var KJ=Object.defineProperty;var YJ=(t,e,r)=>e in t?KJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var QJ=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Iv=(t,e,r)=>YJ(t,typeof e!="symbol"?e+"":e,r);var TAe=QJ((dl,fl)=>{function JJ(t,e){for(var r=0;r<e.length;r++){const o=e[r];if(typeof o!="string"&&!Array.isArray(o)){for(const c in o)if(c!=="default"&&!(c in t)){const f=Object.getOwnPropertyDescriptor(o,c);f&&Object.defineProperty(t,c,f.get?f:{enumerable:!0,get:()=>o[c]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const f of c)if(f.type==="childList")for(const _ of f.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&o(_)}).observe(document,{childList:!0,subtree:!0});function r(c){const f={};return c.integrity&&(f.integrity=c.integrity),c.referrerPolicy&&(f.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?f.credentials="include":c.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function o(c){if(c.ep)return;c.ep=!0;const f=r(c);fetch(c.href,f)}})();var e2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wm(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var y8={exports:{}},aI={},v8={exports:{}},Yr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j1=Symbol.for("react.element"),t2=Symbol.for("react.portal"),n2=Symbol.for("react.fragment"),r2=Symbol.for("react.strict_mode"),i2=Symbol.for("react.profiler"),s2=Symbol.for("react.provider"),o2=Symbol.for("react.context"),a2=Symbol.for("react.forward_ref"),l2=Symbol.for("react.suspense"),c2=Symbol.for("react.memo"),u2=Symbol.for("react.lazy"),mB=Symbol.iterator;function h2(t){return t===null||typeof t!="object"?null:(t=mB&&t[mB]||t["@@iterator"],typeof t=="function"?t:null)}var x8={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b8=Object.assign,w8={};function Uy(t,e,r){this.props=t,this.context=e,this.refs=w8,this.updater=r||x8}Uy.prototype.isReactComponent={};Uy.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Uy.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function T8(){}T8.prototype=Uy.prototype;function ID(t,e,r){this.props=t,this.context=e,this.refs=w8,this.updater=r||x8}var AD=ID.prototype=new T8;AD.constructor=ID;b8(AD,Uy.prototype);AD.isPureReactComponent=!0;var gB=Array.isArray,E8=Object.prototype.hasOwnProperty,CD={current:null},S8={key:!0,ref:!0,__self:!0,__source:!0};function I8(t,e,r){var o,c={},f=null,_=null;if(e!=null)for(o in e.ref!==void 0&&(_=e.ref),e.key!==void 0&&(f=""+e.key),e)E8.call(e,o)&&!S8.hasOwnProperty(o)&&(c[o]=e[o]);var x=arguments.length-2;if(x===1)c.children=r;else if(1<x){for(var a=Array(x),I=0;I<x;I++)a[I]=arguments[I+2];c.children=a}if(t&&t.defaultProps)for(o in x=t.defaultProps,x)c[o]===void 0&&(c[o]=x[o]);return{$$typeof:j1,type:t,key:f,ref:_,props:c,_owner:CD.current}}function d2(t,e){return{$$typeof:j1,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function PD(t){return typeof t=="object"&&t!==null&&t.$$typeof===j1}function f2(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var _B=/\/+/g;function bR(t,e){return typeof t=="object"&&t!==null&&t.key!=null?f2(""+t.key):e.toString(36)}function rE(t,e,r,o,c){var f=typeof t;(f==="undefined"||f==="boolean")&&(t=null);var _=!1;if(t===null)_=!0;else switch(f){case"string":case"number":_=!0;break;case"object":switch(t.$$typeof){case j1:case t2:_=!0}}if(_)return _=t,c=c(_),t=o===""?"."+bR(_,0):o,gB(c)?(r="",t!=null&&(r=t.replace(_B,"$&/")+"/"),rE(c,e,r,"",function(I){return I})):c!=null&&(PD(c)&&(c=d2(c,r+(!c.key||_&&_.key===c.key?"":(""+c.key).replace(_B,"$&/")+"/")+t)),e.push(c)),1;if(_=0,o=o===""?".":o+":",gB(t))for(var x=0;x<t.length;x++){f=t[x];var a=o+bR(f,x);_+=rE(f,e,r,a,c)}else if(a=h2(t),typeof a=="function")for(t=a.call(t),x=0;!(f=t.next()).done;)f=f.value,a=o+bR(f,x++),_+=rE(f,e,r,a,c);else if(f==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return _}function gT(t,e,r){if(t==null)return t;var o=[],c=0;return rE(t,o,"","",function(f){return e.call(r,f,c++)}),o}function p2(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ea={current:null},iE={transition:null},m2={ReactCurrentDispatcher:Ea,ReactCurrentBatchConfig:iE,ReactCurrentOwner:CD};function A8(){throw Error("act(...) is not supported in production builds of React.")}Yr.Children={map:gT,forEach:function(t,e,r){gT(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return gT(t,function(){e++}),e},toArray:function(t){return gT(t,function(e){return e})||[]},only:function(t){if(!PD(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Yr.Component=Uy;Yr.Fragment=n2;Yr.Profiler=i2;Yr.PureComponent=ID;Yr.StrictMode=r2;Yr.Suspense=l2;Yr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=m2;Yr.act=A8;Yr.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var o=b8({},t.props),c=t.key,f=t.ref,_=t._owner;if(e!=null){if(e.ref!==void 0&&(f=e.ref,_=CD.current),e.key!==void 0&&(c=""+e.key),t.type&&t.type.defaultProps)var x=t.type.defaultProps;for(a in e)E8.call(e,a)&&!S8.hasOwnProperty(a)&&(o[a]=e[a]===void 0&&x!==void 0?x[a]:e[a])}var a=arguments.length-2;if(a===1)o.children=r;else if(1<a){x=Array(a);for(var I=0;I<a;I++)x[I]=arguments[I+2];o.children=x}return{$$typeof:j1,type:t.type,key:c,ref:f,props:o,_owner:_}};Yr.createContext=function(t){return t={$$typeof:o2,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:s2,_context:t},t.Consumer=t};Yr.createElement=I8;Yr.createFactory=function(t){var e=I8.bind(null,t);return e.type=t,e};Yr.createRef=function(){return{current:null}};Yr.forwardRef=function(t){return{$$typeof:a2,render:t}};Yr.isValidElement=PD;Yr.lazy=function(t){return{$$typeof:u2,_payload:{_status:-1,_result:t},_init:p2}};Yr.memo=function(t,e){return{$$typeof:c2,type:t,compare:e===void 0?null:e}};Yr.startTransition=function(t){var e=iE.transition;iE.transition={};try{t()}finally{iE.transition=e}};Yr.unstable_act=A8;Yr.useCallback=function(t,e){return Ea.current.useCallback(t,e)};Yr.useContext=function(t){return Ea.current.useContext(t)};Yr.useDebugValue=function(){};Yr.useDeferredValue=function(t){return Ea.current.useDeferredValue(t)};Yr.useEffect=function(t,e){return Ea.current.useEffect(t,e)};Yr.useId=function(){return Ea.current.useId()};Yr.useImperativeHandle=function(t,e,r){return Ea.current.useImperativeHandle(t,e,r)};Yr.useInsertionEffect=function(t,e){return Ea.current.useInsertionEffect(t,e)};Yr.useLayoutEffect=function(t,e){return Ea.current.useLayoutEffect(t,e)};Yr.useMemo=function(t,e){return Ea.current.useMemo(t,e)};Yr.useReducer=function(t,e,r){return Ea.current.useReducer(t,e,r)};Yr.useRef=function(t){return Ea.current.useRef(t)};Yr.useState=function(t){return Ea.current.useState(t)};Yr.useSyncExternalStore=function(t,e,r){return Ea.current.useSyncExternalStore(t,e,r)};Yr.useTransition=function(){return Ea.current.useTransition()};Yr.version="18.3.1";v8.exports=Yr;var ee=v8.exports;const Qr=Wm(ee),BE=JJ({__proto__:null,default:Qr},[ee]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g2=ee,_2=Symbol.for("react.element"),y2=Symbol.for("react.fragment"),v2=Object.prototype.hasOwnProperty,x2=g2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,b2={key:!0,ref:!0,__self:!0,__source:!0};function C8(t,e,r){var o,c={},f=null,_=null;r!==void 0&&(f=""+r),e.key!==void 0&&(f=""+e.key),e.ref!==void 0&&(_=e.ref);for(o in e)v2.call(e,o)&&!b2.hasOwnProperty(o)&&(c[o]=e[o]);if(t&&t.defaultProps)for(o in e=t.defaultProps,e)c[o]===void 0&&(c[o]=e[o]);return{$$typeof:_2,type:t,key:f,ref:_,props:c,_owner:x2.current}}aI.Fragment=y2;aI.jsx=C8;aI.jsxs=C8;y8.exports=aI;var V=y8.exports,P8={exports:{}},xl={},R8={exports:{}},M8={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(lt,At){var nn=lt.length;lt.push(At);e:for(;0<nn;){var fn=nn-1>>>1,mn=lt[fn];if(0<c(mn,At))lt[fn]=At,lt[nn]=mn,nn=fn;else break e}}function r(lt){return lt.length===0?null:lt[0]}function o(lt){if(lt.length===0)return null;var At=lt[0],nn=lt.pop();if(nn!==At){lt[0]=nn;e:for(var fn=0,mn=lt.length,Vt=mn>>>1;fn<Vt;){var wn=2*(fn+1)-1,Ht=lt[wn],Hn=wn+1,Jn=lt[Hn];if(0>c(Ht,nn))Hn<mn&&0>c(Jn,Ht)?(lt[fn]=Jn,lt[Hn]=nn,fn=Hn):(lt[fn]=Ht,lt[wn]=nn,fn=wn);else if(Hn<mn&&0>c(Jn,nn))lt[fn]=Jn,lt[Hn]=nn,fn=Hn;else break e}}return At}function c(lt,At){var nn=lt.sortIndex-At.sortIndex;return nn!==0?nn:lt.id-At.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;t.unstable_now=function(){return f.now()}}else{var _=Date,x=_.now();t.unstable_now=function(){return _.now()-x}}var a=[],I=[],D=1,O=null,F=3,Z=!1,J=!1,ne=!1,se=typeof setTimeout=="function"?setTimeout:null,W=typeof clearTimeout=="function"?clearTimeout:null,Q=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function K(lt){for(var At=r(I);At!==null;){if(At.callback===null)o(I);else if(At.startTime<=lt)o(I),At.sortIndex=At.expirationTime,e(a,At);else break;At=r(I)}}function pe(lt){if(ne=!1,K(lt),!J)if(r(a)!==null)J=!0,Qt(Te);else{var At=r(I);At!==null&&Pt(pe,At.startTime-lt)}}function Te(lt,At){J=!1,ne&&(ne=!1,W(de),de=-1),Z=!0;var nn=F;try{for(K(At),O=r(a);O!==null&&(!(O.expirationTime>At)||lt&&!be());){var fn=O.callback;if(typeof fn=="function"){O.callback=null,F=O.priorityLevel;var mn=fn(O.expirationTime<=At);At=t.unstable_now(),typeof mn=="function"?O.callback=mn:O===r(a)&&o(a),K(At)}else o(a);O=r(a)}if(O!==null)var Vt=!0;else{var wn=r(I);wn!==null&&Pt(pe,wn.startTime-At),Vt=!1}return Vt}finally{O=null,F=nn,Z=!1}}var we=!1,oe=null,de=-1,X=5,ge=-1;function be(){return!(t.unstable_now()-ge<X)}function ke(){if(oe!==null){var lt=t.unstable_now();ge=lt;var At=!0;try{At=oe(!0,lt)}finally{At?Ee():(we=!1,oe=null)}}else we=!1}var Ee;if(typeof Q=="function")Ee=function(){Q(ke)};else if(typeof MessageChannel<"u"){var Lt=new MessageChannel,jt=Lt.port2;Lt.port1.onmessage=ke,Ee=function(){jt.postMessage(null)}}else Ee=function(){se(ke,0)};function Qt(lt){oe=lt,we||(we=!0,Ee())}function Pt(lt,At){de=se(function(){lt(t.unstable_now())},At)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(lt){lt.callback=null},t.unstable_continueExecution=function(){J||Z||(J=!0,Qt(Te))},t.unstable_forceFrameRate=function(lt){0>lt||125<lt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):X=0<lt?Math.floor(1e3/lt):5},t.unstable_getCurrentPriorityLevel=function(){return F},t.unstable_getFirstCallbackNode=function(){return r(a)},t.unstable_next=function(lt){switch(F){case 1:case 2:case 3:var At=3;break;default:At=F}var nn=F;F=At;try{return lt()}finally{F=nn}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(lt,At){switch(lt){case 1:case 2:case 3:case 4:case 5:break;default:lt=3}var nn=F;F=lt;try{return At()}finally{F=nn}},t.unstable_scheduleCallback=function(lt,At,nn){var fn=t.unstable_now();switch(typeof nn=="object"&&nn!==null?(nn=nn.delay,nn=typeof nn=="number"&&0<nn?fn+nn:fn):nn=fn,lt){case 1:var mn=-1;break;case 2:mn=250;break;case 5:mn=1073741823;break;case 4:mn=1e4;break;default:mn=5e3}return mn=nn+mn,lt={id:D++,callback:At,priorityLevel:lt,startTime:nn,expirationTime:mn,sortIndex:-1},nn>fn?(lt.sortIndex=nn,e(I,lt),r(a)===null&&lt===r(I)&&(ne?(W(de),de=-1):ne=!0,Pt(pe,nn-fn))):(lt.sortIndex=mn,e(a,lt),J||Z||(J=!0,Qt(Te))),lt},t.unstable_shouldYield=be,t.unstable_wrapCallback=function(lt){var At=F;return function(){var nn=F;F=At;try{return lt.apply(this,arguments)}finally{F=nn}}}})(M8);R8.exports=M8;var w2=R8.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var T2=ee,vl=w2;function un(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var k8=new Set,Wx={};function Hm(t,e){fy(t,e),fy(t+"Capture",e)}function fy(t,e){for(Wx[t]=e,t=0;t<e.length;t++)k8.add(e[t])}var Vh=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qM=Object.prototype.hasOwnProperty,E2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,yB={},vB={};function S2(t){return qM.call(vB,t)?!0:qM.call(yB,t)?!1:E2.test(t)?vB[t]=!0:(yB[t]=!0,!1)}function I2(t,e,r,o){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return o?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function A2(t,e,r,o){if(e===null||typeof e>"u"||I2(t,e,r,o))return!0;if(o)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Sa(t,e,r,o,c,f,_){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=o,this.attributeNamespace=c,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=f,this.removeEmptyString=_}var Fo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Fo[t]=new Sa(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Fo[e]=new Sa(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Fo[t]=new Sa(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Fo[t]=new Sa(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Fo[t]=new Sa(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Fo[t]=new Sa(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Fo[t]=new Sa(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Fo[t]=new Sa(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Fo[t]=new Sa(t,5,!1,t.toLowerCase(),null,!1,!1)});var RD=/[\-:]([a-z])/g;function MD(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(RD,MD);Fo[e]=new Sa(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(RD,MD);Fo[e]=new Sa(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(RD,MD);Fo[e]=new Sa(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Fo[t]=new Sa(t,1,!1,t.toLowerCase(),null,!1,!1)});Fo.xlinkHref=new Sa("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Fo[t]=new Sa(t,1,!1,t.toLowerCase(),null,!0,!0)});function kD(t,e,r,o){var c=Fo.hasOwnProperty(e)?Fo[e]:null;(c!==null?c.type!==0:o||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(A2(e,r,c,o)&&(r=null),o||c===null?S2(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):c.mustUseProperty?t[c.propertyName]=r===null?c.type===3?!1:"":r:(e=c.attributeName,o=c.attributeNamespace,r===null?t.removeAttribute(e):(c=c.type,r=c===3||c===4&&r===!0?"":""+r,o?t.setAttributeNS(o,e,r):t.setAttribute(e,r))))}var td=T2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_T=Symbol.for("react.element"),O_=Symbol.for("react.portal"),L_=Symbol.for("react.fragment"),DD=Symbol.for("react.strict_mode"),WM=Symbol.for("react.profiler"),D8=Symbol.for("react.provider"),O8=Symbol.for("react.context"),OD=Symbol.for("react.forward_ref"),HM=Symbol.for("react.suspense"),ZM=Symbol.for("react.suspense_list"),LD=Symbol.for("react.memo"),tf=Symbol.for("react.lazy"),L8=Symbol.for("react.offscreen"),xB=Symbol.iterator;function Av(t){return t===null||typeof t!="object"?null:(t=xB&&t[xB]||t["@@iterator"],typeof t=="function"?t:null)}var Is=Object.assign,wR;function Zv(t){if(wR===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);wR=e&&e[1]||""}return`
`+wR+t}var TR=!1;function ER(t,e){if(!t||TR)return"";TR=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(I){var o=I}Reflect.construct(t,[],e)}else{try{e.call()}catch(I){o=I}t.call(e.prototype)}else{try{throw Error()}catch(I){o=I}t()}}catch(I){if(I&&o&&typeof I.stack=="string"){for(var c=I.stack.split(`
`),f=o.stack.split(`
`),_=c.length-1,x=f.length-1;1<=_&&0<=x&&c[_]!==f[x];)x--;for(;1<=_&&0<=x;_--,x--)if(c[_]!==f[x]){if(_!==1||x!==1)do if(_--,x--,0>x||c[_]!==f[x]){var a=`
`+c[_].replace(" at new "," at ");return t.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",t.displayName)),a}while(1<=_&&0<=x);break}}}finally{TR=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?Zv(t):""}function C2(t){switch(t.tag){case 5:return Zv(t.type);case 16:return Zv("Lazy");case 13:return Zv("Suspense");case 19:return Zv("SuspenseList");case 0:case 2:case 15:return t=ER(t.type,!1),t;case 11:return t=ER(t.type.render,!1),t;case 1:return t=ER(t.type,!0),t;default:return""}}function XM(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case L_:return"Fragment";case O_:return"Portal";case WM:return"Profiler";case DD:return"StrictMode";case HM:return"Suspense";case ZM:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case O8:return(t.displayName||"Context")+".Consumer";case D8:return(t._context.displayName||"Context")+".Provider";case OD:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case LD:return e=t.displayName||null,e!==null?e:XM(t.type)||"Memo";case tf:e=t._payload,t=t._init;try{return XM(t(e))}catch{}}return null}function P2(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return XM(e);case 8:return e===DD?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Lf(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function z8(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function R2(t){var e=z8(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),o=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var c=r.get,f=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return c.call(this)},set:function(_){o=""+_,f.call(this,_)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return o},setValue:function(_){o=""+_},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function yT(t){t._valueTracker||(t._valueTracker=R2(t))}function N8(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),o="";return t&&(o=z8(t)?t.checked?"true":"false":t.value),t=o,t!==r?(e.setValue(t),!0):!1}function jE(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function KM(t,e){var r=e.checked;return Is({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function bB(t,e){var r=e.defaultValue==null?"":e.defaultValue,o=e.checked!=null?e.checked:e.defaultChecked;r=Lf(e.value!=null?e.value:r),t._wrapperState={initialChecked:o,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function F8(t,e){e=e.checked,e!=null&&kD(t,"checked",e,!1)}function YM(t,e){F8(t,e);var r=Lf(e.value),o=e.type;if(r!=null)o==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(o==="submit"||o==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?QM(t,e.type,r):e.hasOwnProperty("defaultValue")&&QM(t,e.type,Lf(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function wB(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var o=e.type;if(!(o!=="submit"&&o!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function QM(t,e,r){(e!=="number"||jE(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var Xv=Array.isArray;function Y_(t,e,r,o){if(t=t.options,e){e={};for(var c=0;c<r.length;c++)e["$"+r[c]]=!0;for(r=0;r<t.length;r++)c=e.hasOwnProperty("$"+t[r].value),t[r].selected!==c&&(t[r].selected=c),c&&o&&(t[r].defaultSelected=!0)}else{for(r=""+Lf(r),e=null,c=0;c<t.length;c++){if(t[c].value===r){t[c].selected=!0,o&&(t[c].defaultSelected=!0);return}e!==null||t[c].disabled||(e=t[c])}e!==null&&(e.selected=!0)}}function JM(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(un(91));return Is({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function TB(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(un(92));if(Xv(r)){if(1<r.length)throw Error(un(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:Lf(r)}}function B8(t,e){var r=Lf(e.value),o=Lf(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),o!=null&&(t.defaultValue=""+o)}function EB(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function j8(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ek(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?j8(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var vT,U8=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,o,c){MSApp.execUnsafeLocalFunction(function(){return t(e,r,o,c)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(vT=vT||document.createElement("div"),vT.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=vT.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Hx(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var px={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},M2=["Webkit","ms","Moz","O"];Object.keys(px).forEach(function(t){M2.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),px[e]=px[t]})});function V8(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||px.hasOwnProperty(t)&&px[t]?(""+e).trim():e+"px"}function $8(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var o=r.indexOf("--")===0,c=V8(r,e[r],o);r==="float"&&(r="cssFloat"),o?t.setProperty(r,c):t[r]=c}}var k2=Is({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function tk(t,e){if(e){if(k2[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(un(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(un(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(un(61))}if(e.style!=null&&typeof e.style!="object")throw Error(un(62))}}function nk(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rk=null;function zD(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ik=null,Q_=null,J_=null;function SB(t){if(t=$1(t)){if(typeof ik!="function")throw Error(un(280));var e=t.stateNode;e&&(e=dI(e),ik(t.stateNode,t.type,e))}}function G8(t){Q_?J_?J_.push(t):J_=[t]:Q_=t}function q8(){if(Q_){var t=Q_,e=J_;if(J_=Q_=null,SB(t),e)for(t=0;t<e.length;t++)SB(e[t])}}function W8(t,e){return t(e)}function H8(){}var SR=!1;function Z8(t,e,r){if(SR)return t(e,r);SR=!0;try{return W8(t,e,r)}finally{SR=!1,(Q_!==null||J_!==null)&&(H8(),q8())}}function Zx(t,e){var r=t.stateNode;if(r===null)return null;var o=dI(r);if(o===null)return null;r=o[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(t=t.type,o=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!o;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(un(231,e,typeof r));return r}var sk=!1;if(Vh)try{var Cv={};Object.defineProperty(Cv,"passive",{get:function(){sk=!0}}),window.addEventListener("test",Cv,Cv),window.removeEventListener("test",Cv,Cv)}catch{sk=!1}function D2(t,e,r,o,c,f,_,x,a){var I=Array.prototype.slice.call(arguments,3);try{e.apply(r,I)}catch(D){this.onError(D)}}var mx=!1,UE=null,VE=!1,ok=null,O2={onError:function(t){mx=!0,UE=t}};function L2(t,e,r,o,c,f,_,x,a){mx=!1,UE=null,D2.apply(O2,arguments)}function z2(t,e,r,o,c,f,_,x,a){if(L2.apply(this,arguments),mx){if(mx){var I=UE;mx=!1,UE=null}else throw Error(un(198));VE||(VE=!0,ok=I)}}function Zm(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function X8(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function IB(t){if(Zm(t)!==t)throw Error(un(188))}function N2(t){var e=t.alternate;if(!e){if(e=Zm(t),e===null)throw Error(un(188));return e!==t?null:t}for(var r=t,o=e;;){var c=r.return;if(c===null)break;var f=c.alternate;if(f===null){if(o=c.return,o!==null){r=o;continue}break}if(c.child===f.child){for(f=c.child;f;){if(f===r)return IB(c),t;if(f===o)return IB(c),e;f=f.sibling}throw Error(un(188))}if(r.return!==o.return)r=c,o=f;else{for(var _=!1,x=c.child;x;){if(x===r){_=!0,r=c,o=f;break}if(x===o){_=!0,o=c,r=f;break}x=x.sibling}if(!_){for(x=f.child;x;){if(x===r){_=!0,r=f,o=c;break}if(x===o){_=!0,o=f,r=c;break}x=x.sibling}if(!_)throw Error(un(189))}}if(r.alternate!==o)throw Error(un(190))}if(r.tag!==3)throw Error(un(188));return r.stateNode.current===r?t:e}function K8(t){return t=N2(t),t!==null?Y8(t):null}function Y8(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Y8(t);if(e!==null)return e;t=t.sibling}return null}var Q8=vl.unstable_scheduleCallback,AB=vl.unstable_cancelCallback,F2=vl.unstable_shouldYield,B2=vl.unstable_requestPaint,$s=vl.unstable_now,j2=vl.unstable_getCurrentPriorityLevel,ND=vl.unstable_ImmediatePriority,J8=vl.unstable_UserBlockingPriority,$E=vl.unstable_NormalPriority,U2=vl.unstable_LowPriority,e9=vl.unstable_IdlePriority,lI=null,Lu=null;function V2(t){if(Lu&&typeof Lu.onCommitFiberRoot=="function")try{Lu.onCommitFiberRoot(lI,t,void 0,(t.current.flags&128)===128)}catch{}}var Nc=Math.clz32?Math.clz32:q2,$2=Math.log,G2=Math.LN2;function q2(t){return t>>>=0,t===0?32:31-($2(t)/G2|0)|0}var xT=64,bT=4194304;function Kv(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function GE(t,e){var r=t.pendingLanes;if(r===0)return 0;var o=0,c=t.suspendedLanes,f=t.pingedLanes,_=r&268435455;if(_!==0){var x=_&~c;x!==0?o=Kv(x):(f&=_,f!==0&&(o=Kv(f)))}else _=r&~c,_!==0?o=Kv(_):f!==0&&(o=Kv(f));if(o===0)return 0;if(e!==0&&e!==o&&!(e&c)&&(c=o&-o,f=e&-e,c>=f||c===16&&(f&4194240)!==0))return e;if(o&4&&(o|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=o;0<e;)r=31-Nc(e),c=1<<r,o|=t[r],e&=~c;return o}function W2(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function H2(t,e){for(var r=t.suspendedLanes,o=t.pingedLanes,c=t.expirationTimes,f=t.pendingLanes;0<f;){var _=31-Nc(f),x=1<<_,a=c[_];a===-1?(!(x&r)||x&o)&&(c[_]=W2(x,e)):a<=e&&(t.expiredLanes|=x),f&=~x}}function ak(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function t9(){var t=xT;return xT<<=1,!(xT&4194240)&&(xT=64),t}function IR(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function U1(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Nc(e),t[e]=r}function Z2(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var o=t.eventTimes;for(t=t.expirationTimes;0<r;){var c=31-Nc(r),f=1<<c;e[c]=0,o[c]=-1,t[c]=-1,r&=~f}}function FD(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var o=31-Nc(r),c=1<<o;c&e|t[o]&e&&(t[o]|=e),r&=~c}}var Pi=0;function n9(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var r9,BD,i9,s9,o9,lk=!1,wT=[],xf=null,bf=null,wf=null,Xx=new Map,Kx=new Map,sf=[],X2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function CB(t,e){switch(t){case"focusin":case"focusout":xf=null;break;case"dragenter":case"dragleave":bf=null;break;case"mouseover":case"mouseout":wf=null;break;case"pointerover":case"pointerout":Xx.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Kx.delete(e.pointerId)}}function Pv(t,e,r,o,c,f){return t===null||t.nativeEvent!==f?(t={blockedOn:e,domEventName:r,eventSystemFlags:o,nativeEvent:f,targetContainers:[c]},e!==null&&(e=$1(e),e!==null&&BD(e)),t):(t.eventSystemFlags|=o,e=t.targetContainers,c!==null&&e.indexOf(c)===-1&&e.push(c),t)}function K2(t,e,r,o,c){switch(e){case"focusin":return xf=Pv(xf,t,e,r,o,c),!0;case"dragenter":return bf=Pv(bf,t,e,r,o,c),!0;case"mouseover":return wf=Pv(wf,t,e,r,o,c),!0;case"pointerover":var f=c.pointerId;return Xx.set(f,Pv(Xx.get(f)||null,t,e,r,o,c)),!0;case"gotpointercapture":return f=c.pointerId,Kx.set(f,Pv(Kx.get(f)||null,t,e,r,o,c)),!0}return!1}function a9(t){var e=lm(t.target);if(e!==null){var r=Zm(e);if(r!==null){if(e=r.tag,e===13){if(e=X8(r),e!==null){t.blockedOn=e,o9(t.priority,function(){i9(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function sE(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=ck(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var o=new r.constructor(r.type,r);rk=o,r.target.dispatchEvent(o),rk=null}else return e=$1(r),e!==null&&BD(e),t.blockedOn=r,!1;e.shift()}return!0}function PB(t,e,r){sE(t)&&r.delete(e)}function Y2(){lk=!1,xf!==null&&sE(xf)&&(xf=null),bf!==null&&sE(bf)&&(bf=null),wf!==null&&sE(wf)&&(wf=null),Xx.forEach(PB),Kx.forEach(PB)}function Rv(t,e){t.blockedOn===e&&(t.blockedOn=null,lk||(lk=!0,vl.unstable_scheduleCallback(vl.unstable_NormalPriority,Y2)))}function Yx(t){function e(c){return Rv(c,t)}if(0<wT.length){Rv(wT[0],t);for(var r=1;r<wT.length;r++){var o=wT[r];o.blockedOn===t&&(o.blockedOn=null)}}for(xf!==null&&Rv(xf,t),bf!==null&&Rv(bf,t),wf!==null&&Rv(wf,t),Xx.forEach(e),Kx.forEach(e),r=0;r<sf.length;r++)o=sf[r],o.blockedOn===t&&(o.blockedOn=null);for(;0<sf.length&&(r=sf[0],r.blockedOn===null);)a9(r),r.blockedOn===null&&sf.shift()}var ey=td.ReactCurrentBatchConfig,qE=!0;function Q2(t,e,r,o){var c=Pi,f=ey.transition;ey.transition=null;try{Pi=1,jD(t,e,r,o)}finally{Pi=c,ey.transition=f}}function J2(t,e,r,o){var c=Pi,f=ey.transition;ey.transition=null;try{Pi=4,jD(t,e,r,o)}finally{Pi=c,ey.transition=f}}function jD(t,e,r,o){if(qE){var c=ck(t,e,r,o);if(c===null)zR(t,e,o,WE,r),CB(t,o);else if(K2(c,t,e,r,o))o.stopPropagation();else if(CB(t,o),e&4&&-1<X2.indexOf(t)){for(;c!==null;){var f=$1(c);if(f!==null&&r9(f),f=ck(t,e,r,o),f===null&&zR(t,e,o,WE,r),f===c)break;c=f}c!==null&&o.stopPropagation()}else zR(t,e,o,null,r)}}var WE=null;function ck(t,e,r,o){if(WE=null,t=zD(o),t=lm(t),t!==null)if(e=Zm(t),e===null)t=null;else if(r=e.tag,r===13){if(t=X8(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return WE=t,null}function l9(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(j2()){case ND:return 1;case J8:return 4;case $E:case U2:return 16;case e9:return 536870912;default:return 16}default:return 16}}var df=null,UD=null,oE=null;function c9(){if(oE)return oE;var t,e=UD,r=e.length,o,c="value"in df?df.value:df.textContent,f=c.length;for(t=0;t<r&&e[t]===c[t];t++);var _=r-t;for(o=1;o<=_&&e[r-o]===c[f-o];o++);return oE=c.slice(t,1<o?1-o:void 0)}function aE(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function TT(){return!0}function RB(){return!1}function bl(t){function e(r,o,c,f,_){this._reactName=r,this._targetInst=c,this.type=o,this.nativeEvent=f,this.target=_,this.currentTarget=null;for(var x in t)t.hasOwnProperty(x)&&(r=t[x],this[x]=r?r(f):f[x]);return this.isDefaultPrevented=(f.defaultPrevented!=null?f.defaultPrevented:f.returnValue===!1)?TT:RB,this.isPropagationStopped=RB,this}return Is(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=TT)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=TT)},persist:function(){},isPersistent:TT}),e}var Vy={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},VD=bl(Vy),V1=Is({},Vy,{view:0,detail:0}),eee=bl(V1),AR,CR,Mv,cI=Is({},V1,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$D,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Mv&&(Mv&&t.type==="mousemove"?(AR=t.screenX-Mv.screenX,CR=t.screenY-Mv.screenY):CR=AR=0,Mv=t),AR)},movementY:function(t){return"movementY"in t?t.movementY:CR}}),MB=bl(cI),tee=Is({},cI,{dataTransfer:0}),nee=bl(tee),ree=Is({},V1,{relatedTarget:0}),PR=bl(ree),iee=Is({},Vy,{animationName:0,elapsedTime:0,pseudoElement:0}),see=bl(iee),oee=Is({},Vy,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),aee=bl(oee),lee=Is({},Vy,{data:0}),kB=bl(lee),cee={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},uee={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hee={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dee(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=hee[t])?!!e[t]:!1}function $D(){return dee}var fee=Is({},V1,{key:function(t){if(t.key){var e=cee[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=aE(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?uee[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$D,charCode:function(t){return t.type==="keypress"?aE(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?aE(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),pee=bl(fee),mee=Is({},cI,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),DB=bl(mee),gee=Is({},V1,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$D}),_ee=bl(gee),yee=Is({},Vy,{propertyName:0,elapsedTime:0,pseudoElement:0}),vee=bl(yee),xee=Is({},cI,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),bee=bl(xee),wee=[9,13,27,32],GD=Vh&&"CompositionEvent"in window,gx=null;Vh&&"documentMode"in document&&(gx=document.documentMode);var Tee=Vh&&"TextEvent"in window&&!gx,u9=Vh&&(!GD||gx&&8<gx&&11>=gx),OB=" ",LB=!1;function h9(t,e){switch(t){case"keyup":return wee.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function d9(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var z_=!1;function Eee(t,e){switch(t){case"compositionend":return d9(e);case"keypress":return e.which!==32?null:(LB=!0,OB);case"textInput":return t=e.data,t===OB&&LB?null:t;default:return null}}function See(t,e){if(z_)return t==="compositionend"||!GD&&h9(t,e)?(t=c9(),oE=UD=df=null,z_=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return u9&&e.locale!=="ko"?null:e.data;default:return null}}var Iee={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zB(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Iee[t.type]:e==="textarea"}function f9(t,e,r,o){G8(o),e=HE(e,"onChange"),0<e.length&&(r=new VD("onChange","change",null,r,o),t.push({event:r,listeners:e}))}var _x=null,Qx=null;function Aee(t){E9(t,0)}function uI(t){var e=B_(t);if(N8(e))return t}function Cee(t,e){if(t==="change")return e}var p9=!1;if(Vh){var RR;if(Vh){var MR="oninput"in document;if(!MR){var NB=document.createElement("div");NB.setAttribute("oninput","return;"),MR=typeof NB.oninput=="function"}RR=MR}else RR=!1;p9=RR&&(!document.documentMode||9<document.documentMode)}function FB(){_x&&(_x.detachEvent("onpropertychange",m9),Qx=_x=null)}function m9(t){if(t.propertyName==="value"&&uI(Qx)){var e=[];f9(e,Qx,t,zD(t)),Z8(Aee,e)}}function Pee(t,e,r){t==="focusin"?(FB(),_x=e,Qx=r,_x.attachEvent("onpropertychange",m9)):t==="focusout"&&FB()}function Ree(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return uI(Qx)}function Mee(t,e){if(t==="click")return uI(e)}function kee(t,e){if(t==="input"||t==="change")return uI(e)}function Dee(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Uc=typeof Object.is=="function"?Object.is:Dee;function Jx(t,e){if(Uc(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(o=0;o<r.length;o++){var c=r[o];if(!qM.call(e,c)||!Uc(t[c],e[c]))return!1}return!0}function BB(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function jB(t,e){var r=BB(t);t=0;for(var o;r;){if(r.nodeType===3){if(o=t+r.textContent.length,t<=e&&o>=e)return{node:r,offset:e-t};t=o}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=BB(r)}}function g9(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?g9(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function _9(){for(var t=window,e=jE();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=jE(t.document)}return e}function qD(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Oee(t){var e=_9(),r=t.focusedElem,o=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&g9(r.ownerDocument.documentElement,r)){if(o!==null&&qD(r)){if(e=o.start,t=o.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var c=r.textContent.length,f=Math.min(o.start,c);o=o.end===void 0?f:Math.min(o.end,c),!t.extend&&f>o&&(c=o,o=f,f=c),c=jB(r,f);var _=jB(r,o);c&&_&&(t.rangeCount!==1||t.anchorNode!==c.node||t.anchorOffset!==c.offset||t.focusNode!==_.node||t.focusOffset!==_.offset)&&(e=e.createRange(),e.setStart(c.node,c.offset),t.removeAllRanges(),f>o?(t.addRange(e),t.extend(_.node,_.offset)):(e.setEnd(_.node,_.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Lee=Vh&&"documentMode"in document&&11>=document.documentMode,N_=null,uk=null,yx=null,hk=!1;function UB(t,e,r){var o=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;hk||N_==null||N_!==jE(o)||(o=N_,"selectionStart"in o&&qD(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),yx&&Jx(yx,o)||(yx=o,o=HE(uk,"onSelect"),0<o.length&&(e=new VD("onSelect","select",null,e,r),t.push({event:e,listeners:o}),e.target=N_)))}function ET(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var F_={animationend:ET("Animation","AnimationEnd"),animationiteration:ET("Animation","AnimationIteration"),animationstart:ET("Animation","AnimationStart"),transitionend:ET("Transition","TransitionEnd")},kR={},y9={};Vh&&(y9=document.createElement("div").style,"AnimationEvent"in window||(delete F_.animationend.animation,delete F_.animationiteration.animation,delete F_.animationstart.animation),"TransitionEvent"in window||delete F_.transitionend.transition);function hI(t){if(kR[t])return kR[t];if(!F_[t])return t;var e=F_[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in y9)return kR[t]=e[r];return t}var v9=hI("animationend"),x9=hI("animationiteration"),b9=hI("animationstart"),w9=hI("transitionend"),T9=new Map,VB="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Wf(t,e){T9.set(t,e),Hm(e,[t])}for(var DR=0;DR<VB.length;DR++){var OR=VB[DR],zee=OR.toLowerCase(),Nee=OR[0].toUpperCase()+OR.slice(1);Wf(zee,"on"+Nee)}Wf(v9,"onAnimationEnd");Wf(x9,"onAnimationIteration");Wf(b9,"onAnimationStart");Wf("dblclick","onDoubleClick");Wf("focusin","onFocus");Wf("focusout","onBlur");Wf(w9,"onTransitionEnd");fy("onMouseEnter",["mouseout","mouseover"]);fy("onMouseLeave",["mouseout","mouseover"]);fy("onPointerEnter",["pointerout","pointerover"]);fy("onPointerLeave",["pointerout","pointerover"]);Hm("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Hm("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Hm("onBeforeInput",["compositionend","keypress","textInput","paste"]);Hm("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Hm("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Hm("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yv="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fee=new Set("cancel close invalid load scroll toggle".split(" ").concat(Yv));function $B(t,e,r){var o=t.type||"unknown-event";t.currentTarget=r,z2(o,e,void 0,t),t.currentTarget=null}function E9(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var o=t[r],c=o.event;o=o.listeners;e:{var f=void 0;if(e)for(var _=o.length-1;0<=_;_--){var x=o[_],a=x.instance,I=x.currentTarget;if(x=x.listener,a!==f&&c.isPropagationStopped())break e;$B(c,x,I),f=a}else for(_=0;_<o.length;_++){if(x=o[_],a=x.instance,I=x.currentTarget,x=x.listener,a!==f&&c.isPropagationStopped())break e;$B(c,x,I),f=a}}}if(VE)throw t=ok,VE=!1,ok=null,t}function Ji(t,e){var r=e[gk];r===void 0&&(r=e[gk]=new Set);var o=t+"__bubble";r.has(o)||(S9(e,t,2,!1),r.add(o))}function LR(t,e,r){var o=0;e&&(o|=4),S9(r,t,o,e)}var ST="_reactListening"+Math.random().toString(36).slice(2);function e1(t){if(!t[ST]){t[ST]=!0,k8.forEach(function(r){r!=="selectionchange"&&(Fee.has(r)||LR(r,!1,t),LR(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ST]||(e[ST]=!0,LR("selectionchange",!1,e))}}function S9(t,e,r,o){switch(l9(e)){case 1:var c=Q2;break;case 4:c=J2;break;default:c=jD}r=c.bind(null,e,r,t),c=void 0,!sk||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(c=!0),o?c!==void 0?t.addEventListener(e,r,{capture:!0,passive:c}):t.addEventListener(e,r,!0):c!==void 0?t.addEventListener(e,r,{passive:c}):t.addEventListener(e,r,!1)}function zR(t,e,r,o,c){var f=o;if(!(e&1)&&!(e&2)&&o!==null)e:for(;;){if(o===null)return;var _=o.tag;if(_===3||_===4){var x=o.stateNode.containerInfo;if(x===c||x.nodeType===8&&x.parentNode===c)break;if(_===4)for(_=o.return;_!==null;){var a=_.tag;if((a===3||a===4)&&(a=_.stateNode.containerInfo,a===c||a.nodeType===8&&a.parentNode===c))return;_=_.return}for(;x!==null;){if(_=lm(x),_===null)return;if(a=_.tag,a===5||a===6){o=f=_;continue e}x=x.parentNode}}o=o.return}Z8(function(){var I=f,D=zD(r),O=[];e:{var F=T9.get(t);if(F!==void 0){var Z=VD,J=t;switch(t){case"keypress":if(aE(r)===0)break e;case"keydown":case"keyup":Z=pee;break;case"focusin":J="focus",Z=PR;break;case"focusout":J="blur",Z=PR;break;case"beforeblur":case"afterblur":Z=PR;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Z=MB;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Z=nee;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Z=_ee;break;case v9:case x9:case b9:Z=see;break;case w9:Z=vee;break;case"scroll":Z=eee;break;case"wheel":Z=bee;break;case"copy":case"cut":case"paste":Z=aee;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Z=DB}var ne=(e&4)!==0,se=!ne&&t==="scroll",W=ne?F!==null?F+"Capture":null:F;ne=[];for(var Q=I,K;Q!==null;){K=Q;var pe=K.stateNode;if(K.tag===5&&pe!==null&&(K=pe,W!==null&&(pe=Zx(Q,W),pe!=null&&ne.push(t1(Q,pe,K)))),se)break;Q=Q.return}0<ne.length&&(F=new Z(F,J,null,r,D),O.push({event:F,listeners:ne}))}}if(!(e&7)){e:{if(F=t==="mouseover"||t==="pointerover",Z=t==="mouseout"||t==="pointerout",F&&r!==rk&&(J=r.relatedTarget||r.fromElement)&&(lm(J)||J[$h]))break e;if((Z||F)&&(F=D.window===D?D:(F=D.ownerDocument)?F.defaultView||F.parentWindow:window,Z?(J=r.relatedTarget||r.toElement,Z=I,J=J?lm(J):null,J!==null&&(se=Zm(J),J!==se||J.tag!==5&&J.tag!==6)&&(J=null)):(Z=null,J=I),Z!==J)){if(ne=MB,pe="onMouseLeave",W="onMouseEnter",Q="mouse",(t==="pointerout"||t==="pointerover")&&(ne=DB,pe="onPointerLeave",W="onPointerEnter",Q="pointer"),se=Z==null?F:B_(Z),K=J==null?F:B_(J),F=new ne(pe,Q+"leave",Z,r,D),F.target=se,F.relatedTarget=K,pe=null,lm(D)===I&&(ne=new ne(W,Q+"enter",J,r,D),ne.target=K,ne.relatedTarget=se,pe=ne),se=pe,Z&&J)t:{for(ne=Z,W=J,Q=0,K=ne;K;K=g_(K))Q++;for(K=0,pe=W;pe;pe=g_(pe))K++;for(;0<Q-K;)ne=g_(ne),Q--;for(;0<K-Q;)W=g_(W),K--;for(;Q--;){if(ne===W||W!==null&&ne===W.alternate)break t;ne=g_(ne),W=g_(W)}ne=null}else ne=null;Z!==null&&GB(O,F,Z,ne,!1),J!==null&&se!==null&&GB(O,se,J,ne,!0)}}e:{if(F=I?B_(I):window,Z=F.nodeName&&F.nodeName.toLowerCase(),Z==="select"||Z==="input"&&F.type==="file")var Te=Cee;else if(zB(F))if(p9)Te=kee;else{Te=Ree;var we=Pee}else(Z=F.nodeName)&&Z.toLowerCase()==="input"&&(F.type==="checkbox"||F.type==="radio")&&(Te=Mee);if(Te&&(Te=Te(t,I))){f9(O,Te,r,D);break e}we&&we(t,F,I),t==="focusout"&&(we=F._wrapperState)&&we.controlled&&F.type==="number"&&QM(F,"number",F.value)}switch(we=I?B_(I):window,t){case"focusin":(zB(we)||we.contentEditable==="true")&&(N_=we,uk=I,yx=null);break;case"focusout":yx=uk=N_=null;break;case"mousedown":hk=!0;break;case"contextmenu":case"mouseup":case"dragend":hk=!1,UB(O,r,D);break;case"selectionchange":if(Lee)break;case"keydown":case"keyup":UB(O,r,D)}var oe;if(GD)e:{switch(t){case"compositionstart":var de="onCompositionStart";break e;case"compositionend":de="onCompositionEnd";break e;case"compositionupdate":de="onCompositionUpdate";break e}de=void 0}else z_?h9(t,r)&&(de="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(de="onCompositionStart");de&&(u9&&r.locale!=="ko"&&(z_||de!=="onCompositionStart"?de==="onCompositionEnd"&&z_&&(oe=c9()):(df=D,UD="value"in df?df.value:df.textContent,z_=!0)),we=HE(I,de),0<we.length&&(de=new kB(de,t,null,r,D),O.push({event:de,listeners:we}),oe?de.data=oe:(oe=d9(r),oe!==null&&(de.data=oe)))),(oe=Tee?Eee(t,r):See(t,r))&&(I=HE(I,"onBeforeInput"),0<I.length&&(D=new kB("onBeforeInput","beforeinput",null,r,D),O.push({event:D,listeners:I}),D.data=oe))}E9(O,e)})}function t1(t,e,r){return{instance:t,listener:e,currentTarget:r}}function HE(t,e){for(var r=e+"Capture",o=[];t!==null;){var c=t,f=c.stateNode;c.tag===5&&f!==null&&(c=f,f=Zx(t,r),f!=null&&o.unshift(t1(t,f,c)),f=Zx(t,e),f!=null&&o.push(t1(t,f,c))),t=t.return}return o}function g_(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function GB(t,e,r,o,c){for(var f=e._reactName,_=[];r!==null&&r!==o;){var x=r,a=x.alternate,I=x.stateNode;if(a!==null&&a===o)break;x.tag===5&&I!==null&&(x=I,c?(a=Zx(r,f),a!=null&&_.unshift(t1(r,a,x))):c||(a=Zx(r,f),a!=null&&_.push(t1(r,a,x)))),r=r.return}_.length!==0&&t.push({event:e,listeners:_})}var Bee=/\r\n?/g,jee=/\u0000|\uFFFD/g;function qB(t){return(typeof t=="string"?t:""+t).replace(Bee,`
`).replace(jee,"")}function IT(t,e,r){if(e=qB(e),qB(t)!==e&&r)throw Error(un(425))}function ZE(){}var dk=null,fk=null;function pk(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var mk=typeof setTimeout=="function"?setTimeout:void 0,Uee=typeof clearTimeout=="function"?clearTimeout:void 0,WB=typeof Promise=="function"?Promise:void 0,Vee=typeof queueMicrotask=="function"?queueMicrotask:typeof WB<"u"?function(t){return WB.resolve(null).then(t).catch($ee)}:mk;function $ee(t){setTimeout(function(){throw t})}function NR(t,e){var r=e,o=0;do{var c=r.nextSibling;if(t.removeChild(r),c&&c.nodeType===8)if(r=c.data,r==="/$"){if(o===0){t.removeChild(c),Yx(e);return}o--}else r!=="$"&&r!=="$?"&&r!=="$!"||o++;r=c}while(r);Yx(e)}function Tf(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function HB(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var $y=Math.random().toString(36).slice(2),Pu="__reactFiber$"+$y,n1="__reactProps$"+$y,$h="__reactContainer$"+$y,gk="__reactEvents$"+$y,Gee="__reactListeners$"+$y,qee="__reactHandles$"+$y;function lm(t){var e=t[Pu];if(e)return e;for(var r=t.parentNode;r;){if(e=r[$h]||r[Pu]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=HB(t);t!==null;){if(r=t[Pu])return r;t=HB(t)}return e}t=r,r=t.parentNode}return null}function $1(t){return t=t[Pu]||t[$h],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function B_(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(un(33))}function dI(t){return t[n1]||null}var _k=[],j_=-1;function Hf(t){return{current:t}}function ss(t){0>j_||(t.current=_k[j_],_k[j_]=null,j_--)}function Zi(t,e){j_++,_k[j_]=t.current,t.current=e}var zf={},ra=Hf(zf),Va=Hf(!1),Im=zf;function py(t,e){var r=t.type.contextTypes;if(!r)return zf;var o=t.stateNode;if(o&&o.__reactInternalMemoizedUnmaskedChildContext===e)return o.__reactInternalMemoizedMaskedChildContext;var c={},f;for(f in r)c[f]=e[f];return o&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=c),c}function $a(t){return t=t.childContextTypes,t!=null}function XE(){ss(Va),ss(ra)}function ZB(t,e,r){if(ra.current!==zf)throw Error(un(168));Zi(ra,e),Zi(Va,r)}function I9(t,e,r){var o=t.stateNode;if(e=e.childContextTypes,typeof o.getChildContext!="function")return r;o=o.getChildContext();for(var c in o)if(!(c in e))throw Error(un(108,P2(t)||"Unknown",c));return Is({},r,o)}function KE(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||zf,Im=ra.current,Zi(ra,t),Zi(Va,Va.current),!0}function XB(t,e,r){var o=t.stateNode;if(!o)throw Error(un(169));r?(t=I9(t,e,Im),o.__reactInternalMemoizedMergedChildContext=t,ss(Va),ss(ra),Zi(ra,t)):ss(Va),Zi(Va,r)}var Mh=null,fI=!1,FR=!1;function A9(t){Mh===null?Mh=[t]:Mh.push(t)}function Wee(t){fI=!0,A9(t)}function Zf(){if(!FR&&Mh!==null){FR=!0;var t=0,e=Pi;try{var r=Mh;for(Pi=1;t<r.length;t++){var o=r[t];do o=o(!0);while(o!==null)}Mh=null,fI=!1}catch(c){throw Mh!==null&&(Mh=Mh.slice(t+1)),Q8(ND,Zf),c}finally{Pi=e,FR=!1}}return null}var U_=[],V_=0,YE=null,QE=0,jl=[],Ul=0,Am=null,Dh=1,Oh="";function em(t,e){U_[V_++]=QE,U_[V_++]=YE,YE=t,QE=e}function C9(t,e,r){jl[Ul++]=Dh,jl[Ul++]=Oh,jl[Ul++]=Am,Am=t;var o=Dh;t=Oh;var c=32-Nc(o)-1;o&=~(1<<c),r+=1;var f=32-Nc(e)+c;if(30<f){var _=c-c%5;f=(o&(1<<_)-1).toString(32),o>>=_,c-=_,Dh=1<<32-Nc(e)+c|r<<c|o,Oh=f+t}else Dh=1<<f|r<<c|o,Oh=t}function WD(t){t.return!==null&&(em(t,1),C9(t,1,0))}function HD(t){for(;t===YE;)YE=U_[--V_],U_[V_]=null,QE=U_[--V_],U_[V_]=null;for(;t===Am;)Am=jl[--Ul],jl[Ul]=null,Oh=jl[--Ul],jl[Ul]=null,Dh=jl[--Ul],jl[Ul]=null}var pl=null,al=null,_s=!1,Dc=null;function P9(t,e){var r=Hl(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function KB(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,pl=t,al=Tf(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,pl=t,al=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=Am!==null?{id:Dh,overflow:Oh}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=Hl(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,pl=t,al=null,!0):!1;default:return!1}}function yk(t){return(t.mode&1)!==0&&(t.flags&128)===0}function vk(t){if(_s){var e=al;if(e){var r=e;if(!KB(t,e)){if(yk(t))throw Error(un(418));e=Tf(r.nextSibling);var o=pl;e&&KB(t,e)?P9(o,r):(t.flags=t.flags&-4097|2,_s=!1,pl=t)}}else{if(yk(t))throw Error(un(418));t.flags=t.flags&-4097|2,_s=!1,pl=t}}}function YB(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;pl=t}function AT(t){if(t!==pl)return!1;if(!_s)return YB(t),_s=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!pk(t.type,t.memoizedProps)),e&&(e=al)){if(yk(t))throw R9(),Error(un(418));for(;e;)P9(t,e),e=Tf(e.nextSibling)}if(YB(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(un(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){al=Tf(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}al=null}}else al=pl?Tf(t.stateNode.nextSibling):null;return!0}function R9(){for(var t=al;t;)t=Tf(t.nextSibling)}function my(){al=pl=null,_s=!1}function ZD(t){Dc===null?Dc=[t]:Dc.push(t)}var Hee=td.ReactCurrentBatchConfig;function kv(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(un(309));var o=r.stateNode}if(!o)throw Error(un(147,t));var c=o,f=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===f?e.ref:(e=function(_){var x=c.refs;_===null?delete x[f]:x[f]=_},e._stringRef=f,e)}if(typeof t!="string")throw Error(un(284));if(!r._owner)throw Error(un(290,t))}return t}function CT(t,e){throw t=Object.prototype.toString.call(e),Error(un(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function QB(t){var e=t._init;return e(t._payload)}function M9(t){function e(W,Q){if(t){var K=W.deletions;K===null?(W.deletions=[Q],W.flags|=16):K.push(Q)}}function r(W,Q){if(!t)return null;for(;Q!==null;)e(W,Q),Q=Q.sibling;return null}function o(W,Q){for(W=new Map;Q!==null;)Q.key!==null?W.set(Q.key,Q):W.set(Q.index,Q),Q=Q.sibling;return W}function c(W,Q){return W=Af(W,Q),W.index=0,W.sibling=null,W}function f(W,Q,K){return W.index=K,t?(K=W.alternate,K!==null?(K=K.index,K<Q?(W.flags|=2,Q):K):(W.flags|=2,Q)):(W.flags|=1048576,Q)}function _(W){return t&&W.alternate===null&&(W.flags|=2),W}function x(W,Q,K,pe){return Q===null||Q.tag!==6?(Q=qR(K,W.mode,pe),Q.return=W,Q):(Q=c(Q,K),Q.return=W,Q)}function a(W,Q,K,pe){var Te=K.type;return Te===L_?D(W,Q,K.props.children,pe,K.key):Q!==null&&(Q.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===tf&&QB(Te)===Q.type)?(pe=c(Q,K.props),pe.ref=kv(W,Q,K),pe.return=W,pe):(pe=pE(K.type,K.key,K.props,null,W.mode,pe),pe.ref=kv(W,Q,K),pe.return=W,pe)}function I(W,Q,K,pe){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==K.containerInfo||Q.stateNode.implementation!==K.implementation?(Q=WR(K,W.mode,pe),Q.return=W,Q):(Q=c(Q,K.children||[]),Q.return=W,Q)}function D(W,Q,K,pe,Te){return Q===null||Q.tag!==7?(Q=_m(K,W.mode,pe,Te),Q.return=W,Q):(Q=c(Q,K),Q.return=W,Q)}function O(W,Q,K){if(typeof Q=="string"&&Q!==""||typeof Q=="number")return Q=qR(""+Q,W.mode,K),Q.return=W,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case _T:return K=pE(Q.type,Q.key,Q.props,null,W.mode,K),K.ref=kv(W,null,Q),K.return=W,K;case O_:return Q=WR(Q,W.mode,K),Q.return=W,Q;case tf:var pe=Q._init;return O(W,pe(Q._payload),K)}if(Xv(Q)||Av(Q))return Q=_m(Q,W.mode,K,null),Q.return=W,Q;CT(W,Q)}return null}function F(W,Q,K,pe){var Te=Q!==null?Q.key:null;if(typeof K=="string"&&K!==""||typeof K=="number")return Te!==null?null:x(W,Q,""+K,pe);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case _T:return K.key===Te?a(W,Q,K,pe):null;case O_:return K.key===Te?I(W,Q,K,pe):null;case tf:return Te=K._init,F(W,Q,Te(K._payload),pe)}if(Xv(K)||Av(K))return Te!==null?null:D(W,Q,K,pe,null);CT(W,K)}return null}function Z(W,Q,K,pe,Te){if(typeof pe=="string"&&pe!==""||typeof pe=="number")return W=W.get(K)||null,x(Q,W,""+pe,Te);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case _T:return W=W.get(pe.key===null?K:pe.key)||null,a(Q,W,pe,Te);case O_:return W=W.get(pe.key===null?K:pe.key)||null,I(Q,W,pe,Te);case tf:var we=pe._init;return Z(W,Q,K,we(pe._payload),Te)}if(Xv(pe)||Av(pe))return W=W.get(K)||null,D(Q,W,pe,Te,null);CT(Q,pe)}return null}function J(W,Q,K,pe){for(var Te=null,we=null,oe=Q,de=Q=0,X=null;oe!==null&&de<K.length;de++){oe.index>de?(X=oe,oe=null):X=oe.sibling;var ge=F(W,oe,K[de],pe);if(ge===null){oe===null&&(oe=X);break}t&&oe&&ge.alternate===null&&e(W,oe),Q=f(ge,Q,de),we===null?Te=ge:we.sibling=ge,we=ge,oe=X}if(de===K.length)return r(W,oe),_s&&em(W,de),Te;if(oe===null){for(;de<K.length;de++)oe=O(W,K[de],pe),oe!==null&&(Q=f(oe,Q,de),we===null?Te=oe:we.sibling=oe,we=oe);return _s&&em(W,de),Te}for(oe=o(W,oe);de<K.length;de++)X=Z(oe,W,de,K[de],pe),X!==null&&(t&&X.alternate!==null&&oe.delete(X.key===null?de:X.key),Q=f(X,Q,de),we===null?Te=X:we.sibling=X,we=X);return t&&oe.forEach(function(be){return e(W,be)}),_s&&em(W,de),Te}function ne(W,Q,K,pe){var Te=Av(K);if(typeof Te!="function")throw Error(un(150));if(K=Te.call(K),K==null)throw Error(un(151));for(var we=Te=null,oe=Q,de=Q=0,X=null,ge=K.next();oe!==null&&!ge.done;de++,ge=K.next()){oe.index>de?(X=oe,oe=null):X=oe.sibling;var be=F(W,oe,ge.value,pe);if(be===null){oe===null&&(oe=X);break}t&&oe&&be.alternate===null&&e(W,oe),Q=f(be,Q,de),we===null?Te=be:we.sibling=be,we=be,oe=X}if(ge.done)return r(W,oe),_s&&em(W,de),Te;if(oe===null){for(;!ge.done;de++,ge=K.next())ge=O(W,ge.value,pe),ge!==null&&(Q=f(ge,Q,de),we===null?Te=ge:we.sibling=ge,we=ge);return _s&&em(W,de),Te}for(oe=o(W,oe);!ge.done;de++,ge=K.next())ge=Z(oe,W,de,ge.value,pe),ge!==null&&(t&&ge.alternate!==null&&oe.delete(ge.key===null?de:ge.key),Q=f(ge,Q,de),we===null?Te=ge:we.sibling=ge,we=ge);return t&&oe.forEach(function(ke){return e(W,ke)}),_s&&em(W,de),Te}function se(W,Q,K,pe){if(typeof K=="object"&&K!==null&&K.type===L_&&K.key===null&&(K=K.props.children),typeof K=="object"&&K!==null){switch(K.$$typeof){case _T:e:{for(var Te=K.key,we=Q;we!==null;){if(we.key===Te){if(Te=K.type,Te===L_){if(we.tag===7){r(W,we.sibling),Q=c(we,K.props.children),Q.return=W,W=Q;break e}}else if(we.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===tf&&QB(Te)===we.type){r(W,we.sibling),Q=c(we,K.props),Q.ref=kv(W,we,K),Q.return=W,W=Q;break e}r(W,we);break}else e(W,we);we=we.sibling}K.type===L_?(Q=_m(K.props.children,W.mode,pe,K.key),Q.return=W,W=Q):(pe=pE(K.type,K.key,K.props,null,W.mode,pe),pe.ref=kv(W,Q,K),pe.return=W,W=pe)}return _(W);case O_:e:{for(we=K.key;Q!==null;){if(Q.key===we)if(Q.tag===4&&Q.stateNode.containerInfo===K.containerInfo&&Q.stateNode.implementation===K.implementation){r(W,Q.sibling),Q=c(Q,K.children||[]),Q.return=W,W=Q;break e}else{r(W,Q);break}else e(W,Q);Q=Q.sibling}Q=WR(K,W.mode,pe),Q.return=W,W=Q}return _(W);case tf:return we=K._init,se(W,Q,we(K._payload),pe)}if(Xv(K))return J(W,Q,K,pe);if(Av(K))return ne(W,Q,K,pe);CT(W,K)}return typeof K=="string"&&K!==""||typeof K=="number"?(K=""+K,Q!==null&&Q.tag===6?(r(W,Q.sibling),Q=c(Q,K),Q.return=W,W=Q):(r(W,Q),Q=qR(K,W.mode,pe),Q.return=W,W=Q),_(W)):r(W,Q)}return se}var gy=M9(!0),k9=M9(!1),JE=Hf(null),eS=null,$_=null,XD=null;function KD(){XD=$_=eS=null}function YD(t){var e=JE.current;ss(JE),t._currentValue=e}function xk(t,e,r){for(;t!==null;){var o=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,o!==null&&(o.childLanes|=e)):o!==null&&(o.childLanes&e)!==e&&(o.childLanes|=e),t===r)break;t=t.return}}function ty(t,e){eS=t,XD=$_=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(ja=!0),t.firstContext=null)}function Kl(t){var e=t._currentValue;if(XD!==t)if(t={context:t,memoizedValue:e,next:null},$_===null){if(eS===null)throw Error(un(308));$_=t,eS.dependencies={lanes:0,firstContext:t}}else $_=$_.next=t;return e}var cm=null;function QD(t){cm===null?cm=[t]:cm.push(t)}function D9(t,e,r,o){var c=e.interleaved;return c===null?(r.next=r,QD(e)):(r.next=c.next,c.next=r),e.interleaved=r,Gh(t,o)}function Gh(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var nf=!1;function JD(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function O9(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Fh(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ef(t,e,r){var o=t.updateQueue;if(o===null)return null;if(o=o.shared,ci&2){var c=o.pending;return c===null?e.next=e:(e.next=c.next,c.next=e),o.pending=e,Gh(t,r)}return c=o.interleaved,c===null?(e.next=e,QD(o)):(e.next=c.next,c.next=e),o.interleaved=e,Gh(t,r)}function lE(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var o=e.lanes;o&=t.pendingLanes,r|=o,e.lanes=r,FD(t,r)}}function JB(t,e){var r=t.updateQueue,o=t.alternate;if(o!==null&&(o=o.updateQueue,r===o)){var c=null,f=null;if(r=r.firstBaseUpdate,r!==null){do{var _={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};f===null?c=f=_:f=f.next=_,r=r.next}while(r!==null);f===null?c=f=e:f=f.next=e}else c=f=e;r={baseState:o.baseState,firstBaseUpdate:c,lastBaseUpdate:f,shared:o.shared,effects:o.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function tS(t,e,r,o){var c=t.updateQueue;nf=!1;var f=c.firstBaseUpdate,_=c.lastBaseUpdate,x=c.shared.pending;if(x!==null){c.shared.pending=null;var a=x,I=a.next;a.next=null,_===null?f=I:_.next=I,_=a;var D=t.alternate;D!==null&&(D=D.updateQueue,x=D.lastBaseUpdate,x!==_&&(x===null?D.firstBaseUpdate=I:x.next=I,D.lastBaseUpdate=a))}if(f!==null){var O=c.baseState;_=0,D=I=a=null,x=f;do{var F=x.lane,Z=x.eventTime;if((o&F)===F){D!==null&&(D=D.next={eventTime:Z,lane:0,tag:x.tag,payload:x.payload,callback:x.callback,next:null});e:{var J=t,ne=x;switch(F=e,Z=r,ne.tag){case 1:if(J=ne.payload,typeof J=="function"){O=J.call(Z,O,F);break e}O=J;break e;case 3:J.flags=J.flags&-65537|128;case 0:if(J=ne.payload,F=typeof J=="function"?J.call(Z,O,F):J,F==null)break e;O=Is({},O,F);break e;case 2:nf=!0}}x.callback!==null&&x.lane!==0&&(t.flags|=64,F=c.effects,F===null?c.effects=[x]:F.push(x))}else Z={eventTime:Z,lane:F,tag:x.tag,payload:x.payload,callback:x.callback,next:null},D===null?(I=D=Z,a=O):D=D.next=Z,_|=F;if(x=x.next,x===null){if(x=c.shared.pending,x===null)break;F=x,x=F.next,F.next=null,c.lastBaseUpdate=F,c.shared.pending=null}}while(!0);if(D===null&&(a=O),c.baseState=a,c.firstBaseUpdate=I,c.lastBaseUpdate=D,e=c.shared.interleaved,e!==null){c=e;do _|=c.lane,c=c.next;while(c!==e)}else f===null&&(c.shared.lanes=0);Pm|=_,t.lanes=_,t.memoizedState=O}}function ej(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var o=t[e],c=o.callback;if(c!==null){if(o.callback=null,o=r,typeof c!="function")throw Error(un(191,c));c.call(o)}}}var G1={},zu=Hf(G1),r1=Hf(G1),i1=Hf(G1);function um(t){if(t===G1)throw Error(un(174));return t}function eO(t,e){switch(Zi(i1,e),Zi(r1,t),Zi(zu,G1),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ek(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ek(e,t)}ss(zu),Zi(zu,e)}function _y(){ss(zu),ss(r1),ss(i1)}function L9(t){um(i1.current);var e=um(zu.current),r=ek(e,t.type);e!==r&&(Zi(r1,t),Zi(zu,r))}function tO(t){r1.current===t&&(ss(zu),ss(r1))}var Es=Hf(0);function nS(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var BR=[];function nO(){for(var t=0;t<BR.length;t++)BR[t]._workInProgressVersionPrimary=null;BR.length=0}var cE=td.ReactCurrentDispatcher,jR=td.ReactCurrentBatchConfig,Cm=0,Ss=null,fo=null,To=null,rS=!1,vx=!1,s1=0,Zee=0;function Zo(){throw Error(un(321))}function rO(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!Uc(t[r],e[r]))return!1;return!0}function iO(t,e,r,o,c,f){if(Cm=f,Ss=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,cE.current=t===null||t.memoizedState===null?Qee:Jee,t=r(o,c),vx){f=0;do{if(vx=!1,s1=0,25<=f)throw Error(un(301));f+=1,To=fo=null,e.updateQueue=null,cE.current=ete,t=r(o,c)}while(vx)}if(cE.current=iS,e=fo!==null&&fo.next!==null,Cm=0,To=fo=Ss=null,rS=!1,e)throw Error(un(300));return t}function sO(){var t=s1!==0;return s1=0,t}function wu(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return To===null?Ss.memoizedState=To=t:To=To.next=t,To}function Yl(){if(fo===null){var t=Ss.alternate;t=t!==null?t.memoizedState:null}else t=fo.next;var e=To===null?Ss.memoizedState:To.next;if(e!==null)To=e,fo=t;else{if(t===null)throw Error(un(310));fo=t,t={memoizedState:fo.memoizedState,baseState:fo.baseState,baseQueue:fo.baseQueue,queue:fo.queue,next:null},To===null?Ss.memoizedState=To=t:To=To.next=t}return To}function o1(t,e){return typeof e=="function"?e(t):e}function UR(t){var e=Yl(),r=e.queue;if(r===null)throw Error(un(311));r.lastRenderedReducer=t;var o=fo,c=o.baseQueue,f=r.pending;if(f!==null){if(c!==null){var _=c.next;c.next=f.next,f.next=_}o.baseQueue=c=f,r.pending=null}if(c!==null){f=c.next,o=o.baseState;var x=_=null,a=null,I=f;do{var D=I.lane;if((Cm&D)===D)a!==null&&(a=a.next={lane:0,action:I.action,hasEagerState:I.hasEagerState,eagerState:I.eagerState,next:null}),o=I.hasEagerState?I.eagerState:t(o,I.action);else{var O={lane:D,action:I.action,hasEagerState:I.hasEagerState,eagerState:I.eagerState,next:null};a===null?(x=a=O,_=o):a=a.next=O,Ss.lanes|=D,Pm|=D}I=I.next}while(I!==null&&I!==f);a===null?_=o:a.next=x,Uc(o,e.memoizedState)||(ja=!0),e.memoizedState=o,e.baseState=_,e.baseQueue=a,r.lastRenderedState=o}if(t=r.interleaved,t!==null){c=t;do f=c.lane,Ss.lanes|=f,Pm|=f,c=c.next;while(c!==t)}else c===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function VR(t){var e=Yl(),r=e.queue;if(r===null)throw Error(un(311));r.lastRenderedReducer=t;var o=r.dispatch,c=r.pending,f=e.memoizedState;if(c!==null){r.pending=null;var _=c=c.next;do f=t(f,_.action),_=_.next;while(_!==c);Uc(f,e.memoizedState)||(ja=!0),e.memoizedState=f,e.baseQueue===null&&(e.baseState=f),r.lastRenderedState=f}return[f,o]}function z9(){}function N9(t,e){var r=Ss,o=Yl(),c=e(),f=!Uc(o.memoizedState,c);if(f&&(o.memoizedState=c,ja=!0),o=o.queue,oO(j9.bind(null,r,o,t),[t]),o.getSnapshot!==e||f||To!==null&&To.memoizedState.tag&1){if(r.flags|=2048,a1(9,B9.bind(null,r,o,c,e),void 0,null),So===null)throw Error(un(349));Cm&30||F9(r,e,c)}return c}function F9(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=Ss.updateQueue,e===null?(e={lastEffect:null,stores:null},Ss.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function B9(t,e,r,o){e.value=r,e.getSnapshot=o,U9(e)&&V9(t)}function j9(t,e,r){return r(function(){U9(e)&&V9(t)})}function U9(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!Uc(t,r)}catch{return!0}}function V9(t){var e=Gh(t,1);e!==null&&Fc(e,t,1,-1)}function tj(t){var e=wu();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o1,lastRenderedState:t},e.queue=t,t=t.dispatch=Yee.bind(null,Ss,t),[e.memoizedState,t]}function a1(t,e,r,o){return t={tag:t,create:e,destroy:r,deps:o,next:null},e=Ss.updateQueue,e===null?(e={lastEffect:null,stores:null},Ss.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(o=r.next,r.next=t,t.next=o,e.lastEffect=t)),t}function $9(){return Yl().memoizedState}function uE(t,e,r,o){var c=wu();Ss.flags|=t,c.memoizedState=a1(1|e,r,void 0,o===void 0?null:o)}function pI(t,e,r,o){var c=Yl();o=o===void 0?null:o;var f=void 0;if(fo!==null){var _=fo.memoizedState;if(f=_.destroy,o!==null&&rO(o,_.deps)){c.memoizedState=a1(e,r,f,o);return}}Ss.flags|=t,c.memoizedState=a1(1|e,r,f,o)}function nj(t,e){return uE(8390656,8,t,e)}function oO(t,e){return pI(2048,8,t,e)}function G9(t,e){return pI(4,2,t,e)}function q9(t,e){return pI(4,4,t,e)}function W9(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function H9(t,e,r){return r=r!=null?r.concat([t]):null,pI(4,4,W9.bind(null,e,t),r)}function aO(){}function Z9(t,e){var r=Yl();e=e===void 0?null:e;var o=r.memoizedState;return o!==null&&e!==null&&rO(e,o[1])?o[0]:(r.memoizedState=[t,e],t)}function X9(t,e){var r=Yl();e=e===void 0?null:e;var o=r.memoizedState;return o!==null&&e!==null&&rO(e,o[1])?o[0]:(t=t(),r.memoizedState=[t,e],t)}function K9(t,e,r){return Cm&21?(Uc(r,e)||(r=t9(),Ss.lanes|=r,Pm|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,ja=!0),t.memoizedState=r)}function Xee(t,e){var r=Pi;Pi=r!==0&&4>r?r:4,t(!0);var o=jR.transition;jR.transition={};try{t(!1),e()}finally{Pi=r,jR.transition=o}}function Y9(){return Yl().memoizedState}function Kee(t,e,r){var o=If(t);if(r={lane:o,action:r,hasEagerState:!1,eagerState:null,next:null},Q9(t))J9(e,r);else if(r=D9(t,e,r,o),r!==null){var c=Ta();Fc(r,t,o,c),e7(r,e,o)}}function Yee(t,e,r){var o=If(t),c={lane:o,action:r,hasEagerState:!1,eagerState:null,next:null};if(Q9(t))J9(e,c);else{var f=t.alternate;if(t.lanes===0&&(f===null||f.lanes===0)&&(f=e.lastRenderedReducer,f!==null))try{var _=e.lastRenderedState,x=f(_,r);if(c.hasEagerState=!0,c.eagerState=x,Uc(x,_)){var a=e.interleaved;a===null?(c.next=c,QD(e)):(c.next=a.next,a.next=c),e.interleaved=c;return}}catch{}finally{}r=D9(t,e,c,o),r!==null&&(c=Ta(),Fc(r,t,o,c),e7(r,e,o))}}function Q9(t){var e=t.alternate;return t===Ss||e!==null&&e===Ss}function J9(t,e){vx=rS=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function e7(t,e,r){if(r&4194240){var o=e.lanes;o&=t.pendingLanes,r|=o,e.lanes=r,FD(t,r)}}var iS={readContext:Kl,useCallback:Zo,useContext:Zo,useEffect:Zo,useImperativeHandle:Zo,useInsertionEffect:Zo,useLayoutEffect:Zo,useMemo:Zo,useReducer:Zo,useRef:Zo,useState:Zo,useDebugValue:Zo,useDeferredValue:Zo,useTransition:Zo,useMutableSource:Zo,useSyncExternalStore:Zo,useId:Zo,unstable_isNewReconciler:!1},Qee={readContext:Kl,useCallback:function(t,e){return wu().memoizedState=[t,e===void 0?null:e],t},useContext:Kl,useEffect:nj,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,uE(4194308,4,W9.bind(null,e,t),r)},useLayoutEffect:function(t,e){return uE(4194308,4,t,e)},useInsertionEffect:function(t,e){return uE(4,2,t,e)},useMemo:function(t,e){var r=wu();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var o=wu();return e=r!==void 0?r(e):e,o.memoizedState=o.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},o.queue=t,t=t.dispatch=Kee.bind(null,Ss,t),[o.memoizedState,t]},useRef:function(t){var e=wu();return t={current:t},e.memoizedState=t},useState:tj,useDebugValue:aO,useDeferredValue:function(t){return wu().memoizedState=t},useTransition:function(){var t=tj(!1),e=t[0];return t=Xee.bind(null,t[1]),wu().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var o=Ss,c=wu();if(_s){if(r===void 0)throw Error(un(407));r=r()}else{if(r=e(),So===null)throw Error(un(349));Cm&30||F9(o,e,r)}c.memoizedState=r;var f={value:r,getSnapshot:e};return c.queue=f,nj(j9.bind(null,o,f,t),[t]),o.flags|=2048,a1(9,B9.bind(null,o,f,r,e),void 0,null),r},useId:function(){var t=wu(),e=So.identifierPrefix;if(_s){var r=Oh,o=Dh;r=(o&~(1<<32-Nc(o)-1)).toString(32)+r,e=":"+e+"R"+r,r=s1++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=Zee++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Jee={readContext:Kl,useCallback:Z9,useContext:Kl,useEffect:oO,useImperativeHandle:H9,useInsertionEffect:G9,useLayoutEffect:q9,useMemo:X9,useReducer:UR,useRef:$9,useState:function(){return UR(o1)},useDebugValue:aO,useDeferredValue:function(t){var e=Yl();return K9(e,fo.memoizedState,t)},useTransition:function(){var t=UR(o1)[0],e=Yl().memoizedState;return[t,e]},useMutableSource:z9,useSyncExternalStore:N9,useId:Y9,unstable_isNewReconciler:!1},ete={readContext:Kl,useCallback:Z9,useContext:Kl,useEffect:oO,useImperativeHandle:H9,useInsertionEffect:G9,useLayoutEffect:q9,useMemo:X9,useReducer:VR,useRef:$9,useState:function(){return VR(o1)},useDebugValue:aO,useDeferredValue:function(t){var e=Yl();return fo===null?e.memoizedState=t:K9(e,fo.memoizedState,t)},useTransition:function(){var t=VR(o1)[0],e=Yl().memoizedState;return[t,e]},useMutableSource:z9,useSyncExternalStore:N9,useId:Y9,unstable_isNewReconciler:!1};function Mc(t,e){if(t&&t.defaultProps){e=Is({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}function bk(t,e,r,o){e=t.memoizedState,r=r(o,e),r=r==null?e:Is({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var mI={isMounted:function(t){return(t=t._reactInternals)?Zm(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var o=Ta(),c=If(t),f=Fh(o,c);f.payload=e,r!=null&&(f.callback=r),e=Ef(t,f,c),e!==null&&(Fc(e,t,c,o),lE(e,t,c))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var o=Ta(),c=If(t),f=Fh(o,c);f.tag=1,f.payload=e,r!=null&&(f.callback=r),e=Ef(t,f,c),e!==null&&(Fc(e,t,c,o),lE(e,t,c))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=Ta(),o=If(t),c=Fh(r,o);c.tag=2,e!=null&&(c.callback=e),e=Ef(t,c,o),e!==null&&(Fc(e,t,o,r),lE(e,t,o))}};function rj(t,e,r,o,c,f,_){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(o,f,_):e.prototype&&e.prototype.isPureReactComponent?!Jx(r,o)||!Jx(c,f):!0}function t7(t,e,r){var o=!1,c=zf,f=e.contextType;return typeof f=="object"&&f!==null?f=Kl(f):(c=$a(e)?Im:ra.current,o=e.contextTypes,f=(o=o!=null)?py(t,c):zf),e=new e(r,f),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=mI,t.stateNode=e,e._reactInternals=t,o&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=c,t.__reactInternalMemoizedMaskedChildContext=f),e}function ij(t,e,r,o){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,o),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,o),e.state!==t&&mI.enqueueReplaceState(e,e.state,null)}function wk(t,e,r,o){var c=t.stateNode;c.props=r,c.state=t.memoizedState,c.refs={},JD(t);var f=e.contextType;typeof f=="object"&&f!==null?c.context=Kl(f):(f=$a(e)?Im:ra.current,c.context=py(t,f)),c.state=t.memoizedState,f=e.getDerivedStateFromProps,typeof f=="function"&&(bk(t,e,f,r),c.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(e=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),e!==c.state&&mI.enqueueReplaceState(c,c.state,null),tS(t,r,c,o),c.state=t.memoizedState),typeof c.componentDidMount=="function"&&(t.flags|=4194308)}function yy(t,e){try{var r="",o=e;do r+=C2(o),o=o.return;while(o);var c=r}catch(f){c=`
Error generating stack: `+f.message+`
`+f.stack}return{value:t,source:e,stack:c,digest:null}}function $R(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function Tk(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var tte=typeof WeakMap=="function"?WeakMap:Map;function n7(t,e,r){r=Fh(-1,r),r.tag=3,r.payload={element:null};var o=e.value;return r.callback=function(){oS||(oS=!0,Dk=o),Tk(t,e)},r}function r7(t,e,r){r=Fh(-1,r),r.tag=3;var o=t.type.getDerivedStateFromError;if(typeof o=="function"){var c=e.value;r.payload=function(){return o(c)},r.callback=function(){Tk(t,e)}}var f=t.stateNode;return f!==null&&typeof f.componentDidCatch=="function"&&(r.callback=function(){Tk(t,e),typeof o!="function"&&(Sf===null?Sf=new Set([this]):Sf.add(this));var _=e.stack;this.componentDidCatch(e.value,{componentStack:_!==null?_:""})}),r}function sj(t,e,r){var o=t.pingCache;if(o===null){o=t.pingCache=new tte;var c=new Set;o.set(e,c)}else c=o.get(e),c===void 0&&(c=new Set,o.set(e,c));c.has(r)||(c.add(r),t=mte.bind(null,t,e,r),e.then(t,t))}function oj(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function aj(t,e,r,o,c){return t.mode&1?(t.flags|=65536,t.lanes=c,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=Fh(-1,1),e.tag=2,Ef(r,e,1))),r.lanes|=1),t)}var nte=td.ReactCurrentOwner,ja=!1;function ba(t,e,r,o){e.child=t===null?k9(e,null,r,o):gy(e,t.child,r,o)}function lj(t,e,r,o,c){r=r.render;var f=e.ref;return ty(e,c),o=iO(t,e,r,o,f,c),r=sO(),t!==null&&!ja?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~c,qh(t,e,c)):(_s&&r&&WD(e),e.flags|=1,ba(t,e,o,c),e.child)}function cj(t,e,r,o,c){if(t===null){var f=r.type;return typeof f=="function"&&!mO(f)&&f.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=f,i7(t,e,f,o,c)):(t=pE(r.type,null,o,e,e.mode,c),t.ref=e.ref,t.return=e,e.child=t)}if(f=t.child,!(t.lanes&c)){var _=f.memoizedProps;if(r=r.compare,r=r!==null?r:Jx,r(_,o)&&t.ref===e.ref)return qh(t,e,c)}return e.flags|=1,t=Af(f,o),t.ref=e.ref,t.return=e,e.child=t}function i7(t,e,r,o,c){if(t!==null){var f=t.memoizedProps;if(Jx(f,o)&&t.ref===e.ref)if(ja=!1,e.pendingProps=o=f,(t.lanes&c)!==0)t.flags&131072&&(ja=!0);else return e.lanes=t.lanes,qh(t,e,c)}return Ek(t,e,r,o,c)}function s7(t,e,r){var o=e.pendingProps,c=o.children,f=t!==null?t.memoizedState:null;if(o.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Zi(q_,sl),sl|=r;else{if(!(r&1073741824))return t=f!==null?f.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Zi(q_,sl),sl|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},o=f!==null?f.baseLanes:r,Zi(q_,sl),sl|=o}else f!==null?(o=f.baseLanes|r,e.memoizedState=null):o=r,Zi(q_,sl),sl|=o;return ba(t,e,c,r),e.child}function o7(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function Ek(t,e,r,o,c){var f=$a(r)?Im:ra.current;return f=py(e,f),ty(e,c),r=iO(t,e,r,o,f,c),o=sO(),t!==null&&!ja?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~c,qh(t,e,c)):(_s&&o&&WD(e),e.flags|=1,ba(t,e,r,c),e.child)}function uj(t,e,r,o,c){if($a(r)){var f=!0;KE(e)}else f=!1;if(ty(e,c),e.stateNode===null)hE(t,e),t7(e,r,o),wk(e,r,o,c),o=!0;else if(t===null){var _=e.stateNode,x=e.memoizedProps;_.props=x;var a=_.context,I=r.contextType;typeof I=="object"&&I!==null?I=Kl(I):(I=$a(r)?Im:ra.current,I=py(e,I));var D=r.getDerivedStateFromProps,O=typeof D=="function"||typeof _.getSnapshotBeforeUpdate=="function";O||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(x!==o||a!==I)&&ij(e,_,o,I),nf=!1;var F=e.memoizedState;_.state=F,tS(e,o,_,c),a=e.memoizedState,x!==o||F!==a||Va.current||nf?(typeof D=="function"&&(bk(e,r,D,o),a=e.memoizedState),(x=nf||rj(e,r,x,o,F,a,I))?(O||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(e.flags|=4194308)):(typeof _.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=o,e.memoizedState=a),_.props=o,_.state=a,_.context=I,o=x):(typeof _.componentDidMount=="function"&&(e.flags|=4194308),o=!1)}else{_=e.stateNode,O9(t,e),x=e.memoizedProps,I=e.type===e.elementType?x:Mc(e.type,x),_.props=I,O=e.pendingProps,F=_.context,a=r.contextType,typeof a=="object"&&a!==null?a=Kl(a):(a=$a(r)?Im:ra.current,a=py(e,a));var Z=r.getDerivedStateFromProps;(D=typeof Z=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(x!==O||F!==a)&&ij(e,_,o,a),nf=!1,F=e.memoizedState,_.state=F,tS(e,o,_,c);var J=e.memoizedState;x!==O||F!==J||Va.current||nf?(typeof Z=="function"&&(bk(e,r,Z,o),J=e.memoizedState),(I=nf||rj(e,r,I,o,F,J,a)||!1)?(D||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(o,J,a),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(o,J,a)),typeof _.componentDidUpdate=="function"&&(e.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof _.componentDidUpdate!="function"||x===t.memoizedProps&&F===t.memoizedState||(e.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||x===t.memoizedProps&&F===t.memoizedState||(e.flags|=1024),e.memoizedProps=o,e.memoizedState=J),_.props=o,_.state=J,_.context=a,o=I):(typeof _.componentDidUpdate!="function"||x===t.memoizedProps&&F===t.memoizedState||(e.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||x===t.memoizedProps&&F===t.memoizedState||(e.flags|=1024),o=!1)}return Sk(t,e,r,o,f,c)}function Sk(t,e,r,o,c,f){o7(t,e);var _=(e.flags&128)!==0;if(!o&&!_)return c&&XB(e,r,!1),qh(t,e,f);o=e.stateNode,nte.current=e;var x=_&&typeof r.getDerivedStateFromError!="function"?null:o.render();return e.flags|=1,t!==null&&_?(e.child=gy(e,t.child,null,f),e.child=gy(e,null,x,f)):ba(t,e,x,f),e.memoizedState=o.state,c&&XB(e,r,!0),e.child}function a7(t){var e=t.stateNode;e.pendingContext?ZB(t,e.pendingContext,e.pendingContext!==e.context):e.context&&ZB(t,e.context,!1),eO(t,e.containerInfo)}function hj(t,e,r,o,c){return my(),ZD(c),e.flags|=256,ba(t,e,r,o),e.child}var Ik={dehydrated:null,treeContext:null,retryLane:0};function Ak(t){return{baseLanes:t,cachePool:null,transitions:null}}function l7(t,e,r){var o=e.pendingProps,c=Es.current,f=!1,_=(e.flags&128)!==0,x;if((x=_)||(x=t!==null&&t.memoizedState===null?!1:(c&2)!==0),x?(f=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(c|=1),Zi(Es,c&1),t===null)return vk(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(_=o.children,t=o.fallback,f?(o=e.mode,f=e.child,_={mode:"hidden",children:_},!(o&1)&&f!==null?(f.childLanes=0,f.pendingProps=_):f=yI(_,o,0,null),t=_m(t,o,r,null),f.return=e,t.return=e,f.sibling=t,e.child=f,e.child.memoizedState=Ak(r),e.memoizedState=Ik,t):lO(e,_));if(c=t.memoizedState,c!==null&&(x=c.dehydrated,x!==null))return rte(t,e,_,o,x,c,r);if(f){f=o.fallback,_=e.mode,c=t.child,x=c.sibling;var a={mode:"hidden",children:o.children};return!(_&1)&&e.child!==c?(o=e.child,o.childLanes=0,o.pendingProps=a,e.deletions=null):(o=Af(c,a),o.subtreeFlags=c.subtreeFlags&14680064),x!==null?f=Af(x,f):(f=_m(f,_,r,null),f.flags|=2),f.return=e,o.return=e,o.sibling=f,e.child=o,o=f,f=e.child,_=t.child.memoizedState,_=_===null?Ak(r):{baseLanes:_.baseLanes|r,cachePool:null,transitions:_.transitions},f.memoizedState=_,f.childLanes=t.childLanes&~r,e.memoizedState=Ik,o}return f=t.child,t=f.sibling,o=Af(f,{mode:"visible",children:o.children}),!(e.mode&1)&&(o.lanes=r),o.return=e,o.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=o,e.memoizedState=null,o}function lO(t,e){return e=yI({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function PT(t,e,r,o){return o!==null&&ZD(o),gy(e,t.child,null,r),t=lO(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function rte(t,e,r,o,c,f,_){if(r)return e.flags&256?(e.flags&=-257,o=$R(Error(un(422))),PT(t,e,_,o)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(f=o.fallback,c=e.mode,o=yI({mode:"visible",children:o.children},c,0,null),f=_m(f,c,_,null),f.flags|=2,o.return=e,f.return=e,o.sibling=f,e.child=o,e.mode&1&&gy(e,t.child,null,_),e.child.memoizedState=Ak(_),e.memoizedState=Ik,f);if(!(e.mode&1))return PT(t,e,_,null);if(c.data==="$!"){if(o=c.nextSibling&&c.nextSibling.dataset,o)var x=o.dgst;return o=x,f=Error(un(419)),o=$R(f,o,void 0),PT(t,e,_,o)}if(x=(_&t.childLanes)!==0,ja||x){if(o=So,o!==null){switch(_&-_){case 4:c=2;break;case 16:c=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:c=32;break;case 536870912:c=268435456;break;default:c=0}c=c&(o.suspendedLanes|_)?0:c,c!==0&&c!==f.retryLane&&(f.retryLane=c,Gh(t,c),Fc(o,t,c,-1))}return pO(),o=$R(Error(un(421))),PT(t,e,_,o)}return c.data==="$?"?(e.flags|=128,e.child=t.child,e=gte.bind(null,t),c._reactRetry=e,null):(t=f.treeContext,al=Tf(c.nextSibling),pl=e,_s=!0,Dc=null,t!==null&&(jl[Ul++]=Dh,jl[Ul++]=Oh,jl[Ul++]=Am,Dh=t.id,Oh=t.overflow,Am=e),e=lO(e,o.children),e.flags|=4096,e)}function dj(t,e,r){t.lanes|=e;var o=t.alternate;o!==null&&(o.lanes|=e),xk(t.return,e,r)}function GR(t,e,r,o,c){var f=t.memoizedState;f===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:o,tail:r,tailMode:c}:(f.isBackwards=e,f.rendering=null,f.renderingStartTime=0,f.last=o,f.tail=r,f.tailMode=c)}function c7(t,e,r){var o=e.pendingProps,c=o.revealOrder,f=o.tail;if(ba(t,e,o.children,r),o=Es.current,o&2)o=o&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&dj(t,r,e);else if(t.tag===19)dj(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}o&=1}if(Zi(Es,o),!(e.mode&1))e.memoizedState=null;else switch(c){case"forwards":for(r=e.child,c=null;r!==null;)t=r.alternate,t!==null&&nS(t)===null&&(c=r),r=r.sibling;r=c,r===null?(c=e.child,e.child=null):(c=r.sibling,r.sibling=null),GR(e,!1,c,r,f);break;case"backwards":for(r=null,c=e.child,e.child=null;c!==null;){if(t=c.alternate,t!==null&&nS(t)===null){e.child=c;break}t=c.sibling,c.sibling=r,r=c,c=t}GR(e,!0,r,null,f);break;case"together":GR(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function hE(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function qh(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),Pm|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(un(153));if(e.child!==null){for(t=e.child,r=Af(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=Af(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function ite(t,e,r){switch(e.tag){case 3:a7(e),my();break;case 5:L9(e);break;case 1:$a(e.type)&&KE(e);break;case 4:eO(e,e.stateNode.containerInfo);break;case 10:var o=e.type._context,c=e.memoizedProps.value;Zi(JE,o._currentValue),o._currentValue=c;break;case 13:if(o=e.memoizedState,o!==null)return o.dehydrated!==null?(Zi(Es,Es.current&1),e.flags|=128,null):r&e.child.childLanes?l7(t,e,r):(Zi(Es,Es.current&1),t=qh(t,e,r),t!==null?t.sibling:null);Zi(Es,Es.current&1);break;case 19:if(o=(r&e.childLanes)!==0,t.flags&128){if(o)return c7(t,e,r);e.flags|=128}if(c=e.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),Zi(Es,Es.current),o)break;return null;case 22:case 23:return e.lanes=0,s7(t,e,r)}return qh(t,e,r)}var u7,Ck,h7,d7;u7=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};Ck=function(){};h7=function(t,e,r,o){var c=t.memoizedProps;if(c!==o){t=e.stateNode,um(zu.current);var f=null;switch(r){case"input":c=KM(t,c),o=KM(t,o),f=[];break;case"select":c=Is({},c,{value:void 0}),o=Is({},o,{value:void 0}),f=[];break;case"textarea":c=JM(t,c),o=JM(t,o),f=[];break;default:typeof c.onClick!="function"&&typeof o.onClick=="function"&&(t.onclick=ZE)}tk(r,o);var _;r=null;for(I in c)if(!o.hasOwnProperty(I)&&c.hasOwnProperty(I)&&c[I]!=null)if(I==="style"){var x=c[I];for(_ in x)x.hasOwnProperty(_)&&(r||(r={}),r[_]="")}else I!=="dangerouslySetInnerHTML"&&I!=="children"&&I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(Wx.hasOwnProperty(I)?f||(f=[]):(f=f||[]).push(I,null));for(I in o){var a=o[I];if(x=c!=null?c[I]:void 0,o.hasOwnProperty(I)&&a!==x&&(a!=null||x!=null))if(I==="style")if(x){for(_ in x)!x.hasOwnProperty(_)||a&&a.hasOwnProperty(_)||(r||(r={}),r[_]="");for(_ in a)a.hasOwnProperty(_)&&x[_]!==a[_]&&(r||(r={}),r[_]=a[_])}else r||(f||(f=[]),f.push(I,r)),r=a;else I==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,x=x?x.__html:void 0,a!=null&&x!==a&&(f=f||[]).push(I,a)):I==="children"?typeof a!="string"&&typeof a!="number"||(f=f||[]).push(I,""+a):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&(Wx.hasOwnProperty(I)?(a!=null&&I==="onScroll"&&Ji("scroll",t),f||x===a||(f=[])):(f=f||[]).push(I,a))}r&&(f=f||[]).push("style",r);var I=f;(e.updateQueue=I)&&(e.flags|=4)}};d7=function(t,e,r,o){r!==o&&(e.flags|=4)};function Dv(t,e){if(!_s)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var o=null;r!==null;)r.alternate!==null&&(o=r),r=r.sibling;o===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:o.sibling=null}}function Xo(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,o=0;if(e)for(var c=t.child;c!==null;)r|=c.lanes|c.childLanes,o|=c.subtreeFlags&14680064,o|=c.flags&14680064,c.return=t,c=c.sibling;else for(c=t.child;c!==null;)r|=c.lanes|c.childLanes,o|=c.subtreeFlags,o|=c.flags,c.return=t,c=c.sibling;return t.subtreeFlags|=o,t.childLanes=r,e}function ste(t,e,r){var o=e.pendingProps;switch(HD(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xo(e),null;case 1:return $a(e.type)&&XE(),Xo(e),null;case 3:return o=e.stateNode,_y(),ss(Va),ss(ra),nO(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(t===null||t.child===null)&&(AT(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Dc!==null&&(zk(Dc),Dc=null))),Ck(t,e),Xo(e),null;case 5:tO(e);var c=um(i1.current);if(r=e.type,t!==null&&e.stateNode!=null)h7(t,e,r,o,c),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!o){if(e.stateNode===null)throw Error(un(166));return Xo(e),null}if(t=um(zu.current),AT(e)){o=e.stateNode,r=e.type;var f=e.memoizedProps;switch(o[Pu]=e,o[n1]=f,t=(e.mode&1)!==0,r){case"dialog":Ji("cancel",o),Ji("close",o);break;case"iframe":case"object":case"embed":Ji("load",o);break;case"video":case"audio":for(c=0;c<Yv.length;c++)Ji(Yv[c],o);break;case"source":Ji("error",o);break;case"img":case"image":case"link":Ji("error",o),Ji("load",o);break;case"details":Ji("toggle",o);break;case"input":bB(o,f),Ji("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!f.multiple},Ji("invalid",o);break;case"textarea":TB(o,f),Ji("invalid",o)}tk(r,f),c=null;for(var _ in f)if(f.hasOwnProperty(_)){var x=f[_];_==="children"?typeof x=="string"?o.textContent!==x&&(f.suppressHydrationWarning!==!0&&IT(o.textContent,x,t),c=["children",x]):typeof x=="number"&&o.textContent!==""+x&&(f.suppressHydrationWarning!==!0&&IT(o.textContent,x,t),c=["children",""+x]):Wx.hasOwnProperty(_)&&x!=null&&_==="onScroll"&&Ji("scroll",o)}switch(r){case"input":yT(o),wB(o,f,!0);break;case"textarea":yT(o),EB(o);break;case"select":case"option":break;default:typeof f.onClick=="function"&&(o.onclick=ZE)}o=c,e.updateQueue=o,o!==null&&(e.flags|=4)}else{_=c.nodeType===9?c:c.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=j8(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=_.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof o.is=="string"?t=_.createElement(r,{is:o.is}):(t=_.createElement(r),r==="select"&&(_=t,o.multiple?_.multiple=!0:o.size&&(_.size=o.size))):t=_.createElementNS(t,r),t[Pu]=e,t[n1]=o,u7(t,e,!1,!1),e.stateNode=t;e:{switch(_=nk(r,o),r){case"dialog":Ji("cancel",t),Ji("close",t),c=o;break;case"iframe":case"object":case"embed":Ji("load",t),c=o;break;case"video":case"audio":for(c=0;c<Yv.length;c++)Ji(Yv[c],t);c=o;break;case"source":Ji("error",t),c=o;break;case"img":case"image":case"link":Ji("error",t),Ji("load",t),c=o;break;case"details":Ji("toggle",t),c=o;break;case"input":bB(t,o),c=KM(t,o),Ji("invalid",t);break;case"option":c=o;break;case"select":t._wrapperState={wasMultiple:!!o.multiple},c=Is({},o,{value:void 0}),Ji("invalid",t);break;case"textarea":TB(t,o),c=JM(t,o),Ji("invalid",t);break;default:c=o}tk(r,c),x=c;for(f in x)if(x.hasOwnProperty(f)){var a=x[f];f==="style"?$8(t,a):f==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&U8(t,a)):f==="children"?typeof a=="string"?(r!=="textarea"||a!=="")&&Hx(t,a):typeof a=="number"&&Hx(t,""+a):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(Wx.hasOwnProperty(f)?a!=null&&f==="onScroll"&&Ji("scroll",t):a!=null&&kD(t,f,a,_))}switch(r){case"input":yT(t),wB(t,o,!1);break;case"textarea":yT(t),EB(t);break;case"option":o.value!=null&&t.setAttribute("value",""+Lf(o.value));break;case"select":t.multiple=!!o.multiple,f=o.value,f!=null?Y_(t,!!o.multiple,f,!1):o.defaultValue!=null&&Y_(t,!!o.multiple,o.defaultValue,!0);break;default:typeof c.onClick=="function"&&(t.onclick=ZE)}switch(r){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}}o&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Xo(e),null;case 6:if(t&&e.stateNode!=null)d7(t,e,t.memoizedProps,o);else{if(typeof o!="string"&&e.stateNode===null)throw Error(un(166));if(r=um(i1.current),um(zu.current),AT(e)){if(o=e.stateNode,r=e.memoizedProps,o[Pu]=e,(f=o.nodeValue!==r)&&(t=pl,t!==null))switch(t.tag){case 3:IT(o.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&IT(o.nodeValue,r,(t.mode&1)!==0)}f&&(e.flags|=4)}else o=(r.nodeType===9?r:r.ownerDocument).createTextNode(o),o[Pu]=e,e.stateNode=o}return Xo(e),null;case 13:if(ss(Es),o=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(_s&&al!==null&&e.mode&1&&!(e.flags&128))R9(),my(),e.flags|=98560,f=!1;else if(f=AT(e),o!==null&&o.dehydrated!==null){if(t===null){if(!f)throw Error(un(318));if(f=e.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(un(317));f[Pu]=e}else my(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Xo(e),f=!1}else Dc!==null&&(zk(Dc),Dc=null),f=!0;if(!f)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(o=o!==null,o!==(t!==null&&t.memoizedState!==null)&&o&&(e.child.flags|=8192,e.mode&1&&(t===null||Es.current&1?po===0&&(po=3):pO())),e.updateQueue!==null&&(e.flags|=4),Xo(e),null);case 4:return _y(),Ck(t,e),t===null&&e1(e.stateNode.containerInfo),Xo(e),null;case 10:return YD(e.type._context),Xo(e),null;case 17:return $a(e.type)&&XE(),Xo(e),null;case 19:if(ss(Es),f=e.memoizedState,f===null)return Xo(e),null;if(o=(e.flags&128)!==0,_=f.rendering,_===null)if(o)Dv(f,!1);else{if(po!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(_=nS(t),_!==null){for(e.flags|=128,Dv(f,!1),o=_.updateQueue,o!==null&&(e.updateQueue=o,e.flags|=4),e.subtreeFlags=0,o=r,r=e.child;r!==null;)f=r,t=o,f.flags&=14680066,_=f.alternate,_===null?(f.childLanes=0,f.lanes=t,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=_.childLanes,f.lanes=_.lanes,f.child=_.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=_.memoizedProps,f.memoizedState=_.memoizedState,f.updateQueue=_.updateQueue,f.type=_.type,t=_.dependencies,f.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return Zi(Es,Es.current&1|2),e.child}t=t.sibling}f.tail!==null&&$s()>vy&&(e.flags|=128,o=!0,Dv(f,!1),e.lanes=4194304)}else{if(!o)if(t=nS(_),t!==null){if(e.flags|=128,o=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),Dv(f,!0),f.tail===null&&f.tailMode==="hidden"&&!_.alternate&&!_s)return Xo(e),null}else 2*$s()-f.renderingStartTime>vy&&r!==1073741824&&(e.flags|=128,o=!0,Dv(f,!1),e.lanes=4194304);f.isBackwards?(_.sibling=e.child,e.child=_):(r=f.last,r!==null?r.sibling=_:e.child=_,f.last=_)}return f.tail!==null?(e=f.tail,f.rendering=e,f.tail=e.sibling,f.renderingStartTime=$s(),e.sibling=null,r=Es.current,Zi(Es,o?r&1|2:r&1),e):(Xo(e),null);case 22:case 23:return fO(),o=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==o&&(e.flags|=8192),o&&e.mode&1?sl&1073741824&&(Xo(e),e.subtreeFlags&6&&(e.flags|=8192)):Xo(e),null;case 24:return null;case 25:return null}throw Error(un(156,e.tag))}function ote(t,e){switch(HD(e),e.tag){case 1:return $a(e.type)&&XE(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return _y(),ss(Va),ss(ra),nO(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return tO(e),null;case 13:if(ss(Es),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(un(340));my()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ss(Es),null;case 4:return _y(),null;case 10:return YD(e.type._context),null;case 22:case 23:return fO(),null;case 24:return null;default:return null}}var RT=!1,Jo=!1,ate=typeof WeakSet=="function"?WeakSet:Set,Nn=null;function G_(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(o){zs(t,e,o)}else r.current=null}function Pk(t,e,r){try{r()}catch(o){zs(t,e,o)}}var fj=!1;function lte(t,e){if(dk=qE,t=_9(),qD(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var o=r.getSelection&&r.getSelection();if(o&&o.rangeCount!==0){r=o.anchorNode;var c=o.anchorOffset,f=o.focusNode;o=o.focusOffset;try{r.nodeType,f.nodeType}catch{r=null;break e}var _=0,x=-1,a=-1,I=0,D=0,O=t,F=null;t:for(;;){for(var Z;O!==r||c!==0&&O.nodeType!==3||(x=_+c),O!==f||o!==0&&O.nodeType!==3||(a=_+o),O.nodeType===3&&(_+=O.nodeValue.length),(Z=O.firstChild)!==null;)F=O,O=Z;for(;;){if(O===t)break t;if(F===r&&++I===c&&(x=_),F===f&&++D===o&&(a=_),(Z=O.nextSibling)!==null)break;O=F,F=O.parentNode}O=Z}r=x===-1||a===-1?null:{start:x,end:a}}else r=null}r=r||{start:0,end:0}}else r=null;for(fk={focusedElem:t,selectionRange:r},qE=!1,Nn=e;Nn!==null;)if(e=Nn,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Nn=t;else for(;Nn!==null;){e=Nn;try{var J=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(J!==null){var ne=J.memoizedProps,se=J.memoizedState,W=e.stateNode,Q=W.getSnapshotBeforeUpdate(e.elementType===e.type?ne:Mc(e.type,ne),se);W.__reactInternalSnapshotBeforeUpdate=Q}break;case 3:var K=e.stateNode.containerInfo;K.nodeType===1?K.textContent="":K.nodeType===9&&K.documentElement&&K.removeChild(K.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(un(163))}}catch(pe){zs(e,e.return,pe)}if(t=e.sibling,t!==null){t.return=e.return,Nn=t;break}Nn=e.return}return J=fj,fj=!1,J}function xx(t,e,r){var o=e.updateQueue;if(o=o!==null?o.lastEffect:null,o!==null){var c=o=o.next;do{if((c.tag&t)===t){var f=c.destroy;c.destroy=void 0,f!==void 0&&Pk(e,r,f)}c=c.next}while(c!==o)}}function gI(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var o=r.create;r.destroy=o()}r=r.next}while(r!==e)}}function Rk(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function f7(t){var e=t.alternate;e!==null&&(t.alternate=null,f7(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Pu],delete e[n1],delete e[gk],delete e[Gee],delete e[qee])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function p7(t){return t.tag===5||t.tag===3||t.tag===4}function pj(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||p7(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Mk(t,e,r){var o=t.tag;if(o===5||o===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=ZE));else if(o!==4&&(t=t.child,t!==null))for(Mk(t,e,r),t=t.sibling;t!==null;)Mk(t,e,r),t=t.sibling}function kk(t,e,r){var o=t.tag;if(o===5||o===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(o!==4&&(t=t.child,t!==null))for(kk(t,e,r),t=t.sibling;t!==null;)kk(t,e,r),t=t.sibling}var Ro=null,kc=!1;function Xd(t,e,r){for(r=r.child;r!==null;)m7(t,e,r),r=r.sibling}function m7(t,e,r){if(Lu&&typeof Lu.onCommitFiberUnmount=="function")try{Lu.onCommitFiberUnmount(lI,r)}catch{}switch(r.tag){case 5:Jo||G_(r,e);case 6:var o=Ro,c=kc;Ro=null,Xd(t,e,r),Ro=o,kc=c,Ro!==null&&(kc?(t=Ro,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):Ro.removeChild(r.stateNode));break;case 18:Ro!==null&&(kc?(t=Ro,r=r.stateNode,t.nodeType===8?NR(t.parentNode,r):t.nodeType===1&&NR(t,r),Yx(t)):NR(Ro,r.stateNode));break;case 4:o=Ro,c=kc,Ro=r.stateNode.containerInfo,kc=!0,Xd(t,e,r),Ro=o,kc=c;break;case 0:case 11:case 14:case 15:if(!Jo&&(o=r.updateQueue,o!==null&&(o=o.lastEffect,o!==null))){c=o=o.next;do{var f=c,_=f.destroy;f=f.tag,_!==void 0&&(f&2||f&4)&&Pk(r,e,_),c=c.next}while(c!==o)}Xd(t,e,r);break;case 1:if(!Jo&&(G_(r,e),o=r.stateNode,typeof o.componentWillUnmount=="function"))try{o.props=r.memoizedProps,o.state=r.memoizedState,o.componentWillUnmount()}catch(x){zs(r,e,x)}Xd(t,e,r);break;case 21:Xd(t,e,r);break;case 22:r.mode&1?(Jo=(o=Jo)||r.memoizedState!==null,Xd(t,e,r),Jo=o):Xd(t,e,r);break;default:Xd(t,e,r)}}function mj(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new ate),e.forEach(function(o){var c=_te.bind(null,t,o);r.has(o)||(r.add(o),o.then(c,c))})}}function Rc(t,e){var r=e.deletions;if(r!==null)for(var o=0;o<r.length;o++){var c=r[o];try{var f=t,_=e,x=_;e:for(;x!==null;){switch(x.tag){case 5:Ro=x.stateNode,kc=!1;break e;case 3:Ro=x.stateNode.containerInfo,kc=!0;break e;case 4:Ro=x.stateNode.containerInfo,kc=!0;break e}x=x.return}if(Ro===null)throw Error(un(160));m7(f,_,c),Ro=null,kc=!1;var a=c.alternate;a!==null&&(a.return=null),c.return=null}catch(I){zs(c,e,I)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)g7(e,t),e=e.sibling}function g7(t,e){var r=t.alternate,o=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Rc(e,t),yu(t),o&4){try{xx(3,t,t.return),gI(3,t)}catch(ne){zs(t,t.return,ne)}try{xx(5,t,t.return)}catch(ne){zs(t,t.return,ne)}}break;case 1:Rc(e,t),yu(t),o&512&&r!==null&&G_(r,r.return);break;case 5:if(Rc(e,t),yu(t),o&512&&r!==null&&G_(r,r.return),t.flags&32){var c=t.stateNode;try{Hx(c,"")}catch(ne){zs(t,t.return,ne)}}if(o&4&&(c=t.stateNode,c!=null)){var f=t.memoizedProps,_=r!==null?r.memoizedProps:f,x=t.type,a=t.updateQueue;if(t.updateQueue=null,a!==null)try{x==="input"&&f.type==="radio"&&f.name!=null&&F8(c,f),nk(x,_);var I=nk(x,f);for(_=0;_<a.length;_+=2){var D=a[_],O=a[_+1];D==="style"?$8(c,O):D==="dangerouslySetInnerHTML"?U8(c,O):D==="children"?Hx(c,O):kD(c,D,O,I)}switch(x){case"input":YM(c,f);break;case"textarea":B8(c,f);break;case"select":var F=c._wrapperState.wasMultiple;c._wrapperState.wasMultiple=!!f.multiple;var Z=f.value;Z!=null?Y_(c,!!f.multiple,Z,!1):F!==!!f.multiple&&(f.defaultValue!=null?Y_(c,!!f.multiple,f.defaultValue,!0):Y_(c,!!f.multiple,f.multiple?[]:"",!1))}c[n1]=f}catch(ne){zs(t,t.return,ne)}}break;case 6:if(Rc(e,t),yu(t),o&4){if(t.stateNode===null)throw Error(un(162));c=t.stateNode,f=t.memoizedProps;try{c.nodeValue=f}catch(ne){zs(t,t.return,ne)}}break;case 3:if(Rc(e,t),yu(t),o&4&&r!==null&&r.memoizedState.isDehydrated)try{Yx(e.containerInfo)}catch(ne){zs(t,t.return,ne)}break;case 4:Rc(e,t),yu(t);break;case 13:Rc(e,t),yu(t),c=t.child,c.flags&8192&&(f=c.memoizedState!==null,c.stateNode.isHidden=f,!f||c.alternate!==null&&c.alternate.memoizedState!==null||(hO=$s())),o&4&&mj(t);break;case 22:if(D=r!==null&&r.memoizedState!==null,t.mode&1?(Jo=(I=Jo)||D,Rc(e,t),Jo=I):Rc(e,t),yu(t),o&8192){if(I=t.memoizedState!==null,(t.stateNode.isHidden=I)&&!D&&t.mode&1)for(Nn=t,D=t.child;D!==null;){for(O=Nn=D;Nn!==null;){switch(F=Nn,Z=F.child,F.tag){case 0:case 11:case 14:case 15:xx(4,F,F.return);break;case 1:G_(F,F.return);var J=F.stateNode;if(typeof J.componentWillUnmount=="function"){o=F,r=F.return;try{e=o,J.props=e.memoizedProps,J.state=e.memoizedState,J.componentWillUnmount()}catch(ne){zs(o,r,ne)}}break;case 5:G_(F,F.return);break;case 22:if(F.memoizedState!==null){_j(O);continue}}Z!==null?(Z.return=F,Nn=Z):_j(O)}D=D.sibling}e:for(D=null,O=t;;){if(O.tag===5){if(D===null){D=O;try{c=O.stateNode,I?(f=c.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none"):(x=O.stateNode,a=O.memoizedProps.style,_=a!=null&&a.hasOwnProperty("display")?a.display:null,x.style.display=V8("display",_))}catch(ne){zs(t,t.return,ne)}}}else if(O.tag===6){if(D===null)try{O.stateNode.nodeValue=I?"":O.memoizedProps}catch(ne){zs(t,t.return,ne)}}else if((O.tag!==22&&O.tag!==23||O.memoizedState===null||O===t)&&O.child!==null){O.child.return=O,O=O.child;continue}if(O===t)break e;for(;O.sibling===null;){if(O.return===null||O.return===t)break e;D===O&&(D=null),O=O.return}D===O&&(D=null),O.sibling.return=O.return,O=O.sibling}}break;case 19:Rc(e,t),yu(t),o&4&&mj(t);break;case 21:break;default:Rc(e,t),yu(t)}}function yu(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(p7(r)){var o=r;break e}r=r.return}throw Error(un(160))}switch(o.tag){case 5:var c=o.stateNode;o.flags&32&&(Hx(c,""),o.flags&=-33);var f=pj(t);kk(t,f,c);break;case 3:case 4:var _=o.stateNode.containerInfo,x=pj(t);Mk(t,x,_);break;default:throw Error(un(161))}}catch(a){zs(t,t.return,a)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function cte(t,e,r){Nn=t,_7(t)}function _7(t,e,r){for(var o=(t.mode&1)!==0;Nn!==null;){var c=Nn,f=c.child;if(c.tag===22&&o){var _=c.memoizedState!==null||RT;if(!_){var x=c.alternate,a=x!==null&&x.memoizedState!==null||Jo;x=RT;var I=Jo;if(RT=_,(Jo=a)&&!I)for(Nn=c;Nn!==null;)_=Nn,a=_.child,_.tag===22&&_.memoizedState!==null?yj(c):a!==null?(a.return=_,Nn=a):yj(c);for(;f!==null;)Nn=f,_7(f),f=f.sibling;Nn=c,RT=x,Jo=I}gj(t)}else c.subtreeFlags&8772&&f!==null?(f.return=c,Nn=f):gj(t)}}function gj(t){for(;Nn!==null;){var e=Nn;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Jo||gI(5,e);break;case 1:var o=e.stateNode;if(e.flags&4&&!Jo)if(r===null)o.componentDidMount();else{var c=e.elementType===e.type?r.memoizedProps:Mc(e.type,r.memoizedProps);o.componentDidUpdate(c,r.memoizedState,o.__reactInternalSnapshotBeforeUpdate)}var f=e.updateQueue;f!==null&&ej(e,f,o);break;case 3:var _=e.updateQueue;if(_!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}ej(e,_,r)}break;case 5:var x=e.stateNode;if(r===null&&e.flags&4){r=x;var a=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&r.focus();break;case"img":a.src&&(r.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var I=e.alternate;if(I!==null){var D=I.memoizedState;if(D!==null){var O=D.dehydrated;O!==null&&Yx(O)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(un(163))}Jo||e.flags&512&&Rk(e)}catch(F){zs(e,e.return,F)}}if(e===t){Nn=null;break}if(r=e.sibling,r!==null){r.return=e.return,Nn=r;break}Nn=e.return}}function _j(t){for(;Nn!==null;){var e=Nn;if(e===t){Nn=null;break}var r=e.sibling;if(r!==null){r.return=e.return,Nn=r;break}Nn=e.return}}function yj(t){for(;Nn!==null;){var e=Nn;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{gI(4,e)}catch(a){zs(e,r,a)}break;case 1:var o=e.stateNode;if(typeof o.componentDidMount=="function"){var c=e.return;try{o.componentDidMount()}catch(a){zs(e,c,a)}}var f=e.return;try{Rk(e)}catch(a){zs(e,f,a)}break;case 5:var _=e.return;try{Rk(e)}catch(a){zs(e,_,a)}}}catch(a){zs(e,e.return,a)}if(e===t){Nn=null;break}var x=e.sibling;if(x!==null){x.return=e.return,Nn=x;break}Nn=e.return}}var ute=Math.ceil,sS=td.ReactCurrentDispatcher,cO=td.ReactCurrentOwner,Zl=td.ReactCurrentBatchConfig,ci=0,So=null,Js=null,zo=0,sl=0,q_=Hf(0),po=0,l1=null,Pm=0,_I=0,uO=0,bx=null,Na=null,hO=0,vy=1/0,Ch=null,oS=!1,Dk=null,Sf=null,MT=!1,ff=null,aS=0,wx=0,Ok=null,dE=-1,fE=0;function Ta(){return ci&6?$s():dE!==-1?dE:dE=$s()}function If(t){return t.mode&1?ci&2&&zo!==0?zo&-zo:Hee.transition!==null?(fE===0&&(fE=t9()),fE):(t=Pi,t!==0||(t=window.event,t=t===void 0?16:l9(t.type)),t):1}function Fc(t,e,r,o){if(50<wx)throw wx=0,Ok=null,Error(un(185));U1(t,r,o),(!(ci&2)||t!==So)&&(t===So&&(!(ci&2)&&(_I|=r),po===4&&of(t,zo)),Ga(t,o),r===1&&ci===0&&!(e.mode&1)&&(vy=$s()+500,fI&&Zf()))}function Ga(t,e){var r=t.callbackNode;H2(t,e);var o=GE(t,t===So?zo:0);if(o===0)r!==null&&AB(r),t.callbackNode=null,t.callbackPriority=0;else if(e=o&-o,t.callbackPriority!==e){if(r!=null&&AB(r),e===1)t.tag===0?Wee(vj.bind(null,t)):A9(vj.bind(null,t)),Vee(function(){!(ci&6)&&Zf()}),r=null;else{switch(n9(o)){case 1:r=ND;break;case 4:r=J8;break;case 16:r=$E;break;case 536870912:r=e9;break;default:r=$E}r=S7(r,y7.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function y7(t,e){if(dE=-1,fE=0,ci&6)throw Error(un(327));var r=t.callbackNode;if(ny()&&t.callbackNode!==r)return null;var o=GE(t,t===So?zo:0);if(o===0)return null;if(o&30||o&t.expiredLanes||e)e=lS(t,o);else{e=o;var c=ci;ci|=2;var f=x7();(So!==t||zo!==e)&&(Ch=null,vy=$s()+500,gm(t,e));do try{fte();break}catch(x){v7(t,x)}while(!0);KD(),sS.current=f,ci=c,Js!==null?e=0:(So=null,zo=0,e=po)}if(e!==0){if(e===2&&(c=ak(t),c!==0&&(o=c,e=Lk(t,c))),e===1)throw r=l1,gm(t,0),of(t,o),Ga(t,$s()),r;if(e===6)of(t,o);else{if(c=t.current.alternate,!(o&30)&&!hte(c)&&(e=lS(t,o),e===2&&(f=ak(t),f!==0&&(o=f,e=Lk(t,f))),e===1))throw r=l1,gm(t,0),of(t,o),Ga(t,$s()),r;switch(t.finishedWork=c,t.finishedLanes=o,e){case 0:case 1:throw Error(un(345));case 2:tm(t,Na,Ch);break;case 3:if(of(t,o),(o&130023424)===o&&(e=hO+500-$s(),10<e)){if(GE(t,0)!==0)break;if(c=t.suspendedLanes,(c&o)!==o){Ta(),t.pingedLanes|=t.suspendedLanes&c;break}t.timeoutHandle=mk(tm.bind(null,t,Na,Ch),e);break}tm(t,Na,Ch);break;case 4:if(of(t,o),(o&4194240)===o)break;for(e=t.eventTimes,c=-1;0<o;){var _=31-Nc(o);f=1<<_,_=e[_],_>c&&(c=_),o&=~f}if(o=c,o=$s()-o,o=(120>o?120:480>o?480:1080>o?1080:1920>o?1920:3e3>o?3e3:4320>o?4320:1960*ute(o/1960))-o,10<o){t.timeoutHandle=mk(tm.bind(null,t,Na,Ch),o);break}tm(t,Na,Ch);break;case 5:tm(t,Na,Ch);break;default:throw Error(un(329))}}}return Ga(t,$s()),t.callbackNode===r?y7.bind(null,t):null}function Lk(t,e){var r=bx;return t.current.memoizedState.isDehydrated&&(gm(t,e).flags|=256),t=lS(t,e),t!==2&&(e=Na,Na=r,e!==null&&zk(e)),t}function zk(t){Na===null?Na=t:Na.push.apply(Na,t)}function hte(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var o=0;o<r.length;o++){var c=r[o],f=c.getSnapshot;c=c.value;try{if(!Uc(f(),c))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function of(t,e){for(e&=~uO,e&=~_I,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-Nc(e),o=1<<r;t[r]=-1,e&=~o}}function vj(t){if(ci&6)throw Error(un(327));ny();var e=GE(t,0);if(!(e&1))return Ga(t,$s()),null;var r=lS(t,e);if(t.tag!==0&&r===2){var o=ak(t);o!==0&&(e=o,r=Lk(t,o))}if(r===1)throw r=l1,gm(t,0),of(t,e),Ga(t,$s()),r;if(r===6)throw Error(un(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,tm(t,Na,Ch),Ga(t,$s()),null}function dO(t,e){var r=ci;ci|=1;try{return t(e)}finally{ci=r,ci===0&&(vy=$s()+500,fI&&Zf())}}function Rm(t){ff!==null&&ff.tag===0&&!(ci&6)&&ny();var e=ci;ci|=1;var r=Zl.transition,o=Pi;try{if(Zl.transition=null,Pi=1,t)return t()}finally{Pi=o,Zl.transition=r,ci=e,!(ci&6)&&Zf()}}function fO(){sl=q_.current,ss(q_)}function gm(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,Uee(r)),Js!==null)for(r=Js.return;r!==null;){var o=r;switch(HD(o),o.tag){case 1:o=o.type.childContextTypes,o!=null&&XE();break;case 3:_y(),ss(Va),ss(ra),nO();break;case 5:tO(o);break;case 4:_y();break;case 13:ss(Es);break;case 19:ss(Es);break;case 10:YD(o.type._context);break;case 22:case 23:fO()}r=r.return}if(So=t,Js=t=Af(t.current,null),zo=sl=e,po=0,l1=null,uO=_I=Pm=0,Na=bx=null,cm!==null){for(e=0;e<cm.length;e++)if(r=cm[e],o=r.interleaved,o!==null){r.interleaved=null;var c=o.next,f=r.pending;if(f!==null){var _=f.next;f.next=c,o.next=_}r.pending=o}cm=null}return t}function v7(t,e){do{var r=Js;try{if(KD(),cE.current=iS,rS){for(var o=Ss.memoizedState;o!==null;){var c=o.queue;c!==null&&(c.pending=null),o=o.next}rS=!1}if(Cm=0,To=fo=Ss=null,vx=!1,s1=0,cO.current=null,r===null||r.return===null){po=1,l1=e,Js=null;break}e:{var f=t,_=r.return,x=r,a=e;if(e=zo,x.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var I=a,D=x,O=D.tag;if(!(D.mode&1)&&(O===0||O===11||O===15)){var F=D.alternate;F?(D.updateQueue=F.updateQueue,D.memoizedState=F.memoizedState,D.lanes=F.lanes):(D.updateQueue=null,D.memoizedState=null)}var Z=oj(_);if(Z!==null){Z.flags&=-257,aj(Z,_,x,f,e),Z.mode&1&&sj(f,I,e),e=Z,a=I;var J=e.updateQueue;if(J===null){var ne=new Set;ne.add(a),e.updateQueue=ne}else J.add(a);break e}else{if(!(e&1)){sj(f,I,e),pO();break e}a=Error(un(426))}}else if(_s&&x.mode&1){var se=oj(_);if(se!==null){!(se.flags&65536)&&(se.flags|=256),aj(se,_,x,f,e),ZD(yy(a,x));break e}}f=a=yy(a,x),po!==4&&(po=2),bx===null?bx=[f]:bx.push(f),f=_;do{switch(f.tag){case 3:f.flags|=65536,e&=-e,f.lanes|=e;var W=n7(f,a,e);JB(f,W);break e;case 1:x=a;var Q=f.type,K=f.stateNode;if(!(f.flags&128)&&(typeof Q.getDerivedStateFromError=="function"||K!==null&&typeof K.componentDidCatch=="function"&&(Sf===null||!Sf.has(K)))){f.flags|=65536,e&=-e,f.lanes|=e;var pe=r7(f,x,e);JB(f,pe);break e}}f=f.return}while(f!==null)}w7(r)}catch(Te){e=Te,Js===r&&r!==null&&(Js=r=r.return);continue}break}while(!0)}function x7(){var t=sS.current;return sS.current=iS,t===null?iS:t}function pO(){(po===0||po===3||po===2)&&(po=4),So===null||!(Pm&268435455)&&!(_I&268435455)||of(So,zo)}function lS(t,e){var r=ci;ci|=2;var o=x7();(So!==t||zo!==e)&&(Ch=null,gm(t,e));do try{dte();break}catch(c){v7(t,c)}while(!0);if(KD(),ci=r,sS.current=o,Js!==null)throw Error(un(261));return So=null,zo=0,po}function dte(){for(;Js!==null;)b7(Js)}function fte(){for(;Js!==null&&!F2();)b7(Js)}function b7(t){var e=E7(t.alternate,t,sl);t.memoizedProps=t.pendingProps,e===null?w7(t):Js=e,cO.current=null}function w7(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=ote(r,e),r!==null){r.flags&=32767,Js=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{po=6,Js=null;return}}else if(r=ste(r,e,sl),r!==null){Js=r;return}if(e=e.sibling,e!==null){Js=e;return}Js=e=t}while(e!==null);po===0&&(po=5)}function tm(t,e,r){var o=Pi,c=Zl.transition;try{Zl.transition=null,Pi=1,pte(t,e,r,o)}finally{Zl.transition=c,Pi=o}return null}function pte(t,e,r,o){do ny();while(ff!==null);if(ci&6)throw Error(un(327));r=t.finishedWork;var c=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(un(177));t.callbackNode=null,t.callbackPriority=0;var f=r.lanes|r.childLanes;if(Z2(t,f),t===So&&(Js=So=null,zo=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||MT||(MT=!0,S7($E,function(){return ny(),null})),f=(r.flags&15990)!==0,r.subtreeFlags&15990||f){f=Zl.transition,Zl.transition=null;var _=Pi;Pi=1;var x=ci;ci|=4,cO.current=null,lte(t,r),g7(r,t),Oee(fk),qE=!!dk,fk=dk=null,t.current=r,cte(r),B2(),ci=x,Pi=_,Zl.transition=f}else t.current=r;if(MT&&(MT=!1,ff=t,aS=c),f=t.pendingLanes,f===0&&(Sf=null),V2(r.stateNode),Ga(t,$s()),e!==null)for(o=t.onRecoverableError,r=0;r<e.length;r++)c=e[r],o(c.value,{componentStack:c.stack,digest:c.digest});if(oS)throw oS=!1,t=Dk,Dk=null,t;return aS&1&&t.tag!==0&&ny(),f=t.pendingLanes,f&1?t===Ok?wx++:(wx=0,Ok=t):wx=0,Zf(),null}function ny(){if(ff!==null){var t=n9(aS),e=Zl.transition,r=Pi;try{if(Zl.transition=null,Pi=16>t?16:t,ff===null)var o=!1;else{if(t=ff,ff=null,aS=0,ci&6)throw Error(un(331));var c=ci;for(ci|=4,Nn=t.current;Nn!==null;){var f=Nn,_=f.child;if(Nn.flags&16){var x=f.deletions;if(x!==null){for(var a=0;a<x.length;a++){var I=x[a];for(Nn=I;Nn!==null;){var D=Nn;switch(D.tag){case 0:case 11:case 15:xx(8,D,f)}var O=D.child;if(O!==null)O.return=D,Nn=O;else for(;Nn!==null;){D=Nn;var F=D.sibling,Z=D.return;if(f7(D),D===I){Nn=null;break}if(F!==null){F.return=Z,Nn=F;break}Nn=Z}}}var J=f.alternate;if(J!==null){var ne=J.child;if(ne!==null){J.child=null;do{var se=ne.sibling;ne.sibling=null,ne=se}while(ne!==null)}}Nn=f}}if(f.subtreeFlags&2064&&_!==null)_.return=f,Nn=_;else e:for(;Nn!==null;){if(f=Nn,f.flags&2048)switch(f.tag){case 0:case 11:case 15:xx(9,f,f.return)}var W=f.sibling;if(W!==null){W.return=f.return,Nn=W;break e}Nn=f.return}}var Q=t.current;for(Nn=Q;Nn!==null;){_=Nn;var K=_.child;if(_.subtreeFlags&2064&&K!==null)K.return=_,Nn=K;else e:for(_=Q;Nn!==null;){if(x=Nn,x.flags&2048)try{switch(x.tag){case 0:case 11:case 15:gI(9,x)}}catch(Te){zs(x,x.return,Te)}if(x===_){Nn=null;break e}var pe=x.sibling;if(pe!==null){pe.return=x.return,Nn=pe;break e}Nn=x.return}}if(ci=c,Zf(),Lu&&typeof Lu.onPostCommitFiberRoot=="function")try{Lu.onPostCommitFiberRoot(lI,t)}catch{}o=!0}return o}finally{Pi=r,Zl.transition=e}}return!1}function xj(t,e,r){e=yy(r,e),e=n7(t,e,1),t=Ef(t,e,1),e=Ta(),t!==null&&(U1(t,1,e),Ga(t,e))}function zs(t,e,r){if(t.tag===3)xj(t,t,r);else for(;e!==null;){if(e.tag===3){xj(e,t,r);break}else if(e.tag===1){var o=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(Sf===null||!Sf.has(o))){t=yy(r,t),t=r7(e,t,1),e=Ef(e,t,1),t=Ta(),e!==null&&(U1(e,1,t),Ga(e,t));break}}e=e.return}}function mte(t,e,r){var o=t.pingCache;o!==null&&o.delete(e),e=Ta(),t.pingedLanes|=t.suspendedLanes&r,So===t&&(zo&r)===r&&(po===4||po===3&&(zo&130023424)===zo&&500>$s()-hO?gm(t,0):uO|=r),Ga(t,e)}function T7(t,e){e===0&&(t.mode&1?(e=bT,bT<<=1,!(bT&130023424)&&(bT=4194304)):e=1);var r=Ta();t=Gh(t,e),t!==null&&(U1(t,e,r),Ga(t,r))}function gte(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),T7(t,r)}function _te(t,e){var r=0;switch(t.tag){case 13:var o=t.stateNode,c=t.memoizedState;c!==null&&(r=c.retryLane);break;case 19:o=t.stateNode;break;default:throw Error(un(314))}o!==null&&o.delete(e),T7(t,r)}var E7;E7=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||Va.current)ja=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return ja=!1,ite(t,e,r);ja=!!(t.flags&131072)}else ja=!1,_s&&e.flags&1048576&&C9(e,QE,e.index);switch(e.lanes=0,e.tag){case 2:var o=e.type;hE(t,e),t=e.pendingProps;var c=py(e,ra.current);ty(e,r),c=iO(null,e,o,t,c,r);var f=sO();return e.flags|=1,typeof c=="object"&&c!==null&&typeof c.render=="function"&&c.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,$a(o)?(f=!0,KE(e)):f=!1,e.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,JD(e),c.updater=mI,e.stateNode=c,c._reactInternals=e,wk(e,o,t,r),e=Sk(null,e,o,!0,f,r)):(e.tag=0,_s&&f&&WD(e),ba(null,e,c,r),e=e.child),e;case 16:o=e.elementType;e:{switch(hE(t,e),t=e.pendingProps,c=o._init,o=c(o._payload),e.type=o,c=e.tag=vte(o),t=Mc(o,t),c){case 0:e=Ek(null,e,o,t,r);break e;case 1:e=uj(null,e,o,t,r);break e;case 11:e=lj(null,e,o,t,r);break e;case 14:e=cj(null,e,o,Mc(o.type,t),r);break e}throw Error(un(306,o,""))}return e;case 0:return o=e.type,c=e.pendingProps,c=e.elementType===o?c:Mc(o,c),Ek(t,e,o,c,r);case 1:return o=e.type,c=e.pendingProps,c=e.elementType===o?c:Mc(o,c),uj(t,e,o,c,r);case 3:e:{if(a7(e),t===null)throw Error(un(387));o=e.pendingProps,f=e.memoizedState,c=f.element,O9(t,e),tS(e,o,null,r);var _=e.memoizedState;if(o=_.element,f.isDehydrated)if(f={element:o,isDehydrated:!1,cache:_.cache,pendingSuspenseBoundaries:_.pendingSuspenseBoundaries,transitions:_.transitions},e.updateQueue.baseState=f,e.memoizedState=f,e.flags&256){c=yy(Error(un(423)),e),e=hj(t,e,o,r,c);break e}else if(o!==c){c=yy(Error(un(424)),e),e=hj(t,e,o,r,c);break e}else for(al=Tf(e.stateNode.containerInfo.firstChild),pl=e,_s=!0,Dc=null,r=k9(e,null,o,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(my(),o===c){e=qh(t,e,r);break e}ba(t,e,o,r)}e=e.child}return e;case 5:return L9(e),t===null&&vk(e),o=e.type,c=e.pendingProps,f=t!==null?t.memoizedProps:null,_=c.children,pk(o,c)?_=null:f!==null&&pk(o,f)&&(e.flags|=32),o7(t,e),ba(t,e,_,r),e.child;case 6:return t===null&&vk(e),null;case 13:return l7(t,e,r);case 4:return eO(e,e.stateNode.containerInfo),o=e.pendingProps,t===null?e.child=gy(e,null,o,r):ba(t,e,o,r),e.child;case 11:return o=e.type,c=e.pendingProps,c=e.elementType===o?c:Mc(o,c),lj(t,e,o,c,r);case 7:return ba(t,e,e.pendingProps,r),e.child;case 8:return ba(t,e,e.pendingProps.children,r),e.child;case 12:return ba(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(o=e.type._context,c=e.pendingProps,f=e.memoizedProps,_=c.value,Zi(JE,o._currentValue),o._currentValue=_,f!==null)if(Uc(f.value,_)){if(f.children===c.children&&!Va.current){e=qh(t,e,r);break e}}else for(f=e.child,f!==null&&(f.return=e);f!==null;){var x=f.dependencies;if(x!==null){_=f.child;for(var a=x.firstContext;a!==null;){if(a.context===o){if(f.tag===1){a=Fh(-1,r&-r),a.tag=2;var I=f.updateQueue;if(I!==null){I=I.shared;var D=I.pending;D===null?a.next=a:(a.next=D.next,D.next=a),I.pending=a}}f.lanes|=r,a=f.alternate,a!==null&&(a.lanes|=r),xk(f.return,r,e),x.lanes|=r;break}a=a.next}}else if(f.tag===10)_=f.type===e.type?null:f.child;else if(f.tag===18){if(_=f.return,_===null)throw Error(un(341));_.lanes|=r,x=_.alternate,x!==null&&(x.lanes|=r),xk(_,r,e),_=f.sibling}else _=f.child;if(_!==null)_.return=f;else for(_=f;_!==null;){if(_===e){_=null;break}if(f=_.sibling,f!==null){f.return=_.return,_=f;break}_=_.return}f=_}ba(t,e,c.children,r),e=e.child}return e;case 9:return c=e.type,o=e.pendingProps.children,ty(e,r),c=Kl(c),o=o(c),e.flags|=1,ba(t,e,o,r),e.child;case 14:return o=e.type,c=Mc(o,e.pendingProps),c=Mc(o.type,c),cj(t,e,o,c,r);case 15:return i7(t,e,e.type,e.pendingProps,r);case 17:return o=e.type,c=e.pendingProps,c=e.elementType===o?c:Mc(o,c),hE(t,e),e.tag=1,$a(o)?(t=!0,KE(e)):t=!1,ty(e,r),t7(e,o,c),wk(e,o,c,r),Sk(null,e,o,!0,t,r);case 19:return c7(t,e,r);case 22:return s7(t,e,r)}throw Error(un(156,e.tag))};function S7(t,e){return Q8(t,e)}function yte(t,e,r,o){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Hl(t,e,r,o){return new yte(t,e,r,o)}function mO(t){return t=t.prototype,!(!t||!t.isReactComponent)}function vte(t){if(typeof t=="function")return mO(t)?1:0;if(t!=null){if(t=t.$$typeof,t===OD)return 11;if(t===LD)return 14}return 2}function Af(t,e){var r=t.alternate;return r===null?(r=Hl(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function pE(t,e,r,o,c,f){var _=2;if(o=t,typeof t=="function")mO(t)&&(_=1);else if(typeof t=="string")_=5;else e:switch(t){case L_:return _m(r.children,c,f,e);case DD:_=8,c|=8;break;case WM:return t=Hl(12,r,e,c|2),t.elementType=WM,t.lanes=f,t;case HM:return t=Hl(13,r,e,c),t.elementType=HM,t.lanes=f,t;case ZM:return t=Hl(19,r,e,c),t.elementType=ZM,t.lanes=f,t;case L8:return yI(r,c,f,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case D8:_=10;break e;case O8:_=9;break e;case OD:_=11;break e;case LD:_=14;break e;case tf:_=16,o=null;break e}throw Error(un(130,t==null?t:typeof t,""))}return e=Hl(_,r,e,c),e.elementType=t,e.type=o,e.lanes=f,e}function _m(t,e,r,o){return t=Hl(7,t,o,e),t.lanes=r,t}function yI(t,e,r,o){return t=Hl(22,t,o,e),t.elementType=L8,t.lanes=r,t.stateNode={isHidden:!1},t}function qR(t,e,r){return t=Hl(6,t,null,e),t.lanes=r,t}function WR(t,e,r){return e=Hl(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function xte(t,e,r,o,c){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=IR(0),this.expirationTimes=IR(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=IR(0),this.identifierPrefix=o,this.onRecoverableError=c,this.mutableSourceEagerHydrationData=null}function gO(t,e,r,o,c,f,_,x,a){return t=new xte(t,e,r,x,a),e===1?(e=1,f===!0&&(e|=8)):e=0,f=Hl(3,null,null,e),t.current=f,f.stateNode=t,f.memoizedState={element:o,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},JD(f),t}function bte(t,e,r){var o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:O_,key:o==null?null:""+o,children:t,containerInfo:e,implementation:r}}function I7(t){if(!t)return zf;t=t._reactInternals;e:{if(Zm(t)!==t||t.tag!==1)throw Error(un(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if($a(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(un(171))}if(t.tag===1){var r=t.type;if($a(r))return I9(t,r,e)}return e}function A7(t,e,r,o,c,f,_,x,a){return t=gO(r,o,!0,t,c,f,_,x,a),t.context=I7(null),r=t.current,o=Ta(),c=If(r),f=Fh(o,c),f.callback=e??null,Ef(r,f,c),t.current.lanes=c,U1(t,c,o),Ga(t,o),t}function vI(t,e,r,o){var c=e.current,f=Ta(),_=If(c);return r=I7(r),e.context===null?e.context=r:e.pendingContext=r,e=Fh(f,_),e.payload={element:t},o=o===void 0?null:o,o!==null&&(e.callback=o),t=Ef(c,e,_),t!==null&&(Fc(t,c,_,f),lE(t,c,_)),_}function cS(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function bj(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function _O(t,e){bj(t,e),(t=t.alternate)&&bj(t,e)}function wte(){return null}var C7=typeof reportError=="function"?reportError:function(t){console.error(t)};function yO(t){this._internalRoot=t}xI.prototype.render=yO.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(un(409));vI(t,e,null,null)};xI.prototype.unmount=yO.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Rm(function(){vI(null,t,null,null)}),e[$h]=null}};function xI(t){this._internalRoot=t}xI.prototype.unstable_scheduleHydration=function(t){if(t){var e=s9();t={blockedOn:null,target:t,priority:e};for(var r=0;r<sf.length&&e!==0&&e<sf[r].priority;r++);sf.splice(r,0,t),r===0&&a9(t)}};function vO(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function bI(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function wj(){}function Tte(t,e,r,o,c){if(c){if(typeof o=="function"){var f=o;o=function(){var I=cS(_);f.call(I)}}var _=A7(e,o,t,0,null,!1,!1,"",wj);return t._reactRootContainer=_,t[$h]=_.current,e1(t.nodeType===8?t.parentNode:t),Rm(),_}for(;c=t.lastChild;)t.removeChild(c);if(typeof o=="function"){var x=o;o=function(){var I=cS(a);x.call(I)}}var a=gO(t,0,!1,null,null,!1,!1,"",wj);return t._reactRootContainer=a,t[$h]=a.current,e1(t.nodeType===8?t.parentNode:t),Rm(function(){vI(e,a,r,o)}),a}function wI(t,e,r,o,c){var f=r._reactRootContainer;if(f){var _=f;if(typeof c=="function"){var x=c;c=function(){var a=cS(_);x.call(a)}}vI(e,_,t,c)}else _=Tte(r,e,t,c,o);return cS(_)}r9=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=Kv(e.pendingLanes);r!==0&&(FD(e,r|1),Ga(e,$s()),!(ci&6)&&(vy=$s()+500,Zf()))}break;case 13:Rm(function(){var o=Gh(t,1);if(o!==null){var c=Ta();Fc(o,t,1,c)}}),_O(t,1)}};BD=function(t){if(t.tag===13){var e=Gh(t,134217728);if(e!==null){var r=Ta();Fc(e,t,134217728,r)}_O(t,134217728)}};i9=function(t){if(t.tag===13){var e=If(t),r=Gh(t,e);if(r!==null){var o=Ta();Fc(r,t,e,o)}_O(t,e)}};s9=function(){return Pi};o9=function(t,e){var r=Pi;try{return Pi=t,e()}finally{Pi=r}};ik=function(t,e,r){switch(e){case"input":if(YM(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var o=r[e];if(o!==t&&o.form===t.form){var c=dI(o);if(!c)throw Error(un(90));N8(o),YM(o,c)}}}break;case"textarea":B8(t,r);break;case"select":e=r.value,e!=null&&Y_(t,!!r.multiple,e,!1)}};W8=dO;H8=Rm;var Ete={usingClientEntryPoint:!1,Events:[$1,B_,dI,G8,q8,dO]},Ov={findFiberByHostInstance:lm,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ste={bundleType:Ov.bundleType,version:Ov.version,rendererPackageName:Ov.rendererPackageName,rendererConfig:Ov.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:td.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=K8(t),t===null?null:t.stateNode},findFiberByHostInstance:Ov.findFiberByHostInstance||wte,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var kT=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!kT.isDisabled&&kT.supportsFiber)try{lI=kT.inject(Ste),Lu=kT}catch{}}xl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ete;xl.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!vO(e))throw Error(un(200));return bte(t,e,null,r)};xl.createRoot=function(t,e){if(!vO(t))throw Error(un(299));var r=!1,o="",c=C7;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(o=e.identifierPrefix),e.onRecoverableError!==void 0&&(c=e.onRecoverableError)),e=gO(t,1,!1,null,null,r,!1,o,c),t[$h]=e.current,e1(t.nodeType===8?t.parentNode:t),new yO(e)};xl.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(un(188)):(t=Object.keys(t).join(","),Error(un(268,t)));return t=K8(e),t=t===null?null:t.stateNode,t};xl.flushSync=function(t){return Rm(t)};xl.hydrate=function(t,e,r){if(!bI(e))throw Error(un(200));return wI(null,t,e,!0,r)};xl.hydrateRoot=function(t,e,r){if(!vO(t))throw Error(un(405));var o=r!=null&&r.hydratedSources||null,c=!1,f="",_=C7;if(r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(f=r.identifierPrefix),r.onRecoverableError!==void 0&&(_=r.onRecoverableError)),e=A7(e,null,t,1,r??null,c,!1,f,_),t[$h]=e.current,e1(t),o)for(t=0;t<o.length;t++)r=o[t],c=r._getVersion,c=c(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,c]:e.mutableSourceEagerHydrationData.push(r,c);return new xI(e)};xl.render=function(t,e,r){if(!bI(e))throw Error(un(200));return wI(null,t,e,!1,r)};xl.unmountComponentAtNode=function(t){if(!bI(t))throw Error(un(40));return t._reactRootContainer?(Rm(function(){wI(null,null,t,!1,function(){t._reactRootContainer=null,t[$h]=null})}),!0):!1};xl.unstable_batchedUpdates=dO;xl.unstable_renderSubtreeIntoContainer=function(t,e,r,o){if(!bI(r))throw Error(un(200));if(t==null||t._reactInternals===void 0)throw Error(un(38));return wI(t,e,r,!1,o)};xl.version="18.3.1-next-f1338f8080-20240426";function P7(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(P7)}catch(t){console.error(t)}}P7(),P8.exports=xl;var TI=P8.exports;const DT=Wm(TI);var R7,Tj=TI;R7=Tj.createRoot,Tj.hydrateRoot;/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function c1(){return c1=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},c1.apply(this,arguments)}var pf;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(pf||(pf={}));const Ej="popstate";function Ite(t){t===void 0&&(t={});function e(o,c){let{pathname:f,search:_,hash:x}=o.location;return Nk("",{pathname:f,search:_,hash:x},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function r(o,c){return typeof c=="string"?c:uS(c)}return Cte(e,r,null,t)}function to(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function M7(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Ate(){return Math.random().toString(36).substr(2,8)}function Sj(t,e){return{usr:t.state,key:t.key,idx:e}}function Nk(t,e,r,o){return r===void 0&&(r=null),c1({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Gy(e):e,{state:r,key:e&&e.key||o||Ate()})}function uS(t){let{pathname:e="/",search:r="",hash:o=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),o&&o!=="#"&&(e+=o.charAt(0)==="#"?o:"#"+o),e}function Gy(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let o=t.indexOf("?");o>=0&&(e.search=t.substr(o),t=t.substr(0,o)),t&&(e.pathname=t)}return e}function Cte(t,e,r,o){o===void 0&&(o={});let{window:c=document.defaultView,v5Compat:f=!1}=o,_=c.history,x=pf.Pop,a=null,I=D();I==null&&(I=0,_.replaceState(c1({},_.state,{idx:I}),""));function D(){return(_.state||{idx:null}).idx}function O(){x=pf.Pop;let se=D(),W=se==null?null:se-I;I=se,a&&a({action:x,location:ne.location,delta:W})}function F(se,W){x=pf.Push;let Q=Nk(ne.location,se,W);I=D()+1;let K=Sj(Q,I),pe=ne.createHref(Q);try{_.pushState(K,"",pe)}catch(Te){if(Te instanceof DOMException&&Te.name==="DataCloneError")throw Te;c.location.assign(pe)}f&&a&&a({action:x,location:ne.location,delta:1})}function Z(se,W){x=pf.Replace;let Q=Nk(ne.location,se,W);I=D();let K=Sj(Q,I),pe=ne.createHref(Q);_.replaceState(K,"",pe),f&&a&&a({action:x,location:ne.location,delta:0})}function J(se){let W=c.location.origin!=="null"?c.location.origin:c.location.href,Q=typeof se=="string"?se:uS(se);return Q=Q.replace(/ $/,"%20"),to(W,"No window.location.(origin|href) available to create URL for href: "+Q),new URL(Q,W)}let ne={get action(){return x},get location(){return t(c,_)},listen(se){if(a)throw new Error("A history only accepts one active listener");return c.addEventListener(Ej,O),a=se,()=>{c.removeEventListener(Ej,O),a=null}},createHref(se){return e(c,se)},createURL:J,encodeLocation(se){let W=J(se);return{pathname:W.pathname,search:W.search,hash:W.hash}},push:F,replace:Z,go(se){return _.go(se)}};return ne}var Ij;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Ij||(Ij={}));function Pte(t,e,r){return r===void 0&&(r="/"),Rte(t,e,r,!1)}function Rte(t,e,r,o){let c=typeof e=="string"?Gy(e):e,f=xO(c.pathname||"/",r);if(f==null)return null;let _=k7(t);Mte(_);let x=null;for(let a=0;x==null&&a<_.length;++a){let I=Vte(f);x=jte(_[a],I,o)}return x}function k7(t,e,r,o){e===void 0&&(e=[]),r===void 0&&(r=[]),o===void 0&&(o="");let c=(f,_,x)=>{let a={relativePath:x===void 0?f.path||"":x,caseSensitive:f.caseSensitive===!0,childrenIndex:_,route:f};a.relativePath.startsWith("/")&&(to(a.relativePath.startsWith(o),'Absolute route path "'+a.relativePath+'" nested under path '+('"'+o+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),a.relativePath=a.relativePath.slice(o.length));let I=Cf([o,a.relativePath]),D=r.concat(a);f.children&&f.children.length>0&&(to(f.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+I+'".')),k7(f.children,e,D,I)),!(f.path==null&&!f.index)&&e.push({path:I,score:Fte(I,f.index),routesMeta:D})};return t.forEach((f,_)=>{var x;if(f.path===""||!((x=f.path)!=null&&x.includes("?")))c(f,_);else for(let a of D7(f.path))c(f,_,a)}),e}function D7(t){let e=t.split("/");if(e.length===0)return[];let[r,...o]=e,c=r.endsWith("?"),f=r.replace(/\?$/,"");if(o.length===0)return c?[f,""]:[f];let _=D7(o.join("/")),x=[];return x.push(..._.map(a=>a===""?f:[f,a].join("/"))),c&&x.push(..._),x.map(a=>t.startsWith("/")&&a===""?"/":a)}function Mte(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:Bte(e.routesMeta.map(o=>o.childrenIndex),r.routesMeta.map(o=>o.childrenIndex)))}const kte=/^:[\w-]+$/,Dte=3,Ote=2,Lte=1,zte=10,Nte=-2,Aj=t=>t==="*";function Fte(t,e){let r=t.split("/"),o=r.length;return r.some(Aj)&&(o+=Nte),e&&(o+=Ote),r.filter(c=>!Aj(c)).reduce((c,f)=>c+(kte.test(f)?Dte:f===""?Lte:zte),o)}function Bte(t,e){return t.length===e.length&&t.slice(0,-1).every((o,c)=>o===e[c])?t[t.length-1]-e[e.length-1]:0}function jte(t,e,r){let{routesMeta:o}=t,c={},f="/",_=[];for(let x=0;x<o.length;++x){let a=o[x],I=x===o.length-1,D=f==="/"?e:e.slice(f.length)||"/",O=Cj({path:a.relativePath,caseSensitive:a.caseSensitive,end:I},D),F=a.route;if(!O&&I&&r&&!o[o.length-1].route.index&&(O=Cj({path:a.relativePath,caseSensitive:a.caseSensitive,end:!1},D)),!O)return null;Object.assign(c,O.params),_.push({params:c,pathname:Cf([f,O.pathname]),pathnameBase:Wte(Cf([f,O.pathnameBase])),route:F}),O.pathnameBase!=="/"&&(f=Cf([f,O.pathnameBase]))}return _}function Cj(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,o]=Ute(t.path,t.caseSensitive,t.end),c=e.match(r);if(!c)return null;let f=c[0],_=f.replace(/(.)\/+$/,"$1"),x=c.slice(1);return{params:o.reduce((I,D,O)=>{let{paramName:F,isOptional:Z}=D;if(F==="*"){let ne=x[O]||"";_=f.slice(0,f.length-ne.length).replace(/(.)\/+$/,"$1")}const J=x[O];return Z&&!J?I[F]=void 0:I[F]=(J||"").replace(/%2F/g,"/"),I},{}),pathname:f,pathnameBase:_,pattern:t}}function Ute(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!0),M7(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let o=[],c="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(_,x,a)=>(o.push({paramName:x,isOptional:a!=null}),a?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(o.push({paramName:"*"}),c+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?c+="\\/*$":t!==""&&t!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,e?void 0:"i"),o]}function Vte(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return M7(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function xO(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,o=t.charAt(r);return o&&o!=="/"?null:t.slice(r)||"/"}function $te(t,e){e===void 0&&(e="/");let{pathname:r,search:o="",hash:c=""}=typeof t=="string"?Gy(t):t;return{pathname:r?r.startsWith("/")?r:Gte(r,e):e,search:Hte(o),hash:Zte(c)}}function Gte(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(c=>{c===".."?r.length>1&&r.pop():c!=="."&&r.push(c)}),r.length>1?r.join("/"):"/"}function HR(t,e,r,o){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(o)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function qte(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function O7(t,e){let r=qte(t);return e?r.map((o,c)=>c===r.length-1?o.pathname:o.pathnameBase):r.map(o=>o.pathnameBase)}function L7(t,e,r,o){o===void 0&&(o=!1);let c;typeof t=="string"?c=Gy(t):(c=c1({},t),to(!c.pathname||!c.pathname.includes("?"),HR("?","pathname","search",c)),to(!c.pathname||!c.pathname.includes("#"),HR("#","pathname","hash",c)),to(!c.search||!c.search.includes("#"),HR("#","search","hash",c)));let f=t===""||c.pathname==="",_=f?"/":c.pathname,x;if(_==null)x=r;else{let O=e.length-1;if(!o&&_.startsWith("..")){let F=_.split("/");for(;F[0]==="..";)F.shift(),O-=1;c.pathname=F.join("/")}x=O>=0?e[O]:"/"}let a=$te(c,x),I=_&&_!=="/"&&_.endsWith("/"),D=(f||_===".")&&r.endsWith("/");return!a.pathname.endsWith("/")&&(I||D)&&(a.pathname+="/"),a}const Cf=t=>t.join("/").replace(/\/\/+/g,"/"),Wte=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Hte=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Zte=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function Xte(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const z7=["post","put","patch","delete"];new Set(z7);const Kte=["get",...z7];new Set(Kte);/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function u1(){return u1=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},u1.apply(this,arguments)}const bO=ee.createContext(null),Yte=ee.createContext(null),Xm=ee.createContext(null),EI=ee.createContext(null),Km=ee.createContext({outlet:null,matches:[],isDataRoute:!1}),N7=ee.createContext(null);function Qte(t,e){let{relative:r}=e===void 0?{}:e;q1()||to(!1);let{basename:o,navigator:c}=ee.useContext(Xm),{hash:f,pathname:_,search:x}=B7(t,{relative:r}),a=_;return o!=="/"&&(a=_==="/"?o:Cf([o,_])),c.createHref({pathname:a,search:x,hash:f})}function q1(){return ee.useContext(EI)!=null}function SI(){return q1()||to(!1),ee.useContext(EI).location}function F7(t){ee.useContext(Xm).static||ee.useLayoutEffect(t)}function II(){let{isDataRoute:t}=ee.useContext(Km);return t?hne():Jte()}function Jte(){q1()||to(!1);let t=ee.useContext(bO),{basename:e,future:r,navigator:o}=ee.useContext(Xm),{matches:c}=ee.useContext(Km),{pathname:f}=SI(),_=JSON.stringify(O7(c,r.v7_relativeSplatPath)),x=ee.useRef(!1);return F7(()=>{x.current=!0}),ee.useCallback(function(I,D){if(D===void 0&&(D={}),!x.current)return;if(typeof I=="number"){o.go(I);return}let O=L7(I,JSON.parse(_),f,D.relative==="path");t==null&&e!=="/"&&(O.pathname=O.pathname==="/"?e:Cf([e,O.pathname])),(D.replace?o.replace:o.push)(O,D.state,D)},[e,o,_,f,t])}function B7(t,e){let{relative:r}=e===void 0?{}:e,{future:o}=ee.useContext(Xm),{matches:c}=ee.useContext(Km),{pathname:f}=SI(),_=JSON.stringify(O7(c,o.v7_relativeSplatPath));return ee.useMemo(()=>L7(t,JSON.parse(_),f,r==="path"),[t,_,f,r])}function ene(t,e){return tne(t,e)}function tne(t,e,r,o){q1()||to(!1);let{navigator:c}=ee.useContext(Xm),{matches:f}=ee.useContext(Km),_=f[f.length-1],x=_?_.params:{};_&&_.pathname;let a=_?_.pathnameBase:"/";_&&_.route;let I=SI(),D;if(e){var O;let se=typeof e=="string"?Gy(e):e;a==="/"||(O=se.pathname)!=null&&O.startsWith(a)||to(!1),D=se}else D=I;let F=D.pathname||"/",Z=F;if(a!=="/"){let se=a.replace(/^\//,"").split("/");Z="/"+F.replace(/^\//,"").split("/").slice(se.length).join("/")}let J=Pte(t,{pathname:Z}),ne=one(J&&J.map(se=>Object.assign({},se,{params:Object.assign({},x,se.params),pathname:Cf([a,c.encodeLocation?c.encodeLocation(se.pathname).pathname:se.pathname]),pathnameBase:se.pathnameBase==="/"?a:Cf([a,c.encodeLocation?c.encodeLocation(se.pathnameBase).pathname:se.pathnameBase])})),f,r,o);return e&&ne?ee.createElement(EI.Provider,{value:{location:u1({pathname:"/",search:"",hash:"",state:null,key:"default"},D),navigationType:pf.Pop}},ne):ne}function nne(){let t=une(),e=Xte(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,c={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ee.createElement(ee.Fragment,null,ee.createElement("h2",null,"Unexpected Application Error!"),ee.createElement("h3",{style:{fontStyle:"italic"}},e),r?ee.createElement("pre",{style:c},r):null,null)}const rne=ee.createElement(nne,null);class ine extends ee.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location||r.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:r.error,location:r.location,revalidation:e.revalidation||r.revalidation}}componentDidCatch(e,r){console.error("React Router caught the following error during render",e,r)}render(){return this.state.error!==void 0?ee.createElement(Km.Provider,{value:this.props.routeContext},ee.createElement(N7.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function sne(t){let{routeContext:e,match:r,children:o}=t,c=ee.useContext(bO);return c&&c.static&&c.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(c.staticContext._deepestRenderedBoundaryId=r.route.id),ee.createElement(Km.Provider,{value:e},o)}function one(t,e,r,o){var c;if(e===void 0&&(e=[]),r===void 0&&(r=null),o===void 0&&(o=null),t==null){var f;if(!r)return null;if(r.errors)t=r.matches;else if((f=o)!=null&&f.v7_partialHydration&&e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let _=t,x=(c=r)==null?void 0:c.errors;if(x!=null){let D=_.findIndex(O=>O.route.id&&(x==null?void 0:x[O.route.id])!==void 0);D>=0||to(!1),_=_.slice(0,Math.min(_.length,D+1))}let a=!1,I=-1;if(r&&o&&o.v7_partialHydration)for(let D=0;D<_.length;D++){let O=_[D];if((O.route.HydrateFallback||O.route.hydrateFallbackElement)&&(I=D),O.route.id){let{loaderData:F,errors:Z}=r,J=O.route.loader&&F[O.route.id]===void 0&&(!Z||Z[O.route.id]===void 0);if(O.route.lazy||J){a=!0,I>=0?_=_.slice(0,I+1):_=[_[0]];break}}}return _.reduceRight((D,O,F)=>{let Z,J=!1,ne=null,se=null;r&&(Z=x&&O.route.id?x[O.route.id]:void 0,ne=O.route.errorElement||rne,a&&(I<0&&F===0?(J=!0,se=null):I===F&&(J=!0,se=O.route.hydrateFallbackElement||null)));let W=e.concat(_.slice(0,F+1)),Q=()=>{let K;return Z?K=ne:J?K=se:O.route.Component?K=ee.createElement(O.route.Component,null):O.route.element?K=O.route.element:K=D,ee.createElement(sne,{match:O,routeContext:{outlet:D,matches:W,isDataRoute:r!=null},children:K})};return r&&(O.route.ErrorBoundary||O.route.errorElement||F===0)?ee.createElement(ine,{location:r.location,revalidation:r.revalidation,component:ne,error:Z,children:Q(),routeContext:{outlet:null,matches:W,isDataRoute:!0}}):Q()},null)}var j7=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(j7||{}),hS=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(hS||{});function ane(t){let e=ee.useContext(bO);return e||to(!1),e}function lne(t){let e=ee.useContext(Yte);return e||to(!1),e}function cne(t){let e=ee.useContext(Km);return e||to(!1),e}function U7(t){let e=cne(),r=e.matches[e.matches.length-1];return r.route.id||to(!1),r.route.id}function une(){var t;let e=ee.useContext(N7),r=lne(hS.UseRouteError),o=U7(hS.UseRouteError);return e!==void 0?e:(t=r.errors)==null?void 0:t[o]}function hne(){let{router:t}=ane(j7.UseNavigateStable),e=U7(hS.UseNavigateStable),r=ee.useRef(!1);return F7(()=>{r.current=!0}),ee.useCallback(function(c,f){f===void 0&&(f={}),r.current&&(typeof c=="number"?t.navigate(c):t.navigate(c,u1({fromRouteId:e},f)))},[t,e])}function C_(t){to(!1)}function dne(t){let{basename:e="/",children:r=null,location:o,navigationType:c=pf.Pop,navigator:f,static:_=!1,future:x}=t;q1()&&to(!1);let a=e.replace(/^\/*/,"/"),I=ee.useMemo(()=>({basename:a,navigator:f,static:_,future:u1({v7_relativeSplatPath:!1},x)}),[a,x,f,_]);typeof o=="string"&&(o=Gy(o));let{pathname:D="/",search:O="",hash:F="",state:Z=null,key:J="default"}=o,ne=ee.useMemo(()=>{let se=xO(D,a);return se==null?null:{location:{pathname:se,search:O,hash:F,state:Z,key:J},navigationType:c}},[a,D,O,F,Z,J,c]);return ne==null?null:ee.createElement(Xm.Provider,{value:I},ee.createElement(EI.Provider,{children:r,value:ne}))}function fne(t){let{children:e,location:r}=t;return ene(Fk(e),r)}new Promise(()=>{});function Fk(t,e){e===void 0&&(e=[]);let r=[];return ee.Children.forEach(t,(o,c)=>{if(!ee.isValidElement(o))return;let f=[...e,c];if(o.type===ee.Fragment){r.push.apply(r,Fk(o.props.children,f));return}o.type!==C_&&to(!1),!o.props.index||!o.props.children||to(!1);let _={id:o.props.id||f.join("-"),caseSensitive:o.props.caseSensitive,element:o.props.element,Component:o.props.Component,index:o.props.index,path:o.props.path,loader:o.props.loader,action:o.props.action,errorElement:o.props.errorElement,ErrorBoundary:o.props.ErrorBoundary,hasErrorBoundary:o.props.ErrorBoundary!=null||o.props.errorElement!=null,shouldRevalidate:o.props.shouldRevalidate,handle:o.props.handle,lazy:o.props.lazy};o.props.children&&(_.children=Fk(o.props.children,f)),r.push(_)}),r}/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Bk(){return Bk=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},Bk.apply(this,arguments)}function pne(t,e){if(t==null)return{};var r={},o=Object.keys(t),c,f;for(f=0;f<o.length;f++)c=o[f],!(e.indexOf(c)>=0)&&(r[c]=t[c]);return r}function mne(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function gne(t,e){return t.button===0&&(!e||e==="_self")&&!mne(t)}const _ne=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],yne="6";try{window.__reactRouterVersion=yne}catch{}const vne="startTransition",Pj=BE[vne];function xne(t){let{basename:e,children:r,future:o,window:c}=t,f=ee.useRef();f.current==null&&(f.current=Ite({window:c,v5Compat:!0}));let _=f.current,[x,a]=ee.useState({action:_.action,location:_.location}),{v7_startTransition:I}=o||{},D=ee.useCallback(O=>{I&&Pj?Pj(()=>a(O)):a(O)},[a,I]);return ee.useLayoutEffect(()=>_.listen(D),[_,D]),ee.createElement(dne,{basename:e,children:r,location:x.location,navigationType:x.action,navigator:_,future:o})}const bne=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",wne=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,V7=ee.forwardRef(function(e,r){let{onClick:o,relative:c,reloadDocument:f,replace:_,state:x,target:a,to:I,preventScrollReset:D,unstable_viewTransition:O}=e,F=pne(e,_ne),{basename:Z}=ee.useContext(Xm),J,ne=!1;if(typeof I=="string"&&wne.test(I)&&(J=I,bne))try{let K=new URL(window.location.href),pe=I.startsWith("//")?new URL(K.protocol+I):new URL(I),Te=xO(pe.pathname,Z);pe.origin===K.origin&&Te!=null?I=Te+pe.search+pe.hash:ne=!0}catch{}let se=Qte(I,{relative:c}),W=Tne(I,{replace:_,state:x,target:a,preventScrollReset:D,relative:c,unstable_viewTransition:O});function Q(K){o&&o(K),K.defaultPrevented||W(K)}return ee.createElement("a",Bk({},F,{href:J||se,onClick:ne||f?o:Q,ref:r,target:a}))});var Rj;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Rj||(Rj={}));var Mj;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(Mj||(Mj={}));function Tne(t,e){let{target:r,replace:o,state:c,preventScrollReset:f,relative:_,unstable_viewTransition:x}=e===void 0?{}:e,a=II(),I=SI(),D=B7(t,{relative:_});return ee.useCallback(O=>{if(gne(O,r)){O.preventDefault();let F=o!==void 0?o:uS(I)===uS(D);a(t,{replace:F,state:c,preventScrollReset:f,relative:_,unstable_viewTransition:x})}},[I,a,D,o,c,r,t,f,_,x])}var Ene=function(e){return Sne(e)&&!Ine(e)};function Sne(t){return!!t&&typeof t=="object"}function Ine(t){var e=Object.prototype.toString.call(t);return e==="[object RegExp]"||e==="[object Date]"||Pne(t)}var Ane=typeof Symbol=="function"&&Symbol.for,Cne=Ane?Symbol.for("react.element"):60103;function Pne(t){return t.$$typeof===Cne}function Rne(t){return Array.isArray(t)?[]:{}}function dS(t,e){return e.clone!==!1&&e.isMergeableObject(t)?h1(Rne(t),t,e):t}function Mne(t,e,r){return t.concat(e).map(function(o){return dS(o,r)})}function kne(t,e,r){var o={};return r.isMergeableObject(t)&&Object.keys(t).forEach(function(c){o[c]=dS(t[c],r)}),Object.keys(e).forEach(function(c){!r.isMergeableObject(e[c])||!t[c]?o[c]=dS(e[c],r):o[c]=h1(t[c],e[c],r)}),o}function h1(t,e,r){r=r||{},r.arrayMerge=r.arrayMerge||Mne,r.isMergeableObject=r.isMergeableObject||Ene;var o=Array.isArray(e),c=Array.isArray(t),f=o===c;return f?o?r.arrayMerge(t,e,r):kne(t,e,r):dS(e,r)}h1.all=function(e,r){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(o,c){return h1(o,c,r)},{})};var jk=h1,$7=typeof global=="object"&&global&&global.Object===Object&&global,Dne=typeof self=="object"&&self&&self.Object===Object&&self,Hu=$7||Dne||Function("return this")(),Nf=Hu.Symbol,G7=Object.prototype,One=G7.hasOwnProperty,Lne=G7.toString,Lv=Nf?Nf.toStringTag:void 0;function zne(t){var e=One.call(t,Lv),r=t[Lv];try{t[Lv]=void 0;var o=!0}catch{}var c=Lne.call(t);return o&&(e?t[Lv]=r:delete t[Lv]),c}var Nne=Object.prototype,Fne=Nne.toString;function Bne(t){return Fne.call(t)}var jne="[object Null]",Une="[object Undefined]",kj=Nf?Nf.toStringTag:void 0;function Ym(t){return t==null?t===void 0?Une:jne:kj&&kj in Object(t)?zne(t):Bne(t)}function q7(t,e){return function(r){return t(e(r))}}var wO=q7(Object.getPrototypeOf,Object);function Qm(t){return t!=null&&typeof t=="object"}var Vne="[object Object]",$ne=Function.prototype,Gne=Object.prototype,W7=$ne.toString,qne=Gne.hasOwnProperty,Wne=W7.call(Object);function Dj(t){if(!Qm(t)||Ym(t)!=Vne)return!1;var e=wO(t);if(e===null)return!0;var r=qne.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&W7.call(r)==Wne}function Hne(){this.__data__=[],this.size=0}function H7(t,e){return t===e||t!==t&&e!==e}function AI(t,e){for(var r=t.length;r--;)if(H7(t[r][0],e))return r;return-1}var Zne=Array.prototype,Xne=Zne.splice;function Kne(t){var e=this.__data__,r=AI(e,t);if(r<0)return!1;var o=e.length-1;return r==o?e.pop():Xne.call(e,r,1),--this.size,!0}function Yne(t){var e=this.__data__,r=AI(e,t);return r<0?void 0:e[r][1]}function Qne(t){return AI(this.__data__,t)>-1}function Jne(t,e){var r=this.__data__,o=AI(r,t);return o<0?(++this.size,r.push([t,e])):r[o][1]=e,this}function nd(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}nd.prototype.clear=Hne;nd.prototype.delete=Kne;nd.prototype.get=Yne;nd.prototype.has=Qne;nd.prototype.set=Jne;function ere(){this.__data__=new nd,this.size=0}function tre(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function nre(t){return this.__data__.get(t)}function rre(t){return this.__data__.has(t)}function W1(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var ire="[object AsyncFunction]",sre="[object Function]",ore="[object GeneratorFunction]",are="[object Proxy]";function Z7(t){if(!W1(t))return!1;var e=Ym(t);return e==sre||e==ore||e==ire||e==are}var ZR=Hu["__core-js_shared__"],Oj=function(){var t=/[^.]+$/.exec(ZR&&ZR.keys&&ZR.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function lre(t){return!!Oj&&Oj in t}var cre=Function.prototype,ure=cre.toString;function Jm(t){if(t!=null){try{return ure.call(t)}catch{}try{return t+""}catch{}}return""}var hre=/[\\^$.*+?()[\]{}|]/g,dre=/^\[object .+?Constructor\]$/,fre=Function.prototype,pre=Object.prototype,mre=fre.toString,gre=pre.hasOwnProperty,_re=RegExp("^"+mre.call(gre).replace(hre,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function yre(t){if(!W1(t)||lre(t))return!1;var e=Z7(t)?_re:dre;return e.test(Jm(t))}function vre(t,e){return t==null?void 0:t[e]}function eg(t,e){var r=vre(t,e);return yre(r)?r:void 0}var d1=eg(Hu,"Map"),f1=eg(Object,"create");function xre(){this.__data__=f1?f1(null):{},this.size=0}function bre(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var wre="__lodash_hash_undefined__",Tre=Object.prototype,Ere=Tre.hasOwnProperty;function Sre(t){var e=this.__data__;if(f1){var r=e[t];return r===wre?void 0:r}return Ere.call(e,t)?e[t]:void 0}var Ire=Object.prototype,Are=Ire.hasOwnProperty;function Cre(t){var e=this.__data__;return f1?e[t]!==void 0:Are.call(e,t)}var Pre="__lodash_hash_undefined__";function Rre(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=f1&&e===void 0?Pre:e,this}function Mm(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}Mm.prototype.clear=xre;Mm.prototype.delete=bre;Mm.prototype.get=Sre;Mm.prototype.has=Cre;Mm.prototype.set=Rre;function Mre(){this.size=0,this.__data__={hash:new Mm,map:new(d1||nd),string:new Mm}}function kre(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function CI(t,e){var r=t.__data__;return kre(e)?r[typeof e=="string"?"string":"hash"]:r.map}function Dre(t){var e=CI(this,t).delete(t);return this.size-=e?1:0,e}function Ore(t){return CI(this,t).get(t)}function Lre(t){return CI(this,t).has(t)}function zre(t,e){var r=CI(this,t),o=r.size;return r.set(t,e),this.size+=r.size==o?0:1,this}function Xf(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}Xf.prototype.clear=Mre;Xf.prototype.delete=Dre;Xf.prototype.get=Ore;Xf.prototype.has=Lre;Xf.prototype.set=zre;var Nre=200;function Fre(t,e){var r=this.__data__;if(r instanceof nd){var o=r.__data__;if(!d1||o.length<Nre-1)return o.push([t,e]),this.size=++r.size,this;r=this.__data__=new Xf(o)}return r.set(t,e),this.size=r.size,this}function qy(t){var e=this.__data__=new nd(t);this.size=e.size}qy.prototype.clear=ere;qy.prototype.delete=tre;qy.prototype.get=nre;qy.prototype.has=rre;qy.prototype.set=Fre;function Bre(t,e){for(var r=-1,o=t==null?0:t.length;++r<o&&e(t[r],r,t)!==!1;);return t}var Lj=function(){try{var t=eg(Object,"defineProperty");return t({},"",{}),t}catch{}}();function X7(t,e,r){e=="__proto__"&&Lj?Lj(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var jre=Object.prototype,Ure=jre.hasOwnProperty;function K7(t,e,r){var o=t[e];(!(Ure.call(t,e)&&H7(o,r))||r===void 0&&!(e in t))&&X7(t,e,r)}function PI(t,e,r,o){var c=!r;r||(r={});for(var f=-1,_=e.length;++f<_;){var x=e[f],a=void 0;a===void 0&&(a=t[x]),c?X7(r,x,a):K7(r,x,a)}return r}function Vre(t,e){for(var r=-1,o=Array(t);++r<t;)o[r]=e(r);return o}var $re="[object Arguments]";function zj(t){return Qm(t)&&Ym(t)==$re}var Y7=Object.prototype,Gre=Y7.hasOwnProperty,qre=Y7.propertyIsEnumerable,Wre=zj(function(){return arguments}())?zj:function(t){return Qm(t)&&Gre.call(t,"callee")&&!qre.call(t,"callee")},H1=Array.isArray;function Hre(){return!1}var Q7=typeof dl=="object"&&dl&&!dl.nodeType&&dl,Nj=Q7&&typeof fl=="object"&&fl&&!fl.nodeType&&fl,Zre=Nj&&Nj.exports===Q7,Fj=Zre?Hu.Buffer:void 0,Xre=Fj?Fj.isBuffer:void 0,J7=Xre||Hre,Kre=9007199254740991,Yre=/^(?:0|[1-9]\d*)$/;function Qre(t,e){var r=typeof t;return e=e??Kre,!!e&&(r=="number"||r!="symbol"&&Yre.test(t))&&t>-1&&t%1==0&&t<e}var Jre=9007199254740991;function eG(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Jre}var eie="[object Arguments]",tie="[object Array]",nie="[object Boolean]",rie="[object Date]",iie="[object Error]",sie="[object Function]",oie="[object Map]",aie="[object Number]",lie="[object Object]",cie="[object RegExp]",uie="[object Set]",hie="[object String]",die="[object WeakMap]",fie="[object ArrayBuffer]",pie="[object DataView]",mie="[object Float32Array]",gie="[object Float64Array]",_ie="[object Int8Array]",yie="[object Int16Array]",vie="[object Int32Array]",xie="[object Uint8Array]",bie="[object Uint8ClampedArray]",wie="[object Uint16Array]",Tie="[object Uint32Array]",ts={};ts[mie]=ts[gie]=ts[_ie]=ts[yie]=ts[vie]=ts[xie]=ts[bie]=ts[wie]=ts[Tie]=!0;ts[eie]=ts[tie]=ts[fie]=ts[nie]=ts[pie]=ts[rie]=ts[iie]=ts[sie]=ts[oie]=ts[aie]=ts[lie]=ts[cie]=ts[uie]=ts[hie]=ts[die]=!1;function Eie(t){return Qm(t)&&eG(t.length)&&!!ts[Ym(t)]}function TO(t){return function(e){return t(e)}}var tG=typeof dl=="object"&&dl&&!dl.nodeType&&dl,Tx=tG&&typeof fl=="object"&&fl&&!fl.nodeType&&fl,Sie=Tx&&Tx.exports===tG,XR=Sie&&$7.process,xy=function(){try{var t=Tx&&Tx.require&&Tx.require("util").types;return t||XR&&XR.binding&&XR.binding("util")}catch{}}(),Bj=xy&&xy.isTypedArray,Iie=Bj?TO(Bj):Eie,Aie=Object.prototype,Cie=Aie.hasOwnProperty;function nG(t,e){var r=H1(t),o=!r&&Wre(t),c=!r&&!o&&J7(t),f=!r&&!o&&!c&&Iie(t),_=r||o||c||f,x=_?Vre(t.length,String):[],a=x.length;for(var I in t)(e||Cie.call(t,I))&&!(_&&(I=="length"||c&&(I=="offset"||I=="parent")||f&&(I=="buffer"||I=="byteLength"||I=="byteOffset")||Qre(I,a)))&&x.push(I);return x}var Pie=Object.prototype;function EO(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||Pie;return t===r}var Rie=q7(Object.keys,Object),Mie=Object.prototype,kie=Mie.hasOwnProperty;function Die(t){if(!EO(t))return Rie(t);var e=[];for(var r in Object(t))kie.call(t,r)&&r!="constructor"&&e.push(r);return e}function rG(t){return t!=null&&eG(t.length)&&!Z7(t)}function SO(t){return rG(t)?nG(t):Die(t)}function Oie(t,e){return t&&PI(e,SO(e),t)}function Lie(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var zie=Object.prototype,Nie=zie.hasOwnProperty;function Fie(t){if(!W1(t))return Lie(t);var e=EO(t),r=[];for(var o in t)o=="constructor"&&(e||!Nie.call(t,o))||r.push(o);return r}function IO(t){return rG(t)?nG(t,!0):Fie(t)}function Bie(t,e){return t&&PI(e,IO(e),t)}var iG=typeof dl=="object"&&dl&&!dl.nodeType&&dl,jj=iG&&typeof fl=="object"&&fl&&!fl.nodeType&&fl,jie=jj&&jj.exports===iG,Uj=jie?Hu.Buffer:void 0,Vj=Uj?Uj.allocUnsafe:void 0;function Uie(t,e){if(e)return t.slice();var r=t.length,o=Vj?Vj(r):new t.constructor(r);return t.copy(o),o}function sG(t,e){var r=-1,o=t.length;for(e||(e=Array(o));++r<o;)e[r]=t[r];return e}function Vie(t,e){for(var r=-1,o=t==null?0:t.length,c=0,f=[];++r<o;){var _=t[r];e(_,r,t)&&(f[c++]=_)}return f}function oG(){return[]}var $ie=Object.prototype,Gie=$ie.propertyIsEnumerable,$j=Object.getOwnPropertySymbols,AO=$j?function(t){return t==null?[]:(t=Object(t),Vie($j(t),function(e){return Gie.call(t,e)}))}:oG;function qie(t,e){return PI(t,AO(t),e)}function aG(t,e){for(var r=-1,o=e.length,c=t.length;++r<o;)t[c+r]=e[r];return t}var Wie=Object.getOwnPropertySymbols,lG=Wie?function(t){for(var e=[];t;)aG(e,AO(t)),t=wO(t);return e}:oG;function Hie(t,e){return PI(t,lG(t),e)}function cG(t,e,r){var o=e(t);return H1(t)?o:aG(o,r(t))}function Zie(t){return cG(t,SO,AO)}function Xie(t){return cG(t,IO,lG)}var Uk=eg(Hu,"DataView"),Vk=eg(Hu,"Promise"),$k=eg(Hu,"Set"),Gk=eg(Hu,"WeakMap"),Gj="[object Map]",Kie="[object Object]",qj="[object Promise]",Wj="[object Set]",Hj="[object WeakMap]",Zj="[object DataView]",Yie=Jm(Uk),Qie=Jm(d1),Jie=Jm(Vk),ese=Jm($k),tse=Jm(Gk),kh=Ym;(Uk&&kh(new Uk(new ArrayBuffer(1)))!=Zj||d1&&kh(new d1)!=Gj||Vk&&kh(Vk.resolve())!=qj||$k&&kh(new $k)!=Wj||Gk&&kh(new Gk)!=Hj)&&(kh=function(t){var e=Ym(t),r=e==Kie?t.constructor:void 0,o=r?Jm(r):"";if(o)switch(o){case Yie:return Zj;case Qie:return Gj;case Jie:return qj;case ese:return Wj;case tse:return Hj}return e});var nse=Object.prototype,rse=nse.hasOwnProperty;function ise(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&rse.call(t,"index")&&(r.index=t.index,r.input=t.input),r}var Xj=Hu.Uint8Array;function CO(t){var e=new t.constructor(t.byteLength);return new Xj(e).set(new Xj(t)),e}function sse(t,e){var r=e?CO(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}var ose=/\w*$/;function ase(t){var e=new t.constructor(t.source,ose.exec(t));return e.lastIndex=t.lastIndex,e}var Kj=Nf?Nf.prototype:void 0,Yj=Kj?Kj.valueOf:void 0;function lse(t){return Yj?Object(Yj.call(t)):{}}function cse(t,e){var r=e?CO(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var use="[object Boolean]",hse="[object Date]",dse="[object Map]",fse="[object Number]",pse="[object RegExp]",mse="[object Set]",gse="[object String]",_se="[object Symbol]",yse="[object ArrayBuffer]",vse="[object DataView]",xse="[object Float32Array]",bse="[object Float64Array]",wse="[object Int8Array]",Tse="[object Int16Array]",Ese="[object Int32Array]",Sse="[object Uint8Array]",Ise="[object Uint8ClampedArray]",Ase="[object Uint16Array]",Cse="[object Uint32Array]";function Pse(t,e,r){var o=t.constructor;switch(e){case yse:return CO(t);case use:case hse:return new o(+t);case vse:return sse(t,r);case xse:case bse:case wse:case Tse:case Ese:case Sse:case Ise:case Ase:case Cse:return cse(t,r);case dse:return new o;case fse:case gse:return new o(t);case pse:return ase(t);case mse:return new o;case _se:return lse(t)}}var Qj=Object.create,Rse=function(){function t(){}return function(e){if(!W1(e))return{};if(Qj)return Qj(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();function Mse(t){return typeof t.constructor=="function"&&!EO(t)?Rse(wO(t)):{}}var kse="[object Map]";function Dse(t){return Qm(t)&&kh(t)==kse}var Jj=xy&&xy.isMap,Ose=Jj?TO(Jj):Dse,Lse="[object Set]";function zse(t){return Qm(t)&&kh(t)==Lse}var eU=xy&&xy.isSet,Nse=eU?TO(eU):zse,Fse=1,Bse=2,jse=4,uG="[object Arguments]",Use="[object Array]",Vse="[object Boolean]",$se="[object Date]",Gse="[object Error]",hG="[object Function]",qse="[object GeneratorFunction]",Wse="[object Map]",Hse="[object Number]",dG="[object Object]",Zse="[object RegExp]",Xse="[object Set]",Kse="[object String]",Yse="[object Symbol]",Qse="[object WeakMap]",Jse="[object ArrayBuffer]",eoe="[object DataView]",toe="[object Float32Array]",noe="[object Float64Array]",roe="[object Int8Array]",ioe="[object Int16Array]",soe="[object Int32Array]",ooe="[object Uint8Array]",aoe="[object Uint8ClampedArray]",loe="[object Uint16Array]",coe="[object Uint32Array]",Hi={};Hi[uG]=Hi[Use]=Hi[Jse]=Hi[eoe]=Hi[Vse]=Hi[$se]=Hi[toe]=Hi[noe]=Hi[roe]=Hi[ioe]=Hi[soe]=Hi[Wse]=Hi[Hse]=Hi[dG]=Hi[Zse]=Hi[Xse]=Hi[Kse]=Hi[Yse]=Hi[ooe]=Hi[aoe]=Hi[loe]=Hi[coe]=!0;Hi[Gse]=Hi[hG]=Hi[Qse]=!1;function Ex(t,e,r,o,c,f){var _,x=e&Fse,a=e&Bse,I=e&jse;if(_!==void 0)return _;if(!W1(t))return t;var D=H1(t);if(D){if(_=ise(t),!x)return sG(t,_)}else{var O=kh(t),F=O==hG||O==qse;if(J7(t))return Uie(t,x);if(O==dG||O==uG||F&&!c){if(_=a||F?{}:Mse(t),!x)return a?Hie(t,Bie(_,t)):qie(t,Oie(_,t))}else{if(!Hi[O])return c?t:{};_=Pse(t,O,x)}}f||(f=new qy);var Z=f.get(t);if(Z)return Z;f.set(t,_),Nse(t)?t.forEach(function(se){_.add(Ex(se,e,r,se,t,f))}):Ose(t)&&t.forEach(function(se,W){_.set(W,Ex(se,e,r,W,t,f))});var J=I?a?Xie:Zie:a?IO:SO,ne=D?void 0:J(t);return Bre(ne||t,function(se,W){ne&&(W=se,se=t[W]),K7(_,W,Ex(se,e,r,W,t,f))}),_}var uoe=1,hoe=4;function Qv(t){return Ex(t,uoe|hoe)}var tU=Array.isArray,nU=Object.keys,doe=Object.prototype.hasOwnProperty,foe=typeof Element<"u";function qk(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var r=tU(t),o=tU(e),c,f,_;if(r&&o){if(f=t.length,f!=e.length)return!1;for(c=f;c--!==0;)if(!qk(t[c],e[c]))return!1;return!0}if(r!=o)return!1;var x=t instanceof Date,a=e instanceof Date;if(x!=a)return!1;if(x&&a)return t.getTime()==e.getTime();var I=t instanceof RegExp,D=e instanceof RegExp;if(I!=D)return!1;if(I&&D)return t.toString()==e.toString();var O=nU(t);if(f=O.length,f!==nU(e).length)return!1;for(c=f;c--!==0;)if(!doe.call(e,O[c]))return!1;if(foe&&t instanceof Element&&e instanceof Element)return t===e;for(c=f;c--!==0;)if(_=O[c],!(_==="_owner"&&t.$$typeof)&&!qk(t[_],e[_]))return!1;return!0}return t!==t&&e!==e}var poe=function(e,r){try{return qk(e,r)}catch(o){if(o.message&&o.message.match(/stack|recursion/i)||o.number===-2146828260)return console.warn("Warning: react-fast-compare does not handle circular references.",o.name,o.message),!1;throw o}};const rf=Wm(poe);var moe=4;function rU(t){return Ex(t,moe)}function fG(t,e){for(var r=-1,o=t==null?0:t.length,c=Array(o);++r<o;)c[r]=e(t[r],r,t);return c}var goe="[object Symbol]";function PO(t){return typeof t=="symbol"||Qm(t)&&Ym(t)==goe}var _oe="Expected a function";function RO(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(_oe);var r=function(){var o=arguments,c=e?e.apply(this,o):o[0],f=r.cache;if(f.has(c))return f.get(c);var _=t.apply(this,o);return r.cache=f.set(c,_)||f,_};return r.cache=new(RO.Cache||Xf),r}RO.Cache=Xf;var yoe=500;function voe(t){var e=RO(t,function(o){return r.size===yoe&&r.clear(),o}),r=e.cache;return e}var xoe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,boe=/\\(\\)?/g,woe=voe(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(xoe,function(r,o,c,f){e.push(c?f.replace(boe,"$1"):o||r)}),e}),Toe=1/0;function Eoe(t){if(typeof t=="string"||PO(t))return t;var e=t+"";return e=="0"&&1/t==-Toe?"-0":e}var Soe=1/0,iU=Nf?Nf.prototype:void 0,sU=iU?iU.toString:void 0;function pG(t){if(typeof t=="string")return t;if(H1(t))return fG(t,pG)+"";if(PO(t))return sU?sU.call(t):"";var e=t+"";return e=="0"&&1/t==-Soe?"-0":e}function Ioe(t){return t==null?"":pG(t)}function mG(t){return H1(t)?fG(t,Eoe):PO(t)?[t]:sG(woe(Ioe(t)))}var gG={exports:{}},Ri={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Io=typeof Symbol=="function"&&Symbol.for,MO=Io?Symbol.for("react.element"):60103,kO=Io?Symbol.for("react.portal"):60106,RI=Io?Symbol.for("react.fragment"):60107,MI=Io?Symbol.for("react.strict_mode"):60108,kI=Io?Symbol.for("react.profiler"):60114,DI=Io?Symbol.for("react.provider"):60109,OI=Io?Symbol.for("react.context"):60110,DO=Io?Symbol.for("react.async_mode"):60111,LI=Io?Symbol.for("react.concurrent_mode"):60111,zI=Io?Symbol.for("react.forward_ref"):60112,NI=Io?Symbol.for("react.suspense"):60113,Aoe=Io?Symbol.for("react.suspense_list"):60120,FI=Io?Symbol.for("react.memo"):60115,BI=Io?Symbol.for("react.lazy"):60116,Coe=Io?Symbol.for("react.block"):60121,Poe=Io?Symbol.for("react.fundamental"):60117,Roe=Io?Symbol.for("react.responder"):60118,Moe=Io?Symbol.for("react.scope"):60119;function wl(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case MO:switch(t=t.type,t){case DO:case LI:case RI:case kI:case MI:case NI:return t;default:switch(t=t&&t.$$typeof,t){case OI:case zI:case BI:case FI:case DI:return t;default:return e}}case kO:return e}}}function _G(t){return wl(t)===LI}Ri.AsyncMode=DO;Ri.ConcurrentMode=LI;Ri.ContextConsumer=OI;Ri.ContextProvider=DI;Ri.Element=MO;Ri.ForwardRef=zI;Ri.Fragment=RI;Ri.Lazy=BI;Ri.Memo=FI;Ri.Portal=kO;Ri.Profiler=kI;Ri.StrictMode=MI;Ri.Suspense=NI;Ri.isAsyncMode=function(t){return _G(t)||wl(t)===DO};Ri.isConcurrentMode=_G;Ri.isContextConsumer=function(t){return wl(t)===OI};Ri.isContextProvider=function(t){return wl(t)===DI};Ri.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===MO};Ri.isForwardRef=function(t){return wl(t)===zI};Ri.isFragment=function(t){return wl(t)===RI};Ri.isLazy=function(t){return wl(t)===BI};Ri.isMemo=function(t){return wl(t)===FI};Ri.isPortal=function(t){return wl(t)===kO};Ri.isProfiler=function(t){return wl(t)===kI};Ri.isStrictMode=function(t){return wl(t)===MI};Ri.isSuspense=function(t){return wl(t)===NI};Ri.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===RI||t===LI||t===kI||t===MI||t===NI||t===Aoe||typeof t=="object"&&t!==null&&(t.$$typeof===BI||t.$$typeof===FI||t.$$typeof===DI||t.$$typeof===OI||t.$$typeof===zI||t.$$typeof===Poe||t.$$typeof===Roe||t.$$typeof===Moe||t.$$typeof===Coe)};Ri.typeOf=wl;gG.exports=Ri;var koe=gG.exports,OO=koe,Doe={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},Ooe={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},Loe={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},yG={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},LO={};LO[OO.ForwardRef]=Loe;LO[OO.Memo]=yG;function oU(t){return OO.isMemo(t)?yG:LO[t.$$typeof]||Doe}var zoe=Object.defineProperty,Noe=Object.getOwnPropertyNames,aU=Object.getOwnPropertySymbols,Foe=Object.getOwnPropertyDescriptor,Boe=Object.getPrototypeOf,lU=Object.prototype;function vG(t,e,r){if(typeof e!="string"){if(lU){var o=Boe(e);o&&o!==lU&&vG(t,o,r)}var c=Noe(e);aU&&(c=c.concat(aU(e)));for(var f=oU(t),_=oU(e),x=0;x<c.length;++x){var a=c[x];if(!Ooe[a]&&!(r&&r[a])&&!(_&&_[a])&&!(f&&f[a])){var I=Foe(e,a);try{zoe(t,a,I)}catch{}}}}return t}var joe=vG;const Uoe=Wm(joe);function Ci(){return Ci=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},Ci.apply(this,arguments)}function xG(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function mf(t,e){if(t==null)return{};var r={},o=Object.keys(t),c,f;for(f=0;f<o.length;f++)c=o[f],!(e.indexOf(c)>=0)&&(r[c]=t[c]);return r}function cU(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var jI=ee.createContext(void 0);jI.displayName="FormikContext";var Voe=jI.Provider,$oe=jI.Consumer;function bG(){var t=ee.useContext(jI);return t}var uU=function(e){return Array.isArray(e)&&e.length===0},Mo=function(e){return typeof e=="function"},Z1=function(e){return e!==null&&typeof e=="object"},Goe=function(e){return String(Math.floor(Number(e)))===e},KR=function(e){return Object.prototype.toString.call(e)==="[object String]"},wG=function(e){return ee.Children.count(e)===0},YR=function(e){return Z1(e)&&Mo(e.then)};function gs(t,e,r,o){o===void 0&&(o=0);for(var c=mG(e);t&&o<c.length;)t=t[c[o++]];return o!==c.length&&!t||t===void 0?r:t}function Nu(t,e,r){for(var o=rU(t),c=o,f=0,_=mG(e);f<_.length-1;f++){var x=_[f],a=gs(t,_.slice(0,f+1));if(a&&(Z1(a)||Array.isArray(a)))c=c[x]=rU(a);else{var I=_[f+1];c=c[x]=Goe(I)&&Number(I)>=0?[]:{}}}return(f===0?t:c)[_[f]]===r?t:(r===void 0?delete c[_[f]]:c[_[f]]=r,f===0&&r===void 0&&delete o[_[f]],o)}function TG(t,e,r,o){r===void 0&&(r=new WeakMap),o===void 0&&(o={});for(var c=0,f=Object.keys(t);c<f.length;c++){var _=f[c],x=t[_];Z1(x)?r.get(x)||(r.set(x,!0),o[_]=Array.isArray(x)?[]:{},TG(x,e,r,o[_])):o[_]=e}return o}function qoe(t,e){switch(e.type){case"SET_VALUES":return Ci({},t,{values:e.payload});case"SET_TOUCHED":return Ci({},t,{touched:e.payload});case"SET_ERRORS":return rf(t.errors,e.payload)?t:Ci({},t,{errors:e.payload});case"SET_STATUS":return Ci({},t,{status:e.payload});case"SET_ISSUBMITTING":return Ci({},t,{isSubmitting:e.payload});case"SET_ISVALIDATING":return Ci({},t,{isValidating:e.payload});case"SET_FIELD_VALUE":return Ci({},t,{values:Nu(t.values,e.payload.field,e.payload.value)});case"SET_FIELD_TOUCHED":return Ci({},t,{touched:Nu(t.touched,e.payload.field,e.payload.value)});case"SET_FIELD_ERROR":return Ci({},t,{errors:Nu(t.errors,e.payload.field,e.payload.value)});case"RESET_FORM":return Ci({},t,e.payload);case"SET_FORMIK_STATE":return e.payload(t);case"SUBMIT_ATTEMPT":return Ci({},t,{touched:TG(t.values,!0),isSubmitting:!0,submitCount:t.submitCount+1});case"SUBMIT_FAILURE":return Ci({},t,{isSubmitting:!1});case"SUBMIT_SUCCESS":return Ci({},t,{isSubmitting:!1});default:return t}}var Qp={},OT={};function Woe(t){var e=t.validateOnChange,r=e===void 0?!0:e,o=t.validateOnBlur,c=o===void 0?!0:o,f=t.validateOnMount,_=f===void 0?!1:f,x=t.isInitialValid,a=t.enableReinitialize,I=a===void 0?!1:a,D=t.onSubmit,O=mf(t,["validateOnChange","validateOnBlur","validateOnMount","isInitialValid","enableReinitialize","onSubmit"]),F=Ci({validateOnChange:r,validateOnBlur:c,validateOnMount:_,onSubmit:D},O),Z=ee.useRef(F.initialValues),J=ee.useRef(F.initialErrors||Qp),ne=ee.useRef(F.initialTouched||OT),se=ee.useRef(F.initialStatus),W=ee.useRef(!1),Q=ee.useRef({});ee.useEffect(function(){return W.current=!0,function(){W.current=!1}},[]);var K=ee.useState(0),pe=K[1],Te=ee.useRef({values:Qv(F.initialValues),errors:Qv(F.initialErrors)||Qp,touched:Qv(F.initialTouched)||OT,status:Qv(F.initialStatus),isSubmitting:!1,isValidating:!1,submitCount:0}),we=Te.current,oe=ee.useCallback(function(it){var pt=Te.current;Te.current=qoe(pt,it),pt!==Te.current&&pe(function(Jt){return Jt+1})},[]),de=ee.useCallback(function(it,pt){return new Promise(function(Jt,In){var en=F.validate(it,pt);en==null?Jt(Qp):YR(en)?en.then(function(Ye){Jt(Ye||Qp)},function(Ye){In(Ye)}):Jt(en)})},[F.validate]),X=ee.useCallback(function(it,pt){var Jt=F.validationSchema,In=Mo(Jt)?Jt(pt):Jt,en=pt&&In.validateAt?In.validateAt(pt,it):Zoe(it,In);return new Promise(function(Ye,Rt){en.then(function(){Ye(Qp)},function(bn){bn.name==="ValidationError"?Ye(Hoe(bn)):Rt(bn)})})},[F.validationSchema]),ge=ee.useCallback(function(it,pt){return new Promise(function(Jt){return Jt(Q.current[it].validate(pt))})},[]),be=ee.useCallback(function(it){var pt=Object.keys(Q.current).filter(function(In){return Mo(Q.current[In].validate)}),Jt=pt.length>0?pt.map(function(In){return ge(In,gs(it,In))}):[Promise.resolve("DO_NOT_DELETE_YOU_WILL_BE_FIRED")];return Promise.all(Jt).then(function(In){return In.reduce(function(en,Ye,Rt){return Ye==="DO_NOT_DELETE_YOU_WILL_BE_FIRED"||Ye&&(en=Nu(en,pt[Rt],Ye)),en},{})})},[ge]),ke=ee.useCallback(function(it){return Promise.all([be(it),F.validationSchema?X(it):{},F.validate?de(it):{}]).then(function(pt){var Jt=pt[0],In=pt[1],en=pt[2],Ye=jk.all([Jt,In,en],{arrayMerge:Xoe});return Ye})},[F.validate,F.validationSchema,be,de,X]),Ee=Nl(function(it){return it===void 0&&(it=we.values),oe({type:"SET_ISVALIDATING",payload:!0}),ke(it).then(function(pt){return W.current&&(oe({type:"SET_ISVALIDATING",payload:!1}),oe({type:"SET_ERRORS",payload:pt})),pt})});ee.useEffect(function(){_&&W.current===!0&&rf(Z.current,F.initialValues)&&Ee(Z.current)},[_,Ee]);var Lt=ee.useCallback(function(it){var pt=it&&it.values?it.values:Z.current,Jt=it&&it.errors?it.errors:J.current?J.current:F.initialErrors||{},In=it&&it.touched?it.touched:ne.current?ne.current:F.initialTouched||{},en=it&&it.status?it.status:se.current?se.current:F.initialStatus;Z.current=pt,J.current=Jt,ne.current=In,se.current=en;var Ye=function(){oe({type:"RESET_FORM",payload:{isSubmitting:!!it&&!!it.isSubmitting,errors:Jt,touched:In,status:en,values:pt,isValidating:!!it&&!!it.isValidating,submitCount:it&&it.submitCount&&typeof it.submitCount=="number"?it.submitCount:0}})};if(F.onReset){var Rt=F.onReset(we.values,rr);YR(Rt)?Rt.then(Ye):Ye()}else Ye()},[F.initialErrors,F.initialStatus,F.initialTouched,F.onReset]);ee.useEffect(function(){W.current===!0&&!rf(Z.current,F.initialValues)&&I&&(Z.current=F.initialValues,Lt(),_&&Ee(Z.current))},[I,F.initialValues,Lt,_,Ee]),ee.useEffect(function(){I&&W.current===!0&&!rf(J.current,F.initialErrors)&&(J.current=F.initialErrors||Qp,oe({type:"SET_ERRORS",payload:F.initialErrors||Qp}))},[I,F.initialErrors]),ee.useEffect(function(){I&&W.current===!0&&!rf(ne.current,F.initialTouched)&&(ne.current=F.initialTouched||OT,oe({type:"SET_TOUCHED",payload:F.initialTouched||OT}))},[I,F.initialTouched]),ee.useEffect(function(){I&&W.current===!0&&!rf(se.current,F.initialStatus)&&(se.current=F.initialStatus,oe({type:"SET_STATUS",payload:F.initialStatus}))},[I,F.initialStatus,F.initialTouched]);var jt=Nl(function(it){if(Q.current[it]&&Mo(Q.current[it].validate)){var pt=gs(we.values,it),Jt=Q.current[it].validate(pt);return YR(Jt)?(oe({type:"SET_ISVALIDATING",payload:!0}),Jt.then(function(In){return In}).then(function(In){oe({type:"SET_FIELD_ERROR",payload:{field:it,value:In}}),oe({type:"SET_ISVALIDATING",payload:!1})})):(oe({type:"SET_FIELD_ERROR",payload:{field:it,value:Jt}}),Promise.resolve(Jt))}else if(F.validationSchema)return oe({type:"SET_ISVALIDATING",payload:!0}),X(we.values,it).then(function(In){return In}).then(function(In){oe({type:"SET_FIELD_ERROR",payload:{field:it,value:gs(In,it)}}),oe({type:"SET_ISVALIDATING",payload:!1})});return Promise.resolve()}),Qt=ee.useCallback(function(it,pt){var Jt=pt.validate;Q.current[it]={validate:Jt}},[]),Pt=ee.useCallback(function(it){delete Q.current[it]},[]),lt=Nl(function(it,pt){oe({type:"SET_TOUCHED",payload:it});var Jt=pt===void 0?c:pt;return Jt?Ee(we.values):Promise.resolve()}),At=ee.useCallback(function(it){oe({type:"SET_ERRORS",payload:it})},[]),nn=Nl(function(it,pt){var Jt=Mo(it)?it(we.values):it;oe({type:"SET_VALUES",payload:Jt});var In=pt===void 0?r:pt;return In?Ee(Jt):Promise.resolve()}),fn=ee.useCallback(function(it,pt){oe({type:"SET_FIELD_ERROR",payload:{field:it,value:pt}})},[]),mn=Nl(function(it,pt,Jt){oe({type:"SET_FIELD_VALUE",payload:{field:it,value:pt}});var In=Jt===void 0?r:Jt;return In?Ee(Nu(we.values,it,pt)):Promise.resolve()}),Vt=ee.useCallback(function(it,pt){var Jt=pt,In=it,en;if(!KR(it)){it.persist&&it.persist();var Ye=it.target?it.target:it.currentTarget,Rt=Ye.type,bn=Ye.name,Pn=Ye.id,gn=Ye.value,er=Ye.checked,Ur=Ye.outerHTML,hn=Ye.options,Rn=Ye.multiple;Jt=pt||bn||Pn,In=/number|range/.test(Rt)?(en=parseFloat(gn),isNaN(en)?"":en):/checkbox/.test(Rt)?Yoe(gs(we.values,Jt),er,gn):hn&&Rn?Koe(hn):gn}Jt&&mn(Jt,In)},[mn,we.values]),wn=Nl(function(it){if(KR(it))return function(pt){return Vt(pt,it)};Vt(it)}),Ht=Nl(function(it,pt,Jt){pt===void 0&&(pt=!0),oe({type:"SET_FIELD_TOUCHED",payload:{field:it,value:pt}});var In=Jt===void 0?c:Jt;return In?Ee(we.values):Promise.resolve()}),Hn=ee.useCallback(function(it,pt){it.persist&&it.persist();var Jt=it.target,In=Jt.name,en=Jt.id,Ye=Jt.outerHTML,Rt=pt||In||en;Ht(Rt,!0)},[Ht]),Jn=Nl(function(it){if(KR(it))return function(pt){return Hn(pt,it)};Hn(it)}),ir=ee.useCallback(function(it){Mo(it)?oe({type:"SET_FORMIK_STATE",payload:it}):oe({type:"SET_FORMIK_STATE",payload:function(){return it}})},[]),Zt=ee.useCallback(function(it){oe({type:"SET_STATUS",payload:it})},[]),zt=ee.useCallback(function(it){oe({type:"SET_ISSUBMITTING",payload:it})},[]),qt=Nl(function(){return oe({type:"SUBMIT_ATTEMPT"}),Ee().then(function(it){var pt=it instanceof Error,Jt=!pt&&Object.keys(it).length===0;if(Jt){var In;try{if(In=Gn(),In===void 0)return}catch(en){throw en}return Promise.resolve(In).then(function(en){return W.current&&oe({type:"SUBMIT_SUCCESS"}),en}).catch(function(en){if(W.current)throw oe({type:"SUBMIT_FAILURE"}),en})}else if(W.current&&(oe({type:"SUBMIT_FAILURE"}),pt))throw it})}),xn=Nl(function(it){it&&it.preventDefault&&Mo(it.preventDefault)&&it.preventDefault(),it&&it.stopPropagation&&Mo(it.stopPropagation)&&it.stopPropagation(),qt().catch(function(pt){console.warn("Warning: An unhandled error was caught from submitForm()",pt)})}),rr={resetForm:Lt,validateForm:Ee,validateField:jt,setErrors:At,setFieldError:fn,setFieldTouched:Ht,setFieldValue:mn,setStatus:Zt,setSubmitting:zt,setTouched:lt,setValues:nn,setFormikState:ir,submitForm:qt},Gn=Nl(function(){return D(we.values,rr)}),yr=Nl(function(it){it&&it.preventDefault&&Mo(it.preventDefault)&&it.preventDefault(),it&&it.stopPropagation&&Mo(it.stopPropagation)&&it.stopPropagation(),Lt()}),Gr=ee.useCallback(function(it){return{value:gs(we.values,it),error:gs(we.errors,it),touched:!!gs(we.touched,it),initialValue:gs(Z.current,it),initialTouched:!!gs(ne.current,it),initialError:gs(J.current,it)}},[we.errors,we.touched,we.values]),mr=ee.useCallback(function(it){return{setValue:function(Jt,In){return mn(it,Jt,In)},setTouched:function(Jt,In){return Ht(it,Jt,In)},setError:function(Jt){return fn(it,Jt)}}},[mn,Ht,fn]),wr=ee.useCallback(function(it){var pt=Z1(it),Jt=pt?it.name:it,In=gs(we.values,Jt),en={name:Jt,value:In,onChange:wn,onBlur:Jn};if(pt){var Ye=it.type,Rt=it.value,bn=it.as,Pn=it.multiple;Ye==="checkbox"?Rt===void 0?en.checked=!!In:(en.checked=!!(Array.isArray(In)&&~In.indexOf(Rt)),en.value=Rt):Ye==="radio"?(en.checked=In===Rt,en.value=Rt):bn==="select"&&Pn&&(en.value=en.value||[],en.multiple=!0)}return en},[Jn,wn,we.values]),wt=ee.useMemo(function(){return!rf(Z.current,we.values)},[Z.current,we.values]),St=ee.useMemo(function(){return typeof x<"u"?wt?we.errors&&Object.keys(we.errors).length===0:x!==!1&&Mo(x)?x(F):x:we.errors&&Object.keys(we.errors).length===0},[x,wt,we.errors,F]),Ct=Ci({},we,{initialValues:Z.current,initialErrors:J.current,initialTouched:ne.current,initialStatus:se.current,handleBlur:Jn,handleChange:wn,handleReset:yr,handleSubmit:xn,resetForm:Lt,setErrors:At,setFormikState:ir,setFieldTouched:Ht,setFieldValue:mn,setFieldError:fn,setStatus:Zt,setSubmitting:zt,setTouched:lt,setValues:nn,submitForm:qt,validateForm:Ee,validateField:jt,isValid:St,dirty:wt,unregisterField:Pt,registerField:Qt,getFieldProps:wr,getFieldMeta:Gr,getFieldHelpers:mr,validateOnBlur:c,validateOnChange:r,validateOnMount:_});return Ct}function EG(t){var e=Woe(t),r=t.component,o=t.children,c=t.render,f=t.innerRef;return ee.useImperativeHandle(f,function(){return e}),ee.createElement(Voe,{value:e},r?ee.createElement(r,e):c?c(e):o?Mo(o)?o(e):wG(o)?null:ee.Children.only(o):null)}function Hoe(t){var e={};if(t.inner){if(t.inner.length===0)return Nu(e,t.path,t.message);for(var c=t.inner,r=Array.isArray(c),o=0,c=r?c:c[Symbol.iterator]();;){var f;if(r){if(o>=c.length)break;f=c[o++]}else{if(o=c.next(),o.done)break;f=o.value}var _=f;gs(e,_.path)||(e=Nu(e,_.path,_.message))}}return e}function Zoe(t,e,r,o){r===void 0&&(r=!1);var c=Wk(t);return e[r?"validateSync":"validate"](c,{abortEarly:!1,context:c})}function Wk(t){var e=Array.isArray(t)?[]:{};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var o=String(r);Array.isArray(t[o])===!0?e[o]=t[o].map(function(c){return Array.isArray(c)===!0||Dj(c)?Wk(c):c!==""?c:void 0}):Dj(t[o])?e[o]=Wk(t[o]):e[o]=t[o]!==""?t[o]:void 0}return e}function Xoe(t,e,r){var o=t.slice();return e.forEach(function(f,_){if(typeof o[_]>"u"){var x=r.clone!==!1,a=x&&r.isMergeableObject(f);o[_]=a?jk(Array.isArray(f)?[]:{},f,r):f}else r.isMergeableObject(f)?o[_]=jk(t[_],f,r):t.indexOf(f)===-1&&o.push(f)}),o}function Koe(t){return Array.from(t).filter(function(e){return e.selected}).map(function(e){return e.value})}function Yoe(t,e,r){if(typeof t=="boolean")return!!e;var o=[],c=!1,f=-1;if(Array.isArray(t))o=t,f=t.indexOf(r),c=f>=0;else if(!r||r=="true"||r=="false")return!!e;return e&&r&&!c?o.concat(r):c?o.slice(0,f).concat(o.slice(f+1)):o}var Qoe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?ee.useLayoutEffect:ee.useEffect;function Nl(t){var e=ee.useRef(t);return Qoe(function(){e.current=t}),ee.useCallback(function(){for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return e.current.apply(void 0,o)},[])}function Sx(t){var e=t.validate,r=t.name,o=t.render,c=t.children,f=t.as,_=t.component,x=t.className,a=mf(t,["validate","name","render","children","as","component","className"]),I=bG(),D=mf(I,["validate","validationSchema"]),O=D.registerField,F=D.unregisterField;ee.useEffect(function(){return O(r,{validate:e}),function(){F(r)}},[O,F,r,e]);var Z=D.getFieldProps(Ci({name:r},a)),J=D.getFieldMeta(r),ne={field:Z,form:D};if(o)return o(Ci({},ne,{meta:J}));if(Mo(c))return c(Ci({},ne,{meta:J}));if(_){if(typeof _=="string"){var se=a.innerRef,W=mf(a,["innerRef"]);return ee.createElement(_,Ci({ref:se},Z,W,{className:x}),c)}return ee.createElement(_,Ci({field:Z,form:D},a,{className:x}),c)}var Q=f||"input";if(typeof Q=="string"){var K=a.innerRef,pe=mf(a,["innerRef"]);return ee.createElement(Q,Ci({ref:K},Z,pe,{className:x}),c)}return ee.createElement(Q,Ci({},Z,a,{className:x}),c)}var zO=ee.forwardRef(function(t,e){var r=t.action,o=mf(t,["action"]),c=r??"#",f=bG(),_=f.handleReset,x=f.handleSubmit;return ee.createElement("form",Ci({onSubmit:x,ref:e,onReset:_,action:c},o))});zO.displayName="Form";function Joe(t){var e=function(c){return ee.createElement($oe,null,function(f){return ee.createElement(t,Ci({},c,{formik:f}))})},r=t.displayName||t.name||t.constructor&&t.constructor.name||"Component";return e.WrappedComponent=t,e.displayName="FormikConnect("+r+")",Uoe(e,t)}var eae=function(e,r,o){var c=km(e),f=c[r];return c.splice(r,1),c.splice(o,0,f),c},tae=function(e,r,o){var c=km(e),f=c[r];return c[r]=c[o],c[o]=f,c},QR=function(e,r,o){var c=km(e);return c.splice(r,0,o),c},nae=function(e,r,o){var c=km(e);return c[r]=o,c},km=function(e){if(e){if(Array.isArray(e))return[].concat(e);var r=Object.keys(e).map(function(o){return parseInt(o)}).reduce(function(o,c){return c>o?c:o},0);return Array.from(Ci({},e,{length:r+1}))}else return[]},hU=function(e,r){var o=typeof e=="function"?e:r;return function(c){if(Array.isArray(c)||Z1(c)){var f=km(c);return o(f)}return c}},rae=function(t){xG(e,t);function e(o){var c;return c=t.call(this,o)||this,c.updateArrayField=function(f,_,x){var a=c.props,I=a.name,D=a.formik.setFormikState;D(function(O){var F=hU(x,f),Z=hU(_,f),J=Nu(O.values,I,f(gs(O.values,I))),ne=x?F(gs(O.errors,I)):void 0,se=_?Z(gs(O.touched,I)):void 0;return uU(ne)&&(ne=void 0),uU(se)&&(se=void 0),Ci({},O,{values:J,errors:x?Nu(O.errors,I,ne):O.errors,touched:_?Nu(O.touched,I,se):O.touched})})},c.push=function(f){return c.updateArrayField(function(_){return[].concat(km(_),[Qv(f)])},!1,!1)},c.handlePush=function(f){return function(){return c.push(f)}},c.swap=function(f,_){return c.updateArrayField(function(x){return tae(x,f,_)},!0,!0)},c.handleSwap=function(f,_){return function(){return c.swap(f,_)}},c.move=function(f,_){return c.updateArrayField(function(x){return eae(x,f,_)},!0,!0)},c.handleMove=function(f,_){return function(){return c.move(f,_)}},c.insert=function(f,_){return c.updateArrayField(function(x){return QR(x,f,_)},function(x){return QR(x,f,null)},function(x){return QR(x,f,null)})},c.handleInsert=function(f,_){return function(){return c.insert(f,_)}},c.replace=function(f,_){return c.updateArrayField(function(x){return nae(x,f,_)},!1,!1)},c.handleReplace=function(f,_){return function(){return c.replace(f,_)}},c.unshift=function(f){var _=-1;return c.updateArrayField(function(x){var a=x?[f].concat(x):[f];return _=a.length,a},function(x){return x?[null].concat(x):[null]},function(x){return x?[null].concat(x):[null]}),_},c.handleUnshift=function(f){return function(){return c.unshift(f)}},c.handleRemove=function(f){return function(){return c.remove(f)}},c.handlePop=function(){return function(){return c.pop()}},c.remove=c.remove.bind(cU(c)),c.pop=c.pop.bind(cU(c)),c}var r=e.prototype;return r.componentDidUpdate=function(c){this.props.validateOnChange&&this.props.formik.validateOnChange&&!rf(gs(c.formik.values,c.name),gs(this.props.formik.values,this.props.name))&&this.props.formik.validateForm(this.props.formik.values)},r.remove=function(c){var f;return this.updateArrayField(function(_){var x=_?km(_):[];return f||(f=x[c]),Mo(x.splice)&&x.splice(c,1),Mo(x.every)&&x.every(function(a){return a===void 0})?[]:x},!0,!0),f},r.pop=function(){var c;return this.updateArrayField(function(f){var _=f.slice();return c||(c=_&&_.pop&&_.pop()),_},!0,!0),c},r.render=function(){var c={push:this.push,pop:this.pop,swap:this.swap,move:this.move,insert:this.insert,replace:this.replace,unshift:this.unshift,remove:this.remove,handlePush:this.handlePush,handlePop:this.handlePop,handleSwap:this.handleSwap,handleMove:this.handleMove,handleInsert:this.handleInsert,handleReplace:this.handleReplace,handleUnshift:this.handleUnshift,handleRemove:this.handleRemove},f=this.props,_=f.component,x=f.render,a=f.children,I=f.name,D=f.formik,O=mf(D,["validate","validationSchema"]),F=Ci({},c,{form:O,name:I});return _?ee.createElement(_,F):x?x(F):a?typeof a=="function"?a(F):wG(a)?null:ee.Children.only(a):null},e}(ee.Component);rae.defaultProps={validateOnChange:!0};var iae=function(t){xG(e,t);function e(){return t.apply(this,arguments)||this}var r=e.prototype;return r.shouldComponentUpdate=function(c){return gs(this.props.formik.errors,this.props.name)!==gs(c.formik.errors,this.props.name)||gs(this.props.formik.touched,this.props.name)!==gs(c.formik.touched,this.props.name)||Object.keys(this.props).length!==Object.keys(c).length},r.render=function(){var c=this.props,f=c.component,_=c.formik,x=c.render,a=c.children,I=c.name,D=mf(c,["component","formik","render","children","name"]),O=gs(_.touched,I),F=gs(_.errors,I);return O&&F?x?Mo(x)?x(F):null:a?Mo(a)?a(F):null:f?ee.createElement(f,D,F):F:null},e}(ee.Component),Ix=Joe(iae);function tg(t){this._maxSize=t,this.clear()}tg.prototype.clear=function(){this._size=0,this._values=Object.create(null)};tg.prototype.get=function(t){return this._values[t]};tg.prototype.set=function(t,e){return this._size>=this._maxSize&&this.clear(),t in this._values||this._size++,this._values[t]=e};var sae=/[^.^\]^[]+|(?=\[\]|\.\.)/g,SG=/^\d+$/,oae=/^\d/,aae=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g,lae=/^\s*(['"]?)(.*?)(\1)\s*$/,NO=512,dU=new tg(NO),fU=new tg(NO),pU=new tg(NO),ym={Cache:tg,split:Hk,normalizePath:JR,setter:function(t){var e=JR(t);return fU.get(t)||fU.set(t,function(o,c){for(var f=0,_=e.length,x=o;f<_-1;){var a=e[f];if(a==="__proto__"||a==="constructor"||a==="prototype")return o;x=x[e[f++]]}x[e[f]]=c})},getter:function(t,e){var r=JR(t);return pU.get(t)||pU.set(t,function(c){for(var f=0,_=r.length;f<_;)if(c!=null||!e)c=c[r[f++]];else return;return c})},join:function(t){return t.reduce(function(e,r){return e+(FO(r)||SG.test(r)?"["+r+"]":(e?".":"")+r)},"")},forEach:function(t,e,r){cae(Array.isArray(t)?t:Hk(t),e,r)}};function JR(t){return dU.get(t)||dU.set(t,Hk(t).map(function(e){return e.replace(lae,"$2")}))}function Hk(t){return t.match(sae)||[""]}function cae(t,e,r){var o=t.length,c,f,_,x;for(f=0;f<o;f++)c=t[f],c&&(dae(c)&&(c='"'+c+'"'),x=FO(c),_=!x&&/^\d+$/.test(c),e.call(r,c,x,_,f,t))}function FO(t){return typeof t=="string"&&t&&["'",'"'].indexOf(t.charAt(0))!==-1}function uae(t){return t.match(oae)&&!t.match(SG)}function hae(t){return aae.test(t)}function dae(t){return!FO(t)&&(uae(t)||hae(t))}const fae=/[A-Z\xc0-\xd6\xd8-\xde]?[a-z\xdf-\xf6\xf8-\xff]+(?:['](?:d|ll|m|re|s|t|ve))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde]|$)|(?:[A-Z\xc0-\xd6\xd8-\xde]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['](?:D|LL|M|RE|S|T|VE))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde](?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])|$)|[A-Z\xc0-\xd6\xd8-\xde]?(?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['](?:d|ll|m|re|s|t|ve))?|[A-Z\xc0-\xd6\xd8-\xde]+(?:['](?:D|LL|M|RE|S|T|VE))?|\d*(?:1ST|2ND|3RD|(?![123])\dTH)(?=\b|[a-z_])|\d*(?:1st|2nd|3rd|(?![123])\dth)(?=\b|[A-Z_])|\d+|(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,UI=t=>t.match(fae)||[],VI=t=>t[0].toUpperCase()+t.slice(1),BO=(t,e)=>UI(t).join(e).toLowerCase(),IG=t=>UI(t).reduce((e,r)=>`${e}${e?r[0].toUpperCase()+r.slice(1).toLowerCase():r.toLowerCase()}`,""),pae=t=>VI(IG(t)),mae=t=>BO(t,"_"),gae=t=>BO(t,"-"),_ae=t=>VI(BO(t," ")),yae=t=>UI(t).map(VI).join(" ");var eM={words:UI,upperFirst:VI,camelCase:IG,pascalCase:pae,snakeCase:mae,kebabCase:gae,sentenceCase:_ae,titleCase:yae},jO={exports:{}};jO.exports=function(t){return AG(vae(t),t)};jO.exports.array=AG;function AG(t,e){var r=t.length,o=new Array(r),c={},f=r,_=xae(e),x=bae(t);for(e.forEach(function(I){if(!x.has(I[0])||!x.has(I[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")});f--;)c[f]||a(t[f],f,new Set);return o;function a(I,D,O){if(O.has(I)){var F;try{F=", node was:"+JSON.stringify(I)}catch{F=""}throw new Error("Cyclic dependency"+F)}if(!x.has(I))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(I));if(!c[D]){c[D]=!0;var Z=_.get(I)||new Set;if(Z=Array.from(Z),D=Z.length){O.add(I);do{var J=Z[--D];a(J,x.get(J),O)}while(D);O.delete(I)}o[--r]=I}}}function vae(t){for(var e=new Set,r=0,o=t.length;r<o;r++){var c=t[r];e.add(c[0]),e.add(c[1])}return Array.from(e)}function xae(t){for(var e=new Map,r=0,o=t.length;r<o;r++){var c=t[r];e.has(c[0])||e.set(c[0],new Set),e.has(c[1])||e.set(c[1],new Set),e.get(c[0]).add(c[1])}return e}function bae(t){for(var e=new Map,r=0,o=t.length;r<o;r++)e.set(t[r],r);return e}var wae=jO.exports;const Tae=Wm(wae),Eae=Object.prototype.toString,Sae=Error.prototype.toString,Iae=RegExp.prototype.toString,Aae=typeof Symbol<"u"?Symbol.prototype.toString:()=>"",Cae=/^Symbol\((.*)\)(.*)$/;function Pae(t){return t!=+t?"NaN":t===0&&1/t<0?"-0":""+t}function mU(t,e=!1){if(t==null||t===!0||t===!1)return""+t;const r=typeof t;if(r==="number")return Pae(t);if(r==="string")return e?`"${t}"`:t;if(r==="function")return"[Function "+(t.name||"anonymous")+"]";if(r==="symbol")return Aae.call(t).replace(Cae,"Symbol($1)");const o=Eae.call(t).slice(8,-1);return o==="Date"?isNaN(t.getTime())?""+t:t.toISOString(t):o==="Error"||t instanceof Error?"["+Sae.call(t)+"]":o==="RegExp"?Iae.call(t):null}function Pf(t,e){let r=mU(t,e);return r!==null?r:JSON.stringify(t,function(o,c){let f=mU(this[o],e);return f!==null?f:c},2)}function CG(t){return t==null?[]:[].concat(t)}let PG,RG,MG,Rae=/\$\{\s*(\w+)\s*\}/g;PG=Symbol.toStringTag;class gU{constructor(e,r,o,c){this.name=void 0,this.message=void 0,this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=void 0,this.inner=void 0,this[PG]="Error",this.name="ValidationError",this.value=r,this.path=o,this.type=c,this.errors=[],this.inner=[],CG(e).forEach(f=>{if(Fa.isError(f)){this.errors.push(...f.errors);const _=f.inner.length?f.inner:[f];this.inner.push(..._)}else this.errors.push(f)}),this.message=this.errors.length>1?`${this.errors.length} errors occurred`:this.errors[0]}}RG=Symbol.hasInstance;MG=Symbol.toStringTag;class Fa extends Error{static formatError(e,r){const o=r.label||r.path||"this";return o!==r.path&&(r=Object.assign({},r,{path:o})),typeof e=="string"?e.replace(Rae,(c,f)=>Pf(r[f])):typeof e=="function"?e(r):e}static isError(e){return e&&e.name==="ValidationError"}constructor(e,r,o,c,f){const _=new gU(e,r,o,c);if(f)return _;super(),this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=[],this.inner=[],this[MG]="Error",this.name=_.name,this.message=_.message,this.type=_.type,this.value=_.value,this.path=_.path,this.errors=_.errors,this.inner=_.inner,Error.captureStackTrace&&Error.captureStackTrace(this,Fa)}static[RG](e){return gU[Symbol.hasInstance](e)||super[Symbol.hasInstance](e)}}let Tu={default:"${path} is invalid",required:"${path} is a required field",defined:"${path} must be defined",notNull:"${path} cannot be null",oneOf:"${path} must be one of the following values: ${values}",notOneOf:"${path} must not be one of the following values: ${values}",notType:({path:t,type:e,value:r,originalValue:o})=>{const c=o!=null&&o!==r?` (cast from the value \`${Pf(o,!0)}\`).`:".";return e!=="mixed"?`${t} must be a \`${e}\` type, but the final value was: \`${Pf(r,!0)}\``+c:`${t} must match the configured type. The validated value was: \`${Pf(r,!0)}\``+c}},Oa={length:"${path} must be exactly ${length} characters",min:"${path} must be at least ${min} characters",max:"${path} must be at most ${max} characters",matches:'${path} must match the following: "${regex}"',email:"${path} must be a valid email",url:"${path} must be a valid URL",uuid:"${path} must be a valid UUID",datetime:"${path} must be a valid ISO date-time",datetime_precision:"${path} must be a valid ISO date-time with a sub-second precision of exactly ${precision} digits",datetime_offset:'${path} must be a valid ISO date-time with UTC "Z" timezone',trim:"${path} must be a trimmed string",lowercase:"${path} must be a lowercase string",uppercase:"${path} must be a upper case string"},Mae={min:"${path} must be greater than or equal to ${min}",max:"${path} must be less than or equal to ${max}",lessThan:"${path} must be less than ${less}",moreThan:"${path} must be greater than ${more}",positive:"${path} must be a positive number",negative:"${path} must be a negative number",integer:"${path} must be an integer"},Zk={min:"${path} field must be later than ${min}",max:"${path} field must be at earlier than ${max}"},kae={isValue:"${path} field must be ${value}"},Xk={noUnknown:"${path} field has unspecified keys: ${unknown}"},Dae={min:"${path} field must have at least ${min} items",max:"${path} field must have less than or equal to ${max} items",length:"${path} must have ${length} items"},Oae={notType:t=>{const{path:e,value:r,spec:o}=t,c=o.types.length;if(Array.isArray(r)){if(r.length<c)return`${e} tuple value has too few items, expected a length of ${c} but got ${r.length} for value: \`${Pf(r,!0)}\``;if(r.length>c)return`${e} tuple value has too many items, expected a length of ${c} but got ${r.length} for value: \`${Pf(r,!0)}\``}return Fa.formatError(Tu.notType,t)}};Object.assign(Object.create(null),{mixed:Tu,string:Oa,number:Mae,date:Zk,object:Xk,array:Dae,boolean:kae,tuple:Oae});const UO=t=>t&&t.__isYupSchema__;class fS{static fromOptions(e,r){if(!r.then&&!r.otherwise)throw new TypeError("either `then:` or `otherwise:` is required for `when()` conditions");let{is:o,then:c,otherwise:f}=r,_=typeof o=="function"?o:(...x)=>x.every(a=>a===o);return new fS(e,(x,a)=>{var I;let D=_(...x)?c:f;return(I=D==null?void 0:D(a))!=null?I:a})}constructor(e,r){this.fn=void 0,this.refs=e,this.refs=e,this.fn=r}resolve(e,r){let o=this.refs.map(f=>f.getValue(r==null?void 0:r.value,r==null?void 0:r.parent,r==null?void 0:r.context)),c=this.fn(o,e,r);if(c===void 0||c===e)return e;if(!UO(c))throw new TypeError("conditions must return a schema object");return c.resolve(r)}}const LT={context:"$",value:"."};let ng=class{constructor(e,r={}){if(this.key=void 0,this.isContext=void 0,this.isValue=void 0,this.isSibling=void 0,this.path=void 0,this.getter=void 0,this.map=void 0,typeof e!="string")throw new TypeError("ref must be a string, got: "+e);if(this.key=e.trim(),e==="")throw new TypeError("ref must be a non-empty string");this.isContext=this.key[0]===LT.context,this.isValue=this.key[0]===LT.value,this.isSibling=!this.isContext&&!this.isValue;let o=this.isContext?LT.context:this.isValue?LT.value:"";this.path=this.key.slice(o.length),this.getter=this.path&&ym.getter(this.path,!0),this.map=r.map}getValue(e,r,o){let c=this.isContext?o:this.isValue?e:r;return this.getter&&(c=this.getter(c||{})),this.map&&(c=this.map(c)),c}cast(e,r){return this.getValue(e,r==null?void 0:r.parent,r==null?void 0:r.context)}resolve(){return this}describe(){return{type:"ref",key:this.key}}toString(){return`Ref(${this.key})`}static isRef(e){return e&&e.__isYupRef}};ng.prototype.__isYupRef=!0;const hm=t=>t==null;function __(t){function e({value:r,path:o="",options:c,originalValue:f,schema:_},x,a){const{name:I,test:D,params:O,message:F,skipAbsent:Z}=t;let{parent:J,context:ne,abortEarly:se=_.spec.abortEarly,disableStackTrace:W=_.spec.disableStackTrace}=c;function Q(be){return ng.isRef(be)?be.getValue(r,J,ne):be}function K(be={}){const ke=Object.assign({value:r,originalValue:f,label:_.spec.label,path:be.path||o,spec:_.spec,disableStackTrace:be.disableStackTrace||W},O,be.params);for(const Lt of Object.keys(ke))ke[Lt]=Q(ke[Lt]);const Ee=new Fa(Fa.formatError(be.message||F,ke),r,ke.path,be.type||I,ke.disableStackTrace);return Ee.params=ke,Ee}const pe=se?x:a;let Te={path:o,parent:J,type:I,from:c.from,createError:K,resolve:Q,options:c,originalValue:f,schema:_};const we=be=>{Fa.isError(be)?pe(be):be?a(null):pe(K())},oe=be=>{Fa.isError(be)?pe(be):x(be)};if(Z&&hm(r))return we(!0);let X;try{var ge;if(X=D.call(Te,r,Te),typeof((ge=X)==null?void 0:ge.then)=="function"){if(c.sync)throw new Error(`Validation test of type: "${Te.type}" returned a Promise during a synchronous validate. This test will finish after the validate call has returned`);return Promise.resolve(X).then(we,oe)}}catch(be){oe(be);return}we(X)}return e.OPTIONS=t,e}function Lae(t,e,r,o=r){let c,f,_;return e?(ym.forEach(e,(x,a,I)=>{let D=a?x.slice(1,x.length-1):x;t=t.resolve({context:o,parent:c,value:r});let O=t.type==="tuple",F=I?parseInt(D,10):0;if(t.innerType||O){if(O&&!I)throw new Error(`Yup.reach cannot implicitly index into a tuple type. the path part "${_}" must contain an index to the tuple element, e.g. "${_}[0]"`);if(r&&F>=r.length)throw new Error(`Yup.reach cannot resolve an array item at index: ${x}, in the path: ${e}. because there is no value at that index. `);c=r,r=r&&r[F],t=O?t.spec.types[F]:t.innerType}if(!I){if(!t.fields||!t.fields[D])throw new Error(`The schema does not contain the path: ${e}. (failed at: ${_} which is a type: "${t.type}")`);c=r,r=r&&r[D],t=t.fields[D]}f=D,_=a?"["+x+"]":"."+x}),{schema:t,parent:c,parentPath:f}):{parent:c,parentPath:e,schema:t}}class pS extends Set{describe(){const e=[];for(const r of this.values())e.push(ng.isRef(r)?r.describe():r);return e}resolveAll(e){let r=[];for(const o of this.values())r.push(e(o));return r}clone(){return new pS(this.values())}merge(e,r){const o=this.clone();return e.forEach(c=>o.add(c)),r.forEach(c=>o.delete(c)),o}}function W_(t,e=new Map){if(UO(t)||!t||typeof t!="object")return t;if(e.has(t))return e.get(t);let r;if(t instanceof Date)r=new Date(t.getTime()),e.set(t,r);else if(t instanceof RegExp)r=new RegExp(t),e.set(t,r);else if(Array.isArray(t)){r=new Array(t.length),e.set(t,r);for(let o=0;o<t.length;o++)r[o]=W_(t[o],e)}else if(t instanceof Map){r=new Map,e.set(t,r);for(const[o,c]of t.entries())r.set(o,W_(c,e))}else if(t instanceof Set){r=new Set,e.set(t,r);for(const o of t)r.add(W_(o,e))}else if(t instanceof Object){r={},e.set(t,r);for(const[o,c]of Object.entries(t))r[o]=W_(c,e)}else throw Error(`Unable to clone ${t}`);return r}class $u{constructor(e){this.type=void 0,this.deps=[],this.tests=void 0,this.transforms=void 0,this.conditions=[],this._mutate=void 0,this.internalTests={},this._whitelist=new pS,this._blacklist=new pS,this.exclusiveTests=Object.create(null),this._typeCheck=void 0,this.spec=void 0,this.tests=[],this.transforms=[],this.withMutation(()=>{this.typeError(Tu.notType)}),this.type=e.type,this._typeCheck=e.check,this.spec=Object.assign({strip:!1,strict:!1,abortEarly:!0,recursive:!0,disableStackTrace:!1,nullable:!1,optional:!0,coerce:!0},e==null?void 0:e.spec),this.withMutation(r=>{r.nonNullable()})}get _type(){return this.type}clone(e){if(this._mutate)return e&&Object.assign(this.spec,e),this;const r=Object.create(Object.getPrototypeOf(this));return r.type=this.type,r._typeCheck=this._typeCheck,r._whitelist=this._whitelist.clone(),r._blacklist=this._blacklist.clone(),r.internalTests=Object.assign({},this.internalTests),r.exclusiveTests=Object.assign({},this.exclusiveTests),r.deps=[...this.deps],r.conditions=[...this.conditions],r.tests=[...this.tests],r.transforms=[...this.transforms],r.spec=W_(Object.assign({},this.spec,e)),r}label(e){let r=this.clone();return r.spec.label=e,r}meta(...e){if(e.length===0)return this.spec.meta;let r=this.clone();return r.spec.meta=Object.assign(r.spec.meta||{},e[0]),r}withMutation(e){let r=this._mutate;this._mutate=!0;let o=e(this);return this._mutate=r,o}concat(e){if(!e||e===this)return this;if(e.type!==this.type&&this.type!=="mixed")throw new TypeError(`You cannot \`concat()\` schema's of different types: ${this.type} and ${e.type}`);let r=this,o=e.clone();const c=Object.assign({},r.spec,o.spec);return o.spec=c,o.internalTests=Object.assign({},r.internalTests,o.internalTests),o._whitelist=r._whitelist.merge(e._whitelist,e._blacklist),o._blacklist=r._blacklist.merge(e._blacklist,e._whitelist),o.tests=r.tests,o.exclusiveTests=r.exclusiveTests,o.withMutation(f=>{e.tests.forEach(_=>{f.test(_.OPTIONS)})}),o.transforms=[...r.transforms,...o.transforms],o}isType(e){return e==null?!!(this.spec.nullable&&e===null||this.spec.optional&&e===void 0):this._typeCheck(e)}resolve(e){let r=this;if(r.conditions.length){let o=r.conditions;r=r.clone(),r.conditions=[],r=o.reduce((c,f)=>f.resolve(c,e),r),r=r.resolve(e)}return r}resolveOptions(e){var r,o,c,f;return Object.assign({},e,{from:e.from||[],strict:(r=e.strict)!=null?r:this.spec.strict,abortEarly:(o=e.abortEarly)!=null?o:this.spec.abortEarly,recursive:(c=e.recursive)!=null?c:this.spec.recursive,disableStackTrace:(f=e.disableStackTrace)!=null?f:this.spec.disableStackTrace})}cast(e,r={}){let o=this.resolve(Object.assign({value:e},r)),c=r.assert==="ignore-optionality",f=o._cast(e,r);if(r.assert!==!1&&!o.isType(f)){if(c&&hm(f))return f;let _=Pf(e),x=Pf(f);throw new TypeError(`The value of ${r.path||"field"} could not be cast to a value that satisfies the schema type: "${o.type}". 

attempted value: ${_} 
`+(x!==_?`result of cast: ${x}`:""))}return f}_cast(e,r){let o=e===void 0?e:this.transforms.reduce((c,f)=>f.call(this,c,e,this),e);return o===void 0&&(o=this.getDefault(r)),o}_validate(e,r={},o,c){let{path:f,originalValue:_=e,strict:x=this.spec.strict}=r,a=e;x||(a=this._cast(a,Object.assign({assert:!1},r)));let I=[];for(let D of Object.values(this.internalTests))D&&I.push(D);this.runTests({path:f,value:a,originalValue:_,options:r,tests:I},o,D=>{if(D.length)return c(D,a);this.runTests({path:f,value:a,originalValue:_,options:r,tests:this.tests},o,c)})}runTests(e,r,o){let c=!1,{tests:f,value:_,originalValue:x,path:a,options:I}=e,D=ne=>{c||(c=!0,r(ne,_))},O=ne=>{c||(c=!0,o(ne,_))},F=f.length,Z=[];if(!F)return O([]);let J={value:_,originalValue:x,path:a,options:I,schema:this};for(let ne=0;ne<f.length;ne++){const se=f[ne];se(J,D,function(Q){Q&&(Array.isArray(Q)?Z.push(...Q):Z.push(Q)),--F<=0&&O(Z)})}}asNestedTest({key:e,index:r,parent:o,parentPath:c,originalParent:f,options:_}){const x=e??r;if(x==null)throw TypeError("Must include `key` or `index` for nested validations");const a=typeof x=="number";let I=o[x];const D=Object.assign({},_,{strict:!0,parent:o,value:I,originalValue:f[x],key:void 0,[a?"index":"key"]:x,path:a||x.includes(".")?`${c||""}[${a?x:`"${x}"`}]`:(c?`${c}.`:"")+e});return(O,F,Z)=>this.resolve(D)._validate(I,D,F,Z)}validate(e,r){var o;let c=this.resolve(Object.assign({},r,{value:e})),f=(o=r==null?void 0:r.disableStackTrace)!=null?o:c.spec.disableStackTrace;return new Promise((_,x)=>c._validate(e,r,(a,I)=>{Fa.isError(a)&&(a.value=I),x(a)},(a,I)=>{a.length?x(new Fa(a,I,void 0,void 0,f)):_(I)}))}validateSync(e,r){var o;let c=this.resolve(Object.assign({},r,{value:e})),f,_=(o=r==null?void 0:r.disableStackTrace)!=null?o:c.spec.disableStackTrace;return c._validate(e,Object.assign({},r,{sync:!0}),(x,a)=>{throw Fa.isError(x)&&(x.value=a),x},(x,a)=>{if(x.length)throw new Fa(x,e,void 0,void 0,_);f=a}),f}isValid(e,r){return this.validate(e,r).then(()=>!0,o=>{if(Fa.isError(o))return!1;throw o})}isValidSync(e,r){try{return this.validateSync(e,r),!0}catch(o){if(Fa.isError(o))return!1;throw o}}_getDefault(e){let r=this.spec.default;return r==null?r:typeof r=="function"?r.call(this,e):W_(r)}getDefault(e){return this.resolve(e||{})._getDefault(e)}default(e){return arguments.length===0?this._getDefault():this.clone({default:e})}strict(e=!0){return this.clone({strict:e})}nullability(e,r){const o=this.clone({nullable:e});return o.internalTests.nullable=__({message:r,name:"nullable",test(c){return c===null?this.schema.spec.nullable:!0}}),o}optionality(e,r){const o=this.clone({optional:e});return o.internalTests.optionality=__({message:r,name:"optionality",test(c){return c===void 0?this.schema.spec.optional:!0}}),o}optional(){return this.optionality(!0)}defined(e=Tu.defined){return this.optionality(!1,e)}nullable(){return this.nullability(!0)}nonNullable(e=Tu.notNull){return this.nullability(!1,e)}required(e=Tu.required){return this.clone().withMutation(r=>r.nonNullable(e).defined(e))}notRequired(){return this.clone().withMutation(e=>e.nullable().optional())}transform(e){let r=this.clone();return r.transforms.push(e),r}test(...e){let r;if(e.length===1?typeof e[0]=="function"?r={test:e[0]}:r=e[0]:e.length===2?r={name:e[0],test:e[1]}:r={name:e[0],message:e[1],test:e[2]},r.message===void 0&&(r.message=Tu.default),typeof r.test!="function")throw new TypeError("`test` is a required parameters");let o=this.clone(),c=__(r),f=r.exclusive||r.name&&o.exclusiveTests[r.name]===!0;if(r.exclusive&&!r.name)throw new TypeError("Exclusive tests must provide a unique `name` identifying the test");return r.name&&(o.exclusiveTests[r.name]=!!r.exclusive),o.tests=o.tests.filter(_=>!(_.OPTIONS.name===r.name&&(f||_.OPTIONS.test===c.OPTIONS.test))),o.tests.push(c),o}when(e,r){!Array.isArray(e)&&typeof e!="string"&&(r=e,e=".");let o=this.clone(),c=CG(e).map(f=>new ng(f));return c.forEach(f=>{f.isSibling&&o.deps.push(f.key)}),o.conditions.push(typeof r=="function"?new fS(c,r):fS.fromOptions(c,r)),o}typeError(e){let r=this.clone();return r.internalTests.typeError=__({message:e,name:"typeError",skipAbsent:!0,test(o){return this.schema._typeCheck(o)?!0:this.createError({params:{type:this.schema.type}})}}),r}oneOf(e,r=Tu.oneOf){let o=this.clone();return e.forEach(c=>{o._whitelist.add(c),o._blacklist.delete(c)}),o.internalTests.whiteList=__({message:r,name:"oneOf",skipAbsent:!0,test(c){let f=this.schema._whitelist,_=f.resolveAll(this.resolve);return _.includes(c)?!0:this.createError({params:{values:Array.from(f).join(", "),resolved:_}})}}),o}notOneOf(e,r=Tu.notOneOf){let o=this.clone();return e.forEach(c=>{o._blacklist.add(c),o._whitelist.delete(c)}),o.internalTests.blacklist=__({message:r,name:"notOneOf",test(c){let f=this.schema._blacklist,_=f.resolveAll(this.resolve);return _.includes(c)?this.createError({params:{values:Array.from(f).join(", "),resolved:_}}):!0}}),o}strip(e=!0){let r=this.clone();return r.spec.strip=e,r}describe(e){const r=(e?this.resolve(e):this).clone(),{label:o,meta:c,optional:f,nullable:_}=r.spec;return{meta:c,label:o,optional:f,nullable:_,default:r.getDefault(e),type:r.type,oneOf:r._whitelist.describe(),notOneOf:r._blacklist.describe(),tests:r.tests.map(a=>({name:a.OPTIONS.name,params:a.OPTIONS.params})).filter((a,I,D)=>D.findIndex(O=>O.name===a.name)===I)}}}$u.prototype.__isYupSchema__=!0;for(const t of["validate","validateSync"])$u.prototype[`${t}At`]=function(e,r,o={}){const{parent:c,parentPath:f,schema:_}=Lae(this,e,r,o.context);return _[t](c&&c[f],Object.assign({},o,{parent:c,path:e}))};for(const t of["equals","is"])$u.prototype[t]=$u.prototype.oneOf;for(const t of["not","nope"])$u.prototype[t]=$u.prototype.notOneOf;const zae=/^(\d{4}|[+-]\d{6})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:[ T]?(\d{2}):?(\d{2})(?::?(\d{2})(?:[,.](\d{1,}))?)?(?:(Z)|([+-])(\d{2})(?::?(\d{2}))?)?)?$/;function Nae(t){const e=Kk(t);if(!e)return Date.parse?Date.parse(t):Number.NaN;if(e.z===void 0&&e.plusMinus===void 0)return new Date(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond).valueOf();let r=0;return e.z!=="Z"&&e.plusMinus!==void 0&&(r=e.hourOffset*60+e.minuteOffset,e.plusMinus==="+"&&(r=0-r)),Date.UTC(e.year,e.month,e.day,e.hour,e.minute+r,e.second,e.millisecond)}function Kk(t){var e,r;const o=zae.exec(t);return o?{year:Eh(o[1]),month:Eh(o[2],1)-1,day:Eh(o[3],1),hour:Eh(o[4]),minute:Eh(o[5]),second:Eh(o[6]),millisecond:o[7]?Eh(o[7].substring(0,3)):0,precision:(e=(r=o[7])==null?void 0:r.length)!=null?e:void 0,z:o[8]||void 0,plusMinus:o[9]||void 0,hourOffset:Eh(o[10]),minuteOffset:Eh(o[11])}:null}function Eh(t,e=0){return Number(t)||e}let Fae=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Bae=/^((https?|ftp):)?\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,jae=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Uae="^\\d{4}-\\d{2}-\\d{2}",Vae="\\d{2}:\\d{2}:\\d{2}",$ae="(([+-]\\d{2}(:?\\d{2})?)|Z)",Gae=new RegExp(`${Uae}T${Vae}(\\.\\d+)?${$ae}$`),qae=t=>hm(t)||t===t.trim(),Wae={}.toString();function ry(){return new kG}class kG extends $u{constructor(){super({type:"string",check(e){return e instanceof String&&(e=e.valueOf()),typeof e=="string"}}),this.withMutation(()=>{this.transform((e,r,o)=>{if(!o.spec.coerce||o.isType(e)||Array.isArray(e))return e;const c=e!=null&&e.toString?e.toString():e;return c===Wae?e:c})})}required(e){return super.required(e).withMutation(r=>r.test({message:e||Tu.required,name:"required",skipAbsent:!0,test:o=>!!o.length}))}notRequired(){return super.notRequired().withMutation(e=>(e.tests=e.tests.filter(r=>r.OPTIONS.name!=="required"),e))}length(e,r=Oa.length){return this.test({message:r,name:"length",exclusive:!0,params:{length:e},skipAbsent:!0,test(o){return o.length===this.resolve(e)}})}min(e,r=Oa.min){return this.test({message:r,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(o){return o.length>=this.resolve(e)}})}max(e,r=Oa.max){return this.test({name:"max",exclusive:!0,message:r,params:{max:e},skipAbsent:!0,test(o){return o.length<=this.resolve(e)}})}matches(e,r){let o=!1,c,f;return r&&(typeof r=="object"?{excludeEmptyString:o=!1,message:c,name:f}=r:c=r),this.test({name:f||"matches",message:c||Oa.matches,params:{regex:e},skipAbsent:!0,test:_=>_===""&&o||_.search(e)!==-1})}email(e=Oa.email){return this.matches(Fae,{name:"email",message:e,excludeEmptyString:!0})}url(e=Oa.url){return this.matches(Bae,{name:"url",message:e,excludeEmptyString:!0})}uuid(e=Oa.uuid){return this.matches(jae,{name:"uuid",message:e,excludeEmptyString:!1})}datetime(e){let r="",o,c;return e&&(typeof e=="object"?{message:r="",allowOffset:o=!1,precision:c=void 0}=e:r=e),this.matches(Gae,{name:"datetime",message:r||Oa.datetime,excludeEmptyString:!0}).test({name:"datetime_offset",message:r||Oa.datetime_offset,params:{allowOffset:o},skipAbsent:!0,test:f=>{if(!f||o)return!0;const _=Kk(f);return _?!!_.z:!1}}).test({name:"datetime_precision",message:r||Oa.datetime_precision,params:{precision:c},skipAbsent:!0,test:f=>{if(!f||c==null)return!0;const _=Kk(f);return _?_.precision===c:!1}})}ensure(){return this.default("").transform(e=>e===null?"":e)}trim(e=Oa.trim){return this.transform(r=>r!=null?r.trim():r).test({message:e,name:"trim",test:qae})}lowercase(e=Oa.lowercase){return this.transform(r=>hm(r)?r:r.toLowerCase()).test({message:e,name:"string_case",exclusive:!0,skipAbsent:!0,test:r=>hm(r)||r===r.toLowerCase()})}uppercase(e=Oa.uppercase){return this.transform(r=>hm(r)?r:r.toUpperCase()).test({message:e,name:"string_case",exclusive:!0,skipAbsent:!0,test:r=>hm(r)||r===r.toUpperCase()})}}ry.prototype=kG.prototype;let Hae=new Date(""),Zae=t=>Object.prototype.toString.call(t)==="[object Date]";class $I extends $u{constructor(){super({type:"date",check(e){return Zae(e)&&!isNaN(e.getTime())}}),this.withMutation(()=>{this.transform((e,r,o)=>!o.spec.coerce||o.isType(e)||e===null?e:(e=Nae(e),isNaN(e)?$I.INVALID_DATE:new Date(e)))})}prepareParam(e,r){let o;if(ng.isRef(e))o=e;else{let c=this.cast(e);if(!this._typeCheck(c))throw new TypeError(`\`${r}\` must be a Date or a value that can be \`cast()\` to a Date`);o=c}return o}min(e,r=Zk.min){let o=this.prepareParam(e,"min");return this.test({message:r,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(c){return c>=this.resolve(o)}})}max(e,r=Zk.max){let o=this.prepareParam(e,"max");return this.test({message:r,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(c){return c<=this.resolve(o)}})}}$I.INVALID_DATE=Hae;$I.prototype;function Xae(t,e=[]){let r=[],o=new Set,c=new Set(e.map(([_,x])=>`${_}-${x}`));function f(_,x){let a=ym.split(_)[0];o.add(a),c.has(`${x}-${a}`)||r.push([x,a])}for(const _ of Object.keys(t)){let x=t[_];o.add(_),ng.isRef(x)&&x.isSibling?f(x.path,_):UO(x)&&"deps"in x&&x.deps.forEach(a=>f(a,_))}return Tae.array(Array.from(o),r).reverse()}function _U(t,e){let r=1/0;return t.some((o,c)=>{var f;if((f=e.path)!=null&&f.includes(o))return r=c,!0}),r}function DG(t){return(e,r)=>_U(t,e)-_U(t,r)}const Kae=(t,e,r)=>{if(typeof t!="string")return t;let o=t;try{o=JSON.parse(t)}catch{}return r.isType(o)?o:t};function mE(t){if("fields"in t){const e={};for(const[r,o]of Object.entries(t.fields))e[r]=mE(o);return t.setFields(e)}if(t.type==="array"){const e=t.optional();return e.innerType&&(e.innerType=mE(e.innerType)),e}return t.type==="tuple"?t.optional().clone({types:t.spec.types.map(mE)}):"optional"in t?t.optional():t}const Yae=(t,e)=>{const r=[...ym.normalizePath(e)];if(r.length===1)return r[0]in t;let o=r.pop(),c=ym.getter(ym.join(r),!0)(t);return!!(c&&o in c)};let yU=t=>Object.prototype.toString.call(t)==="[object Object]";function Qae(t,e){let r=Object.keys(t.fields);return Object.keys(e).filter(o=>r.indexOf(o)===-1)}const Jae=DG([]);function VO(t){return new OG(t)}class OG extends $u{constructor(e){super({type:"object",check(r){return yU(r)||typeof r=="function"}}),this.fields=Object.create(null),this._sortErrors=Jae,this._nodes=[],this._excludedEdges=[],this.withMutation(()=>{e&&this.shape(e)})}_cast(e,r={}){var o;let c=super._cast(e,r);if(c===void 0)return this.getDefault(r);if(!this._typeCheck(c))return c;let f=this.fields,_=(o=r.stripUnknown)!=null?o:this.spec.noUnknown,x=[].concat(this._nodes,Object.keys(c).filter(O=>!this._nodes.includes(O))),a={},I=Object.assign({},r,{parent:a,__validating:r.__validating||!1}),D=!1;for(const O of x){let F=f[O],Z=O in c;if(F){let J,ne=c[O];I.path=(r.path?`${r.path}.`:"")+O,F=F.resolve({value:ne,context:r.context,parent:a});let se=F instanceof $u?F.spec:void 0,W=se==null?void 0:se.strict;if(se!=null&&se.strip){D=D||O in c;continue}J=!r.__validating||!W?F.cast(c[O],I):c[O],J!==void 0&&(a[O]=J)}else Z&&!_&&(a[O]=c[O]);(Z!==O in a||a[O]!==c[O])&&(D=!0)}return D?a:c}_validate(e,r={},o,c){let{from:f=[],originalValue:_=e,recursive:x=this.spec.recursive}=r;r.from=[{schema:this,value:_},...f],r.__validating=!0,r.originalValue=_,super._validate(e,r,o,(a,I)=>{if(!x||!yU(I)){c(a,I);return}_=_||I;let D=[];for(let O of this._nodes){let F=this.fields[O];!F||ng.isRef(F)||D.push(F.asNestedTest({options:r,key:O,parent:I,parentPath:r.path,originalParent:_}))}this.runTests({tests:D,value:I,originalValue:_,options:r},o,O=>{c(O.sort(this._sortErrors).concat(a),I)})})}clone(e){const r=super.clone(e);return r.fields=Object.assign({},this.fields),r._nodes=this._nodes,r._excludedEdges=this._excludedEdges,r._sortErrors=this._sortErrors,r}concat(e){let r=super.concat(e),o=r.fields;for(let[c,f]of Object.entries(this.fields)){const _=o[c];o[c]=_===void 0?f:_}return r.withMutation(c=>c.setFields(o,[...this._excludedEdges,...e._excludedEdges]))}_getDefault(e){if("default"in this.spec)return super._getDefault(e);if(!this._nodes.length)return;let r={};return this._nodes.forEach(o=>{var c;const f=this.fields[o];let _=e;(c=_)!=null&&c.value&&(_=Object.assign({},_,{parent:_.value,value:_.value[o]})),r[o]=f&&"getDefault"in f?f.getDefault(_):void 0}),r}setFields(e,r){let o=this.clone();return o.fields=e,o._nodes=Xae(e,r),o._sortErrors=DG(Object.keys(e)),r&&(o._excludedEdges=r),o}shape(e,r=[]){return this.clone().withMutation(o=>{let c=o._excludedEdges;return r.length&&(Array.isArray(r[0])||(r=[r]),c=[...o._excludedEdges,...r]),o.setFields(Object.assign(o.fields,e),c)})}partial(){const e={};for(const[r,o]of Object.entries(this.fields))e[r]="optional"in o&&o.optional instanceof Function?o.optional():o;return this.setFields(e)}deepPartial(){return mE(this)}pick(e){const r={};for(const o of e)this.fields[o]&&(r[o]=this.fields[o]);return this.setFields(r,this._excludedEdges.filter(([o,c])=>e.includes(o)&&e.includes(c)))}omit(e){const r=[];for(const o of Object.keys(this.fields))e.includes(o)||r.push(o);return this.pick(r)}from(e,r,o){let c=ym.getter(e,!0);return this.transform(f=>{if(!f)return f;let _=f;return Yae(f,e)&&(_=Object.assign({},f),o||delete _[e],_[r]=c(f)),_})}json(){return this.transform(Kae)}noUnknown(e=!0,r=Xk.noUnknown){typeof e!="boolean"&&(r=e,e=!0);let o=this.test({name:"noUnknown",exclusive:!0,message:r,test(c){if(c==null)return!0;const f=Qae(this.schema,c);return!e||f.length===0||this.createError({params:{unknown:f.join(", ")}})}});return o.spec.noUnknown=e,o}unknown(e=!0,r=Xk.noUnknown){return this.noUnknown(!e,r)}transformKeys(e){return this.transform(r=>{if(!r)return r;const o={};for(const c of Object.keys(r))o[e(c)]=r[c];return o})}camelCase(){return this.transformKeys(eM.camelCase)}snakeCase(){return this.transformKeys(eM.snakeCase)}constantCase(){return this.transformKeys(e=>eM.snakeCase(e).toUpperCase())}describe(e){const r=(e?this.resolve(e):this).clone(),o=super.describe(e);o.fields={};for(const[f,_]of Object.entries(r.fields)){var c;let x=e;(c=x)!=null&&c.value&&(x=Object.assign({},x,{parent:x.value,value:x.value[f]})),o.fields[f]=_.describe(x)}return o}}VO.prototype=OG.prototype;var vU={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LG=function(t){const e=[];let r=0;for(let o=0;o<t.length;o++){let c=t.charCodeAt(o);c<128?e[r++]=c:c<2048?(e[r++]=c>>6|192,e[r++]=c&63|128):(c&64512)===55296&&o+1<t.length&&(t.charCodeAt(o+1)&64512)===56320?(c=65536+((c&1023)<<10)+(t.charCodeAt(++o)&1023),e[r++]=c>>18|240,e[r++]=c>>12&63|128,e[r++]=c>>6&63|128,e[r++]=c&63|128):(e[r++]=c>>12|224,e[r++]=c>>6&63|128,e[r++]=c&63|128)}return e},ele=function(t){const e=[];let r=0,o=0;for(;r<t.length;){const c=t[r++];if(c<128)e[o++]=String.fromCharCode(c);else if(c>191&&c<224){const f=t[r++];e[o++]=String.fromCharCode((c&31)<<6|f&63)}else if(c>239&&c<365){const f=t[r++],_=t[r++],x=t[r++],a=((c&7)<<18|(f&63)<<12|(_&63)<<6|x&63)-65536;e[o++]=String.fromCharCode(55296+(a>>10)),e[o++]=String.fromCharCode(56320+(a&1023))}else{const f=t[r++],_=t[r++];e[o++]=String.fromCharCode((c&15)<<12|(f&63)<<6|_&63)}}return e.join("")},zG={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let c=0;c<t.length;c+=3){const f=t[c],_=c+1<t.length,x=_?t[c+1]:0,a=c+2<t.length,I=a?t[c+2]:0,D=f>>2,O=(f&3)<<4|x>>4;let F=(x&15)<<2|I>>6,Z=I&63;a||(Z=64,_||(F=64)),o.push(r[D],r[O],r[F],r[Z])}return o.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(LG(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):ele(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let c=0;c<t.length;){const f=r[t.charAt(c++)],x=c<t.length?r[t.charAt(c)]:0;++c;const I=c<t.length?r[t.charAt(c)]:64;++c;const O=c<t.length?r[t.charAt(c)]:64;if(++c,f==null||x==null||I==null||O==null)throw new tle;const F=f<<2|x>>4;if(o.push(F),I!==64){const Z=x<<4&240|I>>2;if(o.push(Z),O!==64){const J=I<<6&192|O;o.push(J)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class tle extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const nle=function(t){const e=LG(t);return zG.encodeByteArray(e,!0)},mS=function(t){return nle(t).replace(/\./g,"")},NG=function(t){try{return zG.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rle(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ile=()=>rle().__FIREBASE_DEFAULTS__,sle=()=>{if(typeof process>"u"||typeof vU>"u")return;const t=vU.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},ole=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&NG(t[1]);return e&&JSON.parse(e)},GI=()=>{try{return ile()||sle()||ole()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},FG=t=>{var e,r;return(r=(e=GI())===null||e===void 0?void 0:e.emulatorHosts)===null||r===void 0?void 0:r[t]},BG=t=>{const e=FG(t);if(!e)return;const r=e.lastIndexOf(":");if(r<=0||r+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(r+1),10);return e[0]==="["?[e.substring(1,r-1),o]:[e.substring(0,r),o]},jG=()=>{var t;return(t=GI())===null||t===void 0?void 0:t.config},UG=t=>{var e;return(e=GI())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ale{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}wrapCallback(e){return(r,o)=>{r?this.reject(r):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(r):e(r,o))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VG(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r={alg:"none",type:"JWT"},o=e||"demo-project",c=t.iat||0,f=t.sub||t.user_id;if(!f)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const _=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:c,exp:c+3600,auth_time:c,sub:f,user_id:f,firebase:{sign_in_provider:"custom",identities:{}}},t);return[mS(JSON.stringify(r)),mS(JSON.stringify(_)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ia(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function lle(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ia())}function cle(){var t;const e=(t=GI())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function ule(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function hle(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function dle(){const t=ia();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function fle(){return!cle()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ple(){try{return typeof indexedDB=="object"}catch{return!1}}function mle(){return new Promise((t,e)=>{try{let r=!0;const o="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(o);c.onsuccess=()=>{c.result.close(),r||self.indexedDB.deleteDatabase(o),t(!0)},c.onupgradeneeded=()=>{r=!1},c.onerror=()=>{var f;e(((f=c.error)===null||f===void 0?void 0:f.message)||"")}}catch(r){e(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gle="FirebaseError";class Zu extends Error{constructor(e,r,o){super(r),this.code=e,this.customData=o,this.name=gle,Object.setPrototypeOf(this,Zu.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,X1.prototype.create)}}class X1{constructor(e,r,o){this.service=e,this.serviceName=r,this.errors=o}create(e,...r){const o=r[0]||{},c=`${this.service}/${e}`,f=this.errors[e],_=f?_le(f,o):"Error",x=`${this.serviceName}: ${_} (${c}).`;return new Zu(c,x,o)}}function _le(t,e){return t.replace(yle,(r,o)=>{const c=e[o];return c!=null?String(c):`<${o}?>`})}const yle=/\{\$([^}]+)}/g;function vle(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function by(t,e){if(t===e)return!0;const r=Object.keys(t),o=Object.keys(e);for(const c of r){if(!o.includes(c))return!1;const f=t[c],_=e[c];if(xU(f)&&xU(_)){if(!by(f,_))return!1}else if(f!==_)return!1}for(const c of o)if(!r.includes(c))return!1;return!0}function xU(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K1(t){const e=[];for(const[r,o]of Object.entries(t))Array.isArray(o)?o.forEach(c=>{e.push(encodeURIComponent(r)+"="+encodeURIComponent(c))}):e.push(encodeURIComponent(r)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function Jv(t){const e={};return t.replace(/^\?/,"").split("&").forEach(o=>{if(o){const[c,f]=o.split("=");e[decodeURIComponent(c)]=decodeURIComponent(f)}}),e}function ex(t){const e=t.indexOf("?");if(!e)return"";const r=t.indexOf("#",e);return t.substring(e,r>0?r:void 0)}function xle(t,e){const r=new ble(t,e);return r.subscribe.bind(r)}class ble{constructor(e,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{e(this)}).catch(o=>{this.error(o)})}next(e){this.forEachObserver(r=>{r.next(e)})}error(e){this.forEachObserver(r=>{r.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,r,o){let c;if(e===void 0&&r===void 0&&o===void 0)throw new Error("Missing Observer.");wle(e,["next","error","complete"])?c=e:c={next:e,error:r,complete:o},c.next===void 0&&(c.next=tM),c.error===void 0&&(c.error=tM),c.complete===void 0&&(c.complete=tM);const f=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?c.error(this.finalError):c.complete()}catch{}}),this.observers.push(c),f}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,e)}sendOne(e,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{r(this.observers[e])}catch(o){typeof console<"u"&&console.error&&console.error(o)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function wle(t,e){if(typeof t!="object"||t===null)return!1;for(const r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}function tM(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gs(t){return t&&t._delegate?t._delegate:t}class Ff{constructor(e,r,o){this.name=e,this.instanceFactory=r,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nm="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tle{constructor(e,r){this.name=e,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const r=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(r)){const o=new ale;if(this.instancesDeferred.set(r,o),this.isInitialized(r)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:r});c&&o.resolve(c)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(e){var r;const o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),c=(r=e==null?void 0:e.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(f){if(c)return null;throw f}else{if(c)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Sle(e))try{this.getOrInitializeService({instanceIdentifier:nm})}catch{}for(const[r,o]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(r);try{const f=this.getOrInitializeService({instanceIdentifier:c});o.resolve(f)}catch{}}}}clearInstance(e=nm){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...e.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=nm){return this.instances.has(e)}getOptions(e=nm){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:r={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:o,options:r});for(const[f,_]of this.instancesDeferred.entries()){const x=this.normalizeInstanceIdentifier(f);o===x&&_.resolve(c)}return c}onInit(e,r){var o;const c=this.normalizeInstanceIdentifier(r),f=(o=this.onInitCallbacks.get(c))!==null&&o!==void 0?o:new Set;f.add(e),this.onInitCallbacks.set(c,f);const _=this.instances.get(c);return _&&e(_,c),()=>{f.delete(e)}}invokeOnInitCallbacks(e,r){const o=this.onInitCallbacks.get(r);if(o)for(const c of o)try{c(e,r)}catch{}}getOrInitializeService({instanceIdentifier:e,options:r={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:Ele(e),options:r}),this.instances.set(e,o),this.instancesOptions.set(e,r),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=nm){return this.component?this.component.multipleInstances?e:nm:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ele(t){return t===nm?void 0:t}function Sle(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ile{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const r=this.getProvider(e.name);if(r.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);r.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const r=new Tle(e,this);return this.providers.set(e,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ri;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(ri||(ri={}));const Ale={debug:ri.DEBUG,verbose:ri.VERBOSE,info:ri.INFO,warn:ri.WARN,error:ri.ERROR,silent:ri.SILENT},Cle=ri.INFO,Ple={[ri.DEBUG]:"log",[ri.VERBOSE]:"log",[ri.INFO]:"info",[ri.WARN]:"warn",[ri.ERROR]:"error"},Rle=(t,e,...r)=>{if(e<t.logLevel)return;const o=new Date().toISOString(),c=Ple[e];if(c)console[c](`[${o}]  ${t.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class $O{constructor(e){this.name=e,this._logLevel=Cle,this._logHandler=Rle,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ri))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Ale[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ri.DEBUG,...e),this._logHandler(this,ri.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ri.VERBOSE,...e),this._logHandler(this,ri.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ri.INFO,...e),this._logHandler(this,ri.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ri.WARN,...e),this._logHandler(this,ri.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ri.ERROR,...e),this._logHandler(this,ri.ERROR,...e)}}const Mle=(t,e)=>e.some(r=>t instanceof r);let bU,wU;function kle(){return bU||(bU=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Dle(){return wU||(wU=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const $G=new WeakMap,Yk=new WeakMap,GG=new WeakMap,nM=new WeakMap,GO=new WeakMap;function Ole(t){const e=new Promise((r,o)=>{const c=()=>{t.removeEventListener("success",f),t.removeEventListener("error",_)},f=()=>{r(Rf(t.result)),c()},_=()=>{o(t.error),c()};t.addEventListener("success",f),t.addEventListener("error",_)});return e.then(r=>{r instanceof IDBCursor&&$G.set(r,t)}).catch(()=>{}),GO.set(e,t),e}function Lle(t){if(Yk.has(t))return;const e=new Promise((r,o)=>{const c=()=>{t.removeEventListener("complete",f),t.removeEventListener("error",_),t.removeEventListener("abort",_)},f=()=>{r(),c()},_=()=>{o(t.error||new DOMException("AbortError","AbortError")),c()};t.addEventListener("complete",f),t.addEventListener("error",_),t.addEventListener("abort",_)});Yk.set(t,e)}let Qk={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return Yk.get(t);if(e==="objectStoreNames")return t.objectStoreNames||GG.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Rf(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function zle(t){Qk=t(Qk)}function Nle(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){const o=t.call(rM(this),e,...r);return GG.set(o,e.sort?e.sort():[e]),Rf(o)}:Dle().includes(t)?function(...e){return t.apply(rM(this),e),Rf($G.get(this))}:function(...e){return Rf(t.apply(rM(this),e))}}function Fle(t){return typeof t=="function"?Nle(t):(t instanceof IDBTransaction&&Lle(t),Mle(t,kle())?new Proxy(t,Qk):t)}function Rf(t){if(t instanceof IDBRequest)return Ole(t);if(nM.has(t))return nM.get(t);const e=Fle(t);return e!==t&&(nM.set(t,e),GO.set(e,t)),e}const rM=t=>GO.get(t);function Ble(t,e,{blocked:r,upgrade:o,blocking:c,terminated:f}={}){const _=indexedDB.open(t,e),x=Rf(_);return o&&_.addEventListener("upgradeneeded",a=>{o(Rf(_.result),a.oldVersion,a.newVersion,Rf(_.transaction),a)}),r&&_.addEventListener("blocked",a=>r(a.oldVersion,a.newVersion,a)),x.then(a=>{f&&a.addEventListener("close",()=>f()),c&&a.addEventListener("versionchange",I=>c(I.oldVersion,I.newVersion,I))}).catch(()=>{}),x}const jle=["get","getKey","getAll","getAllKeys","count"],Ule=["put","add","delete","clear"],iM=new Map;function TU(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(iM.get(e))return iM.get(e);const r=e.replace(/FromIndex$/,""),o=e!==r,c=Ule.includes(r);if(!(r in(o?IDBIndex:IDBObjectStore).prototype)||!(c||jle.includes(r)))return;const f=async function(_,...x){const a=this.transaction(_,c?"readwrite":"readonly");let I=a.store;return o&&(I=I.index(x.shift())),(await Promise.all([I[r](...x),c&&a.done]))[0]};return iM.set(e,f),f}zle(t=>({...t,get:(e,r,o)=>TU(e,r)||t.get(e,r,o),has:(e,r)=>!!TU(e,r)||t.has(e,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vle{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(r=>{if($le(r)){const o=r.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(r=>r).join(" ")}}function $le(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Jk="@firebase/app",EU="0.10.10";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wh=new $O("@firebase/app"),Gle="@firebase/app-compat",qle="@firebase/analytics-compat",Wle="@firebase/analytics",Hle="@firebase/app-check-compat",Zle="@firebase/app-check",Xle="@firebase/auth",Kle="@firebase/auth-compat",Yle="@firebase/database",Qle="@firebase/database-compat",Jle="@firebase/functions",ece="@firebase/functions-compat",tce="@firebase/installations",nce="@firebase/installations-compat",rce="@firebase/messaging",ice="@firebase/messaging-compat",sce="@firebase/performance",oce="@firebase/performance-compat",ace="@firebase/remote-config",lce="@firebase/remote-config-compat",cce="@firebase/storage",uce="@firebase/storage-compat",hce="@firebase/firestore",dce="@firebase/vertexai-preview",fce="@firebase/firestore-compat",pce="firebase",mce="10.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e3="[DEFAULT]",gce={[Jk]:"fire-core",[Gle]:"fire-core-compat",[Wle]:"fire-analytics",[qle]:"fire-analytics-compat",[Zle]:"fire-app-check",[Hle]:"fire-app-check-compat",[Xle]:"fire-auth",[Kle]:"fire-auth-compat",[Yle]:"fire-rtdb",[Qle]:"fire-rtdb-compat",[Jle]:"fire-fn",[ece]:"fire-fn-compat",[tce]:"fire-iid",[nce]:"fire-iid-compat",[rce]:"fire-fcm",[ice]:"fire-fcm-compat",[sce]:"fire-perf",[oce]:"fire-perf-compat",[ace]:"fire-rc",[lce]:"fire-rc-compat",[cce]:"fire-gcs",[uce]:"fire-gcs-compat",[hce]:"fire-fst",[fce]:"fire-fst-compat",[dce]:"fire-vertex","fire-js":"fire-js",[pce]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gS=new Map,_ce=new Map,t3=new Map;function SU(t,e){try{t.container.addComponent(e)}catch(r){Wh.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,r)}}function Dm(t){const e=t.name;if(t3.has(e))return Wh.debug(`There were multiple attempts to register component ${e}.`),!1;t3.set(e,t);for(const r of gS.values())SU(r,t);for(const r of _ce.values())SU(r,t);return!0}function qI(t,e){const r=t.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),t.container.getProvider(e)}function Lc(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yce={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Mf=new X1("app","Firebase",yce);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vce{constructor(e,r,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new Ff("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Mf.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rg=mce;function qG(t,e={}){let r=t;typeof e!="object"&&(e={name:e});const o=Object.assign({name:e3,automaticDataCollectionEnabled:!1},e),c=o.name;if(typeof c!="string"||!c)throw Mf.create("bad-app-name",{appName:String(c)});if(r||(r=jG()),!r)throw Mf.create("no-options");const f=gS.get(c);if(f){if(by(r,f.options)&&by(o,f.config))return f;throw Mf.create("duplicate-app",{appName:c})}const _=new Ile(c);for(const a of t3.values())_.addComponent(a);const x=new vce(r,o,_);return gS.set(c,x),x}function qO(t=e3){const e=gS.get(t);if(!e&&t===e3&&jG())return qG();if(!e)throw Mf.create("no-app",{appName:t});return e}function Fu(t,e,r){var o;let c=(o=gce[t])!==null&&o!==void 0?o:t;r&&(c+=`-${r}`);const f=c.match(/\s|\//),_=e.match(/\s|\//);if(f||_){const x=[`Unable to register library "${c}" with version "${e}":`];f&&x.push(`library name "${c}" contains illegal characters (whitespace or "/")`),f&&_&&x.push("and"),_&&x.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Wh.warn(x.join(" "));return}Dm(new Ff(`${c}-version`,()=>({library:c,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xce="firebase-heartbeat-database",bce=1,p1="firebase-heartbeat-store";let sM=null;function WG(){return sM||(sM=Ble(xce,bce,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(p1)}catch(r){console.warn(r)}}}}).catch(t=>{throw Mf.create("idb-open",{originalErrorMessage:t.message})})),sM}async function wce(t){try{const r=(await WG()).transaction(p1),o=await r.objectStore(p1).get(HG(t));return await r.done,o}catch(e){if(e instanceof Zu)Wh.warn(e.message);else{const r=Mf.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Wh.warn(r.message)}}}async function IU(t,e){try{const o=(await WG()).transaction(p1,"readwrite");await o.objectStore(p1).put(e,HG(t)),await o.done}catch(r){if(r instanceof Zu)Wh.warn(r.message);else{const o=Mf.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});Wh.warn(o.message)}}}function HG(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tce=1024,Ece=30*24*60*60*1e3;class Sce{constructor(e){this.container=e,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new Ace(r),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){var e,r;try{const c=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),f=AU();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===f||this._heartbeatsCache.heartbeats.some(_=>_.date===f)?void 0:(this._heartbeatsCache.heartbeats.push({date:f,agent:c}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(_=>{const x=new Date(_.date).valueOf();return Date.now()-x<=Ece}),this._storage.overwrite(this._heartbeatsCache))}catch(o){Wh.warn(o)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const r=AU(),{heartbeatsToSend:o,unsentEntries:c}=Ice(this._heartbeatsCache.heartbeats),f=mS(JSON.stringify({version:2,heartbeats:o}));return this._heartbeatsCache.lastSentHeartbeatDate=r,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),f}catch(r){return Wh.warn(r),""}}}function AU(){return new Date().toISOString().substring(0,10)}function Ice(t,e=Tce){const r=[];let o=t.slice();for(const c of t){const f=r.find(_=>_.agent===c.agent);if(f){if(f.dates.push(c.date),CU(r)>e){f.dates.pop();break}}else if(r.push({agent:c.agent,dates:[c.date]}),CU(r)>e){r.pop();break}o=o.slice(1)}return{heartbeatsToSend:r,unsentEntries:o}}class Ace{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ple()?mle().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const r=await wce(this.app);return r!=null&&r.heartbeats?r:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var r;if(await this._canUseIndexedDBPromise){const c=await this.read();return IU(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:c.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var r;if(await this._canUseIndexedDBPromise){const c=await this.read();return IU(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...e.heartbeats]})}else return}}function CU(t){return mS(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cce(t){Dm(new Ff("platform-logger",e=>new Vle(e),"PRIVATE")),Dm(new Ff("heartbeat",e=>new Sce(e),"PRIVATE")),Fu(Jk,EU,t),Fu(Jk,EU,"esm2017"),Fu("fire-js","")}Cce("");var Pce="firebase",Rce="10.13.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Fu(Pce,Rce,"app");function WO(t,e){var r={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(r[o]=t[o]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,o=Object.getOwnPropertySymbols(t);c<o.length;c++)e.indexOf(o[c])<0&&Object.prototype.propertyIsEnumerable.call(t,o[c])&&(r[o[c]]=t[o[c]]);return r}function ZG(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Mce=ZG,XG=new X1("auth","Firebase",ZG());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _S=new $O("@firebase/auth");function kce(t,...e){_S.logLevel<=ri.WARN&&_S.warn(`Auth (${rg}): ${t}`,...e)}function gE(t,...e){_S.logLevel<=ri.ERROR&&_S.error(`Auth (${rg}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ql(t,...e){throw ZO(t,...e)}function Bc(t,...e){return ZO(t,...e)}function HO(t,e,r){const o=Object.assign(Object.assign({},Mce()),{[e]:r});return new X1("auth","Firebase",o).create(e,{appName:t.name})}function Bh(t){return HO(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Dce(t,e,r){const o=r;if(!(e instanceof o))throw o.name!==e.constructor.name&&Ql(t,"argument-error"),HO(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ZO(t,...e){if(typeof t!="string"){const r=e[0],o=[...e.slice(1)];return o[0]&&(o[0].appName=t.name),t._errorFactory.create(r,...o)}return XG.create(t,...e)}function br(t,e,...r){if(!t)throw ZO(e,...r)}function Lh(t){const e="INTERNAL ASSERTION FAILED: "+t;throw gE(e),new Error(e)}function Hh(t,e){t||Lh(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n3(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function Oce(){return PU()==="http:"||PU()==="https:"}function PU(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lce(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Oce()||ule()||"connection"in navigator)?navigator.onLine:!0}function zce(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y1{constructor(e,r){this.shortDelay=e,this.longDelay=r,Hh(r>e,"Short delay should be less than long delay!"),this.isMobile=lle()||hle()}get(){return Lce()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XO(t,e){Hh(t.emulator,"Emulator should always be set here");const{url:r}=t.emulator;return e?`${r}${e.startsWith("/")?e.slice(1):e}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KG{static initialize(e,r,o){this.fetchImpl=e,r&&(this.headersImpl=r),o&&(this.responseImpl=o)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Lh("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Lh("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Lh("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nce={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fce=new Y1(3e4,6e4);function Kf(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Yf(t,e,r,o,c={}){return YG(t,c,async()=>{let f={},_={};o&&(e==="GET"?_=o:f={body:JSON.stringify(o)});const x=K1(Object.assign({key:t.config.apiKey},_)).slice(1),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/json",t.languageCode&&(a["X-Firebase-Locale"]=t.languageCode),KG.fetch()(QG(t,t.config.apiHost,r,x),Object.assign({method:e,headers:a,referrerPolicy:"no-referrer"},f))})}async function YG(t,e,r){t._canInitEmulator=!1;const o=Object.assign(Object.assign({},Nce),e);try{const c=new jce(t),f=await Promise.race([r(),c.promise]);c.clearNetworkTimeout();const _=await f.json();if("needConfirmation"in _)throw zT(t,"account-exists-with-different-credential",_);if(f.ok&&!("errorMessage"in _))return _;{const x=f.ok?_.errorMessage:_.error.message,[a,I]=x.split(" : ");if(a==="FEDERATED_USER_ID_ALREADY_LINKED")throw zT(t,"credential-already-in-use",_);if(a==="EMAIL_EXISTS")throw zT(t,"email-already-in-use",_);if(a==="USER_DISABLED")throw zT(t,"user-disabled",_);const D=o[a]||a.toLowerCase().replace(/[_\s]+/g,"-");if(I)throw HO(t,D,I);Ql(t,D)}}catch(c){if(c instanceof Zu)throw c;Ql(t,"network-request-failed",{message:String(c)})}}async function Q1(t,e,r,o,c={}){const f=await Yf(t,e,r,o,c);return"mfaPendingCredential"in f&&Ql(t,"multi-factor-auth-required",{_serverResponse:f}),f}function QG(t,e,r,o){const c=`${e}${r}?${o}`;return t.config.emulator?XO(t.config,c):`${t.config.apiScheme}://${c}`}function Bce(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class jce{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((r,o)=>{this.timer=setTimeout(()=>o(Bc(this.auth,"network-request-failed")),Fce.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function zT(t,e,r){const o={appName:t.name};r.email&&(o.email=r.email),r.phoneNumber&&(o.phoneNumber=r.phoneNumber);const c=Bc(t,e,o);return c.customData._tokenResponse=r,c}function RU(t){return t!==void 0&&t.enterprise!==void 0}class Uce{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const r of this.recaptchaEnforcementState)if(r.provider&&r.provider===e)return Bce(r.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function Vce(t,e){return Yf(t,"GET","/v2/recaptchaConfig",Kf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $ce(t,e){return Yf(t,"POST","/v1/accounts:delete",e)}async function JG(t,e){return Yf(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ax(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Gce(t,e=!1){const r=Gs(t),o=await r.getIdToken(e),c=KO(o);br(c&&c.exp&&c.auth_time&&c.iat,r.auth,"internal-error");const f=typeof c.firebase=="object"?c.firebase:void 0,_=f==null?void 0:f.sign_in_provider;return{claims:c,token:o,authTime:Ax(oM(c.auth_time)),issuedAtTime:Ax(oM(c.iat)),expirationTime:Ax(oM(c.exp)),signInProvider:_||null,signInSecondFactor:(f==null?void 0:f.sign_in_second_factor)||null}}function oM(t){return Number(t)*1e3}function KO(t){const[e,r,o]=t.split(".");if(e===void 0||r===void 0||o===void 0)return gE("JWT malformed, contained fewer than 3 sections"),null;try{const c=NG(r);return c?JSON.parse(c):(gE("Failed to decode base64 JWT payload"),null)}catch(c){return gE("Caught error parsing JWT payload as JSON",c==null?void 0:c.toString()),null}}function MU(t){const e=KO(t);return br(e,"internal-error"),br(typeof e.exp<"u","internal-error"),br(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m1(t,e,r=!1){if(r)return e;try{return await e}catch(o){throw o instanceof Zu&&qce(o)&&t.auth.currentUser===t&&await t.auth.signOut(),o}}function qce({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wce{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var r;if(e){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const c=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,c)}}schedule(e=!1){if(!this.isRunning)return;const r=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r3{constructor(e,r){this.createdAt=e,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ax(this.lastLoginAt),this.creationTime=Ax(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yS(t){var e;const r=t.auth,o=await t.getIdToken(),c=await m1(t,JG(r,{idToken:o}));br(c==null?void 0:c.users.length,r,"internal-error");const f=c.users[0];t._notifyReloadListener(f);const _=!((e=f.providerUserInfo)===null||e===void 0)&&e.length?eq(f.providerUserInfo):[],x=Zce(t.providerData,_),a=t.isAnonymous,I=!(t.email&&f.passwordHash)&&!(x!=null&&x.length),D=a?I:!1,O={uid:f.localId,displayName:f.displayName||null,photoURL:f.photoUrl||null,email:f.email||null,emailVerified:f.emailVerified||!1,phoneNumber:f.phoneNumber||null,tenantId:f.tenantId||null,providerData:x,metadata:new r3(f.createdAt,f.lastLoginAt),isAnonymous:D};Object.assign(t,O)}async function Hce(t){const e=Gs(t);await yS(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Zce(t,e){return[...t.filter(o=>!e.some(c=>c.providerId===o.providerId)),...e]}function eq(t){return t.map(e=>{var{providerId:r}=e,o=WO(e,["providerId"]);return{providerId:r,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xce(t,e){const r=await YG(t,{},async()=>{const o=K1({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:c,apiKey:f}=t.config,_=QG(t,c,"/v1/token",`key=${f}`),x=await t._getAdditionalHeaders();return x["Content-Type"]="application/x-www-form-urlencoded",KG.fetch()(_,{method:"POST",headers:x,body:o})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function Kce(t,e){return Yf(t,"POST","/v2/accounts:revokeToken",Kf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iy{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){br(e.idToken,"internal-error"),br(typeof e.idToken<"u","internal-error"),br(typeof e.refreshToken<"u","internal-error");const r="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):MU(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,r)}updateFromIdToken(e){br(e.length!==0,"internal-error");const r=MU(e);this.updateTokensAndExpiration(e,null,r)}async getToken(e,r=!1){return!r&&this.accessToken&&!this.isExpired?this.accessToken:(br(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,r){const{accessToken:o,refreshToken:c,expiresIn:f}=await Xce(e,r);this.updateTokensAndExpiration(o,c,Number(f))}updateTokensAndExpiration(e,r,o){this.refreshToken=r||null,this.accessToken=e||null,this.expirationTime=Date.now()+o*1e3}static fromJSON(e,r){const{refreshToken:o,accessToken:c,expirationTime:f}=r,_=new iy;return o&&(br(typeof o=="string","internal-error",{appName:e}),_.refreshToken=o),c&&(br(typeof c=="string","internal-error",{appName:e}),_.accessToken=c),f&&(br(typeof f=="number","internal-error",{appName:e}),_.expirationTime=f),_}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new iy,this.toJSON())}_performRefresh(){return Lh("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kd(t,e){br(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class zh{constructor(e){var{uid:r,auth:o,stsTokenManager:c}=e,f=WO(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Wce(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=o,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=f.displayName||null,this.email=f.email||null,this.emailVerified=f.emailVerified||!1,this.phoneNumber=f.phoneNumber||null,this.photoURL=f.photoURL||null,this.isAnonymous=f.isAnonymous||!1,this.tenantId=f.tenantId||null,this.providerData=f.providerData?[...f.providerData]:[],this.metadata=new r3(f.createdAt||void 0,f.lastLoginAt||void 0)}async getIdToken(e){const r=await m1(this,this.stsTokenManager.getToken(this.auth,e));return br(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(e){return Gce(this,e)}reload(){return Hce(this)}_assign(e){this!==e&&(br(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(r=>Object.assign({},r)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const r=new zh(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(e){br(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,r=!1){let o=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),o=!0),r&&await yS(this),await this.auth._persistUserIfCurrent(this),o&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Lc(this.auth.app))return Promise.reject(Bh(this.auth));const e=await this.getIdToken();return await m1(this,$ce(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,r){var o,c,f,_,x,a,I,D;const O=(o=r.displayName)!==null&&o!==void 0?o:void 0,F=(c=r.email)!==null&&c!==void 0?c:void 0,Z=(f=r.phoneNumber)!==null&&f!==void 0?f:void 0,J=(_=r.photoURL)!==null&&_!==void 0?_:void 0,ne=(x=r.tenantId)!==null&&x!==void 0?x:void 0,se=(a=r._redirectEventId)!==null&&a!==void 0?a:void 0,W=(I=r.createdAt)!==null&&I!==void 0?I:void 0,Q=(D=r.lastLoginAt)!==null&&D!==void 0?D:void 0,{uid:K,emailVerified:pe,isAnonymous:Te,providerData:we,stsTokenManager:oe}=r;br(K&&oe,e,"internal-error");const de=iy.fromJSON(this.name,oe);br(typeof K=="string",e,"internal-error"),Kd(O,e.name),Kd(F,e.name),br(typeof pe=="boolean",e,"internal-error"),br(typeof Te=="boolean",e,"internal-error"),Kd(Z,e.name),Kd(J,e.name),Kd(ne,e.name),Kd(se,e.name),Kd(W,e.name),Kd(Q,e.name);const X=new zh({uid:K,auth:e,email:F,emailVerified:pe,displayName:O,isAnonymous:Te,photoURL:J,phoneNumber:Z,tenantId:ne,stsTokenManager:de,createdAt:W,lastLoginAt:Q});return we&&Array.isArray(we)&&(X.providerData=we.map(ge=>Object.assign({},ge))),se&&(X._redirectEventId=se),X}static async _fromIdTokenResponse(e,r,o=!1){const c=new iy;c.updateFromServerResponse(r);const f=new zh({uid:r.localId,auth:e,stsTokenManager:c,isAnonymous:o});return await yS(f),f}static async _fromGetAccountInfoResponse(e,r,o){const c=r.users[0];br(c.localId!==void 0,"internal-error");const f=c.providerUserInfo!==void 0?eq(c.providerUserInfo):[],_=!(c.email&&c.passwordHash)&&!(f!=null&&f.length),x=new iy;x.updateFromIdToken(o);const a=new zh({uid:c.localId,auth:e,stsTokenManager:x,isAnonymous:_}),I={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:f,metadata:new r3(c.createdAt,c.lastLoginAt),isAnonymous:!(c.email&&c.passwordHash)&&!(f!=null&&f.length)};return Object.assign(a,I),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kU=new Map;function Nh(t){Hh(t instanceof Function,"Expected a class definition");let e=kU.get(t);return e?(Hh(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,kU.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tq{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,r){this.storage[e]=r}async _get(e){const r=this.storage[e];return r===void 0?null:r}async _remove(e){delete this.storage[e]}_addListener(e,r){}_removeListener(e,r){}}tq.type="NONE";const DU=tq;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _E(t,e,r){return`firebase:${t}:${e}:${r}`}class sy{constructor(e,r,o){this.persistence=e,this.auth=r,this.userKey=o;const{config:c,name:f}=this.auth;this.fullUserKey=_E(this.userKey,c.apiKey,f),this.fullPersistenceKey=_E("persistence",c.apiKey,f),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?zh._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,r,o="authUser"){if(!r.length)return new sy(Nh(DU),e,o);const c=(await Promise.all(r.map(async I=>{if(await I._isAvailable())return I}))).filter(I=>I);let f=c[0]||Nh(DU);const _=_E(o,e.config.apiKey,e.name);let x=null;for(const I of r)try{const D=await I._get(_);if(D){const O=zh._fromJSON(e,D);I!==f&&(x=O),f=I;break}}catch{}const a=c.filter(I=>I._shouldAllowMigration);return!f._shouldAllowMigration||!a.length?new sy(f,e,o):(f=a[0],x&&await f._set(_,x.toJSON()),await Promise.all(r.map(async I=>{if(I!==f)try{await I._remove(_)}catch{}})),new sy(f,e,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OU(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(sq(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(nq(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(aq(e))return"Blackberry";if(lq(e))return"Webos";if(rq(e))return"Safari";if((e.includes("chrome/")||iq(e))&&!e.includes("edge/"))return"Chrome";if(oq(e))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,o=t.match(r);if((o==null?void 0:o.length)===2)return o[1]}return"Other"}function nq(t=ia()){return/firefox\//i.test(t)}function rq(t=ia()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function iq(t=ia()){return/crios\//i.test(t)}function sq(t=ia()){return/iemobile/i.test(t)}function oq(t=ia()){return/android/i.test(t)}function aq(t=ia()){return/blackberry/i.test(t)}function lq(t=ia()){return/webos/i.test(t)}function YO(t=ia()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function Yce(t=ia()){var e;return YO(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Qce(){return dle()&&document.documentMode===10}function cq(t=ia()){return YO(t)||oq(t)||lq(t)||aq(t)||/windows phone/i.test(t)||sq(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uq(t,e=[]){let r;switch(t){case"Browser":r=OU(ia());break;case"Worker":r=`${OU(ia())}-${t}`;break;default:r=t}const o=e.length?e.join(","):"FirebaseCore-web";return`${r}/JsCore/${rg}/${o}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jce{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,r){const o=f=>new Promise((_,x)=>{try{const a=e(f);_(a)}catch(a){x(a)}});o.onAbort=r,this.queue.push(o);const c=this.queue.length-1;return()=>{this.queue[c]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const r=[];try{for(const o of this.queue)await o(e),o.onAbort&&r.push(o.onAbort)}catch(o){r.reverse();for(const c of r)try{c()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:o==null?void 0:o.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eue(t,e={}){return Yf(t,"GET","/v2/passwordPolicy",Kf(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tue=6;class nue{constructor(e){var r,o,c,f;const _=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(r=_.minPasswordLength)!==null&&r!==void 0?r:tue,_.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=_.maxPasswordLength),_.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=_.containsLowercaseCharacter),_.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=_.containsUppercaseCharacter),_.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=_.containsNumericCharacter),_.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=_.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(c=(o=e.allowedNonAlphanumericCharacters)===null||o===void 0?void 0:o.join(""))!==null&&c!==void 0?c:"",this.forceUpgradeOnSignin=(f=e.forceUpgradeOnSignin)!==null&&f!==void 0?f:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var r,o,c,f,_,x;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=(r=a.meetsMinPasswordLength)!==null&&r!==void 0?r:!0),a.isValid&&(a.isValid=(o=a.meetsMaxPasswordLength)!==null&&o!==void 0?o:!0),a.isValid&&(a.isValid=(c=a.containsLowercaseLetter)!==null&&c!==void 0?c:!0),a.isValid&&(a.isValid=(f=a.containsUppercaseLetter)!==null&&f!==void 0?f:!0),a.isValid&&(a.isValid=(_=a.containsNumericCharacter)!==null&&_!==void 0?_:!0),a.isValid&&(a.isValid=(x=a.containsNonAlphanumericCharacter)!==null&&x!==void 0?x:!0),a}validatePasswordLengthOptions(e,r){const o=this.customStrengthOptions.minPasswordLength,c=this.customStrengthOptions.maxPasswordLength;o&&(r.meetsMinPasswordLength=e.length>=o),c&&(r.meetsMaxPasswordLength=e.length<=c)}validatePasswordCharacterOptions(e,r){this.updatePasswordCharacterOptionsStatuses(r,!1,!1,!1,!1);let o;for(let c=0;c<e.length;c++)o=e.charAt(c),this.updatePasswordCharacterOptionsStatuses(r,o>="a"&&o<="z",o>="A"&&o<="Z",o>="0"&&o<="9",this.allowedNonAlphanumericCharacters.includes(o))}updatePasswordCharacterOptionsStatuses(e,r,o,c,f){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=r)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=o)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=c)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rue{constructor(e,r,o,c){this.app=e,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=o,this.config=c,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new LU(this),this.idTokenSubscription=new LU(this),this.beforeStateQueue=new Jce(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=XG,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=c.sdkClientVersion}_initializeWithPersistence(e,r){return r&&(this._popupRedirectResolver=Nh(r)),this._initializationPromise=this.queue(async()=>{var o,c;if(!this._deleted&&(this.persistenceManager=await sy.create(this,e),!this._deleted)){if(!((o=this._popupRedirectResolver)===null||o===void 0)&&o._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((c=this.currentUser)===null||c===void 0?void 0:c.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const r=await JG(this,{idToken:e}),o=await zh._fromGetAccountInfoResponse(this,r,e);await this.directlySetCurrentUser(o)}catch(r){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",r),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var r;if(Lc(this.app)){const _=this.app.settings.authIdToken;return _?new Promise(x=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(_).then(x,x))}):this.directlySetCurrentUser(null)}const o=await this.assertedPersistence.getCurrentUser();let c=o,f=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const _=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,x=c==null?void 0:c._redirectEventId,a=await this.tryRedirectSignIn(e);(!_||_===x)&&(a!=null&&a.user)&&(c=a.user,f=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(f)try{await this.beforeStateQueue.runMiddleware(c)}catch(_){c=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(_))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return br(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(e){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(e){try{await yS(e)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=zce()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Lc(this.app))return Promise.reject(Bh(this));const r=e?Gs(e):null;return r&&br(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(e,r=!1){if(!this._deleted)return e&&br(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Lc(this.app)?Promise.reject(Bh(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Lc(this.app)?Promise.reject(Bh(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Nh(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const r=this._getPasswordPolicyInternal();return r.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):r.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await eue(this),r=new nue(e);this.tenantId===null?this._projectPasswordPolicy=r:this._tenantPasswordPolicies[this.tenantId]=r}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new X1("auth","Firebase",e())}onAuthStateChanged(e,r,o){return this.registerStateListener(this.authStateSubscription,e,r,o)}beforeAuthStateChanged(e,r){return this.beforeStateQueue.pushCallback(e,r)}onIdTokenChanged(e,r,o){return this.registerStateListener(this.idTokenSubscription,e,r,o)}authStateReady(){return new Promise((e,r)=>{if(this.currentUser)e();else{const o=this.onAuthStateChanged(()=>{o(),e()},r)}})}async revokeAccessToken(e){if(this.currentUser){const r=await this.currentUser.getIdToken(),o={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:r};this.tenantId!=null&&(o.tenantId=this.tenantId),await Kce(this,o)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,r){const o=await this.getOrInitRedirectPersistenceManager(r);return e===null?o.removeCurrentUser():o.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const r=e&&Nh(e)||this._popupRedirectResolver;br(r,this,"argument-error"),this.redirectPersistenceManager=await sy.create(this,[Nh(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var r,o;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===e?this._currentUser:((o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const o=(r=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==o&&(this.lastNotifiedUid=o,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,r,o,c){if(this._deleted)return()=>{};const f=typeof r=="function"?r:r.next.bind(r);let _=!1;const x=this._isInitialized?Promise.resolve():this._initializationPromise;if(br(x,this,"internal-error"),x.then(()=>{_||f(this.currentUser)}),typeof r=="function"){const a=e.addObserver(r,o,c);return()=>{_=!0,a()}}else{const a=e.addObserver(r);return()=>{_=!0,a()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return br(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=uq(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const r={"X-Client-Version":this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const o=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());o&&(r["X-Firebase-Client"]=o);const c=await this._getAppCheckToken();return c&&(r["X-Firebase-AppCheck"]=c),r}async _getAppCheckToken(){var e;const r=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return r!=null&&r.error&&kce(`Error while retrieving App Check token: ${r.error}`),r==null?void 0:r.token}}function Qf(t){return Gs(t)}class LU{constructor(e){this.auth=e,this.observer=null,this.addObserver=xle(r=>this.observer=r)}get next(){return br(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let WI={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function iue(t){WI=t}function hq(t){return WI.loadJS(t)}function sue(){return WI.recaptchaEnterpriseScript}function oue(){return WI.gapiScript}function aue(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const lue="recaptcha-enterprise",cue="NO_RECAPTCHA";class uue{constructor(e){this.type=lue,this.auth=Qf(e)}async verify(e="verify",r=!1){async function o(f){if(!r){if(f.tenantId==null&&f._agentRecaptchaConfig!=null)return f._agentRecaptchaConfig.siteKey;if(f.tenantId!=null&&f._tenantRecaptchaConfigs[f.tenantId]!==void 0)return f._tenantRecaptchaConfigs[f.tenantId].siteKey}return new Promise(async(_,x)=>{Vce(f,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(a=>{if(a.recaptchaKey===void 0)x(new Error("recaptcha Enterprise site key undefined"));else{const I=new Uce(a);return f.tenantId==null?f._agentRecaptchaConfig=I:f._tenantRecaptchaConfigs[f.tenantId]=I,_(I.siteKey)}}).catch(a=>{x(a)})})}function c(f,_,x){const a=window.grecaptcha;RU(a)?a.enterprise.ready(()=>{a.enterprise.execute(f,{action:e}).then(I=>{_(I)}).catch(()=>{_(cue)})}):x(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((f,_)=>{o(this.auth).then(x=>{if(!r&&RU(window.grecaptcha))c(x,f,_);else{if(typeof window>"u"){_(new Error("RecaptchaVerifier is only supported in browser"));return}let a=sue();a.length!==0&&(a+=x),hq(a).then(()=>{c(x,f,_)}).catch(I=>{_(I)})}}).catch(x=>{_(x)})})}}async function zU(t,e,r,o=!1){const c=new uue(t);let f;try{f=await c.verify(r)}catch{f=await c.verify(r,!0)}const _=Object.assign({},e);return o?Object.assign(_,{captchaResp:f}):Object.assign(_,{captchaResponse:f}),Object.assign(_,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(_,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),_}async function i3(t,e,r,o){var c;if(!((c=t._getRecaptchaConfig())===null||c===void 0)&&c.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await zU(t,e,r,r==="getOobCode");return o(t,f)}else return o(t,e).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const _=await zU(t,e,r,r==="getOobCode");return o(t,_)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hue(t,e){const r=qI(t,"auth");if(r.isInitialized()){const c=r.getImmediate(),f=r.getOptions();if(by(f,e??{}))return c;Ql(c,"already-initialized")}return r.initialize({options:e})}function due(t,e){const r=(e==null?void 0:e.persistence)||[],o=(Array.isArray(r)?r:[r]).map(Nh);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(o,e==null?void 0:e.popupRedirectResolver)}function fue(t,e,r){const o=Qf(t);br(o._canInitEmulator,o,"emulator-config-failed"),br(/^https?:\/\//.test(e),o,"invalid-emulator-scheme");const c=!1,f=dq(e),{host:_,port:x}=pue(e),a=x===null?"":`:${x}`;o.config.emulator={url:`${f}//${_}${a}/`},o.settings.appVerificationDisabledForTesting=!0,o.emulatorConfig=Object.freeze({host:_,port:x,protocol:f.replace(":",""),options:Object.freeze({disableWarnings:c})}),mue()}function dq(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function pue(t){const e=dq(t),r=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!r)return{host:"",port:null};const o=r[2].split("@").pop()||"",c=/^(\[[^\]]+\])(:|$)/.exec(o);if(c){const f=c[1];return{host:f,port:NU(o.substr(f.length+1))}}else{const[f,_]=o.split(":");return{host:f,port:NU(_)}}}function NU(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function mue(){function t(){const e=document.createElement("p"),r=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QO{constructor(e,r){this.providerId=e,this.signInMethod=r}toJSON(){return Lh("not implemented")}_getIdTokenResponse(e){return Lh("not implemented")}_linkToIdToken(e,r){return Lh("not implemented")}_getReauthenticationResolver(e){return Lh("not implemented")}}async function gue(t,e){return Yf(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _ue(t,e){return Q1(t,"POST","/v1/accounts:signInWithPassword",Kf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yue(t,e){return Q1(t,"POST","/v1/accounts:signInWithEmailLink",Kf(t,e))}async function vue(t,e){return Q1(t,"POST","/v1/accounts:signInWithEmailLink",Kf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g1 extends QO{constructor(e,r,o,c=null){super("password",o),this._email=e,this._password=r,this._tenantId=c}static _fromEmailAndPassword(e,r){return new g1(e,r,"password")}static _fromEmailAndCode(e,r,o=null){return new g1(e,r,"emailLink",o)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e;if(r!=null&&r.email&&(r!=null&&r.password)){if(r.signInMethod==="password")return this._fromEmailAndPassword(r.email,r.password);if(r.signInMethod==="emailLink")return this._fromEmailAndCode(r.email,r.password,r.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const r={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return i3(e,r,"signInWithPassword",_ue);case"emailLink":return yue(e,{email:this._email,oobCode:this._password});default:Ql(e,"internal-error")}}async _linkToIdToken(e,r){switch(this.signInMethod){case"password":const o={idToken:r,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return i3(e,o,"signUpPassword",gue);case"emailLink":return vue(e,{idToken:r,email:this._email,oobCode:this._password});default:Ql(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oy(t,e){return Q1(t,"POST","/v1/accounts:signInWithIdp",Kf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xue="http://localhost";class Om extends QO{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const r=new Om(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(r.idToken=e.idToken),e.accessToken&&(r.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(r.nonce=e.nonce),e.pendingToken&&(r.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(r.accessToken=e.oauthToken,r.secret=e.oauthTokenSecret):Ql("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e,{providerId:o,signInMethod:c}=r,f=WO(r,["providerId","signInMethod"]);if(!o||!c)return null;const _=new Om(o,c);return _.idToken=f.idToken||void 0,_.accessToken=f.accessToken||void 0,_.secret=f.secret,_.nonce=f.nonce,_.pendingToken=f.pendingToken||null,_}_getIdTokenResponse(e){const r=this.buildRequest();return oy(e,r)}_linkToIdToken(e,r){const o=this.buildRequest();return o.idToken=r,oy(e,o)}_getReauthenticationResolver(e){const r=this.buildRequest();return r.autoCreate=!1,oy(e,r)}buildRequest(){const e={requestUri:xue,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),e.postBody=K1(r)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bue(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function wue(t){const e=Jv(ex(t)).link,r=e?Jv(ex(e)).deep_link_id:null,o=Jv(ex(t)).deep_link_id;return(o?Jv(ex(o)).link:null)||o||r||e||t}class JO{constructor(e){var r,o,c,f,_,x;const a=Jv(ex(e)),I=(r=a.apiKey)!==null&&r!==void 0?r:null,D=(o=a.oobCode)!==null&&o!==void 0?o:null,O=bue((c=a.mode)!==null&&c!==void 0?c:null);br(I&&D&&O,"argument-error"),this.apiKey=I,this.operation=O,this.code=D,this.continueUrl=(f=a.continueUrl)!==null&&f!==void 0?f:null,this.languageCode=(_=a.languageCode)!==null&&_!==void 0?_:null,this.tenantId=(x=a.tenantId)!==null&&x!==void 0?x:null}static parseLink(e){const r=wue(e);try{return new JO(r)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wy{constructor(){this.providerId=Wy.PROVIDER_ID}static credential(e,r){return g1._fromEmailAndPassword(e,r)}static credentialWithLink(e,r){const o=JO.parseLink(r);return br(o,"argument-error"),g1._fromEmailAndCode(e,o.code,o.tenantId)}}Wy.PROVIDER_ID="password";Wy.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Wy.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eL{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J1 extends eL{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class af extends J1{constructor(){super("facebook.com")}static credential(e){return Om._fromParams({providerId:af.PROVIDER_ID,signInMethod:af.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return af.credentialFromTaggedObject(e)}static credentialFromError(e){return af.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return af.credential(e.oauthAccessToken)}catch{return null}}}af.FACEBOOK_SIGN_IN_METHOD="facebook.com";af.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ru extends J1{constructor(){super("google.com"),this.addScope("profile")}static credential(e,r){return Om._fromParams({providerId:Ru.PROVIDER_ID,signInMethod:Ru.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:r})}static credentialFromResult(e){return Ru.credentialFromTaggedObject(e)}static credentialFromError(e){return Ru.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:r,oauthAccessToken:o}=e;if(!r&&!o)return null;try{return Ru.credential(r,o)}catch{return null}}}Ru.GOOGLE_SIGN_IN_METHOD="google.com";Ru.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lf extends J1{constructor(){super("github.com")}static credential(e){return Om._fromParams({providerId:lf.PROVIDER_ID,signInMethod:lf.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return lf.credentialFromTaggedObject(e)}static credentialFromError(e){return lf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return lf.credential(e.oauthAccessToken)}catch{return null}}}lf.GITHUB_SIGN_IN_METHOD="github.com";lf.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cf extends J1{constructor(){super("twitter.com")}static credential(e,r){return Om._fromParams({providerId:cf.PROVIDER_ID,signInMethod:cf.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:r})}static credentialFromResult(e){return cf.credentialFromTaggedObject(e)}static credentialFromError(e){return cf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:r,oauthTokenSecret:o}=e;if(!r||!o)return null;try{return cf.credential(r,o)}catch{return null}}}cf.TWITTER_SIGN_IN_METHOD="twitter.com";cf.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tue(t,e){return Q1(t,"POST","/v1/accounts:signUp",Kf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lm{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,r,o,c=!1){const f=await zh._fromIdTokenResponse(e,o,c),_=FU(o);return new Lm({user:f,providerId:_,_tokenResponse:o,operationType:r})}static async _forOperation(e,r,o){await e._updateTokensIfNecessary(o,!0);const c=FU(o);return new Lm({user:e,providerId:c,_tokenResponse:o,operationType:r})}}function FU(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vS extends Zu{constructor(e,r,o,c){var f;super(r.code,r.message),this.operationType=o,this.user=c,Object.setPrototypeOf(this,vS.prototype),this.customData={appName:e.name,tenantId:(f=e.tenantId)!==null&&f!==void 0?f:void 0,_serverResponse:r.customData._serverResponse,operationType:o}}static _fromErrorAndOperation(e,r,o,c){return new vS(e,r,o,c)}}function fq(t,e,r,o){return(e==="reauthenticate"?r._getReauthenticationResolver(t):r._getIdTokenResponse(t)).catch(f=>{throw f.code==="auth/multi-factor-auth-required"?vS._fromErrorAndOperation(t,f,e,o):f})}async function Eue(t,e,r=!1){const o=await m1(t,e._linkToIdToken(t.auth,await t.getIdToken()),r);return Lm._forOperation(t,"link",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sue(t,e,r=!1){const{auth:o}=t;if(Lc(o.app))return Promise.reject(Bh(o));const c="reauthenticate";try{const f=await m1(t,fq(o,c,e,t),r);br(f.idToken,o,"internal-error");const _=KO(f.idToken);br(_,o,"internal-error");const{sub:x}=_;return br(t.uid===x,o,"user-mismatch"),Lm._forOperation(t,c,f)}catch(f){throw(f==null?void 0:f.code)==="auth/user-not-found"&&Ql(o,"user-mismatch"),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pq(t,e,r=!1){if(Lc(t.app))return Promise.reject(Bh(t));const o="signIn",c=await fq(t,o,e),f=await Lm._fromIdTokenResponse(t,o,c);return r||await t._updateCurrentUser(f.user),f}async function Iue(t,e){return pq(Qf(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mq(t){const e=Qf(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Aue(t,e,r){if(Lc(t.app))return Promise.reject(Bh(t));const o=Qf(t),_=await i3(o,{returnSecureToken:!0,email:e,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Tue).catch(a=>{throw a.code==="auth/password-does-not-meet-requirements"&&mq(t),a}),x=await Lm._fromIdTokenResponse(o,"signIn",_);return await o._updateCurrentUser(x.user),x}function Cue(t,e,r){return Lc(t.app)?Promise.reject(Bh(t)):Iue(Gs(t),Wy.credential(e,r)).catch(async o=>{throw o.code==="auth/password-does-not-meet-requirements"&&mq(t),o})}function Pue(t,e,r,o){return Gs(t).onIdTokenChanged(e,r,o)}function Rue(t,e,r){return Gs(t).beforeAuthStateChanged(e,r)}const xS="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gq{constructor(e,r){this.storageRetriever=e,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(xS,"1"),this.storage.removeItem(xS),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,r){return this.storage.setItem(e,JSON.stringify(r)),Promise.resolve()}_get(e){const r=this.storage.getItem(e);return Promise.resolve(r?JSON.parse(r):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mue=1e3,kue=10;class _q extends gq{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,r)=>this.onStorageEvent(e,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=cq(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){const o=this.storage.getItem(r),c=this.localCache[r];o!==c&&e(r,c,o)}}onStorageEvent(e,r=!1){if(!e.key){this.forAllChangedKeys((_,x,a)=>{this.notifyListeners(_,a)});return}const o=e.key;r?this.detachListener():this.stopPolling();const c=()=>{const _=this.storage.getItem(o);!r&&this.localCache[o]===_||this.notifyListeners(o,_)},f=this.storage.getItem(o);Qce()&&f!==e.newValue&&e.newValue!==e.oldValue?setTimeout(c,kue):c()}notifyListeners(e,r){this.localCache[e]=r;const o=this.listeners[e];if(o)for(const c of Array.from(o))c(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,r,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:r,newValue:o}),!0)})},Mue)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,r){await super._set(e,r),this.localCache[e]=JSON.stringify(r)}async _get(e){const r=await super._get(e);return this.localCache[e]=JSON.stringify(r),r}async _remove(e){await super._remove(e),delete this.localCache[e]}}_q.type="LOCAL";const Due=_q;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yq extends gq{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,r){}_removeListener(e,r){}}yq.type="SESSION";const vq=yq;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oue(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HI{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const r=this.receivers.find(c=>c.isListeningto(e));if(r)return r;const o=new HI(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const r=e,{eventId:o,eventType:c,data:f}=r.data,_=this.handlersMap[c];if(!(_!=null&&_.size))return;r.ports[0].postMessage({status:"ack",eventId:o,eventType:c});const x=Array.from(_).map(async I=>I(r.origin,f)),a=await Oue(x);r.ports[0].postMessage({status:"done",eventId:o,eventType:c,response:a})}_subscribe(e,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(r)}_unsubscribe(e,r){this.handlersMap[e]&&r&&this.handlersMap[e].delete(r),(!r||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}HI.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tL(t="",e=10){let r="";for(let o=0;o<e;o++)r+=Math.floor(Math.random()*10);return t+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lue{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,r,o=50){const c=typeof MessageChannel<"u"?new MessageChannel:null;if(!c)throw new Error("connection_unavailable");let f,_;return new Promise((x,a)=>{const I=tL("",20);c.port1.start();const D=setTimeout(()=>{a(new Error("unsupported_event"))},o);_={messageChannel:c,onMessage(O){const F=O;if(F.data.eventId===I)switch(F.data.status){case"ack":clearTimeout(D),f=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(f),x(F.data.response);break;default:clearTimeout(D),clearTimeout(f),a(new Error("invalid_response"));break}}},this.handlers.add(_),c.port1.addEventListener("message",_.onMessage),this.target.postMessage({eventType:e,eventId:I,data:r},[c.port2])}).finally(()=>{_&&this.removeMessageHandler(_)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bu(){return window}function zue(t){Bu().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xq(){return typeof Bu().WorkerGlobalScope<"u"&&typeof Bu().importScripts=="function"}async function Nue(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Fue(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function Bue(){return xq()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bq="firebaseLocalStorageDb",jue=1,bS="firebaseLocalStorage",wq="fbase_key";class eb{constructor(e){this.request=e}toPromise(){return new Promise((e,r)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function ZI(t,e){return t.transaction([bS],e?"readwrite":"readonly").objectStore(bS)}function Uue(){const t=indexedDB.deleteDatabase(bq);return new eb(t).toPromise()}function s3(){const t=indexedDB.open(bq,jue);return new Promise((e,r)=>{t.addEventListener("error",()=>{r(t.error)}),t.addEventListener("upgradeneeded",()=>{const o=t.result;try{o.createObjectStore(bS,{keyPath:wq})}catch(c){r(c)}}),t.addEventListener("success",async()=>{const o=t.result;o.objectStoreNames.contains(bS)?e(o):(o.close(),await Uue(),e(await s3()))})})}async function BU(t,e,r){const o=ZI(t,!0).put({[wq]:e,value:r});return new eb(o).toPromise()}async function Vue(t,e){const r=ZI(t,!1).get(e),o=await new eb(r).toPromise();return o===void 0?null:o.value}function jU(t,e){const r=ZI(t,!0).delete(e);return new eb(r).toPromise()}const $ue=800,Gue=3;class Tq{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await s3(),this.db)}async _withRetries(e){let r=0;for(;;)try{const o=await this._openDb();return await e(o)}catch(o){if(r++>Gue)throw o;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return xq()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=HI._getInstance(Bue()),this.receiver._subscribe("keyChanged",async(e,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(e,r)=>["keyChanged"])}async initializeSender(){var e,r;if(this.activeServiceWorker=await Nue(),!this.activeServiceWorker)return;this.sender=new Lue(this.activeServiceWorker);const o=await this.sender._send("ping",{},800);o&&!((e=o[0])===null||e===void 0)&&e.fulfilled&&!((r=o[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Fue()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await s3();return await BU(e,xS,"1"),await jU(e,xS),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,r){return this._withPendingWrite(async()=>(await this._withRetries(o=>BU(o,e,r)),this.localCache[e]=r,this.notifyServiceWorker(e)))}async _get(e){const r=await this._withRetries(o=>Vue(o,e));return this.localCache[e]=r,r}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(r=>jU(r,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(c=>{const f=ZI(c,!1).getAll();return new eb(f).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const r=[],o=new Set;if(e.length!==0)for(const{fbase_key:c,value:f}of e)o.add(c),JSON.stringify(this.localCache[c])!==JSON.stringify(f)&&(this.notifyListeners(c,f),r.push(c));for(const c of Object.keys(this.localCache))this.localCache[c]&&!o.has(c)&&(this.notifyListeners(c,null),r.push(c));return r}notifyListeners(e,r){this.localCache[e]=r;const o=this.listeners[e];if(o)for(const c of Array.from(o))c(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),$ue)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Tq.type="LOCAL";const que=Tq;new Y1(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eq(t,e){return e?Nh(e):(br(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nL extends QO{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return oy(e,this._buildIdpRequest())}_linkToIdToken(e,r){return oy(e,this._buildIdpRequest(r))}_getReauthenticationResolver(e){return oy(e,this._buildIdpRequest())}_buildIdpRequest(e){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(r.idToken=e),r}}function Wue(t){return pq(t.auth,new nL(t),t.bypassAuthState)}function Hue(t){const{auth:e,user:r}=t;return br(r,e,"internal-error"),Sue(r,new nL(t),t.bypassAuthState)}async function Zue(t){const{auth:e,user:r}=t;return br(r,e,"internal-error"),Eue(r,new nL(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sq{constructor(e,r,o,c,f=!1){this.auth=e,this.resolver=o,this.user=c,this.bypassAuthState=f,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise(async(e,r)=>{this.pendingPromise={resolve:e,reject:r};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(o){this.reject(o)}})}async onAuthEvent(e){const{urlResponse:r,sessionId:o,postBody:c,tenantId:f,error:_,type:x}=e;if(_){this.reject(_);return}const a={auth:this.auth,requestUri:r,sessionId:o,tenantId:f||void 0,postBody:c||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(x)(a))}catch(I){this.reject(I)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Wue;case"linkViaPopup":case"linkViaRedirect":return Zue;case"reauthViaPopup":case"reauthViaRedirect":return Hue;default:Ql(this.auth,"internal-error")}}resolve(e){Hh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Hh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xue=new Y1(2e3,1e4);async function Iq(t,e,r){if(Lc(t.app))return Promise.reject(Bc(t,"operation-not-supported-in-this-environment"));const o=Qf(t);Dce(t,e,eL);const c=Eq(o,r);return new dm(o,"signInViaPopup",e,c).executeNotNull()}class dm extends Sq{constructor(e,r,o,c,f){super(e,r,c,f),this.provider=o,this.authWindow=null,this.pollId=null,dm.currentPopupAction&&dm.currentPopupAction.cancel(),dm.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return br(e,this.auth,"internal-error"),e}async onExecution(){Hh(this.filter.length===1,"Popup operations only handle one event");const e=tL();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(Bc(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Bc(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,dm.currentPopupAction=null}pollUserCancellation(){const e=()=>{var r,o;if(!((o=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||o===void 0)&&o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Bc(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Xue.get())};e()}}dm.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kue="pendingRedirect",yE=new Map;class Yue extends Sq{constructor(e,r,o=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,o),this.eventId=null}async execute(){let e=yE.get(this.auth._key());if(!e){try{const o=await Que(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(o)}catch(r){e=()=>Promise.reject(r)}yE.set(this.auth._key(),e)}return this.bypassAuthState||yE.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const r=await this.auth._redirectUserForId(e.eventId);if(r)return this.user=r,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Que(t,e){const r=the(e),o=ehe(t);if(!await o._isAvailable())return!1;const c=await o._get(r)==="true";return await o._remove(r),c}function Jue(t,e){yE.set(t._key(),e)}function ehe(t){return Nh(t._redirectPersistence)}function the(t){return _E(Kue,t.config.apiKey,t.name)}async function nhe(t,e,r=!1){if(Lc(t.app))return Promise.reject(Bh(t));const o=Qf(t),c=Eq(o,e),_=await new Yue(o,c,r).execute();return _&&!r&&(delete _.user._redirectEventId,await o._persistUserIfCurrent(_.user),await o._setRedirectUser(null,e)),_}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rhe=10*60*1e3;class ihe{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let r=!1;return this.consumers.forEach(o=>{this.isEventForConsumer(e,o)&&(r=!0,this.sendToConsumer(e,o),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!she(e)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=e,r=!0)),r}sendToConsumer(e,r){var o;if(e.error&&!Aq(e)){const c=((o=e.error.code)===null||o===void 0?void 0:o.split("auth/")[1])||"internal-error";r.onError(Bc(this.auth,c))}else r.onAuthEvent(e)}isEventForConsumer(e,r){const o=r.eventId===null||!!e.eventId&&e.eventId===r.eventId;return r.filter.includes(e.type)&&o}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=rhe&&this.cachedEventUids.clear(),this.cachedEventUids.has(UU(e))}saveEventToCache(e){this.cachedEventUids.add(UU(e)),this.lastProcessedEventTime=Date.now()}}function UU(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Aq({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function she(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Aq(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ohe(t,e={}){return Yf(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ahe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,lhe=/^https?/;async function che(t){if(t.config.emulator)return;const{authorizedDomains:e}=await ohe(t);for(const r of e)try{if(uhe(r))return}catch{}Ql(t,"unauthorized-domain")}function uhe(t){const e=n3(),{protocol:r,hostname:o}=new URL(e);if(t.startsWith("chrome-extension://")){const _=new URL(t);return _.hostname===""&&o===""?r==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):r==="chrome-extension:"&&_.hostname===o}if(!lhe.test(r))return!1;if(ahe.test(t))return o===t;const c=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+c+"|"+c+")$","i").test(o)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hhe=new Y1(3e4,6e4);function VU(){const t=Bu().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let r=0;r<t.CP.length;r++)t.CP[r]=null}}function dhe(t){return new Promise((e,r)=>{var o,c,f;function _(){VU(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{VU(),r(Bc(t,"network-request-failed"))},timeout:hhe.get()})}if(!((c=(o=Bu().gapi)===null||o===void 0?void 0:o.iframes)===null||c===void 0)&&c.Iframe)e(gapi.iframes.getContext());else if(!((f=Bu().gapi)===null||f===void 0)&&f.load)_();else{const x=aue("iframefcb");return Bu()[x]=()=>{gapi.load?_():r(Bc(t,"network-request-failed"))},hq(`${oue()}?onload=${x}`).catch(a=>r(a))}}).catch(e=>{throw vE=null,e})}let vE=null;function fhe(t){return vE=vE||dhe(t),vE}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const phe=new Y1(5e3,15e3),mhe="__/auth/iframe",ghe="emulator/auth/iframe",_he={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},yhe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function vhe(t){const e=t.config;br(e.authDomain,t,"auth-domain-config-required");const r=e.emulator?XO(e,ghe):`https://${t.config.authDomain}/${mhe}`,o={apiKey:e.apiKey,appName:t.name,v:rg},c=yhe.get(t.config.apiHost);c&&(o.eid=c);const f=t._getFrameworks();return f.length&&(o.fw=f.join(",")),`${r}?${K1(o).slice(1)}`}async function xhe(t){const e=await fhe(t),r=Bu().gapi;return br(r,t,"internal-error"),e.open({where:document.body,url:vhe(t),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:_he,dontclear:!0},o=>new Promise(async(c,f)=>{await o.restyle({setHideOnLeave:!1});const _=Bc(t,"network-request-failed"),x=Bu().setTimeout(()=>{f(_)},phe.get());function a(){Bu().clearTimeout(x),c(o)}o.ping(a).then(a,()=>{f(_)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bhe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},whe=500,The=600,Ehe="_blank",She="http://localhost";class $U{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Ihe(t,e,r,o=whe,c=The){const f=Math.max((window.screen.availHeight-c)/2,0).toString(),_=Math.max((window.screen.availWidth-o)/2,0).toString();let x="";const a=Object.assign(Object.assign({},bhe),{width:o.toString(),height:c.toString(),top:f,left:_}),I=ia().toLowerCase();r&&(x=iq(I)?Ehe:r),nq(I)&&(e=e||She,a.scrollbars="yes");const D=Object.entries(a).reduce((F,[Z,J])=>`${F}${Z}=${J},`,"");if(Yce(I)&&x!=="_self")return Ahe(e||"",x),new $U(null);const O=window.open(e||"",x,D);br(O,t,"popup-blocked");try{O.focus()}catch{}return new $U(O)}function Ahe(t,e){const r=document.createElement("a");r.href=t,r.target=e;const o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Che="__/auth/handler",Phe="emulator/auth/handler",Rhe=encodeURIComponent("fac");async function GU(t,e,r,o,c,f){br(t.config.authDomain,t,"auth-domain-config-required"),br(t.config.apiKey,t,"invalid-api-key");const _={apiKey:t.config.apiKey,appName:t.name,authType:r,redirectUrl:o,v:rg,eventId:c};if(e instanceof eL){e.setDefaultLanguage(t.languageCode),_.providerId=e.providerId||"",vle(e.getCustomParameters())||(_.customParameters=JSON.stringify(e.getCustomParameters()));for(const[D,O]of Object.entries({}))_[D]=O}if(e instanceof J1){const D=e.getScopes().filter(O=>O!=="");D.length>0&&(_.scopes=D.join(","))}t.tenantId&&(_.tid=t.tenantId);const x=_;for(const D of Object.keys(x))x[D]===void 0&&delete x[D];const a=await t._getAppCheckToken(),I=a?`#${Rhe}=${encodeURIComponent(a)}`:"";return`${Mhe(t)}?${K1(x).slice(1)}${I}`}function Mhe({config:t}){return t.emulator?XO(t,Phe):`https://${t.authDomain}/${Che}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aM="webStorageSupport";class khe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=vq,this._completeRedirectFn=nhe,this._overrideRedirectResult=Jue}async _openPopup(e,r,o,c){var f;Hh((f=this.eventManagers[e._key()])===null||f===void 0?void 0:f.manager,"_initialize() not called before _openPopup()");const _=await GU(e,r,o,n3(),c);return Ihe(e,_,tL())}async _openRedirect(e,r,o,c){await this._originValidation(e);const f=await GU(e,r,o,n3(),c);return zue(f),new Promise(()=>{})}_initialize(e){const r=e._key();if(this.eventManagers[r]){const{manager:c,promise:f}=this.eventManagers[r];return c?Promise.resolve(c):(Hh(f,"If manager is not set, promise should be"),f)}const o=this.initAndGetManager(e);return this.eventManagers[r]={promise:o},o.catch(()=>{delete this.eventManagers[r]}),o}async initAndGetManager(e){const r=await xhe(e),o=new ihe(e);return r.register("authEvent",c=>(br(c==null?void 0:c.authEvent,e,"invalid-auth-event"),{status:o.onEvent(c.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:o},this.iframes[e._key()]=r,o}_isIframeWebStorageSupported(e,r){this.iframes[e._key()].send(aM,{type:aM},c=>{var f;const _=(f=c==null?void 0:c[0])===null||f===void 0?void 0:f[aM];_!==void 0&&r(!!_),Ql(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const r=e._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=che(e)),this.originValidationPromises[r]}get _shouldInitProactively(){return cq()||rq()||YO()}}const Dhe=khe;var qU="@firebase/auth",WU="1.7.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ohe{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const r=this.auth.onIdTokenChanged(o=>{e((o==null?void 0:o.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,r),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const r=this.internalListeners.get(e);r&&(this.internalListeners.delete(e),r(),this.updateProactiveRefresh())}assertAuthConfigured(){br(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lhe(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function zhe(t){Dm(new Ff("auth",(e,{options:r})=>{const o=e.getProvider("app").getImmediate(),c=e.getProvider("heartbeat"),f=e.getProvider("app-check-internal"),{apiKey:_,authDomain:x}=o.options;br(_&&!_.includes(":"),"invalid-api-key",{appName:o.name});const a={apiKey:_,authDomain:x,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:uq(t)},I=new rue(o,c,f,a);return due(I,r),I},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,r,o)=>{e.getProvider("auth-internal").initialize()})),Dm(new Ff("auth-internal",e=>{const r=Qf(e.getProvider("auth").getImmediate());return(o=>new Ohe(o))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),Fu(qU,WU,Lhe(t)),Fu(qU,WU,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nhe=5*60,Fhe=UG("authIdTokenMaxAge")||Nhe;let HU=null;const Bhe=t=>async e=>{const r=e&&await e.getIdTokenResult(),o=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(o&&o>Fhe)return;const c=r==null?void 0:r.token;HU!==c&&(HU=c,await fetch(t,{method:c?"POST":"DELETE",headers:c?{Authorization:`Bearer ${c}`}:{}}))};function jhe(t=qO()){const e=qI(t,"auth");if(e.isInitialized())return e.getImmediate();const r=hue(t,{popupRedirectResolver:Dhe,persistence:[que,Due,vq]}),o=UG("authTokenSyncURL");if(o&&typeof isSecureContext=="boolean"&&isSecureContext){const f=new URL(o,location.origin);if(location.origin===f.origin){const _=Bhe(f.toString());Rue(r,_,()=>_(r.currentUser)),Pue(r,x=>_(x))}}const c=FG("auth");return c&&fue(r,`http://${c}`),r}function Uhe(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}iue({loadJS(t){return new Promise((e,r)=>{const o=document.createElement("script");o.setAttribute("src",t),o.onload=e,o.onerror=c=>{const f=Bc("internal-error");f.customData=c,r(f)},o.type="text/javascript",o.charset="UTF-8",Uhe().appendChild(o)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});zhe("Browser");var ZU=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var vm,Cq;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(oe,de){function X(){}X.prototype=de.prototype,oe.D=de.prototype,oe.prototype=new X,oe.prototype.constructor=oe,oe.C=function(ge,be,ke){for(var Ee=Array(arguments.length-2),Lt=2;Lt<arguments.length;Lt++)Ee[Lt-2]=arguments[Lt];return de.prototype[be].apply(ge,Ee)}}function r(){this.blockSize=-1}function o(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(o,r),o.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function c(oe,de,X){X||(X=0);var ge=Array(16);if(typeof de=="string")for(var be=0;16>be;++be)ge[be]=de.charCodeAt(X++)|de.charCodeAt(X++)<<8|de.charCodeAt(X++)<<16|de.charCodeAt(X++)<<24;else for(be=0;16>be;++be)ge[be]=de[X++]|de[X++]<<8|de[X++]<<16|de[X++]<<24;de=oe.g[0],X=oe.g[1],be=oe.g[2];var ke=oe.g[3],Ee=de+(ke^X&(be^ke))+ge[0]+3614090360&4294967295;de=X+(Ee<<7&4294967295|Ee>>>25),Ee=ke+(be^de&(X^be))+ge[1]+3905402710&4294967295,ke=de+(Ee<<12&4294967295|Ee>>>20),Ee=be+(X^ke&(de^X))+ge[2]+606105819&4294967295,be=ke+(Ee<<17&4294967295|Ee>>>15),Ee=X+(de^be&(ke^de))+ge[3]+3250441966&4294967295,X=be+(Ee<<22&4294967295|Ee>>>10),Ee=de+(ke^X&(be^ke))+ge[4]+4118548399&4294967295,de=X+(Ee<<7&4294967295|Ee>>>25),Ee=ke+(be^de&(X^be))+ge[5]+1200080426&4294967295,ke=de+(Ee<<12&4294967295|Ee>>>20),Ee=be+(X^ke&(de^X))+ge[6]+2821735955&4294967295,be=ke+(Ee<<17&4294967295|Ee>>>15),Ee=X+(de^be&(ke^de))+ge[7]+4249261313&4294967295,X=be+(Ee<<22&4294967295|Ee>>>10),Ee=de+(ke^X&(be^ke))+ge[8]+1770035416&4294967295,de=X+(Ee<<7&4294967295|Ee>>>25),Ee=ke+(be^de&(X^be))+ge[9]+2336552879&4294967295,ke=de+(Ee<<12&4294967295|Ee>>>20),Ee=be+(X^ke&(de^X))+ge[10]+4294925233&4294967295,be=ke+(Ee<<17&4294967295|Ee>>>15),Ee=X+(de^be&(ke^de))+ge[11]+2304563134&4294967295,X=be+(Ee<<22&4294967295|Ee>>>10),Ee=de+(ke^X&(be^ke))+ge[12]+1804603682&4294967295,de=X+(Ee<<7&4294967295|Ee>>>25),Ee=ke+(be^de&(X^be))+ge[13]+4254626195&4294967295,ke=de+(Ee<<12&4294967295|Ee>>>20),Ee=be+(X^ke&(de^X))+ge[14]+2792965006&4294967295,be=ke+(Ee<<17&4294967295|Ee>>>15),Ee=X+(de^be&(ke^de))+ge[15]+1236535329&4294967295,X=be+(Ee<<22&4294967295|Ee>>>10),Ee=de+(be^ke&(X^be))+ge[1]+4129170786&4294967295,de=X+(Ee<<5&4294967295|Ee>>>27),Ee=ke+(X^be&(de^X))+ge[6]+3225465664&4294967295,ke=de+(Ee<<9&4294967295|Ee>>>23),Ee=be+(de^X&(ke^de))+ge[11]+643717713&4294967295,be=ke+(Ee<<14&4294967295|Ee>>>18),Ee=X+(ke^de&(be^ke))+ge[0]+3921069994&4294967295,X=be+(Ee<<20&4294967295|Ee>>>12),Ee=de+(be^ke&(X^be))+ge[5]+3593408605&4294967295,de=X+(Ee<<5&4294967295|Ee>>>27),Ee=ke+(X^be&(de^X))+ge[10]+38016083&4294967295,ke=de+(Ee<<9&4294967295|Ee>>>23),Ee=be+(de^X&(ke^de))+ge[15]+3634488961&4294967295,be=ke+(Ee<<14&4294967295|Ee>>>18),Ee=X+(ke^de&(be^ke))+ge[4]+3889429448&4294967295,X=be+(Ee<<20&4294967295|Ee>>>12),Ee=de+(be^ke&(X^be))+ge[9]+568446438&4294967295,de=X+(Ee<<5&4294967295|Ee>>>27),Ee=ke+(X^be&(de^X))+ge[14]+3275163606&4294967295,ke=de+(Ee<<9&4294967295|Ee>>>23),Ee=be+(de^X&(ke^de))+ge[3]+4107603335&4294967295,be=ke+(Ee<<14&4294967295|Ee>>>18),Ee=X+(ke^de&(be^ke))+ge[8]+1163531501&4294967295,X=be+(Ee<<20&4294967295|Ee>>>12),Ee=de+(be^ke&(X^be))+ge[13]+2850285829&4294967295,de=X+(Ee<<5&4294967295|Ee>>>27),Ee=ke+(X^be&(de^X))+ge[2]+4243563512&4294967295,ke=de+(Ee<<9&4294967295|Ee>>>23),Ee=be+(de^X&(ke^de))+ge[7]+1735328473&4294967295,be=ke+(Ee<<14&4294967295|Ee>>>18),Ee=X+(ke^de&(be^ke))+ge[12]+2368359562&4294967295,X=be+(Ee<<20&4294967295|Ee>>>12),Ee=de+(X^be^ke)+ge[5]+4294588738&4294967295,de=X+(Ee<<4&4294967295|Ee>>>28),Ee=ke+(de^X^be)+ge[8]+2272392833&4294967295,ke=de+(Ee<<11&4294967295|Ee>>>21),Ee=be+(ke^de^X)+ge[11]+1839030562&4294967295,be=ke+(Ee<<16&4294967295|Ee>>>16),Ee=X+(be^ke^de)+ge[14]+4259657740&4294967295,X=be+(Ee<<23&4294967295|Ee>>>9),Ee=de+(X^be^ke)+ge[1]+2763975236&4294967295,de=X+(Ee<<4&4294967295|Ee>>>28),Ee=ke+(de^X^be)+ge[4]+1272893353&4294967295,ke=de+(Ee<<11&4294967295|Ee>>>21),Ee=be+(ke^de^X)+ge[7]+4139469664&4294967295,be=ke+(Ee<<16&4294967295|Ee>>>16),Ee=X+(be^ke^de)+ge[10]+3200236656&4294967295,X=be+(Ee<<23&4294967295|Ee>>>9),Ee=de+(X^be^ke)+ge[13]+681279174&4294967295,de=X+(Ee<<4&4294967295|Ee>>>28),Ee=ke+(de^X^be)+ge[0]+3936430074&4294967295,ke=de+(Ee<<11&4294967295|Ee>>>21),Ee=be+(ke^de^X)+ge[3]+3572445317&4294967295,be=ke+(Ee<<16&4294967295|Ee>>>16),Ee=X+(be^ke^de)+ge[6]+76029189&4294967295,X=be+(Ee<<23&4294967295|Ee>>>9),Ee=de+(X^be^ke)+ge[9]+3654602809&4294967295,de=X+(Ee<<4&4294967295|Ee>>>28),Ee=ke+(de^X^be)+ge[12]+3873151461&4294967295,ke=de+(Ee<<11&4294967295|Ee>>>21),Ee=be+(ke^de^X)+ge[15]+530742520&4294967295,be=ke+(Ee<<16&4294967295|Ee>>>16),Ee=X+(be^ke^de)+ge[2]+3299628645&4294967295,X=be+(Ee<<23&4294967295|Ee>>>9),Ee=de+(be^(X|~ke))+ge[0]+4096336452&4294967295,de=X+(Ee<<6&4294967295|Ee>>>26),Ee=ke+(X^(de|~be))+ge[7]+1126891415&4294967295,ke=de+(Ee<<10&4294967295|Ee>>>22),Ee=be+(de^(ke|~X))+ge[14]+2878612391&4294967295,be=ke+(Ee<<15&4294967295|Ee>>>17),Ee=X+(ke^(be|~de))+ge[5]+4237533241&4294967295,X=be+(Ee<<21&4294967295|Ee>>>11),Ee=de+(be^(X|~ke))+ge[12]+1700485571&4294967295,de=X+(Ee<<6&4294967295|Ee>>>26),Ee=ke+(X^(de|~be))+ge[3]+2399980690&4294967295,ke=de+(Ee<<10&4294967295|Ee>>>22),Ee=be+(de^(ke|~X))+ge[10]+4293915773&4294967295,be=ke+(Ee<<15&4294967295|Ee>>>17),Ee=X+(ke^(be|~de))+ge[1]+2240044497&4294967295,X=be+(Ee<<21&4294967295|Ee>>>11),Ee=de+(be^(X|~ke))+ge[8]+1873313359&4294967295,de=X+(Ee<<6&4294967295|Ee>>>26),Ee=ke+(X^(de|~be))+ge[15]+4264355552&4294967295,ke=de+(Ee<<10&4294967295|Ee>>>22),Ee=be+(de^(ke|~X))+ge[6]+2734768916&4294967295,be=ke+(Ee<<15&4294967295|Ee>>>17),Ee=X+(ke^(be|~de))+ge[13]+1309151649&4294967295,X=be+(Ee<<21&4294967295|Ee>>>11),Ee=de+(be^(X|~ke))+ge[4]+4149444226&4294967295,de=X+(Ee<<6&4294967295|Ee>>>26),Ee=ke+(X^(de|~be))+ge[11]+3174756917&4294967295,ke=de+(Ee<<10&4294967295|Ee>>>22),Ee=be+(de^(ke|~X))+ge[2]+718787259&4294967295,be=ke+(Ee<<15&4294967295|Ee>>>17),Ee=X+(ke^(be|~de))+ge[9]+3951481745&4294967295,oe.g[0]=oe.g[0]+de&4294967295,oe.g[1]=oe.g[1]+(be+(Ee<<21&4294967295|Ee>>>11))&4294967295,oe.g[2]=oe.g[2]+be&4294967295,oe.g[3]=oe.g[3]+ke&4294967295}o.prototype.u=function(oe,de){de===void 0&&(de=oe.length);for(var X=de-this.blockSize,ge=this.B,be=this.h,ke=0;ke<de;){if(be==0)for(;ke<=X;)c(this,oe,ke),ke+=this.blockSize;if(typeof oe=="string"){for(;ke<de;)if(ge[be++]=oe.charCodeAt(ke++),be==this.blockSize){c(this,ge),be=0;break}}else for(;ke<de;)if(ge[be++]=oe[ke++],be==this.blockSize){c(this,ge),be=0;break}}this.h=be,this.o+=de},o.prototype.v=function(){var oe=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);oe[0]=128;for(var de=1;de<oe.length-8;++de)oe[de]=0;var X=8*this.o;for(de=oe.length-8;de<oe.length;++de)oe[de]=X&255,X/=256;for(this.u(oe),oe=Array(16),de=X=0;4>de;++de)for(var ge=0;32>ge;ge+=8)oe[X++]=this.g[de]>>>ge&255;return oe};function f(oe,de){var X=x;return Object.prototype.hasOwnProperty.call(X,oe)?X[oe]:X[oe]=de(oe)}function _(oe,de){this.h=de;for(var X=[],ge=!0,be=oe.length-1;0<=be;be--){var ke=oe[be]|0;ge&&ke==de||(X[be]=ke,ge=!1)}this.g=X}var x={};function a(oe){return-128<=oe&&128>oe?f(oe,function(de){return new _([de|0],0>de?-1:0)}):new _([oe|0],0>oe?-1:0)}function I(oe){if(isNaN(oe)||!isFinite(oe))return O;if(0>oe)return se(I(-oe));for(var de=[],X=1,ge=0;oe>=X;ge++)de[ge]=oe/X|0,X*=4294967296;return new _(de,0)}function D(oe,de){if(oe.length==0)throw Error("number format error: empty string");if(de=de||10,2>de||36<de)throw Error("radix out of range: "+de);if(oe.charAt(0)=="-")return se(D(oe.substring(1),de));if(0<=oe.indexOf("-"))throw Error('number format error: interior "-" character');for(var X=I(Math.pow(de,8)),ge=O,be=0;be<oe.length;be+=8){var ke=Math.min(8,oe.length-be),Ee=parseInt(oe.substring(be,be+ke),de);8>ke?(ke=I(Math.pow(de,ke)),ge=ge.j(ke).add(I(Ee))):(ge=ge.j(X),ge=ge.add(I(Ee)))}return ge}var O=a(0),F=a(1),Z=a(16777216);t=_.prototype,t.m=function(){if(ne(this))return-se(this).m();for(var oe=0,de=1,X=0;X<this.g.length;X++){var ge=this.i(X);oe+=(0<=ge?ge:4294967296+ge)*de,de*=4294967296}return oe},t.toString=function(oe){if(oe=oe||10,2>oe||36<oe)throw Error("radix out of range: "+oe);if(J(this))return"0";if(ne(this))return"-"+se(this).toString(oe);for(var de=I(Math.pow(oe,6)),X=this,ge="";;){var be=pe(X,de).g;X=W(X,be.j(de));var ke=((0<X.g.length?X.g[0]:X.h)>>>0).toString(oe);if(X=be,J(X))return ke+ge;for(;6>ke.length;)ke="0"+ke;ge=ke+ge}},t.i=function(oe){return 0>oe?0:oe<this.g.length?this.g[oe]:this.h};function J(oe){if(oe.h!=0)return!1;for(var de=0;de<oe.g.length;de++)if(oe.g[de]!=0)return!1;return!0}function ne(oe){return oe.h==-1}t.l=function(oe){return oe=W(this,oe),ne(oe)?-1:J(oe)?0:1};function se(oe){for(var de=oe.g.length,X=[],ge=0;ge<de;ge++)X[ge]=~oe.g[ge];return new _(X,~oe.h).add(F)}t.abs=function(){return ne(this)?se(this):this},t.add=function(oe){for(var de=Math.max(this.g.length,oe.g.length),X=[],ge=0,be=0;be<=de;be++){var ke=ge+(this.i(be)&65535)+(oe.i(be)&65535),Ee=(ke>>>16)+(this.i(be)>>>16)+(oe.i(be)>>>16);ge=Ee>>>16,ke&=65535,Ee&=65535,X[be]=Ee<<16|ke}return new _(X,X[X.length-1]&-2147483648?-1:0)};function W(oe,de){return oe.add(se(de))}t.j=function(oe){if(J(this)||J(oe))return O;if(ne(this))return ne(oe)?se(this).j(se(oe)):se(se(this).j(oe));if(ne(oe))return se(this.j(se(oe)));if(0>this.l(Z)&&0>oe.l(Z))return I(this.m()*oe.m());for(var de=this.g.length+oe.g.length,X=[],ge=0;ge<2*de;ge++)X[ge]=0;for(ge=0;ge<this.g.length;ge++)for(var be=0;be<oe.g.length;be++){var ke=this.i(ge)>>>16,Ee=this.i(ge)&65535,Lt=oe.i(be)>>>16,jt=oe.i(be)&65535;X[2*ge+2*be]+=Ee*jt,Q(X,2*ge+2*be),X[2*ge+2*be+1]+=ke*jt,Q(X,2*ge+2*be+1),X[2*ge+2*be+1]+=Ee*Lt,Q(X,2*ge+2*be+1),X[2*ge+2*be+2]+=ke*Lt,Q(X,2*ge+2*be+2)}for(ge=0;ge<de;ge++)X[ge]=X[2*ge+1]<<16|X[2*ge];for(ge=de;ge<2*de;ge++)X[ge]=0;return new _(X,0)};function Q(oe,de){for(;(oe[de]&65535)!=oe[de];)oe[de+1]+=oe[de]>>>16,oe[de]&=65535,de++}function K(oe,de){this.g=oe,this.h=de}function pe(oe,de){if(J(de))throw Error("division by zero");if(J(oe))return new K(O,O);if(ne(oe))return de=pe(se(oe),de),new K(se(de.g),se(de.h));if(ne(de))return de=pe(oe,se(de)),new K(se(de.g),de.h);if(30<oe.g.length){if(ne(oe)||ne(de))throw Error("slowDivide_ only works with positive integers.");for(var X=F,ge=de;0>=ge.l(oe);)X=Te(X),ge=Te(ge);var be=we(X,1),ke=we(ge,1);for(ge=we(ge,2),X=we(X,2);!J(ge);){var Ee=ke.add(ge);0>=Ee.l(oe)&&(be=be.add(X),ke=Ee),ge=we(ge,1),X=we(X,1)}return de=W(oe,be.j(de)),new K(be,de)}for(be=O;0<=oe.l(de);){for(X=Math.max(1,Math.floor(oe.m()/de.m())),ge=Math.ceil(Math.log(X)/Math.LN2),ge=48>=ge?1:Math.pow(2,ge-48),ke=I(X),Ee=ke.j(de);ne(Ee)||0<Ee.l(oe);)X-=ge,ke=I(X),Ee=ke.j(de);J(ke)&&(ke=F),be=be.add(ke),oe=W(oe,Ee)}return new K(be,oe)}t.A=function(oe){return pe(this,oe).h},t.and=function(oe){for(var de=Math.max(this.g.length,oe.g.length),X=[],ge=0;ge<de;ge++)X[ge]=this.i(ge)&oe.i(ge);return new _(X,this.h&oe.h)},t.or=function(oe){for(var de=Math.max(this.g.length,oe.g.length),X=[],ge=0;ge<de;ge++)X[ge]=this.i(ge)|oe.i(ge);return new _(X,this.h|oe.h)},t.xor=function(oe){for(var de=Math.max(this.g.length,oe.g.length),X=[],ge=0;ge<de;ge++)X[ge]=this.i(ge)^oe.i(ge);return new _(X,this.h^oe.h)};function Te(oe){for(var de=oe.g.length+1,X=[],ge=0;ge<de;ge++)X[ge]=oe.i(ge)<<1|oe.i(ge-1)>>>31;return new _(X,oe.h)}function we(oe,de){var X=de>>5;de%=32;for(var ge=oe.g.length-X,be=[],ke=0;ke<ge;ke++)be[ke]=0<de?oe.i(ke+X)>>>de|oe.i(ke+X+1)<<32-de:oe.i(ke+X);return new _(be,oe.h)}o.prototype.digest=o.prototype.v,o.prototype.reset=o.prototype.s,o.prototype.update=o.prototype.u,Cq=o,_.prototype.add=_.prototype.add,_.prototype.multiply=_.prototype.j,_.prototype.modulo=_.prototype.A,_.prototype.compare=_.prototype.l,_.prototype.toNumber=_.prototype.m,_.prototype.toString=_.prototype.toString,_.prototype.getBits=_.prototype.i,_.fromNumber=I,_.fromString=D,vm=_}).apply(typeof ZU<"u"?ZU:typeof self<"u"?self:typeof window<"u"?window:{});var NT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Pq,Rq,tx,Mq,xE,o3,kq,Dq,Oq;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(R,H,ue){return R==Array.prototype||R==Object.prototype||(R[H]=ue.value),R};function r(R){R=[typeof globalThis=="object"&&globalThis,R,typeof window=="object"&&window,typeof self=="object"&&self,typeof NT=="object"&&NT];for(var H=0;H<R.length;++H){var ue=R[H];if(ue&&ue.Math==Math)return ue}throw Error("Cannot find global object")}var o=r(this);function c(R,H){if(H)e:{var ue=o;R=R.split(".");for(var Me=0;Me<R.length-1;Me++){var ct=R[Me];if(!(ct in ue))break e;ue=ue[ct]}R=R[R.length-1],Me=ue[R],H=H(Me),H!=Me&&H!=null&&e(ue,R,{configurable:!0,writable:!0,value:H})}}function f(R,H){R instanceof String&&(R+="");var ue=0,Me=!1,ct={next:function(){if(!Me&&ue<R.length){var Tt=ue++;return{value:H(Tt,R[Tt]),done:!1}}return Me=!0,{done:!0,value:void 0}}};return ct[Symbol.iterator]=function(){return ct},ct}c("Array.prototype.values",function(R){return R||function(){return f(this,function(H,ue){return ue})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var _=_||{},x=this||self;function a(R){var H=typeof R;return H=H!="object"?H:R?Array.isArray(R)?"array":H:"null",H=="array"||H=="object"&&typeof R.length=="number"}function I(R){var H=typeof R;return H=="object"&&R!=null||H=="function"}function D(R,H,ue){return R.call.apply(R.bind,arguments)}function O(R,H,ue){if(!R)throw Error();if(2<arguments.length){var Me=Array.prototype.slice.call(arguments,2);return function(){var ct=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(ct,Me),R.apply(H,ct)}}return function(){return R.apply(H,arguments)}}function F(R,H,ue){return F=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?D:O,F.apply(null,arguments)}function Z(R,H){var ue=Array.prototype.slice.call(arguments,1);return function(){var Me=ue.slice();return Me.push.apply(Me,arguments),R.apply(this,Me)}}function J(R,H){function ue(){}ue.prototype=H.prototype,R.aa=H.prototype,R.prototype=new ue,R.prototype.constructor=R,R.Qb=function(Me,ct,Tt){for(var rn=Array(arguments.length-2),ui=2;ui<arguments.length;ui++)rn[ui-2]=arguments[ui];return H.prototype[ct].apply(Me,rn)}}function ne(R){const H=R.length;if(0<H){const ue=Array(H);for(let Me=0;Me<H;Me++)ue[Me]=R[Me];return ue}return[]}function se(R,H){for(let ue=1;ue<arguments.length;ue++){const Me=arguments[ue];if(a(Me)){const ct=R.length||0,Tt=Me.length||0;R.length=ct+Tt;for(let rn=0;rn<Tt;rn++)R[ct+rn]=Me[rn]}else R.push(Me)}}class W{constructor(H,ue){this.i=H,this.j=ue,this.h=0,this.g=null}get(){let H;return 0<this.h?(this.h--,H=this.g,this.g=H.next,H.next=null):H=this.i(),H}}function Q(R){return/^[\s\xa0]*$/.test(R)}function K(){var R=x.navigator;return R&&(R=R.userAgent)?R:""}function pe(R){return pe[" "](R),R}pe[" "]=function(){};var Te=K().indexOf("Gecko")!=-1&&!(K().toLowerCase().indexOf("webkit")!=-1&&K().indexOf("Edge")==-1)&&!(K().indexOf("Trident")!=-1||K().indexOf("MSIE")!=-1)&&K().indexOf("Edge")==-1;function we(R,H,ue){for(const Me in R)H.call(ue,R[Me],Me,R)}function oe(R,H){for(const ue in R)H.call(void 0,R[ue],ue,R)}function de(R){const H={};for(const ue in R)H[ue]=R[ue];return H}const X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ge(R,H){let ue,Me;for(let ct=1;ct<arguments.length;ct++){Me=arguments[ct];for(ue in Me)R[ue]=Me[ue];for(let Tt=0;Tt<X.length;Tt++)ue=X[Tt],Object.prototype.hasOwnProperty.call(Me,ue)&&(R[ue]=Me[ue])}}function be(R){var H=1;R=R.split(":");const ue=[];for(;0<H&&R.length;)ue.push(R.shift()),H--;return R.length&&ue.push(R.join(":")),ue}function ke(R){x.setTimeout(()=>{throw R},0)}function Ee(){var R=At;let H=null;return R.g&&(H=R.g,R.g=R.g.next,R.g||(R.h=null),H.next=null),H}class Lt{constructor(){this.h=this.g=null}add(H,ue){const Me=jt.get();Me.set(H,ue),this.h?this.h.next=Me:this.g=Me,this.h=Me}}var jt=new W(()=>new Qt,R=>R.reset());class Qt{constructor(){this.next=this.g=this.h=null}set(H,ue){this.h=H,this.g=ue,this.next=null}reset(){this.next=this.g=this.h=null}}let Pt,lt=!1,At=new Lt,nn=()=>{const R=x.Promise.resolve(void 0);Pt=()=>{R.then(fn)}};var fn=()=>{for(var R;R=Ee();){try{R.h.call(R.g)}catch(ue){ke(ue)}var H=jt;H.j(R),100>H.h&&(H.h++,R.next=H.g,H.g=R)}lt=!1};function mn(){this.s=this.s,this.C=this.C}mn.prototype.s=!1,mn.prototype.ma=function(){this.s||(this.s=!0,this.N())},mn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Vt(R,H){this.type=R,this.g=this.target=H,this.defaultPrevented=!1}Vt.prototype.h=function(){this.defaultPrevented=!0};var wn=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var R=!1,H=Object.defineProperty({},"passive",{get:function(){R=!0}});try{const ue=()=>{};x.addEventListener("test",ue,H),x.removeEventListener("test",ue,H)}catch{}return R}();function Ht(R,H){if(Vt.call(this,R?R.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,R){var ue=this.type=R.type,Me=R.changedTouches&&R.changedTouches.length?R.changedTouches[0]:null;if(this.target=R.target||R.srcElement,this.g=H,H=R.relatedTarget){if(Te){e:{try{pe(H.nodeName);var ct=!0;break e}catch{}ct=!1}ct||(H=null)}}else ue=="mouseover"?H=R.fromElement:ue=="mouseout"&&(H=R.toElement);this.relatedTarget=H,Me?(this.clientX=Me.clientX!==void 0?Me.clientX:Me.pageX,this.clientY=Me.clientY!==void 0?Me.clientY:Me.pageY,this.screenX=Me.screenX||0,this.screenY=Me.screenY||0):(this.clientX=R.clientX!==void 0?R.clientX:R.pageX,this.clientY=R.clientY!==void 0?R.clientY:R.pageY,this.screenX=R.screenX||0,this.screenY=R.screenY||0),this.button=R.button,this.key=R.key||"",this.ctrlKey=R.ctrlKey,this.altKey=R.altKey,this.shiftKey=R.shiftKey,this.metaKey=R.metaKey,this.pointerId=R.pointerId||0,this.pointerType=typeof R.pointerType=="string"?R.pointerType:Hn[R.pointerType]||"",this.state=R.state,this.i=R,R.defaultPrevented&&Ht.aa.h.call(this)}}J(Ht,Vt);var Hn={2:"touch",3:"pen",4:"mouse"};Ht.prototype.h=function(){Ht.aa.h.call(this);var R=this.i;R.preventDefault?R.preventDefault():R.returnValue=!1};var Jn="closure_listenable_"+(1e6*Math.random()|0),ir=0;function Zt(R,H,ue,Me,ct){this.listener=R,this.proxy=null,this.src=H,this.type=ue,this.capture=!!Me,this.ha=ct,this.key=++ir,this.da=this.fa=!1}function zt(R){R.da=!0,R.listener=null,R.proxy=null,R.src=null,R.ha=null}function qt(R){this.src=R,this.g={},this.h=0}qt.prototype.add=function(R,H,ue,Me,ct){var Tt=R.toString();R=this.g[Tt],R||(R=this.g[Tt]=[],this.h++);var rn=rr(R,H,Me,ct);return-1<rn?(H=R[rn],ue||(H.fa=!1)):(H=new Zt(H,this.src,Tt,!!Me,ct),H.fa=ue,R.push(H)),H};function xn(R,H){var ue=H.type;if(ue in R.g){var Me=R.g[ue],ct=Array.prototype.indexOf.call(Me,H,void 0),Tt;(Tt=0<=ct)&&Array.prototype.splice.call(Me,ct,1),Tt&&(zt(H),R.g[ue].length==0&&(delete R.g[ue],R.h--))}}function rr(R,H,ue,Me){for(var ct=0;ct<R.length;++ct){var Tt=R[ct];if(!Tt.da&&Tt.listener==H&&Tt.capture==!!ue&&Tt.ha==Me)return ct}return-1}var Gn="closure_lm_"+(1e6*Math.random()|0),yr={};function Gr(R,H,ue,Me,ct){if(Array.isArray(H)){for(var Tt=0;Tt<H.length;Tt++)Gr(R,H[Tt],ue,Me,ct);return null}return ue=In(ue),R&&R[Jn]?R.K(H,ue,I(Me)?!!Me.capture:!!Me,ct):mr(R,H,ue,!1,Me,ct)}function mr(R,H,ue,Me,ct,Tt){if(!H)throw Error("Invalid event type");var rn=I(ct)?!!ct.capture:!!ct,ui=pt(R);if(ui||(R[Gn]=ui=new qt(R)),ue=ui.add(H,ue,Me,rn,Tt),ue.proxy)return ue;if(Me=wr(),ue.proxy=Me,Me.src=R,Me.listener=ue,R.addEventListener)wn||(ct=rn),ct===void 0&&(ct=!1),R.addEventListener(H.toString(),Me,ct);else if(R.attachEvent)R.attachEvent(Ct(H.toString()),Me);else if(R.addListener&&R.removeListener)R.addListener(Me);else throw Error("addEventListener and attachEvent are unavailable.");return ue}function wr(){function R(ue){return H.call(R.src,R.listener,ue)}const H=it;return R}function wt(R,H,ue,Me,ct){if(Array.isArray(H))for(var Tt=0;Tt<H.length;Tt++)wt(R,H[Tt],ue,Me,ct);else Me=I(Me)?!!Me.capture:!!Me,ue=In(ue),R&&R[Jn]?(R=R.i,H=String(H).toString(),H in R.g&&(Tt=R.g[H],ue=rr(Tt,ue,Me,ct),-1<ue&&(zt(Tt[ue]),Array.prototype.splice.call(Tt,ue,1),Tt.length==0&&(delete R.g[H],R.h--)))):R&&(R=pt(R))&&(H=R.g[H.toString()],R=-1,H&&(R=rr(H,ue,Me,ct)),(ue=-1<R?H[R]:null)&&St(ue))}function St(R){if(typeof R!="number"&&R&&!R.da){var H=R.src;if(H&&H[Jn])xn(H.i,R);else{var ue=R.type,Me=R.proxy;H.removeEventListener?H.removeEventListener(ue,Me,R.capture):H.detachEvent?H.detachEvent(Ct(ue),Me):H.addListener&&H.removeListener&&H.removeListener(Me),(ue=pt(H))?(xn(ue,R),ue.h==0&&(ue.src=null,H[Gn]=null)):zt(R)}}}function Ct(R){return R in yr?yr[R]:yr[R]="on"+R}function it(R,H){if(R.da)R=!0;else{H=new Ht(H,this);var ue=R.listener,Me=R.ha||R.src;R.fa&&St(R),R=ue.call(Me,H)}return R}function pt(R){return R=R[Gn],R instanceof qt?R:null}var Jt="__closure_events_fn_"+(1e9*Math.random()>>>0);function In(R){return typeof R=="function"?R:(R[Jt]||(R[Jt]=function(H){return R.handleEvent(H)}),R[Jt])}function en(){mn.call(this),this.i=new qt(this),this.M=this,this.F=null}J(en,mn),en.prototype[Jn]=!0,en.prototype.removeEventListener=function(R,H,ue,Me){wt(this,R,H,ue,Me)};function Ye(R,H){var ue,Me=R.F;if(Me)for(ue=[];Me;Me=Me.F)ue.push(Me);if(R=R.M,Me=H.type||H,typeof H=="string")H=new Vt(H,R);else if(H instanceof Vt)H.target=H.target||R;else{var ct=H;H=new Vt(Me,R),ge(H,ct)}if(ct=!0,ue)for(var Tt=ue.length-1;0<=Tt;Tt--){var rn=H.g=ue[Tt];ct=Rt(rn,Me,!0,H)&&ct}if(rn=H.g=R,ct=Rt(rn,Me,!0,H)&&ct,ct=Rt(rn,Me,!1,H)&&ct,ue)for(Tt=0;Tt<ue.length;Tt++)rn=H.g=ue[Tt],ct=Rt(rn,Me,!1,H)&&ct}en.prototype.N=function(){if(en.aa.N.call(this),this.i){var R=this.i,H;for(H in R.g){for(var ue=R.g[H],Me=0;Me<ue.length;Me++)zt(ue[Me]);delete R.g[H],R.h--}}this.F=null},en.prototype.K=function(R,H,ue,Me){return this.i.add(String(R),H,!1,ue,Me)},en.prototype.L=function(R,H,ue,Me){return this.i.add(String(R),H,!0,ue,Me)};function Rt(R,H,ue,Me){if(H=R.i.g[String(H)],!H)return!0;H=H.concat();for(var ct=!0,Tt=0;Tt<H.length;++Tt){var rn=H[Tt];if(rn&&!rn.da&&rn.capture==ue){var ui=rn.listener,xs=rn.ha||rn.src;rn.fa&&xn(R.i,rn),ct=ui.call(xs,Me)!==!1&&ct}}return ct&&!Me.defaultPrevented}function bn(R,H,ue){if(typeof R=="function")ue&&(R=F(R,ue));else if(R&&typeof R.handleEvent=="function")R=F(R.handleEvent,R);else throw Error("Invalid listener argument");return 2147483647<Number(H)?-1:x.setTimeout(R,H||0)}function Pn(R){R.g=bn(()=>{R.g=null,R.i&&(R.i=!1,Pn(R))},R.l);const H=R.h;R.h=null,R.m.apply(null,H)}class gn extends mn{constructor(H,ue){super(),this.m=H,this.l=ue,this.h=null,this.i=!1,this.g=null}j(H){this.h=arguments,this.g?this.i=!0:Pn(this)}N(){super.N(),this.g&&(x.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function er(R){mn.call(this),this.h=R,this.g={}}J(er,mn);var Ur=[];function hn(R){we(R.g,function(H,ue){this.g.hasOwnProperty(ue)&&St(H)},R),R.g={}}er.prototype.N=function(){er.aa.N.call(this),hn(this)},er.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Rn=x.JSON.stringify,Kt=x.JSON.parse,zi=class{stringify(R){return x.JSON.stringify(R,void 0)}parse(R){return x.JSON.parse(R,void 0)}};function li(){}li.prototype.h=null;function vi(R){return R.h||(R.h=R.i())}function go(){}var Xi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ao(){Vt.call(this,"d")}J(Ao,Vt);function Za(){Vt.call(this,"c")}J(Za,Vt);var _o={},Wt=null;function Ln(){return Wt=Wt||new en}_o.La="serverreachability";function Or(R){Vt.call(this,_o.La,R)}J(Or,Vt);function Pr(R){const H=Ln();Ye(H,new Or(H))}_o.STAT_EVENT="statevent";function Ei(R,H){Vt.call(this,_o.STAT_EVENT,R),this.stat=H}J(Ei,Vt);function Rr(R){const H=Ln();Ye(H,new Ei(H,R))}_o.Ma="timingevent";function us(R,H){Vt.call(this,_o.Ma,R),this.size=H}J(us,Vt);function $i(R,H){if(typeof R!="function")throw Error("Fn must not be null and must be a function");return x.setTimeout(function(){R()},H)}function si(){this.g=!0}si.prototype.xa=function(){this.g=!1};function no(R,H,ue,Me,ct,Tt){R.info(function(){if(R.g)if(Tt)for(var rn="",ui=Tt.split("&"),xs=0;xs<ui.length;xs++){var Hr=ui[xs].split("=");if(1<Hr.length){var ks=Hr[0];Hr=Hr[1];var Ds=ks.split("_");rn=2<=Ds.length&&Ds[1]=="type"?rn+(ks+"="+Hr+"&"):rn+(ks+"=redacted&")}}else rn=null;else rn=Tt;return"XMLHTTP REQ ("+Me+") [attempt "+ct+"]: "+H+`
`+ue+`
`+rn})}function ro(R,H,ue,Me,ct,Tt,rn){R.info(function(){return"XMLHTTP RESP ("+Me+") [ attempt "+ct+"]: "+H+`
`+ue+`
`+Tt+" "+rn})}function qr(R,H,ue,Me){R.info(function(){return"XMLHTTP TEXT ("+H+"): "+El(R,ue)+(Me?" "+Me:"")})}function Si(R,H){R.info(function(){return"TIMEOUT: "+H})}si.prototype.info=function(){};function El(R,H){if(!R.g)return H;if(!H)return null;try{var ue=JSON.parse(H);if(ue){for(R=0;R<ue.length;R++)if(Array.isArray(ue[R])){var Me=ue[R];if(!(2>Me.length)){var ct=Me[1];if(Array.isArray(ct)&&!(1>ct.length)){var Tt=ct[0];if(Tt!="noop"&&Tt!="stop"&&Tt!="close")for(var rn=1;rn<ct.length;rn++)ct[rn]=""}}}}return Rn(ue)}catch{return H}}var Be={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},te={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},le;function xe(){}J(xe,li),xe.prototype.g=function(){return new XMLHttpRequest},xe.prototype.i=function(){return{}},le=new xe;function Oe(R,H,ue,Me){this.j=R,this.i=H,this.l=ue,this.R=Me||1,this.U=new er(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new De}function De(){this.i=null,this.g="",this.h=!1}var Ge={},tt={};function $e(R,H,ue){R.L=1,R.v=Wc(Uo(H)),R.m=ue,R.P=!0,Je(R,null)}function Je(R,H){R.F=Date.now(),$t(R),R.A=Uo(R.v);var ue=R.A,Me=R.R;Array.isArray(Me)||(Me=[String(Me)]),cg(ue.i,"t",Me),R.C=0,ue=R.j.J,R.h=new De,R.g=nu(R.j,ue?H:null,!R.m),0<R.O&&(R.M=new gn(F(R.Y,R,R.g),R.O)),H=R.U,ue=R.g,Me=R.ca;var ct="readystatechange";Array.isArray(ct)||(ct&&(Ur[0]=ct.toString()),ct=Ur);for(var Tt=0;Tt<ct.length;Tt++){var rn=Gr(ue,ct[Tt],Me||H.handleEvent,!1,H.h||H);if(!rn)break;H.g[rn.key]=rn}H=R.H?de(R.H):{},R.m?(R.u||(R.u="POST"),H["Content-Type"]="application/x-www-form-urlencoded",R.g.ea(R.A,R.u,R.m,H)):(R.u="GET",R.g.ea(R.A,R.u,null,H)),Pr(),no(R.i,R.u,R.A,R.l,R.R,R.m)}Oe.prototype.ca=function(R){R=R.target;const H=this.M;H&&aa(R)==3?H.j():this.Y(R)},Oe.prototype.Y=function(R){try{if(R==this.g)e:{const Ds=aa(this.g);var H=this.g.Ba();const hc=this.g.Z();if(!(3>Ds)&&(Ds!=3||this.g&&(this.h.h||this.g.oa()||oc(this.g)))){this.J||Ds!=4||H==7||(H==8||0>=hc?Pr(3):Pr(2)),An(this);var ue=this.g.Z();this.X=ue;t:if(mt(this)){var Me=oc(this.g);R="";var ct=Me.length,Tt=aa(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Dn(this),ur(this);var rn="";break t}this.h.i=new x.TextDecoder}for(H=0;H<ct;H++)this.h.h=!0,R+=this.h.i.decode(Me[H],{stream:!(Tt&&H==ct-1)});Me.length=0,this.h.g+=R,this.C=0,rn=this.h.g}else rn=this.g.oa();if(this.o=ue==200,ro(this.i,this.u,this.A,this.l,this.R,Ds,ue),this.o){if(this.T&&!this.K){t:{if(this.g){var ui,xs=this.g;if((ui=xs.g?xs.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Q(ui)){var Hr=ui;break t}}Hr=null}if(ue=Hr)qr(this.i,this.l,ue,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,hr(this,ue);else{this.o=!1,this.s=3,Rr(12),Dn(this),ur(this);break e}}if(this.P){ue=!0;let ds;for(;!this.J&&this.C<rn.length;)if(ds=gt(this,rn),ds==tt){Ds==4&&(this.s=4,Rr(14),ue=!1),qr(this.i,this.l,null,"[Incomplete Response]");break}else if(ds==Ge){this.s=4,Rr(15),qr(this.i,this.l,rn,"[Invalid Chunk]"),ue=!1;break}else qr(this.i,this.l,ds,null),hr(this,ds);if(mt(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ds!=4||rn.length!=0||this.h.h||(this.s=1,Rr(16),ue=!1),this.o=this.o&&ue,!ue)qr(this.i,this.l,rn,"[Invalid Chunked Response]"),Dn(this),ur(this);else if(0<rn.length&&!this.W){this.W=!0;var ks=this.j;ks.g==this&&ks.ba&&!ks.M&&(ks.j.info("Great, no buffering proxy detected. Bytes received: "+rn.length),vs(ks),ks.M=!0,Rr(11))}}else qr(this.i,this.l,rn,null),hr(this,rn);Ds==4&&Dn(this),this.o&&!this.J&&(Ds==4?dg(this.j,this):(this.o=!1,$t(this)))}else th(this.g),ue==400&&0<rn.indexOf("Unknown SID")?(this.s=3,Rr(12)):(this.s=0,Rr(13)),Dn(this),ur(this)}}}catch{}finally{}};function mt(R){return R.g?R.u=="GET"&&R.L!=2&&R.j.Ca:!1}function gt(R,H){var ue=R.C,Me=H.indexOf(`
`,ue);return Me==-1?tt:(ue=Number(H.substring(ue,Me)),isNaN(ue)?Ge:(Me+=1,Me+ue>H.length?tt:(H=H.slice(Me,Me+ue),R.C=Me+ue,H)))}Oe.prototype.cancel=function(){this.J=!0,Dn(this)};function $t(R){R.S=Date.now()+R.I,_n(R,R.I)}function _n(R,H){if(R.B!=null)throw Error("WatchDog timer not null");R.B=$i(F(R.ba,R),H)}function An(R){R.B&&(x.clearTimeout(R.B),R.B=null)}Oe.prototype.ba=function(){this.B=null;const R=Date.now();0<=R-this.S?(Si(this.i,this.A),this.L!=2&&(Pr(),Rr(17)),Dn(this),this.s=2,ur(this)):_n(this,this.S-R)};function ur(R){R.j.G==0||R.J||dg(R.j,R)}function Dn(R){An(R);var H=R.M;H&&typeof H.ma=="function"&&H.ma(),R.M=null,hn(R.U),R.g&&(H=R.g,R.g=null,H.abort(),H.ma())}function hr(R,H){try{var ue=R.j;if(ue.G!=0&&(ue.g==R||xi(ue.h,R))){if(!R.K&&xi(ue.h,R)&&ue.G==3){try{var Me=ue.Da.g.parse(H)}catch{Me=null}if(Array.isArray(Me)&&Me.length==3){var ct=Me;if(ct[0]==0){e:if(!ue.u){if(ue.g)if(ue.g.F+3e3<R.F)la(ue),lc(ue);else break e;Fs(ue),Rr(18)}}else ue.za=ct[1],0<ue.za-ue.T&&37500>ct[2]&&ue.F&&ue.v==0&&!ue.C&&(ue.C=$i(F(ue.Za,ue),6e3));if(1>=dr(ue.h)&&ue.ca){try{ue.ca()}catch{}ue.ca=void 0}}else $o(ue,11)}else if((R.K||ue.g==R)&&la(ue),!Q(H))for(ct=ue.Da.g.parse(H),H=0;H<ct.length;H++){let Hr=ct[H];if(ue.T=Hr[0],Hr=Hr[1],ue.G==2)if(Hr[0]=="c"){ue.K=Hr[1],ue.ia=Hr[2];const ks=Hr[3];ks!=null&&(ue.la=ks,ue.j.info("VER="+ue.la));const Ds=Hr[4];Ds!=null&&(ue.Aa=Ds,ue.j.info("SVER="+ue.Aa));const hc=Hr[5];hc!=null&&typeof hc=="number"&&0<hc&&(Me=1.5*hc,ue.L=Me,ue.j.info("backChannelRequestTimeoutMs_="+Me)),Me=ue;const ds=R.g;if(ds){const dc=ds.g?ds.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(dc){var Tt=Me.h;Tt.g||dc.indexOf("spdy")==-1&&dc.indexOf("quic")==-1&&dc.indexOf("h2")==-1||(Tt.j=Tt.l,Tt.g=new Set,Tt.h&&(bi(Tt,Tt.h),Tt.h=null))}if(Me.D){const pd=ds.g?ds.g.getResponseHeader("X-HTTP-Session-Id"):null;pd&&(Me.ya=pd,di(Me.I,Me.D,pd))}}ue.G=3,ue.l&&ue.l.ua(),ue.ba&&(ue.R=Date.now()-R.F,ue.j.info("Handshake RTT: "+ue.R+"ms")),Me=ue;var rn=R;if(Me.qa=fd(Me,Me.J?Me.ia:null,Me.W),rn.K){Ki(Me.h,rn);var ui=rn,xs=Me.L;xs&&(ui.I=xs),ui.B&&(An(ui),$t(ui)),Me.g=rn}else Ms(Me);0<ue.i.length&&Ia(ue)}else Hr[0]!="stop"&&Hr[0]!="close"||$o(ue,7);else ue.G==3&&(Hr[0]=="stop"||Hr[0]=="close"?Hr[0]=="stop"?$o(ue,7):dd(ue):Hr[0]!="noop"&&ue.l&&ue.l.ta(Hr),ue.v=0)}}Pr(4)}catch{}}var cn=class{constructor(R,H){this.g=R,this.map=H}};function ei(R){this.l=R||10,x.PerformanceNavigationTiming?(R=x.performance.getEntriesByType("navigation"),R=0<R.length&&(R[0].nextHopProtocol=="hq"||R[0].nextHopProtocol=="h2")):R=!!(x.chrome&&x.chrome.loadTimes&&x.chrome.loadTimes()&&x.chrome.loadTimes().wasFetchedViaSpdy),this.j=R?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function vr(R){return R.h?!0:R.g?R.g.size>=R.j:!1}function dr(R){return R.h?1:R.g?R.g.size:0}function xi(R,H){return R.h?R.h==H:R.g?R.g.has(H):!1}function bi(R,H){R.g?R.g.add(H):R.h=H}function Ki(R,H){R.h&&R.h==H?R.h=null:R.g&&R.g.has(H)&&R.g.delete(H)}ei.prototype.cancel=function(){if(this.i=Ps(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const R of this.g.values())R.cancel();this.g.clear()}};function Ps(R){if(R.h!=null)return R.i.concat(R.h.D);if(R.g!=null&&R.g.size!==0){let H=R.i;for(const ue of R.g.values())H=H.concat(ue.D);return H}return ne(R.i)}function Ws(R){if(R.V&&typeof R.V=="function")return R.V();if(typeof Map<"u"&&R instanceof Map||typeof Set<"u"&&R instanceof Set)return Array.from(R.values());if(typeof R=="string")return R.split("");if(a(R)){for(var H=[],ue=R.length,Me=0;Me<ue;Me++)H.push(R[Me]);return H}H=[],ue=0;for(Me in R)H[ue++]=R[Me];return H}function nc(R){if(R.na&&typeof R.na=="function")return R.na();if(!R.V||typeof R.V!="function"){if(typeof Map<"u"&&R instanceof Map)return Array.from(R.keys());if(!(typeof Set<"u"&&R instanceof Set)){if(a(R)||typeof R=="string"){var H=[];R=R.length;for(var ue=0;ue<R;ue++)H.push(ue);return H}H=[],ue=0;for(const Me in R)H[ue++]=Me;return H}}}function od(R,H){if(R.forEach&&typeof R.forEach=="function")R.forEach(H,void 0);else if(a(R)||typeof R=="string")Array.prototype.forEach.call(R,H,void 0);else for(var ue=nc(R),Me=Ws(R),ct=Me.length,Tt=0;Tt<ct;Tt++)H.call(void 0,Me[Tt],ue&&ue[Tt],R)}var ad=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Yu(R,H){if(R){R=R.split("&");for(var ue=0;ue<R.length;ue++){var Me=R[ue].indexOf("="),ct=null;if(0<=Me){var Tt=R[ue].substring(0,Me);ct=R[ue].substring(Me+1)}else Tt=R[ue];H(Tt,ct?decodeURIComponent(ct.replace(/\+/g," ")):"")}}}function zn(R){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,R instanceof zn){this.h=R.h,sa(this,R.j),this.o=R.o,this.g=R.g,qc(this,R.s),this.l=R.l;var H=R.i,ue=new Zc;ue.i=H.i,H.g&&(ue.g=new Map(H.g),ue.h=H.h),ld(this,ue),this.m=R.m}else R&&(H=String(R).match(ad))?(this.h=!1,sa(this,H[1]||"",!0),this.o=rc(H[2]||""),this.g=rc(H[3]||"",!0),qc(this,H[4]),this.l=rc(H[5]||"",!0),ld(this,H[6]||"",!0),this.m=rc(H[7]||"")):(this.h=!1,this.i=new Zc(null,this.h))}zn.prototype.toString=function(){var R=[],H=this.j;H&&R.push(ic(H,Hc,!0),":");var ue=this.g;return(ue||H=="file")&&(R.push("//"),(H=this.o)&&R.push(ic(H,Hc,!0),"@"),R.push(encodeURIComponent(String(ue)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ue=this.s,ue!=null&&R.push(":",String(ue))),(ue=this.l)&&(this.g&&ue.charAt(0)!="/"&&R.push("/"),R.push(ic(ue,ue.charAt(0)=="/"?cd:Qu,!0))),(ue=this.i.toString())&&R.push("?",ue),(ue=this.m)&&R.push("#",ic(ue,ag)),R.join("")};function Uo(R){return new zn(R)}function sa(R,H,ue){R.j=ue?rc(H,!0):H,R.j&&(R.j=R.j.replace(/:$/,""))}function qc(R,H){if(H){if(H=Number(H),isNaN(H)||0>H)throw Error("Bad port number "+H);R.s=H}else R.s=null}function ld(R,H,ue){H instanceof Zc?(R.i=H,ug(R.i,R.h)):(ue||(H=ic(H,ud)),R.i=new Zc(H,R.h))}function di(R,H,ue){R.i.set(H,ue)}function Wc(R){return di(R,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),R}function rc(R,H){return R?H?decodeURI(R.replace(/%25/g,"%2525")):decodeURIComponent(R):""}function ic(R,H,ue){return typeof R=="string"?(R=encodeURI(R).replace(H,tp),ue&&(R=R.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),R):null}function tp(R){return R=R.charCodeAt(0),"%"+(R>>4&15).toString(16)+(R&15).toString(16)}var Hc=/[#\/\?@]/g,Qu=/[#\?:]/g,cd=/[#\?]/g,ud=/[#\?@]/g,ag=/#/g;function Zc(R,H){this.h=this.g=null,this.i=R||null,this.j=!!H}function Co(R){R.g||(R.g=new Map,R.h=0,R.i&&Yu(R.i,function(H,ue){R.add(decodeURIComponent(H.replace(/\+/g," ")),ue)}))}t=Zc.prototype,t.add=function(R,H){Co(this),this.i=null,R=Xc(this,R);var ue=this.g.get(R);return ue||this.g.set(R,ue=[]),ue.push(H),this.h+=1,this};function fr(R,H){Co(R),H=Xc(R,H),R.g.has(H)&&(R.i=null,R.h-=R.g.get(H).length,R.g.delete(H))}function lg(R,H){return Co(R),H=Xc(R,H),R.g.has(H)}t.forEach=function(R,H){Co(this),this.g.forEach(function(ue,Me){ue.forEach(function(ct){R.call(H,ct,Me,this)},this)},this)},t.na=function(){Co(this);const R=Array.from(this.g.values()),H=Array.from(this.g.keys()),ue=[];for(let Me=0;Me<H.length;Me++){const ct=R[Me];for(let Tt=0;Tt<ct.length;Tt++)ue.push(H[Me])}return ue},t.V=function(R){Co(this);let H=[];if(typeof R=="string")lg(this,R)&&(H=H.concat(this.g.get(Xc(this,R))));else{R=Array.from(this.g.values());for(let ue=0;ue<R.length;ue++)H=H.concat(R[ue])}return H},t.set=function(R,H){return Co(this),this.i=null,R=Xc(this,R),lg(this,R)&&(this.h-=this.g.get(R).length),this.g.set(R,[H]),this.h+=1,this},t.get=function(R,H){return R?(R=this.V(R),0<R.length?String(R[0]):H):H};function cg(R,H,ue){fr(R,H),0<ue.length&&(R.i=null,R.g.set(Xc(R,H),ne(ue)),R.h+=ue.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const R=[],H=Array.from(this.g.keys());for(var ue=0;ue<H.length;ue++){var Me=H[ue];const Tt=encodeURIComponent(String(Me)),rn=this.V(Me);for(Me=0;Me<rn.length;Me++){var ct=Tt;rn[Me]!==""&&(ct+="="+encodeURIComponent(String(rn[Me]))),R.push(ct)}}return this.i=R.join("&")};function Xc(R,H){return H=String(H),R.j&&(H=H.toLowerCase()),H}function ug(R,H){H&&!R.j&&(Co(R),R.i=null,R.g.forEach(function(ue,Me){var ct=Me.toLowerCase();Me!=ct&&(fr(this,Me),cg(this,ct,ue))},R)),R.j=H}function i0(R,H){const ue=new si;if(x.Image){const Me=new Image;Me.onload=Z(Vo,ue,"TestLoadImage: loaded",!0,H,Me),Me.onerror=Z(Vo,ue,"TestLoadImage: error",!1,H,Me),Me.onabort=Z(Vo,ue,"TestLoadImage: abort",!1,H,Me),Me.ontimeout=Z(Vo,ue,"TestLoadImage: timeout",!1,H,Me),x.setTimeout(function(){Me.ontimeout&&Me.ontimeout()},1e4),Me.src=R}else H(!1)}function np(R,H){const ue=new si,Me=new AbortController,ct=setTimeout(()=>{Me.abort(),Vo(ue,"TestPingServer: timeout",!1,H)},1e4);fetch(R,{signal:Me.signal}).then(Tt=>{clearTimeout(ct),Tt.ok?Vo(ue,"TestPingServer: ok",!0,H):Vo(ue,"TestPingServer: server error",!1,H)}).catch(()=>{clearTimeout(ct),Vo(ue,"TestPingServer: error",!1,H)})}function Vo(R,H,ue,Me,ct){try{ct&&(ct.onload=null,ct.onerror=null,ct.onabort=null,ct.ontimeout=null),Me(ue)}catch{}}function Po(){this.g=new zi}function hg(R,H,ue){const Me=ue||"";try{od(R,function(ct,Tt){let rn=ct;I(ct)&&(rn=Rn(ct)),H.push(Me+Tt+"="+encodeURIComponent(rn))})}catch(ct){throw H.push(Me+"type="+encodeURIComponent("_badmap")),ct}}function Kc(R){this.l=R.Ub||null,this.j=R.eb||!1}J(Kc,li),Kc.prototype.g=function(){return new Yc(this.l,this.j)},Kc.prototype.i=function(R){return function(){return R}}({});function Yc(R,H){en.call(this),this.D=R,this.o=H,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}J(Yc,en),t=Yc.prototype,t.open=function(R,H){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=R,this.A=H,this.readyState=1,Dt(this)},t.send=function(R){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const H={headers:this.u,method:this.B,credentials:this.m,cache:void 0};R&&(H.body=R),(this.D||x).fetch(new Request(this.A,H)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,oa(this)),this.readyState=0},t.Sa=function(R){if(this.g&&(this.l=R,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=R.headers,this.readyState=2,Dt(this)),this.g&&(this.readyState=3,Dt(this),this.g)))if(this.responseType==="arraybuffer")R.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof x.ReadableStream<"u"&&"body"in R){if(this.j=R.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Qc(this)}else R.text().then(this.Ra.bind(this),this.ga.bind(this))};function Qc(R){R.j.read().then(R.Pa.bind(R)).catch(R.ga.bind(R))}t.Pa=function(R){if(this.g){if(this.o&&R.value)this.response.push(R.value);else if(!this.o){var H=R.value?R.value:new Uint8Array(0);(H=this.v.decode(H,{stream:!R.done}))&&(this.response=this.responseText+=H)}R.done?oa(this):Dt(this),this.readyState==3&&Qc(this)}},t.Ra=function(R){this.g&&(this.response=this.responseText=R,oa(this))},t.Qa=function(R){this.g&&(this.response=R,oa(this))},t.ga=function(){this.g&&oa(this)};function oa(R){R.readyState=4,R.l=null,R.j=null,R.v=null,Dt(R)}t.setRequestHeader=function(R,H){this.u.append(R,H)},t.getResponseHeader=function(R){return this.h&&this.h.get(R.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const R=[],H=this.h.entries();for(var ue=H.next();!ue.done;)ue=ue.value,R.push(ue[0]+": "+ue[1]),ue=H.next();return R.join(`\r
`)};function Dt(R){R.onreadystatechange&&R.onreadystatechange.call(R)}Object.defineProperty(Yc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(R){this.m=R?"include":"same-origin"}});function sc(R){let H="";return we(R,function(ue,Me){H+=Me,H+=":",H+=ue,H+=`\r
`}),H}function hd(R,H,ue){e:{for(Me in ue){var Me=!1;break e}Me=!0}Me||(ue=sc(ue),typeof R=="string"?ue!=null&&encodeURIComponent(String(ue)):di(R,H,ue))}function fi(R){en.call(this),this.headers=new Map,this.o=R||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}J(fi,en);var sr=/^https?$/i,io=["POST","PUT"];t=fi.prototype,t.Ha=function(R){this.J=R},t.ea=function(R,H,ue,Me){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+R);H=H?H.toUpperCase():"GET",this.D=R,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():le.g(),this.v=this.o?vi(this.o):vi(le),this.g.onreadystatechange=F(this.Ea,this);try{this.B=!0,this.g.open(H,String(R),!0),this.B=!1}catch(Tt){Jc(this,Tt);return}if(R=ue||"",ue=new Map(this.headers),Me)if(Object.getPrototypeOf(Me)===Object.prototype)for(var ct in Me)ue.set(ct,Me[ct]);else if(typeof Me.keys=="function"&&typeof Me.get=="function")for(const Tt of Me.keys())ue.set(Tt,Me.get(Tt));else throw Error("Unknown input type for opt_headers: "+String(Me));Me=Array.from(ue.keys()).find(Tt=>Tt.toLowerCase()=="content-type"),ct=x.FormData&&R instanceof x.FormData,!(0<=Array.prototype.indexOf.call(io,H,void 0))||Me||ct||ue.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Tt,rn]of ue)this.g.setRequestHeader(Tt,rn);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Kn(this),this.u=!0,this.g.send(R),this.u=!1}catch(Tt){Jc(this,Tt)}};function Jc(R,H){R.h=!1,R.g&&(R.j=!0,R.g.abort(),R.j=!1),R.l=H,R.m=5,Ju(R),yo(R)}function Ju(R){R.A||(R.A=!0,Ye(R,"complete"),Ye(R,"error"))}t.abort=function(R){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=R||7,Ye(this,"complete"),Ye(this,"abort"),yo(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),yo(this,!0)),fi.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?eh(this):this.bb())},t.bb=function(){eh(this)};function eh(R){if(R.h&&typeof _<"u"&&(!R.v[1]||aa(R)!=4||R.Z()!=2)){if(R.u&&aa(R)==4)bn(R.Ea,0,R);else if(Ye(R,"readystatechange"),aa(R)==4){R.h=!1;try{const rn=R.Z();e:switch(rn){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var H=!0;break e;default:H=!1}var ue;if(!(ue=H)){var Me;if(Me=rn===0){var ct=String(R.D).match(ad)[1]||null;!ct&&x.self&&x.self.location&&(ct=x.self.location.protocol.slice(0,-1)),Me=!sr.test(ct?ct.toLowerCase():"")}ue=Me}if(ue)Ye(R,"complete"),Ye(R,"success");else{R.m=6;try{var Tt=2<aa(R)?R.g.statusText:""}catch{Tt=""}R.l=Tt+" ["+R.Z()+"]",Ju(R)}}finally{yo(R)}}}}function yo(R,H){if(R.g){Kn(R);const ue=R.g,Me=R.v[0]?()=>{}:null;R.g=null,R.v=null,H||Ye(R,"ready");try{ue.onreadystatechange=Me}catch{}}}function Kn(R){R.I&&(x.clearTimeout(R.I),R.I=null)}t.isActive=function(){return!!this.g};function aa(R){return R.g?R.g.readyState:0}t.Z=function(){try{return 2<aa(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(R){if(this.g){var H=this.g.responseText;return R&&H.indexOf(R)==0&&(H=H.substring(R.length)),Kt(H)}};function oc(R){try{if(!R.g)return null;if("response"in R.g)return R.g.response;switch(R.H){case"":case"text":return R.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in R.g)return R.g.mozResponseArrayBuffer}return null}catch{return null}}function th(R){const H={};R=(R.g&&2<=aa(R)&&R.g.getAllResponseHeaders()||"").split(`\r
`);for(let Me=0;Me<R.length;Me++){if(Q(R[Me]))continue;var ue=be(R[Me]);const ct=ue[0];if(ue=ue[1],typeof ue!="string")continue;ue=ue.trim();const Tt=H[ct]||[];H[ct]=Tt,Tt.push(ue)}oe(H,function(Me){return Me.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ac(R,H,ue){return ue&&ue.internalChannelParams&&ue.internalChannelParams[R]||H}function Rs(R){this.Aa=0,this.i=[],this.j=new si,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ac("failFast",!1,R),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ac("baseRetryDelayMs",5e3,R),this.cb=ac("retryDelaySeedMs",1e4,R),this.Wa=ac("forwardChannelMaxRetries",2,R),this.wa=ac("forwardChannelRequestTimeoutMs",2e4,R),this.pa=R&&R.xmlHttpFactory||void 0,this.Xa=R&&R.Tb||void 0,this.Ca=R&&R.useFetchStreams||!1,this.L=void 0,this.J=R&&R.supportsCrossDomainXhr||!1,this.K="",this.h=new ei(R&&R.concurrentRequestLimit),this.Da=new Po,this.P=R&&R.fastHandshake||!1,this.O=R&&R.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=R&&R.Rb||!1,R&&R.xa&&this.j.xa(),R&&R.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&R&&R.detectBufferingProxy||!1,this.ja=void 0,R&&R.longPollingTimeout&&0<R.longPollingTimeout&&(this.ja=R.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=Rs.prototype,t.la=8,t.G=1,t.connect=function(R,H,ue,Me){Rr(0),this.W=R,this.H=H||{},ue&&Me!==void 0&&(this.H.OSID=ue,this.H.OAID=Me),this.F=this.X,this.I=fd(this,null,this.W),Ia(this)};function dd(R){if(cc(R),R.G==3){var H=R.U++,ue=Uo(R.I);if(di(ue,"SID",R.K),di(ue,"RID",H),di(ue,"TYPE","terminate"),Xa(R,ue),H=new Oe(R,R.j,H),H.L=2,H.v=Wc(Uo(ue)),ue=!1,x.navigator&&x.navigator.sendBeacon)try{ue=x.navigator.sendBeacon(H.v.toString(),"")}catch{}!ue&&x.Image&&(new Image().src=H.v,ue=!0),ue||(H.g=nu(H.j,null),H.g.ea(H.v)),H.F=Date.now(),$t(H)}tu(R)}function lc(R){R.g&&(vs(R),R.g.cancel(),R.g=null)}function cc(R){lc(R),R.u&&(x.clearTimeout(R.u),R.u=null),la(R),R.h.cancel(),R.s&&(typeof R.s=="number"&&x.clearTimeout(R.s),R.s=null)}function Ia(R){if(!vr(R.h)&&!R.s){R.s=!0;var H=R.Ga;Pt||nn(),lt||(Pt(),lt=!0),At.add(H,R),R.B=0}}function rp(R,H){return dr(R.h)>=R.h.j-(R.s?1:0)?!1:R.s?(R.i=H.D.concat(R.i),!0):R.G==1||R.G==2||R.B>=(R.Va?0:R.Wa)?!1:(R.s=$i(F(R.Ga,R,H),uc(R,R.B)),R.B++,!0)}t.Ga=function(R){if(this.s)if(this.s=null,this.G==1){if(!R){this.U=Math.floor(1e5*Math.random()),R=this.U++;const ct=new Oe(this,this.j,R);let Tt=this.o;if(this.S&&(Tt?(Tt=de(Tt),ge(Tt,this.S)):Tt=this.S),this.m!==null||this.O||(ct.H=Tt,Tt=null),this.P)e:{for(var H=0,ue=0;ue<this.i.length;ue++){t:{var Me=this.i[ue];if("__data__"in Me.map&&(Me=Me.map.__data__,typeof Me=="string")){Me=Me.length;break t}Me=void 0}if(Me===void 0)break;if(H+=Me,4096<H){H=ue;break e}if(H===4096||ue===this.i.length-1){H=ue+1;break e}}H=1e3}else H=1e3;H=eu(this,ct,H),ue=Uo(this.I),di(ue,"RID",R),di(ue,"CVER",22),this.D&&di(ue,"X-HTTP-Session-Id",this.D),Xa(this,ue),Tt&&(this.O?H="headers="+encodeURIComponent(String(sc(Tt)))+"&"+H:this.m&&hd(ue,this.m,Tt)),bi(this.h,ct),this.Ua&&di(ue,"TYPE","init"),this.P?(di(ue,"$req",H),di(ue,"SID","null"),ct.T=!0,$e(ct,ue,null)):$e(ct,ue,H),this.G=2}}else this.G==3&&(R?nh(this,R):this.i.length==0||vr(this.h)||nh(this))};function nh(R,H){var ue;H?ue=H.l:ue=R.U++;const Me=Uo(R.I);di(Me,"SID",R.K),di(Me,"RID",ue),di(Me,"AID",R.T),Xa(R,Me),R.m&&R.o&&hd(Me,R.m,R.o),ue=new Oe(R,R.j,ue,R.B+1),R.m===null&&(ue.H=R.o),H&&(R.i=H.D.concat(R.i)),H=eu(R,ue,1e3),ue.I=Math.round(.5*R.wa)+Math.round(.5*R.wa*Math.random()),bi(R.h,ue),$e(ue,Me,H)}function Xa(R,H){R.H&&we(R.H,function(ue,Me){di(H,Me,ue)}),R.l&&od({},function(ue,Me){di(H,Me,ue)})}function eu(R,H,ue){ue=Math.min(R.i.length,ue);var Me=R.l?F(R.l.Na,R.l,R):null;e:{var ct=R.i;let Tt=-1;for(;;){const rn=["count="+ue];Tt==-1?0<ue?(Tt=ct[0].g,rn.push("ofs="+Tt)):Tt=0:rn.push("ofs="+Tt);let ui=!0;for(let xs=0;xs<ue;xs++){let Hr=ct[xs].g;const ks=ct[xs].map;if(Hr-=Tt,0>Hr)Tt=Math.max(0,ct[xs].g-100),ui=!1;else try{hg(ks,rn,"req"+Hr+"_")}catch{Me&&Me(ks)}}if(ui){Me=rn.join("&");break e}}}return R=R.i.splice(0,ue),H.D=R,Me}function Ms(R){if(!R.g&&!R.u){R.Y=1;var H=R.Fa;Pt||nn(),lt||(Pt(),lt=!0),At.add(H,R),R.v=0}}function Fs(R){return R.g||R.u||3<=R.v?!1:(R.Y++,R.u=$i(F(R.Fa,R),uc(R,R.v)),R.v++,!0)}t.Fa=function(){if(this.u=null,Ii(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var R=2*this.R;this.j.info("BP detection timer enabled: "+R),this.A=$i(F(this.ab,this),R)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Rr(10),lc(this),Ii(this))};function vs(R){R.A!=null&&(x.clearTimeout(R.A),R.A=null)}function Ii(R){R.g=new Oe(R,R.j,"rpc",R.Y),R.m===null&&(R.g.H=R.o),R.g.O=0;var H=Uo(R.qa);di(H,"RID","rpc"),di(H,"SID",R.K),di(H,"AID",R.T),di(H,"CI",R.F?"0":"1"),!R.F&&R.ja&&di(H,"TO",R.ja),di(H,"TYPE","xmlhttp"),Xa(R,H),R.m&&R.o&&hd(H,R.m,R.o),R.L&&(R.g.I=R.L);var ue=R.g;R=R.ia,ue.L=1,ue.v=Wc(Uo(H)),ue.m=null,ue.P=!0,Je(ue,R)}t.Za=function(){this.C!=null&&(this.C=null,lc(this),Fs(this),Rr(19))};function la(R){R.C!=null&&(x.clearTimeout(R.C),R.C=null)}function dg(R,H){var ue=null;if(R.g==H){la(R),vs(R),R.g=null;var Me=2}else if(xi(R.h,H))ue=H.D,Ki(R.h,H),Me=1;else return;if(R.G!=0){if(H.o)if(Me==1){ue=H.m?H.m.length:0,H=Date.now()-H.F;var ct=R.B;Me=Ln(),Ye(Me,new us(Me,ue)),Ia(R)}else Ms(R);else if(ct=H.s,ct==3||ct==0&&0<H.X||!(Me==1&&rp(R,H)||Me==2&&Fs(R)))switch(ue&&0<ue.length&&(H=R.h,H.i=H.i.concat(ue)),ct){case 1:$o(R,5);break;case 4:$o(R,10);break;case 3:$o(R,6);break;default:$o(R,2)}}}function uc(R,H){let ue=R.Ta+Math.floor(Math.random()*R.cb);return R.isActive()||(ue*=2),ue*H}function $o(R,H){if(R.j.info("Error code "+H),H==2){var ue=F(R.fb,R),Me=R.Xa;const ct=!Me;Me=new zn(Me||"//www.google.com/images/cleardot.gif"),x.location&&x.location.protocol=="http"||sa(Me,"https"),Wc(Me),ct?i0(Me.toString(),ue):np(Me.toString(),ue)}else Rr(2);R.G=0,R.l&&R.l.sa(H),tu(R),cc(R)}t.fb=function(R){R?(this.j.info("Successfully pinged google.com"),Rr(2)):(this.j.info("Failed to ping google.com"),Rr(1))};function tu(R){if(R.G=0,R.ka=[],R.l){const H=Ps(R.h);(H.length!=0||R.i.length!=0)&&(se(R.ka,H),se(R.ka,R.i),R.h.i.length=0,ne(R.i),R.i.length=0),R.l.ra()}}function fd(R,H,ue){var Me=ue instanceof zn?Uo(ue):new zn(ue);if(Me.g!="")H&&(Me.g=H+"."+Me.g),qc(Me,Me.s);else{var ct=x.location;Me=ct.protocol,H=H?H+"."+ct.hostname:ct.hostname,ct=+ct.port;var Tt=new zn(null);Me&&sa(Tt,Me),H&&(Tt.g=H),ct&&qc(Tt,ct),ue&&(Tt.l=ue),Me=Tt}return ue=R.D,H=R.ya,ue&&H&&di(Me,ue,H),di(Me,"VER",R.la),Xa(R,Me),Me}function nu(R,H,ue){if(H&&!R.J)throw Error("Can't create secondary domain capable XhrIo object.");return H=R.Ca&&!R.pa?new fi(new Kc({eb:ue})):new fi(R.pa),H.Ha(R.J),H}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ka(){}t=Ka.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function Sl(){}Sl.prototype.g=function(R,H){return new hs(R,H)};function hs(R,H){en.call(this),this.g=new Rs(H),this.l=R,this.h=H&&H.messageUrlParams||null,R=H&&H.messageHeaders||null,H&&H.clientProtocolHeaderRequired&&(R?R["X-Client-Protocol"]="webchannel":R={"X-Client-Protocol":"webchannel"}),this.g.o=R,R=H&&H.initMessageHeaders||null,H&&H.messageContentType&&(R?R["X-WebChannel-Content-Type"]=H.messageContentType:R={"X-WebChannel-Content-Type":H.messageContentType}),H&&H.va&&(R?R["X-WebChannel-Client-Profile"]=H.va:R={"X-WebChannel-Client-Profile":H.va}),this.g.S=R,(R=H&&H.Sb)&&!Q(R)&&(this.g.m=R),this.v=H&&H.supportsCrossDomainXhr||!1,this.u=H&&H.sendRawJson||!1,(H=H&&H.httpSessionIdParam)&&!Q(H)&&(this.g.D=H,R=this.h,R!==null&&H in R&&(R=this.h,H in R&&delete R[H])),this.j=new Ya(this)}J(hs,en),hs.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},hs.prototype.close=function(){dd(this.g)},hs.prototype.o=function(R){var H=this.g;if(typeof R=="string"){var ue={};ue.__data__=R,R=ue}else this.u&&(ue={},ue.__data__=Rn(R),R=ue);H.i.push(new cn(H.Ya++,R)),H.G==3&&Ia(H)},hs.prototype.N=function(){this.g.l=null,delete this.j,dd(this.g),delete this.g,hs.aa.N.call(this)};function ru(R){Ao.call(this),R.__headers__&&(this.headers=R.__headers__,this.statusCode=R.__status__,delete R.__headers__,delete R.__status__);var H=R.__sm__;if(H){e:{for(const ue in H){R=ue;break e}R=void 0}(this.i=R)&&(R=this.i,H=H!==null&&R in H?H[R]:void 0),this.data=H}else this.data=R}J(ru,Ao);function iu(){Za.call(this),this.status=1}J(iu,Za);function Ya(R){this.g=R}J(Ya,Ka),Ya.prototype.ua=function(){Ye(this.g,"a")},Ya.prototype.ta=function(R){Ye(this.g,new ru(R))},Ya.prototype.sa=function(R){Ye(this.g,new iu)},Ya.prototype.ra=function(){Ye(this.g,"b")},Sl.prototype.createWebChannel=Sl.prototype.g,hs.prototype.send=hs.prototype.o,hs.prototype.open=hs.prototype.m,hs.prototype.close=hs.prototype.close,Oq=function(){return new Sl},Dq=function(){return Ln()},kq=_o,o3={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Be.NO_ERROR=0,Be.TIMEOUT=8,Be.HTTP_ERROR=6,xE=Be,te.COMPLETE="complete",Mq=te,go.EventType=Xi,Xi.OPEN="a",Xi.CLOSE="b",Xi.ERROR="c",Xi.MESSAGE="d",en.prototype.listen=en.prototype.K,tx=go,Rq=Kc,fi.prototype.listenOnce=fi.prototype.L,fi.prototype.getLastError=fi.prototype.Ka,fi.prototype.getLastErrorCode=fi.prototype.Ba,fi.prototype.getStatus=fi.prototype.Z,fi.prototype.getResponseJson=fi.prototype.Oa,fi.prototype.getResponseText=fi.prototype.oa,fi.prototype.send=fi.prototype.ea,fi.prototype.setWithCredentials=fi.prototype.Ha,Pq=fi}).apply(typeof NT<"u"?NT:typeof self<"u"?self:typeof window<"u"?window:{});const XU="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qo{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Qo.UNAUTHENTICATED=new Qo(null),Qo.GOOGLE_CREDENTIALS=new Qo("google-credentials-uid"),Qo.FIRST_PARTY=new Qo("first-party-uid"),Qo.MOCK_USER=new Qo("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Hy="10.13.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zm=new $O("@firebase/firestore");function zv(){return zm.logLevel}function qn(t,...e){if(zm.logLevel<=ri.DEBUG){const r=e.map(rL);zm.debug(`Firestore (${Hy}): ${t}`,...r)}}function Zh(t,...e){if(zm.logLevel<=ri.ERROR){const r=e.map(rL);zm.error(`Firestore (${Hy}): ${t}`,...r)}}function wy(t,...e){if(zm.logLevel<=ri.WARN){const r=e.map(rL);zm.warn(`Firestore (${Hy}): ${t}`,...r)}}function rL(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(r){return JSON.stringify(r)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ir(t="Unexpected state"){const e=`FIRESTORE (${Hy}) INTERNAL ASSERTION FAILED: `+t;throw Zh(e),new Error(e)}function Vi(t,e){t||Ir()}function Dr(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class On extends Zu{constructor(e,r){super(e,r),this.code=e,this.message=r,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jh{constructor(){this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lq{constructor(e,r){this.user=r,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Vhe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,r){e.enqueueRetryable(()=>r(Qo.UNAUTHENTICATED))}shutdown(){}}class $he{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,r){this.changeListener=r,e.enqueueRetryable(()=>r(this.token.user))}shutdown(){this.changeListener=null}}class Ghe{constructor(e){this.t=e,this.currentUser=Qo.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,r){let o=this.i;const c=a=>this.i!==o?(o=this.i,r(a)):Promise.resolve();let f=new jh;this.o=()=>{this.i++,this.currentUser=this.u(),f.resolve(),f=new jh,e.enqueueRetryable(()=>c(this.currentUser))};const _=()=>{const a=f;e.enqueueRetryable(async()=>{await a.promise,await c(this.currentUser)})},x=a=>{qn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=a,this.auth.addAuthTokenListener(this.o),_()};this.t.onInit(a=>x(a)),setTimeout(()=>{if(!this.auth){const a=this.t.getImmediate({optional:!0});a?x(a):(qn("FirebaseAuthCredentialsProvider","Auth not yet detected"),f.resolve(),f=new jh)}},0),_()}getToken(){const e=this.i,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(o=>this.i!==e?(qn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(Vi(typeof o.accessToken=="string"),new Lq(o.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Vi(e===null||typeof e=="string"),new Qo(e)}}class qhe{constructor(e,r,o){this.l=e,this.h=r,this.P=o,this.type="FirstParty",this.user=Qo.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Whe{constructor(e,r,o){this.l=e,this.h=r,this.P=o}getToken(){return Promise.resolve(new qhe(this.l,this.h,this.P))}start(e,r){e.enqueueRetryable(()=>r(Qo.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Hhe{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Zhe{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,r){const o=f=>{f.error!=null&&qn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${f.error.message}`);const _=f.token!==this.R;return this.R=f.token,qn("FirebaseAppCheckTokenProvider",`Received ${_?"new":"existing"} token.`),_?r(f.token):Promise.resolve()};this.o=f=>{e.enqueueRetryable(()=>o(f))};const c=f=>{qn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=f,this.appCheck.addTokenListener(this.o)};this.A.onInit(f=>c(f)),setTimeout(()=>{if(!this.appCheck){const f=this.A.getImmediate({optional:!0});f?c(f):qn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(r=>r?(Vi(typeof r.token=="string"),this.R=r.token,new Hhe(r.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xhe(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(r);else for(let o=0;o<t;o++)r[o]=Math.floor(256*Math.random());return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zq{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=Math.floor(256/e.length)*e.length;let o="";for(;o.length<20;){const c=Xhe(40);for(let f=0;f<c.length;++f)o.length<20&&c[f]<r&&(o+=e.charAt(c[f]%e.length))}return o}}function hi(t,e){return t<e?-1:t>e?1:0}function Ty(t,e,r){return t.length===e.length&&t.every((o,c)=>r(o,e[c]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(e,r){if(this.seconds=e,this.nanoseconds=r,r<0)throw new On(Xt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new On(Xt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(e<-62135596800)throw new On(Xt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new On(Xt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return mo.fromMillis(Date.now())}static fromDate(e){return mo.fromMillis(e.getTime())}static fromMillis(e){const r=Math.floor(e/1e3),o=Math.floor(1e6*(e-1e3*r));return new mo(r,o)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?hi(this.nanoseconds,e.nanoseconds):hi(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kr{constructor(e){this.timestamp=e}static fromTimestamp(e){return new kr(e)}static min(){return new kr(new mo(0,0))}static max(){return new kr(new mo(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _1{constructor(e,r,o){r===void 0?r=0:r>e.length&&Ir(),o===void 0?o=e.length-r:o>e.length-r&&Ir(),this.segments=e,this.offset=r,this.len=o}get length(){return this.len}isEqual(e){return _1.comparator(this,e)===0}child(e){const r=this.segments.slice(this.offset,this.limit());return e instanceof _1?e.forEach(o=>{r.push(o)}):r.push(e),this.construct(r)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}forEach(e){for(let r=this.offset,o=this.limit();r<o;r++)e(this.segments[r])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,r){const o=Math.min(e.length,r.length);for(let c=0;c<o;c++){const f=e.get(c),_=r.get(c);if(f<_)return-1;if(f>_)return 1}return e.length<r.length?-1:e.length>r.length?1:0}}class is extends _1{construct(e,r,o){return new is(e,r,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const r=[];for(const o of e){if(o.indexOf("//")>=0)throw new On(Xt.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);r.push(...o.split("/").filter(c=>c.length>0))}return new is(r)}static emptyPath(){return new is([])}}const Khe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Lo extends _1{construct(e,r,o){return new Lo(e,r,o)}static isValidIdentifier(e){return Khe.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Lo.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Lo(["__name__"])}static fromServerFormat(e){const r=[];let o="",c=0;const f=()=>{if(o.length===0)throw new On(Xt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);r.push(o),o=""};let _=!1;for(;c<e.length;){const x=e[c];if(x==="\\"){if(c+1===e.length)throw new On(Xt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const a=e[c+1];if(a!=="\\"&&a!=="."&&a!=="`")throw new On(Xt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=a,c+=2}else x==="`"?(_=!_,c++):x!=="."||_?(o+=x,c++):(f(),c++)}if(f(),_)throw new On(Xt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Lo(r)}static emptyPath(){return new Lo([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lr{constructor(e){this.path=e}static fromPath(e){return new lr(is.fromString(e))}static fromName(e){return new lr(is.fromString(e).popFirst(5))}static empty(){return new lr(is.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&is.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,r){return is.comparator(e.path,r.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new lr(new is(e.slice()))}}function Yhe(t,e){const r=t.toTimestamp().seconds,o=t.toTimestamp().nanoseconds+1,c=kr.fromTimestamp(o===1e9?new mo(r+1,0):new mo(r,o));return new Bf(c,lr.empty(),e)}function Qhe(t){return new Bf(t.readTime,t.key,-1)}class Bf{constructor(e,r,o){this.readTime=e,this.documentKey=r,this.largestBatchId=o}static min(){return new Bf(kr.min(),lr.empty(),-1)}static max(){return new Bf(kr.max(),lr.empty(),-1)}}function Jhe(t,e){let r=t.readTime.compareTo(e.readTime);return r!==0?r:(r=lr.comparator(t.documentKey,e.documentKey),r!==0?r:hi(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ede="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class tde{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tb(t){if(t.code!==Xt.FAILED_PRECONDITION||t.message!==ede)throw t;qn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sn{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(r=>{this.isDone=!0,this.result=r,this.nextCallback&&this.nextCallback(r)},r=>{this.isDone=!0,this.error=r,this.catchCallback&&this.catchCallback(r)})}catch(e){return this.next(void 0,e)}next(e,r){return this.callbackAttached&&Ir(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(r,this.error):this.wrapSuccess(e,this.result):new sn((o,c)=>{this.nextCallback=f=>{this.wrapSuccess(e,f).next(o,c)},this.catchCallback=f=>{this.wrapFailure(r,f).next(o,c)}})}toPromise(){return new Promise((e,r)=>{this.next(e,r)})}wrapUserFunction(e){try{const r=e();return r instanceof sn?r:sn.resolve(r)}catch(r){return sn.reject(r)}}wrapSuccess(e,r){return e?this.wrapUserFunction(()=>e(r)):sn.resolve(r)}wrapFailure(e,r){return e?this.wrapUserFunction(()=>e(r)):sn.reject(r)}static resolve(e){return new sn((r,o)=>{r(e)})}static reject(e){return new sn((r,o)=>{o(e)})}static waitFor(e){return new sn((r,o)=>{let c=0,f=0,_=!1;e.forEach(x=>{++c,x.next(()=>{++f,_&&f===c&&r()},a=>o(a))}),_=!0,f===c&&r()})}static or(e){let r=sn.resolve(!1);for(const o of e)r=r.next(c=>c?sn.resolve(c):o());return r}static forEach(e,r){const o=[];return e.forEach((c,f)=>{o.push(r.call(this,c,f))}),this.waitFor(o)}static mapArray(e,r){return new sn((o,c)=>{const f=e.length,_=new Array(f);let x=0;for(let a=0;a<f;a++){const I=a;r(e[I]).next(D=>{_[I]=D,++x,x===f&&o(_)},D=>c(D))}})}static doWhile(e,r){return new sn((o,c)=>{const f=()=>{e()===!0?r().next(()=>{f()},c):o()};f()})}}function nde(t){const e=t.match(/Android ([\d.]+)/i),r=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(r)}function nb(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iL{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=o=>this.ie(o),this.se=o=>r.writeSequenceNumber(o))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}iL.oe=-1;function XI(t){return t==null}function wS(t){return t===0&&1/t==-1/0}function rde(t){return typeof t=="number"&&Number.isInteger(t)&&!wS(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KU(t){let e=0;for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}function ig(t,e){for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e(r,t[r])}function Nq(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class As{constructor(e,r){this.comparator=e,this.root=r||ko.EMPTY}insert(e,r){return new As(this.comparator,this.root.insert(e,r,this.comparator).copy(null,null,ko.BLACK,null,null))}remove(e){return new As(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ko.BLACK,null,null))}get(e){let r=this.root;for(;!r.isEmpty();){const o=this.comparator(e,r.key);if(o===0)return r.value;o<0?r=r.left:o>0&&(r=r.right)}return null}indexOf(e){let r=0,o=this.root;for(;!o.isEmpty();){const c=this.comparator(e,o.key);if(c===0)return r+o.left.size;c<0?o=o.left:(r+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((r,o)=>(e(r,o),!1))}toString(){const e=[];return this.inorderTraversal((r,o)=>(e.push(`${r}:${o}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new FT(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new FT(this.root,e,this.comparator,!1)}getReverseIterator(){return new FT(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new FT(this.root,e,this.comparator,!0)}}class FT{constructor(e,r,o,c){this.isReverse=c,this.nodeStack=[];let f=1;for(;!e.isEmpty();)if(f=r?o(e.key,r):1,r&&c&&(f*=-1),f<0)e=this.isReverse?e.left:e.right;else{if(f===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const r={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return r}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ko{constructor(e,r,o,c,f){this.key=e,this.value=r,this.color=o??ko.RED,this.left=c??ko.EMPTY,this.right=f??ko.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,r,o,c,f){return new ko(e??this.key,r??this.value,o??this.color,c??this.left,f??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,o){let c=this;const f=o(e,c.key);return c=f<0?c.copy(null,null,null,c.left.insert(e,r,o),null):f===0?c.copy(null,r,null,null,null):c.copy(null,null,null,null,c.right.insert(e,r,o)),c.fixUp()}removeMin(){if(this.left.isEmpty())return ko.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,r){let o,c=this;if(r(e,c.key)<0)c.left.isEmpty()||c.left.isRed()||c.left.left.isRed()||(c=c.moveRedLeft()),c=c.copy(null,null,null,c.left.remove(e,r),null);else{if(c.left.isRed()&&(c=c.rotateRight()),c.right.isEmpty()||c.right.isRed()||c.right.left.isRed()||(c=c.moveRedRight()),r(e,c.key)===0){if(c.right.isEmpty())return ko.EMPTY;o=c.right.min(),c=c.copy(o.key,o.value,null,null,c.right.removeMin())}c=c.copy(null,null,null,null,c.right.remove(e,r))}return c.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ko.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ko.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ir();const e=this.left.check();if(e!==this.right.check())throw Ir();return e+(this.isRed()?0:1)}}ko.EMPTY=null,ko.RED=!0,ko.BLACK=!1;ko.EMPTY=new class{constructor(){this.size=0}get key(){throw Ir()}get value(){throw Ir()}get color(){throw Ir()}get left(){throw Ir()}get right(){throw Ir()}copy(e,r,o,c,f){return this}insert(e,r,o){return new ko(e,r)}remove(e,r){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{constructor(e){this.comparator=e,this.data=new As(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((r,o)=>(e(r),!1))}forEachInRange(e,r){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const c=o.getNext();if(this.comparator(c.key,e[1])>=0)return;r(c.key)}}forEachWhile(e,r){let o;for(o=r!==void 0?this.data.getIteratorFrom(r):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const r=this.data.getIteratorFrom(e);return r.hasNext()?r.getNext().key:null}getIterator(){return new YU(this.data.getIterator())}getIteratorFrom(e){return new YU(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let r=this;return r.size<e.size&&(r=e,e=this),e.forEach(o=>{r=r.add(o)}),r}isEqual(e){if(!(e instanceof No)||this.size!==e.size)return!1;const r=this.data.getIterator(),o=e.data.getIterator();for(;r.hasNext();){const c=r.getNext().key,f=o.getNext().key;if(this.comparator(c,f)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(r=>{e.push(r)}),e}toString(){const e=[];return this.forEach(r=>e.push(r)),"SortedSet("+e.toString()+")"}copy(e){const r=new No(this.comparator);return r.data=e,r}}class YU{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(e){this.fields=e,e.sort(Lo.comparator)}static empty(){return new ll([])}unionWith(e){let r=new No(Lo.comparator);for(const o of this.fields)r=r.add(o);for(const o of e)r=r.add(o);return new ll(r.toArray())}covers(e){for(const r of this.fields)if(r.isPrefixOf(e))return!0;return!1}isEqual(e){return Ty(this.fields,e.fields,(r,o)=>r.isEqual(o))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fq extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo{constructor(e){this.binaryString=e}static fromBase64String(e){const r=function(c){try{return atob(c)}catch(f){throw typeof DOMException<"u"&&f instanceof DOMException?new Fq("Invalid base64 string: "+f):f}}(e);return new Bo(r)}static fromUint8Array(e){const r=function(c){let f="";for(let _=0;_<c.length;++_)f+=String.fromCharCode(c[_]);return f}(e);return new Bo(r)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(r){return btoa(r)}(this.binaryString)}toUint8Array(){return function(r){const o=new Uint8Array(r.length);for(let c=0;c<r.length;c++)o[c]=r.charCodeAt(c);return o}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return hi(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Bo.EMPTY_BYTE_STRING=new Bo("");const ide=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function jf(t){if(Vi(!!t),typeof t=="string"){let e=0;const r=ide.exec(t);if(Vi(!!r),r[1]){let c=r[1];c=(c+"000000000").substr(0,9),e=Number(c)}const o=new Date(t);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:Vs(t.seconds),nanos:Vs(t.nanos)}}function Vs(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Nm(t){return typeof t=="string"?Bo.fromBase64String(t):Bo.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sL(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="server_timestamp"}function oL(t){const e=t.mapValue.fields.__previous_value__;return sL(e)?oL(e):e}function y1(t){const e=jf(t.mapValue.fields.__local_write_time__.timestampValue);return new mo(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sde{constructor(e,r,o,c,f,_,x,a,I){this.databaseId=e,this.appId=r,this.persistenceKey=o,this.host=c,this.ssl=f,this.forceLongPolling=_,this.autoDetectLongPolling=x,this.longPollingOptions=a,this.useFetchStreams=I}}class v1{constructor(e,r){this.projectId=e,this.database=r||"(default)"}static empty(){return new v1("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof v1&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BT={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Fm(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?sL(t)?4:ade(t)?9007199254740991:ode(t)?10:11:Ir()}function Gu(t,e){if(t===e)return!0;const r=Fm(t);if(r!==Fm(e))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return y1(t).isEqual(y1(e));case 3:return function(c,f){if(typeof c.timestampValue=="string"&&typeof f.timestampValue=="string"&&c.timestampValue.length===f.timestampValue.length)return c.timestampValue===f.timestampValue;const _=jf(c.timestampValue),x=jf(f.timestampValue);return _.seconds===x.seconds&&_.nanos===x.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(c,f){return Nm(c.bytesValue).isEqual(Nm(f.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(c,f){return Vs(c.geoPointValue.latitude)===Vs(f.geoPointValue.latitude)&&Vs(c.geoPointValue.longitude)===Vs(f.geoPointValue.longitude)}(t,e);case 2:return function(c,f){if("integerValue"in c&&"integerValue"in f)return Vs(c.integerValue)===Vs(f.integerValue);if("doubleValue"in c&&"doubleValue"in f){const _=Vs(c.doubleValue),x=Vs(f.doubleValue);return _===x?wS(_)===wS(x):isNaN(_)&&isNaN(x)}return!1}(t,e);case 9:return Ty(t.arrayValue.values||[],e.arrayValue.values||[],Gu);case 10:case 11:return function(c,f){const _=c.mapValue.fields||{},x=f.mapValue.fields||{};if(KU(_)!==KU(x))return!1;for(const a in _)if(_.hasOwnProperty(a)&&(x[a]===void 0||!Gu(_[a],x[a])))return!1;return!0}(t,e);default:return Ir()}}function x1(t,e){return(t.values||[]).find(r=>Gu(r,e))!==void 0}function Ey(t,e){if(t===e)return 0;const r=Fm(t),o=Fm(e);if(r!==o)return hi(r,o);switch(r){case 0:case 9007199254740991:return 0;case 1:return hi(t.booleanValue,e.booleanValue);case 2:return function(f,_){const x=Vs(f.integerValue||f.doubleValue),a=Vs(_.integerValue||_.doubleValue);return x<a?-1:x>a?1:x===a?0:isNaN(x)?isNaN(a)?0:-1:1}(t,e);case 3:return QU(t.timestampValue,e.timestampValue);case 4:return QU(y1(t),y1(e));case 5:return hi(t.stringValue,e.stringValue);case 6:return function(f,_){const x=Nm(f),a=Nm(_);return x.compareTo(a)}(t.bytesValue,e.bytesValue);case 7:return function(f,_){const x=f.split("/"),a=_.split("/");for(let I=0;I<x.length&&I<a.length;I++){const D=hi(x[I],a[I]);if(D!==0)return D}return hi(x.length,a.length)}(t.referenceValue,e.referenceValue);case 8:return function(f,_){const x=hi(Vs(f.latitude),Vs(_.latitude));return x!==0?x:hi(Vs(f.longitude),Vs(_.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return JU(t.arrayValue,e.arrayValue);case 10:return function(f,_){var x,a,I,D;const O=f.fields||{},F=_.fields||{},Z=(x=O.value)===null||x===void 0?void 0:x.arrayValue,J=(a=F.value)===null||a===void 0?void 0:a.arrayValue,ne=hi(((I=Z==null?void 0:Z.values)===null||I===void 0?void 0:I.length)||0,((D=J==null?void 0:J.values)===null||D===void 0?void 0:D.length)||0);return ne!==0?ne:JU(Z,J)}(t.mapValue,e.mapValue);case 11:return function(f,_){if(f===BT.mapValue&&_===BT.mapValue)return 0;if(f===BT.mapValue)return 1;if(_===BT.mapValue)return-1;const x=f.fields||{},a=Object.keys(x),I=_.fields||{},D=Object.keys(I);a.sort(),D.sort();for(let O=0;O<a.length&&O<D.length;++O){const F=hi(a[O],D[O]);if(F!==0)return F;const Z=Ey(x[a[O]],I[D[O]]);if(Z!==0)return Z}return hi(a.length,D.length)}(t.mapValue,e.mapValue);default:throw Ir()}}function QU(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return hi(t,e);const r=jf(t),o=jf(e),c=hi(r.seconds,o.seconds);return c!==0?c:hi(r.nanos,o.nanos)}function JU(t,e){const r=t.values||[],o=e.values||[];for(let c=0;c<r.length&&c<o.length;++c){const f=Ey(r[c],o[c]);if(f)return f}return hi(r.length,o.length)}function Sy(t){return a3(t)}function a3(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(r){const o=jf(r);return`time(${o.seconds},${o.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(r){return Nm(r).toBase64()}(t.bytesValue):"referenceValue"in t?function(r){return lr.fromName(r).toString()}(t.referenceValue):"geoPointValue"in t?function(r){return`geo(${r.latitude},${r.longitude})`}(t.geoPointValue):"arrayValue"in t?function(r){let o="[",c=!0;for(const f of r.values||[])c?c=!1:o+=",",o+=a3(f);return o+"]"}(t.arrayValue):"mapValue"in t?function(r){const o=Object.keys(r.fields||{}).sort();let c="{",f=!0;for(const _ of o)f?f=!1:c+=",",c+=`${_}:${a3(r.fields[_])}`;return c+"}"}(t.mapValue):Ir()}function eV(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function l3(t){return!!t&&"integerValue"in t}function aL(t){return!!t&&"arrayValue"in t}function tV(t){return!!t&&"nullValue"in t}function nV(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function bE(t){return!!t&&"mapValue"in t}function ode(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="__vector__"}function Cx(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return ig(t.mapValue.fields,(r,o)=>e.mapValue.fields[r]=Cx(o)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let r=0;r<(t.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=Cx(t.arrayValue.values[r]);return e}return Object.assign({},t)}function ade(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ba{constructor(e){this.value=e}static empty(){return new Ba({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let r=this.value;for(let o=0;o<e.length-1;++o)if(r=(r.mapValue.fields||{})[e.get(o)],!bE(r))return null;return r=(r.mapValue.fields||{})[e.lastSegment()],r||null}}set(e,r){this.getFieldsMap(e.popLast())[e.lastSegment()]=Cx(r)}setAll(e){let r=Lo.emptyPath(),o={},c=[];e.forEach((_,x)=>{if(!r.isImmediateParentOf(x)){const a=this.getFieldsMap(r);this.applyChanges(a,o,c),o={},c=[],r=x.popLast()}_?o[x.lastSegment()]=Cx(_):c.push(x.lastSegment())});const f=this.getFieldsMap(r);this.applyChanges(f,o,c)}delete(e){const r=this.field(e.popLast());bE(r)&&r.mapValue.fields&&delete r.mapValue.fields[e.lastSegment()]}isEqual(e){return Gu(this.value,e.value)}getFieldsMap(e){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let o=0;o<e.length;++o){let c=r.mapValue.fields[e.get(o)];bE(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},r.mapValue.fields[e.get(o)]=c),r=c}return r.mapValue.fields}applyChanges(e,r,o){ig(r,(c,f)=>e[c]=f);for(const c of o)delete e[c]}clone(){return new Ba(Cx(this.value))}}function Bq(t){const e=[];return ig(t.fields,(r,o)=>{const c=new Lo([r]);if(bE(o)){const f=Bq(o.mapValue).fields;if(f.length===0)e.push(c);else for(const _ of f)e.push(c.child(_))}else e.push(c)}),new ll(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{constructor(e,r,o,c,f,_,x){this.key=e,this.documentType=r,this.version=o,this.readTime=c,this.createTime=f,this.data=_,this.documentState=x}static newInvalidDocument(e){return new ea(e,0,kr.min(),kr.min(),kr.min(),Ba.empty(),0)}static newFoundDocument(e,r,o,c){return new ea(e,1,r,kr.min(),o,c,0)}static newNoDocument(e,r){return new ea(e,2,r,kr.min(),kr.min(),Ba.empty(),0)}static newUnknownDocument(e,r){return new ea(e,3,r,kr.min(),kr.min(),Ba.empty(),2)}convertToFoundDocument(e,r){return!this.createTime.isEqual(kr.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=r,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ba.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ba.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=kr.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ea&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ea(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TS{constructor(e,r){this.position=e,this.inclusive=r}}function rV(t,e,r){let o=0;for(let c=0;c<t.position.length;c++){const f=e[c],_=t.position[c];if(f.field.isKeyField()?o=lr.comparator(lr.fromName(_.referenceValue),r.key):o=Ey(_,r.data.field(f.field)),f.dir==="desc"&&(o*=-1),o!==0)break}return o}function iV(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let r=0;r<t.position.length;r++)if(!Gu(t.position[r],e.position[r]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b1{constructor(e,r="asc"){this.field=e,this.dir=r}}function lde(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jq{}class eo extends jq{constructor(e,r,o){super(),this.field=e,this.op=r,this.value=o}static create(e,r,o){return e.isKeyField()?r==="in"||r==="not-in"?this.createKeyFieldInFilter(e,r,o):new ude(e,r,o):r==="array-contains"?new fde(e,o):r==="in"?new pde(e,o):r==="not-in"?new mde(e,o):r==="array-contains-any"?new gde(e,o):new eo(e,r,o)}static createKeyFieldInFilter(e,r,o){return r==="in"?new hde(e,o):new dde(e,o)}matches(e){const r=e.data.field(this.field);return this.op==="!="?r!==null&&this.matchesComparison(Ey(r,this.value)):r!==null&&Fm(this.value)===Fm(r)&&this.matchesComparison(Ey(r,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ir()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Vc extends jq{constructor(e,r){super(),this.filters=e,this.op=r,this.ae=null}static create(e,r){return new Vc(e,r)}matches(e){return Uq(this)?this.filters.find(r=>!r.matches(e))===void 0:this.filters.find(r=>r.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,r)=>e.concat(r.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Uq(t){return t.op==="and"}function Vq(t){return cde(t)&&Uq(t)}function cde(t){for(const e of t.filters)if(e instanceof Vc)return!1;return!0}function c3(t){if(t instanceof eo)return t.field.canonicalString()+t.op.toString()+Sy(t.value);if(Vq(t))return t.filters.map(e=>c3(e)).join(",");{const e=t.filters.map(r=>c3(r)).join(",");return`${t.op}(${e})`}}function $q(t,e){return t instanceof eo?function(o,c){return c instanceof eo&&o.op===c.op&&o.field.isEqual(c.field)&&Gu(o.value,c.value)}(t,e):t instanceof Vc?function(o,c){return c instanceof Vc&&o.op===c.op&&o.filters.length===c.filters.length?o.filters.reduce((f,_,x)=>f&&$q(_,c.filters[x]),!0):!1}(t,e):void Ir()}function Gq(t){return t instanceof eo?function(r){return`${r.field.canonicalString()} ${r.op} ${Sy(r.value)}`}(t):t instanceof Vc?function(r){return r.op.toString()+" {"+r.getFilters().map(Gq).join(" ,")+"}"}(t):"Filter"}class ude extends eo{constructor(e,r,o){super(e,r,o),this.key=lr.fromName(o.referenceValue)}matches(e){const r=lr.comparator(e.key,this.key);return this.matchesComparison(r)}}class hde extends eo{constructor(e,r){super(e,"in",r),this.keys=qq("in",r)}matches(e){return this.keys.some(r=>r.isEqual(e.key))}}class dde extends eo{constructor(e,r){super(e,"not-in",r),this.keys=qq("not-in",r)}matches(e){return!this.keys.some(r=>r.isEqual(e.key))}}function qq(t,e){var r;return(((r=e.arrayValue)===null||r===void 0?void 0:r.values)||[]).map(o=>lr.fromName(o.referenceValue))}class fde extends eo{constructor(e,r){super(e,"array-contains",r)}matches(e){const r=e.data.field(this.field);return aL(r)&&x1(r.arrayValue,this.value)}}class pde extends eo{constructor(e,r){super(e,"in",r)}matches(e){const r=e.data.field(this.field);return r!==null&&x1(this.value.arrayValue,r)}}class mde extends eo{constructor(e,r){super(e,"not-in",r)}matches(e){if(x1(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const r=e.data.field(this.field);return r!==null&&!x1(this.value.arrayValue,r)}}class gde extends eo{constructor(e,r){super(e,"array-contains-any",r)}matches(e){const r=e.data.field(this.field);return!(!aL(r)||!r.arrayValue.values)&&r.arrayValue.values.some(o=>x1(this.value.arrayValue,o))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _de{constructor(e,r=null,o=[],c=[],f=null,_=null,x=null){this.path=e,this.collectionGroup=r,this.orderBy=o,this.filters=c,this.limit=f,this.startAt=_,this.endAt=x,this.ue=null}}function sV(t,e=null,r=[],o=[],c=null,f=null,_=null){return new _de(t,e,r,o,c,f,_)}function lL(t){const e=Dr(t);if(e.ue===null){let r=e.path.canonicalString();e.collectionGroup!==null&&(r+="|cg:"+e.collectionGroup),r+="|f:",r+=e.filters.map(o=>c3(o)).join(","),r+="|ob:",r+=e.orderBy.map(o=>function(f){return f.field.canonicalString()+f.dir}(o)).join(","),XI(e.limit)||(r+="|l:",r+=e.limit),e.startAt&&(r+="|lb:",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(o=>Sy(o)).join(",")),e.endAt&&(r+="|ub:",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(o=>Sy(o)).join(",")),e.ue=r}return e.ue}function cL(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let r=0;r<t.orderBy.length;r++)if(!lde(t.orderBy[r],e.orderBy[r]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let r=0;r<t.filters.length;r++)if(!$q(t.filters[r],e.filters[r]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!iV(t.startAt,e.startAt)&&iV(t.endAt,e.endAt)}function u3(t){return lr.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zy{constructor(e,r=null,o=[],c=[],f=null,_="F",x=null,a=null){this.path=e,this.collectionGroup=r,this.explicitOrderBy=o,this.filters=c,this.limit=f,this.limitType=_,this.startAt=x,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function yde(t,e,r,o,c,f,_,x){return new Zy(t,e,r,o,c,f,_,x)}function KI(t){return new Zy(t)}function oV(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function Wq(t){return t.collectionGroup!==null}function Px(t){const e=Dr(t);if(e.ce===null){e.ce=[];const r=new Set;for(const f of e.explicitOrderBy)e.ce.push(f),r.add(f.field.canonicalString());const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(_){let x=new No(Lo.comparator);return _.filters.forEach(a=>{a.getFlattenedFilters().forEach(I=>{I.isInequality()&&(x=x.add(I.field))})}),x})(e).forEach(f=>{r.has(f.canonicalString())||f.isKeyField()||e.ce.push(new b1(f,o))}),r.has(Lo.keyField().canonicalString())||e.ce.push(new b1(Lo.keyField(),o))}return e.ce}function ju(t){const e=Dr(t);return e.le||(e.le=vde(e,Px(t))),e.le}function vde(t,e){if(t.limitType==="F")return sV(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(c=>{const f=c.dir==="desc"?"asc":"desc";return new b1(c.field,f)});const r=t.endAt?new TS(t.endAt.position,t.endAt.inclusive):null,o=t.startAt?new TS(t.startAt.position,t.startAt.inclusive):null;return sV(t.path,t.collectionGroup,e,t.filters,t.limit,r,o)}}function h3(t,e){const r=t.filters.concat([e]);return new Zy(t.path,t.collectionGroup,t.explicitOrderBy.slice(),r,t.limit,t.limitType,t.startAt,t.endAt)}function ES(t,e,r){return new Zy(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,r,t.startAt,t.endAt)}function YI(t,e){return cL(ju(t),ju(e))&&t.limitType===e.limitType}function Hq(t){return`${lL(ju(t))}|lt:${t.limitType}`}function P_(t){return`Query(target=${function(r){let o=r.path.canonicalString();return r.collectionGroup!==null&&(o+=" collectionGroup="+r.collectionGroup),r.filters.length>0&&(o+=`, filters: [${r.filters.map(c=>Gq(c)).join(", ")}]`),XI(r.limit)||(o+=", limit: "+r.limit),r.orderBy.length>0&&(o+=`, orderBy: [${r.orderBy.map(c=>function(_){return`${_.field.canonicalString()} (${_.dir})`}(c)).join(", ")}]`),r.startAt&&(o+=", startAt: ",o+=r.startAt.inclusive?"b:":"a:",o+=r.startAt.position.map(c=>Sy(c)).join(",")),r.endAt&&(o+=", endAt: ",o+=r.endAt.inclusive?"a:":"b:",o+=r.endAt.position.map(c=>Sy(c)).join(",")),`Target(${o})`}(ju(t))}; limitType=${t.limitType})`}function QI(t,e){return e.isFoundDocument()&&function(o,c){const f=c.key.path;return o.collectionGroup!==null?c.key.hasCollectionId(o.collectionGroup)&&o.path.isPrefixOf(f):lr.isDocumentKey(o.path)?o.path.isEqual(f):o.path.isImmediateParentOf(f)}(t,e)&&function(o,c){for(const f of Px(o))if(!f.field.isKeyField()&&c.data.field(f.field)===null)return!1;return!0}(t,e)&&function(o,c){for(const f of o.filters)if(!f.matches(c))return!1;return!0}(t,e)&&function(o,c){return!(o.startAt&&!function(_,x,a){const I=rV(_,x,a);return _.inclusive?I<=0:I<0}(o.startAt,Px(o),c)||o.endAt&&!function(_,x,a){const I=rV(_,x,a);return _.inclusive?I>=0:I>0}(o.endAt,Px(o),c))}(t,e)}function xde(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Zq(t){return(e,r)=>{let o=!1;for(const c of Px(t)){const f=bde(c,e,r);if(f!==0)return f;o=o||c.field.isKeyField()}return 0}}function bde(t,e,r){const o=t.field.isKeyField()?lr.comparator(e.key,r.key):function(f,_,x){const a=_.data.field(f),I=x.data.field(f);return a!==null&&I!==null?Ey(a,I):Ir()}(t.field,e,r);switch(t.dir){case"asc":return o;case"desc":return-1*o;default:return Ir()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(e,r){this.mapKeyFn=e,this.equalsFn=r,this.inner={},this.innerSize=0}get(e){const r=this.mapKeyFn(e),o=this.inner[r];if(o!==void 0){for(const[c,f]of o)if(this.equalsFn(c,e))return f}}has(e){return this.get(e)!==void 0}set(e,r){const o=this.mapKeyFn(e),c=this.inner[o];if(c===void 0)return this.inner[o]=[[e,r]],void this.innerSize++;for(let f=0;f<c.length;f++)if(this.equalsFn(c[f][0],e))return void(c[f]=[e,r]);c.push([e,r]),this.innerSize++}delete(e){const r=this.mapKeyFn(e),o=this.inner[r];if(o===void 0)return!1;for(let c=0;c<o.length;c++)if(this.equalsFn(o[c][0],e))return o.length===1?delete this.inner[r]:o.splice(c,1),this.innerSize--,!0;return!1}forEach(e){ig(this.inner,(r,o)=>{for(const[c,f]of o)e(c,f)})}isEmpty(){return Nq(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wde=new As(lr.comparator);function Xh(){return wde}const Xq=new As(lr.comparator);function nx(...t){let e=Xq;for(const r of t)e=e.insert(r.key,r);return e}function Kq(t){let e=Xq;return t.forEach((r,o)=>e=e.insert(r,o.overlayedDocument)),e}function fm(){return Rx()}function Yq(){return Rx()}function Rx(){return new Xy(t=>t.toString(),(t,e)=>t.isEqual(e))}const Tde=new As(lr.comparator),Ede=new No(lr.comparator);function Jr(...t){let e=Ede;for(const r of t)e=e.add(r);return e}const Sde=new No(hi);function Ide(){return Sde}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uL(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:wS(e)?"-0":e}}function Qq(t){return{integerValue:""+t}}function Ade(t,e){return rde(e)?Qq(e):uL(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JI{constructor(){this._=void 0}}function Cde(t,e,r){return t instanceof w1?function(c,f){const _={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:c.seconds,nanos:c.nanoseconds}}}};return f&&sL(f)&&(f=oL(f)),f&&(_.fields.__previous_value__=f),{mapValue:_}}(r,e):t instanceof Iy?eW(t,e):t instanceof Ay?tW(t,e):function(c,f){const _=Jq(c,f),x=aV(_)+aV(c.Pe);return l3(_)&&l3(c.Pe)?Qq(x):uL(c.serializer,x)}(t,e)}function Pde(t,e,r){return t instanceof Iy?eW(t,e):t instanceof Ay?tW(t,e):r}function Jq(t,e){return t instanceof SS?function(o){return l3(o)||function(f){return!!f&&"doubleValue"in f}(o)}(e)?e:{integerValue:0}:null}class w1 extends JI{}class Iy extends JI{constructor(e){super(),this.elements=e}}function eW(t,e){const r=nW(e);for(const o of t.elements)r.some(c=>Gu(c,o))||r.push(o);return{arrayValue:{values:r}}}class Ay extends JI{constructor(e){super(),this.elements=e}}function tW(t,e){let r=nW(e);for(const o of t.elements)r=r.filter(c=>!Gu(c,o));return{arrayValue:{values:r}}}class SS extends JI{constructor(e,r){super(),this.serializer=e,this.Pe=r}}function aV(t){return Vs(t.integerValue||t.doubleValue)}function nW(t){return aL(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hL{constructor(e,r){this.field=e,this.transform=r}}function Rde(t,e){return t.field.isEqual(e.field)&&function(o,c){return o instanceof Iy&&c instanceof Iy||o instanceof Ay&&c instanceof Ay?Ty(o.elements,c.elements,Gu):o instanceof SS&&c instanceof SS?Gu(o.Pe,c.Pe):o instanceof w1&&c instanceof w1}(t.transform,e.transform)}class Mde{constructor(e,r){this.version=e,this.transformResults=r}}class Xl{constructor(e,r){this.updateTime=e,this.exists=r}static none(){return new Xl}static exists(e){return new Xl(void 0,e)}static updateTime(e){return new Xl(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function wE(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class eA{}function rW(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new dL(t.key,Xl.none()):new rb(t.key,t.data,Xl.none());{const r=t.data,o=Ba.empty();let c=new No(Lo.comparator);for(let f of e.fields)if(!c.has(f)){let _=r.field(f);_===null&&f.length>1&&(f=f.popLast(),_=r.field(f)),_===null?o.delete(f):o.set(f,_),c=c.add(f)}return new Jf(t.key,o,new ll(c.toArray()),Xl.none())}}function kde(t,e,r){t instanceof rb?function(c,f,_){const x=c.value.clone(),a=cV(c.fieldTransforms,f,_.transformResults);x.setAll(a),f.convertToFoundDocument(_.version,x).setHasCommittedMutations()}(t,e,r):t instanceof Jf?function(c,f,_){if(!wE(c.precondition,f))return void f.convertToUnknownDocument(_.version);const x=cV(c.fieldTransforms,f,_.transformResults),a=f.data;a.setAll(iW(c)),a.setAll(x),f.convertToFoundDocument(_.version,a).setHasCommittedMutations()}(t,e,r):function(c,f,_){f.convertToNoDocument(_.version).setHasCommittedMutations()}(0,e,r)}function Mx(t,e,r,o){return t instanceof rb?function(f,_,x,a){if(!wE(f.precondition,_))return x;const I=f.value.clone(),D=uV(f.fieldTransforms,a,_);return I.setAll(D),_.convertToFoundDocument(_.version,I).setHasLocalMutations(),null}(t,e,r,o):t instanceof Jf?function(f,_,x,a){if(!wE(f.precondition,_))return x;const I=uV(f.fieldTransforms,a,_),D=_.data;return D.setAll(iW(f)),D.setAll(I),_.convertToFoundDocument(_.version,D).setHasLocalMutations(),x===null?null:x.unionWith(f.fieldMask.fields).unionWith(f.fieldTransforms.map(O=>O.field))}(t,e,r,o):function(f,_,x){return wE(f.precondition,_)?(_.convertToNoDocument(_.version).setHasLocalMutations(),null):x}(t,e,r)}function Dde(t,e){let r=null;for(const o of t.fieldTransforms){const c=e.data.field(o.field),f=Jq(o.transform,c||null);f!=null&&(r===null&&(r=Ba.empty()),r.set(o.field,f))}return r||null}function lV(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(o,c){return o===void 0&&c===void 0||!(!o||!c)&&Ty(o,c,(f,_)=>Rde(f,_))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class rb extends eA{constructor(e,r,o,c=[]){super(),this.key=e,this.value=r,this.precondition=o,this.fieldTransforms=c,this.type=0}getFieldMask(){return null}}class Jf extends eA{constructor(e,r,o,c,f=[]){super(),this.key=e,this.data=r,this.fieldMask=o,this.precondition=c,this.fieldTransforms=f,this.type=1}getFieldMask(){return this.fieldMask}}function iW(t){const e=new Map;return t.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const o=t.data.field(r);e.set(r,o)}}),e}function cV(t,e,r){const o=new Map;Vi(t.length===r.length);for(let c=0;c<r.length;c++){const f=t[c],_=f.transform,x=e.data.field(f.field);o.set(f.field,Pde(_,x,r[c]))}return o}function uV(t,e,r){const o=new Map;for(const c of t){const f=c.transform,_=r.data.field(c.field);o.set(c.field,Cde(f,_,e))}return o}class dL extends eA{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ode extends eA{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lde{constructor(e,r,o,c){this.batchId=e,this.localWriteTime=r,this.baseMutations=o,this.mutations=c}applyToRemoteDocument(e,r){const o=r.mutationResults;for(let c=0;c<this.mutations.length;c++){const f=this.mutations[c];f.key.isEqual(e.key)&&kde(f,e,o[c])}}applyToLocalView(e,r){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(r=Mx(o,e,r,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(r=Mx(o,e,r,this.localWriteTime));return r}applyToLocalDocumentSet(e,r){const o=Yq();return this.mutations.forEach(c=>{const f=e.get(c.key),_=f.overlayedDocument;let x=this.applyToLocalView(_,f.mutatedFields);x=r.has(c.key)?null:x;const a=rW(_,x);a!==null&&o.set(c.key,a),_.isValidDocument()||_.convertToNoDocument(kr.min())}),o}keys(){return this.mutations.reduce((e,r)=>e.add(r.key),Jr())}isEqual(e){return this.batchId===e.batchId&&Ty(this.mutations,e.mutations,(r,o)=>lV(r,o))&&Ty(this.baseMutations,e.baseMutations,(r,o)=>lV(r,o))}}class fL{constructor(e,r,o,c){this.batch=e,this.commitVersion=r,this.mutationResults=o,this.docVersions=c}static from(e,r,o){Vi(e.mutations.length===o.length);let c=function(){return Tde}();const f=e.mutations;for(let _=0;_<f.length;_++)c=c.insert(f[_].key,o[_].version);return new fL(e,r,o,c)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zde{constructor(e,r){this.largestBatchId=e,this.mutation=r}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nde{constructor(e,r){this.count=e,this.unchangedNames=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ks,ai;function Fde(t){switch(t){default:return Ir();case Xt.CANCELLED:case Xt.UNKNOWN:case Xt.DEADLINE_EXCEEDED:case Xt.RESOURCE_EXHAUSTED:case Xt.INTERNAL:case Xt.UNAVAILABLE:case Xt.UNAUTHENTICATED:return!1;case Xt.INVALID_ARGUMENT:case Xt.NOT_FOUND:case Xt.ALREADY_EXISTS:case Xt.PERMISSION_DENIED:case Xt.FAILED_PRECONDITION:case Xt.ABORTED:case Xt.OUT_OF_RANGE:case Xt.UNIMPLEMENTED:case Xt.DATA_LOSS:return!0}}function sW(t){if(t===void 0)return Zh("GRPC error has no .code"),Xt.UNKNOWN;switch(t){case Ks.OK:return Xt.OK;case Ks.CANCELLED:return Xt.CANCELLED;case Ks.UNKNOWN:return Xt.UNKNOWN;case Ks.DEADLINE_EXCEEDED:return Xt.DEADLINE_EXCEEDED;case Ks.RESOURCE_EXHAUSTED:return Xt.RESOURCE_EXHAUSTED;case Ks.INTERNAL:return Xt.INTERNAL;case Ks.UNAVAILABLE:return Xt.UNAVAILABLE;case Ks.UNAUTHENTICATED:return Xt.UNAUTHENTICATED;case Ks.INVALID_ARGUMENT:return Xt.INVALID_ARGUMENT;case Ks.NOT_FOUND:return Xt.NOT_FOUND;case Ks.ALREADY_EXISTS:return Xt.ALREADY_EXISTS;case Ks.PERMISSION_DENIED:return Xt.PERMISSION_DENIED;case Ks.FAILED_PRECONDITION:return Xt.FAILED_PRECONDITION;case Ks.ABORTED:return Xt.ABORTED;case Ks.OUT_OF_RANGE:return Xt.OUT_OF_RANGE;case Ks.UNIMPLEMENTED:return Xt.UNIMPLEMENTED;case Ks.DATA_LOSS:return Xt.DATA_LOSS;default:return Ir()}}(ai=Ks||(Ks={}))[ai.OK=0]="OK",ai[ai.CANCELLED=1]="CANCELLED",ai[ai.UNKNOWN=2]="UNKNOWN",ai[ai.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ai[ai.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ai[ai.NOT_FOUND=5]="NOT_FOUND",ai[ai.ALREADY_EXISTS=6]="ALREADY_EXISTS",ai[ai.PERMISSION_DENIED=7]="PERMISSION_DENIED",ai[ai.UNAUTHENTICATED=16]="UNAUTHENTICATED",ai[ai.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ai[ai.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ai[ai.ABORTED=10]="ABORTED",ai[ai.OUT_OF_RANGE=11]="OUT_OF_RANGE",ai[ai.UNIMPLEMENTED=12]="UNIMPLEMENTED",ai[ai.INTERNAL=13]="INTERNAL",ai[ai.UNAVAILABLE=14]="UNAVAILABLE",ai[ai.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bde(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jde=new vm([4294967295,4294967295],0);function hV(t){const e=Bde().encode(t),r=new Cq;return r.update(e),new Uint8Array(r.digest())}function dV(t){const e=new DataView(t.buffer),r=e.getUint32(0,!0),o=e.getUint32(4,!0),c=e.getUint32(8,!0),f=e.getUint32(12,!0);return[new vm([r,o],0),new vm([c,f],0)]}class pL{constructor(e,r,o){if(this.bitmap=e,this.padding=r,this.hashCount=o,r<0||r>=8)throw new rx(`Invalid padding: ${r}`);if(o<0)throw new rx(`Invalid hash count: ${o}`);if(e.length>0&&this.hashCount===0)throw new rx(`Invalid hash count: ${o}`);if(e.length===0&&r!==0)throw new rx(`Invalid padding when bitmap length is 0: ${r}`);this.Ie=8*e.length-r,this.Te=vm.fromNumber(this.Ie)}Ee(e,r,o){let c=e.add(r.multiply(vm.fromNumber(o)));return c.compare(jde)===1&&(c=new vm([c.getBits(0),c.getBits(1)],0)),c.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const r=hV(e),[o,c]=dV(r);for(let f=0;f<this.hashCount;f++){const _=this.Ee(o,c,f);if(!this.de(_))return!1}return!0}static create(e,r,o){const c=e%8==0?0:8-e%8,f=new Uint8Array(Math.ceil(e/8)),_=new pL(f,c,r);return o.forEach(x=>_.insert(x)),_}insert(e){if(this.Ie===0)return;const r=hV(e),[o,c]=dV(r);for(let f=0;f<this.hashCount;f++){const _=this.Ee(o,c,f);this.Ae(_)}}Ae(e){const r=Math.floor(e/8),o=e%8;this.bitmap[r]|=1<<o}}class rx extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tA{constructor(e,r,o,c,f){this.snapshotVersion=e,this.targetChanges=r,this.targetMismatches=o,this.documentUpdates=c,this.resolvedLimboDocuments=f}static createSynthesizedRemoteEventForCurrentChange(e,r,o){const c=new Map;return c.set(e,ib.createSynthesizedTargetChangeForCurrentChange(e,r,o)),new tA(kr.min(),c,new As(hi),Xh(),Jr())}}class ib{constructor(e,r,o,c,f){this.resumeToken=e,this.current=r,this.addedDocuments=o,this.modifiedDocuments=c,this.removedDocuments=f}static createSynthesizedTargetChangeForCurrentChange(e,r,o){return new ib(o,r,Jr(),Jr(),Jr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TE{constructor(e,r,o,c){this.Re=e,this.removedTargetIds=r,this.key=o,this.Ve=c}}class oW{constructor(e,r){this.targetId=e,this.me=r}}class aW{constructor(e,r,o=Bo.EMPTY_BYTE_STRING,c=null){this.state=e,this.targetIds=r,this.resumeToken=o,this.cause=c}}class fV{constructor(){this.fe=0,this.ge=mV(),this.pe=Bo.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Jr(),r=Jr(),o=Jr();return this.ge.forEach((c,f)=>{switch(f){case 0:e=e.add(c);break;case 2:r=r.add(c);break;case 1:o=o.add(c);break;default:Ir()}}),new ib(this.pe,this.ye,e,r,o)}Ce(){this.we=!1,this.ge=mV()}Fe(e,r){this.we=!0,this.ge=this.ge.insert(e,r)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Vi(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Ude{constructor(e){this.Le=e,this.Be=new Map,this.ke=Xh(),this.qe=pV(),this.Qe=new As(hi)}Ke(e){for(const r of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(r,e.Ve):this.Ue(r,e.key,e.Ve);for(const r of e.removedTargetIds)this.Ue(r,e.key,e.Ve)}We(e){this.forEachTarget(e,r=>{const o=this.Ge(r);switch(e.state){case 0:this.ze(r)&&o.De(e.resumeToken);break;case 1:o.Oe(),o.Se||o.Ce(),o.De(e.resumeToken);break;case 2:o.Oe(),o.Se||this.removeTarget(r);break;case 3:this.ze(r)&&(o.Ne(),o.De(e.resumeToken));break;case 4:this.ze(r)&&(this.je(r),o.De(e.resumeToken));break;default:Ir()}})}forEachTarget(e,r){e.targetIds.length>0?e.targetIds.forEach(r):this.Be.forEach((o,c)=>{this.ze(c)&&r(c)})}He(e){const r=e.targetId,o=e.me.count,c=this.Je(r);if(c){const f=c.target;if(u3(f))if(o===0){const _=new lr(f.path);this.Ue(r,_,ea.newNoDocument(_,kr.min()))}else Vi(o===1);else{const _=this.Ye(r);if(_!==o){const x=this.Ze(e),a=x?this.Xe(x,e,_):1;if(a!==0){this.je(r);const I=a===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(r,I)}}}}}Ze(e){const r=e.me.unchangedNames;if(!r||!r.bits)return null;const{bits:{bitmap:o="",padding:c=0},hashCount:f=0}=r;let _,x;try{_=Nm(o).toUint8Array()}catch(a){if(a instanceof Fq)return wy("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{x=new pL(_,c,f)}catch(a){return wy(a instanceof rx?"BloomFilter error: ":"Applying bloom filter failed: ",a),null}return x.Ie===0?null:x}Xe(e,r,o){return r.me.count===o-this.nt(e,r.targetId)?0:2}nt(e,r){const o=this.Le.getRemoteKeysForTarget(r);let c=0;return o.forEach(f=>{const _=this.Le.tt(),x=`projects/${_.projectId}/databases/${_.database}/documents/${f.path.canonicalString()}`;e.mightContain(x)||(this.Ue(r,f,null),c++)}),c}rt(e){const r=new Map;this.Be.forEach((f,_)=>{const x=this.Je(_);if(x){if(f.current&&u3(x.target)){const a=new lr(x.target.path);this.ke.get(a)!==null||this.it(_,a)||this.Ue(_,a,ea.newNoDocument(a,e))}f.be&&(r.set(_,f.ve()),f.Ce())}});let o=Jr();this.qe.forEach((f,_)=>{let x=!0;_.forEachWhile(a=>{const I=this.Je(a);return!I||I.purpose==="TargetPurposeLimboResolution"||(x=!1,!1)}),x&&(o=o.add(f))}),this.ke.forEach((f,_)=>_.setReadTime(e));const c=new tA(e,r,this.Qe,this.ke,o);return this.ke=Xh(),this.qe=pV(),this.Qe=new As(hi),c}$e(e,r){if(!this.ze(e))return;const o=this.it(e,r.key)?2:0;this.Ge(e).Fe(r.key,o),this.ke=this.ke.insert(r.key,r),this.qe=this.qe.insert(r.key,this.st(r.key).add(e))}Ue(e,r,o){if(!this.ze(e))return;const c=this.Ge(e);this.it(e,r)?c.Fe(r,1):c.Me(r),this.qe=this.qe.insert(r,this.st(r).delete(e)),o&&(this.ke=this.ke.insert(r,o))}removeTarget(e){this.Be.delete(e)}Ye(e){const r=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let r=this.Be.get(e);return r||(r=new fV,this.Be.set(e,r)),r}st(e){let r=this.qe.get(e);return r||(r=new No(hi),this.qe=this.qe.insert(e,r)),r}ze(e){const r=this.Je(e)!==null;return r||qn("WatchChangeAggregator","Detected inactive target",e),r}Je(e){const r=this.Be.get(e);return r&&r.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new fV),this.Le.getRemoteKeysForTarget(e).forEach(r=>{this.Ue(e,r,null)})}it(e,r){return this.Le.getRemoteKeysForTarget(e).has(r)}}function pV(){return new As(lr.comparator)}function mV(){return new As(lr.comparator)}const Vde={asc:"ASCENDING",desc:"DESCENDING"},$de={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Gde={and:"AND",or:"OR"};class qde{constructor(e,r){this.databaseId=e,this.useProto3Json=r}}function d3(t,e){return t.useProto3Json||XI(e)?e:{value:e}}function IS(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function lW(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Wde(t,e){return IS(t,e.toTimestamp())}function Uu(t){return Vi(!!t),kr.fromTimestamp(function(r){const o=jf(r);return new mo(o.seconds,o.nanos)}(t))}function mL(t,e){return f3(t,e).canonicalString()}function f3(t,e){const r=function(c){return new is(["projects",c.projectId,"databases",c.database])}(t).child("documents");return e===void 0?r:r.child(e)}function cW(t){const e=is.fromString(t);return Vi(pW(e)),e}function p3(t,e){return mL(t.databaseId,e.path)}function lM(t,e){const r=cW(e);if(r.get(1)!==t.databaseId.projectId)throw new On(Xt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+t.databaseId.projectId);if(r.get(3)!==t.databaseId.database)throw new On(Xt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+t.databaseId.database);return new lr(hW(r))}function uW(t,e){return mL(t.databaseId,e)}function Hde(t){const e=cW(t);return e.length===4?is.emptyPath():hW(e)}function m3(t){return new is(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function hW(t){return Vi(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function gV(t,e,r){return{name:p3(t,e),fields:r.value.mapValue.fields}}function Zde(t,e){let r;if("targetChange"in e){e.targetChange;const o=function(I){return I==="NO_CHANGE"?0:I==="ADD"?1:I==="REMOVE"?2:I==="CURRENT"?3:I==="RESET"?4:Ir()}(e.targetChange.targetChangeType||"NO_CHANGE"),c=e.targetChange.targetIds||[],f=function(I,D){return I.useProto3Json?(Vi(D===void 0||typeof D=="string"),Bo.fromBase64String(D||"")):(Vi(D===void 0||D instanceof Buffer||D instanceof Uint8Array),Bo.fromUint8Array(D||new Uint8Array))}(t,e.targetChange.resumeToken),_=e.targetChange.cause,x=_&&function(I){const D=I.code===void 0?Xt.UNKNOWN:sW(I.code);return new On(D,I.message||"")}(_);r=new aW(o,c,f,x||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const c=lM(t,o.document.name),f=Uu(o.document.updateTime),_=o.document.createTime?Uu(o.document.createTime):kr.min(),x=new Ba({mapValue:{fields:o.document.fields}}),a=ea.newFoundDocument(c,f,_,x),I=o.targetIds||[],D=o.removedTargetIds||[];r=new TE(I,D,a.key,a)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const c=lM(t,o.document),f=o.readTime?Uu(o.readTime):kr.min(),_=ea.newNoDocument(c,f),x=o.removedTargetIds||[];r=new TE([],x,_.key,_)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const c=lM(t,o.document),f=o.removedTargetIds||[];r=new TE([],f,c,null)}else{if(!("filter"in e))return Ir();{e.filter;const o=e.filter;o.targetId;const{count:c=0,unchangedNames:f}=o,_=new Nde(c,f),x=o.targetId;r=new oW(x,_)}}return r}function Xde(t,e){let r;if(e instanceof rb)r={update:gV(t,e.key,e.value)};else if(e instanceof dL)r={delete:p3(t,e.key)};else if(e instanceof Jf)r={update:gV(t,e.key,e.data),updateMask:ife(e.fieldMask)};else{if(!(e instanceof Ode))return Ir();r={verify:p3(t,e.key)}}return e.fieldTransforms.length>0&&(r.updateTransforms=e.fieldTransforms.map(o=>function(f,_){const x=_.transform;if(x instanceof w1)return{fieldPath:_.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(x instanceof Iy)return{fieldPath:_.field.canonicalString(),appendMissingElements:{values:x.elements}};if(x instanceof Ay)return{fieldPath:_.field.canonicalString(),removeAllFromArray:{values:x.elements}};if(x instanceof SS)return{fieldPath:_.field.canonicalString(),increment:x.Pe};throw Ir()}(0,o))),e.precondition.isNone||(r.currentDocument=function(c,f){return f.updateTime!==void 0?{updateTime:Wde(c,f.updateTime)}:f.exists!==void 0?{exists:f.exists}:Ir()}(t,e.precondition)),r}function Kde(t,e){return t&&t.length>0?(Vi(e!==void 0),t.map(r=>function(c,f){let _=c.updateTime?Uu(c.updateTime):Uu(f);return _.isEqual(kr.min())&&(_=Uu(f)),new Mde(_,c.transformResults||[])}(r,e))):[]}function Yde(t,e){return{documents:[uW(t,e.path)]}}function Qde(t,e){const r={structuredQuery:{}},o=e.path;let c;e.collectionGroup!==null?(c=o,r.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(c=o.popLast(),r.structuredQuery.from=[{collectionId:o.lastSegment()}]),r.parent=uW(t,c);const f=function(I){if(I.length!==0)return fW(Vc.create(I,"and"))}(e.filters);f&&(r.structuredQuery.where=f);const _=function(I){if(I.length!==0)return I.map(D=>function(F){return{field:R_(F.field),direction:tfe(F.dir)}}(D))}(e.orderBy);_&&(r.structuredQuery.orderBy=_);const x=d3(t,e.limit);return x!==null&&(r.structuredQuery.limit=x),e.startAt&&(r.structuredQuery.startAt=function(I){return{before:I.inclusive,values:I.position}}(e.startAt)),e.endAt&&(r.structuredQuery.endAt=function(I){return{before:!I.inclusive,values:I.position}}(e.endAt)),{_t:r,parent:c}}function Jde(t){let e=Hde(t.parent);const r=t.structuredQuery,o=r.from?r.from.length:0;let c=null;if(o>0){Vi(o===1);const D=r.from[0];D.allDescendants?c=D.collectionId:e=e.child(D.collectionId)}let f=[];r.where&&(f=function(O){const F=dW(O);return F instanceof Vc&&Vq(F)?F.getFilters():[F]}(r.where));let _=[];r.orderBy&&(_=function(O){return O.map(F=>function(J){return new b1(M_(J.field),function(se){switch(se){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(J.direction))}(F))}(r.orderBy));let x=null;r.limit&&(x=function(O){let F;return F=typeof O=="object"?O.value:O,XI(F)?null:F}(r.limit));let a=null;r.startAt&&(a=function(O){const F=!!O.before,Z=O.values||[];return new TS(Z,F)}(r.startAt));let I=null;return r.endAt&&(I=function(O){const F=!O.before,Z=O.values||[];return new TS(Z,F)}(r.endAt)),yde(e,c,_,f,x,"F",a,I)}function efe(t,e){const r=function(c){switch(c){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ir()}}(e.purpose);return r==null?null:{"goog-listen-tags":r}}function dW(t){return t.unaryFilter!==void 0?function(r){switch(r.unaryFilter.op){case"IS_NAN":const o=M_(r.unaryFilter.field);return eo.create(o,"==",{doubleValue:NaN});case"IS_NULL":const c=M_(r.unaryFilter.field);return eo.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const f=M_(r.unaryFilter.field);return eo.create(f,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const _=M_(r.unaryFilter.field);return eo.create(_,"!=",{nullValue:"NULL_VALUE"});default:return Ir()}}(t):t.fieldFilter!==void 0?function(r){return eo.create(M_(r.fieldFilter.field),function(c){switch(c){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ir()}}(r.fieldFilter.op),r.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(r){return Vc.create(r.compositeFilter.filters.map(o=>dW(o)),function(c){switch(c){case"AND":return"and";case"OR":return"or";default:return Ir()}}(r.compositeFilter.op))}(t):Ir()}function tfe(t){return Vde[t]}function nfe(t){return $de[t]}function rfe(t){return Gde[t]}function R_(t){return{fieldPath:t.canonicalString()}}function M_(t){return Lo.fromServerFormat(t.fieldPath)}function fW(t){return t instanceof eo?function(r){if(r.op==="=="){if(nV(r.value))return{unaryFilter:{field:R_(r.field),op:"IS_NAN"}};if(tV(r.value))return{unaryFilter:{field:R_(r.field),op:"IS_NULL"}}}else if(r.op==="!="){if(nV(r.value))return{unaryFilter:{field:R_(r.field),op:"IS_NOT_NAN"}};if(tV(r.value))return{unaryFilter:{field:R_(r.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:R_(r.field),op:nfe(r.op),value:r.value}}}(t):t instanceof Vc?function(r){const o=r.getFilters().map(c=>fW(c));return o.length===1?o[0]:{compositeFilter:{op:rfe(r.op),filters:o}}}(t):Ir()}function ife(t){const e=[];return t.fields.forEach(r=>e.push(r.canonicalString())),{fieldPaths:e}}function pW(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gf{constructor(e,r,o,c,f=kr.min(),_=kr.min(),x=Bo.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=r,this.purpose=o,this.sequenceNumber=c,this.snapshotVersion=f,this.lastLimboFreeSnapshotVersion=_,this.resumeToken=x,this.expectedCount=a}withSequenceNumber(e){return new gf(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,r){return new gf(this.target,this.targetId,this.purpose,this.sequenceNumber,r,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new gf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new gf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sfe{constructor(e){this.ct=e}}function ofe(t){const e=Jde({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?ES(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class afe{constructor(){this.un=new lfe}addToCollectionParentIndex(e,r){return this.un.add(r),sn.resolve()}getCollectionParents(e,r){return sn.resolve(this.un.getEntries(r))}addFieldIndex(e,r){return sn.resolve()}deleteFieldIndex(e,r){return sn.resolve()}deleteAllFieldIndexes(e){return sn.resolve()}createTargetIndexes(e,r){return sn.resolve()}getDocumentsMatchingTarget(e,r){return sn.resolve(null)}getIndexType(e,r){return sn.resolve(0)}getFieldIndexes(e,r){return sn.resolve([])}getNextCollectionGroupToUpdate(e){return sn.resolve(null)}getMinOffset(e,r){return sn.resolve(Bf.min())}getMinOffsetFromCollectionGroup(e,r){return sn.resolve(Bf.min())}updateCollectionGroup(e,r,o){return sn.resolve()}updateIndexEntries(e,r){return sn.resolve()}}class lfe{constructor(){this.index={}}add(e){const r=e.lastSegment(),o=e.popLast(),c=this.index[r]||new No(is.comparator),f=!c.has(o);return this.index[r]=c.add(o),f}has(e){const r=e.lastSegment(),o=e.popLast(),c=this.index[r];return c&&c.has(o)}getEntries(e){return(this.index[e]||new No(is.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cy{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Cy(0)}static kn(){return new Cy(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cfe{constructor(){this.changes=new Xy(e=>e.toString(),(e,r)=>e.isEqual(r)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,r){this.assertNotApplied(),this.changes.set(e,ea.newInvalidDocument(e).setReadTime(r))}getEntry(e,r){this.assertNotApplied();const o=this.changes.get(r);return o!==void 0?sn.resolve(o):this.getFromCache(e,r)}getEntries(e,r){return this.getAllFromCache(e,r)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ufe{constructor(e,r){this.overlayedDocument=e,this.mutatedFields=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hfe{constructor(e,r,o,c){this.remoteDocumentCache=e,this.mutationQueue=r,this.documentOverlayCache=o,this.indexManager=c}getDocument(e,r){let o=null;return this.documentOverlayCache.getOverlay(e,r).next(c=>(o=c,this.remoteDocumentCache.getEntry(e,r))).next(c=>(o!==null&&Mx(o.mutation,c,ll.empty(),mo.now()),c))}getDocuments(e,r){return this.remoteDocumentCache.getEntries(e,r).next(o=>this.getLocalViewOfDocuments(e,o,Jr()).next(()=>o))}getLocalViewOfDocuments(e,r,o=Jr()){const c=fm();return this.populateOverlays(e,c,r).next(()=>this.computeViews(e,r,c,o).next(f=>{let _=nx();return f.forEach((x,a)=>{_=_.insert(x,a.overlayedDocument)}),_}))}getOverlayedDocuments(e,r){const o=fm();return this.populateOverlays(e,o,r).next(()=>this.computeViews(e,r,o,Jr()))}populateOverlays(e,r,o){const c=[];return o.forEach(f=>{r.has(f)||c.push(f)}),this.documentOverlayCache.getOverlays(e,c).next(f=>{f.forEach((_,x)=>{r.set(_,x)})})}computeViews(e,r,o,c){let f=Xh();const _=Rx(),x=function(){return Rx()}();return r.forEach((a,I)=>{const D=o.get(I.key);c.has(I.key)&&(D===void 0||D.mutation instanceof Jf)?f=f.insert(I.key,I):D!==void 0?(_.set(I.key,D.mutation.getFieldMask()),Mx(D.mutation,I,D.mutation.getFieldMask(),mo.now())):_.set(I.key,ll.empty())}),this.recalculateAndSaveOverlays(e,f).next(a=>(a.forEach((I,D)=>_.set(I,D)),r.forEach((I,D)=>{var O;return x.set(I,new ufe(D,(O=_.get(I))!==null&&O!==void 0?O:null))}),x))}recalculateAndSaveOverlays(e,r){const o=Rx();let c=new As((_,x)=>_-x),f=Jr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,r).next(_=>{for(const x of _)x.keys().forEach(a=>{const I=r.get(a);if(I===null)return;let D=o.get(a)||ll.empty();D=x.applyToLocalView(I,D),o.set(a,D);const O=(c.get(x.batchId)||Jr()).add(a);c=c.insert(x.batchId,O)})}).next(()=>{const _=[],x=c.getReverseIterator();for(;x.hasNext();){const a=x.getNext(),I=a.key,D=a.value,O=Yq();D.forEach(F=>{if(!f.has(F)){const Z=rW(r.get(F),o.get(F));Z!==null&&O.set(F,Z),f=f.add(F)}}),_.push(this.documentOverlayCache.saveOverlays(e,I,O))}return sn.waitFor(_)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(e,r){return this.remoteDocumentCache.getEntries(e,r).next(o=>this.recalculateAndSaveOverlays(e,o))}getDocumentsMatchingQuery(e,r,o,c){return function(_){return lr.isDocumentKey(_.path)&&_.collectionGroup===null&&_.filters.length===0}(r)?this.getDocumentsMatchingDocumentQuery(e,r.path):Wq(r)?this.getDocumentsMatchingCollectionGroupQuery(e,r,o,c):this.getDocumentsMatchingCollectionQuery(e,r,o,c)}getNextDocuments(e,r,o,c){return this.remoteDocumentCache.getAllFromCollectionGroup(e,r,o,c).next(f=>{const _=c-f.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,r,o.largestBatchId,c-f.size):sn.resolve(fm());let x=-1,a=f;return _.next(I=>sn.forEach(I,(D,O)=>(x<O.largestBatchId&&(x=O.largestBatchId),f.get(D)?sn.resolve():this.remoteDocumentCache.getEntry(e,D).next(F=>{a=a.insert(D,F)}))).next(()=>this.populateOverlays(e,I,f)).next(()=>this.computeViews(e,a,I,Jr())).next(D=>({batchId:x,changes:Kq(D)})))})}getDocumentsMatchingDocumentQuery(e,r){return this.getDocument(e,new lr(r)).next(o=>{let c=nx();return o.isFoundDocument()&&(c=c.insert(o.key,o)),c})}getDocumentsMatchingCollectionGroupQuery(e,r,o,c){const f=r.collectionGroup;let _=nx();return this.indexManager.getCollectionParents(e,f).next(x=>sn.forEach(x,a=>{const I=function(O,F){return new Zy(F,null,O.explicitOrderBy.slice(),O.filters.slice(),O.limit,O.limitType,O.startAt,O.endAt)}(r,a.child(f));return this.getDocumentsMatchingCollectionQuery(e,I,o,c).next(D=>{D.forEach((O,F)=>{_=_.insert(O,F)})})}).next(()=>_))}getDocumentsMatchingCollectionQuery(e,r,o,c){let f;return this.documentOverlayCache.getOverlaysForCollection(e,r.path,o.largestBatchId).next(_=>(f=_,this.remoteDocumentCache.getDocumentsMatchingQuery(e,r,o,f,c))).next(_=>{f.forEach((a,I)=>{const D=I.getKey();_.get(D)===null&&(_=_.insert(D,ea.newInvalidDocument(D)))});let x=nx();return _.forEach((a,I)=>{const D=f.get(a);D!==void 0&&Mx(D.mutation,I,ll.empty(),mo.now()),QI(r,I)&&(x=x.insert(a,I))}),x})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dfe{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,r){return sn.resolve(this.hr.get(r))}saveBundleMetadata(e,r){return this.hr.set(r.id,function(c){return{id:c.id,version:c.version,createTime:Uu(c.createTime)}}(r)),sn.resolve()}getNamedQuery(e,r){return sn.resolve(this.Pr.get(r))}saveNamedQuery(e,r){return this.Pr.set(r.name,function(c){return{name:c.name,query:ofe(c.bundledQuery),readTime:Uu(c.readTime)}}(r)),sn.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ffe{constructor(){this.overlays=new As(lr.comparator),this.Ir=new Map}getOverlay(e,r){return sn.resolve(this.overlays.get(r))}getOverlays(e,r){const o=fm();return sn.forEach(r,c=>this.getOverlay(e,c).next(f=>{f!==null&&o.set(c,f)})).next(()=>o)}saveOverlays(e,r,o){return o.forEach((c,f)=>{this.ht(e,r,f)}),sn.resolve()}removeOverlaysForBatchId(e,r,o){const c=this.Ir.get(o);return c!==void 0&&(c.forEach(f=>this.overlays=this.overlays.remove(f)),this.Ir.delete(o)),sn.resolve()}getOverlaysForCollection(e,r,o){const c=fm(),f=r.length+1,_=new lr(r.child("")),x=this.overlays.getIteratorFrom(_);for(;x.hasNext();){const a=x.getNext().value,I=a.getKey();if(!r.isPrefixOf(I.path))break;I.path.length===f&&a.largestBatchId>o&&c.set(a.getKey(),a)}return sn.resolve(c)}getOverlaysForCollectionGroup(e,r,o,c){let f=new As((I,D)=>I-D);const _=this.overlays.getIterator();for(;_.hasNext();){const I=_.getNext().value;if(I.getKey().getCollectionGroup()===r&&I.largestBatchId>o){let D=f.get(I.largestBatchId);D===null&&(D=fm(),f=f.insert(I.largestBatchId,D)),D.set(I.getKey(),I)}}const x=fm(),a=f.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((I,D)=>x.set(I,D)),!(x.size()>=c)););return sn.resolve(x)}ht(e,r,o){const c=this.overlays.get(o.key);if(c!==null){const _=this.Ir.get(c.largestBatchId).delete(o.key);this.Ir.set(c.largestBatchId,_)}this.overlays=this.overlays.insert(o.key,new zde(r,o));let f=this.Ir.get(r);f===void 0&&(f=Jr(),this.Ir.set(r,f)),this.Ir.set(r,f.add(o.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pfe{constructor(){this.sessionToken=Bo.EMPTY_BYTE_STRING}getSessionToken(e){return sn.resolve(this.sessionToken)}setSessionToken(e,r){return this.sessionToken=r,sn.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gL{constructor(){this.Tr=new No(wo.Er),this.dr=new No(wo.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,r){const o=new wo(e,r);this.Tr=this.Tr.add(o),this.dr=this.dr.add(o)}Rr(e,r){e.forEach(o=>this.addReference(o,r))}removeReference(e,r){this.Vr(new wo(e,r))}mr(e,r){e.forEach(o=>this.removeReference(o,r))}gr(e){const r=new lr(new is([])),o=new wo(r,e),c=new wo(r,e+1),f=[];return this.dr.forEachInRange([o,c],_=>{this.Vr(_),f.push(_.key)}),f}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const r=new lr(new is([])),o=new wo(r,e),c=new wo(r,e+1);let f=Jr();return this.dr.forEachInRange([o,c],_=>{f=f.add(_.key)}),f}containsKey(e){const r=new wo(e,0),o=this.Tr.firstAfterOrEqual(r);return o!==null&&e.isEqual(o.key)}}class wo{constructor(e,r){this.key=e,this.wr=r}static Er(e,r){return lr.comparator(e.key,r.key)||hi(e.wr,r.wr)}static Ar(e,r){return hi(e.wr,r.wr)||lr.comparator(e.key,r.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mfe{constructor(e,r){this.indexManager=e,this.referenceDelegate=r,this.mutationQueue=[],this.Sr=1,this.br=new No(wo.Er)}checkEmpty(e){return sn.resolve(this.mutationQueue.length===0)}addMutationBatch(e,r,o,c){const f=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const _=new Lde(f,r,o,c);this.mutationQueue.push(_);for(const x of c)this.br=this.br.add(new wo(x.key,f)),this.indexManager.addToCollectionParentIndex(e,x.key.path.popLast());return sn.resolve(_)}lookupMutationBatch(e,r){return sn.resolve(this.Dr(r))}getNextMutationBatchAfterBatchId(e,r){const o=r+1,c=this.vr(o),f=c<0?0:c;return sn.resolve(this.mutationQueue.length>f?this.mutationQueue[f]:null)}getHighestUnacknowledgedBatchId(){return sn.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return sn.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,r){const o=new wo(r,0),c=new wo(r,Number.POSITIVE_INFINITY),f=[];return this.br.forEachInRange([o,c],_=>{const x=this.Dr(_.wr);f.push(x)}),sn.resolve(f)}getAllMutationBatchesAffectingDocumentKeys(e,r){let o=new No(hi);return r.forEach(c=>{const f=new wo(c,0),_=new wo(c,Number.POSITIVE_INFINITY);this.br.forEachInRange([f,_],x=>{o=o.add(x.wr)})}),sn.resolve(this.Cr(o))}getAllMutationBatchesAffectingQuery(e,r){const o=r.path,c=o.length+1;let f=o;lr.isDocumentKey(f)||(f=f.child(""));const _=new wo(new lr(f),0);let x=new No(hi);return this.br.forEachWhile(a=>{const I=a.key.path;return!!o.isPrefixOf(I)&&(I.length===c&&(x=x.add(a.wr)),!0)},_),sn.resolve(this.Cr(x))}Cr(e){const r=[];return e.forEach(o=>{const c=this.Dr(o);c!==null&&r.push(c)}),r}removeMutationBatch(e,r){Vi(this.Fr(r.batchId,"removed")===0),this.mutationQueue.shift();let o=this.br;return sn.forEach(r.mutations,c=>{const f=new wo(c.key,r.batchId);return o=o.delete(f),this.referenceDelegate.markPotentiallyOrphaned(e,c.key)}).next(()=>{this.br=o})}On(e){}containsKey(e,r){const o=new wo(r,0),c=this.br.firstAfterOrEqual(o);return sn.resolve(r.isEqual(c&&c.key))}performConsistencyCheck(e){return this.mutationQueue.length,sn.resolve()}Fr(e,r){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const r=this.vr(e);return r<0||r>=this.mutationQueue.length?null:this.mutationQueue[r]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gfe{constructor(e){this.Mr=e,this.docs=function(){return new As(lr.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,r){const o=r.key,c=this.docs.get(o),f=c?c.size:0,_=this.Mr(r);return this.docs=this.docs.insert(o,{document:r.mutableCopy(),size:_}),this.size+=_-f,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const r=this.docs.get(e);r&&(this.docs=this.docs.remove(e),this.size-=r.size)}getEntry(e,r){const o=this.docs.get(r);return sn.resolve(o?o.document.mutableCopy():ea.newInvalidDocument(r))}getEntries(e,r){let o=Xh();return r.forEach(c=>{const f=this.docs.get(c);o=o.insert(c,f?f.document.mutableCopy():ea.newInvalidDocument(c))}),sn.resolve(o)}getDocumentsMatchingQuery(e,r,o,c){let f=Xh();const _=r.path,x=new lr(_.child("")),a=this.docs.getIteratorFrom(x);for(;a.hasNext();){const{key:I,value:{document:D}}=a.getNext();if(!_.isPrefixOf(I.path))break;I.path.length>_.length+1||Jhe(Qhe(D),o)<=0||(c.has(D.key)||QI(r,D))&&(f=f.insert(D.key,D.mutableCopy()))}return sn.resolve(f)}getAllFromCollectionGroup(e,r,o,c){Ir()}Or(e,r){return sn.forEach(this.docs,o=>r(o))}newChangeBuffer(e){return new _fe(this)}getSize(e){return sn.resolve(this.size)}}class _fe extends cfe{constructor(e){super(),this.cr=e}applyChanges(e){const r=[];return this.changes.forEach((o,c)=>{c.isValidDocument()?r.push(this.cr.addEntry(e,c)):this.cr.removeEntry(o)}),sn.waitFor(r)}getFromCache(e,r){return this.cr.getEntry(e,r)}getAllFromCache(e,r){return this.cr.getEntries(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yfe{constructor(e){this.persistence=e,this.Nr=new Xy(r=>lL(r),cL),this.lastRemoteSnapshotVersion=kr.min(),this.highestTargetId=0,this.Lr=0,this.Br=new gL,this.targetCount=0,this.kr=Cy.Bn()}forEachTarget(e,r){return this.Nr.forEach((o,c)=>r(c)),sn.resolve()}getLastRemoteSnapshotVersion(e){return sn.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return sn.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),sn.resolve(this.highestTargetId)}setTargetsMetadata(e,r,o){return o&&(this.lastRemoteSnapshotVersion=o),r>this.Lr&&(this.Lr=r),sn.resolve()}Kn(e){this.Nr.set(e.target,e);const r=e.targetId;r>this.highestTargetId&&(this.kr=new Cy(r),this.highestTargetId=r),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,r){return this.Kn(r),this.targetCount+=1,sn.resolve()}updateTargetData(e,r){return this.Kn(r),sn.resolve()}removeTargetData(e,r){return this.Nr.delete(r.target),this.Br.gr(r.targetId),this.targetCount-=1,sn.resolve()}removeTargets(e,r,o){let c=0;const f=[];return this.Nr.forEach((_,x)=>{x.sequenceNumber<=r&&o.get(x.targetId)===null&&(this.Nr.delete(_),f.push(this.removeMatchingKeysForTargetId(e,x.targetId)),c++)}),sn.waitFor(f).next(()=>c)}getTargetCount(e){return sn.resolve(this.targetCount)}getTargetData(e,r){const o=this.Nr.get(r)||null;return sn.resolve(o)}addMatchingKeys(e,r,o){return this.Br.Rr(r,o),sn.resolve()}removeMatchingKeys(e,r,o){this.Br.mr(r,o);const c=this.persistence.referenceDelegate,f=[];return c&&r.forEach(_=>{f.push(c.markPotentiallyOrphaned(e,_))}),sn.waitFor(f)}removeMatchingKeysForTargetId(e,r){return this.Br.gr(r),sn.resolve()}getMatchingKeysForTargetId(e,r){const o=this.Br.yr(r);return sn.resolve(o)}containsKey(e,r){return sn.resolve(this.Br.containsKey(r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vfe{constructor(e,r){this.qr={},this.overlays={},this.Qr=new iL(0),this.Kr=!1,this.Kr=!0,this.$r=new pfe,this.referenceDelegate=e(this),this.Ur=new yfe(this),this.indexManager=new afe,this.remoteDocumentCache=function(c){return new gfe(c)}(o=>this.referenceDelegate.Wr(o)),this.serializer=new sfe(r),this.Gr=new dfe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let r=this.overlays[e.toKey()];return r||(r=new ffe,this.overlays[e.toKey()]=r),r}getMutationQueue(e,r){let o=this.qr[e.toKey()];return o||(o=new mfe(r,this.referenceDelegate),this.qr[e.toKey()]=o),o}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,r,o){qn("MemoryPersistence","Starting transaction:",e);const c=new xfe(this.Qr.next());return this.referenceDelegate.zr(),o(c).next(f=>this.referenceDelegate.jr(c).next(()=>f)).toPromise().then(f=>(c.raiseOnCommittedEvent(),f))}Hr(e,r){return sn.or(Object.values(this.qr).map(o=>()=>o.containsKey(e,r)))}}class xfe extends tde{constructor(e){super(),this.currentSequenceNumber=e}}class _L{constructor(e){this.persistence=e,this.Jr=new gL,this.Yr=null}static Zr(e){return new _L(e)}get Xr(){if(this.Yr)return this.Yr;throw Ir()}addReference(e,r,o){return this.Jr.addReference(o,r),this.Xr.delete(o.toString()),sn.resolve()}removeReference(e,r,o){return this.Jr.removeReference(o,r),this.Xr.add(o.toString()),sn.resolve()}markPotentiallyOrphaned(e,r){return this.Xr.add(r.toString()),sn.resolve()}removeTarget(e,r){this.Jr.gr(r.targetId).forEach(c=>this.Xr.add(c.toString()));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,r.targetId).next(c=>{c.forEach(f=>this.Xr.add(f.toString()))}).next(()=>o.removeTargetData(e,r))}zr(){this.Yr=new Set}jr(e){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return sn.forEach(this.Xr,o=>{const c=lr.fromPath(o);return this.ei(e,c).next(f=>{f||r.removeEntry(c,kr.min())})}).next(()=>(this.Yr=null,r.apply(e)))}updateLimboDocument(e,r){return this.ei(e,r).next(o=>{o?this.Xr.delete(r.toString()):this.Xr.add(r.toString())})}Wr(e){return 0}ei(e,r){return sn.or([()=>sn.resolve(this.Jr.containsKey(r)),()=>this.persistence.getTargetCache().containsKey(e,r),()=>this.persistence.Hr(e,r)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yL{constructor(e,r,o,c){this.targetId=e,this.fromCache=r,this.$i=o,this.Ui=c}static Wi(e,r){let o=Jr(),c=Jr();for(const f of r.docChanges)switch(f.type){case 0:o=o.add(f.doc.key);break;case 1:c=c.add(f.doc.key)}return new yL(e,r.fromCache,o,c)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bfe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wfe{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return fle()?8:nde(ia())>0?6:4}()}initialize(e,r){this.Ji=e,this.indexManager=r,this.Gi=!0}getDocumentsMatchingQuery(e,r,o,c){const f={result:null};return this.Yi(e,r).next(_=>{f.result=_}).next(()=>{if(!f.result)return this.Zi(e,r,c,o).next(_=>{f.result=_})}).next(()=>{if(f.result)return;const _=new bfe;return this.Xi(e,r,_).next(x=>{if(f.result=x,this.zi)return this.es(e,r,_,x.size)})}).next(()=>f.result)}es(e,r,o,c){return o.documentReadCount<this.ji?(zv()<=ri.DEBUG&&qn("QueryEngine","SDK will not create cache indexes for query:",P_(r),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),sn.resolve()):(zv()<=ri.DEBUG&&qn("QueryEngine","Query:",P_(r),"scans",o.documentReadCount,"local documents and returns",c,"documents as results."),o.documentReadCount>this.Hi*c?(zv()<=ri.DEBUG&&qn("QueryEngine","The SDK decides to create cache indexes for query:",P_(r),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ju(r))):sn.resolve())}Yi(e,r){if(oV(r))return sn.resolve(null);let o=ju(r);return this.indexManager.getIndexType(e,o).next(c=>c===0?null:(r.limit!==null&&c===1&&(r=ES(r,null,"F"),o=ju(r)),this.indexManager.getDocumentsMatchingTarget(e,o).next(f=>{const _=Jr(...f);return this.Ji.getDocuments(e,_).next(x=>this.indexManager.getMinOffset(e,o).next(a=>{const I=this.ts(r,x);return this.ns(r,I,_,a.readTime)?this.Yi(e,ES(r,null,"F")):this.rs(e,I,r,a)}))})))}Zi(e,r,o,c){return oV(r)||c.isEqual(kr.min())?sn.resolve(null):this.Ji.getDocuments(e,o).next(f=>{const _=this.ts(r,f);return this.ns(r,_,o,c)?sn.resolve(null):(zv()<=ri.DEBUG&&qn("QueryEngine","Re-using previous result from %s to execute query: %s",c.toString(),P_(r)),this.rs(e,_,r,Yhe(c,-1)).next(x=>x))})}ts(e,r){let o=new No(Zq(e));return r.forEach((c,f)=>{QI(e,f)&&(o=o.add(f))}),o}ns(e,r,o,c){if(e.limit===null)return!1;if(o.size!==r.size)return!0;const f=e.limitType==="F"?r.last():r.first();return!!f&&(f.hasPendingWrites||f.version.compareTo(c)>0)}Xi(e,r,o){return zv()<=ri.DEBUG&&qn("QueryEngine","Using full collection scan to execute query:",P_(r)),this.Ji.getDocumentsMatchingQuery(e,r,Bf.min(),o)}rs(e,r,o,c){return this.Ji.getDocumentsMatchingQuery(e,o,c).next(f=>(r.forEach(_=>{f=f.insert(_.key,_)}),f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tfe{constructor(e,r,o,c){this.persistence=e,this.ss=r,this.serializer=c,this.os=new As(hi),this._s=new Xy(f=>lL(f),cL),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(o)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new hfe(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",r=>e.collect(r,this.os))}}function Efe(t,e,r,o){return new Tfe(t,e,r,o)}async function mW(t,e){const r=Dr(t);return await r.persistence.runTransaction("Handle user change","readonly",o=>{let c;return r.mutationQueue.getAllMutationBatches(o).next(f=>(c=f,r.ls(e),r.mutationQueue.getAllMutationBatches(o))).next(f=>{const _=[],x=[];let a=Jr();for(const I of c){_.push(I.batchId);for(const D of I.mutations)a=a.add(D.key)}for(const I of f){x.push(I.batchId);for(const D of I.mutations)a=a.add(D.key)}return r.localDocuments.getDocuments(o,a).next(I=>({hs:I,removedBatchIds:_,addedBatchIds:x}))})})}function Sfe(t,e){const r=Dr(t);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",o=>{const c=e.batch.keys(),f=r.cs.newChangeBuffer({trackRemovals:!0});return function(x,a,I,D){const O=I.batch,F=O.keys();let Z=sn.resolve();return F.forEach(J=>{Z=Z.next(()=>D.getEntry(a,J)).next(ne=>{const se=I.docVersions.get(J);Vi(se!==null),ne.version.compareTo(se)<0&&(O.applyToRemoteDocument(ne,I),ne.isValidDocument()&&(ne.setReadTime(I.commitVersion),D.addEntry(ne)))})}),Z.next(()=>x.mutationQueue.removeMutationBatch(a,O))}(r,o,e,f).next(()=>f.apply(o)).next(()=>r.mutationQueue.performConsistencyCheck(o)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(o,c,e.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,function(x){let a=Jr();for(let I=0;I<x.mutationResults.length;++I)x.mutationResults[I].transformResults.length>0&&(a=a.add(x.batch.mutations[I].key));return a}(e))).next(()=>r.localDocuments.getDocuments(o,c))})}function gW(t){const e=Dr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",r=>e.Ur.getLastRemoteSnapshotVersion(r))}function Ife(t,e){const r=Dr(t),o=e.snapshotVersion;let c=r.os;return r.persistence.runTransaction("Apply remote event","readwrite-primary",f=>{const _=r.cs.newChangeBuffer({trackRemovals:!0});c=r.os;const x=[];e.targetChanges.forEach((D,O)=>{const F=c.get(O);if(!F)return;x.push(r.Ur.removeMatchingKeys(f,D.removedDocuments,O).next(()=>r.Ur.addMatchingKeys(f,D.addedDocuments,O)));let Z=F.withSequenceNumber(f.currentSequenceNumber);e.targetMismatches.get(O)!==null?Z=Z.withResumeToken(Bo.EMPTY_BYTE_STRING,kr.min()).withLastLimboFreeSnapshotVersion(kr.min()):D.resumeToken.approximateByteSize()>0&&(Z=Z.withResumeToken(D.resumeToken,o)),c=c.insert(O,Z),function(ne,se,W){return ne.resumeToken.approximateByteSize()===0||se.snapshotVersion.toMicroseconds()-ne.snapshotVersion.toMicroseconds()>=3e8?!0:W.addedDocuments.size+W.modifiedDocuments.size+W.removedDocuments.size>0}(F,Z,D)&&x.push(r.Ur.updateTargetData(f,Z))});let a=Xh(),I=Jr();if(e.documentUpdates.forEach(D=>{e.resolvedLimboDocuments.has(D)&&x.push(r.persistence.referenceDelegate.updateLimboDocument(f,D))}),x.push(Afe(f,_,e.documentUpdates).next(D=>{a=D.Ps,I=D.Is})),!o.isEqual(kr.min())){const D=r.Ur.getLastRemoteSnapshotVersion(f).next(O=>r.Ur.setTargetsMetadata(f,f.currentSequenceNumber,o));x.push(D)}return sn.waitFor(x).next(()=>_.apply(f)).next(()=>r.localDocuments.getLocalViewOfDocuments(f,a,I)).next(()=>a)}).then(f=>(r.os=c,f))}function Afe(t,e,r){let o=Jr(),c=Jr();return r.forEach(f=>o=o.add(f)),e.getEntries(t,o).next(f=>{let _=Xh();return r.forEach((x,a)=>{const I=f.get(x);a.isFoundDocument()!==I.isFoundDocument()&&(c=c.add(x)),a.isNoDocument()&&a.version.isEqual(kr.min())?(e.removeEntry(x,a.readTime),_=_.insert(x,a)):!I.isValidDocument()||a.version.compareTo(I.version)>0||a.version.compareTo(I.version)===0&&I.hasPendingWrites?(e.addEntry(a),_=_.insert(x,a)):qn("LocalStore","Ignoring outdated watch update for ",x,". Current version:",I.version," Watch version:",a.version)}),{Ps:_,Is:c}})}function Cfe(t,e){const r=Dr(t);return r.persistence.runTransaction("Get next mutation batch","readonly",o=>(e===void 0&&(e=-1),r.mutationQueue.getNextMutationBatchAfterBatchId(o,e)))}function Pfe(t,e){const r=Dr(t);return r.persistence.runTransaction("Allocate target","readwrite",o=>{let c;return r.Ur.getTargetData(o,e).next(f=>f?(c=f,sn.resolve(c)):r.Ur.allocateTargetId(o).next(_=>(c=new gf(e,_,"TargetPurposeListen",o.currentSequenceNumber),r.Ur.addTargetData(o,c).next(()=>c))))}).then(o=>{const c=r.os.get(o.targetId);return(c===null||o.snapshotVersion.compareTo(c.snapshotVersion)>0)&&(r.os=r.os.insert(o.targetId,o),r._s.set(e,o.targetId)),o})}async function g3(t,e,r){const o=Dr(t),c=o.os.get(e),f=r?"readwrite":"readwrite-primary";try{r||await o.persistence.runTransaction("Release target",f,_=>o.persistence.referenceDelegate.removeTarget(_,c))}catch(_){if(!nb(_))throw _;qn("LocalStore",`Failed to update sequence numbers for target ${e}: ${_}`)}o.os=o.os.remove(e),o._s.delete(c.target)}function _V(t,e,r){const o=Dr(t);let c=kr.min(),f=Jr();return o.persistence.runTransaction("Execute query","readwrite",_=>function(a,I,D){const O=Dr(a),F=O._s.get(D);return F!==void 0?sn.resolve(O.os.get(F)):O.Ur.getTargetData(I,D)}(o,_,ju(e)).next(x=>{if(x)return c=x.lastLimboFreeSnapshotVersion,o.Ur.getMatchingKeysForTargetId(_,x.targetId).next(a=>{f=a})}).next(()=>o.ss.getDocumentsMatchingQuery(_,e,r?c:kr.min(),r?f:Jr())).next(x=>(Rfe(o,xde(e),x),{documents:x,Ts:f})))}function Rfe(t,e,r){let o=t.us.get(e)||kr.min();r.forEach((c,f)=>{f.readTime.compareTo(o)>0&&(o=f.readTime)}),t.us.set(e,o)}class yV{constructor(){this.activeTargetIds=Ide()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Mfe{constructor(){this.so=new yV,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,r,o){}addLocalQueryTarget(e){return this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,r,o){this.oo[e]=r}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new yV,Promise.resolve()}handleUserChange(e,r,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kfe{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vV{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){qn("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){qn("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jT=null;function cM(){return jT===null?jT=function(){return 268435456+Math.round(2147483648*Math.random())}():jT++,"0x"+jT.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dfe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ofe{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ko="WebChannelConnection";class Lfe extends class{constructor(r){this.databaseInfo=r,this.databaseId=r.databaseId;const o=r.ssl?"https":"http",c=encodeURIComponent(this.databaseId.projectId),f=encodeURIComponent(this.databaseId.database);this.Do=o+"://"+r.host,this.vo=`projects/${c}/databases/${f}`,this.Co=this.databaseId.database==="(default)"?`project_id=${c}`:`project_id=${c}&database_id=${f}`}get Fo(){return!1}Mo(r,o,c,f,_){const x=cM(),a=this.xo(r,o.toUriEncodedString());qn("RestConnection",`Sending RPC '${r}' ${x}:`,a,c);const I={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(I,f,_),this.No(r,a,I,c).then(D=>(qn("RestConnection",`Received RPC '${r}' ${x}: `,D),D),D=>{throw wy("RestConnection",`RPC '${r}' ${x} failed with error: `,D,"url: ",a,"request:",c),D})}Lo(r,o,c,f,_,x){return this.Mo(r,o,c,f,_)}Oo(r,o,c){r["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Hy}(),r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),o&&o.headers.forEach((f,_)=>r[_]=f),c&&c.headers.forEach((f,_)=>r[_]=f)}xo(r,o){const c=Dfe[r];return`${this.Do}/v1/${o}:${c}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,r,o,c){const f=cM();return new Promise((_,x)=>{const a=new Pq;a.setWithCredentials(!0),a.listenOnce(Mq.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case xE.NO_ERROR:const D=a.getResponseJson();qn(Ko,`XHR for RPC '${e}' ${f} received:`,JSON.stringify(D)),_(D);break;case xE.TIMEOUT:qn(Ko,`RPC '${e}' ${f} timed out`),x(new On(Xt.DEADLINE_EXCEEDED,"Request time out"));break;case xE.HTTP_ERROR:const O=a.getStatus();if(qn(Ko,`RPC '${e}' ${f} failed with status:`,O,"response text:",a.getResponseText()),O>0){let F=a.getResponseJson();Array.isArray(F)&&(F=F[0]);const Z=F==null?void 0:F.error;if(Z&&Z.status&&Z.message){const J=function(se){const W=se.toLowerCase().replace(/_/g,"-");return Object.values(Xt).indexOf(W)>=0?W:Xt.UNKNOWN}(Z.status);x(new On(J,Z.message))}else x(new On(Xt.UNKNOWN,"Server responded with status "+a.getStatus()))}else x(new On(Xt.UNAVAILABLE,"Connection failed."));break;default:Ir()}}finally{qn(Ko,`RPC '${e}' ${f} completed.`)}});const I=JSON.stringify(c);qn(Ko,`RPC '${e}' ${f} sending request:`,c),a.send(r,"POST",I,o,15)})}Bo(e,r,o){const c=cM(),f=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],_=Oq(),x=Dq(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},I=this.longPollingOptions.timeoutSeconds;I!==void 0&&(a.longPollingTimeout=Math.round(1e3*I)),this.useFetchStreams&&(a.xmlHttpFactory=new Rq({})),this.Oo(a.initMessageHeaders,r,o),a.encodeInitMessageHeaders=!0;const D=f.join("");qn(Ko,`Creating RPC '${e}' stream ${c}: ${D}`,a);const O=_.createWebChannel(D,a);let F=!1,Z=!1;const J=new Ofe({Io:se=>{Z?qn(Ko,`Not sending because RPC '${e}' stream ${c} is closed:`,se):(F||(qn(Ko,`Opening RPC '${e}' stream ${c} transport.`),O.open(),F=!0),qn(Ko,`RPC '${e}' stream ${c} sending:`,se),O.send(se))},To:()=>O.close()}),ne=(se,W,Q)=>{se.listen(W,K=>{try{Q(K)}catch(pe){setTimeout(()=>{throw pe},0)}})};return ne(O,tx.EventType.OPEN,()=>{Z||(qn(Ko,`RPC '${e}' stream ${c} transport opened.`),J.yo())}),ne(O,tx.EventType.CLOSE,()=>{Z||(Z=!0,qn(Ko,`RPC '${e}' stream ${c} transport closed`),J.So())}),ne(O,tx.EventType.ERROR,se=>{Z||(Z=!0,wy(Ko,`RPC '${e}' stream ${c} transport errored:`,se),J.So(new On(Xt.UNAVAILABLE,"The operation could not be completed")))}),ne(O,tx.EventType.MESSAGE,se=>{var W;if(!Z){const Q=se.data[0];Vi(!!Q);const K=Q,pe=K.error||((W=K[0])===null||W===void 0?void 0:W.error);if(pe){qn(Ko,`RPC '${e}' stream ${c} received error:`,pe);const Te=pe.status;let we=function(X){const ge=Ks[X];if(ge!==void 0)return sW(ge)}(Te),oe=pe.message;we===void 0&&(we=Xt.INTERNAL,oe="Unknown error status: "+Te+" with message "+pe.message),Z=!0,J.So(new On(we,oe)),O.close()}else qn(Ko,`RPC '${e}' stream ${c} received:`,Q),J.bo(Q)}}),ne(x,kq.STAT_EVENT,se=>{se.stat===o3.PROXY?qn(Ko,`RPC '${e}' stream ${c} detected buffering proxy`):se.stat===o3.NOPROXY&&qn(Ko,`RPC '${e}' stream ${c} detected no buffering proxy`)}),setTimeout(()=>{J.wo()},0),J}}function uM(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nA(t){return new qde(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _W{constructor(e,r,o=1e3,c=1.5,f=6e4){this.ui=e,this.timerId=r,this.ko=o,this.qo=c,this.Qo=f,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const r=Math.floor(this.Ko+this.zo()),o=Math.max(0,Date.now()-this.Uo),c=Math.max(0,r-o);c>0&&qn("ExponentialBackoff",`Backing off for ${c} ms (base delay: ${this.Ko} ms, delay with jitter: ${r} ms, last attempt: ${o} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,c,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yW{constructor(e,r,o,c,f,_,x,a){this.ui=e,this.Ho=o,this.Jo=c,this.connection=f,this.authCredentialsProvider=_,this.appCheckCredentialsProvider=x,this.listener=a,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new _W(e,r)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,r){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():r&&r.code===Xt.RESOURCE_EXHAUSTED?(Zh(r.toString()),Zh("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):r&&r.code===Xt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(r)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),r=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([o,c])=>{this.Yo===r&&this.P_(o,c)},o=>{e(()=>{const c=new On(Xt.UNKNOWN,"Fetching auth token failed: "+o.message);return this.I_(c)})})}P_(e,r){const o=this.h_(this.Yo);this.stream=this.T_(e,r),this.stream.Eo(()=>{o(()=>this.listener.Eo())}),this.stream.Ro(()=>{o(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(c=>{o(()=>this.I_(c))}),this.stream.onMessage(c=>{o(()=>++this.e_==1?this.E_(c):this.onNext(c))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return qn("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return r=>{this.ui.enqueueAndForget(()=>this.Yo===e?r():(qn("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class zfe extends yW{constructor(e,r,o,c,f,_){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,o,c,_),this.serializer=f}T_(e,r){return this.connection.Bo("Listen",e,r)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const r=Zde(this.serializer,e),o=function(f){if(!("targetChange"in f))return kr.min();const _=f.targetChange;return _.targetIds&&_.targetIds.length?kr.min():_.readTime?Uu(_.readTime):kr.min()}(e);return this.listener.d_(r,o)}A_(e){const r={};r.database=m3(this.serializer),r.addTarget=function(f,_){let x;const a=_.target;if(x=u3(a)?{documents:Yde(f,a)}:{query:Qde(f,a)._t},x.targetId=_.targetId,_.resumeToken.approximateByteSize()>0){x.resumeToken=lW(f,_.resumeToken);const I=d3(f,_.expectedCount);I!==null&&(x.expectedCount=I)}else if(_.snapshotVersion.compareTo(kr.min())>0){x.readTime=IS(f,_.snapshotVersion.toTimestamp());const I=d3(f,_.expectedCount);I!==null&&(x.expectedCount=I)}return x}(this.serializer,e);const o=efe(this.serializer,e);o&&(r.labels=o),this.a_(r)}R_(e){const r={};r.database=m3(this.serializer),r.removeTarget=e,this.a_(r)}}class Nfe extends yW{constructor(e,r,o,c,f,_){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,o,c,_),this.serializer=f}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,r){return this.connection.Bo("Write",e,r)}E_(e){return Vi(!!e.streamToken),this.lastStreamToken=e.streamToken,Vi(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Vi(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const r=Kde(e.writeResults,e.commitTime),o=Uu(e.commitTime);return this.listener.g_(o,r)}p_(){const e={};e.database=m3(this.serializer),this.a_(e)}m_(e){const r={streamToken:this.lastStreamToken,writes:e.map(o=>Xde(this.serializer,o))};this.a_(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ffe extends class{}{constructor(e,r,o,c){super(),this.authCredentials=e,this.appCheckCredentials=r,this.connection=o,this.serializer=c,this.y_=!1}w_(){if(this.y_)throw new On(Xt.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,r,o,c){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,_])=>this.connection.Mo(e,f3(r,o),c,f,_)).catch(f=>{throw f.name==="FirebaseError"?(f.code===Xt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new On(Xt.UNKNOWN,f.toString())})}Lo(e,r,o,c,f){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([_,x])=>this.connection.Lo(e,f3(r,o),c,_,x,f)).catch(_=>{throw _.name==="FirebaseError"?(_.code===Xt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),_):new On(Xt.UNKNOWN,_.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Bfe{constructor(e,r){this.asyncQueue=e,this.onlineStateHandler=r,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const r=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Zh(r),this.D_=!1):qn("OnlineStateTracker",r)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jfe{constructor(e,r,o,c,f){this.localStore=e,this.datastore=r,this.asyncQueue=o,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=f,this.k_._o(_=>{o.enqueueAndForget(async()=>{sg(this)&&(qn("RemoteStore","Restarting streams for network reachability change."),await async function(a){const I=Dr(a);I.L_.add(4),await sb(I),I.q_.set("Unknown"),I.L_.delete(4),await rA(I)}(this))})}),this.q_=new Bfe(o,c)}}async function rA(t){if(sg(t))for(const e of t.B_)await e(!0)}async function sb(t){for(const e of t.B_)await e(!1)}function vW(t,e){const r=Dr(t);r.N_.has(e.targetId)||(r.N_.set(e.targetId,e),wL(r)?bL(r):Ky(r).r_()&&xL(r,e))}function vL(t,e){const r=Dr(t),o=Ky(r);r.N_.delete(e),o.r_()&&xW(r,e),r.N_.size===0&&(o.r_()?o.o_():sg(r)&&r.q_.set("Unknown"))}function xL(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(kr.min())>0){const r=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(r)}Ky(t).A_(e)}function xW(t,e){t.Q_.xe(e),Ky(t).R_(e)}function bL(t){t.Q_=new Ude({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),Ky(t).start(),t.q_.v_()}function wL(t){return sg(t)&&!Ky(t).n_()&&t.N_.size>0}function sg(t){return Dr(t).L_.size===0}function bW(t){t.Q_=void 0}async function Ufe(t){t.q_.set("Online")}async function Vfe(t){t.N_.forEach((e,r)=>{xL(t,e)})}async function $fe(t,e){bW(t),wL(t)?(t.q_.M_(e),bL(t)):t.q_.set("Unknown")}async function Gfe(t,e,r){if(t.q_.set("Online"),e instanceof aW&&e.state===2&&e.cause)try{await async function(c,f){const _=f.cause;for(const x of f.targetIds)c.N_.has(x)&&(await c.remoteSyncer.rejectListen(x,_),c.N_.delete(x),c.Q_.removeTarget(x))}(t,e)}catch(o){qn("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),o),await AS(t,o)}else if(e instanceof TE?t.Q_.Ke(e):e instanceof oW?t.Q_.He(e):t.Q_.We(e),!r.isEqual(kr.min()))try{const o=await gW(t.localStore);r.compareTo(o)>=0&&await function(f,_){const x=f.Q_.rt(_);return x.targetChanges.forEach((a,I)=>{if(a.resumeToken.approximateByteSize()>0){const D=f.N_.get(I);D&&f.N_.set(I,D.withResumeToken(a.resumeToken,_))}}),x.targetMismatches.forEach((a,I)=>{const D=f.N_.get(a);if(!D)return;f.N_.set(a,D.withResumeToken(Bo.EMPTY_BYTE_STRING,D.snapshotVersion)),xW(f,a);const O=new gf(D.target,a,I,D.sequenceNumber);xL(f,O)}),f.remoteSyncer.applyRemoteEvent(x)}(t,r)}catch(o){qn("RemoteStore","Failed to raise snapshot:",o),await AS(t,o)}}async function AS(t,e,r){if(!nb(e))throw e;t.L_.add(1),await sb(t),t.q_.set("Offline"),r||(r=()=>gW(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{qn("RemoteStore","Retrying IndexedDB access"),await r(),t.L_.delete(1),await rA(t)})}function wW(t,e){return e().catch(r=>AS(t,r,e))}async function iA(t){const e=Dr(t),r=Uf(e);let o=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;qfe(e);)try{const c=await Cfe(e.localStore,o);if(c===null){e.O_.length===0&&r.o_();break}o=c.batchId,Wfe(e,c)}catch(c){await AS(e,c)}TW(e)&&EW(e)}function qfe(t){return sg(t)&&t.O_.length<10}function Wfe(t,e){t.O_.push(e);const r=Uf(t);r.r_()&&r.V_&&r.m_(e.mutations)}function TW(t){return sg(t)&&!Uf(t).n_()&&t.O_.length>0}function EW(t){Uf(t).start()}async function Hfe(t){Uf(t).p_()}async function Zfe(t){const e=Uf(t);for(const r of t.O_)e.m_(r.mutations)}async function Xfe(t,e,r){const o=t.O_.shift(),c=fL.from(o,e,r);await wW(t,()=>t.remoteSyncer.applySuccessfulWrite(c)),await iA(t)}async function Kfe(t,e){e&&Uf(t).V_&&await async function(o,c){if(function(_){return Fde(_)&&_!==Xt.ABORTED}(c.code)){const f=o.O_.shift();Uf(o).s_(),await wW(o,()=>o.remoteSyncer.rejectFailedWrite(f.batchId,c)),await iA(o)}}(t,e),TW(t)&&EW(t)}async function xV(t,e){const r=Dr(t);r.asyncQueue.verifyOperationInProgress(),qn("RemoteStore","RemoteStore received new credentials");const o=sg(r);r.L_.add(3),await sb(r),o&&r.q_.set("Unknown"),await r.remoteSyncer.handleCredentialChange(e),r.L_.delete(3),await rA(r)}async function Yfe(t,e){const r=Dr(t);e?(r.L_.delete(2),await rA(r)):e||(r.L_.add(2),await sb(r),r.q_.set("Unknown"))}function Ky(t){return t.K_||(t.K_=function(r,o,c){const f=Dr(r);return f.w_(),new zfe(o,f.connection,f.authCredentials,f.appCheckCredentials,f.serializer,c)}(t.datastore,t.asyncQueue,{Eo:Ufe.bind(null,t),Ro:Vfe.bind(null,t),mo:$fe.bind(null,t),d_:Gfe.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),wL(t)?bL(t):t.q_.set("Unknown")):(await t.K_.stop(),bW(t))})),t.K_}function Uf(t){return t.U_||(t.U_=function(r,o,c){const f=Dr(r);return f.w_(),new Nfe(o,f.connection,f.authCredentials,f.appCheckCredentials,f.serializer,c)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Hfe.bind(null,t),mo:Kfe.bind(null,t),f_:Zfe.bind(null,t),g_:Xfe.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await iA(t)):(await t.U_.stop(),t.O_.length>0&&(qn("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TL{constructor(e,r,o,c,f){this.asyncQueue=e,this.timerId=r,this.targetTimeMs=o,this.op=c,this.removalCallback=f,this.deferred=new jh,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(_=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,r,o,c,f){const _=Date.now()+o,x=new TL(e,r,_,c,f);return x.start(o),x}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new On(Xt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function EL(t,e){if(Zh("AsyncQueue",`${e}: ${t}`),nb(t))return new On(Xt.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ay{constructor(e){this.comparator=e?(r,o)=>e(r,o)||lr.comparator(r.key,o.key):(r,o)=>lr.comparator(r.key,o.key),this.keyedMap=nx(),this.sortedSet=new As(this.comparator)}static emptySet(e){return new ay(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const r=this.keyedMap.get(e);return r?this.sortedSet.indexOf(r):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((r,o)=>(e(r),!1))}add(e){const r=this.delete(e.key);return r.copy(r.keyedMap.insert(e.key,e),r.sortedSet.insert(e,null))}delete(e){const r=this.get(e);return r?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(r)):this}isEqual(e){if(!(e instanceof ay)||this.size!==e.size)return!1;const r=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;r.hasNext();){const c=r.getNext().key,f=o.getNext().key;if(!c.isEqual(f))return!1}return!0}toString(){const e=[];return this.forEach(r=>{e.push(r.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,r){const o=new ay;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=r,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bV{constructor(){this.W_=new As(lr.comparator)}track(e){const r=e.doc.key,o=this.W_.get(r);o?e.type!==0&&o.type===3?this.W_=this.W_.insert(r,e):e.type===3&&o.type!==1?this.W_=this.W_.insert(r,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.W_=this.W_.insert(r,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.W_=this.W_.remove(r):e.type===1&&o.type===2?this.W_=this.W_.insert(r,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):Ir():this.W_=this.W_.insert(r,e)}G_(){const e=[];return this.W_.inorderTraversal((r,o)=>{e.push(o)}),e}}class Py{constructor(e,r,o,c,f,_,x,a,I){this.query=e,this.docs=r,this.oldDocs=o,this.docChanges=c,this.mutatedKeys=f,this.fromCache=_,this.syncStateChanged=x,this.excludesMetadataChanges=a,this.hasCachedResults=I}static fromInitialDocuments(e,r,o,c,f){const _=[];return r.forEach(x=>{_.push({type:0,doc:x})}),new Py(e,r,ay.emptySet(r),_,o,c,!0,!1,f)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&YI(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const r=this.docChanges,o=e.docChanges;if(r.length!==o.length)return!1;for(let c=0;c<r.length;c++)if(r[c].type!==o[c].type||!r[c].doc.isEqual(o[c].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qfe{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Jfe{constructor(){this.queries=wV(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(r,o){const c=Dr(r),f=c.queries;c.queries=wV(),f.forEach((_,x)=>{for(const a of x.j_)a.onError(o)})})(this,new On(Xt.ABORTED,"Firestore shutting down"))}}function wV(){return new Xy(t=>Hq(t),YI)}async function SL(t,e){const r=Dr(t);let o=3;const c=e.query;let f=r.queries.get(c);f?!f.H_()&&e.J_()&&(o=2):(f=new Qfe,o=e.J_()?0:1);try{switch(o){case 0:f.z_=await r.onListen(c,!0);break;case 1:f.z_=await r.onListen(c,!1);break;case 2:await r.onFirstRemoteStoreListen(c)}}catch(_){const x=EL(_,`Initialization of query '${P_(e.query)}' failed`);return void e.onError(x)}r.queries.set(c,f),f.j_.push(e),e.Z_(r.onlineState),f.z_&&e.X_(f.z_)&&AL(r)}async function IL(t,e){const r=Dr(t),o=e.query;let c=3;const f=r.queries.get(o);if(f){const _=f.j_.indexOf(e);_>=0&&(f.j_.splice(_,1),f.j_.length===0?c=e.J_()?0:1:!f.H_()&&e.J_()&&(c=2))}switch(c){case 0:return r.queries.delete(o),r.onUnlisten(o,!0);case 1:return r.queries.delete(o),r.onUnlisten(o,!1);case 2:return r.onLastRemoteStoreUnlisten(o);default:return}}function epe(t,e){const r=Dr(t);let o=!1;for(const c of e){const f=c.query,_=r.queries.get(f);if(_){for(const x of _.j_)x.X_(c)&&(o=!0);_.z_=c}}o&&AL(r)}function tpe(t,e,r){const o=Dr(t),c=o.queries.get(e);if(c)for(const f of c.j_)f.onError(r);o.queries.delete(e)}function AL(t){t.Y_.forEach(e=>{e.next()})}var _3,TV;(TV=_3||(_3={})).ea="default",TV.Cache="cache";class CL{constructor(e,r,o){this.query=e,this.ta=r,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=o||{}}X_(e){if(!this.options.includeMetadataChanges){const o=[];for(const c of e.docChanges)c.type!==3&&o.push(c);e=new Py(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let r=!1;return this.na?this.ia(e)&&(this.ta.next(e),r=!0):this.sa(e,this.onlineState)&&(this.oa(e),r=!0),this.ra=e,r}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let r=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),r=!0),r}sa(e,r){if(!e.fromCache||!this.J_())return!0;const o=r!=="Offline";return(!this.options._a||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||r==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const r=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!r)&&this.options.includeMetadataChanges===!0}oa(e){e=Py.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==_3.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SW{constructor(e){this.key=e}}class IW{constructor(e){this.key=e}}class npe{constructor(e,r){this.query=e,this.Ta=r,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Jr(),this.mutatedKeys=Jr(),this.Aa=Zq(e),this.Ra=new ay(this.Aa)}get Va(){return this.Ta}ma(e,r){const o=r?r.fa:new bV,c=r?r.Ra:this.Ra;let f=r?r.mutatedKeys:this.mutatedKeys,_=c,x=!1;const a=this.query.limitType==="F"&&c.size===this.query.limit?c.last():null,I=this.query.limitType==="L"&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((D,O)=>{const F=c.get(D),Z=QI(this.query,O)?O:null,J=!!F&&this.mutatedKeys.has(F.key),ne=!!Z&&(Z.hasLocalMutations||this.mutatedKeys.has(Z.key)&&Z.hasCommittedMutations);let se=!1;F&&Z?F.data.isEqual(Z.data)?J!==ne&&(o.track({type:3,doc:Z}),se=!0):this.ga(F,Z)||(o.track({type:2,doc:Z}),se=!0,(a&&this.Aa(Z,a)>0||I&&this.Aa(Z,I)<0)&&(x=!0)):!F&&Z?(o.track({type:0,doc:Z}),se=!0):F&&!Z&&(o.track({type:1,doc:F}),se=!0,(a||I)&&(x=!0)),se&&(Z?(_=_.add(Z),f=ne?f.add(D):f.delete(D)):(_=_.delete(D),f=f.delete(D)))}),this.query.limit!==null)for(;_.size>this.query.limit;){const D=this.query.limitType==="F"?_.last():_.first();_=_.delete(D.key),f=f.delete(D.key),o.track({type:1,doc:D})}return{Ra:_,fa:o,ns:x,mutatedKeys:f}}ga(e,r){return e.hasLocalMutations&&r.hasCommittedMutations&&!r.hasLocalMutations}applyChanges(e,r,o,c){const f=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const _=e.fa.G_();_.sort((D,O)=>function(Z,J){const ne=se=>{switch(se){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ir()}};return ne(Z)-ne(J)}(D.type,O.type)||this.Aa(D.doc,O.doc)),this.pa(o),c=c!=null&&c;const x=r&&!c?this.ya():[],a=this.da.size===0&&this.current&&!c?1:0,I=a!==this.Ea;return this.Ea=a,_.length!==0||I?{snapshot:new Py(this.query,e.Ra,f,_,e.mutatedKeys,a===0,I,!1,!!o&&o.resumeToken.approximateByteSize()>0),wa:x}:{wa:x}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new bV,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(r=>this.Ta=this.Ta.add(r)),e.modifiedDocuments.forEach(r=>{}),e.removedDocuments.forEach(r=>this.Ta=this.Ta.delete(r)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Jr(),this.Ra.forEach(o=>{this.Sa(o.key)&&(this.da=this.da.add(o.key))});const r=[];return e.forEach(o=>{this.da.has(o)||r.push(new IW(o))}),this.da.forEach(o=>{e.has(o)||r.push(new SW(o))}),r}ba(e){this.Ta=e.Ts,this.da=Jr();const r=this.ma(e.documents);return this.applyChanges(r,!0)}Da(){return Py.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class rpe{constructor(e,r,o){this.query=e,this.targetId=r,this.view=o}}class ipe{constructor(e){this.key=e,this.va=!1}}class spe{constructor(e,r,o,c,f,_){this.localStore=e,this.remoteStore=r,this.eventManager=o,this.sharedClientState=c,this.currentUser=f,this.maxConcurrentLimboResolutions=_,this.Ca={},this.Fa=new Xy(x=>Hq(x),YI),this.Ma=new Map,this.xa=new Set,this.Oa=new As(lr.comparator),this.Na=new Map,this.La=new gL,this.Ba={},this.ka=new Map,this.qa=Cy.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function ope(t,e,r=!0){const o=kW(t);let c;const f=o.Fa.get(e);return f?(o.sharedClientState.addLocalQueryTarget(f.targetId),c=f.view.Da()):c=await AW(o,e,r,!0),c}async function ape(t,e){const r=kW(t);await AW(r,e,!0,!1)}async function AW(t,e,r,o){const c=await Pfe(t.localStore,ju(e)),f=c.targetId,_=r?t.sharedClientState.addLocalQueryTarget(f):"not-current";let x;return o&&(x=await lpe(t,e,f,_==="current",c.resumeToken)),t.isPrimaryClient&&r&&vW(t.remoteStore,c),x}async function lpe(t,e,r,o,c){t.Ka=(O,F,Z)=>async function(ne,se,W,Q){let K=se.view.ma(W);K.ns&&(K=await _V(ne.localStore,se.query,!1).then(({documents:oe})=>se.view.ma(oe,K)));const pe=Q&&Q.targetChanges.get(se.targetId),Te=Q&&Q.targetMismatches.get(se.targetId)!=null,we=se.view.applyChanges(K,ne.isPrimaryClient,pe,Te);return SV(ne,se.targetId,we.wa),we.snapshot}(t,O,F,Z);const f=await _V(t.localStore,e,!0),_=new npe(e,f.Ts),x=_.ma(f.documents),a=ib.createSynthesizedTargetChangeForCurrentChange(r,o&&t.onlineState!=="Offline",c),I=_.applyChanges(x,t.isPrimaryClient,a);SV(t,r,I.wa);const D=new rpe(e,r,_);return t.Fa.set(e,D),t.Ma.has(r)?t.Ma.get(r).push(e):t.Ma.set(r,[e]),I.snapshot}async function cpe(t,e,r){const o=Dr(t),c=o.Fa.get(e),f=o.Ma.get(c.targetId);if(f.length>1)return o.Ma.set(c.targetId,f.filter(_=>!YI(_,e))),void o.Fa.delete(e);o.isPrimaryClient?(o.sharedClientState.removeLocalQueryTarget(c.targetId),o.sharedClientState.isActiveQueryTarget(c.targetId)||await g3(o.localStore,c.targetId,!1).then(()=>{o.sharedClientState.clearQueryState(c.targetId),r&&vL(o.remoteStore,c.targetId),y3(o,c.targetId)}).catch(tb)):(y3(o,c.targetId),await g3(o.localStore,c.targetId,!0))}async function upe(t,e){const r=Dr(t),o=r.Fa.get(e),c=r.Ma.get(o.targetId);r.isPrimaryClient&&c.length===1&&(r.sharedClientState.removeLocalQueryTarget(o.targetId),vL(r.remoteStore,o.targetId))}async function hpe(t,e,r){const o=ype(t);try{const c=await function(_,x){const a=Dr(_),I=mo.now(),D=x.reduce((Z,J)=>Z.add(J.key),Jr());let O,F;return a.persistence.runTransaction("Locally write mutations","readwrite",Z=>{let J=Xh(),ne=Jr();return a.cs.getEntries(Z,D).next(se=>{J=se,J.forEach((W,Q)=>{Q.isValidDocument()||(ne=ne.add(W))})}).next(()=>a.localDocuments.getOverlayedDocuments(Z,J)).next(se=>{O=se;const W=[];for(const Q of x){const K=Dde(Q,O.get(Q.key).overlayedDocument);K!=null&&W.push(new Jf(Q.key,K,Bq(K.value.mapValue),Xl.exists(!0)))}return a.mutationQueue.addMutationBatch(Z,I,W,x)}).next(se=>{F=se;const W=se.applyToLocalDocumentSet(O,ne);return a.documentOverlayCache.saveOverlays(Z,se.batchId,W)})}).then(()=>({batchId:F.batchId,changes:Kq(O)}))}(o.localStore,e);o.sharedClientState.addPendingMutation(c.batchId),function(_,x,a){let I=_.Ba[_.currentUser.toKey()];I||(I=new As(hi)),I=I.insert(x,a),_.Ba[_.currentUser.toKey()]=I}(o,c.batchId,r),await ob(o,c.changes),await iA(o.remoteStore)}catch(c){const f=EL(c,"Failed to persist write");r.reject(f)}}async function CW(t,e){const r=Dr(t);try{const o=await Ife(r.localStore,e);e.targetChanges.forEach((c,f)=>{const _=r.Na.get(f);_&&(Vi(c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size<=1),c.addedDocuments.size>0?_.va=!0:c.modifiedDocuments.size>0?Vi(_.va):c.removedDocuments.size>0&&(Vi(_.va),_.va=!1))}),await ob(r,o,e)}catch(o){await tb(o)}}function EV(t,e,r){const o=Dr(t);if(o.isPrimaryClient&&r===0||!o.isPrimaryClient&&r===1){const c=[];o.Fa.forEach((f,_)=>{const x=_.view.Z_(e);x.snapshot&&c.push(x.snapshot)}),function(_,x){const a=Dr(_);a.onlineState=x;let I=!1;a.queries.forEach((D,O)=>{for(const F of O.j_)F.Z_(x)&&(I=!0)}),I&&AL(a)}(o.eventManager,e),c.length&&o.Ca.d_(c),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function dpe(t,e,r){const o=Dr(t);o.sharedClientState.updateQueryState(e,"rejected",r);const c=o.Na.get(e),f=c&&c.key;if(f){let _=new As(lr.comparator);_=_.insert(f,ea.newNoDocument(f,kr.min()));const x=Jr().add(f),a=new tA(kr.min(),new Map,new As(hi),_,x);await CW(o,a),o.Oa=o.Oa.remove(f),o.Na.delete(e),PL(o)}else await g3(o.localStore,e,!1).then(()=>y3(o,e,r)).catch(tb)}async function fpe(t,e){const r=Dr(t),o=e.batch.batchId;try{const c=await Sfe(r.localStore,e);RW(r,o,null),PW(r,o),r.sharedClientState.updateMutationState(o,"acknowledged"),await ob(r,c)}catch(c){await tb(c)}}async function ppe(t,e,r){const o=Dr(t);try{const c=await function(_,x){const a=Dr(_);return a.persistence.runTransaction("Reject batch","readwrite-primary",I=>{let D;return a.mutationQueue.lookupMutationBatch(I,x).next(O=>(Vi(O!==null),D=O.keys(),a.mutationQueue.removeMutationBatch(I,O))).next(()=>a.mutationQueue.performConsistencyCheck(I)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(I,D,x)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(I,D)).next(()=>a.localDocuments.getDocuments(I,D))})}(o.localStore,e);RW(o,e,r),PW(o,e),o.sharedClientState.updateMutationState(e,"rejected",r),await ob(o,c)}catch(c){await tb(c)}}function PW(t,e){(t.ka.get(e)||[]).forEach(r=>{r.resolve()}),t.ka.delete(e)}function RW(t,e,r){const o=Dr(t);let c=o.Ba[o.currentUser.toKey()];if(c){const f=c.get(e);f&&(r?f.reject(r):f.resolve(),c=c.remove(e)),o.Ba[o.currentUser.toKey()]=c}}function y3(t,e,r=null){t.sharedClientState.removeLocalQueryTarget(e);for(const o of t.Ma.get(e))t.Fa.delete(o),r&&t.Ca.$a(o,r);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(o=>{t.La.containsKey(o)||MW(t,o)})}function MW(t,e){t.xa.delete(e.path.canonicalString());const r=t.Oa.get(e);r!==null&&(vL(t.remoteStore,r),t.Oa=t.Oa.remove(e),t.Na.delete(r),PL(t))}function SV(t,e,r){for(const o of r)o instanceof SW?(t.La.addReference(o.key,e),mpe(t,o)):o instanceof IW?(qn("SyncEngine","Document no longer in limbo: "+o.key),t.La.removeReference(o.key,e),t.La.containsKey(o.key)||MW(t,o.key)):Ir()}function mpe(t,e){const r=e.key,o=r.path.canonicalString();t.Oa.get(r)||t.xa.has(o)||(qn("SyncEngine","New document in limbo: "+r),t.xa.add(o),PL(t))}function PL(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const r=new lr(is.fromString(e)),o=t.qa.next();t.Na.set(o,new ipe(r)),t.Oa=t.Oa.insert(r,o),vW(t.remoteStore,new gf(ju(KI(r.path)),o,"TargetPurposeLimboResolution",iL.oe))}}async function ob(t,e,r){const o=Dr(t),c=[],f=[],_=[];o.Fa.isEmpty()||(o.Fa.forEach((x,a)=>{_.push(o.Ka(a,e,r).then(I=>{var D;if((I||r)&&o.isPrimaryClient){const O=I?!I.fromCache:(D=r==null?void 0:r.targetChanges.get(a.targetId))===null||D===void 0?void 0:D.current;o.sharedClientState.updateQueryState(a.targetId,O?"current":"not-current")}if(I){c.push(I);const O=yL.Wi(a.targetId,I);f.push(O)}}))}),await Promise.all(_),o.Ca.d_(c),await async function(a,I){const D=Dr(a);try{await D.persistence.runTransaction("notifyLocalViewChanges","readwrite",O=>sn.forEach(I,F=>sn.forEach(F.$i,Z=>D.persistence.referenceDelegate.addReference(O,F.targetId,Z)).next(()=>sn.forEach(F.Ui,Z=>D.persistence.referenceDelegate.removeReference(O,F.targetId,Z)))))}catch(O){if(!nb(O))throw O;qn("LocalStore","Failed to update sequence numbers: "+O)}for(const O of I){const F=O.targetId;if(!O.fromCache){const Z=D.os.get(F),J=Z.snapshotVersion,ne=Z.withLastLimboFreeSnapshotVersion(J);D.os=D.os.insert(F,ne)}}}(o.localStore,f))}async function gpe(t,e){const r=Dr(t);if(!r.currentUser.isEqual(e)){qn("SyncEngine","User change. New user:",e.toKey());const o=await mW(r.localStore,e);r.currentUser=e,function(f,_){f.ka.forEach(x=>{x.forEach(a=>{a.reject(new On(Xt.CANCELLED,_))})}),f.ka.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await ob(r,o.hs)}}function _pe(t,e){const r=Dr(t),o=r.Na.get(e);if(o&&o.va)return Jr().add(o.key);{let c=Jr();const f=r.Ma.get(e);if(!f)return c;for(const _ of f){const x=r.Fa.get(_);c=c.unionWith(x.view.Va)}return c}}function kW(t){const e=Dr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=CW.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=_pe.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=dpe.bind(null,e),e.Ca.d_=epe.bind(null,e.eventManager),e.Ca.$a=tpe.bind(null,e.eventManager),e}function ype(t){const e=Dr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=fpe.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ppe.bind(null,e),e}class IV{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=nA(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,r){return null}createIndexBackfillerScheduler(e,r){return null}createLocalStore(e){return Efe(this.persistence,new wfe,e.initialUser,this.serializer)}createPersistence(e){return new vfe(_L.Zr,this.serializer)}createSharedClientState(e){return new Mfe}async terminate(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class vpe{async initialize(e,r){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>EV(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=gpe.bind(null,this.syncEngine),await Yfe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Jfe}()}createDatastore(e){const r=nA(e.databaseInfo.databaseId),o=function(f){return new Lfe(f)}(e.databaseInfo);return function(f,_,x,a){return new Ffe(f,_,x,a)}(e.authCredentials,e.appCheckCredentials,o,r)}createRemoteStore(e){return function(o,c,f,_,x){return new jfe(o,c,f,_,x)}(this.localStore,this.datastore,e.asyncQueue,r=>EV(this.syncEngine,r,0),function(){return vV.D()?new vV:new kfe}())}createSyncEngine(e,r){return function(c,f,_,x,a,I,D){const O=new spe(c,f,_,x,a,I);return D&&(O.Qa=!0),O}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}async terminate(){var e,r;await async function(c){const f=Dr(c);qn("RemoteStore","RemoteStore shutting down."),f.L_.add(5),await sb(f),f.k_.shutdown(),f.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RL{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):Zh("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,r){this.muted||setTimeout(()=>{this.muted||e(r)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xpe{constructor(e,r,o,c){this.authCredentials=e,this.appCheckCredentials=r,this.asyncQueue=o,this.databaseInfo=c,this.user=Qo.UNAUTHENTICATED,this.clientId=zq.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(o,async f=>{qn("FirestoreClient","Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(o,f=>(qn("FirestoreClient","Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new On(Xt.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new jh;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){const o=EL(r,"Failed to shutdown persistence");e.reject(o)}}),e.promise}}async function hM(t,e){t.asyncQueue.verifyOperationInProgress(),qn("FirestoreClient","Initializing OfflineComponentProvider");const r=t.configuration;await e.initialize(r);let o=r.initialUser;t.setCredentialChangeListener(async c=>{o.isEqual(c)||(await mW(e.localStore,c),o=c)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function AV(t,e){t.asyncQueue.verifyOperationInProgress();const r=await wpe(t);qn("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(r,t.configuration),t.setCredentialChangeListener(o=>xV(e.remoteStore,o)),t.setAppCheckTokenChangeListener((o,c)=>xV(e.remoteStore,c)),t._onlineComponents=e}function bpe(t){return t.name==="FirebaseError"?t.code===Xt.FAILED_PRECONDITION||t.code===Xt.UNIMPLEMENTED:!(typeof DOMException<"u"&&t instanceof DOMException)||t.code===22||t.code===20||t.code===11}async function wpe(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){qn("FirestoreClient","Using user provided OfflineComponentProvider");try{await hM(t,t._uninitializedComponentsProvider._offline)}catch(e){const r=e;if(!bpe(r))throw r;wy("Error using user provided cache. Falling back to memory cache: "+r),await hM(t,new IV)}}else qn("FirestoreClient","Using default OfflineComponentProvider"),await hM(t,new IV);return t._offlineComponents}async function DW(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(qn("FirestoreClient","Using user provided OnlineComponentProvider"),await AV(t,t._uninitializedComponentsProvider._online)):(qn("FirestoreClient","Using default OnlineComponentProvider"),await AV(t,new vpe))),t._onlineComponents}function Tpe(t){return DW(t).then(e=>e.syncEngine)}async function CS(t){const e=await DW(t),r=e.eventManager;return r.onListen=ope.bind(null,e.syncEngine),r.onUnlisten=cpe.bind(null,e.syncEngine),r.onFirstRemoteStoreListen=ape.bind(null,e.syncEngine),r.onLastRemoteStoreUnlisten=upe.bind(null,e.syncEngine),r}function Epe(t,e,r={}){const o=new jh;return t.asyncQueue.enqueueAndForget(async()=>function(f,_,x,a,I){const D=new RL({next:F=>{_.enqueueAndForget(()=>IL(f,O));const Z=F.docs.has(x);!Z&&F.fromCache?I.reject(new On(Xt.UNAVAILABLE,"Failed to get document because the client is offline.")):Z&&F.fromCache&&a&&a.source==="server"?I.reject(new On(Xt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):I.resolve(F)},error:F=>I.reject(F)}),O=new CL(KI(x.path),D,{includeMetadataChanges:!0,_a:!0});return SL(f,O)}(await CS(t),t.asyncQueue,e,r,o)),o.promise}function Spe(t,e,r={}){const o=new jh;return t.asyncQueue.enqueueAndForget(async()=>function(f,_,x,a,I){const D=new RL({next:F=>{_.enqueueAndForget(()=>IL(f,O)),F.fromCache&&a.source==="server"?I.reject(new On(Xt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):I.resolve(F)},error:F=>I.reject(F)}),O=new CL(x,D,{includeMetadataChanges:!0,_a:!0});return SL(f,O)}(await CS(t),t.asyncQueue,e,r,o)),o.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OW(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CV=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LW(t,e,r){if(!r)throw new On(Xt.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Ipe(t,e,r,o){if(e===!0&&o===!0)throw new On(Xt.INVALID_ARGUMENT,`${t} and ${r} cannot be used together.`)}function PV(t){if(!lr.isDocumentKey(t))throw new On(Xt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function RV(t){if(lr.isDocumentKey(t))throw new On(Xt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function sA(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(o){return o.constructor?o.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ir()}function qa(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new On(Xt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=sA(t);throw new On(Xt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${r}`)}}return t}function Ape(t,e){if(e<=0)throw new On(Xt.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MV{constructor(e){var r,o;if(e.host===void 0){if(e.ssl!==void 0)throw new On(Xt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(r=e.ssl)===null||r===void 0||r;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new On(Xt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Ipe("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=OW((o=e.experimentalLongPollingOptions)!==null&&o!==void 0?o:{}),function(f){if(f.timeoutSeconds!==void 0){if(isNaN(f.timeoutSeconds))throw new On(Xt.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (must not be NaN)`);if(f.timeoutSeconds<5)throw new On(Xt.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (minimum allowed value is 5)`);if(f.timeoutSeconds>30)throw new On(Xt.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(o,c){return o.timeoutSeconds===c.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class oA{constructor(e,r,o,c){this._authCredentials=e,this._appCheckCredentials=r,this._databaseId=o,this._app=c,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new MV({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new On(Xt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new On(Xt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new MV(e),e.credentials!==void 0&&(this._authCredentials=function(o){if(!o)return new Vhe;switch(o.type){case"firstParty":return new Whe(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new On(Xt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(r){const o=CV.get(r);o&&(qn("ComponentProvider","Removing Datastore"),CV.delete(r),o.terminate())}(this),Promise.resolve()}}function Cpe(t,e,r,o={}){var c;const f=(t=qa(t,oA))._getSettings(),_=`${e}:${r}`;if(f.host!=="firestore.googleapis.com"&&f.host!==_&&wy("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},f),{host:_,ssl:!1})),o.mockUserToken){let x,a;if(typeof o.mockUserToken=="string")x=o.mockUserToken,a=Qo.MOCK_USER;else{x=VG(o.mockUserToken,(c=t._app)===null||c===void 0?void 0:c.options.projectId);const I=o.mockUserToken.sub||o.mockUserToken.user_id;if(!I)throw new On(Xt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new Qo(I)}t._authCredentials=new $he(new Lq(x,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rd{constructor(e,r,o){this.converter=r,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new rd(this.firestore,e,this._query)}}class ta{constructor(e,r,o){this.converter=r,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new kf(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ta(this.firestore,e,this._key)}}class kf extends rd{constructor(e,r,o){super(e,r,KI(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ta(this.firestore,null,new lr(e))}withConverter(e){return new kf(this.firestore,e,this._path)}}function rs(t,e,...r){if(t=Gs(t),LW("collection","path",e),t instanceof oA){const o=is.fromString(e,...r);return RV(o),new kf(t,null,o)}{if(!(t instanceof ta||t instanceof kf))throw new On(Xt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=t._path.child(is.fromString(e,...r));return RV(o),new kf(t.firestore,null,o)}}function ar(t,e,...r){if(t=Gs(t),arguments.length===1&&(e=zq.newId()),LW("doc","path",e),t instanceof oA){const o=is.fromString(e,...r);return PV(o),new ta(t,null,new lr(o))}{if(!(t instanceof ta||t instanceof kf))throw new On(Xt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=t._path.child(is.fromString(e,...r));return PV(o),new ta(t.firestore,t instanceof kf?t.converter:null,new lr(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ppe{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new _W(this,"async_queue_retry"),this.Eu=()=>{const r=uM();r&&qn("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()};const e=uM();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;const r=uM();r&&typeof r.removeEventListener=="function"&&r.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});const r=new jh;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(r.resolve,r.reject),r.promise)).then(()=>r.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}async Ru(){if(this.uu.length!==0){try{await this.uu[0](),this.uu.shift(),this.t_.reset()}catch(e){if(!nb(e))throw e;qn("AsyncQueue","Operation failed with retryable error: "+e)}this.uu.length>0&&this.t_.Go(()=>this.Ru())}}Au(e){const r=this.au.then(()=>(this.Pu=!0,e().catch(o=>{this.hu=o,this.Pu=!1;const c=function(_){let x=_.message||"";return _.stack&&(x=_.stack.includes(_.message)?_.stack:_.message+`
`+_.stack),x}(o);throw Zh("INTERNAL UNHANDLED ERROR: ",c),o}).then(o=>(this.Pu=!1,o))));return this.au=r,r}enqueueAfterDelay(e,r,o){this.du(),this.Tu.indexOf(e)>-1&&(r=0);const c=TL.createAndSchedule(this,e,r,o,f=>this.Vu(f));return this.lu.push(c),c}du(){this.hu&&Ir()}verifyOperationInProgress(){}async mu(){let e;do e=this.au,await e;while(e!==this.au)}fu(e){for(const r of this.lu)if(r.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((r,o)=>r.targetTimeMs-o.targetTimeMs);for(const r of this.lu)if(r.skipDelay(),e!=="all"&&r.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){const r=this.lu.indexOf(e);this.lu.splice(r,1)}}function kV(t){return function(r,o){if(typeof r!="object"||r===null)return!1;const c=r;for(const f of o)if(f in c&&typeof c[f]=="function")return!0;return!1}(t,["next","error","complete"])}class Kh extends oA{constructor(e,r,o,c){super(e,r,o,c),this.type="firestore",this._queue=function(){return new Ppe}(),this._persistenceKey=(c==null?void 0:c.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||zW(this),this._firestoreClient.terminate()}}function Rpe(t,e){const r=typeof t=="object"?t:qO(),o=typeof t=="string"?t:"(default)",c=qI(r,"firestore").getImmediate({identifier:o});if(!c._initialized){const f=BG("firestore");f&&Cpe(c,...f)}return c}function aA(t){return t._firestoreClient||zW(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function zW(t){var e,r,o;const c=t._freezeSettings(),f=function(x,a,I,D){return new sde(x,a,I,D.host,D.ssl,D.experimentalForceLongPolling,D.experimentalAutoDetectLongPolling,OW(D.experimentalLongPollingOptions),D.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,c);t._firestoreClient=new xpe(t._authCredentials,t._appCheckCredentials,t._queue,f),!((r=c.localCache)===null||r===void 0)&&r._offlineComponentProvider&&(!((o=c.localCache)===null||o===void 0)&&o._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:c.localCache.kind,_offline:c.localCache._offlineComponentProvider,_online:c.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ry{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ry(Bo.fromBase64String(e))}catch(r){throw new On(Xt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+r)}}static fromUint8Array(e){return new Ry(Bo.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lA{constructor(...e){for(let r=0;r<e.length;++r)if(e[r].length===0)throw new On(Xt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Lo(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yy{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ML{constructor(e,r){if(!isFinite(e)||e<-90||e>90)throw new On(Xt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(r)||r<-180||r>180)throw new On(Xt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=e,this._long=r}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return hi(this._lat,e._lat)||hi(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kL{constructor(e){this._values=(e||[]).map(r=>r)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(o,c){if(o.length!==c.length)return!1;for(let f=0;f<o.length;++f)if(o[f]!==c[f])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mpe=/^__.*__$/;class kpe{constructor(e,r,o){this.data=e,this.fieldMask=r,this.fieldTransforms=o}toMutation(e,r){return this.fieldMask!==null?new Jf(e,this.data,this.fieldMask,r,this.fieldTransforms):new rb(e,this.data,r,this.fieldTransforms)}}class NW{constructor(e,r,o){this.data=e,this.fieldMask=r,this.fieldTransforms=o}toMutation(e,r){return new Jf(e,this.data,this.fieldMask,r,this.fieldTransforms)}}function FW(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ir()}}class cA{constructor(e,r,o,c,f,_){this.settings=e,this.databaseId=r,this.serializer=o,this.ignoreUndefinedProperties=c,f===void 0&&this.yu(),this.fieldTransforms=f||[],this.fieldMask=_||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new cA(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var r;const o=(r=this.path)===null||r===void 0?void 0:r.child(e),c=this.Su({path:o,Du:!1});return c.vu(e),c}Cu(e){var r;const o=(r=this.path)===null||r===void 0?void 0:r.child(e),c=this.Su({path:o,Du:!1});return c.yu(),c}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return PS(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return this.fieldMask.find(r=>e.isPrefixOf(r))!==void 0||this.fieldTransforms.find(r=>e.isPrefixOf(r.field))!==void 0}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(e.length===0)throw this.Mu("Document fields must not be empty");if(FW(this.wu)&&Mpe.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}}class Dpe{constructor(e,r,o){this.databaseId=e,this.ignoreUndefinedProperties=r,this.serializer=o||nA(e)}Nu(e,r,o,c=!1){return new cA({wu:e,methodName:r,Ou:o,path:Lo.emptyPath(),Du:!1,xu:c},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function uA(t){const e=t._freezeSettings(),r=nA(t._databaseId);return new Dpe(t._databaseId,!!e.ignoreUndefinedProperties,r)}function BW(t,e,r,o,c,f={}){const _=t.Nu(f.merge||f.mergeFields?2:0,e,r,c);zL("Data must be an object, but it was:",_,o);const x=UW(o,_);let a,I;if(f.merge)a=new ll(_.fieldMask),I=_.fieldTransforms;else if(f.mergeFields){const D=[];for(const O of f.mergeFields){const F=v3(e,O,r);if(!_.contains(F))throw new On(Xt.INVALID_ARGUMENT,`Field '${F}' is specified in your field mask but missing from your input data.`);$W(D,F)||D.push(F)}a=new ll(D),I=_.fieldTransforms.filter(O=>a.covers(O.field))}else a=null,I=_.fieldTransforms;return new kpe(new Ba(x),a,I)}class hA extends Yy{_toFieldTransform(e){if(e.wu!==2)throw e.wu===1?e.Mu(`${this._methodName}() can only appear at the top level of your update data`):e.Mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof hA}}function jW(t,e,r){return new cA({wu:3,Ou:e.settings.Ou,methodName:t._methodName,Du:r},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class DL extends Yy{_toFieldTransform(e){return new hL(e.path,new w1)}isEqual(e){return e instanceof DL}}class OL extends Yy{constructor(e,r){super(e),this.Lu=r}_toFieldTransform(e){const r=jW(this,e,!0),o=this.Lu.map(f=>og(f,r)),c=new Iy(o);return new hL(e.path,c)}isEqual(e){return e instanceof OL&&by(this.Lu,e.Lu)}}class LL extends Yy{constructor(e,r){super(e),this.Lu=r}_toFieldTransform(e){const r=jW(this,e,!0),o=this.Lu.map(f=>og(f,r)),c=new Ay(o);return new hL(e.path,c)}isEqual(e){return e instanceof LL&&by(this.Lu,e.Lu)}}function Ope(t,e,r,o){const c=t.Nu(1,e,r);zL("Data must be an object, but it was:",c,o);const f=[],_=Ba.empty();ig(o,(a,I)=>{const D=NL(e,a,r);I=Gs(I);const O=c.Cu(D);if(I instanceof hA)f.push(D);else{const F=og(I,O);F!=null&&(f.push(D),_.set(D,F))}});const x=new ll(f);return new NW(_,x,c.fieldTransforms)}function Lpe(t,e,r,o,c,f){const _=t.Nu(1,e,r),x=[v3(e,o,r)],a=[c];if(f.length%2!=0)throw new On(Xt.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let F=0;F<f.length;F+=2)x.push(v3(e,f[F])),a.push(f[F+1]);const I=[],D=Ba.empty();for(let F=x.length-1;F>=0;--F)if(!$W(I,x[F])){const Z=x[F];let J=a[F];J=Gs(J);const ne=_.Cu(Z);if(J instanceof hA)I.push(Z);else{const se=og(J,ne);se!=null&&(I.push(Z),D.set(Z,se))}}const O=new ll(I);return new NW(D,O,_.fieldTransforms)}function zpe(t,e,r,o=!1){return og(r,t.Nu(o?4:3,e))}function og(t,e){if(VW(t=Gs(t)))return zL("Unsupported field value:",e,t),UW(t,e);if(t instanceof Yy)return function(o,c){if(!FW(c.wu))throw c.Mu(`${o._methodName}() can only be used with update() and set()`);if(!c.path)throw c.Mu(`${o._methodName}() is not currently supported inside arrays`);const f=o._toFieldTransform(c);f&&c.fieldTransforms.push(f)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Du&&e.wu!==4)throw e.Mu("Nested arrays are not supported");return function(o,c){const f=[];let _=0;for(const x of o){let a=og(x,c.Fu(_));a==null&&(a={nullValue:"NULL_VALUE"}),f.push(a),_++}return{arrayValue:{values:f}}}(t,e)}return function(o,c){if((o=Gs(o))===null)return{nullValue:"NULL_VALUE"};if(typeof o=="number")return Ade(c.serializer,o);if(typeof o=="boolean")return{booleanValue:o};if(typeof o=="string")return{stringValue:o};if(o instanceof Date){const f=mo.fromDate(o);return{timestampValue:IS(c.serializer,f)}}if(o instanceof mo){const f=new mo(o.seconds,1e3*Math.floor(o.nanoseconds/1e3));return{timestampValue:IS(c.serializer,f)}}if(o instanceof ML)return{geoPointValue:{latitude:o.latitude,longitude:o.longitude}};if(o instanceof Ry)return{bytesValue:lW(c.serializer,o._byteString)};if(o instanceof ta){const f=c.databaseId,_=o.firestore._databaseId;if(!_.isEqual(f))throw c.Mu(`Document reference is for database ${_.projectId}/${_.database} but should be for database ${f.projectId}/${f.database}`);return{referenceValue:mL(o.firestore._databaseId||c.databaseId,o._key.path)}}if(o instanceof kL)return function(_,x){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:_.toArray().map(a=>{if(typeof a!="number")throw x.Mu("VectorValues must only contain numeric values.");return uL(x.serializer,a)})}}}}}}(o,c);throw c.Mu(`Unsupported field value: ${sA(o)}`)}(t,e)}function UW(t,e){const r={};return Nq(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ig(t,(o,c)=>{const f=og(c,e.bu(o));f!=null&&(r[o]=f)}),{mapValue:{fields:r}}}function VW(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof mo||t instanceof ML||t instanceof Ry||t instanceof ta||t instanceof Yy||t instanceof kL)}function zL(t,e,r){if(!VW(r)||!function(c){return typeof c=="object"&&c!==null&&(Object.getPrototypeOf(c)===Object.prototype||Object.getPrototypeOf(c)===null)}(r)){const o=sA(r);throw o==="an object"?e.Mu(t+" a custom object"):e.Mu(t+" "+o)}}function v3(t,e,r){if((e=Gs(e))instanceof lA)return e._internalPath;if(typeof e=="string")return NL(t,e);throw PS("Field path arguments must be of type string or ",t,!1,void 0,r)}const Npe=new RegExp("[~\\*/\\[\\]]");function NL(t,e,r){if(e.search(Npe)>=0)throw PS(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new lA(...e.split("."))._internalPath}catch{throw PS(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function PS(t,e,r,o,c){const f=o&&!o.isEmpty(),_=c!==void 0;let x=`Function ${e}() called with invalid data`;r&&(x+=" (via `toFirestore()`)"),x+=". ";let a="";return(f||_)&&(a+=" (found",f&&(a+=` in field ${o}`),_&&(a+=` in document ${c}`),a+=")"),new On(Xt.INVALID_ARGUMENT,x+t+a)}function $W(t,e){return t.some(r=>r.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GW{constructor(e,r,o,c,f){this._firestore=e,this._userDataWriter=r,this._key=o,this._document=c,this._converter=f}get id(){return this._key.path.lastSegment()}get ref(){return new ta(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Fpe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const r=this._document.data.field(dA("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r)}}}class Fpe extends GW{data(){return super.data()}}function dA(t,e){return typeof e=="string"?NL(t,e):e instanceof lA?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qW(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new On(Xt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class FL{}class BL extends FL{}function Oo(t,e,...r){let o=[];e instanceof FL&&o.push(e),o=o.concat(r),function(f){const _=f.filter(a=>a instanceof jL).length,x=f.filter(a=>a instanceof fA).length;if(_>1||_>0&&x>0)throw new On(Xt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(o);for(const c of o)t=c._apply(t);return t}class fA extends BL{constructor(e,r,o){super(),this._field=e,this._op=r,this._value=o,this.type="where"}static _create(e,r,o){return new fA(e,r,o)}_apply(e){const r=this._parse(e);return HW(e._query,r),new rd(e.firestore,e.converter,h3(e._query,r))}_parse(e){const r=uA(e.firestore);return function(f,_,x,a,I,D,O){let F;if(I.isKeyField()){if(D==="array-contains"||D==="array-contains-any")throw new On(Xt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${D}' queries on documentId().`);if(D==="in"||D==="not-in"){OV(O,D);const Z=[];for(const J of O)Z.push(DV(a,f,J));F={arrayValue:{values:Z}}}else F=DV(a,f,O)}else D!=="in"&&D!=="not-in"&&D!=="array-contains-any"||OV(O,D),F=zpe(x,_,O,D==="in"||D==="not-in");return eo.create(I,D,F)}(e._query,"where",r,e.firestore._databaseId,this._field,this._op,this._value)}}function Di(t,e,r){const o=e,c=dA("where",t);return fA._create(c,o,r)}class jL extends FL{constructor(e,r){super(),this.type=e,this._queryConstraints=r}static _create(e,r){return new jL(e,r)}_parse(e){const r=this._queryConstraints.map(o=>o._parse(e)).filter(o=>o.getFilters().length>0);return r.length===1?r[0]:Vc.create(r,this._getOperator())}_apply(e){const r=this._parse(e);return r.getFilters().length===0?e:(function(c,f){let _=c;const x=f.getFlattenedFilters();for(const a of x)HW(_,a),_=h3(_,a)}(e._query,r),new rd(e.firestore,e.converter,h3(e._query,r)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class UL extends BL{constructor(e,r){super(),this._field=e,this._direction=r,this.type="orderBy"}static _create(e,r){return new UL(e,r)}_apply(e){const r=function(c,f,_){if(c.startAt!==null)throw new On(Xt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(c.endAt!==null)throw new On(Xt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new b1(f,_)}(e._query,this._field,this._direction);return new rd(e.firestore,e.converter,function(c,f){const _=c.explicitOrderBy.concat([f]);return new Zy(c.path,c.collectionGroup,_,c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt)}(e._query,r))}}function RS(t,e="asc"){const r=e,o=dA("orderBy",t);return UL._create(o,r)}class VL extends BL{constructor(e,r,o){super(),this.type=e,this._limit=r,this._limitType=o}static _create(e,r,o){return new VL(e,r,o)}_apply(e){return new rd(e.firestore,e.converter,ES(e._query,this._limit,this._limitType))}}function WW(t){return Ape("limit",t),VL._create("limit",t,"F")}function DV(t,e,r){if(typeof(r=Gs(r))=="string"){if(r==="")throw new On(Xt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Wq(e)&&r.indexOf("/")!==-1)throw new On(Xt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);const o=e.path.child(is.fromString(r));if(!lr.isDocumentKey(o))throw new On(Xt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${o}' is not because it has an odd number of segments (${o.length}).`);return eV(t,new lr(o))}if(r instanceof ta)return eV(t,r._key);throw new On(Xt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${sA(r)}.`)}function OV(t,e){if(!Array.isArray(t)||t.length===0)throw new On(Xt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function HW(t,e){const r=function(c,f){for(const _ of c)for(const x of _.getFlattenedFilters())if(f.indexOf(x.op)>=0)return x.op;return null}(t.filters,function(c){switch(c){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(r!==null)throw r===e.op?new On(Xt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new On(Xt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${r.toString()}' filters.`)}class Bpe{convertValue(e,r="none"){switch(Fm(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Vs(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,r);case 5:return e.stringValue;case 6:return this.convertBytes(Nm(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,r);case 11:return this.convertObject(e.mapValue,r);case 10:return this.convertVectorValue(e.mapValue);default:throw Ir()}}convertObject(e,r){return this.convertObjectMap(e.fields,r)}convertObjectMap(e,r="none"){const o={};return ig(e,(c,f)=>{o[c]=this.convertValue(f,r)}),o}convertVectorValue(e){var r,o,c;const f=(c=(o=(r=e.fields)===null||r===void 0?void 0:r.value.arrayValue)===null||o===void 0?void 0:o.values)===null||c===void 0?void 0:c.map(_=>Vs(_.doubleValue));return new kL(f)}convertGeoPoint(e){return new ML(Vs(e.latitude),Vs(e.longitude))}convertArray(e,r){return(e.values||[]).map(o=>this.convertValue(o,r))}convertServerTimestamp(e,r){switch(r){case"previous":const o=oL(e);return o==null?null:this.convertValue(o,r);case"estimate":return this.convertTimestamp(y1(e));default:return null}}convertTimestamp(e){const r=jf(e);return new mo(r.seconds,r.nanos)}convertDocumentKey(e,r){const o=is.fromString(e);Vi(pW(o));const c=new v1(o.get(1),o.get(3)),f=new lr(o.popFirst(5));return c.isEqual(r)||Zh(`Document ${f} contains a document reference within a different database (${c.projectId}/${c.database}) which is not supported. It will be treated as a reference in the current database (${r.projectId}/${r.database}) instead.`),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZW(t,e,r){let o;return o=t?t.toFirestore(e):e,o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ix{constructor(e,r){this.hasPendingWrites=e,this.fromCache=r}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class XW extends GW{constructor(e,r,o,c,f,_){super(e,r,o,c,_),this._firestore=e,this._firestoreImpl=e,this.metadata=f}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const r=new EE(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,r={}){if(this._document){const o=this._document.data.field(dA("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,r.serverTimestamps)}}}class EE extends XW{data(e={}){return super.data(e)}}class KW{constructor(e,r,o,c){this._firestore=e,this._userDataWriter=r,this._snapshot=c,this.metadata=new ix(c.hasPendingWrites,c.fromCache),this.query=o}get docs(){const e=[];return this.forEach(r=>e.push(r)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,r){this._snapshot.docs.forEach(o=>{e.call(r,new EE(this._firestore,this._userDataWriter,o.key,o,new ix(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const r=!!e.includeMetadataChanges;if(r&&this._snapshot.excludesMetadataChanges)throw new On(Xt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===r||(this._cachedChanges=function(c,f){if(c._snapshot.oldDocs.isEmpty()){let _=0;return c._snapshot.docChanges.map(x=>{const a=new EE(c._firestore,c._userDataWriter,x.doc.key,x.doc,new ix(c._snapshot.mutatedKeys.has(x.doc.key),c._snapshot.fromCache),c.query.converter);return x.doc,{type:"added",doc:a,oldIndex:-1,newIndex:_++}})}{let _=c._snapshot.oldDocs;return c._snapshot.docChanges.filter(x=>f||x.type!==3).map(x=>{const a=new EE(c._firestore,c._userDataWriter,x.doc.key,x.doc,new ix(c._snapshot.mutatedKeys.has(x.doc.key),c._snapshot.fromCache),c.query.converter);let I=-1,D=-1;return x.type!==0&&(I=_.indexOf(x.doc.key),_=_.delete(x.doc.key)),x.type!==1&&(_=_.add(x.doc),D=_.indexOf(x.doc.key)),{type:jpe(x.type),doc:a,oldIndex:I,newIndex:D}})}}(this,r),this._cachedChangesIncludeMetadataChanges=r),this._cachedChanges}}function jpe(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ir()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ns(t){t=qa(t,ta);const e=qa(t.firestore,Kh);return Epe(aA(e),t._key).then(r=>YW(e,t,r))}class $L extends Bpe{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ry(e)}convertReference(e){const r=this.convertDocumentKey(e,this.firestore._databaseId);return new ta(this.firestore,null,r)}}function cl(t){t=qa(t,rd);const e=qa(t.firestore,Kh),r=aA(e),o=new $L(e);return qW(t._query),Spe(r,t._query).then(c=>new KW(e,o,t,c))}function xm(t,e,r){t=qa(t,ta);const o=qa(t.firestore,Kh),c=ZW(t.converter,e);return pA(o,[BW(uA(o),"setDoc",t._key,c,t.converter!==null,r).toMutation(t._key,Xl.none())])}function Ns(t,e,r,...o){t=qa(t,ta);const c=qa(t.firestore,Kh),f=uA(c);let _;return _=typeof(e=Gs(e))=="string"||e instanceof lA?Lpe(f,"updateDoc",t._key,e,r,o):Ope(f,"updateDoc",t._key,e),pA(c,[_.toMutation(t._key,Xl.exists(!0))])}function kx(t){return pA(qa(t.firestore,Kh),[new dL(t._key,Xl.none())])}function x3(t,e){const r=qa(t.firestore,Kh),o=ar(t),c=ZW(t.converter,e);return pA(r,[BW(uA(t.firestore),"addDoc",o._key,c,t.converter!==null,{}).toMutation(o._key,Xl.exists(!1))]).then(()=>o)}function Df(t,...e){var r,o,c;t=Gs(t);let f={includeMetadataChanges:!1,source:"default"},_=0;typeof e[_]!="object"||kV(e[_])||(f=e[_],_++);const x={includeMetadataChanges:f.includeMetadataChanges,source:f.source};if(kV(e[_])){const O=e[_];e[_]=(r=O.next)===null||r===void 0?void 0:r.bind(O),e[_+1]=(o=O.error)===null||o===void 0?void 0:o.bind(O),e[_+2]=(c=O.complete)===null||c===void 0?void 0:c.bind(O)}let a,I,D;if(t instanceof ta)I=qa(t.firestore,Kh),D=KI(t._key.path),a={next:O=>{e[_]&&e[_](YW(I,t,O))},error:e[_+1],complete:e[_+2]};else{const O=qa(t,rd);I=qa(O.firestore,Kh),D=O._query;const F=new $L(I);a={next:Z=>{e[_]&&e[_](new KW(I,F,O,Z))},error:e[_+1],complete:e[_+2]},qW(t._query)}return function(F,Z,J,ne){const se=new RL(ne),W=new CL(Z,se,J);return F.asyncQueue.enqueueAndForget(async()=>SL(await CS(F),W)),()=>{se.za(),F.asyncQueue.enqueueAndForget(async()=>IL(await CS(F),W))}}(aA(I),D,x,a)}function pA(t,e){return function(o,c){const f=new jh;return o.asyncQueue.enqueueAndForget(async()=>hpe(await Tpe(o),c,f)),f.promise}(aA(t),e)}function YW(t,e,r){const o=r.docs.get(e._key),c=new $L(t);return new XW(t,c,e._key,o,new ix(r.hasPendingWrites,r.fromCache),e.converter)}function b3(){return new DL("serverTimestamp")}function Dx(...t){return new OL("arrayUnion",t)}function w3(...t){return new LL("arrayRemove",t)}(function(e,r=!0){(function(c){Hy=c})(rg),Dm(new Ff("firestore",(o,{instanceIdentifier:c,options:f})=>{const _=o.getProvider("app").getImmediate(),x=new Kh(new Ghe(o.getProvider("auth-internal")),new Zhe(o.getProvider("app-check-internal")),function(I,D){if(!Object.prototype.hasOwnProperty.apply(I.options,["projectId"]))throw new On(Xt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new v1(I.options.projectId,D)}(_,c),_);return f=Object.assign({useFetchStreams:r},f),x._setSettings(f),x},"PUBLIC").setMultipleInstances(!0)),Fu(XU,"4.7.1",e),Fu(XU,"4.7.1","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QW="firebasestorage.googleapis.com",JW="storageBucket",Upe=2*60*1e3,Vpe=10*60*1e3,$pe=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cs extends Zu{constructor(e,r,o=0){super(dM(e),`Firebase Storage: ${r} (${dM(e)})`),this.status_=o,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Cs.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return dM(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var as;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(as||(as={}));function dM(t){return"storage/"+t}function GL(){const t="An unknown error occurred, please check the error payload for server response.";return new Cs(as.UNKNOWN,t)}function Gpe(t){return new Cs(as.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function qpe(t){return new Cs(as.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Wpe(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Cs(as.UNAUTHENTICATED,t)}function Hpe(){return new Cs(as.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Zpe(t){return new Cs(as.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function eH(){return new Cs(as.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function tH(){return new Cs(as.CANCELED,"User canceled the upload/download.")}function Xpe(t){return new Cs(as.INVALID_URL,"Invalid URL '"+t+"'.")}function Kpe(t){return new Cs(as.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function Ype(){return new Cs(as.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+JW+"' property when initializing the app?")}function nH(){return new Cs(as.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Qpe(){return new Cs(as.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function Jpe(){return new Cs(as.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function eme(t){return new Cs(as.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function T3(t){return new Cs(as.INVALID_ARGUMENT,t)}function rH(){return new Cs(as.APP_DELETED,"The Firebase app was deleted.")}function tme(t){return new Cs(as.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Ox(t,e){return new Cs(as.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Nv(t){throw new Cs(as.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ul{constructor(e,r){this.bucket=e,this.path_=r}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,r){let o;try{o=ul.makeFromUrl(e,r)}catch{return new ul(e,"")}if(o.path==="")return o;throw Kpe(e)}static makeFromUrl(e,r){let o=null;const c="([A-Za-z0-9.\\-_]+)";function f(pe){pe.path.charAt(pe.path.length-1)==="/"&&(pe.path_=pe.path_.slice(0,-1))}const _="(/(.*))?$",x=new RegExp("^gs://"+c+_,"i"),a={bucket:1,path:3};function I(pe){pe.path_=decodeURIComponent(pe.path)}const D="v[A-Za-z0-9_]+",O=r.replace(/[.]/g,"\\."),F="(/([^?#]*).*)?$",Z=new RegExp(`^https?://${O}/${D}/b/${c}/o${F}`,"i"),J={bucket:1,path:3},ne=r===QW?"(?:storage.googleapis.com|storage.cloud.google.com)":r,se="([^?#]*)",W=new RegExp(`^https?://${ne}/${c}/${se}`,"i"),K=[{regex:x,indices:a,postModify:f},{regex:Z,indices:J,postModify:I},{regex:W,indices:{bucket:1,path:2},postModify:I}];for(let pe=0;pe<K.length;pe++){const Te=K[pe],we=Te.regex.exec(e);if(we){const oe=we[Te.indices.bucket];let de=we[Te.indices.path];de||(de=""),o=new ul(oe,de),Te.postModify(o);break}}if(o==null)throw Xpe(e);return o}}class nme{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rme(t,e,r){let o=1,c=null,f=null,_=!1,x=0;function a(){return x===2}let I=!1;function D(...se){I||(I=!0,e.apply(null,se))}function O(se){c=setTimeout(()=>{c=null,t(Z,a())},se)}function F(){f&&clearTimeout(f)}function Z(se,...W){if(I){F();return}if(se){F(),D.call(null,se,...W);return}if(a()||_){F(),D.call(null,se,...W);return}o<64&&(o*=2);let K;x===1?(x=2,K=0):K=(o+Math.random())*1e3,O(K)}let J=!1;function ne(se){J||(J=!0,F(),!I&&(c!==null?(se||(x=2),clearTimeout(c),O(0)):se||(x=1)))}return O(0),f=setTimeout(()=>{_=!0,ne(!0)},r),ne}function ime(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sme(t){return t!==void 0}function ome(t){return typeof t=="function"}function ame(t){return typeof t=="object"&&!Array.isArray(t)}function mA(t){return typeof t=="string"||t instanceof String}function LV(t){return qL()&&t instanceof Blob}function qL(){return typeof Blob<"u"}function zV(t,e,r,o){if(o<e)throw T3(`Invalid value for '${t}'. Expected ${e} or greater.`);if(o>r)throw T3(`Invalid value for '${t}'. Expected ${r} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ab(t,e,r){let o=e;return r==null&&(o=`https://${e}`),`${r}://${o}/v0${t}`}function iH(t){const e=encodeURIComponent;let r="?";for(const o in t)if(t.hasOwnProperty(o)){const c=e(o)+"="+e(t[o]);r=r+c+"&"}return r=r.slice(0,-1),r}var bm;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(bm||(bm={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sH(t,e){const r=t>=500&&t<600,c=[408,429].indexOf(t)!==-1,f=e.indexOf(t)!==-1;return r||c||f}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lme{constructor(e,r,o,c,f,_,x,a,I,D,O,F=!0){this.url_=e,this.method_=r,this.headers_=o,this.body_=c,this.successCodes_=f,this.additionalRetryCodes_=_,this.callback_=x,this.errorCallback_=a,this.timeout_=I,this.progressCallback_=D,this.connectionFactory_=O,this.retry=F,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((Z,J)=>{this.resolve_=Z,this.reject_=J,this.start_()})}start_(){const e=(o,c)=>{if(c){o(!1,new UT(!1,null,!0));return}const f=this.connectionFactory_();this.pendingConnection_=f;const _=x=>{const a=x.loaded,I=x.lengthComputable?x.total:-1;this.progressCallback_!==null&&this.progressCallback_(a,I)};this.progressCallback_!==null&&f.addUploadProgressListener(_),f.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&f.removeUploadProgressListener(_),this.pendingConnection_=null;const x=f.getErrorCode()===bm.NO_ERROR,a=f.getStatus();if(!x||sH(a,this.additionalRetryCodes_)&&this.retry){const D=f.getErrorCode()===bm.ABORT;o(!1,new UT(!1,null,D));return}const I=this.successCodes_.indexOf(a)!==-1;o(!0,new UT(I,f))})},r=(o,c)=>{const f=this.resolve_,_=this.reject_,x=c.connection;if(c.wasSuccessCode)try{const a=this.callback_(x,x.getResponse());sme(a)?f(a):f()}catch(a){_(a)}else if(x!==null){const a=GL();a.serverResponse=x.getErrorText(),this.errorCallback_?_(this.errorCallback_(x,a)):_(a)}else if(c.canceled){const a=this.appDelete_?rH():tH();_(a)}else{const a=eH();_(a)}};this.canceled_?r(!1,new UT(!1,null,!0)):this.backoffId_=rme(e,r,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&ime(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class UT{constructor(e,r,o){this.wasSuccessCode=e,this.connection=r,this.canceled=!!o}}function cme(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function ume(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function hme(t,e){e&&(t["X-Firebase-GMPID"]=e)}function dme(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function fme(t,e,r,o,c,f,_=!0){const x=iH(t.urlParams),a=t.url+x,I=Object.assign({},t.headers);return hme(I,e),cme(I,r),ume(I,f),dme(I,o),new lme(a,t.method,I,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,c,_)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pme(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function mme(...t){const e=pme();if(e!==void 0){const r=new e;for(let o=0;o<t.length;o++)r.append(t[o]);return r.getBlob()}else{if(qL())return new Blob(t);throw new Cs(as.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function gme(t,e,r){return t.webkitSlice?t.webkitSlice(e,r):t.mozSlice?t.mozSlice(e,r):t.slice?t.slice(e,r):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _me(t){if(typeof atob>"u")throw eme("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ku={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class fM{constructor(e,r){this.data=e,this.contentType=r||null}}function yme(t,e){switch(t){case ku.RAW:return new fM(oH(e));case ku.BASE64:case ku.BASE64URL:return new fM(aH(t,e));case ku.DATA_URL:return new fM(xme(e),bme(e))}throw GL()}function oH(t){const e=[];for(let r=0;r<t.length;r++){let o=t.charCodeAt(r);if(o<=127)e.push(o);else if(o<=2047)e.push(192|o>>6,128|o&63);else if((o&64512)===55296)if(!(r<t.length-1&&(t.charCodeAt(r+1)&64512)===56320))e.push(239,191,189);else{const f=o,_=t.charCodeAt(++r);o=65536|(f&1023)<<10|_&1023,e.push(240|o>>18,128|o>>12&63,128|o>>6&63,128|o&63)}else(o&64512)===56320?e.push(239,191,189):e.push(224|o>>12,128|o>>6&63,128|o&63)}return new Uint8Array(e)}function vme(t){let e;try{e=decodeURIComponent(t)}catch{throw Ox(ku.DATA_URL,"Malformed data URL.")}return oH(e)}function aH(t,e){switch(t){case ku.BASE64:{const c=e.indexOf("-")!==-1,f=e.indexOf("_")!==-1;if(c||f)throw Ox(t,"Invalid character '"+(c?"-":"_")+"' found: is it base64url encoded?");break}case ku.BASE64URL:{const c=e.indexOf("+")!==-1,f=e.indexOf("/")!==-1;if(c||f)throw Ox(t,"Invalid character '"+(c?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let r;try{r=_me(e)}catch(c){throw c.message.includes("polyfill")?c:Ox(t,"Invalid character found")}const o=new Uint8Array(r.length);for(let c=0;c<r.length;c++)o[c]=r.charCodeAt(c);return o}class lH{constructor(e){this.base64=!1,this.contentType=null;const r=e.match(/^data:([^,]+)?,/);if(r===null)throw Ox(ku.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const o=r[1]||null;o!=null&&(this.base64=wme(o,";base64"),this.contentType=this.base64?o.substring(0,o.length-7):o),this.rest=e.substring(e.indexOf(",")+1)}}function xme(t){const e=new lH(t);return e.base64?aH(ku.BASE64,e.rest):vme(e.rest)}function bme(t){return new lH(t).contentType}function wme(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{constructor(e,r){let o=0,c="";LV(e)?(this.data_=e,o=e.size,c=e.type):e instanceof ArrayBuffer?(r?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),o=this.data_.length):e instanceof Uint8Array&&(r?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),o=e.length),this.size_=o,this.type_=c}size(){return this.size_}type(){return this.type_}slice(e,r){if(LV(this.data_)){const o=this.data_,c=gme(o,e,r);return c===null?null:new uf(c)}else{const o=new Uint8Array(this.data_.buffer,e,r-e);return new uf(o,!0)}}static getBlob(...e){if(qL()){const r=e.map(o=>o instanceof uf?o.data_:o);return new uf(mme.apply(null,r))}else{const r=e.map(_=>mA(_)?yme(ku.RAW,_).data:_.data_);let o=0;r.forEach(_=>{o+=_.byteLength});const c=new Uint8Array(o);let f=0;return r.forEach(_=>{for(let x=0;x<_.length;x++)c[f++]=_[x]}),new uf(c,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cH(t){let e;try{e=JSON.parse(t)}catch{return null}return ame(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tme(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function Eme(t,e){const r=e.split("/").filter(o=>o.length>0).join("/");return t.length===0?r:t+"/"+r}function uH(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sme(t,e){return e}class xa{constructor(e,r,o,c){this.server=e,this.local=r||e,this.writable=!!o,this.xform=c||Sme}}let VT=null;function Ime(t){return!mA(t)||t.length<2?t:uH(t)}function hH(){if(VT)return VT;const t=[];t.push(new xa("bucket")),t.push(new xa("generation")),t.push(new xa("metageneration")),t.push(new xa("name","fullPath",!0));function e(f,_){return Ime(_)}const r=new xa("name");r.xform=e,t.push(r);function o(f,_){return _!==void 0?Number(_):_}const c=new xa("size");return c.xform=o,t.push(c),t.push(new xa("timeCreated")),t.push(new xa("updated")),t.push(new xa("md5Hash",null,!0)),t.push(new xa("cacheControl",null,!0)),t.push(new xa("contentDisposition",null,!0)),t.push(new xa("contentEncoding",null,!0)),t.push(new xa("contentLanguage",null,!0)),t.push(new xa("contentType",null,!0)),t.push(new xa("metadata","customMetadata",!0)),VT=t,VT}function Ame(t,e){function r(){const o=t.bucket,c=t.fullPath,f=new ul(o,c);return e._makeStorageReference(f)}Object.defineProperty(t,"ref",{get:r})}function Cme(t,e,r){const o={};o.type="file";const c=r.length;for(let f=0;f<c;f++){const _=r[f];o[_.local]=_.xform(o,e[_.server])}return Ame(o,t),o}function dH(t,e,r){const o=cH(e);return o===null?null:Cme(t,o,r)}function Pme(t,e,r,o){const c=cH(e);if(c===null||!mA(c.downloadTokens))return null;const f=c.downloadTokens;if(f.length===0)return null;const _=encodeURIComponent;return f.split(",").map(I=>{const D=t.bucket,O=t.fullPath,F="/b/"+_(D)+"/o/"+_(O),Z=ab(F,r,o),J=iH({alt:"media",token:I});return Z+J})[0]}function fH(t,e){const r={},o=e.length;for(let c=0;c<o;c++){const f=e[c];f.writable&&(r[f.server]=t[f.local])}return JSON.stringify(r)}class Qy{constructor(e,r,o,c){this.url=e,this.method=r,this.handler=o,this.timeout=c,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uh(t){if(!t)throw GL()}function WL(t,e){function r(o,c){const f=dH(t,c,e);return Uh(f!==null),f}return r}function Rme(t,e){function r(o,c){const f=dH(t,c,e);return Uh(f!==null),Pme(f,c,t.host,t._protocol)}return r}function lb(t){function e(r,o){let c;return r.getStatus()===401?r.getErrorText().includes("Firebase App Check token is invalid")?c=Hpe():c=Wpe():r.getStatus()===402?c=qpe(t.bucket):r.getStatus()===403?c=Zpe(t.path):c=o,c.status=r.getStatus(),c.serverResponse=o.serverResponse,c}return e}function pH(t){const e=lb(t);function r(o,c){let f=e(o,c);return o.getStatus()===404&&(f=Gpe(t.path)),f.serverResponse=c.serverResponse,f}return r}function Mme(t,e,r){const o=e.fullServerUrl(),c=ab(o,t.host,t._protocol),f="GET",_=t.maxOperationRetryTime,x=new Qy(c,f,WL(t,r),_);return x.errorHandler=pH(e),x}function kme(t,e,r){const o=e.fullServerUrl(),c=ab(o,t.host,t._protocol),f="GET",_=t.maxOperationRetryTime,x=new Qy(c,f,Rme(t,r),_);return x.errorHandler=pH(e),x}function Dme(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function mH(t,e,r){const o=Object.assign({},r);return o.fullPath=t.path,o.size=e.size(),o.contentType||(o.contentType=Dme(null,e)),o}function Ome(t,e,r,o,c){const f=e.bucketOnlyServerUrl(),_={"X-Goog-Upload-Protocol":"multipart"};function x(){let K="";for(let pe=0;pe<2;pe++)K=K+Math.random().toString().slice(2);return K}const a=x();_["Content-Type"]="multipart/related; boundary="+a;const I=mH(e,o,c),D=fH(I,r),O="--"+a+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+D+`\r
--`+a+`\r
Content-Type: `+I.contentType+`\r
\r
`,F=`\r
--`+a+"--",Z=uf.getBlob(O,o,F);if(Z===null)throw nH();const J={name:I.fullPath},ne=ab(f,t.host,t._protocol),se="POST",W=t.maxUploadRetryTime,Q=new Qy(ne,se,WL(t,r),W);return Q.urlParams=J,Q.headers=_,Q.body=Z.uploadData(),Q.errorHandler=lb(e),Q}class MS{constructor(e,r,o,c){this.current=e,this.total=r,this.finalized=!!o,this.metadata=c||null}}function HL(t,e){let r=null;try{r=t.getResponseHeader("X-Goog-Upload-Status")}catch{Uh(!1)}return Uh(!!r&&(e||["active"]).indexOf(r)!==-1),r}function Lme(t,e,r,o,c){const f=e.bucketOnlyServerUrl(),_=mH(e,o,c),x={name:_.fullPath},a=ab(f,t.host,t._protocol),I="POST",D={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${o.size()}`,"X-Goog-Upload-Header-Content-Type":_.contentType,"Content-Type":"application/json; charset=utf-8"},O=fH(_,r),F=t.maxUploadRetryTime;function Z(ne){HL(ne);let se;try{se=ne.getResponseHeader("X-Goog-Upload-URL")}catch{Uh(!1)}return Uh(mA(se)),se}const J=new Qy(a,I,Z,F);return J.urlParams=x,J.headers=D,J.body=O,J.errorHandler=lb(e),J}function zme(t,e,r,o){const c={"X-Goog-Upload-Command":"query"};function f(I){const D=HL(I,["active","final"]);let O=null;try{O=I.getResponseHeader("X-Goog-Upload-Size-Received")}catch{Uh(!1)}O||Uh(!1);const F=Number(O);return Uh(!isNaN(F)),new MS(F,o.size(),D==="final")}const _="POST",x=t.maxUploadRetryTime,a=new Qy(r,_,f,x);return a.headers=c,a.errorHandler=lb(e),a}const NV=256*1024;function Nme(t,e,r,o,c,f,_,x){const a=new MS(0,0);if(_?(a.current=_.current,a.total=_.total):(a.current=0,a.total=o.size()),o.size()!==a.total)throw Qpe();const I=a.total-a.current;let D=I;c>0&&(D=Math.min(D,c));const O=a.current,F=O+D;let Z="";D===0?Z="finalize":I===D?Z="upload, finalize":Z="upload";const J={"X-Goog-Upload-Command":Z,"X-Goog-Upload-Offset":`${a.current}`},ne=o.slice(O,F);if(ne===null)throw nH();function se(pe,Te){const we=HL(pe,["active","final"]),oe=a.current+D,de=o.size();let X;return we==="final"?X=WL(e,f)(pe,Te):X=null,new MS(oe,de,we==="final",X)}const W="POST",Q=e.maxUploadRetryTime,K=new Qy(r,W,se,Q);return K.headers=J,K.body=ne.uploadData(),K.progressCallback=x||null,K.errorHandler=lb(t),K}const La={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function pM(t){switch(t){case"running":case"pausing":case"canceling":return La.RUNNING;case"paused":return La.PAUSED;case"success":return La.SUCCESS;case"canceled":return La.CANCELED;case"error":return La.ERROR;default:return La.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fme{constructor(e,r,o){if(ome(e)||r!=null||o!=null)this.next=e,this.error=r??void 0,this.complete=o??void 0;else{const f=e;this.next=f.next,this.error=f.error,this.complete=f.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y_(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class Bme{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=bm.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=bm.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=bm.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,r,o,c){if(this.sent_)throw Nv("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(r,e,!0),c!==void 0)for(const f in c)c.hasOwnProperty(f)&&this.xhr_.setRequestHeader(f,c[f].toString());return o!==void 0?this.xhr_.send(o):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Nv("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Nv("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Nv("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Nv("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class jme extends Bme{initXhr(){this.xhr_.responseType="text"}}function k_(){return new jme}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ume{constructor(e,r,o=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=r,this._metadata=o,this._mappings=hH(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=c=>{if(this._request=void 0,this._chunkMultiplier=1,c._codeEquals(as.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const f=this.isExponentialBackoffExpired();if(sH(c.status,[]))if(f)c=eH();else{this.sleepTime=Math.max(this.sleepTime*2,$pe),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=c,this._transition("error")}},this._metadataErrorHandler=c=>{this._request=void 0,c._codeEquals(as.CANCELED)?this.completeTransitions_():(this._error=c,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((c,f)=>{this._resolve=c,this._reject=f,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return r=>this._updateProgress(e+r)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([r,o])=>{switch(this._state){case"running":e(r,o);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,r)=>{const o=Lme(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),c=this._ref.storage._makeRequest(o,k_,e,r);this._request=c,c.getPromise().then(f=>{this._request=void 0,this._uploadUrl=f,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((r,o)=>{const c=zme(this._ref.storage,this._ref._location,e,this._blob),f=this._ref.storage._makeRequest(c,k_,r,o);this._request=f,f.getPromise().then(_=>{_=_,this._request=void 0,this._updateProgress(_.current),this._needToFetchStatus=!1,_.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=NV*this._chunkMultiplier,r=new MS(this._transferred,this._blob.size()),o=this._uploadUrl;this._resolveToken((c,f)=>{let _;try{_=Nme(this._ref._location,this._ref.storage,o,this._blob,e,this._mappings,r,this._makeProgressCallback())}catch(a){this._error=a,this._transition("error");return}const x=this._ref.storage._makeRequest(_,k_,c,f,!1);this._request=x,x.getPromise().then(a=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(a.current),a.finalized?(this._metadata=a.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){NV*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,r)=>{const o=Mme(this._ref.storage,this._ref._location,this._mappings),c=this._ref.storage._makeRequest(o,k_,e,r);this._request=c,c.getPromise().then(f=>{this._request=void 0,this._metadata=f,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,r)=>{const o=Ome(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),c=this._ref.storage._makeRequest(o,k_,e,r);this._request=c,c.getPromise().then(f=>{this._request=void 0,this._metadata=f,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const r=this._transferred;this._transferred=e,this._transferred!==r&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const r=this._state==="paused";this._state=e,r&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=tH(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=pM(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,r,o,c){const f=new Fme(r||void 0,o||void 0,c||void 0);return this._addObserver(f),()=>{this._removeObserver(f)}}then(e,r){return this._promise.then(e,r)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const r=this._observers.indexOf(e);r!==-1&&this._observers.splice(r,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(r=>{this._notifyObserver(r)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(pM(this._state)){case La.SUCCESS:y_(this._resolve.bind(null,this.snapshot))();break;case La.CANCELED:case La.ERROR:const r=this._reject;y_(r.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(pM(this._state)){case La.RUNNING:case La.PAUSED:e.next&&y_(e.next.bind(e,this.snapshot))();break;case La.SUCCESS:e.complete&&y_(e.complete.bind(e))();break;case La.CANCELED:case La.ERROR:e.error&&y_(e.error.bind(e,this._error))();break;default:e.error&&y_(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bm{constructor(e,r){this._service=e,r instanceof ul?this._location=r:this._location=ul.makeFromUrl(r,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,r){return new Bm(e,r)}get root(){const e=new ul(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return uH(this._location.path)}get storage(){return this._service}get parent(){const e=Tme(this._location.path);if(e===null)return null;const r=new ul(this._location.bucket,e);return new Bm(this._service,r)}_throwIfRoot(e){if(this._location.path==="")throw tme(e)}}function Vme(t,e,r){return t._throwIfRoot("uploadBytesResumable"),new Ume(t,new uf(e),r)}function $me(t){t._throwIfRoot("getDownloadURL");const e=kme(t.storage,t._location,hH());return t.storage.makeRequestWithTokens(e,k_).then(r=>{if(r===null)throw Jpe();return r})}function Gme(t,e){const r=Eme(t._location.path,e),o=new ul(t._location.bucket,r);return new Bm(t.storage,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qme(t){return/^[A-Za-z]+:\/\//.test(t)}function Wme(t,e){return new Bm(t,e)}function gH(t,e){if(t instanceof ZL){const r=t;if(r._bucket==null)throw Ype();const o=new Bm(r,r._bucket);return e!=null?gH(o,e):o}else return e!==void 0?Gme(t,e):t}function Hme(t,e){if(e&&qme(e)){if(t instanceof ZL)return Wme(t,e);throw T3("To use ref(service, url), the first argument must be a Storage instance.")}else return gH(t,e)}function FV(t,e){const r=e==null?void 0:e[JW];return r==null?null:ul.makeFromBucketSpec(r,t)}function Zme(t,e,r,o={}){t.host=`${e}:${r}`,t._protocol="http";const{mockUserToken:c}=o;c&&(t._overrideAuthToken=typeof c=="string"?c:VG(c,t.app.options.projectId))}class ZL{constructor(e,r,o,c,f){this.app=e,this._authProvider=r,this._appCheckProvider=o,this._url=c,this._firebaseVersion=f,this._bucket=null,this._host=QW,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Upe,this._maxUploadRetryTime=Vpe,this._requests=new Set,c!=null?this._bucket=ul.makeFromBucketSpec(c,this._host):this._bucket=FV(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=ul.makeFromBucketSpec(this._url,e):this._bucket=FV(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){zV("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){zV("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const r=await e.getToken();if(r!==null)return r.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Bm(this,e)}_makeRequest(e,r,o,c,f=!0){if(this._deleted)return new nme(rH());{const _=fme(e,this._appId,o,c,r,this._firebaseVersion,f);return this._requests.add(_),_.getPromise().then(()=>this._requests.delete(_),()=>this._requests.delete(_)),_}}async makeRequestWithTokens(e,r){const[o,c]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,r,o,c).getPromise()}}const BV="@firebase/storage",jV="0.13.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _H="storage";function Xme(t,e,r){return t=Gs(t),Vme(t,e,r)}function Kme(t){return t=Gs(t),$me(t)}function Yme(t,e){return t=Gs(t),Hme(t,e)}function yH(t=qO(),e){t=Gs(t);const o=qI(t,_H).getImmediate({identifier:e}),c=BG("storage");return c&&Qme(o,...c),o}function Qme(t,e,r,o={}){Zme(t,e,r,o)}function Jme(t,{instanceIdentifier:e}){const r=t.getProvider("app").getImmediate(),o=t.getProvider("auth-internal"),c=t.getProvider("app-check-internal");return new ZL(r,o,c,e,rg)}function ege(){Dm(new Ff(_H,Jme,"PUBLIC").setMultipleInstances(!0)),Fu(BV,jV,""),Fu(BV,jV,"esm2017")}ege();const tge={apiKey:"AIzaSyC2wTEeSiz_09FzWarn52vwzSlzfHXjATE",authDomain:"quests-b5b92.firebaseapp.com",databaseURL:"https://quests-b5b92-default-rtdb.firebaseio.com",projectId:"quests-b5b92",storageBucket:"quests-b5b92.appspot.com",messagingSenderId:"388972050284",appId:"1:388972050284:web:38dfdb79a67edcf0756549",measurementId:"G-Y1P89CPKCY"},XL=qG(tge),Ut=jhe(XL),Cn=Rpe(XL);yH(XL);const nge=async(t,e,r)=>{try{const o=await Aue(Ut,t,e),c=o.user.uid;return await xm(ar(Cn,"users",c),{name:r,email:t,profilePhoto:await KL(),bio:"",isActive:!0,lastActive:Date.now(),receiverId:c,senderId:c,isPrivate:!1}),o}catch(o){console.error("Error signing up:",o)}},vH=new Ru,rge=async()=>{try{const e=(await Iq(Ut,vH)).user,r=ar(Cn,"users",e.uid);return(await ns(r)).exists()||await xm(r,{name:e.displayName||"Unnamed",email:e.email,profilePhoto:e.photoURL||await KL(),bio:"",isActive:!0,receiverId:e.uid,senderId:e.uid,isPrivate:!1}),e}catch(t){throw console.error("Error signing up with Google:",t),t}},ige=async()=>{try{const t=await Iq(Ut,vH),r=Ru.credentialFromResult(t).accessToken,o=t.user;return await sx(o.uid,{isActive:!0,lastActive:Date.now()}),console.log("User signed in with Google:",o),o}catch(t){console.error("Error signing in with Google:",t)}},sge=async(t,e)=>{var r;try{const o=await Cue(Ut,t,e),c=(r=o.user)==null?void 0:r.uid;return c?await Ns(ar(Cn,"users",c),{isActive:!0,lastActive:Date.now()}):console.error("User ID is not available"),o}catch(o){console.error("Error signing in:",o)}},oge=async t=>{const e=yH(),r=Yme(e,`profile_photos/${Ut.currentUser.uid}`),o=Xme(r,t);return new Promise((c,f)=>{o.on("state_changed",_=>{},_=>{console.error("Error uploading image:",_),f(_)},async()=>{try{const _=await Kme(o.snapshot.ref);c(_)}catch(_){console.error("Error getting download URL:",_),f(_)}})})},sx=async(t,e)=>{try{console.log("Updating user profile:",t,e),await Ns(ar(Cn,"users",t),e),console.log("User profile updated successfully")}catch(r){console.error("Error updating user profile:",r)}},KL=async()=>"https://firebasestorage.googleapis.com/v0/b/quests-b5b92.appspot.com/o/profile_photos%2Fdefault.jpg?alt=media&token=e7424067-7007-4a70-a405-b56c83f0d9d2",Lx=async t=>{try{const e=await ns(ar(Cn,"users",t));if(e.exists())return e.data();console.log("No such document!")}catch(e){console.error("Error fetching user data:",e)}};var xH={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},UV=Qr.createContext&&Qr.createContext(xH),age=["attr","size","title"];function lge(t,e){if(t==null)return{};var r=cge(t,e),o,c;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(t);for(c=0;c<f.length;c++)o=f[c],!(e.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(t,o)&&(r[o]=t[o])}return r}function cge(t,e){if(t==null)return{};var r={};for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){if(e.indexOf(o)>=0)continue;r[o]=t[o]}return r}function kS(){return kS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},kS.apply(this,arguments)}function VV(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),r.push.apply(r,o)}return r}function DS(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?VV(Object(r),!0).forEach(function(o){uge(t,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):VV(Object(r)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(r,o))})}return t}function uge(t,e,r){return e=hge(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function hge(t){var e=dge(t,"string");return typeof e=="symbol"?e:e+""}function dge(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var o=r.call(t,e||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function bH(t){return t&&t.map((e,r)=>Qr.createElement(e.tag,DS({key:r},e.attr),bH(e.child)))}function wH(t){return e=>Qr.createElement(fge,kS({attr:DS({},t.attr)},e),bH(t.child))}function fge(t){var e=r=>{var{attr:o,size:c,title:f}=t,_=lge(t,age),x=c||r.size||"1em",a;return r.className&&(a=r.className),t.className&&(a=(a?a+" ":"")+t.className),Qr.createElement("svg",kS({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,o,_,{className:a,style:DS(DS({color:t.color||r.color},r.style),t.style),height:x,width:x,xmlns:"http://www.w3.org/2000/svg"}),f&&Qr.createElement("title",null,f),t.children)};return UV!==void 0?Qr.createElement(UV.Consumer,null,r=>e(r)):e(xH)}function TH(t){return wH({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"},child:[]}]})(t)}function EH(t){return wH({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(t)}const pge=()=>{const t=II(),[e,r]=ee.useState(!1),o={email:"",password:""},c=VO({email:ry().email("Invalid email address").required("Required"),password:ry().required("Required")}),f=(a,{setSubmitting:I})=>{sge(a.email,a.password).then(D=>{const O=D.user;console.log("User signed in:",O.uid),t("/home")}).catch(D=>{console.error("Error signing in:",D)}).finally(()=>{I(!1)})},_=()=>{r(!e)},x=async()=>{try{await ige()&&t("/home")}catch(a){console.error("Error signing in with Google:",a)}};return V.jsxs("section",{className:"login-container",children:[V.jsxs("div",{className:"login-form-container",children:[V.jsx("h1",{children:"Login"}),V.jsxs("p",{className:"linktoregister",children:["Not a user? ",V.jsx(V7,{to:"/register",className:"gotoregister",style:{color:"rgb(10,145,255)"},children:"Create an account here"})]}),V.jsx(EG,{initialValues:o,validationSchema:c,onSubmit:f,children:({isSubmitting:a})=>V.jsxs(zO,{className:"login-form",children:[V.jsx(Sx,{type:"email",name:"email",placeholder:"Email Address",required:!0}),V.jsx(Ix,{name:"email",component:"div",style:{color:"red"}}),V.jsxs("div",{className:"password-container",children:[V.jsx(Sx,{type:e?"text":"password",name:"password",placeholder:"Password",required:!0}),V.jsx("span",{className:"password-toggle",onClick:_,role:"button","aria-label":"Toggle password visibility",children:e?V.jsx(TH,{}):V.jsx(EH,{})})]}),V.jsx(Ix,{name:"password",component:"div",style:{color:"red"}}),V.jsxs("div",{className:"buttons",children:[V.jsx("button",{className:"google-login-btn",onClick:x,type:"button",children:V.jsx("img",{src:"/google-logo.png",alt:"Google",className:"google-logo"})}),V.jsx("button",{className:"loginbtn",type:"submit",disabled:a,children:"Login"})]})]})})]}),V.jsxs("div",{className:"blue-rectangle",children:[V.jsx("img",{className:"questsimg",src:"/Questslogo white.png",alt:"Quests logo"}),V.jsx("h3",{children:"Welcome Back!"}),V.jsx("p",{children:"We're glad to see you again. Log in to continue where you left off."})]})]})},mge=()=>{const t=II(),[e,r]=ee.useState(!1),o={name:"",email:"",password:""},c=VO({name:ry().required("Required"),email:ry().email("Invalid email address").required("Required"),password:ry().min(6,"Password must be at least 6 characters").required("Required")}),f=async(x,{setSubmitting:a,setErrors:I})=>{try{const D=await nge(x.email,x.password,x.name);if(!D||!D.user)throw new Error("Failed to sign up");const O=D.user;console.log("User signed up successfully:",O);const F=await KL();await xm(ar(Cn,"users",O.uid),{name:x.name,email:x.email,profilePhoto:F,bio:"",isActive:!0}),console.log("User data added to Firestore"),t("/login")}catch(D){console.error("Error signing up:",D),I({general:"Failed to sign up. Please check your details and try again."})}finally{a(!1)}},_=async()=>{try{const x=await rge();console.log("Google user signed up:",x),t("/login")}catch(x){console.error("Error signing up with Google:",x)}};return V.jsxs("section",{className:"register-container",children:[V.jsxs("div",{className:"register-form-container",children:[V.jsx("h2",{className:"createacc",children:"Create New Account"}),V.jsxs("p",{className:"aauser",children:["Already a user? ",V.jsx(V7,{to:"/login",style:{color:"rgb(10,145,255)"},children:"Login here."})]}),V.jsx(EG,{initialValues:o,validationSchema:c,onSubmit:f,children:({isSubmitting:x,errors:a})=>V.jsxs(zO,{className:"register-form",children:[V.jsx(Sx,{className:"username",type:"text",name:"name",placeholder:"Username",required:!0}),V.jsx(Ix,{name:"name",component:"div",style:{color:"red"}}),V.jsx(Sx,{type:"email",name:"email",placeholder:"Email",required:!0}),V.jsx(Ix,{name:"email",component:"div",style:{color:"red"}}),V.jsxs("div",{className:"password-container",children:[V.jsx(Sx,{type:e?"text":"password",name:"password",placeholder:"Password",required:!0}),V.jsx("div",{className:"password-toggle",onClick:()=>r(!e),role:"button","aria-label":"Toggle password visibility",children:e?V.jsx(TH,{}):V.jsx(EH,{})})]}),V.jsx(Ix,{name:"password",component:"div",style:{color:"red"}}),V.jsxs("div",{className:"button-container",children:[V.jsx("button",{className:"google-register-btn",onClick:_,type:"button",children:V.jsx("img",{src:"/google-logo.png",alt:"Google",className:"google-logo"})}),V.jsx("button",{className:"register-btn",type:"submit",disabled:x,children:"Register"})]}),a.general&&V.jsx("div",{style:{color:"red",marginTop:"10px"},children:a.general})]})})]}),V.jsxs("div",{className:"blue-rectangle",children:[V.jsx("img",{className:"questsimg",src:"/Questslogo white.png",alt:"Quests logo"}),V.jsx("h3",{children:"Welcome!"}),V.jsx("p",{children:"Join our community today and unlock a world of possibilities. Connect, share, and grow with us!"})]})]})},T1={black:"#000",white:"#fff"},v_={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},x_={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},b_={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},w_={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},T_={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},Fv={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},gge={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"};function Yh(t){let e="https://mui.com/production-error/?code="+t;for(let r=1;r<arguments.length;r+=1)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified MUI error #"+t+"; visit "+e+" for the full message."}const gA="$$material";function OS(){return OS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)({}).hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},OS.apply(null,arguments)}function SH(t){var e=Object.create(null);return function(r){return e[r]===void 0&&(e[r]=t(r)),e[r]}}var _ge=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,yge=SH(function(t){return _ge.test(t)||t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)<91}),vge=!1;function xge(t){if(t.sheet)return t.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===t)return document.styleSheets[e]}function bge(t){var e=document.createElement("style");return e.setAttribute("data-emotion",t.key),t.nonce!==void 0&&e.setAttribute("nonce",t.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var wge=function(){function t(r){var o=this;this._insertTag=function(c){var f;o.tags.length===0?o.insertionPoint?f=o.insertionPoint.nextSibling:o.prepend?f=o.container.firstChild:f=o.before:f=o.tags[o.tags.length-1].nextSibling,o.container.insertBefore(c,f),o.tags.push(c)},this.isSpeedy=r.speedy===void 0?!vge:r.speedy,this.tags=[],this.ctr=0,this.nonce=r.nonce,this.key=r.key,this.container=r.container,this.prepend=r.prepend,this.insertionPoint=r.insertionPoint,this.before=null}var e=t.prototype;return e.hydrate=function(o){o.forEach(this._insertTag)},e.insert=function(o){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(bge(this));var c=this.tags[this.tags.length-1];if(this.isSpeedy){var f=xge(c);try{f.insertRule(o,f.cssRules.length)}catch{}}else c.appendChild(document.createTextNode(o));this.ctr++},e.flush=function(){this.tags.forEach(function(o){var c;return(c=o.parentNode)==null?void 0:c.removeChild(o)}),this.tags=[],this.ctr=0},t}(),Yo="-ms-",LS="-moz-",_i="-webkit-",IH="comm",YL="rule",QL="decl",Tge="@import",AH="@keyframes",Ege="@layer",Sge=Math.abs,_A=String.fromCharCode,Ige=Object.assign;function Age(t,e){return Do(t,0)^45?(((e<<2^Do(t,0))<<2^Do(t,1))<<2^Do(t,2))<<2^Do(t,3):0}function CH(t){return t.trim()}function Cge(t,e){return(t=e.exec(t))?t[0]:t}function yi(t,e,r){return t.replace(e,r)}function E3(t,e){return t.indexOf(e)}function Do(t,e){return t.charCodeAt(e)|0}function E1(t,e,r){return t.slice(e,r)}function Su(t){return t.length}function JL(t){return t.length}function $T(t,e){return e.push(t),t}function Pge(t,e){return t.map(e).join("")}var yA=1,My=1,PH=0,Wa=0,Ys=0,Jy="";function vA(t,e,r,o,c,f,_){return{value:t,root:e,parent:r,type:o,props:c,children:f,line:yA,column:My,length:_,return:""}}function Bv(t,e){return Ige(vA("",null,null,"",null,null,0),t,{length:-t.length},e)}function Rge(){return Ys}function Mge(){return Ys=Wa>0?Do(Jy,--Wa):0,My--,Ys===10&&(My=1,yA--),Ys}function ml(){return Ys=Wa<PH?Do(Jy,Wa++):0,My++,Ys===10&&(My=1,yA++),Ys}function Vu(){return Do(Jy,Wa)}function SE(){return Wa}function cb(t,e){return E1(Jy,t,e)}function S1(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function RH(t){return yA=My=1,PH=Su(Jy=t),Wa=0,[]}function MH(t){return Jy="",t}function IE(t){return CH(cb(Wa-1,S3(t===91?t+2:t===40?t+1:t)))}function kge(t){for(;(Ys=Vu())&&Ys<33;)ml();return S1(t)>2||S1(Ys)>3?"":" "}function Dge(t,e){for(;--e&&ml()&&!(Ys<48||Ys>102||Ys>57&&Ys<65||Ys>70&&Ys<97););return cb(t,SE()+(e<6&&Vu()==32&&ml()==32))}function S3(t){for(;ml();)switch(Ys){case t:return Wa;case 34:case 39:t!==34&&t!==39&&S3(Ys);break;case 40:t===41&&S3(t);break;case 92:ml();break}return Wa}function Oge(t,e){for(;ml()&&t+Ys!==57;)if(t+Ys===84&&Vu()===47)break;return"/*"+cb(e,Wa-1)+"*"+_A(t===47?t:ml())}function Lge(t){for(;!S1(Vu());)ml();return cb(t,Wa)}function zge(t){return MH(AE("",null,null,null,[""],t=RH(t),0,[0],t))}function AE(t,e,r,o,c,f,_,x,a){for(var I=0,D=0,O=_,F=0,Z=0,J=0,ne=1,se=1,W=1,Q=0,K="",pe=c,Te=f,we=o,oe=K;se;)switch(J=Q,Q=ml()){case 40:if(J!=108&&Do(oe,O-1)==58){E3(oe+=yi(IE(Q),"&","&\f"),"&\f")!=-1&&(W=-1);break}case 34:case 39:case 91:oe+=IE(Q);break;case 9:case 10:case 13:case 32:oe+=kge(J);break;case 92:oe+=Dge(SE()-1,7);continue;case 47:switch(Vu()){case 42:case 47:$T(Nge(Oge(ml(),SE()),e,r),a);break;default:oe+="/"}break;case 123*ne:x[I++]=Su(oe)*W;case 125*ne:case 59:case 0:switch(Q){case 0:case 125:se=0;case 59+D:W==-1&&(oe=yi(oe,/\f/g,"")),Z>0&&Su(oe)-O&&$T(Z>32?GV(oe+";",o,r,O-1):GV(yi(oe," ","")+";",o,r,O-2),a);break;case 59:oe+=";";default:if($T(we=$V(oe,e,r,I,D,c,x,K,pe=[],Te=[],O),f),Q===123)if(D===0)AE(oe,e,we,we,pe,f,O,x,Te);else switch(F===99&&Do(oe,3)===110?100:F){case 100:case 108:case 109:case 115:AE(t,we,we,o&&$T($V(t,we,we,0,0,c,x,K,c,pe=[],O),Te),c,Te,O,x,o?pe:Te);break;default:AE(oe,we,we,we,[""],Te,0,x,Te)}}I=D=Z=0,ne=W=1,K=oe="",O=_;break;case 58:O=1+Su(oe),Z=J;default:if(ne<1){if(Q==123)--ne;else if(Q==125&&ne++==0&&Mge()==125)continue}switch(oe+=_A(Q),Q*ne){case 38:W=D>0?1:(oe+="\f",-1);break;case 44:x[I++]=(Su(oe)-1)*W,W=1;break;case 64:Vu()===45&&(oe+=IE(ml())),F=Vu(),D=O=Su(K=oe+=Lge(SE())),Q++;break;case 45:J===45&&Su(oe)==2&&(ne=0)}}return f}function $V(t,e,r,o,c,f,_,x,a,I,D){for(var O=c-1,F=c===0?f:[""],Z=JL(F),J=0,ne=0,se=0;J<o;++J)for(var W=0,Q=E1(t,O+1,O=Sge(ne=_[J])),K=t;W<Z;++W)(K=CH(ne>0?F[W]+" "+Q:yi(Q,/&\f/g,F[W])))&&(a[se++]=K);return vA(t,e,r,c===0?YL:x,a,I,D)}function Nge(t,e,r){return vA(t,e,r,IH,_A(Rge()),E1(t,2,-2),0)}function GV(t,e,r,o){return vA(t,e,r,QL,E1(t,0,o),E1(t,o+1,-1),o)}function ly(t,e){for(var r="",o=JL(t),c=0;c<o;c++)r+=e(t[c],c,t,e)||"";return r}function Fge(t,e,r,o){switch(t.type){case Ege:if(t.children.length)break;case Tge:case QL:return t.return=t.return||t.value;case IH:return"";case AH:return t.return=t.value+"{"+ly(t.children,o)+"}";case YL:t.value=t.props.join(",")}return Su(r=ly(t.children,o))?t.return=t.value+"{"+r+"}":""}function Bge(t){var e=JL(t);return function(r,o,c,f){for(var _="",x=0;x<e;x++)_+=t[x](r,o,c,f)||"";return _}}function jge(t){return function(e){e.root||(e=e.return)&&t(e)}}var Uge=function(e,r,o){for(var c=0,f=0;c=f,f=Vu(),c===38&&f===12&&(r[o]=1),!S1(f);)ml();return cb(e,Wa)},Vge=function(e,r){var o=-1,c=44;do switch(S1(c)){case 0:c===38&&Vu()===12&&(r[o]=1),e[o]+=Uge(Wa-1,r,o);break;case 2:e[o]+=IE(c);break;case 4:if(c===44){e[++o]=Vu()===58?"&\f":"",r[o]=e[o].length;break}default:e[o]+=_A(c)}while(c=ml());return e},$ge=function(e,r){return MH(Vge(RH(e),r))},qV=new WeakMap,Gge=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var r=e.value,o=e.parent,c=e.column===o.column&&e.line===o.line;o.type!=="rule";)if(o=o.parent,!o)return;if(!(e.props.length===1&&r.charCodeAt(0)!==58&&!qV.get(o))&&!c){qV.set(e,!0);for(var f=[],_=$ge(r,f),x=o.props,a=0,I=0;a<_.length;a++)for(var D=0;D<x.length;D++,I++)e.props[I]=f[a]?_[a].replace(/&\f/g,x[D]):x[D]+" "+_[a]}}},qge=function(e){if(e.type==="decl"){var r=e.value;r.charCodeAt(0)===108&&r.charCodeAt(2)===98&&(e.return="",e.value="")}};function kH(t,e){switch(Age(t,e)){case 5103:return _i+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return _i+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return _i+t+LS+t+Yo+t+t;case 6828:case 4268:return _i+t+Yo+t+t;case 6165:return _i+t+Yo+"flex-"+t+t;case 5187:return _i+t+yi(t,/(\w+).+(:[^]+)/,_i+"box-$1$2"+Yo+"flex-$1$2")+t;case 5443:return _i+t+Yo+"flex-item-"+yi(t,/flex-|-self/,"")+t;case 4675:return _i+t+Yo+"flex-line-pack"+yi(t,/align-content|flex-|-self/,"")+t;case 5548:return _i+t+Yo+yi(t,"shrink","negative")+t;case 5292:return _i+t+Yo+yi(t,"basis","preferred-size")+t;case 6060:return _i+"box-"+yi(t,"-grow","")+_i+t+Yo+yi(t,"grow","positive")+t;case 4554:return _i+yi(t,/([^-])(transform)/g,"$1"+_i+"$2")+t;case 6187:return yi(yi(yi(t,/(zoom-|grab)/,_i+"$1"),/(image-set)/,_i+"$1"),t,"")+t;case 5495:case 3959:return yi(t,/(image-set\([^]*)/,_i+"$1$`$1");case 4968:return yi(yi(t,/(.+:)(flex-)?(.*)/,_i+"box-pack:$3"+Yo+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+_i+t+t;case 4095:case 3583:case 4068:case 2532:return yi(t,/(.+)-inline(.+)/,_i+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Su(t)-1-e>6)switch(Do(t,e+1)){case 109:if(Do(t,e+4)!==45)break;case 102:return yi(t,/(.+:)(.+)-([^]+)/,"$1"+_i+"$2-$3$1"+LS+(Do(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~E3(t,"stretch")?kH(yi(t,"stretch","fill-available"),e)+t:t}break;case 4949:if(Do(t,e+1)!==115)break;case 6444:switch(Do(t,Su(t)-3-(~E3(t,"!important")&&10))){case 107:return yi(t,":",":"+_i)+t;case 101:return yi(t,/(.+:)([^;!]+)(;|!.+)?/,"$1"+_i+(Do(t,14)===45?"inline-":"")+"box$3$1"+_i+"$2$3$1"+Yo+"$2box$3")+t}break;case 5936:switch(Do(t,e+11)){case 114:return _i+t+Yo+yi(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return _i+t+Yo+yi(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return _i+t+Yo+yi(t,/[svh]\w+-[tblr]{2}/,"lr")+t}return _i+t+Yo+t+t}return t}var Wge=function(e,r,o,c){if(e.length>-1&&!e.return)switch(e.type){case QL:e.return=kH(e.value,e.length);break;case AH:return ly([Bv(e,{value:yi(e.value,"@","@"+_i)})],c);case YL:if(e.length)return Pge(e.props,function(f){switch(Cge(f,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return ly([Bv(e,{props:[yi(f,/:(read-\w+)/,":"+LS+"$1")]})],c);case"::placeholder":return ly([Bv(e,{props:[yi(f,/:(plac\w+)/,":"+_i+"input-$1")]}),Bv(e,{props:[yi(f,/:(plac\w+)/,":"+LS+"$1")]}),Bv(e,{props:[yi(f,/:(plac\w+)/,Yo+"input-$1")]})],c)}return""})}},Hge=[Wge],Zge=function(e){var r=e.key;if(r==="css"){var o=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(o,function(ne){var se=ne.getAttribute("data-emotion");se.indexOf(" ")!==-1&&(document.head.appendChild(ne),ne.setAttribute("data-s",""))})}var c=e.stylisPlugins||Hge,f={},_,x=[];_=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+r+' "]'),function(ne){for(var se=ne.getAttribute("data-emotion").split(" "),W=1;W<se.length;W++)f[se[W]]=!0;x.push(ne)});var a,I=[Gge,qge];{var D,O=[Fge,jge(function(ne){D.insert(ne)})],F=Bge(I.concat(c,O)),Z=function(se){return ly(zge(se),F)};a=function(se,W,Q,K){D=Q,Z(se?se+"{"+W.styles+"}":W.styles),K&&(J.inserted[W.name]=!0)}}var J={key:r,sheet:new wge({key:r,container:_,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:f,registered:{},insert:a};return J.sheet.hydrate(x),J},Xge=!0;function Kge(t,e,r){var o="";return r.split(" ").forEach(function(c){t[c]!==void 0?e.push(t[c]+";"):o+=c+" "}),o}var DH=function(e,r,o){var c=e.key+"-"+r.name;(o===!1||Xge===!1)&&e.registered[c]===void 0&&(e.registered[c]=r.styles)},OH=function(e,r,o){DH(e,r,o);var c=e.key+"-"+r.name;if(e.inserted[r.name]===void 0){var f=r;do e.insert(r===f?"."+c:"",f,e.sheet,!0),f=f.next;while(f!==void 0)}};function Yge(t){for(var e=0,r,o=0,c=t.length;c>=4;++o,c-=4)r=t.charCodeAt(o)&255|(t.charCodeAt(++o)&255)<<8|(t.charCodeAt(++o)&255)<<16|(t.charCodeAt(++o)&255)<<24,r=(r&65535)*1540483477+((r>>>16)*59797<<16),r^=r>>>24,e=(r&65535)*1540483477+((r>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(c){case 3:e^=(t.charCodeAt(o+2)&255)<<16;case 2:e^=(t.charCodeAt(o+1)&255)<<8;case 1:e^=t.charCodeAt(o)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var Qge={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Jge=!1,e_e=/[A-Z]|^ms/g,t_e=/_EMO_([^_]+?)_([^]*?)_EMO_/g,LH=function(e){return e.charCodeAt(1)===45},WV=function(e){return e!=null&&typeof e!="boolean"},mM=SH(function(t){return LH(t)?t:t.replace(e_e,"-$&").toLowerCase()}),HV=function(e,r){switch(e){case"animation":case"animationName":if(typeof r=="string")return r.replace(t_e,function(o,c,f){return Iu={name:c,styles:f,next:Iu},c})}return Qge[e]!==1&&!LH(e)&&typeof r=="number"&&r!==0?r+"px":r},n_e="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function I1(t,e,r){if(r==null)return"";var o=r;if(o.__emotion_styles!==void 0)return o;switch(typeof r){case"boolean":return"";case"object":{var c=r;if(c.anim===1)return Iu={name:c.name,styles:c.styles,next:Iu},c.name;var f=r;if(f.styles!==void 0){var _=f.next;if(_!==void 0)for(;_!==void 0;)Iu={name:_.name,styles:_.styles,next:Iu},_=_.next;var x=f.styles+";";return x}return r_e(t,e,r)}case"function":{if(t!==void 0){var a=Iu,I=r(t);return Iu=a,I1(t,e,I)}break}}var D=r;if(e==null)return D;var O=e[D];return O!==void 0?O:D}function r_e(t,e,r){var o="";if(Array.isArray(r))for(var c=0;c<r.length;c++)o+=I1(t,e,r[c])+";";else for(var f in r){var _=r[f];if(typeof _!="object"){var x=_;e!=null&&e[x]!==void 0?o+=f+"{"+e[x]+"}":WV(x)&&(o+=mM(f)+":"+HV(f,x)+";")}else{if(f==="NO_COMPONENT_SELECTOR"&&Jge)throw new Error(n_e);if(Array.isArray(_)&&typeof _[0]=="string"&&(e==null||e[_[0]]===void 0))for(var a=0;a<_.length;a++)WV(_[a])&&(o+=mM(f)+":"+HV(f,_[a])+";");else{var I=I1(t,e,_);switch(f){case"animation":case"animationName":{o+=mM(f)+":"+I+";";break}default:o+=f+"{"+I+"}"}}}}return o}var ZV=/label:\s*([^\s;\n{]+)\s*(;|$)/g,Iu;function e4(t,e,r){if(t.length===1&&typeof t[0]=="object"&&t[0]!==null&&t[0].styles!==void 0)return t[0];var o=!0,c="";Iu=void 0;var f=t[0];if(f==null||f.raw===void 0)o=!1,c+=I1(r,e,f);else{var _=f;c+=_[0]}for(var x=1;x<t.length;x++)if(c+=I1(r,e,t[x]),o){var a=f;c+=a[x]}ZV.lastIndex=0;for(var I="",D;(D=ZV.exec(c))!==null;)I+="-"+D[1];var O=Yge(c)+I;return{name:O,styles:c,next:Iu}}var i_e=function(e){return e()},zH=BE.useInsertionEffect?BE.useInsertionEffect:!1,s_e=zH||i_e,XV=zH||ee.useLayoutEffect,NH=ee.createContext(typeof HTMLElement<"u"?Zge({key:"css"}):null);NH.Provider;var FH=function(e){return ee.forwardRef(function(r,o){var c=ee.useContext(NH);return e(r,c,o)})},t4=ee.createContext({}),o_e=FH(function(t,e){var r=t.styles,o=e4([r],void 0,ee.useContext(t4)),c=ee.useRef();return XV(function(){var f=e.key+"-global",_=new e.sheet.constructor({key:f,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),x=!1,a=document.querySelector('style[data-emotion="'+f+" "+o.name+'"]');return e.sheet.tags.length&&(_.before=e.sheet.tags[0]),a!==null&&(x=!0,a.setAttribute("data-emotion",f),_.hydrate([a])),c.current=[_,x],function(){_.flush()}},[e]),XV(function(){var f=c.current,_=f[0],x=f[1];if(x){f[1]=!1;return}if(o.next!==void 0&&OH(e,o.next,!0),_.tags.length){var a=_.tags[_.tags.length-1].nextElementSibling;_.before=a,_.flush()}e.insert("",o,_,!1)},[e,o.name]),null});function a_e(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e4(e)}var n4=function(){var e=a_e.apply(void 0,arguments),r="animation-"+e.name;return{name:r,styles:"@keyframes "+r+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},l_e=yge,c_e=function(e){return e!=="theme"},KV=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?l_e:c_e},YV=function(e,r,o){var c;if(r){var f=r.shouldForwardProp;c=e.__emotion_forwardProp&&f?function(_){return e.__emotion_forwardProp(_)&&f(_)}:f}return typeof c!="function"&&o&&(c=e.__emotion_forwardProp),c},u_e=!1,h_e=function(e){var r=e.cache,o=e.serialized,c=e.isStringTag;return DH(r,o,c),s_e(function(){return OH(r,o,c)}),null},d_e=function t(e,r){var o=e.__emotion_real===e,c=o&&e.__emotion_base||e,f,_;r!==void 0&&(f=r.label,_=r.target);var x=YV(e,r,o),a=x||KV(c),I=!a("as");return function(){var D=arguments,O=o&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(f!==void 0&&O.push("label:"+f+";"),D[0]==null||D[0].raw===void 0)O.push.apply(O,D);else{O.push(D[0][0]);for(var F=D.length,Z=1;Z<F;Z++)O.push(D[Z],D[0][Z])}var J=FH(function(ne,se,W){var Q=I&&ne.as||c,K="",pe=[],Te=ne;if(ne.theme==null){Te={};for(var we in ne)Te[we]=ne[we];Te.theme=ee.useContext(t4)}typeof ne.className=="string"?K=Kge(se.registered,pe,ne.className):ne.className!=null&&(K=ne.className+" ");var oe=e4(O.concat(pe),se.registered,Te);K+=se.key+"-"+oe.name,_!==void 0&&(K+=" "+_);var de=I&&x===void 0?KV(Q):a,X={};for(var ge in ne)I&&ge==="as"||de(ge)&&(X[ge]=ne[ge]);return X.className=K,W&&(X.ref=W),ee.createElement(ee.Fragment,null,ee.createElement(h_e,{cache:se,serialized:oe,isStringTag:typeof Q=="string"}),ee.createElement(Q,X))});return J.displayName=f!==void 0?f:"Styled("+(typeof c=="string"?c:c.displayName||c.name||"Component")+")",J.defaultProps=e.defaultProps,J.__emotion_real=J,J.__emotion_base=c,J.__emotion_styles=O,J.__emotion_forwardProp=x,Object.defineProperty(J,"toString",{value:function(){return _===void 0&&u_e?"NO_COMPONENT_SELECTOR":"."+_}}),J.withComponent=function(ne,se){return t(ne,OS({},r,se,{shouldForwardProp:YV(J,se,!0)})).apply(void 0,O)},J}},f_e=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],I3=d_e.bind();f_e.forEach(function(t){I3[t]=I3(t)});var BH={exports:{}},p_e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",m_e=p_e,g_e=m_e;function jH(){}function UH(){}UH.resetWarningCache=jH;var __e=function(){function t(o,c,f,_,x,a){if(a!==g_e){var I=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw I.name="Invariant Violation",I}}t.isRequired=t;function e(){return t}var r={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:UH,resetWarningCache:jH};return r.PropTypes=r,r};BH.exports=__e();var y_e=BH.exports;const Kr=Wm(y_e);function v_e(t){return t==null||Object.keys(t).length===0}function x_e(t){const{styles:e,defaultTheme:r={}}=t,o=typeof e=="function"?c=>e(v_e(c)?r:c):e;return V.jsx(o_e,{styles:o})}/**
 * @mui/styled-engine v6.0.2
 *
 * @license MIT
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function b_e(t,e){return I3(t,e)}const w_e=(t,e)=>{Array.isArray(t.__emotion_styles)&&(t.__emotion_styles=e(t.__emotion_styles))};function Mu(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function VH(t){if(!Mu(t))return t;const e={};return Object.keys(t).forEach(r=>{e[r]=VH(t[r])}),e}function na(t,e,r={clone:!0}){const o=r.clone?{...t}:t;return Mu(t)&&Mu(e)&&Object.keys(e).forEach(c=>{Mu(e[c])&&Object.prototype.hasOwnProperty.call(t,c)&&Mu(t[c])?o[c]=na(t[c],e[c],r):r.clone?o[c]=Mu(e[c])?VH(e[c]):e[c]:o[c]=e[c]}),o}const T_e=t=>{const e=Object.keys(t).map(r=>({key:r,val:t[r]}))||[];return e.sort((r,o)=>r.val-o.val),e.reduce((r,o)=>({...r,[o.key]:o.val}),{})};function E_e(t){const{values:e={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:r="px",step:o=5,...c}=t,f=T_e(e),_=Object.keys(f);function x(F){return`@media (min-width:${typeof e[F]=="number"?e[F]:F}${r})`}function a(F){return`@media (max-width:${(typeof e[F]=="number"?e[F]:F)-o/100}${r})`}function I(F,Z){const J=_.indexOf(Z);return`@media (min-width:${typeof e[F]=="number"?e[F]:F}${r}) and (max-width:${(J!==-1&&typeof e[_[J]]=="number"?e[_[J]]:Z)-o/100}${r})`}function D(F){return _.indexOf(F)+1<_.length?I(F,_[_.indexOf(F)+1]):x(F)}function O(F){const Z=_.indexOf(F);return Z===0?x(_[1]):Z===_.length-1?a(_[Z]):I(F,_[_.indexOf(F)+1]).replace("@media","@media not all and")}return{keys:_,values:f,up:x,down:a,between:I,only:D,not:O,unit:r,...c}}function S_e(t,e){if(!t.containerQueries)return e;const r=Object.keys(e).filter(o=>o.startsWith("@container")).sort((o,c)=>{var _,x;const f=/min-width:\s*([0-9.]+)/;return+(((_=o.match(f))==null?void 0:_[1])||0)-+(((x=c.match(f))==null?void 0:x[1])||0)});return r.length?r.reduce((o,c)=>{const f=e[c];return delete o[c],o[c]=f,o},{...e}):e}function I_e(t,e){return e==="@"||e.startsWith("@")&&(t.some(r=>e.startsWith(`@${r}`))||!!e.match(/^@\d/))}function A_e(t,e){const r=e.match(/^@([^/]+)?\/?(.+)?$/);if(!r)return null;const[,o,c]=r,f=Number.isNaN(+o)?o||0:+o;return t.containerQueries(c).up(f)}function C_e(t){const e=(f,_)=>f.replace("@media",_?`@container ${_}`:"@container");function r(f,_){f.up=(...x)=>e(t.breakpoints.up(...x),_),f.down=(...x)=>e(t.breakpoints.down(...x),_),f.between=(...x)=>e(t.breakpoints.between(...x),_),f.only=(...x)=>e(t.breakpoints.only(...x),_),f.not=(...x)=>{const a=e(t.breakpoints.not(...x),_);return a.includes("not all and")?a.replace("not all and ","").replace("min-width:","width<").replace("max-width:","width>").replace("and","or"):a}}const o={},c=f=>(r(o,f),o);return r(c),{...t,containerQueries:c}}const P_e={borderRadius:4};function zx(t,e){return e?na(t,e,{clone:!1}):t}const xA={xs:0,sm:600,md:900,lg:1200,xl:1536},QV={keys:["xs","sm","md","lg","xl"],up:t=>`@media (min-width:${xA[t]}px)`},R_e={containerQueries:t=>({up:e=>{let r=typeof e=="number"?e:xA[e]||e;return typeof r=="number"&&(r=`${r}px`),t?`@container ${t} (min-width:${r})`:`@container (min-width:${r})`}})};function Qh(t,e,r){const o=t.theme||{};if(Array.isArray(e)){const f=o.breakpoints||QV;return e.reduce((_,x,a)=>(_[f.up(f.keys[a])]=r(e[a]),_),{})}if(typeof e=="object"){const f=o.breakpoints||QV;return Object.keys(e).reduce((_,x)=>{if(I_e(f.keys,x)){const a=A_e(o.containerQueries?o:R_e,x);a&&(_[a]=r(e[x],x))}else if(Object.keys(f.values||xA).includes(x)){const a=f.up(x);_[a]=r(e[x],x)}else{const a=x;_[a]=e[a]}return _},{})}return r(e)}function M_e(t={}){var r;return((r=t.keys)==null?void 0:r.reduce((o,c)=>{const f=t.up(c);return o[f]={},o},{}))||{}}function k_e(t,e){return t.reduce((r,o)=>{const c=r[o];return(!c||Object.keys(c).length===0)&&delete r[o],r},e)}function Qn(t){if(typeof t!="string")throw new Error(Yh(7));return t.charAt(0).toUpperCase()+t.slice(1)}function bA(t,e,r=!0){if(!e||typeof e!="string")return null;if(t&&t.vars&&r){const o=`vars.${e}`.split(".").reduce((c,f)=>c&&c[f]?c[f]:null,t);if(o!=null)return o}return e.split(".").reduce((o,c)=>o&&o[c]!=null?o[c]:null,t)}function zS(t,e,r,o=r){let c;return typeof t=="function"?c=t(r):Array.isArray(t)?c=t[r]||o:c=bA(t,r)||o,e&&(c=e(c,o,t)),c}function qs(t){const{prop:e,cssProperty:r=t.prop,themeKey:o,transform:c}=t,f=_=>{if(_[e]==null)return null;const x=_[e],a=_.theme,I=bA(a,o)||{};return Qh(_,x,O=>{let F=zS(I,c,O);return O===F&&typeof O=="string"&&(F=zS(I,c,`${e}${O==="default"?"":Qn(O)}`,O)),r===!1?F:{[r]:F}})};return f.propTypes={},f.filterProps=[e],f}function D_e(t){const e={};return r=>(e[r]===void 0&&(e[r]=t(r)),e[r])}const O_e={m:"margin",p:"padding"},L_e={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},JV={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},z_e=D_e(t=>{if(t.length>2)if(JV[t])t=JV[t];else return[t];const[e,r]=t.split(""),o=O_e[e],c=L_e[r]||"";return Array.isArray(c)?c.map(f=>o+f):[o+c]}),r4=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],i4=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...r4,...i4];function ub(t,e,r,o){const c=bA(t,e,!0)??r;return typeof c=="number"||typeof c=="string"?f=>typeof f=="string"?f:typeof c=="string"?`calc(${f} * ${c})`:c*f:Array.isArray(c)?f=>{if(typeof f=="string")return f;const _=Math.abs(f),x=c[_];return f>=0?x:typeof x=="number"?-x:`-${x}`}:typeof c=="function"?c:()=>{}}function s4(t){return ub(t,"spacing",8)}function hb(t,e){return typeof e=="string"||e==null?e:t(e)}function N_e(t,e){return r=>t.reduce((o,c)=>(o[c]=hb(e,r),o),{})}function F_e(t,e,r,o){if(!e.includes(r))return null;const c=z_e(r),f=N_e(c,o),_=t[r];return Qh(t,_,f)}function $H(t,e){const r=s4(t.theme);return Object.keys(t).map(o=>F_e(t,e,o,r)).reduce(zx,{})}function Os(t){return $H(t,r4)}Os.propTypes={};Os.filterProps=r4;function Ls(t){return $H(t,i4)}Ls.propTypes={};Ls.filterProps=i4;function GH(t=8,e=s4({spacing:t})){if(t.mui)return t;const r=(...o)=>(o.length===0?[1]:o).map(f=>{const _=e(f);return typeof _=="number"?`${_}px`:_}).join(" ");return r.mui=!0,r}function wA(...t){const e=t.reduce((o,c)=>(c.filterProps.forEach(f=>{o[f]=c}),o),{}),r=o=>Object.keys(o).reduce((c,f)=>e[f]?zx(c,e[f](o)):c,{});return r.propTypes={},r.filterProps=t.reduce((o,c)=>o.concat(c.filterProps),[]),r}function Vl(t){return typeof t!="number"?t:`${t}px solid`}function ec(t,e){return qs({prop:t,themeKey:"borders",transform:e})}const B_e=ec("border",Vl),j_e=ec("borderTop",Vl),U_e=ec("borderRight",Vl),V_e=ec("borderBottom",Vl),$_e=ec("borderLeft",Vl),G_e=ec("borderColor"),q_e=ec("borderTopColor"),W_e=ec("borderRightColor"),H_e=ec("borderBottomColor"),Z_e=ec("borderLeftColor"),X_e=ec("outline",Vl),K_e=ec("outlineColor"),TA=t=>{if(t.borderRadius!==void 0&&t.borderRadius!==null){const e=ub(t.theme,"shape.borderRadius",4),r=o=>({borderRadius:hb(e,o)});return Qh(t,t.borderRadius,r)}return null};TA.propTypes={};TA.filterProps=["borderRadius"];wA(B_e,j_e,U_e,V_e,$_e,G_e,q_e,W_e,H_e,Z_e,TA,X_e,K_e);const EA=t=>{if(t.gap!==void 0&&t.gap!==null){const e=ub(t.theme,"spacing",8),r=o=>({gap:hb(e,o)});return Qh(t,t.gap,r)}return null};EA.propTypes={};EA.filterProps=["gap"];const SA=t=>{if(t.columnGap!==void 0&&t.columnGap!==null){const e=ub(t.theme,"spacing",8),r=o=>({columnGap:hb(e,o)});return Qh(t,t.columnGap,r)}return null};SA.propTypes={};SA.filterProps=["columnGap"];const IA=t=>{if(t.rowGap!==void 0&&t.rowGap!==null){const e=ub(t.theme,"spacing",8),r=o=>({rowGap:hb(e,o)});return Qh(t,t.rowGap,r)}return null};IA.propTypes={};IA.filterProps=["rowGap"];const Y_e=qs({prop:"gridColumn"}),Q_e=qs({prop:"gridRow"}),J_e=qs({prop:"gridAutoFlow"}),eye=qs({prop:"gridAutoColumns"}),tye=qs({prop:"gridAutoRows"}),nye=qs({prop:"gridTemplateColumns"}),rye=qs({prop:"gridTemplateRows"}),iye=qs({prop:"gridTemplateAreas"}),sye=qs({prop:"gridArea"});wA(EA,SA,IA,Y_e,Q_e,J_e,eye,tye,nye,rye,iye,sye);function cy(t,e){return e==="grey"?e:t}const oye=qs({prop:"color",themeKey:"palette",transform:cy}),aye=qs({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:cy}),lye=qs({prop:"backgroundColor",themeKey:"palette",transform:cy});wA(oye,aye,lye);function ol(t){return t<=1&&t!==0?`${t*100}%`:t}const cye=qs({prop:"width",transform:ol}),o4=t=>{if(t.maxWidth!==void 0&&t.maxWidth!==null){const e=r=>{var c,f,_,x,a;const o=((_=(f=(c=t.theme)==null?void 0:c.breakpoints)==null?void 0:f.values)==null?void 0:_[r])||xA[r];return o?((a=(x=t.theme)==null?void 0:x.breakpoints)==null?void 0:a.unit)!=="px"?{maxWidth:`${o}${t.theme.breakpoints.unit}`}:{maxWidth:o}:{maxWidth:ol(r)}};return Qh(t,t.maxWidth,e)}return null};o4.filterProps=["maxWidth"];const uye=qs({prop:"minWidth",transform:ol}),hye=qs({prop:"height",transform:ol}),dye=qs({prop:"maxHeight",transform:ol}),fye=qs({prop:"minHeight",transform:ol});qs({prop:"size",cssProperty:"width",transform:ol});qs({prop:"size",cssProperty:"height",transform:ol});const pye=qs({prop:"boxSizing"});wA(cye,o4,uye,hye,dye,fye,pye);const db={border:{themeKey:"borders",transform:Vl},borderTop:{themeKey:"borders",transform:Vl},borderRight:{themeKey:"borders",transform:Vl},borderBottom:{themeKey:"borders",transform:Vl},borderLeft:{themeKey:"borders",transform:Vl},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:Vl},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:TA},color:{themeKey:"palette",transform:cy},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:cy},backgroundColor:{themeKey:"palette",transform:cy},p:{style:Ls},pt:{style:Ls},pr:{style:Ls},pb:{style:Ls},pl:{style:Ls},px:{style:Ls},py:{style:Ls},padding:{style:Ls},paddingTop:{style:Ls},paddingRight:{style:Ls},paddingBottom:{style:Ls},paddingLeft:{style:Ls},paddingX:{style:Ls},paddingY:{style:Ls},paddingInline:{style:Ls},paddingInlineStart:{style:Ls},paddingInlineEnd:{style:Ls},paddingBlock:{style:Ls},paddingBlockStart:{style:Ls},paddingBlockEnd:{style:Ls},m:{style:Os},mt:{style:Os},mr:{style:Os},mb:{style:Os},ml:{style:Os},mx:{style:Os},my:{style:Os},margin:{style:Os},marginTop:{style:Os},marginRight:{style:Os},marginBottom:{style:Os},marginLeft:{style:Os},marginX:{style:Os},marginY:{style:Os},marginInline:{style:Os},marginInlineStart:{style:Os},marginInlineEnd:{style:Os},marginBlock:{style:Os},marginBlockStart:{style:Os},marginBlockEnd:{style:Os},displayPrint:{cssProperty:!1,transform:t=>({"@media print":{display:t}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:EA},rowGap:{style:IA},columnGap:{style:SA},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:ol},maxWidth:{style:o4},minWidth:{transform:ol},height:{transform:ol},maxHeight:{transform:ol},minHeight:{transform:ol},boxSizing:{},font:{themeKey:"font"},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}};function mye(...t){const e=t.reduce((o,c)=>o.concat(Object.keys(c)),[]),r=new Set(e);return t.every(o=>r.size===Object.keys(o).length)}function gye(t,e){return typeof t=="function"?t(e):t}function _ye(){function t(r,o,c,f){const _={[r]:o,theme:c},x=f[r];if(!x)return{[r]:o};const{cssProperty:a=r,themeKey:I,transform:D,style:O}=x;if(o==null)return null;if(I==="typography"&&o==="inherit")return{[r]:o};const F=bA(c,I)||{};return O?O(_):Qh(_,o,J=>{let ne=zS(F,D,J);return J===ne&&typeof J=="string"&&(ne=zS(F,D,`${r}${J==="default"?"":Qn(J)}`,J)),a===!1?ne:{[a]:ne}})}function e(r){const{sx:o,theme:c={}}=r||{};if(!o)return null;const f=c.unstable_sxConfig??db;function _(x){let a=x;if(typeof x=="function")a=x(c);else if(typeof x!="object")return x;if(!a)return null;const I=M_e(c.breakpoints),D=Object.keys(I);let O=I;return Object.keys(a).forEach(F=>{const Z=gye(a[F],c);if(Z!=null)if(typeof Z=="object")if(f[F])O=zx(O,t(F,Z,c,f));else{const J=Qh({theme:c},Z,ne=>({[F]:ne}));mye(J,Z)?O[F]=e({sx:Z,theme:c}):O=zx(O,J)}else O=zx(O,t(F,Z,c,f))}),S_e(c,k_e(D,O))}return Array.isArray(o)?o.map(_):_(o)}return e}const fb=_ye();fb.filterProps=["sx"];function yye(t,e){var o;const r=this;if(r.vars){if(!((o=r.colorSchemes)!=null&&o[t])||typeof r.getColorSchemeSelector!="function")return{};let c=r.getColorSchemeSelector(t);return(c.includes("data-")||c.includes("."))&&(c=`*:where(${c.replace(/\s*&$/,"")}) &`),{[c]:e}}return r.palette.mode===t?e:{}}function a4(t={},...e){const{breakpoints:r={},palette:o={},spacing:c,shape:f={},..._}=t,x=E_e(r),a=GH(c);let I=na({breakpoints:x,direction:"ltr",components:{},palette:{mode:"light",...o},spacing:a,shape:{...P_e,...f}},_);return I=C_e(I),I.applyStyles=yye,I=e.reduce((D,O)=>na(D,O),I),I.unstable_sxConfig={...db,..._==null?void 0:_.unstable_sxConfig},I.unstable_sx=function(O){return fb({sx:O,theme:this})},I}function vye(t){return Object.keys(t).length===0}function xye(t=null){const e=ee.useContext(t4);return!e||vye(e)?t:e}const bye=a4();function l4(t=bye){return xye(t)}function wye({styles:t,themeId:e,defaultTheme:r={}}){const o=l4(r),c=typeof t=="function"?t(e&&o[e]||o):t;return V.jsx(x_e,{styles:c})}const Tye=t=>{var o;const e={systemProps:{},otherProps:{}},r=((o=t==null?void 0:t.theme)==null?void 0:o.unstable_sxConfig)??db;return Object.keys(t).forEach(c=>{r[c]?e.systemProps[c]=t[c]:e.otherProps[c]=t[c]}),e};function Eye(t){const{sx:e,...r}=t,{systemProps:o,otherProps:c}=Tye(r);let f;return Array.isArray(e)?f=[o,...e]:typeof e=="function"?f=(..._)=>{const x=e(..._);return Mu(x)?{...o,...x}:o}:f={...o,...e},{...c,sx:f}}const e6=t=>t,Sye=()=>{let t=e6;return{configure(e){t=e},generate(e){return t(e)},reset(){t=e6}}},Iye=Sye();function qH(t){var e,r,o="";if(typeof t=="string"||typeof t=="number")o+=t;else if(typeof t=="object")if(Array.isArray(t)){var c=t.length;for(e=0;e<c;e++)t[e]&&(r=qH(t[e]))&&(o&&(o+=" "),o+=r)}else for(r in t)t[r]&&(o&&(o+=" "),o+=r);return o}function Nr(){for(var t,e,r=0,o="",c=arguments.length;r<c;r++)(t=arguments[r])&&(e=qH(t))&&(o&&(o+=" "),o+=e);return o}const Aye={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function Mi(t,e,r="Mui"){const o=Aye[e];return o?`${r}-${o}`:`${Iye.generate(t)}-${e}`}function ki(t,e,r="Mui"){const o={};return e.forEach(c=>{o[c]=Mi(t,c,r)}),o}var Oi={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var c4=Symbol.for("react.element"),u4=Symbol.for("react.portal"),AA=Symbol.for("react.fragment"),CA=Symbol.for("react.strict_mode"),PA=Symbol.for("react.profiler"),RA=Symbol.for("react.provider"),MA=Symbol.for("react.context"),Cye=Symbol.for("react.server_context"),kA=Symbol.for("react.forward_ref"),DA=Symbol.for("react.suspense"),OA=Symbol.for("react.suspense_list"),LA=Symbol.for("react.memo"),zA=Symbol.for("react.lazy"),Pye=Symbol.for("react.offscreen"),WH;WH=Symbol.for("react.module.reference");function tc(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case c4:switch(t=t.type,t){case AA:case PA:case CA:case DA:case OA:return t;default:switch(t=t&&t.$$typeof,t){case Cye:case MA:case kA:case zA:case LA:case RA:return t;default:return e}}case u4:return e}}}Oi.ContextConsumer=MA;Oi.ContextProvider=RA;Oi.Element=c4;Oi.ForwardRef=kA;Oi.Fragment=AA;Oi.Lazy=zA;Oi.Memo=LA;Oi.Portal=u4;Oi.Profiler=PA;Oi.StrictMode=CA;Oi.Suspense=DA;Oi.SuspenseList=OA;Oi.isAsyncMode=function(){return!1};Oi.isConcurrentMode=function(){return!1};Oi.isContextConsumer=function(t){return tc(t)===MA};Oi.isContextProvider=function(t){return tc(t)===RA};Oi.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===c4};Oi.isForwardRef=function(t){return tc(t)===kA};Oi.isFragment=function(t){return tc(t)===AA};Oi.isLazy=function(t){return tc(t)===zA};Oi.isMemo=function(t){return tc(t)===LA};Oi.isPortal=function(t){return tc(t)===u4};Oi.isProfiler=function(t){return tc(t)===PA};Oi.isStrictMode=function(t){return tc(t)===CA};Oi.isSuspense=function(t){return tc(t)===DA};Oi.isSuspenseList=function(t){return tc(t)===OA};Oi.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===AA||t===PA||t===CA||t===DA||t===OA||t===Pye||typeof t=="object"&&t!==null&&(t.$$typeof===zA||t.$$typeof===LA||t.$$typeof===RA||t.$$typeof===MA||t.$$typeof===kA||t.$$typeof===WH||t.getModuleId!==void 0)};Oi.typeOf=tc;const Rye=a4();function gM(t){return t!=="ownerState"&&t!=="theme"&&t!=="sx"&&t!=="as"}function A3(t,e,r){return kye(e)?r:e[t]||e}const GT=Symbol("mui.processed_props");function qT(t,e,r){if(GT in t)return t[GT];const o={...t,theme:A3(e,t.theme,r)};return t[GT]=o,o[GT]=o,o}function Mye(t){return t?(e,r)=>r[t]:null}function CE(t,e){var o;const r=typeof t=="function"?t(e):t;if(Array.isArray(r))return r.flatMap(c=>CE(c,e));if(Array.isArray(r==null?void 0:r.variants)){const{variants:c,...f}=r;let _=f,x;e:for(let a=0;a<c.length;a+=1){const I=c[a];if(typeof I.props=="function"){if(x??(x={...e,...e.ownerState,ownerState:e.ownerState}),!I.props(x))continue}else for(const D in I.props)if(e[D]!==I.props[D]&&((o=e.ownerState)==null?void 0:o[D])!==I.props[D])continue e;Array.isArray(_)||(_=[_]),typeof I.style=="function"?(x??(x={...e,...e.ownerState,ownerState:e.ownerState}),_.push(I.style(x))):_.push(I.style)}return _}return r}function HH(t={}){const{themeId:e,defaultTheme:r=Rye,rootShouldForwardProp:o=gM,slotShouldForwardProp:c=gM}=t,f=x=>fb(qT(x,e,r));return f.__mui_systemSx=!0,(x,a={})=>{w_e(x,we=>we.filter(oe=>!(oe!=null&&oe.__mui_systemSx)));const{name:I,slot:D,skipVariantsResolver:O,skipSx:F,overridesResolver:Z=Mye(Oye(D)),...J}=a,ne=O!==void 0?O:D&&D!=="Root"&&D!=="root"||!1,se=F||!1;let W,Q=gM;D==="Root"||D==="root"?Q=o:D?Q=c:Dye(x)&&(Q=void 0);const K=b_e(x,{shouldForwardProp:Q,label:W,...J}),pe=we=>typeof we=="function"&&we.__emotion_real!==we||Mu(we)?oe=>CE(we,qT(oe,e,r)):we,Te=(we,...oe)=>{let de=pe(we);const X=oe?oe.map(pe):[];I&&Z&&X.push(ke=>{const Ee=A3(e,ke.theme,r);if(!Ee.components||!Ee.components[I]||!Ee.components[I].styleOverrides)return null;const Lt=Ee.components[I].styleOverrides,jt={},Qt=qT(ke,e,r);for(const Pt in Lt)jt[Pt]=CE(Lt[Pt],Qt);return Z(ke,jt)}),I&&!ne&&X.push(ke=>{var jt,Qt;const Ee=A3(e,ke.theme,r),Lt=(Qt=(jt=Ee==null?void 0:Ee.components)==null?void 0:jt[I])==null?void 0:Qt.variants;return Lt?CE({variants:Lt},qT(ke,e,r)):null}),se||X.push(f);const ge=X.length-oe.length;if(Array.isArray(we)&&ge>0){const ke=new Array(ge).fill("");de=[...we,...ke],de.raw=[...we.raw,...ke]}const be=K(de,...X);return x.muiName&&(be.muiName=x.muiName),be};return K.withConfig&&(Te.withConfig=K.withConfig),Te}}function kye(t){for(const e in t)return!1;return!0}function Dye(t){return typeof t=="string"&&t.charCodeAt(0)>96}function Oye(t){return t&&t.charAt(0).toLowerCase()+t.slice(1)}const Gc=HH();function A1(t,e){const r={...e};for(const o in t)if(Object.prototype.hasOwnProperty.call(t,o)){const c=o;if(c==="components"||c==="slots")r[c]={...t[c],...r[c]};else if(c==="componentsProps"||c==="slotProps"){const f=t[c],_=e[c];if(!_)r[c]=f||{};else if(!f)r[c]=_;else{r[c]={..._};for(const x in f)if(Object.prototype.hasOwnProperty.call(f,x)){const a=x;r[c][a]=A1(f[a],_[a])}}}else r[c]===void 0&&(r[c]=t[c])}return r}function Lye(t){const{theme:e,name:r,props:o}=t;return!e||!e.components||!e.components[r]||!e.components[r].defaultProps?o:A1(e.components[r].defaultProps,o)}function zye({props:t,name:e,defaultTheme:r,themeId:o}){let c=l4(r);return o&&(c=c[o]||c),Lye({theme:c,name:e,props:t})}const jm=typeof window<"u"?ee.useLayoutEffect:ee.useEffect;function Nye(t,e=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER){return Math.max(e,Math.min(t,r))}function h4(t,e=0,r=1){return Nye(t,e,r)}function Fye(t){t=t.slice(1);const e=new RegExp(`.{1,${t.length>=6?2:1}}`,"g");let r=t.match(e);return r&&r[0].length===1&&(r=r.map(o=>o+o)),r?`rgb${r.length===4?"a":""}(${r.map((o,c)=>c<3?parseInt(o,16):Math.round(parseInt(o,16)/255*1e3)/1e3).join(", ")})`:""}function Vf(t){if(t.type)return t;if(t.charAt(0)==="#")return Vf(Fye(t));const e=t.indexOf("("),r=t.substring(0,e);if(!["rgb","rgba","hsl","hsla","color"].includes(r))throw new Error(Yh(9,t));let o=t.substring(e+1,t.length-1),c;if(r==="color"){if(o=o.split(" "),c=o.shift(),o.length===4&&o[3].charAt(0)==="/"&&(o[3]=o[3].slice(1)),!["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].includes(c))throw new Error(Yh(10,c))}else o=o.split(",");return o=o.map(f=>parseFloat(f)),{type:r,values:o,colorSpace:c}}const Bye=t=>{const e=Vf(t);return e.values.slice(0,3).map((r,o)=>e.type.includes("hsl")&&o!==0?`${r}%`:r).join(" ")},ox=(t,e)=>{try{return Bye(t)}catch{return t}};function NA(t){const{type:e,colorSpace:r}=t;let{values:o}=t;return e.includes("rgb")?o=o.map((c,f)=>f<3?parseInt(c,10):c):e.includes("hsl")&&(o[1]=`${o[1]}%`,o[2]=`${o[2]}%`),e.includes("color")?o=`${r} ${o.join(" ")}`:o=`${o.join(", ")}`,`${e}(${o})`}function ZH(t){t=Vf(t);const{values:e}=t,r=e[0],o=e[1]/100,c=e[2]/100,f=o*Math.min(c,1-c),_=(I,D=(I+r/30)%12)=>c-f*Math.max(Math.min(D-3,9-D,1),-1);let x="rgb";const a=[Math.round(_(0)*255),Math.round(_(8)*255),Math.round(_(4)*255)];return t.type==="hsla"&&(x+="a",a.push(e[3])),NA({type:x,values:a})}function C3(t){t=Vf(t);let e=t.type==="hsl"||t.type==="hsla"?Vf(ZH(t)).values:t.values;return e=e.map(r=>(t.type!=="color"&&(r/=255),r<=.03928?r/12.92:((r+.055)/1.055)**2.4)),Number((.2126*e[0]+.7152*e[1]+.0722*e[2]).toFixed(3))}function jye(t,e){const r=C3(t),o=C3(e);return(Math.max(r,o)+.05)/(Math.min(r,o)+.05)}function Gl(t,e){return t=Vf(t),e=h4(e),(t.type==="rgb"||t.type==="hsl")&&(t.type+="a"),t.type==="color"?t.values[3]=`/${e}`:t.values[3]=e,NA(t)}function WT(t,e,r){try{return Gl(t,e)}catch{return t}}function d4(t,e){if(t=Vf(t),e=h4(e),t.type.includes("hsl"))t.values[2]*=1-e;else if(t.type.includes("rgb")||t.type.includes("color"))for(let r=0;r<3;r+=1)t.values[r]*=1-e;return NA(t)}function ji(t,e,r){try{return d4(t,e)}catch{return t}}function f4(t,e){if(t=Vf(t),e=h4(e),t.type.includes("hsl"))t.values[2]+=(100-t.values[2])*e;else if(t.type.includes("rgb"))for(let r=0;r<3;r+=1)t.values[r]+=(255-t.values[r])*e;else if(t.type.includes("color"))for(let r=0;r<3;r+=1)t.values[r]+=(1-t.values[r])*e;return NA(t)}function Ui(t,e,r){try{return f4(t,e)}catch{return t}}function Uye(t,e=.15){return C3(t)>.5?d4(t,e):f4(t,e)}function HT(t,e,r){try{return Uye(t,e)}catch{return t}}function P3(...t){return t.reduce((e,r)=>r==null?e:function(...c){e.apply(this,c),r.apply(this,c)},()=>{})}function XH(t,e=166){let r;function o(...c){const f=()=>{t.apply(this,c)};clearTimeout(r),r=setTimeout(f,e)}return o.clear=()=>{clearTimeout(r)},o}function _M(t,e){var r,o,c;return ee.isValidElement(t)&&e.indexOf(t.type.muiName??((c=(o=(r=t.type)==null?void 0:r._payload)==null?void 0:o.value)==null?void 0:c.muiName))!==-1}function gl(t){return t&&t.ownerDocument||document}function Um(t){return gl(t).defaultView||window}function R3(t,e){typeof t=="function"?t(e):t&&(t.current=e)}let t6=0;function Vye(t){const[e,r]=ee.useState(t),o=t||e;return ee.useEffect(()=>{e==null&&(t6+=1,r(`mui-${t6}`))},[e]),o}const n6=BE.useId;function p4(t){if(n6!==void 0){const e=n6();return t??e}return Vye(t)}function NS({controlled:t,default:e,name:r,state:o="value"}){const{current:c}=ee.useRef(t!==void 0),[f,_]=ee.useState(e),x=c?t:f,a=ee.useCallback(I=>{c||_(I)},[]);return[x,a]}function H_(t){const e=ee.useRef(t);return jm(()=>{e.current=t}),ee.useRef((...r)=>(0,e.current)(...r)).current}function jo(...t){return ee.useMemo(()=>t.every(e=>e==null)?null:e=>{t.forEach(r=>{R3(r,e)})},t)}const r6={};function KH(t,e){const r=ee.useRef(r6);return r.current===r6&&(r.current=t(e)),r}const $ye=[];function Gye(t){ee.useEffect(t,$ye)}class m4{constructor(){Iv(this,"currentId",null);Iv(this,"clear",()=>{this.currentId!==null&&(clearTimeout(this.currentId),this.currentId=null)});Iv(this,"disposeEffect",()=>this.clear)}static create(){return new m4}start(e,r){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,r()},e)}}function YH(){const t=KH(m4.create).current;return Gye(t.disposeEffect),t}function i6(t){try{return t.matches(":focus-visible")}catch{}return!1}function QH(t){const e=t.documentElement.clientWidth;return Math.abs(window.innerWidth-e)}const JH=t=>{const e=ee.useRef({});return ee.useEffect(()=>{e.current=t}),e.current};function Li(t,e,r=void 0){const o={};for(const c in t){const f=t[c];let _="",x=!0;for(let a=0;a<f.length;a+=1){const I=f[a];I&&(_+=(x===!0?"":" ")+e(I),x=!1,r&&r[I]&&(_+=" "+r[I]))}o[c]=_}return o}function qye(t){return typeof t=="string"}function eZ(t,e,r){return t===void 0||qye(t)?e:{...e,ownerState:{...e.ownerState,...r}}}function tZ(t,e=[]){if(t===void 0)return{};const r={};return Object.keys(t).filter(o=>o.match(/^on[A-Z]/)&&typeof t[o]=="function"&&!e.includes(o)).forEach(o=>{r[o]=t[o]}),r}function s6(t){if(t===void 0)return{};const e={};return Object.keys(t).filter(r=>!(r.match(/^on[A-Z]/)&&typeof t[r]=="function")).forEach(r=>{e[r]=t[r]}),e}function nZ(t){const{getSlotProps:e,additionalProps:r,externalSlotProps:o,externalForwardedProps:c,className:f}=t;if(!e){const Z=Nr(r==null?void 0:r.className,f,c==null?void 0:c.className,o==null?void 0:o.className),J={...r==null?void 0:r.style,...c==null?void 0:c.style,...o==null?void 0:o.style},ne={...r,...c,...o};return Z.length>0&&(ne.className=Z),Object.keys(J).length>0&&(ne.style=J),{props:ne,internalRef:void 0}}const _=tZ({...c,...o}),x=s6(o),a=s6(c),I=e(_),D=Nr(I==null?void 0:I.className,r==null?void 0:r.className,f,c==null?void 0:c.className,o==null?void 0:o.className),O={...I==null?void 0:I.style,...r==null?void 0:r.style,...c==null?void 0:c.style,...o==null?void 0:o.style},F={...I,...r,...a,...x};return D.length>0&&(F.className=D),Object.keys(O).length>0&&(F.style=O),{props:F,internalRef:I.ref}}function rZ(t,e,r){return typeof t=="function"?t(e,r):t}function FS(t){var O;const{elementType:e,externalSlotProps:r,ownerState:o,skipResolvingSlotProps:c=!1,...f}=t,_=c?{}:rZ(r,o),{props:x,internalRef:a}=nZ({...f,externalSlotProps:_}),I=jo(a,_==null?void 0:_.ref,(O=t.additionalProps)==null?void 0:O.ref);return eZ(e,{...x,ref:I},o)}function pb(t){return!t||!ee.isValidElement(t)?null:t.props.propertyIsEnumerable("ref")?t.props.ref:t.ref}const Wye=ee.createContext(),Hye=()=>ee.useContext(Wye)??!1,Zye=ee.createContext(void 0);function Xye(t){const{theme:e,name:r,props:o}=t;if(!e||!e.components||!e.components[r])return o;const c=e.components[r];return c.defaultProps?A1(c.defaultProps,o):!c.styleOverrides&&!c.variants?A1(c,o):o}function Kye({props:t,name:e}){const r=ee.useContext(Zye);return Xye({props:t,name:e,theme:{components:r}})}function Yye(t=""){function e(...o){if(!o.length)return"";const c=o[0];return typeof c=="string"&&!c.match(/(#|\(|\)|(-?(\d*\.)?\d+)(px|em|%|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc))|^(-?(\d*\.)?\d+)$|(\d+ \d+ \d+)/)?`, var(--${t?`${t}-`:""}${c}${e(...o.slice(1))})`:`, ${c}`}return(o,...c)=>`var(--${t?`${t}-`:""}${o}${e(...c)})`}const o6=(t,e,r,o=[])=>{let c=t;e.forEach((f,_)=>{_===e.length-1?Array.isArray(c)?c[Number(f)]=r:c&&typeof c=="object"&&(c[f]=r):c&&typeof c=="object"&&(c[f]||(c[f]=o.includes(f)?[]:{}),c=c[f])})},Qye=(t,e,r)=>{function o(c,f=[],_=[]){Object.entries(c).forEach(([x,a])=>{(!r||r&&!r([...f,x]))&&a!=null&&(typeof a=="object"&&Object.keys(a).length>0?o(a,[...f,x],Array.isArray(a)?[..._,x]:_):e([...f,x],a,_))})}o(t)},Jye=(t,e)=>typeof e=="number"?["lineHeight","fontWeight","opacity","zIndex"].some(o=>t.includes(o))||t[t.length-1].toLowerCase().indexOf("opacity")>=0?e:`${e}px`:e;function yM(t,e){const{prefix:r,shouldSkipGeneratingVar:o}=e||{},c={},f={},_={};return Qye(t,(x,a,I)=>{if((typeof a=="string"||typeof a=="number")&&(!o||!o(x,a))){const D=`--${r?`${r}-`:""}${x.join("-")}`,O=Jye(x,a);Object.assign(c,{[D]:O}),o6(f,x,`var(${D})`,I),o6(_,x,`var(${D}, ${O})`,I)}},x=>x[0]==="vars"),{css:c,vars:f,varsWithDefaults:_}}function e0e(t,e={}){const{getSelector:r=se,disableCssColorScheme:o,colorSchemeSelector:c}=e,{colorSchemes:f={},components:_,defaultColorScheme:x="light",...a}=t,{vars:I,css:D,varsWithDefaults:O}=yM(a,e);let F=O;const Z={},{[x]:J,...ne}=f;if(Object.entries(ne||{}).forEach(([K,pe])=>{const{vars:Te,css:we,varsWithDefaults:oe}=yM(pe,e);F=na(F,oe),Z[K]={css:we,vars:Te}}),J){const{css:K,vars:pe,varsWithDefaults:Te}=yM(J,e);F=na(F,Te),Z[x]={css:K,vars:pe}}function se(K,pe){var we,oe;let Te=c;if(c==="class"&&(Te=".%s"),c==="data"&&(Te="[data-%s]"),c!=null&&c.startsWith("data-")&&!c.includes("%s")&&(Te=`[${c}="%s"]`),K){if(Te==="media")return t.defaultColorScheme===K?":root":{[`@media (prefers-color-scheme: ${((oe=(we=f[K])==null?void 0:we.palette)==null?void 0:oe.mode)||K})`]:{":root":pe}};if(Te)return t.defaultColorScheme===K?`:root, ${Te.replace("%s",String(K))}`:Te.replace("%s",String(K))}return":root"}return{vars:F,generateThemeVars:()=>{let K={...I};return Object.entries(Z).forEach(([,{vars:pe}])=>{K=na(K,pe)}),K},generateStyleSheets:()=>{var de,X;const K=[],pe=t.defaultColorScheme||"light";function Te(ge,be){Object.keys(be).length&&K.push(typeof ge=="string"?{[ge]:{...be}}:ge)}Te(r(void 0,{...D}),D);const{[pe]:we,...oe}=Z;if(we){const{css:ge}=we,be=(X=(de=f[pe])==null?void 0:de.palette)==null?void 0:X.mode,ke=!o&&be?{colorScheme:be,...ge}:{...ge};Te(r(pe,{...ke}),ke)}return Object.entries(oe).forEach(([ge,{css:be}])=>{var Lt,jt;const ke=(jt=(Lt=f[ge])==null?void 0:Lt.palette)==null?void 0:jt.mode,Ee=!o&&ke?{colorScheme:ke,...be}:{...be};Te(r(ge,{...Ee}),Ee)}),K}}}function t0e(t){return function(r){return t==="media"?`@media (prefers-color-scheme: ${r})`:t?t.startsWith("data-")&&!t.includes("%s")?`[${t}="${r}"] &`:t==="class"?`.${r} &`:t==="data"?`[data-${r}] &`:`${t.replace("%s",r)} &`:"&"}}const a6={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:T1.white,default:T1.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},vM={text:{primary:T1.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:T1.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function l6(t,e,r,o){const c=o.light||o,f=o.dark||o*1.5;t[e]||(t.hasOwnProperty(r)?t[e]=t[r]:e==="light"?t.light=f4(t.main,c):e==="dark"&&(t.dark=d4(t.main,f)))}function n0e(t="light"){return t==="dark"?{main:b_[200],light:b_[50],dark:b_[400]}:{main:b_[700],light:b_[400],dark:b_[800]}}function r0e(t="light"){return t==="dark"?{main:x_[200],light:x_[50],dark:x_[400]}:{main:x_[500],light:x_[300],dark:x_[700]}}function i0e(t="light"){return t==="dark"?{main:v_[500],light:v_[300],dark:v_[700]}:{main:v_[700],light:v_[400],dark:v_[800]}}function s0e(t="light"){return t==="dark"?{main:w_[400],light:w_[300],dark:w_[700]}:{main:w_[700],light:w_[500],dark:w_[900]}}function o0e(t="light"){return t==="dark"?{main:T_[400],light:T_[300],dark:T_[700]}:{main:T_[800],light:T_[500],dark:T_[900]}}function a0e(t="light"){return t==="dark"?{main:Fv[400],light:Fv[300],dark:Fv[700]}:{main:"#ed6c02",light:Fv[500],dark:Fv[900]}}function g4(t){const{mode:e="light",contrastThreshold:r=3,tonalOffset:o=.2,...c}=t,f=t.primary||n0e(e),_=t.secondary||r0e(e),x=t.error||i0e(e),a=t.info||s0e(e),I=t.success||o0e(e),D=t.warning||a0e(e);function O(ne){return jye(ne,vM.text.primary)>=r?vM.text.primary:a6.text.primary}const F=({color:ne,name:se,mainShade:W=500,lightShade:Q=300,darkShade:K=700})=>{if(ne={...ne},!ne.main&&ne[W]&&(ne.main=ne[W]),!ne.hasOwnProperty("main"))throw new Error(Yh(11,se?` (${se})`:"",W));if(typeof ne.main!="string")throw new Error(Yh(12,se?` (${se})`:"",JSON.stringify(ne.main)));return l6(ne,"light",Q,o),l6(ne,"dark",K,o),ne.contrastText||(ne.contrastText=O(ne.main)),ne},Z={dark:vM,light:a6};return na({common:{...T1},mode:e,primary:F({color:f,name:"primary"}),secondary:F({color:_,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:F({color:x,name:"error"}),warning:F({color:D,name:"warning"}),info:F({color:a,name:"info"}),success:F({color:I,name:"success"}),grey:gge,contrastThreshold:r,getContrastText:O,augmentColor:F,tonalOffset:o,...Z[e]},c)}function l0e(t){const e={};return Object.entries(t).forEach(o=>{const[c,f]=o;typeof f=="object"&&(e[c]=`${f.fontStyle?`${f.fontStyle} `:""}${f.fontVariant?`${f.fontVariant} `:""}${f.fontWeight?`${f.fontWeight} `:""}${f.fontStretch?`${f.fontStretch} `:""}${f.fontSize||""}${f.lineHeight?`/${f.lineHeight} `:""}${f.fontFamily||""}`)}),e}function c0e(t,e){return{toolbar:{minHeight:56,[t.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[t.up("sm")]:{minHeight:64}},...e}}function u0e(t){return Math.round(t*1e5)/1e5}const c6={textTransform:"uppercase"},u6='"Roboto", "Helvetica", "Arial", sans-serif';function h0e(t,e){const{fontFamily:r=u6,fontSize:o=14,fontWeightLight:c=300,fontWeightRegular:f=400,fontWeightMedium:_=500,fontWeightBold:x=700,htmlFontSize:a=16,allVariants:I,pxToRem:D,...O}=typeof e=="function"?e(t):e,F=o/14,Z=D||(se=>`${se/a*F}rem`),J=(se,W,Q,K,pe)=>({fontFamily:r,fontWeight:se,fontSize:Z(W),lineHeight:Q,...r===u6?{letterSpacing:`${u0e(K/W)}em`}:{},...pe,...I}),ne={h1:J(c,96,1.167,-1.5),h2:J(c,60,1.2,-.5),h3:J(f,48,1.167,0),h4:J(f,34,1.235,.25),h5:J(f,24,1.334,0),h6:J(_,20,1.6,.15),subtitle1:J(f,16,1.75,.15),subtitle2:J(_,14,1.57,.1),body1:J(f,16,1.5,.15),body2:J(f,14,1.43,.15),button:J(_,14,1.75,.4,c6),caption:J(f,12,1.66,.4),overline:J(f,12,2.66,1,c6),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return na({htmlFontSize:a,pxToRem:Z,fontFamily:r,fontSize:o,fontWeightLight:c,fontWeightRegular:f,fontWeightMedium:_,fontWeightBold:x,...ne},O,{clone:!1})}const d0e=.2,f0e=.14,p0e=.12;function ms(...t){return[`${t[0]}px ${t[1]}px ${t[2]}px ${t[3]}px rgba(0,0,0,${d0e})`,`${t[4]}px ${t[5]}px ${t[6]}px ${t[7]}px rgba(0,0,0,${f0e})`,`${t[8]}px ${t[9]}px ${t[10]}px ${t[11]}px rgba(0,0,0,${p0e})`].join(",")}const m0e=["none",ms(0,2,1,-1,0,1,1,0,0,1,3,0),ms(0,3,1,-2,0,2,2,0,0,1,5,0),ms(0,3,3,-2,0,3,4,0,0,1,8,0),ms(0,2,4,-1,0,4,5,0,0,1,10,0),ms(0,3,5,-1,0,5,8,0,0,1,14,0),ms(0,3,5,-1,0,6,10,0,0,1,18,0),ms(0,4,5,-2,0,7,10,1,0,2,16,1),ms(0,5,5,-3,0,8,10,1,0,3,14,2),ms(0,5,6,-3,0,9,12,1,0,3,16,2),ms(0,6,6,-3,0,10,14,1,0,4,18,3),ms(0,6,7,-4,0,11,15,1,0,4,20,3),ms(0,7,8,-4,0,12,17,2,0,5,22,4),ms(0,7,8,-4,0,13,19,2,0,5,24,4),ms(0,7,9,-4,0,14,21,2,0,5,26,4),ms(0,8,9,-5,0,15,22,2,0,6,28,5),ms(0,8,10,-5,0,16,24,2,0,6,30,5),ms(0,8,11,-5,0,17,26,2,0,6,32,5),ms(0,9,11,-5,0,18,28,2,0,7,34,6),ms(0,9,12,-6,0,19,29,2,0,7,36,6),ms(0,10,13,-6,0,20,31,3,0,8,38,7),ms(0,10,13,-6,0,21,33,3,0,8,40,7),ms(0,10,14,-6,0,22,35,3,0,8,42,7),ms(0,11,14,-7,0,23,36,3,0,9,44,8),ms(0,11,15,-7,0,24,38,3,0,9,46,8)],g0e={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},_0e={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function h6(t){return`${Math.round(t)}ms`}function y0e(t){if(!t)return 0;const e=t/36;return Math.min(Math.round((4+15*e**.25+e/5)*10),3e3)}function v0e(t){const e={...g0e,...t.easing},r={..._0e,...t.duration};return{getAutoHeightDuration:y0e,create:(c=["all"],f={})=>{const{duration:_=r.standard,easing:x=e.easeInOut,delay:a=0,...I}=f;return(Array.isArray(c)?c:[c]).map(D=>`${D} ${typeof _=="string"?_:h6(_)} ${x} ${typeof a=="string"?a:h6(a)}`).join(",")},...t,easing:e,duration:r}}const x0e={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};function M3(t={},...e){const{breakpoints:r,mixins:o={},spacing:c,palette:f={},transitions:_={},typography:x={},shape:a,...I}=t;if(t.vars)throw new Error(Yh(20));const D=g4(f),O=a4(t);let F=na(O,{mixins:c0e(O.breakpoints,o),palette:D,shadows:m0e.slice(),typography:h0e(D,x),transitions:v0e(_),zIndex:{...x0e}});return F=na(F,I),F=e.reduce((Z,J)=>na(Z,J),F),F.unstable_sxConfig={...db,...I==null?void 0:I.unstable_sxConfig},F.unstable_sx=function(J){return fb({sx:J,theme:this})},F}function k3(t){let e;return t<1?e=5.11916*t**2:e=4.5*Math.log(t+1)+2,Math.round(e*10)/1e3}const b0e=[...Array(25)].map((t,e)=>{if(e===0)return;const r=k3(e);return`linear-gradient(rgba(255 255 255 / ${r}), rgba(255 255 255 / ${r}))`});function iZ(t){return{inputPlaceholder:t==="dark"?.5:.42,inputUnderline:t==="dark"?.7:.42,switchTrackDisabled:t==="dark"?.2:.12,switchTrack:t==="dark"?.3:.38}}function sZ(t){return t==="dark"?b0e:[]}function w0e(t){const{palette:e={mode:"light"},opacity:r,overlays:o,...c}=t,f=g4(e);return{palette:f,opacity:{...iZ(f.mode),...r},overlays:o||sZ(f.mode),...c}}function T0e(t){var e;return!!t[0].match(/(cssVarPrefix|colorSchemeSelector|typography|mixins|breakpoints|direction|transitions)/)||!!t[0].match(/sxConfig$/)||t[0]==="palette"&&!!((e=t[1])!=null&&e.match(/(mode|contrastThreshold|tonalOffset)/))}const E0e=t=>[...[...Array(24)].map((e,r)=>`--${t?`${t}-`:""}overlays-${r+1}`),`--${t?`${t}-`:""}palette-AppBar-darkBg`,`--${t?`${t}-`:""}palette-AppBar-darkColor`],S0e=t=>(e,r)=>{const o=t.colorSchemeSelector;let c=o;if(o==="class"&&(c=".%s"),o==="data"&&(c="[data-%s]"),o!=null&&o.startsWith("data-")&&!o.includes("%s")&&(c=`[${o}="%s"]`),t.defaultColorScheme===e){if(e==="dark"){const f={};return E0e(t.cssVarPrefix).forEach(_=>{f[_]=r[_],delete r[_]}),c==="media"?{":root":r,"@media (prefers-color-scheme: dark)":{":root":f}}:c?{[c.replace("%s",e)]:f,[`:root, ${c.replace("%s",e)}`]:r}:{":root":{...r,...f}}}if(c&&c!=="media")return`:root, ${c.replace("%s",String(e))}`}else if(e){if(c==="media")return{[`@media (prefers-color-scheme: ${String(e)})`]:{":root":r}};if(c)return c.replace("%s",String(e))}return":root"};function I0e(t){return Mu(t)||typeof t>"u"||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||Array.isArray(t)}function A0e(t={}){const e={...t};function r(o){const c=Object.entries(o);for(let f=0;f<c.length;f++){const[_,x]=c[f];!I0e(x)||_.startsWith("unstable_")?delete o[_]:Mu(x)&&(o[_]={...x},r(o[_]))}}return r(e),`import { unstable_createBreakpoints as createBreakpoints, createTransitions } from '@mui/material/styles';

const theme = ${JSON.stringify(e,null,2)};

theme.breakpoints = createBreakpoints(theme.breakpoints || {});
theme.transitions = createTransitions(theme.transitions || {});

export default theme;`}function C0e(t,e){e.forEach(r=>{t[r]||(t[r]={})})}function Ft(t,e,r){!t[e]&&r&&(t[e]=r)}function ax(t){return!t||!t.startsWith("hsl")?t:ZH(t)}function Sh(t,e){`${e}Channel`in t||(t[`${e}Channel`]=ox(ax(t[e]),`MUI: Can't create \`palette.${e}Channel\` because \`palette.${e}\` is not one of these formats: #nnn, #nnnnnn, rgb(), rgba(), hsl(), hsla(), color().
To suppress this warning, you need to explicitly provide the \`palette.${e}Channel\` as a string (in rgb format, for example "12 12 12") or undefined if you want to remove the channel token.`))}function P0e(t){return typeof t=="number"?`${t}px`:typeof t=="string"||typeof t=="function"||Array.isArray(t)?t:"8px"}const vu=t=>{try{return t()}catch{}},R0e=(t="mui")=>Yye(t);function xM(t,e,r,o){if(!e)return;e=e===!0?{}:e;const c=o==="dark"?"dark":"light";if(!r){t[o]=w0e({...e,palette:{mode:c,...e==null?void 0:e.palette}});return}const{palette:f,..._}=M3({...r,palette:{mode:c,...e==null?void 0:e.palette}});return t[o]={...e,palette:f,opacity:{...iZ(c),...e==null?void 0:e.opacity},overlays:(e==null?void 0:e.overlays)||sZ(c)},_}function M0e(t={},...e){const{colorSchemes:r={light:!0},defaultColorScheme:o,disableCssColorScheme:c=!1,cssVarPrefix:f="mui",shouldSkipGeneratingVar:_=T0e,colorSchemeSelector:x=r.light&&r.dark?"media":void 0,...a}=t,I=Object.keys(r)[0],D=o||(r.light&&I!=="light"?"light":I),O=R0e(f),{[D]:F,light:Z,dark:J,...ne}=r,se={...ne};let W=F;if((D==="dark"&&!("dark"in r)||D==="light"&&!("light"in r))&&(W=!0),!W)throw new Error(Yh(21,D));const Q=xM(se,W,a,D);Z&&!se.light&&xM(se,Z,void 0,"light"),J&&!se.dark&&xM(se,J,void 0,"dark");let K={defaultColorScheme:D,...Q,cssVarPrefix:f,colorSchemeSelector:x,getCssVar:O,colorSchemes:se,font:{...l0e(Q.typography),...Q.font},spacing:P0e(a.spacing)};Object.keys(K.colorSchemes).forEach(de=>{const X=K.colorSchemes[de].palette,ge=be=>{const ke=be.split("-"),Ee=ke[1],Lt=ke[2];return O(be,X[Ee][Lt])};if(X.mode==="light"&&(Ft(X.common,"background","#fff"),Ft(X.common,"onBackground","#000")),X.mode==="dark"&&(Ft(X.common,"background","#000"),Ft(X.common,"onBackground","#fff")),C0e(X,["Alert","AppBar","Avatar","Button","Chip","FilledInput","LinearProgress","Skeleton","Slider","SnackbarContent","SpeedDialAction","StepConnector","StepContent","Switch","TableCell","Tooltip"]),X.mode==="light"){Ft(X.Alert,"errorColor",ji(X.error.light,.6)),Ft(X.Alert,"infoColor",ji(X.info.light,.6)),Ft(X.Alert,"successColor",ji(X.success.light,.6)),Ft(X.Alert,"warningColor",ji(X.warning.light,.6)),Ft(X.Alert,"errorFilledBg",ge("palette-error-main")),Ft(X.Alert,"infoFilledBg",ge("palette-info-main")),Ft(X.Alert,"successFilledBg",ge("palette-success-main")),Ft(X.Alert,"warningFilledBg",ge("palette-warning-main")),Ft(X.Alert,"errorFilledColor",vu(()=>X.getContrastText(X.error.main))),Ft(X.Alert,"infoFilledColor",vu(()=>X.getContrastText(X.info.main))),Ft(X.Alert,"successFilledColor",vu(()=>X.getContrastText(X.success.main))),Ft(X.Alert,"warningFilledColor",vu(()=>X.getContrastText(X.warning.main))),Ft(X.Alert,"errorStandardBg",Ui(X.error.light,.9)),Ft(X.Alert,"infoStandardBg",Ui(X.info.light,.9)),Ft(X.Alert,"successStandardBg",Ui(X.success.light,.9)),Ft(X.Alert,"warningStandardBg",Ui(X.warning.light,.9)),Ft(X.Alert,"errorIconColor",ge("palette-error-main")),Ft(X.Alert,"infoIconColor",ge("palette-info-main")),Ft(X.Alert,"successIconColor",ge("palette-success-main")),Ft(X.Alert,"warningIconColor",ge("palette-warning-main")),Ft(X.AppBar,"defaultBg",ge("palette-grey-100")),Ft(X.Avatar,"defaultBg",ge("palette-grey-400")),Ft(X.Button,"inheritContainedBg",ge("palette-grey-300")),Ft(X.Button,"inheritContainedHoverBg",ge("palette-grey-A100")),Ft(X.Chip,"defaultBorder",ge("palette-grey-400")),Ft(X.Chip,"defaultAvatarColor",ge("palette-grey-700")),Ft(X.Chip,"defaultIconColor",ge("palette-grey-700")),Ft(X.FilledInput,"bg","rgba(0, 0, 0, 0.06)"),Ft(X.FilledInput,"hoverBg","rgba(0, 0, 0, 0.09)"),Ft(X.FilledInput,"disabledBg","rgba(0, 0, 0, 0.12)"),Ft(X.LinearProgress,"primaryBg",Ui(X.primary.main,.62)),Ft(X.LinearProgress,"secondaryBg",Ui(X.secondary.main,.62)),Ft(X.LinearProgress,"errorBg",Ui(X.error.main,.62)),Ft(X.LinearProgress,"infoBg",Ui(X.info.main,.62)),Ft(X.LinearProgress,"successBg",Ui(X.success.main,.62)),Ft(X.LinearProgress,"warningBg",Ui(X.warning.main,.62)),Ft(X.Skeleton,"bg",`rgba(${ge("palette-text-primaryChannel")} / 0.11)`),Ft(X.Slider,"primaryTrack",Ui(X.primary.main,.62)),Ft(X.Slider,"secondaryTrack",Ui(X.secondary.main,.62)),Ft(X.Slider,"errorTrack",Ui(X.error.main,.62)),Ft(X.Slider,"infoTrack",Ui(X.info.main,.62)),Ft(X.Slider,"successTrack",Ui(X.success.main,.62)),Ft(X.Slider,"warningTrack",Ui(X.warning.main,.62));const be=HT(X.background.default,.8);Ft(X.SnackbarContent,"bg",be),Ft(X.SnackbarContent,"color",vu(()=>X.getContrastText(be))),Ft(X.SpeedDialAction,"fabHoverBg",HT(X.background.paper,.15)),Ft(X.StepConnector,"border",ge("palette-grey-400")),Ft(X.StepContent,"border",ge("palette-grey-400")),Ft(X.Switch,"defaultColor",ge("palette-common-white")),Ft(X.Switch,"defaultDisabledColor",ge("palette-grey-100")),Ft(X.Switch,"primaryDisabledColor",Ui(X.primary.main,.62)),Ft(X.Switch,"secondaryDisabledColor",Ui(X.secondary.main,.62)),Ft(X.Switch,"errorDisabledColor",Ui(X.error.main,.62)),Ft(X.Switch,"infoDisabledColor",Ui(X.info.main,.62)),Ft(X.Switch,"successDisabledColor",Ui(X.success.main,.62)),Ft(X.Switch,"warningDisabledColor",Ui(X.warning.main,.62)),Ft(X.TableCell,"border",Ui(WT(X.divider,1),.88)),Ft(X.Tooltip,"bg",WT(X.grey[700],.92))}if(X.mode==="dark"){Ft(X.Alert,"errorColor",Ui(X.error.light,.6)),Ft(X.Alert,"infoColor",Ui(X.info.light,.6)),Ft(X.Alert,"successColor",Ui(X.success.light,.6)),Ft(X.Alert,"warningColor",Ui(X.warning.light,.6)),Ft(X.Alert,"errorFilledBg",ge("palette-error-dark")),Ft(X.Alert,"infoFilledBg",ge("palette-info-dark")),Ft(X.Alert,"successFilledBg",ge("palette-success-dark")),Ft(X.Alert,"warningFilledBg",ge("palette-warning-dark")),Ft(X.Alert,"errorFilledColor",vu(()=>X.getContrastText(X.error.dark))),Ft(X.Alert,"infoFilledColor",vu(()=>X.getContrastText(X.info.dark))),Ft(X.Alert,"successFilledColor",vu(()=>X.getContrastText(X.success.dark))),Ft(X.Alert,"warningFilledColor",vu(()=>X.getContrastText(X.warning.dark))),Ft(X.Alert,"errorStandardBg",ji(X.error.light,.9)),Ft(X.Alert,"infoStandardBg",ji(X.info.light,.9)),Ft(X.Alert,"successStandardBg",ji(X.success.light,.9)),Ft(X.Alert,"warningStandardBg",ji(X.warning.light,.9)),Ft(X.Alert,"errorIconColor",ge("palette-error-main")),Ft(X.Alert,"infoIconColor",ge("palette-info-main")),Ft(X.Alert,"successIconColor",ge("palette-success-main")),Ft(X.Alert,"warningIconColor",ge("palette-warning-main")),Ft(X.AppBar,"defaultBg",ge("palette-grey-900")),Ft(X.AppBar,"darkBg",ge("palette-background-paper")),Ft(X.AppBar,"darkColor",ge("palette-text-primary")),Ft(X.Avatar,"defaultBg",ge("palette-grey-600")),Ft(X.Button,"inheritContainedBg",ge("palette-grey-800")),Ft(X.Button,"inheritContainedHoverBg",ge("palette-grey-700")),Ft(X.Chip,"defaultBorder",ge("palette-grey-700")),Ft(X.Chip,"defaultAvatarColor",ge("palette-grey-300")),Ft(X.Chip,"defaultIconColor",ge("palette-grey-300")),Ft(X.FilledInput,"bg","rgba(255, 255, 255, 0.09)"),Ft(X.FilledInput,"hoverBg","rgba(255, 255, 255, 0.13)"),Ft(X.FilledInput,"disabledBg","rgba(255, 255, 255, 0.12)"),Ft(X.LinearProgress,"primaryBg",ji(X.primary.main,.5)),Ft(X.LinearProgress,"secondaryBg",ji(X.secondary.main,.5)),Ft(X.LinearProgress,"errorBg",ji(X.error.main,.5)),Ft(X.LinearProgress,"infoBg",ji(X.info.main,.5)),Ft(X.LinearProgress,"successBg",ji(X.success.main,.5)),Ft(X.LinearProgress,"warningBg",ji(X.warning.main,.5)),Ft(X.Skeleton,"bg",`rgba(${ge("palette-text-primaryChannel")} / 0.13)`),Ft(X.Slider,"primaryTrack",ji(X.primary.main,.5)),Ft(X.Slider,"secondaryTrack",ji(X.secondary.main,.5)),Ft(X.Slider,"errorTrack",ji(X.error.main,.5)),Ft(X.Slider,"infoTrack",ji(X.info.main,.5)),Ft(X.Slider,"successTrack",ji(X.success.main,.5)),Ft(X.Slider,"warningTrack",ji(X.warning.main,.5));const be=HT(X.background.default,.98);Ft(X.SnackbarContent,"bg",be),Ft(X.SnackbarContent,"color",vu(()=>X.getContrastText(be))),Ft(X.SpeedDialAction,"fabHoverBg",HT(X.background.paper,.15)),Ft(X.StepConnector,"border",ge("palette-grey-600")),Ft(X.StepContent,"border",ge("palette-grey-600")),Ft(X.Switch,"defaultColor",ge("palette-grey-300")),Ft(X.Switch,"defaultDisabledColor",ge("palette-grey-600")),Ft(X.Switch,"primaryDisabledColor",ji(X.primary.main,.55)),Ft(X.Switch,"secondaryDisabledColor",ji(X.secondary.main,.55)),Ft(X.Switch,"errorDisabledColor",ji(X.error.main,.55)),Ft(X.Switch,"infoDisabledColor",ji(X.info.main,.55)),Ft(X.Switch,"successDisabledColor",ji(X.success.main,.55)),Ft(X.Switch,"warningDisabledColor",ji(X.warning.main,.55)),Ft(X.TableCell,"border",ji(WT(X.divider,1),.68)),Ft(X.Tooltip,"bg",WT(X.grey[700],.92))}Sh(X.background,"default"),Sh(X.background,"paper"),Sh(X.common,"background"),Sh(X.common,"onBackground"),Sh(X,"divider"),Object.keys(X).forEach(be=>{const ke=X[be];ke&&typeof ke=="object"&&(ke.main&&Ft(X[be],"mainChannel",ox(ax(ke.main))),ke.light&&Ft(X[be],"lightChannel",ox(ax(ke.light))),ke.dark&&Ft(X[be],"darkChannel",ox(ax(ke.dark))),ke.contrastText&&Ft(X[be],"contrastTextChannel",ox(ax(ke.contrastText))),be==="text"&&(Sh(X[be],"primary"),Sh(X[be],"secondary")),be==="action"&&(ke.active&&Sh(X[be],"active"),ke.selected&&Sh(X[be],"selected")))})}),K=e.reduce((de,X)=>na(de,X),K);const pe={prefix:f,disableCssColorScheme:c,shouldSkipGeneratingVar:_,getSelector:S0e(K)},{vars:Te,generateThemeVars:we,generateStyleSheets:oe}=e0e(K,pe);return K.vars=Te,Object.entries(K.colorSchemes[K.defaultColorScheme]).forEach(([de,X])=>{K[de]=X}),K.generateThemeVars=we,K.generateStyleSheets=oe,K.generateSpacing=function(){return GH(a.spacing,s4(this))},K.getColorSchemeSelector=t0e(x),K.spacing=K.generateSpacing(),K.shouldSkipGeneratingVar=_,K.unstable_sxConfig={...db,...a==null?void 0:a.unstable_sxConfig},K.unstable_sx=function(X){return fb({sx:X,theme:this})},K.toRuntimeSource=A0e,K}function d6(t,e,r){t.colorSchemes&&r&&(t.colorSchemes[e]={...r!==!0&&r,palette:g4({...r===!0?{}:r.palette,mode:e})})}function k0e(t={},...e){const{palette:r,cssVariables:o=!1,colorSchemes:c=r?void 0:{light:!0},defaultColorScheme:f=r==null?void 0:r.mode,..._}=t,x=f||"light",a=c==null?void 0:c[x],I={...c,...r?{[x]:{...typeof a!="boolean"&&a,palette:r}}:void 0};if(o===!1){if(!("colorSchemes"in t))return M3(t,...e);let D=r;"palette"in t||I[x]&&(I[x]!==!0?D=I[x].palette:x==="dark"&&(D={mode:"dark"}));const O=M3({...t,palette:D},...e);return O.defaultColorScheme=x,O.colorSchemes=I,O.palette.mode==="light"&&(O.colorSchemes.light={...I.light!==!0&&I.light,palette:O.palette},d6(O,"dark",I.dark)),O.palette.mode==="dark"&&(O.colorSchemes.dark={...I.dark!==!0&&I.dark,palette:O.palette},d6(O,"light",I.light)),O}return!r&&!("light"in I)&&x==="light"&&(I.light=!0),M0e({..._,colorSchemes:I,defaultColorScheme:x,...typeof o!="boolean"&&o},...e)}const FA=k0e();function _4(){const t=l4(FA);return t[gA]||t}function D0e({props:t,name:e}){return zye({props:t,name:e,defaultTheme:FA,themeId:gA})}function oZ(t){return t!=="ownerState"&&t!=="theme"&&t!=="sx"&&t!=="as"}const Ha=t=>oZ(t)&&t!=="classes",tr=HH({themeId:gA,defaultTheme:FA,rootShouldForwardProp:Ha});function O0e(t){return V.jsx(wye,{...t,defaultTheme:FA,themeId:gA})}function L0e(t){return function(r){return V.jsx(O0e,{styles:typeof t=="function"?o=>t({theme:o,...r}):t})}}function z0e(){return Eye}const f6={theme:void 0};function ls(t){let e,r;return o=>{let c=e;return(c===void 0||o.theme!==r)&&(f6.theme=o.theme,c=t(f6),e=c,r=o.theme),c}}function cs(t){return Kye(t)}function N0e(t){return Mi("MuiSvgIcon",t)}ki("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const F0e=t=>{const{color:e,fontSize:r,classes:o}=t,c={root:["root",e!=="inherit"&&`color${Qn(e)}`,`fontSize${Qn(r)}`]};return Li(c,N0e,o)},B0e=tr("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.color!=="inherit"&&e[`color${Qn(r.color)}`],e[`fontSize${Qn(r.fontSize)}`]]}})(ls(({theme:t})=>{var e,r,o,c,f,_,x,a,I,D,O,F,Z,J;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",flexShrink:0,transition:(c=(e=t.transitions)==null?void 0:e.create)==null?void 0:c.call(e,"fill",{duration:(o=(r=(t.vars??t).transitions)==null?void 0:r.duration)==null?void 0:o.shorter}),variants:[{props:ne=>!ne.hasSvgAsChild,style:{fill:"currentColor"}},{props:{fontSize:"inherit"},style:{fontSize:"inherit"}},{props:{fontSize:"small"},style:{fontSize:((_=(f=t.typography)==null?void 0:f.pxToRem)==null?void 0:_.call(f,20))||"1.25rem"}},{props:{fontSize:"medium"},style:{fontSize:((a=(x=t.typography)==null?void 0:x.pxToRem)==null?void 0:a.call(x,24))||"1.5rem"}},{props:{fontSize:"large"},style:{fontSize:((D=(I=t.typography)==null?void 0:I.pxToRem)==null?void 0:D.call(I,35))||"2.1875rem"}},...Object.entries((t.vars??t).palette).filter(([,ne])=>ne&&ne.main).map(([ne])=>{var se,W;return{props:{color:ne},style:{color:(W=(se=(t.vars??t).palette)==null?void 0:se[ne])==null?void 0:W.main}}}),{props:{color:"action"},style:{color:(F=(O=(t.vars??t).palette)==null?void 0:O.action)==null?void 0:F.active}},{props:{color:"disabled"},style:{color:(J=(Z=(t.vars??t).palette)==null?void 0:Z.action)==null?void 0:J.disabled}},{props:{color:"inherit"},style:{color:void 0}}]}})),BS=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiSvgIcon"}),{children:c,className:f,color:_="inherit",component:x="svg",fontSize:a="medium",htmlColor:I,inheritViewBox:D=!1,titleAccess:O,viewBox:F="0 0 24 24",...Z}=o,J=ee.isValidElement(c)&&c.type==="svg",ne={...o,color:_,component:x,fontSize:a,instanceFontSize:e.fontSize,inheritViewBox:D,viewBox:F,hasSvgAsChild:J},se={};D||(se.viewBox=F);const W=F0e(ne);return V.jsxs(B0e,{as:x,className:Nr(W.root,f),focusable:"false",color:I,"aria-hidden":O?void 0:!0,role:O?"img":void 0,ref:r,...se,...Z,...J&&c.props,ownerState:ne,children:[J?c.props.children:c,O?V.jsx("title",{children:O}):null]})});BS&&(BS.muiName="SvgIcon");function Xu(t,e){function r(o,c){return V.jsx(BS,{"data-testid":`${e}Icon`,ref:c,...o,children:t})}return r.muiName=BS.muiName,ee.memo(ee.forwardRef(r))}function aZ(t,e){if(t==null)return{};var r={};for(var o in t)if({}.hasOwnProperty.call(t,o)){if(e.includes(o))continue;r[o]=t[o]}return r}function D3(t,e){return D3=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},D3(t,e)}function lZ(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,D3(t,e)}const p6={disabled:!1},jS=Qr.createContext(null);var j0e=function(e){return e.scrollTop},lx="unmounted",rm="exited",im="entering",D_="entered",O3="exiting",Ku=function(t){lZ(e,t);function e(o,c){var f;f=t.call(this,o,c)||this;var _=c,x=_&&!_.isMounting?o.enter:o.appear,a;return f.appearStatus=null,o.in?x?(a=rm,f.appearStatus=im):a=D_:o.unmountOnExit||o.mountOnEnter?a=lx:a=rm,f.state={status:a},f.nextCallback=null,f}e.getDerivedStateFromProps=function(c,f){var _=c.in;return _&&f.status===lx?{status:rm}:null};var r=e.prototype;return r.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},r.componentDidUpdate=function(c){var f=null;if(c!==this.props){var _=this.state.status;this.props.in?_!==im&&_!==D_&&(f=im):(_===im||_===D_)&&(f=O3)}this.updateStatus(!1,f)},r.componentWillUnmount=function(){this.cancelNextCallback()},r.getTimeouts=function(){var c=this.props.timeout,f,_,x;return f=_=x=c,c!=null&&typeof c!="number"&&(f=c.exit,_=c.enter,x=c.appear!==void 0?c.appear:_),{exit:f,enter:_,appear:x}},r.updateStatus=function(c,f){if(c===void 0&&(c=!1),f!==null)if(this.cancelNextCallback(),f===im){if(this.props.unmountOnExit||this.props.mountOnEnter){var _=this.props.nodeRef?this.props.nodeRef.current:DT.findDOMNode(this);_&&j0e(_)}this.performEnter(c)}else this.performExit();else this.props.unmountOnExit&&this.state.status===rm&&this.setState({status:lx})},r.performEnter=function(c){var f=this,_=this.props.enter,x=this.context?this.context.isMounting:c,a=this.props.nodeRef?[x]:[DT.findDOMNode(this),x],I=a[0],D=a[1],O=this.getTimeouts(),F=x?O.appear:O.enter;if(!c&&!_||p6.disabled){this.safeSetState({status:D_},function(){f.props.onEntered(I)});return}this.props.onEnter(I,D),this.safeSetState({status:im},function(){f.props.onEntering(I,D),f.onTransitionEnd(F,function(){f.safeSetState({status:D_},function(){f.props.onEntered(I,D)})})})},r.performExit=function(){var c=this,f=this.props.exit,_=this.getTimeouts(),x=this.props.nodeRef?void 0:DT.findDOMNode(this);if(!f||p6.disabled){this.safeSetState({status:rm},function(){c.props.onExited(x)});return}this.props.onExit(x),this.safeSetState({status:O3},function(){c.props.onExiting(x),c.onTransitionEnd(_.exit,function(){c.safeSetState({status:rm},function(){c.props.onExited(x)})})})},r.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},r.safeSetState=function(c,f){f=this.setNextCallback(f),this.setState(c,f)},r.setNextCallback=function(c){var f=this,_=!0;return this.nextCallback=function(x){_&&(_=!1,f.nextCallback=null,c(x))},this.nextCallback.cancel=function(){_=!1},this.nextCallback},r.onTransitionEnd=function(c,f){this.setNextCallback(f);var _=this.props.nodeRef?this.props.nodeRef.current:DT.findDOMNode(this),x=c==null&&!this.props.addEndListener;if(!_||x){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var a=this.props.nodeRef?[this.nextCallback]:[_,this.nextCallback],I=a[0],D=a[1];this.props.addEndListener(I,D)}c!=null&&setTimeout(this.nextCallback,c)},r.render=function(){var c=this.state.status;if(c===lx)return null;var f=this.props,_=f.children;f.in,f.mountOnEnter,f.unmountOnExit,f.appear,f.enter,f.exit,f.timeout,f.addEndListener,f.onEnter,f.onEntering,f.onEntered,f.onExit,f.onExiting,f.onExited,f.nodeRef;var x=aZ(f,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return Qr.createElement(jS.Provider,{value:null},typeof _=="function"?_(c,x):Qr.cloneElement(Qr.Children.only(_),x))},e}(Qr.Component);Ku.contextType=jS;Ku.propTypes={};function E_(){}Ku.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:E_,onEntering:E_,onEntered:E_,onExit:E_,onExiting:E_,onExited:E_};Ku.UNMOUNTED=lx;Ku.EXITED=rm;Ku.ENTERING=im;Ku.ENTERED=D_;Ku.EXITING=O3;function U0e(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y4(t,e){var r=function(f){return e&&ee.isValidElement(f)?e(f):f},o=Object.create(null);return t&&ee.Children.map(t,function(c){return c}).forEach(function(c){o[c.key]=r(c)}),o}function V0e(t,e){t=t||{},e=e||{};function r(D){return D in e?e[D]:t[D]}var o=Object.create(null),c=[];for(var f in t)f in e?c.length&&(o[f]=c,c=[]):c.push(f);var _,x={};for(var a in e){if(o[a])for(_=0;_<o[a].length;_++){var I=o[a][_];x[o[a][_]]=r(I)}x[a]=r(a)}for(_=0;_<c.length;_++)x[c[_]]=r(c[_]);return x}function pm(t,e,r){return r[e]!=null?r[e]:t.props[e]}function $0e(t,e){return y4(t.children,function(r){return ee.cloneElement(r,{onExited:e.bind(null,r),in:!0,appear:pm(r,"appear",t),enter:pm(r,"enter",t),exit:pm(r,"exit",t)})})}function G0e(t,e,r){var o=y4(t.children),c=V0e(e,o);return Object.keys(c).forEach(function(f){var _=c[f];if(ee.isValidElement(_)){var x=f in e,a=f in o,I=e[f],D=ee.isValidElement(I)&&!I.props.in;a&&(!x||D)?c[f]=ee.cloneElement(_,{onExited:r.bind(null,_),in:!0,exit:pm(_,"exit",t),enter:pm(_,"enter",t)}):!a&&x&&!D?c[f]=ee.cloneElement(_,{in:!1}):a&&x&&ee.isValidElement(I)&&(c[f]=ee.cloneElement(_,{onExited:r.bind(null,_),in:I.props.in,exit:pm(_,"exit",t),enter:pm(_,"enter",t)}))}}),c}var q0e=Object.values||function(t){return Object.keys(t).map(function(e){return t[e]})},W0e={component:"div",childFactory:function(e){return e}},v4=function(t){lZ(e,t);function e(o,c){var f;f=t.call(this,o,c)||this;var _=f.handleExited.bind(U0e(f));return f.state={contextValue:{isMounting:!0},handleExited:_,firstRender:!0},f}var r=e.prototype;return r.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},r.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(c,f){var _=f.children,x=f.handleExited,a=f.firstRender;return{children:a?$0e(c,x):G0e(c,_,x),firstRender:!1}},r.handleExited=function(c,f){var _=y4(this.props.children);c.key in _||(c.props.onExited&&c.props.onExited(f),this.mounted&&this.setState(function(x){var a=OS({},x.children);return delete a[c.key],{children:a}}))},r.render=function(){var c=this.props,f=c.component,_=c.childFactory,x=aZ(c,["component","childFactory"]),a=this.state.contextValue,I=q0e(this.state.children).map(_);return delete x.appear,delete x.enter,delete x.exit,f===null?Qr.createElement(jS.Provider,{value:a},I):Qr.createElement(jS.Provider,{value:a},Qr.createElement(f,x,I))},e}(Qr.Component);v4.propTypes={};v4.defaultProps=W0e;const cZ=t=>t.scrollTop;function US(t,e){const{timeout:r,easing:o,style:c={}}=t;return{duration:c.transitionDuration??(typeof r=="number"?r:r[e.mode]||0),easing:c.transitionTimingFunction??(typeof o=="object"?o[e.mode]:o),delay:c.transitionDelay}}function H0e(t){return Mi("MuiPaper",t)}ki("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const Z0e=t=>{const{square:e,elevation:r,variant:o,classes:c}=t,f={root:["root",o,!e&&"rounded",o==="elevation"&&`elevation${r}`]};return Li(f,H0e,c)},X0e=tr("div",{name:"MuiPaper",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,e[r.variant],!r.square&&e.rounded,r.variant==="elevation"&&e[`elevation${r.elevation}`]]}})(ls(({theme:t})=>({backgroundColor:(t.vars||t).palette.background.paper,color:(t.vars||t).palette.text.primary,transition:t.transitions.create("box-shadow"),variants:[{props:({ownerState:e})=>!e.square,style:{borderRadius:t.shape.borderRadius}},{props:{variant:"outlined"},style:{border:`1px solid ${(t.vars||t).palette.divider}`}},{props:{variant:"elevation"},style:{boxShadow:"var(--Paper-shadow)",backgroundImage:"var(--Paper-overlay)"}}]}))),K0e=ee.forwardRef(function(e,r){var Z;const o=cs({props:e,name:"MuiPaper"}),c=_4(),{className:f,component:_="div",elevation:x=1,square:a=!1,variant:I="elevation",...D}=o,O={...o,component:_,elevation:x,square:a,variant:I},F=Z0e(O);return V.jsx(X0e,{as:_,ownerState:O,className:Nr(F.root,f),ref:r,...D,style:{...I==="elevation"&&{"--Paper-shadow":(c.vars||c).shadows[x],...c.vars&&{"--Paper-overlay":(Z=c.vars.overlays)==null?void 0:Z[x]},...!c.vars&&c.palette.mode==="dark"&&{"--Paper-overlay":`linear-gradient(${Gl("#fff",k3(x))}, ${Gl("#fff",k3(x))})`}},...D.style}})});function ql(t,e){const{className:r,elementType:o,ownerState:c,externalForwardedProps:f,getSlotOwnerState:_,internalForwardedProps:x,...a}=e,{component:I,slots:D={[t]:void 0},slotProps:O={[t]:void 0},...F}=f,Z=D[t]||o,J=rZ(O[t],c),{props:{component:ne,...se},internalRef:W}=nZ({className:r,...a,externalForwardedProps:t==="root"?F:void 0,externalSlotProps:J}),Q=jo(W,J==null?void 0:J.ref,e.ref),K=_?_(se):{},pe={...c,...K},Te=t==="root"?ne||I:ne,we=eZ(Z,{...t==="root"&&!I&&!D[t]&&x,...t!=="root"&&!D[t]&&x,...se,...Te&&{as:Te},ref:Q},pe);return Object.keys(K).forEach(oe=>{delete we[oe]}),[Z,we]}class VS{constructor(){Iv(this,"mountEffect",()=>{this.shouldMount&&!this.didMount&&this.ref.current!==null&&(this.didMount=!0,this.mounted.resolve())});this.ref={current:null},this.mounted=null,this.didMount=!1,this.shouldMount=!1,this.setShouldMount=null}static create(){return new VS}static use(){const e=KH(VS.create).current,[r,o]=ee.useState(!1);return e.shouldMount=r,e.setShouldMount=o,ee.useEffect(e.mountEffect,[r]),e}mount(){return this.mounted||(this.mounted=Q0e(),this.shouldMount=!0,this.setShouldMount(this.shouldMount)),this.mounted}start(...e){this.mount().then(()=>{var r;return(r=this.ref.current)==null?void 0:r.start(...e)})}stop(...e){this.mount().then(()=>{var r;return(r=this.ref.current)==null?void 0:r.stop(...e)})}pulsate(...e){this.mount().then(()=>{var r;return(r=this.ref.current)==null?void 0:r.pulsate(...e)})}}function Y0e(){return VS.use()}function Q0e(){let t,e;const r=new Promise((o,c)=>{t=o,e=c});return r.resolve=t,r.reject=e,r}function J0e(t){const{className:e,classes:r,pulsate:o=!1,rippleX:c,rippleY:f,rippleSize:_,in:x,onExited:a,timeout:I}=t,[D,O]=ee.useState(!1),F=Nr(e,r.ripple,r.rippleVisible,o&&r.ripplePulsate),Z={width:_,height:_,top:-(_/2)+f,left:-(_/2)+c},J=Nr(r.child,D&&r.childLeaving,o&&r.childPulsate);return!x&&!D&&O(!0),ee.useEffect(()=>{if(!x&&a!=null){const ne=setTimeout(a,I);return()=>{clearTimeout(ne)}}},[a,x,I]),V.jsx("span",{className:F,style:Z,children:V.jsx("span",{className:J})})}const Bl=ki("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),L3=550,eve=80,tve=n4`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`,nve=n4`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`,rve=n4`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`,ive=tr("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),sve=tr(J0e,{name:"MuiTouchRipple",slot:"Ripple"})`
  opacity: 0;
  position: absolute;

  &.${Bl.rippleVisible} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${tve};
    animation-duration: ${L3}ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
  }

  &.${Bl.ripplePulsate} {
    animation-duration: ${({theme:t})=>t.transitions.duration.shorter}ms;
  }

  & .${Bl.child} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${Bl.childLeaving} {
    opacity: 0;
    animation-name: ${nve};
    animation-duration: ${L3}ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
  }

  & .${Bl.childPulsate} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${rve};
    animation-duration: 2500ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`,ove=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiTouchRipple"}),{center:c=!1,classes:f={},className:_,...x}=o,[a,I]=ee.useState([]),D=ee.useRef(0),O=ee.useRef(null);ee.useEffect(()=>{O.current&&(O.current(),O.current=null)},[a]);const F=ee.useRef(!1),Z=YH(),J=ee.useRef(null),ne=ee.useRef(null),se=ee.useCallback(pe=>{const{pulsate:Te,rippleX:we,rippleY:oe,rippleSize:de,cb:X}=pe;I(ge=>[...ge,V.jsx(sve,{classes:{ripple:Nr(f.ripple,Bl.ripple),rippleVisible:Nr(f.rippleVisible,Bl.rippleVisible),ripplePulsate:Nr(f.ripplePulsate,Bl.ripplePulsate),child:Nr(f.child,Bl.child),childLeaving:Nr(f.childLeaving,Bl.childLeaving),childPulsate:Nr(f.childPulsate,Bl.childPulsate)},timeout:L3,pulsate:Te,rippleX:we,rippleY:oe,rippleSize:de},D.current)]),D.current+=1,O.current=X},[f]),W=ee.useCallback((pe={},Te={},we=()=>{})=>{const{pulsate:oe=!1,center:de=c||Te.pulsate,fakeElement:X=!1}=Te;if((pe==null?void 0:pe.type)==="mousedown"&&F.current){F.current=!1;return}(pe==null?void 0:pe.type)==="touchstart"&&(F.current=!0);const ge=X?null:ne.current,be=ge?ge.getBoundingClientRect():{width:0,height:0,left:0,top:0};let ke,Ee,Lt;if(de||pe===void 0||pe.clientX===0&&pe.clientY===0||!pe.clientX&&!pe.touches)ke=Math.round(be.width/2),Ee=Math.round(be.height/2);else{const{clientX:jt,clientY:Qt}=pe.touches&&pe.touches.length>0?pe.touches[0]:pe;ke=Math.round(jt-be.left),Ee=Math.round(Qt-be.top)}if(de)Lt=Math.sqrt((2*be.width**2+be.height**2)/3),Lt%2===0&&(Lt+=1);else{const jt=Math.max(Math.abs((ge?ge.clientWidth:0)-ke),ke)*2+2,Qt=Math.max(Math.abs((ge?ge.clientHeight:0)-Ee),Ee)*2+2;Lt=Math.sqrt(jt**2+Qt**2)}pe!=null&&pe.touches?J.current===null&&(J.current=()=>{se({pulsate:oe,rippleX:ke,rippleY:Ee,rippleSize:Lt,cb:we})},Z.start(eve,()=>{J.current&&(J.current(),J.current=null)})):se({pulsate:oe,rippleX:ke,rippleY:Ee,rippleSize:Lt,cb:we})},[c,se,Z]),Q=ee.useCallback(()=>{W({},{pulsate:!0})},[W]),K=ee.useCallback((pe,Te)=>{if(Z.clear(),(pe==null?void 0:pe.type)==="touchend"&&J.current){J.current(),J.current=null,Z.start(0,()=>{K(pe,Te)});return}J.current=null,I(we=>we.length>0?we.slice(1):we),O.current=Te},[Z]);return ee.useImperativeHandle(r,()=>({pulsate:Q,start:W,stop:K}),[Q,W,K]),V.jsx(ive,{className:Nr(Bl.root,f.root,_),ref:ne,...x,children:V.jsx(v4,{component:null,exit:!0,children:a})})});function ave(t){return Mi("MuiButtonBase",t)}const lve=ki("MuiButtonBase",["root","disabled","focusVisible"]),cve=t=>{const{disabled:e,focusVisible:r,focusVisibleClassName:o,classes:c}=t,_=Li({root:["root",e&&"disabled",r&&"focusVisible"]},ave,c);return r&&o&&(_.root+=` ${o}`),_},uve=tr("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(t,e)=>e.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${lve.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),x4=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiButtonBase"}),{action:c,centerRipple:f=!1,children:_,className:x,component:a="button",disabled:I=!1,disableRipple:D=!1,disableTouchRipple:O=!1,focusRipple:F=!1,focusVisibleClassName:Z,LinkComponent:J="a",onBlur:ne,onClick:se,onContextMenu:W,onDragLeave:Q,onFocus:K,onFocusVisible:pe,onKeyDown:Te,onKeyUp:we,onMouseDown:oe,onMouseLeave:de,onMouseUp:X,onTouchEnd:ge,onTouchMove:be,onTouchStart:ke,tabIndex:Ee=0,TouchRippleProps:Lt,touchRippleRef:jt,type:Qt,...Pt}=o,lt=ee.useRef(null),At=Y0e(),nn=jo(At.ref,jt),[fn,mn]=ee.useState(!1);I&&fn&&mn(!1),ee.useImperativeHandle(c,()=>({focusVisible:()=>{mn(!0),lt.current.focus()}}),[]);const Vt=At.shouldMount&&!D&&!I;ee.useEffect(()=>{fn&&F&&!D&&At.pulsate()},[D,F,fn,At]);function wn(pt,Jt,In=O){return H_(en=>(Jt&&Jt(en),In||At[pt](en),!0))}const Ht=wn("start",oe),Hn=wn("stop",W),Jn=wn("stop",Q),ir=wn("stop",X),Zt=wn("stop",pt=>{fn&&pt.preventDefault(),de&&de(pt)}),zt=wn("start",ke),qt=wn("stop",ge),xn=wn("stop",be),rr=wn("stop",pt=>{i6(pt.target)||mn(!1),ne&&ne(pt)},!1),Gn=H_(pt=>{lt.current||(lt.current=pt.currentTarget),i6(pt.target)&&(mn(!0),pe&&pe(pt)),K&&K(pt)}),yr=()=>{const pt=lt.current;return a&&a!=="button"&&!(pt.tagName==="A"&&pt.href)},Gr=H_(pt=>{F&&!pt.repeat&&fn&&pt.key===" "&&At.stop(pt,()=>{At.start(pt)}),pt.target===pt.currentTarget&&yr()&&pt.key===" "&&pt.preventDefault(),Te&&Te(pt),pt.target===pt.currentTarget&&yr()&&pt.key==="Enter"&&!I&&(pt.preventDefault(),se&&se(pt))}),mr=H_(pt=>{F&&pt.key===" "&&fn&&!pt.defaultPrevented&&At.stop(pt,()=>{At.pulsate(pt)}),we&&we(pt),se&&pt.target===pt.currentTarget&&yr()&&pt.key===" "&&!pt.defaultPrevented&&se(pt)});let wr=a;wr==="button"&&(Pt.href||Pt.to)&&(wr=J);const wt={};wr==="button"?(wt.type=Qt===void 0?"button":Qt,wt.disabled=I):(!Pt.href&&!Pt.to&&(wt.role="button"),I&&(wt["aria-disabled"]=I));const St=jo(r,lt),Ct={...o,centerRipple:f,component:a,disabled:I,disableRipple:D,disableTouchRipple:O,focusRipple:F,tabIndex:Ee,focusVisible:fn},it=cve(Ct);return V.jsxs(uve,{as:wr,className:Nr(it.root,x),ownerState:Ct,onBlur:rr,onClick:se,onContextMenu:Hn,onFocus:Gn,onKeyDown:Gr,onKeyUp:mr,onMouseDown:Ht,onMouseLeave:Zt,onMouseUp:ir,onDragLeave:Jn,onTouchEnd:qt,onTouchMove:xn,onTouchStart:zt,ref:St,tabIndex:I?-1:Ee,type:Qt,...wt,...Pt,children:[_,Vt?V.jsx(ove,{ref:nn,center:f,...Lt}):null]})});function hve(t){return Mi("MuiIconButton",t)}const dve=ki("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge"]),fve=t=>{const{classes:e,disabled:r,color:o,edge:c,size:f}=t,_={root:["root",r&&"disabled",o!=="default"&&`color${Qn(o)}`,c&&`edge${Qn(c)}`,`size${Qn(f)}`]};return Li(_,hve,e)},pve=tr(x4,{name:"MuiIconButton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.color!=="default"&&e[`color${Qn(r.color)}`],r.edge&&e[`edge${Qn(r.edge)}`],e[`size${Qn(r.size)}`]]}})(ls(({theme:t})=>({textAlign:"center",flex:"0 0 auto",fontSize:t.typography.pxToRem(24),padding:8,borderRadius:"50%",color:(t.vars||t).palette.action.active,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),variants:[{props:{disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:Gl(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}},{props:{edge:"start"},style:{marginLeft:-12}},{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:{edge:"end"},style:{marginRight:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}}]})),ls(({theme:t})=>({variants:[{props:{color:"inherit"},style:{color:"inherit"}},...Object.entries(t.palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e},style:{color:(t.vars||t).palette[e].main}})),...Object.entries(t.palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${(t.vars||t).palette[e].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:Gl((t.vars||t).palette[e].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}})),{props:{size:"small"},style:{padding:5,fontSize:t.typography.pxToRem(18)}},{props:{size:"large"},style:{padding:12,fontSize:t.typography.pxToRem(28)}}],[`&.${dve.disabled}`]:{backgroundColor:"transparent",color:(t.vars||t).palette.action.disabled}}))),Ih=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiIconButton"}),{edge:c=!1,children:f,className:_,color:x="default",disabled:a=!1,disableFocusRipple:I=!1,disableRipple:D=!1,size:O="medium",...F}=o,Z={...o,edge:c,color:x,disabled:a,disableFocusRipple:I,disableRipple:D,size:O},J=fve(Z);return V.jsx(pve,{className:Nr(J.root,_),centerRipple:!0,focusRipple:!I,disabled:a,disableRipple:D,ref:r,...F,ownerState:Z,children:f})});function mve(t){return Mi("MuiTypography",t)}ki("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const gve={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},_ve=z0e(),yve=t=>{const{align:e,gutterBottom:r,noWrap:o,paragraph:c,variant:f,classes:_}=t,x={root:["root",f,t.align!=="inherit"&&`align${Qn(e)}`,r&&"gutterBottom",o&&"noWrap",c&&"paragraph"]};return Li(x,mve,_)},vve=tr("span",{name:"MuiTypography",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.variant&&e[r.variant],r.align!=="inherit"&&e[`align${Qn(r.align)}`],r.noWrap&&e.noWrap,r.gutterBottom&&e.gutterBottom,r.paragraph&&e.paragraph]}})(ls(({theme:t})=>{var e;return{margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(t.typography).filter(([r,o])=>r!=="inherit"&&o&&typeof o=="object").map(([r,o])=>({props:{variant:r},style:o})),...Object.entries(t.palette).filter(([,r])=>r&&r.main).map(([r])=>({props:{color:r},style:{color:(t.vars||t).palette[r].main}})),...Object.entries(((e=t.palette)==null?void 0:e.text)||{}).filter(([,r])=>typeof r=="string").map(([r])=>({props:{color:`text${Qn(r)}`},style:{color:(t.vars||t).palette.text[r]}})),{props:({ownerState:r})=>r.align!=="inherit",style:{textAlign:"var(--Typography-textAlign)"}},{props:({ownerState:r})=>r.noWrap,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:({ownerState:r})=>r.gutterBottom,style:{marginBottom:"0.35em"}},{props:({ownerState:r})=>r.paragraph,style:{marginBottom:16}}]}})),m6={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},g6=ee.forwardRef(function(e,r){const{color:o,...c}=cs({props:e,name:"MuiTypography"}),f=!gve[o],_=_ve({...c,...f&&{color:o}}),{align:x="inherit",className:a,component:I,gutterBottom:D=!1,noWrap:O=!1,paragraph:F=!1,variant:Z="body1",variantMapping:J=m6,...ne}=_,se={..._,align:x,color:o,className:a,component:I,gutterBottom:D,noWrap:O,paragraph:F,variant:Z,variantMapping:J},W=I||(F?"p":J[Z]||m6[Z])||"span",Q=yve(se);return V.jsx(vve,{as:W,ref:r,className:Nr(Q.root,a),...ne,ownerState:se,style:{...x!=="inherit"&&{"--Typography-textAlign":x},...ne.style}})});function xve(t){return typeof t=="function"?t():t}const bve=ee.forwardRef(function(e,r){const{children:o,container:c,disablePortal:f=!1}=e,[_,x]=ee.useState(null),a=jo(pb(o),r);if(jm(()=>{f||x(xve(c)||document.body)},[c,f]),jm(()=>{if(_&&!f)return R3(r,_),()=>{R3(r,null)}},[r,_,f]),f){if(ee.isValidElement(o)){const I={ref:a};return ee.cloneElement(o,I)}return V.jsx(ee.Fragment,{children:o})}return V.jsx(ee.Fragment,{children:_&&TI.createPortal(o,_)})});function ZT(t){return parseInt(t,10)||0}const wve={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}};function Tve(t){return t==null||Object.keys(t).length===0||t.outerHeightStyle===0&&!t.overflowing}const Eve=ee.forwardRef(function(e,r){const{onChange:o,maxRows:c,minRows:f=1,style:_,value:x,...a}=e,{current:I}=ee.useRef(x!=null),D=ee.useRef(null),O=jo(r,D),F=ee.useRef(null),Z=ee.useRef(null),J=ee.useCallback(()=>{const W=D.current,K=Um(W).getComputedStyle(W);if(K.width==="0px")return{outerHeightStyle:0,overflowing:!1};const pe=Z.current;pe.style.width=K.width,pe.value=W.value||e.placeholder||"x",pe.value.slice(-1)===`
`&&(pe.value+=" ");const Te=K.boxSizing,we=ZT(K.paddingBottom)+ZT(K.paddingTop),oe=ZT(K.borderBottomWidth)+ZT(K.borderTopWidth),de=pe.scrollHeight;pe.value="x";const X=pe.scrollHeight;let ge=de;f&&(ge=Math.max(Number(f)*X,ge)),c&&(ge=Math.min(Number(c)*X,ge)),ge=Math.max(ge,X);const be=ge+(Te==="border-box"?we+oe:0),ke=Math.abs(ge-de)<=1;return{outerHeightStyle:be,overflowing:ke}},[c,f,e.placeholder]),ne=ee.useCallback(()=>{const W=J();if(Tve(W))return;const Q=W.outerHeightStyle,K=D.current;F.current!==Q&&(F.current=Q,K.style.height=`${Q}px`),K.style.overflow=W.overflowing?"hidden":""},[J]);jm(()=>{const W=()=>{ne()};let Q;const K=XH(W),pe=D.current,Te=Um(pe);Te.addEventListener("resize",K);let we;return typeof ResizeObserver<"u"&&(we=new ResizeObserver(W),we.observe(pe)),()=>{K.clear(),cancelAnimationFrame(Q),Te.removeEventListener("resize",K),we&&we.disconnect()}},[J,ne]),jm(()=>{ne()});const se=W=>{I||ne(),o&&o(W)};return V.jsxs(ee.Fragment,{children:[V.jsx("textarea",{value:x,onChange:se,ref:O,rows:f,style:_,...a}),V.jsx("textarea",{"aria-hidden":!0,className:e.className,readOnly:!0,ref:Z,tabIndex:-1,style:{...wve.shadow,..._,paddingTop:0,paddingBottom:0}})]})});function z3(t){return typeof t=="string"}function ep({props:t,states:e,muiFormControl:r}){return e.reduce((o,c)=>(o[c]=t[c],r&&typeof t[c]>"u"&&(o[c]=r[c]),o),{})}const b4=ee.createContext(void 0);function id(){return ee.useContext(b4)}function _6(t){return t!=null&&!(Array.isArray(t)&&t.length===0)}function $S(t,e=!1){return t&&(_6(t.value)&&t.value!==""||e&&_6(t.defaultValue)&&t.defaultValue!=="")}function Sve(t){return t.startAdornment}function Ive(t){return Mi("MuiInputBase",t)}const ky=ki("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]);var y6;const BA=(t,e)=>{const{ownerState:r}=t;return[e.root,r.formControl&&e.formControl,r.startAdornment&&e.adornedStart,r.endAdornment&&e.adornedEnd,r.error&&e.error,r.size==="small"&&e.sizeSmall,r.multiline&&e.multiline,r.color&&e[`color${Qn(r.color)}`],r.fullWidth&&e.fullWidth,r.hiddenLabel&&e.hiddenLabel]},jA=(t,e)=>{const{ownerState:r}=t;return[e.input,r.size==="small"&&e.inputSizeSmall,r.multiline&&e.inputMultiline,r.type==="search"&&e.inputTypeSearch,r.startAdornment&&e.inputAdornedStart,r.endAdornment&&e.inputAdornedEnd,r.hiddenLabel&&e.inputHiddenLabel]},Ave=t=>{const{classes:e,color:r,disabled:o,error:c,endAdornment:f,focused:_,formControl:x,fullWidth:a,hiddenLabel:I,multiline:D,readOnly:O,size:F,startAdornment:Z,type:J}=t,ne={root:["root",`color${Qn(r)}`,o&&"disabled",c&&"error",a&&"fullWidth",_&&"focused",x&&"formControl",F&&F!=="medium"&&`size${Qn(F)}`,D&&"multiline",Z&&"adornedStart",f&&"adornedEnd",I&&"hiddenLabel",O&&"readOnly"],input:["input",o&&"disabled",J==="search"&&"inputTypeSearch",D&&"inputMultiline",F==="small"&&"inputSizeSmall",I&&"inputHiddenLabel",Z&&"inputAdornedStart",f&&"inputAdornedEnd",O&&"readOnly"]};return Li(ne,Ive,e)},UA=tr("div",{name:"MuiInputBase",slot:"Root",overridesResolver:BA})(ls(({theme:t})=>({...t.typography.body1,color:(t.vars||t).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${ky.disabled}`]:{color:(t.vars||t).palette.text.disabled,cursor:"default"},variants:[{props:({ownerState:e})=>e.multiline,style:{padding:"4px 0 5px"}},{props:({ownerState:e,size:r})=>e.multiline&&r==="small",style:{paddingTop:1}},{props:({ownerState:e})=>e.fullWidth,style:{width:"100%"}}]}))),VA=tr("input",{name:"MuiInputBase",slot:"Input",overridesResolver:jA})(ls(({theme:t})=>{const e=t.palette.mode==="light",r={color:"currentColor",...t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:e?.42:.5},transition:t.transitions.create("opacity",{duration:t.transitions.duration.shorter})},o={opacity:"0 !important"},c=t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:e?.42:.5};return{font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%","&::-webkit-input-placeholder":r,"&::-moz-placeholder":r,"&::-ms-input-placeholder":r,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${ky.formControl} &`]:{"&::-webkit-input-placeholder":o,"&::-moz-placeholder":o,"&::-ms-input-placeholder":o,"&:focus::-webkit-input-placeholder":c,"&:focus::-moz-placeholder":c,"&:focus::-ms-input-placeholder":c},[`&.${ky.disabled}`]:{opacity:1,WebkitTextFillColor:(t.vars||t).palette.text.disabled},variants:[{props:({ownerState:f})=>!f.disableInjectingGlobalStyles,style:{animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}}},{props:{size:"small"},style:{paddingTop:1}},{props:({ownerState:f})=>f.multiline,style:{height:"auto",resize:"none",padding:0,paddingTop:0}},{props:{type:"search"},style:{MozAppearance:"textfield"}}]}})),v6=L0e({"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}),Cve=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiInputBase"}),{"aria-describedby":c,autoComplete:f,autoFocus:_,className:x,color:a,components:I={},componentsProps:D={},defaultValue:O,disabled:F,disableInjectingGlobalStyles:Z,endAdornment:J,error:ne,fullWidth:se=!1,id:W,inputComponent:Q="input",inputProps:K={},inputRef:pe,margin:Te,maxRows:we,minRows:oe,multiline:de=!1,name:X,onBlur:ge,onChange:be,onClick:ke,onFocus:Ee,onKeyDown:Lt,onKeyUp:jt,placeholder:Qt,readOnly:Pt,renderSuffix:lt,rows:At,size:nn,slotProps:fn={},slots:mn={},startAdornment:Vt,type:wn="text",value:Ht,...Hn}=o,Jn=K.value!=null?K.value:Ht,{current:ir}=ee.useRef(Jn!=null),Zt=ee.useRef(),zt=ee.useCallback(gn=>{},[]),qt=jo(Zt,pe,K.ref,zt),[xn,rr]=ee.useState(!1),Gn=id(),yr=ep({props:o,muiFormControl:Gn,states:["color","disabled","error","hiddenLabel","size","required","filled"]});yr.focused=Gn?Gn.focused:xn,ee.useEffect(()=>{!Gn&&F&&xn&&(rr(!1),ge&&ge())},[Gn,F,xn,ge]);const Gr=Gn&&Gn.onFilled,mr=Gn&&Gn.onEmpty,wr=ee.useCallback(gn=>{$S(gn)?Gr&&Gr():mr&&mr()},[Gr,mr]);jm(()=>{ir&&wr({value:Jn})},[Jn,wr,ir]);const wt=gn=>{Ee&&Ee(gn),K.onFocus&&K.onFocus(gn),Gn&&Gn.onFocus?Gn.onFocus(gn):rr(!0)},St=gn=>{ge&&ge(gn),K.onBlur&&K.onBlur(gn),Gn&&Gn.onBlur?Gn.onBlur(gn):rr(!1)},Ct=(gn,...er)=>{if(!ir){const Ur=gn.target||Zt.current;if(Ur==null)throw new Error(Yh(1));wr({value:Ur.value})}K.onChange&&K.onChange(gn,...er),be&&be(gn,...er)};ee.useEffect(()=>{wr(Zt.current)},[]);const it=gn=>{Zt.current&&gn.currentTarget===gn.target&&Zt.current.focus(),ke&&ke(gn)};let pt=Q,Jt=K;de&&pt==="input"&&(At?Jt={type:void 0,minRows:At,maxRows:At,...Jt}:Jt={type:void 0,maxRows:we,minRows:oe,...Jt},pt=Eve);const In=gn=>{wr(gn.animationName==="mui-auto-fill-cancel"?Zt.current:{value:"x"})};ee.useEffect(()=>{Gn&&Gn.setAdornedStart(!!Vt)},[Gn,Vt]);const en={...o,color:yr.color||"primary",disabled:yr.disabled,endAdornment:J,error:yr.error,focused:yr.focused,formControl:Gn,fullWidth:se,hiddenLabel:yr.hiddenLabel,multiline:de,size:yr.size,startAdornment:Vt,type:wn},Ye=Ave(en),Rt=mn.root||I.Root||UA,bn=fn.root||D.root||{},Pn=mn.input||I.Input||VA;return Jt={...Jt,...fn.input??D.input},V.jsxs(ee.Fragment,{children:[!Z&&typeof v6=="function"&&(y6||(y6=V.jsx(v6,{}))),V.jsxs(Rt,{...bn,ref:r,onClick:it,...Hn,...!z3(Rt)&&{ownerState:{...en,...bn.ownerState}},className:Nr(Ye.root,bn.className,x,Pt&&"MuiInputBase-readOnly"),children:[Vt,V.jsx(b4.Provider,{value:null,children:V.jsx(Pn,{"aria-invalid":yr.error,"aria-describedby":c,autoComplete:f,autoFocus:_,defaultValue:O,disabled:yr.disabled,id:W,onAnimationStart:In,name:X,placeholder:Qt,readOnly:Pt,required:yr.required,rows:At,value:Jn,onKeyDown:Lt,onKeyUp:jt,type:wn,...Jt,...!z3(Pn)&&{as:pt,ownerState:{...en,...Jt.ownerState}},ref:qt,className:Nr(Ye.input,Jt.className,Pt&&"MuiInputBase-readOnly"),onBlur:St,onChange:Ct,onFocus:wt})}),J,lt?lt({...yr,startAdornment:Vt}):null]})]})}),w4=Cve;function Pve(t){return Mi("MuiInput",t)}const jv={...ky,...ki("MuiInput",["root","underline","input"])};function Rve(t){return Mi("MuiOutlinedInput",t)}const xu={...ky,...ki("MuiOutlinedInput",["root","notchedOutline","input"])};function Mve(t){return Mi("MuiFilledInput",t)}const Jp={...ky,...ki("MuiFilledInput",["root","underline","input","adornedStart","adornedEnd","sizeSmall","multiline","hiddenLabel"])},kve=Xu(V.jsx("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),Dve={entering:{opacity:1},entered:{opacity:1}},Ove=ee.forwardRef(function(e,r){const o=_4(),c={enter:o.transitions.duration.enteringScreen,exit:o.transitions.duration.leavingScreen},{addEndListener:f,appear:_=!0,children:x,easing:a,in:I,onEnter:D,onEntered:O,onEntering:F,onExit:Z,onExited:J,onExiting:ne,style:se,timeout:W=c,TransitionComponent:Q=Ku,...K}=e,pe=ee.useRef(null),Te=jo(pe,pb(x),r),we=Lt=>jt=>{if(Lt){const Qt=pe.current;jt===void 0?Lt(Qt):Lt(Qt,jt)}},oe=we(F),de=we((Lt,jt)=>{cZ(Lt);const Qt=US({style:se,timeout:W,easing:a},{mode:"enter"});Lt.style.webkitTransition=o.transitions.create("opacity",Qt),Lt.style.transition=o.transitions.create("opacity",Qt),D&&D(Lt,jt)}),X=we(O),ge=we(ne),be=we(Lt=>{const jt=US({style:se,timeout:W,easing:a},{mode:"exit"});Lt.style.webkitTransition=o.transitions.create("opacity",jt),Lt.style.transition=o.transitions.create("opacity",jt),Z&&Z(Lt)}),ke=we(J),Ee=Lt=>{f&&f(pe.current,Lt)};return V.jsx(Q,{appear:_,in:I,nodeRef:pe,onEnter:de,onEntered:X,onEntering:oe,onExit:be,onExited:ke,onExiting:ge,addEndListener:Ee,timeout:W,...K,children:(Lt,jt)=>ee.cloneElement(x,{style:{opacity:0,visibility:Lt==="exited"&&!I?"hidden":void 0,...Dve[Lt],...se,...x.props.style},ref:Te,...jt})})});function Lve(t){return Mi("MuiBackdrop",t)}ki("MuiBackdrop",["root","invisible"]);const zve=t=>{const{classes:e,invisible:r}=t;return Li({root:["root",r&&"invisible"]},Lve,e)},Nve=tr("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.invisible&&e.invisible]}})({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent",variants:[{props:{invisible:!0},style:{backgroundColor:"transparent"}}]}),Fve=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiBackdrop"}),{children:c,className:f,component:_="div",invisible:x=!1,open:a,components:I={},componentsProps:D={},slotProps:O={},slots:F={},TransitionComponent:Z,transitionDuration:J,...ne}=o,se={...o,component:_,invisible:x},W=zve(se),Q={transition:Z,root:I.Root,...F},K={...D,...O},pe={slots:Q,slotProps:K},[Te,we]=ql("root",{elementType:Nve,externalForwardedProps:pe,className:Nr(W.root,f),ownerState:se}),[oe,de]=ql("transition",{elementType:Ove,externalForwardedProps:pe,ownerState:se});return delete de.ownerState,V.jsx(oe,{in:a,timeout:J,...ne,...de,children:V.jsx(Te,{"aria-hidden":!0,...we,classes:W,ref:r,children:c})})});function Bve(t){const{badgeContent:e,invisible:r=!1,max:o=99,showZero:c=!1}=t,f=JH({badgeContent:e,max:o});let _=r;r===!1&&e===0&&!c&&(_=!0);const{badgeContent:x,max:a=o}=_?f:t,I=x&&Number(x)>a?`${a}+`:x;return{badgeContent:x,invisible:_,max:a,displayValue:I}}function jve(t){return Mi("MuiBadge",t)}const Yd=ki("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),bM=10,wM=4,Uve=t=>{const{color:e,anchorOrigin:r,invisible:o,overlap:c,variant:f,classes:_={}}=t,x={root:["root"],badge:["badge",f,o&&"invisible",`anchorOrigin${Qn(r.vertical)}${Qn(r.horizontal)}`,`anchorOrigin${Qn(r.vertical)}${Qn(r.horizontal)}${Qn(c)}`,`overlap${Qn(c)}`,e!=="default"&&`color${Qn(e)}`]};return Li(x,jve,_)},Vve=tr("span",{name:"MuiBadge",slot:"Root",overridesResolver:(t,e)=>e.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),$ve=tr("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.badge,e[r.variant],e[`anchorOrigin${Qn(r.anchorOrigin.vertical)}${Qn(r.anchorOrigin.horizontal)}${Qn(r.overlap)}`],r.color!=="default"&&e[`color${Qn(r.color)}`],r.invisible&&e.invisible]}})(ls(({theme:t})=>({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:t.typography.fontFamily,fontWeight:t.typography.fontWeightMedium,fontSize:t.typography.pxToRem(12),minWidth:bM*2,lineHeight:1,padding:"0 6px",height:bM*2,borderRadius:bM,zIndex:1,transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.enteringScreen}),variants:[...Object.entries(t.palette).filter(([,e])=>e&&e.main&&e.contrastText).map(([e])=>({props:{color:e},style:{backgroundColor:(t.vars||t).palette[e].main,color:(t.vars||t).palette[e].contrastText}})),{props:{variant:"dot"},style:{borderRadius:wM,height:wM*2,minWidth:wM*2,padding:0}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.leavingScreen})}}]}))),Gve=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiBadge"}),{anchorOrigin:c={vertical:"top",horizontal:"right"},className:f,classes:_,component:x,components:a={},componentsProps:I={},children:D,overlap:O="rectangular",color:F="default",invisible:Z=!1,max:J=99,badgeContent:ne,slots:se,slotProps:W,showZero:Q=!1,variant:K="standard",...pe}=o,{badgeContent:Te,invisible:we,max:oe,displayValue:de}=Bve({max:J,invisible:Z,badgeContent:ne,showZero:Q}),X=JH({anchorOrigin:c,color:F,overlap:O,variant:K,badgeContent:ne}),ge=we||Te==null&&K!=="dot",{color:be=F,overlap:ke=O,anchorOrigin:Ee=c,variant:Lt=K}=ge?X:o,jt=Lt!=="dot"?de:void 0,Qt={...o,badgeContent:Te,invisible:ge,max:oe,displayValue:jt,showZero:Q,anchorOrigin:Ee,color:be,overlap:ke,variant:Lt},Pt=Uve(Qt),lt=(se==null?void 0:se.root)??a.Root??Vve,At=(se==null?void 0:se.badge)??a.Badge??$ve,nn=(W==null?void 0:W.root)??I.root,fn=(W==null?void 0:W.badge)??I.badge,mn=FS({elementType:lt,externalSlotProps:nn,externalForwardedProps:pe,additionalProps:{ref:r,as:x},ownerState:Qt,className:Nr(nn==null?void 0:nn.className,Pt.root,f)}),Vt=FS({elementType:At,externalSlotProps:fn,ownerState:Qt,className:Nr(Pt.badge,fn==null?void 0:fn.className)});return V.jsxs(lt,{...mn,children:[D,V.jsx(At,{...Vt,children:jt})]})});function qve(t){return Mi("MuiButton",t)}const S_=ki("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]),Wve=ee.createContext({}),Hve=ee.createContext(void 0),Zve=t=>{const{color:e,disableElevation:r,fullWidth:o,size:c,variant:f,classes:_}=t,x={root:["root",f,`${f}${Qn(e)}`,`size${Qn(c)}`,`${f}Size${Qn(c)}`,`color${Qn(e)}`,r&&"disableElevation",o&&"fullWidth"],label:["label"],startIcon:["icon","startIcon",`iconSize${Qn(c)}`],endIcon:["icon","endIcon",`iconSize${Qn(c)}`]},a=Li(x,qve,_);return{..._,...a}},uZ=[{props:{size:"small"},style:{"& > *:nth-of-type(1)":{fontSize:18}}},{props:{size:"medium"},style:{"& > *:nth-of-type(1)":{fontSize:20}}},{props:{size:"large"},style:{"& > *:nth-of-type(1)":{fontSize:22}}}],Xve=tr(x4,{shouldForwardProp:t=>Ha(t)||t==="classes",name:"MuiButton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,e[r.variant],e[`${r.variant}${Qn(r.color)}`],e[`size${Qn(r.size)}`],e[`${r.variant}Size${Qn(r.size)}`],r.color==="inherit"&&e.colorInherit,r.disableElevation&&e.disableElevation,r.fullWidth&&e.fullWidth]}})(ls(({theme:t})=>{var o,c;const e=t.palette.mode==="light"?t.palette.grey[300]:t.palette.grey[800],r=t.palette.mode==="light"?t.palette.grey.A100:t.palette.grey[700];return{...t.typography.button,minWidth:64,padding:"6px 16px",border:0,borderRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create(["background-color","box-shadow","border-color","color"],{duration:t.transitions.duration.short}),"&:hover":{textDecoration:"none"},[`&.${S_.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{variant:"contained"},style:{color:"var(--variant-containedColor)",backgroundColor:"var(--variant-containedBg)",boxShadow:(t.vars||t).shadows[2],"&:hover":{boxShadow:(t.vars||t).shadows[4],"@media (hover: none)":{boxShadow:(t.vars||t).shadows[2]}},"&:active":{boxShadow:(t.vars||t).shadows[8]},[`&.${S_.focusVisible}`]:{boxShadow:(t.vars||t).shadows[6]},[`&.${S_.disabled}`]:{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground}}},{props:{variant:"outlined"},style:{padding:"5px 15px",border:"1px solid currentColor",borderColor:"var(--variant-outlinedBorder, currentColor)",backgroundColor:"var(--variant-outlinedBg)",color:"var(--variant-outlinedColor)",[`&.${S_.disabled}`]:{border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`}}},{props:{variant:"text"},style:{padding:"6px 8px",color:"var(--variant-textColor)",backgroundColor:"var(--variant-textBg)"}},...Object.entries(t.palette).filter(([,f])=>f&&f.main&&f.dark&&f.contrastText).map(([f])=>({props:{color:f},style:{"--variant-textColor":(t.vars||t).palette[f].main,"--variant-outlinedColor":(t.vars||t).palette[f].main,"--variant-outlinedBorder":t.vars?`rgba(${t.vars.palette[f].mainChannel} / 0.5)`:Gl(t.palette[f].main,.5),"--variant-containedColor":(t.vars||t).palette[f].contrastText,"--variant-containedBg":(t.vars||t).palette[f].main,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":(t.vars||t).palette[f].dark,"--variant-textBg":t.vars?`rgba(${t.vars.palette[f].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:Gl(t.palette[f].main,t.palette.action.hoverOpacity),"--variant-outlinedBorder":(t.vars||t).palette[f].main,"--variant-outlinedBg":t.vars?`rgba(${t.vars.palette[f].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:Gl(t.palette[f].main,t.palette.action.hoverOpacity)}}}})),{props:{color:"inherit"},style:{"--variant-containedColor":t.vars?t.vars.palette.text.primary:(c=(o=t.palette).getContrastText)==null?void 0:c.call(o,e),"--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedBg:e,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedHoverBg:r,"--variant-textBg":t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:Gl(t.palette.text.primary,t.palette.action.hoverOpacity),"--variant-outlinedBg":t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:Gl(t.palette.text.primary,t.palette.action.hoverOpacity)}}}},{props:{size:"small",variant:"text"},style:{padding:"4px 5px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"text"},style:{padding:"8px 11px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"outlined"},style:{padding:"3px 9px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"outlined"},style:{padding:"7px 21px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"contained"},style:{padding:"4px 10px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"contained"},style:{padding:"8px 22px",fontSize:t.typography.pxToRem(15)}},{props:{disableElevation:!0},style:{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${S_.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${S_.disabled}`]:{boxShadow:"none"}}},{props:{fullWidth:!0},style:{width:"100%"}}]}})),Kve=tr("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.startIcon,e[`iconSize${Qn(r.size)}`]]}})({display:"inherit",marginRight:8,marginLeft:-4,variants:[{props:{size:"small"},style:{marginLeft:-2}},...uZ]}),Yve=tr("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.endIcon,e[`iconSize${Qn(r.size)}`]]}})({display:"inherit",marginRight:-4,marginLeft:8,variants:[{props:{size:"small"},style:{marginRight:-2}},...uZ]}),N3=ee.forwardRef(function(e,r){const o=ee.useContext(Wve),c=ee.useContext(Hve),f=A1(o,e),_=cs({props:f,name:"MuiButton"}),{children:x,color:a="primary",component:I="button",className:D,disabled:O=!1,disableElevation:F=!1,disableFocusRipple:Z=!1,endIcon:J,focusVisibleClassName:ne,fullWidth:se=!1,size:W="medium",startIcon:Q,type:K,variant:pe="text",...Te}=_,we={..._,color:a,component:I,disabled:O,disableElevation:F,disableFocusRipple:Z,fullWidth:se,size:W,type:K,variant:pe},oe=Zve(we),de=Q&&V.jsx(Kve,{className:oe.startIcon,ownerState:we,children:Q}),X=J&&V.jsx(Yve,{className:oe.endIcon,ownerState:we,children:J}),ge=c||"";return V.jsxs(Xve,{ownerState:we,className:Nr(o.className,oe.root,D,ge),component:I,disabled:O,focusRipple:!Z,focusVisibleClassName:Nr(oe.focusVisible,ne),ref:r,type:K,...Te,classes:oe,children:[de,x,X]})});function Qve(t){return Mi("PrivateSwitchBase",t)}ki("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const Jve=t=>{const{classes:e,checked:r,disabled:o,edge:c}=t,f={root:["root",r&&"checked",o&&"disabled",c&&`edge${Qn(c)}`],input:["input"]};return Li(f,Qve,e)},exe=tr(x4)({padding:9,borderRadius:"50%",variants:[{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:({edge:t,ownerState:e})=>t==="start"&&e.size!=="small",style:{marginLeft:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}},{props:({edge:t,ownerState:e})=>t==="end"&&e.size!=="small",style:{marginRight:-12}}]}),txe=tr("input",{shouldForwardProp:Ha})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),nxe=ee.forwardRef(function(e,r){const{autoFocus:o,checked:c,checkedIcon:f,className:_,defaultChecked:x,disabled:a,disableFocusRipple:I=!1,edge:D=!1,icon:O,id:F,inputProps:Z,inputRef:J,name:ne,onBlur:se,onChange:W,onFocus:Q,readOnly:K,required:pe=!1,tabIndex:Te,type:we,value:oe,...de}=e,[X,ge]=NS({controlled:c,default:!!x,name:"SwitchBase",state:"checked"}),be=id(),ke=At=>{Q&&Q(At),be&&be.onFocus&&be.onFocus(At)},Ee=At=>{se&&se(At),be&&be.onBlur&&be.onBlur(At)},Lt=At=>{if(At.nativeEvent.defaultPrevented)return;const nn=At.target.checked;ge(nn),W&&W(At,nn)};let jt=a;be&&typeof jt>"u"&&(jt=be.disabled);const Qt=we==="checkbox"||we==="radio",Pt={...e,checked:X,disabled:jt,disableFocusRipple:I,edge:D},lt=Jve(Pt);return V.jsxs(exe,{component:"span",className:Nr(lt.root,_),centerRipple:!0,focusRipple:!I,disabled:jt,tabIndex:null,role:void 0,onFocus:ke,onBlur:Ee,ownerState:Pt,ref:r,...de,children:[V.jsx(txe,{autoFocus:o,checked:c,defaultChecked:x,className:lt.input,disabled:jt,id:Qt?F:void 0,name:ne,onChange:Lt,readOnly:K,ref:J,required:pe,ownerState:Pt,tabIndex:Te,type:we,...we==="checkbox"&&oe===void 0?{}:{value:oe},...Z}),X?f:O]})});function rxe(t){const e=gl(t);return e.body===t?Um(t).innerWidth>e.documentElement.clientWidth:t.scrollHeight>t.clientHeight}function Nx(t,e){e?t.setAttribute("aria-hidden","true"):t.removeAttribute("aria-hidden")}function x6(t){return parseInt(Um(t).getComputedStyle(t).paddingRight,10)||0}function ixe(t){const r=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].indexOf(t.tagName)!==-1,o=t.tagName==="INPUT"&&t.getAttribute("type")==="hidden";return r||o}function b6(t,e,r,o,c){const f=[e,r,...o];[].forEach.call(t.children,_=>{const x=f.indexOf(_)===-1,a=!ixe(_);x&&a&&Nx(_,c)})}function TM(t,e){let r=-1;return t.some((o,c)=>e(o)?(r=c,!0):!1),r}function sxe(t,e){const r=[],o=t.container;if(!e.disableScrollLock){if(rxe(o)){const _=QH(gl(o));r.push({value:o.style.paddingRight,property:"padding-right",el:o}),o.style.paddingRight=`${x6(o)+_}px`;const x=gl(o).querySelectorAll(".mui-fixed");[].forEach.call(x,a=>{r.push({value:a.style.paddingRight,property:"padding-right",el:a}),a.style.paddingRight=`${x6(a)+_}px`})}let f;if(o.parentNode instanceof DocumentFragment)f=gl(o).body;else{const _=o.parentElement,x=Um(o);f=(_==null?void 0:_.nodeName)==="HTML"&&x.getComputedStyle(_).overflowY==="scroll"?_:o}r.push({value:f.style.overflow,property:"overflow",el:f},{value:f.style.overflowX,property:"overflow-x",el:f},{value:f.style.overflowY,property:"overflow-y",el:f}),f.style.overflow="hidden"}return()=>{r.forEach(({value:f,el:_,property:x})=>{f?_.style.setProperty(x,f):_.style.removeProperty(x)})}}function oxe(t){const e=[];return[].forEach.call(t.children,r=>{r.getAttribute("aria-hidden")==="true"&&e.push(r)}),e}class axe{constructor(){this.modals=[],this.containers=[]}add(e,r){let o=this.modals.indexOf(e);if(o!==-1)return o;o=this.modals.length,this.modals.push(e),e.modalRef&&Nx(e.modalRef,!1);const c=oxe(r);b6(r,e.mount,e.modalRef,c,!0);const f=TM(this.containers,_=>_.container===r);return f!==-1?(this.containers[f].modals.push(e),o):(this.containers.push({modals:[e],container:r,restore:null,hiddenSiblings:c}),o)}mount(e,r){const o=TM(this.containers,f=>f.modals.indexOf(e)!==-1),c=this.containers[o];c.restore||(c.restore=sxe(c,r))}remove(e,r=!0){const o=this.modals.indexOf(e);if(o===-1)return o;const c=TM(this.containers,_=>_.modals.indexOf(e)!==-1),f=this.containers[c];if(f.modals.splice(f.modals.indexOf(e),1),this.modals.splice(o,1),f.modals.length===0)f.restore&&f.restore(),e.modalRef&&Nx(e.modalRef,r),b6(f.container,e.mount,e.modalRef,f.hiddenSiblings,!1),this.containers.splice(c,1);else{const _=f.modals[f.modals.length-1];_.modalRef&&Nx(_.modalRef,!1)}return o}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}}const lxe=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function cxe(t){const e=parseInt(t.getAttribute("tabindex")||"",10);return Number.isNaN(e)?t.contentEditable==="true"||(t.nodeName==="AUDIO"||t.nodeName==="VIDEO"||t.nodeName==="DETAILS")&&t.getAttribute("tabindex")===null?0:t.tabIndex:e}function uxe(t){if(t.tagName!=="INPUT"||t.type!=="radio"||!t.name)return!1;const e=o=>t.ownerDocument.querySelector(`input[type="radio"]${o}`);let r=e(`[name="${t.name}"]:checked`);return r||(r=e(`[name="${t.name}"]`)),r!==t}function hxe(t){return!(t.disabled||t.tagName==="INPUT"&&t.type==="hidden"||uxe(t))}function dxe(t){const e=[],r=[];return Array.from(t.querySelectorAll(lxe)).forEach((o,c)=>{const f=cxe(o);f===-1||!hxe(o)||(f===0?e.push(o):r.push({documentOrder:c,tabIndex:f,node:o}))}),r.sort((o,c)=>o.tabIndex===c.tabIndex?o.documentOrder-c.documentOrder:o.tabIndex-c.tabIndex).map(o=>o.node).concat(e)}function fxe(){return!0}function pxe(t){const{children:e,disableAutoFocus:r=!1,disableEnforceFocus:o=!1,disableRestoreFocus:c=!1,getTabbable:f=dxe,isEnabled:_=fxe,open:x}=t,a=ee.useRef(!1),I=ee.useRef(null),D=ee.useRef(null),O=ee.useRef(null),F=ee.useRef(null),Z=ee.useRef(!1),J=ee.useRef(null),ne=jo(pb(e),J),se=ee.useRef(null);ee.useEffect(()=>{!x||!J.current||(Z.current=!r)},[r,x]),ee.useEffect(()=>{if(!x||!J.current)return;const K=gl(J.current);return J.current.contains(K.activeElement)||(J.current.hasAttribute("tabIndex")||J.current.setAttribute("tabIndex","-1"),Z.current&&J.current.focus()),()=>{c||(O.current&&O.current.focus&&(a.current=!0,O.current.focus()),O.current=null)}},[x]),ee.useEffect(()=>{if(!x||!J.current)return;const K=gl(J.current),pe=oe=>{se.current=oe,!(o||!_()||oe.key!=="Tab")&&K.activeElement===J.current&&oe.shiftKey&&(a.current=!0,D.current&&D.current.focus())},Te=()=>{var X,ge;const oe=J.current;if(oe===null)return;if(!K.hasFocus()||!_()||a.current){a.current=!1;return}if(oe.contains(K.activeElement)||o&&K.activeElement!==I.current&&K.activeElement!==D.current)return;if(K.activeElement!==F.current)F.current=null;else if(F.current!==null)return;if(!Z.current)return;let de=[];if((K.activeElement===I.current||K.activeElement===D.current)&&(de=f(J.current)),de.length>0){const be=!!((X=se.current)!=null&&X.shiftKey&&((ge=se.current)==null?void 0:ge.key)==="Tab"),ke=de[0],Ee=de[de.length-1];typeof ke!="string"&&typeof Ee!="string"&&(be?Ee.focus():ke.focus())}else oe.focus()};K.addEventListener("focusin",Te),K.addEventListener("keydown",pe,!0);const we=setInterval(()=>{K.activeElement&&K.activeElement.tagName==="BODY"&&Te()},50);return()=>{clearInterval(we),K.removeEventListener("focusin",Te),K.removeEventListener("keydown",pe,!0)}},[r,o,c,_,x,f]);const W=K=>{O.current===null&&(O.current=K.relatedTarget),Z.current=!0,F.current=K.target;const pe=e.props.onFocus;pe&&pe(K)},Q=K=>{O.current===null&&(O.current=K.relatedTarget),Z.current=!0};return V.jsxs(ee.Fragment,{children:[V.jsx("div",{tabIndex:x?0:-1,onFocus:Q,ref:I,"data-testid":"sentinelStart"}),ee.cloneElement(e,{ref:ne,onFocus:W}),V.jsx("div",{tabIndex:x?0:-1,onFocus:Q,ref:D,"data-testid":"sentinelEnd"})]})}function mxe(t){return typeof t=="function"?t():t}function gxe(t){return t?t.props.hasOwnProperty("in"):!1}const _xe=new axe;function yxe(t){const{container:e,disableEscapeKeyDown:r=!1,disableScrollLock:o=!1,manager:c=_xe,closeAfterTransition:f=!1,onTransitionEnter:_,onTransitionExited:x,children:a,onClose:I,open:D,rootRef:O}=t,F=ee.useRef({}),Z=ee.useRef(null),J=ee.useRef(null),ne=jo(J,O),[se,W]=ee.useState(!D),Q=gxe(a);let K=!0;(t["aria-hidden"]==="false"||t["aria-hidden"]===!1)&&(K=!1);const pe=()=>gl(Z.current),Te=()=>(F.current.modalRef=J.current,F.current.mount=Z.current,F.current),we=()=>{c.mount(Te(),{disableScrollLock:o}),J.current&&(J.current.scrollTop=0)},oe=H_(()=>{const Qt=mxe(e)||pe().body;c.add(Te(),Qt),J.current&&we()}),de=ee.useCallback(()=>c.isTopModal(Te()),[c]),X=H_(Qt=>{Z.current=Qt,Qt&&(D&&de()?we():J.current&&Nx(J.current,K))}),ge=ee.useCallback(()=>{c.remove(Te(),K)},[K,c]);ee.useEffect(()=>()=>{ge()},[ge]),ee.useEffect(()=>{D?oe():(!Q||!f)&&ge()},[D,ge,Q,f,oe]);const be=Qt=>Pt=>{var lt;(lt=Qt.onKeyDown)==null||lt.call(Qt,Pt),!(Pt.key!=="Escape"||Pt.which===229||!de())&&(r||(Pt.stopPropagation(),I&&I(Pt,"escapeKeyDown")))},ke=Qt=>Pt=>{var lt;(lt=Qt.onClick)==null||lt.call(Qt,Pt),Pt.target===Pt.currentTarget&&I&&I(Pt,"backdropClick")};return{getRootProps:(Qt={})=>{const Pt=tZ(t);delete Pt.onTransitionEnter,delete Pt.onTransitionExited;const lt={...Pt,...Qt};return{role:"presentation",...lt,onKeyDown:be(lt),ref:ne}},getBackdropProps:(Qt={})=>{const Pt=Qt;return{"aria-hidden":!0,...Pt,onClick:ke(Pt),open:D}},getTransitionProps:()=>{const Qt=()=>{W(!1),_&&_()},Pt=()=>{W(!0),x&&x(),f&&ge()};return{onEnter:P3(Qt,a==null?void 0:a.props.onEnter),onExited:P3(Pt,a==null?void 0:a.props.onExited)}},rootRef:ne,portalRef:X,isTopModal:de,exited:se,hasTransition:Q}}function vxe(t){return Mi("MuiModal",t)}ki("MuiModal",["root","hidden","backdrop"]);const xxe=t=>{const{open:e,exited:r,classes:o}=t;return Li({root:["root",!e&&r&&"hidden"],backdrop:["backdrop"]},vxe,o)},bxe=tr("div",{name:"MuiModal",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,!r.open&&r.exited&&e.hidden]}})(ls(({theme:t})=>({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0,variants:[{props:({ownerState:e})=>!e.open&&e.exited,style:{visibility:"hidden"}}]}))),wxe=tr(Fve,{name:"MuiModal",slot:"Backdrop",overridesResolver:(t,e)=>e.backdrop})({zIndex:-1}),Txe=ee.forwardRef(function(e,r){const o=cs({name:"MuiModal",props:e}),{BackdropComponent:c=wxe,BackdropProps:f,classes:_,className:x,closeAfterTransition:a=!1,children:I,container:D,component:O,components:F={},componentsProps:Z={},disableAutoFocus:J=!1,disableEnforceFocus:ne=!1,disableEscapeKeyDown:se=!1,disablePortal:W=!1,disableRestoreFocus:Q=!1,disableScrollLock:K=!1,hideBackdrop:pe=!1,keepMounted:Te=!1,onBackdropClick:we,onClose:oe,onTransitionEnter:de,onTransitionExited:X,open:ge,slotProps:be={},slots:ke={},theme:Ee,...Lt}=o,jt={...o,closeAfterTransition:a,disableAutoFocus:J,disableEnforceFocus:ne,disableEscapeKeyDown:se,disablePortal:W,disableRestoreFocus:Q,disableScrollLock:K,hideBackdrop:pe,keepMounted:Te},{getRootProps:Qt,getBackdropProps:Pt,getTransitionProps:lt,portalRef:At,isTopModal:nn,exited:fn,hasTransition:mn}=yxe({...jt,rootRef:r}),Vt={...jt,exited:fn},wn=xxe(Vt),Ht={};if(I.props.tabIndex===void 0&&(Ht.tabIndex="-1"),mn){const{onEnter:xn,onExited:rr}=lt();Ht.onEnter=xn,Ht.onExited=rr}const Hn={slots:{root:F.Root,backdrop:F.Backdrop,...ke},slotProps:{...Z,...be}},[Jn,ir]=ql("root",{elementType:bxe,externalForwardedProps:Hn,getSlotProps:Qt,additionalProps:{ref:r,as:O},ownerState:Vt,className:Nr(x,wn==null?void 0:wn.root,!Vt.open&&Vt.exited&&(wn==null?void 0:wn.hidden))}),[Zt,zt]=ql("backdrop",{elementType:c,externalForwardedProps:Hn,additionalProps:f,getSlotProps:xn=>Pt({...xn,onClick:rr=>{we&&we(rr),xn!=null&&xn.onClick&&xn.onClick(rr)}}),className:Nr(f==null?void 0:f.className,wn==null?void 0:wn.backdrop),ownerState:Vt}),qt=jo(f==null?void 0:f.ref,zt.ref);return!Te&&!ge&&(!mn||fn)?null:V.jsx(bve,{ref:At,container:D,disablePortal:W,children:V.jsxs(Jn,{...ir,...Lt,children:[!pe&&c?V.jsx(Zt,{...zt,ref:qt}):null,V.jsx(pxe,{disableEnforceFocus:ne,disableAutoFocus:J,disableRestoreFocus:Q,isEnabled:nn,open:ge,children:ee.cloneElement(I,Ht)})]})})}),Exe=t=>{const{classes:e,disableUnderline:r,startAdornment:o,endAdornment:c,size:f,hiddenLabel:_,multiline:x}=t,a={root:["root",!r&&"underline",o&&"adornedStart",c&&"adornedEnd",f==="small"&&`size${Qn(f)}`,_&&"hiddenLabel",x&&"multiline"],input:["input"]},I=Li(a,Mve,e);return{...e,...I}},Sxe=tr(UA,{shouldForwardProp:t=>Ha(t)||t==="classes",name:"MuiFilledInput",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[...BA(t,e),!r.disableUnderline&&e.underline]}})(ls(({theme:t})=>{const e=t.palette.mode==="light",r=e?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",o=e?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",c=e?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",f=e?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return{position:"relative",backgroundColor:t.vars?t.vars.palette.FilledInput.bg:o,borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),"&:hover":{backgroundColor:t.vars?t.vars.palette.FilledInput.hoverBg:c,"@media (hover: none)":{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:o}},[`&.${Jp.focused}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:o},[`&.${Jp.disabled}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.disabledBg:f},variants:[{props:({ownerState:_})=>!_.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Jp.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Jp.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`:r}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Jp.disabled}, .${Jp.error}):before`]:{borderBottom:`1px solid ${(t.vars||t).palette.text.primary}`},[`&.${Jp.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(t.palette).filter(([,_])=>_&&_.main).map(([_])=>{var x;return{props:{disableUnderline:!1,color:_},style:{"&::after":{borderBottom:`2px solid ${(x=(t.vars||t).palette[_])==null?void 0:x.main}`}}}}),{props:({ownerState:_})=>_.startAdornment,style:{paddingLeft:12}},{props:({ownerState:_})=>_.endAdornment,style:{paddingRight:12}},{props:({ownerState:_})=>_.multiline,style:{padding:"25px 12px 8px"}},{props:({ownerState:_,size:x})=>_.multiline&&x==="small",style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:_})=>_.multiline&&_.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:_})=>_.multiline&&_.hiddenLabel&&_.size==="small",style:{paddingTop:8,paddingBottom:9}}]}})),Ixe=tr(VA,{name:"MuiFilledInput",slot:"Input",overridesResolver:jA})(ls(({theme:t})=>({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12,...!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:t.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:t.palette.mode==="light"?null:"#fff",caretColor:t.palette.mode==="light"?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},...t.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:e})=>e.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:e})=>e.startAdornment,style:{paddingLeft:0}},{props:({ownerState:e})=>e.endAdornment,style:{paddingRight:0}},{props:({ownerState:e})=>e.hiddenLabel&&e.size==="small",style:{paddingTop:8,paddingBottom:9}},{props:({ownerState:e})=>e.multiline,style:{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0}}]}))),GS=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiFilledInput"}),{disableUnderline:c=!1,components:f={},componentsProps:_,fullWidth:x=!1,hiddenLabel:a,inputComponent:I="input",multiline:D=!1,slotProps:O,slots:F={},type:Z="text",...J}=o,ne={...o,disableUnderline:c,fullWidth:x,inputComponent:I,multiline:D,type:Z},se=Exe(o),W={root:{ownerState:ne},input:{ownerState:ne}},Q=O??_?na(W,O??_):W,K=F.root??f.Root??Sxe,pe=F.input??f.Input??Ixe;return V.jsx(w4,{slots:{root:K,input:pe},componentsProps:Q,fullWidth:x,inputComponent:I,multiline:D,ref:r,type:Z,...J,classes:se})});GS&&(GS.muiName="Input");function Axe(t){return Mi("MuiFormControl",t)}ki("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const Cxe=t=>{const{classes:e,margin:r,fullWidth:o}=t,c={root:["root",r!=="none"&&`margin${Qn(r)}`,o&&"fullWidth"]};return Li(c,Axe,e)},Pxe=tr("div",{name:"MuiFormControl",slot:"Root",overridesResolver:({ownerState:t},e)=>({...e.root,...e[`margin${Qn(t.margin)}`],...t.fullWidth&&e.fullWidth})})({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top",variants:[{props:{margin:"normal"},style:{marginTop:16,marginBottom:8}},{props:{margin:"dense"},style:{marginTop:8,marginBottom:4}},{props:{fullWidth:!0},style:{width:"100%"}}]}),Rxe=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiFormControl"}),{children:c,className:f,color:_="primary",component:x="div",disabled:a=!1,error:I=!1,focused:D,fullWidth:O=!1,hiddenLabel:F=!1,margin:Z="none",required:J=!1,size:ne="medium",variant:se="outlined",...W}=o,Q={...o,color:_,component:x,disabled:a,error:I,fullWidth:O,hiddenLabel:F,margin:Z,required:J,size:ne,variant:se},K=Cxe(Q),[pe,Te]=ee.useState(()=>{let Ee=!1;return c&&ee.Children.forEach(c,Lt=>{if(!_M(Lt,["Input","Select"]))return;const jt=_M(Lt,["Select"])?Lt.props.input:Lt;jt&&Sve(jt.props)&&(Ee=!0)}),Ee}),[we,oe]=ee.useState(()=>{let Ee=!1;return c&&ee.Children.forEach(c,Lt=>{_M(Lt,["Input","Select"])&&($S(Lt.props,!0)||$S(Lt.props.inputProps,!0))&&(Ee=!0)}),Ee}),[de,X]=ee.useState(!1);a&&de&&X(!1);const ge=D!==void 0&&!a?D:de;let be;const ke=ee.useMemo(()=>({adornedStart:pe,setAdornedStart:Te,color:_,disabled:a,error:I,filled:we,focused:ge,fullWidth:O,hiddenLabel:F,size:ne,onBlur:()=>{X(!1)},onEmpty:()=>{oe(!1)},onFilled:()=>{oe(!0)},onFocus:()=>{X(!0)},registerEffect:be,required:J,variant:se}),[pe,_,a,I,we,ge,O,F,be,J,ne,se]);return V.jsx(b4.Provider,{value:ke,children:V.jsx(Pxe,{as:x,ownerState:Q,className:Nr(K.root,f),ref:r,...W,children:c})})});function Mxe(t){return Mi("MuiFormControlLabel",t)}const cx=ki("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),kxe=t=>{const{classes:e,disabled:r,labelPlacement:o,error:c,required:f}=t,_={root:["root",r&&"disabled",`labelPlacement${Qn(o)}`,c&&"error",f&&"required"],label:["label",r&&"disabled"],asterisk:["asterisk",c&&"error"]};return Li(_,Mxe,e)},Dxe=tr("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[{[`& .${cx.label}`]:e.label},e.root,e[`labelPlacement${Qn(r.labelPlacement)}`]]}})(ls(({theme:t})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${cx.disabled}`]:{cursor:"default"},[`& .${cx.label}`]:{[`&.${cx.disabled}`]:{color:(t.vars||t).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:e})=>e==="start"||e==="top"||e==="bottom",style:{marginLeft:16}}]}))),Oxe=tr("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(t,e)=>e.asterisk})(ls(({theme:t})=>({[`&.${cx.error}`]:{color:(t.vars||t).palette.error.main}}))),Lxe=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiFormControlLabel"}),{checked:c,className:f,componentsProps:_={},control:x,disabled:a,disableTypography:I,inputRef:D,label:O,labelPlacement:F="end",name:Z,onChange:J,required:ne,slots:se={},slotProps:W={},value:Q,...K}=o,pe=id(),Te=a??x.props.disabled??(pe==null?void 0:pe.disabled),we=ne??x.props.required,oe={disabled:Te,required:we};["checked","name","onChange","value","inputRef"].forEach(jt=>{typeof x.props[jt]>"u"&&typeof o[jt]<"u"&&(oe[jt]=o[jt])});const de=ep({props:o,muiFormControl:pe,states:["error"]}),X={...o,disabled:Te,labelPlacement:F,required:we,error:de.error},ge=kxe(X),be={slots:se,slotProps:{..._,...W}},[ke,Ee]=ql("typography",{elementType:g6,externalForwardedProps:be,ownerState:X});let Lt=O;return Lt!=null&&Lt.type!==g6&&!I&&(Lt=V.jsx(ke,{component:"span",...Ee,className:Nr(ge.label,Ee==null?void 0:Ee.className),children:Lt})),V.jsxs(Dxe,{className:Nr(ge.root,f),ownerState:X,ref:r,...K,children:[ee.cloneElement(x,oe),we?V.jsxs("div",{children:[Lt,V.jsxs(Oxe,{ownerState:X,"aria-hidden":!0,className:ge.asterisk,children:["","*"]})]}):Lt]})});function zxe(t){return Mi("MuiFormGroup",t)}ki("MuiFormGroup",["root","row","error"]);const Nxe=t=>{const{classes:e,row:r,error:o}=t;return Li({root:["root",r&&"row",o&&"error"]},zxe,e)},Fxe=tr("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.row&&e.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),Bxe=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiFormGroup"}),{className:c,row:f=!1,..._}=o,x=id(),a=ep({props:o,muiFormControl:x,states:["error"]}),I={...o,row:f,error:a.error},D=Nxe(I);return V.jsx(Fxe,{className:Nr(D.root,c),ownerState:I,ref:r,..._})});function jxe(t){return Mi("MuiFormHelperText",t)}const w6=ki("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var T6;const Uxe=t=>{const{classes:e,contained:r,size:o,disabled:c,error:f,filled:_,focused:x,required:a}=t,I={root:["root",c&&"disabled",f&&"error",o&&`size${Qn(o)}`,r&&"contained",x&&"focused",_&&"filled",a&&"required"]};return Li(I,jxe,e)},Vxe=tr("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.size&&e[`size${Qn(r.size)}`],r.contained&&e.contained,r.filled&&e.filled]}})(ls(({theme:t})=>({color:(t.vars||t).palette.text.secondary,...t.typography.caption,textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${w6.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${w6.error}`]:{color:(t.vars||t).palette.error.main},variants:[{props:{size:"small"},style:{marginTop:4}},{props:({ownerState:e})=>e.contained,style:{marginLeft:14,marginRight:14}}]}))),$xe=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiFormHelperText"}),{children:c,className:f,component:_="p",disabled:x,error:a,filled:I,focused:D,margin:O,required:F,variant:Z,...J}=o,ne=id(),se=ep({props:o,muiFormControl:ne,states:["variant","size","disabled","error","filled","focused","required"]}),W={...o,component:_,contained:se.variant==="filled"||se.variant==="outlined",variant:se.variant,size:se.size,disabled:se.disabled,error:se.error,filled:se.filled,focused:se.focused,required:se.required};delete W.ownerState;const Q=Uxe(W);return V.jsx(Vxe,{as:_,className:Nr(Q.root,f),ref:r,...J,ownerState:W,children:c===" "?T6||(T6=V.jsx("span",{className:"notranslate",children:""})):c})});function Gxe(t){return Mi("MuiFormLabel",t)}const Fx=ki("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),qxe=t=>{const{classes:e,color:r,focused:o,disabled:c,error:f,filled:_,required:x}=t,a={root:["root",`color${Qn(r)}`,c&&"disabled",f&&"error",_&&"filled",o&&"focused",x&&"required"],asterisk:["asterisk",f&&"error"]};return Li(a,Gxe,e)},Wxe=tr("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:({ownerState:t},e)=>({...e.root,...t.color==="secondary"&&e.colorSecondary,...t.filled&&e.filled})})(ls(({theme:t})=>({color:(t.vars||t).palette.text.secondary,...t.typography.body1,lineHeight:"1.4375em",padding:0,position:"relative",variants:[...Object.entries(t.palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e},style:{[`&.${Fx.focused}`]:{color:(t.vars||t).palette[e].main}}})),{props:{},style:{[`&.${Fx.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${Fx.error}`]:{color:(t.vars||t).palette.error.main}}}]}))),Hxe=tr("span",{name:"MuiFormLabel",slot:"Asterisk",overridesResolver:(t,e)=>e.asterisk})(ls(({theme:t})=>({[`&.${Fx.error}`]:{color:(t.vars||t).palette.error.main}}))),Zxe=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiFormLabel"}),{children:c,className:f,color:_,component:x="label",disabled:a,error:I,filled:D,focused:O,required:F,...Z}=o,J=id(),ne=ep({props:o,muiFormControl:J,states:["color","required","focused","disabled","error","filled"]}),se={...o,color:ne.color||"primary",component:x,disabled:ne.disabled,error:ne.error,filled:ne.filled,focused:ne.focused,required:ne.required},W=qxe(se);return V.jsxs(Wxe,{as:x,ownerState:se,className:Nr(W.root,f),ref:r,...Z,children:[c,ne.required&&V.jsxs(Hxe,{ownerState:se,"aria-hidden":!0,className:W.asterisk,children:["","*"]})]})});function F3(t){return`scale(${t}, ${t**2})`}const Xxe={entering:{opacity:1,transform:F3(1)},entered:{opacity:1,transform:"none"}},EM=typeof navigator<"u"&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),B3=ee.forwardRef(function(e,r){const{addEndListener:o,appear:c=!0,children:f,easing:_,in:x,onEnter:a,onEntered:I,onEntering:D,onExit:O,onExited:F,onExiting:Z,style:J,timeout:ne="auto",TransitionComponent:se=Ku,...W}=e,Q=YH(),K=ee.useRef(),pe=_4(),Te=ee.useRef(null),we=jo(Te,pb(f),r),oe=jt=>Qt=>{if(jt){const Pt=Te.current;Qt===void 0?jt(Pt):jt(Pt,Qt)}},de=oe(D),X=oe((jt,Qt)=>{cZ(jt);const{duration:Pt,delay:lt,easing:At}=US({style:J,timeout:ne,easing:_},{mode:"enter"});let nn;ne==="auto"?(nn=pe.transitions.getAutoHeightDuration(jt.clientHeight),K.current=nn):nn=Pt,jt.style.transition=[pe.transitions.create("opacity",{duration:nn,delay:lt}),pe.transitions.create("transform",{duration:EM?nn:nn*.666,delay:lt,easing:At})].join(","),a&&a(jt,Qt)}),ge=oe(I),be=oe(Z),ke=oe(jt=>{const{duration:Qt,delay:Pt,easing:lt}=US({style:J,timeout:ne,easing:_},{mode:"exit"});let At;ne==="auto"?(At=pe.transitions.getAutoHeightDuration(jt.clientHeight),K.current=At):At=Qt,jt.style.transition=[pe.transitions.create("opacity",{duration:At,delay:Pt}),pe.transitions.create("transform",{duration:EM?At:At*.666,delay:EM?Pt:Pt||At*.333,easing:lt})].join(","),jt.style.opacity=0,jt.style.transform=F3(.75),O&&O(jt)}),Ee=oe(F),Lt=jt=>{ne==="auto"&&Q.start(K.current||0,jt),o&&o(Te.current,jt)};return V.jsx(se,{appear:c,in:x,nodeRef:Te,onEnter:X,onEntered:ge,onEntering:de,onExit:ke,onExited:Ee,onExiting:be,addEndListener:Lt,timeout:ne==="auto"?null:ne,...W,children:(jt,Qt)=>ee.cloneElement(f,{style:{opacity:0,transform:F3(.75),visibility:jt==="exited"&&!x?"hidden":void 0,...Xxe[jt],...J,...f.props.style},ref:we,...Qt})})});B3&&(B3.muiSupportAuto=!0);const Kxe=t=>{const{classes:e,disableUnderline:r}=t,c=Li({root:["root",!r&&"underline"],input:["input"]},Pve,e);return{...e,...c}},Yxe=tr(UA,{shouldForwardProp:t=>Ha(t)||t==="classes",name:"MuiInput",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[...BA(t,e),!r.disableUnderline&&e.underline]}})(ls(({theme:t})=>{let r=t.palette.mode==="light"?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return t.vars&&(r=`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`),{position:"relative",variants:[{props:({ownerState:o})=>o.formControl,style:{"label + &":{marginTop:16}}},{props:({ownerState:o})=>!o.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${jv.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${jv.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${r}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${jv.disabled}, .${jv.error}):before`]:{borderBottom:`2px solid ${(t.vars||t).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${r}`}},[`&.${jv.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(t.palette).filter(([,o])=>o&&o.main).map(([o])=>({props:{color:o,disableUnderline:!1},style:{"&::after":{borderBottom:`2px solid ${(t.vars||t).palette[o].main}`}}}))]}})),Qxe=tr(VA,{name:"MuiInput",slot:"Input",overridesResolver:jA})({}),qS=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiInput"}),{disableUnderline:c=!1,components:f={},componentsProps:_,fullWidth:x=!1,inputComponent:a="input",multiline:I=!1,slotProps:D,slots:O={},type:F="text",...Z}=o,J=Kxe(o),se={root:{ownerState:{disableUnderline:c}}},W=D??_?na(D??_,se):se,Q=O.root??f.Root??Yxe,K=O.input??f.Input??Qxe;return V.jsx(w4,{slots:{root:Q,input:K},slotProps:W,fullWidth:x,inputComponent:a,multiline:I,ref:r,type:F,...Z,classes:J})});qS&&(qS.muiName="Input");function Jxe(t){return Mi("MuiInputLabel",t)}ki("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const e1e=t=>{const{classes:e,formControl:r,size:o,shrink:c,disableAnimation:f,variant:_,required:x}=t,a={root:["root",r&&"formControl",!f&&"animated",c&&"shrink",o&&o!=="normal"&&`size${Qn(o)}`,_],asterisk:[x&&"asterisk"]},I=Li(a,Jxe,e);return{...e,...I}},t1e=tr(Zxe,{shouldForwardProp:t=>Ha(t)||t==="classes",name:"MuiInputLabel",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[{[`& .${Fx.asterisk}`]:e.asterisk},e.root,r.formControl&&e.formControl,r.size==="small"&&e.sizeSmall,r.shrink&&e.shrink,!r.disableAnimation&&e.animated,r.focused&&e.focused,e[r.variant]]}})(ls(({theme:t})=>({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",variants:[{props:({ownerState:e})=>e.formControl,style:{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"}},{props:{size:"small"},style:{transform:"translate(0, 17px) scale(1)"}},{props:({ownerState:e})=>e.shrink,style:{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"}},{props:({ownerState:e})=>!e.disableAnimation,style:{transition:t.transitions.create(["color","transform","max-width"],{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut})}},{props:{variant:"filled"},style:{zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"filled",size:"small"},style:{transform:"translate(12px, 13px) scale(1)"}},{props:({variant:e,ownerState:r})=>e==="filled"&&r.shrink,style:{userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"}},{props:({variant:e,ownerState:r,size:o})=>e==="filled"&&r.shrink&&o==="small",style:{transform:"translate(12px, 4px) scale(0.75)"}},{props:{variant:"outlined"},style:{zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"outlined",size:"small"},style:{transform:"translate(14px, 9px) scale(1)"}},{props:({variant:e,ownerState:r})=>e==="outlined"&&r.shrink,style:{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}}]}))),n1e=ee.forwardRef(function(e,r){const o=cs({name:"MuiInputLabel",props:e}),{disableAnimation:c=!1,margin:f,shrink:_,variant:x,className:a,...I}=o,D=id();let O=_;typeof O>"u"&&D&&(O=D.filled||D.focused||D.adornedStart);const F=ep({props:o,muiFormControl:D,states:["size","variant","required","focused"]}),Z={...o,disableAnimation:c,formControl:D,shrink:O,size:F.size,variant:F.variant,required:F.required,focused:F.focused},J=e1e(Z);return V.jsx(t1e,{"data-shrink":O,ref:r,className:Nr(J.root,a),...I,ownerState:Z,classes:J})}),r1e=ee.createContext({});function i1e(t){return Mi("MuiList",t)}ki("MuiList",["root","padding","dense","subheader"]);const s1e=t=>{const{classes:e,disablePadding:r,dense:o,subheader:c}=t;return Li({root:["root",!r&&"padding",o&&"dense",c&&"subheader"]},i1e,e)},o1e=tr("ul",{name:"MuiList",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,!r.disablePadding&&e.padding,r.dense&&e.dense,r.subheader&&e.subheader]}})({listStyle:"none",margin:0,padding:0,position:"relative",variants:[{props:({ownerState:t})=>!t.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:t})=>t.subheader,style:{paddingTop:0}}]}),a1e=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiList"}),{children:c,className:f,component:_="ul",dense:x=!1,disablePadding:a=!1,subheader:I,...D}=o,O=ee.useMemo(()=>({dense:x}),[x]),F={...o,component:_,dense:x,disablePadding:a},Z=s1e(F);return V.jsx(r1e.Provider,{value:O,children:V.jsxs(o1e,{as:_,className:Nr(Z.root,f),ref:r,ownerState:F,...D,children:[I,c]})})});function SM(t,e,r){return t===e?t.firstChild:e&&e.nextElementSibling?e.nextElementSibling:r?null:t.firstChild}function E6(t,e,r){return t===e?r?t.firstChild:t.lastChild:e&&e.previousElementSibling?e.previousElementSibling:r?null:t.lastChild}function hZ(t,e){if(e===void 0)return!0;let r=t.innerText;return r===void 0&&(r=t.textContent),r=r.trim().toLowerCase(),r.length===0?!1:e.repeating?r[0]===e.keys[0]:r.startsWith(e.keys.join(""))}function Uv(t,e,r,o,c,f){let _=!1,x=c(t,e,e?r:!1);for(;x;){if(x===t.firstChild){if(_)return!1;_=!0}const a=o?!1:x.disabled||x.getAttribute("aria-disabled")==="true";if(!x.hasAttribute("tabindex")||!hZ(x,f)||a)x=c(t,x,r);else return x.focus(),!0}return!1}const l1e=ee.forwardRef(function(e,r){const{actions:o,autoFocus:c=!1,autoFocusItem:f=!1,children:_,className:x,disabledItemsFocusable:a=!1,disableListWrap:I=!1,onKeyDown:D,variant:O="selectedMenu",...F}=e,Z=ee.useRef(null),J=ee.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});jm(()=>{c&&Z.current.focus()},[c]),ee.useImperativeHandle(o,()=>({adjustStyleForScrollbar:(K,{direction:pe})=>{const Te=!Z.current.style.width;if(K.clientHeight<Z.current.clientHeight&&Te){const we=`${QH(gl(K))}px`;Z.current.style[pe==="rtl"?"paddingLeft":"paddingRight"]=we,Z.current.style.width=`calc(100% + ${we})`}return Z.current}}),[]);const ne=K=>{const pe=Z.current,Te=K.key;if(K.ctrlKey||K.metaKey||K.altKey){D&&D(K);return}const oe=gl(pe).activeElement;if(Te==="ArrowDown")K.preventDefault(),Uv(pe,oe,I,a,SM);else if(Te==="ArrowUp")K.preventDefault(),Uv(pe,oe,I,a,E6);else if(Te==="Home")K.preventDefault(),Uv(pe,null,I,a,SM);else if(Te==="End")K.preventDefault(),Uv(pe,null,I,a,E6);else if(Te.length===1){const de=J.current,X=Te.toLowerCase(),ge=performance.now();de.keys.length>0&&(ge-de.lastTime>500?(de.keys=[],de.repeating=!0,de.previousKeyMatched=!0):de.repeating&&X!==de.keys[0]&&(de.repeating=!1)),de.lastTime=ge,de.keys.push(X);const be=oe&&!de.repeating&&hZ(oe,de);de.previousKeyMatched&&(be||Uv(pe,oe,!1,a,SM,de))?K.preventDefault():de.previousKeyMatched=!1}D&&D(K)},se=jo(Z,r);let W=-1;ee.Children.forEach(_,(K,pe)=>{if(!ee.isValidElement(K)){W===pe&&(W+=1,W>=_.length&&(W=-1));return}K.props.disabled||(O==="selectedMenu"&&K.props.selected||W===-1)&&(W=pe),W===pe&&(K.props.disabled||K.props.muiSkipListHighlight||K.type.muiSkipListHighlight)&&(W+=1,W>=_.length&&(W=-1))});const Q=ee.Children.map(_,(K,pe)=>{if(pe===W){const Te={};return f&&(Te.autoFocus=!0),K.props.tabIndex===void 0&&O==="selectedMenu"&&(Te.tabIndex=0),ee.cloneElement(K,Te)}return K});return V.jsx(a1e,{role:"menu",ref:se,className:x,onKeyDown:ne,tabIndex:c?0:-1,...F,children:Q})});function c1e(t){return Mi("MuiPopover",t)}ki("MuiPopover",["root","paper"]);function S6(t,e){let r=0;return typeof e=="number"?r=e:e==="center"?r=t.height/2:e==="bottom"&&(r=t.height),r}function I6(t,e){let r=0;return typeof e=="number"?r=e:e==="center"?r=t.width/2:e==="right"&&(r=t.width),r}function A6(t){return[t.horizontal,t.vertical].map(e=>typeof e=="number"?`${e}px`:e).join(" ")}function IM(t){return typeof t=="function"?t():t}const u1e=t=>{const{classes:e}=t;return Li({root:["root"],paper:["paper"]},c1e,e)},h1e=tr(Txe,{name:"MuiPopover",slot:"Root",overridesResolver:(t,e)=>e.root})({}),dZ=tr(K0e,{name:"MuiPopover",slot:"Paper",overridesResolver:(t,e)=>e.paper})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),d1e=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiPopover"}),{action:c,anchorEl:f,anchorOrigin:_={vertical:"top",horizontal:"left"},anchorPosition:x,anchorReference:a="anchorEl",children:I,className:D,container:O,elevation:F=8,marginThreshold:Z=16,open:J,PaperProps:ne={},slots:se={},slotProps:W={},transformOrigin:Q={vertical:"top",horizontal:"left"},TransitionComponent:K=B3,transitionDuration:pe="auto",TransitionProps:{onEntering:Te,...we}={},disableScrollLock:oe=!1,...de}=o,X=(W==null?void 0:W.paper)??ne,ge=ee.useRef(),be={...o,anchorOrigin:_,anchorReference:a,elevation:F,marginThreshold:Z,externalPaperSlotProps:X,transformOrigin:Q,TransitionComponent:K,transitionDuration:pe,TransitionProps:we},ke=u1e(be),Ee=ee.useCallback(()=>{if(a==="anchorPosition")return x;const zt=IM(f),xn=(zt&&zt.nodeType===1?zt:gl(ge.current).body).getBoundingClientRect();return{top:xn.top+S6(xn,_.vertical),left:xn.left+I6(xn,_.horizontal)}},[f,_.horizontal,_.vertical,x,a]),Lt=ee.useCallback(zt=>({vertical:S6(zt,Q.vertical),horizontal:I6(zt,Q.horizontal)}),[Q.horizontal,Q.vertical]),jt=ee.useCallback(zt=>{const qt={width:zt.offsetWidth,height:zt.offsetHeight},xn=Lt(qt);if(a==="none")return{top:null,left:null,transformOrigin:A6(xn)};const rr=Ee();let Gn=rr.top-xn.vertical,yr=rr.left-xn.horizontal;const Gr=Gn+qt.height,mr=yr+qt.width,wr=Um(IM(f)),wt=wr.innerHeight-Z,St=wr.innerWidth-Z;if(Z!==null&&Gn<Z){const Ct=Gn-Z;Gn-=Ct,xn.vertical+=Ct}else if(Z!==null&&Gr>wt){const Ct=Gr-wt;Gn-=Ct,xn.vertical+=Ct}if(Z!==null&&yr<Z){const Ct=yr-Z;yr-=Ct,xn.horizontal+=Ct}else if(mr>St){const Ct=mr-St;yr-=Ct,xn.horizontal+=Ct}return{top:`${Math.round(Gn)}px`,left:`${Math.round(yr)}px`,transformOrigin:A6(xn)}},[f,a,Ee,Lt,Z]),[Qt,Pt]=ee.useState(J),lt=ee.useCallback(()=>{const zt=ge.current;if(!zt)return;const qt=jt(zt);qt.top!==null&&(zt.style.top=qt.top),qt.left!==null&&(zt.style.left=qt.left),zt.style.transformOrigin=qt.transformOrigin,Pt(!0)},[jt]);ee.useEffect(()=>(oe&&window.addEventListener("scroll",lt),()=>window.removeEventListener("scroll",lt)),[f,oe,lt]);const At=(zt,qt)=>{Te&&Te(zt,qt),lt()},nn=()=>{Pt(!1)};ee.useEffect(()=>{J&&lt()}),ee.useImperativeHandle(c,()=>J?{updatePosition:()=>{lt()}}:null,[J,lt]),ee.useEffect(()=>{if(!J)return;const zt=XH(()=>{lt()}),qt=Um(f);return qt.addEventListener("resize",zt),()=>{zt.clear(),qt.removeEventListener("resize",zt)}},[f,J,lt]);let fn=pe;pe==="auto"&&!K.muiSupportAuto&&(fn=void 0);const mn=O||(f?gl(IM(f)).body:void 0),Vt={slots:se,slotProps:{...W,paper:X}},[wn,Ht]=ql("paper",{elementType:dZ,externalForwardedProps:Vt,additionalProps:{elevation:F,className:Nr(ke.paper,X==null?void 0:X.className),style:Qt?X.style:{...X.style,opacity:0}},ownerState:be}),[Hn,{slotProps:Jn,...ir}]=ql("root",{elementType:h1e,externalForwardedProps:Vt,additionalProps:{slotProps:{backdrop:{invisible:!0}},container:mn,open:J},ownerState:be,className:Nr(ke.root,D)}),Zt=jo(ge,Ht.ref);return V.jsx(Hn,{...ir,...!z3(Hn)&&{slotProps:Jn,disableScrollLock:oe},...de,ref:r,children:V.jsx(K,{appear:!0,in:J,onEntering:At,onExited:nn,timeout:fn,...we,children:V.jsx(wn,{...Ht,ref:Zt,children:I})})})});function f1e(t){return Mi("MuiMenu",t)}ki("MuiMenu",["root","paper","list"]);const p1e={vertical:"top",horizontal:"right"},m1e={vertical:"top",horizontal:"left"},g1e=t=>{const{classes:e}=t;return Li({root:["root"],paper:["paper"],list:["list"]},f1e,e)},_1e=tr(d1e,{shouldForwardProp:t=>Ha(t)||t==="classes",name:"MuiMenu",slot:"Root",overridesResolver:(t,e)=>e.root})({}),y1e=tr(dZ,{name:"MuiMenu",slot:"Paper",overridesResolver:(t,e)=>e.paper})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),v1e=tr(l1e,{name:"MuiMenu",slot:"List",overridesResolver:(t,e)=>e.list})({outline:0}),x1e=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiMenu"}),{autoFocus:c=!0,children:f,className:_,disableAutoFocusItem:x=!1,MenuListProps:a={},onClose:I,open:D,PaperProps:O={},PopoverClasses:F,transitionDuration:Z="auto",TransitionProps:{onEntering:J,...ne}={},variant:se="selectedMenu",slots:W={},slotProps:Q={},...K}=o,pe=Hye(),Te={...o,autoFocus:c,disableAutoFocusItem:x,MenuListProps:a,onEntering:J,PaperProps:O,transitionDuration:Z,TransitionProps:ne,variant:se},we=g1e(Te),oe=c&&!x&&D,de=ee.useRef(null),X=(Qt,Pt)=>{de.current&&de.current.adjustStyleForScrollbar(Qt,{direction:pe?"rtl":"ltr"}),J&&J(Qt,Pt)},ge=Qt=>{Qt.key==="Tab"&&(Qt.preventDefault(),I&&I(Qt,"tabKeyDown"))};let be=-1;ee.Children.map(f,(Qt,Pt)=>{ee.isValidElement(Qt)&&(Qt.props.disabled||(se==="selectedMenu"&&Qt.props.selected||be===-1)&&(be=Pt))});const ke=W.paper??y1e,Ee=Q.paper??O,Lt=FS({elementType:W.root,externalSlotProps:Q.root,ownerState:Te,className:[we.root,_]}),jt=FS({elementType:ke,externalSlotProps:Ee,ownerState:Te,className:we.paper});return V.jsx(_1e,{onClose:I,anchorOrigin:{vertical:"bottom",horizontal:pe?"right":"left"},transformOrigin:pe?p1e:m1e,slots:{paper:ke,root:W.root},slotProps:{root:Lt,paper:jt},open:D,ref:r,transitionDuration:Z,TransitionProps:{onEntering:X,...ne},ownerState:Te,...K,classes:F,children:V.jsx(v1e,{onKeyDown:ge,actions:de,autoFocus:c&&(be===-1||x),autoFocusItem:oe,variant:se,...a,className:Nr(we.list,a.className),children:f})})});function b1e(t){return Mi("MuiNativeSelect",t)}const T4=ki("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),w1e=t=>{const{classes:e,variant:r,disabled:o,multiple:c,open:f,error:_}=t,x={select:["select",r,o&&"disabled",c&&"multiple",_&&"error"],icon:["icon",`icon${Qn(r)}`,f&&"iconOpen",o&&"disabled"]};return Li(x,b1e,e)},fZ=tr("select")(({theme:t})=>({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":{borderRadius:0},[`&.${T4.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(t.vars||t).palette.background.paper},variants:[{props:({ownerState:e})=>e.variant!=="filled"&&e.variant!=="outlined",style:{"&&&":{paddingRight:24,minWidth:16}}},{props:{variant:"filled"},style:{"&&&":{paddingRight:32}}},{props:{variant:"outlined"},style:{borderRadius:(t.vars||t).shape.borderRadius,"&:focus":{borderRadius:(t.vars||t).shape.borderRadius},"&&&":{paddingRight:32}}}]})),T1e=tr(fZ,{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:Ha,overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.select,e[r.variant],r.error&&e.error,{[`&.${T4.multiple}`]:e.multiple}]}})({}),pZ=tr("svg")(({theme:t})=>({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(t.vars||t).palette.action.active,[`&.${T4.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:({ownerState:e})=>e.open,style:{transform:"rotate(180deg)"}},{props:{variant:"filled"},style:{right:7}},{props:{variant:"outlined"},style:{right:7}}]})),E1e=tr(pZ,{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.icon,r.variant&&e[`icon${Qn(r.variant)}`],r.open&&e.iconOpen]}})({}),S1e=ee.forwardRef(function(e,r){const{className:o,disabled:c,error:f,IconComponent:_,inputRef:x,variant:a="standard",...I}=e,D={...e,disabled:c,variant:a,error:f},O=w1e(D);return V.jsxs(ee.Fragment,{children:[V.jsx(T1e,{ownerState:D,className:Nr(O.select,o),disabled:c,ref:x||r,...I}),e.multiple?null:V.jsx(E1e,{as:_,ownerState:D,className:O.icon})]})});var C6;const I1e=tr("fieldset",{shouldForwardProp:Ha})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),A1e=tr("legend",{shouldForwardProp:Ha})(ls(({theme:t})=>({float:"unset",width:"auto",overflow:"hidden",variants:[{props:({ownerState:e})=>!e.withLabel,style:{padding:0,lineHeight:"11px",transition:t.transitions.create("width",{duration:150,easing:t.transitions.easing.easeOut})}},{props:({ownerState:e})=>e.withLabel,style:{display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:t.transitions.create("max-width",{duration:50,easing:t.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}}},{props:({ownerState:e})=>e.withLabel&&e.notched,style:{maxWidth:"100%",transition:t.transitions.create("max-width",{duration:100,easing:t.transitions.easing.easeOut,delay:50})}}]})));function C1e(t){const{children:e,classes:r,className:o,label:c,notched:f,..._}=t,x=c!=null&&c!=="",a={...t,notched:f,withLabel:x};return V.jsx(I1e,{"aria-hidden":!0,className:o,ownerState:a,..._,children:V.jsx(A1e,{ownerState:a,children:x?V.jsx("span",{children:c}):C6||(C6=V.jsx("span",{className:"notranslate",children:""}))})})}const P1e=t=>{const{classes:e}=t,o=Li({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},Rve,e);return{...e,...o}},R1e=tr(UA,{shouldForwardProp:t=>Ha(t)||t==="classes",name:"MuiOutlinedInput",slot:"Root",overridesResolver:BA})(ls(({theme:t})=>{const e=t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{position:"relative",borderRadius:(t.vars||t).shape.borderRadius,[`&:hover .${xu.notchedOutline}`]:{borderColor:(t.vars||t).palette.text.primary},[`&.${xu.focused} .${xu.notchedOutline}`]:{borderWidth:2},variants:[...Object.entries(t.palette).filter(([,r])=>r&&r.main).map(([r])=>({props:{color:r},style:{[`&.${xu.focused} .${xu.notchedOutline}`]:{borderColor:(t.vars||t).palette[r].main}}})),{props:{},style:{"@media (hover: none)":{[`&:hover .${xu.notchedOutline}`]:{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:e}},[`&.${xu.error} .${xu.notchedOutline}`]:{borderColor:(t.vars||t).palette.error.main},[`&.${xu.disabled} .${xu.notchedOutline}`]:{borderColor:(t.vars||t).palette.action.disabled}}},{props:({ownerState:r})=>r.startAdornment,style:{paddingLeft:14}},{props:({ownerState:r})=>r.endAdornment,style:{paddingRight:14}},{props:({ownerState:r})=>r.multiline,style:{padding:"16.5px 14px"}},{props:({ownerState:r,size:o})=>r.multiline&&o==="small",style:{padding:"8.5px 14px"}}]}})),M1e=tr(C1e,{name:"MuiOutlinedInput",slot:"NotchedOutline",overridesResolver:(t,e)=>e.notchedOutline})(ls(({theme:t})=>{const e=t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:e}})),k1e=tr(VA,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:jA})(ls(({theme:t})=>({padding:"16.5px 14px",...!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:t.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:t.palette.mode==="light"?null:"#fff",caretColor:t.palette.mode==="light"?null:"#fff",borderRadius:"inherit"}},...t.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{padding:"8.5px 14px"}},{props:({ownerState:e})=>e.multiline,style:{padding:0}},{props:({ownerState:e})=>e.startAdornment,style:{paddingLeft:0}},{props:({ownerState:e})=>e.endAdornment,style:{paddingRight:0}}]}))),WS=ee.forwardRef(function(e,r){var o;const c=cs({props:e,name:"MuiOutlinedInput"}),{components:f={},fullWidth:_=!1,inputComponent:x="input",label:a,multiline:I=!1,notched:D,slots:O={},type:F="text",...Z}=c,J=P1e(c),ne=id(),se=ep({props:c,muiFormControl:ne,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),W={...c,color:se.color||"primary",disabled:se.disabled,error:se.error,focused:se.focused,formControl:ne,fullWidth:_,hiddenLabel:se.hiddenLabel,multiline:I,size:se.size,type:F},Q=O.root??f.Root??R1e,K=O.input??f.Input??k1e;return V.jsx(w4,{slots:{root:Q,input:K},renderSuffix:pe=>V.jsx(M1e,{ownerState:W,className:J.notchedOutline,label:a!=null&&a!==""&&se.required?o||(o=V.jsxs(ee.Fragment,{children:[a,"","*"]})):a,notched:typeof D<"u"?D:!!(pe.startAdornment||pe.filled||pe.focused)}),fullWidth:_,inputComponent:x,multiline:I,ref:r,type:F,...Z,classes:{...J,notchedOutline:null}})});WS&&(WS.muiName="Input");const D1e=Xu(V.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),O1e=Xu(V.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),L1e=tr("span",{shouldForwardProp:Ha})({position:"relative",display:"flex"}),z1e=tr(D1e)({transform:"scale(1)"}),N1e=tr(O1e)(ls(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function mZ(t){const{checked:e=!1,classes:r={},fontSize:o}=t,c={...t,checked:e};return V.jsxs(L1e,{className:r.root,ownerState:c,children:[V.jsx(z1e,{fontSize:o,className:r.background,ownerState:c}),V.jsx(N1e,{fontSize:o,className:r.dot,ownerState:c})]})}const gZ=ee.createContext(void 0);function F1e(){return ee.useContext(gZ)}function B1e(t){return Mi("MuiRadio",t)}const P6=ki("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),j1e=t=>{const{classes:e,color:r,size:o}=t,c={root:["root",`color${Qn(r)}`,o!=="medium"&&`size${Qn(o)}`]};return{...e,...Li(c,B1e,e)}},U1e=tr(nxe,{shouldForwardProp:t=>Ha(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.size!=="medium"&&e[`size${Qn(r.size)}`],e[`color${Qn(r.color)}`]]}})(ls(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${P6.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:Gl(t.palette.action.active,t.palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[e].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:Gl(t.palette[e].main,t.palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e},style:{[`&.${P6.checked}`]:{color:(t.vars||t).palette[e].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function V1e(t,e){return typeof e=="object"&&e!==null?t===e:String(t)===String(e)}const R6=V.jsx(mZ,{checked:!0}),M6=V.jsx(mZ,{}),$1e=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiRadio"}),{checked:c,checkedIcon:f=R6,color:_="primary",icon:x=M6,name:a,onChange:I,size:D="medium",className:O,disableRipple:F=!1,...Z}=o,J={...o,disableRipple:F,color:_,size:D},ne=j1e(J),se=F1e();let W=c;const Q=P3(I,se&&se.onChange);let K=a;return se&&(typeof W>"u"&&(W=V1e(se.value,o.value)),typeof K>"u"&&(K=se.name)),V.jsx(U1e,{type:"radio",icon:ee.cloneElement(x,{fontSize:M6.props.fontSize??D}),checkedIcon:ee.cloneElement(f,{fontSize:R6.props.fontSize??D}),ownerState:J,classes:ne,name:K,checked:W,onChange:Q,ref:r,className:Nr(ne.root,O),...Z})});function G1e(t){return Mi("MuiRadioGroup",t)}ki("MuiRadioGroup",["root","row","error"]);const q1e=t=>{const{classes:e,row:r,error:o}=t;return Li({root:["root",r&&"row",o&&"error"]},G1e,e)},W1e=ee.forwardRef(function(e,r){const{actions:o,children:c,className:f,defaultValue:_,name:x,onChange:a,value:I,...D}=e,O=ee.useRef(null),F=q1e(e),[Z,J]=NS({controlled:I,default:_,name:"RadioGroup"});ee.useImperativeHandle(o,()=>({focus:()=>{let Q=O.current.querySelector("input:not(:disabled):checked");Q||(Q=O.current.querySelector("input:not(:disabled)")),Q&&Q.focus()}}),[]);const ne=jo(r,O),se=p4(x),W=ee.useMemo(()=>({name:se,onChange(Q){J(Q.target.value),a&&a(Q,Q.target.value)},value:Z}),[se,a,J,Z]);return V.jsx(gZ.Provider,{value:W,children:V.jsx(Bxe,{role:"radiogroup",ref:ne,className:Nr(F.root,f),...D,children:c})})});function H1e(t){return Mi("MuiSelect",t)}const Vv=ki("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var k6;const Z1e=tr(fZ,{name:"MuiSelect",slot:"Select",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[{[`&.${Vv.select}`]:e.select},{[`&.${Vv.select}`]:e[r.variant]},{[`&.${Vv.error}`]:e.error},{[`&.${Vv.multiple}`]:e.multiple}]}})({[`&.${Vv.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),X1e=tr(pZ,{name:"MuiSelect",slot:"Icon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.icon,r.variant&&e[`icon${Qn(r.variant)}`],r.open&&e.iconOpen]}})({}),K1e=tr("input",{shouldForwardProp:t=>oZ(t)&&t!=="classes",name:"MuiSelect",slot:"NativeInput",overridesResolver:(t,e)=>e.nativeInput})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function D6(t,e){return typeof e=="object"&&e!==null?t===e:String(t)===String(e)}function Y1e(t){return t==null||typeof t=="string"&&!t.trim()}const Q1e=t=>{const{classes:e,variant:r,disabled:o,multiple:c,open:f,error:_}=t,x={select:["select",r,o&&"disabled",c&&"multiple",_&&"error"],icon:["icon",`icon${Qn(r)}`,f&&"iconOpen",o&&"disabled"],nativeInput:["nativeInput"]};return Li(x,H1e,e)},J1e=ee.forwardRef(function(e,r){var Ur;const{"aria-describedby":o,"aria-label":c,autoFocus:f,autoWidth:_,children:x,className:a,defaultOpen:I,defaultValue:D,disabled:O,displayEmpty:F,error:Z=!1,IconComponent:J,inputRef:ne,labelId:se,MenuProps:W={},multiple:Q,name:K,onBlur:pe,onChange:Te,onClose:we,onFocus:oe,onOpen:de,open:X,readOnly:ge,renderValue:be,SelectDisplayProps:ke={},tabIndex:Ee,type:Lt,value:jt,variant:Qt="standard",...Pt}=e,[lt,At]=NS({controlled:jt,default:D,name:"Select"}),[nn,fn]=NS({controlled:X,default:I,name:"Select"}),mn=ee.useRef(null),Vt=ee.useRef(null),[wn,Ht]=ee.useState(null),{current:Hn}=ee.useRef(X!=null),[Jn,ir]=ee.useState(),Zt=jo(r,ne),zt=ee.useCallback(hn=>{Vt.current=hn,hn&&Ht(hn)},[]),qt=wn==null?void 0:wn.parentNode;ee.useImperativeHandle(Zt,()=>({focus:()=>{Vt.current.focus()},node:mn.current,value:lt}),[lt]),ee.useEffect(()=>{I&&nn&&wn&&!Hn&&(ir(_?null:qt.clientWidth),Vt.current.focus())},[wn,_]),ee.useEffect(()=>{f&&Vt.current.focus()},[f]),ee.useEffect(()=>{if(!se)return;const hn=gl(Vt.current).getElementById(se);if(hn){const Rn=()=>{getSelection().isCollapsed&&Vt.current.focus()};return hn.addEventListener("click",Rn),()=>{hn.removeEventListener("click",Rn)}}},[se]);const xn=(hn,Rn)=>{hn?de&&de(Rn):we&&we(Rn),Hn||(ir(_?null:qt.clientWidth),fn(hn))},rr=hn=>{hn.button===0&&(hn.preventDefault(),Vt.current.focus(),xn(!0,hn))},Gn=hn=>{xn(!1,hn)},yr=ee.Children.toArray(x),Gr=hn=>{const Rn=yr.find(Kt=>Kt.props.value===hn.target.value);Rn!==void 0&&(At(Rn.props.value),Te&&Te(hn,Rn))},mr=hn=>Rn=>{let Kt;if(Rn.currentTarget.hasAttribute("tabindex")){if(Q){Kt=Array.isArray(lt)?lt.slice():[];const zi=lt.indexOf(hn.props.value);zi===-1?Kt.push(hn.props.value):Kt.splice(zi,1)}else Kt=hn.props.value;if(hn.props.onClick&&hn.props.onClick(Rn),lt!==Kt&&(At(Kt),Te)){const zi=Rn.nativeEvent||Rn,li=new zi.constructor(zi.type,zi);Object.defineProperty(li,"target",{writable:!0,value:{value:Kt,name:K}}),Te(li,hn)}Q||xn(!1,Rn)}},wr=hn=>{ge||[" ","ArrowUp","ArrowDown","Enter"].includes(hn.key)&&(hn.preventDefault(),xn(!0,hn))},wt=wn!==null&&nn,St=hn=>{!wt&&pe&&(Object.defineProperty(hn,"target",{writable:!0,value:{value:lt,name:K}}),pe(hn))};delete Pt["aria-invalid"];let Ct,it;const pt=[];let Jt=!1;($S({value:lt})||F)&&(be?Ct=be(lt):Jt=!0);const In=yr.map(hn=>{if(!ee.isValidElement(hn))return null;let Rn;if(Q){if(!Array.isArray(lt))throw new Error(Yh(2));Rn=lt.some(Kt=>D6(Kt,hn.props.value)),Rn&&Jt&&pt.push(hn.props.children)}else Rn=D6(lt,hn.props.value),Rn&&Jt&&(it=hn.props.children);return ee.cloneElement(hn,{"aria-selected":Rn?"true":"false",onClick:mr(hn),onKeyUp:Kt=>{Kt.key===" "&&Kt.preventDefault(),hn.props.onKeyUp&&hn.props.onKeyUp(Kt)},role:"option",selected:Rn,value:void 0,"data-value":hn.props.value})});Jt&&(Q?pt.length===0?Ct=null:Ct=pt.reduce((hn,Rn,Kt)=>(hn.push(Rn),Kt<pt.length-1&&hn.push(", "),hn),[]):Ct=it);let en=Jn;!_&&Hn&&wn&&(en=qt.clientWidth);let Ye;typeof Ee<"u"?Ye=Ee:Ye=O?null:0;const Rt=ke.id||(K?`mui-component-select-${K}`:void 0),bn={...e,variant:Qt,value:lt,open:wt,error:Z},Pn=Q1e(bn),gn={...W.PaperProps,...(Ur=W.slotProps)==null?void 0:Ur.paper},er=p4();return V.jsxs(ee.Fragment,{children:[V.jsx(Z1e,{as:"div",ref:zt,tabIndex:Ye,role:"combobox","aria-controls":er,"aria-disabled":O?"true":void 0,"aria-expanded":wt?"true":"false","aria-haspopup":"listbox","aria-label":c,"aria-labelledby":[se,Rt].filter(Boolean).join(" ")||void 0,"aria-describedby":o,onKeyDown:wr,onMouseDown:O||ge?null:rr,onBlur:St,onFocus:oe,...ke,ownerState:bn,className:Nr(ke.className,Pn.select,a),id:Rt,children:Y1e(Ct)?k6||(k6=V.jsx("span",{className:"notranslate",children:""})):Ct}),V.jsx(K1e,{"aria-invalid":Z,value:Array.isArray(lt)?lt.join(","):lt,name:K,ref:mn,"aria-hidden":!0,onChange:Gr,tabIndex:-1,disabled:O,className:Pn.nativeInput,autoFocus:f,...Pt,ownerState:bn}),V.jsx(X1e,{as:J,className:Pn.icon,ownerState:bn}),V.jsx(x1e,{id:`menu-${K||""}`,anchorEl:qt,open:wt,onClose:Gn,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},...W,MenuListProps:{"aria-labelledby":se,role:"listbox","aria-multiselectable":Q?"true":void 0,disableListWrap:!0,id:er,...W.MenuListProps},slotProps:{...W.slotProps,paper:{...gn,style:{minWidth:en,...gn!=null?gn.style:null}}},children:In})]})}),ebe=t=>{const{classes:e}=t;return e},E4={name:"MuiSelect",overridesResolver:(t,e)=>e.root,shouldForwardProp:t=>Ha(t)&&t!=="variant",slot:"Root"},tbe=tr(qS,E4)(""),nbe=tr(WS,E4)(""),rbe=tr(GS,E4)(""),_Z=ee.forwardRef(function(e,r){const o=D0e({name:"MuiSelect",props:e}),{autoWidth:c=!1,children:f,classes:_={},className:x,defaultOpen:a=!1,displayEmpty:I=!1,IconComponent:D=kve,id:O,input:F,inputProps:Z,label:J,labelId:ne,MenuProps:se,multiple:W=!1,native:Q=!1,onClose:K,onOpen:pe,open:Te,renderValue:we,SelectDisplayProps:oe,variant:de="outlined",...X}=o,ge=Q?S1e:J1e,be=id(),ke=ep({props:o,muiFormControl:be,states:["variant","error"]}),Ee=ke.variant||de,Lt={...o,variant:Ee,classes:_},jt=ebe(Lt),{root:Qt,...Pt}=jt,lt=F||{standard:V.jsx(tbe,{ownerState:Lt}),outlined:V.jsx(nbe,{label:J,ownerState:Lt}),filled:V.jsx(rbe,{ownerState:Lt})}[Ee],At=jo(r,pb(lt));return V.jsx(ee.Fragment,{children:ee.cloneElement(lt,{inputComponent:ge,inputProps:{children:f,error:ke.error,IconComponent:D,variant:Ee,type:void 0,multiple:W,...Q?{id:O}:{autoWidth:c,defaultOpen:a,displayEmpty:I,labelId:ne,MenuProps:se,onClose:K,onOpen:pe,open:Te,renderValue:we,SelectDisplayProps:{id:O,...oe}},...Z,classes:Z?na(Pt,Z.classes):Pt,...F?F.props.inputProps:{}},...(W&&Q||I)&&Ee==="outlined"?{notched:!0}:{},ref:At,className:Nr(lt.props.className,x,jt.root),...!F&&{variant:Ee},...X})})});_Z.muiName="Select";function ibe(t){return Mi("MuiTextField",t)}ki("MuiTextField",["root"]);const sbe={standard:qS,filled:GS,outlined:WS},obe=t=>{const{classes:e}=t;return Li({root:["root"]},ibe,e)},abe=tr(Rxe,{name:"MuiTextField",slot:"Root",overridesResolver:(t,e)=>e.root})({}),O6=ee.forwardRef(function(e,r){const o=cs({props:e,name:"MuiTextField"}),{autoComplete:c,autoFocus:f=!1,children:_,className:x,color:a="primary",defaultValue:I,disabled:D=!1,error:O=!1,FormHelperTextProps:F,fullWidth:Z=!1,helperText:J,id:ne,InputLabelProps:se,inputProps:W,InputProps:Q,inputRef:K,label:pe,maxRows:Te,minRows:we,multiline:oe=!1,name:de,onBlur:X,onChange:ge,onFocus:be,placeholder:ke,required:Ee=!1,rows:Lt,select:jt=!1,SelectProps:Qt,slots:Pt={},slotProps:lt={},type:At,value:nn,variant:fn="outlined",...mn}=o,Vt={...o,autoFocus:f,color:a,disabled:D,error:O,fullWidth:Z,multiline:oe,required:Ee,select:jt,variant:fn},wn=obe(Vt),Ht=p4(ne),Hn=J&&Ht?`${Ht}-helper-text`:void 0,Jn=pe&&Ht?`${Ht}-label`:void 0,ir=sbe[fn],Zt={slots:Pt,slotProps:{input:Q,inputLabel:se,htmlInput:W,formHelperText:F,select:Qt,...lt}},zt={},qt=Zt.slotProps.inputLabel;fn==="outlined"&&(qt&&typeof qt.shrink<"u"&&(zt.notched=qt.shrink),zt.label=pe),jt&&((!Qt||!Qt.native)&&(zt.id=void 0),zt["aria-describedby"]=void 0);const[xn,rr]=ql("input",{elementType:ir,externalForwardedProps:Zt,additionalProps:zt,ownerState:Vt}),[Gn,yr]=ql("inputLabel",{elementType:n1e,externalForwardedProps:Zt,ownerState:Vt}),[Gr,mr]=ql("htmlInput",{elementType:"input",externalForwardedProps:Zt,ownerState:Vt}),[wr,wt]=ql("formHelperText",{elementType:$xe,externalForwardedProps:Zt,ownerState:Vt}),[St,Ct]=ql("select",{elementType:_Z,externalForwardedProps:Zt,ownerState:Vt}),it=V.jsx(xn,{"aria-describedby":Hn,autoComplete:c,autoFocus:f,defaultValue:I,fullWidth:Z,multiline:oe,name:de,rows:Lt,maxRows:Te,minRows:we,type:At,value:nn,id:Ht,inputRef:K,onBlur:X,onChange:ge,onFocus:be,placeholder:ke,inputProps:mr,slots:{input:Pt.htmlInput?Gr:void 0},...rr});return V.jsxs(abe,{className:Nr(wn.root,x),disabled:D,error:O,fullWidth:Z,ref:r,required:Ee,color:a,variant:fn,ownerState:Vt,...mn,children:[pe!=null&&pe!==""&&V.jsx(Gn,{htmlFor:Ht,id:Jn,...yr,children:pe}),jt?V.jsx(St,{"aria-describedby":Hn,id:Ht,labelId:Jn,value:nn,input:it,...Ct,children:_}):it,J&&V.jsx(wr,{id:Hn,...wt,children:J})]})}),L6=Xu(V.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),z6=Xu([V.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),V.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"CameraAlt"),lbe=Xu(V.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),cbe=Xu(V.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),ube=Xu(V.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),hbe=Xu(V.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),dbe=Xu(V.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),fbe=ee.createContext(null),pbe=ee.createContext({}),mbe=ee.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),gbe=typeof window<"u",_be=gbe?ee.useLayoutEffect:ee.useEffect;function yZ(t){const e=ee.useRef(null);return e.current===null&&(e.current=t()),e.current}class ybe extends ee.Component{getSnapshotBeforeUpdate(e){const r=this.props.childRef.current;if(r&&e.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=r.offsetHeight||0,o.width=r.offsetWidth||0,o.top=r.offsetTop,o.left=r.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function vbe({children:t,isPresent:e}){const r=ee.useId(),o=ee.useRef(null),c=ee.useRef({width:0,height:0,top:0,left:0}),{nonce:f}=ee.useContext(mbe);return ee.useInsertionEffect(()=>{const{width:_,height:x,top:a,left:I}=c.current;if(e||!o.current||!_||!x)return;o.current.dataset.motionPopId=r;const D=document.createElement("style");return f&&(D.nonce=f),document.head.appendChild(D),D.sheet&&D.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${_}px !important;
            height: ${x}px !important;
            top: ${a}px !important;
            left: ${I}px !important;
          }
        `),()=>{document.head.removeChild(D)}},[e]),V.jsx(ybe,{isPresent:e,childRef:o,sizeRef:c,children:ee.cloneElement(t,{ref:o})})}const xbe=({children:t,initial:e,isPresent:r,onExitComplete:o,custom:c,presenceAffectsLayout:f,mode:_})=>{const x=yZ(bbe),a=ee.useId(),I=ee.useMemo(()=>({id:a,initial:e,isPresent:r,custom:c,onExitComplete:D=>{x.set(D,!0);for(const O of x.values())if(!O)return;o&&o()},register:D=>(x.set(D,!1),()=>x.delete(D))}),f?[Math.random()]:[r]);return ee.useMemo(()=>{x.forEach((D,O)=>x.set(O,!1))},[r]),ee.useEffect(()=>{!r&&!x.size&&o&&o()},[r]),_==="popLayout"&&(t=V.jsx(vbe,{isPresent:r,children:t})),V.jsx(fbe.Provider,{value:I,children:t})};function bbe(){return new Map}const XT=t=>t.key||"";function N6(t){const e=[];return ee.Children.forEach(t,r=>{ee.isValidElement(r)&&e.push(r)}),e}const wbe=({children:t,exitBeforeEnter:e,custom:r,initial:o=!0,onExitComplete:c,presenceAffectsLayout:f=!0,mode:_="sync"})=>{const x=ee.useMemo(()=>N6(t),[t]),a=x.map(XT),I=ee.useRef(!0),D=ee.useRef(x),O=yZ(()=>new Map),[F,Z]=ee.useState(x),[J,ne]=ee.useState(x);_be(()=>{I.current=!1,D.current=x;for(let Q=0;Q<J.length;Q++){const K=XT(J[Q]);a.includes(K)?O.delete(K):O.get(K)!==!0&&O.set(K,!1)}},[J,a.length,a.join("-")]);const se=[];if(x!==F){let Q=[...x];for(let K=0;K<J.length;K++){const pe=J[K],Te=XT(pe);a.includes(Te)||(Q.splice(K,0,pe),se.push(pe))}_==="wait"&&se.length&&(Q=se),ne(N6(Q)),Z(x);return}const{forceRender:W}=ee.useContext(pbe);return V.jsx(V.Fragment,{children:J.map(Q=>{const K=XT(Q),pe=x===J||a.includes(K),Te=()=>{if(O.has(K))O.set(K,!0);else return;let we=!0;O.forEach(oe=>{oe||(we=!1)}),we&&(W==null||W(),ne(D.current),c&&c())};return V.jsx(xbe,{isPresent:pe,initial:!I.current||o?void 0:!1,custom:pe?void 0:r,presenceAffectsLayout:f,mode:_,onExitComplete:pe?void 0:Te,children:Q},K)})})};var S4=gb(),Fr=t=>mb(t,S4),I4=gb();Fr.write=t=>mb(t,I4);var $A=gb();Fr.onStart=t=>mb(t,$A);var A4=gb();Fr.onFrame=t=>mb(t,A4);var C4=gb();Fr.onFinish=t=>mb(t,C4);var uy=[];Fr.setTimeout=(t,e)=>{const r=Fr.now()+e,o=()=>{const f=uy.findIndex(_=>_.cancel==o);~f&&uy.splice(f,1),yf-=~f?1:0},c={time:r,handler:t,cancel:o};return uy.splice(vZ(r),0,c),yf+=1,xZ(),c};var vZ=t=>~(~uy.findIndex(e=>e.time>t)||~uy.length);Fr.cancel=t=>{$A.delete(t),A4.delete(t),C4.delete(t),S4.delete(t),I4.delete(t)};Fr.sync=t=>{j3=!0,Fr.batchedUpdates(t),j3=!1};Fr.throttle=t=>{let e;function r(){try{t(...e)}finally{e=null}}function o(...c){e=c,Fr.onStart(r)}return o.handler=t,o.cancel=()=>{$A.delete(r),e=null},o};var P4=typeof window<"u"?window.requestAnimationFrame:()=>{};Fr.use=t=>P4=t;Fr.now=typeof performance<"u"?()=>performance.now():Date.now;Fr.batchedUpdates=t=>t();Fr.catch=console.error;Fr.frameLoop="always";Fr.advance=()=>{Fr.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):wZ()};var _f=-1,yf=0,j3=!1;function mb(t,e){j3?(e.delete(t),t(0)):(e.add(t),xZ())}function xZ(){_f<0&&(_f=0,Fr.frameLoop!=="demand"&&P4(bZ))}function Tbe(){_f=-1}function bZ(){~_f&&(P4(bZ),Fr.batchedUpdates(wZ))}function wZ(){const t=_f;_f=Fr.now();const e=vZ(_f);if(e&&(TZ(uy.splice(0,e),r=>r.handler()),yf-=e),!yf){Tbe();return}$A.flush(),S4.flush(t?Math.min(64,_f-t):16.667),A4.flush(),I4.flush(),C4.flush()}function gb(){let t=new Set,e=t;return{add(r){yf+=e==t&&!t.has(r)?1:0,t.add(r)},delete(r){return yf-=e==t&&t.has(r)?1:0,t.delete(r)},flush(r){e.size&&(t=new Set,yf-=e.size,TZ(e,o=>o(r)&&t.add(o)),yf+=t.size,e=t)}}}function TZ(t,e){t.forEach(r=>{try{e(r)}catch(o){Fr.catch(o)}})}var Ebe=Object.defineProperty,Sbe=(t,e)=>{for(var r in e)Ebe(t,r,{get:e[r],enumerable:!0})},$c={};Sbe($c,{assign:()=>Abe,colors:()=>Of,createStringInterpolator:()=>M4,skipAnimation:()=>SZ,to:()=>EZ,willAdvance:()=>k4});function U3(){}var Ibe=(t,e,r)=>Object.defineProperty(t,e,{value:r,writable:!0,configurable:!0}),yn={arr:Array.isArray,obj:t=>!!t&&t.constructor.name==="Object",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",und:t=>t===void 0};function Ph(t,e){if(yn.arr(t)){if(!yn.arr(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}return t===e}var ii=(t,e)=>t.forEach(e);function qu(t,e,r){if(yn.arr(t)){for(let o=0;o<t.length;o++)e.call(r,t[o],`${o}`);return}for(const o in t)t.hasOwnProperty(o)&&e.call(r,t[o],o)}var hl=t=>yn.und(t)?[]:yn.arr(t)?t:[t];function Bx(t,e){if(t.size){const r=Array.from(t);t.clear(),ii(r,e)}}var ux=(t,...e)=>Bx(t,r=>r(...e)),R4=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),M4,EZ,Of=null,SZ=!1,k4=U3,Abe=t=>{t.to&&(EZ=t.to),t.now&&(Fr.now=t.now),t.colors!==void 0&&(Of=t.colors),t.skipAnimation!=null&&(SZ=t.skipAnimation),t.createStringInterpolator&&(M4=t.createStringInterpolator),t.requestAnimationFrame&&Fr.use(t.requestAnimationFrame),t.batchedUpdates&&(Fr.batchedUpdates=t.batchedUpdates),t.willAdvance&&(k4=t.willAdvance),t.frameLoop&&(Fr.frameLoop=t.frameLoop)},jx=new Set,Wl=[],AM=[],HS=0,GA={get idle(){return!jx.size&&!Wl.length},start(t){HS>t.priority?(jx.add(t),Fr.onStart(Cbe)):(IZ(t),Fr(V3))},advance:V3,sort(t){if(HS)Fr.onFrame(()=>GA.sort(t));else{const e=Wl.indexOf(t);~e&&(Wl.splice(e,1),AZ(t))}},clear(){Wl=[],jx.clear()}};function Cbe(){jx.forEach(IZ),jx.clear(),Fr(V3)}function IZ(t){Wl.includes(t)||AZ(t)}function AZ(t){Wl.splice(Pbe(Wl,e=>e.priority>t.priority),0,t)}function V3(t){const e=AM;for(let r=0;r<Wl.length;r++){const o=Wl[r];HS=o.priority,o.idle||(k4(o),o.advance(t),o.idle||e.push(o))}return HS=0,AM=Wl,AM.length=0,Wl=e,Wl.length>0}function Pbe(t,e){const r=t.findIndex(e);return r<0?t.length:r}var Rbe=(t,e,r)=>Math.min(Math.max(r,t),e),Mbe={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},zc="[-+]?\\d*\\.?\\d+",ZS=zc+"%";function qA(...t){return"\\(\\s*("+t.join(")\\s*,\\s*(")+")\\s*\\)"}var kbe=new RegExp("rgb"+qA(zc,zc,zc)),Dbe=new RegExp("rgba"+qA(zc,zc,zc,zc)),Obe=new RegExp("hsl"+qA(zc,ZS,ZS)),Lbe=new RegExp("hsla"+qA(zc,ZS,ZS,zc)),zbe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Nbe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Fbe=/^#([0-9a-fA-F]{6})$/,Bbe=/^#([0-9a-fA-F]{8})$/;function jbe(t){let e;return typeof t=="number"?t>>>0===t&&t>=0&&t<=4294967295?t:null:(e=Fbe.exec(t))?parseInt(e[1]+"ff",16)>>>0:Of&&Of[t]!==void 0?Of[t]:(e=kbe.exec(t))?(I_(e[1])<<24|I_(e[2])<<16|I_(e[3])<<8|255)>>>0:(e=Dbe.exec(t))?(I_(e[1])<<24|I_(e[2])<<16|I_(e[3])<<8|j6(e[4]))>>>0:(e=zbe.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=Bbe.exec(t))?parseInt(e[1],16)>>>0:(e=Nbe.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=Obe.exec(t))?(F6(B6(e[1]),KT(e[2]),KT(e[3]))|255)>>>0:(e=Lbe.exec(t))?(F6(B6(e[1]),KT(e[2]),KT(e[3]))|j6(e[4]))>>>0:null}function CM(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function F6(t,e,r){const o=r<.5?r*(1+e):r+e-r*e,c=2*r-o,f=CM(c,o,t+1/3),_=CM(c,o,t),x=CM(c,o,t-1/3);return Math.round(f*255)<<24|Math.round(_*255)<<16|Math.round(x*255)<<8}function I_(t){const e=parseInt(t,10);return e<0?0:e>255?255:e}function B6(t){return(parseFloat(t)%360+360)%360/360}function j6(t){const e=parseFloat(t);return e<0?0:e>1?255:Math.round(e*255)}function KT(t){const e=parseFloat(t);return e<0?0:e>100?1:e/100}function U6(t){let e=jbe(t);if(e===null)return t;e=e||0;const r=(e&4278190080)>>>24,o=(e&16711680)>>>16,c=(e&65280)>>>8,f=(e&255)/255;return`rgba(${r}, ${o}, ${c}, ${f})`}var C1=(t,e,r)=>{if(yn.fun(t))return t;if(yn.arr(t))return C1({range:t,output:e,extrapolate:r});if(yn.str(t.output[0]))return M4(t);const o=t,c=o.output,f=o.range||[0,1],_=o.extrapolateLeft||o.extrapolate||"extend",x=o.extrapolateRight||o.extrapolate||"extend",a=o.easing||(I=>I);return I=>{const D=Vbe(I,f);return Ube(I,f[D],f[D+1],c[D],c[D+1],a,_,x,o.map)}};function Ube(t,e,r,o,c,f,_,x,a){let I=a?a(t):t;if(I<e){if(_==="identity")return I;_==="clamp"&&(I=e)}if(I>r){if(x==="identity")return I;x==="clamp"&&(I=r)}return o===c?o:e===r?t<=e?o:c:(e===-1/0?I=-I:r===1/0?I=I-e:I=(I-e)/(r-e),I=f(I),o===-1/0?I=-I:c===1/0?I=I+o:I=I*(c-o)+o,I)}function Vbe(t,e){for(var r=1;r<e.length-1&&!(e[r]>=t);++r);return r-1}var $be=(t,e="end")=>r=>{r=e==="end"?Math.min(r,.999):Math.max(r,.001);const o=r*t,c=e==="end"?Math.floor(o):Math.ceil(o);return Rbe(0,1,c/t)},XS=1.70158,YT=XS*1.525,V6=XS+1,$6=2*Math.PI/3,G6=2*Math.PI/4.5,QT=t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,Gbe={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>1-(1-t)*(1-t),easeInOutQuad:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeInCubic:t=>t*t*t,easeOutCubic:t=>1-Math.pow(1-t,3),easeInOutCubic:t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1-Math.pow(1-t,4),easeInOutQuart:t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1-Math.pow(1-t,5),easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInExpo:t=>t===0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t===1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,easeInCirc:t=>1-Math.sqrt(1-Math.pow(t,2)),easeOutCirc:t=>Math.sqrt(1-Math.pow(t-1,2)),easeInOutCirc:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,easeInBack:t=>V6*t*t*t-XS*t*t,easeOutBack:t=>1+V6*Math.pow(t-1,3)+XS*Math.pow(t-1,2),easeInOutBack:t=>t<.5?Math.pow(2*t,2)*((YT+1)*2*t-YT)/2:(Math.pow(2*t-2,2)*((YT+1)*(t*2-2)+YT)+2)/2,easeInElastic:t=>t===0?0:t===1?1:-Math.pow(2,10*t-10)*Math.sin((t*10-10.75)*$6),easeOutElastic:t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t*10-.75)*$6)+1,easeInOutElastic:t=>t===0?0:t===1?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*G6))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*G6)/2+1,easeInBounce:t=>1-QT(1-t),easeOutBounce:QT,easeInOutBounce:t=>t<.5?(1-QT(1-2*t))/2:(1+QT(2*t-1))/2,steps:$be},P1=Symbol.for("FluidValue.get"),Dy=Symbol.for("FluidValue.observers"),$l=t=>!!(t&&t[P1]),za=t=>t&&t[P1]?t[P1]():t,q6=t=>t[Dy]||null;function qbe(t,e){t.eventObserved?t.eventObserved(e):t(e)}function R1(t,e){const r=t[Dy];r&&r.forEach(o=>{qbe(o,e)})}var CZ=class{constructor(t){if(!t&&!(t=this.get))throw Error("Unknown getter");Wbe(this,t)}},Wbe=(t,e)=>PZ(t,P1,e);function e0(t,e){if(t[P1]){let r=t[Dy];r||PZ(t,Dy,r=new Set),r.has(e)||(r.add(e),t.observerAdded&&t.observerAdded(r.size,e))}return e}function M1(t,e){const r=t[Dy];if(r&&r.has(e)){const o=r.size-1;o?r.delete(e):t[Dy]=null,t.observerRemoved&&t.observerRemoved(o,e)}}var PZ=(t,e,r)=>Object.defineProperty(t,e,{value:r,writable:!0,configurable:!0}),PE=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,Hbe=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,W6=new RegExp(`(${PE.source})(%|[a-z]+)`,"i"),Zbe=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,WA=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,RZ=t=>{const[e,r]=Xbe(t);if(!e||R4())return t;const o=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(o)return o.trim();if(r&&r.startsWith("--")){const c=window.getComputedStyle(document.documentElement).getPropertyValue(r);return c||t}else{if(r&&WA.test(r))return RZ(r);if(r)return r}return t},Xbe=t=>{const e=WA.exec(t);if(!e)return[,];const[,r,o]=e;return[r,o]},PM,Kbe=(t,e,r,o,c)=>`rgba(${Math.round(e)}, ${Math.round(r)}, ${Math.round(o)}, ${c})`,MZ=t=>{PM||(PM=Of?new RegExp(`(${Object.keys(Of).join("|")})(?!\\w)`,"g"):/^\b$/);const e=t.output.map(f=>za(f).replace(WA,RZ).replace(Hbe,U6).replace(PM,U6)),r=e.map(f=>f.match(PE).map(Number)),c=r[0].map((f,_)=>r.map(x=>{if(!(_ in x))throw Error('The arity of each "output" value must be equal');return x[_]})).map(f=>C1({...t,output:f}));return f=>{var a;const _=!W6.test(e[0])&&((a=e.find(I=>W6.test(I)))==null?void 0:a.replace(PE,""));let x=0;return e[0].replace(PE,()=>`${c[x++](f)}${_||""}`).replace(Zbe,Kbe)}},D4="react-spring: ",kZ=t=>{const e=t;let r=!1;if(typeof e!="function")throw new TypeError(`${D4}once requires a function parameter`);return(...o)=>{r||(e(...o),r=!0)}},Ybe=kZ(console.warn);function Qbe(){Ybe(`${D4}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var Jbe=kZ(console.warn);function ewe(){Jbe(`${D4}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function HA(t){return yn.str(t)&&(t[0]=="#"||/\d/.test(t)||!R4()&&WA.test(t)||t in(Of||{}))}var O4=R4()?ee.useEffect:ee.useLayoutEffect,twe=()=>{const t=ee.useRef(!1);return O4(()=>(t.current=!0,()=>{t.current=!1}),[]),t};function DZ(){const t=ee.useState()[1],e=twe();return()=>{e.current&&t(Math.random())}}function nwe(t,e){const[r]=ee.useState(()=>({inputs:e,result:t()})),o=ee.useRef(),c=o.current;let f=c;return f?e&&f.inputs&&rwe(e,f.inputs)||(f={inputs:e,result:t()}):f=r,ee.useEffect(()=>{o.current=f,c==r&&(r.inputs=r.result=void 0)},[f]),f.result}function rwe(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}var OZ=t=>ee.useEffect(t,iwe),iwe=[];function H6(t){const e=ee.useRef();return ee.useEffect(()=>{e.current=t}),e.current}var k1=Symbol.for("Animated:node"),swe=t=>!!t&&t[k1]===t,Eu=t=>t&&t[k1],L4=(t,e)=>Ibe(t,k1,e),ZA=t=>t&&t[k1]&&t[k1].getPayload(),LZ=class{constructor(){L4(this,this)}getPayload(){return this.payload||[]}},_b=class extends LZ{constructor(t){super(),this._value=t,this.done=!0,this.durationProgress=0,yn.num(this._value)&&(this.lastPosition=this._value)}static create(t){return new _b(t)}getPayload(){return[this]}getValue(){return this._value}setValue(t,e){return yn.num(t)&&(this.lastPosition=t,e&&(t=Math.round(t/e)*e,this.done&&(this.lastPosition=t))),this._value===t?!1:(this._value=t,!0)}reset(){const{done:t}=this;this.done=!1,yn.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,t&&(this.lastVelocity=null),this.v0=null)}},D1=class extends _b{constructor(t){super(0),this._string=null,this._toString=C1({output:[t,t]})}static create(t){return new D1(t)}getValue(){const t=this._string;return t??(this._string=this._toString(this._value))}setValue(t){if(yn.str(t)){if(t==this._string)return!1;this._string=t,this._value=1}else if(super.setValue(t))this._string=null;else return!1;return!0}reset(t){t&&(this._toString=C1({output:[this.getValue(),t]})),this._value=0,super.reset()}},KS={dependencies:null},XA=class extends LZ{constructor(t){super(),this.source=t,this.setValue(t)}getValue(t){const e={};return qu(this.source,(r,o)=>{swe(r)?e[o]=r.getValue(t):$l(r)?e[o]=za(r):t||(e[o]=r)}),e}setValue(t){this.source=t,this.payload=this._makePayload(t)}reset(){this.payload&&ii(this.payload,t=>t.reset())}_makePayload(t){if(t){const e=new Set;return qu(t,this._addToPayload,e),Array.from(e)}}_addToPayload(t){KS.dependencies&&$l(t)&&KS.dependencies.add(t);const e=ZA(t);e&&ii(e,r=>this.add(r))}},zZ=class extends XA{constructor(t){super(t)}static create(t){return new zZ(t)}getValue(){return this.source.map(t=>t.getValue())}setValue(t){const e=this.getPayload();return t.length==e.length?e.map((r,o)=>r.setValue(t[o])).some(Boolean):(super.setValue(t.map(owe)),!0)}};function owe(t){return(HA(t)?D1:_b).create(t)}function $3(t){const e=Eu(t);return e?e.constructor:yn.arr(t)?zZ:HA(t)?D1:_b}var Z6=(t,e)=>{const r=!yn.fun(t)||t.prototype&&t.prototype.isReactComponent;return ee.forwardRef((o,c)=>{const f=ee.useRef(null),_=r&&ee.useCallback(J=>{f.current=cwe(c,J)},[c]),[x,a]=lwe(o,e),I=DZ(),D=()=>{const J=f.current;if(r&&!J)return;(J?e.applyAnimatedValues(J,x.getValue(!0)):!1)===!1&&I()},O=new awe(D,a),F=ee.useRef();O4(()=>(F.current=O,ii(a,J=>e0(J,O)),()=>{F.current&&(ii(F.current.deps,J=>M1(J,F.current)),Fr.cancel(F.current.update))})),ee.useEffect(D,[]),OZ(()=>()=>{const J=F.current;ii(J.deps,ne=>M1(ne,J))});const Z=e.getComponentProps(x.getValue());return ee.createElement(t,{...Z,ref:_})})},awe=class{constructor(t,e){this.update=t,this.deps=e}eventObserved(t){t.type=="change"&&Fr.write(this.update)}};function lwe(t,e){const r=new Set;return KS.dependencies=r,t.style&&(t={...t,style:e.createAnimatedStyle(t.style)}),t=new XA(t),KS.dependencies=null,[t,r]}function cwe(t,e){return t&&(yn.fun(t)?t(e):t.current=e),e}var X6=Symbol.for("AnimatedComponent"),uwe=(t,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:r=c=>new XA(c),getComponentProps:o=c=>c}={})=>{const c={applyAnimatedValues:e,createAnimatedStyle:r,getComponentProps:o},f=_=>{const x=K6(_)||"Anonymous";return yn.str(_)?_=f[_]||(f[_]=Z6(_,c)):_=_[X6]||(_[X6]=Z6(_,c)),_.displayName=`Animated(${x})`,_};return qu(t,(_,x)=>{yn.arr(t)&&(x=K6(_)),f[x]=f(_)}),{animated:f}},K6=t=>yn.str(t)?t:t&&yn.str(t.displayName)?t.displayName:yn.fun(t)&&t.name||null;function om(t,...e){return yn.fun(t)?t(...e):t}var Ux=(t,e)=>t===!0||!!(e&&t&&(yn.fun(t)?t(e):hl(t).includes(e))),NZ=(t,e)=>yn.obj(t)?e&&t[e]:t,FZ=(t,e)=>t.default===!0?t[e]:t.default?t.default[e]:void 0,hwe=t=>t,z4=(t,e=hwe)=>{let r=dwe;t.default&&t.default!==!0&&(t=t.default,r=Object.keys(t));const o={};for(const c of r){const f=e(t[c],c);yn.und(f)||(o[c]=f)}return o},dwe=["config","onProps","onStart","onChange","onPause","onResume","onRest"],fwe={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function pwe(t){const e={};let r=0;if(qu(t,(o,c)=>{fwe[c]||(e[c]=o,r++)}),r)return e}function BZ(t){const e=pwe(t);if(e){const r={to:e};return qu(t,(o,c)=>c in e||(r[c]=o)),r}return{...t}}function O1(t){return t=za(t),yn.arr(t)?t.map(O1):HA(t)?$c.createStringInterpolator({range:[0,1],output:[t,t]})(1):t}function mwe(t){for(const e in t)return!0;return!1}function G3(t){return yn.fun(t)||yn.arr(t)&&yn.obj(t[0])}function gwe(t,e){var r;(r=t.ref)==null||r.delete(t),e==null||e.delete(t)}function _we(t,e){var r;e&&t.ref!==e&&((r=t.ref)==null||r.delete(t),e.add(t),t.ref=e)}var ywe={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}},q3={...ywe.default,mass:1,damping:1,easing:Gbe.linear,clamp:!1},vwe=class{constructor(){this.velocity=0,Object.assign(this,q3)}};function xwe(t,e,r){r&&(r={...r},Y6(r,e),e={...r,...e}),Y6(t,e),Object.assign(t,e);for(const _ in q3)t[_]==null&&(t[_]=q3[_]);let{frequency:o,damping:c}=t;const{mass:f}=t;return yn.und(o)||(o<.01&&(o=.01),c<0&&(c=0),t.tension=Math.pow(2*Math.PI/o,2)*f,t.friction=4*Math.PI*c*f/o),t}function Y6(t,e){if(!yn.und(e.decay))t.duration=void 0;else{const r=!yn.und(e.tension)||!yn.und(e.friction);(r||!yn.und(e.frequency)||!yn.und(e.damping)||!yn.und(e.mass))&&(t.duration=void 0,t.decay=void 0),r&&(t.frequency=void 0)}}var Q6=[],bwe=class{constructor(){this.changed=!1,this.values=Q6,this.toValues=null,this.fromValues=Q6,this.config=new vwe,this.immediate=!1}};function jZ(t,{key:e,props:r,defaultProps:o,state:c,actions:f}){return new Promise((_,x)=>{let a,I,D=Ux(r.cancel??(o==null?void 0:o.cancel),e);if(D)Z();else{yn.und(r.pause)||(c.paused=Ux(r.pause,e));let J=o==null?void 0:o.pause;J!==!0&&(J=c.paused||Ux(J,e)),a=om(r.delay||0,e),J?(c.resumeQueue.add(F),f.pause()):(f.resume(),F())}function O(){c.resumeQueue.add(F),c.timeouts.delete(I),I.cancel(),a=I.time-Fr.now()}function F(){a>0&&!$c.skipAnimation?(c.delayed=!0,I=Fr.setTimeout(Z,a),c.pauseQueue.add(O),c.timeouts.add(I)):Z()}function Z(){c.delayed&&(c.delayed=!1),c.pauseQueue.delete(O),c.timeouts.delete(I),t<=(c.cancelId||0)&&(D=!0);try{f.start({...r,callId:t,cancel:D},_)}catch(J){x(J)}}})}var N4=(t,e)=>e.length==1?e[0]:e.some(r=>r.cancelled)?hy(t.get()):e.every(r=>r.noop)?UZ(t.get()):Oc(t.get(),e.every(r=>r.finished)),UZ=t=>({value:t,noop:!0,finished:!0,cancelled:!1}),Oc=(t,e,r=!1)=>({value:t,finished:e,cancelled:r}),hy=t=>({value:t,cancelled:!0,finished:!1});function VZ(t,e,r,o){const{callId:c,parentId:f,onRest:_}=e,{asyncTo:x,promise:a}=r;return!f&&t===x&&!e.reset?a:r.promise=(async()=>{r.asyncId=c,r.asyncTo=t;const I=z4(e,(se,W)=>W==="onRest"?void 0:se);let D,O;const F=new Promise((se,W)=>(D=se,O=W)),Z=se=>{const W=c<=(r.cancelId||0)&&hy(o)||c!==r.asyncId&&Oc(o,!1);if(W)throw se.result=W,O(se),se},J=(se,W)=>{const Q=new J6,K=new e$;return(async()=>{if($c.skipAnimation)throw L1(r),K.result=Oc(o,!1),O(K),K;Z(Q);const pe=yn.obj(se)?{...se}:{...W,to:se};pe.parentId=c,qu(I,(we,oe)=>{yn.und(pe[oe])&&(pe[oe]=we)});const Te=await o.start(pe);return Z(Q),r.paused&&await new Promise(we=>{r.resumeQueue.add(we)}),Te})()};let ne;if($c.skipAnimation)return L1(r),Oc(o,!1);try{let se;yn.arr(t)?se=(async W=>{for(const Q of W)await J(Q)})(t):se=Promise.resolve(t(J,o.stop.bind(o))),await Promise.all([se.then(D),F]),ne=Oc(o.get(),!0,!1)}catch(se){if(se instanceof J6)ne=se.result;else if(se instanceof e$)ne=se.result;else throw se}finally{c==r.asyncId&&(r.asyncId=f,r.asyncTo=f?x:void 0,r.promise=f?a:void 0)}return yn.fun(_)&&Fr.batchedUpdates(()=>{_(ne,o,o.item)}),ne})()}function L1(t,e){Bx(t.timeouts,r=>r.cancel()),t.pauseQueue.clear(),t.resumeQueue.clear(),t.asyncId=t.asyncTo=t.promise=void 0,e&&(t.cancelId=e)}var J6=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},e$=class extends Error{constructor(){super("SkipAnimationSignal")}},W3=t=>t instanceof F4,wwe=1,F4=class extends CZ{constructor(){super(...arguments),this.id=wwe++,this._priority=0}get priority(){return this._priority}set priority(t){this._priority!=t&&(this._priority=t,this._onPriorityChange(t))}get(){const t=Eu(this);return t&&t.getValue()}to(...t){return $c.to(this,t)}interpolate(...t){return Qbe(),$c.to(this,t)}toJSON(){return this.get()}observerAdded(t){t==1&&this._attach()}observerRemoved(t){t==0&&this._detach()}_attach(){}_detach(){}_onChange(t,e=!1){R1(this,{type:"change",parent:this,value:t,idle:e})}_onPriorityChange(t){this.idle||GA.sort(this),R1(this,{type:"priority",parent:this,priority:t})}},Vm=Symbol.for("SpringPhase"),$Z=1,H3=2,Z3=4,RM=t=>(t[Vm]&$Z)>0,Qd=t=>(t[Vm]&H3)>0,$v=t=>(t[Vm]&Z3)>0,t$=(t,e)=>e?t[Vm]|=H3|$Z:t[Vm]&=~H3,n$=(t,e)=>e?t[Vm]|=Z3:t[Vm]&=~Z3,Twe=class extends F4{constructor(t,e){if(super(),this.animation=new bwe,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!yn.und(t)||!yn.und(e)){const r=yn.obj(t)?{...t}:{...e,from:t};yn.und(r.default)&&(r.default=!0),this.start(r)}}get idle(){return!(Qd(this)||this._state.asyncTo)||$v(this)}get goal(){return za(this.animation.to)}get velocity(){const t=Eu(this);return t instanceof _b?t.lastVelocity||0:t.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return RM(this)}get isAnimating(){return Qd(this)}get isPaused(){return $v(this)}get isDelayed(){return this._state.delayed}advance(t){let e=!0,r=!1;const o=this.animation;let{toValues:c}=o;const{config:f}=o,_=ZA(o.to);!_&&$l(o.to)&&(c=hl(za(o.to))),o.values.forEach((I,D)=>{if(I.done)return;const O=I.constructor==D1?1:_?_[D].lastPosition:c[D];let F=o.immediate,Z=O;if(!F){if(Z=I.lastPosition,f.tension<=0){I.done=!0;return}let J=I.elapsedTime+=t;const ne=o.fromValues[D],se=I.v0!=null?I.v0:I.v0=yn.arr(f.velocity)?f.velocity[D]:f.velocity;let W;const Q=f.precision||(ne==O?.005:Math.min(1,Math.abs(O-ne)*.001));if(yn.und(f.duration))if(f.decay){const K=f.decay===!0?.998:f.decay,pe=Math.exp(-(1-K)*J);Z=ne+se/(1-K)*(1-pe),F=Math.abs(I.lastPosition-Z)<=Q,W=se*pe}else{W=I.lastVelocity==null?se:I.lastVelocity;const K=f.restVelocity||Q/10,pe=f.clamp?0:f.bounce,Te=!yn.und(pe),we=ne==O?I.v0>0:ne<O;let oe,de=!1;const X=1,ge=Math.ceil(t/X);for(let be=0;be<ge&&(oe=Math.abs(W)>K,!(!oe&&(F=Math.abs(O-Z)<=Q,F)));++be){Te&&(de=Z==O||Z>O==we,de&&(W=-W*pe,Z=O));const ke=-f.tension*1e-6*(Z-O),Ee=-f.friction*.001*W,Lt=(ke+Ee)/f.mass;W=W+Lt*X,Z=Z+W*X}}else{let K=1;f.duration>0&&(this._memoizedDuration!==f.duration&&(this._memoizedDuration=f.duration,I.durationProgress>0&&(I.elapsedTime=f.duration*I.durationProgress,J=I.elapsedTime+=t)),K=(f.progress||0)+J/this._memoizedDuration,K=K>1?1:K<0?0:K,I.durationProgress=K),Z=ne+f.easing(K)*(O-ne),W=(Z-I.lastPosition)/t,F=K==1}I.lastVelocity=W,Number.isNaN(Z)&&(console.warn("Got NaN while animating:",this),F=!0)}_&&!_[D].done&&(F=!1),F?I.done=!0:e=!1,I.setValue(Z,f.round)&&(r=!0)});const x=Eu(this),a=x.getValue();if(e){const I=za(o.to);(a!==I||r)&&!f.decay?(x.setValue(I),this._onChange(I)):r&&f.decay&&this._onChange(a),this._stop()}else r&&this._onChange(a)}set(t){return Fr.batchedUpdates(()=>{this._stop(),this._focus(t),this._set(t)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(Qd(this)){const{to:t,config:e}=this.animation;Fr.batchedUpdates(()=>{this._onStart(),e.decay||this._set(t,!1),this._stop()})}return this}update(t){return(this.queue||(this.queue=[])).push(t),this}start(t,e){let r;return yn.und(t)?(r=this.queue||[],this.queue=[]):r=[yn.obj(t)?t:{...e,to:t}],Promise.all(r.map(o=>this._update(o))).then(o=>N4(this,o))}stop(t){const{to:e}=this.animation;return this._focus(this.get()),L1(this._state,t&&this._lastCallId),Fr.batchedUpdates(()=>this._stop(e,t)),this}reset(){this._update({reset:!0})}eventObserved(t){t.type=="change"?this._start():t.type=="priority"&&(this.priority=t.priority+1)}_prepareNode(t){const e=this.key||"";let{to:r,from:o}=t;r=yn.obj(r)?r[e]:r,(r==null||G3(r))&&(r=void 0),o=yn.obj(o)?o[e]:o,o==null&&(o=void 0);const c={to:r,from:o};return RM(this)||(t.reverse&&([r,o]=[o,r]),o=za(o),yn.und(o)?Eu(this)||this._set(r):this._set(o)),c}_update({...t},e){const{key:r,defaultProps:o}=this;t.default&&Object.assign(o,z4(t,(_,x)=>/^on/.test(x)?NZ(_,r):_)),i$(this,t,"onProps"),qv(this,"onProps",t,this);const c=this._prepareNode(t);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const f=this._state;return jZ(++this._lastCallId,{key:r,props:t,defaultProps:o,state:f,actions:{pause:()=>{$v(this)||(n$(this,!0),ux(f.pauseQueue),qv(this,"onPause",Oc(this,Gv(this,this.animation.to)),this))},resume:()=>{$v(this)&&(n$(this,!1),Qd(this)&&this._resume(),ux(f.resumeQueue),qv(this,"onResume",Oc(this,Gv(this,this.animation.to)),this))},start:this._merge.bind(this,c)}}).then(_=>{if(t.loop&&_.finished&&!(e&&_.noop)){const x=GZ(t);if(x)return this._update(x,!0)}return _})}_merge(t,e,r){if(e.cancel)return this.stop(!0),r(hy(this));const o=!yn.und(t.to),c=!yn.und(t.from);if(o||c)if(e.callId>this._lastToId)this._lastToId=e.callId;else return r(hy(this));const{key:f,defaultProps:_,animation:x}=this,{to:a,from:I}=x;let{to:D=a,from:O=I}=t;c&&!o&&(!e.default||yn.und(D))&&(D=O),e.reverse&&([D,O]=[O,D]);const F=!Ph(O,I);F&&(x.from=O),O=za(O);const Z=!Ph(D,a);Z&&this._focus(D);const J=G3(e.to),{config:ne}=x,{decay:se,velocity:W}=ne;(o||c)&&(ne.velocity=0),e.config&&!J&&xwe(ne,om(e.config,f),e.config!==_.config?om(_.config,f):void 0);let Q=Eu(this);if(!Q||yn.und(D))return r(Oc(this,!0));const K=yn.und(e.reset)?c&&!e.default:!yn.und(O)&&Ux(e.reset,f),pe=K?O:this.get(),Te=O1(D),we=yn.num(Te)||yn.arr(Te)||HA(Te),oe=!J&&(!we||Ux(_.immediate||e.immediate,f));if(Z){const be=$3(D);if(be!==Q.constructor)if(oe)Q=this._set(Te);else throw Error(`Cannot animate between ${Q.constructor.name} and ${be.name}, as the "to" prop suggests`)}const de=Q.constructor;let X=$l(D),ge=!1;if(!X){const be=K||!RM(this)&&F;(Z||be)&&(ge=Ph(O1(pe),Te),X=!ge),(!Ph(x.immediate,oe)&&!oe||!Ph(ne.decay,se)||!Ph(ne.velocity,W))&&(X=!0)}if(ge&&Qd(this)&&(x.changed&&!K?X=!0:X||this._stop(a)),!J&&((X||$l(a))&&(x.values=Q.getPayload(),x.toValues=$l(D)?null:de==D1?[1]:hl(Te)),x.immediate!=oe&&(x.immediate=oe,!oe&&!K&&this._set(a)),X)){const{onRest:be}=x;ii(Swe,Ee=>i$(this,e,Ee));const ke=Oc(this,Gv(this,a));ux(this._pendingCalls,ke),this._pendingCalls.add(r),x.changed&&Fr.batchedUpdates(()=>{var Ee;x.changed=!K,be==null||be(ke,this),K?om(_.onRest,ke):(Ee=x.onStart)==null||Ee.call(x,ke,this)})}K&&this._set(pe),J?r(VZ(e.to,e,this._state,this)):X?this._start():Qd(this)&&!Z?this._pendingCalls.add(r):r(UZ(pe))}_focus(t){const e=this.animation;t!==e.to&&(q6(this)&&this._detach(),e.to=t,q6(this)&&this._attach())}_attach(){let t=0;const{to:e}=this.animation;$l(e)&&(e0(e,this),W3(e)&&(t=e.priority+1)),this.priority=t}_detach(){const{to:t}=this.animation;$l(t)&&M1(t,this)}_set(t,e=!0){const r=za(t);if(!yn.und(r)){const o=Eu(this);if(!o||!Ph(r,o.getValue())){const c=$3(r);!o||o.constructor!=c?L4(this,c.create(r)):o.setValue(r),o&&Fr.batchedUpdates(()=>{this._onChange(r,e)})}}return Eu(this)}_onStart(){const t=this.animation;t.changed||(t.changed=!0,qv(this,"onStart",Oc(this,Gv(this,t.to)),this))}_onChange(t,e){e||(this._onStart(),om(this.animation.onChange,t,this)),om(this.defaultProps.onChange,t,this),super._onChange(t,e)}_start(){const t=this.animation;Eu(this).reset(za(t.to)),t.immediate||(t.fromValues=t.values.map(e=>e.lastPosition)),Qd(this)||(t$(this,!0),$v(this)||this._resume())}_resume(){$c.skipAnimation?this.finish():GA.start(this)}_stop(t,e){if(Qd(this)){t$(this,!1);const r=this.animation;ii(r.values,c=>{c.done=!0}),r.toValues&&(r.onChange=r.onPause=r.onResume=void 0),R1(this,{type:"idle",parent:this});const o=e?hy(this.get()):Oc(this.get(),Gv(this,t??r.to));ux(this._pendingCalls,o),r.changed&&(r.changed=!1,qv(this,"onRest",o,this))}}};function Gv(t,e){const r=O1(e),o=O1(t.get());return Ph(o,r)}function GZ(t,e=t.loop,r=t.to){const o=om(e);if(o){const c=o!==!0&&BZ(o),f=(c||t).reverse,_=!c||c.reset;return z1({...t,loop:e,default:!1,pause:void 0,to:!f||G3(r)?r:void 0,from:_?t.from:void 0,reset:_,...c})}}function z1(t){const{to:e,from:r}=t=BZ(t),o=new Set;return yn.obj(e)&&r$(e,o),yn.obj(r)&&r$(r,o),t.keys=o.size?Array.from(o):null,t}function Ewe(t){const e=z1(t);return yn.und(e.default)&&(e.default=z4(e)),e}function r$(t,e){qu(t,(r,o)=>r!=null&&e.add(o))}var Swe=["onStart","onRest","onChange","onPause","onResume"];function i$(t,e,r){t.animation[r]=e[r]!==FZ(e,r)?NZ(e[r],t.key):void 0}function qv(t,e,...r){var o,c,f,_;(c=(o=t.animation)[e])==null||c.call(o,...r),(_=(f=t.defaultProps)[e])==null||_.call(f,...r)}var Iwe=["onStart","onChange","onRest"],Awe=1,Cwe=class{constructor(e,r){this.id=Awe++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),r&&(this._flush=r),e&&this.start({default:!0,...e})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each((r,o)=>e[o]=r.get()),e}set(e){for(const r in e){const o=e[r];yn.und(o)||this.springs[r].set(o)}}update(e){return e&&this.queue.push(z1(e)),this}start(e){let{queue:r}=this;return e?r=hl(e).map(z1):this.queue=[],this._flush?this._flush(this,r):(XZ(this,r),X3(this,r))}stop(e,r){if(e!==!!e&&(r=e),r){const o=this.springs;ii(hl(r),c=>o[c].stop(!!e))}else L1(this._state,this._lastAsyncId),this.each(o=>o.stop(!!e));return this}pause(e){if(yn.und(e))this.start({pause:!0});else{const r=this.springs;ii(hl(e),o=>r[o].pause())}return this}resume(e){if(yn.und(e))this.start({pause:!1});else{const r=this.springs;ii(hl(e),o=>r[o].resume())}return this}each(e){qu(this.springs,e)}_onFrame(){const{onStart:e,onChange:r,onRest:o}=this._events,c=this._active.size>0,f=this._changed.size>0;(c&&!this._started||f&&!this._started)&&(this._started=!0,Bx(e,([a,I])=>{I.value=this.get(),a(I,this,this._item)}));const _=!c&&this._started,x=f||_&&o.size?this.get():null;f&&r.size&&Bx(r,([a,I])=>{I.value=x,a(I,this,this._item)}),_&&(this._started=!1,Bx(o,([a,I])=>{I.value=x,a(I,this,this._item)}))}eventObserved(e){if(e.type=="change")this._changed.add(e.parent),e.idle||this._active.add(e.parent);else if(e.type=="idle")this._active.delete(e.parent);else return;Fr.onFrame(this._onFrame)}};function X3(t,e){return Promise.all(e.map(r=>qZ(t,r))).then(r=>N4(t,r))}async function qZ(t,e,r){const{keys:o,to:c,from:f,loop:_,onRest:x,onResolve:a}=e,I=yn.obj(e.default)&&e.default;_&&(e.loop=!1),c===!1&&(e.to=null),f===!1&&(e.from=null);const D=yn.arr(c)||yn.fun(c)?c:void 0;D?(e.to=void 0,e.onRest=void 0,I&&(I.onRest=void 0)):ii(Iwe,ne=>{const se=e[ne];if(yn.fun(se)){const W=t._events[ne];e[ne]=({finished:Q,cancelled:K})=>{const pe=W.get(se);pe?(Q||(pe.finished=!1),K&&(pe.cancelled=!0)):W.set(se,{value:null,finished:Q||!1,cancelled:K||!1})},I&&(I[ne]=e[ne])}});const O=t._state;e.pause===!O.paused?(O.paused=e.pause,ux(e.pause?O.pauseQueue:O.resumeQueue)):O.paused&&(e.pause=!0);const F=(o||Object.keys(t.springs)).map(ne=>t.springs[ne].start(e)),Z=e.cancel===!0||FZ(e,"cancel")===!0;(D||Z&&O.asyncId)&&F.push(jZ(++t._lastAsyncId,{props:e,state:O,actions:{pause:U3,resume:U3,start(ne,se){Z?(L1(O,t._lastAsyncId),se(hy(t))):(ne.onRest=x,se(VZ(D,ne,O,t)))}}})),O.paused&&await new Promise(ne=>{O.resumeQueue.add(ne)});const J=N4(t,await Promise.all(F));if(_&&J.finished&&!(r&&J.noop)){const ne=GZ(e,_,c);if(ne)return XZ(t,[ne]),qZ(t,ne,!0)}return a&&Fr.batchedUpdates(()=>a(J,t,t.item)),J}function s$(t,e){const r={...t.springs};return e&&ii(hl(e),o=>{yn.und(o.keys)&&(o=z1(o)),yn.obj(o.to)||(o={...o,to:void 0}),ZZ(r,o,c=>HZ(c))}),WZ(t,r),r}function WZ(t,e){qu(e,(r,o)=>{t.springs[o]||(t.springs[o]=r,e0(r,t))})}function HZ(t,e){const r=new Twe;return r.key=t,e&&e0(r,e),r}function ZZ(t,e,r){e.keys&&ii(e.keys,o=>{(t[o]||(t[o]=r(o)))._prepareNode(e)})}function XZ(t,e){ii(e,r=>{ZZ(t.springs,r,o=>HZ(o,t))})}var KA=({children:t,...e})=>{const r=ee.useContext(YS),o=e.pause||!!r.pause,c=e.immediate||!!r.immediate;e=nwe(()=>({pause:o,immediate:c}),[o,c]);const{Provider:f}=YS;return ee.createElement(f,{value:e},t)},YS=Pwe(KA,{});KA.Provider=YS.Provider;KA.Consumer=YS.Consumer;function Pwe(t,e){return Object.assign(t,ee.createContext(e)),t.Provider._context=t,t.Consumer._context=t,t}var Rwe=()=>{const t=[],e=function(o){ewe();const c=[];return ii(t,(f,_)=>{if(yn.und(o))c.push(f.start());else{const x=r(o,f,_);x&&c.push(f.start(x))}}),c};e.current=t,e.add=function(o){t.includes(o)||t.push(o)},e.delete=function(o){const c=t.indexOf(o);~c&&t.splice(c,1)},e.pause=function(){return ii(t,o=>o.pause(...arguments)),this},e.resume=function(){return ii(t,o=>o.resume(...arguments)),this},e.set=function(o){ii(t,(c,f)=>{const _=yn.fun(o)?o(f,c):o;_&&c.set(_)})},e.start=function(o){const c=[];return ii(t,(f,_)=>{if(yn.und(o))c.push(f.start());else{const x=this._getProps(o,f,_);x&&c.push(f.start(x))}}),c},e.stop=function(){return ii(t,o=>o.stop(...arguments)),this},e.update=function(o){return ii(t,(c,f)=>c.update(this._getProps(o,c,f))),this};const r=function(o,c,f){return yn.fun(o)?o(f,c):o};return e._getProps=r,e};function Mwe(t,e,r){const o=yn.fun(e)&&e;o&&!r&&(r=[]);const c=ee.useMemo(()=>o||arguments.length==3?Rwe():void 0,[]),f=ee.useRef(0),_=DZ(),x=ee.useMemo(()=>({ctrls:[],queue:[],flush(W,Q){const K=s$(W,Q);return f.current>0&&!x.queue.length&&!Object.keys(K).some(Te=>!W.springs[Te])?X3(W,Q):new Promise(Te=>{WZ(W,K),x.queue.push(()=>{Te(X3(W,Q))}),_()})}}),[]),a=ee.useRef([...x.ctrls]),I=[],D=H6(t)||0;ee.useMemo(()=>{ii(a.current.slice(t,D),W=>{gwe(W,c),W.stop(!0)}),a.current.length=t,O(D,t)},[t]),ee.useMemo(()=>{O(0,Math.min(D,t))},r);function O(W,Q){for(let K=W;K<Q;K++){const pe=a.current[K]||(a.current[K]=new Cwe(null,x.flush)),Te=o?o(K,pe):e[K];Te&&(I[K]=Ewe(Te))}}const F=a.current.map((W,Q)=>s$(W,I[Q])),Z=ee.useContext(KA),J=H6(Z),ne=Z!==J&&mwe(Z);O4(()=>{f.current++,x.ctrls=a.current;const{queue:W}=x;W.length&&(x.queue=[],ii(W,Q=>Q())),ii(a.current,(Q,K)=>{c==null||c.add(Q),ne&&Q.start({default:Z});const pe=I[K];pe&&(_we(Q,pe.ref),Q.ref?Q.queue.push(pe):Q.start(pe))})}),OZ(()=>()=>{ii(x.ctrls,W=>W.stop(!0))});const se=F.map(W=>({...W}));return c?[se,c]:se}function yb(t,e){const r=yn.fun(t),[[o],c]=Mwe(1,r?t:[t],r?[]:e);return r||arguments.length==2?[o,c]:o}var kwe=class extends F4{constructor(t,e){super(),this.source=t,this.idle=!0,this._active=new Set,this.calc=C1(...e);const r=this._get(),o=$3(r);L4(this,o.create(r))}advance(t){const e=this._get(),r=this.get();Ph(e,r)||(Eu(this).setValue(e),this._onChange(e,this.idle)),!this.idle&&o$(this._active)&&MM(this)}_get(){const t=yn.arr(this.source)?this.source.map(za):hl(za(this.source));return this.calc(...t)}_start(){this.idle&&!o$(this._active)&&(this.idle=!1,ii(ZA(this),t=>{t.done=!1}),$c.skipAnimation?(Fr.batchedUpdates(()=>this.advance()),MM(this)):GA.start(this))}_attach(){let t=1;ii(hl(this.source),e=>{$l(e)&&e0(e,this),W3(e)&&(e.idle||this._active.add(e),t=Math.max(t,e.priority+1))}),this.priority=t,this._start()}_detach(){ii(hl(this.source),t=>{$l(t)&&M1(t,this)}),this._active.clear(),MM(this)}eventObserved(t){t.type=="change"?t.idle?this.advance():(this._active.add(t.parent),this._start()):t.type=="idle"?this._active.delete(t.parent):t.type=="priority"&&(this.priority=hl(this.source).reduce((e,r)=>Math.max(e,(W3(r)?r.priority:0)+1),0))}};function Dwe(t){return t.idle!==!1}function o$(t){return!t.size||Array.from(t).every(Dwe)}function MM(t){t.idle||(t.idle=!0,ii(ZA(t),e=>{e.done=!0}),R1(t,{type:"idle",parent:t}))}$c.assign({createStringInterpolator:MZ,to:(t,e)=>new kwe(t,e)});var KZ=/^--/;function Owe(t,e){return e==null||typeof e=="boolean"||e===""?"":typeof e=="number"&&e!==0&&!KZ.test(t)&&!(Vx.hasOwnProperty(t)&&Vx[t])?e+"px":(""+e).trim()}var a$={};function Lwe(t,e){if(!t.nodeType||!t.setAttribute)return!1;const r=t.nodeName==="filter"||t.parentNode&&t.parentNode.nodeName==="filter",{style:o,children:c,scrollTop:f,scrollLeft:_,viewBox:x,...a}=e,I=Object.values(a),D=Object.keys(a).map(O=>r||t.hasAttribute(O)?O:a$[O]||(a$[O]=O.replace(/([A-Z])/g,F=>"-"+F.toLowerCase())));c!==void 0&&(t.textContent=c);for(const O in o)if(o.hasOwnProperty(O)){const F=Owe(O,o[O]);KZ.test(O)?t.style.setProperty(O,F):t.style[O]=F}D.forEach((O,F)=>{t.setAttribute(O,I[F])}),f!==void 0&&(t.scrollTop=f),_!==void 0&&(t.scrollLeft=_),x!==void 0&&t.setAttribute("viewBox",x)}var Vx={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},zwe=(t,e)=>t+e.charAt(0).toUpperCase()+e.substring(1),Nwe=["Webkit","Ms","Moz","O"];Vx=Object.keys(Vx).reduce((t,e)=>(Nwe.forEach(r=>t[zwe(r,e)]=t[e]),t),Vx);var Fwe=/^(matrix|translate|scale|rotate|skew)/,Bwe=/^(translate)/,jwe=/^(rotate|skew)/,kM=(t,e)=>yn.num(t)&&t!==0?t+e:t,RE=(t,e)=>yn.arr(t)?t.every(r=>RE(r,e)):yn.num(t)?t===e:parseFloat(t)===e,Uwe=class extends XA{constructor({x:t,y:e,z:r,...o}){const c=[],f=[];(t||e||r)&&(c.push([t||0,e||0,r||0]),f.push(_=>[`translate3d(${_.map(x=>kM(x,"px")).join(",")})`,RE(_,0)])),qu(o,(_,x)=>{if(x==="transform")c.push([_||""]),f.push(a=>[a,a===""]);else if(Fwe.test(x)){if(delete o[x],yn.und(_))return;const a=Bwe.test(x)?"px":jwe.test(x)?"deg":"";c.push(hl(_)),f.push(x==="rotate3d"?([I,D,O,F])=>[`rotate3d(${I},${D},${O},${kM(F,a)})`,RE(F,0)]:I=>[`${x}(${I.map(D=>kM(D,a)).join(",")})`,RE(I,x.startsWith("scale")?1:0)])}}),c.length&&(o.transform=new Vwe(c,f)),super(o)}},Vwe=class extends CZ{constructor(t,e){super(),this.inputs=t,this.transforms=e,this._value=null}get(){return this._value||(this._value=this._get())}_get(){let t="",e=!0;return ii(this.inputs,(r,o)=>{const c=za(r[0]),[f,_]=this.transforms[o](yn.arr(c)?c:r.map(za));t+=" "+f,e=e&&_}),e?"none":t}observerAdded(t){t==1&&ii(this.inputs,e=>ii(e,r=>$l(r)&&e0(r,this)))}observerRemoved(t){t==0&&ii(this.inputs,e=>ii(e,r=>$l(r)&&M1(r,this)))}eventObserved(t){t.type=="change"&&(this._value=null),R1(this,t)}},$we=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"];$c.assign({batchedUpdates:TI.unstable_batchedUpdates,createStringInterpolator:MZ,colors:Mbe});var Gwe=uwe($we,{applyAnimatedValues:Lwe,createAnimatedStyle:t=>new Uwe(t),getComponentProps:({scrollTop:t,scrollLeft:e,...r})=>r}),vb=Gwe.animated;function K3(t,e){return t.map(function(r,o){return r+e[o]})}function B4(t,e){return t.map(function(r,o){return r-e[o]})}function Y3(t){return Math.hypot.apply(Math,t)}function qwe(t,e,r){var o=Y3(e),c=o===0?0:1/o,f=r===0?0:1/r,_=f*o,x=e.map(function(D){return f*D}),a=e.map(function(D){return c*D}),I=Y3(t);return{velocities:x,velocity:_,distance:I,direction:a}}function Q3(t){return Math.sign?Math.sign(t):+(t>0)-+(t<0)||+t}function Wwe(t,e,r){return Math.max(e,Math.min(t,r))}function Hwe(t,e){return Math.pow(t,e*5)}function l$(t,e,r){return e===0||Math.abs(e)===1/0?Hwe(t,r):t*e*r/(e+r*t)}function c$(t,e,r,o){return o===void 0&&(o=.15),o===0?Wwe(t,e,r):t<e?-l$(e-t,r-e,o)+e:t>r?+l$(t-r,r-e,o)+r:t}function Zwe(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function Xwe(t,e,r){return e&&Zwe(t.prototype,e),t}function wa(){return wa=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},wa.apply(this,arguments)}function YZ(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function Kwe(t,e){if(t==null)return{};var r={},o=Object.keys(t),c,f;for(f=0;f<o.length;f++)c=o[f],!(e.indexOf(c)>=0)&&(r[c]=t[c]);return r}function Ah(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ywe(t,e){if(t){if(typeof t=="string")return u$(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u$(t,e)}}function u$(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,o=new Array(e);r<e;r++)o[r]=t[r];return o}function YA(t,e){var r;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(r=Ywe(t))||e){r&&(t=r);var o=0;return function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return r=t[Symbol.iterator](),r.next.bind(r)}function QZ(){}function JZ(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.length===0?QZ:e.length===1?e[0]:function(){for(var o,c=YA(e),f;!(f=c()).done;){var _=f.value;o=_.apply(this,arguments)||o}return o}}function hf(t,e){if(t===void 0){if(e===void 0)throw new Error("Must define fallback value if undefined is expected");t=e}return Array.isArray(t)?t:[t,t]}function h$(t){if(typeof t=="function"){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];return t.apply(void 0,r)}else return t}function j4(t,e){t===void 0&&(t={});for(var r={},o=0,c=Object.entries(e);o<c.length;o++){var f=c[o],_=f[0],x=f[1];switch(typeof x){case"function":r[_]=x.call(r,t[_],_,t);break;case"object":r[_]=j4(t[_],x);break;case"boolean":x&&(r[_]=t[_]);break}}return r}function Qwe(){try{return"constructor"in GestureEvent}catch{return!1}}function eX(){return typeof window<"u"&&"ontouchstart"in window}function Jwe(){return typeof window<"u"&&"onpointerdown"in window}function tX(t){return"pointerId"in t?null:t.type==="touchend"?t.changedTouches:t.targetTouches}function nX(t){return Array.from(tX(t)).map(function(e){return e.identifier})}function d$(t){var e="buttons"in t?t.buttons:0,r=t.shiftKey,o=t.altKey,c=t.metaKey,f=t.ctrlKey;return{buttons:e,shiftKey:r,altKey:o,metaKey:c,ctrlKey:f}}var eTe=function(e){return e};function f$(t,e){e===void 0&&(e=eTe);var r=tX(t),o=r?r[0]:t,c=o.clientX,f=o.clientY;return e([c,f])}var tTe=180,nTe=.15,rTe=.5,iTe=50,sTe=250,oTe={threshold:function(e){return e===void 0&&(e=0),hf(e)},rubberband:function(e){switch(e===void 0&&(e=0),e){case!0:return hf(nTe);case!1:return hf(0);default:return hf(e)}},enabled:function(e){return e===void 0&&(e=!0),e},triggerAllEvents:function(e){return e===void 0&&(e=!1),e},initial:function(e){return e===void 0&&(e=0),typeof e=="function"?e:hf(e)},transform:!0},rX=wa({},oTe,{axis:!0,lockDirection:function(e){return e===void 0&&(e=!1),e},bounds:function(e){if(e===void 0&&(e={}),typeof e=="function")return function(O){return rX.bounds(e(O))};var r=e,o=r.left,c=o===void 0?-1/0:o,f=r.right,_=f===void 0?1/0:f,x=r.top,a=x===void 0?-1/0:x,I=r.bottom,D=I===void 0?1/0:I;return[[c,_],[a,D]]}}),aTe=typeof window<"u"&&window.document&&window.document.createElement,lTe={enabled:function(e){return e===void 0&&(e=!0),e},domTarget:!0,window:function(t){function e(r){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return t===void 0&&(t=aTe?window:void 0),t}),eventOptions:function(e){var r=e===void 0?{}:e,o=r.passive,c=o===void 0?!0:o,f=r.capture,_=f===void 0?!1:f;return{passive:c,capture:_}},transform:!0},cTe=wa({},rX,{useTouch:function(e){e===void 0&&(e=!1);var r=eX(),o=Jwe();return!!(e&&r||r&&!o)},experimental_preventWindowScrollY:function(e){return e===void 0&&(e=!1),e},threshold:function(e,r,o){var c=o.filterTaps,f=c===void 0?!1:c,_=o.lockDirection,x=_===void 0?!1:_,a=o.axis,I=a===void 0?void 0:a,D=hf(e,f?3:x||I?1:0);return this.filterTaps=f,D},swipeVelocity:function(e){return e===void 0&&(e=rTe),hf(e)},swipeDistance:function(e){return e===void 0&&(e=iTe),hf(e)},swipeDuration:function(e){return e===void 0&&(e=sTe),e},delay:function(e){switch(e===void 0&&(e=0),e){case!0:return tTe;case!1:return 0;default:return e}}});function uTe(t){return t===void 0&&(t={}),j4(t,lTe)}function hTe(t){return t===void 0&&(t={}),j4(t,cTe)}function dTe(t){var e=t.domTarget,r=t.eventOptions,o=t.window,c=t.enabled,f=Kwe(t,["domTarget","eventOptions","window","enabled"]),_=uTe({domTarget:e,eventOptions:r,window:o,enabled:c});return _.drag=hTe(f),_}function Wv(t){return wa({_active:!1,_blocked:!1,_intentional:[!1,!1],_movement:[0,0],_initial:[0,0],_bounds:[[-1/0,1/0],[-1/0,1/0]],_threshold:[0,0],_lastEventType:void 0,_dragStarted:!1,_dragPreventScroll:!1,_dragIsTap:!0,_dragDelayed:!1,event:void 0,intentional:!1,values:[0,0],velocities:[0,0],delta:[0,0],movement:[0,0],offset:[0,0],lastOffset:[0,0],direction:[0,0],initial:[0,0],previous:[0,0],first:!1,last:!1,active:!1,timeStamp:0,startTime:0,elapsedTime:0,cancel:QZ,canceled:!1,memo:void 0,args:void 0},t)}function iX(){var t={hovering:!1,scrolling:!1,wheeling:!1,dragging:!1,moving:!1,pinching:!1,touches:0,buttons:0,down:!1,shiftKey:!1,altKey:!1,metaKey:!1,ctrlKey:!1,locked:!1},e=Wv({_pointerId:void 0,axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0,tap:!1,swipe:[0,0]}),r=Wv({_pointerIds:[],da:[0,0],vdva:[0,0],origin:void 0,turns:0}),o=Wv({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),c=Wv({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),f=Wv({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0});return{shared:t,drag:e,pinch:r,wheel:o,move:c,scroll:f}}var sm=new Map,fTe=function(e){return e},pTe=function(){function t(r,o){var c=this;o===void 0&&(o=[]),this.controller=r,this.args=o,this.debounced=!0,this.setTimeout=function(f,_){var x;_===void 0&&(_=140),clearTimeout(c.controller.timeouts[c.stateKey]);for(var a=arguments.length,I=new Array(a>2?a-2:0),D=2;D<a;D++)I[D-2]=arguments[D];c.controller.timeouts[c.stateKey]=(x=window).setTimeout.apply(x,[f,_].concat(I))},this.clearTimeout=function(){clearTimeout(c.controller.timeouts[c.stateKey])},this.fireGestureHandler=function(f){if(f===void 0&&(f=!1),c.state._blocked)return c.debounced||(c.state._active=!1,c.clean()),null;if(!f&&!c.state.intentional&&!c.config.triggerAllEvents)return null;if(c.state.intentional){var _=c.state.active,x=c.state._active;c.state.active=x,c.state.first=x&&!_,c.state.last=_&&!x,c.controller.state.shared[c.ingKey]=x}var a=c.controller.pointerIds.size||c.controller.touchIds.size,I=c.controller.state.shared.buttons>0||a>0,D=wa({},c.controller.state.shared,c.state,c.mapStateValues(c.state),{locked:!!document.pointerLockElement,touches:a,down:I}),O=c.handler(D);return c.state.memo=O!==void 0?O:c.state.memo,D},this.controller=r,this.args=o}var e=t.prototype;return e.updateSharedState=function(o){Object.assign(this.controller.state.shared,o)},e.updateGestureState=function(o){Object.assign(this.state,o)},e.checkIntentionality=function(o,c){return{_intentional:o,_blocked:!1}},e.getMovement=function(o){var c=this.config.rubberband,f=this.state,_=f._bounds,x=f._initial,a=f._active,I=f._intentional,D=f.lastOffset,O=f.movement,F=f._threshold,Z=this.getInternalMovement(o,this.state),J=I[0]===!1?p$(Z[0],F[0]):I[0],ne=I[1]===!1?p$(Z[1],F[1]):I[1],se=this.checkIntentionality([J,ne],Z);if(se._blocked)return wa({},se,{_movement:Z,delta:[0,0]});var W=se._intentional,Q=Z,K=[W[0]!==!1?Z[0]-W[0]:0,W[1]!==!1?Z[1]-W[1]:0],pe=K3(K,D),Te=a?c:[0,0];return K=m$(_,K3(K,x),Te),wa({},se,{intentional:W[0]!==!1||W[1]!==!1,_initial:x,_movement:Q,movement:K,values:o,offset:m$(_,pe,Te),delta:B4(K,O)})},e.clean=function(){this.clearTimeout()},Xwe(t,[{key:"config",get:function(){return this.controller.config[this.stateKey]}},{key:"enabled",get:function(){return this.controller.config.enabled&&this.config.enabled}},{key:"state",get:function(){return this.controller.state[this.stateKey]}},{key:"handler",get:function(){return this.controller.handlers[this.stateKey]}},{key:"transform",get:function(){return this.config.transform||this.controller.config.transform||fTe}}]),t}();function p$(t,e){return Math.abs(t)>=e?Q3(t)*e:!1}function m$(t,e,r){var o=e[0],c=e[1],f=r[0],_=r[1],x=t[0],a=x[0],I=x[1],D=t[1],O=D[0],F=D[1];return[c$(o,a,I,f),c$(c,O,F,_)]}function DM(t,e,r){var o=t.state,c=e.timeStamp,f=e.type,_=o.values,x=r?0:c-o.startTime;return{_lastEventType:f,event:e,timeStamp:c,elapsedTime:x,previous:_}}function mTe(t,e,r,o){var c=t.state,f=t.config,_=t.stateKey,x=t.args,a=t.transform,I=c.offset,D=r.timeStamp,O=f.initial,F=f.bounds,Z=f.threshold,J=B4(a(Z),a([0,0])).map(Math.abs),ne=wa({},iX()[_],{_active:!0,args:x,values:e,initial:e,_threshold:J,offset:I,lastOffset:I,startTime:D});return wa({},ne,{_initial:h$(O,ne),_bounds:h$(F,ne)})}var gTe=function(e){var r=this;this.classes=e,this.pointerIds=new Set,this.touchIds=new Set,this.supportsTouchEvents=eX(),this.supportsGestureEvents=Qwe(),this.bind=function(){for(var o=arguments.length,c=new Array(o),f=0;f<o;f++)c[f]=arguments[f];for(var _={},x=YA(r.classes),a;!(a=x()).done;){var I=a.value;new I(r,c).addBindings(_)}var D=function(Z){bu(_,Z,function(J){return r.nativeRefs[Z](wa({},r.state.shared,{event:J,args:c}))})};for(var O in r.nativeRefs)D(O);return r.config.domTarget?wTe(r,_):TTe(r,_)},this.effect=function(){return r.config.domTarget&&r.bind(),r.clean},this.clean=function(){var o=oX(r.config),c=r.config.eventOptions;o&&xb(o,sX(r.domListeners),c),Object.values(r.timeouts).forEach(clearTimeout),vTe(r)},this.classes=e,this.state=iX(),this.timeouts={},this.domListeners=[],this.windowListeners={}};function _Te(t,e){"pointerId"in e?t.pointerIds.add(e.pointerId):t.touchIds=new Set(nX(e))}function yTe(t,e){"pointerId"in e?t.pointerIds.delete(e.pointerId):nX(e).forEach(function(r){return t.touchIds.delete(r)})}function vTe(t){var e=t.config,r=e.window,o=e.eventOptions,c=t.windowListeners;if(r){for(var f in c){var _=c[f];xb(r,_,o)}t.windowListeners={}}}function xTe(t,e,r){var o=t.config,c=t.windowListeners;r===void 0&&(r=o.eventOptions),o.window&&(xb(o.window,c[e],r),delete c[e])}function bTe(t,e,r,o){var c=t.config,f=t.windowListeners;r===void 0&&(r=[]),o===void 0&&(o=c.eventOptions),c.window&&(xb(c.window,f[e],o),aX(c.window,f[e]=r,o))}function wTe(t,e){var r=t.config,o=t.domListeners,c=oX(r);if(!c)throw new Error("domTarget must be defined");var f=r.eventOptions;xb(c,sX(o),f);for(var _=0,x=Object.entries(e);_<x.length;_++){var a=x[_],I=a[0],D=a[1],O=I.slice(2).toLowerCase();o.push([O,JZ.apply(void 0,D)])}aX(c,o,f)}function TTe(t,e){for(var r=t.config,o={},c=r.eventOptions.capture?"Capture":"",f=0,_=Object.entries(e);f<_.length;f++){var x=_[f],a=x[0],I=x[1],D=Array.isArray(I)?I:[I],O=a+c;o[O]=JZ.apply(void 0,D)}return o}function sX(t){return t===void 0&&(t=[]),t.splice(0,t.length)}function oX(t){var e=t.domTarget;return e&&"current"in e?e.current:e}function bu(t,e,r){t[e]||(t[e]=[]),t[e].push(r)}function aX(t,e,r){e===void 0&&(e=[]),r===void 0&&(r={});for(var o=YA(e),c;!(c=o()).done;){var f=c.value,_=f[0],x=f[1];t.addEventListener(_,x,r)}}function xb(t,e,r){e===void 0&&(e=[]),r===void 0&&(r={});for(var o=YA(e),c;!(c=o()).done;){var f=c.value,_=f[0],x=f[1];t.removeEventListener(_,x,r)}}function ETe(t,e,r){r===void 0&&(r={});var o=ITe(t),c=Qr.useMemo(function(){return new gTe(o)},[]);return c.config=e,c.handlers=t,c.nativeRefs=r,Qr.useEffect(c.effect,[]),c.config.domTarget?STe:c.bind}function STe(){}function ITe(t){var e=new Set;return t.drag&&e.add(sm.get("drag")),t.wheel&&e.add(sm.get("wheel")),t.scroll&&e.add(sm.get("scroll")),t.move&&e.add(sm.get("move")),t.pinch&&e.add(sm.get("pinch")),t.hover&&e.add(sm.get("hover")),e}var ATe=function(t){YZ(e,t);function e(){return t.apply(this,arguments)||this}var r=e.prototype;return r.getInternalMovement=function(c,f){return B4(c,f.initial)},r.checkIntentionality=function(c,f){if(c[0]===!1&&c[1]===!1)return{_intentional:c,axis:this.state.axis};var _=f.map(Math.abs),x=_[0],a=_[1],I=this.state.axis||(x>a?"x":x<a?"y":void 0);return!this.config.axis&&!this.config.lockDirection?{_intentional:c,_blocked:!1,axis:I}:I?this.config.axis&&I!==this.config.axis?{_intentional:c,_blocked:!0,axis:I}:(c[I==="x"?1:0]=!1,{_intentional:c,_blocked:!1,axis:I}):{_intentional:[!1,!1],_blocked:!1,axis:I}},r.getKinematics=function(c,f){var _=this.getMovement(c);if(!_._blocked){var x=f.timeStamp-this.state.timeStamp;Object.assign(_,qwe(_.movement,_.delta,x))}return _},r.mapStateValues=function(c){return{xy:c.values,vxvy:c.velocities}},e}(pTe),CTe=3;function g$(t){"persist"in t&&typeof t.persist=="function"&&t.persist()}var PTe=function(t){YZ(e,t);function e(){var o;return o=t.apply(this,arguments)||this,o.ingKey="dragging",o.stateKey="drag",o.setPointerCapture=function(c){if(!(o.config.useTouch||document.pointerLockElement)){var f=c.target,_=c.pointerId;f&&"setPointerCapture"in f&&f.setPointerCapture(_),o.updateGestureState({_dragTarget:f,_dragPointerId:_})}},o.releasePointerCapture=function(){if(!(o.config.useTouch||document.pointerLockElement)){var c=o.state,f=c._dragTarget,_=c._dragPointerId;if(_&&f&&"releasePointerCapture"in f&&(!("hasPointerCapture"in f)||f.hasPointerCapture(_)))try{f.releasePointerCapture(_)}catch{}}},o.preventScroll=function(c){o.state._dragPreventScroll&&c.cancelable&&c.preventDefault()},o.getEventId=function(c){return o.config.useTouch?c.changedTouches[0].identifier:c.pointerId},o.isValidEvent=function(c){return o.state._pointerId===o.getEventId(c)},o.shouldPreventWindowScrollY=o.config.experimental_preventWindowScrollY&&o.controller.supportsTouchEvents,o.setUpWindowScrollDetection=function(c){g$(c),bTe(o.controller,o.stateKey,[["touchmove",o.preventScroll],["touchend",o.clean.bind(Ah(o))],["touchcancel",o.clean.bind(Ah(o))]],{passive:!1}),o.setTimeout(o.startDrag.bind(Ah(o)),250,c)},o.setUpDelayedDragTrigger=function(c){o.state._dragDelayed=!0,g$(c),o.setTimeout(o.startDrag.bind(Ah(o)),o.config.delay,c)},o.setStartState=function(c){var f=f$(c,o.transform);o.updateSharedState(d$(c)),o.updateGestureState(wa({},mTe(Ah(o),f,c),DM(Ah(o),c,!0),{_pointerId:o.getEventId(c)})),o.updateGestureState(o.getMovement(f))},o.onDragStart=function(c){_Te(o.controller,c),!(!o.enabled||o.state._active)&&(o.setStartState(c),o.setPointerCapture(c),o.shouldPreventWindowScrollY?o.setUpWindowScrollDetection(c):o.config.delay>0?o.setUpDelayedDragTrigger(c):o.startDrag(c,!0))},o.onDragChange=function(c){if(!(o.state.canceled||!o.state._active||!o.isValidEvent(c)||o.state._lastEventType===c.type&&c.timeStamp===o.state.timeStamp)){var f;if(document.pointerLockElement){var _=c.movementX,x=c.movementY;f=K3(o.transform([_,x]),o.state.values)}else f=f$(c,o.transform);var a=o.getKinematics(f,c);if(!o.state._dragStarted){if(o.state._dragDelayed){o.startDrag(c);return}if(o.shouldPreventWindowScrollY)if(!o.state._dragPreventScroll&&a.axis)if(a.axis==="x")o.startDrag(c);else{o.state._active=!1;return}else return;else return}var I=d$(c);o.updateSharedState(I);var D=DM(Ah(o),c),O=Y3(a._movement),F=o.state._dragIsTap;F&&O>=CTe&&(F=!1),o.updateGestureState(wa({},D,a,{_dragIsTap:F})),o.fireGestureHandler()}},o.onDragEnd=function(c){if(yTe(o.controller,c),!!o.isValidEvent(c)&&(o.clean(),!!o.state._active)){o.state._active=!1;var f=o.state._dragIsTap,_=o.state.velocities,x=_[0],a=_[1],I=o.state.movement,D=I[0],O=I[1],F=o.state._intentional,Z=F[0],J=F[1],ne=o.config.swipeVelocity,se=ne[0],W=ne[1],Q=o.config.swipeDistance,K=Q[0],pe=Q[1],Te=o.config.swipeDuration,we=wa({},DM(Ah(o),c),o.getMovement(o.state.values)),oe=[0,0];we.elapsedTime<Te&&(Z!==!1&&Math.abs(x)>se&&Math.abs(D)>K&&(oe[0]=Q3(x)),J!==!1&&Math.abs(a)>W&&Math.abs(O)>pe&&(oe[1]=Q3(a))),o.updateSharedState({buttons:0}),o.updateGestureState(wa({},we,{tap:f,swipe:oe})),o.fireGestureHandler(o.config.filterTaps&&f===!0)}},o.clean=function(){t.prototype.clean.call(Ah(o)),o.state._dragStarted=!1,o.releasePointerCapture(),xTe(o.controller,o.stateKey)},o.onCancel=function(){o.state.canceled||(o.updateGestureState({canceled:!0,_active:!1}),o.updateSharedState({buttons:0}),setTimeout(function(){return o.fireGestureHandler()},0))},o.onClick=function(c){o.state._dragIsTap||c.stopPropagation()},o}var r=e.prototype;return r.startDrag=function(c,f){f===void 0&&(f=!1),!(!this.state._active||this.state._dragStarted)&&(f||this.setStartState(c),this.updateGestureState({_dragStarted:!0,_dragPreventScroll:!0,cancel:this.onCancel}),this.clearTimeout(),this.fireGestureHandler())},r.addBindings=function(c){if(this.config.useTouch?(bu(c,"onTouchStart",this.onDragStart),bu(c,"onTouchMove",this.onDragChange),bu(c,"onTouchEnd",this.onDragEnd),bu(c,"onTouchCancel",this.onDragEnd)):(bu(c,"onPointerDown",this.onDragStart),bu(c,"onPointerMove",this.onDragChange),bu(c,"onPointerUp",this.onDragEnd),bu(c,"onPointerCancel",this.onDragEnd)),this.config.filterTaps){var f=this.controller.config.eventOptions.capture?"onClick":"onClickCapture";bu(c,f,this.onClick)}},e}(ATe);function RTe(t,e){var r,o=[],c,f=!1;function _(){for(var x=arguments.length,a=new Array(x),I=0;I<x;I++)a[I]=arguments[I];return f&&r===this&&e(a,o)||(c=t.apply(this,a),f=!0,r=this,o=a),c}return _}function ME(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var r,o,c;if(Array.isArray(t)){if(r=t.length,r!==e.length)return!1;for(o=r;o--!==0;)if(!ME(t[o],e[o]))return!1;return!0}var f;if(typeof Map=="function"&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(f=t.entries();!(o=f.next()).done;)if(!e.has(o.value[0]))return!1;for(f=t.entries();!(o=f.next()).done;)if(!ME(o.value[1],e.get(o.value[0])))return!1;return!0}if(typeof Set=="function"&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(f=t.entries();!(o=f.next()).done;)if(!e.has(o.value[0]))return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===e.toString();if(c=Object.keys(t),r=c.length,r!==Object.keys(e).length)return!1;for(o=r;o--!==0;)if(!Object.prototype.hasOwnProperty.call(e,c[o]))return!1;if(typeof Element<"u"&&t instanceof Element)return!1;for(o=r;o--!==0;)if(!(c[o]==="_owner"&&t.$$typeof)&&!ME(t[c[o]],e[c[o]]))return!1;return!0}return t!==t&&e!==e}function MTe(t,e){try{return ME(t,e)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}}function bb(t,e){e===void 0&&(e={}),sm.set("drag",PTe);var r=ee.useRef();return r.current||(r.current=RTe(dTe,MTe)),ETe({drag:t},r.current(e))}var Ua=function(){return Ua=Object.assign||function(e){for(var r,o=1,c=arguments.length;o<c;o++){r=arguments[o];for(var f in r)Object.prototype.hasOwnProperty.call(r,f)&&(e[f]=r[f])}return e},Ua.apply(this,arguments)};function QS(t,e,r){if(r||arguments.length===2)for(var o=0,c=e.length,f;o<c;o++)(f||!(o in e))&&(f||(f=Array.prototype.slice.call(e,0,o)),f[o]=e[o]);return t.concat(f||Array.prototype.slice.call(e))}var es="-ms-",$x="-moz-",Ti="-webkit-",lX="comm",QA="rule",U4="decl",kTe="@import",cX="@keyframes",DTe="@layer",uX=Math.abs,V4=String.fromCharCode,J3=Object.assign;function OTe(t,e){return Eo(t,0)^45?(((e<<2^Eo(t,0))<<2^Eo(t,1))<<2^Eo(t,2))<<2^Eo(t,3):0}function hX(t){return t.trim()}function Rh(t,e){return(t=e.exec(t))?t[0]:t}function $r(t,e,r){return t.replace(e,r)}function kE(t,e,r){return t.indexOf(e,r)}function Eo(t,e){return t.charCodeAt(e)|0}function Oy(t,e,r){return t.slice(e,r)}function Au(t){return t.length}function dX(t){return t.length}function hx(t,e){return e.push(t),t}function LTe(t,e){return t.map(e).join("")}function _$(t,e){return t.filter(function(r){return!Rh(r,e)})}var JA=1,Ly=1,fX=0,Jl=0,Qs=0,t0="";function eC(t,e,r,o,c,f,_,x){return{value:t,root:e,parent:r,type:o,props:c,children:f,line:JA,column:Ly,length:_,return:"",siblings:x}}function ef(t,e){return J3(eC("",null,null,"",null,null,0,t.siblings),t,{length:-t.length},e)}function A_(t){for(;t.root;)t=ef(t.root,{children:[t]});hx(t,t.siblings)}function zTe(){return Qs}function NTe(){return Qs=Jl>0?Eo(t0,--Jl):0,Ly--,Qs===10&&(Ly=1,JA--),Qs}function jc(){return Qs=Jl<fX?Eo(t0,Jl++):0,Ly++,Qs===10&&(Ly=1,JA++),Qs}function wm(){return Eo(t0,Jl)}function DE(){return Jl}function tC(t,e){return Oy(t0,t,e)}function eD(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function FTe(t){return JA=Ly=1,fX=Au(t0=t),Jl=0,[]}function BTe(t){return t0="",t}function OM(t){return hX(tC(Jl-1,tD(t===91?t+2:t===40?t+1:t)))}function jTe(t){for(;(Qs=wm())&&Qs<33;)jc();return eD(t)>2||eD(Qs)>3?"":" "}function UTe(t,e){for(;--e&&jc()&&!(Qs<48||Qs>102||Qs>57&&Qs<65||Qs>70&&Qs<97););return tC(t,DE()+(e<6&&wm()==32&&jc()==32))}function tD(t){for(;jc();)switch(Qs){case t:return Jl;case 34:case 39:t!==34&&t!==39&&tD(Qs);break;case 40:t===41&&tD(t);break;case 92:jc();break}return Jl}function VTe(t,e){for(;jc()&&t+Qs!==57;)if(t+Qs===84&&wm()===47)break;return"/*"+tC(e,Jl-1)+"*"+V4(t===47?t:jc())}function $Te(t){for(;!eD(wm());)jc();return tC(t,Jl)}function GTe(t){return BTe(OE("",null,null,null,[""],t=FTe(t),0,[0],t))}function OE(t,e,r,o,c,f,_,x,a){for(var I=0,D=0,O=_,F=0,Z=0,J=0,ne=1,se=1,W=1,Q=0,K="",pe=c,Te=f,we=o,oe=K;se;)switch(J=Q,Q=jc()){case 40:if(J!=108&&Eo(oe,O-1)==58){kE(oe+=$r(OM(Q),"&","&\f"),"&\f",uX(I?x[I-1]:0))!=-1&&(W=-1);break}case 34:case 39:case 91:oe+=OM(Q);break;case 9:case 10:case 13:case 32:oe+=jTe(J);break;case 92:oe+=UTe(DE()-1,7);continue;case 47:switch(wm()){case 42:case 47:hx(qTe(VTe(jc(),DE()),e,r,a),a);break;default:oe+="/"}break;case 123*ne:x[I++]=Au(oe)*W;case 125*ne:case 59:case 0:switch(Q){case 0:case 125:se=0;case 59+D:W==-1&&(oe=$r(oe,/\f/g,"")),Z>0&&Au(oe)-O&&hx(Z>32?v$(oe+";",o,r,O-1,a):v$($r(oe," ","")+";",o,r,O-2,a),a);break;case 59:oe+=";";default:if(hx(we=y$(oe,e,r,I,D,c,x,K,pe=[],Te=[],O,f),f),Q===123)if(D===0)OE(oe,e,we,we,pe,f,O,x,Te);else switch(F===99&&Eo(oe,3)===110?100:F){case 100:case 108:case 109:case 115:OE(t,we,we,o&&hx(y$(t,we,we,0,0,c,x,K,c,pe=[],O,Te),Te),c,Te,O,x,o?pe:Te);break;default:OE(oe,we,we,we,[""],Te,0,x,Te)}}I=D=Z=0,ne=W=1,K=oe="",O=_;break;case 58:O=1+Au(oe),Z=J;default:if(ne<1){if(Q==123)--ne;else if(Q==125&&ne++==0&&NTe()==125)continue}switch(oe+=V4(Q),Q*ne){case 38:W=D>0?1:(oe+="\f",-1);break;case 44:x[I++]=(Au(oe)-1)*W,W=1;break;case 64:wm()===45&&(oe+=OM(jc())),F=wm(),D=O=Au(K=oe+=$Te(DE())),Q++;break;case 45:J===45&&Au(oe)==2&&(ne=0)}}return f}function y$(t,e,r,o,c,f,_,x,a,I,D,O){for(var F=c-1,Z=c===0?f:[""],J=dX(Z),ne=0,se=0,W=0;ne<o;++ne)for(var Q=0,K=Oy(t,F+1,F=uX(se=_[ne])),pe=t;Q<J;++Q)(pe=hX(se>0?Z[Q]+" "+K:$r(K,/&\f/g,Z[Q])))&&(a[W++]=pe);return eC(t,e,r,c===0?QA:x,a,I,D,O)}function qTe(t,e,r,o){return eC(t,e,r,lX,V4(zTe()),Oy(t,2,-2),0,o)}function v$(t,e,r,o,c){return eC(t,e,r,U4,Oy(t,0,o),Oy(t,o+1,-1),o,c)}function pX(t,e,r){switch(OTe(t,e)){case 5103:return Ti+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Ti+t+t;case 4789:return $x+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return Ti+t+$x+t+es+t+t;case 5936:switch(Eo(t,e+11)){case 114:return Ti+t+es+$r(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return Ti+t+es+$r(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return Ti+t+es+$r(t,/[svh]\w+-[tblr]{2}/,"lr")+t}case 6828:case 4268:case 2903:return Ti+t+es+t+t;case 6165:return Ti+t+es+"flex-"+t+t;case 5187:return Ti+t+$r(t,/(\w+).+(:[^]+)/,Ti+"box-$1$2"+es+"flex-$1$2")+t;case 5443:return Ti+t+es+"flex-item-"+$r(t,/flex-|-self/g,"")+(Rh(t,/flex-|baseline/)?"":es+"grid-row-"+$r(t,/flex-|-self/g,""))+t;case 4675:return Ti+t+es+"flex-line-pack"+$r(t,/align-content|flex-|-self/g,"")+t;case 5548:return Ti+t+es+$r(t,"shrink","negative")+t;case 5292:return Ti+t+es+$r(t,"basis","preferred-size")+t;case 6060:return Ti+"box-"+$r(t,"-grow","")+Ti+t+es+$r(t,"grow","positive")+t;case 4554:return Ti+$r(t,/([^-])(transform)/g,"$1"+Ti+"$2")+t;case 6187:return $r($r($r(t,/(zoom-|grab)/,Ti+"$1"),/(image-set)/,Ti+"$1"),t,"")+t;case 5495:case 3959:return $r(t,/(image-set\([^]*)/,Ti+"$1$`$1");case 4968:return $r($r(t,/(.+:)(flex-)?(.*)/,Ti+"box-pack:$3"+es+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Ti+t+t;case 4200:if(!Rh(t,/flex-|baseline/))return es+"grid-column-align"+Oy(t,e)+t;break;case 2592:case 3360:return es+$r(t,"template-","")+t;case 4384:case 3616:return r&&r.some(function(o,c){return e=c,Rh(o.props,/grid-\w+-end/)})?~kE(t+(r=r[e].value),"span",0)?t:es+$r(t,"-start","")+t+es+"grid-row-span:"+(~kE(r,"span",0)?Rh(r,/\d+/):+Rh(r,/\d+/)-+Rh(t,/\d+/))+";":es+$r(t,"-start","")+t;case 4896:case 4128:return r&&r.some(function(o){return Rh(o.props,/grid-\w+-start/)})?t:es+$r($r(t,"-end","-span"),"span ","")+t;case 4095:case 3583:case 4068:case 2532:return $r(t,/(.+)-inline(.+)/,Ti+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Au(t)-1-e>6)switch(Eo(t,e+1)){case 109:if(Eo(t,e+4)!==45)break;case 102:return $r(t,/(.+:)(.+)-([^]+)/,"$1"+Ti+"$2-$3$1"+$x+(Eo(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~kE(t,"stretch",0)?pX($r(t,"stretch","fill-available"),e,r)+t:t}break;case 5152:case 5920:return $r(t,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(o,c,f,_,x,a,I){return es+c+":"+f+I+(_?es+c+"-span:"+(x?a:+a-+f)+I:"")+t});case 4949:if(Eo(t,e+6)===121)return $r(t,":",":"+Ti)+t;break;case 6444:switch(Eo(t,Eo(t,14)===45?18:11)){case 120:return $r(t,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Ti+(Eo(t,14)===45?"inline-":"")+"box$3$1"+Ti+"$2$3$1"+es+"$2box$3")+t;case 100:return $r(t,":",":"+es)+t}break;case 5719:case 2647:case 2135:case 3927:case 2391:return $r(t,"scroll-","scroll-snap-")+t}return t}function JS(t,e){for(var r="",o=0;o<t.length;o++)r+=e(t[o],o,t,e)||"";return r}function WTe(t,e,r,o){switch(t.type){case DTe:if(t.children.length)break;case kTe:case U4:return t.return=t.return||t.value;case lX:return"";case cX:return t.return=t.value+"{"+JS(t.children,o)+"}";case QA:if(!Au(t.value=t.props.join(",")))return""}return Au(r=JS(t.children,o))?t.return=t.value+"{"+r+"}":""}function HTe(t){var e=dX(t);return function(r,o,c,f){for(var _="",x=0;x<e;x++)_+=t[x](r,o,c,f)||"";return _}}function ZTe(t){return function(e){e.root||(e=e.return)&&t(e)}}function XTe(t,e,r,o){if(t.length>-1&&!t.return)switch(t.type){case U4:t.return=pX(t.value,t.length,r);return;case cX:return JS([ef(t,{value:$r(t.value,"@","@"+Ti)})],o);case QA:if(t.length)return LTe(r=t.props,function(c){switch(Rh(c,o=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":A_(ef(t,{props:[$r(c,/:(read-\w+)/,":"+$x+"$1")]})),A_(ef(t,{props:[c]})),J3(t,{props:_$(r,o)});break;case"::placeholder":A_(ef(t,{props:[$r(c,/:(plac\w+)/,":"+Ti+"input-$1")]})),A_(ef(t,{props:[$r(c,/:(plac\w+)/,":"+$x+"$1")]})),A_(ef(t,{props:[$r(c,/:(plac\w+)/,es+"input-$1")]})),A_(ef(t,{props:[c]})),J3(t,{props:_$(r,o)});break}return""})}}var KTe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},il={},zy=typeof process<"u"&&il!==void 0&&(il.REACT_APP_SC_ATTR||il.SC_ATTR)||"data-styled",mX="active",gX="data-styled-version",nC="6.1.13",$4=`/*!sc*/
`,eI=typeof window<"u"&&"HTMLElement"in window,YTe=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&il!==void 0&&il.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&il.REACT_APP_SC_DISABLE_SPEEDY!==""?il.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&il.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&il!==void 0&&il.SC_DISABLE_SPEEDY!==void 0&&il.SC_DISABLE_SPEEDY!==""&&il.SC_DISABLE_SPEEDY!=="false"&&il.SC_DISABLE_SPEEDY),rC=Object.freeze([]),Ny=Object.freeze({});function QTe(t,e,r){return r===void 0&&(r=Ny),t.theme!==r.theme&&t.theme||e||r.theme}var _X=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),JTe=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,eEe=/(^-|-$)/g;function x$(t){return t.replace(JTe,"-").replace(eEe,"")}var tEe=/(a)(d)/gi,JT=52,b$=function(t){return String.fromCharCode(t+(t>25?39:97))};function nD(t){var e,r="";for(e=Math.abs(t);e>JT;e=e/JT|0)r=b$(e%JT)+r;return(b$(e%JT)+r).replace(tEe,"$1-$2")}var LM,yX=5381,Z_=function(t,e){for(var r=e.length;r;)t=33*t^e.charCodeAt(--r);return t},vX=function(t){return Z_(yX,t)};function nEe(t){return nD(vX(t)>>>0)}function rEe(t){return t.displayName||t.name||"Component"}function zM(t){return typeof t=="string"&&!0}var xX=typeof Symbol=="function"&&Symbol.for,bX=xX?Symbol.for("react.memo"):60115,iEe=xX?Symbol.for("react.forward_ref"):60112,sEe={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},oEe={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},wX={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},aEe=((LM={})[iEe]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},LM[bX]=wX,LM);function w$(t){return("type"in(e=t)&&e.type.$$typeof)===bX?wX:"$$typeof"in t?aEe[t.$$typeof]:sEe;var e}var lEe=Object.defineProperty,cEe=Object.getOwnPropertyNames,T$=Object.getOwnPropertySymbols,uEe=Object.getOwnPropertyDescriptor,hEe=Object.getPrototypeOf,E$=Object.prototype;function TX(t,e,r){if(typeof e!="string"){if(E$){var o=hEe(e);o&&o!==E$&&TX(t,o,r)}var c=cEe(e);T$&&(c=c.concat(T$(e)));for(var f=w$(t),_=w$(e),x=0;x<c.length;++x){var a=c[x];if(!(a in oEe||r&&r[a]||_&&a in _||f&&a in f)){var I=uEe(e,a);try{lEe(t,a,I)}catch{}}}}return t}function Fy(t){return typeof t=="function"}function G4(t){return typeof t=="object"&&"styledComponentId"in t}function mm(t,e){return t&&e?"".concat(t," ").concat(e):t||e||""}function S$(t,e){if(t.length===0)return"";for(var r=t[0],o=1;o<t.length;o++)r+=t[o];return r}function N1(t){return t!==null&&typeof t=="object"&&t.constructor.name===Object.name&&!("props"in t&&t.$$typeof)}function rD(t,e,r){if(r===void 0&&(r=!1),!r&&!N1(t)&&!Array.isArray(t))return e;if(Array.isArray(e))for(var o=0;o<e.length;o++)t[o]=rD(t[o],e[o]);else if(N1(e))for(var o in e)t[o]=rD(t[o],e[o]);return t}function q4(t,e){Object.defineProperty(t,"toString",{value:e})}function wb(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(t," for more information.").concat(e.length>0?" Args: ".concat(e.join(", ")):""))}var dEe=function(){function t(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return t.prototype.indexOfGroup=function(e){for(var r=0,o=0;o<e;o++)r+=this.groupSizes[o];return r},t.prototype.insertRules=function(e,r){if(e>=this.groupSizes.length){for(var o=this.groupSizes,c=o.length,f=c;e>=f;)if((f<<=1)<0)throw wb(16,"".concat(e));this.groupSizes=new Uint32Array(f),this.groupSizes.set(o),this.length=f;for(var _=c;_<f;_++)this.groupSizes[_]=0}for(var x=this.indexOfGroup(e+1),a=(_=0,r.length);_<a;_++)this.tag.insertRule(x,r[_])&&(this.groupSizes[e]++,x++)},t.prototype.clearGroup=function(e){if(e<this.length){var r=this.groupSizes[e],o=this.indexOfGroup(e),c=o+r;this.groupSizes[e]=0;for(var f=o;f<c;f++)this.tag.deleteRule(o)}},t.prototype.getGroup=function(e){var r="";if(e>=this.length||this.groupSizes[e]===0)return r;for(var o=this.groupSizes[e],c=this.indexOfGroup(e),f=c+o,_=c;_<f;_++)r+="".concat(this.tag.getRule(_)).concat($4);return r},t}(),LE=new Map,tI=new Map,zE=1,eE=function(t){if(LE.has(t))return LE.get(t);for(;tI.has(zE);)zE++;var e=zE++;return LE.set(t,e),tI.set(e,t),e},fEe=function(t,e){zE=e+1,LE.set(t,e),tI.set(e,t)},pEe="style[".concat(zy,"][").concat(gX,'="').concat(nC,'"]'),mEe=new RegExp("^".concat(zy,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),gEe=function(t,e,r){for(var o,c=r.split(","),f=0,_=c.length;f<_;f++)(o=c[f])&&t.registerName(e,o)},_Ee=function(t,e){for(var r,o=((r=e.textContent)!==null&&r!==void 0?r:"").split($4),c=[],f=0,_=o.length;f<_;f++){var x=o[f].trim();if(x){var a=x.match(mEe);if(a){var I=0|parseInt(a[1],10),D=a[2];I!==0&&(fEe(D,I),gEe(t,D,a[3]),t.getTag().insertRules(I,c)),c.length=0}else c.push(x)}}},I$=function(t){for(var e=document.querySelectorAll(pEe),r=0,o=e.length;r<o;r++){var c=e[r];c&&c.getAttribute(zy)!==mX&&(_Ee(t,c),c.parentNode&&c.parentNode.removeChild(c))}};function yEe(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var EX=function(t){var e=document.head,r=t||e,o=document.createElement("style"),c=function(x){var a=Array.from(x.querySelectorAll("style[".concat(zy,"]")));return a[a.length-1]}(r),f=c!==void 0?c.nextSibling:null;o.setAttribute(zy,mX),o.setAttribute(gX,nC);var _=yEe();return _&&o.setAttribute("nonce",_),r.insertBefore(o,f),o},vEe=function(){function t(e){this.element=EX(e),this.element.appendChild(document.createTextNode("")),this.sheet=function(r){if(r.sheet)return r.sheet;for(var o=document.styleSheets,c=0,f=o.length;c<f;c++){var _=o[c];if(_.ownerNode===r)return _}throw wb(17)}(this.element),this.length=0}return t.prototype.insertRule=function(e,r){try{return this.sheet.insertRule(r,e),this.length++,!0}catch{return!1}},t.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},t.prototype.getRule=function(e){var r=this.sheet.cssRules[e];return r&&r.cssText?r.cssText:""},t}(),xEe=function(){function t(e){this.element=EX(e),this.nodes=this.element.childNodes,this.length=0}return t.prototype.insertRule=function(e,r){if(e<=this.length&&e>=0){var o=document.createTextNode(r);return this.element.insertBefore(o,this.nodes[e]||null),this.length++,!0}return!1},t.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},t.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},t}(),bEe=function(){function t(e){this.rules=[],this.length=0}return t.prototype.insertRule=function(e,r){return e<=this.length&&(this.rules.splice(e,0,r),this.length++,!0)},t.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},t.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},t}(),A$=eI,wEe={isServer:!eI,useCSSOMInjection:!YTe},SX=function(){function t(e,r,o){e===void 0&&(e=Ny),r===void 0&&(r={});var c=this;this.options=Ua(Ua({},wEe),e),this.gs=r,this.names=new Map(o),this.server=!!e.isServer,!this.server&&eI&&A$&&(A$=!1,I$(this)),q4(this,function(){return function(f){for(var _=f.getTag(),x=_.length,a="",I=function(O){var F=function(W){return tI.get(W)}(O);if(F===void 0)return"continue";var Z=f.names.get(F),J=_.getGroup(O);if(Z===void 0||!Z.size||J.length===0)return"continue";var ne="".concat(zy,".g").concat(O,'[id="').concat(F,'"]'),se="";Z!==void 0&&Z.forEach(function(W){W.length>0&&(se+="".concat(W,","))}),a+="".concat(J).concat(ne,'{content:"').concat(se,'"}').concat($4)},D=0;D<x;D++)I(D);return a}(c)})}return t.registerId=function(e){return eE(e)},t.prototype.rehydrate=function(){!this.server&&eI&&I$(this)},t.prototype.reconstructWithOptions=function(e,r){return r===void 0&&(r=!0),new t(Ua(Ua({},this.options),e),this.gs,r&&this.names||void 0)},t.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},t.prototype.getTag=function(){return this.tag||(this.tag=(e=function(r){var o=r.useCSSOMInjection,c=r.target;return r.isServer?new bEe(c):o?new vEe(c):new xEe(c)}(this.options),new dEe(e)));var e},t.prototype.hasNameForId=function(e,r){return this.names.has(e)&&this.names.get(e).has(r)},t.prototype.registerName=function(e,r){if(eE(e),this.names.has(e))this.names.get(e).add(r);else{var o=new Set;o.add(r),this.names.set(e,o)}},t.prototype.insertRules=function(e,r,o){this.registerName(e,r),this.getTag().insertRules(eE(e),o)},t.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},t.prototype.clearRules=function(e){this.getTag().clearGroup(eE(e)),this.clearNames(e)},t.prototype.clearTag=function(){this.tag=void 0},t}(),TEe=/&/g,EEe=/^\s*\/\/.*$/gm;function IX(t,e){return t.map(function(r){return r.type==="rule"&&(r.value="".concat(e," ").concat(r.value),r.value=r.value.replaceAll(",",",".concat(e," ")),r.props=r.props.map(function(o){return"".concat(e," ").concat(o)})),Array.isArray(r.children)&&r.type!=="@keyframes"&&(r.children=IX(r.children,e)),r})}function SEe(t){var e,r,o,c=Ny,f=c.options,_=f===void 0?Ny:f,x=c.plugins,a=x===void 0?rC:x,I=function(F,Z,J){return J.startsWith(r)&&J.endsWith(r)&&J.replaceAll(r,"").length>0?".".concat(e):F},D=a.slice();D.push(function(F){F.type===QA&&F.value.includes("&")&&(F.props[0]=F.props[0].replace(TEe,r).replace(o,I))}),_.prefix&&D.push(XTe),D.push(WTe);var O=function(F,Z,J,ne){Z===void 0&&(Z=""),J===void 0&&(J=""),ne===void 0&&(ne="&"),e=ne,r=Z,o=new RegExp("\\".concat(r,"\\b"),"g");var se=F.replace(EEe,""),W=GTe(J||Z?"".concat(J," ").concat(Z," { ").concat(se," }"):se);_.namespace&&(W=IX(W,_.namespace));var Q=[];return JS(W,HTe(D.concat(ZTe(function(K){return Q.push(K)})))),Q};return O.hash=a.length?a.reduce(function(F,Z){return Z.name||wb(15),Z_(F,Z.name)},yX).toString():"",O}var IEe=new SX,iD=SEe(),AX=Qr.createContext({shouldForwardProp:void 0,styleSheet:IEe,stylis:iD});AX.Consumer;Qr.createContext(void 0);function C$(){return ee.useContext(AX)}var AEe=function(){function t(e,r){var o=this;this.inject=function(c,f){f===void 0&&(f=iD);var _=o.name+f.hash;c.hasNameForId(o.id,_)||c.insertRules(o.id,_,f(o.rules,_,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=r,q4(this,function(){throw wb(12,String(o.name))})}return t.prototype.getName=function(e){return e===void 0&&(e=iD),this.name+e.hash},t}(),CEe=function(t){return t>="A"&&t<="Z"};function P$(t){for(var e="",r=0;r<t.length;r++){var o=t[r];if(r===1&&o==="-"&&t[0]==="-")return t;CEe(o)?e+="-"+o.toLowerCase():e+=o}return e.startsWith("ms-")?"-"+e:e}var CX=function(t){return t==null||t===!1||t===""},PX=function(t){var e,r,o=[];for(var c in t){var f=t[c];t.hasOwnProperty(c)&&!CX(f)&&(Array.isArray(f)&&f.isCss||Fy(f)?o.push("".concat(P$(c),":"),f,";"):N1(f)?o.push.apply(o,QS(QS(["".concat(c," {")],PX(f),!1),["}"],!1)):o.push("".concat(P$(c),": ").concat((e=c,(r=f)==null||typeof r=="boolean"||r===""?"":typeof r!="number"||r===0||e in KTe||e.startsWith("--")?String(r).trim():"".concat(r,"px")),";")))}return o};function Tm(t,e,r,o){if(CX(t))return[];if(G4(t))return[".".concat(t.styledComponentId)];if(Fy(t)){if(!Fy(f=t)||f.prototype&&f.prototype.isReactComponent||!e)return[t];var c=t(e);return Tm(c,e,r,o)}var f;return t instanceof AEe?r?(t.inject(r,o),[t.getName(o)]):[t]:N1(t)?PX(t):Array.isArray(t)?Array.prototype.concat.apply(rC,t.map(function(_){return Tm(_,e,r,o)})):[t.toString()]}function PEe(t){for(var e=0;e<t.length;e+=1){var r=t[e];if(Fy(r)&&!G4(r))return!1}return!0}var REe=vX(nC),MEe=function(){function t(e,r,o){this.rules=e,this.staticRulesId="",this.isStatic=(o===void 0||o.isStatic)&&PEe(e),this.componentId=r,this.baseHash=Z_(REe,r),this.baseStyle=o,SX.registerId(r)}return t.prototype.generateAndInjectStyles=function(e,r,o){var c=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,r,o):"";if(this.isStatic&&!o.hash)if(this.staticRulesId&&r.hasNameForId(this.componentId,this.staticRulesId))c=mm(c,this.staticRulesId);else{var f=S$(Tm(this.rules,e,r,o)),_=nD(Z_(this.baseHash,f)>>>0);if(!r.hasNameForId(this.componentId,_)){var x=o(f,".".concat(_),void 0,this.componentId);r.insertRules(this.componentId,_,x)}c=mm(c,_),this.staticRulesId=_}else{for(var a=Z_(this.baseHash,o.hash),I="",D=0;D<this.rules.length;D++){var O=this.rules[D];if(typeof O=="string")I+=O;else if(O){var F=S$(Tm(O,e,r,o));a=Z_(a,F+D),I+=F}}if(I){var Z=nD(a>>>0);r.hasNameForId(this.componentId,Z)||r.insertRules(this.componentId,Z,o(I,".".concat(Z),void 0,this.componentId)),c=mm(c,Z)}}return c},t}(),RX=Qr.createContext(void 0);RX.Consumer;var NM={};function kEe(t,e,r){var o=G4(t),c=t,f=!zM(t),_=e.attrs,x=_===void 0?rC:_,a=e.componentId,I=a===void 0?function(pe,Te){var we=typeof pe!="string"?"sc":x$(pe);NM[we]=(NM[we]||0)+1;var oe="".concat(we,"-").concat(nEe(nC+we+NM[we]));return Te?"".concat(Te,"-").concat(oe):oe}(e.displayName,e.parentComponentId):a,D=e.displayName,O=D===void 0?function(pe){return zM(pe)?"styled.".concat(pe):"Styled(".concat(rEe(pe),")")}(t):D,F=e.displayName&&e.componentId?"".concat(x$(e.displayName),"-").concat(e.componentId):e.componentId||I,Z=o&&c.attrs?c.attrs.concat(x).filter(Boolean):x,J=e.shouldForwardProp;if(o&&c.shouldForwardProp){var ne=c.shouldForwardProp;if(e.shouldForwardProp){var se=e.shouldForwardProp;J=function(pe,Te){return ne(pe,Te)&&se(pe,Te)}}else J=ne}var W=new MEe(r,F,o?c.componentStyle:void 0);function Q(pe,Te){return function(we,oe,de){var X=we.attrs,ge=we.componentStyle,be=we.defaultProps,ke=we.foldedComponentIds,Ee=we.styledComponentId,Lt=we.target,jt=Qr.useContext(RX),Qt=C$(),Pt=we.shouldForwardProp||Qt.shouldForwardProp,lt=QTe(oe,jt,be)||Ny,At=function(Ht,Hn,Jn){for(var ir,Zt=Ua(Ua({},Hn),{className:void 0,theme:Jn}),zt=0;zt<Ht.length;zt+=1){var qt=Fy(ir=Ht[zt])?ir(Zt):ir;for(var xn in qt)Zt[xn]=xn==="className"?mm(Zt[xn],qt[xn]):xn==="style"?Ua(Ua({},Zt[xn]),qt[xn]):qt[xn]}return Hn.className&&(Zt.className=mm(Zt.className,Hn.className)),Zt}(X,oe,lt),nn=At.as||Lt,fn={};for(var mn in At)At[mn]===void 0||mn[0]==="$"||mn==="as"||mn==="theme"&&At.theme===lt||(mn==="forwardedAs"?fn.as=At.forwardedAs:Pt&&!Pt(mn,nn)||(fn[mn]=At[mn]));var Vt=function(Ht,Hn){var Jn=C$(),ir=Ht.generateAndInjectStyles(Hn,Jn.styleSheet,Jn.stylis);return ir}(ge,At),wn=mm(ke,Ee);return Vt&&(wn+=" "+Vt),At.className&&(wn+=" "+At.className),fn[zM(nn)&&!_X.has(nn)?"class":"className"]=wn,fn.ref=de,ee.createElement(nn,fn)}(K,pe,Te)}Q.displayName=O;var K=Qr.forwardRef(Q);return K.attrs=Z,K.componentStyle=W,K.displayName=O,K.shouldForwardProp=J,K.foldedComponentIds=o?mm(c.foldedComponentIds,c.styledComponentId):"",K.styledComponentId=F,K.target=o?c.target:t,Object.defineProperty(K,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(pe){this._foldedDefaultProps=o?function(Te){for(var we=[],oe=1;oe<arguments.length;oe++)we[oe-1]=arguments[oe];for(var de=0,X=we;de<X.length;de++)rD(Te,X[de],!0);return Te}({},c.defaultProps,pe):pe}}),q4(K,function(){return".".concat(K.styledComponentId)}),f&&TX(K,t,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),K}function R$(t,e){for(var r=[t[0]],o=0,c=e.length;o<c;o+=1)r.push(e[o],t[o+1]);return r}var M$=function(t){return Object.assign(t,{isCss:!0})};function DEe(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(Fy(t)||N1(t))return M$(Tm(R$(rC,QS([t],e,!0))));var o=t;return e.length===0&&o.length===1&&typeof o[0]=="string"?Tm(o):M$(Tm(R$(o,e)))}function sD(t,e,r){if(r===void 0&&(r=Ny),!e)throw wb(1,e);var o=function(c){for(var f=[],_=1;_<arguments.length;_++)f[_-1]=arguments[_];return t(e,r,DEe.apply(void 0,QS([c],f,!1)))};return o.attrs=function(c){return sD(t,e,Ua(Ua({},r),{attrs:Array.prototype.concat(r.attrs,c).filter(Boolean)}))},o.withConfig=function(c){return sD(t,e,Ua(Ua({},r),c))},o}var MX=function(t){return sD(kEe,t)},n0=MX;_X.forEach(function(t){n0[t]=MX(t)});/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function nI(t,e,r,o){return new(r||(r=Promise))(function(c,f){function _(I){try{a(o.next(I))}catch(D){f(D)}}function x(I){try{a(o.throw(I))}catch(D){f(D)}}function a(I){I.done?c(I.value):new r(function(D){D(I.value)}).then(_,x)}a((o=o.apply(t,[])).next())})}function rI(t,e){var r={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},o,c,f,_;return _={next:x(0),throw:x(1),return:x(2)},typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function x(I){return function(D){return a([I,D])}}function a(I){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,c&&(f=I[0]&2?c.return:I[0]?c.throw||((f=c.return)&&f.call(c),0):c.next)&&!(f=f.call(c,I[1])).done)return f;switch(c=0,f&&(I=[I[0]&2,f.value]),I[0]){case 0:case 1:f=I;break;case 4:return r.label++,{value:I[1],done:!1};case 5:r.label++,c=I[1],I=[0];continue;case 7:I=r.ops.pop(),r.trys.pop();continue;default:if(f=r.trys,!(f=f.length>0&&f[f.length-1])&&(I[0]===6||I[0]===2)){r=0;continue}if(I[0]===3&&(!f||I[1]>f[0]&&I[1]<f[3])){r.label=I[1];break}if(I[0]===6&&r.label<f[1]){r.label=f[1],f=I;break}if(f&&r.label<f[2]){r.label=f[2],r.ops.push(I);break}f[2]&&r.ops.pop(),r.trys.pop();continue}I=e.call(t,r)}catch(D){I=[6,D],c=0}finally{o=f=0}if(I[0]&5)throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}}function Tb(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var OEe=n0.div(D$||(D$=Tb([`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
`],[`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
`]))),LEe=n0.div(O$||(O$=Tb([`
  width: 100%;
  `,`
`],[`
  width: 100%;
  `,`
`])),function(t){var e=t.aspectRatio;return e==="cover"?`
    position: absolute;
    bottom: 0;
    top: 0;
    left: 0;
    right: 0;`:`
    position: relative;
    padding-bottom: `+100/e+"%;"}),k$=n0.div(L$||(L$=Tb([`
  padding: 40px;
`],[`
  padding: 40px;
`]))),zEe=n0.video(z$||(z$=Tb([`
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
  transform: rotateY(`,`);
`],[`
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
  transform: rotateY(`,`);
`])),function(t){var e=t.mirrored;return e?"180deg":"0deg"}),NEe=n0.canvas(N$||(N$=Tb([`
  display: none;
`],[`
  display: none;
`]))),D$,O$,L$,z$,N$,kX=Qr.forwardRef(function(t,e){var r=t.facingMode,o=r===void 0?"user":r,c=t.aspectRatio,f=c===void 0?"cover":c,_=t.numberOfCamerasCallback,x=_===void 0?function(){return null}:_,a=t.videoSourceDeviceId,I=a===void 0?void 0:a,D=t.errorMessages,O=D===void 0?{noCameraAccessible:"No camera device accessible. Please connect your camera or try a different browser.",permissionDenied:"Permission denied. Please refresh and give camera permission.",switchCamera:"It is not possible to switch camera to different one because there is only one video device accessible.",canvas:"Canvas is not supported."}:D,F=t.videoReadyCallback,Z=F===void 0?function(){return null}:F,J=ee.useRef(null),ne=ee.useRef(null),se=ee.useRef(null),W=ee.useRef(null),Q=ee.useState(0),K=Q[0],pe=Q[1],Te=ee.useState(null),we=Te[0],oe=Te[1],de=ee.useState(o),X=de[0],ge=de[1],be=ee.useState(!1),ke=be[0],Ee=be[1],Lt=ee.useState(!1),jt=Lt[0],Qt=Lt[1],Pt=ee.useState(!1),lt=Pt[0],At=Pt[1],nn=ee.useState(!1),fn=nn[0],mn=nn[1],Vt=ee.useRef(!1);ee.useEffect(function(){return Vt.current=!0,function(){Vt.current=!1}},[]),ee.useEffect(function(){x(K)},[K]);var wn=function(Ht){return Ht===void 0&&(Ht=!1),nI(void 0,void 0,void 0,function(){var Hn,Jn;return rI(this,function(ir){switch(ir.label){case 0:if(!(we&&(navigator!=null&&navigator.mediaDevices)&&Vt.current))return[3,4];if(Hn=navigator.mediaDevices.getSupportedConstraints(),Jn=we.getTracks()[0],!(Hn&&"torch"in Hn&&Jn))return[3,4];ir.label=1;case 1:return ir.trys.push([1,3,,4]),[4,Jn.applyConstraints({advanced:[{torch:Ht}]})];case 2:return ir.sent(),[2,!0];case 3:return ir.sent(),[2,!1];case 4:return[2,!1]}})})};return ee.useEffect(function(){wn(fn)},[fn]),ee.useImperativeHandle(e,function(){return{takePhoto:function(Ht){var Hn,Jn,ir,Zt,zt;if(K<1)throw new Error(O.noCameraAccessible);if(ne!=null&&ne.current){var qt=((Hn=J==null?void 0:J.current)===null||Hn===void 0?void 0:Hn.videoWidth)||1280,xn=((Jn=J==null?void 0:J.current)===null||Jn===void 0?void 0:Jn.videoHeight)||720,rr=qt/xn,Gn=((ir=W==null?void 0:W.current)===null||ir===void 0?void 0:ir.offsetWidth)||1280,yr=((Zt=W==null?void 0:W.current)===null||Zt===void 0?void 0:Zt.offsetHeight)||1280,Gr=Gn/yr,mr=void 0,wr=void 0,wt=void 0,St=void 0,Ct=void 0;switch(rr>Gr?(St=xn,wt=xn*Gr,mr=(qt-wt)/2,wr=0):(wt=qt,St=qt/Gr,mr=0,wr=(xn-St)/2),ne.current.width=wt,ne.current.height=St,se.current||(se.current=ne.current.getContext("2d",{willReadFrequently:!0})),se.current&&(J!=null&&J.current)&&se.current.drawImage(J.current,mr,wr,wt,St,0,0,wt,St),Ht){case"imgData":Ct=(zt=se.current)===null||zt===void 0?void 0:zt.getImageData(0,0,wt,St);break;default:Ct=ne.current.toDataURL("image/jpeg");break}return Ct}else throw new Error(O.canvas)},switchCamera:function(){if(K<1)throw new Error(O.noCameraAccessible);K<2&&console.error("Error: Unable to switch camera. Only one device is accessible.");var Ht=X==="user"?"environment":"user";return ge(Ht),Ht},getNumberOfCameras:function(){return K},toggleTorch:function(){var Ht=!fn;return mn(Ht),Ht},torchSupported:lt}}),ee.useEffect(function(){BEe(we,oe,X,I,pe,Ee,Qt,!!Vt.current)},[X,I]),ee.useEffect(function(){return wn(!1).then(function(Ht){return At(Ht)}),we&&J&&J.current&&(J.current.srcObject=we),function(){we&&we.getTracks().forEach(function(Ht){Ht.stop()})}},[we]),Qr.createElement(LEe,{ref:W,aspectRatio:f},Qr.createElement(OEe,null,ke?Qr.createElement(k$,null,O.noCameraAccessible):null,jt?Qr.createElement(k$,null,O.permissionDenied):null,Qr.createElement(zEe,{ref:J,id:"video",muted:!0,autoPlay:!0,playsInline:!0,mirrored:X==="user",onLoadedData:function(){Z()}}),Qr.createElement(NEe,{ref:ne})))});kX.displayName="Camera";var FEe=function(t){return nI(void 0,void 0,void 0,function(){var e;return rI(this,function(r){switch(r.label){case 0:return e=[],t!=="environment"?[3,2]:[4,navigator.mediaDevices.enumerateDevices().then(function(o){var c=o.filter(function(f){return f.kind=="videoinput"});c.forEach(function(f){var _=f.getCapabilities();_.facingMode&&_.facingMode.indexOf("environment")>=0&&_.deviceId&&e.push(_.deviceId)})})];case 1:r.sent(),r.label=2;case 2:return e.length>1?[2,e.pop()]:[2,void 0]}})})},BEe=function(t,e,r,o,c,f,_,x){return nI(void 0,void 0,void 0,function(){var a,I,D,O,F;return rI(this,function(Z){switch(Z.label){case 0:return t&&t.getTracks().forEach(function(J){J.stop()}),[4,FEe(r)];case 1:return I=Z.sent(),I?a=I:a=o?{exact:o}:void 0,D={audio:!1,video:{deviceId:a,facingMode:r}},!((F=navigator==null?void 0:navigator.mediaDevices)===null||F===void 0)&&F.getUserMedia?navigator.mediaDevices.getUserMedia(D).then(function(J){x&&e(F$(J,c))}).catch(function(J){B$(J,f,_)}):(O=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,O?O(D,function(J){return nI(void 0,void 0,void 0,function(){return rI(this,function(ne){return x&&e(F$(J,c)),[2]})})},function(J){B$(J,f,_)}):f(!0)),[2]}})})},F$=function(t,e){return navigator.mediaDevices.enumerateDevices().then(function(r){return e(r.filter(function(o){return o.kind==="videoinput"}).length)}),t},B$=function(t,e,r){console.error(t),t.name==="PermissionDeniedError"?r(!0):e(!0)};const DX=ee.createContext(),Eb=()=>ee.useContext(DX),jEe=({children:t})=>{const[e,r]=ee.useState([]),[o,c]=ee.useState(null);ee.useEffect(()=>{c(Date.now())},[]),ee.useEffect(()=>{if(o){const _=rs(Cn,"quests"),x=Oo(_,Di("createdAt",">",new Date(o))),a=Df(x,I=>{I.docChanges().forEach(D=>{if(D.type==="added"){const O=D.doc.data();f(`New quest available: ${O.title}`,"info")}})});return()=>a()}},[o]);const f=ee.useCallback((_,x)=>{const a=Date.now();r(I=>[...I,{id:a,message:_,type:x,show:!0}]),setTimeout(()=>{r(I=>I.map(D=>D.id===a?{...D,show:!1}:D))},3e3),setTimeout(()=>{r(I=>I.filter(D=>D.id!==a))},3500)},[]);return V.jsxs(DX.Provider,{value:{notifications:e,showNotification:f},children:[t,V.jsx("div",{className:"notification-container",children:e.map(_=>V.jsx("div",{className:`notification ${_.type} ${_.show?"show":"hide"}`,children:_.message},_.id))})]})};var OX={exports:{}};(function(t,e){var r={};(function(o,c){t.exports=c()})(e2,function(){var o,c,f;function _(a,I){if(!o)o=I;else if(!c)c=I;else{var D="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",O={};o(O),f=I(O),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(f.workerUrl=window.URL.createObjectURL(new Blob([D],{type:"text/javascript"})))}}_(["exports"],function(a){var I="3.6.0";let D;const O={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(D==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{D=r.API_URL_REGEX!=null?new RegExp(r.API_URL_REGEX):i}catch{D=i}}return D},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!O.API_URL)return null;try{const i=new URL(O.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function F(i){return O.API_URL_REGEX.test(i)}function Z(i){return i.indexOf("mapbox:")===0}function J(i){return O.API_CDN_URL_REGEX.test(i)}function ne(i){return O.API_SPRITE_REGEX.test(i)}function se(i){return O.API_STYLE_REGEX.test(i)&&!ne(i)}const W={create:"create",load:"load",fullLoad:"fullLoad"},Q={mark(i){performance.mark(i)},measure(i,n,s){performance.measure(i,n,s)}};function K(i){const n=i.name.split("?")[0];return J(n)&&n.includes("mapbox-gl.js")?"javascript":J(n)&&n.includes("mapbox-gl.css")?"css":function(s){return O.API_FONTS_REGEX.test(s)}(n)?"fontRange":ne(n)?"sprite":se(n)?"style":function(s){return O.API_TILEJSON_REGEX.test(s)}(n)?"tilejson":"other"}function pe(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Te={},we={};Object.defineProperty(we,"__esModule",{value:!0}),we.setMatrixArrayType=function(i){we.ARRAY_TYPE=de=i},we.toRadian=function(i){return i*ge},we.equals=function(i,n){return Math.abs(i-n)<=oe*Math.max(1,Math.abs(i),Math.abs(n))},we.RANDOM=we.ARRAY_TYPE=we.EPSILON=void 0;var oe=1e-6;we.EPSILON=oe;var de=typeof Float32Array<"u"?Float32Array:Array;we.ARRAY_TYPE=de;var X=Math.random;we.RANDOM=X;var ge=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var i=0,n=arguments.length;n--;)i+=arguments[n]*arguments[n];return Math.sqrt(i)});var be={};function ke(i){return ke=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ke(i)}Object.defineProperty(be,"__esModule",{value:!0}),be.create=function(){var i=new Ee.ARRAY_TYPE(4);return Ee.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},be.clone=function(i){var n=new Ee.ARRAY_TYPE(4);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n},be.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i},be.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i},be.fromValues=function(i,n,s,u){var h=new Ee.ARRAY_TYPE(4);return h[0]=i,h[1]=n,h[2]=s,h[3]=u,h},be.set=function(i,n,s,u,h){return i[0]=n,i[1]=s,i[2]=u,i[3]=h,i},be.transpose=function(i,n){if(i===n){var s=n[1];i[1]=n[2],i[2]=s}else i[0]=n[0],i[1]=n[2],i[2]=n[1],i[3]=n[3];return i},be.invert=function(i,n){var s=n[0],u=n[1],h=n[2],p=n[3],m=s*p-h*u;return m?(i[0]=p*(m=1/m),i[1]=-u*m,i[2]=-h*m,i[3]=s*m,i):null},be.adjoint=function(i,n){var s=n[0];return i[0]=n[3],i[1]=-n[1],i[2]=-n[2],i[3]=s,i},be.determinant=function(i){return i[0]*i[3]-i[2]*i[1]},be.multiply=jt,be.rotate=function(i,n,s){var u=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(s),w=Math.cos(s);return i[0]=u*w+p*v,i[1]=h*w+m*v,i[2]=u*-v+p*w,i[3]=h*-v+m*w,i},be.scale=function(i,n,s){var u=n[1],h=n[2],p=n[3],m=s[0],v=s[1];return i[0]=n[0]*m,i[1]=u*m,i[2]=h*v,i[3]=p*v,i},be.fromRotation=function(i,n){var s=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=s,i[2]=-s,i[3]=u,i},be.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=n[1],i},be.str=function(i){return"mat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},be.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},be.LDU=function(i,n,s,u){return i[2]=u[2]/u[0],s[0]=u[0],s[1]=u[1],s[3]=u[3]-i[2]*s[1],[i,n,s]},be.add=function(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i[2]=n[2]+s[2],i[3]=n[3]+s[3],i},be.subtract=Qt,be.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]},be.equals=function(i,n){var s=i[0],u=i[1],h=i[2],p=i[3],m=n[0],v=n[1],w=n[2],E=n[3];return Math.abs(s-m)<=Ee.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-v)<=Ee.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(h-w)<=Ee.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(p-E)<=Ee.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))},be.multiplyScalar=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3]*s,i},be.multiplyScalarAndAdd=function(i,n,s,u){return i[0]=n[0]+s[0]*u,i[1]=n[1]+s[1]*u,i[2]=n[2]+s[2]*u,i[3]=n[3]+s[3]*u,i},be.sub=be.mul=void 0;var Ee=function(i,n){if(i&&i.__esModule)return i;if(i===null||ke(i)!=="object"&&typeof i!="function")return{default:i};var s=Lt(void 0);if(s&&s.has(i))return s.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,s&&s.set(i,u),u}(we);function Lt(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(Lt=function(u){return u?s:n})(i)}function jt(i,n,s){var u=n[0],h=n[1],p=n[2],m=n[3],v=s[0],w=s[1],E=s[2],A=s[3];return i[0]=u*v+p*w,i[1]=h*v+m*w,i[2]=u*E+p*A,i[3]=h*E+m*A,i}function Qt(i,n,s){return i[0]=n[0]-s[0],i[1]=n[1]-s[1],i[2]=n[2]-s[2],i[3]=n[3]-s[3],i}be.mul=jt,be.sub=Qt;var Pt={};function lt(i){return lt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},lt(i)}Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.create=function(){var i=new At.ARRAY_TYPE(6);return At.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[4]=0,i[5]=0),i[0]=1,i[3]=1,i},Pt.clone=function(i){var n=new At.ARRAY_TYPE(6);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n},Pt.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i},Pt.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i},Pt.fromValues=function(i,n,s,u,h,p){var m=new At.ARRAY_TYPE(6);return m[0]=i,m[1]=n,m[2]=s,m[3]=u,m[4]=h,m[5]=p,m},Pt.set=function(i,n,s,u,h,p,m){return i[0]=n,i[1]=s,i[2]=u,i[3]=h,i[4]=p,i[5]=m,i},Pt.invert=function(i,n){var s=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=s*p-u*h;return w?(i[0]=p*(w=1/w),i[1]=-u*w,i[2]=-h*w,i[3]=s*w,i[4]=(h*v-p*m)*w,i[5]=(u*m-s*v)*w,i):null},Pt.determinant=function(i){return i[0]*i[3]-i[1]*i[2]},Pt.multiply=fn,Pt.rotate=function(i,n,s){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=Math.sin(s),A=Math.cos(s);return i[0]=u*A+p*E,i[1]=h*A+m*E,i[2]=u*-E+p*A,i[3]=h*-E+m*A,i[4]=v,i[5]=w,i},Pt.scale=function(i,n,s){var u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=s[0],E=s[1];return i[0]=n[0]*w,i[1]=u*w,i[2]=h*E,i[3]=p*E,i[4]=m,i[5]=v,i},Pt.translate=function(i,n,s){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=s[0],A=s[1];return i[0]=u,i[1]=h,i[2]=p,i[3]=m,i[4]=u*E+p*A+v,i[5]=h*E+m*A+w,i},Pt.fromRotation=function(i,n){var s=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=s,i[2]=-s,i[3]=u,i[4]=0,i[5]=0,i},Pt.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=n[1],i[4]=0,i[5]=0,i},Pt.fromTranslation=function(i,n){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=n[0],i[5]=n[1],i},Pt.str=function(i){return"mat2d("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+")"},Pt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],1)},Pt.add=function(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i[2]=n[2]+s[2],i[3]=n[3]+s[3],i[4]=n[4]+s[4],i[5]=n[5]+s[5],i},Pt.subtract=mn,Pt.multiplyScalar=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3]*s,i[4]=n[4]*s,i[5]=n[5]*s,i},Pt.multiplyScalarAndAdd=function(i,n,s,u){return i[0]=n[0]+s[0]*u,i[1]=n[1]+s[1]*u,i[2]=n[2]+s[2]*u,i[3]=n[3]+s[3]*u,i[4]=n[4]+s[4]*u,i[5]=n[5]+s[5]*u,i},Pt.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]},Pt.equals=function(i,n){var s=i[0],u=i[1],h=i[2],p=i[3],m=i[4],v=i[5],w=n[0],E=n[1],A=n[2],P=n[3],M=n[4],z=n[5];return Math.abs(s-w)<=At.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(u-E)<=At.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-A)<=At.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(p-P)<=At.EPSILON*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(m-M)<=At.EPSILON*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(v-z)<=At.EPSILON*Math.max(1,Math.abs(v),Math.abs(z))},Pt.sub=Pt.mul=void 0;var At=function(i,n){if(i&&i.__esModule)return i;if(i===null||lt(i)!=="object"&&typeof i!="function")return{default:i};var s=nn(void 0);if(s&&s.has(i))return s.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,s&&s.set(i,u),u}(we);function nn(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(nn=function(u){return u?s:n})(i)}function fn(i,n,s){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=s[0],A=s[1],P=s[2],M=s[3],z=s[4],B=s[5];return i[0]=u*E+p*A,i[1]=h*E+m*A,i[2]=u*P+p*M,i[3]=h*P+m*M,i[4]=u*z+p*B+v,i[5]=h*z+m*B+w,i}function mn(i,n,s){return i[0]=n[0]-s[0],i[1]=n[1]-s[1],i[2]=n[2]-s[2],i[3]=n[3]-s[3],i[4]=n[4]-s[4],i[5]=n[5]-s[5],i}Pt.mul=fn,Pt.sub=mn;var Vt={};function wn(i){return wn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},wn(i)}Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.create=function(){var i=new Ht.ARRAY_TYPE(9);return Ht.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i},Vt.fromMat4=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[4],i[4]=n[5],i[5]=n[6],i[6]=n[8],i[7]=n[9],i[8]=n[10],i},Vt.clone=function(i){var n=new Ht.ARRAY_TYPE(9);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n},Vt.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i},Vt.fromValues=function(i,n,s,u,h,p,m,v,w){var E=new Ht.ARRAY_TYPE(9);return E[0]=i,E[1]=n,E[2]=s,E[3]=u,E[4]=h,E[5]=p,E[6]=m,E[7]=v,E[8]=w,E},Vt.set=function(i,n,s,u,h,p,m,v,w,E){return i[0]=n,i[1]=s,i[2]=u,i[3]=h,i[4]=p,i[5]=m,i[6]=v,i[7]=w,i[8]=E,i},Vt.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Vt.transpose=function(i,n){if(i===n){var s=n[1],u=n[2],h=n[5];i[1]=n[3],i[2]=n[6],i[3]=s,i[5]=n[7],i[6]=u,i[7]=h}else i[0]=n[0],i[1]=n[3],i[2]=n[6],i[3]=n[1],i[4]=n[4],i[5]=n[7],i[6]=n[2],i[7]=n[5],i[8]=n[8];return i},Vt.invert=function(i,n){var s=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],A=n[8],P=A*m-v*E,M=-A*p+v*w,z=E*p-m*w,B=s*P+u*M+h*z;return B?(i[0]=P*(B=1/B),i[1]=(-A*u+h*E)*B,i[2]=(v*u-h*m)*B,i[3]=M*B,i[4]=(A*s-h*w)*B,i[5]=(-v*s+h*p)*B,i[6]=z*B,i[7]=(-E*s+u*w)*B,i[8]=(m*s-u*p)*B,i):null},Vt.adjoint=function(i,n){var s=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],A=n[8];return i[0]=m*A-v*E,i[1]=h*E-u*A,i[2]=u*v-h*m,i[3]=v*w-p*A,i[4]=s*A-h*w,i[5]=h*p-s*v,i[6]=p*E-m*w,i[7]=u*w-s*E,i[8]=s*m-u*p,i},Vt.determinant=function(i){var n=i[3],s=i[4],u=i[5],h=i[6],p=i[7],m=i[8];return i[0]*(m*s-u*p)+i[1]*(-m*n+u*h)+i[2]*(p*n-s*h)},Vt.multiply=Jn,Vt.translate=function(i,n,s){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],A=n[7],P=n[8],M=s[0],z=s[1];return i[0]=u,i[1]=h,i[2]=p,i[3]=m,i[4]=v,i[5]=w,i[6]=M*u+z*m+E,i[7]=M*h+z*v+A,i[8]=M*p+z*w+P,i},Vt.rotate=function(i,n,s){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],A=n[7],P=n[8],M=Math.sin(s),z=Math.cos(s);return i[0]=z*u+M*m,i[1]=z*h+M*v,i[2]=z*p+M*w,i[3]=z*m-M*u,i[4]=z*v-M*h,i[5]=z*w-M*p,i[6]=E,i[7]=A,i[8]=P,i},Vt.scale=function(i,n,s){var u=s[0],h=s[1];return i[0]=u*n[0],i[1]=u*n[1],i[2]=u*n[2],i[3]=h*n[3],i[4]=h*n[4],i[5]=h*n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i},Vt.fromTranslation=function(i,n){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=n[0],i[7]=n[1],i[8]=1,i},Vt.fromRotation=function(i,n){var s=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=s,i[2]=0,i[3]=-s,i[4]=u,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Vt.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=n[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Vt.fromMat2d=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=0,i[3]=n[2],i[4]=n[3],i[5]=0,i[6]=n[4],i[7]=n[5],i[8]=1,i},Vt.fromQuat=function(i,n){var s=n[0],u=n[1],h=n[2],p=n[3],m=s+s,v=u+u,w=h+h,E=s*m,A=u*m,P=u*v,M=h*m,z=h*v,B=h*w,U=p*m,$=p*v,Y=p*w;return i[0]=1-P-B,i[3]=A-Y,i[6]=M+$,i[1]=A+Y,i[4]=1-E-B,i[7]=z-U,i[2]=M-$,i[5]=z+U,i[8]=1-E-P,i},Vt.normalFromMat4=function(i,n){var s=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],A=n[8],P=n[9],M=n[10],z=n[11],B=n[12],U=n[13],$=n[14],Y=n[15],fe=s*v-u*m,he=s*w-h*m,me=s*E-p*m,Ae=u*w-h*v,Ce=u*E-p*v,Le=h*E-p*w,Ve=A*U-P*B,He=A*$-M*B,et=A*Y-z*B,Ze=P*$-M*U,st=P*Y-z*U,yt=M*Y-z*$,ot=fe*yt-he*st+me*Ze+Ae*et-Ce*He+Le*Ve;return ot?(i[0]=(v*yt-w*st+E*Ze)*(ot=1/ot),i[1]=(w*et-m*yt-E*He)*ot,i[2]=(m*st-v*et+E*Ve)*ot,i[3]=(h*st-u*yt-p*Ze)*ot,i[4]=(s*yt-h*et+p*He)*ot,i[5]=(u*et-s*st-p*Ve)*ot,i[6]=(U*Le-$*Ce+Y*Ae)*ot,i[7]=($*me-B*Le-Y*he)*ot,i[8]=(B*Ce-U*me+Y*fe)*ot,i):null},Vt.projection=function(i,n,s){return i[0]=2/n,i[1]=0,i[2]=0,i[3]=0,i[4]=-2/s,i[5]=0,i[6]=-1,i[7]=1,i[8]=1,i},Vt.str=function(i){return"mat3("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+")"},Vt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},Vt.add=function(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i[2]=n[2]+s[2],i[3]=n[3]+s[3],i[4]=n[4]+s[4],i[5]=n[5]+s[5],i[6]=n[6]+s[6],i[7]=n[7]+s[7],i[8]=n[8]+s[8],i},Vt.subtract=ir,Vt.multiplyScalar=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3]*s,i[4]=n[4]*s,i[5]=n[5]*s,i[6]=n[6]*s,i[7]=n[7]*s,i[8]=n[8]*s,i},Vt.multiplyScalarAndAdd=function(i,n,s,u){return i[0]=n[0]+s[0]*u,i[1]=n[1]+s[1]*u,i[2]=n[2]+s[2]*u,i[3]=n[3]+s[3]*u,i[4]=n[4]+s[4]*u,i[5]=n[5]+s[5]*u,i[6]=n[6]+s[6]*u,i[7]=n[7]+s[7]*u,i[8]=n[8]+s[8]*u,i},Vt.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]&&i[8]===n[8]},Vt.equals=function(i,n){var s=i[0],u=i[1],h=i[2],p=i[3],m=i[4],v=i[5],w=i[6],E=i[7],A=i[8],P=n[0],M=n[1],z=n[2],B=n[3],U=n[4],$=n[5],Y=n[6],fe=n[7],he=n[8];return Math.abs(s-P)<=Ht.EPSILON*Math.max(1,Math.abs(s),Math.abs(P))&&Math.abs(u-M)<=Ht.EPSILON*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(h-z)<=Ht.EPSILON*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(p-B)<=Ht.EPSILON*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(m-U)<=Ht.EPSILON*Math.max(1,Math.abs(m),Math.abs(U))&&Math.abs(v-$)<=Ht.EPSILON*Math.max(1,Math.abs(v),Math.abs($))&&Math.abs(w-Y)<=Ht.EPSILON*Math.max(1,Math.abs(w),Math.abs(Y))&&Math.abs(E-fe)<=Ht.EPSILON*Math.max(1,Math.abs(E),Math.abs(fe))&&Math.abs(A-he)<=Ht.EPSILON*Math.max(1,Math.abs(A),Math.abs(he))},Vt.sub=Vt.mul=void 0;var Ht=function(i,n){if(i&&i.__esModule)return i;if(i===null||wn(i)!=="object"&&typeof i!="function")return{default:i};var s=Hn(void 0);if(s&&s.has(i))return s.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,s&&s.set(i,u),u}(we);function Hn(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(Hn=function(u){return u?s:n})(i)}function Jn(i,n,s){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],A=n[7],P=n[8],M=s[0],z=s[1],B=s[2],U=s[3],$=s[4],Y=s[5],fe=s[6],he=s[7],me=s[8];return i[0]=M*u+z*m+B*E,i[1]=M*h+z*v+B*A,i[2]=M*p+z*w+B*P,i[3]=U*u+$*m+Y*E,i[4]=U*h+$*v+Y*A,i[5]=U*p+$*w+Y*P,i[6]=fe*u+he*m+me*E,i[7]=fe*h+he*v+me*A,i[8]=fe*p+he*w+me*P,i}function ir(i,n,s){return i[0]=n[0]-s[0],i[1]=n[1]-s[1],i[2]=n[2]-s[2],i[3]=n[3]-s[3],i[4]=n[4]-s[4],i[5]=n[5]-s[5],i[6]=n[6]-s[6],i[7]=n[7]-s[7],i[8]=n[8]-s[8],i}Vt.mul=Jn,Vt.sub=ir;var Zt={};function zt(i){return zt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},zt(i)}Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.create=function(){var i=new qt.ARRAY_TYPE(16);return qt.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},Zt.clone=function(i){var n=new qt.ARRAY_TYPE(16);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],n},Zt.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i},Zt.fromValues=function(i,n,s,u,h,p,m,v,w,E,A,P,M,z,B,U){var $=new qt.ARRAY_TYPE(16);return $[0]=i,$[1]=n,$[2]=s,$[3]=u,$[4]=h,$[5]=p,$[6]=m,$[7]=v,$[8]=w,$[9]=E,$[10]=A,$[11]=P,$[12]=M,$[13]=z,$[14]=B,$[15]=U,$},Zt.set=function(i,n,s,u,h,p,m,v,w,E,A,P,M,z,B,U,$){return i[0]=n,i[1]=s,i[2]=u,i[3]=h,i[4]=p,i[5]=m,i[6]=v,i[7]=w,i[8]=E,i[9]=A,i[10]=P,i[11]=M,i[12]=z,i[13]=B,i[14]=U,i[15]=$,i},Zt.identity=rr,Zt.transpose=function(i,n){if(i===n){var s=n[1],u=n[2],h=n[3],p=n[6],m=n[7],v=n[11];i[1]=n[4],i[2]=n[8],i[3]=n[12],i[4]=s,i[6]=n[9],i[7]=n[13],i[8]=u,i[9]=p,i[11]=n[14],i[12]=h,i[13]=m,i[14]=v}else i[0]=n[0],i[1]=n[4],i[2]=n[8],i[3]=n[12],i[4]=n[1],i[5]=n[5],i[6]=n[9],i[7]=n[13],i[8]=n[2],i[9]=n[6],i[10]=n[10],i[11]=n[14],i[12]=n[3],i[13]=n[7],i[14]=n[11],i[15]=n[15];return i},Zt.invert=function(i,n){var s=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],A=n[8],P=n[9],M=n[10],z=n[11],B=n[12],U=n[13],$=n[14],Y=n[15],fe=s*v-u*m,he=s*w-h*m,me=s*E-p*m,Ae=u*w-h*v,Ce=u*E-p*v,Le=h*E-p*w,Ve=A*U-P*B,He=A*$-M*B,et=A*Y-z*B,Ze=P*$-M*U,st=P*Y-z*U,yt=M*Y-z*$,ot=fe*yt-he*st+me*Ze+Ae*et-Ce*He+Le*Ve;return ot?(i[0]=(v*yt-w*st+E*Ze)*(ot=1/ot),i[1]=(h*st-u*yt-p*Ze)*ot,i[2]=(U*Le-$*Ce+Y*Ae)*ot,i[3]=(M*Ce-P*Le-z*Ae)*ot,i[4]=(w*et-m*yt-E*He)*ot,i[5]=(s*yt-h*et+p*He)*ot,i[6]=($*me-B*Le-Y*he)*ot,i[7]=(A*Le-M*me+z*he)*ot,i[8]=(m*st-v*et+E*Ve)*ot,i[9]=(u*et-s*st-p*Ve)*ot,i[10]=(B*Ce-U*me+Y*fe)*ot,i[11]=(P*me-A*Ce-z*fe)*ot,i[12]=(v*He-m*Ze-w*Ve)*ot,i[13]=(s*Ze-u*He+h*Ve)*ot,i[14]=(U*he-B*Ae-$*fe)*ot,i[15]=(A*Ae-P*he+M*fe)*ot,i):null},Zt.adjoint=function(i,n){var s=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],A=n[8],P=n[9],M=n[10],z=n[11],B=n[12],U=n[13],$=n[14],Y=n[15];return i[0]=v*(M*Y-z*$)-P*(w*Y-E*$)+U*(w*z-E*M),i[1]=-(u*(M*Y-z*$)-P*(h*Y-p*$)+U*(h*z-p*M)),i[2]=u*(w*Y-E*$)-v*(h*Y-p*$)+U*(h*E-p*w),i[3]=-(u*(w*z-E*M)-v*(h*z-p*M)+P*(h*E-p*w)),i[4]=-(m*(M*Y-z*$)-A*(w*Y-E*$)+B*(w*z-E*M)),i[5]=s*(M*Y-z*$)-A*(h*Y-p*$)+B*(h*z-p*M),i[6]=-(s*(w*Y-E*$)-m*(h*Y-p*$)+B*(h*E-p*w)),i[7]=s*(w*z-E*M)-m*(h*z-p*M)+A*(h*E-p*w),i[8]=m*(P*Y-z*U)-A*(v*Y-E*U)+B*(v*z-E*P),i[9]=-(s*(P*Y-z*U)-A*(u*Y-p*U)+B*(u*z-p*P)),i[10]=s*(v*Y-E*U)-m*(u*Y-p*U)+B*(u*E-p*v),i[11]=-(s*(v*z-E*P)-m*(u*z-p*P)+A*(u*E-p*v)),i[12]=-(m*(P*$-M*U)-A*(v*$-w*U)+B*(v*M-w*P)),i[13]=s*(P*$-M*U)-A*(u*$-h*U)+B*(u*M-h*P),i[14]=-(s*(v*$-w*U)-m*(u*$-h*U)+B*(u*w-h*v)),i[15]=s*(v*M-w*P)-m*(u*M-h*P)+A*(u*w-h*v),i},Zt.determinant=function(i){var n=i[0],s=i[1],u=i[2],h=i[3],p=i[4],m=i[5],v=i[6],w=i[7],E=i[8],A=i[9],P=i[10],M=i[11],z=i[12],B=i[13],U=i[14],$=i[15];return(n*m-s*p)*(P*$-M*U)-(n*v-u*p)*(A*$-M*B)+(n*w-h*p)*(A*U-P*B)+(s*v-u*m)*(E*$-M*z)-(s*w-h*m)*(E*U-P*z)+(u*w-h*v)*(E*B-A*z)},Zt.multiply=Gn,Zt.translate=function(i,n,s){var u,h,p,m,v,w,E,A,P,M,z,B,U=s[0],$=s[1],Y=s[2];return n===i?(i[12]=n[0]*U+n[4]*$+n[8]*Y+n[12],i[13]=n[1]*U+n[5]*$+n[9]*Y+n[13],i[14]=n[2]*U+n[6]*$+n[10]*Y+n[14],i[15]=n[3]*U+n[7]*$+n[11]*Y+n[15]):(h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],A=n[7],P=n[8],M=n[9],z=n[10],B=n[11],i[0]=u=n[0],i[1]=h,i[2]=p,i[3]=m,i[4]=v,i[5]=w,i[6]=E,i[7]=A,i[8]=P,i[9]=M,i[10]=z,i[11]=B,i[12]=u*U+v*$+P*Y+n[12],i[13]=h*U+w*$+M*Y+n[13],i[14]=p*U+E*$+z*Y+n[14],i[15]=m*U+A*$+B*Y+n[15]),i},Zt.scale=function(i,n,s){var u=s[0],h=s[1],p=s[2];return i[0]=n[0]*u,i[1]=n[1]*u,i[2]=n[2]*u,i[3]=n[3]*u,i[4]=n[4]*h,i[5]=n[5]*h,i[6]=n[6]*h,i[7]=n[7]*h,i[8]=n[8]*p,i[9]=n[9]*p,i[10]=n[10]*p,i[11]=n[11]*p,i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i},Zt.rotate=function(i,n,s,u){var h,p,m,v,w,E,A,P,M,z,B,U,$,Y,fe,he,me,Ae,Ce,Le,Ve,He,et,Ze,st=u[0],yt=u[1],ot=u[2],bt=Math.hypot(st,yt,ot);return bt<qt.EPSILON?null:(st*=bt=1/bt,yt*=bt,ot*=bt,h=Math.sin(s),p=Math.cos(s),w=n[1],E=n[2],A=n[3],M=n[5],z=n[6],B=n[7],$=n[9],Y=n[10],fe=n[11],he=st*st*(m=1-p)+p,Ce=st*yt*m-ot*h,Le=yt*yt*m+p,Ve=ot*yt*m+st*h,He=st*ot*m+yt*h,et=yt*ot*m-st*h,Ze=ot*ot*m+p,i[0]=(v=n[0])*he+(P=n[4])*(me=yt*st*m+ot*h)+(U=n[8])*(Ae=ot*st*m-yt*h),i[1]=w*he+M*me+$*Ae,i[2]=E*he+z*me+Y*Ae,i[3]=A*he+B*me+fe*Ae,i[4]=v*Ce+P*Le+U*Ve,i[5]=w*Ce+M*Le+$*Ve,i[6]=E*Ce+z*Le+Y*Ve,i[7]=A*Ce+B*Le+fe*Ve,i[8]=v*He+P*et+U*Ze,i[9]=w*He+M*et+$*Ze,i[10]=E*He+z*et+Y*Ze,i[11]=A*He+B*et+fe*Ze,n!==i&&(i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i)},Zt.rotateX=function(i,n,s){var u=Math.sin(s),h=Math.cos(s),p=n[4],m=n[5],v=n[6],w=n[7],E=n[8],A=n[9],P=n[10],M=n[11];return n!==i&&(i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[4]=p*h+E*u,i[5]=m*h+A*u,i[6]=v*h+P*u,i[7]=w*h+M*u,i[8]=E*h-p*u,i[9]=A*h-m*u,i[10]=P*h-v*u,i[11]=M*h-w*u,i},Zt.rotateY=function(i,n,s){var u=Math.sin(s),h=Math.cos(s),p=n[0],m=n[1],v=n[2],w=n[3],E=n[8],A=n[9],P=n[10],M=n[11];return n!==i&&(i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[0]=p*h-E*u,i[1]=m*h-A*u,i[2]=v*h-P*u,i[3]=w*h-M*u,i[8]=p*u+E*h,i[9]=m*u+A*h,i[10]=v*u+P*h,i[11]=w*u+M*h,i},Zt.rotateZ=function(i,n,s){var u=Math.sin(s),h=Math.cos(s),p=n[0],m=n[1],v=n[2],w=n[3],E=n[4],A=n[5],P=n[6],M=n[7];return n!==i&&(i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[0]=p*h+E*u,i[1]=m*h+A*u,i[2]=v*h+P*u,i[3]=w*h+M*u,i[4]=E*h-p*u,i[5]=A*h-m*u,i[6]=P*h-v*u,i[7]=M*h-w*u,i},Zt.fromTranslation=function(i,n){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i},Zt.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=n[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Zt.fromRotation=function(i,n,s){var u,h,p,m=s[0],v=s[1],w=s[2],E=Math.hypot(m,v,w);return E<qt.EPSILON?null:(m*=E=1/E,v*=E,w*=E,u=Math.sin(n),h=Math.cos(n),i[0]=m*m*(p=1-h)+h,i[1]=v*m*p+w*u,i[2]=w*m*p-v*u,i[3]=0,i[4]=m*v*p-w*u,i[5]=v*v*p+h,i[6]=w*v*p+m*u,i[7]=0,i[8]=m*w*p+v*u,i[9]=v*w*p-m*u,i[10]=w*w*p+h,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)},Zt.fromXRotation=function(i,n){var s=Math.sin(n),u=Math.cos(n);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u,i[6]=s,i[7]=0,i[8]=0,i[9]=-s,i[10]=u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Zt.fromYRotation=function(i,n){var s=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=0,i[2]=-s,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=s,i[9]=0,i[10]=u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Zt.fromZRotation=function(i,n){var s=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=s,i[2]=0,i[3]=0,i[4]=-s,i[5]=u,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Zt.fromRotationTranslation=yr,Zt.fromQuat2=function(i,n){var s=new qt.ARRAY_TYPE(3),u=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],w=n[5],E=n[6],A=n[7],P=u*u+h*h+p*p+m*m;return P>0?(s[0]=2*(v*m+A*u+w*p-E*h)/P,s[1]=2*(w*m+A*h+E*u-v*p)/P,s[2]=2*(E*m+A*p+v*h-w*u)/P):(s[0]=2*(v*m+A*u+w*p-E*h),s[1]=2*(w*m+A*h+E*u-v*p),s[2]=2*(E*m+A*p+v*h-w*u)),yr(i,n,s),i},Zt.getTranslation=function(i,n){return i[0]=n[12],i[1]=n[13],i[2]=n[14],i},Zt.getScaling=Gr,Zt.getRotation=function(i,n){var s=new qt.ARRAY_TYPE(3);Gr(s,n);var u=1/s[0],h=1/s[1],p=1/s[2],m=n[0]*u,v=n[1]*h,w=n[2]*p,E=n[4]*u,A=n[5]*h,P=n[6]*p,M=n[8]*u,z=n[9]*h,B=n[10]*p,U=m+A+B,$=0;return U>0?($=2*Math.sqrt(U+1),i[3]=.25*$,i[0]=(P-z)/$,i[1]=(M-w)/$,i[2]=(v-E)/$):m>A&&m>B?($=2*Math.sqrt(1+m-A-B),i[3]=(P-z)/$,i[0]=.25*$,i[1]=(v+E)/$,i[2]=(M+w)/$):A>B?($=2*Math.sqrt(1+A-m-B),i[3]=(M-w)/$,i[0]=(v+E)/$,i[1]=.25*$,i[2]=(P+z)/$):($=2*Math.sqrt(1+B-m-A),i[3]=(v-E)/$,i[0]=(M+w)/$,i[1]=(P+z)/$,i[2]=.25*$),i},Zt.fromRotationTranslationScale=function(i,n,s,u){var h=n[0],p=n[1],m=n[2],v=n[3],w=h+h,E=p+p,A=m+m,P=h*w,M=h*E,z=h*A,B=p*E,U=p*A,$=m*A,Y=v*w,fe=v*E,he=v*A,me=u[0],Ae=u[1],Ce=u[2];return i[0]=(1-(B+$))*me,i[1]=(M+he)*me,i[2]=(z-fe)*me,i[3]=0,i[4]=(M-he)*Ae,i[5]=(1-(P+$))*Ae,i[6]=(U+Y)*Ae,i[7]=0,i[8]=(z+fe)*Ce,i[9]=(U-Y)*Ce,i[10]=(1-(P+B))*Ce,i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i},Zt.fromRotationTranslationScaleOrigin=function(i,n,s,u,h){var p=n[0],m=n[1],v=n[2],w=n[3],E=p+p,A=m+m,P=v+v,M=p*E,z=p*A,B=p*P,U=m*A,$=m*P,Y=v*P,fe=w*E,he=w*A,me=w*P,Ae=u[0],Ce=u[1],Le=u[2],Ve=h[0],He=h[1],et=h[2],Ze=(1-(U+Y))*Ae,st=(z+me)*Ae,yt=(B-he)*Ae,ot=(z-me)*Ce,bt=(1-(M+Y))*Ce,rt=($+fe)*Ce,dt=(B+he)*Le,It=($-fe)*Le,at=(1-(M+U))*Le;return i[0]=Ze,i[1]=st,i[2]=yt,i[3]=0,i[4]=ot,i[5]=bt,i[6]=rt,i[7]=0,i[8]=dt,i[9]=It,i[10]=at,i[11]=0,i[12]=s[0]+Ve-(Ze*Ve+ot*He+dt*et),i[13]=s[1]+He-(st*Ve+bt*He+It*et),i[14]=s[2]+et-(yt*Ve+rt*He+at*et),i[15]=1,i},Zt.fromQuat=function(i,n){var s=n[0],u=n[1],h=n[2],p=n[3],m=s+s,v=u+u,w=h+h,E=s*m,A=u*m,P=u*v,M=h*m,z=h*v,B=h*w,U=p*m,$=p*v,Y=p*w;return i[0]=1-P-B,i[1]=A+Y,i[2]=M-$,i[3]=0,i[4]=A-Y,i[5]=1-E-B,i[6]=z+U,i[7]=0,i[8]=M+$,i[9]=z-U,i[10]=1-E-P,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Zt.frustum=function(i,n,s,u,h,p,m){var v=1/(s-n),w=1/(h-u),E=1/(p-m);return i[0]=2*p*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*p*w,i[6]=0,i[7]=0,i[8]=(s+n)*v,i[9]=(h+u)*w,i[10]=(m+p)*E,i[11]=-1,i[12]=0,i[13]=0,i[14]=m*p*2*E,i[15]=0,i},Zt.perspectiveNO=mr,Zt.perspectiveZO=function(i,n,s,u,h){var p,m=1/Math.tan(n/2);return i[0]=m/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=h*(p=1/(u-h)),i[14]=h*u*p):(i[10]=-1,i[14]=-u),i},Zt.perspectiveFromFieldOfView=function(i,n,s,u){var h=Math.tan(n.upDegrees*Math.PI/180),p=Math.tan(n.downDegrees*Math.PI/180),m=Math.tan(n.leftDegrees*Math.PI/180),v=Math.tan(n.rightDegrees*Math.PI/180),w=2/(m+v),E=2/(h+p);return i[0]=w,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=E,i[6]=0,i[7]=0,i[8]=-(m-v)*w*.5,i[9]=(h-p)*E*.5,i[10]=u/(s-u),i[11]=-1,i[12]=0,i[13]=0,i[14]=u*s/(s-u),i[15]=0,i},Zt.orthoNO=wr,Zt.orthoZO=function(i,n,s,u,h,p,m){var v=1/(n-s),w=1/(u-h),E=1/(p-m);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=E,i[11]=0,i[12]=(n+s)*v,i[13]=(h+u)*w,i[14]=p*E,i[15]=1,i},Zt.lookAt=function(i,n,s,u){var h,p,m,v,w,E,A,P,M,z,B=n[0],U=n[1],$=n[2],Y=u[0],fe=u[1],he=u[2],me=s[0],Ae=s[1],Ce=s[2];return Math.abs(B-me)<qt.EPSILON&&Math.abs(U-Ae)<qt.EPSILON&&Math.abs($-Ce)<qt.EPSILON?rr(i):(A=B-me,P=U-Ae,M=$-Ce,h=fe*(M*=z=1/Math.hypot(A,P,M))-he*(P*=z),p=he*(A*=z)-Y*M,m=Y*P-fe*A,(z=Math.hypot(h,p,m))?(h*=z=1/z,p*=z,m*=z):(h=0,p=0,m=0),v=P*m-M*p,w=M*h-A*m,E=A*p-P*h,(z=Math.hypot(v,w,E))?(v*=z=1/z,w*=z,E*=z):(v=0,w=0,E=0),i[0]=h,i[1]=v,i[2]=A,i[3]=0,i[4]=p,i[5]=w,i[6]=P,i[7]=0,i[8]=m,i[9]=E,i[10]=M,i[11]=0,i[12]=-(h*B+p*U+m*$),i[13]=-(v*B+w*U+E*$),i[14]=-(A*B+P*U+M*$),i[15]=1,i)},Zt.targetTo=function(i,n,s,u){var h=n[0],p=n[1],m=n[2],v=u[0],w=u[1],E=u[2],A=h-s[0],P=p-s[1],M=m-s[2],z=A*A+P*P+M*M;z>0&&(A*=z=1/Math.sqrt(z),P*=z,M*=z);var B=w*M-E*P,U=E*A-v*M,$=v*P-w*A;return(z=B*B+U*U+$*$)>0&&(B*=z=1/Math.sqrt(z),U*=z,$*=z),i[0]=B,i[1]=U,i[2]=$,i[3]=0,i[4]=P*$-M*U,i[5]=M*B-A*$,i[6]=A*U-P*B,i[7]=0,i[8]=A,i[9]=P,i[10]=M,i[11]=0,i[12]=h,i[13]=p,i[14]=m,i[15]=1,i},Zt.str=function(i){return"mat4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+", "+i[9]+", "+i[10]+", "+i[11]+", "+i[12]+", "+i[13]+", "+i[14]+", "+i[15]+")"},Zt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])},Zt.add=function(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i[2]=n[2]+s[2],i[3]=n[3]+s[3],i[4]=n[4]+s[4],i[5]=n[5]+s[5],i[6]=n[6]+s[6],i[7]=n[7]+s[7],i[8]=n[8]+s[8],i[9]=n[9]+s[9],i[10]=n[10]+s[10],i[11]=n[11]+s[11],i[12]=n[12]+s[12],i[13]=n[13]+s[13],i[14]=n[14]+s[14],i[15]=n[15]+s[15],i},Zt.subtract=wt,Zt.multiplyScalar=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3]*s,i[4]=n[4]*s,i[5]=n[5]*s,i[6]=n[6]*s,i[7]=n[7]*s,i[8]=n[8]*s,i[9]=n[9]*s,i[10]=n[10]*s,i[11]=n[11]*s,i[12]=n[12]*s,i[13]=n[13]*s,i[14]=n[14]*s,i[15]=n[15]*s,i},Zt.multiplyScalarAndAdd=function(i,n,s,u){return i[0]=n[0]+s[0]*u,i[1]=n[1]+s[1]*u,i[2]=n[2]+s[2]*u,i[3]=n[3]+s[3]*u,i[4]=n[4]+s[4]*u,i[5]=n[5]+s[5]*u,i[6]=n[6]+s[6]*u,i[7]=n[7]+s[7]*u,i[8]=n[8]+s[8]*u,i[9]=n[9]+s[9]*u,i[10]=n[10]+s[10]*u,i[11]=n[11]+s[11]*u,i[12]=n[12]+s[12]*u,i[13]=n[13]+s[13]*u,i[14]=n[14]+s[14]*u,i[15]=n[15]+s[15]*u,i},Zt.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]&&i[8]===n[8]&&i[9]===n[9]&&i[10]===n[10]&&i[11]===n[11]&&i[12]===n[12]&&i[13]===n[13]&&i[14]===n[14]&&i[15]===n[15]},Zt.equals=function(i,n){var s=i[0],u=i[1],h=i[2],p=i[3],m=i[4],v=i[5],w=i[6],E=i[7],A=i[8],P=i[9],M=i[10],z=i[11],B=i[12],U=i[13],$=i[14],Y=i[15],fe=n[0],he=n[1],me=n[2],Ae=n[3],Ce=n[4],Le=n[5],Ve=n[6],He=n[7],et=n[8],Ze=n[9],st=n[10],yt=n[11],ot=n[12],bt=n[13],rt=n[14],dt=n[15];return Math.abs(s-fe)<=qt.EPSILON*Math.max(1,Math.abs(s),Math.abs(fe))&&Math.abs(u-he)<=qt.EPSILON*Math.max(1,Math.abs(u),Math.abs(he))&&Math.abs(h-me)<=qt.EPSILON*Math.max(1,Math.abs(h),Math.abs(me))&&Math.abs(p-Ae)<=qt.EPSILON*Math.max(1,Math.abs(p),Math.abs(Ae))&&Math.abs(m-Ce)<=qt.EPSILON*Math.max(1,Math.abs(m),Math.abs(Ce))&&Math.abs(v-Le)<=qt.EPSILON*Math.max(1,Math.abs(v),Math.abs(Le))&&Math.abs(w-Ve)<=qt.EPSILON*Math.max(1,Math.abs(w),Math.abs(Ve))&&Math.abs(E-He)<=qt.EPSILON*Math.max(1,Math.abs(E),Math.abs(He))&&Math.abs(A-et)<=qt.EPSILON*Math.max(1,Math.abs(A),Math.abs(et))&&Math.abs(P-Ze)<=qt.EPSILON*Math.max(1,Math.abs(P),Math.abs(Ze))&&Math.abs(M-st)<=qt.EPSILON*Math.max(1,Math.abs(M),Math.abs(st))&&Math.abs(z-yt)<=qt.EPSILON*Math.max(1,Math.abs(z),Math.abs(yt))&&Math.abs(B-ot)<=qt.EPSILON*Math.max(1,Math.abs(B),Math.abs(ot))&&Math.abs(U-bt)<=qt.EPSILON*Math.max(1,Math.abs(U),Math.abs(bt))&&Math.abs($-rt)<=qt.EPSILON*Math.max(1,Math.abs($),Math.abs(rt))&&Math.abs(Y-dt)<=qt.EPSILON*Math.max(1,Math.abs(Y),Math.abs(dt))},Zt.sub=Zt.mul=Zt.ortho=Zt.perspective=void 0;var qt=function(i,n){if(i&&i.__esModule)return i;if(i===null||zt(i)!=="object"&&typeof i!="function")return{default:i};var s=xn(void 0);if(s&&s.has(i))return s.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,s&&s.set(i,u),u}(we);function xn(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(xn=function(u){return u?s:n})(i)}function rr(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Gn(i,n,s){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],A=n[7],P=n[8],M=n[9],z=n[10],B=n[11],U=n[12],$=n[13],Y=n[14],fe=n[15],he=s[0],me=s[1],Ae=s[2],Ce=s[3];return i[0]=he*u+me*v+Ae*P+Ce*U,i[1]=he*h+me*w+Ae*M+Ce*$,i[2]=he*p+me*E+Ae*z+Ce*Y,i[3]=he*m+me*A+Ae*B+Ce*fe,i[4]=(he=s[4])*u+(me=s[5])*v+(Ae=s[6])*P+(Ce=s[7])*U,i[5]=he*h+me*w+Ae*M+Ce*$,i[6]=he*p+me*E+Ae*z+Ce*Y,i[7]=he*m+me*A+Ae*B+Ce*fe,i[8]=(he=s[8])*u+(me=s[9])*v+(Ae=s[10])*P+(Ce=s[11])*U,i[9]=he*h+me*w+Ae*M+Ce*$,i[10]=he*p+me*E+Ae*z+Ce*Y,i[11]=he*m+me*A+Ae*B+Ce*fe,i[12]=(he=s[12])*u+(me=s[13])*v+(Ae=s[14])*P+(Ce=s[15])*U,i[13]=he*h+me*w+Ae*M+Ce*$,i[14]=he*p+me*E+Ae*z+Ce*Y,i[15]=he*m+me*A+Ae*B+Ce*fe,i}function yr(i,n,s){var u=n[0],h=n[1],p=n[2],m=n[3],v=u+u,w=h+h,E=p+p,A=u*v,P=u*w,M=u*E,z=h*w,B=h*E,U=p*E,$=m*v,Y=m*w,fe=m*E;return i[0]=1-(z+U),i[1]=P+fe,i[2]=M-Y,i[3]=0,i[4]=P-fe,i[5]=1-(A+U),i[6]=B+$,i[7]=0,i[8]=M+Y,i[9]=B-$,i[10]=1-(A+z),i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i}function Gr(i,n){var s=n[4],u=n[5],h=n[6],p=n[8],m=n[9],v=n[10];return i[0]=Math.hypot(n[0],n[1],n[2]),i[1]=Math.hypot(s,u,h),i[2]=Math.hypot(p,m,v),i}function mr(i,n,s,u,h){var p,m=1/Math.tan(n/2);return i[0]=m/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=(h+u)*(p=1/(u-h)),i[14]=2*h*u*p):(i[10]=-1,i[14]=-2*u),i}function wr(i,n,s,u,h,p,m){var v=1/(n-s),w=1/(u-h),E=1/(p-m);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*E,i[11]=0,i[12]=(n+s)*v,i[13]=(h+u)*w,i[14]=(m+p)*E,i[15]=1,i}function wt(i,n,s){return i[0]=n[0]-s[0],i[1]=n[1]-s[1],i[2]=n[2]-s[2],i[3]=n[3]-s[3],i[4]=n[4]-s[4],i[5]=n[5]-s[5],i[6]=n[6]-s[6],i[7]=n[7]-s[7],i[8]=n[8]-s[8],i[9]=n[9]-s[9],i[10]=n[10]-s[10],i[11]=n[11]-s[11],i[12]=n[12]-s[12],i[13]=n[13]-s[13],i[14]=n[14]-s[14],i[15]=n[15]-s[15],i}Zt.perspective=mr,Zt.ortho=wr,Zt.mul=Gn,Zt.sub=wt;var St={},Ct={};function it(i){return it=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},it(i)}Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.create=In,Ct.clone=function(i){var n=new pt.ARRAY_TYPE(3);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n},Ct.length=en,Ct.fromValues=function(i,n,s){var u=new pt.ARRAY_TYPE(3);return u[0]=i,u[1]=n,u[2]=s,u},Ct.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i},Ct.set=function(i,n,s,u){return i[0]=n,i[1]=s,i[2]=u,i},Ct.add=function(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i[2]=n[2]+s[2],i},Ct.subtract=Ye,Ct.multiply=Rt,Ct.divide=bn,Ct.ceil=function(i,n){return i[0]=Math.ceil(n[0]),i[1]=Math.ceil(n[1]),i[2]=Math.ceil(n[2]),i},Ct.floor=function(i,n){return i[0]=Math.floor(n[0]),i[1]=Math.floor(n[1]),i[2]=Math.floor(n[2]),i},Ct.min=function(i,n,s){return i[0]=Math.min(n[0],s[0]),i[1]=Math.min(n[1],s[1]),i[2]=Math.min(n[2],s[2]),i},Ct.max=function(i,n,s){return i[0]=Math.max(n[0],s[0]),i[1]=Math.max(n[1],s[1]),i[2]=Math.max(n[2],s[2]),i},Ct.round=function(i,n){return i[0]=Math.round(n[0]),i[1]=Math.round(n[1]),i[2]=Math.round(n[2]),i},Ct.scale=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i},Ct.scaleAndAdd=function(i,n,s,u){return i[0]=n[0]+s[0]*u,i[1]=n[1]+s[1]*u,i[2]=n[2]+s[2]*u,i},Ct.distance=Pn,Ct.squaredDistance=gn,Ct.squaredLength=er,Ct.negate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i},Ct.inverse=function(i,n){return i[0]=1/n[0],i[1]=1/n[1],i[2]=1/n[2],i},Ct.normalize=function(i,n){var s=n[0],u=n[1],h=n[2],p=s*s+u*u+h*h;return p>0&&(p=1/Math.sqrt(p)),i[0]=n[0]*p,i[1]=n[1]*p,i[2]=n[2]*p,i},Ct.dot=Ur,Ct.cross=function(i,n,s){var u=n[0],h=n[1],p=n[2],m=s[0],v=s[1],w=s[2];return i[0]=h*w-p*v,i[1]=p*m-u*w,i[2]=u*v-h*m,i},Ct.lerp=function(i,n,s,u){var h=n[0],p=n[1],m=n[2];return i[0]=h+u*(s[0]-h),i[1]=p+u*(s[1]-p),i[2]=m+u*(s[2]-m),i},Ct.hermite=function(i,n,s,u,h,p){var m=p*p,v=m*(2*p-3)+1,w=m*(p-2)+p,E=m*(p-1),A=m*(3-2*p);return i[0]=n[0]*v+s[0]*w+u[0]*E+h[0]*A,i[1]=n[1]*v+s[1]*w+u[1]*E+h[1]*A,i[2]=n[2]*v+s[2]*w+u[2]*E+h[2]*A,i},Ct.bezier=function(i,n,s,u,h,p){var m=1-p,v=m*m,w=p*p,E=v*m,A=3*p*v,P=3*w*m,M=w*p;return i[0]=n[0]*E+s[0]*A+u[0]*P+h[0]*M,i[1]=n[1]*E+s[1]*A+u[1]*P+h[1]*M,i[2]=n[2]*E+s[2]*A+u[2]*P+h[2]*M,i},Ct.random=function(i,n){n=n||1;var s=2*pt.RANDOM()*Math.PI,u=2*pt.RANDOM()-1,h=Math.sqrt(1-u*u)*n;return i[0]=Math.cos(s)*h,i[1]=Math.sin(s)*h,i[2]=u*n,i},Ct.transformMat4=function(i,n,s){var u=n[0],h=n[1],p=n[2],m=s[3]*u+s[7]*h+s[11]*p+s[15];return i[0]=(s[0]*u+s[4]*h+s[8]*p+s[12])/(m=m||1),i[1]=(s[1]*u+s[5]*h+s[9]*p+s[13])/m,i[2]=(s[2]*u+s[6]*h+s[10]*p+s[14])/m,i},Ct.transformMat3=function(i,n,s){var u=n[0],h=n[1],p=n[2];return i[0]=u*s[0]+h*s[3]+p*s[6],i[1]=u*s[1]+h*s[4]+p*s[7],i[2]=u*s[2]+h*s[5]+p*s[8],i},Ct.transformQuat=function(i,n,s){var u=s[0],h=s[1],p=s[2],m=n[0],v=n[1],w=n[2],E=h*w-p*v,A=p*m-u*w,P=u*v-h*m,M=h*P-p*A,z=p*E-u*P,B=u*A-h*E,U=2*s[3];return A*=U,P*=U,z*=2,B*=2,i[0]=m+(E*=U)+(M*=2),i[1]=v+A+z,i[2]=w+P+B,i},Ct.rotateX=function(i,n,s,u){var h=[],p=[];return h[0]=n[0]-s[0],h[1]=n[1]-s[1],h[2]=n[2]-s[2],p[0]=h[0],p[1]=h[1]*Math.cos(u)-h[2]*Math.sin(u),p[2]=h[1]*Math.sin(u)+h[2]*Math.cos(u),i[0]=p[0]+s[0],i[1]=p[1]+s[1],i[2]=p[2]+s[2],i},Ct.rotateY=function(i,n,s,u){var h=[],p=[];return h[0]=n[0]-s[0],h[1]=n[1]-s[1],h[2]=n[2]-s[2],p[0]=h[2]*Math.sin(u)+h[0]*Math.cos(u),p[1]=h[1],p[2]=h[2]*Math.cos(u)-h[0]*Math.sin(u),i[0]=p[0]+s[0],i[1]=p[1]+s[1],i[2]=p[2]+s[2],i},Ct.rotateZ=function(i,n,s,u){var h=[],p=[];return h[0]=n[0]-s[0],h[1]=n[1]-s[1],h[2]=n[2]-s[2],p[0]=h[0]*Math.cos(u)-h[1]*Math.sin(u),p[1]=h[0]*Math.sin(u)+h[1]*Math.cos(u),p[2]=h[2],i[0]=p[0]+s[0],i[1]=p[1]+s[1],i[2]=p[2]+s[2],i},Ct.angle=function(i,n){var s=i[0],u=i[1],h=i[2],p=n[0],m=n[1],v=n[2],w=Math.sqrt(s*s+u*u+h*h)*Math.sqrt(p*p+m*m+v*v),E=w&&Ur(i,n)/w;return Math.acos(Math.min(Math.max(E,-1),1))},Ct.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i},Ct.str=function(i){return"vec3("+i[0]+", "+i[1]+", "+i[2]+")"},Ct.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]},Ct.equals=function(i,n){var s=i[0],u=i[1],h=i[2],p=n[0],m=n[1],v=n[2];return Math.abs(s-p)<=pt.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-m)<=pt.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(h-v)<=pt.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))},Ct.forEach=Ct.sqrLen=Ct.len=Ct.sqrDist=Ct.dist=Ct.div=Ct.mul=Ct.sub=void 0;var pt=function(i,n){if(i&&i.__esModule)return i;if(i===null||it(i)!=="object"&&typeof i!="function")return{default:i};var s=Jt(void 0);if(s&&s.has(i))return s.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,s&&s.set(i,u),u}(we);function Jt(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(Jt=function(u){return u?s:n})(i)}function In(){var i=new pt.ARRAY_TYPE(3);return pt.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function en(i){return Math.hypot(i[0],i[1],i[2])}function Ye(i,n,s){return i[0]=n[0]-s[0],i[1]=n[1]-s[1],i[2]=n[2]-s[2],i}function Rt(i,n,s){return i[0]=n[0]*s[0],i[1]=n[1]*s[1],i[2]=n[2]*s[2],i}function bn(i,n,s){return i[0]=n[0]/s[0],i[1]=n[1]/s[1],i[2]=n[2]/s[2],i}function Pn(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1],n[2]-i[2])}function gn(i,n){var s=n[0]-i[0],u=n[1]-i[1],h=n[2]-i[2];return s*s+u*u+h*h}function er(i){var n=i[0],s=i[1],u=i[2];return n*n+s*s+u*u}function Ur(i,n){return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]}Ct.sub=Ye,Ct.mul=Rt,Ct.div=bn,Ct.dist=Pn,Ct.sqrDist=gn,Ct.len=en,Ct.sqrLen=er;var hn,Rn=(hn=In(),function(i,n,s,u,h,p){var m,v;for(n||(n=3),s||(s=0),v=u?Math.min(u*n+s,i.length):i.length,m=s;m<v;m+=n)hn[0]=i[m],hn[1]=i[m+1],hn[2]=i[m+2],h(hn,hn,p),i[m]=hn[0],i[m+1]=hn[1],i[m+2]=hn[2];return i});Ct.forEach=Rn;var Kt={};function zi(i){return zi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},zi(i)}Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.create=go,Kt.clone=function(i){var n=new li.ARRAY_TYPE(4);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n},Kt.fromValues=function(i,n,s,u){var h=new li.ARRAY_TYPE(4);return h[0]=i,h[1]=n,h[2]=s,h[3]=u,h},Kt.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i},Kt.set=function(i,n,s,u,h){return i[0]=n,i[1]=s,i[2]=u,i[3]=h,i},Kt.add=function(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i[2]=n[2]+s[2],i[3]=n[3]+s[3],i},Kt.subtract=Xi,Kt.multiply=Ao,Kt.divide=Za,Kt.ceil=function(i,n){return i[0]=Math.ceil(n[0]),i[1]=Math.ceil(n[1]),i[2]=Math.ceil(n[2]),i[3]=Math.ceil(n[3]),i},Kt.floor=function(i,n){return i[0]=Math.floor(n[0]),i[1]=Math.floor(n[1]),i[2]=Math.floor(n[2]),i[3]=Math.floor(n[3]),i},Kt.min=function(i,n,s){return i[0]=Math.min(n[0],s[0]),i[1]=Math.min(n[1],s[1]),i[2]=Math.min(n[2],s[2]),i[3]=Math.min(n[3],s[3]),i},Kt.max=function(i,n,s){return i[0]=Math.max(n[0],s[0]),i[1]=Math.max(n[1],s[1]),i[2]=Math.max(n[2],s[2]),i[3]=Math.max(n[3],s[3]),i},Kt.round=function(i,n){return i[0]=Math.round(n[0]),i[1]=Math.round(n[1]),i[2]=Math.round(n[2]),i[3]=Math.round(n[3]),i},Kt.scale=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3]*s,i},Kt.scaleAndAdd=function(i,n,s,u){return i[0]=n[0]+s[0]*u,i[1]=n[1]+s[1]*u,i[2]=n[2]+s[2]*u,i[3]=n[3]+s[3]*u,i},Kt.distance=_o,Kt.squaredDistance=Wt,Kt.length=Ln,Kt.squaredLength=Or,Kt.negate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=-n[3],i},Kt.inverse=function(i,n){return i[0]=1/n[0],i[1]=1/n[1],i[2]=1/n[2],i[3]=1/n[3],i},Kt.normalize=function(i,n){var s=n[0],u=n[1],h=n[2],p=n[3],m=s*s+u*u+h*h+p*p;return m>0&&(m=1/Math.sqrt(m)),i[0]=s*m,i[1]=u*m,i[2]=h*m,i[3]=p*m,i},Kt.dot=function(i,n){return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},Kt.cross=function(i,n,s,u){var h=s[0]*u[1]-s[1]*u[0],p=s[0]*u[2]-s[2]*u[0],m=s[0]*u[3]-s[3]*u[0],v=s[1]*u[2]-s[2]*u[1],w=s[1]*u[3]-s[3]*u[1],E=s[2]*u[3]-s[3]*u[2],A=n[0],P=n[1],M=n[2],z=n[3];return i[0]=P*E-M*w+z*v,i[1]=-A*E+M*m-z*p,i[2]=A*w-P*m+z*h,i[3]=-A*v+P*p-M*h,i},Kt.lerp=function(i,n,s,u){var h=n[0],p=n[1],m=n[2],v=n[3];return i[0]=h+u*(s[0]-h),i[1]=p+u*(s[1]-p),i[2]=m+u*(s[2]-m),i[3]=v+u*(s[3]-v),i},Kt.random=function(i,n){var s,u,h,p,m,v;n=n||1;do m=(s=2*li.RANDOM()-1)*s+(u=2*li.RANDOM()-1)*u;while(m>=1);do v=(h=2*li.RANDOM()-1)*h+(p=2*li.RANDOM()-1)*p;while(v>=1);var w=Math.sqrt((1-m)/v);return i[0]=n*s,i[1]=n*u,i[2]=n*h*w,i[3]=n*p*w,i},Kt.transformMat4=function(i,n,s){var u=n[0],h=n[1],p=n[2],m=n[3];return i[0]=s[0]*u+s[4]*h+s[8]*p+s[12]*m,i[1]=s[1]*u+s[5]*h+s[9]*p+s[13]*m,i[2]=s[2]*u+s[6]*h+s[10]*p+s[14]*m,i[3]=s[3]*u+s[7]*h+s[11]*p+s[15]*m,i},Kt.transformQuat=function(i,n,s){var u=n[0],h=n[1],p=n[2],m=s[0],v=s[1],w=s[2],E=s[3],A=E*u+v*p-w*h,P=E*h+w*u-m*p,M=E*p+m*h-v*u,z=-m*u-v*h-w*p;return i[0]=A*E+z*-m+P*-w-M*-v,i[1]=P*E+z*-v+M*-m-A*-w,i[2]=M*E+z*-w+A*-v-P*-m,i[3]=n[3],i},Kt.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=0,i},Kt.str=function(i){return"vec4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},Kt.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]},Kt.equals=function(i,n){var s=i[0],u=i[1],h=i[2],p=i[3],m=n[0],v=n[1],w=n[2],E=n[3];return Math.abs(s-m)<=li.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-v)<=li.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(h-w)<=li.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(p-E)<=li.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))},Kt.forEach=Kt.sqrLen=Kt.len=Kt.sqrDist=Kt.dist=Kt.div=Kt.mul=Kt.sub=void 0;var li=function(i,n){if(i&&i.__esModule)return i;if(i===null||zi(i)!=="object"&&typeof i!="function")return{default:i};var s=vi(void 0);if(s&&s.has(i))return s.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,s&&s.set(i,u),u}(we);function vi(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(vi=function(u){return u?s:n})(i)}function go(){var i=new li.ARRAY_TYPE(4);return li.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function Xi(i,n,s){return i[0]=n[0]-s[0],i[1]=n[1]-s[1],i[2]=n[2]-s[2],i[3]=n[3]-s[3],i}function Ao(i,n,s){return i[0]=n[0]*s[0],i[1]=n[1]*s[1],i[2]=n[2]*s[2],i[3]=n[3]*s[3],i}function Za(i,n,s){return i[0]=n[0]/s[0],i[1]=n[1]/s[1],i[2]=n[2]/s[2],i[3]=n[3]/s[3],i}function _o(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1],n[2]-i[2],n[3]-i[3])}function Wt(i,n){var s=n[0]-i[0],u=n[1]-i[1],h=n[2]-i[2],p=n[3]-i[3];return s*s+u*u+h*h+p*p}function Ln(i){return Math.hypot(i[0],i[1],i[2],i[3])}function Or(i){var n=i[0],s=i[1],u=i[2],h=i[3];return n*n+s*s+u*u+h*h}Kt.sub=Xi,Kt.mul=Ao,Kt.div=Za,Kt.dist=_o,Kt.sqrDist=Wt,Kt.len=Ln,Kt.sqrLen=Or;var Pr=function(){var i=go();return function(n,s,u,h,p,m){var v,w;for(s||(s=4),u||(u=0),w=h?Math.min(h*s+u,n.length):n.length,v=u;v<w;v+=s)i[0]=n[v],i[1]=n[v+1],i[2]=n[v+2],i[3]=n[v+3],p(i,i,m),n[v]=i[0],n[v+1]=i[1],n[v+2]=i[2],n[v+3]=i[3];return n}}();function Ei(i){return Ei=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ei(i)}Kt.forEach=Pr,Object.defineProperty(St,"__esModule",{value:!0}),St.create=qr,St.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i},St.setAxisAngle=Si,St.getAxisAngle=function(i,n){var s=2*Math.acos(n[3]),u=Math.sin(s/2);return u>Rr.EPSILON?(i[0]=n[0]/u,i[1]=n[1]/u,i[2]=n[2]/u):(i[0]=1,i[1]=0,i[2]=0),s},St.getAngle=function(i,n){var s=De(i,n);return Math.acos(2*s*s-1)},St.multiply=El,St.rotateX=function(i,n,s){s*=.5;var u=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(s),w=Math.cos(s);return i[0]=u*w+m*v,i[1]=h*w+p*v,i[2]=p*w-h*v,i[3]=m*w-u*v,i},St.rotateY=function(i,n,s){s*=.5;var u=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(s),w=Math.cos(s);return i[0]=u*w-p*v,i[1]=h*w+m*v,i[2]=p*w+u*v,i[3]=m*w-h*v,i},St.rotateZ=function(i,n,s){s*=.5;var u=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(s),w=Math.cos(s);return i[0]=u*w+h*v,i[1]=h*w-u*v,i[2]=p*w+m*v,i[3]=m*w-p*v,i},St.calculateW=function(i,n){var s=n[0],u=n[1],h=n[2];return i[0]=s,i[1]=u,i[2]=h,i[3]=Math.sqrt(Math.abs(1-s*s-u*u-h*h)),i},St.exp=Be,St.ln=te,St.pow=function(i,n,s){return te(i,n),Oe(i,i,s),Be(i,i),i},St.slerp=le,St.random=function(i){var n=Rr.RANDOM(),s=Rr.RANDOM(),u=Rr.RANDOM(),h=Math.sqrt(1-n),p=Math.sqrt(n);return i[0]=h*Math.sin(2*Math.PI*s),i[1]=h*Math.cos(2*Math.PI*s),i[2]=p*Math.sin(2*Math.PI*u),i[3]=p*Math.cos(2*Math.PI*u),i},St.invert=function(i,n){var s=n[0],u=n[1],h=n[2],p=n[3],m=s*s+u*u+h*h+p*p,v=m?1/m:0;return i[0]=-s*v,i[1]=-u*v,i[2]=-h*v,i[3]=p*v,i},St.conjugate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=n[3],i},St.fromMat3=xe,St.fromEuler=function(i,n,s,u){var h=.5*Math.PI/180;n*=h,s*=h,u*=h;var p=Math.sin(n),m=Math.cos(n),v=Math.sin(s),w=Math.cos(s),E=Math.sin(u),A=Math.cos(u);return i[0]=p*w*A-m*v*E,i[1]=m*v*A+p*w*E,i[2]=m*w*E-p*v*A,i[3]=m*w*A+p*v*E,i},St.str=function(i){return"quat("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},St.setAxes=St.sqlerp=St.rotationTo=St.equals=St.exactEquals=St.normalize=St.sqrLen=St.squaredLength=St.len=St.length=St.lerp=St.dot=St.scale=St.mul=St.add=St.set=St.copy=St.fromValues=St.clone=void 0;var Rr=ro(we),us=ro(Vt),$i=ro(Ct),si=ro(Kt);function no(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(no=function(u){return u?s:n})(i)}function ro(i,n){if(i&&i.__esModule)return i;if(i===null||Ei(i)!=="object"&&typeof i!="function")return{default:i};var s=no(n);if(s&&s.has(i))return s.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,s&&s.set(i,u),u}function qr(){var i=new Rr.ARRAY_TYPE(4);return Rr.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Si(i,n,s){s*=.5;var u=Math.sin(s);return i[0]=u*n[0],i[1]=u*n[1],i[2]=u*n[2],i[3]=Math.cos(s),i}function El(i,n,s){var u=n[0],h=n[1],p=n[2],m=n[3],v=s[0],w=s[1],E=s[2],A=s[3];return i[0]=u*A+m*v+h*E-p*w,i[1]=h*A+m*w+p*v-u*E,i[2]=p*A+m*E+u*w-h*v,i[3]=m*A-u*v-h*w-p*E,i}function Be(i,n){var s=n[0],u=n[1],h=n[2],p=n[3],m=Math.sqrt(s*s+u*u+h*h),v=Math.exp(p),w=m>0?v*Math.sin(m)/m:0;return i[0]=s*w,i[1]=u*w,i[2]=h*w,i[3]=v*Math.cos(m),i}function te(i,n){var s=n[0],u=n[1],h=n[2],p=n[3],m=Math.sqrt(s*s+u*u+h*h),v=m>0?Math.atan2(m,p)/m:0;return i[0]=s*v,i[1]=u*v,i[2]=h*v,i[3]=.5*Math.log(s*s+u*u+h*h+p*p),i}function le(i,n,s,u){var h,p,m,v,w,E=n[0],A=n[1],P=n[2],M=n[3],z=s[0],B=s[1],U=s[2],$=s[3];return(p=E*z+A*B+P*U+M*$)<0&&(p=-p,z=-z,B=-B,U=-U,$=-$),1-p>Rr.EPSILON?(h=Math.acos(p),m=Math.sin(h),v=Math.sin((1-u)*h)/m,w=Math.sin(u*h)/m):(v=1-u,w=u),i[0]=v*E+w*z,i[1]=v*A+w*B,i[2]=v*P+w*U,i[3]=v*M+w*$,i}function xe(i,n){var s,u=n[0]+n[4]+n[8];if(u>0)s=Math.sqrt(u+1),i[3]=.5*s,i[0]=(n[5]-n[7])*(s=.5/s),i[1]=(n[6]-n[2])*s,i[2]=(n[1]-n[3])*s;else{var h=0;n[4]>n[0]&&(h=1),n[8]>n[3*h+h]&&(h=2);var p=(h+1)%3,m=(h+2)%3;s=Math.sqrt(n[3*h+h]-n[3*p+p]-n[3*m+m]+1),i[h]=.5*s,i[3]=(n[3*p+m]-n[3*m+p])*(s=.5/s),i[p]=(n[3*p+h]+n[3*h+p])*s,i[m]=(n[3*m+h]+n[3*h+m])*s}return i}St.clone=si.clone,St.fromValues=si.fromValues,St.copy=si.copy,St.set=si.set,St.add=si.add,St.mul=El;var Oe=si.scale;St.scale=Oe;var De=si.dot;St.dot=De,St.lerp=si.lerp;var Ge=si.length;St.length=Ge,St.len=Ge;var tt=si.squaredLength;St.squaredLength=tt,St.sqrLen=tt;var $e=si.normalize;St.normalize=$e,St.exactEquals=si.exactEquals,St.equals=si.equals;var Je,mt,gt,$t=(Je=$i.create(),mt=$i.fromValues(1,0,0),gt=$i.fromValues(0,1,0),function(i,n,s){var u=$i.dot(n,s);return u<-.999999?($i.cross(Je,mt,n),$i.len(Je)<1e-6&&$i.cross(Je,gt,n),$i.normalize(Je,Je),Si(i,Je,Math.PI),i):u>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):($i.cross(Je,n,s),i[0]=Je[0],i[1]=Je[1],i[2]=Je[2],i[3]=1+u,$e(i,i))});St.rotationTo=$t;var _n,An,ur=(_n=qr(),An=qr(),function(i,n,s,u,h,p){return le(_n,n,h,p),le(An,s,u,p),le(i,_n,An,2*p*(1-p)),i});St.sqlerp=ur;var Dn,hr=(Dn=us.create(),function(i,n,s,u){return Dn[0]=s[0],Dn[3]=s[1],Dn[6]=s[2],Dn[1]=u[0],Dn[4]=u[1],Dn[7]=u[2],Dn[2]=-n[0],Dn[5]=-n[1],Dn[8]=-n[2],$e(i,xe(i,Dn))});St.setAxes=hr;var cn={};function ei(i){return ei=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ei(i)}Object.defineProperty(cn,"__esModule",{value:!0}),cn.create=function(){var i=new vr.ARRAY_TYPE(8);return vr.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0),i[3]=1,i},cn.clone=function(i){var n=new vr.ARRAY_TYPE(8);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n},cn.fromValues=function(i,n,s,u,h,p,m,v){var w=new vr.ARRAY_TYPE(8);return w[0]=i,w[1]=n,w[2]=s,w[3]=u,w[4]=h,w[5]=p,w[6]=m,w[7]=v,w},cn.fromRotationTranslationValues=function(i,n,s,u,h,p,m){var v=new vr.ARRAY_TYPE(8);v[0]=i,v[1]=n,v[2]=s,v[3]=u;var w=.5*h,E=.5*p,A=.5*m;return v[4]=w*u+E*s-A*n,v[5]=E*u+A*i-w*s,v[6]=A*u+w*n-E*i,v[7]=-w*i-E*n-A*s,v},cn.fromRotationTranslation=Ps,cn.fromTranslation=function(i,n){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=.5*n[0],i[5]=.5*n[1],i[6]=.5*n[2],i[7]=0,i},cn.fromRotation=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},cn.fromMat4=function(i,n){var s=dr.create();xi.getRotation(s,n);var u=new vr.ARRAY_TYPE(3);return xi.getTranslation(u,n),Ps(i,s,u),i},cn.copy=Ws,cn.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},cn.set=function(i,n,s,u,h,p,m,v,w){return i[0]=n,i[1]=s,i[2]=u,i[3]=h,i[4]=p,i[5]=m,i[6]=v,i[7]=w,i},cn.getDual=function(i,n){return i[0]=n[4],i[1]=n[5],i[2]=n[6],i[3]=n[7],i},cn.setDual=function(i,n){return i[4]=n[0],i[5]=n[1],i[6]=n[2],i[7]=n[3],i},cn.getTranslation=function(i,n){var s=n[4],u=n[5],h=n[6],p=n[7],m=-n[0],v=-n[1],w=-n[2],E=n[3];return i[0]=2*(s*E+p*m+u*w-h*v),i[1]=2*(u*E+p*v+h*m-s*w),i[2]=2*(h*E+p*w+s*v-u*m),i},cn.translate=function(i,n,s){var u=n[0],h=n[1],p=n[2],m=n[3],v=.5*s[0],w=.5*s[1],E=.5*s[2],A=n[4],P=n[5],M=n[6],z=n[7];return i[0]=u,i[1]=h,i[2]=p,i[3]=m,i[4]=m*v+h*E-p*w+A,i[5]=m*w+p*v-u*E+P,i[6]=m*E+u*w-h*v+M,i[7]=-u*v-h*w-p*E+z,i},cn.rotateX=function(i,n,s){var u=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],w=n[5],E=n[6],A=n[7],P=v*m+A*u+w*p-E*h,M=w*m+A*h+E*u-v*p,z=E*m+A*p+v*h-w*u,B=A*m-v*u-w*h-E*p;return dr.rotateX(i,n,s),i[4]=P*(m=i[3])+B*(u=i[0])+M*(p=i[2])-z*(h=i[1]),i[5]=M*m+B*h+z*u-P*p,i[6]=z*m+B*p+P*h-M*u,i[7]=B*m-P*u-M*h-z*p,i},cn.rotateY=function(i,n,s){var u=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],w=n[5],E=n[6],A=n[7],P=v*m+A*u+w*p-E*h,M=w*m+A*h+E*u-v*p,z=E*m+A*p+v*h-w*u,B=A*m-v*u-w*h-E*p;return dr.rotateY(i,n,s),i[4]=P*(m=i[3])+B*(u=i[0])+M*(p=i[2])-z*(h=i[1]),i[5]=M*m+B*h+z*u-P*p,i[6]=z*m+B*p+P*h-M*u,i[7]=B*m-P*u-M*h-z*p,i},cn.rotateZ=function(i,n,s){var u=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],w=n[5],E=n[6],A=n[7],P=v*m+A*u+w*p-E*h,M=w*m+A*h+E*u-v*p,z=E*m+A*p+v*h-w*u,B=A*m-v*u-w*h-E*p;return dr.rotateZ(i,n,s),i[4]=P*(m=i[3])+B*(u=i[0])+M*(p=i[2])-z*(h=i[1]),i[5]=M*m+B*h+z*u-P*p,i[6]=z*m+B*p+P*h-M*u,i[7]=B*m-P*u-M*h-z*p,i},cn.rotateByQuatAppend=function(i,n,s){var u=s[0],h=s[1],p=s[2],m=s[3],v=n[0],w=n[1],E=n[2],A=n[3];return i[0]=v*m+A*u+w*p-E*h,i[1]=w*m+A*h+E*u-v*p,i[2]=E*m+A*p+v*h-w*u,i[3]=A*m-v*u-w*h-E*p,i[4]=(v=n[4])*m+(A=n[7])*u+(w=n[5])*p-(E=n[6])*h,i[5]=w*m+A*h+E*u-v*p,i[6]=E*m+A*p+v*h-w*u,i[7]=A*m-v*u-w*h-E*p,i},cn.rotateByQuatPrepend=function(i,n,s){var u=n[0],h=n[1],p=n[2],m=n[3],v=s[0],w=s[1],E=s[2],A=s[3];return i[0]=u*A+m*v+h*E-p*w,i[1]=h*A+m*w+p*v-u*E,i[2]=p*A+m*E+u*w-h*v,i[3]=m*A-u*v-h*w-p*E,i[4]=u*(A=s[7])+m*(v=s[4])+h*(E=s[6])-p*(w=s[5]),i[5]=h*A+m*w+p*v-u*E,i[6]=p*A+m*E+u*w-h*v,i[7]=m*A-u*v-h*w-p*E,i},cn.rotateAroundAxis=function(i,n,s,u){if(Math.abs(u)<vr.EPSILON)return Ws(i,n);var h=Math.hypot(s[0],s[1],s[2]);u*=.5;var p=Math.sin(u),m=p*s[0]/h,v=p*s[1]/h,w=p*s[2]/h,E=Math.cos(u),A=n[0],P=n[1],M=n[2],z=n[3];i[0]=A*E+z*m+P*w-M*v,i[1]=P*E+z*v+M*m-A*w,i[2]=M*E+z*w+A*v-P*m,i[3]=z*E-A*m-P*v-M*w;var B=n[4],U=n[5],$=n[6],Y=n[7];return i[4]=B*E+Y*m+U*w-$*v,i[5]=U*E+Y*v+$*m-B*w,i[6]=$*E+Y*w+B*v-U*m,i[7]=Y*E-B*m-U*v-$*w,i},cn.add=function(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i[2]=n[2]+s[2],i[3]=n[3]+s[3],i[4]=n[4]+s[4],i[5]=n[5]+s[5],i[6]=n[6]+s[6],i[7]=n[7]+s[7],i},cn.multiply=nc,cn.scale=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3]*s,i[4]=n[4]*s,i[5]=n[5]*s,i[6]=n[6]*s,i[7]=n[7]*s,i},cn.lerp=function(i,n,s,u){var h=1-u;return od(n,s)<0&&(u=-u),i[0]=n[0]*h+s[0]*u,i[1]=n[1]*h+s[1]*u,i[2]=n[2]*h+s[2]*u,i[3]=n[3]*h+s[3]*u,i[4]=n[4]*h+s[4]*u,i[5]=n[5]*h+s[5]*u,i[6]=n[6]*h+s[6]*u,i[7]=n[7]*h+s[7]*u,i},cn.invert=function(i,n){var s=Yu(n);return i[0]=-n[0]/s,i[1]=-n[1]/s,i[2]=-n[2]/s,i[3]=n[3]/s,i[4]=-n[4]/s,i[5]=-n[5]/s,i[6]=-n[6]/s,i[7]=n[7]/s,i},cn.conjugate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=n[3],i[4]=-n[4],i[5]=-n[5],i[6]=-n[6],i[7]=n[7],i},cn.normalize=function(i,n){var s=Yu(n);if(s>0){s=Math.sqrt(s);var u=n[0]/s,h=n[1]/s,p=n[2]/s,m=n[3]/s,v=n[4],w=n[5],E=n[6],A=n[7],P=u*v+h*w+p*E+m*A;i[0]=u,i[1]=h,i[2]=p,i[3]=m,i[4]=(v-u*P)/s,i[5]=(w-h*P)/s,i[6]=(E-p*P)/s,i[7]=(A-m*P)/s}return i},cn.str=function(i){return"quat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+")"},cn.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]},cn.equals=function(i,n){var s=i[0],u=i[1],h=i[2],p=i[3],m=i[4],v=i[5],w=i[6],E=i[7],A=n[0],P=n[1],M=n[2],z=n[3],B=n[4],U=n[5],$=n[6],Y=n[7];return Math.abs(s-A)<=vr.EPSILON*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(u-P)<=vr.EPSILON*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(h-M)<=vr.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(p-z)<=vr.EPSILON*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(m-B)<=vr.EPSILON*Math.max(1,Math.abs(m),Math.abs(B))&&Math.abs(v-U)<=vr.EPSILON*Math.max(1,Math.abs(v),Math.abs(U))&&Math.abs(w-$)<=vr.EPSILON*Math.max(1,Math.abs(w),Math.abs($))&&Math.abs(E-Y)<=vr.EPSILON*Math.max(1,Math.abs(E),Math.abs(Y))},cn.sqrLen=cn.squaredLength=cn.len=cn.length=cn.dot=cn.mul=cn.setReal=cn.getReal=void 0;var vr=Ki(we),dr=Ki(St),xi=Ki(Zt);function bi(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(bi=function(u){return u?s:n})(i)}function Ki(i,n){if(i&&i.__esModule)return i;if(i===null||ei(i)!=="object"&&typeof i!="function")return{default:i};var s=bi(n);if(s&&s.has(i))return s.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,s&&s.set(i,u),u}function Ps(i,n,s){var u=.5*s[0],h=.5*s[1],p=.5*s[2],m=n[0],v=n[1],w=n[2],E=n[3];return i[0]=m,i[1]=v,i[2]=w,i[3]=E,i[4]=u*E+h*w-p*v,i[5]=h*E+p*m-u*w,i[6]=p*E+u*v-h*m,i[7]=-u*m-h*v-p*w,i}function Ws(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i}function nc(i,n,s){var u=n[0],h=n[1],p=n[2],m=n[3],v=s[4],w=s[5],E=s[6],A=s[7],P=n[4],M=n[5],z=n[6],B=n[7],U=s[0],$=s[1],Y=s[2],fe=s[3];return i[0]=u*fe+m*U+h*Y-p*$,i[1]=h*fe+m*$+p*U-u*Y,i[2]=p*fe+m*Y+u*$-h*U,i[3]=m*fe-u*U-h*$-p*Y,i[4]=u*A+m*v+h*E-p*w+P*fe+B*U+M*Y-z*$,i[5]=h*A+m*w+p*v-u*E+M*fe+B*$+z*U-P*Y,i[6]=p*A+m*E+u*w-h*v+z*fe+B*Y+P*$-M*U,i[7]=m*A-u*v-h*w-p*E+B*fe-P*U-M*$-z*Y,i}cn.getReal=dr.copy,cn.setReal=dr.copy,cn.mul=nc;var od=dr.dot;cn.dot=od;var ad=dr.length;cn.length=ad,cn.len=ad;var Yu=dr.squaredLength;cn.squaredLength=Yu,cn.sqrLen=Yu;var zn={};function Uo(i){return Uo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Uo(i)}Object.defineProperty(zn,"__esModule",{value:!0}),zn.create=ld,zn.clone=function(i){var n=new sa.ARRAY_TYPE(2);return n[0]=i[0],n[1]=i[1],n},zn.fromValues=function(i,n){var s=new sa.ARRAY_TYPE(2);return s[0]=i,s[1]=n,s},zn.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i},zn.set=function(i,n,s){return i[0]=n,i[1]=s,i},zn.add=function(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i},zn.subtract=di,zn.multiply=Wc,zn.divide=rc,zn.ceil=function(i,n){return i[0]=Math.ceil(n[0]),i[1]=Math.ceil(n[1]),i},zn.floor=function(i,n){return i[0]=Math.floor(n[0]),i[1]=Math.floor(n[1]),i},zn.min=function(i,n,s){return i[0]=Math.min(n[0],s[0]),i[1]=Math.min(n[1],s[1]),i},zn.max=function(i,n,s){return i[0]=Math.max(n[0],s[0]),i[1]=Math.max(n[1],s[1]),i},zn.round=function(i,n){return i[0]=Math.round(n[0]),i[1]=Math.round(n[1]),i},zn.scale=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i},zn.scaleAndAdd=function(i,n,s,u){return i[0]=n[0]+s[0]*u,i[1]=n[1]+s[1]*u,i},zn.distance=ic,zn.squaredDistance=tp,zn.length=Hc,zn.squaredLength=Qu,zn.negate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i},zn.inverse=function(i,n){return i[0]=1/n[0],i[1]=1/n[1],i},zn.normalize=function(i,n){var s=n[0],u=n[1],h=s*s+u*u;return h>0&&(h=1/Math.sqrt(h)),i[0]=n[0]*h,i[1]=n[1]*h,i},zn.dot=function(i,n){return i[0]*n[0]+i[1]*n[1]},zn.cross=function(i,n,s){var u=n[0]*s[1]-n[1]*s[0];return i[0]=i[1]=0,i[2]=u,i},zn.lerp=function(i,n,s,u){var h=n[0],p=n[1];return i[0]=h+u*(s[0]-h),i[1]=p+u*(s[1]-p),i},zn.random=function(i,n){n=n||1;var s=2*sa.RANDOM()*Math.PI;return i[0]=Math.cos(s)*n,i[1]=Math.sin(s)*n,i},zn.transformMat2=function(i,n,s){var u=n[0],h=n[1];return i[0]=s[0]*u+s[2]*h,i[1]=s[1]*u+s[3]*h,i},zn.transformMat2d=function(i,n,s){var u=n[0],h=n[1];return i[0]=s[0]*u+s[2]*h+s[4],i[1]=s[1]*u+s[3]*h+s[5],i},zn.transformMat3=function(i,n,s){var u=n[0],h=n[1];return i[0]=s[0]*u+s[3]*h+s[6],i[1]=s[1]*u+s[4]*h+s[7],i},zn.transformMat4=function(i,n,s){var u=n[0],h=n[1];return i[0]=s[0]*u+s[4]*h+s[12],i[1]=s[1]*u+s[5]*h+s[13],i},zn.rotate=function(i,n,s,u){var h=n[0]-s[0],p=n[1]-s[1],m=Math.sin(u),v=Math.cos(u);return i[0]=h*v-p*m+s[0],i[1]=h*m+p*v+s[1],i},zn.angle=function(i,n){var s=i[0],u=i[1],h=n[0],p=n[1],m=Math.sqrt(s*s+u*u)*Math.sqrt(h*h+p*p);return Math.acos(Math.min(Math.max(m&&(s*h+u*p)/m,-1),1))},zn.zero=function(i){return i[0]=0,i[1]=0,i},zn.str=function(i){return"vec2("+i[0]+", "+i[1]+")"},zn.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]},zn.equals=function(i,n){var s=i[0],u=i[1],h=n[0],p=n[1];return Math.abs(s-h)<=sa.EPSILON*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(u-p)<=sa.EPSILON*Math.max(1,Math.abs(u),Math.abs(p))},zn.forEach=zn.sqrLen=zn.sqrDist=zn.dist=zn.div=zn.mul=zn.sub=zn.len=void 0;var sa=function(i,n){if(i&&i.__esModule)return i;if(i===null||Uo(i)!=="object"&&typeof i!="function")return{default:i};var s=qc(void 0);if(s&&s.has(i))return s.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,s&&s.set(i,u),u}(we);function qc(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(qc=function(u){return u?s:n})(i)}function ld(){var i=new sa.ARRAY_TYPE(2);return sa.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0),i}function di(i,n,s){return i[0]=n[0]-s[0],i[1]=n[1]-s[1],i}function Wc(i,n,s){return i[0]=n[0]*s[0],i[1]=n[1]*s[1],i}function rc(i,n,s){return i[0]=n[0]/s[0],i[1]=n[1]/s[1],i}function ic(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1])}function tp(i,n){var s=n[0]-i[0],u=n[1]-i[1];return s*s+u*u}function Hc(i){return Math.hypot(i[0],i[1])}function Qu(i){var n=i[0],s=i[1];return n*n+s*s}zn.len=Hc,zn.sub=di,zn.mul=Wc,zn.div=rc,zn.dist=ic,zn.sqrDist=tp,zn.sqrLen=Qu;var cd=function(){var i=ld();return function(n,s,u,h,p,m){var v,w;for(s||(s=2),u||(u=0),w=h?Math.min(h*s+u,n.length):n.length,v=u;v<w;v+=s)i[0]=n[v],i[1]=n[v+1],p(i,i,m),n[v]=i[0],n[v+1]=i[1];return n}}();function ud(i){return ud=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ud(i)}zn.forEach=cd,Object.defineProperty(Te,"__esModule",{value:!0}),a.aB=Te.vec4=a.$=Te.vec3=Te.vec2=Te.quat2=a.aw=Te.quat=a.ae=Te.mat4=a.bE=Te.mat3=Te.mat2d=a.aD=Te.mat2=Te.glMatrix=void 0;var ag=Po(we);Te.glMatrix=ag;var Zc=Po(be);a.aD=Te.mat2=Zc;var Co=Po(Pt);Te.mat2d=Co;var fr=Po(Vt);a.bE=Te.mat3=fr;var lg=Po(Zt);a.ae=Te.mat4=lg;var cg=Po(St);a.aw=Te.quat=cg;var Xc=Po(cn);Te.quat2=Xc;var ug=Po(zn);Te.vec2=ug;var i0=Po(Ct);a.$=Te.vec3=i0;var np=Po(Kt);function Vo(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(Vo=function(u){return u?s:n})(i)}function Po(i,n){if(i&&i.__esModule)return i;if(i===null||ud(i)!=="object"&&typeof i!="function")return{default:i};var s=Vo(n);if(s&&s.has(i))return s.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,s&&s.set(i,u),u}a.aB=Te.vec4=np;var hg=Kc;function Kc(i,n,s,u){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=n,this.p2x=s,this.p2y=u}Kc.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,n){if(n===void 0&&(n=1e-6),i<0)return 0;if(i>1)return 1;for(var s=i,u=0;u<8;u++){var h=this.sampleCurveX(s)-i;if(Math.abs(h)<n)return s;var p=this.sampleCurveDerivativeX(s);if(Math.abs(p)<1e-6)break;s-=h/p}var m=0,v=1;for(s=i,u=0;u<20&&(h=this.sampleCurveX(s),!(Math.abs(h-i)<n));u++)i>h?m=s:v=s,s=.5*(v-m)+m;return s},solve:function(i,n){return this.sampleCurveY(this.solveCurveX(i,n))}};var Yc=pe(hg),Qc=oa;function oa(i,n){this.x=i,this.y=n}oa.prototype={clone:function(){return new oa(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,n){return this.clone()._rotateAround(i,n)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var n=i.x-this.x,s=i.y-this.y;return n*n+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,n){return Math.atan2(this.x*n-this.y*i,this.x*i+this.y*n)},_matMult:function(i){var n=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=n,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var n=Math.cos(i),s=Math.sin(i),u=s*this.x+n*this.y;return this.x=n*this.x-s*this.y,this.y=u,this},_rotateAround:function(i,n){var s=Math.cos(i),u=Math.sin(i),h=n.y+u*(this.x-n.x)+s*(this.y-n.y);return this.x=n.x+s*(this.x-n.x)-u*(this.y-n.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},oa.convert=function(i){return i instanceof oa?i:Array.isArray(i)?new oa(i[0],i[1]):i};var Dt=pe(Qc);function sc(i,n){if(Array.isArray(i)){if(!Array.isArray(n)||i.length!==n.length)return!1;for(let s=0;s<i.length;s++)if(!sc(i[s],n[s]))return!1;return!0}if(typeof i=="object"&&i!==null&&n!==null){if(typeof n!="object"||Object.keys(i).length!==Object.keys(n).length)return!1;for(const s in i)if(!sc(i[s],n[s]))return!1;return!0}return i===n}const hd=Math.PI/180,fi=180/Math.PI;function sr(i){return i*hd}function io(i){return i*fi}const Jc=[[0,0],[1,0],[1,1],[0,1]];function Ju(i){if(i<=0)return 0;if(i>=1)return 1;const n=i*i,s=n*i;return 4*(i<.5?s:3*(i-n)+s-.75)}function eh(i,n,s,u){const h=new Yc(i,n,s,u);return function(p){return h.solve(p)}}const yo=eh(.25,.1,.25,1);function Kn(i,n,s){return Math.min(s,Math.max(n,i))}function aa(i,n,s){return(s=Kn((s-i)/(n-i),0,1))*s*(3-2*s)}function oc(i,n,s){const u=s-n,h=((i-n)%u+u)%u+n;return h===n?s:h}function th(i,n,s){if(!i.length)return s(null,[]);let u=i.length;const h=new Array(i.length);let p=null;i.forEach((m,v)=>{n(m,(w,E)=>{w&&(p=w),h[v]=E,--u==0&&s(p,h)})})}function ac(i){const n=[];for(const s in i)n.push(i[s]);return n}function Rs(i,...n){for(const s of n)for(const u in s)i[u]=s[u];return i}let dd=1;function lc(){return dd++}function cc(){return function i(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Ia(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function rp(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function nh(i,n){i.forEach(s=>{n[s]&&(n[s]=n[s].bind(n))})}function Xa(i,n){return i.indexOf(n,i.length-n.length)!==-1}function eu(i,n,s){const u={};for(const h in i)u[h]=n.call(this,i[h],h,i);return u}function Ms(i,n,s){const u={};for(const h in i)n.call(this,i[h],h,i)&&(u[h]=i[h]);return u}function Fs(i){return Array.isArray(i)?i.map(Fs):typeof i=="object"&&i?eu(i,Fs):i}const vs={};function Ii(i){vs[i]||(typeof console<"u"&&console.warn(i),vs[i]=!0)}function la(i,n,s){return(s.y-i.y)*(n.x-i.x)>(n.y-i.y)*(s.x-i.x)}function dg(i){let n=0;for(let s,u,h=0,p=i.length,m=p-1;h<p;m=h++)s=i[h],u=i[m],n+=(u.x-s.x)*(s.y+u.y);return n}function uc([i,n,s]){const u=sr(n+90),h=sr(s);return{x:i*Math.cos(u)*Math.sin(h),y:i*Math.sin(u)*Math.sin(h),z:i*Math.cos(h),azimuthal:n,polar:s}}function $o(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function tu(i){const n={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,u,h,p)=>{const m=h||p;return n[u]=!m||m.toLowerCase(),""}),n["max-age"]){const s=parseInt(n["max-age"],10);isNaN(s)?delete n["max-age"]:n["max-age"]=s}return n}let fd,nu,Ka,Sl,hs,ru,iu=null;function Ya(i){try{const n=self[i];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}}function R(i,n){return[i[4*n],i[4*n+1],i[4*n+2],i[4*n+3]]}function H(i,n,s,u){for(;n<s;){const h=n+s>>1;i[h]<u?n=h+1:s=h}return n}function ue(i,n,s,u){for(;n<s;){const h=n+s>>1;i[h]<=u?n=h+1:s=h}return n}function Me(i){return i>0?1/(1.001-i):1+i}function ct(i){return i>0?1-1/(1.001-i):-i}function Tt(){return fd==null&&(fd=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),fd}const rn={now:()=>Sl!==void 0?Sl:performance.now(),setNow(i){Sl=i},restoreNow(){Sl=void 0},frame(i){const n=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(i,n=0){const{width:s,height:u}=i;hs||(hs=document.createElement("canvas"));const h=hs.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(s>hs.width||u>hs.height)&&(hs.width=s,hs.height=u),h.clearRect(-n,-n,s+2*n,u+2*n),h.drawImage(i,0,0,s,u),h.getImageData(-n,-n,s+2*n,u+2*n)},resolveURL:i=>(nu||(nu=document.createElement("a")),nu.href=i,nu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ka==null&&(Ka=window.matchMedia("(prefers-reduced-motion: reduce)")),Ka.matches)},hasCanvasFingerprintNoise(){if(ru!==void 0)return ru;if(!Tt())return ru=!1,!1;const i=new OffscreenCanvas(85,1),n=i.getContext("2d",{willReadFrequently:!0});let s=0;for(let h=0;h<i.width;++h)n.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,n.fillRect(h,0,1,1);const u=n.getImageData(0,0,i.width,i.height);s=0;for(let h=0;h<u.data.length;++h)if(h%4!=3&&s++!==u.data[h])return ru=!0,!0;return ru=!1,!1}};function ui(i,n){const s=i.indexOf("?");if(s<0)return`${i}?${new URLSearchParams(n).toString()}`;const u=new URLSearchParams(i.slice(s));for(const h in n)u.set(h,n[h]);return`${i.slice(0,s)}?${u.toString()}`}function xs(i,n={persistentParams:[]}){const s=i.indexOf("?");if(s<0)return i;const u=new URLSearchParams,h=new URLSearchParams(i.slice(s));for(const m of n.persistentParams){const v=h.get(m);v&&u.set(m,v)}const p=u.toString();return`${i.slice(0,s)}${p.length>0?`?${p}`:""}`}const Hr="mapbox-tiles";let ks=500,Ds=50;const hc=["language","worldview","jobid"];let ds,dc;function pd(){try{return caches}catch{}}function ip(){const i=pd();i&&!ds&&(ds=i.open(Hr))}let fg=1/0;const pg={supported:!1,testSupport:function(i){!mg&&md&&(Ab?s0(i):sp=i)}};let sp,md,mg=!1,Ab=!1;const Cb=typeof self<"u"?self:{};function s0(i){const n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,md),i.isContextLost())return;pg.supported=!0}catch{}i.deleteTexture(n),mg=!0}Cb.document&&(md=Cb.document.createElement("img"),md.onload=function(){sp&&s0(sp),sp=null,Ab=!0},md.onerror=function(){mg=!0,sp=null},md.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const op={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(op);class gg extends Error{constructor(n,s,u){s===401&&F(u)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=s,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const o0=$o()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Il=function(i,n){if(!(/^file:/.test(s=i.url)||/^file:/.test(o0())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,h){const p=new AbortController,m=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:o0(),referrerPolicy:u.referrerPolicy,signal:p.signal});let v=!1,w=!1;const E=(A=m.url).indexOf("sku=")>0&&F(A);var A;u.type==="json"&&m.headers.set("Accept","application/json");const P=(z,B,U)=>{if(w)return;if(z&&z.message!=="SecurityError"&&Ii(z.toString()),B&&U)return M(B);const $=Date.now();fetch(m).then(Y=>{if(Y.ok){const fe=E?Y.clone():null;return M(Y,fe,$)}return h(new gg(Y.statusText,Y.status,u.url))}).catch(Y=>{Y.name!=="AbortError"&&h(new Error(`${Y.message} ${u.url}`))})},M=(z,B,U)=>{(u.type==="arrayBuffer"?z.arrayBuffer():u.type==="json"?z.json():z.text()).then($=>{w||(B&&U&&function(Y,fe,he){if(ip(),!ds)return;const me=tu(fe.headers.get("Cache-Control")||"");if(me["no-store"])return;const Ae={status:fe.status,statusText:fe.statusText,headers:new Headers};fe.headers.forEach((Ve,He)=>Ae.headers.set(He,Ve)),me["max-age"]&&Ae.headers.set("Expires",new Date(he+1e3*me["max-age"]).toUTCString());const Ce=Ae.headers.get("Expires");if(!Ce||new Date(Ce).getTime()-he<42e4)return;let Le=xs(Y.url,{persistentParams:hc});if(fe.status===206){const Ve=Y.headers.get("Range");if(!Ve)return;Ae.status=200,Le=ui(Le,{range:Ve})}(function(Ve,He){if(dc===void 0)try{new Response(new ReadableStream),dc=!0}catch{dc=!1}dc?He(Ve.body):Ve.blob().then(He)})(fe,Ve=>{const He=new Response((et=fe.status)!==200&&et!==404&&[101,103,204,205,304].includes(et)?null:Ve,Ae);var et;ip(),ds&&ds.then(Ze=>Ze.put(Le,He)).catch(Ze=>Ii(Ze.message))})}(m,B,U),v=!0,h(null,$,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch($=>{w||h(new Error($.message))})};return E?function(z,B){if(ip(),!ds)return B(null);ds.then(U=>{let $=xs(z.url,{persistentParams:hc});const Y=z.headers.get("Range");Y&&($=ui($,{range:Y})),U.match($).then(fe=>{const he=function(me){if(!me)return!1;const Ae=new Date(me.headers.get("Expires")||0),Ce=tu(me.headers.get("Cache-Control")||"");return Ae>Date.now()&&!Ce["no-cache"]}(fe);U.delete($),he&&U.put($,fe.clone()),B(null,fe,he)}).catch(B)}).catch(B)}(m,P):P(null,null),{cancel:()=>{w=!0,v||p.abort()}}}(i,n);if($o()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,n,void 0,!0)}var s;return function(u,h){const p=new XMLHttpRequest;p.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const m in u.headers)p.setRequestHeader(m,u.headers[m]);return u.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=u.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let m=p.response;if(u.type==="json")try{m=JSON.parse(p.response)}catch(v){return h(v)}h(null,m,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new gg(p.statusText,p.status,u.url))},p.send(u.body),{cancel:()=>p.abort()}}(i,n)},rh=function(i,n){return Il(Rs(i,{type:"arrayBuffer"}),n)};function lC(i){const n=document.createElement("a");return n.href=i,n.protocol===location.protocol&&n.host===location.host}const Pb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ap,gd;ap=[],gd=0;const lp=function(i,n){if(pg.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),gd>=O.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:i,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return ap.push(p),p}gd++;let s=!1;const u=()=>{if(!s)for(s=!0,gd--;ap.length&&gd<O.MAX_PARALLEL_IMAGE_REQUESTS;){const p=ap.shift(),{requestParameters:m,callback:v,cancelled:w}=p;w||(p.cancel=lp(m,v).cancel)}},h=rh(i,(p,m,v,w)=>{u(),p?n(p):m&&(self.createImageBitmap?function(E,A){const P=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(P).then(M=>{A(null,M)}).catch(M=>{A(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(E,A)=>n(E,A,v,w)):function(E,A){const P=new Image;P.onload=()=>{A(null,P),URL.revokeObjectURL(P.src),P.onload=null,requestAnimationFrame(()=>{P.src=Pb})},P.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?URL.createObjectURL(M):Pb}(m,(E,A)=>n(E,A,v,w)))});return{cancel:()=>{h.cancel(),u()}}},a0="01",l0="NO_ACCESS_TOKEN",cC=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Aa(i){const n=i.match(cC);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function ih(i){const n=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${n}`}const c0="mapbox.eventData";function Rb(i){if(!i)return null;const n=i.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(n[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class sh{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const s=Rb(O.ACCESS_TOKEN);let u="";return u=s&&s.u?btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(h,p)=>String.fromCharCode(+("0x"+p)))):O.ACCESS_TOKEN||"",n?`${c0}.${n}:${u}`:`${c0}:${u}`}fetchEventData(){const n=Ya("localStorage"),s=this.getStorageKey(),u=this.getStorageKey("uuid");if(n)try{const h=localStorage.getItem(s);h&&(this.eventData=JSON.parse(h));const p=localStorage.getItem(u);p&&(this.anonId=p)}catch{Ii("Unable to read from LocalStorage")}}saveEventData(){const n=Ya("localStorage"),s=this.getStorageKey(),u=this.getStorageKey("uuid"),h=this.anonId;if(n&&h)try{localStorage.setItem(u,h),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{Ii("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,s,u,h){if(!O.EVENTS_URL)return;const p=Aa(O.EVENTS_URL);p.params.push(`access_token=${h||O.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(n).toISOString()},v=s?Rs(m,s):m,w={url:ih(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=function(E,A){return Il(Rs(E,{method:"POST"}),A)}(w,E=>{this.pendingRequest=null,u(E),this.saveEventData(),this.processRequests(h)})}queueRequest(n,s){this.queue.push(n),this.processRequests(s)}}const Mb=new class extends sh{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,n){O.EVENTS_URL&&O.ACCESS_TOKEN&&Array.isArray(i)&&i.some(s=>Z(s)||F(s))&&this.queueRequest(Date.now(),n)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=Rb(O.ACCESS_TOKEN),s=n?n.u:O.ACCESS_TOKEN;let u=s!==this.eventData.tokenU;rp(this.anonId)||(this.anonId=cc(),u=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),m=new Date(h),v=(h-this.eventData.lastSuccess)/864e5;u=u||v>=1||v<-1||p.getDate()!==m.getDate()}else u=!0;u?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:a0,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=h,this.eventData.tokenU=s)},i):this.processRequests()}},u0=Mb.postTurnstileEvent.bind(Mb),_d=new class extends sh{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,n,s,u){this.skuToken=n,this.errorCb=u,O.EVENTS_URL&&(s||O.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},s):this.errorCb(new Error(l0)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:s}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),rp(this.anonId)||(this.anonId=cc()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:a0,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):n&&(this.success[n]=!0)},i))}remove(){this.errorCb=null}},kb=_d.postMapLoadEvent.bind(_d),cp=new class extends sh{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(i){let n=this.mapInstanceIdMap.get(i);return n||(n=cc(),this.mapInstanceIdMap.set(i,n)),n}getEventId(i){const n=this.eventIdPerMapInstanceMap.get(i)||0;return this.eventIdPerMapInstanceMap.set(i,n+1),n}postStyleLoadEvent(i,n){const{map:s,style:u,importedStyles:h}=n;if(!O.EVENTS_URL||!i&&!O.ACCESS_TOKEN)return;const p=this.getMapInstanceId(s),m={mapInstanceId:p,eventId:this.getEventId(p),style:u};h.length&&(m.importedStyles=h),this.queueRequest({timestamp:Date.now(),payload:m},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:s}=this.queue.shift();this.postEvent(n,s,()=>{},i)}},Db=cp.postStyleLoadEvent.bind(cp),Ob=new class extends sh{constructor(){super("gljs.performance")}postPerformanceEvent(i,n){O.EVENTS_URL&&(i||O.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:s}=this.queue.shift(),u=function(h){const p=performance.getEntriesByType("resource"),m=performance.getEntriesByType("mark"),v=function(z){const B={};if(z){for(const U in z)if(U!=="other")for(const $ of z[U]){const Y=`${U}ResolveRangeMin`,fe=`${U}ResolveRangeMax`,he=`${U}RequestCount`,me=`${U}RequestCachedCount`;B[Y]=Math.min(B[Y]||1/0,$.startTime),B[fe]=Math.max(B[fe]||-1/0,$.responseEnd);const Ae=Ce=>{B[Ce]===void 0&&(B[Ce]=0),++B[Ce]};$.transferSize!==void 0&&$.transferSize===0&&Ae(me),Ae(he)}}return B}(function(z,B){const U={};if(z)for(const $ of z){const Y=B($);U[Y]===void 0&&(U[Y]=[]),U[Y].push($)}return U}(p,K)),w=window.devicePixelRatio,E=navigator.connection||navigator.mozConnection||navigator.webkitConnection,A=E?E.effectiveType:void 0,P={counters:[],metadata:[],attributes:[]},M=(z,B,U)=>{U!=null&&z.push({name:B,value:U.toString()})};for(const z in v)M(P.counters,z,v[z]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(M(P.counters,"interactionRangeMin",h.interactionRange[0]),M(P.counters,"interactionRangeMax",h.interactionRange[1])),m)for(const z of Object.keys(W)){const B=W[z],U=m.find($=>$.name===B);U&&M(P.counters,B,U.startTime)}return M(P.counters,"visibilityHidden",h.visibilityHidden),M(P.attributes,"style",function(z){if(z)for(const B of z){const U=B.name.split("?")[0];if(se(U)){const $=U.split("/").slice(-2);if($.length===2)return`mapbox://styles/${$[0]}/${$[1]}`}}}(p)),M(P.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),M(P.attributes,"fogEnabled",h.fogEnabled?"true":"false"),M(P.attributes,"projection",h.projection),M(P.attributes,"zoom",h.zoom),M(P.metadata,"devicePixelRatio",w),M(P.metadata,"connectionEffectiveType",A),M(P.metadata,"navigatorUserAgent",navigator.userAgent),M(P.metadata,"screenWidth",window.screen.width),M(P.metadata,"screenHeight",window.screen.height),M(P.metadata,"windowWidth",window.innerWidth),M(P.metadata,"windowHeight",window.innerHeight),M(P.metadata,"mapWidth",h.width/w),M(P.metadata,"mapHeight",h.height/w),M(P.metadata,"webglRenderer",h.renderer),M(P.metadata,"webglVendor",h.vendor),M(P.metadata,"sdkVersion",I),M(P.metadata,"sdkIdentifier","mapbox-gl-js"),P}(s);for(const h of u.metadata);for(const h of u.counters);for(const h of u.attributes);this.postEvent(n,u,()=>{},i)}},uC=Ob.postPerformanceEvent.bind(Ob),up=new class extends sh{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,n,s,u){if(!O.API_URL||!O.SESSION_PATH)return;const h=Aa(O.API_URL+O.SESSION_PATH);h.params.push(`sku=${n||""}`),h.params.push(`access_token=${u||O.ACCESS_TOKEN||""}`);const p={url:ih(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,v){return Il(Rs(m,{method:"GET"}),v)}(p,m=>{this.pendingRequest=null,s(m),this.saveEventData(),this.processRequests(u)})}getSessionAPI(i,n,s,u){this.skuToken=n,this.errorCb=u,O.SESSION_PATH&&O.API_URL&&(s||O.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},s):this.errorCb(new Error(l0)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:s}=this.queue.shift();n&&this.success[n]||this.getSession(s,this.skuToken,u=>{u?this.errorCb(u):n&&(this.success[n]=!0)},i)}remove(){this.errorCb=null}},h0=up.getSessionAPI.bind(up),hp=new Set;var oh={exports:{}},yd={exports:function(i,n){var s,u,h,p,m,v,w,E;for(u=i.length-(s=3&i.length),h=n,m=3432918353,v=461845907,E=0;E<u;)w=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,h=27492+(65535&(p=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(w=0,s){case 3:w^=(255&i.charCodeAt(E+2))<<16;case 2:w^=(255&i.charCodeAt(E+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&i.charCodeAt(E)))*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}},hC={exports:function(i,n){for(var s,u=i.length,h=n^u,p=0;u>=4;)s=1540483477*(65535&(s=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(s>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),u-=4,++p;switch(u){case 3:h^=(255&i.charCodeAt(p+2))<<16;case 2:h^=(255&i.charCodeAt(p+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(p)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}},Lb=yd.exports,dC=hC.exports;oh.exports=Lb,oh.exports.murmur3=Lb,oh.exports.murmur2=dC;var _g=pe(oh.exports);class Al{constructor(n,...s){Rs(this,s[0]||{}),this.type=n}}class dp extends Al{constructor(n,s={}){super("error",Rs({error:n},s))}}function yg(i,n,s){s[i]&&s[i].indexOf(n)!==-1||(s[i]=s[i]||[],s[i].push(n))}function d0(i,n,s){if(s&&s[i]){const u=s[i].indexOf(n);u!==-1&&s[i].splice(u,1)}}class ah{on(n,s){return this._listeners=this._listeners||{},yg(n,s,this._listeners),this}off(n,s){return d0(n,s,this._listeners),d0(n,s,this._oneTimeListeners),this}once(n,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},yg(n,s,this._oneTimeListeners),this):new Promise(u=>this.once(n,u))}fire(n,s){const u=typeof n=="string"?new Al(n,s):n,h=u.type;if(this.listens(h)){u.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const w of p)w.call(this,u);const m=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const w of m)d0(h,w,this._oneTimeListeners),w.call(this,u);const v=this._eventedParent;v&&(Rs(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(u))}else u instanceof dp&&console.error(u.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,s){return this._eventedParent=n,this._eventedParentData=s,this}}a.G=void 0;var zb={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function vg(i){return(i=Math.round(i))<0?0:i>255?255:i}function f0(i){return vg(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function xg(i){return(n=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:n>1?1:n;var n}function p0(i,n,s){return s<0?s+=1:s>1&&(s-=1),6*s<1?i+(n-i)*s*6:2*s<1?n:3*s<2?i+(n-i)*(2/3-s)*6:i}try{a.G={}.parseCSSColor=function(i){var n,s=i.replace(/ /g,"").toLowerCase();if(s in zb)return zb[s].slice();if(s[0]==="#")return s.length===4?(n=parseInt(s.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:s.length===7&&(n=parseInt(s.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var u=s.indexOf("("),h=s.indexOf(")");if(u!==-1&&h+1===s.length){var p=s.substr(0,u),m=s.substr(u+1,h-(u+1)).split(","),v=1;switch(p){case"rgba":if(m.length!==4)return null;v=xg(m.pop());case"rgb":return m.length!==3?null:[f0(m[0]),f0(m[1]),f0(m[2]),v];case"hsla":if(m.length!==4)return null;v=xg(m.pop());case"hsl":if(m.length!==3)return null;var w=(parseFloat(m[0])%360+360)%360/360,E=xg(m[1]),A=xg(m[2]),P=A<=.5?A*(E+1):A+E-A*E,M=2*A-P;return[vg(255*p0(M,P,w+1/3)),vg(255*p0(M,P,w)),vg(255*p0(M,P,w-1/3)),v];default:return null}}return null}}catch{}class Ar{constructor(n,s,u,h=1){this.r=n,this.g=s,this.b=u,this.a=h}static parse(n){if(!n)return;if(n instanceof Ar)return n;if(typeof n!="string")return;const s=a.G(n);return s?new Ar(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[n,s,u,h]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(n)},${Math.round(s)},${Math.round(u)},${h})`}toRenderColor(n){const{r:s,g:u,b:h,a:p}=this;return new fC(n,s,u,h,p)}}class fC{constructor(n,s,u,h,p){if(n){const m=n.image.height,v=m*m;s=p===0?0:s/p*(m-1),u=p===0?0:u/p*(m-1),h=p===0?0:h/p*(m-1);const w=Math.floor(s),E=Math.floor(u),A=Math.floor(h),P=Math.ceil(s),M=Math.ceil(u),z=Math.ceil(h),B=s-w,U=u-E,$=h-A,Y=n.image.data,fe=4*(w+E*v+A*m),he=4*(w+E*v+z*m),me=4*(w+M*v+A*m),Ae=4*(w+M*v+z*m),Ce=4*(P+E*v+A*m),Le=4*(P+E*v+z*m),Ve=4*(P+M*v+A*m),He=4*(P+M*v+z*m);if(fe<0||He>=Y.length)throw new Error("out of range");this.r=En(En(En(Y[fe],Y[he],$),En(Y[me],Y[Ae],$),U),En(En(Y[Ce],Y[Le],$),En(Y[Ve],Y[He],$),U),B)/255*p,this.g=En(En(En(Y[fe+1],Y[he+1],$),En(Y[me+1],Y[Ae+1],$),U),En(En(Y[Ce+1],Y[Le+1],$),En(Y[Ve+1],Y[He+1],$),U),B)/255*p,this.b=En(En(En(Y[fe+2],Y[he+2],$),En(Y[me+2],Y[Ae+2],$),U),En(En(Y[Ce+2],Y[Le+2],$),En(Y[Ve+2],Y[He+2],$),U),B)/255*p,this.a=p}else this.r=s,this.g=u,this.b=h,this.a=p}toArray(){const{r:n,g:s,b:u,a:h}=this;return h===0?[0,0,0,0]:[255*n/h,255*s/h,255*u/h,h]}toArray01(){const{r:n,g:s,b:u,a:h}=this;return h===0?[0,0,0,0]:[n/h,s/h,u/h,h]}toArray01Scaled(n){const{r:s,g:u,b:h,a:p}=this;return p===0?[0,0,0]:[s/p*n,u/p*n,h/p*n]}toArray01PremultipliedAlpha(){const{r:n,g:s,b:u,a:h}=this;return[n,s,u,h]}toArray01Linear(){const{r:n,g:s,b:u,a:h}=this;return h===0?[0,0,0,0]:[Math.pow(n/h,2.2),Math.pow(s/h,2.2),Math.pow(u/h,2.2),h]}}function En(i,n,s){return i*(1-s)+n*s}function m0(i,n,s){return i.map((u,h)=>En(u,n[h],s))}Ar.black=new Ar(0,0,0,1),Ar.white=new Ar(1,1,1,1),Ar.transparent=new Ar(0,0,0,0),Ar.red=new Ar(1,0,0,1),Ar.blue=new Ar(0,0,1,1);var fp=Object.freeze({__proto__:null,array:m0,color:function(i,n,s){return new Ar(En(i.r,n.r,s),En(i.g,n.g,s),En(i.b,n.b,s),En(i.a,n.a,s))},number:En});function vd(i,...n){for(const s of n)for(const u in s)i[u]=s[u];return i}class Cl extends Error{constructor(n,s){super(s),this.message=s,this.key=n}}class g0{constructor(n,s=[]){this.parent=n,this.bindings={};for(const[u,h]of s)this.bindings[u]=h}concat(n){return new g0(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const ca={kind:"null"},tn={kind:"number"},xr={kind:"string"},Mr={kind:"boolean"},Ca={kind:"color"},xd={kind:"object"},Er={kind:"value"},bg={kind:"collator"},bd={kind:"formatted"},lh={kind:"resolvedImage"};function so(i,n){return{kind:"array",itemType:i,N:n}}function Ni(i){if(i.kind==="array"){const n=Ni(i.itemType);return typeof i.N=="number"?`array<${n}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${n}>`}return i.kind}const _0=[ca,tn,xr,Mr,Ca,bd,xd,so(Er),lh];function pp(i,n){if(n.kind==="error")return null;if(i.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!pp(i.itemType,n.itemType))&&(typeof i.N!="number"||i.N===n.N))return null}else{if(i.kind===n.kind)return null;if(i.kind==="value"){for(const s of _0)if(!pp(s,n))return null}}return`Expected ${Ni(i)} but found ${Ni(n)} instead.`}function Pa(i,n){return n.some(s=>s.kind===i.kind)}function mp(i,n){return n.some(s=>s==="null"?i===null:s==="array"?Array.isArray(i):s==="object"?i&&!Array.isArray(i)&&typeof i=="object":s===typeof i)}class wg{constructor(n,s,u){this.sensitivity=n?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,s){return this.collator.compare(n,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Tg{constructor(n,s,u,h,p){this.text=n.normalize?n.normalize():n,this.image=s,this.scale=u,this.fontStack=h,this.textColor=p}}class vo{constructor(n){this.sections=n}static fromString(n){return new vo([new Tg(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.namePrimary.length!==0)}static factory(n){return n instanceof vo?n:vo.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const s of this.sections){if(s.image){n.push(["image",s.image.namePrimary]);continue}n.push(s.text);const u={};s.fontStack&&(u["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(u["font-scale"]=s.scale),s.textColor&&(u["text-color"]=["rgba"].concat(s.textColor.toRenderColor(null).toArray())),n.push(u)}return n}}class ua{constructor(n){this.namePrimary=n.namePrimary,n.nameSecondary&&(this.nameSecondary=n.nameSecondary),this.available=n.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(n,s){return n?new ua({namePrimary:n,nameSecondary:s,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Nb(i,n,s,u){return typeof i=="number"&&i>=0&&i<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof s=="number"&&s>=0&&s<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[i,n,s,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[i,n,s,u]:[i,n,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function wd(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ar||i instanceof wg||i instanceof vo||i instanceof ua)return!0;if(Array.isArray(i)){for(const n of i)if(!wd(n))return!1;return!0}if(typeof i=="object"){for(const n in i)if(!wd(i[n]))return!1;return!0}return!1}function fs(i){if(i===null)return ca;if(typeof i=="string")return xr;if(typeof i=="boolean")return Mr;if(typeof i=="number")return tn;if(i instanceof Ar)return Ca;if(i instanceof wg)return bg;if(i instanceof vo)return bd;if(i instanceof ua)return lh;if(Array.isArray(i)){const n=i.length;let s;for(const u of i){const h=fs(u);if(s){if(s===h)continue;s=Er;break}s=h}return so(s||Er,n)}return xd}function Qa(i){const n=typeof i;return i===null?"":n==="string"||n==="number"||n==="boolean"?String(i):i instanceof Ar||i instanceof vo||i instanceof ua?i.toString():JSON.stringify(i)}class Ja{constructor(n,s){this.type=n,this.value=s}static parse(n,s){if(n.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!wd(n[1]))return s.error("invalid value");const u=n[1];let h=fs(u);const p=s.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new Ja(h,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ar?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof vo?this.value.serialize():this.value}}class bs{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const y0={string:xr,number:tn,boolean:Mr,object:xd};class ha{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");let u,h=1;const p=n[0];if(p==="array"){let v,w;if(n.length>2){const E=n[1];if(typeof E!="string"||!(E in y0)||E==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);v=y0[E],h++}else v=Er;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return s.error('The length argument to "array" must be a positive integer literal',2);w=n[2],h++}u=so(v,w)}else u=y0[p];const m=[];for(;h<n.length;h++){const v=s.parse(n[h],h,Er);if(!v)return null;m.push(v)}return new ha(u,m)}evaluate(n){for(let s=0;s<this.args.length;s++){const u=this.args[s].evaluate(n);if(!pp(this.type,fs(u)))return u;if(s===this.args.length-1)throw new bs(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${Ni(fs(u))} but was expected to be of type ${Ni(this.type)}.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,s=[n.kind];if(n.kind==="array"){const u=n.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){s.push(u.kind);const h=n.N;(typeof h=="number"||this.args.length>1)&&s.push(h)}}return s.concat(this.args.map(u=>u.serialize()))}}class ch{constructor(n){this.type=bd,this.sections=n}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const u=n[1];if(!Array.isArray(u)&&typeof u=="object")return s.error("First argument must be an image or text section.");const h=[];let p=!1;for(let m=1;m<=n.length-1;++m){const v=n[m];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let w=null;if(v["font-scale"]&&(w=s.parse(v["font-scale"],1,tn),!w))return null;let E=null;if(v["text-font"]&&(E=s.parse(v["text-font"],1,so(xr)),!E))return null;let A=null;if(v["text-color"]&&(A=s.parse(v["text-color"],1,Ca),!A))return null;const P=h[h.length-1];P.scale=w,P.font=E,P.textColor=A}else{const w=s.parse(n[m],1,Er);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new ch(h)}evaluate(n){return new vo(this.sections.map(s=>{const u=s.content.evaluate(n);return fs(u)===lh?new Tg("",u,null,null,null):new Tg(Qa(u),null,s.scale?s.scale.evaluate(n):null,s.font?s.font.evaluate(n).join(","):null,s.textColor?s.textColor.evaluate(n):null)}))}eachChild(n){for(const s of this.sections)n(s.content),s.scale&&n(s.scale),s.font&&n(s.font),s.textColor&&n(s.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const s of this.sections){n.push(s.content.serialize());const u={};s.scale&&(u["font-scale"]=s.scale.serialize()),s.font&&(u["text-font"]=s.font.serialize()),s.textColor&&(u["text-color"]=s.textColor.serialize()),n.push(u)}return n}}class fc{constructor(n,s){this.type=lh,this.inputPrimary=n,this.inputSecondary=s}static parse(n,s){if(n.length<2)return s.error("Expected two or more arguments.");const u=s.parse(n[1],1,xr);if(!u)return s.error("No image name provided.");if(n.length===2)return new fc(u);const h=s.parse(n[2],1,xr);return h?new fc(u,h):s.error("Secondary image variant is not a string.")}evaluate(n){const s=ua.fromString(this.inputPrimary.evaluate(n),this.inputSecondary?this.inputSecondary.evaluate(n):void 0);return s&&n.availableImages&&(s.available=n.availableImages.indexOf(s.namePrimary)>-1,s.nameSecondary&&s.available&&n.availableImages&&(s.available=n.availableImages.indexOf(s.nameSecondary)>-1)),s}eachChild(n){n(this.inputPrimary),this.inputSecondary&&n(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function su(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}const pC={"to-boolean":Mr,"to-color":Ca,"to-number":tn,"to-string":xr};class pc{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const u=n[0],h=[];let p=ca;if(u==="to-array"){if(!Array.isArray(n[1]))return null;const m=n[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);p=so(s.expectedType.itemType,m)}else{if(!(m>0&&wd(n[1][0])))return null;p=so(fs(n[1][0]),m)}for(let v=0;v<m;v++){const w=n[1][v];let E;if(su(w)==="array")E=s.parse(w,void 0,p.itemType);else{const A=su(w);if(A!==p.itemType.kind)return s.error(`Expected ${p.itemType.kind} but found ${A}.`);E=s.registry.literal.parse(["literal",w===void 0?null:w],s)}if(!E)return null;h.push(E)}}else{if((u==="to-boolean"||u==="to-string")&&n.length!==2)return s.error("Expected one argument.");p=pC[u];for(let m=1;m<n.length;m++){const v=s.parse(n[m],m,Er);if(!v)return null;h.push(v)}}return new pc(p,h)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let s,u;for(const h of this.args){if(s=h.evaluate(n),u=null,s instanceof Ar)return s;if(typeof s=="string"){const p=n.parseColor(s);if(p)return p}else if(Array.isArray(s)&&(u=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Nb(s[0],s[1],s[2],s[3]),!u))return new Ar(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new bs(u||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const u of this.args){if(s=u.evaluate(n),s===null)return 0;const h=Number(s);if(!isNaN(h))return h}throw new bs(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?vo.fromString(Qa(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?ua.fromString(Qa(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map(s=>s.evaluate(n)):Qa(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ch([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new fc(this.args[0]).serialize();const n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{n.push(s.serialize())}),n}}const mC=["Unknown","Point","LineString","Polygon"];class v0{constructor(n,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?mC[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:u,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*s-n[0])+this.featureDistanceData.bearing[1]*(h*s-n[1])}return 0}parseColor(n){let s=this._parseColorCache[n];return s||(s=this._parseColorCache[n]=Ar.parse(n)),s}getConfig(n){return this.options?this.options.get(n):null}}class Go{constructor(n,s,u,h,p){this.name=n,this.type=s,this._evaluate=u,this.args=h,this._overloadIndex=p}evaluate(n){if(!this._evaluate){const s=Go.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,s){const u=n[0],h=Go.definitions[u];if(!h)return s.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,m=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=[];let w=null,E=-1;for(const[A,P]of m){if(Array.isArray(A)&&A.length!==n.length-1)continue;v.push(A),E++,w=new ew(s.registry,s.path,null,s.scope,void 0,s._scope,s.options);const M=[];let z=!1;for(let B=1;B<n.length;B++){const U=n[B],$=Array.isArray(A)?A[B-1]:A.type,Y=w.parse(U,1+M.length,$);if(!Y){z=!0;break}M.push(Y)}if(!z)if(Array.isArray(A)&&A.length!==M.length)w.error(`Expected ${A.length} arguments, but found ${M.length} instead.`);else{for(let B=0;B<M.length;B++){const U=Array.isArray(A)?A[B]:A.type,$=M[B];w.concat(B+1).checkSubtype(U,$.type)}if(w.errors.length===0)return new Go(u,p,P,M,E)}}if(v.length===1)s.errors.push(...w.errors);else{const A=(v.length?v:m.map(([M])=>M)).map(gC).join(" | "),P=[];for(let M=1;M<n.length;M++){const z=s.parse(n[M],1+P.length);if(!z)return null;P.push(Ni(z.type))}s.error(`Expected arguments of type ${A}, but found (${P.join(", ")}) instead.`)}return null}static register(n,s){Go.definitions=s;for(const u in s)n[u]=Go}}function gC(i){return Array.isArray(i)?`(${i.map(Ni).join(", ")})`:`(${Ni(i.type)}...)`}class gp{constructor(n,s,u){this.type=bg,this.locale=u,this.caseSensitive=n,this.diacriticSensitive=s}static parse(n,s){if(n.length!==2)return s.error("Expected one argument.");const u=n[1];if(typeof u!="object"||Array.isArray(u))return s.error("Collator options argument must be an object.");const h=s.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Mr);if(!h)return null;const p=s.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Mr);if(!p)return null;let m=null;return u.locale&&(m=s.parse(u.locale,1,xr),!m)?null:new gp(h,p,m)}evaluate(n){return new wg(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}function Cr(i,n,s=0,u=i.length-1,h=Fb){for(;u>s;){if(u-s>600){const w=u-s+1,E=n-s+1,A=Math.log(w),P=.5*Math.exp(2*A/3),M=.5*Math.sqrt(A*P*(w-P)/w)*(E-w/2<0?-1:1);Cr(i,n,Math.max(s,Math.floor(n-E*P/w+M)),Math.min(u,Math.floor(n+(w-E)*P/w+M)),h)}const p=i[n];let m=s,v=u;for(Td(i,s,n),h(i[u],p)>0&&Td(i,s,u);m<v;){for(Td(i,m,v),m++,v--;h(i[m],p)<0;)m++;for(;h(i[v],p)>0;)v--}h(i[s],p)===0?Td(i,s,v):(v++,Td(i,v,u)),v<=n&&(s=v+1),n<=v&&(u=v-1)}}function Td(i,n,s){const u=i[n];i[n]=i[s],i[s]=u}function Fb(i,n){return i<n?-1:i>n?1:0}function _C(i){let n=0;for(let s,u,h=0,p=i.length,m=p-1;h<p;m=h++)s=i[h],u=i[m],n+=(u.x-s.x)*(s.y+u.y);return n}function _p(i,n){i[0]=Math.min(i[0],n[0]),i[1]=Math.min(i[1],n[1]),i[2]=Math.max(i[2],n[0]),i[3]=Math.max(i[3],n[1])}function ou(i,n){return!(i[0]<=n[0]||i[2]>=n[2]||i[1]<=n[1]||i[3]>=n[3])}function Eg(i,n,s){const u=i[0]-n[0],h=i[1]-n[1],p=i[0]-s[0],m=i[1]-s[1];return u*m-p*h==0&&u*p<=0&&h*m<=0}function mc(i,n,s=!1){let u=!1;for(let v=0,w=n.length;v<w;v++){const E=n[v];for(let A=0,P=E.length,M=P-1;A<P;M=A++){const z=E[M],B=E[A];if(Eg(i,z,B))return s;(p=z)[1]>(h=i)[1]!=(m=B)[1]>h[1]&&h[0]<(m[0]-p[0])*(h[1]-p[1])/(m[1]-p[1])+p[0]&&(u=!u)}}var h,p,m;return u}function Bb(i,n,s,u){const h=u[0]-s[0],p=u[1]-s[1],m=(i[0]-s[0])*p-h*(i[1]-s[1]),v=(n[0]-s[0])*p-h*(n[1]-s[1]);return m>0&&v<0||m<0&&v>0}function yp(i,n,s,u){return(h=[u[0]-s[0],u[1]-s[1]])[0]*(p=[n[0]-i[0],n[1]-i[1]])[1]-h[1]*p[0]!=0&&!(!Bb(i,n,s,u)||!Bb(s,u,i,n));var h,p}const oo=8192;function yC(i,n){const s=(180+i[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,n.z);return[Math.round(s*h*oo),Math.round(u*h*oo)]}function jb(i,n){for(let s=0;s<n.length;s++)if(mc(i,n[s]))return!0;return!1}function vp(i,n,s){for(const u of s)for(let h=0,p=u.length,m=p-1;h<p;m=h++)if(yp(i,n,u[m],u[h]))return!0;return!1}function Sg(i,n){for(let s=0;s<i.length;++s)if(!mc(i[s],n))return!1;for(let s=0;s<i.length-1;++s)if(vp(i[s],i[s+1],n))return!1;return!0}function vC(i,n){for(let s=0;s<n.length;s++)if(Sg(i,n[s]))return!0;return!1}function x0(i,n,s){const u=[];for(let h=0;h<i.length;h++){const p=[];for(let m=0;m<i[h].length;m++){const v=yC(i[h][m],s);_p(n,v),p.push(v)}u.push(p)}return u}function Ub(i,n,s){const u=[];for(let h=0;h<i.length;h++){const p=x0(i[h],n,s);u.push(p)}return u}function b0(i,n,s,u){if(i[0]<s[0]||i[0]>s[2]){const h=.5*u;let p=i[0]-s[0]>h?-u:s[0]-i[0]>h?u:0;p===0&&(p=i[0]-s[2]>h?-u:s[2]-i[0]>h?u:0),i[0]+=p}_p(n,i)}function Ig(i,n,s,u){const h=Math.pow(2,u.z)*oo,p=[u.x*oo,u.y*oo],m=[];if(!i)return m;for(const v of i)for(const w of v){const E=[w.x+p[0],w.y+p[1]];b0(E,n,s,h),m.push(E)}return m}function Vb(i,n,s,u){const h=Math.pow(2,u.z)*oo,p=[u.x*oo,u.y*oo],m=[];if(!i)return m;for(const w of i){const E=[];for(const A of w){const P=[A.x+p[0],A.y+p[1]];_p(n,P),E.push(P)}m.push(E)}if(n[2]-n[0]<=h/2){(v=n)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of m)for(const E of w)b0(E,n,s,h)}var v;return m}class Pl{constructor(n,s){this.type=Mr,this.geojson=n,this.geometries=s}static parse(n,s){if(n.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(wd(n[1])){const u=n[1];if(u.type==="FeatureCollection")for(let h=0;h<u.features.length;++h){const p=u.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Pl(u,u.features[h].geometry)}else if(u.type==="Feature"){const h=u.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Pl(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Pl(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(s,u){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=s.canonicalID();if(!m)return!1;if(u.type==="Polygon"){const v=x0(u.coordinates,p,m),w=Ig(s.geometry(),h,p,m);if(!ou(h,p))return!1;for(const E of w)if(!mc(E,v))return!1}if(u.type==="MultiPolygon"){const v=Ub(u.coordinates,p,m),w=Ig(s.geometry(),h,p,m);if(!ou(h,p))return!1;for(const E of w)if(!jb(E,v))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(s,u){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=s.canonicalID();if(!m)return!1;if(u.type==="Polygon"){const v=x0(u.coordinates,p,m),w=Vb(s.geometry(),h,p,m);if(!ou(h,p))return!1;for(const E of w)if(!Sg(E,v))return!1}if(u.type==="MultiPolygon"){const v=Ub(u.coordinates,p,m),w=Vb(s.geometry(),h,p,m);if(!ou(h,p))return!1;for(const E of w)if(!vC(E,v))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ag={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},$b=1/298.257223563,Gb=$b*(2-$b),xp=Math.PI/180;class bp{static fromTile(n,s,u){const h=Math.PI*(1-2*(n+.5)/Math.pow(2,s)),p=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/xp;return new bp(p,u)}static get units(){return Ag}constructor(n,s){if(n===void 0)throw new Error("No latitude given.");if(s&&!Ag[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(Ag).join(", ")}`);const u=6378.137*xp*(s?Ag[s]:1),h=Math.cos(n*xp),p=1/(1-Gb*(1-h*h)),m=Math.sqrt(p);this.kx=u*m*h,this.ky=u*m*p*(1-Gb)}distance(n,s){const u=da(n[0]-s[0])*this.kx,h=(n[1]-s[1])*this.ky;return Math.sqrt(u*u+h*h)}bearing(n,s){const u=da(s[0]-n[0])*this.kx;return Math.atan2(u,(s[1]-n[1])*this.ky)/xp}destination(n,s,u){const h=u*xp;return this.offset(n,Math.sin(h)*s,Math.cos(h)*s)}offset(n,s,u){return[n[0]+s/this.kx,n[1]+u/this.ky]}lineDistance(n){let s=0;for(let u=0;u<n.length-1;u++)s+=this.distance(n[u],n[u+1]);return s}area(n){let s=0;for(let u=0;u<n.length;u++){const h=n[u];for(let p=0,m=h.length,v=m-1;p<m;v=p++)s+=da(h[p][0]-h[v][0])*(h[p][1]+h[v][1])*(u?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(n,s){let u=0;if(s<=0)return n[0];for(let h=0;h<n.length-1;h++){const p=n[h],m=n[h+1],v=this.distance(p,m);if(u+=v,u>s)return w0(p,m,(s-(u-v))/v)}return n[n.length-1]}pointToSegmentDistance(n,s,u){let[h,p]=s,m=da(u[0]-h)*this.kx,v=(u[1]-p)*this.ky;if(m!==0||v!==0){const w=(da(n[0]-h)*this.kx*m+(n[1]-p)*this.ky*v)/(m*m+v*v);w>1?(h=u[0],p=u[1]):w>0&&(h+=m/this.kx*w,p+=v/this.ky*w)}return m=da(n[0]-h)*this.kx,v=(n[1]-p)*this.ky,Math.sqrt(m*m+v*v)}pointOnLine(n,s){let u=1/0,h=n[0][0],p=n[0][1],m=0,v=0;for(let w=0;w<n.length-1;w++){let E=n[w][0],A=n[w][1],P=da(n[w+1][0]-E)*this.kx,M=(n[w+1][1]-A)*this.ky,z=0;P===0&&M===0||(z=(da(s[0]-E)*this.kx*P+(s[1]-A)*this.ky*M)/(P*P+M*M),z>1?(E=n[w+1][0],A=n[w+1][1]):z>0&&(E+=P/this.kx*z,A+=M/this.ky*z)),P=da(s[0]-E)*this.kx,M=(s[1]-A)*this.ky;const B=P*P+M*M;B<u&&(u=B,h=E,p=A,m=w,v=z)}return{point:[h,p],index:m,t:Math.max(0,Math.min(1,v))}}lineSlice(n,s,u){let h=this.pointOnLine(u,n),p=this.pointOnLine(u,s);if(h.index>p.index||h.index===p.index&&h.t>p.t){const E=h;h=p,p=E}const m=[h.point],v=h.index+1,w=p.index;!qb(u[v],m[0])&&v<=w&&m.push(u[v]);for(let E=v+1;E<=w;E++)m.push(u[E]);return qb(u[w],p.point)||m.push(p.point),m}lineSliceAlong(n,s,u){let h=0;const p=[];for(let m=0;m<u.length-1;m++){const v=u[m],w=u[m+1],E=this.distance(v,w);if(h+=E,h>n&&p.length===0&&p.push(w0(v,w,(n-(h-E))/E)),h>=s)return p.push(w0(v,w,(s-(h-E))/E)),p;h>n&&p.push(w)}return p}bufferPoint(n,s){const u=s/this.ky,h=s/this.kx;return[n[0]-h,n[1]-u,n[0]+h,n[1]+u]}bufferBBox(n,s){const u=s/this.ky,h=s/this.kx;return[n[0]-h,n[1]-u,n[2]+h,n[3]+u]}insideBBox(n,s){return da(n[0]-s[0])>=0&&da(n[0]-s[2])<=0&&n[1]>=s[1]&&n[1]<=s[3]}}function qb(i,n){return i[0]===n[0]&&i[1]===n[1]}function w0(i,n,s){const u=da(n[0]-i[0]);return[i[0]+u*s,i[1]+(n[1]-i[1])*s]}function da(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}class au{constructor(n=[],s=(u,h)=>u<h?-1:u>h?1:0){if(this.data=n,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:s,compare:u}=this,h=s[n];for(;n>0;){const p=n-1>>1,m=s[p];if(u(h,m)>=0)break;s[n]=m,n=p}s[n]=h}_down(n){const{data:s,compare:u}=this,h=this.length>>1,p=s[n];for(;n<h;){let m=1+(n<<1);const v=m+1;if(v<this.length&&u(s[v],s[m])<0&&(m=v),u(s[m],p)>=0)break;s[n]=s[m],n=m}s[n]=p}}var Mt=8192;function Wb(i,n){return n.dist-i.dist}const wp=100,T0=50;function Hb(i){const n=[1/0,1/0,-1/0,-1/0];if(n.length!==i.length)return!1;for(let s=0;s<n.length;s++)if(n[s]!==i[s])return!1;return!0}function Cg(i){return i[1]-i[0]+1}function gc(i,n){const s=i[1]>=i[0]&&i[1]<n;return s||console.warn("Distance Expression: Index is out of range"),s}function E0(i,n){if(i[0]>i[1])return[null,null];const s=Cg(i);if(n){if(s===2)return[i,null];const u=Math.floor(s/2);return[[i[0],i[0]+u],[i[0]+u,i[1]]]}{if(s===1)return[i,null];const u=Math.floor(s/2)-1;return[[i[0],i[0]+u],[i[0]+u+1,i[1]]]}}function fa(i,n){const s=[1/0,1/0,-1/0,-1/0];if(!gc(n,i.length))return s;for(let u=n[0];u<=n[1];++u)_p(s,i[u]);return s}function Pg(i){const n=[1/0,1/0,-1/0,-1/0];for(let s=0;s<i.length;++s)for(let u=0;u<i[s].length;++u)_p(n,i[s][u]);return n}function Ed(i,n,s){if(Hb(i)||Hb(n))return NaN;let u=0,h=0;return i[2]<n[0]&&(u=n[0]-i[2]),i[0]>n[2]&&(u=i[0]-n[2]),i[1]>n[3]&&(h=i[1]-n[3]),i[3]<n[1]&&(h=n[1]-i[3]),s.distance([0,0],[u,h])}function Zb(i){return 360*i-180}function Xb(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function pa(i,n){const s=Math.pow(2,n.z),u=(i.y/Mt+n.y)/s;return[Zb((i.x/Mt+n.x)/s),Xb(u)]}function Kb(i,n){const s=[];for(let u=0;u<i.length;++u)s.push(pa(i[u],n));return s}function Yb(i,n,s){const u=s.pointOnLine(n,i).point;return s.distance(i,u)}function S0(i,n,s,u,h){const p=s.slice(u[0],u[1]+1);let m=1/0;for(let v=n[0];v<=n[1];++v)if((m=Math.min(m,Yb(i[v],p,h)))===0)return 0;return m}function Sd(i,n,s,u,h){const p=Math.min(h.pointToSegmentDistance(i,s,u),h.pointToSegmentDistance(n,s,u)),m=Math.min(h.pointToSegmentDistance(s,i,n),h.pointToSegmentDistance(u,i,n));return Math.min(p,m)}function xC(i,n,s,u,h){if(!gc(n,i.length)||!gc(u,s.length))return NaN;let p=1/0;for(let m=n[0];m<n[1];++m)for(let v=u[0];v<u[1];++v){if(yp(i[m],i[m+1],s[v],s[v+1]))return 0;p=Math.min(p,Sd(i[m],i[m+1],s[v],s[v+1],h))}return p}function bC(i,n,s,u,h){if(!gc(n,i.length)||!gc(u,s.length))return NaN;let p=1/0;for(let m=n[0];m<=n[1];++m)for(let v=u[0];v<=u[1];++v)if((p=Math.min(p,h.distance(i[m],s[v])))===0)return p;return p}function wC(i,n,s){if(mc(i,n,!0))return 0;let u=1/0;for(const h of n){const p=h.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[p-1]&&(u=Math.min(u,s.pointToSegmentDistance(i,h[p-1],h[0])))===0||(u=Math.min(u,Yb(i,h,s)))===0)return u}return u}function TC(i,n,s,u){if(!gc(n,i.length))return NaN;for(let p=n[0];p<=n[1];++p)if(mc(i[p],s,!0))return 0;let h=1/0;for(let p=n[0];p<n[1];++p)for(const m of s)for(let v=0,w=m.length,E=w-1;v<w;E=v++){if(yp(i[p],i[p+1],m[E],m[v]))return 0;h=Math.min(h,Sd(i[p],i[p+1],m[E],m[v],u))}return h}function Qb(i,n){for(const s of i)for(let u=0;u<=s.length-1;++u)if(mc(s[u],n,!0))return!0;return!1}function Rg(i,n,s,u=1/0){const h=Pg(i),p=Pg(n);if(u!==1/0&&Ed(h,p,s)>=u)return u;if(ou(h,p)){if(Qb(i,n))return 0}else if(Qb(n,i))return 0;let m=u;for(const v of i)for(let w=0,E=v.length,A=E-1;w<E;A=w++)for(const P of n)for(let M=0,z=P.length,B=z-1;M<z;B=M++){if(yp(v[A],v[w],P[B],P[M]))return 0;m=Math.min(m,Sd(v[A],v[w],P[B],P[M],s))}return m}function uh(i,n,s,u,h,p,m){if(p===null||m===null)return;const v=Ed(fa(u,p),fa(h,m),s);v<n&&i.push({dist:v,range1:p,range2:m})}function ma(i,n,s,u,h=1/0){let p=Math.min(u.distance(i[0],s[0][0]),h);if(p===0)return p;const m=new au([{dist:0,range1:[0,i.length-1],range2:[0,0]}],Wb),v=n?T0:wp,w=Pg(s);for(;m.length;){const E=m.pop();if(E.dist>=p)continue;const A=E.range1;if(Cg(A)<=v){if(!gc(A,i.length))return NaN;if(n){const P=TC(i,A,s,u);if((p=Math.min(p,P))===0)return p}else for(let P=A[0];P<=A[1];++P){const M=wC(i[P],s,u);if((p=Math.min(p,M))===0)return p}}else{const P=E0(A,n);if(P[0]!==null){const M=Ed(fa(i,P[0]),w,u);M<p&&m.push({dist:M,range1:P[0],range2:[0,0]})}if(P[1]!==null){const M=Ed(fa(i,P[1]),w,u);M<p&&m.push({dist:M,range1:P[1],range2:[0,0]})}}}return p}function Tp(i,n,s,u,h,p=1/0){let m=Math.min(p,h.distance(i[0],s[0]));if(m===0)return m;const v=new au([{dist:0,range1:[0,i.length-1],range2:[0,s.length-1]}],Wb),w=n?T0:wp,E=u?T0:wp;for(;v.length;){const A=v.pop();if(A.dist>=m)continue;const P=A.range1,M=A.range2;if(Cg(P)<=w&&Cg(M)<=E){if(!gc(P,i.length)||!gc(M,s.length))return NaN;if(n&&u?m=Math.min(m,xC(i,P,s,M,h)):n||u?n&&!u?m=Math.min(m,S0(s,M,i,P,h)):!n&&u&&(m=Math.min(m,S0(i,P,s,M,h))):m=Math.min(m,bC(i,P,s,M,h)),m===0)return m}else{const z=E0(P,n),B=E0(M,u);uh(v,m,h,i,s,z[0],B[0]),uh(v,m,h,i,s,z[0],B[1]),uh(v,m,h,i,s,z[1],B[0]),uh(v,m,h,i,s,z[1],B[1])}}return m}function I0(i,n,s,u,h=1/0){let p=h;const m=fa(i,[0,i.length-1]);for(const v of s)if(!(p!==1/0&&Ed(m,fa(v,[0,v.length-1]),u)>=p)&&(p=Math.min(p,Tp(i,n,v,!0,u,p)),p===0))return p;return p}function Mg(i,n,s,u,h=1/0){let p=h;const m=fa(i,[0,i.length-1]);for(const v of s){if(p!==1/0&&Ed(m,Pg(v),u)>=p)continue;const w=ma(i,n,v,u,p);if(isNaN(w))return w;if((p=Math.min(p,w))===0)return p}return p}function A0(i){return i==="Point"||i==="MultiPoint"||i==="LineString"||i==="MultiLineString"||i==="Polygon"||i==="MultiPolygon"}class hh{constructor(n,s){this.type=tn,this.geojson=n,this.geometries=s}static parse(n,s){if(n.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if(wd(n[1])){const u=n[1];if(u.type==="FeatureCollection"){for(let h=0;h<u.features.length;++h)if(A0(u.features[h].geometry.type))return new hh(u,u.features[h].geometry)}else if(u.type==="Feature"){if(A0(u.geometry.type))return new hh(u,u.geometry)}else if(A0(u.type))return new hh(u,u)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){const s=n.geometry(),u=n.canonicalID();if(s!=null&&u!=null){if(n.geometryType()==="Point")return function(h,p,m){const v=[];for(const E of h)for(const A of E)v.push(pa(A,p));const w=new bp(v[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?Tp(v,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",w):m.type==="MultiLineString"?I0(v,!1,m.coordinates,w):m.type==="Polygon"||m.type==="MultiPolygon"?Mg(v,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,w):null}(s,u,this.geometries);if(n.geometryType()==="LineString")return function(h,p,m){const v=[];for(const E of h){const A=[];for(const P of E)A.push(pa(P,p));v.push(A)}const w=new bp(v[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return I0(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,w);if(m.type==="MultiLineString"){let E=1/0;for(let A=0;A<m.coordinates.length;A++){const P=I0(m.coordinates[A],!0,v,w,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}if(m.type==="Polygon"||m.type==="MultiPolygon"){let E=1/0;for(let A=0;A<v.length;A++){const P=Mg(v[A],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,w,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}return null}(s,u,this.geometries);if(n.geometryType()==="Polygon")return function(h,p,m){const v=[];for(const E of function(A,P){const M=A.length;if(M<=1)return[A];const z=[];let B,U;for(let $=0;$<M;$++){const Y=_C(A[$]);Y!==0&&(A[$].area=Math.abs(Y),U===void 0&&(U=Y<0),U===Y<0?(B&&z.push(B),B=[A[$]]):B.push(A[$]))}return B&&z.push(B),z}(h)){const A=[];for(let P=0;P<E.length;++P)A.push(Kb(E[P],p));v.push(A)}const w=new bp(v[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Mg(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,w);if(m.type==="MultiLineString"){let E=1/0;for(let A=0;A<m.coordinates.length;A++){const P=Mg(m.coordinates[A],!0,v,w,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}return m.type==="Polygon"||m.type==="MultiPolygon"?function(E,A,P){let M=1/0;for(const z of E)for(const B of A){const U=Rg(z,B,P,M);if(isNaN(U))return U;if((M=Math.min(M,U))===0)return M}return M}(m.type==="Polygon"?[m.coordinates]:m.coordinates,v,w):null}(s,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ep(i,n){switch(i){case"string":return Qa(n);case"number":return+n;case"boolean":return!!n;case"color":return Ar.parse(n);case"formatted":return vo.fromString(Qa(n));case"resolvedImage":return ua.fromString(Qa(n))}return n}function Jb(i,n,s,u){return u!==void 0&&(i=u*Math.round(i/u)),n!==void 0&&i<n&&(i=n),s!==void 0&&i>s&&(i=s),i}class lu{constructor(n,s,u){this.type=n,this.key=s,this.scope=u}static parse(n,s){let u=s.expectedType;if(u==null&&(u=Er),n.length<2||n.length>3)return s.error("Invalid number of arguments for 'config' expression.");const h=s.parse(n[1],1);if(!(h instanceof Ja))return s.error("Key name of 'config' expression must be a string literal.");if(n.length>=3){const p=s.parse(n[2],2);return p instanceof Ja?new lu(u,Qa(h.value),Qa(p.value)):s.error("Scope of 'config' expression must be a string literal.")}return new lu(u,Qa(h.value))}evaluate(n){const s=[this.key,this.scope,n.scope].filter(Boolean).join(""),u=n.getConfig(s);if(!u)return null;const{type:h,value:p,values:m,minValue:v,maxValue:w,stepValue:E}=u,A=u.default.evaluate(n);let P=A;if(p){const M=n.scope;n.scope=(M||"").split("").slice(1).join(""),P=p.evaluate(n),n.scope=M}return h&&(P=Ep(h,P)),P===void 0||v===void 0&&w===void 0&&E===void 0||(typeof P=="number"?P=Jb(P,v,w,E):Array.isArray(P)&&(P=P.map(M=>typeof M=="number"?Jb(M,v,w,E):M))),p!==void 0&&P!==void 0&&m&&!m.includes(P)&&(P=A,h&&(P=Ep(h,P))),(h&&h!==this.type||P!==void 0&&fs(P)!==this.type)&&(P=Ep(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const n=["config",this.key];return this.scope&&n.concat(this.key),n}}function Sp(i){if(i instanceof Go&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Pl||i instanceof hh)return!1;let n=!0;return i.eachChild(s=>{n&&!Sp(s)&&(n=!1)}),n}function kg(i){if(i instanceof Go&&i.name==="feature-state")return!1;let n=!0;return i.eachChild(s=>{n&&!kg(s)&&(n=!1)}),n}function Ip(i){if(i instanceof lu)return new Set([i.key]);let n=new Set;return i.eachChild(s=>{n=new Set([...n,...Ip(s)])}),n}function Ap(i,n){if(i instanceof Go&&n.indexOf(i.name)>=0)return!1;let s=!0;return i.eachChild(u=>{s&&!Ap(u,n)&&(s=!1)}),s}class Cp{constructor(n,s){this.type=s.type,this.name=n,this.boundExpression=s}static parse(n,s){if(n.length!==2||typeof n[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const u=n[1];return s.scope.has(u)?new Cp(u,s.scope.get(u)):s.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Dg{constructor(n,s=[],u,h=new g0,p=[],m,v){this.registry=n,this.path=s,this.key=s.map(w=>`[${w}]`).join(""),this.scope=h,this.errors=p,this.expectedType=u,this._scope=m,this.options=v}parse(n,s,u,h,p={}){return s||u?this.concat(s,u,h)._parse(n,p):this._parse(n,p)}_parse(n,s){function u(h,p,m){return m==="assert"?new ha(p,[h]):m==="coerce"?new pc(p,[h]):h}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(h){let p=h.parse(n,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,v=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||v.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(m,v))return null}else p=u(p,m,s.typeAnnotation||"coerce");else p=u(p,m,s.typeAnnotation||"assert")}if(!(p instanceof Ja)&&p.type.kind!=="resolvedImage"&&Pp(p)){const m=new v0(this._scope,this.options);try{p=new Ja(p.type,p.evaluate(m))}catch(v){return this.error(v.message),null}}return p}return pc.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,s,u){const h=typeof n=="number"?this.path.concat(n):this.path,p=u?this.scope.concat(u):this.scope;return new Dg(this.registry,h,s||null,p,this.errors,this._scope,this.options)}error(n,...s){const u=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new Cl(u,n))}checkSubtype(n,s){const u=pp(n,s);return u&&this.error(u),u}}var ew=Dg;function Pp(i){if(i instanceof Cp)return Pp(i.boundExpression);if(i instanceof Go&&i.name==="error"||i instanceof gp||i instanceof Pl||i instanceof hh||i instanceof lu)return!1;const n=i instanceof pc||i instanceof ha;let s=!0;return i.eachChild(u=>{s=n?s&&Pp(u):s&&u instanceof Ja}),!!s&&Sp(i)&&Ap(i,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function dh(i,n){const s=i.length-1;let u,h,p=0,m=s,v=0;for(;p<=m;)if(v=Math.floor((p+m)/2),u=i[v],h=i[v+1],u<=n){if(v===s||n<h)return v;p=v+1}else{if(!(u>n))throw new bs("Input is not a number.");m=v-1}return 0}class Id{constructor(n,s,u){this.type=n,this.input=s,this.labels=[],this.outputs=[];for(const[h,p]of u)this.labels.push(h),this.outputs.push(p)}static parse(n,s){if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");const u=s.parse(n[1],1,tn);if(!u)return null;const h=[];let p=null;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);for(let m=1;m<n.length;m+=2){const v=m===1?-1/0:n[m],w=n[m+1],E=m,A=m+1;if(typeof v!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=v)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=s.parse(w,A,p);if(!P)return null;p=p||P.type,h.push([v,P])}return new Id(p,u,h)}evaluate(n){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(n);const h=this.input.evaluate(n);if(h<=s[0])return u[0].evaluate(n);const p=s.length;return h>=s[p-1]?u[p-1].evaluate(n):u[dh(s,h)].evaluate(n)}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&n.push(this.labels[s]),n.push(this.outputs[s].serialize());return n}}const tw=.95047,C0=1.08883,nw=4/29,cu=6/29,rw=3*cu*cu,EC=cu*cu*cu,SC=Math.PI/180,IC=180/Math.PI;function Og(i){return i>EC?Math.pow(i,1/3):i/rw+nw}function P0(i){return i>cu?i*i*i:rw*(i-nw)}function R0(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function M0(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function iw(i){const n=M0(i.r),s=M0(i.g),u=M0(i.b),h=Og((.4124564*n+.3575761*s+.1804375*u)/tw),p=Og((.2126729*n+.7151522*s+.072175*u)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-Og((.0193339*n+.119192*s+.9503041*u)/C0)),alpha:i.a}}function sw(i){let n=(i.l+16)/116,s=isNaN(i.a)?n:n+i.a/500,u=isNaN(i.b)?n:n-i.b/200;return n=1*P0(n),s=tw*P0(s),u=C0*P0(u),new Ar(R0(3.2404542*s-1.5371385*n-.4985314*u),R0(-.969266*s+1.8760108*n+.041556*u),R0(.0556434*s-.2040259*n+1.0572252*u),i.alpha)}function AC(i,n,s){const u=n-i;return i+s*(u>180||u<-180?u-360*Math.round(u/360):u)}const Rp={forward:iw,reverse:sw,interpolate:function(i,n,s){return{l:En(i.l,n.l,s),a:En(i.a,n.a,s),b:En(i.b,n.b,s),alpha:En(i.alpha,n.alpha,s)}}},Mp={forward:function(i){const{l:n,a:s,b:u}=iw(i),h=Math.atan2(u,s)*IC;return{h:h<0?h+360:h,c:Math.sqrt(s*s+u*u),l:n,alpha:i.a}},reverse:function(i){const n=i.h*SC,s=i.c;return sw({l:i.l,a:Math.cos(n)*s,b:Math.sin(n)*s,alpha:i.alpha})},interpolate:function(i,n,s){return{h:AC(i.h,n.h,s),c:En(i.c,n.c,s),l:En(i.l,n.l,s),alpha:En(i.alpha,n.alpha,s)}}};var kp=Object.freeze({__proto__:null,hcl:Mp,lab:Rp});class ga{constructor(n,s,u,h,p){this.type=n,this.operator=s,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(const[m,v]of p)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(n,s,u,h){let p=0;if(n.name==="exponential")p=k0(s,n.base,u,h);else if(n.name==="linear")p=k0(s,1,u,h);else if(n.name==="cubic-bezier"){const m=n.controlPoints;p=new Yc(m[0],m[1],m[2],m[3]).solve(k0(s,1,u,h))}return p}static parse(n,s){let[u,h,p,...m]=n;if(!Array.isArray(h)||h.length===0)return s.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some(A=>typeof A!="number"||A<0||A>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(p=s.parse(p,2,tn),!p)return null;const v=[];let w=null;u==="interpolate-hcl"||u==="interpolate-lab"?w=Ca:s.expectedType&&s.expectedType.kind!=="value"&&(w=s.expectedType);for(let E=0;E<m.length;E+=2){const A=m[E],P=m[E+1],M=E+3,z=E+4;if(typeof A!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(v.length&&v[v.length-1][0]>=A)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const B=s.parse(P,z,w);if(!B)return null;w=w||B.type,v.push([A,B])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new ga(w,u,h,p,v):s.error(`Type ${Ni(w)} is not interpolatable.`)}evaluate(n){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(n);const h=this.input.evaluate(n);if(h<=s[0])return u[0].evaluate(n);const p=s.length;if(h>=s[p-1])return u[p-1].evaluate(n);const m=dh(s,h),v=ga.interpolationFactor(this.interpolation,h,s[m],s[m+1]),w=u[m].evaluate(n),E=u[m+1].evaluate(n);return this.operator==="interpolate"?fp[this.type.kind.toLowerCase()](w,E,v):this.operator==="interpolate-hcl"?Mp.reverse(Mp.interpolate(Mp.forward(w),Mp.forward(E),v)):Rp.reverse(Rp.interpolate(Rp.forward(w),Rp.forward(E),v))}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,n,this.input.serialize()];for(let u=0;u<this.labels.length;u++)s.push(this.labels[u],this.outputs[u].serialize());return s}}function k0(i,n,s,u){const h=u-s,p=i-s;return h===0?0:n===1?p/h:(Math.pow(n,p)-1)/(Math.pow(n,h)-1)}class fh{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expectected at least one argument.");let u=null;const h=s.expectedType;h&&h.kind!=="value"&&(u=h);const p=[];for(const v of n.slice(1)){const w=s.parse(v,1+p.length,u,void 0,{typeAnnotation:"omit"});if(!w)return null;u=u||w.type,p.push(w)}const m=h&&p.some(v=>pp(h,v.type));return new fh(m?Er:u,p)}evaluate(n){let s,u=null,h=0;for(const p of this.args){if(h++,u=p.evaluate(n),u&&u instanceof ua&&!u.available&&(s||(s=u),u=null,h===this.args.length))return s;if(u!==null)break}return u}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(s=>{n.push(s.serialize())}),n}}class Lg{constructor(n,s){this.type=s.type,this.bindings=[].concat(n),this.result=s}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const s of this.bindings)n(s[1]);n(this.result)}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const u=[];for(let p=1;p<n.length-1;p+=2){const m=n[p];if(typeof m!="string")return s.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return s.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=s.parse(n[p+1],p+1);if(!v)return null;u.push([m,v])}const h=s.parse(n[n.length-1],n.length-1,s.expectedType,u);return h?new Lg(u,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[s,u]of this.bindings)n.push(s,u.serialize());return n.push(this.result.serialize()),n}}class zg{constructor(n,s,u){this.type=n,this.index=s,this.input=u}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=s.parse(n[1],1,tn),h=s.parse(n[2],2,so(s.expectedType||Er));return u&&h?new zg(h.type.itemType,u,h):null}evaluate(n){const s=this.index.evaluate(n),u=this.input.evaluate(n);if(s<0)throw new bs(`Array index out of bounds: ${s} < 0.`);if(s>=u.length)throw new bs(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s!==Math.floor(s))throw new bs(`Array index must be an integer, but found ${s} instead.`);return u[s]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class D0{constructor(n,s){this.type=Mr,this.needle=n,this.haystack=s}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=s.parse(n[1],1,Er),h=s.parse(n[2],2,Er);return u&&h?Pa(u.type,[Mr,xr,tn,ca,Er])?new D0(u,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ni(u.type)} instead`):null}evaluate(n){const s=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(u==null)return!1;if(!mp(s,["boolean","string","number","null"]))throw new bs(`Expected first argument to be of type boolean, string, number or null, but found ${Ni(fs(s))} instead.`);if(!mp(u,["string","array"]))throw new bs(`Expected second argument to be of type array or string, but found ${Ni(fs(u))} instead.`);return u.indexOf(s)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Dp{constructor(n,s,u){this.type=tn,this.needle=n,this.haystack=s,this.fromIndex=u}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const u=s.parse(n[1],1,Er),h=s.parse(n[2],2,Er);if(!u||!h)return null;if(!Pa(u.type,[Mr,xr,tn,ca,Er]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ni(u.type)} instead`);if(n.length===4){const p=s.parse(n[3],3,tn);return p?new Dp(u,h,p):null}return new Dp(u,h)}evaluate(n){const s=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(!mp(s,["boolean","string","number","null"]))throw new bs(`Expected first argument to be of type boolean, string, number or null, but found ${Ni(fs(s))} instead.`);if(!mp(u,["string","array"]))throw new bs(`Expected second argument to be of type array or string, but found ${Ni(fs(u))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(n);return u.indexOf(s,h)}return u.indexOf(s)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ng{constructor(n,s,u,h,p,m){this.inputType=n,this.type=s,this.input=u,this.cases=h,this.outputs=p,this.otherwise=m}static parse(n,s){if(n.length<5)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return s.error("Expected an even number of arguments.");let u,h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const p={},m=[];for(let E=2;E<n.length-1;E+=2){let A=n[E];const P=n[E+1];Array.isArray(A)||(A=[A]);const M=s.concat(E);if(A.length===0)return M.error("Expected at least one branch label.");for(const B of A){if(typeof B!="number"&&typeof B!="string")return M.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return M.error("Numeric branch labels must be integer values.");if(u){if(M.checkSubtype(u,fs(B)))return null}else u=fs(B);if(p[String(B)]!==void 0)return M.error("Branch labels must be unique.");p[String(B)]=m.length}const z=s.parse(P,E,h);if(!z)return null;h=h||z.type,m.push(z)}const v=s.parse(n[1],1,Er);if(!v)return null;const w=s.parse(n[n.length-1],n.length-1,h);return w?v.type.kind!=="value"&&s.concat(1).checkSubtype(u,v.type)?null:new Ng(u,h,v,p,m,w):null}evaluate(n){const s=this.input.evaluate(n);return(fs(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),u=[],h={};for(const m of s){const v=h[this.cases[m]];v===void 0?(h[this.cases[m]]=u.length,u.push([this.cases[m],[m]])):u[v][1].push(m)}const p=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,v]of u)n.push(v.length===1?p(v[0]):v.map(p)),n.push(this.outputs[m].serialize());return n.push(this.otherwise.serialize()),n}}class Fg{constructor(n,s,u){this.type=n,this.branches=s,this.otherwise=u}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return s.error("Expected an odd number of arguments.");let u;s.expectedType&&s.expectedType.kind!=="value"&&(u=s.expectedType);const h=[];for(let m=1;m<n.length-1;m+=2){const v=s.parse(n[m],m,Mr);if(!v)return null;const w=s.parse(n[m+1],m+1,u);if(!w)return null;h.push([v,w]),u=u||w.type}const p=s.parse(n[n.length-1],n.length-1,u);return p?new Fg(u,h,p):null}evaluate(n){for(const[s,u]of this.branches)if(s.evaluate(n))return u.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[s,u]of this.branches)n(s),n(u);n(this.otherwise)}outputDefined(){return this.branches.every(([n,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(s=>{n.push(s.serialize())}),n}}class Op{constructor(n,s,u,h){this.type=n,this.input=s,this.beginIndex=u,this.endIndex=h}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const u=s.parse(n[1],1,Er),h=s.parse(n[2],2,tn);if(!u||!h)return null;if(!Pa(u.type,[so(Er),xr,Er]))return s.error(`Expected first argument to be of type array or string, but found ${Ni(u.type)} instead`);if(n.length===4){const p=s.parse(n[3],3,tn);return p?new Op(u.type,u,h,p):null}return new Op(u.type,u,h)}evaluate(n){const s=this.input.evaluate(n),u=this.beginIndex.evaluate(n);if(!mp(s,["string","array"]))throw new bs(`Expected first argument to be of type array or string, but found ${Ni(fs(s))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(n);return s.slice(u,h)}return s.slice(u)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Bg(i,n){return i==="=="||i==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function jg(i,n,s,u){return u.compare(n,s)===0}function Ad(i,n,s){const u=i!=="=="&&i!=="!=";return class LX{constructor(p,m,v){this.type=Mr,this.lhs=p,this.rhs=m,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const v=p[0];let w=m.parse(p[1],1,Er);if(!w)return null;if(!Bg(v,w.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${Ni(w.type)}'.`);let E=m.parse(p[2],2,Er);if(!E)return null;if(!Bg(v,E.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${Ni(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error(`Cannot compare types '${Ni(w.type)}' and '${Ni(E.type)}'.`);u&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new ha(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new ha(w.type,[E])));let A=null;if(p.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(A=m.parse(p[3],3,bg),!A)return null}return new LX(w,E,A)}evaluate(p){const m=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(u&&this.hasUntypedArgument){const w=fs(m),E=fs(v);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new bs(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const w=fs(m),E=fs(v);if(w.kind!=="string"||E.kind!=="string")return n(p,m,v)}return this.collator?s(p,m,v,this.collator.evaluate(p)):n(p,m,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[i];return this.eachChild(m=>{p.push(m.serialize())}),p}}}const CC=Ad("==",function(i,n,s){return n===s},jg),ow=Ad("!=",function(i,n,s){return n!==s},function(i,n,s,u){return!jg(0,n,s,u)}),PC=Ad("<",function(i,n,s){return n<s},function(i,n,s,u){return u.compare(n,s)<0}),RC=Ad(">",function(i,n,s){return n>s},function(i,n,s,u){return u.compare(n,s)>0}),MC=Ad("<=",function(i,n,s){return n<=s},function(i,n,s,u){return u.compare(n,s)<=0}),kC=Ad(">=",function(i,n,s){return n>=s},function(i,n,s,u){return u.compare(n,s)>=0});class O0{constructor(n,s,u,h,p,m){this.type=xr,this.number=n,this.locale=s,this.currency=u,this.unit=h,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(n,s){if(n.length!==3)return s.error("Expected two arguments.");const u=s.parse(n[1],1,tn);if(!u)return null;const h=n[2];if(typeof h!="object"||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=s.parse(h.locale,1,xr),!p))return null;let m=null;if(h.currency&&(m=s.parse(h.currency,1,xr),!m))return null;let v=null;if(h.unit&&(v=s.parse(h.unit,1,xr),!v))return null;let w=null;if(h["min-fraction-digits"]&&(w=s.parse(h["min-fraction-digits"],1,tn),!w))return null;let E=null;return h["max-fraction-digits"]&&(E=s.parse(h["max-fraction-digits"],1,tn),!E)?null:new O0(u,p,m,v,w,E)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class L0{constructor(n){this.type=tn,this.input=n}static parse(n,s){if(n.length!==2)return s.error(`Expected 1 argument, but found ${n.length-1} instead.`);const u=s.parse(n[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Ni(u.type)} instead.`):new L0(u):null}evaluate(n){const s=this.input.evaluate(n);if(typeof s=="string"||Array.isArray(s))return s.length;throw new bs(`Expected value to be of type string or array, but found ${Ni(fs(s))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(s=>{n.push(s.serialize())}),n}}function aw(i){return function(){i=1831565813+(i|=0)|0;let n=Math.imul(i^i>>>15,1|i);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const Cd={"==":CC,"!=":ow,">":RC,"<":PC,">=":kC,"<=":MC,array:ha,at:zg,boolean:ha,case:Fg,coalesce:fh,collator:gp,format:ch,image:fc,in:D0,"index-of":Dp,interpolate:ga,"interpolate-hcl":ga,"interpolate-lab":ga,length:L0,let:Lg,literal:Ja,match:Ng,number:ha,"number-format":O0,object:ha,slice:Op,step:Id,string:ha,"to-boolean":pc,"to-color":pc,"to-number":pc,"to-string":pc,var:Cp,within:Pl,distance:hh,config:lu};function lw(i,[n,s,u,h]){n=n.evaluate(i),s=s.evaluate(i),u=u.evaluate(i);const p=h?h.evaluate(i):1,m=Nb(n,s,u,p);if(m)throw new bs(m);return new Ar(n/255*p,s/255*p,u/255*p,p)}function DC(i,[n,s,u,h]){n=n.evaluate(i),s=s.evaluate(i),u=u.evaluate(i);const p=h?h.evaluate(i):1,m=function(E,A,P,M){return typeof E=="number"&&E>=0&&E<=360?typeof A=="number"&&A>=0&&A<=100&&typeof P=="number"&&P>=0&&P<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[E,A,P,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[E,A,P,M]:[E,A,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[E,A,P,M]:[E,A,P]).join(", ")}]: 'h' must be between 0 and 360.`}(n,s,u,p);if(m)throw new bs(m);const v=`hsla(${n}, ${s}%, ${u}%, ${p})`,w=Ar.parse(v);if(!w)throw new bs(`Failed to parse HSLA color: ${v}`);return w}function g(i,n){return i in n}function l(i,n){const s=n[i];return s===void 0?null:s}function d(i){return{type:i}}function y(i){return{result:"success",value:i}}function b(i){return{result:"error",value:i}}function T(i,n){return!!i&&!!i.parameters&&i.parameters.indexOf(n)>-1}function S(i){return i["property-type"]==="data-driven"}function C(i){return T(i.expression,"measure-light")}function k(i){return T(i.expression,"zoom")}function L(i){return!!i.expression&&i.expression.interpolated}function N(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function j(i){return i}function G(i,n){const s=n.type==="color",u=i.stops&&typeof i.stops[0][0]=="object",h=u||!(u||i.property!==void 0),p=i.type||(L(n)?"exponential":"interval");if(s&&((i=vd({},i)).stops&&(i.stops=i.stops.map(E=>[E[0],Ar.parse(E[1])])),i.default=Ar.parse(i.default?i.default:n.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!kp[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let m,v,w;if(p==="exponential")m=ae;else if(p==="interval")m=ie;else if(p==="categorical"){m=re,v=Object.create(null);for(const E of i.stops)v[E[0]]=E[1];w=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=ce}if(u){const E={},A=[];for(let z=0;z<i.stops.length;z++){const B=i.stops[z],U=B[0].zoom;E[U]===void 0&&(E[U]={zoom:U,type:i.type,property:i.property,default:i.default,stops:[]},A.push(U)),E[U].stops.push([B[0].value,B[1]])}const P=[];for(const z of A)P.push([E[z].zoom,G(E[z],n)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:ga.interpolationFactor.bind(void 0,M),zoomStops:P.map(z=>z[0]),evaluate:({zoom:z},B)=>ae({stops:P,base:i.base},n,z).evaluate(z,B)}}if(h){const E=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:ga.interpolationFactor.bind(void 0,E),zoomStops:i.stops.map(A=>A[0]),evaluate:({zoom:A})=>m(i,n,A,v,w)}}return{kind:"source",evaluate(E,A){const P=A&&A.properties?A.properties[i.property]:void 0;return P===void 0?q(i.default,n.default):m(i,n,P,v,w)}}}function q(i,n,s){return i!==void 0?i:n!==void 0?n:s!==void 0?s:void 0}function re(i,n,s,u,h){return q(typeof s===h?u[s]:void 0,i.default,n.default)}function ie(i,n,s){if(su(s)!=="number")return q(i.default,n.default);const u=i.stops.length;if(u===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[u-1][0])return i.stops[u-1][1];const h=dh(i.stops.map(p=>p[0]),s);return i.stops[h][1]}function ae(i,n,s){const u=i.base!==void 0?i.base:1;if(su(s)!=="number")return q(i.default,n.default);const h=i.stops.length;if(h===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[h-1][0])return i.stops[h-1][1];const p=dh(i.stops.map(A=>A[0]),s),m=function(A,P,M,z){const B=z-M,U=A-M;return B===0?0:P===1?U/B:(Math.pow(P,U)-1)/(Math.pow(P,B)-1)}(s,u,i.stops[p][0],i.stops[p+1][0]),v=i.stops[p][1],w=i.stops[p+1][1];let E=fp[n.type]||j;if(i.colorSpace&&i.colorSpace!=="rgb"){const A=kp[i.colorSpace];E=(P,M)=>A.reverse(A.interpolate(A.forward(P),A.forward(M),m))}return typeof v.evaluate=="function"?{evaluate(...A){const P=v.evaluate.apply(void 0,A),M=w.evaluate.apply(void 0,A);if(P!==void 0&&M!==void 0)return E(P,M,m)}}:E(v,w,m)}function ce(i,n,s){return n.type==="color"?s=Ar.parse(s):n.type==="formatted"?s=vo.fromString(s.toString()):n.type==="resolvedImage"?s=ua.fromString(s.toString()):su(s)===n.type||n.type==="enum"&&n.values[s]||(s=void 0),q(s,i.default,n.default)}Go.register(Cd,{error:[{kind:"error"},[xr],(i,[n])=>{throw new bs(n.evaluate(i))}],typeof:[xr,[Er],(i,[n])=>Ni(fs(n.evaluate(i)))],"to-rgba":[so(tn,4),[Ca],(i,[n])=>n.evaluate(i).toRenderColor(null).toArray()],rgb:[Ca,[tn,tn,tn],lw],rgba:[Ca,[tn,tn,tn,tn],lw],hsl:[Ca,[tn,tn,tn],DC],hsla:[Ca,[tn,tn,tn,tn],DC],has:{type:Mr,overloads:[[[xr],(i,[n])=>g(n.evaluate(i),i.properties())],[[xr,xd],(i,[n,s])=>g(n.evaluate(i),s.evaluate(i))]]},get:{type:Er,overloads:[[[xr],(i,[n])=>l(n.evaluate(i),i.properties())],[[xr,xd],(i,[n,s])=>l(n.evaluate(i),s.evaluate(i))]]},"feature-state":[Er,[xr],(i,[n])=>l(n.evaluate(i),i.featureState||{})],properties:[xd,[],i=>i.properties()],"geometry-type":[xr,[],i=>i.geometryType()],id:[Er,[],i=>i.id()],zoom:[tn,[],i=>i.globals.zoom],pitch:[tn,[],i=>i.globals.pitch||0],"distance-from-center":[tn,[],i=>i.distanceFromCenter()],"measure-light":[tn,[xr],(i,[n])=>i.measureLight(n.evaluate(i))],"heatmap-density":[tn,[],i=>i.globals.heatmapDensity||0],"line-progress":[tn,[],i=>i.globals.lineProgress||0],"raster-value":[tn,[],i=>i.globals.rasterValue||0],"raster-particle-speed":[tn,[],i=>i.globals.rasterParticleSpeed||0],"sky-radial-progress":[tn,[],i=>i.globals.skyRadialProgress||0],accumulated:[Er,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[tn,d(tn),(i,n)=>{let s=0;for(const u of n)s+=u.evaluate(i);return s}],"*":[tn,d(tn),(i,n)=>{let s=1;for(const u of n)s*=u.evaluate(i);return s}],"-":{type:tn,overloads:[[[tn,tn],(i,[n,s])=>n.evaluate(i)-s.evaluate(i)],[[tn],(i,[n])=>-n.evaluate(i)]]},"/":[tn,[tn,tn],(i,[n,s])=>n.evaluate(i)/s.evaluate(i)],"%":[tn,[tn,tn],(i,[n,s])=>n.evaluate(i)%s.evaluate(i)],ln2:[tn,[],()=>Math.LN2],pi:[tn,[],()=>Math.PI],e:[tn,[],()=>Math.E],"^":[tn,[tn,tn],(i,[n,s])=>Math.pow(n.evaluate(i),s.evaluate(i))],sqrt:[tn,[tn],(i,[n])=>Math.sqrt(n.evaluate(i))],log10:[tn,[tn],(i,[n])=>Math.log(n.evaluate(i))/Math.LN10],ln:[tn,[tn],(i,[n])=>Math.log(n.evaluate(i))],log2:[tn,[tn],(i,[n])=>Math.log(n.evaluate(i))/Math.LN2],sin:[tn,[tn],(i,[n])=>Math.sin(n.evaluate(i))],cos:[tn,[tn],(i,[n])=>Math.cos(n.evaluate(i))],tan:[tn,[tn],(i,[n])=>Math.tan(n.evaluate(i))],asin:[tn,[tn],(i,[n])=>Math.asin(n.evaluate(i))],acos:[tn,[tn],(i,[n])=>Math.acos(n.evaluate(i))],atan:[tn,[tn],(i,[n])=>Math.atan(n.evaluate(i))],min:[tn,d(tn),(i,n)=>Math.min(...n.map(s=>s.evaluate(i)))],max:[tn,d(tn),(i,n)=>Math.max(...n.map(s=>s.evaluate(i)))],abs:[tn,[tn],(i,[n])=>Math.abs(n.evaluate(i))],round:[tn,[tn],(i,[n])=>{const s=n.evaluate(i);return s<0?-Math.round(-s):Math.round(s)}],floor:[tn,[tn],(i,[n])=>Math.floor(n.evaluate(i))],ceil:[tn,[tn],(i,[n])=>Math.ceil(n.evaluate(i))],"filter-==":[Mr,[xr,Er],(i,[n,s])=>i.properties()[n.value]===s.value],"filter-id-==":[Mr,[Er],(i,[n])=>i.id()===n.value],"filter-type-==":[Mr,[xr],(i,[n])=>i.geometryType()===n.value],"filter-<":[Mr,[xr,Er],(i,[n,s])=>{const u=i.properties()[n.value],h=s.value;return typeof u==typeof h&&u<h}],"filter-id-<":[Mr,[Er],(i,[n])=>{const s=i.id(),u=n.value;return typeof s==typeof u&&s<u}],"filter->":[Mr,[xr,Er],(i,[n,s])=>{const u=i.properties()[n.value],h=s.value;return typeof u==typeof h&&u>h}],"filter-id->":[Mr,[Er],(i,[n])=>{const s=i.id(),u=n.value;return typeof s==typeof u&&s>u}],"filter-<=":[Mr,[xr,Er],(i,[n,s])=>{const u=i.properties()[n.value],h=s.value;return typeof u==typeof h&&u<=h}],"filter-id-<=":[Mr,[Er],(i,[n])=>{const s=i.id(),u=n.value;return typeof s==typeof u&&s<=u}],"filter->=":[Mr,[xr,Er],(i,[n,s])=>{const u=i.properties()[n.value],h=s.value;return typeof u==typeof h&&u>=h}],"filter-id->=":[Mr,[Er],(i,[n])=>{const s=i.id(),u=n.value;return typeof s==typeof u&&s>=u}],"filter-has":[Mr,[Er],(i,[n])=>n.value in i.properties()],"filter-has-id":[Mr,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Mr,[so(xr)],(i,[n])=>n.value.indexOf(i.geometryType())>=0],"filter-id-in":[Mr,[so(Er)],(i,[n])=>n.value.indexOf(i.id())>=0],"filter-in-small":[Mr,[xr,so(Er)],(i,[n,s])=>s.value.indexOf(i.properties()[n.value])>=0],"filter-in-large":[Mr,[xr,so(Er)],(i,[n,s])=>function(u,h,p,m){for(;p<=m;){const v=p+m>>1;if(h[v]===u)return!0;h[v]>u?m=v-1:p=v+1}return!1}(i.properties()[n.value],s.value,0,s.value.length-1)],all:{type:Mr,overloads:[[[Mr,Mr],(i,[n,s])=>n.evaluate(i)&&s.evaluate(i)],[d(Mr),(i,n)=>{for(const s of n)if(!s.evaluate(i))return!1;return!0}]]},any:{type:Mr,overloads:[[[Mr,Mr],(i,[n,s])=>n.evaluate(i)||s.evaluate(i)],[d(Mr),(i,n)=>{for(const s of n)if(s.evaluate(i))return!0;return!1}]]},"!":[Mr,[Mr],(i,[n])=>!n.evaluate(i)],"is-supported-script":[Mr,[xr],(i,[n])=>{const s=i.globals&&i.globals.isSupportedScript;return!s||s(n.evaluate(i))}],upcase:[xr,[xr],(i,[n])=>n.evaluate(i).toUpperCase()],downcase:[xr,[xr],(i,[n])=>n.evaluate(i).toLowerCase()],concat:[xr,d(Er),(i,n)=>n.map(s=>Qa(s.evaluate(i))).join("")],"resolved-locale":[xr,[bg],(i,[n])=>n.evaluate(i).resolvedLocale()],random:[tn,[tn,tn,Er],(i,n)=>{const[s,u,h]=n.map(m=>m.evaluate(i));if(s>u||s===u)return s;let p;if(typeof h=="string")p=function(m){let v=0;if(m.length===0)return v;for(let w=0;w<m.length;w++)v=(v<<5)-v+m.charCodeAt(w),v|=0;return v}(h);else{if(typeof h!="number")throw new bs(`Invalid seed input: ${h}`);p=h}return s+aw(p)()*(u-s)}]});class ye{constructor(n,s,u,h){this.expression=n,this._warningHistory={},this._evaluator=new v0(u,h),this._defaultValue=s?function(p){return p.type==="color"&&(N(p.default)||Array.isArray(p.default))?new Ar(0,0,0,0):p.type==="color"?Ar.parse(p.default)||null:p.default===void 0?null:p.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(n,s,u,h,p,m,v,w){return this._evaluator.globals=n,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(n,s,u,h,p,m,v,w){this._evaluator.globals=n,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new bs(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${E.message}`)),this._defaultValue}}}function ve(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Cd}function _e(i,n,s,u){const h=new ew(Cd,[],n?function(m){const v={color:Ca,string:xr,number:tn,enum:xr,boolean:Mr,formatted:bd,resolvedImage:lh};return m.type==="array"?so(v[m.value]||Er,m.length):v[m.type]}(n):void 0,void 0,void 0,s,u),p=h.parse(i,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?y(new ye(p,n,s,u)):b(h.errors)}class Re{constructor(n,s,u){this.kind=n,this._styleExpression=s,this.isLightConstant=u,this.isStateDependent=n!=="constant"&&!kg(s.expression),this.configDependencies=Ip(s.expression)}evaluateWithoutErrorHandling(n,s,u,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(n,s,u,h,p,m)}evaluate(n,s,u,h,p,m){return this._styleExpression.evaluate(n,s,u,h,p,m)}}class Se{constructor(n,s,u,h,p){this.kind=n,this.zoomStops=u,this._styleExpression=s,this.isStateDependent=n!=="camera"&&!kg(s.expression),this.isLightConstant=p,this.configDependencies=Ip(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(n,s,u,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(n,s,u,h,p,m)}evaluate(n,s,u,h,p,m){return this._styleExpression.evaluate(n,s,u,h,p,m)}interpolationFactor(n,s,u){return this.interpolationType?ga.interpolationFactor(this.interpolationType,n,s,u):0}}function Ie(i,n,s,u){if((i=_e(i,n,s,u)).result==="error")return i;const h=i.value.expression,p=Sp(h);if(!p&&!S(n))return b([new Cl("","data expressions not supported")]);const m=Ap(h,["zoom","pitch","distance-from-center"]);if(!m&&!k(n))return b([new Cl("","zoom expressions not supported")]);const v=Ap(h,["measure-light"]);if(!v&&!C(n))return b([new Cl("","measure-light expression not supported")]);const w=n.expression&&n.expression.relaxZoomRestriction,E=Ne(h);return E||m||w?E instanceof Cl?b([E]):E instanceof ga&&!L(n)?b([new Cl("",'"interpolate" expressions cannot be used with this property')]):y(E?new Se(p?"camera":"composite",i.value,E.labels,E instanceof ga?E.interpolation:void 0,v):new Re(p?"constant":"source",i.value,v)):b([new Cl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ze{constructor(n,s){this._parameters=n,this._specification=s,vd(this,G(this._parameters,this._specification))}static deserialize(n){return new ze(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Ne(i){let n=null;if(i instanceof Lg)n=Ne(i.result);else if(i instanceof fh){for(const s of i.args)if(n=Ne(s),n)break}else(i instanceof Id||i instanceof ga)&&i.input instanceof Go&&i.input.name==="zoom"&&(n=i);return n instanceof Cl||i.eachChild(s=>{const u=Ne(s);u instanceof Cl?n=u:n&&u&&n!==u&&(n=new Cl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}var qe=Pe,Fe=3;function Pe(i,n,s){var u=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(n=h[1])+2*(s=h[2]);for(var p=0;p<this.d*this.d;p++){var m=h[Fe+p],v=h[Fe+p+1];u.push(m===v?null:h.subarray(m,v))}var w=h[Fe+u.length+1];this.keys=h.subarray(h[Fe+u.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=n+2*s;for(var E=0;E<this.d*this.d;E++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=i,this.padding=s,this.scale=n/i,this.uid=0;var A=s/n*i;this.min=-A,this.max=i+A}Pe.prototype.insert=function(i,n,s,u,h){this._forEachCell(n,s,u,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(h)},Pe.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Pe.prototype._insertCell=function(i,n,s,u,h,p){this.cells[h].push(p)},Pe.prototype.query=function(i,n,s,u,h){var p=this.min,m=this.max;if(i<=p&&n<=p&&m<=s&&m<=u&&!h)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(i,n,s,u,this._queryCell,v,{},h),v},Pe.prototype._queryCell=function(i,n,s,u,h,p,m,v){var w=this.cells[h];if(w!==null)for(var E=this.keys,A=this.bboxes,P=0;P<w.length;P++){var M=w[P];if(m[M]===void 0){var z=4*M;(v?v(A[z+0],A[z+1],A[z+2],A[z+3]):i<=A[z+2]&&n<=A[z+3]&&s>=A[z+0]&&u>=A[z+1])?(m[M]=!0,p.push(E[M])):m[M]=!1}}},Pe.prototype._forEachCell=function(i,n,s,u,h,p,m,v){for(var w=this._convertToCellCoord(i),E=this._convertToCellCoord(n),A=this._convertToCellCoord(s),P=this._convertToCellCoord(u),M=w;M<=A;M++)for(var z=E;z<=P;z++){var B=this.d*z+M;if((!v||v(this._convertFromCellCoord(M),this._convertFromCellCoord(z),this._convertFromCellCoord(M+1),this._convertFromCellCoord(z+1)))&&h.call(this,i,n,s,u,B,p,m,v))return}},Pe.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Pe.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Pe.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,n=Fe+this.cells.length+1+1,s=0,u=0;u<this.cells.length;u++)s+=this.cells[u].length;var h=new Int32Array(n+s+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=n,m=0;m<i.length;m++){var v=i[m];h[Fe+m]=p,h.set(v,p),p+=v.length}return h[Fe+i.length]=p,h.set(this.keys,p),h[Fe+i.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer};var Qe=pe(qe);const Xe={};function Ue(i,n,s={}){Object.defineProperty(i,"_classRegistryKey",{value:n,writable:!1}),Xe[n]={klass:i,omit:s.omit||[]}}Ue(Object,"Object"),Qe.serialize=function(i,n){const s=i.toArrayBuffer();return n&&n.add(s),{buffer:s}},Qe.deserialize=function(i){return new Qe(i.buffer)},Object.defineProperty(Qe,"name",{value:"Grid"}),Ue(Qe,"Grid"),Ue(Ar,"Color"),Ue(Error,"Error"),Ue(vo,"Formatted"),Ue(Tg,"FormattedSection"),Ue(gg,"AJAXError"),Ue(ua,"ResolvedImage"),Ue(ze,"StylePropertyFunction"),Ue(ye,"StyleExpression",{omit:["_evaluator"]}),Ue(Se,"ZoomDependentExpression"),Ue(Re,"ZoomConstantExpression"),Ue(Go,"CompoundExpression",{omit:["_evaluate"]});for(const i in Cd)Xe[Cd[i]._classRegistryKey]||Ue(Cd[i],`Expression${i}`);function _t(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function ut(i){return self.ImageBitmap&&i instanceof ImageBitmap}function We(i,n){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(_t(i)||ut(i))return n&&n.add(i),i;if(ArrayBuffer.isView(i)){const s=i;return n&&n.add(s.buffer),s}if(i instanceof ImageData)return n&&n.add(i.data.buffer),i;if(Array.isArray(i)){const s=[];for(const u of i)s.push(We(u,n));return s}if(i instanceof Map){const s={$name:"Map"};for(const[u,h]of i.entries())s[u]=We(h);return s}if(i instanceof Set){const s={$name:"Set"};let u=0;for(const h of i.values())s[++u]=We(h);return s}if(typeof i=="object"){const s=i.constructor,u=s._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const h=s.serialize?s.serialize(i,n):{};if(!s.serialize){for(const p in i)i.hasOwnProperty(p)&&(Xe[u].omit.indexOf(p)>=0||(h[p]=We(i[p],n)));i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(h.$name=u),h}throw new Error("can't serialize object of type "+typeof i)}function nt(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||_t(i)||ut(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(nt);if(typeof i=="object"){const n=i.$name||"Object";if(n==="Map"){const h=new Map;for(const p of Object.keys(i))p!=="$name"&&h.set(p,nt(i[p]));return h}if(n==="Set"){const h=new Set;for(const p of Object.keys(i))p!=="$name"&&h.add(nt(i[p]));return h}const{klass:s}=Xe[n];if(!s)throw new Error(`can't deserialize unregistered class ${n}`);if(s.deserialize)return s.deserialize(i);const u=Object.create(s.prototype);for(const h of Object.keys(i))h!=="$name"&&(u[h]=nt(i[h]));return u}throw new Error("can't deserialize object of type "+typeof i)}const je={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519,"CJK Unified Ideographs Extension B":i=>i>=131072&&i<=173791};function ht(i){for(const n of i)if(Bt(n.charCodeAt(0)))return!0;return!1}function ft(i){for(const n of i)if(!Nt(n.charCodeAt(0)))return!1;return!0}function Nt(i){return!(je.Arabic(i)||je["Arabic Supplement"](i)||je["Arabic Extended-A"](i)||je["Arabic Presentation Forms-A"](i)||je["Arabic Presentation Forms-B"](i))}function Bt(i){return!(i!==746&&i!==747&&(i<4352||!(je["Bopomofo Extended"](i)||je.Bopomofo(i)||je["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||je["CJK Compatibility Ideographs"](i)||je["CJK Compatibility"](i)||je["CJK Radicals Supplement"](i)||je["CJK Strokes"](i)||!(!je["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||je["CJK Unified Ideographs Extension A"](i)||je["CJK Unified Ideographs"](i)||je["Enclosed CJK Letters and Months"](i)||je["Hangul Compatibility Jamo"](i)||je["Hangul Jamo Extended-A"](i)||je["Hangul Jamo Extended-B"](i)||je["Hangul Jamo"](i)||je["Hangul Syllables"](i)||je.Hiragana(i)||je["Ideographic Description Characters"](i)||je.Kanbun(i)||je["Kangxi Radicals"](i)||je["Katakana Phonetic Extensions"](i)||je.Katakana(i)&&i!==12540||!(!je["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!je["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||je["Unified Canadian Aboriginal Syllabics"](i)||je["Unified Canadian Aboriginal Syllabics Extended"](i)||je["Vertical Forms"](i)||je["Yijing Hexagram Symbols"](i)||je["Yi Syllables"](i)||je["Yi Radicals"](i))))}function on(i){return!(Bt(i)||function(n){return!!(je["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||je["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||je["Letterlike Symbols"](n)||je["Number Forms"](n)||je["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||je["Control Pictures"](n)&&n!==9251||je["Optical Character Recognition"](n)||je["Enclosed Alphanumerics"](n)||je["Geometric Shapes"](n)||je["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||je["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||je["CJK Symbols and Punctuation"](n)||je.Katakana(n)||je["Private Use Area"](n)||je["CJK Compatibility Forms"](n)||je["Small Form Variants"](n)||je["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(i))}function Gt(i){return i>=1424&&i<=2303||je["Arabic Presentation Forms-A"](i)||je["Arabic Presentation Forms-B"](i)}function Tn(i,n){return!(!n&&Gt(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||je.Khmer(i))}function Vn(i){for(const n of i)if(Gt(n.charCodeAt(0)))return!0;return!1}const Sn="deferred",Zn="loading",pr="loaded";let ti=null,Vr="unavailable",gr=null;const jr=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Vr="error"),ti&&ti(i)};function Yn(){nr.fire(new Al("pluginStateChange",{pluginStatus:Vr,pluginURL:gr}))}const nr=new ah,$n=function(){return Vr},Tr=function(){if(Vr!==Sn||!gr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Vr=Zn,Yn(),gr&&rh({url:gr},i=>{i?jr(i):(Vr=pr,Yn())})},or={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Vr===pr||or.applyArabicShaping!=null,isLoading:()=>Vr===Zn,setState(i){Vr=i.pluginStatus,gr=i.pluginURL},isParsed:()=>or.applyArabicShaping!=null&&or.processBidirectionalText!=null&&or.processStyledBidirectionalText!=null,getPluginURL:()=>gr};class kn{constructor(n,s){this.zoom=n,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return function(s,u){for(const h of s)if(!Tn(h.charCodeAt(0),u))return!1;return!0}(n,or.isLoaded())}}class Gi{constructor(n,s,u,h){this.property=n,this.value=s,this.expression=function(p,m,v,w){if(N(p))return new ze(p,m);if(ve(p)||Array.isArray(p)&&p.length>0){const E=Ie(p,m,v,w);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));return E.value}{let E=p;return typeof p=="string"&&m.type==="color"&&(E=Ar.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>E}}}(s===void 0?n.specification.default:s,n.specification,u,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,s,u){return this.property.possiblyEvaluate(this,n,s,u)}}class qi{constructor(n,s,u){this.property=n,this.value=new Gi(n,void 0,s,u)}transitioned(n,s){return new lo(this.property,this.value,s,Rs({},n.transition,this.transition),n.now)}untransitioned(){return new lo(this.property,this.value,null,{},0)}}class ao{constructor(n,s,u){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=s,this._options=u,this.configDependencies=new Set}getValue(n){return Fs(this._values[n].value.value)}setValue(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new qi(this._values[n].property,this._scope,this._options)),this._values[n].value=new Gi(this._values[n].property,s===null?void 0:Fs(s),this._scope,this._options),this._values[n].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].value.expression.configDependencies]))}setTransitionOrValue(n,s){s&&(this._options=s);const u=this._properties.properties;if(n)for(const h in n){const p=n[h];if(Xa(h,"-transition")){const m=h.slice(0,-11);u[m]&&this.setTransition(m,p)}else u.hasOwnProperty(h)&&this.setValue(h,p)}}getTransition(n){return Fs(this._values[n].transition)}setTransition(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new qi(this._values[n].property)),this._values[n].transition=Fs(s)||void 0}serialize(){const n={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(n[s]=u);const h=this.getTransition(s);h!==void 0&&(n[`${s}-transition`]=h)}return n}transitioned(n,s){const u=new Hs(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].transitioned(n,s._values[h]);return u}untransitioned(){const n=new Hs(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].untransitioned();return n}}class lo{constructor(n,s,u,h,p){const m=h.delay||0,v=h.duration||0;p=p||0,this.property=n,this.value=s,this.begin=p+m,this.end=this.begin+v,n.specification.transition&&(h.delay||h.duration)&&(this.prior=u)}possiblyEvaluate(n,s,u){const h=n.now||0,p=this.value.possiblyEvaluate(n,s,u),m=this.prior;if(m){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return m.possiblyEvaluate(n,s,u);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(n,s,u),p,Ju(v))}}return p}}class Hs{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,s,u){const h=new Zs(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(n,s,u);return h}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class co{constructor(n,s,u){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=s,this._options=u,this.configDependencies=new Set}getValue(n){return Fs(this._values[n].value)}setValue(n,s){this._values[n]=new Gi(this._values[n].property,s===null?void 0:Fs(s),this._scope,this._options),this._values[n].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].expression.configDependencies]))}serialize(){const n={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(n[s]=u)}return n}possiblyEvaluate(n,s,u){const h=new Zs(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(n,s,u);return h}}class Bs{constructor(n,s,u){this.property=n,this.value=s,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,s,u,h){return this.property.evaluate(this.value,this.parameters,n,s,u,h)}}class Zs{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class xt{constructor(n){this.specification=n}possiblyEvaluate(n,s){return n.expression.evaluate(s)}interpolate(n,s,u){const h=fp[this.specification.type];return h?h(n,s,u):n}}class ln{constructor(n,s){this.specification=n,this.overrides=s}possiblyEvaluate(n,s,u,h){return new Bs(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(s,null,{},u,h)}:n.expression,s)}interpolate(n,s,u){if(n.value.kind!=="constant"||s.value.kind!=="constant")return n;if(n.value.value===void 0||s.value.value===void 0)return new Bs(this,{kind:"constant",value:void 0},n.parameters);const h=fp[this.specification.type];return h?new Bs(this,{kind:"constant",value:h(n.value.value,s.value.value,u)},n.parameters):n}evaluate(n,s,u,h,p,m){return n.kind==="constant"?n.value:n.evaluate(s,u,h,p,m)}}class xo{constructor(n){this.specification=n}possiblyEvaluate(n,s,u,h){return!!n.expression.evaluate(s,null,{},u,h)}interpolate(){return!1}}class Zr{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new kn(0,{});for(const u in n){const h=n[u];h.specification.overridable&&this.overridableProperties.push(u);const p=this.defaultPropertyValues[u]=new Gi(h,void 0),m=this.defaultTransitionablePropertyValues[u]=new qi(h);this.defaultTransitioningPropertyValues[u]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=p.possiblyEvaluate(s)}}}Ue(ln,"DataDrivenProperty"),Ue(xt,"DataConstantProperty"),Ue(xo,"ColorRampProperty");var Ke=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-line-alignment":{"type":"enum","values":{"inside":1,"outside":1,"center":1},"default":"center","property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function _c(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function el(i){if(Array.isArray(i))return i.map(el);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const n={};for(const s in i)n[s]=el(i[s]);return n}return _c(i)}function yc(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const n of i.slice(1))if(!yc(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function vc(i,n="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};yc(i)||(i=Pd(i));const s=i;let u=!0;try{u=function(E){if(!uu(E))return E;let A=el(E);return Vg(A),A=Ug(A),A}(s)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(s,null,2)}
        `)}const h=Ke[`filter_${n}`],p=_e(u,h);let m=null;if(p.result==="error")throw new Error(p.value.map(E=>`${E.key}: ${E.message}`).join(", "));m=(E,A,P)=>p.value.evaluate(E,A,{},P);let v=null,w=null;if(u!==s){const E=_e(s,h);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));v=(A,P,M,z,B)=>E.value.evaluate(A,P,{},M,void 0,void 0,z,B),w=!Sp(E.value.expression)}return{filter:m,dynamicFilter:v||void 0,needGeometry:$g(u),needFeature:!!w}}function Ug(i){if(!Array.isArray(i))return i;const n=function(s){if(z0.has(s[0])){for(let u=1;u<s.length;u++)if(uu(s[u]))return!0}return s}(i);return n===!0?n:n.map(s=>Ug(s))}function Vg(i){let n=!1;const s=[];if(i[0]==="case"){for(let u=1;u<i.length-1;u+=2)n=n||uu(i[u]),s.push(i[u+1]);s.push(i[i.length-1])}else if(i[0]==="match"){n=n||uu(i[1]);for(let u=2;u<i.length-1;u+=2)s.push(i[u+1]);s.push(i[i.length-1])}else if(i[0]==="step"){n=n||uu(i[1]);for(let u=1;u<i.length-1;u+=2)s.push(i[u+1])}n&&(i.length=0,i.push("any",...s));for(let u=1;u<i.length;u++)Vg(i[u])}function uu(i){if(!Array.isArray(i))return!1;if((n=i[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let s=1;s<i.length;s++)if(uu(i[s]))return!0;return!1}const z0=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ph(i,n){return i<n?-1:i>n?1:0}function $g(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let n=1;n<i.length;n++)if($g(i[n]))return!0;return!1}function Pd(i){if(!i)return!0;const n=i[0];return i.length<=1?n!=="any":n==="=="?OC(i[1],i[2],"=="):n==="!="?cw(OC(i[1],i[2],"==")):n==="<"||n===">"||n==="<="||n===">="?OC(i[1],i[2],n):n==="any"?(s=i.slice(1),["any"].concat(s.map(Pd))):n==="all"?["all"].concat(i.slice(1).map(Pd)):n==="none"?["all"].concat(i.slice(1).map(Pd).map(cw)):n==="in"?iz(i[1],i.slice(2)):n==="!in"?cw(iz(i[1],i.slice(2))):n==="has"?sz(i[1]):n!=="!has"||cw(sz(i[1]));var s}function OC(i,n,s){switch(i){case"$type":return[`filter-type-${s}`,n];case"$id":return[`filter-id-${s}`,n];default:return[`filter-${s}`,i,n]}}function iz(i,n){if(n.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(s=>typeof s!=typeof n[0])?["filter-in-large",i,["literal",n.sort(ph)]]:["filter-in-small",i,["literal",n]]}}function sz(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function cw(i){return["!",i]}const uw="";function oz(i,n){return n?`${i}${uw}${n}`:i}const az="-transition",IK=new Set(["fill","line","background","hillshade","raster"]);class _a extends ah{constructor(n,s,u,h,p){if(super(),this.id=n.id,this.fqid=oz(this.id,u),this.type=n.type,this.scope=u,this.lut=h,this.options=p,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),n.slot&&(this.slot=n.slot),s.layout&&(this._unevaluatedLayout=new co(s.layout,this.scope,p),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),s.paint)){this._transitionablePaint=new ao(s.paint,this.scope,p);for(const m in n.paint)this.setPaintProperty(m,n.paint[m]);for(const m in n.layout)this.setLayoutProperty(m,n.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Zs(s.paint)}}onAdd(n){}onRemove(n){}isDraped(n){return IK.has(this.type)}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,s){if(this.type==="custom"&&n==="visibility")return void(this.visibility=s);const u=this._unevaluatedLayout;u._properties.properties[n]&&(u.setValue(n,s),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),n==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(n){return Xa(n,az)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,s){const u=this._transitionablePaint,h=u._properties.properties;if(Xa(n,az)){const P=n.slice(0,-11);return h[P]&&u.setTransition(P,s||void 0),!1}if(!h[n])return!1;const p=u._values[n],m=p.value.isDataDriven(),v=p.value;u.setValue(n,s),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(n);const w=u._values[n].value,E=w.isDataDriven(),A=Xa(n,"pattern")||n==="line-dasharray";return E||m||A||this._handleOverridablePaintPropertyUpdate(n,v,w)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,s,u){return null}_handleOverridablePaintPropertyUpdate(n,s,u){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,s)}serialize(){return Ms({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(n,s)=>!(n===void 0||s==="layout"&&!Object.keys(n).length||s==="paint"&&!Object.keys(n).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const n in this.paint._values){const s=this.paint.get(n);if(s instanceof Bs&&S(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=vc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(n){this._stats&&(n.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(n){}queryIntersectsFeature(n,s,u,h,p,m,v,w,E){}queryIntersectsMatchingFeature(n,s,u,h){}}const AK={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class N0{constructor(n,s){this._structArray=n,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class pi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,s){return n._trim(),s&&(n.isTransferred=!0,s.add(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const s=Object.create(this.prototype);return s.arrayBuffer=n.arrayBuffer,s.length=n.length,s.capacity=n.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...n){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...n){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Lr(i,n=1){let s=0,u=0;return{members:i.map(h=>{const p=AK[h.type].BYTES_PER_ELEMENT,m=s=lz(s,Math.max(n,p)),v=h.components||1;return u=Math.max(u,p),s+=p*v,{name:h.name,type:h.type,components:v,offset:m}}),size:lz(s,Math.max(u,n)),alignment:n}}function lz(i,n){return Math.ceil(i/n)*n}class xc extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s){const u=this.length;return this.resize(u+1),this.emplace(u,n,s)}emplace(n,s,u){const h=2*n;return this.int16[h+0]=s,this.int16[h+1]=u,n}}xc.prototype.bytesPerElement=4,Ue(xc,"StructArrayLayout2i4");class hw extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,u)}emplace(n,s,u,h){const p=3*n;return this.int16[p+0]=s,this.int16[p+1]=u,this.int16[p+2]=h,n}}hw.prototype.bytesPerElement=6,Ue(hw,"StructArrayLayout3i6");class mh extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,u,h)}emplace(n,s,u,h,p){const m=4*n;return this.int16[m+0]=s,this.int16[m+1]=u,this.int16[m+2]=h,this.int16[m+3]=p,n}}mh.prototype.bytesPerElement=8,Ue(mh,"StructArrayLayout4i8");class LC extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,s,u,h,p)}emplace(n,s,u,h,p,m){const v=5*n;return this.int16[v+0]=s,this.int16[v+1]=u,this.int16[v+2]=h,this.int16[v+3]=p,this.int16[v+4]=m,n}}LC.prototype.bytesPerElement=10,Ue(LC,"StructArrayLayout5i10");class zC extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,s,u,h,p,m,v)}emplace(n,s,u,h,p,m,v,w){const E=6*n,A=12*n,P=3*n;return this.int16[E+0]=s,this.int16[E+1]=u,this.uint8[A+4]=h,this.uint8[A+5]=p,this.uint8[A+6]=m,this.uint8[A+7]=v,this.float32[P+2]=w,n}}zC.prototype.bytesPerElement=12,Ue(zC,"StructArrayLayout2i4ub1f12");class Rd extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,u,h)}emplace(n,s,u,h,p){const m=4*n;return this.float32[m+0]=s,this.float32[m+1]=u,this.float32[m+2]=h,this.float32[m+3]=p,n}}Rd.prototype.bytesPerElement=16,Ue(Rd,"StructArrayLayout4f16");class Md extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,u)}emplace(n,s,u,h){const p=3*n;return this.float32[p+0]=s,this.float32[p+1]=u,this.float32[p+2]=h,n}}Md.prototype.bytesPerElement=12,Ue(Md,"StructArrayLayout3f12");class kd extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,s,u,h,p)}emplace(n,s,u,h,p,m){const v=6*n,w=3*n;return this.uint16[v+0]=s,this.uint16[v+1]=u,this.uint16[v+2]=h,this.uint16[v+3]=p,this.float32[w+2]=m,n}}kd.prototype.bytesPerElement=12,Ue(kd,"StructArrayLayout4ui1f12");class dw extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,u,h)}emplace(n,s,u,h,p){const m=4*n;return this.uint16[m+0]=s,this.uint16[m+1]=u,this.uint16[m+2]=h,this.uint16[m+3]=p,n}}dw.prototype.bytesPerElement=8,Ue(dw,"StructArrayLayout4ui8");class fw extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u,h,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,s,u,h,p,m)}emplace(n,s,u,h,p,m,v){const w=6*n;return this.int16[w+0]=s,this.int16[w+1]=u,this.int16[w+2]=h,this.int16[w+3]=p,this.int16[w+4]=m,this.int16[w+5]=v,n}}fw.prototype.bytesPerElement=12,Ue(fw,"StructArrayLayout6i12");class NC extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,u,h,p,m,v,w,E,A,P,M){const z=this.length;return this.resize(z+1),this.emplace(z,n,s,u,h,p,m,v,w,E,A,P,M)}emplace(n,s,u,h,p,m,v,w,E,A,P,M,z){const B=12*n;return this.int16[B+0]=s,this.int16[B+1]=u,this.int16[B+2]=h,this.int16[B+3]=p,this.uint16[B+4]=m,this.uint16[B+5]=v,this.uint16[B+6]=w,this.uint16[B+7]=E,this.int16[B+8]=A,this.int16[B+9]=P,this.int16[B+10]=M,this.int16[B+11]=z,n}}NC.prototype.bytesPerElement=24,Ue(NC,"StructArrayLayout4i4ui4i24");class FC extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,s,u,h,p,m)}emplace(n,s,u,h,p,m,v){const w=10*n,E=5*n;return this.int16[w+0]=s,this.int16[w+1]=u,this.int16[w+2]=h,this.float32[E+2]=p,this.float32[E+3]=m,this.float32[E+4]=v,n}}FC.prototype.bytesPerElement=20,Ue(FC,"StructArrayLayout3i3f20");class BC extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint32[1*n+0]=s,n}}BC.prototype.bytesPerElement=4,Ue(BC,"StructArrayLayout1ul4");class Dd extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s){const u=this.length;return this.resize(u+1),this.emplace(u,n,s)}emplace(n,s,u){const h=2*n;return this.uint16[h+0]=s,this.uint16[h+1]=u,n}}Dd.prototype.bytesPerElement=4,Ue(Dd,"StructArrayLayout2ui4");class jC extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,u,h,p,m,v,w,E,A,P,M,z){const B=this.length;return this.resize(B+1),this.emplace(B,n,s,u,h,p,m,v,w,E,A,P,M,z)}emplace(n,s,u,h,p,m,v,w,E,A,P,M,z,B){const U=20*n,$=10*n;return this.int16[U+0]=s,this.int16[U+1]=u,this.int16[U+2]=h,this.int16[U+3]=p,this.int16[U+4]=m,this.float32[$+3]=v,this.float32[$+4]=w,this.float32[$+5]=E,this.float32[$+6]=A,this.int16[U+14]=P,this.uint32[$+8]=M,this.uint16[U+18]=z,this.uint16[U+19]=B,n}}jC.prototype.bytesPerElement=40,Ue(jC,"StructArrayLayout5i4f1i1ul2ui40");class pw extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u,h,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,s,u,h,p,m,v)}emplace(n,s,u,h,p,m,v,w){const E=8*n;return this.int16[E+0]=s,this.int16[E+1]=u,this.int16[E+2]=h,this.int16[E+4]=p,this.int16[E+5]=m,this.int16[E+6]=v,this.int16[E+7]=w,n}}pw.prototype.bytesPerElement=16,Ue(pw,"StructArrayLayout3i2i2i16");class UC extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,s,u,h,p)}emplace(n,s,u,h,p,m){const v=4*n,w=8*n;return this.float32[v+0]=s,this.float32[v+1]=u,this.float32[v+2]=h,this.int16[w+6]=p,this.int16[w+7]=m,n}}UC.prototype.bytesPerElement=16,Ue(UC,"StructArrayLayout2f1f2i16");class VC extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,u,h)}emplace(n,s,u,h,p){const m=12*n,v=3*n;return this.uint8[m+0]=s,this.uint8[m+1]=u,this.float32[v+1]=h,this.float32[v+2]=p,n}}VC.prototype.bytesPerElement=12,Ue(VC,"StructArrayLayout2ub2f12");class js extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,u)}emplace(n,s,u,h){const p=3*n;return this.uint16[p+0]=s,this.uint16[p+1]=u,this.uint16[p+2]=h,n}}js.prototype.bytesPerElement=6,Ue(js,"StructArrayLayout3ui6");class $C extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,p,m,v,w,E,A,P,M,z,B,U,$,Y,fe,he,me,Ae){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,n,s,u,h,p,m,v,w,E,A,P,M,z,B,U,$,Y,fe,he,me,Ae)}emplace(n,s,u,h,p,m,v,w,E,A,P,M,z,B,U,$,Y,fe,he,me,Ae,Ce){const Le=30*n,Ve=15*n,He=60*n;return this.int16[Le+0]=s,this.int16[Le+1]=u,this.int16[Le+2]=h,this.float32[Ve+2]=p,this.float32[Ve+3]=m,this.uint16[Le+8]=v,this.uint16[Le+9]=w,this.uint32[Ve+5]=E,this.uint32[Ve+6]=A,this.uint32[Ve+7]=P,this.uint16[Le+16]=M,this.uint16[Le+17]=z,this.uint16[Le+18]=B,this.float32[Ve+10]=U,this.float32[Ve+11]=$,this.uint8[He+48]=Y,this.uint8[He+49]=fe,this.uint8[He+50]=he,this.uint32[Ve+13]=me,this.int16[Le+28]=Ae,this.uint8[He+58]=Ce,n}}$C.prototype.bytesPerElement=60,Ue($C,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class GC extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,p,m,v,w,E,A,P,M,z,B,U,$,Y,fe,he,me,Ae,Ce,Le,Ve,He,et,Ze,st,yt,ot,bt,rt){const dt=this.length;return this.resize(dt+1),this.emplace(dt,n,s,u,h,p,m,v,w,E,A,P,M,z,B,U,$,Y,fe,he,me,Ae,Ce,Le,Ve,He,et,Ze,st,yt,ot,bt,rt)}emplace(n,s,u,h,p,m,v,w,E,A,P,M,z,B,U,$,Y,fe,he,me,Ae,Ce,Le,Ve,He,et,Ze,st,yt,ot,bt,rt,dt){const It=20*n,at=40*n,Ot=80*n;return this.float32[It+0]=s,this.float32[It+1]=u,this.int16[at+4]=h,this.int16[at+5]=p,this.int16[at+6]=m,this.int16[at+7]=v,this.int16[at+8]=w,this.int16[at+9]=E,this.int16[at+10]=A,this.int16[at+11]=P,this.int16[at+12]=M,this.uint16[at+13]=z,this.uint16[at+14]=B,this.uint16[at+15]=U,this.uint16[at+16]=$,this.uint16[at+17]=Y,this.uint16[at+18]=fe,this.uint16[at+19]=he,this.uint16[at+20]=me,this.uint16[at+21]=Ae,this.uint16[at+22]=Ce,this.uint16[at+23]=Le,this.uint16[at+24]=Ve,this.uint16[at+25]=He,this.uint16[at+26]=et,this.uint16[at+27]=Ze,this.uint32[It+14]=st,this.float32[It+15]=yt,this.float32[It+16]=ot,this.float32[It+17]=bt,this.float32[It+18]=rt,this.uint8[Ot+76]=dt,n}}GC.prototype.bytesPerElement=80,Ue(GC,"StructArrayLayout2f9i15ui1ul4f1ub80");class Gg extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.float32[1*n+0]=s,n}}Gg.prototype.bytesPerElement=4,Ue(Gg,"StructArrayLayout1f4");class Lp extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,s,u,h,p)}emplace(n,s,u,h,p,m){const v=5*n;return this.float32[v+0]=s,this.float32[v+1]=u,this.float32[v+2]=h,this.float32[v+3]=p,this.float32[v+4]=m,n}}Lp.prototype.bytesPerElement=20,Ue(Lp,"StructArrayLayout5f20");class qC extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,s,u,h,p,m,v)}emplace(n,s,u,h,p,m,v,w){const E=7*n;return this.float32[E+0]=s,this.float32[E+1]=u,this.float32[E+2]=h,this.float32[E+3]=p,this.float32[E+4]=m,this.float32[E+5]=v,this.float32[E+6]=w,n}}qC.prototype.bytesPerElement=28,Ue(qC,"StructArrayLayout7f28");class WC extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,u,h)}emplace(n,s,u,h,p){const m=6*n;return this.uint32[3*n+0]=s,this.uint16[m+2]=u,this.uint16[m+3]=h,this.uint16[m+4]=p,n}}WC.prototype.bytesPerElement=12,Ue(WC,"StructArrayLayout1ul3ui12");class F0 extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint16[1*n+0]=s,n}}F0.prototype.bytesPerElement=2,Ue(F0,"StructArrayLayout1ui2");class B0 extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s){const u=this.length;return this.resize(u+1),this.emplace(u,n,s)}emplace(n,s,u){const h=2*n;return this.float32[h+0]=s,this.float32[h+1]=u,n}}B0.prototype.bytesPerElement=8,Ue(B0,"StructArrayLayout2f8");class HC extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,p,m,v,w,E,A,P,M,z,B,U,$){const Y=this.length;return this.resize(Y+1),this.emplace(Y,n,s,u,h,p,m,v,w,E,A,P,M,z,B,U,$)}emplace(n,s,u,h,p,m,v,w,E,A,P,M,z,B,U,$,Y){const fe=16*n;return this.float32[fe+0]=s,this.float32[fe+1]=u,this.float32[fe+2]=h,this.float32[fe+3]=p,this.float32[fe+4]=m,this.float32[fe+5]=v,this.float32[fe+6]=w,this.float32[fe+7]=E,this.float32[fe+8]=A,this.float32[fe+9]=P,this.float32[fe+10]=M,this.float32[fe+11]=z,this.float32[fe+12]=B,this.float32[fe+13]=U,this.float32[fe+14]=$,this.float32[fe+15]=Y,n}}HC.prototype.bytesPerElement=64,Ue(HC,"StructArrayLayout16f64");class mw extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,u,h,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,s,u,h,p,m,v)}emplace(n,s,u,h,p,m,v,w){const E=10*n,A=5*n;return this.uint16[E+0]=s,this.uint16[E+1]=u,this.uint16[E+2]=h,this.uint16[E+3]=p,this.float32[A+2]=m,this.float32[A+3]=v,this.float32[A+4]=w,n}}mw.prototype.bytesPerElement=20,Ue(mw,"StructArrayLayout4ui3f20");class ZC extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.int16[1*n+0]=s,n}}ZC.prototype.bytesPerElement=2,Ue(ZC,"StructArrayLayout1i2");class XC extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint8[1*n+0]=s,n}}XC.prototype.bytesPerElement=1,Ue(XC,"StructArrayLayout1ub1");class cz extends N0{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}cz.prototype.size=40;class KC extends jC{get(n){return new cz(this,n)}}Ue(KC,"CollisionBoxArray");class uz extends N0{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}uz.prototype.size=60;class hz extends $C{get(n){return new uz(this,n)}}Ue(hz,"PlacedSymbolArray");class dz extends N0{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}dz.prototype.size=80;class fz extends GC{get(n){return new dz(this,n)}}Ue(fz,"SymbolInstanceArray");class pz extends Gg{getoffsetX(n){return this.float32[1*n+0]}}Ue(pz,"GlyphOffsetArray");class mz extends xc{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}Ue(mz,"SymbolLineVertexArray");class gz extends N0{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}gz.prototype.size=12;class _z extends WC{get(n){return new gz(this,n)}}Ue(_z,"FeatureIndexArray");class yz extends Dd{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}Ue(yz,"FillExtrusionCentroidArray");class vz extends N0{get a_join_normal_inside_polygon0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside_polygon1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside_polygon2(){return this._structArray.int16[this._pos2+2]}get a_join_normal_inside_polygon3(){return this._structArray.int16[this._pos2+3]}}vz.prototype.size=8;class xz extends mh{get(n){return new vz(this,n)}}Ue(xz,"FillExtrusionWallArray");const CK=Lr([{name:"a_pos",components:2,type:"Int16"}],4),PK=Lr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class wi{constructor(n=[]){this.segments=n}_prepareSegment(n,s,u,h){let p=this.segments[this.segments.length-1];return n>wi.MAX_VERTEX_ARRAY_LENGTH&&Ii(`Max vertices per segment is ${wi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!p||p.vertexLength+n>wi.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:s,primitiveOffset:u,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}prepareSegment(n,s,u,h){return this._prepareSegment(n,s.length,u.length,h)}get(){return this.segments}destroy(){for(const n of this.segments)for(const s in n.vaos)n.vaos[s].destroy()}static simpleSegment(n,s,u,h){return new wi([{vertexOffset:n,primitiveOffset:s,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])}}function bz(i,n){return 256*(i=Kn(Math.floor(i),0,255))+Kn(Math.floor(n),0,255)}wi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ue(wi,"SegmentVector");const RK=Lr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),MK=Lr([{name:"a_dash",components:4,type:"Uint16"}]);class j0{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,s,u,h){this.ids.push(wz(n)),this.positions.push(s,u,h)}eachPosition(n,s){const u=wz(n);let h=0,p=this.ids.length-1;for(;h<p;){const m=h+p>>1;this.ids[m]>=u?p=m:h=m+1}for(;this.ids[h]===u;)s(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(n,s){const u=new Float64Array(n.ids),h=new Uint32Array(n.positions);return YC(u,h,0,u.length-1),s&&(s.add(u.buffer),s.add(h.buffer)),{ids:u,positions:h}}static deserialize(n){const s=new j0;let u;s.ids=n.ids,s.positions=n.positions;for(const h of s.ids)h!==u&&s.uniqueIds.push(h),u=h;return s.indexed=!0,s}}function wz(i){const n=+i;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:_g(String(i))}function YC(i,n,s,u){for(;s<u;){const h=i[s+u>>1];let p=s-1,m=u+1;for(;;){do p++;while(i[p]<h);do m--;while(i[m]>h);if(p>=m)break;gw(i,p,m),gw(n,3*p,3*m),gw(n,3*p+1,3*m+1),gw(n,3*p+2,3*m+2)}m-s<u-m?(YC(i,n,s,m),s=m+1):(YC(i,n,m+1,u),u=m)}}function gw(i,n,s){const u=i[n];i[n]=i[s],i[s]=u}Ue(j0,"FeaturePositionMap");class gh{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,s),this.initialized=!0),!!this.location}set(n,s,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class _w extends gh{constructor(n){super(n),this.current=0}set(n,s,u){this.fetchUniformLocation(n,s)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class qo extends gh{constructor(n){super(n),this.current=0}set(n,s,u){this.fetchUniformLocation(n,s)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class _h extends gh{constructor(n){super(n),this.current=[0,0]}set(n,s,u){this.fetchUniformLocation(n,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class QC extends gh{constructor(n){super(n),this.current=[0,0,0]}set(n,s,u){this.fetchUniformLocation(n,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class JC extends gh{constructor(n){super(n),this.current=[0,0,0,0]}set(n,s,u){this.fetchUniformLocation(n,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Tz extends gh{constructor(n){super(n),this.current=Ar.transparent.toRenderColor(null)}set(n,s,u){this.fetchUniformLocation(n,s)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const kK=new Float32Array(16);class U0 extends gh{constructor(n){super(n),this.current=kK}set(n,s,u){if(this.fetchUniformLocation(n,s)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const DK=new Float32Array(9),OK=new Float32Array(4);class eP extends gh{constructor(n){super(n),this.current=OK}set(n,s,u){if(this.fetchUniformLocation(n,s)){for(let h=0;h<4;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function tP(i){return[bz(255*i.r,255*i.g),bz(255*i.b,255*i.a)]}class V0{constructor(n,s,u,h){this.value=n,this.uniformNames=s.map(p=>`u_${p}`),this.type=u,this.context=h}setUniform(n,s,u,h,p){const m=h.constantOr(this.value);s.set(n,p,m instanceof Ar?m.toRenderColor(this.context.lut):m)}getBinding(n,s){return this.type==="color"?new Tz(n):new qo(n)}}class qg{constructor(n,s){this.uniformNames=s.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(n){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br)}setUniform(n,s,u,h,p){const m=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;m&&s.set(n,p,m)}getBinding(n,s){return s==="u_pattern"||s==="u_dash"?new JC(n):new qo(n)}}class yh{constructor(n,s,u,h){this.expression=n,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(p=>({name:`a_${p}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(n,s,u,h,p,m,v){const w=this.paintVertexArray.length,E=this.expression.evaluate(new kn(0,{brightness:m}),s,{},p,h,v);this.paintVertexArray.resize(n),this._setPaintValue(w,n,E,this.context)}updatePaintArray(n,s,u,h,p,m,v){const w=this.expression.evaluate({zoom:0,brightness:v},u,h,void 0,p);this._setPaintValue(n,s,w,this.context)}_setPaintValue(n,s,u,h){if(this.type==="color"){const p=tP(u.toRenderColor(h.lut));for(let m=n;m<s;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=n;p<s;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class bc{constructor(n,s,u,h,p,m){this.expression=n,this.uniformNames=s.map(v=>`u_${v}_t`),this.type=u,this.useIntegerZoom=h,this.context=p,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(n,s,u,h,p,m,v){const w=this.expression.evaluate(new kn(this.context.zoom,{brightness:m}),s,{},p,h,v),E=this.expression.evaluate(new kn(this.context.zoom+1,{brightness:m}),s,{},p,h,v),A=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(A,n,w,E,this.context)}updatePaintArray(n,s,u,h,p,m,v){const w=this.expression.evaluate({zoom:this.context.zoom,brightness:v},u,h,void 0,p),E=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v},u,h,void 0,p);this._setPaintValue(n,s,w,E,this.context)}_setPaintValue(n,s,u,h,p){if(this.type==="color"){const m=tP(u.toRenderColor(p.lut)),v=tP(u.toRenderColor(p.lut));for(let w=n;w<s;w++)this.paintVertexArray.emplace(w,m[0],m[1],v[0],v[1])}else{for(let m=n;m<s;m++)this.paintVertexArray.emplace(m,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,s,u,h,p){const m=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,v=Kn(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);s.set(n,p,v)}getBinding(n,s){return new qo(n)}}class Od{constructor(n,s,u,h,p){this.expression=n,this.layerId=p,this.paintVertexAttributes=(u==="array"?MK:RK).members;for(let m=0;m<s.length;++m);this.paintVertexArray=new h}populatePaintArray(n,s,u,h){const p=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(p,n,s.patterns&&s.patterns[this.layerId],u)}updatePaintArray(n,s,u,h,p,m,v){this._setPaintValues(n,s,u.patterns&&u.patterns[this.layerId],m)}_setPaintValues(n,s,u,h){if(!h||!u)return;const p=h[u];if(!p)return;const{tl:m,br:v,pixelRatio:w}=p;for(let E=n;E<s;E++)this.paintVertexArray.emplace(E,m[0],m[1],v[0],v[1],w)}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class zp{constructor(n,s,u=()=>!0){this.binders={},this._buffers=[],this.context=s;const h=[];for(const p in n.paint._values){const m=n.paint.get(p);if(!u(p)||!(m instanceof Bs&&S(m.property.specification)))continue;const v=zK(p,n.type),w=m.value,E=m.property.specification.type,A=!!m.property.useIntegerZoom,P=p==="line-dasharray"||p.endsWith("pattern"),M=p==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(w.kind!=="constant"||M)if(w.kind==="source"||M||P){const z=Ez(p,E,"source");this.binders[p]=P?new Od(w,v,E,z,n.id):new yh(w,v,E,z),h.push(`/a_${p}`)}else{const z=Ez(p,E,"composite");this.binders[p]=new bc(w,v,E,A,s,z),h.push(`/z_${p}`)}else this.binders[p]=P?new qg(w.value,v):new V0(w.value,v,E,s),h.push(`/u_${p}`)}this.cacheKey=h.sort().join("")}getMaxValue(n){const s=this.binders[n];return s instanceof yh||s instanceof bc?s.maxValue:0}populatePaintArrays(n,s,u,h,p,m,v){for(const w in this.binders){const E=this.binders[w];E.context=this.context,(E instanceof yh||E instanceof bc||E instanceof Od)&&E.populatePaintArray(n,s,u,h,p,m,v)}}setConstantPatternPositions(n){for(const s in this.binders){const u=this.binders[s];u instanceof qg&&u.setConstantPatternPositions(n)}}updatePaintArrays(n,s,u,h,p,m,v,w){let E=!1;const A=Object.keys(n),P=A.length!==0,M=P?A:s.uniqueIds;this.context.lut=p.lut;for(const z in this.binders){const B=this.binders[z];if(B.context=this.context,(B instanceof yh||B instanceof bc||B instanceof Od)&&(B.expression.isStateDependent===!0||B.expression.isLightConstant===!1)){const U=p.paint.get(z);B.expression=U.value;for(const $ of M){const Y=n[$.toString()];s.eachPosition($,(fe,he,me)=>{const Ae=h.feature(fe);B.updatePaintArray(he,me,Ae,Y,m,v,w)})}if(!P)for(const $ of u.uniqueIds){const Y=n[$.toString()];u.eachPosition($,(fe,he,me)=>{const Ae=h.feature(fe);B.updatePaintArray(he,me,Ae,Y,m,v,w)})}E=!0}}return E}defines(){const n=[];for(const s in this.binders){const u=this.binders[s];(u instanceof V0||u instanceof qg)&&n.push(...u.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return n}getBinderAttributes(){const n=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof yh||u instanceof bc||u instanceof Od)for(let h=0;h<u.paintVertexAttributes.length;h++)n.push(u.paintVertexAttributes[h].name)}return n}getBinderUniforms(){const n=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof V0||u instanceof qg||u instanceof bc)for(const h of u.uniformNames)n.push(h)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const s=[];for(const u in this.binders){const h=this.binders[u];if(h instanceof V0||h instanceof qg||h instanceof bc)for(const p of h.uniformNames)s.push({name:p,property:u,binding:h.getBinding(n,p)})}return s}setUniforms(n,s,u,h,p){for(const{name:m,property:v,binding:w}of u)this.binders[v].setUniform(n,w,p,h.get(v),m)}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const s=this.binders[n];(s instanceof yh||s instanceof bc||s instanceof Od)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(n){for(const s in this.binders){const u=this.binders[s];(u instanceof yh||u instanceof bc||u instanceof Od)&&u.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const s=this.binders[n];(s instanceof yh||s instanceof bc||s instanceof Od)&&s.destroy()}}}class Ld{constructor(n,s,u=()=>!0){this.programConfigurations={};for(const h of n)this.programConfigurations[h.id]=new zp(h,s,u);this.needsUpload=!1,this._featureMap=new j0,this._featureMapWithoutIds=new j0,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,s,u,h,p,m,v,w){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(n,s,h,p,m,v,w);s.id!==void 0?this._featureMap.add(s.id,u,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,s,u,h,p,m){for(const v of u)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,s,v,h,p,m||0)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const LK={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function zK(i,n){return LK[i]||[i.replace(`${n}-`,"").replace(/-/g,"_")]}const NK={"line-pattern":{source:kd,composite:kd},"fill-pattern":{source:kd,composite:kd},"fill-extrusion-pattern":{source:kd,composite:kd},"line-dasharray":{source:dw,composite:dw}},FK={color:{source:B0,composite:Rd},number:{source:Gg,composite:B0}};function Ez(i,n,s){const u=NK[i];return u&&u[s]||FK[n][s]}Ue(V0,"ConstantBinder"),Ue(qg,"PatternConstantBinder"),Ue(yh,"SourceExpressionBinder"),Ue(Od,"PatternCompositeBinder"),Ue(bc,"CompositeExpressionBinder"),Ue(zp,"ProgramConfiguration",{omit:["_buffers"]}),Ue(Ld,"ProgramConfigurationSet");const Wo=Mt/Math.PI/2,nP=5,Sz=6,BK=16383,Wg=64,rP=[Wg,32,16],Rl=-Wo,Ml=Wo;function Hg(i,n,s,u=Wo){return s=sr(s),[i*Math.sin(s)*u,-n*u,i*Math.cos(s)*u]}function Np(i,n,s){return Hg(Math.cos(sr(i)),Math.sin(sr(i)),n,s)}const Zg=63710088e-1,iP=2*Math.PI*Zg;class Sr{constructor(n,s){if(isNaN(n)||isNaN(s))throw new Error(`Invalid LngLat object: (${n}, ${s})`);if(this.lng=+n,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Sr(oc(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const s=Math.PI/180,u=this.lat*s,h=n.lat*s,p=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((n.lng-this.lng)*s);return Zg*Math.acos(Math.min(p,1))}toBounds(n=0){const s=360*n/40075017,u=s/Math.cos(Math.PI/180*this.lat);return new zd({lng:this.lng-u,lat:this.lat-s},{lng:this.lng+u,lat:this.lat+s})}toEcef(n){return Np(this.lat,this.lng,Wo+n*Wo/Zg)}static convert(n){if(n instanceof Sr)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Sr(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Sr(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class zd{constructor(n,s){if(n)if(s)this.setSouthWest(n).setNorthEast(s);else if(n.length===4){const u=n;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=n;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(n){return this._ne=n instanceof Sr?new Sr(n.lng,n.lat):Sr.convert(n),this}setSouthWest(n){return this._sw=n instanceof Sr?new Sr(n.lng,n.lat):Sr.convert(n),this}extend(n){const s=this._sw,u=this._ne;let h,p;if(n instanceof Sr)h=n,p=n;else{if(!(n instanceof zd))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(zd.convert(n)):this.extend(Sr.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(Sr.convert(n)):this;if(h=n._sw,p=n._ne,!h||!p)return this}return s||u?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),u.lng=Math.max(p.lng,u.lng),u.lat=Math.max(p.lat,u.lat)):(this._sw=new Sr(h.lng,h.lat),this._ne=new Sr(p.lng,p.lat)),this}getCenter(){return new Sr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Sr(this.getWest(),this.getNorth())}getSouthEast(){return new Sr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:s,lat:u}=Sr.convert(n);let h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(n){return!n||n instanceof zd?n:new zd(n)}}var Iz={};(function(i,n){(function(s){function u(p,m,v){var w=h(256*p,256*(m=Math.pow(2,v)-m-1),v),E=h(256*(p+1),256*(m+1),v);return w[0]+","+w[1]+","+E[0]+","+E[1]}function h(p,m,v){var w=2*Math.PI*6378137/256/Math.pow(2,v);return[p*w-2*Math.PI*6378137/2,m*w-2*Math.PI*6378137/2]}s.getURL=function(p,m,v,w,E,A){return A=A||{},p+"?"+["bbox="+u(v,w,E),"format="+(A.format||"image/png"),"service="+(A.service||"WMS"),"version="+(A.version||"1.1.1"),"request="+(A.request||"GetMap"),"srs="+(A.srs||"EPSG:3857"),"width="+(A.width||256),"height="+(A.height||256),"layers="+m].join("&")},s.getTileBBox=u,s.getMercCoords=h,Object.defineProperty(s,"__esModule",{value:!0})})(n)})(0,Iz);var jK=Iz;class Fp{constructor(n,s,u){this.z=n,this.x=s,this.y=u,this.key=Xg(0,n,n,s,u)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,s){const u=jK.getTileBBox(this.x,this.y,this.z),h=function(p,m,v){let w,E="";for(let A=p;A>0;A--)w=1<<A-1,E+=(m&w?1:0)+(v&w?2:0);return E}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Az{constructor(n,s){this.wrap=n,this.canonical=s,this.key=Xg(n,s.z,s.z,s.x,s.y)}}class ws{constructor(n,s,u,h,p){this.overscaledZ=n,this.wrap=s,this.canonical=new Fp(u,+h,+p),this.key=s===0&&n===u?this.canonical.key:Xg(s,n,u,h,p)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const s=this.canonical.z-n;return n>this.canonical.z?new ws(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ws(n,this.wrap,n,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(n,s=!0){if(this.overscaledZ===n&&s)return this.key;if(n>this.canonical.z)return Xg(this.wrap*+s,n,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-n;return Xg(this.wrap*+s,n,n,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const s=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>s&&n.canonical.y===this.canonical.y>>s}children(n){if(this.overscaledZ>=n)return[new ws(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new ws(s,this.wrap,s,u,h),new ws(s,this.wrap,s,u+1,h),new ws(s,this.wrap,s,u,h+1),new ws(s,this.wrap,s,u+1,h+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new ws(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new ws(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Az(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Xg(i,n,s,u,h){const p=1<<Math.min(s,22);let m=p*(h%p)+u%p;return i&&s<22&&(m+=p*p*((i<0?-2*i-1:2*i)%(1<<2*(22-s)))),16*(32*m+s)+(n-s)}const UK=[i=>{let n=i.canonical.x-1,s=i.wrap;return n<0&&(n=(1<<i.canonical.z)-1,s--),new ws(i.overscaledZ,s,i.canonical.z,n,i.canonical.y)},i=>{let n=i.canonical.x+1,s=i.wrap;return n===1<<i.canonical.z&&(n=0,s++),new ws(i.overscaledZ,s,i.canonical.z,n,i.canonical.y)},i=>new ws(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,(i.canonical.y===0?1<<i.canonical.z:i.canonical.y)-1),i=>new ws(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y===(1<<i.canonical.z)-1?0:i.canonical.y+1)];Ue(Fp,"CanonicalTileID"),Ue(ws,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const VK=0,$K=25.5;function sP(i){return iP*Math.cos(i*Math.PI/180)}function hu(i){return(180+i)/360}function du(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Ho(i,n){return i/sP(n)}function ya(i){return 360*i-180}function Xs(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Cz(i,n){return i*sP(Xs(n))}const Wi=85.051129;function Pz(i){return Math.cos(sr(Kn(i,-Wi,Wi)))}function Bp(i,n){const s=Kn(n,VK,$K),u=Math.pow(2,s);return Pz(i)*iP/(512*u)}function Rz(i){return 1/Math.cos(i*Math.PI/180)}function yw(i,n=0){const s=Math.exp(Math.PI*(1-(i.y+n/Mt)/(1<<i.z)*2));return 80150034*s/(s*s+1)/Mt/(1<<i.z)}class bo{constructor(n,s,u=0){this.x=+n,this.y=+s,this.z=+u}static fromLngLat(n,s=0){const u=Sr.convert(n);return new bo(hu(u.lng),du(u.lat),Ho(s,u.lat))}toLngLat(){return new Sr(ya(this.x),Xs(this.y))}toAltitude(){return Cz(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/iP*Rz(Xs(this.y))}}function oP(i,n,s,u,h,p,m,v,w){const E=(n+u)/2,A=(s+h)/2,P=new Dt(E,A);v(P),function(M,z,B,U,$,Y){const fe=B-$,he=U-Y;return Math.abs((U-z)*fe-(B-M)*he)/Math.hypot(fe,he)}(P.x,P.y,p.x,p.y,m.x,m.y)>=w?(oP(i,n,s,E,A,p,P,v,w),oP(i,E,A,u,h,P,m,v,w)):i.push(m)}function Mz(i,n,s){let u=i[0],h=u.x,p=u.y;n(u);const m=[u];for(let v=1;v<i.length;v++){const w=i[v],{x:E,y:A}=w;n(w),oP(m,h,p,E,A,u,w,n,s),h=E,p=A,u=w}return m}function aP(i,n,s,u){if(u(n,s)){const h=n.add(s)._mult(.5);aP(i,n,h,u),aP(i,h,s,u)}else i.push(s)}function GK(i,n){let s=i[0];const u=[s];for(let h=1;h<i.length;h++){const p=i[h];aP(u,s,p,n),s=p}return u}const lP=Math.pow(2,14)-1,kz=-lP-1;function qK(i,n){const s=Math.round(i.x*n),u=Math.round(i.y*n);return i.x=Kn(s,kz,lP),i.y=Kn(u,kz,lP),(s<i.x||s>i.x+1||u<i.y||u>i.y+1)&&Ii("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function wc(i,n,s){const u=i.loadGeometry(),h=i.extent,p=Mt/h;if(n&&s&&s.projection.isReprojectedInTileSpace){const m=1<<n.z,{scale:v,x:w,y:E,projection:A}=s,P=M=>{const z=ya((n.x+M.x/h)/m),B=Xs((n.y+M.y/h)/m),U=A.project(z,B);M.x=(U.x*v-w)*h,M.y=(U.y*v-E)*h};for(let M=0;M<u.length;M++)if(i.type!==1)u[M]=Mz(u[M],P,1);else{const z=[];for(const B of u[M])B.x<0||B.x>=h||B.y<0||B.y>=h||(P(B),z.push(B));u[M]=z}}for(const m of u)for(const v of m)qK(v,p);return u}function vh(i,n){return{type:i.type,id:i.id,properties:i.properties,geometry:n?wc(i):[]}}function vw(i,n,s,u,h){i.emplaceBack(2*n+(u+1)/2,2*s+(h+1)/2)}function xw(i,n,s){i.emplaceBack(n.x,n.y,n.z,s[0]*16384,s[1]*16384,s[2]*16384)}class cP{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new xc,this.indexArray=new js,this.segments=new wi,this.programConfigurations=new Ld(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}updateFootprints(n,s){}populate(n,s,u,h){const p=this.layers[0],m=[];let v=null;p.type==="circle"&&(v=p.layout.get("circle-sort-key"));for(const{feature:E,id:A,index:P,sourceLayerIndex:M}of n){const z=this.layers[0]._featureFilter.needGeometry,B=vh(E,z);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),B,u))continue;const U=v?v.evaluate(B,{},u):void 0,$={id:A,properties:E.properties,type:E.type,sourceLayerIndex:M,index:P,geometry:z?B.geometry:wc(E,u,h),patterns:{},sortKey:U};m.push($)}v&&m.sort((E,A)=>E.sortKey-A.sortKey);let w=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new fw,w=h.projection);for(const E of m){const{geometry:A,index:P,sourceLayerIndex:M}=E,z=n[P].feature;this.addFeature(E,A,P,s.availableImages,u,w,s.brightness),s.featureIndex.insert(z,A,P,M,this.index)}}update(n,s,u,h,p){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,s,m?this.stateDependentLayers:this.layers,u,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,CK.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,PK.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,s,u,h,p,m,v){for(const w of s)for(const E of w){const A=E.x,P=E.y;if(A<0||A>=Mt||P<0||P>=Mt)continue;if(m){const B=m.projectTilePoint(A,P,p),U=m.upVector(p,A,P),$=this.globeExtVertexArray;xw($,B,U),xw($,B,U),xw($,B,U),xw($,B,U)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),z=M.vertexLength;vw(this.layoutVertexArray,A,P,-1,-1),vw(this.layoutVertexArray,A,P,1,-1),vw(this.layoutVertexArray,A,P,1,1),vw(this.layoutVertexArray,A,P,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+2,z+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,{},h,p,v)}}function uP(i,n){for(let s=0;s<i.length;s++)if(Nd(n,i[s]))return!0;for(let s=0;s<n.length;s++)if(Nd(i,n[s]))return!0;return!!hP(i,n)}function WK(i,n,s){return!!Nd(i,n)||!!dP(n,i,s)}function Dz(i,n){if(i.length===1)return Lz(n,i[0]);for(let s=0;s<n.length;s++){const u=n[s];for(let h=0;h<u.length;h++)if(Nd(i,u[h]))return!0}for(let s=0;s<i.length;s++)if(Lz(n,i[s]))return!0;for(let s=0;s<n.length;s++)if(hP(i,n[s]))return!0;return!1}function HK(i,n,s){if(i.length>1){if(hP(i,n))return!0;for(let u=0;u<n.length;u++)if(dP(n[u],i,s))return!0}for(let u=0;u<i.length;u++)if(dP(i[u],n,s))return!0;return!1}function hP(i,n){if(i.length===0||n.length===0)return!1;for(let s=0;s<i.length-1;s++){const u=i[s],h=i[s+1];for(let p=0;p<n.length-1;p++)if(ZK(u,h,n[p],n[p+1]))return!0}return!1}function ZK(i,n,s,u){return la(i,s,u)!==la(n,s,u)&&la(i,n,s)!==la(i,n,u)}function dP(i,n,s){const u=s*s;if(n.length===1)return i.distSqr(n[0])<u;for(let h=1;h<n.length;h++)if(Oz(i,n[h-1],n[h])<u)return!0;return!1}function Oz(i,n,s){const u=n.distSqr(s);if(u===0)return i.distSqr(n);const h=((i.x-n.x)*(s.x-n.x)+(i.y-n.y)*(s.y-n.y))/u;return i.distSqr(h<0?n:h>1?s:s.sub(n)._mult(h)._add(n))}function Lz(i,n){let s,u,h,p=!1;for(let m=0;m<i.length;m++){s=i[m];for(let v=0,w=s.length-1;v<s.length;w=v++)u=s[v],h=s[w],u.y>n.y!=h.y>n.y&&n.x<(h.x-u.x)*(n.y-u.y)/(h.y-u.y)+u.x&&(p=!p)}return p}function Nd(i,n){let s=!1;for(let u=0,h=i.length-1;u<i.length;h=u++){const p=i[u],m=i[h];p.y>n.y!=m.y>n.y&&n.x<(m.x-p.x)*(n.y-p.y)/(m.y-p.y)+p.x&&(s=!s)}return s}function zz(i,n,s,u,h){for(const m of i)if(n<=m.x&&s<=m.y&&u>=m.x&&h>=m.y)return!0;const p=[new Dt(n,s),new Dt(n,h),new Dt(u,h),new Dt(u,s)];if(i.length>2){for(const m of p)if(Nd(i,m))return!0}for(let m=0;m<i.length-1;m++)if(XK(i[m],i[m+1],p))return!0;return!1}function XK(i,n,s){const u=s[0],h=s[2];if(i.x<u.x&&n.x<u.x||i.x>h.x&&n.x>h.x||i.y<u.y&&n.y<u.y||i.y>h.y&&n.y>h.y)return!1;const p=la(i,n,s[0]);return p!==la(i,n,s[1])||p!==la(i,n,s[2])||p!==la(i,n,s[3])}function Kg(i,n,s,u,h,p){let m=n.y-i.y,v=i.x-n.x;if(p=p||0){const w=m*m+v*v;if(w===0)return!0;const E=Math.sqrt(w);m/=E,v/=E}return!((s.x-i.x)*m+(s.y-i.y)*v-p<0||(u.x-i.x)*m+(u.y-i.y)*v-p<0||(h.x-i.x)*m+(h.y-i.y)*v-p<0)}function fP(i,n,s,u,h,p,m){return!(Kg(i,n,u,h,p,m)||Kg(n,s,u,h,p,m)||Kg(s,i,u,h,p,m)||Kg(u,h,i,n,s,m)||Kg(h,p,i,n,s,m)||Kg(p,u,i,n,s,m))}function Yg(i,n,s){const u=n.paint.get(i).value;return u.kind==="constant"?u.value:s.programConfigurations.get(n.id).getMaxValue(i)}function bw(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Nz(i,n,s,u,h){if(!n[0]&&!n[1])return i;const p=Dt.convert(n)._mult(h);s==="viewport"&&p._rotate(-u);const m=[];for(let v=0;v<i.length;v++)m.push(i[v].sub(p));return m}function Fz(i,n,s,u){const h=Dt.convert(i)._mult(u);return n==="viewport"&&h._rotate(-s),h}let Bz,jz;Ue(cP,"CircleBucket",{omit:["layers"]});class pP{constructor(n,s){this.pos=n,this.dir=s}intersectsPlane(n,s,u){const h=a.$.dot(s,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((n[0]-this.pos[0])*s[0]+(n[1]-this.pos[1])*s[1]+(n[2]-this.pos[2])*s[2])/h;return u[0]=this.pos[0]+this.dir[0]*p,u[1]=this.pos[1]+this.dir[1]*p,u[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(n,s,u){if(a.$.equals(this.pos,n)||s===0)return u[0]=u[1]=u[2]=0,!1;const[h,p,m]=this.dir,v=this.pos[0]-n[0],w=this.pos[1]-n[1],E=this.pos[2]-n[2],A=h*h+p*p+m*m,P=2*(v*h+w*p+E*m),M=P*P-4*A*(v*v+w*w+E*E-s*s);if(M<0){const z=Math.max(-P/2,0),B=v+h*z,U=w+p*z,$=E+m*z,Y=Math.hypot(B,U,$);return u[0]=B*s/Y,u[1]=U*s/Y,u[2]=$*s/Y,!1}{const z=(-P-Math.sqrt(M))/(2*A);if(z<0){const B=Math.hypot(v,w,E);return u[0]=v*s/B,u[1]=w*s/B,u[2]=E*s/B,!1}return u[0]=v+h*z,u[1]=w+p*z,u[2]=E+m*z,!0}}}class mP{constructor(n,s,u,h,p){this.TL=n,this.TR=s,this.BR=u,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(n,s,u){const h=[-1,1,1],p=[1,1,1],m=[1,-1,1],v=[-1,-1,1],w=a.$.transformMat4(h,h,n),E=a.$.transformMat4(p,p,n),A=a.$.transformMat4(m,m,n),P=a.$.transformMat4(v,v,n);return new mP(w,E,A,P,s/u)}}function $0(i,n,s){let u=1/0,h=-1/0;const p=[];for(const m of i){a.$.sub(p,m,n);const v=a.$.dot(p,s);u=Math.min(u,v),h=Math.max(h,v)}return[u,h]}function Uz(i,n){let s=!0;for(let u=0;u<i.planes.length;u++){const h=i.planes[u];let p=0;for(let m=0;m<n.length;m++)p+=a.$.dot(h,n[m])+h[3]>=0;if(p===0)return 0;p!==n.length&&(s=!1)}return s?2:1}function Vz(i,n){for(const s of i.projections){const u=$0(n,i.points[0],s.axis);if(s.projection[1]<u[0]||s.projection[0]>u[1])return 0}return 1}function $z(i,n){let s=0;const u=[0,0,0,0];for(let h=0;h<i.length;h++)u[0]=i[h][0],u[1]=i[h][1],u[2]=i[h][2],u[3]=1,a.aB.dot(u,n)>=0&&s++;return s}class gP{constructor(n,s){this.points=n||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=mi.fromPoints(this.points),this.projections=[],this.frustumEdges=[a.$.sub([],this.points[2],this.points[3]),a.$.sub([],this.points[0],this.points[3]),a.$.sub([],this.points[4],this.points[0]),a.$.sub([],this.points[5],this.points[1]),a.$.sub([],this.points[6],this.points[2]),a.$.sub([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const h=[0,-u[2],u[1]],p=[u[2],0,-u[0]];this.projections.push({axis:h,projection:$0(this.points,this.points[0],h)}),this.projections.push({axis:p,projection:$0(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(n,s,u,h){const p=Math.pow(2,u),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const A=a.aB.transformMat4([],E,n),P=1/A[3]/s*p;return a.aB.mul(A,A,[P,P,h?1/A[3]:P,P])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const A=a.$.sub([],m[E[0]],m[E[1]]),P=a.$.sub([],m[E[2]],m[E[1]]),M=a.$.normalize([],a.$.cross([],A,P)),z=-a.$.dot(M,m[E[1]]);return M.concat(z)}),w=[];for(let E=0;E<m.length;E++)w.push([m[E][0],m[E][1],m[E][2]]);return new gP(w,v)}intersectsPrecise(n,s,u){for(let h=0;h<s.length;h++)if(!$z(n,s[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!$z(n,this.planes[h]))return 0;for(const h of u)for(const p of this.frustumEdges){const m=a.$.cross([],h,p),v=a.$.length(m);if(v===0)continue;a.$.scale(m,m,1/v);const w=$0(this.points,this.points[0],m),E=$0(n,this.points[0],m);if(w[0]>E[1]||E[0]>w[1])return 0}return 1}containsPoint(n){for(const s of this.planes){const u=s[3];if(a.$.dot([s[0],s[1],s[2]],n)+u<0)return!1}return!0}}class mi{static fromPoints(n){const s=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const h of n)a.$.min(s,s,h),a.$.max(u,u,h);return new mi(s,u)}static fromTileIdAndHeight(n,s,u){const h=1<<n.canonical.z,p=n.canonical.x,m=n.canonical.y;return new mi([p/h,m/h,s],[(p+1)/h,(m+1)/h,u])}static applyTransform(n,s){const u=n.getCorners();for(let h=0;h<u.length;++h)a.$.transformMat4(u[h],u[h],s);return mi.fromPoints(u)}static applyTransformFast(n,s){const u=[s[12],s[13],s[14]],h=[...u];for(let p=0;p<3;p++)for(let m=0;m<3;m++){const v=s[4*m+p],w=v*n.min[m],E=v*n.max[m];u[p]+=Math.min(w,E),h[p]+=Math.max(w,E)}return new mi(u,h)}static projectAabbCorners(n,s){const u=n.getCorners();for(let h=0;h<u.length;++h)a.$.transformMat4(u[h],u[h],s);return u}constructor(n,s){this.min=n,this.max=s,this.center=a.$.scale([],a.$.add([],this.min,this.max),.5)}quadrant(n){const s=[n%2==0,n<2],u=a.$.clone(this.min),h=a.$.clone(this.max);for(let p=0;p<s.length;p++)u[p]=s[p]?this.min[p]:this.center[p],h[p]=s[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new mi(u,h)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,s=this.max;return[[n[0],n[1],n[2]],[s[0],n[1],n[2]],[s[0],s[1],n[2]],[n[0],s[1],n[2]],[n[0],n[1],s[2]],[s[0],n[1],s[2]],[s[0],s[1],s[2]],[n[0],s[1],s[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?Uz(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?Uz(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,s){return s||this.intersects(n)?Vz(n,this.getCorners()):0}intersectsPreciseFlat(n,s){return s||this.intersectsFlat(n)?Vz(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let s=0;s<3;++s)if(this.min[s]>n.max[s]||n.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],n.min[s]),this.max[s]=Math.max(this.max[s],n.max[s])}encapsulatePoint(n){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],n[s]),this.max[s]=Math.max(this.max[s],n[s])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}Ue(mi,"Aabb");const KK=Lr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ww}=KK,Gz=Lr([{name:"a_pos_3",components:3,type:"Int16"}]);var G0=Lr([{name:"a_pos",type:"Int16",components:2}]);function Tw(i){return i*Wo/Zg}const YK=[new mi([Rl,Rl,Rl],[Ml,Ml,Ml]),new mi([Rl,Rl,Rl],[0,0,Ml]),new mi([0,Rl,Rl],[Ml,0,Ml]),new mi([Rl,0,Rl],[0,Ml,Ml]),new mi([0,0,Rl],[Ml,Ml,Ml])];function qz(i,n,s,u=!0){const h=a.$.scale([],i._camera.position,i.worldSize),p=[n,s,1,1];a.aB.transformMat4(p,p,i.pixelMatrixInverse),a.aB.scale(p,p,1/p[3]);const m=a.$.sub([],p,h),v=a.$.normalize([],m),w=i.globeMatrix,E=[w[12],w[13],w[14]],A=a.$.sub([],E,h),P=a.$.length(A),M=a.$.normalize([],A),z=i.worldSize/(2*Math.PI),B=a.$.dot(M,v),U=Math.asin(z/P);if(U<Math.acos(B)){if(!u)return null;const Ze=[],st=[];a.$.scale(Ze,v,P/B),a.$.normalize(st,a.$.sub(st,Ze,A)),a.$.normalize(v,a.$.add(v,A,a.$.scale(v,st,Math.tan(U)*P)))}const $=[];new pP(h,v).closestPointOnSphere(E,z,$);const Y=a.$.normalize([],R(w,0)),fe=a.$.normalize([],R(w,1)),he=a.$.normalize([],R(w,2)),me=a.$.dot(Y,$),Ae=a.$.dot(fe,$),Ce=a.$.dot(he,$),Le=io(Math.asin(-Ae/z));let Ve=io(Math.atan2(me,Ce));Ve=i.center.lng+function(Ze,st){const yt=(st-Ze+180)%360-180;return yt<-180?yt+360:yt}(i.center.lng,Ve);const He=hu(Ve),et=Kn(du(Le),0,1);return new bo(He,et)}class QK{constructor(n,s,u){this.a=a.$.sub([],n,u),this.b=a.$.sub([],s,u),this.center=u;const h=a.$.normalize([],this.a),p=a.$.normalize([],this.b);this.angle=Math.acos(a.$.dot(h,p))}}function _P(i,n){if(i.angle===0)return null;let s;return s=i.a[n]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[n]/i.a[n]/Math.sin(i.angle)-1/Math.tan(i.angle)),s<0||s>1?null:function(u,h,p,m){const v=Math.sin(p);return u*(Math.sin((1-m)*p)/v)+h*(Math.sin(m*p)/v)}(i.a[n],i.b[n],i.angle,Kn(s,0,1))+i.center[n]}function fu(i){if(i.z<=1)return YK[i.z+2*i.y+i.x];const n=yP(Ew(i));return mi.fromPoints(n)}function xh(i,n,s){return a.$.scale(i,i,1-s),a.$.scaleAndAdd(i,i,n,s)}function Wz(i,n){const s=bh(n.zoom);if(s===0)return fu(i);const u=Ew(i),h=yP(u),p=hu(u.getWest())*n.worldSize,m=hu(u.getEast())*n.worldSize,v=du(u.getNorth())*n.worldSize,w=du(u.getSouth())*n.worldSize,E=[p,v,0],A=[m,v,0],P=[p,w,0],M=[m,w,0],z=a.ae.invert([],n.globeMatrix);return a.$.transformMat4(E,E,z),a.$.transformMat4(A,A,z),a.$.transformMat4(P,P,z),a.$.transformMat4(M,M,z),h[0]=xh(h[0],P,s),h[1]=xh(h[1],M,s),h[2]=xh(h[2],A,s),h[3]=xh(h[3],E,s),mi.fromPoints(h)}function Hz(i,n,s){for(const u of i)a.$.transformMat4(u,u,n),a.$.scale(u,u,s)}function Zz(i,n,s,u){const h=n/i.worldSize,p=i.globeMatrix;if(s.z<=1){const He=fu(s).getCorners();return Hz(He,p,h),mi.fromPoints(He)}const m=Ew(s,u),v=yP(m,Wo+Tw(i._tileCoverLift));Hz(v,p,h);const w=Number.MAX_VALUE,E=[-w,-w,-w],A=[w,w,w];if(m.contains(i.center)){for(const Ze of v)a.$.min(A,A,Ze),a.$.max(E,E,Ze);E[2]=0;const He=i.point,et=[He.x*h,He.y*h,0];return a.$.min(A,A,et),a.$.max(E,E,et),new mi(A,E)}if(i._tileCoverLift>0){for(const He of v)a.$.min(A,A,He),a.$.max(E,E,He);return new mi(A,E)}const P=[p[12]*h,p[13]*h,p[14]*h],M=m.getCenter(),z=Kn(i.center.lat,-Wi,Wi),B=Kn(M.lat,-Wi,Wi),U=hu(i.center.lng),$=du(z);let Y=U-hu(M.lng);const fe=$-du(B);Y>.5?Y-=1:Y<-.5&&(Y+=1);let he=0;if(Math.abs(Y)>Math.abs(fe))he=Y>=0?1:3;else{he=fe>=0?0:2;const He=[p[4]*h,p[5]*h,p[6]*h],et=-Math.sin(sr(fe>=0?m.getSouth():m.getNorth()))*Wo;a.$.scaleAndAdd(P,P,He,et)}const me=v[he],Ae=v[(he+1)%4],Ce=new QK(me,Ae,P),Le=[_P(Ce,0)||me[0],_P(Ce,1)||me[1],_P(Ce,2)||me[2]],Ve=bh(i.zoom);if(Ve>0){const He=function({x:Ze,y:st,z:yt},ot,bt,rt,dt){const It=1/(1<<yt);let at=Ze*It,Ot=at+It,Et=st*It,vt=Et+It,vn=0;const dn=(at+Ot)/2-rt;return dn>.5?vn=-1:dn<-.5&&(vn=1),at=((at+vn)*ot-(rt*=ot))*bt+rt,Ot=((Ot+vn)*ot-rt)*bt+rt,Et=(Et*ot-(dt*=ot))*bt+dt,vt=(vt*ot-dt)*bt+dt,[[at,vt,0],[Ot,vt,0],[Ot,Et,0],[at,Et,0]]}(s,n,i._pixelsPerMercatorPixel,U,$);for(let Ze=0;Ze<v.length;Ze++)xh(v[Ze],He[Ze],Ve);const et=a.$.add([],He[he],He[(he+1)%4]);a.$.scale(et,et,.5),xh(Le,et,Ve)}for(const He of v)a.$.min(A,A,He),a.$.max(E,E,He);return A[2]=Math.min(me[2],Ae[2]),a.$.min(A,A,Le),a.$.max(E,E,Le),new mi(A,E)}function Ew({x:i,y:n,z:s},u=!1){const h=1/(1<<s),p=new Sr(ya(i*h),n===(1<<s)-1&&u?-90:Xs((n+1)*h)),m=new Sr(ya((i+1)*h),n===0&&u?90:Xs(n*h));return new zd(p,m)}function yP(i,n=Wo){const s=sr(i.getNorth()),u=sr(i.getSouth()),h=Math.cos(s),p=Math.cos(u),m=Math.sin(s),v=Math.sin(u),w=i.getWest(),E=i.getEast();return[Hg(p,v,w,n),Hg(p,v,E,n),Hg(h,m,E,n),Hg(h,m,w,n)]}function q0(i,n,s,u){const h=1<<s.z,p=(i/Mt+s.x)/h;return Np(Xs((n/Mt+s.y)/h),ya(p),u)}function Sw({min:i,max:n}){return BK/Math.max(n[0]-i[0],n[1]-i[1],n[2]-i[2])}const Xz=new Float64Array(16);function W0(i){const n=Sw(i),s=a.ae.fromScaling(Xz,[n,n,n]);return a.ae.translate(s,s,a.$.negate([],i.min))}function vP(i){const n=a.ae.fromTranslation(Xz,i.min),s=1/Sw(i);return a.ae.scale(n,n,[s,s,s])}function xP(i){const n=Mt/(2*Math.PI);return i/(2*Math.PI)/n}function Kz(i,n){return Mt/(512*Math.pow(2,i))*Sw(fu(n))}function Yz(i,n,s,u,h){const p=xP(s),m=[i,n,-s/(2*Math.PI)],v=a.ae.identity(new Float64Array(16));return a.ae.translate(v,v,m),a.ae.scale(v,v,[p,p,p]),a.ae.rotateX(v,v,sr(-h)),a.ae.rotateY(v,v,sr(-u)),v}function bh(i){return aa(nP,Sz,i)}function Qz(i,n){const s=Np(n.lat,n.lng),u=function(p){const m=Np(p._center.lat,p._center.lng),v=a.$.fromValues(0,1,0);let w=a.$.cross([],v,m);const E=a.ae.fromRotation([],-p.angle,m);w=a.$.transformMat4(w,w,E),a.ae.fromRotation(E,-p._pitch,w);const A=a.$.normalize([],m);return a.$.scale(A,A,Tw(p.cameraToCenterDistance/p.pixelsPerMeter)),a.$.transformMat4(A,A,E),a.$.add([],m,A)}(i),h=a.$.subtract([],u,s);return a.$.angle(h,s)}function bP(i,n){return Qz(i,n)>Math.PI/2*1.01}const Jz=sr(85),JK=Math.cos(Jz),eY=Math.sin(Jz),tY=a.ae.create(),eN=i=>{const n=[];return i.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),i.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function tN(i,n,s,u,h,p,m,v,w){if(p&&i.queryGeometry.isAboveHorizon)return!1;p&&(w*=i.pixelToTileUnitsFactor);const E=i.tileID.canonical,A=s.projection.upVectorScale(E,s.center.lat,s.worldSize).metersToTile;for(const P of n)for(const M of P){const z=M.add(v),B=h&&s.elevation?s.elevation.exaggeration()*h.getElevationAt(z.x,z.y,!0):0,U=s.projection.projectTilePoint(z.x,z.y,E);if(B>0){const he=s.projection.upVector(E,z.x,z.y);U.x+=he[0]*A*B,U.y+=he[1]*A*B,U.z+=he[2]*A*B}const $=p?z:nY(U.x,U.y,U.z,u),Y=p?i.tilespaceRays.map(he=>iY(he,B)):i.queryGeometry.screenGeometry,fe=a.aB.transformMat4([],[U.x,U.y,U.z,1],u);if(!m&&p?w*=fe[3]/s.cameraToCenterDistance:m&&!p&&(w*=s.cameraToCenterDistance/fe[3]),p){const he=Xs((M.y/Mt+E.y)/(1<<E.z));w/=s.projection.pixelsPerMeter(he,1)/Ho(1,he)}if(WK(Y,$,w))return!0}return!1}function nY(i,n,s,u){const h=a.aB.transformMat4([],[i,n,s,1],u);return new Dt(h[0]/h[3],h[1]/h[3])}const nN=a.$.fromValues(0,0,0),rY=a.$.fromValues(0,0,1);function iY(i,n){const s=a.$.create();return nN[2]=n,i.intersectsPlane(nN,rY,s),new Dt(s[0],s[1])}class rN extends cP{}function iN(i,{width:n,height:s},u,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==n*s*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(n*s*u);return i.width=n,i.height=s,i.data=h,i}function sN(i,n,s){const{width:u,height:h}=n;u===i.width&&h===i.height||(wP(i,n,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,u),height:Math.min(i.height,h)},s,null),i.width=u,i.height=h,i.data=n.data)}function wP(i,n,s,u,h,p,m,v){if(h.width===0||h.height===0)return n;if(h.width>i.width||h.height>i.height||s.x>i.width-h.width||s.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>n.width||h.height>n.height||u.x>n.width-h.width||u.y>n.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const w=i.data,E=n.data,A=p===4&&v;for(let P=0;P<h.height;P++){const M=((s.y+P)*i.width+s.x)*p,z=((u.y+P)*n.width+u.x)*p;if(A)for(let B=0;B<h.width;B++){const U=M+B*p+3,$=z+B*p;E[$+0]=255,E[$+1]=255,E[$+2]=255,E[$+3]=w[U]}else if(m)for(let B=0;B<h.width;B++){const U=M+B*p,$=z+B*p,Y=w[U+3],fe=new Ar(w[U+0]/255*Y,w[U+1]/255*Y,w[U+2]/255*Y,Y).toRenderColor(m).toArray();E[$+0]=fe[0],E[$+1]=fe[1],E[$+2]=fe[2],E[$+3]=fe[3]}else for(let B=0;B<h.width*p;B++)E[z+B]=w[M+B]}return n}Ue(rN,"HeatmapBucket",{omit:["layers"]});class Fd{constructor(n,s){iN(this,n,1,s)}resize(n){sN(this,new Fd(n),1)}clone(){return new Fd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,u,h,p){wP(n,s,u,h,p,1,null)}}class tl{constructor(n,s){iN(this,n,4,s)}resize(n){sN(this,new tl(n),4)}replace(n,s){s?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new tl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,u,h,p,m,v){wP(n,s,u,h,p,4,m,v)}}class oN{constructor(n,s){this.width=n.width,this.height=n.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}let aN,lN,cN,uN;function H0(i){const n={},s=i.resolution||256,u=i.clips?i.clips.length:1,h=i.image||new tl({width:s,height:u}),p=(m,v,w)=>{n[i.evaluationKey]=w;const E=i.expression.evaluate(n);E&&(h.data[m+v+0]=Math.floor(255*E.r/E.a),h.data[m+v+1]=Math.floor(255*E.g/E.a),h.data[m+v+2]=Math.floor(255*E.b/E.a),h.data[m+v+3]=Math.floor(255*E.a))};if(i.clips)for(let m=0,v=0;m<u;++m,v+=4*s)for(let w=0,E=0;w<s;w++,E+=4){const A=w/(s-1),{start:P,end:M}=i.clips[m];p(v,E,P*(1-A)+M*A)}else for(let m=0,v=0;m<s;m++,v+=4)p(0,v,m/(s-1));return h}Ue(Fd,"AlphaImage"),Ue(tl,"RGBAImage");const sY=Lr([{name:"a_pos",components:2,type:"Int16"}],4),{members:oY}=sY;function Z0(i,n,s=2){const u=n&&n.length,h=u?n[0]*s:i.length;let p=hN(i,0,h,s,!0);const m=[];if(!p||p.next===p.prev)return m;let v,w,E;if(u&&(p=function(A,P,M,z){const B=[];for(let U=0,$=P.length;U<$;U++){const Y=hN(A,P[U]*z,U<$-1?P[U+1]*z:A.length,z,!1);Y===Y.next&&(Y.steiner=!0),B.push(pY(Y))}B.sort(hY);for(let U=0;U<B.length;U++)M=dY(B[U],M);return M}(i,n,p,s)),i.length>80*s){v=1/0,w=1/0;let A=-1/0,P=-1/0;for(let M=s;M<h;M+=s){const z=i[M],B=i[M+1];z<v&&(v=z),B<w&&(w=B),z>A&&(A=z),B>P&&(P=B)}E=Math.max(A-v,P-w),E=E!==0?32767/E:0}return X0(p,m,s,v,w,E,0),m}function hN(i,n,s,u,h){let p;if(h===function(m,v,w,E){let A=0;for(let P=v,M=w-E;P<w;P+=E)A+=(m[M]-m[P])*(m[P+1]+m[M+1]),M=P;return A}(i,n,s,u)>0)for(let m=n;m<s;m+=u)p=pN(m/u|0,i[m],i[m+1],p);else for(let m=s-u;m>=n;m-=u)p=pN(m/u|0,i[m],i[m+1],p);return p&&Iw(p,p.next)&&(Y0(p),p=p.next),p}function jp(i,n){if(!i)return i;n||(n=i);let s,u=i;do if(s=!1,u.steiner||!Iw(u,u.next)&&Ts(u.prev,u,u.next)!==0)u=u.next;else{if(Y0(u),u=n=u.prev,u===u.next)break;s=!0}while(s||u!==n);return n}function X0(i,n,s,u,h,p,m){if(!i)return;!m&&p&&function(w,E,A,P){let M=w;do M.z===0&&(M.z=TP(M.x,M.y,E,A,P)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==w);M.prevZ.nextZ=null,M.prevZ=null,function(z){let B,U=1;do{let $,Y=z;z=null;let fe=null;for(B=0;Y;){B++;let he=Y,me=0;for(let Ce=0;Ce<U&&(me++,he=he.nextZ,he);Ce++);let Ae=U;for(;me>0||Ae>0&&he;)me!==0&&(Ae===0||!he||Y.z<=he.z)?($=Y,Y=Y.nextZ,me--):($=he,he=he.nextZ,Ae--),fe?fe.nextZ=$:z=$,$.prevZ=fe,fe=$;Y=he}fe.nextZ=null,U*=2}while(B>1)}(M)}(i,u,h,p);let v=i;for(;i.prev!==i.next;){const w=i.prev,E=i.next;if(p?lY(i,u,h,p):aY(i))n.push(w.i,i.i,E.i),Y0(i),i=E.next,v=E.next;else if((i=E)===v){m?m===1?X0(i=cY(jp(i),n),n,s,u,h,p,2):m===2&&uY(i,n,s,u,h,p):X0(jp(i),n,s,u,h,p,1);break}}}function aY(i){const n=i.prev,s=i,u=i.next;if(Ts(n,s,u)>=0)return!1;const h=n.x,p=s.x,m=u.x,v=n.y,w=s.y,E=u.y,A=h<p?h<m?h:m:p<m?p:m,P=v<w?v<E?v:E:w<E?w:E,M=h>p?h>m?h:m:p>m?p:m,z=v>w?v>E?v:E:w>E?w:E;let B=u.next;for(;B!==n;){if(B.x>=A&&B.x<=M&&B.y>=P&&B.y<=z&&Qg(h,v,p,w,m,E,B.x,B.y)&&Ts(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function lY(i,n,s,u){const h=i.prev,p=i,m=i.next;if(Ts(h,p,m)>=0)return!1;const v=h.x,w=p.x,E=m.x,A=h.y,P=p.y,M=m.y,z=v<w?v<E?v:E:w<E?w:E,B=A<P?A<M?A:M:P<M?P:M,U=v>w?v>E?v:E:w>E?w:E,$=A>P?A>M?A:M:P>M?P:M,Y=TP(z,B,n,s,u),fe=TP(U,$,n,s,u);let he=i.prevZ,me=i.nextZ;for(;he&&he.z>=Y&&me&&me.z<=fe;){if(he.x>=z&&he.x<=U&&he.y>=B&&he.y<=$&&he!==h&&he!==m&&Qg(v,A,w,P,E,M,he.x,he.y)&&Ts(he.prev,he,he.next)>=0||(he=he.prevZ,me.x>=z&&me.x<=U&&me.y>=B&&me.y<=$&&me!==h&&me!==m&&Qg(v,A,w,P,E,M,me.x,me.y)&&Ts(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;he&&he.z>=Y;){if(he.x>=z&&he.x<=U&&he.y>=B&&he.y<=$&&he!==h&&he!==m&&Qg(v,A,w,P,E,M,he.x,he.y)&&Ts(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;me&&me.z<=fe;){if(me.x>=z&&me.x<=U&&me.y>=B&&me.y<=$&&me!==h&&me!==m&&Qg(v,A,w,P,E,M,me.x,me.y)&&Ts(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function cY(i,n){let s=i;do{const u=s.prev,h=s.next.next;!Iw(u,h)&&dN(u,s,s.next,h)&&K0(u,h)&&K0(h,u)&&(n.push(u.i,s.i,h.i),Y0(s),Y0(s.next),s=i=h),s=s.next}while(s!==i);return jp(s)}function uY(i,n,s,u,h,p){let m=i;do{let v=m.next.next;for(;v!==m.prev;){if(m.i!==v.i&&mY(m,v)){let w=fN(m,v);return m=jp(m,m.next),w=jp(w,w.next),X0(m,n,s,u,h,p,0),void X0(w,n,s,u,h,p,0)}v=v.next}m=m.next}while(m!==i)}function hY(i,n){return i.x-n.x}function dY(i,n){const s=function(h,p){let m=p;const v=h.x,w=h.y;let E,A=-1/0;do{if(w<=m.y&&w>=m.next.y&&m.next.y!==m.y){const U=m.x+(w-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(U<=v&&U>A&&(A=U,E=m.x<m.next.x?m:m.next,U===v))return E}m=m.next}while(m!==p);if(!E)return null;const P=E,M=E.x,z=E.y;let B=1/0;m=E;do{if(v>=m.x&&m.x>=M&&v!==m.x&&Qg(w<z?v:A,w,M,z,w<z?A:v,w,m.x,m.y)){const U=Math.abs(w-m.y)/(v-m.x);K0(m,h)&&(U<B||U===B&&(m.x>E.x||m.x===E.x&&fY(E,m)))&&(E=m,B=U)}m=m.next}while(m!==P);return E}(i,n);if(!s)return n;const u=fN(s,i);return jp(u,u.next),jp(s,s.next)}function fY(i,n){return Ts(i.prev,i,n.prev)<0&&Ts(n.next,i,i.next)<0}function TP(i,n,s,u,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-s)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-u)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function pY(i){let n=i,s=i;do(n.x<s.x||n.x===s.x&&n.y<s.y)&&(s=n),n=n.next;while(n!==i);return s}function Qg(i,n,s,u,h,p,m,v){return(h-m)*(n-v)>=(i-m)*(p-v)&&(i-m)*(u-v)>=(s-m)*(n-v)&&(s-m)*(p-v)>=(h-m)*(u-v)}function mY(i,n){return i.next.i!==n.i&&i.prev.i!==n.i&&!function(s,u){let h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==u.i&&h.next.i!==u.i&&dN(h,h.next,s,u))return!0;h=h.next}while(h!==s);return!1}(i,n)&&(K0(i,n)&&K0(n,i)&&function(s,u){let h=s,p=!1;const m=(s.x+u.x)/2,v=(s.y+u.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&m<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==s);return p}(i,n)&&(Ts(i.prev,i,n.prev)||Ts(i,n.prev,n))||Iw(i,n)&&Ts(i.prev,i,i.next)>0&&Ts(n.prev,n,n.next)>0)}function Ts(i,n,s){return(n.y-i.y)*(s.x-n.x)-(n.x-i.x)*(s.y-n.y)}function Iw(i,n){return i.x===n.x&&i.y===n.y}function dN(i,n,s,u){const h=Cw(Ts(i,n,s)),p=Cw(Ts(i,n,u)),m=Cw(Ts(s,u,i)),v=Cw(Ts(s,u,n));return h!==p&&m!==v||!(h!==0||!Aw(i,s,n))||!(p!==0||!Aw(i,u,n))||!(m!==0||!Aw(s,i,u))||!(v!==0||!Aw(s,n,u))}function Aw(i,n,s){return n.x<=Math.max(i.x,s.x)&&n.x>=Math.min(i.x,s.x)&&n.y<=Math.max(i.y,s.y)&&n.y>=Math.min(i.y,s.y)}function Cw(i){return i>0?1:i<0?-1:0}function K0(i,n){return Ts(i.prev,i,i.next)<0?Ts(i,n,i.next)>=0&&Ts(i,i.prev,n)>=0:Ts(i,n,i.prev)<0||Ts(i,i.next,n)<0}function fN(i,n){const s=EP(i.i,i.x,i.y),u=EP(n.i,n.x,n.y),h=i.next,p=n.prev;return i.next=n,n.prev=i,s.next=h,h.prev=s,u.next=s,s.prev=u,p.next=u,u.prev=p,u}function pN(i,n,s,u){const h=EP(i,n,s);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function Y0(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function EP(i,n,s){return{i,x:n,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Pw(i,n){const s=i.length;if(s<=1)return[i];const u=[];let h,p;for(let m=0;m<s;m++){const v=dg(i[m]);v!==0&&(i[m].area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(h&&u.push(h),h=[i[m]]):h.push(i[m]))}if(h&&u.push(h),n>1)for(let m=0;m<u.length;m++)u[m].length<=n||(Cr(u[m],n,1,u[m].length-1,gY),u[m]=u[m].slice(0,n));return u}function gY(i,n){return n.area-i.area}function SP(i,n,s){const u=s.patternDependencies;let h=!1;for(const p of n){const m=p.paint.get(`${i}-pattern`);m.isConstant()||(h=!0);const v=m.constantOr(null);v&&(h=!0,u[v]=!0)}return h}function IP(i,n,s,u,h){const p=h.patternDependencies;for(const m of n){const v=m.paint.get(`${i}-pattern`).value;if(v.kind!=="constant"){let w=v.evaluate({zoom:u},s,{},h.availableImages);w=w&&w.name?w.name:w,p[w]=!0,s.patterns[m.id]=w}}return s}class Rw{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xc,this.indexArray=new js,this.indexArray2=new Dd,this.programConfigurations=new Ld(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new wi,this.segments2=new wi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=n.projection}updateFootprints(n,s){}populate(n,s,u,h){this.hasPattern=SP("fill",this.layers,s);const p=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:v,id:w,index:E,sourceLayerIndex:A}of n){const P=this.layers[0]._featureFilter.needGeometry,M=vh(v,P);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),M,u))continue;const z=p?p.evaluate(M,{},u,s.availableImages):void 0,B={id:w,properties:v.properties,type:v.type,sourceLayerIndex:A,index:E,geometry:P?M.geometry:wc(v,u,h),patterns:{},sortKey:z};m.push(B)}p&&m.sort((v,w)=>v.sortKey-w.sortKey);for(const v of m){const{geometry:w,index:E,sourceLayerIndex:A}=v;if(this.hasPattern){const P=IP("fill",this.layers,v,this.zoom,s);this.patternFeatures.push(P)}else this.addFeature(v,w,E,u,{},s.availableImages,s.brightness);s.featureIndex.insert(n[E].feature,w,E,A,this.index)}}update(n,s,u,h,p){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,s,m?this.stateDependentLayers:this.layers,u,h,p)}addFeatures(n,s,u,h,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,u,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,oY),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,s,u,h,p,m=[],v){for(const w of Pw(s,500)){let E=0;for(const U of w)E+=U.length;const A=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),P=A.vertexLength,M=[],z=[];for(const U of w){if(U.length===0)continue;U!==w[0]&&z.push(M.length/2);const $=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),Y=$.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(Y+U.length-1,Y),M.push(U[0].x),M.push(U[0].y);for(let fe=1;fe<U.length;fe++)this.layoutVertexArray.emplaceBack(U[fe].x,U[fe].y),this.indexArray2.emplaceBack(Y+fe-1,Y+fe),M.push(U[fe].x),M.push(U[fe].y);$.vertexLength+=U.length,$.primitiveLength+=U.length}const B=Z0(M,z);for(let U=0;U<B.length;U+=3)this.indexArray.emplaceBack(P+B[U],P+B[U+1],P+B[U+2]);A.vertexLength+=E,A.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,p,m,h,v)}}let mN,gN,_N,yN;Ue(Rw,"FillBucket",{omit:["layers","patternFeatures"]});class AP{constructor(n,s,u,h){if(this.triangleCount=s.length/3,this.min=new Dt(0,0),this.max=new Dt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0)return;const[p,m]=[n[0].clone(),n[0].clone()];for(let P=1;P<n.length;++P){const M=n[P];p.x=Math.min(p.x,M.x),p.y=Math.min(p.y,M.y),m.x=Math.max(m.x,M.x),m.y=Math.max(m.y,M.y)}if(h){const P=Math.ceil(Math.max(m.x-p.x,m.y-p.y)/h);u=Math.max(u,P)}if(u===0)return;this.min=p,this.max=m;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const w=Math.max(v.x,v.y)/u;this.cellsX=Math.max(1,Math.ceil(v.x/w)),this.cellsY=Math.max(1,Math.ceil(v.y/w)),this.xScale=1/w,this.yScale=1/w;const E=[];for(let P=0;P<this.triangleCount;P++){const M=n[s[3*P+0]].sub(this.min),z=n[s[3*P+1]].sub(this.min),B=n[s[3*P+2]].sub(this.min),U=pu(Math.floor(Math.min(M.x,z.x,B.x)),this.xScale,this.cellsX),$=pu(Math.floor(Math.max(M.x,z.x,B.x)),this.xScale,this.cellsX),Y=pu(Math.floor(Math.min(M.y,z.y,B.y)),this.yScale,this.cellsY),fe=pu(Math.floor(Math.max(M.y,z.y,B.y)),this.yScale,this.cellsY),he=new Dt(0,0),me=new Dt(0,0),Ae=new Dt(0,0),Ce=new Dt(0,0);for(let Le=Y;Le<=fe;++Le){he.y=me.y=Le*w,Ae.y=Ce.y=(Le+1)*w;for(let Ve=U;Ve<=$;++Ve)he.x=Ae.x=Ve*w,me.x=Ce.x=(Ve+1)*w,(fP(M,z,B,he,me,Ce)||fP(M,z,B,he,Ce,Ae))&&E.push({cellIdx:Le*this.cellsX+Ve,triIdx:P})}}if(E.length===0)return;E.sort((P,M)=>P.cellIdx-M.cellIdx||P.triIdx-M.triIdx);let A=0;for(;A<E.length;){const P=E[A].cellIdx,M={start:this.payload.length,len:0};for(;A<E.length&&E[A].cellIdx===P;)++M.len,this.payload.push(E[A++].triIdx);this.cells[P]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(n,s){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>n.x||n.y>this.max.y||this.min.y>n.y)return;const u=pu(n.x-this.min.x,this.xScale,this.cellsX),h=pu(n.y-this.min.y,this.yScale,this.cellsY),p=this.cells[h*this.cellsX+u];if(p){this._lazyInitLookup();for(let m=0;m<p.len;m++){const v=this.payload[p.start+m],w=Math.floor(v/8),E=1<<v%8;if(!(this.lookup[w]&E)&&(this.lookup[w]|=E,s.push(v),s.length===this.triangleCount))return}}}query(n,s,u){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>s.x||n.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();const h=pu(n.x-this.min.x,this.xScale,this.cellsX),p=pu(s.x-this.min.x,this.xScale,this.cellsX),m=pu(n.y-this.min.y,this.yScale,this.cellsY),v=pu(s.y-this.min.y,this.yScale,this.cellsY);for(let w=m;w<=v;w++)for(let E=h;E<=p;E++){const A=this.cells[w*this.cellsX+E];if(A)for(let P=0;P<A.len;P++){const M=this.payload[A.start+P],z=Math.floor(M/8),B=1<<M%8;if(!(this.lookup[z]&B)&&(this.lookup[z]|=B,u.push(M),u.length===this.triangleCount))return}}}}function pu(i,n,s){return Math.max(0,Math.min(s-1,Math.floor(i*n)))}Ue(AP,"TriangleGridIndex");class vN{constructor(n){this.zoom=n.zoom,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[]}updateFootprints(n,s){for(const u of this.footprints)s.push({footprint:u,id:n})}populate(n,s,u,h){const p=[];for(const{feature:m,id:v,index:w,sourceLayerIndex:E}of n){const A=this.layers[0]._featureFilter.needGeometry,P=vh(m,A);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),P,u))continue;const M={id:v,properties:m.properties,type:m.type,sourceLayerIndex:E,index:w,geometry:A?P.geometry:wc(m,u,h),patterns:{}};p.push(M)}for(const m of p){const{geometry:v,index:w,sourceLayerIndex:E}=m;this.addFeature(m,v,w,u,{},s.availableImages,s.brightness),s.featureIndex.insert(n[w].feature,v,w,E,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(n){}update(n,s,u,h,p){}destroy(){}addFeature(n,s,u,h,p,m=[],v){for(const w of Pw(s,2)){const E=[],A=[],P=[],M=new Dt(1/0,1/0),z=new Dt(-1/0,-1/0);for(const $ of w)if($.length!==0){$!==w[0]&&P.push(A.length/2);for(let Y=0;Y<$.length;Y++)A.push($[Y].x),A.push($[Y].y),E.push($[Y]),M.x=Math.min(M.x,$[Y].x),M.y=Math.min(M.y,$[Y].y),z.x=Math.max(z.x,$[Y].x),z.y=Math.max(z.y,$[Y].y)}const B=Z0(A,P),U=new AP(E,B,8,256);this.footprints.push({vertices:E,indices:B,grid:U,min:M,max:z})}}}Ue(vN,"ClipBucket",{omit:["layers"]});const _Y=Lr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),yY=Lr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),vY=Lr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),xY=Lr([{name:"a_join_normal_inside_polygon",components:4,type:"Int16"}]),bY=Lr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),wY=Lr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:TY}=_Y;var Mw={},EY=Qc,xN=Jg;function Jg(i,n,s,u,h){this.properties={},this.extent=s,this.type=0,this._pbf=i,this._geometry=-1,this._keys=u,this._values=h,i.readFields(SY,this,n)}function SY(i,n,s){i==1?n.id=s.readVarint():i==2?function(u,h){for(var p=u.readVarint()+u.pos;u.pos<p;){var m=h._keys[u.readVarint()],v=h._values[u.readVarint()];h.properties[m]=v}}(s,n):i==3?n.type=s.readVarint():i==4&&(n._geometry=s.pos)}function IY(i){for(var n,s,u=0,h=0,p=i.length,m=p-1;h<p;m=h++)u+=((s=i[m]).x-(n=i[h]).x)*(n.y+s.y);return u}Jg.types=["Unknown","Point","LineString","Polygon"],Jg.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var n,s=i.readVarint()+i.pos,u=1,h=0,p=0,m=0,v=[];i.pos<s;){if(h<=0){var w=i.readVarint();u=7&w,h=w>>3}if(h--,u===1||u===2)p+=i.readSVarint(),m+=i.readSVarint(),u===1&&(n&&v.push(n),n=[]),n.push(new EY(p,m));else{if(u!==7)throw new Error("unknown command "+u);n&&n.push(n[0].clone())}}return n&&v.push(n),v},Jg.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var n=i.readVarint()+i.pos,s=1,u=0,h=0,p=0,m=1/0,v=-1/0,w=1/0,E=-1/0;i.pos<n;){if(u<=0){var A=i.readVarint();s=7&A,u=A>>3}if(u--,s===1||s===2)(h+=i.readSVarint())<m&&(m=h),h>v&&(v=h),(p+=i.readSVarint())<w&&(w=p),p>E&&(E=p);else if(s!==7)throw new Error("unknown command "+s)}return[m,w,v,E]},Jg.prototype.toGeoJSON=function(i,n,s){var u,h,p=this.extent*Math.pow(2,s),m=this.extent*i,v=this.extent*n,w=this.loadGeometry(),E=Jg.types[this.type];function A(z){for(var B=0;B<z.length;B++){var U=z[B];z[B]=[360*(U.x+m)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(u=0;u<w.length;u++)P[u]=w[u][0];A(w=P);break;case 2:for(u=0;u<w.length;u++)A(w[u]);break;case 3:for(w=function(z){var B=z.length;if(B<=1)return[z];for(var U,$,Y=[],fe=0;fe<B;fe++){var he=IY(z[fe]);he!==0&&($===void 0&&($=he<0),$===he<0?(U&&Y.push(U),U=[z[fe]]):U.push(z[fe]))}return U&&Y.push(U),Y}(w),u=0;u<w.length;u++)for(h=0;h<w[u].length;h++)A(w[u][h])}w.length===1?w=w[0]:E="Multi"+E;var M={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(M.id=this.id),M};var AY=xN,bN=wN;function wN(i,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(CY,this,n),this.length=this._features.length}function CY(i,n,s){i===15?n.version=s.readVarint():i===1?n.name=s.readString():i===5?n.extent=s.readVarint():i===2?n._features.push(s.pos):i===3?n._keys.push(s.readString()):i===4&&n._values.push(function(u){for(var h=null,p=u.readVarint()+u.pos;u.pos<p;){var m=u.readVarint()>>3;h=m===1?u.readString():m===2?u.readFloat():m===3?u.readDouble():m===4?u.readVarint64():m===5?u.readVarint():m===6?u.readSVarint():m===7?u.readBoolean():null}return h}(s))}wN.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var n=this._pbf.readVarint()+this._pbf.pos;return new AY(this._pbf,n,this.extent,this._keys,this._values)};var PY=bN;function RY(i,n,s){if(i===3){var u=new PY(s,s.readVarint()+s.pos);u.length&&(n[u.name]=u)}}var CP=Mw.VectorTile=function(i,n){this.layers=i.readFields(RY,{},n)},kw=Mw.VectorTileFeature=xN;Mw.VectorTileLayer=bN;class Up extends Dt{constructor(n,s,u){super(n,s),this.z=u}}class TN extends Up{constructor(n,s,u,h){super(n,s,u),this.w=h}}function Dw(i,n,s,u){const h=[],p=u===0?(m,v,w,E,A,P)=>{m.push(new Dt(P,w+(P-v)/(E-v)*(A-w)))}:(m,v,w,E,A,P)=>{m.push(new Dt(v+(P-w)/(A-w)*(E-v),P))};for(const m of i){const v=[];for(const w of m){if(w.length<=2)continue;const E=[];for(let M=0;M<w.length-1;M++){const z=w[M].x,B=w[M].y,U=w[M+1].x,$=w[M+1].y,Y=u===0?z:B,fe=u===0?U:$;Y<n?fe>n&&p(E,z,B,U,$,n):Y>s?fe<s&&p(E,z,B,U,$,s):E.push(w[M]),fe<n&&Y>=n&&p(E,z,B,U,$,n),fe>s&&Y<=s&&p(E,z,B,U,$,s)}let A=w[w.length-1];const P=u===0?A.x:A.y;P>=n&&P<=s&&E.push(A),E.length&&(A=E[E.length-1],E[0].x===A.x&&E[0].y===A.y||E.push(E[0]),v.push(E))}v.length&&h.push(v)}return h}function EN(i,n,s,u){const h=s==="x"?"y":"x",p=(u-i[s])/(n[s]-i[s]);i[h]=i[h]+(n[h]-i[h])*p,i[s]=u,i.hasOwnProperty("z")&&(i.z=En(i.z,n.z,p)),i.hasOwnProperty("w")&&(i.w=En(i.w,n.w,p))}function SN(i,n,s,u){const h=s,p=u;for(const m of["x","y"]){let v=i,w=n;v[m]>=w[m]&&(v=n,w=i),v[m]<h&&w[m]>h&&EN(v,w,m,h),v[m]<p&&w[m]>p&&EN(w,v,m,p)}}const Ow=Number.MAX_SAFE_INTEGER;function IN(i,n,s,u){return i.order<n||i.order===Ow||!(i.clipMask&s)||function(h,p){return p.length!==0&&p.find(m=>m===h)===void 0}(u,i.clipScope)}function Lw(i,n){return i.x-n.x||i.y-n.y}function AN(i,n){return Lw(i.min,n.min)===0&&Lw(i.max,n.max)===0}function PP(i,n){return!(i.min.x>n.max.x||i.max.x<n.min.x||i.min.y>n.max.y||i.max.y<n.min.y)}function RP(i,n){if(i.length!==n.length)return!1;for(let s=0;s<i.length;s++)if(i[s].sourceId!==n[s].sourceId||!AN(i[s],n[s])||i[s].order!==n[s].order||i[s].clipMask!==n[s].clipMask||!sc(i[s].clipScope,n[s].clipScope))return!1;return!0}function CN(i,n,s){const u=1/Mt,h=1/(1<<s.canonical.z),p=(n.x*u+s.canonical.x)*h+s.wrap,m=(n.y*u+s.canonical.y)*h;return{min:new Dt((i.x*u+s.canonical.x)*h+s.wrap,(i.y*u+s.canonical.y)*h),max:new Dt(p,m)}}function MY(i,n,s){const u=1<<s.canonical.z,h=((n.x-s.wrap)*u-s.canonical.x)*Mt,p=(n.y*u-s.canonical.y)*Mt;return{min:new Dt(((i.x-s.wrap)*u-s.canonical.x)*Mt,(i.y*u-s.canonical.y)*Mt),max:new Dt(h,p)}}function PN(i,n,s,u,h,p,m){const v=i.indices,w=i.vertices,E=[];for(let A=u;A<u+h;A+=3){const P=n[s[A+0]+p],M=n[s[A+1]+p],z=n[s[A+2]+p],B=Math.min(P.x,M.x,z.x),U=Math.max(P.x,M.x,z.x),$=Math.min(P.y,M.y,z.y),Y=Math.max(P.y,M.y,z.y);E.length=0,i.grid.query(new Dt(B,$),new Dt(U,Y),E);for(let fe=0;fe<E.length;fe++){const he=E[fe];if(fP(w[v[3*he+0]],w[v[3*he+1]],w[v[3*he+2]],P,M,z,m))return!0}}return!1}function RN(i,n,s,u){if(!i||!s)return!1;let h=i.vertices;if(!n.canonical.equals(u.canonical)||n.wrap!==u.wrap){if(s.vertices.length<i.vertices.length)return RN(s,u,i,n);const p=n.canonical,m=u.canonical,v=Math.pow(2,m.z-p.z);h=i.vertices.map(w=>new Dt((w.x+p.x*Mt)*v-m.x*Mt,(w.y+p.y*Mt)*v-m.y*Mt))}return PN(s,h,i.indices,0,i.indices.length,0,0)}function MN(i,n,s,u){const h=Math.pow(2,u.z-s.z);return new Dt((i+s.x*Mt)*h-u.x*Mt,(n+s.y*Mt)*h-u.y*Mt)}function kN(i,n){const s=[];n.footprint.grid.queryPoint(i,s);const u=n.footprint.indices,h=n.footprint.vertices;for(let p=0;p<s.length;p++){const m=s[p];if(Nd([h[u[3*m+0]],h[u[3*m+1]],h[u[3*m+2]]],i))return!0}return!1}class DN{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,s){const u=this.toIdx(n,s);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(n,s){return this.leaves[this.toIdx(n,s)]}toIdx(n,s){return s*this.size+n}}function ON(i,n,s,u){let h=0,p=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(u[m])<1e-15){if(s[m]<i[m]||s[m]>n[m])return null}else{const v=1/u[m];let w=(i[m]-s[m])*v,E=(n[m]-s[m])*v;if(w>E){const A=w;w=E,E=A}if(w>h&&(h=w),E<p&&(p=E),h>p)return null}return h}function LN(i,n,s,u,h,p,m,v,w,E,A){const P=u-i,M=h-n,z=p-s,B=m-i,U=v-n,$=w-s,Y=A[1]*$-A[2]*U,fe=A[2]*B-A[0]*$,he=A[0]*U-A[1]*B,me=P*Y+M*fe+z*he;if(Math.abs(me)<1e-15)return null;const Ae=1/me,Ce=E[0]-i,Le=E[1]-n,Ve=E[2]-s,He=(Ce*Y+Le*fe+Ve*he)*Ae;if(He<0||He>1)return null;const et=Le*z-Ve*M,Ze=Ve*P-Ce*z,st=Ce*M-Le*P,yt=(A[0]*et+A[1]*Ze+A[2]*st)*Ae;return yt<0||He+yt>1?null:(B*et+U*Ze+$*st)*Ae}function zN(i,n,s){return(i-n)/(s-n)}function NN(i,n,s,u,h,p,m,v,w){const E=1<<s,A=p-u,P=m-h,M=(i+1)/E*A+u,z=(n+0)/E*P+h,B=(n+1)/E*P+h;v[0]=(i+0)/E*A+u,v[1]=z,w[0]=M,w[1]=B}class FN{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(p){const m=Math.ceil(Math.log2(p.dim/8)),v=[];let w=Math.ceil(Math.pow(2,m));const E=1/w,A=(z,B,U,$,Y)=>{const fe=$?1:0,he=(z+1)*U-fe,me=B*U,Ae=(B+1)*U-fe;Y[0]=z*U,Y[1]=me,Y[2]=he,Y[3]=Ae};let P=new DN(w);const M=[];for(let z=0;z<w*w;z++){A(z%w,Math.floor(z/w),E,!1,M);const B=Bd(M[0],M[1],p),U=Bd(M[2],M[1],p),$=Bd(M[2],M[3],p),Y=Bd(M[0],M[3],p);P.minimums.push(Math.min(B,U,$,Y)),P.maximums.push(Math.max(B,U,$,Y)),P.leaves.push(1)}for(v.push(P),w/=2;w>=1;w/=2){const z=v[v.length-1];P=new DN(w);for(let B=0;B<w*w;B++){A(B%w,Math.floor(B/w),2,!0,M);const U=z.getElevation(M[0],M[1]),$=z.getElevation(M[2],M[1]),Y=z.getElevation(M[2],M[3]),fe=z.getElevation(M[0],M[3]),he=z.isLeaf(M[0],M[1]),me=z.isLeaf(M[2],M[1]),Ae=z.isLeaf(M[2],M[3]),Ce=z.isLeaf(M[0],M[3]),Le=Math.min(U.min,$.min,Y.min,fe.min),Ve=Math.max(U.max,$.max,Y.max,fe.max),He=he&&me&&Ae&&Ce;P.maximums.push(Ve),P.minimums.push(Le),P.leaves.push(Ve-Le<=5&&He?1:0)}v.push(P)}return v}(this.dem),u=s.length-1,h=s[u];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(s,0,0,u,0)}raycastRoot(n,s,u,h,p,m,v=1){return ON([n,s,-100],[u,h,this.maximums[0]*v],p,m)}raycast(n,s,u,h,p,m,v=1){if(!this.nodeCount)return null;const w=this.raycastRoot(n,s,u,h,p,m,v);if(w==null)return null;const E=[],A=[],P=[],M=[],z=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:B,t:U,nodex:$,nodey:Y,depth:fe}=z.pop();if(this.leaves[B]){NN($,Y,fe,n,s,u,h,P,M);const me=1<<fe,Ae=($+0)/me,Ce=($+1)/me,Le=(Y+0)/me,Ve=(Y+1)/me,He=Bd(Ae,Le,this.dem)*v,et=Bd(Ce,Le,this.dem)*v,Ze=Bd(Ce,Ve,this.dem)*v,st=Bd(Ae,Ve,this.dem)*v,yt=LN(P[0],P[1],He,M[0],P[1],et,M[0],M[1],Ze,p,m),ot=LN(M[0],M[1],Ze,P[0],M[1],st,P[0],P[1],He,p,m),bt=Math.min(yt!==null?yt:Number.MAX_VALUE,ot!==null?ot:Number.MAX_VALUE);if(bt!==Number.MAX_VALUE)return bt;{const rt=a.$.scaleAndAdd([],p,m,U);if(BN(He,et,st,Ze,zN(rt[0],P[0],M[0]),zN(rt[1],P[1],M[1]))>=rt[2])return U}continue}let he=0;for(let me=0;me<this._siblingOffset.length;me++){NN(($<<1)+this._siblingOffset[me][0],(Y<<1)+this._siblingOffset[me][1],fe+1,n,s,u,h,P,M),P[2]=-100,M[2]=this.maximums[this.childOffsets[B]+me]*v;const Ae=ON(P,M,p,m);if(Ae!=null){const Ce=Ae;E[me]=Ce;let Le=!1;for(let Ve=0;Ve<he&&!Le;Ve++)Ce>=E[A[Ve]]&&(A.splice(Ve,0,me),Le=!0);Le||(A[he]=me),he++}}for(let me=0;me<he;me++){const Ae=A[me];z.push({idx:this.childOffsets[B]+Ae,t:E[Ae],nodex:($<<1)+this._siblingOffset[Ae][0],nodey:(Y<<1)+this._siblingOffset[Ae][1],depth:fe+1})}}return null}_addNode(n,s,u){return this.minimums.push(n),this.maximums.push(s),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(n,s,u,h,p){if(n[h].isLeaf(s,u)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const m=h-1,v=n[m];let w=0,E=0;for(let A=0;A<this._siblingOffset.length;A++){const P=2*s+this._siblingOffset[A][0],M=2*u+this._siblingOffset[A][1],z=v.getElevation(P,M),B=v.isLeaf(P,M),U=this._addNode(z.min,z.max,B);B&&(w|=1<<A),E||(E=U)}for(let A=0;A<this._siblingOffset.length;A++)w&1<<A||this._construct(n,2*s+this._siblingOffset[A][0],2*u+this._siblingOffset[A][1],m,E+A)}}function BN(i,n,s,u,h,p){return En(En(i,s,p),En(n,u,p),h)}function Bd(i,n,s){const u=s.dim,h=Kn(i*u-.5,0,u-1),p=Kn(n*u-.5,0,u-1),m=Math.floor(h),v=Math.floor(p),w=Math.min(m+1,u-1),E=Math.min(v+1,u-1);return BN(s.get(m,v),s.get(w,v),s.get(m,E),s.get(w,E),h-m,p-v)}const kY={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function DY(i,n,s){return(256*i*256+256*n+s)/10-1e4}function OY(i,n,s){return 256*i+n+s/256-32768}class zw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,s,u,h=!1){if(this.uid=n,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return Ii(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const p=this.dim=s.height-2,m=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let w=0;w<p;w++)m[this._idx(-1,w)]=m[this._idx(0,w)],m[this._idx(p,w)]=m[this._idx(p-1,w)],m[this._idx(w,-1)]=m[this._idx(w,0)],m[this._idx(w,p)]=m[this._idx(w,p-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(p,-1)]=m[this._idx(p-1,0)],m[this._idx(-1,p)]=m[this._idx(0,p-1)],m[this._idx(p,p)]=m[this._idx(p-1,p-1)]}const v=u==="terrarium"?OY:DY;for(let w=0;w<m.length;++w){const E=4*w;this.floatView[w]=v(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=rn.now()}_buildQuadTree(){this._tree=new FN(this)}get(n,s,u=!1){u&&(n=Kn(n,-1,this.dim),s=Kn(s,-1,this.dim));const h=this._idx(n,s);return this.floatView[h]}set(n,s,u){const h=this._idx(n,s),p=this.floatView[h];return this.floatView[h]=u,u-p}static getUnpackVector(n){return kY[n]}_idx(n,s){if(n<-1||n>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(n+1)}static pack(n,s){const u=[0,0,0,0],h=zw.getUnpackVector(s);let p=Math.floor((n+h[3])/h[2]);return u[2]=p%256,p=Math.floor(p/256),u[1]=p%256,p=Math.floor(p/256),u[0]=p,u}getPixels(){return new oN({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,s,u){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,p=s*this.dim+this.dim,m=u*this.dim,v=u*this.dim+this.dim;switch(s){case-1:h=p-1;break;case 1:p=h+1}switch(u){case-1:m=v-1;break;case 1:v=m+1}const w=-s*this.dim,E=-u*this.dim;for(let A=m;A<v;A++)for(let P=h;P<p;P++){const M=4*this._idx(P,A),z=4*this._idx(P+w,A+E);this.pixels[M+0]=n.pixels[z+0],this.pixels[M+1]=n.pixels[z+1],this.pixels[M+2]=n.pixels[z+2],this.pixels[M+3]=n.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ue(zw,"DEMData"),Ue(FN,"DemMinMaxQuadTree",{omit:["dem"]});class e_{constructor(n,s,u){this._demTile=n,this._dem=this._demTile.dem,this._scale=s,this._offset=u}static create(n,s,u){const h=u||n.findDEMTileFor(s);if(!h||!h.dem)return;const p=h.dem,m=h.tileID,v=1<<s.canonical.z-m.canonical.z;return new e_(h,p.dim/Mt/v,[(s.canonical.x/v-m.canonical.x)*p.dim,(s.canonical.y/v-m.canonical.y)*p.dim])}tileCoordToPixel(n,s){const u=s*this._scale+this._offset[1],h=Math.floor(n*this._scale+this._offset[0]),p=Math.floor(u);return new Dt(h,p)}getElevationAt(n,s,u,h){const p=n*this._scale+this._offset[0],m=s*this._scale+this._offset[1],v=Math.floor(p),w=Math.floor(m),E=this._dem;return h=!!h,u?En(En(E.get(v,w,h),E.get(v,w+1,h),m-w),En(E.get(v+1,w,h),E.get(v+1,w+1,h),m-w),p-v):E.get(v,w,h)}getElevationAtPixel(n,s,u){return this._dem.get(n,s,!!u)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*Ho(1,n)*this._dem.stride}}const jN={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},LY=kw.types,zY=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-line-alignment"],NY=["fill-extrusion-flood-light-ground-radius"],FY=Math.pow(2,13),BY=Math.pow(2,15)-1,UN=new Dt(0,1),jd=2147483648;function Q0(i,n,s,u,h,p,m,v){i.emplaceBack((n<<1)+m,(s<<1)+p,(Math.floor(u*FY)<<1)+h,Math.round(v))}function J0(i,n,s,u){i.emplaceBack(n.x*Mt,n.y*Mt,s?0:1,u?1:0)}function Nw(i,n,s,u,h,p){i.emplaceBack(n.x,n.y,(s.x<<1)+u,(s.y<<1)+h,p)}function ev(i,n,s){i.emplaceBack(n.x,n.y,n.z,s[0]*16384,s[1]*16384,s[2]*16384)}class VN{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class $N{constructor(){this.centroidXY=new Dt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Dt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Dt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Dt(this.max.x-this.min.x,this.max.y-this.min.y)}}class GN{constructor(){this.acc=new Dt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,s){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=s.x,n.min.y=n.max.y=s.y)}appendEdge(n,s,u){this.accCount++,this.acc._add(s);let h=!!this.borders;s.x<n.min.x?(n.min.x=s.x,h=!0):s.x>n.max.x&&(n.max.x=s.x,h=!0),s.y<n.min.y?(n.min.y=s.y,h=!0):s.y>n.max.y&&(n.max.y=s.y,h=!0),((s.x===0||s.x===Mt)&&s.x===u.x)!=((s.y===0||s.y===Mt)&&s.y===u.y)&&this.processBorderOverlap(s,u),h&&this.checkBorderIntersection(s,u)}checkBorderIntersection(n,s){s.x<0!=n.x<0&&this.addBorderIntersection(0,En(s.y,n.y,(0-s.x)/(n.x-s.x))),s.x>Mt!=n.x>Mt&&this.addBorderIntersection(1,En(s.y,n.y,(Mt-s.x)/(n.x-s.x))),s.y<0!=n.y<0&&this.addBorderIntersection(2,En(s.x,n.x,(0-s.y)/(n.y-s.y))),s.y>Mt!=n.y>Mt&&this.addBorderIntersection(3,En(s.x,n.x,(Mt-s.y)/(n.y-s.y)))}addBorderIntersection(n,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[n];s<u[0]&&(u[0]=s),s>u[1]&&(u[1]=s)}processBorderOverlap(n,s){if(n.x===s.x){if(n.y===s.y)return;const u=n.x===0?0:1;this.addBorderIntersection(u,s.y),this.addBorderIntersection(u,n.y)}else{const u=n.y===0?2:3;this.addBorderIntersection(u,s.x),this.addBorderIntersection(u,n.x)}}centroid(){return this.accCount===0?new Dt(0,0):new Dt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((n,s)=>n+ +(s[0]!==Number.MAX_VALUE),0):0}}function qN(i,n){const s=i.add(n)._unit(),u=Kn(i.x*s.x+i.y*s.y,-1,1);var h,p,m;return h=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(h)))/4*BY*((p=i).x*(m=n).y-p.y*m.x<0?-1:1)}const jY=[i=>i.x<0,i=>i.x>Mt,i=>i.y<0,i=>i.y>Mt];function UY(i,n,s,u){const h=[4];if(u===0)return h;s._mult(u);const p=i.sub(s),m=n.sub(s),v=[i,n,p,m];for(let w=0;w<4;w++)for(const E of v)if(jY[w](E)){h.push(w);break}return h}class WN{constructor(n){this.vertexArray=new LC,this.indexArray=new js,this.programConfigurations=new Ld(n.layers,{zoom:n.zoom,lut:n.lut},s=>NY.includes(s)),this._segments=new wi,this.hiddenByLandmarkVertexArray=new XC,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new wi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,s,u,h=!1){const p=n.length;if(p>2){let m=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let w;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const E=n[0],A=n[1];w=qN(E.sub(n[p-1])._perp()._unit(),A.sub(E)._perp()._unit())}for(let E=0;E<p;E++){const A=E===p-1?0:E+1,P=n[E],M=n[A],z=n[A===p-1?0:A+1],B=M.sub(P)._perp()._unit(),U=qN(B,z.sub(M)._perp()._unit()),$=w,Y=U;if(MP(P,M,s)||h&&XN(P,s)&&XN(M,s)){w=U;continue}const fe=v.vertexLength;Nw(this.vertexArray,P,M,1,1,$),Nw(this.vertexArray,P,M,1,0,$),Nw(this.vertexArray,P,M,0,1,Y),Nw(this.vertexArray,P,M,0,0,Y),v.vertexLength+=4;const he=UY(P,M,B,u);for(const me of he)this._segmentToGroundQuads[m].push({id:fe,region:me}),this._segmentToRegionTriCounts[m][me]+=2,v.primitiveLength+=2;w=U}}}prepareBorderSegments(){if(!this.hasData())return;const n=this._segments.get(),s=n.length;for(let u=0;u<s;u++)this._segmentToGroundQuads[u].sort((h,p)=>h.region-p.region);for(let u=0;u<s;u++){const h=this._segmentToGroundQuads[u],p=n[u],m=this._segmentToRegionTriCounts[u];m.reduce((w,E)=>w+E,0);let v=0;for(let w=0;w<=4;w++){const E=m[w];if(E!==0){let A=this.regionSegments[w];A||(A=this.regionSegments[w]=new wi);const P={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+v,vertexLength:p.vertexLength,primitiveLength:E};A.get().push(P)}v+=E}for(let w=0;w<h.length;w++){const E=h[w].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,s,u,h,p,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,s,u,h,p,m)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,yY.members),this.indexBuffer=n.createIndexBuffer(this.indexArray))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,s,u,h,p,m){this.hasData()&&this.programConfigurations.updatePaintArrays(n,s,u,h,p,m)}updateHiddenByLandmark(n){if(!this.hasData())return;const s=n.groundVertexCount+n.groundVertexArrayOffset;if(n.groundVertexCount===0)return;const u=n.flags&jd?1:0;for(let h=n.groundVertexArrayOffset;h<s;++h)this.hiddenByLandmarkVertexArray.emplace(h,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,bY.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){const s=this.regionSegments[n];s&&s.destroy()}}}}class Fw{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new js,this.footprintVertices=new xc,this.footprintSegments=[],this.layoutVertexArray=new mh,this.centroidVertexArray=new yz,this.wallVertexArray=new xz,this.indexArray=new js,this.programConfigurations=new Ld(n.layers,{zoom:n.zoom,lut:n.lut},s=>zY.includes(s)),this.segments=new wi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new WN(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(n,s){}populate(n,s,u,h){this.features=[],this.hasPattern=SP("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=yw(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:m,index:v,sourceLayerIndex:w}of n){const E=this.layers[0]._featureFilter.needGeometry,A=vh(p,E);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),A,u))continue;const P={id:m,sourceLayerIndex:w,index:v,geometry:E?A.geometry:wc(p,u,h),properties:p.properties,type:p.type,patterns:{}},M=this.layoutVertexArray.length;if(this.hasPattern)this.features.push(IP("fill-extrusion",this.layers,P,this.zoom,s));else if(this.wallMode)for(const z of P.geometry)this.addFeature(P,[z],v,u,{},s.availableImages,h,s.brightness);else this.addFeature(P,P.geometry,v,u,{},s.availableImages,h,s.brightness);s.featureIndex.insert(p,P.geometry,v,w,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,s,u,h,p,m){for(const v of this.features){const{geometry:w}=v;if(this.wallMode)for(const E of w)this.addFeature(v,[E],v.index,s,u,h,p,m);else this.addFeature(v,w,v.index,s,u,h,p,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,s,u,h,p){const m=Object.keys(n).length!==0;if(m&&!this.stateDependentLayers.length)return;const v=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(n,s,v,u,h,p),this.groundEffect.update(n,s,v,u,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,TY),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.wallVertexBuffer=n.createVertexBuffer(this.wallVertexArray,xY.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,wY.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,vY.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,s,u,h,p,m,v,w){const E=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,A=[new Dt(0,0),new Dt(Mt,Mt)],P=v.projection,M=P.name==="globe",z=this.wallMode||LY[n.type]==="Polygon",B=new GN;B.centroidDataIndex=this.centroidData.length;const U=new $N,$=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},h)<=0,Y=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},h);let fe;if(U.height=Y,U.vertexArrayOffset=this.layoutVertexArray.length,U.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new fw),this.wallMode){if(M)return void Ii("Non zero fill-extrusion-line-width is not yet supported on globe.");if(s.length!==1)return;fe=function(et){const Ze=et[0].x===et[et.length-1].x&&et[0].y===et[et.length-1].y;(function(dn){let Yt=0;const kt=dn.length;for(let Mn=0;Mn<kt;Mn++)Yt+=(dn[(Mn+1)%kt].x-dn[Mn].x)*(dn[(Mn+1)%kt].y+dn[Mn].y);return Yt>=0})(et)||(et=et.reverse());const yt={isPolygon:Ze,geometry:[],joinNormals:[]},ot=[],bt=[],rt=[];let dt=et.length;if(dt<(Ze?3:2))return yt;for(;dt>=2&&et[dt-1].equals(et[dt-2]);)dt--;let It,at,Ot,Et,vt,vn=0;for(;vn<dt-1&&et[vn].equals(et[vn+1]);)vn++;Ze&&(It=et[dt-2],vt=et[vn].sub(It)._unit()._perp());for(let dn=vn;dn<dt;dn++){if(Ot=dn===dt-1?Ze?et[vn+1]:void 0:et[dn+1],Ot&&et[dn].equals(Ot))continue;vt&&(Et=vt),It&&(at=It),It=et[dn],vt=Ot?Ot.sub(It)._unit()._perp():Et,Et=Et||vt;const Yt=Et.add(vt);Yt.x===0&&Yt.y===0||Yt._unit();const kt=Yt.x*vt.x+Yt.y*vt.y,Mn=kt!==0?1/kt:1/0,pn=Et.x*vt.y-Et.y*vt.x>0;let an="miter";an==="miter"&&Mn>2&&(an="bevel");const Fn=(jn,Bn,Xn,_r)=>{const cr=new Dt(jn.x,jn.y),Wr=new Dt(jn.x,jn.y);cr.x-=Bn.x*_r,cr.y-=Bn.y*_r,Wr.x-=Bn.x*Math.max(Xn,1),Wr.y-=Bn.y*Math.max(Xn,1),rt.push(Bn),ot.push(cr),bt.push(Wr)};if(an==="miter")Yt._mult(Mn),Fn(It,Yt,1,0);else{const jn=-Math.sqrt(Mn*Mn-1),Bn=pn?jn:0,Xn=pn?0:jn;at&&Fn(It,Et,Bn,Xn),Ot&&Fn(It,vt,Bn,Xn)}}return yt.geometry=[...ot,...bt.reverse(),ot[0]],yt.joinNormals=[...rt,...rt.reverse(),rt[rt.length-1]],yt}(s[0]),s=[fe.geometry]}const he=(et,Ze)=>et<(Ze.length-1)/2||et===Ze.length-1,me=this.wallMode?[s]:Pw(s,500);for(let et=me.length-1;et>=0;et--){const Ze=me[et];(Ze.length===0||(Ae=Ze[0]).every(st=>st.x<=0)||Ae.every(st=>st.x>=Mt)||Ae.every(st=>st.y<=0)||Ae.every(st=>st.y>=Mt))&&me.splice(et,1)}var Ae;let Ce;if(M)Ce=JN(me,A,h);else{Ce=[];for(const et of me)Ce.push({polygon:et,bounds:A})}const Le=z?this.edgeRadius:0,Ve=Le>0&&this.zoom<17,He=(et,Ze)=>{if(et.length===0)return!1;const st=et[et.length-1];return Ze.x===st.x&&Ze.y===st.y};for(const{polygon:et,bounds:Ze}of Ce){let st=0,yt=0;for(const dt of et)z&&!dt[0].equals(dt[dt.length-1])&&dt.push(dt[0]),yt+=z?dt.length-1:dt.length;const ot=this.segments.prepareSegment((z?5:4)*yt,this.layoutVertexArray,this.indexArray);U.footprintSegIdx<0&&(U.footprintSegIdx=this.footprintSegments.length),U.polygonSegIdx<0&&(U.polygonSegIdx=this.polygonSegments.length);const bt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},rt=new VN;if(rt.vertexOffset=this.footprintVertices.length,rt.indexOffset=3*this.footprintIndices.length,rt.ringIndices=[],z){const dt=[],It=[];st=ot.vertexLength;for(let Ot=0;Ot<et.length;Ot++){const Et=et[Ot];Et.length&&Ot!==0&&It.push(dt.length/2);const vt=[];let vn,dn;vn=Et[1].sub(Et[0])._perp()._unit(),rt.ringIndices.push(Et.length-1);for(let Yt=1;Yt<Et.length;Yt++){const kt=Et[Yt],Mn=Et[Yt===Et.length-1?1:Yt+1],pn=kt.clone();if(Le){dn=Mn.sub(kt)._perp()._unit();const an=vn.add(dn)._unit(),Fn=Le*Math.min(4,1/(vn.x*an.x+vn.y*an.y));pn.x+=Fn*an.x,pn.y+=Fn*an.y,pn.x=Math.round(pn.x),pn.y=Math.round(pn.y),vn=dn}if(!$||Le!==0&&!Ve||He(vt,pn)||vt.push(pn),Q0(this.layoutVertexArray,pn.x,pn.y,0,0,1,1,0),this.wallMode){const an=he(Yt,Et);J0(this.wallVertexArray,fe.joinNormals[Yt],an,fe.isPolygon)}ot.vertexLength++,this.footprintVertices.emplaceBack(kt.x,kt.y),dt.push(kt.x,kt.y),M&&ev(this.layoutVertexExtArray,P.projectTilePoint(pn.x,pn.y,h),P.upVector(h,pn.x,pn.y))}$&&(Le===0||Ve)&&(vt.length!==0&&He(vt,vt[0])&&vt.pop(),this.groundEffect.addData(vt,Ze,E))}const at=Z0(dt,It);for(let Ot=0;Ot<at.length;Ot+=3)this.footprintIndices.emplaceBack(rt.vertexOffset+at[Ot+0],rt.vertexOffset+at[Ot+1],rt.vertexOffset+at[Ot+2]),this.indexArray.emplaceBack(st+at[Ot],st+at[Ot+2],st+at[Ot+1]),ot.primitiveLength++;rt.indexCount+=at.length,rt.vertexCount+=this.footprintVertices.length-rt.vertexOffset}for(let dt=0;dt<et.length;dt++){const It=et[dt];B.startRing(U,It[0]);let at=It.length>4&&KN(It[It.length-2],It[0],It[1]),Ot=Le?VY(It[It.length-2],It[0],It[1],Le):0;const Et=[];let vt,vn,dn;vn=It[1].sub(It[0])._perp()._unit();let Yt=!0;for(let kt=1,Mn=0;kt<It.length;kt++){let pn=It[kt-1],an=It[kt];const Fn=It[kt===It.length-1?1:kt+1];if(B.appendEdge(U,an,pn),MP(an,pn,Ze)){Le&&(vn=Fn.sub(an)._perp()._unit(),Yt=!Yt);continue}const jn=an.sub(pn)._perp(),Bn=jn.x/(Math.abs(jn.x)+Math.abs(jn.y)),Xn=jn.y>0?1:0,_r=pn.dist(an);if(Mn+_r>32768&&(Mn=0),Le){dn=Fn.sub(an)._perp()._unit();let Un=ZN(pn,an,Fn,HN(vn,dn),Le);isNaN(Un)&&(Un=0);const zr=an.sub(pn)._unit();pn=pn.add(zr.mult(Ot))._round(),an=an.add(zr.mult(-Un))._round(),Ot=Un,vn=dn,$&&this.zoom>=17&&(He(Et,pn)||Et.push(pn),He(Et,an)||Et.push(an))}const cr=ot.vertexLength,Wr=It.length>4&&KN(pn,an,Fn);let Xr=YN(Mn,at,Yt);if(Q0(this.layoutVertexArray,pn.x,pn.y,Bn,Xn,0,0,Xr),Q0(this.layoutVertexArray,pn.x,pn.y,Bn,Xn,0,1,Xr),this.wallMode){const Un=he(kt-1,It),zr=fe.joinNormals[kt-1];J0(this.wallVertexArray,zr,!Un,fe.isPolygon),J0(this.wallVertexArray,zr,!Un,fe.isPolygon)}if(Mn+=_r,Xr=YN(Mn,Wr,!Yt),at=Wr,Q0(this.layoutVertexArray,an.x,an.y,Bn,Xn,0,0,Xr),Q0(this.layoutVertexArray,an.x,an.y,Bn,Xn,0,1,Xr),this.wallMode){const Un=he(kt,It),zr=fe.joinNormals[kt];J0(this.wallVertexArray,zr,!Un,fe.isPolygon),J0(this.wallVertexArray,zr,!Un,fe.isPolygon)}if(ot.vertexLength+=4,this.indexArray.emplaceBack(cr+0,cr+1,cr+2),this.indexArray.emplaceBack(cr+1,cr+3,cr+2),ot.primitiveLength+=2,Le){const Un=st+(kt===1?It.length-2:kt-2),zr=kt===1?st:Un+1;if(this.indexArray.emplaceBack(cr+1,Un,cr+3),this.indexArray.emplaceBack(Un,zr,cr+3),ot.primitiveLength+=2,vt===void 0&&(vt=cr),!MP(Fn,It[kt],Ze)){const Br=kt===It.length-1?vt:ot.vertexLength;this.indexArray.emplaceBack(cr+2,cr+3,Br),this.indexArray.emplaceBack(cr+3,Br+1,Br),this.indexArray.emplaceBack(cr+3,zr,Br+1),ot.primitiveLength+=3}Yt=!Yt}if(M){const Un=this.layoutVertexExtArray,zr=P.projectTilePoint(pn.x,pn.y,h),Br=P.projectTilePoint(an.x,an.y,h),oi=P.upVector(h,pn.x,pn.y),Fi=P.upVector(h,an.x,an.y);ev(Un,zr,oi),ev(Un,zr,oi),ev(Un,Br,Fi),ev(Un,Br,Fi)}}z&&(st+=It.length-1),$&&Le&&this.zoom>=17&&(Et.length!==0&&He(Et,Et[0])&&Et.pop(),this.groundEffect.addData(Et,Ze,E,Le>0))}this.footprintSegments.push(rt),bt.triangleCount=this.indexArray.length-bt.triangleArrayOffset,this.polygonSegments.push(bt),++U.footprintSegLen,++U.polygonSegLen}if(U.vertexCount=this.layoutVertexArray.length-U.vertexArrayOffset,U.groundVertexCount=this.groundEffect.vertexArray.length-U.groundVertexArrayOffset,U.vertexCount!==0){if(U.centroidXY=B.borders?UN:this.encodeCentroid(B,U),this.centroidData.push(U),B.borders){this.featuresOnBorder.push(B);const et=this.featuresOnBorder.length-1;for(let Ze=0;Ze<B.borders.length;Ze++)B.borders[Ze][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ze].push(et)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,p,m,h,w),this.groundEffect.addPaintPropertiesData(n,u,p,m,h,w),this.maxHeight=Math.max(this.maxHeight,Y)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort((s,u)=>this.featuresOnBorder[s].borders[n][0]-this.featuresOnBorder[u].borders[n][0])}splitToSubtiles(){const n=[];for(let v=0;v<this.centroidData.length;v++){const w=this.centroidData[v],E=+(w.min.y+w.max.y>Mt),A=2*E+(+(w.min.x+w.max.x>Mt)^E);for(let P=0;P<w.polygonSegLen;P++){const M=w.polygonSegIdx+P;n.push({centroidIdx:v,subtile:A,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const s=new js;n.sort((v,w)=>v.triangleSegmentIdx===w.triangleSegmentIdx?v.subtile-w.subtile:v.triangleSegmentIdx-w.triangleSegmentIdx);let u=0,h=0,p=0;for(const v of n){if(v.triangleSegmentIdx!==u)break;p++}const m=n.length;for(;h!==n.length;){u=n[h].triangleSegmentIdx;let v=0,w=h,E=h;for(let A=w;A<p&&n[A].subtile===v;A++)E++;for(;w!==p;){const A=n[w];v=A.subtile;const P=this.centroidData[A.centroidIdx].min.clone(),M=this.centroidData[A.centroidIdx].max.clone(),z={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let B=w;B<E;B++){const U=n[B],$=this.polygonSegments[U.polygonSegmentIdx],Y=this.centroidData[U.centroidIdx].min,fe=this.centroidData[U.centroidIdx].max,he=this.indexArray.uint16;for(let me=$.triangleArrayOffset;me<$.triangleArrayOffset+$.triangleCount;me++)s.emplaceBack(he[3*me],he[3*me+1],he[3*me+2]);z.primitiveLength+=$.triangleCount,P.x=Math.min(P.x,Y.x),P.y=Math.min(P.y,Y.y),M.x=Math.max(M.x,fe.x),M.y=Math.max(M.y,fe.y)}z.primitiveLength>0&&this.triangleSubSegments.push({segment:z,min:P,max:M}),w=E;for(let B=w;B<p&&n[B].subtile===n[w].subtile;B++)E++}h=p;for(let A=h;A<m&&n[A].triangleSegmentIdx===n[h].triangleSegmentIdx;A++)p++}s._trim(),this.indexArray=s}getVisibleSegments(n,s,u){const h=new wi;if(this.wallMode){for(const U of this.triangleSubSegments)h.segments.push(U.segment);return h}let p=0,m=0;const v=1<<n.canonical.z;if(s){const U=s.getMinMaxForTile(n);U&&(p=U.min,m=U.max)}m+=this.maxHeight;const w=n.toUnwrapped();let E;const A=[w.canonical.x/v+w.wrap,w.canonical.y/v],P=[(w.canonical.x+1)/v+w.wrap,(w.canonical.y+1)/v],M=(U,$,Y)=>[U[0]*(1-Y[0])+$[0]*Y[0],U[1]*(1-Y[1])+$[1]*Y[1]],z=[],B=[];for(const U of this.triangleSubSegments){z[0]=U.min.x/Mt,z[1]=U.min.y/Mt,B[0]=U.max.x/Mt,B[1]=U.max.y/Mt;const $=M(A,P,z),Y=M(A,P,B);if(new mi([$[0],$[1],p],[Y[0],Y[1],m]).intersectsPrecise(u)===0){E&&(h.segments.push(E),E=void 0);continue}const fe=U.segment;E&&E.vertexOffset!==fe.vertexOffset&&(h.segments.push(E),E=void 0),E?(E.vertexLength+=fe.vertexLength,E.primitiveLength+=fe.primitiveLength):E={vertexOffset:fe.vertexOffset,primitiveLength:fe.primitiveLength,vertexLength:fe.vertexLength,primitiveOffset:fe.primitiveOffset,sortKey:void 0,vaos:{}}}return E&&h.segments.push(E),h}encodeCentroid(n,s){const u=n.centroid(),h=s.span(),p=Math.min(7,Math.round(h.x*this.tileToMeter/10)),m=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new Dt(Kn(u.x,1,Mt-1)<<3|p,Kn(u.y,1,Mt-1)<<3|m)}encodeBorderCentroid(n){if(!n.borders)return new Dt(0,0);const s=n.borders,u=Number.MAX_VALUE;if(s[0][0]!==u||s[1][0]!==u){const h=s[0][0]!==u?0:1;return new Dt(6|(s[0][0]!==u?0:65528),(s[h][0]+s[h][1])/2<<3|6)}{const h=s[2][0]!==u?2:3;return new Dt((s[h][0]+s[h][1])/2<<3|6,6|(s[2][0]!==u?0:65528))}}showCentroid(n){const s=this.centroidData[n.centroidDataIndex];s.flags&=jd,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);const s=n.vertexArrayOffset,u=n.vertexCount+n.vertexArrayOffset,h=n.flags&jd?UN:n.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==h.y||p!==h.x){for(let m=s;m<u;++m)this.centroidVertexArray.emplace(m,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const h=s.getReplacementRegionsForTile(n.toUnwrapped());if(RP(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const p=[];for(const m of this.activeReplacements){if(m.order<u)continue;const v=Math.pow(2,m.footprintTileId.canonical.z-n.canonical.z);for(const w of this.centroidData)if(!(w.flags&jd||m.min.x>w.max.x||w.min.x>m.max.x||m.min.y>w.max.y||w.min.y>m.max.y))for(let E=0;E<w.footprintSegLen;E++){const A=this.footprintSegments[w.footprintSegIdx+E];if(p.length=0,$Y(this.footprintVertices,A.vertexOffset,A.vertexCount,m.footprintTileId.canonical,n.canonical,p),PN(m.footprint,p,this.footprintIndices.uint16,A.indexOffset,A.indexCount,-A.vertexOffset,-v)){w.flags|=jd;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,s,u){let h=!1;for(let p=0;p<u.footprintSegLen;p++){const m=this.footprintSegments[u.footprintSegIdx+p];let v=0;for(const w of m.ringIndices){for(let E=v,A=w+v-1;E<w+v;A=E++){const P=this.footprintVertices.int16[2*(E+m.vertexOffset)+0],M=this.footprintVertices.int16[2*(E+m.vertexOffset)+1],z=this.footprintVertices.int16[2*(A+m.vertexOffset)+1];M>s!=z>s&&n<(this.footprintVertices.int16[2*(A+m.vertexOffset)+0]-P)*(s-M)/(z-M)+P&&(h=!h)}v=w}}return h}getHeightAtTileCoord(n,s){let u=Number.NEGATIVE_INFINITY,h=!0;const p=4*(n+Mt)*Mt+(s+Mt);if(this.partLookup.hasOwnProperty(p)){const m=this.partLookup[p];return m?{height:m.height,hidden:!!(m.flags&jd)}:void 0}for(const m of this.centroidData)n>m.max.x||m.min.x>n||s>m.max.y||m.min.y>s||this.footprintContainsPoint(n,s,m)&&m&&m.height>u&&(u=m.height,this.partLookup[p]=m,h=!!(m.flags&jd));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.partLookup[p]=void 0}}function HN(i,n){const s=i.add(n)._unit();return i.x*s.x+i.y*s.y}function VY(i,n,s,u){const h=n.sub(i)._perp()._unit(),p=s.sub(n)._perp()._unit();return ZN(i,n,s,HN(h,p),u)}function ZN(i,n,s,u,h){const p=Math.sqrt(1-u*u);return Math.min(i.dist(n)/3,n.dist(s)/3,h*p/u)}function MP(i,n,s){return i.x<s[0].x&&n.x<s[0].x||i.x>s[1].x&&n.x>s[1].x||i.y<s[0].y&&n.y<s[0].y||i.y>s[1].y&&n.y>s[1].y}function XN(i,n){return i.x<n[0].x||i.x>n[1].x||i.y<n[0].y||i.y>n[1].y}function KN(i,n,s){if(i.x<0||i.x>=Mt||n.x<0||n.x>=Mt||s.x<0||s.x>=Mt)return!1;const u=s.sub(n),h=u.perp(),p=i.sub(n);return(u.x*p.x+u.y*p.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(p.x*p.x+p.y*p.y))>-.866&&h.x*p.x+h.y*p.y<0}function YN(i,n,s){const u=n?2|i:-3&i;return s?1|u:-2&u}function QN(){const i=Math.PI/32,n=Math.tan(i),s=Zg;return s*Math.sqrt(1+2*n*n)-s}function JN(i,n,s){const u=1<<s.z,h=ya(s.x/u),p=ya((s.x+1)/u),m=Xs(s.y/u),v=Xs((s.y+1)/u);return function(w,E,A,P,M=0,z){const B=[];if(!w.length||!A||!P)return B;const U=(Ce,Le)=>{for(const Ve of Ce)B.push({polygon:Ve,bounds:Le})},$=Math.ceil(Math.log2(A)),Y=Math.ceil(Math.log2(P)),fe=$-Y,he=[];for(let Ce=0;Ce<Math.abs(fe);Ce++)he.push(fe>0?0:1);for(let Ce=0;Ce<Math.min($,Y);Ce++)he.push(0),he.push(1);let me=w;if(me=Dw(me,E[0].y-M,E[1].y+M,1),me=Dw(me,E[0].x-M,E[1].x+M,0),!me.length)return B;const Ae=[];for(he.length?Ae.push({polygons:me,bounds:E,depth:0}):U(me,E);Ae.length;){const Ce=Ae.pop(),Le=Ce.depth,Ve=he[Le],He=Ce.bounds[0],et=Ce.bounds[1],Ze=Ve===0?He.x:He.y,st=Ve===0?et.x:et.y,yt=z?z(Ve,Ze,st):.5*(Ze+st),ot=Dw(Ce.polygons,Ze-M,yt+M,Ve),bt=Dw(Ce.polygons,yt-M,st+M,Ve);if(ot.length){const rt=[He,new Dt(Ve===0?yt:et.x,Ve===1?yt:et.y)];he.length>Le+1?Ae.push({polygons:ot,bounds:rt,depth:Le+1}):U(ot,rt)}if(bt.length){const rt=[new Dt(Ve===0?yt:He.x,Ve===1?yt:He.y),et];he.length>Le+1?Ae.push({polygons:bt,bounds:rt,depth:Le+1}):U(bt,rt)}}return B}(i,n,Math.ceil((p-h)/11.25),Math.ceil((m-v)/11.25),1,(w,E,A)=>{if(w===0)return .5*(E+A);{const P=Xs((s.y+E/Mt)/u);return(du(.5*(Xs((s.y+A/Mt)/u)+P))*u-s.y)*Mt}})}function $Y(i,n,s,u,h,p){const m=Math.pow(2,u.z-h.z);for(let v=0;v<s;v++){let w=i.int16[2*(v+n)+0],E=i.int16[2*(v+n)+1];w=(w+h.x*Mt)*m-u.x*Mt,E=(E+h.y*Mt)*m-u.y*Mt,p.push(new Dt(w,E))}}let eF,tF;function tv(i,n){return i.x*n.x+i.y*n.y}function nF(i,n){if(i.length===1){let s=0;const u=n[s++];let h;for(;!h||u.equals(h);)if(h=n[s++],!h)return 1/0;for(;s<n.length;s++){const p=n[s],m=i[0],v=h.sub(u),w=p.sub(u),E=m.sub(u),A=tv(v,v),P=tv(v,w),M=tv(w,w),z=tv(E,v),B=tv(E,w),U=A*M-P*P,$=(M*z-P*B)/U,Y=(A*B-P*z)/U,fe=u.z*(1-$-Y)+h.z*$+p.z*Y;if(isFinite(fe))return fe}return 1/0}{let s=1/0;for(const u of n)s=Math.min(s,u.z);return s}}function rF(i,n,s,u,h,p,m,v){const w=m*h.getElevationAt(i,n,!0,!0),E=p[0]!==0,A=E?p[1]===0?m*(p[0]/7-450):m*function(P,M,z){const B=Math.floor(M[0]/8),U=Math.floor(M[1]/8),$=10*(M[0]-8*B),Y=10*(M[1]-8*U),fe=P.getElevationAt(B,U,!0,!0),he=P.getMeterToDEM(z),me=Math.floor(.5*($*he-1)),Ae=Math.floor(.5*(Y*he-1)),Ce=P.tileCoordToPixel(B,U),Le=2*me+1,Ve=2*Ae+1,He=function(bt,rt,dt,It,at){return[bt.getElevationAtPixel(rt,dt,!0),bt.getElevationAtPixel(rt+at,dt,!0),bt.getElevationAtPixel(rt,dt+at,!0),bt.getElevationAtPixel(rt+It,dt+at,!0)]}(P,Ce.x-me,Ce.y-Ae,Le,Ve),et=Math.abs(He[0]-He[1]),Ze=Math.abs(He[2]-He[3]),st=Math.abs(He[0]-He[2])+Math.abs(He[1]-He[3]),yt=Math.min(.25,.5*he*(et+Ze)/Le),ot=Math.min(.25,.5*he*st/Ve);return fe+Math.max(yt*$,ot*Y)}(h,p,v):w;return{base:w+(s===0)?-1:s,top:E?Math.max(A+u,w+s+2):w+u}}Ue(Fw,"FillExtrusionBucket",{omit:["layers","features"]}),Ue($N,"PartData"),Ue(VN,"FootprintSegment"),Ue(GN,"BorderCentroidData"),Ue(WN,"GroundEffect");const GY=Lr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:qY}=GY,WY=Lr([{name:"a_packed",components:4,type:"Float32"}]),{members:HY}=WY,ZY=Lr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:XY}=ZY,KY=Lr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),YY=Lr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),QY=Lr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Lr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const iF=Lr([{name:"a_z_offset",components:1,type:"Float32"}],4),JY=Lr([{name:"a_texb",components:2,type:"Uint16"}]),eQ=Lr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),tQ=Lr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Lr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const sF=Lr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nQ=Lr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Lr([{name:"triangle",components:3,type:"Uint16"}]),Lr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Lr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Lr([{type:"Float32",name:"offsetX"}]),Lr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class oF{constructor(n,s){this.width=n,this.height=s,this.nextRow=0,this.image=new Fd({width:n,height:s}),this.positions={},this.uploaded=!1}getDash(n,s){const u=this.getKey(n,s);return this.positions[u]}trim(){const n=this.width,s=this.height=Ia(this.nextRow);this.image.resize({width:n,height:s})}getKey(n,s){return n.join(",")+s}getDashRanges(n,s,u){const h=[];let p=n.length%2==1?-n[n.length-1]*u:0,m=n[0]*u,v=!0;h.push({left:p,right:m,isDash:v,zeroLength:n[0]===0});let w=n[0];for(let E=1;E<n.length;E++){v=!v;const A=n[E];p=w*u,w+=A,m=w*u,h.push({left:p,right:m,isDash:v,zeroLength:A===0})}return h}addRoundDash(n,s,u){const h=s/2;for(let p=-u;p<=u;p++){const m=this.width*(this.nextRow+u+p);let v=0,w=n[v];for(let E=0;E<this.width;E++){E/w.right>1&&(w=n[++v]);const A=Math.abs(E-w.left),P=Math.abs(E-w.right),M=Math.min(A,P);let z;const B=p/u*(h+1);if(w.isDash){const U=h-Math.abs(B);z=Math.sqrt(M*M+U*U)}else z=h-Math.sqrt(M*M+B*B);this.image.data[m+E]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(n,s){for(let w=n.length-1;w>=0;--w){const E=n[w],A=n[w+1];E.zeroLength?n.splice(w,1):A&&A.isDash===E.isDash&&(A.left=E.left,n.splice(w,1))}const u=n[0],h=n[n.length-1];u.isDash===h.isDash&&(u.left=h.left-this.width,h.right=u.right+this.width);const p=this.width*this.nextRow;let m=0,v=n[m];for(let w=0;w<this.width;w++){w/v.right>1&&(v=n[++m]);const E=Math.abs(w-v.left),A=Math.abs(w-v.right),P=Math.min(E,A);this.image.data[p+w]=Math.max(0,Math.min(255,(v.isDash?P:-P)+s+128))}}addDash(n,s){const u=this.getKey(n,s);if(this.positions[u])return this.positions[u];const h=s==="round",p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return Ii("LineAtlas out of space"),null;n.length===0&&n.push(1);let v=0;for(let A=0;A<n.length;A++)n[A]<0&&(Ii("Negative value is found in line dasharray, replacing values with 0"),n[A]=0),v+=n[A];if(v!==0){const A=this.width/v,P=this.getDashRanges(n,this.width,A);h?this.addRoundDash(P,A,p):this.addRegularDash(P,s==="square"?.5*A:0)}const w=this.nextRow+p;this.nextRow+=m;const E={tl:[w,p],br:[v,0]};return this.positions[u]=E,E}}Ue(oF,"LineAtlas");const rQ=kw.types,iQ=Math.cos(Math.PI/180*37.5),sQ=Math.cos(Math.PI/180*5);class Bw{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new zC,this.layoutVertexArray2=new Rd,this.patternVertexArray=new Md,this.indexArray=new js,this.programConfigurations=new Ld(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new wi,this.maxLineLength=0,this.zOffsetVertexArray=new Gg,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=n.tessellationStep?n.tessellationStep:Mt/64}updateFootprints(n,s){}populate(n,s,u,h){this.hasPattern=SP("line",this.layers,s);const p=this.layers[0].layout.get("line-sort-key"),m=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!m.isConstant()||!!m.constantOr(0);const v=[];for(const{feature:P,id:M,index:z,sourceLayerIndex:B}of n){const U=this.layers[0]._featureFilter.needGeometry,$=vh(P,U);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),$,u))continue;const Y=p?p.evaluate($,{},u):void 0,fe={id:M,properties:P.properties,type:P.type,sourceLayerIndex:B,index:z,geometry:U?$.geometry:wc(P,u,h),patterns:{},sortKey:Y};v.push(fe)}p&&v.sort((P,M)=>P.sortKey-M.sortKey);const{lineAtlas:w,featureIndex:E}=s,A=this.addConstantDashes(w);for(const P of v){const{geometry:M,index:z,sourceLayerIndex:B}=P;if(A&&this.addFeatureDashes(P,w),this.hasPattern){const U=IP("line",this.layers,P,this.zoom,s);this.patternFeatures.push(U)}else this.addFeature(P,M,z,u,w.positions,s.availableImages,s.brightness);E.insert(n[z].feature,M,z,B,this.index)}}addConstantDashes(n){let s=!1;for(const u of this.layers){const h=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")s=!0;else{const m=p.value,v=h.value;if(!v)continue;n.addDash(v,m)}}return s}addFeatureDashes(n,s){const u=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,m=h.layout.get("line-cap").value;if(p.kind==="constant"&&m.kind==="constant")continue;let v,w;if(p.kind==="constant"){if(v=p.value,!v)continue}else v=p.evaluate({zoom:u},n);w=m.kind==="constant"?m.value:m.evaluate({zoom:u},n),s.addDash(v,w),n.patterns[h.id]=s.getKey(v,w)}}update(n,s,u,h,p){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,s,m?this.stateDependentLayers:this.layers,u,h,p)}addFeatures(n,s,u,h,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,u,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,HY)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=n.createVertexBuffer(this.patternVertexArray,XY)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,iF.members,!0)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,qY),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,s,u,h,p,m,v){const w=this.layers[0].layout,E=w.get("line-join").evaluate(n,{}),A=w.get("line-cap").evaluate(n,{}),P=w.get("line-miter-limit"),M=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const z of s)this.addLine(z,n,h,E,A,P,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,p,m,h,v)}addLine(n,s,u,h,p,m,v){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const w={zoom:this.zoom,lineProgress:void 0},E=this.layers[0].layout,A=h==="none";if(this.patternJoinNone=this.hasPattern&&A,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ce=0;Ce<n.length-1;Ce++)this.totalDistance+=n[Ce].dist(n[Ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=rQ[s.type]==="Polygon";let M=n.length;for(;M>=2&&n[M-1].equals(n[M-2]);)M--;let z=0;for(;z<M-1&&n[z].equals(n[z+1]);)z++;if(M<(P?3:2))return;h==="bevel"&&(m=1.05);const B=this.overscaling<=16?15*Mt/(512*this.overscaling):0,U=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let $,Y,fe,he,me,Ae;this.e1=this.e2=-1,P&&($=n[M-2],me=n[z].sub($)._unit()._perp());for(let Ce=z;Ce<M;Ce++){if(fe=Ce===M-1?P?n[z+1]:void 0:n[Ce+1],fe&&n[Ce].equals(fe))continue;if(me&&(he=me),$&&(Y=$),$=n[Ce],this.hasZOffset){const rt=E.get("line-z-offset").value;if(rt.kind==="constant")Ae=rt.value;else{if(this.lineClips){const dt=this.totalDistance/(this.lineClips.end-this.lineClips.start);w.lineProgress=(dt*this.lineClips.start+this.distance+(Y?Y.dist($):0))/dt}else Ii(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),w.lineProgress=0;Ae=rt.evaluate(w,s)}Ae=Ae||0}me=fe?fe.sub($)._unit()._perp():he,he=he||me;const Le=Y&&fe;let Ve=Le?h:P||A?"butt":p;const He=he.x*me.x+he.y*me.y;if(A){const rt=function(dt){if(dt.patternJoinNone){const It=dt.segmentPoints.length/2,at=dt.lineSoFar-dt.segmentStart;for(let Ot=0;Ot<It;++Ot){const Et=dt.segmentPoints[2*Ot+1],vt=Math.round(dt.segmentPoints[2*Ot])+.5+.25*Et;dt.patternVertexArray.emplaceBack(vt,at,dt.segmentStart),dt.patternVertexArray.emplaceBack(vt,at,dt.segmentStart)}dt.segmentPoints.length=0}dt.e1=dt.e2=-1};if(Le&&He<sQ){this.updateDistance(Y,$),this.addCurrentVertex($,he,1,1,U,Ae),rt(this),this.addCurrentVertex($,me,-1,-1,U,Ae);continue}if(Y){if(!fe){this.updateDistance(Y,$),this.addCurrentVertex($,he,1,1,U,Ae),rt(this);continue}Ve="miter"}}let et=he.add(me);et.x===0&&et.y===0||et._unit();const Ze=et.x*me.x+et.y*me.y,st=Ze!==0?1/Ze:1/0,yt=2*Math.sqrt(2-2*Ze),ot=Ze<iQ&&Y&&fe,bt=he.x*me.y-he.y*me.x>0;if(ot&&Ce>z){const rt=$.dist(Y);if(rt>2*B){const dt=$.sub($.sub(Y)._mult(B/rt)._round());this.updateDistance(Y,dt),this.addCurrentVertex(dt,he,0,0,U,Ae),Y=dt}}if(Le&&Ve==="round"&&(st<v?Ve="miter":st<=2&&(Ve="fakeround")),Ve==="miter"&&st>m&&(Ve="bevel"),Ve==="bevel"&&(st>2&&(Ve="flipbevel"),st<m&&(Ve="miter")),Y&&this.updateDistance(Y,$),Ve==="miter")et._mult(st),this.addCurrentVertex($,et,0,0,U,Ae);else if(Ve==="flipbevel"){if(st>100)et=me.mult(-1);else{const rt=st*he.add(me).mag()/he.sub(me).mag();et._perp()._mult(rt*(bt?-1:1))}this.addCurrentVertex($,et,0,0,U,Ae),this.addCurrentVertex($,et.mult(-1),0,0,U,Ae)}else if(Ve==="bevel"||Ve==="fakeround"){const rt=-Math.sqrt(st*st-1),dt=bt?rt:0,It=bt?0:rt;if(Y&&this.addCurrentVertex($,he,dt,It,U,Ae),Ve==="fakeround"){const at=Math.round(180*yt/Math.PI/20);for(let Ot=1;Ot<at;Ot++){let Et=Ot/at;if(Et!==.5){const vn=Et-.5;Et+=Et*vn*(Et-1)*((1.0904+He*(He*(3.55645-1.43519*He)-3.2452))*vn*vn+(.848013+He*(.215638*He-1.06021)))}const vt=me.sub(he)._mult(Et)._add(he)._unit()._mult(bt?-1:1);this.addHalfVertex($,vt.x,vt.y,!1,bt,0,U,Ae)}}fe&&this.addCurrentVertex($,me,-dt,-It,U,Ae)}else Ve==="butt"?this.addCurrentVertex($,et,0,0,U,Ae):Ve==="square"?(Y||this.addCurrentVertex($,et,-1,-1,U,Ae),this.addCurrentVertex($,et,0,0,U,Ae),Y&&this.addCurrentVertex($,et,1,1,U,Ae)):Ve==="round"&&(Y&&(this.addCurrentVertex($,he,0,0,U,Ae),this.addCurrentVertex($,he,1,1,U,Ae,!0)),fe&&(this.addCurrentVertex($,me,-1,-1,U,Ae,!0),this.addCurrentVertex($,me,0,0,U,Ae)));if(ot&&Ce<M-1){const rt=$.dist(fe);if(rt>2*B){const dt=$.add(fe.sub($)._mult(B/rt)._round());this.updateDistance($,dt),this.addCurrentVertex(dt,me,0,0,U,Ae),$=dt}}}}addVerticesTo(n,s,u,h,p,m,v,w,E,A){const P=(s.w-n.w)/this.tessellationStep|0;if(P>1){this.lineSoFar=n.w;const M=(s.x-n.x)/P,z=(s.y-n.y)/P,B=(s.z-n.z)/P,U=(s.w-n.w)/P;for(let $=1;$<P;++$)n.x+=M,n.y+=z,n.z+=B,this.lineSoFar+=U,this.addHalfVertex(n,u,h,A,!1,v,E,n.z),this.addHalfVertex(n,p,m,A,!0,-w,E,n.z)}this.lineSoFar=s.w,this.addHalfVertex(s,u,h,A,!1,v,E,s.z),this.addHalfVertex(s,p,m,A,!0,-w,E,s.z)}addCurrentVertex(n,s,u,h,p,m,v=!1){const w=s.x+s.y*u,E=s.y-s.x*u,A=s.y*h-s.x,P=-s.y-s.x*h;if(m!=null){const z=Mt+10,B=m,U=new TN(n.x,n.y,B,this.lineSoFar),$=aF(n,-10,z),Y=this.lineSoFar;if(this.currentVertex)if($){const fe=this.currentVertexIsOutside,he=this.currentVertex,me=new TN(n.x,n.y,B,this.lineSoFar);SN(he,me,-10,z),aF(me,-10,z)||(fe&&(this.e1=this.e2=-1,this.lineSoFar=he.w,this.addHalfVertex(he,w,E,v,!1,u,p,he.z),this.addHalfVertex(he,A,P,v,!0,-h,p,he.z)),this.addVerticesTo(he,me,w,E,A,P,u,h,p,v))}else{const fe=this.currentVertex;this.currentVertexIsOutside&&(SN(fe,U,-10,z),this.e1=this.e2=-1,this.lineSoFar=fe.w,this.addHalfVertex(fe,w,E,v,!1,u,p,fe.z),this.addHalfVertex(fe,A,P,v,!0,-h,p,fe.z)),this.addVerticesTo(fe,U,w,E,A,P,u,h,p,v)}else $||(this.addHalfVertex(n,w,E,v,!1,u,p,m),this.addHalfVertex(n,A,P,v,!0,-h,p,m));this.currentVertex=U,this.currentVertexIsOutside=$,this.lineSoFar=Y}else this.addHalfVertex(n,w,E,v,!1,u,p,m),this.addHalfVertex(n,A,P,v,!0,-h,p,m)}addHalfVertex({x:n,y:s},u,h,p,m,v,w,E){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((n<<1)+(p?1:0),(s<<1)+(m?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const A=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),w.primitiveLength++),m?this.e2=A:this.e1=A,E!=null&&this.zOffsetVertexArray.emplaceBack(E)}updateScaledDistance(){if(this.lineClips){const n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,s){this.distance+=n.dist(s),this.updateScaledDistance()}}function aF(i,n,s){return i.x<n||i.x>s||i.y<n||i.y>s}let lF,cF;function uF(i,n,s){return n*(Mt/(i.tileSize*Math.pow(2,s-i.tileID.overscaledZ)))}function hF(i,n){return 1/uF(i,1,n.tileZoom)}function dF(i,n,s,u){return i.translatePosMatrix(u||n.tileID.projMatrix,n,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}Ue(Bw,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const fF=i=>{const n=[];pF(i)&&n.push("RENDER_LINE_DASH"),i.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");const s=i.paint.get("line-trim-offset");s[0]===0&&s[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),i.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER");const u=i.layout.get("line-join").constantOr("miter")==="none",h=!!i.paint.get("line-pattern").constantOr(1);return u&&h&&n.push("LINE_JOIN_NONE"),n};function pF(i){const n=i.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}class mF{constructor(n){this._stringToNumber={},this._numberToString=[];for(let s=0;s<n.length;s++){const u=n[s];this._stringToNumber[u]=s,this._numberToString[s]=u}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}var oQ={read:function(i,n,s,u,h){var p,m,v=8*h-u-1,w=(1<<v)-1,E=w>>1,A=-7,P=s?h-1:0,M=s?-1:1,z=i[n+P];for(P+=M,p=z&(1<<-A)-1,z>>=-A,A+=v;A>0;p=256*p+i[n+P],P+=M,A-=8);for(m=p&(1<<-A)-1,p>>=-A,A+=u;A>0;m=256*m+i[n+P],P+=M,A-=8);if(p===0)p=1-E;else{if(p===w)return m?NaN:1/0*(z?-1:1);m+=Math.pow(2,u),p-=E}return(z?-1:1)*m*Math.pow(2,p-u)},write:function(i,n,s,u,h,p){var m,v,w,E=8*p-h-1,A=(1<<E)-1,P=A>>1,M=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=u?0:p-1,B=u?1:-1,U=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(v=isNaN(n)?1:0,m=A):(m=Math.floor(Math.log(n)/Math.LN2),n*(w=Math.pow(2,-m))<1&&(m--,w*=2),(n+=m+P>=1?M/w:M*Math.pow(2,1-P))*w>=2&&(m++,w/=2),m+P>=A?(v=0,m=A):m+P>=1?(v=(n*w-1)*Math.pow(2,h),m+=P):(v=n*Math.pow(2,P-1)*Math.pow(2,h),m=0));h>=8;i[s+z]=255&v,z+=B,v/=256,h-=8);for(m=m<<h|v,E+=h;E>0;i[s+z]=255&m,z+=B,m/=256,E-=8);i[s+z-B]|=128*U}},gF=gi,jw=oQ;function gi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}gi.Varint=0,gi.Fixed64=1,gi.Bytes=2,gi.Fixed32=5;var kP=4294967296,_F=1/kP,yF=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function wh(i){return i.type===gi.Bytes?i.readVarint()+i.pos:i.pos+1}function t_(i,n,s){return s?4294967296*n+(i>>>0):4294967296*(n>>>0)+(i>>>0)}function vF(i,n,s){var u=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));s.realloc(u);for(var h=s.pos-1;h>=i;h--)s.buf[h+u]=s.buf[h]}function aQ(i,n){for(var s=0;s<i.length;s++)n.writeVarint(i[s])}function lQ(i,n){for(var s=0;s<i.length;s++)n.writeSVarint(i[s])}function cQ(i,n){for(var s=0;s<i.length;s++)n.writeFloat(i[s])}function uQ(i,n){for(var s=0;s<i.length;s++)n.writeDouble(i[s])}function hQ(i,n){for(var s=0;s<i.length;s++)n.writeBoolean(i[s])}function dQ(i,n){for(var s=0;s<i.length;s++)n.writeFixed32(i[s])}function fQ(i,n){for(var s=0;s<i.length;s++)n.writeSFixed32(i[s])}function pQ(i,n){for(var s=0;s<i.length;s++)n.writeFixed64(i[s])}function mQ(i,n){for(var s=0;s<i.length;s++)n.writeSFixed64(i[s])}function Uw(i,n){return(i[n]|i[n+1]<<8|i[n+2]<<16)+16777216*i[n+3]}function n_(i,n,s){i[s]=n,i[s+1]=n>>>8,i[s+2]=n>>>16,i[s+3]=n>>>24}function xF(i,n){return(i[n]|i[n+1]<<8|i[n+2]<<16)+(i[n+3]<<24)}gi.prototype={destroy:function(){this.buf=null},readFields:function(i,n,s){for(s=s||this.length;this.pos<s;){var u=this.readVarint(),h=u>>3,p=this.pos;this.type=7&u,i(h,n,this),this.pos===p&&this.skip(u)}return n},readMessage:function(i,n){return this.readFields(i,n,this.readVarint()+this.pos)},readFixed32:function(){var i=Uw(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=xF(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Uw(this.buf,this.pos)+Uw(this.buf,this.pos+4)*kP;return this.pos+=8,i},readSFixed64:function(){var i=Uw(this.buf,this.pos)+xF(this.buf,this.pos+4)*kP;return this.pos+=8,i},readFloat:function(){var i=jw.read(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=jw.read(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var n,s,u=this.buf;return n=127&(s=u[this.pos++]),s<128?n:(n|=(127&(s=u[this.pos++]))<<7,s<128?n:(n|=(127&(s=u[this.pos++]))<<14,s<128?n:(n|=(127&(s=u[this.pos++]))<<21,s<128?n:function(h,p,m){var v,w,E=m.buf;if(v=(112&(w=E[m.pos++]))>>4,w<128||(v|=(127&(w=E[m.pos++]))<<3,w<128)||(v|=(127&(w=E[m.pos++]))<<10,w<128)||(v|=(127&(w=E[m.pos++]))<<17,w<128)||(v|=(127&(w=E[m.pos++]))<<24,w<128)||(v|=(1&(w=E[m.pos++]))<<31,w<128))return t_(h,v,p);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(s=u[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,n=this.pos;return this.pos=i,i-n>=12&&yF?function(s,u,h){return yF.decode(s.subarray(u,h))}(this.buf,n,i):function(s,u,h){for(var p="",m=u;m<h;){var v,w,E,A=s[m],P=null,M=A>239?4:A>223?3:A>191?2:1;if(m+M>h)break;M===1?A<128&&(P=A):M===2?(192&(v=s[m+1]))==128&&(P=(31&A)<<6|63&v)<=127&&(P=null):M===3?(w=s[m+2],(192&(v=s[m+1]))==128&&(192&w)==128&&((P=(15&A)<<12|(63&v)<<6|63&w)<=2047||P>=55296&&P<=57343)&&(P=null)):M===4&&(w=s[m+2],E=s[m+3],(192&(v=s[m+1]))==128&&(192&w)==128&&(192&E)==128&&((P=(15&A)<<18|(63&v)<<12|(63&w)<<6|63&E)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,M=1):P>65535&&(P-=65536,p+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),p+=String.fromCharCode(P),m+=M}return p}(this.buf,n,i)},readBytes:function(){var i=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,i);return this.pos=i,n},readPackedVarint:function(i,n){if(this.type!==gi.Bytes)return i.push(this.readVarint(n));var s=wh(this);for(i=i||[];this.pos<s;)i.push(this.readVarint(n));return i},readPackedSVarint:function(i){if(this.type!==gi.Bytes)return i.push(this.readSVarint());var n=wh(this);for(i=i||[];this.pos<n;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==gi.Bytes)return i.push(this.readBoolean());var n=wh(this);for(i=i||[];this.pos<n;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==gi.Bytes)return i.push(this.readFloat());var n=wh(this);for(i=i||[];this.pos<n;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==gi.Bytes)return i.push(this.readDouble());var n=wh(this);for(i=i||[];this.pos<n;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==gi.Bytes)return i.push(this.readFixed32());var n=wh(this);for(i=i||[];this.pos<n;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==gi.Bytes)return i.push(this.readSFixed32());var n=wh(this);for(i=i||[];this.pos<n;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==gi.Bytes)return i.push(this.readFixed64());var n=wh(this);for(i=i||[];this.pos<n;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==gi.Bytes)return i.push(this.readSFixed64());var n=wh(this);for(i=i||[];this.pos<n;)i.push(this.readSFixed64());return i},skip:function(i){var n=7&i;if(n===gi.Varint)for(;this.buf[this.pos++]>127;);else if(n===gi.Bytes)this.pos=this.readVarint()+this.pos;else if(n===gi.Fixed32)this.pos+=4;else{if(n!==gi.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(i,n){this.writeVarint(i<<3|n)},realloc:function(i){for(var n=this.length||16;n<this.pos+i;)n*=2;if(n!==this.length){var s=new Uint8Array(n);s.set(this.buf),this.buf=s,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),n_(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),n_(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),n_(this.buf,-1&i,this.pos),n_(this.buf,Math.floor(i*_F),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),n_(this.buf,-1&i,this.pos),n_(this.buf,Math.floor(i*_F),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(n,s){var u,h;if(n>=0?(u=n%4294967296|0,h=n/4294967296|0):(h=~(-n/4294967296),4294967295^(u=~(-n%4294967296))?u=u+1|0:(u=0,h=h+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(p,m,v){v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7)}(u,0,s),function(p,m){var v=(7&p)<<4;m.buf[m.pos++]|=v|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))}(h,s)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var n=this.pos;this.pos=function(u,h,p){for(var m,v,w=0;w<h.length;w++){if((m=h.charCodeAt(w))>55295&&m<57344){if(!v){m>56319||w+1===h.length?(u[p++]=239,u[p++]=191,u[p++]=189):v=m;continue}if(m<56320){u[p++]=239,u[p++]=191,u[p++]=189,v=m;continue}m=v-55296<<10|m-56320|65536,v=null}else v&&(u[p++]=239,u[p++]=191,u[p++]=189,v=null);m<128?u[p++]=m:(m<2048?u[p++]=m>>6|192:(m<65536?u[p++]=m>>12|224:(u[p++]=m>>18|240,u[p++]=m>>12&63|128),u[p++]=m>>6&63|128),u[p++]=63&m|128)}return p}(this.buf,i,this.pos);var s=this.pos-n;s>=128&&vF(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeFloat:function(i){this.realloc(4),jw.write(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),jw.write(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var n=i.length;this.writeVarint(n),this.realloc(n);for(var s=0;s<n;s++)this.buf[this.pos++]=i[s]},writeRawMessage:function(i,n){this.pos++;var s=this.pos;i(n,this);var u=this.pos-s;u>=128&&vF(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u},writeMessage:function(i,n,s){this.writeTag(i,gi.Bytes),this.writeRawMessage(n,s)},writePackedVarint:function(i,n){n.length&&this.writeMessage(i,aQ,n)},writePackedSVarint:function(i,n){n.length&&this.writeMessage(i,lQ,n)},writePackedBoolean:function(i,n){n.length&&this.writeMessage(i,hQ,n)},writePackedFloat:function(i,n){n.length&&this.writeMessage(i,cQ,n)},writePackedDouble:function(i,n){n.length&&this.writeMessage(i,uQ,n)},writePackedFixed32:function(i,n){n.length&&this.writeMessage(i,dQ,n)},writePackedSFixed32:function(i,n){n.length&&this.writeMessage(i,fQ,n)},writePackedFixed64:function(i,n){n.length&&this.writeMessage(i,pQ,n)},writePackedSFixed64:function(i,n){n.length&&this.writeMessage(i,mQ,n)},writeBytesField:function(i,n){this.writeTag(i,gi.Bytes),this.writeBytes(n)},writeFixed32Field:function(i,n){this.writeTag(i,gi.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(i,n){this.writeTag(i,gi.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(i,n){this.writeTag(i,gi.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(i,n){this.writeTag(i,gi.Fixed64),this.writeSFixed64(n)},writeVarintField:function(i,n){this.writeTag(i,gi.Varint),this.writeVarint(n)},writeSVarintField:function(i,n){this.writeTag(i,gi.Varint),this.writeSVarint(n)},writeStringField:function(i,n){this.writeTag(i,gi.Bytes),this.writeString(n)},writeFloatField:function(i,n){this.writeTag(i,gi.Fixed32),this.writeFloat(n)},writeDoubleField:function(i,n){this.writeTag(i,gi.Fixed64),this.writeDouble(n)},writeBooleanField:function(i,n){this.writeVarintField(i,!!n)}};var nv=pe(gF);const gQ=["id","tile","layer","source","sourceLayer","state"];class bF{constructor(n,s,u,h,p){this.type="Feature",this._vectorTileFeature=n,this._z=s,this._x=u,this._y=h,this.properties=n.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const s of gQ)this[s]!==void 0&&(n[s]=this[s]);return n}}class _Q{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,s,u){const h=String(s);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][h]=this.stateChanges[n][h]||{},Rs(this.stateChanges[n][h],u),this.deletedStates[n]===null){this.deletedStates[n]={};for(const p in this.state[n])p!==h&&(this.deletedStates[n][p]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][h]===null){this.deletedStates[n][h]={};for(const p in this.state[n][h])u[p]||(this.deletedStates[n][h][p]=null)}else for(const p in u)this.deletedStates[n]&&this.deletedStates[n][h]&&this.deletedStates[n][h][p]===null&&delete this.deletedStates[n][h][p]}removeFeatureState(n,s,u){if(this.deletedStates[n]===null)return;const h=String(s);if(this.deletedStates[n]=this.deletedStates[n]||{},u&&s!==void 0)this.deletedStates[n][h]!==null&&(this.deletedStates[n][h]=this.deletedStates[n][h]||{},this.deletedStates[n][h][u]=null);else if(s!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][h])for(u in this.deletedStates[n][h]={},this.stateChanges[n][h])this.deletedStates[n][h][u]=null;else this.deletedStates[n][h]=null;else this.deletedStates[n]=null}getState(n,s){const u=String(s),h=Rs({},(this.state[n]||{})[u],(this.stateChanges[n]||{})[u]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const p=this.deletedStates[n][s];if(p===null)return{};for(const m in p)delete h[m]}return h}initializeTileState(n,s){n.setFeatureState(this.state,s)}coalesceChanges(n,s){const u={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const p={};for(const m in this.stateChanges[h])this.state[h][m]||(this.state[h][m]={}),Rs(this.state[h][m],this.stateChanges[h][m]),p[m]=this.state[h][m];u[h]=p}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const p={};if(this.deletedStates[h]===null)for(const m in this.state[h])p[m]={},this.state[h][m]={};else for(const m in this.deletedStates[h]){if(this.deletedStates[h][m]===null)this.state[h][m]={};else if(this.state[h][m])for(const v of Object.keys(this.deletedStates[h][m]))delete this.state[h][m][v];p[m]=this.state[h][m]}u[h]=u[h]||{},Rs(u[h],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const h in n)n[h].setFeatureState(u,s)}}class wF{constructor(n,s){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Qe(Mt,16,0),this.featureIndexArray=new _z,this.promoteId=s,this.is3DTile=!1}insert(n,s,u,h,p,m=0,v=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,p,m);const E=this.grid;for(let A=0;A<s.length;A++){const P=s[A],M=[1/0,1/0,-1/0,-1/0];for(let z=0;z<P.length;z++){const B=P[z];M[0]=Math.min(M[0],B.x),M[1]=Math.min(M[1],B.y),M[2]=Math.max(M[2],B.x),M[3]=Math.max(M[3],B.y)}v!==0&&(M[0]-=v,M[1]-=v,M[2]+=v,M[3]+=v),M[0]<Mt&&M[1]<Mt&&M[2]>=0&&M[3]>=0&&E.insert(w,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new CP(new nv(this.rawTileData)).layers,this.sourceLayerCoder=new mF(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,s,u,h){this.loadVTLayers();const p=n.params||{},m=vc(p.filter),v=n.tileResult,w=n.transform,E=v.bufferedTilespaceBounds,A=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(B,U,$,Y)=>zz(v.bufferedTilespaceGeometry,B,U,$,Y));A.sort(yQ);let P=null;w.elevation&&A.length>0&&(P=e_.create(w.elevation,this.tileID));const M={};let z;for(let B=0;B<A.length;B++){const U=A[B];if(U===z)continue;z=U;const $=this.featureIndexArray.get(U);let Y=null;if(this.is3DTile){const fe=this.bucketLayerIDs[0][0],he=s[fe];if(he.type!=="model")continue;const{queryFeature:me,intersectionZ:Ae}=he.queryIntersectsMatchingFeature(v,$.featureIndex,m,w);me&&this.appendToResult(M,fe,$.featureIndex,me,Ae)}else this.loadMatchingFeature(M,$,m,p.layers,p.availableImages,s,u,h,(fe,he,me,Ae=0)=>(Y||(Y=wc(fe,this.tileID.canonical,n.tileTransform)),he.queryIntersectsFeature(v,fe,me,Y,this.z,n.transform,n.pixelPosMatrix,P,Ae)))}return M}loadMatchingFeature(n,s,u,h,p,m,v,w,E){const{featureIndex:A,bucketIndex:P,sourceLayerIndex:M,layoutVertexArrayOffset:z}=s,B=this.bucketLayerIDs[P];if(h&&!function(fe,he){for(let me=0;me<fe.length;me++)if(he.indexOf(fe[me])>=0)return!0;return!1}(h,B))return;const U=this.sourceLayerCoder.decode(M),$=this.vtLayers[U].feature(A);if(u.needGeometry){const fe=vh($,!0);if(!u.filter(new kn(this.tileID.overscaledZ),fe,this.tileID.canonical))return}else if(!u.filter(new kn(this.tileID.overscaledZ),$))return;const Y=this.getId($,U);for(let fe=0;fe<B.length;fe++){const he=B[fe];if(h&&h.indexOf(he)<0)continue;const me=m[he];if(!me)continue;let Ae={};Y!==void 0&&w&&(Ae=w.getState(me.sourceLayer||"_geojsonTileLayer",Y));const Ce=!E||E($,me,Ae,z);if(!Ce)continue;const Le=new bF($,this.z,this.x,this.y,Y),Ve=Rs({},v[he]);Ve.paint=TF(Ve.paint,me.paint,$,Ae,p),Ve.layout=TF(Ve.layout,me.layout,$,Ae,p),Le.layer=Ve,this.appendToResult(n,he,A,Le,Ce)}}appendToResult(n,s,u,h,p){let m=n[s];m===void 0&&(m=n[s]=[]),m.push({featureIndex:u,feature:h,intersectionZ:p})}lookupSymbolFeatures(n,s,u,h,p,m,v,w){const E={};this.loadVTLayers();const A=vc(p);for(const P of n)this.loadMatchingFeature(E,{bucketIndex:u,sourceLayerIndex:h,featureIndex:P,layoutVertexArrayOffset:0},A,m,v,w,s);return E}loadFeature(n){const{featureIndex:s,sourceLayerIndex:u}=n;this.loadVTLayers();const h=this.sourceLayerCoder.decode(u),p=this.vtFeatures[h];if(p[s])return p[s];const m=this.vtLayers[h].feature(s);return p[s]=m,m}hasLayer(n){for(const s of this.bucketLayerIDs)for(const u of s)if(n===u)return!0;return!1}getId(n,s){let u=n.id;if(this.promoteId){const h=typeof this.promoteId=="string"?this.promoteId:this.promoteId[s];h!=null&&(u=n.properties[h]),typeof u=="boolean"&&(u=Number(u))}return u}}function TF(i,n,s,u,h){return eu(i,(p,m)=>{const v=n instanceof Zs?n.get(m):null;return v&&v.evaluate?v.evaluate(s,u,h):v})}function yQ(i,n){return n-i}Ue(wF,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var uo=24;const Tc=128;function DP(i,n){const{expression:s}=n;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new kn(i+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:h}=s;let p=0;for(;p<u.length&&u[p]<=i;)p++;p=Math.max(0,p-1);let m=p;for(;m<u.length&&u[m]<i+1;)m++;m=Math.min(u.length-1,m);const v=u[p],w=u[m];return s.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:w,minSize:s.evaluate(new kn(v)),maxSize:s.evaluate(new kn(w)),interpolationType:h}}}function Vw(i,{uSize:n,uSizeT:s},{lowerSize:u,upperSize:h}){return i.kind==="source"?u/Tc:i.kind==="composite"?En(u/Tc,h/Tc,s):n}function r_(i,n){let s=0,u=0;if(i.kind==="constant")u=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:h,minZoom:p,maxZoom:m}=i,v=h?Kn(ga.interpolationFactor(h,n,p,m),0,1):0;i.kind==="camera"?u=En(i.minSize,i.maxSize,v):s=v}return{uSizeT:s,uSize:u}}var vQ=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Tc,evaluateSizeForFeature:Vw,evaluateSizeForZoom:r_,getSizeData:DP});function xQ(i,n,s){return i.sections.forEach(u=>{u.text=function(h,p,m){const v=p.layout.get("text-transform").evaluate(m,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),or.applyArabicShaping&&(h=or.applyArabicShaping(h)),h}(u.text,n,s)}),i}const rv={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function bQ(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}function wQ(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}const OP=3;function TQ(i,n,s){n.glyphs=[],i===1&&s.readMessage(EQ,n)}function EQ(i,n,s){if(i===3){const{id:u,bitmap:h,width:p,height:m,left:v,top:w,advance:E}=s.readMessage(SQ,{});n.glyphs.push({id:u,bitmap:new Fd({width:p+2*OP,height:m+2*OP},h),metrics:{width:p,height:m,left:v,top:w,advance:E}})}else i===4?n.ascender=s.readSVarint():i===5&&(n.descender=s.readSVarint())}function SQ(i,n,s){i===1?n.id=s.readVarint():i===2?n.bitmap=s.readBytes():i===3?n.width=s.readVarint():i===4?n.height=s.readVarint():i===5?n.left=s.readSVarint():i===6?n.top=s.readSVarint():i===7&&(n.advance=s.readVarint())}const EF=OP,nl={horizontal:1,vertical:2,horizontalOnly:3};class iv{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,s){const u=new iv;return u.scale=n||1,u.fontStack=s,u}static forImage(n){const s=new iv;return s.imageName=n,s}}class i_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,s){const u=new i_;for(let h=0;h<n.sections.length;h++){const p=n.sections[h];p.image?u.addImageSection(p):u.addTextSection(p,s)}return u}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=function(s,u){let h="";for(let p=0;p<s.length;p++){const m=s.charCodeAt(p+1)||null,v=s.charCodeAt(p-1)||null;h+=!u&&(m&&on(m)&&!rv[s[p+1]]||v&&on(v)&&!rv[s[p-1]])||!rv[s[p]]?s[p]:rv[s[p]]}return h}(this.text,n)}trim(){let n=0;for(let u=0;u<this.text.length&&$w[this.text.charCodeAt(u)];u++)n++;let s=this.text.length;for(let u=this.text.length-1;u>=0&&u>=n&&$w[this.text.charCodeAt(u)];u--)s--;this.text=this.text.substring(n,s),this.sectionIndex=this.sectionIndex.slice(n,s)}substring(n,s){const u=new i_;return u.text=this.text.substring(n,s),u.sectionIndex=this.sectionIndex.slice(n,s),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,s)=>Math.max(n,this.sections[s].scale),0)}addTextSection(n,s){this.text+=n.text,this.sections.push(iv.forText(n.scale,n.fontStack||s));const u=this.sections.length-1;for(let h=0;h<n.text.length;++h)this.sectionIndex.push(u)}addImageSection(n){const s=n.image?n.image.namePrimary:"";if(s.length===0)return void Ii("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(iv.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Ii("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function LP(i,n,s,u,h,p,m,v,w,E,A,P,M,z,B){const U=i_.fromFeature(i,h);P===nl.vertical&&U.verticalizePunctuation(M);let $=[];const Y=function(Ce,Le,Ve,He,et,Ze){if(!Ce)return[];const st=[],yt=function(dt,It,at,Ot,Et,vt){let vn=0;for(let dn=0;dn<dt.length();dn++){const Yt=dt.getSection(dn);vn+=SF(dt.getCodePoint(dn),Yt,Ot,Et,It,vt)}return vn/Math.max(1,Math.ceil(vn/at))}(Ce,Le,Ve,He,et,Ze),ot=Ce.text.indexOf("")>=0;let bt=0;for(let dt=0;dt<Ce.length();dt++){const It=Ce.getSection(dt),at=Ce.getCodePoint(dt);if($w[at]||(bt+=SF(at,It,He,et,Le,Ze)),dt<Ce.length()-1){const Ot=!((rt=at)<11904||!(je["Bopomofo Extended"](rt)||je.Bopomofo(rt)||je["CJK Compatibility Forms"](rt)||je["CJK Compatibility Ideographs"](rt)||je["CJK Compatibility"](rt)||je["CJK Radicals Supplement"](rt)||je["CJK Strokes"](rt)||je["CJK Symbols and Punctuation"](rt)||je["CJK Unified Ideographs Extension A"](rt)||je["CJK Unified Ideographs"](rt)||je["Enclosed CJK Letters and Months"](rt)||je["Halfwidth and Fullwidth Forms"](rt)||je.Hiragana(rt)||je["Ideographic Description Characters"](rt)||je["Kangxi Radicals"](rt)||je["Katakana Phonetic Extensions"](rt)||je.Katakana(rt)||je["Vertical Forms"](rt)||je["Yi Radicals"](rt)||je["Yi Syllables"](rt)));(IQ[at]||Ot||It.imageName)&&st.push(AF(dt+1,bt,yt,st,AQ(at,Ce.getCodePoint(dt+1),Ot&&ot),!1))}}var rt;return CF(AF(Ce.length(),bt,yt,st,0,!0))}(U,E,p,n,u,z),{processBidirectionalText:fe,processStyledBidirectionalText:he}=or;if(fe&&U.sections.length===1){const Ce=fe(U.toString(),Y);for(const Le of Ce){const Ve=new i_;Ve.text=Le,Ve.sections=U.sections;for(let He=0;He<Le.length;He++)Ve.sectionIndex.push(0);$.push(Ve)}}else if(he){const Ce=he(U.text,U.sectionIndex,Y);for(const Le of Ce){const Ve=new i_;Ve.text=Le[0],Ve.sectionIndex=Le[1],Ve.sections=U.sections,$.push(Ve)}}else $=function(Ce,Le){const Ve=[],He=Ce.text;let et=0;for(const Ze of Le)Ve.push(Ce.substring(et,Ze)),et=Ze;return et<He.length&&Ve.push(Ce.substring(et,He.length)),Ve}(U,Y);const me=[],Ae={positionedLines:me,text:U.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ce,Le,Ve,He,et,Ze,st,yt,ot,bt,rt,dt){let It=0,at=0,Ot=0;const Et=yt==="right"?1:yt==="left"?0:.5;let vt=!1;for(const pn of et){const an=pn.getSections();for(const Fn of an){if(Fn.imageName)continue;const jn=Le[Fn.fontStack];if(jn&&(vt=jn.ascender!==void 0&&jn.descender!==void 0,!vt))break}if(!vt)break}let vn=0;for(const pn of et){pn.trim();const an=pn.getMaxScale(),Fn=(an-1)*uo,jn={positionedGlyphs:[],lineOffset:0};Ce.positionedLines[vn]=jn;const Bn=jn.positionedGlyphs;let Xn=0;if(!pn.length()){at+=Ze,++vn;continue}let _r=0,cr=0;for(let Xr=0;Xr<pn.length();Xr++){const Un=pn.getSection(Xr),zr=pn.getSectionIndex(Xr),Br=pn.getCodePoint(Xr);let oi=Un.scale,Fi=null,Qi=null,Bi=null,Ai=uo,Us=0;const ps=!(ot===nl.horizontal||!rt&&!Bt(Br)||rt&&($w[Br]||(dn=Br,je.Arabic(dn)||je["Arabic Supplement"](dn)||je["Arabic Extended-A"](dn)||je["Arabic Presentation Forms-A"](dn)||je["Arabic Presentation Forms-B"](dn))));if(Un.imageName){const ho=He[Un.imageName];if(!ho)continue;Bi=Un.imageName,Ce.iconsInText=Ce.iconsInText||!0,Qi=ho.paddedRect;const ni=ho.displaySize;oi=oi*uo/dt,Fi={width:ni[0],height:ni[1],left:0,top:-EF,advance:ps?ni[1]:ni[0],localGlyph:!1},Us=vt?-Fi.height*oi:an*uo-17-ni[1]*oi,Ai=Fi.advance;const va=(ps?ni[0]:ni[1])*oi-uo*an;va>0&&va>Xn&&(Xn=va)}else{const ho=Ve[Un.fontStack];if(!ho)continue;ho[Br]&&(Qi=ho[Br]);const ni=Le[Un.fontStack];if(!ni)continue;const va=ni.glyphs[Br];if(!va)continue;if(Fi=va.metrics,Ai=Br!==8203?uo:0,vt){const Pc=ni.ascender!==void 0?Math.abs(ni.ascender):0,Ll=ni.descender!==void 0?Math.abs(ni.descender):0,zl=(Pc+Ll)*oi;_r<zl&&(_r=zl,cr=(Pc-Ll)/2*oi),Us=-Pc*oi}else Us=(an-oi)*uo-17}ps?(Ce.verticalizable=!0,Bn.push({glyph:Br,imageName:Bi,x:It,y:at+Us,vertical:ps,scale:oi,localGlyph:Fi.localGlyph,fontStack:Un.fontStack,sectionIndex:zr,metrics:Fi,rect:Qi}),It+=Ai*oi+bt):(Bn.push({glyph:Br,imageName:Bi,x:It,y:at+Us,vertical:ps,scale:oi,localGlyph:Fi.localGlyph,fontStack:Un.fontStack,sectionIndex:zr,metrics:Fi,rect:Qi}),It+=Fi.advance*oi+bt)}Bn.length!==0&&(Ot=Math.max(It-bt,Ot),vt?PF(Bn,Et,Xn,cr,Ze*an/2):PF(Bn,Et,Xn,0,Ze/2)),It=0;const Wr=Ze*an+Xn;jn.lineOffset=Math.max(Xn,Fn),at+=Wr,++vn}var dn;const Yt=at,{horizontalAlign:kt,verticalAlign:Mn}=zP(st);(function(pn,an,Fn,jn,Bn,Xn){const _r=(an-Fn)*Bn,cr=-Xn*jn;for(const Wr of pn)for(const Xr of Wr.positionedGlyphs)Xr.x+=_r,Xr.y+=cr})(Ce.positionedLines,Et,kt,Mn,Ot,Yt),Ce.top+=-Mn*Yt,Ce.bottom=Ce.top+Yt,Ce.left+=-kt*Ot,Ce.right=Ce.left+Ot,Ce.hasBaseline=vt}(Ae,n,s,u,$,m,v,w,P,E,M,B),!function(Ce){for(const Le of Ce)if(Le.positionedGlyphs.length!==0)return!1;return!0}(me)&&Ae}const $w={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},IQ={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function SF(i,n,s,u,h,p){if(n.imageName){const m=u[n.imageName];return m?m.displaySize[0]*n.scale*uo/p+h:0}{const m=s[n.fontStack],v=m&&m.glyphs[i];return v?v.metrics.advance*n.scale+h:0}}function IF(i,n,s,u){const h=Math.pow(i-n,2);return u?i<n?h/2:2*h:h+Math.abs(s)*s}function AQ(i,n,s){let u=0;return i===10&&(u-=1e4),s&&(u+=150),i!==40&&i!==65288||(u+=50),n!==41&&n!==65289||(u+=50),u}function AF(i,n,s,u,h,p){let m=null,v=IF(n,s,h,p);for(const w of u){const E=IF(n-w.x,s,h,p)+w.badness;E<=v&&(m=w,v=E)}return{index:i,x:n,priorBreak:m,badness:v}}function CF(i){return i?CF(i.priorBreak).concat(i.index):[]}function zP(i){let n=.5,s=.5;switch(i){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:n,verticalAlign:s}}function PF(i,n,s,u,h){if(!(n||s||u||h))return;const p=i.length-1,m=i[p],v=(m.x+m.metrics.advance*m.scale)*n;for(let w=0;w<=p;w++)i[w].x-=v,i[w].y+=s+u+h}function CQ(i,n,s,u){const{horizontalAlign:h,verticalAlign:p}=zP(u),m=s[0]-i.displaySize[0]*h,v=s[1]-i.displaySize[1]*p;return{imagePrimary:i,imageSecondary:n,top:v,bottom:v+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function RF(i,n,s,u,h,p){const m=i.imagePrimary;let v;if(m.content){const $=m.content,Y=m.pixelRatio||1;v=[$[0]/Y,$[1]/Y,m.displaySize[0]-$[2]/Y,m.displaySize[1]-$[3]/Y]}const w=n.left*p,E=n.right*p;let A,P,M,z;s==="width"||s==="both"?(z=h[0]+w-u[3],P=h[0]+E+u[1]):(z=h[0]+(w+E-m.displaySize[0])/2,P=z+m.displaySize[0]);const B=n.top*p,U=n.bottom*p;return s==="height"||s==="both"?(A=h[1]+B-u[0],M=h[1]+U+u[2]):(A=h[1]+(B+U-m.displaySize[1])/2,M=A+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:A,right:P,bottom:M,left:z,collisionPadding:v}}class Th extends Dt{constructor(n,s,u,h,p){super(n,s),this.angle=h,this.z=u,p!==void 0&&(this.segment=p)}clone(){return new Th(this.x,this.y,this.z,this.angle,this.segment)}}function MF(i,n,s,u,h){if(n.segment===void 0)return!0;let p=n,m=n.segment+1,v=0;for(;v>-s/2;){if(m--,m<0)return!1;v-=i[m].dist(p),p=i[m]}v+=i[m].dist(i[m+1]),m++;const w=[];let E=0;for(;v<s/2;){const A=i[m],P=i[m+1];if(!P)return!1;let M=i[m-1].angleTo(A)-A.angleTo(P);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:M}),E+=M;v-w[0].distance>u;)E-=w.shift().angleDelta;if(E>h)return!1;m++,v+=A.dist(P)}return!0}function kF(i){let n=0;for(let s=0;s<i.length-1;s++)n+=i[s].dist(i[s+1]);return n}function DF(i,n,s){return i?.6*n*s:0}function OF(i,n){return Math.max(i?i.right-i.left:0,n?n.right-n.left:0)}function PQ(i,n,s,u,h,p){const m=DF(s,h,p),v=OF(s,u)*p;let w=0;const E=kF(i)/2;for(let A=0;A<i.length-1;A++){const P=i[A],M=i[A+1],z=P.dist(M);if(w+z>E){const B=(E-w)/z,U=En(P.x,M.x,B),$=En(P.y,M.y,B),Y=new Th(U,$,0,M.angleTo(P),A);return!m||MF(i,Y,v,m,n)?Y:void 0}w+=z}}function RQ(i,n,s,u,h,p,m,v,w){const E=DF(u,p,m),A=OF(u,h),P=A*m,M=i[0].x===0||i[0].x===w||i[0].y===0||i[0].y===w;return n-P<n/4&&(n=P+n/4),LF(i,M?n/2*v%n:(A/2+2*p)*m*v%n,n,E,s,P,M,!1,w)}function LF(i,n,s,u,h,p,m,v,w){const E=p/2,A=kF(i);let P=0,M=n-s,z=[];for(let B=0;B<i.length-1;B++){const U=i[B],$=i[B+1],Y=U.dist($),fe=$.angleTo(U);for(;M+s<P+Y;){M+=s;const he=(M-P)/Y,me=En(U.x,$.x,he),Ae=En(U.y,$.y,he);if(me>=0&&me<w&&Ae>=0&&Ae<w&&M-E>=0&&M+E<=A){const Ce=new Th(me,Ae,0,fe,B);u&&!MF(i,Ce,p,u,h)||z.push(Ce)}}P+=Y}return v||z.length||m||(z=LF(i,P/2,s,u,h,p,m,!0,w)),z}function zF(i,n,s,u,h){const p=[];for(let m=0;m<i.length;m++){const v=i[m];let w;for(let E=0;E<v.length-1;E++){let A=v[E],P=v[E+1];A.x<n&&P.x<n||(A.x<n?A=new Dt(n,A.y+(n-A.x)/(P.x-A.x)*(P.y-A.y))._round():P.x<n&&(P=new Dt(n,A.y+(n-A.x)/(P.x-A.x)*(P.y-A.y))._round()),A.y<s&&P.y<s||(A.y<s?A=new Dt(A.x+(s-A.y)/(P.y-A.y)*(P.x-A.x),s)._round():P.y<s&&(P=new Dt(A.x+(s-A.y)/(P.y-A.y)*(P.x-A.x),s)._round()),A.x>=u&&P.x>=u||(A.x>=u?A=new Dt(u,A.y+(u-A.x)/(P.x-A.x)*(P.y-A.y))._round():P.x>=u&&(P=new Dt(u,A.y+(u-A.x)/(P.x-A.x)*(P.y-A.y))._round()),A.y>=h&&P.y>=h||(A.y>=h?A=new Dt(A.x+(h-A.y)/(P.y-A.y)*(P.x-A.x),h)._round():P.y>=h&&(P=new Dt(A.x+(h-A.y)/(P.y-A.y)*(P.x-A.x),h)._round()),w&&A.equals(w[w.length-1])||(w=[A],p.push(w)),w.push(P)))))}}return p}function NF(i){let n=0,s=0;for(const m of i)n+=m.w*m.h,s=Math.max(s,m.w);i.sort((m,v)=>v.h-m.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),s),h:1/0}];let h=0,p=0;for(const m of i)for(let v=u.length-1;v>=0;v--){const w=u[v];if(!(m.w>w.w||m.h>w.h)){if(m.x=w.x,m.y=w.y,p=Math.max(p,m.y+m.h),h=Math.max(h,m.x+m.w),m.w===w.w&&m.h===w.h){const E=u.pop();v<u.length&&(u[v]=E)}else m.h===w.h?(w.x+=m.w,w.w-=m.w):m.w===w.w?(w.y+=m.h,w.h-=m.h):(u.push({x:w.x+m.w,y:w.y,w:w.w-m.w,h:m.h}),w.y+=m.h,w.h-=m.h);break}}return{w:h,h:p,fill:n/(h*p)||0}}Ue(Th,"Anchor");const Ra=1;class NP{constructor(n,{pixelRatio:s,version:u,stretchX:h,stretchY:p,content:m}){this.paddedRect=n,this.pixelRatio=s,this.stretchX=h,this.stretchY=p,this.content=m,this.version=u}get tl(){return[this.paddedRect.x+Ra,this.paddedRect.y+Ra]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ra,this.paddedRect.y+this.paddedRect.h-Ra]}get displaySize(){return[(this.paddedRect.w-2*Ra)/this.pixelRatio,(this.paddedRect.h-2*Ra)/this.pixelRatio]}}class FF{constructor(n,s,u){const h={},p={};this.haveRenderCallbacks=[];const m=[];this.addImages(n,h,m),this.addImages(s,p,m);const{w:v,h:w}=NF(m),E=new tl({width:v||1,height:w||1});for(const A in n){const P=n[A],M=h[A].paddedRect;tl.copy(P.data,E,{x:0,y:0},{x:M.x+Ra,y:M.y+Ra},P.data,u,P.sdf)}for(const A in s){const P=s[A],M=p[A].paddedRect,z=M.x+Ra,B=M.y+Ra,U=P.data.width,$=P.data.height;tl.copy(P.data,E,{x:0,y:0},{x:z,y:B},P.data,u),tl.copy(P.data,E,{x:0,y:$-1},{x:z,y:B-1},{width:U,height:1},u),tl.copy(P.data,E,{x:0,y:0},{x:z,y:B+$},{width:U,height:1},u),tl.copy(P.data,E,{x:U-1,y:0},{x:z-1,y:B},{width:1,height:$},u),tl.copy(P.data,E,{x:0,y:0},{x:z+U,y:B},{width:1,height:$},u)}this.image=E,this.iconPositions=h,this.patternPositions=p}addImages(n,s,u){for(const h in n){const p=n[h],m={x:0,y:0,w:p.data.width+2*Ra,h:p.data.height+2*Ra};u.push(m),s[h]=new NP(m,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(n,s,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>n.hasImage(h,u)),n.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const h in n.getUpdatedImages(u))this.patchUpdatedImage(this.iconPositions[h],n.getImage(h,u),s),this.patchUpdatedImage(this.patternPositions[h],n.getImage(h,u),s)}patchUpdatedImage(n,s,u){if(!n||!s||n.version===s.version)return;n.version=s.version;const[h,p]=n.tl,m=!!Object.keys(this.patternPositions).length;u.update(s.data,{useMipmap:m},{x:h,y:p})}}Ue(NP,"ImagePosition"),Ue(FF,"ImageAtlas");const sv=1e20;function BF(i,n,s,u,h,p,m,v,w){for(let E=n;E<n+u;E++)jF(i,s*p+E,p,h,m,v,w);for(let E=s;E<s+h;E++)jF(i,E*p+n,1,u,m,v,w)}function jF(i,n,s,u,h,p,m){p[0]=0,m[0]=-sv,m[1]=sv,h[0]=i[n];for(let v=1,w=0,E=0;v<u;v++){h[v]=i[n+v*s];const A=v*v;do{const P=p[w];E=(h[v]-h[P]+A-P*P)/(v-P)/2}while(E<=m[w]&&--w>-1);w++,p[w]=v,m[w]=E,m[w+1]=sv}for(let v=0,w=0;v<u;v++){for(;m[w+1]<v;)w++;const E=p[w],A=v-E;i[n+v*s]=h[E]+A*A}}const Ec=2,FP={none:0,ideographs:1,all:2};class s_{constructor(n,s,u){this.requestManager=n,this.localGlyphMode=s,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n,s){this.urls[s]=n}getGlyphs(n,s,u){const h=[],p=this.urls[s]||O.GLYPHS_URL;for(const m in n)for(const v of n[m])h.push({stack:m,id:v});th(h,({stack:m,id:v},w)=>{let E=this.entries[m];E||(E=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=E.glyphs[v];if(A!==void 0)return void w(null,{stack:m,id:v,glyph:A});if(A=this._tinySDF(E,m,v),A)return E.glyphs[v]=A,void w(null,{stack:m,id:v,glyph:A});const P=Math.floor(v/256);if(256*P>65535)return void w(new Error("glyphs > 65535 not supported"));if(E.ranges[P])return void w(null,{stack:m,id:v,glyph:A});let M=E.requests[P];M||(M=E.requests[P]=[],s_.loadGlyphRange(m,P,p,this.requestManager,(z,B)=>{if(B){E.ascender=B.ascender,E.descender=B.descender;for(const U in B.glyphs)this._doesCharSupportLocalGlyph(+U)||(E.glyphs[+U]=B.glyphs[+U]);E.ranges[P]=!0}for(const U of M)U(z,B);delete E.requests[P]})),M.push((z,B)=>{z?w(z):B&&w(null,{stack:m,id:v,glyph:B.glyphs[v]||null})})},(m,v)=>{if(m)u(m);else if(v){const w={};for(const{stack:E,id:A,glyph:P}of v)w[E]===void 0&&(w[E]={}),w[E].glyphs===void 0&&(w[E].glyphs={}),w[E].glyphs[A]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},w[E].ascender=this.entries[E].ascender,w[E].descender=this.entries[E].descender;u(null,w)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==FP.none&&(this.localGlyphMode===FP.all?!!this.localFontFamily:!!this.localFontFamily&&(je["CJK Unified Ideographs"](n)||je["Hangul Syllables"](n)||je.Hiragana(n)||je.Katakana(n)||je["CJK Symbols and Punctuation"](n)||je["CJK Unified Ideographs Extension A"](n)||je["CJK Unified Ideographs Extension B"](n)))}_tinySDF(n,s,u){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let p=n.tinySDF;if(!p){let U="400";/bold/i.test(s)?U="900":/medium/i.test(s)?U="500":/light/i.test(s)&&(U="200"),p=n.tinySDF=new s_.TinySDF({fontFamily:h,fontWeight:U,fontSize:24*Ec,buffer:3*Ec,radius:8*Ec}),p.fontWeight=U}if(this.localGlyphs[p.fontWeight][u])return this.localGlyphs[p.fontWeight][u];const m=String.fromCodePoint(u),{data:v,width:w,height:E,glyphWidth:A,glyphHeight:P,glyphLeft:M,glyphTop:z,glyphAdvance:B}=p.draw(m);return this.localGlyphs[p.fontWeight][u]={id:u,bitmap:new Fd({width:w,height:E},v),metrics:{width:A/Ec,height:P/Ec,left:M/Ec,top:z/Ec-27,advance:B/Ec,localGlyph:!0}}}}s_.loadGlyphRange=function(i,n,s,u,h){const p=256*n,m=p+255,v=u.transformRequest(u.normalizeGlyphsURL(s).replace("{fontstack}",i).replace("{range}",`${p}-${m}`),op.Glyphs);rh(v,(w,E)=>{if(w)h(w);else if(E){const A={},P=function(M){return new nv(M).readFields(TQ,{})}(E);for(const M of P.glyphs)A[M.id]=M;h(null,{glyphs:A,ascender:P.ascender,descender:P.descender})}})},s_.TinySDF=class{constructor({fontSize:i=24,buffer:n=3,radius:s=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:m="normal"}={}){this.buffer=n,this.cutoff=u,this.radius=s;const v=this.size=i+4*n,w=this._createCanvas(v),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${m} ${p} ${i}px ${h}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(i){const n=document.createElement("canvas");return n.width=n.height=i,n}draw(i){const{width:n,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(i),m=Math.ceil(s),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),w=Math.min(this.size-this.buffer,m+Math.ceil(u)),E=v+2*this.buffer,A=w+2*this.buffer,P=Math.max(E*A,0),M=new Uint8ClampedArray(P),z={data:M,width:E,height:A,glyphWidth:v,glyphHeight:w,glyphTop:m,glyphLeft:0,glyphAdvance:n};if(v===0||w===0)return z;const{ctx:B,buffer:U,gridInner:$,gridOuter:Y}=this;B.clearRect(U,U,v,w),B.fillText(i,U,U+m);const fe=B.getImageData(U,U,v,w);Y.fill(sv,0,P),$.fill(0,0,P);for(let he=0;he<w;he++)for(let me=0;me<v;me++){const Ae=fe.data[4*(he*v+me)+3]/255;if(Ae===0)continue;const Ce=(he+U)*E+me+U;if(Ae===1)Y[Ce]=0,$[Ce]=sv;else{const Le=.5-Ae;Y[Ce]=Le>0?Le*Le:0,$[Ce]=Le<0?Le*Le:0}}BF(Y,0,0,E,A,E,this.f,this.v,this.z),BF($,U,U,v,w,E,this.f,this.v,this.z);for(let he=0;he<P;he++){const me=Math.sqrt(Y[he])-Math.sqrt($[he]);M[he]=Math.round(255-255*(me/this.radius+this.cutoff))}return z}};const Ud=Ra;function UF(i,n,s,u){const h=[],p=i.imagePrimary,m=p.pixelRatio,v=p.paddedRect.w-2*Ud,w=p.paddedRect.h-2*Ud,E=i.right-i.left,A=i.bottom-i.top,P=p.stretchX||[[0,v]],M=p.stretchY||[[0,w]],z=(Ze,st)=>Ze+st[1]-st[0],B=P.reduce(z,0),U=M.reduce(z,0),$=v-B,Y=w-U;let fe=0,he=B,me=0,Ae=U,Ce=0,Le=$,Ve=0,He=Y;if(p.content&&u){const Ze=p.content;fe=Gw(P,0,Ze[0]),me=Gw(M,0,Ze[1]),he=Gw(P,Ze[0],Ze[2]),Ae=Gw(M,Ze[1],Ze[3]),Ce=Ze[0]-fe,Ve=Ze[1]-me,Le=Ze[2]-Ze[0]-he,He=Ze[3]-Ze[1]-Ae}const et=(Ze,st,yt,ot)=>{const bt=qw(Ze.stretch-fe,he,E,i.left),rt=Ww(Ze.fixed-Ce,Le,Ze.stretch,B),dt=qw(st.stretch-me,Ae,A,i.top),It=Ww(st.fixed-Ve,He,st.stretch,U),at=qw(yt.stretch-fe,he,E,i.left),Ot=Ww(yt.fixed-Ce,Le,yt.stretch,B),Et=qw(ot.stretch-me,Ae,A,i.top),vt=Ww(ot.fixed-Ve,He,ot.stretch,U),vn=new Dt(bt,dt),dn=new Dt(at,dt),Yt=new Dt(at,Et),kt=new Dt(bt,Et),Mn=new Dt(rt/m,It/m),pn=new Dt(Ot/m,vt/m),an=n*Math.PI/180;if(an){const cr=Math.sin(an),Wr=Math.cos(an),Xr=[Wr,-cr,cr,Wr];vn._matMult(Xr),dn._matMult(Xr),kt._matMult(Xr),Yt._matMult(Xr)}const Fn=Ze.stretch+Ze.fixed,jn=yt.stretch+yt.fixed,Bn=st.stretch+st.fixed,Xn=ot.stretch+ot.fixed,_r=i.imageSecondary;return{tl:vn,tr:dn,bl:kt,br:Yt,texPrimary:{x:p.paddedRect.x+Ud+Fn,y:p.paddedRect.y+Ud+Bn,w:jn-Fn,h:Xn-Bn},texSecondary:_r?{x:_r.paddedRect.x+Ud+Fn,y:_r.paddedRect.y+Ud+Bn,w:jn-Fn,h:Xn-Bn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mn,pixelOffsetBR:pn,minFontScaleX:Le/m/E,minFontScaleY:He/m/A,isSDF:s}};if(u&&(p.stretchX||p.stretchY)){const Ze=VF(P,$,B),st=VF(M,Y,U);for(let yt=0;yt<Ze.length-1;yt++){const ot=Ze[yt],bt=Ze[yt+1];for(let rt=0;rt<st.length-1;rt++)h.push(et(ot,st[rt],bt,st[rt+1]))}}else h.push(et({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return h}function Gw(i,n,s){let u=0;for(const h of i)u+=Math.max(n,Math.min(s,h[1]))-Math.max(n,Math.min(s,h[0]));return u}function VF(i,n,s){const u=[{fixed:-Ud,stretch:0}];for(const[h,p]of i){const m=u[u.length-1];u.push({fixed:h-m.stretch,stretch:m.stretch}),u.push({fixed:h-m.stretch,stretch:m.stretch+(p-h)})}return u.push({fixed:n+Ud,stretch:s}),u}function qw(i,n,s,u){return i/n*s+u}function Ww(i,n,s,u){return i-n*s/u}function MQ(i,n,s,u){const h=n+i.positionedLines[u].lineOffset;return u===0?s+h/2:s+(h+(n+i.positionedLines[u-1].lineOffset))/2}function kQ(i,n=1,s=!1){let u=1/0,h=1/0,p=-1/0,m=-1/0;const v=i[0];for(let z=0;z<v.length;z++){const B=v[z];(!z||B.x<u)&&(u=B.x),(!z||B.y<h)&&(h=B.y),(!z||B.x>p)&&(p=B.x),(!z||B.y>m)&&(m=B.y)}const w=Math.min(p-u,m-h);let E=w/2;const A=new au([],DQ);if(w===0)return new Dt(u,h);for(let z=u;z<p;z+=w)for(let B=h;B<m;B+=w)A.push(new o_(z+E,B+E,E,i));let P=function(z){let B=0,U=0,$=0;const Y=z[0];for(let fe=0,he=Y.length,me=he-1;fe<he;me=fe++){const Ae=Y[fe],Ce=Y[me],Le=Ae.x*Ce.y-Ce.x*Ae.y;U+=(Ae.x+Ce.x)*Le,$+=(Ae.y+Ce.y)*Le,B+=3*Le}return new o_(U/B,$/B,0,z)}(i),M=A.length;for(;A.length;){const z=A.pop();(z.d>P.d||!P.d)&&(P=z,s&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,M)),z.max-P.d<=n||(E=z.h/2,A.push(new o_(z.p.x-E,z.p.y-E,E,i)),A.push(new o_(z.p.x+E,z.p.y-E,E,i)),A.push(new o_(z.p.x-E,z.p.y+E,E,i)),A.push(new o_(z.p.x+E,z.p.y+E,E,i)),M+=4)}return s&&(console.log(`num probes: ${M}`),console.log(`best distance: ${P.d}`)),P.p}function DQ(i,n){return n.max-i.max}class o_{constructor(n,s,u,h){this.p=new Dt(n,s),this.h=u,this.d=function(p,m){let v=!1,w=1/0;for(let E=0;E<m.length;E++){const A=m[E];for(let P=0,M=A.length,z=M-1;P<M;z=P++){const B=A[P],U=A[z];B.y>p.y!=U.y>p.y&&p.x<(U.x-B.x)*(p.y-B.y)/(U.y-B.y)+B.x&&(v=!v),w=Math.min(w,Oz(p,B,U))}}return(v?1:-1)*Math.sqrt(w)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const BP=Number.POSITIVE_INFINITY,OQ=Math.sqrt(2);function $F(i,[n,s]){let u=0,h=0;if(s===BP){n<0&&(n=0);const p=n/OQ;switch(i){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-n;break;case"top":h=n-7}switch(i){case"top-right":case"bottom-right":u=-p;break;case"top-left":case"bottom-left":u=p;break;case"left":u=n;break;case"right":u=-n}}else{switch(n=Math.abs(n),s=Math.abs(s),i){case"top-right":case"top-left":case"top":h=s-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-s}switch(i){case"top-right":case"bottom-right":case"right":u=-n;break;case"top-left":case"bottom-left":case"left":u=n}}return[u,h]}function jP(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function LQ(i,n,s,u,h,p,m,v,w,E,A,P,M,z,B){let U=p.textMaxSize.evaluate(n,{},P);U===void 0&&(U=m);const $=i.layers[0].layout,Y=$.get("icon-offset").evaluate(n,{},P),fe=qF(s.horizontal)||s.vertical,he=M.name==="globe",me=uo,Ae=m/me,Ce=i.tilePixelRatio*U/me,Le=(bt=i.overscaling,i.zoom>18&&bt>2&&(bt>>=1),Math.max(Mt/(512*bt),1)*$.get("symbol-spacing")),Ve=$.get("text-padding")*i.tilePixelRatio,He=$.get("icon-padding")*i.tilePixelRatio,et=sr($.get("text-max-angle")),Ze=$.get("text-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",st=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",yt=$.get("symbol-placement"),ot=Le/2;var bt;const rt=$.get("icon-text-fit").evaluate(n,{},P),dt=$.get("icon-text-fit-padding").evaluate(n,{},P),It=rt!=="none";let at;i.hasAnyIconTextFit===!1&&It&&(i.hasAnyIconTextFit=!0),u&&It&&(i.allowVerticalPlacement&&s.vertical&&(at=RF(u,s.vertical,rt,dt,Y,Ae)),fe&&(u=RF(u,fe,rt,dt,Y,Ae)));const Ot=(Et,vt,vn)=>{if(vt.x<0||vt.x>=Mt||vt.y<0||vt.y>=Mt)return;let dn=null;if(he){const{x:Yt,y:kt,z:Mn}=M.projectTilePoint(vt.x,vt.y,vn);dn={anchor:new Th(Yt,kt,Mn,0,void 0),up:M.upVector(vn,vt.x,vt.y)}}(function(Yt,kt,Mn,pn,an,Fn,jn,Bn,Xn,_r,cr,Wr,Xr,Un,zr,Br,oi,Fi,Qi,Bi,Ai,Us,ps,ho,ni,va,Pc){const Ll=Yt.addToLineVertexArray(kt,pn);let zl,Zp,Hd,Xp,Sv,aB,lB,cB=0,uB=0,hB=0,dB=0,mR=-1,gR=-1;const _u={};let fB=_g("");const Kp=Mn?Mn.anchor:kt,_R=Xn.layout.get("icon-text-fit").evaluate(Ai,{},ni)!=="none";let yR=0,vR=0;if(Xn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[yR,vR]=Xn.layout.get("text-offset").evaluate(Ai,{},ni).map(ka=>ka*uo):(yR=Xn.layout.get("text-radial-offset").evaluate(Ai,{},ni)*uo,vR=BP),Yt.allowVerticalPlacement&&an.vertical){const ka=an.vertical;if(zr)aB=UP(ka),Bn&&(lB=UP(Bn));else{const Da=Xn.layout.get("text-rotate").evaluate(Ai,{},ni)+90;Hd=Hw(_r,Kp,kt,cr,Wr,Xr,ka,Un,Da,Br),Bn&&(Xp=Hw(_r,Kp,kt,cr,Wr,Xr,Bn,Fi,Da))}}if(Fn){const ka=Xn.layout.get("icon-rotate").evaluate(Ai,{},ni),Da=UF(Fn,ka,ps,_R),m_=Bn?UF(Bn,ka,ps,_R):void 0;Zp=Hw(_r,Kp,kt,cr,Wr,Xr,Fn,Fi,ka),cB=4*Da.length;const pB=Yt.iconSizeData;let Yp=null;pB.kind==="source"?(Yp=[Tc*Xn.layout.get("icon-size").evaluate(Ai,{},ni)],Yp[0]>Vd&&Ii(`${Yt.layerIds[0]}: Value for "icon-size" is >= ${ov}. Reduce your "icon-size".`)):pB.kind==="composite"&&(Yp=[Tc*Us.compositeIconSizes[0].evaluate(Ai,{},ni),Tc*Us.compositeIconSizes[1].evaluate(Ai,{},ni)],(Yp[0]>Vd||Yp[1]>Vd)&&Ii(`${Yt.layerIds[0]}: Value for "icon-size" is >= ${ov}. Reduce your "icon-size".`)),Yt.addSymbols(Yt.icon,Da,Yp,Bi,Qi,Ai,!1,Mn,kt,Ll.lineStartIndex,Ll.lineLength,-1,ho,ni,va,Pc),mR=Yt.icon.placedSymbolArray.length-1,m_&&(uB=4*m_.length,Yt.addSymbols(Yt.icon,m_,Yp,Bi,Qi,Ai,nl.vertical,Mn,kt,Ll.lineStartIndex,Ll.lineLength,-1,ho,ni,va,Pc),gR=Yt.icon.placedSymbolArray.length-1)}for(const ka in an.horizontal){const Da=an.horizontal[ka];zl||(fB=_g(Da.text),zr?Sv=UP(Da):zl=Hw(_r,Kp,kt,cr,Wr,Xr,Da,Un,Xn.layout.get("text-rotate").evaluate(Ai,{},ni),Br));const m_=Da.positionedLines.length===1;if(hB+=GF(Yt,Mn,kt,Da,jn,Xn,zr,Ai,Br,Ll,an.vertical?nl.horizontal:nl.horizontalOnly,m_?Object.keys(an.horizontal):[ka],_u,mR,Us,ho,ni,va),m_)break}an.vertical&&(dB+=GF(Yt,Mn,kt,an.vertical,jn,Xn,zr,Ai,Br,Ll,nl.vertical,["vertical"],_u,gR,Us,ho,ni,va));let Zd=-1;const xR=(ka,Da)=>ka?Math.max(ka,Da):Da;Zd=xR(Sv,Zd),Zd=xR(aB,Zd),Zd=xR(lB,Zd);const XJ=Zd>-1?1:0;Yt.glyphOffsetArray.length>=65535&&Ii("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ai.sortKey!==void 0&&Yt.addToSortKeyRanges(Yt.symbolInstances.length,Ai.sortKey),Yt.symbolInstances.emplaceBack(kt.x,kt.y,Kp.x,Kp.y,Kp.z,_u.right>=0?_u.right:-1,_u.center>=0?_u.center:-1,_u.left>=0?_u.left:-1,_u.vertical>=0?_u.vertical:-1,mR,gR,fB,zl!==void 0?zl:Yt.collisionBoxArray.length,zl!==void 0?zl+1:Yt.collisionBoxArray.length,Hd!==void 0?Hd:Yt.collisionBoxArray.length,Hd!==void 0?Hd+1:Yt.collisionBoxArray.length,Zp!==void 0?Zp:Yt.collisionBoxArray.length,Zp!==void 0?Zp+1:Yt.collisionBoxArray.length,Xp||Yt.collisionBoxArray.length,Xp?Xp+1:Yt.collisionBoxArray.length,cr,hB,dB,cB,uB,XJ,0,yR,vR,Zd,0,_R?1:0)})(i,vt,dn,Et,s,u,h,at,i.layers[0],i.collisionBoxArray,n.index,n.sourceLayerIndex,i.index,Ve,Ze,w,0,He,st,Y,n,p,E,A,P,z,B)};if(yt==="line")for(const Et of zF(n.geometry,0,0,Mt,Mt)){const vt=RQ(Et,Le,et,s.vertical||fe,u,me,Ce,i.overscaling,Mt);for(const vn of vt)fe&&zQ(i,fe.text,ot,vn)||Ot(Et,vn,P)}else if(yt==="line-center"){for(const Et of n.geometry)if(Et.length>1){const vt=PQ(Et,et,s.vertical||fe,u,me,Ce);vt&&Ot(Et,vt,P)}}else if(n.type==="Polygon")for(const Et of Pw(n.geometry,0)){const vt=kQ(Et,16);Ot(Et[0],new Th(vt.x,vt.y,0,0,void 0),P)}else if(n.type==="LineString")for(const Et of n.geometry)Ot(Et,new Th(Et[0].x,Et[0].y,0,0,void 0),P);else if(n.type==="Point")for(const Et of n.geometry)for(const vt of Et)Ot([vt],new Th(vt.x,vt.y,0,0,void 0),P)}const ov=255,Vd=ov*Tc;function GF(i,n,s,u,h,p,m,v,w,E,A,P,M,z,B,U,$,Y){const fe=function(Ae,Ce,Le,Ve,He,et,Ze,st){const yt=[];if(Ce.positionedLines.length===0)return yt;const ot=Ve.layout.get("text-rotate").evaluate(et,{})*Math.PI/180,bt=function(Ot){const Et=Ot[0],vt=Ot[1],vn=Et*vt;return vn>0?[Et,-vt]:vn<0?[-Et,vt]:Et===0?[vt,Et]:[vt,-Et]}(Le);let rt=Math.abs(Ce.top-Ce.bottom);for(const Ot of Ce.positionedLines)rt-=Ot.lineOffset;const dt=Ce.positionedLines.length,It=rt/dt;let at=Ce.top-Le[1];for(let Ot=0;Ot<dt;++Ot){const Et=Ce.positionedLines[Ot];at=MQ(Ce,It,at,Ot);for(const vt of Et.positionedGlyphs){if(!vt.rect)continue;const vn=vt.rect||{};let dn=EF+1,Yt=!0,kt=1,Mn=0;if(vt.imageName){const Bi=Ze[vt.imageName];if(!Bi)continue;if(Bi.sdf){Ii("SDF images are not supported in formatted text and will be ignored.");continue}Yt=!1,kt=Bi.pixelRatio,dn=Ra/kt}const pn=(He||st)&&vt.vertical,an=vt.metrics.advance*vt.scale/2,Fn=vt.metrics,jn=vt.rect;if(jn===null)continue;st&&Ce.verticalizable&&(Mn=vt.imageName?an-vt.metrics.width*vt.scale/2:0);const Bn=He?[vt.x+an,vt.y]:[0,0];let Xn=[0,0],_r=[0,0],cr=!1;He||(pn?(_r=[vt.x+an+bt[0],vt.y+bt[1]-Mn],cr=!0):Xn=[vt.x+an+Le[0],vt.y+Le[1]-Mn]);const Wr=jn.w*vt.scale/(kt*(vt.localGlyph?Ec:1)),Xr=jn.h*vt.scale/(kt*(vt.localGlyph?Ec:1));let Un,zr,Br,oi;if(pn){const Bi=vt.y-at,Ai=new Dt(-an,an-Bi),Us=-Math.PI/2,ps=new Dt(..._r);Un=new Dt(-an+Xn[0],Xn[1]),Un._rotateAround(Us,Ai)._add(ps),Un.x+=-Bi+an,Un.y-=(Fn.left-dn)*vt.scale;const ho=vt.imageName?Fn.advance*vt.scale:uo*vt.scale,ni=String.fromCodePoint(vt.glyph);bQ(ni)?Un.x+=(1-dn)*vt.scale:wQ(ni)?Un.x+=ho-Fn.height*vt.scale+(-dn-1)*vt.scale:Un.x+=vt.imageName||Fn.width+2*dn===jn.w&&Fn.height+2*dn===jn.h?(ho-Xr)/2:(ho-(Fn.height+2*dn)*vt.scale)/2,zr=new Dt(Un.x,Un.y-Wr),Br=new Dt(Un.x+Xr,Un.y),oi=new Dt(Un.x+Xr,Un.y-Wr)}else{const Bi=(Fn.left-dn)*vt.scale-an+Xn[0],Ai=(-Fn.top-dn)*vt.scale+Xn[1],Us=Bi+Wr,ps=Ai+Xr;Un=new Dt(Bi,Ai),zr=new Dt(Us,Ai),Br=new Dt(Bi,ps),oi=new Dt(Us,ps)}if(ot){let Bi;Bi=He?new Dt(0,0):cr?new Dt(bt[0],bt[1]):new Dt(Le[0],Le[1]),Un._rotateAround(ot,Bi),zr._rotateAround(ot,Bi),Br._rotateAround(ot,Bi),oi._rotateAround(ot,Bi)}const Fi=new Dt(0,0),Qi=new Dt(0,0);yt.push({tl:Un,tr:zr,bl:Br,br:oi,texPrimary:vn,texSecondary:void 0,writingMode:Ce.writingMode,glyphOffset:Bn,sectionIndex:vt.sectionIndex,isSDF:Yt,pixelOffsetTL:Fi,pixelOffsetBR:Qi,minFontScaleX:0,minFontScaleY:0})}}return yt}(0,u,w,p,m,v,h,i.allowVerticalPlacement),he=i.textSizeData;let me=null;he.kind==="source"?(me=[Tc*p.layout.get("text-size").evaluate(v,{},$)],me[0]>Vd&&Ii(`${i.layerIds[0]}: Value for "text-size" is >= ${ov}. Reduce your "text-size".`)):he.kind==="composite"&&(me=[Tc*B.compositeTextSizes[0].evaluate(v,{},$),Tc*B.compositeTextSizes[1].evaluate(v,{},$)],(me[0]>Vd||me[1]>Vd)&&Ii(`${i.layerIds[0]}: Value for "text-size" is >= ${ov}. Reduce your "text-size".`)),i.addSymbols(i.text,fe,me,w,m,v,A,n,s,E.lineStartIndex,E.lineLength,z,U,$,Y,!1);for(const Ae of P)M[Ae]=i.text.placedSymbolArray.length-1;return 4*fe.length}function qF(i){for(const n in i)return i[n];return null}function Hw(i,n,s,u,h,p,m,v,w,E){let A=m.top,P=m.bottom,M=m.left,z=m.right;const B=m.collisionPadding;if(B&&(M-=B[0],A-=B[1],z+=B[2],P+=B[3]),w){const U=new Dt(M,A),$=new Dt(z,A),Y=new Dt(M,P),fe=new Dt(z,P),he=sr(w);let me=new Dt(0,0);E&&(me=new Dt(E[0],E[1])),U._rotateAround(he,me),$._rotateAround(he,me),Y._rotateAround(he,me),fe._rotateAround(he,me),M=Math.min(U.x,$.x,Y.x,fe.x),z=Math.max(U.x,$.x,Y.x,fe.x),A=Math.min(U.y,$.y,Y.y,fe.y),P=Math.max(U.y,$.y,Y.y,fe.y)}return i.emplaceBack(n.x,n.y,n.z,s.x,s.y,M,A,z,P,v,u,h,p),i.length-1}function UP(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const n=i.bottom-i.top;return n>0?Math.max(10,n):null}function zQ(i,n,s,u){const h=i.compareText;if(n in h){const p=h[n];for(let m=p.length-1;m>=0;m--)if(u.dist(p[m])<s)return!0}else h[n]=[];return h[n].push(u),!1}function WF(i,n){const s=i.fovAboveCenter,u=i.elevation?i.elevation.getMinElevationBelowMSL()*n:0,h=(i._camera.position[2]*i.worldSize-u)/Math.cos(i._pitch),p=Math.sin(s)*h/Math.sin(Math.max(Math.PI/2-i._pitch-s,.01)),m=Math.sin(i._pitch)*p+h;return Math.min(1.01*m,h*(1/i._horizonShift))}function Vp(i,n){if(!n.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:n};const s=Math.pow(2,-i.z),u=i.x*s,h=(i.x+1)*s,p=i.y*s,m=(i.y+1)*s,v=ya(u),w=ya(h),E=Xs(p),A=Xs(m),P=n.project(v,E),M=n.project(w,E),z=n.project(w,A),B=n.project(v,A);let U=Math.min(P.x,M.x,z.x,B.x),$=Math.min(P.y,M.y,z.y,B.y),Y=Math.max(P.x,M.x,z.x,B.x),fe=Math.max(P.y,M.y,z.y,B.y);const he=s/16;function me(Ce,Le,Ve,He,et,Ze){const st=(Ve+et)/2,yt=(He+Ze)/2,ot=n.project(ya(st),Xs(yt)),bt=Math.max(0,U-ot.x,$-ot.y,ot.x-Y,ot.y-fe);U=Math.min(U,ot.x),Y=Math.max(Y,ot.x),$=Math.min($,ot.y),fe=Math.max(fe,ot.y),bt>he&&(me(Ce,ot,Ve,He,st,yt),me(ot,Le,st,yt,et,Ze))}me(P,M,u,p,h,p),me(M,z,h,p,h,m),me(z,B,h,m,u,m),me(B,P,u,m,u,p),U-=he,$-=he,Y+=he,fe+=he;const Ae=1/Math.max(Y-U,fe-$);return{scale:Ae,x:U*Ae,y:$*Ae,x2:Y*Ae,y2:fe*Ae,projection:n}}function HF(i,{x:n,y:s},u=0){return new Dt(((n-u)*i.scale-i.x)*Mt,(s*i.scale-i.y)*Mt)}const NQ=a.ae.identity(new Float32Array(16));class $d{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,s){return{x:0,y:0,z:0}}unproject(n,s){return new Sr(0,0)}projectTilePoint(n,s,u){return{x:n,y:s,z:0}}locationPoint(n,s,u=!0){return n._coordinatePoint(n.locationCoordinate(s),u)}pixelsPerMeter(n,s){return Ho(1,n)*s}pixelSpaceConversion(n,s,u){return 1}farthestPixelDistance(n){return WF(n,n.pixelsPerMeter)}pointCoordinate(n,s,u,h){const p=n.horizonLineFromTop(!1),m=new Dt(s,Math.max(p,u));return n.rayIntersectionCoordinate(n.pointRayIntersection(m,h))}pointCoordinate3D(n,s,u){const h=new Dt(s,u);if(n.elevation)return n.elevation.pointCoordinate(h);{const p=this.pointCoordinate(n,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(n,s){if(n.elevation&&n.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(n,s.x,s.y);const u=n.horizonLineFromTop();return s.y<u}createInversionMatrix(n,s){return NQ}createTileMatrix(n,s,u){let h,p,m;const v=u.canonical,w=a.ae.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Vp(v,this);h=1,p=E.x+u.wrap*E.scale,m=E.y,a.ae.scale(w,w,[h/E.scale,h/E.scale,n.pixelsPerMeter/s])}else h=s/n.zoomScale(v.z),p=(v.x+Math.pow(2,v.z)*u.wrap)*h,m=v.y*h;return a.ae.translate(w,w,[p,m,0]),a.ae.scale(w,w,[h/Mt,h/Mt,1]),w}upVector(n,s,u){return[0,0,1]}upVectorScale(n,s,u){return{metersToTile:1}}}class FQ extends $d{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[s,u]=this.parallels=n.parallels||[29.5,45.5],h=Math.sin(sr(s));this.n=(h+Math.sin(sr(u)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(n,s){const{n:u,c:h,r0:p}=this,m=sr(n-this.center[0]),v=sr(s),w=Math.sqrt(h-2*u*Math.sin(v))/u;return{x:w*Math.sin(m*u),y:w*Math.cos(m*u)-p,z:0}}unproject(n,s){const{n:u,c:h,r0:p}=this,m=p+s;let v=Math.atan2(n,Math.abs(m))*Math.sign(m);m*u<0&&(v-=Math.PI*Math.sign(n)*Math.sign(m));const w=sr(this.center[0])*u;v=oc(v,-Math.PI-w,Math.PI-w);const E=Kn(io(v/u)+this.center[0],-180,180),A=Math.asin(Kn((h-(n*n+m*m)*u*u)/(2*u),-1,1)),P=Kn(io(A),-Wi,Wi);return new Sr(E,P)}}const av=1.340264,lv=-.081106,cv=893e-6,uv=.003796,Zw=Math.sqrt(3)/2;class BQ extends $d{project(n,s){s=s/180*Math.PI,n=n/180*Math.PI;const u=Math.asin(Zw*Math.sin(s)),h=u*u,p=h*h*h;return{x:.5*(n*Math.cos(u)/(Zw*(av+3*lv*h+p*(7*cv+9*uv*h)))/Math.PI+.5),y:1-.5*(u*(av+lv*h+p*(cv+uv*h))/Math.PI+1),z:0}}unproject(n,s){n=(2*n-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,h=u*u,p=h*h*h;for(let A,P,M,z=0;z<12&&(P=u*(av+lv*h+p*(cv+uv*h))-s,M=av+3*lv*h+p*(7*cv+9*uv*h),A=P/M,u=Kn(u-A,-Math.PI/3,Math.PI/3),h=u*u,p=h*h*h,!(Math.abs(A)<1e-12));++z);const m=Zw*n*(av+3*lv*h+p*(7*cv+9*uv*h))/Math.cos(u),v=Math.asin(Math.sin(u)/Zw),w=Kn(180*m/Math.PI,-180,180),E=Kn(180*v/Math.PI,-Wi,Wi);return new Sr(w,E)}}class jQ extends $d{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,s){return{x:.5+n/360,y:.5-s/360,z:0}}unproject(n,s){const u=360*(n-.5),h=Kn(360*(.5-s),-Wi,Wi);return new Sr(u,h)}}const a_=Math.PI/2;function Xw(i){return Math.tan((a_+i)/2)}class UQ extends $d{constructor(n){super(n),this.center=n.center||[0,30];const[s,u]=this.parallels=n.parallels||[30,30];let h=sr(s),p=sr(u);this.southernCenter=h+p<0,this.southernCenter&&(h=-h,p=-p);const m=Math.cos(h),v=Xw(h);this.n=h===p?Math.sin(h):Math.log(m/Math.cos(p))/Math.log(Xw(p)/v),this.f=m*Math.pow(Xw(h),this.n)/this.n}project(n,s){s=sr(s),this.southernCenter&&(s=-s),n=sr(n-this.center[0]);const u=1e-6,{n:h,f:p}=this;p>0?s<-a_+u&&(s=-a_+u):s>a_-u&&(s=a_-u);const m=p/Math.pow(Xw(s),h);let v=m*Math.sin(h*n),w=p-m*Math.cos(h*n);return v=.5*(v/Math.PI+.5),w=.5*(w/Math.PI+.5),{x:v,y:this.southernCenter?w:1-w,z:0}}unproject(n,s){n=(2*n-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:u,f:h}=this,p=h-s,m=Math.sign(p),v=Math.sign(u)*Math.sqrt(n*n+p*p);let w=Math.atan2(n,Math.abs(p))*m;p*u<0&&(w-=Math.PI*Math.sign(n)*m);const E=Kn(io(w/u)+this.center[0],-180,180),A=Kn(io(2*Math.atan(Math.pow(h/v,1/u))-a_),-Wi,Wi);return new Sr(E,this.southernCenter?-A:A)}}class ZF extends $d{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,s){return{x:hu(n),y:du(s),z:0}}unproject(n,s){const u=ya(n),h=Xs(s);return new Sr(u,h)}}const XF=sr(Wi);class VQ extends $d{project(n,s){const u=(s=sr(s))*s,h=u*u;return{x:.5*((n=sr(n))*(.8707-.131979*u+h*(h*(.003971*u-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+u*(.015085+h*(.028874*u-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(n,s){n=(2*n-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,h=25,p=0,m=u*u;do{m=u*u;const E=m*m;p=(u*(1.007226+m*(.015085+E*(.028874*m-.044475-.005916*E)))-s)/(1.007226+m*(.045255+E*(.259866*m-.311325-.005916*11*E))),u=Kn(u-p,-XF,XF)}while(Math.abs(p)>1e-6&&--h>0);m=u*u;const v=Kn(io(n/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),w=io(u);return new Sr(v,w)}}const KF=sr(Wi);class $Q extends $d{project(n,s){s=sr(s),n=sr(n);const u=Math.cos(s),h=2/Math.PI,p=Math.acos(u*Math.cos(n/2)),m=Math.sin(p)/p,v=.5*(n*h+2*u*Math.sin(n/2)/m)||0,w=.5*(s+Math.sin(s)/m)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(n,s){let u=n=(2*n-.5)*Math.PI,h=s=(2*(1-s)-1)*Math.PI,p=25;const m=1e-6;let v=0,w=0;do{const E=Math.cos(h),A=Math.sin(h),P=2*A*E,M=A*A,z=E*E,B=Math.cos(u/2),U=Math.sin(u/2),$=2*B*U,Y=U*U,fe=1-z*B*B,he=fe?1/fe:0,me=fe?Math.acos(E*B)*Math.sqrt(1/fe):0,Ae=.5*(2*me*E*U+2*u/Math.PI)-n,Ce=.5*(me*A+h)-s,Le=.5*he*(z*Y+me*E*B*M)+1/Math.PI,Ve=he*($*P/4-me*A*U),He=.125*he*(P*U-me*A*z*$),et=.5*he*(M*B+me*Y*E)+.5,Ze=Ve*He-et*Le;v=(Ce*Ve-Ae*et)/Ze,w=(Ae*He-Ce*Le)/Ze,u=Kn(u-v,-Math.PI,Math.PI),h=Kn(h-w,-KF,KF)}while((Math.abs(v)>m||Math.abs(w)>m)&&--p>0);return new Sr(io(u),io(h))}}class YF extends $d{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(sr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,s){const{scale:u,cosPhi:h}=this;return{x:sr(n)*h*u+.5,y:-Math.sin(sr(s))/h*u+.5,z:0}}unproject(n,s){const{scale:u,cosPhi:h}=this,p=-(s-.5)/u,m=Kn(io((n-.5)/u)/h,-180,180),v=Math.asin(Kn(p*h,-1,1)),w=Kn(io(v),-Wi,Wi);return new Sr(m,w)}}class GQ extends ZF{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,s,u){const h=q0(n,s,u),p=W0(fu(u));return a.$.transformMat4(h,h,p),{x:h[0],y:h[1],z:h[2]}}locationPoint(n,s){const u=Np(s.lat,s.lng),h=a.$.normalize([],u),p=n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(s),n._centerAltitude):n._centerAltitude,m=Ho(1,0)*Mt*p;a.$.scaleAndAdd(u,u,h,m);const v=a.ae.identity(new Float64Array(16));return a.ae.multiply(v,n.pixelMatrix,n.globeMatrix),a.$.transformMat4(u,u,v),new Dt(u[0],u[1])}pixelsPerMeter(n,s){return Ho(1,0)*s}pixelSpaceConversion(n,s,u){const h=Ho(1,n)*s,p=En(Ho(1,45)*s,h,u);return this.pixelsPerMeter(n,s)/p}createTileMatrix(n,s,u){const h=vP(fu(u.canonical));return a.ae.multiply(new Float64Array(16),n.globeMatrix,h)}createInversionMatrix(n,s){const{center:u}=n,h=W0(fu(s));return a.ae.rotateY(h,h,sr(u.lng)),a.ae.rotateX(h,h,sr(u.lat)),a.ae.scale(h,h,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(n,s,u,h){return qz(n,s,u,!0)||new bo(0,0)}pointCoordinate3D(n,s,u){const h=this.pointCoordinate(n,s,u,0);return[h.x,h.y,h.z]}isPointAboveHorizon(n,s){return!qz(n,s.x,s.y,!1)}farthestPixelDistance(n){const s=function(h,p){const m=h.cameraToCenterDistance,v=h._centerAltitude*p,w=h._camera,E=h._camera.forward(),A=a.$.add([],a.$.scale([],E,-m),[0,0,v]),P=h.worldSize/(2*Math.PI),M=[0,0,-P],z=h.width/h.height,B=Math.tan(h.fovAboveCenter),U=a.$.scale([],w.up(),B),$=a.$.scale([],w.right(),B*z),Y=a.$.normalize([],a.$.add([],a.$.add([],E,U),$)),fe=[];let he;if(new pP(A,Y).closestPointOnSphere(M,P,fe)){const me=a.$.add([],fe,M),Ae=a.$.sub([],me,A);he=Math.cos(h.fovAboveCenter)*a.$.length(Ae)}else{const me=a.$.sub([],A,M),Ae=a.$.sub([],M,A);a.$.normalize(Ae,Ae);const Ce=a.$.length(me)-P;he=Math.sqrt(Ce*(Ce+2*P));const Le=Math.acos(he/(P+Ce))-Math.acos(a.$.dot(E,Ae));he*=Math.cos(Le)}return 1.01*he}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),u=bh(n.zoom);if(u>0){const h=WF(n,Ho(1,n.center.lat)*n.worldSize),p=n.worldSize/(2*Math.PI),m=Math.max(n.width,n.height)/n.worldSize*Math.PI;return En(s,h+p*(1-Math.cos(m)),Math.pow(u,10))}return s}upVector(n,s,u){return q0(s,u,n,1)}upVectorScale(n){return{metersToTile:Tw(Sw(fu(n)))}}}function QF(i){const n=i.parallels,s=!!n&&Math.abs(n[0]+n[1])<.01;switch(i.name){case"mercator":return new ZF(i);case"equirectangular":return new jQ(i);case"naturalEarth":return new VQ(i);case"equalEarth":return new BQ(i);case"winkelTripel":return new $Q(i);case"albers":return s?new YF(i):new FQ(i);case"lambertConformalConic":return s?new YF(i):new UQ(i);case"globe":return new GQ(i)}throw new Error(`Invalid projection name: ${i.name}`)}const qQ=kw.types,WQ=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kw(i,n,s,u,h,p,m,v,w,E,A,P,M){const z=v?Math.min(Vd,Math.round(v[0])):0,B=v?Math.min(Vd,Math.round(v[1])):0;i.emplaceBack(n,s,Math.round(32*u),Math.round(32*h),p,m,(z<<1)+(w?1:0),B,16*E,16*A,256*P,256*M)}function Yw(i,n,s){i.emplaceBack(n,s)}function Qw(i,n,s,u,h,p,m){i.emplaceBack(n,s,u,h,p,m)}function Jw(i,n,s,u,h){i.emplaceBack(n,s,u,h),i.emplaceBack(n,s,u,h),i.emplaceBack(n,s,u,h),i.emplaceBack(n,s,u,h)}function HQ(i){for(const n of i.sections)if(Vn(n.text))return!0;return!1}class VP{constructor(n){this.layoutVertexArray=new NC,this.indexArray=new js,this.programConfigurations=n,this.segments=new wi,this.dynamicLayoutVertexArray=new Rd,this.opacityVertexArray=new BC,this.placedSymbolArray=new hz,this.iconTransitioningVertexArray=new Dd,this.globeExtVertexArray=new FC,this.zOffsetVertexArray=new Gg}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(n,s,u,h,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,KY.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,QY.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,WQ,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,JY.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,YY.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,iF.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ue(VP,"SymbolBuffers");class $P{constructor(n,s,u){this.layoutVertexArray=new n,this.layoutAttributes=s,this.indexArray=new u,this.segments=new wi,this.collisionVertexArray=new VC,this.collisionVertexArrayExt=new Rd}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,eQ.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,tQ.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ue($P,"CollisionBuffers");class l_{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.lut=n.lut,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=a.ae.identity([]),this.placementViewportMatrix=a.ae.identity([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=DP(this.zoom,s["text-size"]),this.iconSizeData=DP(this.zoom,s["icon-size"]);const u=this.layers[0].layout,h=u.get("symbol-sort-key"),p=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(m=>nl[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=u.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new VP(new Ld(this.layers,{zoom:this.zoom,lut:this.lut},n=>/^text/.test(n))),this.icon=new VP(new Ld(this.layers,{zoom:this.zoom,lut:this.lut},n=>/^icon/.test(n))),this.glyphOffsetArray=new pz,this.lineVertexArray=new mz,this.symbolInstances=new fz}calculateGlyphDependencies(n,s,u,h,p){for(let m=0;m<n.length;m++){const v=n.codePointAt(m);if(v===void 0)break;if(s[v]=!0,h&&p&&v<=65535){const w=rv[n.charAt(m)];w&&(s[w.charCodeAt(0)]=!0)}}}updateFootprints(n,s){}updateReplacement(n,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const u=s.getReplacementRegionsForTile(n.toUnwrapped(),!0);return!RP(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(n,s,u,h){const p=this.layers[0],m=p.layout,v=this.projection.name==="globe",w=m.get("text-font"),E=m.get("text-field"),A=m.get("icon-image"),P=(E.value.kind!=="constant"||E.value.value instanceof vo&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),M=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,z=m.get("symbol-sort-key");if(this.features=[],!P&&!M)return;const B=s.iconDependencies,U=s.glyphDependencies,$=s.availableImages,Y=new kn(this.zoom);for(const{feature:fe,id:he,index:me,sourceLayerIndex:Ae}of n){const Ce=p._featureFilter.needGeometry,Le=vh(fe,Ce);if(!p._featureFilter.filter(Y,Le,u))continue;if(Ce||(Le.geometry=wc(fe,u,h)),v&&fe.type!==1&&u.z<=5){const Ze=Le.geometry,st=.98078528056,yt=(ot,bt)=>{const rt=q0(ot.x,ot.y,u,1),dt=q0(bt.x,bt.y,u,1);return a.$.dot(rt,dt)<st};for(let ot=0;ot<Ze.length;ot++)Ze[ot]=GK(Ze[ot],yt)}let Ve,He;if(P){const Ze=p.getValueAndResolveTokens("text-field",Le,u,$),st=vo.factory(Ze);HQ(st)&&(this.hasRTLText=!0),(!this.hasRTLText||$n()==="unavailable"||this.hasRTLText&&or.isParsed())&&(Ve=xQ(st,p,Le))}if(M){const Ze=p.getValueAndResolveTokens("icon-image",Le,u,$);He=Ze instanceof ua?Ze:ua.fromString(Ze)}if(!Ve&&!He)continue;const et=this.sortFeaturesByKey?z.evaluate(Le,{},u):void 0;if(this.features.push({id:he,text:Ve,icon:He,index:me,sourceLayerIndex:Ae,geometry:Le.geometry,properties:fe.properties,type:qQ[fe.type],sortKey:et}),He&&(B[He.namePrimary]=!0,He.nameSecondary&&(B[He.nameSecondary]=!0)),Ve){const Ze=w.evaluate(Le,{},u).join(","),st=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(nl.vertical)>=0;for(const yt of Ve.sections)if(yt.image)B[yt.image.namePrimary]=!0;else{const ot=ht(Ve.toString()),bt=yt.fontStack||Ze,rt=U[bt]=U[bt]||{};this.calculateGlyphDependencies(yt.text,rt,st,this.allowVerticalPlacement,ot)}}}m.get("symbol-placement")==="line"&&(this.features=function(fe){const he={},me={},Ae=[];let Ce=0;function Le(Ze){Ae.push(fe[Ze]),Ce++}function Ve(Ze,st,yt){const ot=me[Ze];return delete me[Ze],me[st]=ot,Ae[ot].geometry[0].pop(),Ae[ot].geometry[0]=Ae[ot].geometry[0].concat(yt[0]),ot}function He(Ze,st,yt){const ot=he[st];return delete he[st],he[Ze]=ot,Ae[ot].geometry[0].shift(),Ae[ot].geometry[0]=yt[0].concat(Ae[ot].geometry[0]),ot}function et(Ze,st,yt){const ot=yt?st[0][st[0].length-1]:st[0][0];return`${Ze}:${ot.x}:${ot.y}`}for(let Ze=0;Ze<fe.length;Ze++){const st=fe[Ze],yt=st.geometry,ot=st.text?st.text.toString():null;if(!ot){Le(Ze);continue}const bt=et(ot,yt),rt=et(ot,yt,!0);if(bt in me&&rt in he&&me[bt]!==he[rt]){const dt=He(bt,rt,yt),It=Ve(bt,rt,Ae[dt].geometry);delete he[bt],delete me[rt],me[et(ot,Ae[It].geometry,!0)]=It,Ae[dt].geometry=null}else bt in me?Ve(bt,rt,yt):rt in he?He(bt,rt,yt):(Le(Ze),he[bt]=Ce-1,me[rt]=Ce-1)}return Ae.filter(Ze=>Ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((fe,he)=>fe.sortKey-he.sortKey)}update(n,s,u,h,p){const m=Object.keys(n).length!==0;if(m&&!this.stateDependentLayers.length)return;const v=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(n,s,v,u,h,p),this.icon.programConfigurations.updatePaintArrays(n,s,v,u,h,p)}updateZOffset(){const n=(p,m,v)=>{u+=m,u>p.length&&p.resize(u);for(let w=-m;w<0;w++)p.emplace(w+u,v)},s=(p,m,v)=>{h+=m,h>p.length&&p.resize(h);for(let w=-m;w<0;w++)p.emplace(w+h,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,h=0;for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:w,numIconVertices:E}=m,A=m.zOffset,P=E>0;if((v>0||w>0)&&(n(this.text.zOffsetVertexArray,v,A),n(this.text.zOffsetVertexArray,w,A)),P){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:z}=m;M>=0&&s(this.icon.zOffsetVertexArray,E,A),z>=0&&s(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,A)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=QF(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,s){const u=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:h,y:p}of s)this.lineVertexArray.emplaceBack(h,p);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(n,s,u,h,p,m,v,w,E,A,P,M,z,B,U,$){const Y=n.indexArray,fe=n.layoutVertexArray,he=n.globeExtVertexArray,me=n.segments.prepareSegment(4*s.length,fe,Y,this.canOverlap?m.sortKey:void 0),Ae=this.glyphOffsetArray.length,Ce=me.vertexLength,Le=this.allowVerticalPlacement&&v===nl.vertical?Math.PI/2:0,Ve=m.text&&m.text.sections;for(let et=0;et<s.length;et++){const{tl:Ze,tr:st,bl:yt,br:ot,texPrimary:bt,texSecondary:rt,pixelOffsetTL:dt,pixelOffsetBR:It,minFontScaleX:at,minFontScaleY:Ot,glyphOffset:Et,isSDF:vt,sectionIndex:vn}=s[et],dn=me.vertexLength,Yt=Et[1];if(Kw(fe,E.x,E.y,Ze.x,Yt+Ze.y,bt.x,bt.y,u,vt,dt.x,dt.y,at,Ot),Kw(fe,E.x,E.y,st.x,Yt+st.y,bt.x+bt.w,bt.y,u,vt,It.x,dt.y,at,Ot),Kw(fe,E.x,E.y,yt.x,Yt+yt.y,bt.x,bt.y+bt.h,u,vt,dt.x,It.y,at,Ot),Kw(fe,E.x,E.y,ot.x,Yt+ot.y,bt.x+bt.w,bt.y+bt.h,u,vt,It.x,It.y,at,Ot),w){const{x:kt,y:Mn,z:pn}=w.anchor,[an,Fn,jn]=w.up;Qw(he,kt,Mn,pn,an,Fn,jn),Qw(he,kt,Mn,pn,an,Fn,jn),Qw(he,kt,Mn,pn,an,Fn,jn),Qw(he,kt,Mn,pn,an,Fn,jn),Jw(n.dynamicLayoutVertexArray,kt,Mn,pn,Le)}else Jw(n.dynamicLayoutVertexArray,E.x,E.y,E.z,Le);if($){const kt=rt||bt;Yw(n.iconTransitioningVertexArray,kt.x,kt.y),Yw(n.iconTransitioningVertexArray,kt.x+kt.w,kt.y),Yw(n.iconTransitioningVertexArray,kt.x,kt.y+kt.h),Yw(n.iconTransitioningVertexArray,kt.x+kt.w,kt.y+kt.h)}Y.emplaceBack(dn,dn+1,dn+2),Y.emplaceBack(dn+1,dn+2,dn+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Et[0]),et!==s.length-1&&vn===s[et+1].sectionIndex||n.programConfigurations.populatePaintArrays(fe.length,m,m.index,{},z,B,U,Ve&&Ve[vn])}const He=w?w.anchor:E;n.placedSymbolArray.emplaceBack(He.x,He.y,He.z,E.x,E.y,Ae,this.glyphOffsetArray.length-Ae,Ce,A,P,E.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],v,0,!1,0,M,0)}_commitLayoutVertex(n,s,u,h,p,m,v){n.emplaceBack(s,u,h,p,m,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(n,s,u,h,p,m,v){const w=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),E=w.vertexLength,A=v.tileAnchorX,P=v.tileAnchorY;for(let z=0;z<4;z++)u.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,s,n.padding,v.zOffset),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,A,P,new Dt(n.x1,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,A,P,new Dt(n.x2,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,A,P,new Dt(n.x2,n.y2)),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,A,P,new Dt(n.x1,n.y2)),w.vertexLength+=4;const M=u.indexArray;M.emplaceBack(E,E+1),M.emplaceBack(E+1,E+2),M.emplaceBack(E+2,E+3),M.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(n,s,u,h,p,m){for(let v=h;v<p;v++){const w=u.get(v),E=this.getSymbolInstanceTextSize(n,m,s,v);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(n,s,u,h,p,m){for(let v=h;v<p;v++){const w=u.get(v),E=this.getSymbolInstanceIconSize(n,s,m.placedIconSymbolIndex);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,m)}}generateCollisionDebugBuffers(n,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $P(pw,sF.members,Dd),this.iconCollisionBox=new $P(pw,sF.members,Dd);const u=r_(this.iconSizeData,n),h=r_(this.textSizeData,n);for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(h,n,s,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(h,n,s,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(u,n,s,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(u,n,s,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(n,s,u,h){const p=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:h),m=Vw(this.textSizeData,n,p)/uo;return this.tilePixelRatio*m}getSymbolInstanceIconSize(n,s,u){const h=this.icon.placedSymbolArray.get(u),p=Vw(this.iconSizeData,n,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(n,s,u,h){n.emplaceBack(s,-u,-u,h),n.emplaceBack(s,u,-u,h),n.emplaceBack(s,u,u,h),n.emplaceBack(s,-u,u,h)}_updateTextDebugCollisionBoxes(n,s,u,h,p,m){for(let v=h;v<p;v++){const w=u.get(v),E=this.getSymbolInstanceTextSize(n,m,s,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(n,s,u,h,p,m){for(let v=h;v<p;v++){const w=u.get(v),E=this.getSymbolInstanceIconSize(n,s,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding,m.zOffset)}}updateCollisionDebugBuffers(n,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=r_(this.iconSizeData,n),h=r_(this.textSizeData,n);for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,n,s,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(h,n,s,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(u,n,s,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._updateIconDebugCollisionBoxes(u,n,s,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,s,u,h,p,m,v,w,E){const A={};if(s<u){const{x1:P,y1:M,x2:z,y2:B,padding:U,projectedAnchorX:$,projectedAnchorY:Y,projectedAnchorZ:fe,tileAnchorX:he,tileAnchorY:me,featureIndex:Ae}=n.get(s);A.textBox={x1:P,y1:M,x2:z,y2:B,padding:U,projectedAnchorX:$,projectedAnchorY:Y,projectedAnchorZ:fe,tileAnchorX:he,tileAnchorY:me},A.textFeatureIndex=Ae}if(h<p){const{x1:P,y1:M,x2:z,y2:B,padding:U,projectedAnchorX:$,projectedAnchorY:Y,projectedAnchorZ:fe,tileAnchorX:he,tileAnchorY:me,featureIndex:Ae}=n.get(h);A.verticalTextBox={x1:P,y1:M,x2:z,y2:B,padding:U,projectedAnchorX:$,projectedAnchorY:Y,projectedAnchorZ:fe,tileAnchorX:he,tileAnchorY:me},A.verticalTextFeatureIndex=Ae}if(m<v){const{x1:P,y1:M,x2:z,y2:B,padding:U,projectedAnchorX:$,projectedAnchorY:Y,projectedAnchorZ:fe,tileAnchorX:he,tileAnchorY:me,featureIndex:Ae}=n.get(m);A.iconBox={x1:P,y1:M,x2:z,y2:B,padding:U,projectedAnchorX:$,projectedAnchorY:Y,projectedAnchorZ:fe,tileAnchorX:he,tileAnchorY:me},A.iconFeatureIndex=Ae}if(w<E){const{x1:P,y1:M,x2:z,y2:B,padding:U,projectedAnchorX:$,projectedAnchorY:Y,projectedAnchorZ:fe,tileAnchorX:he,tileAnchorY:me,featureIndex:Ae}=n.get(w);A.verticalIconBox={x1:P,y1:M,x2:z,y2:B,padding:U,projectedAnchorX:$,projectedAnchorY:Y,projectedAnchorZ:fe,tileAnchorX:he,tileAnchorY:me},A.verticalIconFeatureIndex=Ae}return A}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,s){const u=n.placedSymbolArray.get(s),h=u.vertexStartIndex+4*u.numGlyphs;for(let p=u.vertexStartIndex;p<h;p+=4)n.indexArray.emplaceBack(p,p+1,p+2),n.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(n),u=Math.cos(n),h=[],p=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const w=this.symbolInstances.get(v);h.push(0|Math.round(s*w.tileAnchorX+u*w.tileAnchorY)),p.push(w.featureIndex)}return m.sort((v,w)=>h[v]-h[w]||p[w]-p[v]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((n,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(n).zOffset)}addToSortKeyRanges(n,s){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const u=this.symbolInstances.get(s);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:E}=u;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ue(l_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),l_.addDynamicAttributes=Jw;class kl{constructor(n,s,u,h){this.context=n,this.format=u,this.texture=n.gl.createTexture(),this.update(s,h)}update(n,s,u){const{width:h,height:p}=n,{context:m}=this,{gl:v}=m;if(v.bindTexture(v.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!s||s.premultiply!==!1)),this.useMipmap=!!(s&&s.useMipmap),u||this.size&&this.size[0]===h&&this.size[1]===p){const{x:w,y:E}=u||{x:0,y:0};if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap)v.texSubImage2D(v.TEXTURE_2D,0,w,E,v.RGBA,v.UNSIGNED_BYTE,n);else{let A=this.format,P=v.UNSIGNED_BYTE;this.format===v.R32F&&(A=v.RED,P=v.FLOAT),v.texSubImage2D(v.TEXTURE_2D,0,w,E,h,p,A,P,n.data)}}else if(this.size=[h,p],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap){let w=this.format;this.format===v.R8&&(w=v.RED),v.texImage2D(v.TEXTURE_2D,0,this.format,w,v.UNSIGNED_BYTE,n)}else{let w=this.format,E=this.format,A=v.UNSIGNED_BYTE,P=!1;this.format===v.DEPTH_COMPONENT&&(w=v.DEPTH_COMPONENT16,A=v.UNSIGNED_SHORT),this.format===v.DEPTH_STENCIL&&(w=v.DEPTH24_STENCIL8,A=v.UNSIGNED_INT_24_8,P=!0),this.format===v.R8&&(E=v.RED),this.format===v.R32F&&(A=v.FLOAT,E=v.RED),!this.useMipmap&&P?v.texStorage2D(v.TEXTURE_2D,1,w,h,p):v.texImage2D(v.TEXTURE_2D,0,w,h,p,0,E,A,n.data)}this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(n,s,u=!1){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!u?n===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),s!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(n,s,u,h){const{context:p}=this,{gl:m}=p;m.bindTexture(m.TEXTURE_2D,this.texture),s!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,s),this.magFilter=s),n!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?n===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),u!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,u),this.wrapS=u),h!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class eT{constructor(n,s){this.context=n,this.texture=s}bind(n,s){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),n!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,n),this.minFilter=n),s!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrapS=s)}}const Dl=32,mu=33,Gd=new Uint16Array(8184);for(let i=0;i<2046;i++){let n=i+2,s=0,u=0,h=0,p=0,m=0,v=0;for(1&n?h=p=m=Dl:s=u=v=Dl;(n>>=1)>1;){const E=s+h>>1,A=u+p>>1;1&n?(h=s,p=u,s=m,u=v):(s=h,u=p,h=m,p=v),m=E,v=A}const w=4*i;Gd[w+0]=s,Gd[w+1]=u,Gd[w+2]=h,Gd[w+3]=p}const gu=new Uint16Array(2178),qd=new Uint8Array(1089),tT=new Uint16Array(1089);function JF(i){return i===0?-.03125:i===32?.03125:0}var nT=Lr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class $p{constructor(n,s,u,h){this.id=$p.uniqueIdxCounter,$p.uniqueIdxCounter++,this.context=n;const p=n.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||h||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=$p.uniqueIdxCounter,$p.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}$p.uniqueIdxCounter=0;class c_{constructor(n,s,u){this.func=n,this.mask=s,this.range=u}}c_.ReadOnly=!1,c_.ReadWrite=!0,c_.disabled=new c_(519,c_.ReadOnly,[0,1]);const GP=7680;class qP{constructor(n,s,u,h,p,m){this.test=n,this.ref=s,this.mask=u,this.fail=h,this.depthFail=p,this.pass=m}}qP.disabled=new qP({func:519,mask:0},0,0,GP,GP,GP);const hv=771;class Ma{constructor(n,s,u,h){this.blendFunction=n,this.blendColor=s,this.mask=u,this.blendEquation=h}}Ma.Replace=[1,0,1,0],Ma.disabled=new Ma(Ma.Replace,Ar.transparent,[!1,!1,!1,!1]),Ma.unblended=new Ma(Ma.Replace,Ar.transparent,[!0,!0,!0,!0]),Ma.alphaBlended=new Ma([1,hv,1,hv],Ar.transparent,[!0,!0,!0,!0]),Ma.alphaBlendedNonPremultiplied=new Ma([770,hv,770,hv],Ar.transparent,[!0,!0,!0,!0]),Ma.multiply=new Ma([774,0,774,0],Ar.transparent,[!0,!0,!0,!0]);const WP=1029,HP=2305;class Sc{constructor(n,s,u){this.enable=n,this.mode=s,this.frontFace=u}}Sc.disabled=new Sc(!1,WP,HP),Sc.backCCW=new Sc(!0,WP,HP),Sc.backCW=new Sc(!0,WP,2304),Sc.frontCW=new Sc(!0,1028,2304),Sc.frontCCW=new Sc(!0,1028,HP);var ZQ=Lr([{name:"a_index",type:"Int16",components:1}]);const e5={type:2,extent:Mt,loadGeometry:()=>[[new Dt(0,0),new Dt(Mt+1,0),new Dt(Mt+1,Mt+1),new Dt(0,Mt+1),new Dt(0,0)]]};class rT{constructor(n,s,u,h,p){this.tileID=n,this.uid=lc(),this.uses=0,this.tileSize=s,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,h&&h.style&&(this._lastUpdatedBrightness=h.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(n){const s=n+this.timeAdded;s<rn.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Vp(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,s,u){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(h,p){const m={};if(!p)return m;for(const v of h){const w=v.layerIds.map(E=>p.getLayer(E)).filter(Boolean);if(w.length!==0){v.layers=w,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(E=>w.filter(A=>A.id===E)[0]));for(const E of w)m[E.fqid]=v}}return m}(n.buckets,s.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const p=this.buckets[h];if(p instanceof l_){if(this.hasSymbolBuckets=!0,!u)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const p=this.buckets[h];if(p instanceof l_&&p.hasRTLText){this.hasRTLText=!0,or.isLoading()||or.isLoaded()||$n()!=="deferred"||Tr();break}}this.queryPadding=0;for(const h in this.buckets){const p=this.buckets[h],m=s.style.getOwnLayer(h);if(!m)continue;const v=m.queryRadius(p);this.queryPadding=Math.max(this.queryPadding,v)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new KC}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(n)}const s=n.gl,u=this.imageAtlas;if(u&&!u.uploaded){const h=!!Object.keys(u.patternPositions).length;this.imageAtlasTexture=new kl(n,u.image,s.RGBA,{useMipmap:h}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new kl(n,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new kl(n,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(n,s,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,u),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const h=s.style.getBrightness();(this._lastUpdatedBrightness||h)&&(this._lastUpdatedBrightness&&h&&Math.abs(this._lastUpdatedBrightness-h)<.001||(this._lastUpdatedBrightness=h,this.updateBuckets(void 0,s)))}queryRenderedFeatures(n,s,u,h,p,m,v,w){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:v,transform:m,params:p,tileTransform:this.tileTransform},n,s,u):{}}querySourceFeatures(n,s){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const h=u.loadVTLayers(),p=s?s.sourceLayer:"",m=h._geojsonTileLayer||h[p];if(!m)return;const v=vc(s&&s.filter),{z:w,x:E,y:A}=this.tileID.canonical,P={z:w,x:E,y:A};for(let M=0;M<m.length;M++){const z=m.feature(M);if(v.needGeometry){const $=vh(z,!0);if(!v.filter(new kn(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!v.filter(new kn(this.tileID.overscaledZ),z))continue;const B=u.getId(z,p),U=new bF(z,w,E,A,B);U.tile=P,n.push(U)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const s=this.expirationTime;if(n.cacheControl){const u=tu(n.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const u=Date.now();let h=!1;if(this.expirationTime>u)h=!1;else if(s)if(this.expirationTime<s)h=!0;else{const p=this.expirationTime-s;p?this.expirationTime=u+Math.max(p,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,s){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0&&s&&this.updateBuckets(n,s)}updateBuckets(n,s){if(!this.latestFeatureIndex)return;const u=this.latestFeatureIndex.loadVTLayers(),h=s.style.listImages(),p=s.style.getBrightness();for(const m in this.buckets){if(!s.style.hasLayer(m))continue;const v=this.buckets[m],w=v.layers[0].sourceLayer||"_geojsonTileLayer",E=u[w];let A={};if(n&&(A=n[w],!E||!A||Object.keys(A).length===0))continue;if(v.update(A,E,h,this.imageAtlas&&this.imageAtlas.patternPositions||{},p),v instanceof Bw||v instanceof Rw){const M=s.style.getOwnSourceCache(v.layers[0].source);s._terrain&&s._terrain.enabled&&M&&v.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(M.id,this.tileID)}const P=s&&s.style&&s.style.getOwnLayer(m);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<rn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=rn.now()+n}setTexture(n,s){const u=s.context,h=u.gl;this.texture=this.texture||s.getTileTexture(n.width),this.texture&&this.texture instanceof kl?this.texture.update(n,{useMipmap:!0}):(this.texture=new kl(u,n,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(n,s){const u={};for(const h of s)u[h]=!0;this.dependencies[n]=u}hasDependency(n,s){for(const u of n){const h=this.dependencies[u];if(h){for(const p of s)if(h[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const u=wc(e5,this.tileID.canonical,this.tileTransform)[0],h=new xc,p=new F0;for(let m=0;m<u.length;m++){const{x:v,y:w}=u[m];h.emplaceBack(v,w),p.emplaceBack(m)}p.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(p),this._tileDebugBuffer=n.createVertexBuffer(h,G0.members),this._tileDebugSegments=wi.simpleSegment(0,0,h.length,p.length)}_makeTileBoundsBuffers(n,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const u=wc(e5,this.tileID.canonical,this.tileTransform)[0];let h,p;if(this.isRaster){const m=function(v,w){const E=Vp(v,w),A=Math.pow(2,v.z);for(let $=0;$<mu;$++)for(let Y=0;Y<mu;Y++){const fe=ya((v.x+(Y+JF(Y))/Dl)/A),he=Xs((v.y+($+JF($))/Dl)/A),me=w.project(fe,he),Ae=$*mu+Y;gu[2*Ae+0]=Math.round((me.x*E.scale-E.x)*Mt),gu[2*Ae+1]=Math.round((me.y*E.scale-E.y)*Mt)}qd.fill(0),tT.fill(0);for(let $=2045;$>=0;$--){const Y=4*$,fe=Gd[Y+0],he=Gd[Y+1],me=Gd[Y+2],Ae=Gd[Y+3],Ce=fe+me>>1,Le=he+Ae>>1,Ve=Ce+Le-he,He=Le+fe-Ce,et=he*mu+fe,Ze=Ae*mu+me,st=Le*mu+Ce,yt=Math.hypot((gu[2*et+0]+gu[2*Ze+0])/2-gu[2*st+0],(gu[2*et+1]+gu[2*Ze+1])/2-gu[2*st+1])>=16;qd[st]=qd[st]||(yt?1:0),$<1022&&(qd[st]=qd[st]||qd[(he+He>>1)*mu+(fe+Ve>>1)]||qd[(Ae+He>>1)*mu+(me+Ve>>1)])}const P=new mh,M=new js;let z=0;function B($,Y){const fe=Y*mu+$;return tT[fe]===0&&(P.emplaceBack(gu[2*fe+0],gu[2*fe+1],$*Mt/Dl,Y*Mt/Dl),tT[fe]=++z),tT[fe]-1}function U($,Y,fe,he,me,Ae){const Ce=$+fe>>1,Le=Y+he>>1;if(Math.abs($-me)+Math.abs(Y-Ae)>1&&qd[Le*mu+Ce])U(me,Ae,$,Y,Ce,Le),U(fe,he,me,Ae,Ce,Le);else{const Ve=B($,Y),He=B(fe,he),et=B(me,Ae);M.emplaceBack(Ve,He,et)}}return U(0,0,Dl,Dl,Dl,0),U(Dl,Dl,0,0,0,Dl),{vertices:P,indices:M}}(this.tileID.canonical,s);h=m.vertices,p=m.indices}else{h=new mh,p=new js;for(const{x:v,y:w}of u)h.emplaceBack(v,w,0,0);const m=Z0(h.int16,void 0,4);for(let v=0;v<m.length;v+=3)p.emplaceBack(m[v],m[v+1],m[v+2])}this._tileBoundsBuffer=n.createVertexBuffer(h,nT.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(p),this._tileBoundsSegments=wi.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugBuffers(n,s){const u=s.projection;if(!u||u.name!=="globe"||s.freezeTileCoverage)return;const h=this.tileID.canonical,p=W0(Wz(h,s)),m=bh(s.zoom);let v;m>0&&(v=a.ae.invert(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,h,s,p,v,m),this._makeGlobeTileDebugTextBuffer(n,h,s,p,v,m)}_globePoint(n,s,u,h,p,m,v){let w=q0(n,s,u);if(m){const E=1<<u.z,A=hu(h.center.lng),P=du(h.center.lat),M=(u.x+.5)/E-A;let z=0;M>.5?z=-1:M<-.5&&(z=1);let B=(n/Mt+u.x)/E+z,U=(s/Mt+u.y)/E;B=(B-A)*h._pixelsPerMercatorPixel+A,U=(U-P)*h._pixelsPerMercatorPixel+P;const $=[B*h.worldSize,U*h.worldSize,0];a.$.transformMat4($,$,m),w=xh(w,$,v)}return a.$.transformMat4(w,w,p)}_makeGlobeTileDebugBorderBuffer(n,s,u,h,p,m){const v=new xc,w=new F0,E=new hw,A=(M,z,B,U,$)=>{const Y=(B-M)/($-1),fe=(U-z)/($-1),he=v.length;for(let me=0;me<$;me++){const Ae=M+me*Y,Ce=z+me*fe;v.emplaceBack(Ae,Ce);const Le=this._globePoint(Ae,Ce,s,u,h,p,m);E.emplaceBack(Le[0],Le[1],Le[2]),w.emplaceBack(he+me)}},P=Mt;A(0,0,P,0,16),A(P,0,P,P,16),A(P,P,0,P,16),A(0,P,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(w),this._tileDebugBuffer=n.createVertexBuffer(v,G0.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(E,Gz.members),this._tileDebugSegments=wi.simpleSegment(0,0,v.length,w.length)}_makeGlobeTileDebugTextBuffer(n,s,u,h,p,m){const v=Mt/4,w=new xc,E=new js,A=new hw,P=25;E.reserve(32),w.reserve(P),A.reserve(P);const M=(z,B)=>P*z+B;for(let z=0;z<P;z++){const B=z*v;for(let U=0;U<P;U++){const $=U*v;w.emplaceBack($,B);const Y=this._globePoint($,B,s,u,h,p,m);A.emplaceBack(Y[0],Y[1],Y[2])}}for(let z=0;z<4;z++)for(let B=0;B<4;B++){const U=M(z,B),$=M(z,B+1),Y=M(z+1,B),fe=M(z+1,B+1);E.emplaceBack(U,$,Y),E.emplaceBack(Y,$,fe)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(E),this._tileDebugTextBuffer=n.createVertexBuffer(w,G0.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(A,Gz.members),this._tileDebugTextSegments=wi.simpleSegment(0,0,P,32)}destroy(n=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof kl&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function XQ(i,n,s){i===1?n.header_length=s.readFixed32():i===2?n.x=s.readVarint():i===3?n.y=s.readVarint():i===4?n.z=s.readVarint():i===5&&n.layers.push(function(u,h){return u.readFields(eJ,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},h)}(s,s.readVarint()+s.pos))}function KQ(i,n,s){i===1?(n.delta_filter=function(u,h){return u.readFields(YQ,{block_size:0},h)}(s,s.readVarint()+s.pos),n.filter="delta_filter"):i===2?(s.readVarint(),n.filter="zigzag_filter"):i===3?(s.readVarint(),n.filter="bitshuffle_filter"):i===4&&(s.readVarint(),n.filter="byteshuffle_filter")}function YQ(i,n,s){i===1&&(n.block_size=s.readVarint())}function QQ(i,n,s){i===1?(s.readVarint(),n.codec="gzip_data"):i===2?(s.readVarint(),n.codec="jpeg_image"):i===3?(s.readVarint(),n.codec="webp_image"):i===4&&(s.readVarint(),n.codec="png_image")}function JQ(i,n,s){i===1?n.first_byte=s.readFixed64():i===2?n.last_byte=s.readFixed64():i===3?n.filters.push(function(u,h){return u.readFields(KQ,{},h)}(s,s.readVarint()+s.pos)):i===4?n.codec=function(u,h){return u.readFields(QQ,{},h)}(s,s.readVarint()+s.pos):i===5?n.deprecated_offset=s.readFloat():i===6?n.deprecated_scale=s.readFloat():i===7?n.bands.push(s.readString()):i===8?n.offset=s.readDouble():i===9&&(n.scale=s.readDouble())}function eJ(i,n,s){i===1?n.version=s.readVarint():i===2?n.name=s.readString():i===3?n.units=s.readString():i===4?n.tilesize=s.readVarint():i===5?n.buffer=s.readVarint():i===6?n.pixel_format=s.readVarint():i===7&&n.data_index.push(function(u,h){return u.readFields(JQ,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},h)}(s,s.readVarint()+s.pos))}function tJ(i,n,s){if(i===2)(function(u,h,p){u.readFields(nJ,p,h)})(s,s.readVarint()+s.pos,n);else if(i===3)throw new Error("Not implemented")}function nJ(i,n,s){if(i===1){let u=0;const h=s.readVarint()+s.pos;for(;s.pos<h;)n[u++]=s.readVarint()}}class rJ{constructor(n){this.capacity=n,this.cache=new Map}get(n){if(!this.cache.has(n))return;const s=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,s),s}put(n,s){this.cache.has(n)?this.cache.delete(n):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(n,s)}}function iJ(i,n){if(n.length!==4)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let s=n[3];for(let u=2;u>=1;u--){const h=u===1?1:0,p=u===2?1:0;for(let m=0;m<n[0];m++){const v=n[1]*m;for(let w=h;w<n[1];w++){const E=n[2]*(w+v);for(let A=p;A<n[2];A++){const P=n[3]*(A+E);for(let M=0;M<n[3];M++){const z=P+M;i[z]+=i[z-s]}}}}s*=n[u]}return i}function sJ(i){for(let n=0,s=i.length;n<s;n++)i[n]=i[n]>>>1^-(1&i[n]);return i}function oJ(i,n){switch(n){case"uint32":return i;case"uint16":for(let s=0;s<i.length;s+=2){const u=i[s],h=i[s+1];i[s]=(240&u)>>4|(61440&u)>>8|(240&h)<<4|61440&h,i[s+1]=15&u|(3840&u)>>4|(15&h)<<8|(3840&h)<<4}return i;case"uint8":for(let s=0;s<i.length;s+=4){const u=i[s],h=i[s+1],p=i[s+2],m=i[s+3];i[s+0]=(192&u)>>6|(192&h)>>4|(192&p)>>2|192&m,i[s+1]=(48&u)>>4|(48&h)>>2|48&p|(48&m)<<2,i[s+2]=(12&u)>>2|12&h|(12&p)<<2|(12&m)<<4,i[s+3]=3&u|(3&h)<<2|(3&p)<<4|(3&m)<<6}return i;default:throw new Error(`Invalid pixel format, "${n}"`)}}var rl=Uint8Array,dv=Uint16Array,aJ=Int32Array,t5=new rl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),n5=new rl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),lJ=new rl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r5=function(i,n){for(var s=new dv(31),u=0;u<31;++u)s[u]=n+=1<<i[u-1];var h=new aJ(s[30]);for(u=1;u<30;++u)for(var p=s[u];p<s[u+1];++p)h[p]=p-s[u]<<5|u;return{b:s,r:h}},i5=r5(t5,2),s5=i5.b,cJ=i5.r;s5[28]=258,cJ[258]=28;for(var uJ=r5(n5,0).b,o5=new dv(32768),Yi=0;Yi<32768;++Yi){var u_=(43690&Yi)>>1|(21845&Yi)<<1;o5[Yi]=((65280&(u_=(61680&(u_=(52428&u_)>>2|(13107&u_)<<2))>>4|(3855&u_)<<4))>>8|(255&u_)<<8)>>1}var fv=function(i,n,s){for(var u=i.length,h=0,p=new dv(n);h<u;++h)i[h]&&++p[i[h]-1];var m,v=new dv(n);for(h=1;h<n;++h)v[h]=v[h-1]+p[h-1]<<1;m=new dv(1<<n);var w=15-n;for(h=0;h<u;++h)if(i[h])for(var E=h<<4|i[h],A=n-i[h],P=v[i[h]-1]++<<A,M=P|(1<<A)-1;P<=M;++P)m[o5[P]>>w]=E;return m},pv=new rl(288);for(Yi=0;Yi<144;++Yi)pv[Yi]=8;for(Yi=144;Yi<256;++Yi)pv[Yi]=9;for(Yi=256;Yi<280;++Yi)pv[Yi]=7;for(Yi=280;Yi<288;++Yi)pv[Yi]=8;var a5=new rl(32);for(Yi=0;Yi<32;++Yi)a5[Yi]=5;var hJ=fv(pv,9),dJ=fv(a5,5),ZP=function(i){for(var n=i[0],s=1;s<i.length;++s)i[s]>n&&(n=i[s]);return n},Ic=function(i,n,s){var u=n/8|0;return(i[u]|i[u+1]<<8)>>(7&n)&s},XP=function(i,n){var s=n/8|0;return(i[s]|i[s+1]<<8|i[s+2]<<16)>>(7&n)},fJ=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ac=function(i,n,s){var u=new Error(n||fJ[i]);if(u.code=i,Error.captureStackTrace&&Error.captureStackTrace(u,Ac),!s)throw u;return u},pJ=new rl(0),mJ=typeof TextDecoder<"u"&&new TextDecoder;try{mJ.decode(pJ,{stream:!0})}catch{}const gJ={gzip_data:"gzip"};class Ol extends Error{constructor(n){super(n),this.name="MRTError"}}const _J={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},l5={uint32:1,uint16:2,uint8:4},yJ={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let KP,YP;class mv{constructor(n=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=n}getLayer(n){const s=this.layers[n];if(!s)throw new Ol(`Layer '${n}' not found`);return s}getHeaderLength(n){const s=new Uint8Array(n),u=new DataView(n);if(s[0]!==13)throw new Ol("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(n){const s=new Uint8Array(n),u=this.getHeaderLength(n);if(s.length<u)throw new Ol(`Expected header with length >= ${u} but got buffer of length ${s.length}`);const h=function(p,m){return p.readFields(XQ,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new KP(s.subarray(0,u)));if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new Ol(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const p of h.layers)this.layers[p.name]=new vJ(p,{cacheSize:this._cacheSize});return this}createDecodingTask(n){const s=[],u=this.getLayer(n.layerName);for(let h of n.blockIndices){const p=u.dataIndex[h],m=p.first_byte-n.firstByte,v=p.last_byte-n.firstByte;if(u._blocksInProgress.has(h))continue;const w={layerName:u.name,firstByte:m,lastByte:v,pixelFormat:u.pixelFormat,blockIndex:h,blockShape:[p.bands.length].concat(u.bandShape),buffer:u.buffer,codec:p.codec.codec,filters:p.filters.map(E=>E.filter)};u._blocksInProgress.add(h),s.push(w)}return new c5(s,()=>{s.forEach(h=>u._blocksInProgress.delete(h.blockIndex))},(h,p)=>{if(s.forEach(m=>u._blocksInProgress.delete(m.blockIndex)),h)throw h;p.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class vJ{constructor({version:n,name:s,units:u,tilesize:h,pixel_format:p,buffer:m,data_index:v},w){if(this.version=n,this.version!==1)throw new Ol(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=s,this.units=u,this.tileSize=h,this.buffer=m,this.pixelFormat=_J[p],this.dataIndex=v,this.bandShape=[h+2*m,h+2*m,l5[this.pixelFormat]],this._decodedBlocks=new rJ(w?w.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return l5[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:n})=>n).flat()}processDecodedData(n){const s=n.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,n.data)}getBlockForBand(n){let s=0;switch(typeof n){case"string":for(const[u,h]of this.dataIndex.entries()){for(const[p,m]of h.bands.entries())if(m===n)return{bandIndex:s+p,blockIndex:u,blockBandIndex:p};s+=h.bands.length}break;case"number":for(const[u,h]of this.dataIndex.entries()){if(n>=s&&n<s+h.bands.length)return{bandIndex:n,blockIndex:u,blockBandIndex:n-s};s+=h.bands.length}break;default:throw new Ol(`Invalid band \`${JSON.stringify(n)}\`. Expected string or integer.`)}throw new Ol(`Band not found: ${JSON.stringify(n)}`)}getDataRange(n){let s=1/0,u=-1/0;const h=[],p=new Set;for(const m of n){const{blockIndex:v}=this.getBlockForBand(m);if(v<0)throw new Ol(`Invalid band: ${JSON.stringify(m)}`);const w=this.dataIndex[v];h.includes(v)||h.push(v),p.add(v),s=Math.min(s,w.first_byte),u=Math.max(u,w.last_byte)}if(p.size>this.cacheSize)throw new Ol(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:u,blockIndices:h}}hasBand(n){const{blockIndex:s}=this.getBlockForBand(n);return s>=0}hasDataForBand(n){const{blockIndex:s}=this.getBlockForBand(n);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(n){const{blockIndex:s,blockBandIndex:u}=this.getBlockForBand(n),h=this._decodedBlocks.get(s.toString());if(!h)throw new Ol(`Data for band ${JSON.stringify(n)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[s],m=this.bandShape.reduce((E,A)=>E*A,1),v=u*m,w=h.subarray(v,v+m);return{data:w,bytes:new Uint8Array(w.buffer).subarray(w.byteOffset,w.byteOffset+w.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset!==0?p.offset:p.deprecated_offset,scale:p.scale!==0?p.scale:p.deprecated_scale}}}mv.setPbf=function(i){KP=i};class c5{constructor(n,s,u){this.tasks=n,this._onCancel=s,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(n,s){this._finalized||(this._onComplete(n,s),this._finalized=!0)}}mv.performDecoding=function(i,n){const s=new Uint8Array(i);return Promise.all(n.tasks.map(u=>{const{layerName:h,firstByte:p,lastByte:m,pixelFormat:v,blockShape:w,blockIndex:E,filters:A,codec:P}=u,M=s.subarray(p,m+1),z=new Uint32Array(w[0]*w[1]*w[2]);let B;if(P!=="gzip_data")throw new Ol(`Unhandled codec: ${P}`);return B=function(U,$){if(!globalThis.DecompressionStream&&$==="gzip_data")return Promise.resolve(((me=function(Le){Le[0]==31&&Le[1]==139&&Le[2]==8||Ac(6,"invalid gzip data");var Ve=Le[3],He=10;4&Ve&&(He+=2+(Le[10]|Le[11]<<8));for(var et=(Ve>>3&1)+(Ve>>4&1);et>0;et-=!Le[He++]);return He+(2&Ve)}(he=U))+8>he.length&&Ac(6,"invalid gzip data"),function(Le,Ve,He,et){var Ze=Le.length;if(!Ze||Ve.f&&!Ve.l)return He||new rl(0);var st=!He,yt=st||Ve.i!=2,ot=Ve.i;st&&(He=new rl(3*Ze));var bt,rt,dt=function(Hd){var Xp=He.length;if(Hd>Xp){var Sv=new rl(Math.max(2*Xp,Hd));Sv.set(He),He=Sv}},It=Ve.f||0,at=Ve.p||0,Ot=Ve.b||0,Et=Ve.l,vt=Ve.d,vn=Ve.m,dn=Ve.n,Yt=8*Ze;do{if(!Et){It=Ic(Le,at,1);var kt=Ic(Le,at+1,3);if(at+=3,!kt){var Mn=Le[(Un=4+((at+7)/8|0))-4]|Le[Un-3]<<8,pn=Un+Mn;if(pn>Ze){ot&&Ac(0);break}yt&&dt(Ot+Mn),He.set(Le.subarray(Un,pn),Ot),Ve.b=Ot+=Mn,Ve.p=at=8*pn,Ve.f=It;continue}if(kt==1)Et=hJ,vt=dJ,vn=9,dn=5;else if(kt==2){var an=Ic(Le,at,31)+257,Fn=Ic(Le,at+10,15)+4,jn=an+Ic(Le,at+5,31)+1;at+=14;for(var Bn=new rl(jn),Xn=new rl(19),_r=0;_r<Fn;++_r)Xn[lJ[_r]]=Ic(Le,at+3*_r,7);at+=3*Fn;var cr=ZP(Xn),Wr=(1<<cr)-1,Xr=fv(Xn,cr);for(_r=0;_r<jn;){var Un,zr=Xr[Ic(Le,at,Wr)];if(at+=15&zr,(Un=zr>>4)<16)Bn[_r++]=Un;else{var Br=0,oi=0;for(Un==16?(oi=3+Ic(Le,at,3),at+=2,Br=Bn[_r-1]):Un==17?(oi=3+Ic(Le,at,7),at+=3):Un==18&&(oi=11+Ic(Le,at,127),at+=7);oi--;)Bn[_r++]=Br}}var Fi=Bn.subarray(0,an),Qi=Bn.subarray(an);vn=ZP(Fi),dn=ZP(Qi),Et=fv(Fi,vn),vt=fv(Qi,dn)}else Ac(1);if(at>Yt){ot&&Ac(0);break}}yt&&dt(Ot+131072);for(var Bi=(1<<vn)-1,Ai=(1<<dn)-1,Us=at;;Us=at){var ps=(Br=Et[XP(Le,at)&Bi])>>4;if((at+=15&Br)>Yt){ot&&Ac(0);break}if(Br||Ac(2),ps<256)He[Ot++]=ps;else{if(ps==256){Us=at,Et=null;break}var ho=ps-254;ps>264&&(ho=Ic(Le,at,(1<<(Pc=t5[_r=ps-257]))-1)+s5[_r],at+=Pc);var ni=vt[XP(Le,at)&Ai],va=ni>>4;if(ni||Ac(3),at+=15&ni,Qi=uJ[va],va>3){var Pc=n5[va];Qi+=XP(Le,at)&(1<<Pc)-1,at+=Pc}if(at>Yt){ot&&Ac(0);break}yt&&dt(Ot+131072);var Ll=Ot+ho;if(Ot<Qi){var zl=0-Qi,Zp=Math.min(Qi,Ll);for(zl+Ot<0&&Ac(3);Ot<Zp;++Ot)He[Ot]=(void 0)[zl+Ot]}for(;Ot<Ll;++Ot)He[Ot]=He[Ot-Qi]}}Ve.l=Et,Ve.p=Us,Ve.b=Ot,Ve.f=It,Et&&(It=1,Ve.m=vn,Ve.d=vt,Ve.n=dn)}while(!It);return Ot!=He.length&&st?(bt=He,((rt=Ot)==null||rt>bt.length)&&(rt=bt.length),new rl(bt.subarray(0,rt))):He.subarray(0,Ot)}(he.subarray(me,-8),{i:2},new rl(((Y=he)[(fe=Y.length)-4]|Y[fe-3]<<8|Y[fe-2]<<16|Y[fe-1]<<24)>>>0))));var Y,fe,he,me;const Ae=gJ[$];if(!Ae)throw new Error(`Unhandled codec: ${$}`);const Ce=new globalThis.DecompressionStream(Ae);return new Response(new Blob([U]).stream().pipeThrough(Ce)).arrayBuffer().then(Le=>new Uint8Array(Le))}(M,P).then(U=>(function($,Y){$.readFields(tJ,Y)}(new KP(U),z),new yJ[v](z.buffer))),B.then(U=>{for(let $=A.length-1;$>=0;$--)switch(A[$]){case"delta_filter":iJ(U,w);break;case"zigzag_filter":sJ(U);break;case"bitshuffle_filter":oJ(U,v);break;default:throw new Ol(`Unhandled filter "${A[$]}"`)}return{layerName:h,blockIndex:E,data:U}}).catch(U=>{throw U})}))},mv.setPbf(nv);class u5 extends rT{constructor(n,s,u,h,p){super(n,s,u,h,p),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(n,s){const u=s.context,h=u.gl;this.texture=this.texture||s.getTileTexture(n.width),this.texture&&this.texture instanceof kl?this.texture.update(n,{useMipmap:!1,premultiply:!1}):this.texture=new kl(u,n,h.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,s){const u=this._mrt=new mv(30),h=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=rh(h,(p,m,v,w)=>{if(p)s(p);else try{const E=u.getHeaderLength(m);if(E>n)return void(this.request=this.fetchHeader(E,s));u.parseHeader(m),this._isHeaderLoaded=!0;let A=0;for(const P of Object.values(u.layers))A=Math.max(A,P.dataIndex[P.dataIndex.length-1].last_byte);m.byteLength>=A&&(this.entireBuffer=m),s(null,this.entireBuffer||m,v,w)}catch(E){s(E)}}),this.request}fetchBand(n,s,u){const h=this._mrt;if(!this._isHeaderLoaded||!h)return void u(new Error("Tile header is not ready"));const p=this.actor;if(!p)return void u(new Error("Can't fetch tile band without an actor"));let m;const v=(P,M)=>{m.complete(P,M),P?u(P):(this.updateTextureDescriptor(n,s),u(null,this.textureDescriptor&&this.textureDescriptor.img))},w=(P,M)=>{if(P)return u(P);const z=p.send("decodeRasterArray",{buffer:M,task:m},v,void 0,!0);this._workQueue.push(()=>{z&&z.cancel(),m.cancel()})},E=h.getLayer(n);if(!E)return void u(new Error(`Unknown sourceLayer "${n}"`));if(E.hasDataForBand(s))return this.updateTextureDescriptor(n,s),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const A=E.getDataRange([s]);if(m=h.createDecodingTask(A),!m||m.tasks.length)if(this.flushQueues(),this.entireBuffer)w(null,this.entireBuffer.slice(A.firstByte,A.lastByte+1));else{const P=Object.assign({},this.requestParams,{headers:{Range:`bytes=${A.firstByte}-${A.lastByte}`}}),M=rh(P,w);this._fetchQueue.push(()=>{M.cancel(),m.cancel()})}else u(null)}updateNeeded(n,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,s){if(!this._mrt)return;const u=this._mrt.getLayer(n);if(!u||!u.hasBand(s)||!u.hasDataForBand(s))return;const{bytes:h,tileSize:p,buffer:m,offset:v,scale:w}=u.getBandView(s),E=p+2*m,A={data:h,width:E,height:E},P=this.texture;P&&P instanceof kl&&P.update(A,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:n,band:s,img:A,buffer:m,offset:v,tileSize:p,format:u.pixelFormat,mix:[w,256*w,65536*w,16777216*w]}}}class xJ{constructor(n,s){this.max=n,this.onRemove=s,this.reset()}reset(){for(const n in this.data)for(const s of this.data[n])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(n,s,u){const h=n.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const p={value:s,timeout:void 0};if(u!==void 0&&(p.timeout=setTimeout(()=>{this.remove(n,p)},u)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const s=this.data[n].shift();return s.timeout&&clearTimeout(s.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),s.value}getByKey(n){const s=this.data[n];return s?s[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,s){if(!this.has(n))return this;const u=n.wrapped().key,h=s===void 0?0:this.data[u].indexOf(s),p=this.data[u][h];return this.data[u].splice(h,1),p.timeout&&clearTimeout(p.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(p.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(n){const s=[];for(const u in this.data)for(const h of this.data[u])n(h.value)||s.push(h);for(const u of s)this.remove(u.value.tileID,u)}}class Gp extends ah{constructor(n,s,u){super(),this.id=n,this._onlySymbols=u,s.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new xJ(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new _Q,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const s=this._tiles[n];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,s){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,s)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const u=this._tiles[s];u.upload(n),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return ac(this._tiles).map(n=>n.tileID).sort(h5).map(n=>n.key)}getRenderableIds(n,s){const u=[];for(const h in this._tiles)this._isIdRenderable(+h,n,s)&&u.push(this._tiles[h]);return n?u.sort((h,p)=>{const m=h.tileID,v=p.tileID,w=new Dt(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),E=new Dt(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-v.overscaledZ||E.y-w.y||E.x-w.x}).map(h=>h.tileID.key):u.map(h=>h.tileID).sort(h5).map(h=>h.key)}hasRenderableParent(n){const s=this.findLoadedParent(n,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(n,s,u){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(s||!this._tiles[n].holdingForFade())&&(u||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,s){const u=this._tiles[n];u&&(u.state!=="loading"&&(u.state=s),this._loadTile(u,this._tileLoaded.bind(this,u,n,s)))}_tileLoaded(n,s,u,h){if(h)if(n.state="errored",h.status!==404)this._source.fire(new dp(h,{tile:n}));else{if(this._source.fire(new Al("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=rn.now(),u==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(s,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new Al("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const s=this.getRenderableIds();for(let h=0;h<s.length;h++){const p=s[h];if(n.neighboringTiles&&n.neighboringTiles[p]){const m=this.getTileByID(p);u(n,m),u(m,n)}}function u(h,p){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let m=p.tileID.canonical.x-h.tileID.canonical.x;const v=p.tileID.canonical.y-h.tileID.canonical.y,w=Math.pow(2,h.tileID.canonical.z),E=p.tileID.key;m===0&&v===0||Math.abs(v)>1||(Math.abs(m)>1&&(Math.abs(m+w)===1?m+=w:Math.abs(m-w)===1&&(m-=w)),p.dem&&h.dem&&(h.dem.backfillBorder(p.dem,m,v),h.neighboringTiles&&h.neighboringTiles[E]&&(h.neighboringTiles[E].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,s,u,h){for(const p in this._tiles){let m=this._tiles[p];if(h[p]||!m.hasData()||m.tileID.overscaledZ<=s||m.tileID.overscaledZ>u)continue;let v=m.tileID;for(;m&&m.tileID.overscaledZ>s+1;){const E=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[E.key],m&&m.hasData()&&(v=E)}let w=v;for(;w.overscaledZ>s;)if(w=w.scaledTo(w.overscaledZ-1),n[w.key]){h[v.key]=v;break}}}findLoadedParent(n,s){if(n.key in this._loadedParentTiles){const u=this._loadedParentTiles[n.key];return u&&u.tileID.overscaledZ>=s?u:null}for(let u=n.overscaledZ-1;u>=s;u--){const h=n.scaledTo(u),p=this._getLoadedTile(h);if(p)return p}}_getLoadedTile(n){const s=this._tiles[n.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,s){s=s||this._source.tileSize;const u=Math.ceil(n.width/s)+1,h=Math.ceil(n.height/s)+1,p=Math.floor(u*h*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(n){const s=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,s){const u={};for(const h in this._tiles){const p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),u[p.tileID.key]=p}this._tiles=u;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(n,s,u,h){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(n,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const p=this._source.type==="batched-model";let m;if(this.used||this.usedForTerrain){if(this._source.tileID)m=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(E=>new ws(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y));else if(this.tileCoverLift!==0){const E=n.clone();E.tileCoverLift=this.tileCoverLift,m=E.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:p}),this._source.minzoom<=1&&n.projection.name==="globe"&&(m.push(new ws(1,0,1,0,0)),m.push(new ws(1,0,1,1,0)),m.push(new ws(1,0,1,0,1)),m.push(new ws(1,0,1,1,1)))}else if(m=n.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:p}),this._source.hasTile){const E=this._source.hasTile.bind(this._source);m=m.filter(A=>E(A))}}else m=[];if(m.length>0&&this.castsShadows&&h&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!QP(this._source.type)){const E=n.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),A=Math.min(E,this._source.maxzoom);if(p){const P=n.extendTileCover(m,A);for(const M of P)m.push(M)}else{const P=n.extendTileCover(m,A,h);for(const M of P)this._shadowCasterTiles[M.key]=!0,m.push(M)}}const v=this._updateRetainedTiles(m);if(QP(this._source.type)&&m.length!==0){const E={},A={},P=Object.keys(v);for(const z of P){const B=v[z],U=this._tiles[z];if(!U||U.fadeEndTime&&U.fadeEndTime<=rn.now())continue;const $=this.findLoadedParent(B,Math.max(B.overscaledZ-Gp.maxOverzooming,this._source.minzoom));$&&(this._addTile($.tileID),E[$.tileID.key]=$.tileID),A[z]=B}const M=m[m.length-1].overscaledZ;for(const z in this._tiles){const B=this._tiles[z];if(v[z]||!B.hasData())continue;let U=B.tileID;for(;U.overscaledZ>M;){U=U.scaledTo(U.overscaledZ-1);const $=this._tiles[U.key];if($&&$.hasData()&&A[U.key]){v[z]=B.tileID;break}}}for(const z in E)v[z]||(this._coveredTiles[z]=!0,v[z]=E[z])}for(const E in v)this._tiles[E].clearFadeHold();const w=function(E,A){const P=[];for(const M in E)M in A||P.push(M);return P}(this._tiles,v);for(const E of w){const A=this._tiles[E];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(+E)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const s={};if(n.length===0)return s;const u={},h=n.reduce((E,A)=>Math.min(E,A.overscaledZ),1/0),p=n[0].overscaledZ,m=Math.max(p-Gp.maxOverzooming,this._source.minzoom),v=Math.max(p+Gp.maxUnderzooming,this._source.minzoom),w={};for(const E of n){const A=this._addTile(E);s[E.key]=E,A.hasData()||h<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,h,v,s);for(const E of n){let A=this._tiles[E.key];if(A.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const M=E.children(this._source.maxzoom)[0],z=this.getTile(M);if(z&&z.hasData()){s[M.key]=M;continue}}else{const M=E.children(this._source.maxzoom);if(s[M[0].key]&&s[M[1].key]&&s[M[2].key]&&s[M[3].key])continue}let P=A.wasRequested();for(let M=E.overscaledZ-1;M>=m;--M){const z=E.scaledTo(M);if(u[z.key]||(u[z.key]=!0,A=this.getTile(z),!A&&P&&(A=this._addTile(z)),A&&(s[z.key]=z,P=A.wasRequested(),A.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const s=[];let u,h=this._tiles[n].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){u=this._loadedParentTiles[h.key];break}s.push(h.key);const p=h.scaledTo(h.overscaledZ-1);if(u=this._getLoadedTile(p),u)break;h=p}for(const p of s)this._loadedParentTiles[p]=u}}_addTile(n){let s=this._tiles[n.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),s;s=this._cache.getAndRemove(n),s&&(this._setTileReloadTimer(n.key,s),s.tileID=n,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,s)));const u=!!s;if(!u){const h=this.map?this.map.painter:null,p=this._source.tileSize*n.overscaleFactor();s=this._source.type==="raster-array"?new u5(n,p,this.transform.tileZoom,h,this._isRaster):new rT(n,p,this.transform.tileZoom,h,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,n.key,s.state))}return s?(s.uses++,this._tiles[n.key]=s,u||this._source.fire(new Al("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(n,s){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const u=s.getExpiryTimeout();u&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},u))}_removeTile(n){const s=this._tiles[n];s&&(s.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,s,u){const h=[],p=this.transform;if(!p)return h;const m=p.projection.name==="globe",v=hu(p.center.lng);for(const w in this._tiles){const E=this._tiles[w];if(u&&E.clearQueryDebugViz(),E.holdingForFade())continue;let A;if(m){const P=E.tileID.canonical;if(P.z===0){const M=[Math.abs(Kn(v,...gv(P,-1))-v),Math.abs(Kn(v,...gv(P,1))-v)];A=[0,2*M.indexOf(Math.min(...M))-1]}else{const M=[Math.abs(Kn(v,...gv(P,-1))-v),Math.abs(Kn(v,...gv(P,0))-v),Math.abs(Kn(v,...gv(P,1))-v)];A=[M.indexOf(Math.min(...M))-1]}}else A=[0];for(const P of A){const M=n.containsTile(E,p,s,P);M&&h.push(M)}}return h}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,s){const u=this.getRenderableIds(n,s).map(p=>this._tiles[p].tileID),h=this.transform.projection.name==="globe";for(const p of u)p.projMatrix=this.transform.calculateProjMatrix(p.toUnwrapped()),p.expandedProjMatrix=h?this.transform.calculateProjMatrix(p.toUnwrapped(),!1,!0):p.projMatrix;return u}sortCoordinatesByDistance(n){const s=n.slice(),u=this.transform._camera.position,h=this.transform._camera.forward(),p={};for(const m of s){const v=1/(1<<m.canonical.z);p[m.key]=((m.canonical.x+.5)*v+m.wrap-u[0])*h[0]+((m.canonical.y+.5)*v-u[1])*h[1]-u[2]*h[2]}return s.sort((m,v)=>p[m.key]-p[v.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(QP(this._source.type))for(const n in this._tiles){const s=this._tiles[n];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=rn.now())return!0}return!1}setFeatureState(n,s,u){this._state.updateState(n=n||"_geojsonTileLayer",s,u)}removeFeatureState(n,s,u){this._state.removeFeatureState(n=n||"_geojsonTileLayer",s,u)}getFeatureState(n,s){return this._state.getState(n=n||"_geojsonTileLayer",s)}setDependencies(n,s,u){const h=this._tiles[n];h&&h.setDependencies(s,u)}reloadTilesForDependencies(n,s){for(const u in this._tiles)this._tiles[u].hasDependency(n,s)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(n,s))}_preloadTiles(n,s){if(!this._sourceLoaded){const v=()=>{this._sourceLoaded&&(this._source.off("data",v),this._preloadTiles(n,s))};return void this._source.on("data",v)}const u=new Map,h=Array.isArray(n)?n:[n],p=this.map.painter.terrain,m=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const v of h){const w=v.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of w)u.set(E.key,E);this.usedForTerrain&&v.updateElevation(!1)}th(Array.from(u.values()),(v,w)=>{const E=new rT(v,this._source.tileSize*v.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,A=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),w(A,E)})},s)}}function h5(i,n){const s=Math.abs(2*i.wrap)-+(i.wrap<0),u=Math.abs(2*n.wrap)-+(n.wrap<0);return i.overscaledZ-n.overscaledZ||u-s||n.canonical.y-i.canonical.y||n.canonical.x-i.canonical.x}function QP(i){return i==="raster"||i==="image"||i==="video"||i==="custom"}function gv(i,n){const s=1<<i.z;return[i.x/s+n,(i.x+1)/s+n]}Gp.maxOverzooming=10,Gp.maxUnderzooming=3;const d5=()=>YP||(YP={layout:lF||(lF=new Zr({"line-cap":new ln(Ke.layout_line["line-cap"]),"line-join":new ln(Ke.layout_line["line-join"]),"line-miter-limit":new xt(Ke.layout_line["line-miter-limit"]),"line-round-limit":new xt(Ke.layout_line["line-round-limit"]),"line-sort-key":new ln(Ke.layout_line["line-sort-key"]),"line-z-offset":new ln(Ke.layout_line["line-z-offset"]),visibility:new xt(Ke.layout_line.visibility)})),paint:cF||(cF=new Zr({"line-opacity":new ln(Ke.paint_line["line-opacity"]),"line-color":new ln(Ke.paint_line["line-color"]),"line-translate":new xt(Ke.paint_line["line-translate"]),"line-translate-anchor":new xt(Ke.paint_line["line-translate-anchor"]),"line-width":new ln(Ke.paint_line["line-width"]),"line-gap-width":new ln(Ke.paint_line["line-gap-width"]),"line-offset":new ln(Ke.paint_line["line-offset"]),"line-blur":new ln(Ke.paint_line["line-blur"]),"line-dasharray":new ln(Ke.paint_line["line-dasharray"]),"line-pattern":new ln(Ke.paint_line["line-pattern"]),"line-gradient":new xo(Ke.paint_line["line-gradient"]),"line-trim-offset":new xt(Ke.paint_line["line-trim-offset"]),"line-trim-fade-range":new xt(Ke.paint_line["line-trim-fade-range"]),"line-trim-color":new xt(Ke.paint_line["line-trim-color"]),"line-emissive-strength":new xt(Ke.paint_line["line-emissive-strength"]),"line-border-width":new ln(Ke.paint_line["line-border-width"]),"line-border-color":new ln(Ke.paint_line["line-border-color"]),"line-occlusion-opacity":new xt(Ke.paint_line["line-occlusion-opacity"])}))},YP);class bJ extends ln{possiblyEvaluate(n,s){return s=new kn(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition}),super.possiblyEvaluate(n,s)}evaluate(n,s,u,h){return s=Rs({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(n,s,u,h)}}let _v,f5,p5,JP;function m5(i,n){return n>0?n+2*i:i}class g5{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:ca,this.defaultValue=n}evaluate(n){if(n.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(n.formattedSection))return s.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ue(g5,"FormatSectionOverride",{omit:["defaultValue"]});const eR=()=>JP||(JP={layout:f5||(f5=new Zr({"symbol-placement":new xt(Ke.layout_symbol["symbol-placement"]),"symbol-spacing":new xt(Ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new xt(Ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ln(Ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new xt(Ke.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new xt(Ke.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new xt(Ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new xt(Ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new xt(Ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new xt(Ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new ln(Ke.layout_symbol["icon-size"]),"icon-text-fit":new ln(Ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ln(Ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new ln(Ke.layout_symbol["icon-image"]),"icon-rotate":new ln(Ke.layout_symbol["icon-rotate"]),"icon-padding":new xt(Ke.layout_symbol["icon-padding"]),"icon-keep-upright":new xt(Ke.layout_symbol["icon-keep-upright"]),"icon-offset":new ln(Ke.layout_symbol["icon-offset"]),"icon-anchor":new ln(Ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new xt(Ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new xt(Ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new xt(Ke.layout_symbol["text-rotation-alignment"]),"text-field":new ln(Ke.layout_symbol["text-field"]),"text-font":new ln(Ke.layout_symbol["text-font"]),"text-size":new ln(Ke.layout_symbol["text-size"]),"text-max-width":new ln(Ke.layout_symbol["text-max-width"]),"text-line-height":new ln(Ke.layout_symbol["text-line-height"]),"text-letter-spacing":new ln(Ke.layout_symbol["text-letter-spacing"]),"text-justify":new ln(Ke.layout_symbol["text-justify"]),"text-radial-offset":new ln(Ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new xt(Ke.layout_symbol["text-variable-anchor"]),"text-anchor":new ln(Ke.layout_symbol["text-anchor"]),"text-max-angle":new xt(Ke.layout_symbol["text-max-angle"]),"text-writing-mode":new xt(Ke.layout_symbol["text-writing-mode"]),"text-rotate":new ln(Ke.layout_symbol["text-rotate"]),"text-padding":new xt(Ke.layout_symbol["text-padding"]),"text-keep-upright":new xt(Ke.layout_symbol["text-keep-upright"]),"text-transform":new ln(Ke.layout_symbol["text-transform"]),"text-offset":new ln(Ke.layout_symbol["text-offset"]),"text-allow-overlap":new xt(Ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new xt(Ke.layout_symbol["text-ignore-placement"]),"text-optional":new xt(Ke.layout_symbol["text-optional"]),visibility:new xt(Ke.layout_symbol.visibility)})),paint:p5||(p5=new Zr({"icon-opacity":new ln(Ke.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ln(Ke.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ln(Ke.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ln(Ke.paint_symbol["text-emissive-strength"]),"icon-color":new ln(Ke.paint_symbol["icon-color"]),"icon-halo-color":new ln(Ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new ln(Ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ln(Ke.paint_symbol["icon-halo-blur"]),"icon-translate":new xt(Ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new xt(Ke.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ln(Ke.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ln(Ke.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ln(Ke.paint_symbol["text-occlusion-opacity"]),"text-color":new ln(Ke.paint_symbol["text-color"],{runtimeType:Ca,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ln(Ke.paint_symbol["text-halo-color"]),"text-halo-width":new ln(Ke.paint_symbol["text-halo-width"]),"text-halo-blur":new ln(Ke.paint_symbol["text-halo-blur"]),"text-translate":new xt(Ke.paint_symbol["text-translate"]),"text-translate-anchor":new xt(Ke.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new xt(Ke.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new xt(Ke.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new xt(Ke.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new xt(Ke.paint_symbol["icon-color-brightness-max"])}))},JP);class iT extends _a{constructor(n,s,u,h){super(n,eR(),s,u,h),this._colorAdjustmentMatrix=a.ae.identity([]),this.hasInitialOcclusionOpacityProperties=n.paint!==void 0&&("icon-occlusion-opacity"in n.paint||"text-occlusion-opacity"in n.paint)}recalculate(n,s){super.recalculate(n,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const h=[];for(const p of u)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(n,s,u,h){return this._saturation===n&&this._contrast===s&&this._brightnessMin===u&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(p,m,v,w){p=ct(p),m=Me(m);const E=a.ae.create(),A=p/3,P=1-2*A,M=[P,A,A,0,A,P,A,0,A,A,P,0,0,0,0,1],z=.5-.5*m,B=w-v;return a.ae.multiply(E,[B,0,0,0,0,B,0,0,0,0,B,0,v,v,v,1],[m,0,0,0,0,m,0,0,0,0,m,0,z,z,z,1]),a.ae.multiply(E,E,M),E}(n,s,u,h),this._saturation=n,this._contrast=s,this._brightnessMin=u,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(n,s,u,h){const p=this.layout.get(n).evaluate(s,{},u,h),m=this._unevaluatedLayout._values[n];return m.isDataDriven()||ve(m.value)||!p?p:function(v,w){return w.replace(/{([^{}]+)}/g,(E,A)=>A in v?String(v[A]):"")}(s.properties,p)}createBucket(n){return new l_(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of eR().paint.overridableProperties){if(!iT.hasPaintOverride(this.layout,n))continue;const s=this.paint.get(n),u=new g5(s),h=new ye(u,s.property.specification,this.scope,this.options);let p=null;p=s.value.kind==="constant"||s.value.kind==="source"?new Re("source",h):new Se("composite",h,s.value.zoomStops,s.value._interpolationType),this.paint._values[n]=new Bs(s.property,p,s.parameters)}}_handleOverridablePaintPropertyUpdate(n,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven())&&iT.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,s){const u=n.get("text-field"),h=eR().paint.properties[s];let p=!1;const m=v=>{for(const w of v)if(h.overrides&&h.overrides.hasOverride(w))return void(p=!0)};if(u.value.kind==="constant"&&u.value.value instanceof vo)m(u.value.value.sections);else if(u.value.kind==="source"){const v=E=>{p||(E instanceof Ja&&fs(E.value)===bd?m(E.value.sections):E instanceof ch?m(E.sections):E.eachChild(v))},w=u.value;w._styleExpression&&v(w._styleExpression.expression)}return p}getProgramIds(){const n=this.paint.get("icon-opacity").constantOr(1)!==0,s=this.paint.get("text-opacity").constantOr(1)!==0,u=[];return n&&u.push("symbolIcon"),s&&u.push("symbolSDF"),u}getDefaultProgramParams(n,s,u){return{config:new zp(this,{zoom:s,lut:u}),overrideFog:!1}}}let _5,y5,v5,x5;function sT(i,n,s,u,h,p,m,v){const w=[i,n,1,s,u,1,h,p,1],E=[m,v,1],A=a.bE.adjoint([],w),[P,M,z]=a.$.transformMat3(E,E,A);return a.bE.multiply(w,w,[P,0,0,0,M,0,0,0,z])}function b5(i,n,s,u,h,p,m,v){const w=function(E,A,P,M,z,B,U,$){const Y=sT(0,0,1,0,1,1,0,1),fe=sT(E,A,P,M,z,B,U,$),he=a.bE.adjoint([],Y);return a.bE.multiply(fe,fe,he)}(i,n,s,u,h,p,m,v);return[w[2]/w[8]/Mt,w[5]/w[8]/Mt]}function oT(i){return[i[0],Math.min(Math.max(i[1],-Wi),Wi)]}class w5 extends ah{constructor(n,s,u,h){super(),this.id=n,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=s,this._dirty=!1}load(n,s){if(this._loaded=s||!1,this.fire(new Al("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=lp(this.map._requestManager.transformRequest(this.url,op.Image),(u,h)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new dp(u)):h&&(this.image=h instanceof HTMLImageElement?rn.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new eT(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Al("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(n){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof eT||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=n[0][1],u=n[0][1];for(const p of n)p[1]>u&&(u=p[1]),p[1]<s&&(s=p[1]);const h=(u+s)/2;if(h>Wi?this.onNorthPole=!0:h<-Wi&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=n.map(bo.fromLngLat);this.tileID=function(m){let v=1/0,w=1/0,E=-1/0,A=-1/0;for(const U of m)v=Math.min(v,U.x),w=Math.min(w,U.y),E=Math.max(E,U.x),A=Math.max(A,U.y);const P=Math.max(E-v,A-w),M=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),z=Math.pow(2,M);let B=Math.floor((v+E)/2*z);return B>1&&(B-=1),new Fp(M,B,Math.floor((w+A)/2*z))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Al("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(const $ in this.tiles){const Y=this.tiles[$];Y.state!=="loaded"&&(Y.state="loaded",Y.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const s=Vp(new Fp(0,0,0),this.map.transform.projection),u=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function($){const Y=$[1].x-$[0].x,fe=$[1].y-$[0].y,he=$[2].x-$[1].x,me=$[2].y-$[1].y,Ae=$[3].x-$[2].x,Ce=$[3].y-$[2].y,Le=$[0].x-$[3].x,Ve=$[0].y-$[3].y,He=Y*me-he*fe,et=he*Ce-Ae*me,Ze=Ae*Ve-Le*Ce,st=Le*fe-Y*Ve;return He>0&&et>0&&Ze>0&&st>0||He<0&&et<0&&Ze<0&&st<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=Vp(this.tileID,this.map.transform.projection),[p,m,v,w]=this.coordinates.map($=>{const Y=h.projection.project($[0],$[1]);return HF(h,Y)._round()});this.perspectiveTransform=b5(p.x,p.y,m.x,m.y,v.x,v.y,w.x,w.y);const E=this._boundsArray=new mh;E.emplaceBack(p.x,p.y,0,0),E.emplaceBack(m.x,m.y,Mt,0),E.emplaceBack(w.x,w.y,0,Mt),E.emplaceBack(v.x,v.y,Mt,Mt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(E,nT.members),this.boundsSegments=wi.simpleSegment(0,0,4,2);const A=[],P=function($){return[oT($[0]),oT($[1]),oT($[2]),oT($[3])]}(this.coordinates),[M,z,B,U]=function($){let Y=$[0][0],fe=Y,he=$[0][1],me=he;for(let Ae=1;Ae<$.length;Ae++)$[Ae][0]<Y?Y=$[Ae][0]:$[Ae][0]>fe&&(fe=$[Ae][0]),$[Ae][1]<he?he=$[Ae][1]:$[Ae][1]>me&&(me=$[Ae][1]);return[Y,he,fe-Y,me-he]}(P);{const $=new mh,[Y,fe,he,me]=function(rt){let dt=rt[0].x,It=dt,at=rt[0].y,Ot=at;for(let Et=1;Et<rt.length;Et++)rt[Et].x<dt?dt=rt[Et].x:rt[Et].x>It&&(It=rt[Et].x),rt[Et].y<at?at=rt[Et].y:rt[Et].y>Ot&&(Ot=rt[Et].y);return[dt,at,It-dt,Ot-at]}(u),Ae=rt=>[(rt.x-Y)/he,(rt.y-fe)/me],[Ce,Le,Ve,He]=u.map(Ae),et=function(rt,dt,It,at,Ot,Et,vt,vn){const dn=sT(0,0,1,0,1,1,0,1),Yt=sT(rt,dt,It,at,Ot,Et,vt,vn),kt=a.bE.adjoint([],Yt);return a.bE.multiply(dn,dn,kt)}(Ce[0],Ce[1],Le[0],Le[1],Ve[0],Ve[1],He[0],He[1]);this.elevatedGlobePerspectiveTransform=b5(Ce[0],Ce[1],Le[0],Le[1],Ve[0],Ve[1],He[0],He[1]);const Ze=(rt,dt)=>{A.push(rt.lng);const It=Math.round((rt.lng-M)/B*Mt),at=Math.round((rt.lat-z)/U*Mt),Ot=Ae(dt),Et=a.$.transformMat3([],[Ot[0],Ot[1],1],et),vt=Math.round(Et[0]/Et[2]*Mt),vn=Math.round(Et[1]/Et[2]*Mt);$.emplaceBack(It,at,vt,vn)},st=u[3].x-u[0].x,yt=u[3].y-u[0].y,ot=u[2].x-u[1].x,bt=u[2].y-u[1].y;for(let rt=0;rt<65;rt++){const dt=rt/64,It=[u[0].x+dt*st,u[0].y+dt*yt],at=[u[1].x+dt*ot,u[1].y+dt*bt],Ot=at[0]-It[0],Et=at[1]-It[1];for(let vt=0;vt<65;vt++){const vn=vt/64,dn={x:It[0]+Ot*vn,y:It[1]+Et*vn,z:0};Ze(s.projection.unproject(dn.x,dn.y),dn)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer($,nT.members)}{this.maxLongitudeTriangleSize=0;let $=[],Y=new js;const fe=(he,me,Ae)=>{Y.emplaceBack(he,me,Ae);const Ce=A[he],Le=A[me],Ve=A[Ae],He=Math.min(Math.min(Ce,Le),Ve),et=Math.max(Math.max(Ce,Le),Ve)-He;et>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=et),$.push(He+et/2)};for(let he=0;he<64;he++)for(let me=0;me<64;me++){const Ae=65*he+me,Ce=Ae+1,Le=Ae+65,Ve=Le+1;fe(Ae,Le,Ce),fe(Ce,Le,Ve)}[$,Y]=function(he,me){const Ae=Array.from({length:he.length},(Ve,He)=>He);Ae.sort((Ve,He)=>he[Ve]-he[He]);const Ce=[],Le=new js;for(let Ve=0;Ve<Ae.length;Ve++){const He=Ae[Ve];Ce.push(he[He]);const et=3*He,Ze=et+1;Le.emplaceBack(me.uint16[et],me.uint16[Ze],me.uint16[Ze+1])}return[Ce,Le]}($,Y),this.elevatedGlobeTrianglesCenterLongitudes=$,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(Y)}this.elevatedGlobeSegments=wi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,B/Mt,0,U/Mt,0,0,z,M,0])}prepare(){const n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;const s=this.map.painter.context,u=s.gl;!this._dirty||this.texture instanceof eT||(this.texture?this.texture.update(this.image):(this.texture=new kl(s,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(s)}loadTile(n,s){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},s(null)):(n.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){const s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let h=(p=n+180)+360*Math.round((u[0]-p)/360);var p;const m=new wi,v=(P,M)=>{m.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:s.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},w=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-h)<=w){const P=ue(u,0,u.length,h+w);return P===u.length||v(P,H(u,P+1,u.length,h+360-w)-P),m}h<u[0]&&(h+=360);const E=H(u,0,u.length,h-w);if(E===u.length)return v(0,u.length),m;v(0,E-0);const A=ue(u,E+1,u.length,h+w);return A!==u.length&&v(A,u.length-A),m}}const wJ=(Math.pow(256,2)-1)/16907520;class T5 extends _a{constructor(n,s,u,h){super(n,{layout:v5||(v5=new Zr({visibility:new xt(Ke.layout_raster.visibility)})),paint:x5||(x5=new Zr({"raster-opacity":new xt(Ke.paint_raster["raster-opacity"]),"raster-color":new xo(Ke.paint_raster["raster-color"]),"raster-color-mix":new xt(Ke.paint_raster["raster-color-mix"]),"raster-color-range":new xt(Ke.paint_raster["raster-color-range"]),"raster-hue-rotate":new xt(Ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new xt(Ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new xt(Ke.paint_raster["raster-brightness-max"]),"raster-saturation":new xt(Ke.paint_raster["raster-saturation"]),"raster-contrast":new xt(Ke.paint_raster["raster-contrast"]),"raster-resampling":new xt(Ke.paint_raster["raster-resampling"]),"raster-fade-duration":new xt(Ke.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new xt(Ke.paint_raster["raster-emissive-strength"]),"raster-array-band":new xt(Ke.paint_raster["raster-array-band"]),"raster-elevation":new xt(Ke.paint_raster["raster-elevation"])}))},s,u,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(n){return!(n&&n._source instanceof w5&&(n._source.onNorthPole||n._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(n){n!=="raster-color"&&n!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(n){if(!this.hasColorMap()||!this._curRampRange)return;const s=this._transitionablePaint._values["raster-color"].value.expression,[u,h]=n||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(h)||u===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=H0({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,h])}}let E5,S5,I5,A5,C5;class P5 extends _a{constructor(n,s,u,h){super(n,{layout:E5||(E5=new Zr({visibility:new xt(Ke["layout_raster-particle"].visibility)})),paint:S5||(S5=new Zr({"raster-particle-array-band":new xt(Ke["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new xt(Ke["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new xo(Ke["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new xt(Ke["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new xt(Ke["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new xt(Ke["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new xt(Ke["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new xt(Ke["paint_raster-particle"]["raster-particle-elevation"])}))},s,u,h),this._updateColorRamp(),this.lastInvalidatedAt=rn.now()}onRemove(n){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(n){return!1}_handleSpecialPaintPropertyUpdate(n){n!=="raster-particle-color"&&n!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),n==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=H0({expression:n,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=rn.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class TJ extends _a{constructor(n,s){super(n,{},s,null),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}function tR(i,n,s){const u=[0,0,1],h=a.aw.identity([]);return a.aw.rotateY(h,h,s?-sr(i)+Math.PI:sr(i)),a.aw.rotateX(h,h,-sr(n)),a.$.transformQuat(u,u,h),a.$.normalize(u,u)}function R5(i,n){const s=aT(i.projection,i.zoom,i.width,i.height),u=function(p,m,v,w,E){const A=new Sr(v.lng-180*Wd,v.lat),P=new Sr(v.lng+180*Wd,v.lat),M=p.project(A.lng,A.lat),z=p.project(P.lng,P.lat),B=-Math.atan2(z.y-M.y,z.x-M.x),U=bo.fromLngLat(v);U.y=Kn(U.y,-1+Wd,1-Wd);const $=U.toLngLat(),Y=p.project($.lng,$.lat),fe=bo.fromLngLat($);fe.x+=Wd;const he=fe.toLngLat(),me=p.project(he.lng,he.lat),Ae=D5(me.x-Y.x,me.y-Y.y,B),Ce=bo.fromLngLat($);Ce.y+=Wd;const Le=Ce.toLngLat(),Ve=p.project(Le.lng,Le.lat),He=D5(Ve.x-Y.x,Ve.y-Y.y,B),et=Math.abs(Ae.x)/Math.abs(He.y),Ze=a.ae.identity([]);a.ae.rotateZ(Ze,Ze,-B*(1-(E?0:w)));const st=a.ae.identity([]);return a.ae.scale(st,st,[1,1-(1-et)*w,1]),st[4]=-He.x/He.y*w,a.ae.rotateZ(st,st,B),a.ae.multiply(st,Ze,st),st}(i.projection,0,i.center,s,n),h=M5(i);return a.ae.scale(u,u,[h,h,1]),u}function M5(i){const n=i.projection,s=aT(i.projection,i.zoom,i.width,i.height),u=k5(n,i.center),h=k5(n,Sr.convert(n.center));return Math.pow(2,u*s+(1-s)*h)}function aT(i,n,s,u,h=1/0){const p=i.range;if(!p)return 0;const m=Math.min(h,Math.max(s,u)),v=Math.log(m/1024)/Math.LN2;return aa(p[0]+v,p[1]+v,n)}const Wd=1/4e4;function k5(i,n){const s=Kn(n.lat,-Wi,Wi),u=new Sr(n.lng-180*Wd,s),h=new Sr(n.lng+180*Wd,s),p=i.project(u.lng,s),m=i.project(h.lng,s),v=bo.fromLngLat(u),w=bo.fromLngLat(h),E=m.x-p.x,A=m.y-p.y,P=w.x-v.x,M=w.y-v.y,z=Math.sqrt((P*P+M*M)/(E*E+A*A));return Math.log(z)/Math.LN2}function D5(i,n,s){const u=Math.cos(s),h=Math.sin(s);return{x:i*u-n*h,y:i*h+n*u}}function O5(i,n,s){a.ae.identity(i),a.ae.rotateZ(i,i,sr(n[2])),a.ae.rotateX(i,i,sr(n[0])),a.ae.rotateY(i,i,sr(n[1])),a.ae.scale(i,i,s),a.ae.multiply(i,i,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function lT(i,n,s,u,h,p,m,v){const w=[s[0]-n[0],s[1]-n[1],0],E=[u[0]-n[0],u[1]-n[1],0];if(a.$.length(w)<1e-12||a.$.length(E)<1e-12)return a.aw.identity(i);const A=a.$.cross([],w,E);a.$.normalize(A,A),a.$.subtract(E,u,n),w[2]=(p-h)*v,E[2]=(m-h)*v;const P=w;return a.$.cross(P,w,E),a.$.normalize(P,P),a.aw.rotationTo(i,A,P)}function nR(i,n,s=!1){const u=bh(n.zoom),h=function(p,m,v){const w=m.worldSize,E=[p[12],p[13],p[14]],A=Xs(E[1]/w),P=ya(E[0]/w),M=a.ae.identity([]),z=Ho(1,A)*w,B=Ho(1,0)*w*Bp(A,m.zoom),U=1/xP(w);let $=B*U;if(v){const me=aT(m.projection,m.zoom,m.width,m.height,1024);$=U*m.projection.pixelSpaceConversion(m.center.lat,w,me)}const Y=Np(A,P);a.$.add(Y,Y,a.$.scale([],a.$.normalize([],Y),z*$*E[2]));const fe=function(me){const Ae=[me[0],me[1],me[2]];let Ce=[0,1,0];const Le=a.$.cross([],Ce,Ae);return a.$.cross(Ce,Ae,Le),a.$.squaredLength(Ce)===0&&(Ce=[0,1,0],a.$.cross(Le,Ae,Ce)),a.$.normalize(Le,Le),a.$.normalize(Ce,Ce),a.$.normalize(Ae,Ae),[Le[0],Le[1],Le[2],0,Ce[0],Ce[1],Ce[2],0,Ae[0],Ae[1],Ae[2],0,me[0],me[1],me[2],1]}(Y);a.ae.scale(M,M,[$,$,$*z]),a.ae.translate(M,M,[-E[0],-E[1],-E[2]]);const he=a.ae.multiply([],m.globeMatrix,fe);return a.ae.multiply(he,he,M),a.ae.multiply(he,he,p),he}(i,n,s);if(u>0){const p=function(m,v){const w=v.worldSize,E=Ho(1,0)*w*Bp(v.center.lat,v.zoom)/xP(w),A=Ho(1,v.center.lat)*w,P=a.ae.identity([]);return a.ae.rotateY(P,P,sr(v.center.lng)),a.ae.rotateX(P,P,sr(v.center.lat)),a.ae.translate(P,P,[0,0,Wo]),a.ae.scale(P,P,[E,E,E*A]),a.ae.translate(P,P,[v.point.x-.5*w,v.point.y-.5*w,0]),a.ae.multiply(P,P,m),a.ae.multiply(P,v.globeMatrix,P)}(i,n);return function(m,v,w){const E=(B,U,$)=>{const Y=a.$.length(B),fe=a.$.length(U),he=xh(B,U,$);return a.$.scale(he,he,1/a.$.length(he)*En(Y,fe,$))},A=E([m[0],m[1],m[2]],[v[0],v[1],v[2]],w),P=E([m[4],m[5],m[6]],[v[4],v[5],v[6]],w),M=E([m[8],m[9],m[10]],[v[8],v[9],v[10]],w),z=xh([m[12],m[13],m[14]],[v[12],v[13],v[14]],w);return[A[0],A[1],A[2],0,P[0],P[1],P[2],0,M[0],M[1],M[2],0,z[0],z[1],z[2],1]}(h,p,u)}return h}function L5(i,n,s,u){const h=mi.projectAabbCorners(u,s);let p=Number.MAX_VALUE,m=-1;for(let E=0;E<h.length;++E){const A=h[E];A[0]=(.5*A[0]+.5)*n.width,A[1]=(.5-.5*A[1])*n.height,A[2]<p&&(m=E,p=A[2])}const v=E=>new Dt(h[E][0],h[E][1]);let w;switch(m){case 0:case 6:w=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:w=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:w=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:w=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if(uP(i,w))return p}const EJ=Lr([{name:"a_pos_3f",components:3,type:"Float32"}]),SJ=Lr([{name:"a_color_3f",components:3,type:"Float32"}]),IJ=Lr([{name:"a_color_4f",components:4,type:"Float32"}]),AJ=Lr([{name:"a_uv_2f",components:2,type:"Float32"}]),CJ=Lr([{name:"a_normal_3f",components:3,type:"Float32"}]),PJ=Lr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),RJ=Lr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class cT{constructor(n,s,u,h){this.message=(n?`${n}: `:"")+u,h&&(this.identifier=h),s!=null&&s.__line__&&(this.line=s.__line__)}}function z5(i,n){const s=i.indexOf("://")===-1;try{return new URL(i,s&&n?"http://example.com":void 0),!0}catch{return!1}}class N5{constructor(n,s){this.feature=n,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class F5{constructor(){this.instancedDataArray=new HC,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class rR{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=n.projection,this.index=n.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(n,s){}populate(n,s,u,h){this.tileToMeter=yw(u);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:v,index:w,sourceLayerIndex:E}of n){const A=v??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),P=vh(m,p);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),P,u))continue;const M={id:A,sourceLayerIndex:E,index:w,geometry:p?P.geometry:wc(m,u,h),properties:m.properties,type:m.type,patterns:{}},z=this.addFeature(M,M.geometry,P);z&&s.featureIndex.insert(m,M.geometry,w,E,this.index,this.instancesPerModel[z].instancedDataArray.length,Mt/32)}this.lookup=null}update(n,s,u,h){for(const p in this.instancesPerModel){const m=this.instancesPerModel[p];for(const v in n)m.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(m.features[m.idToFeaturesIndex[v]],n[v],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];for(const h of u.features){const p=this.layers[0],m=h.feature,v=this.canonical,w=p.paint.get("model-rotation").evaluate(m,{},v),E=p.paint.get("model-scale").evaluate(m,{},v),A=p.paint.get("model-translation").evaluate(m,{},v);a.$.exactEquals(h.rotation,w)&&a.$.exactEquals(h.scale,E)&&a.$.exactEquals(h.translation,A)||(this.evaluate(h,h.featureStates,u,!0),n=!0)}}return n}updateReplacement(n,s,u,h){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const p=s.getReplacementRegionsForTile(n.toUnwrapped(),!0);if(RP(this.activeReplacements,p))return!1;this.activeReplacements=p;let m=!1;for(const v in this.instancesPerModel){const w=this.instancesPerModel[v],E=w.instancedDataArray;for(const A of w.features){const P=A.instancedDataOffset,M=A.instancedDataCount;for(let z=0;z<M;z++){const B=16*(z+P);let U=E.float32[B+0];U=U>Mt?U-Mt:U;const $=Math.floor(U),Y=E.float32[B+1];let fe=!1;for(const he of this.activeReplacements)if(!IN(he,u,jN.Model,h)&&!(he.min.x>$||$>he.max.x||he.min.y>Y||Y>he.max.y)&&(fe=kN(MN($,Y,n.canonical,he.footprintTileId.canonical),he),fe))break;E.float32[B]=fe?U+Mt:U,m=m||fe}}}return m}isEmpty(){for(const n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=n.createVertexBuffer(u.instancedDataArray,PJ.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(n&&this.modelUris)for(const s of this.modelUris)n.removeModel(s,"")}addFeature(n,s,u){const h=this.layers[0],p=h.layout.get("model-id").evaluate(u,{},this.canonical);if(!p)return Ii(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),p;z5(p,!1)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new F5);const m=this.instancesPerModel[p],v=m.instancedDataArray,w=new N5(u,v.length);for(const E of s)for(const A of E){if(A.x<0||A.x>=Mt||A.y<0||A.y>=Mt)continue;const P=(this.lookupDim-1)/Mt,M=this.lookupDim*(A.y*P|0)+A.x*P|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const z=v.length;v.resize(z+1),m.instancesEvaluatedElevation.push(0),v.float32[16*z]=A.x,v.float32[16*z+1]=A.y}return w.instancedDataCount=m.instancedDataArray.length-w.instancedDataOffset,w.instancedDataCount>0&&(n.id&&(m.idToFeaturesIndex[n.id]=m.features.length),m.features.push(w),this.evaluate(w,{},m,!1)),p}getModelUris(){return this.modelUris}evaluate(n,s,u,h){const p=this.layers[0],m=n.feature,v=this.canonical,w=n.rotation=p.paint.get("model-rotation").evaluate(m,s,v),E=n.scale=p.paint.get("model-scale").evaluate(m,s,v),A=n.translation=p.paint.get("model-translation").evaluate(m,s,v),P=p.paint.get("model-color").evaluate(m,s,v);P.a=p.paint.get("model-color-mix-intensity").evaluate(m,s,v);const M=[];this.maxVerticalOffset<A[2]&&(this.maxVerticalOffset=A[2]),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),O5(M,w,E);const z=Math.round(100*P.a)+P.b/1.05;for(let B=0;B<n.instancedDataCount;++B){const U=n.instancedDataOffset+B,$=16*U,Y=u.instancedDataArray.float32;let fe=0;h&&(fe=Y[$+6]-u.instancesEvaluatedElevation[U]);const he=0|Y[$+1];Y[$]=(0|Y[$])+P.r/1.05,Y[$+1]=he+P.g/1.05,Y[$+2]=z,Y[$+3]=1/(v.z>10?this.tileToMeter:yw(v,he)),Y[$+4]=A[0],Y[$+5]=A[1],Y[$+6]=A[2]+fe,Y[$+7]=M[0],Y[$+8]=M[1],Y[$+9]=M[2],Y[$+10]=M[4],Y[$+11]=M[5],Y[$+12]=M[6],Y[$+13]=M[8],Y[$+14]=M[9],Y[$+15]=M[10],u.instancesEvaluatedElevation[U]=A[2]}}}let B5,j5;Ue(rR,"ModelBucket",{omit:["layers"]}),Ue(F5,"PerModelAttributes"),Ue(N5,"ModelFeature");const qp=64,h_={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function U5(i,n,s,u,h,p,m,v,w,E=!1){const A=s.zoom,P=s.project(u),M=Bp(u.lat,A),z=1/M;a.ae.identity(i),a.ae.translate(i,i,[P.x+m[0]*z,P.y+m[1]*z,m[2]]);let B=1,U=1;const $=s.worldSize;if(E){if(s.projection.name==="mercator"){let me=0;s.elevation&&(me=s.elevation.getAtPointOrZero(new bo(P.x/$,P.y/$),0));const Ae=a.aB.transformMat4([],[P.x,P.y,me,1],s.projMatrix)[3]/s.cameraToCenterDistance;B=Ae,U=Ae*Bp(s.center.lat,A)}else if(s.projection.name==="globe"){const me=nR(i,s),Ae=a.ae.multiply([],s.projMatrix,me),Ce=[0,0,0,1];a.aB.transformMat4(Ce,Ce,Ae);const Le=Ce[3]/s.cameraToCenterDistance,Ve=bh(A),He=s.projection.pixelsPerMeter(u.lat,$)*Bp(u.lat,A),et=s.projection.pixelsPerMeter(s.center.lat,$)*Bp(s.center.lat,A);B=Le/En(He,Pz(s.center.lat),Ve),U=Le*M/He,B*=et,U*=et}}else B=z;a.ae.scale(i,i,[B,B,U]);const Y=[...i],fe=n.orientation,he=[];if(O5(he,[fe[0]+h[0],fe[1]+h[1],fe[2]+h[2]],p),a.ae.multiply(i,Y,he),v&&s.elevation){let me=0;const Ae=[];if(w&&s.elevation){me=function(Ve,He,et,Ze,st){const yt=He.elevation;if(!yt)return 0;const ot=mi.projectAabbCorners(et,Ze),bt=Ho(1,st.lat)*He.worldSize,rt=function(Mn,pn){const an=[0,0,1],Fn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const jn of Fn){const Bn=Mn[jn.corners[0]],Xn=Mn[jn.corners[1]],_r=Mn[jn.corners[2]],cr=[Xn[0]-Bn[0],Xn[1]-Bn[1],pn*(Xn[2]-Bn[2])],Wr=a.$.cross(cr,cr,[_r[0]-Bn[0],_r[1]-Bn[1],pn*(_r[2]-Bn[2])]);a.$.normalize(Wr,Wr),jn.dotProductWithUp=a.$.dot(Wr,an)}return Fn.sort((jn,Bn)=>jn.dotProductWithUp-Bn.dotProductWithUp),Fn[0].corners}(ot,bt),dt=ot[rt[0]],It=ot[rt[1]],at=ot[rt[2]],Ot=ot[rt[3]],Et=yt.getAtPointOrZero(new bo(dt[0]/He.worldSize,dt[1]/He.worldSize),0),vt=yt.getAtPointOrZero(new bo(It[0]/He.worldSize,It[1]/He.worldSize),0),vn=yt.getAtPointOrZero(new bo(at[0]/He.worldSize,at[1]/He.worldSize),0),dn=yt.getAtPointOrZero(new bo(Ot[0]/He.worldSize,Ot[1]/He.worldSize),0),Yt=(Et+dn)/2,kt=(vt+vn)/2;return Yt>kt?vt<vn?lT(Ve,It,Ot,dt,vt,dn,Et,bt):lT(Ve,at,dt,Ot,vn,Et,dn,bt):Et<dn?lT(Ve,dt,It,at,Et,vt,vn,bt):lT(Ve,Ot,at,It,dn,vn,vt,bt),Math.max(Yt,kt)}(Ae,s,n.aabb,i,u);const Ce=a.ae.fromQuat([],Ae),Le=a.ae.multiply([],Ce,he);a.ae.multiply(i,Y,Le)}else me=s.elevation.getAtPointOrZero(new bo(P.x/$,P.y/$),0);me!==0&&(i[14]+=me)}}function yv(i,n,s=!1){i.uploaded||(i.gfxTexture=new kl(n,i.image,s?n.gl.R8:n.gl.RGBA,{useMipmap:i.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),i.uploaded=!0,i.image=null)}function MJ(i,n,s){i.indexBuffer=n.createIndexBuffer(i.indexArray,!1,!0),i.vertexBuffer=n.createVertexBuffer(i.vertexArray,EJ.members,!1,!0),i.normalArray&&(i.normalBuffer=n.createVertexBuffer(i.normalArray,CJ.members,!1,!0)),i.texcoordArray&&(i.texcoordBuffer=n.createVertexBuffer(i.texcoordArray,AJ.members,!1,!0)),i.colorArray&&(i.colorBuffer=n.createVertexBuffer(i.colorArray,(i.colorArray.bytesPerElement===12?SJ:IJ).members,!1,!0)),i.featureArray&&(i.pbrBuffer=n.createVertexBuffer(i.featureArray,RJ.members,!0)),i.segments=wi.simpleSegment(0,0,i.vertexArray.length,i.indexArray.length);const u=i.material;u.pbrMetallicRoughness.baseColorTexture&&yv(u.pbrMetallicRoughness.baseColorTexture,n),u.pbrMetallicRoughness.metallicRoughnessTexture&&yv(u.pbrMetallicRoughness.metallicRoughnessTexture,n),u.normalTexture&&yv(u.normalTexture,n),u.occlusionTexture&&yv(u.occlusionTexture,n,s),u.emissionTexture&&yv(u.emissionTexture,n)}function iR(i,n,s){if(i.meshes)for(const u of i.meshes)MJ(u,n,s);if(i.children)for(const u of i.children)iR(u,n,s)}function uT(i){if(i.meshes)for(const n of i.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(i.children)for(const n of i.children)uT(n)}function sR(i){if(i.meshes)for(const s of i.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((n=s.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(i.children)for(const s of i.children)sR(s)}class kJ{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class DJ{constructor(){this.tasks={},this.taskQueue=[],nh(["process"],this),this.invoker=new kJ(this.process),this.nextId=0}add(n,s){const u=this.nextId++,h=function({type:p,isSymbolTile:m,zoom:v}){return v=v||0,p==="message"?0:p!=="maybePrepare"||m?p!=="parseTile"||m?p==="parseTile"&&m?300-v:p==="maybePrepare"&&m?400-v:500:200-v:100-v}(s);if(h===0){try{n()}finally{}return null}return this.tasks[u]={fn:n,metadata:s,priority:h,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const s=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let n=null,s=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<s&&(s=p.priority,n=h)}if(n===null)return null;const u=this.taskQueue[n];return this.taskQueue.splice(n,1),u}remove(){this.invoker.remove()}}class V5{constructor(n,s,u){this.target=n,this.parent=s,this.mapId=u,this.callbacks={},this.cancelCallbacks={},nh(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new DJ}send(n,s,u,h,p=!1,m){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=m,this.callbacks[v]=u);const w=new Set;return this.target.postMessage({id:v,type:n,hasCallback:!!u,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:We(s,w)},w),{cancel:()=>{u&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(n){const s=n.data,u=s.id;if(u&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){const h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h.cancel()}else if(s.mustQueue||$o()){const h=this.callbacks[u],p=this.scheduler.add(()=>this.processTask(u,s),h&&h.metadata||{type:"message"});p&&(this.cancelCallbacks[u]=p)}else this.processTask(u,s)}processTask(n,s){if(delete this.cancelCallbacks[n],s.type==="<response>"){const u=this.callbacks[n];delete this.callbacks[n],u&&(s.error?u(nt(s.error)):u(null,nt(s.data)))}else{const u=new Set,h=s.hasCallback?(m,v)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:m?We(m):null,data:We(v,u)},u)}:m=>{},p=nt(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,p,h);else if(this.parent.getWorkerSource){const m=s.type.split(".");this.parent.getWorkerSource(s.sourceMapId,m[0],p.source,p.scope)[m[1]](p,h)}else h(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class d_{constructor(n,s){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=lc();const u=this.workerPool.acquire(this.id);for(let h=0;h<u.length;h++){const p=new d_.Actor(u[h],s,this.id);p.name=`Worker ${h}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,s,u){th(this.actors,(h,p)=>{h.send(n,s,p)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}d_.Actor=V5;var vv={workerUrl:"",workerClass:null,workerParams:void 0};function OJ(){return vv.workerClass!=null?new vv.workerClass:new self.Worker(vv.workerUrl,vv.workerParams)}const oR="mapboxgl_preloaded_worker_pool";class xv{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<xv.workerCount;)this.workers.push(new OJ);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[oR]}numActive(){return Object.keys(this.active).length}}let bv;function hT(){return bv||(bv=new xv),bv}xv.workerCount=2;let dT,aR,Cc,f_,lR,p_=null;function $5(){return $o()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:aR||O.DRACO_URL}function G5(){if($o()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(f_)return f_;const i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return f_=WebAssembly.validate(i)?O.MESHOPT_SIMD_URL:O.MESHOPT_URL,f_}const fT={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},LJ={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},wv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function q5(i,n,s){const u=s.json.bufferViews.length,h=s.buffers.length;n.bufferView=u,s.json.bufferViews[u]={buffer:h,byteLength:i.byteLength},s.buffers[h]=i}const cR="KHR_draco_mesh_compression";function zJ(i,n){const s=i.extensions&&i.extensions[cR];if(!s)return;const u=new Cc.Decoder,h=X5(n,s.bufferView),p=new Cc.Mesh;if(!u.DecodeArrayToMesh(h,h.byteLength,p))throw new Error("Failed to decode Draco mesh");const m=n.json.accessors[i.indices],v=fT[m.componentType],w=m.count*v.BYTES_PER_ELEMENT,E=Cc._malloc(w);v===Uint16Array?u.GetTrianglesUInt16Array(p,w,E):u.GetTrianglesUInt32Array(p,w,E),q5(Cc.memory.buffer.slice(E,E+w),m,n),Cc._free(E);for(const A of Object.keys(s.attributes)){const P=u.GetAttributeByUniqueId(p,s.attributes[A]),M=n.json.accessors[i.attributes[A]],z=LJ[M.componentType],B=M.count*wv[M.type]*fT[M.componentType].BYTES_PER_ELEMENT,U=Cc._malloc(B);u.GetAttributeDataArrayForAllPoints(p,P,Cc[z],B,U),q5(Cc.memory.buffer.slice(U,U+B),M,n),Cc._free(U)}u.destroy(),p.destroy(),delete i.extensions[cR]}const pT="EXT_meshopt_compression";function NJ(i,n){if(!i.extensions||!i.extensions[pT])return;const s=i.extensions[pT],u=new Uint8Array(n.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),h=new Uint8Array(s.count*s.byteStride);lR.decodeGltfBuffer(h,s.count,s.byteStride,u,s.mode,s.filter),i.buffer=n.buffers.length,i.byteOffset=0,n.buffers[i.buffer]=h.buffer,delete i.extensions[pT]}const W5=1179937895,H5=new TextDecoder("utf8");function Z5(i,n){return new URL(i,n).href}function FJ(i,n,s,u){return fetch(Z5(i.uri,u)).then(h=>h.arrayBuffer()).then(h=>{n.buffers[s]=h})}function X5(i,n){const s=i.json.bufferViews[n];return new Uint8Array(i.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function BJ(i,n,s,u){if(i.uri){const h=Z5(i.uri,u);return fetch(h).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{n.images[s]=p})}if(i.bufferView!==void 0){const h=X5(n,i.bufferView),p=new Blob([h],{type:i.mimeType});return createImageBitmap(p).then(m=>{n.images[s]=m})}}function K5(i,n=0,s){const u={json:null,images:[],buffers:[]};if(new Uint32Array(i,n,1)[0]===W5){const A=new Uint32Array(i,n);let P=2;const M=(A[P++]>>2)-3,z=A[P++]>>2;if(P++,u.json=JSON.parse(H5.decode(A.subarray(P,P+z))),P+=z,P<M){const B=A[P++];P++;const U=n+(P<<2);u.buffers[0]=i.slice(U,U+B)}}else u.json=JSON.parse(H5.decode(new Uint8Array(i,n)));const{buffers:h,images:p,meshes:m,extensionsUsed:v,bufferViews:w}=u.json;let E=Promise.resolve();if(h){const A=[];for(let P=0;P<h.length;P++){const M=h[P];M.uri?A.push(FJ(M,u,P,s)):u.buffers[P]||(u.buffers[P]=null)}E=Promise.all(A)}return E.then(()=>{const A=[],P=v&&v.includes(cR),M=v&&v.includes(pT);if(P&&A.push(function(){if(!Cc)return dT||(dT=function(z){let B,U=null;function $(){B=new Uint8Array(U.buffer)}function Y(){throw new Error("Unexpected Draco error.")}const fe={a:{a:Y,d:function(he,me,Ae){return B.copyWithin(he,me,me+Ae)},c:function(he){const me=B.length,Ae=Math.max(he>>>0,Math.ceil(1.2*me)),Ce=Math.ceil((Ae-me)/65536);try{return U.grow(Ce),$(),!0}catch{return!1}},b:Y}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(z,fe):z.then(he=>he.arrayBuffer()).then(he=>WebAssembly.instantiate(he,fe))).then(he=>{const{Rb:me,Qb:Ae,P:Ce,T:Le,X:Ve,Ja:He,La:et,Qa:Ze,Va:st,Wa:yt,eb:ot,jb:bt,f:rt,e:dt,yb:It,zb:at,Ab:Ot,Bb:Et,Db:vt,Gb:vn}=he.instance.exports;U=dt;const dn=(()=>{let Yt=0,kt=0,Mn=0,pn=0;return an=>{Mn&&(me(pn),me(Yt),kt+=Mn,Mn=Yt=0),Yt||(kt+=128,Yt=Ae(kt));const Fn=an.length+7&-8;let jn=Yt;Fn>=kt&&(Mn=Fn,jn=pn=Ae(Fn));for(let Bn=0;Bn<an.length;Bn++)B[jn+Bn]=an[Bn];return jn}})();return $(),rt(),{memory:dt,_free:me,_malloc:Ae,Mesh:class{constructor(){this.ptr=Ce()}destroy(){Le(this.ptr)}},Decoder:class{constructor(){this.ptr=He()}destroy(){bt(this.ptr)}DecodeArrayToMesh(Yt,kt,Mn){const pn=dn(Yt),an=et(this.ptr,pn,kt,Mn.ptr);return!!Ve(an)}GetAttributeByUniqueId(Yt,kt){return{ptr:Ze(this.ptr,Yt.ptr,kt)}}GetTrianglesUInt16Array(Yt,kt,Mn){st(this.ptr,Yt.ptr,kt,Mn)}GetTrianglesUInt32Array(Yt,kt,Mn){yt(this.ptr,Yt.ptr,kt,Mn)}GetAttributeDataArrayForAllPoints(Yt,kt,Mn,pn,an){ot(this.ptr,Yt.ptr,kt.ptr,Mn,pn,an)}},DT_INT8:It(),DT_UINT8:at(),DT_INT16:Ot(),DT_UINT16:Et(),DT_UINT32:vt(),DT_FLOAT32:vn()}})}(fetch($5())),dT.then(z=>{Cc=z,dT=void 0}))}()),M&&A.push(function(){if(lR)return;const z=function(B){let U;const $=WebAssembly.instantiateStreaming(B,{}).then(he=>{U=he.instance,U.exports.__wasm_call_ctors()}),Y={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},fe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:$,supported:!0,decodeGltfBuffer(he,me,Ae,Ce,Le,Ve){(function(He,et,Ze,st,yt,ot,bt){const rt=He.exports.sbrk,dt=st+3&-4,It=rt(dt*yt),at=rt(ot.length),Ot=new Uint8Array(He.exports.memory.buffer);Ot.set(ot,at);const Et=et(It,st,yt,at,ot.length);if(Et===0&&bt&&bt(It,dt,yt),Ze.set(Ot.subarray(It,It+st*yt)),rt(It-rt(0)),Et!==0)throw new Error(`Malformed buffer data: ${Et}`)})(U,U.exports[fe[Le]],he,me,Ae,Ce,U.exports[Y[Ve]])}}}(fetch(G5()));return z.ready.then(()=>{lR=z})}()),p)for(let z=0;z<p.length;z++)A.push(BJ(p[z],u,z,s));return(A.length?Promise.all(A):Promise.resolve()).then(()=>{if(P&&m)for(const{primitives:z}of m)for(const B of z)zJ(B,u);if(M&&m&&w)for(const z of w)NJ(z,u);return u})})}function Wp(i,n){const s=i.json.bufferViews[n.bufferView],u=fT[n.componentType];return new u(i.buffers[s.buffer],(n.byteOffset||0)+(s.byteOffset||0),n.count*(s.byteStride&&s.byteStride!==wv[n.type]*u.BYTES_PER_ELEMENT?s.byteStride/u.BYTES_PER_ELEMENT:wv[n.type]))}function uR(i,n,s,u){const h=fT[n.componentType],p=function(A){switch(A){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),m=i.json.bufferViews[n.bufferView],v=m.byteStride?m.byteStride/h.BYTES_PER_ELEMENT:wv[n.type],w=s.float32,E=w.length/s.capacity;for(let A=0,P=0;A<n.count*v;A+=v,P+=E)for(let M=0;M<E;M++)w[P+M]=u[A+M]*p;s._trim()}function jJ(i,n,s){const u=i.indices,h=i.attributes,p={};p.indexArray=new js;const m=n.json.accessors[u],v=m.count/3;p.indexArray.reserve(v);const w=Wp(n,m);for(let M=0;M<v;M++)p.indexArray.emplaceBack(w[3*M],w[3*M+1],w[3*M+2]);p.indexArray._trim(),p.vertexArray=new Md;const E=n.json.accessors[h.POSITION];p.vertexArray.reserve(E.count);const A=Wp(n,E);for(let M=0;M<E.count;M++)p.vertexArray.emplaceBack(A[3*M],A[3*M+1],A[3*M+2]);if(p.vertexArray._trim(),p.aabb=new mi(E.min,E.max),p.centroid=function(M,z){const B=[0,0,0],U=M.length;if(U>0){for(let $=0;$<U;$++){const Y=3*M[$];B[0]+=z[Y],B[1]+=z[Y+1],B[2]+=z[Y+2]}B[0]/=U,B[1]/=U,B[2]/=U}return B}(w,A),h.COLOR_0!==void 0){const M=n.json.accessors[h.COLOR_0],z=wv[M.type],B=Wp(n,M);p.colorArray=z===3?new Md:new Rd,p.colorArray.resize(M.count),uR(n,M,p.colorArray,B)}if(h.NORMAL!==void 0){p.normalArray=new Md;const M=n.json.accessors[h.NORMAL];p.normalArray.resize(M.count);const z=Wp(n,M);uR(n,M,p.normalArray,z)}if(h.TEXCOORD_0!==void 0&&s.length>0){p.texcoordArray=new B0;const M=n.json.accessors[h.TEXCOORD_0];p.texcoordArray.resize(M.count);const z=Wp(n,M);uR(n,M,p.texcoordArray,z)}if(h._FEATURE_ID_RGBA4444!==void 0){const M=n.json.accessors[h._FEATURE_ID_RGBA4444];n.json.extensionsUsed&&n.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=Wp(n,M))}h._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(Wp(n,n.json.accessors[h._FEATURE_RGBA4444]).buffer));const P=i.material;return p.material=function(M,z){const{emissiveFactor:B=[0,0,0],alphaMode:U="OPAQUE",alphaCutoff:$=.5,normalTexture:Y,occlusionTexture:fe,emissiveTexture:he,doubleSided:me}=M,{baseColorFactor:Ae=[1,1,1,1],metallicFactor:Ce=1,roughnessFactor:Le=1,baseColorTexture:Ve,metallicRoughnessTexture:He}=M.pbrMetallicRoughness||{},et=fe?z[fe.index]:void 0;if(fe&&fe.extensions&&fe.extensions.KHR_texture_transform&&et){const Ze=fe.extensions.KHR_texture_transform;et.offsetScale=[Ze.offset[0],Ze.offset[1],Ze.scale[0],Ze.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ar(...Ae),metallicFactor:Ce,roughnessFactor:Le,baseColorTexture:Ve?z[Ve.index]:void 0,metallicRoughnessTexture:He?z[He.index]:void 0},doubleSided:me,emissiveFactor:B,alphaMode:U,alphaCutoff:$,normalTexture:Y?z[Y.index]:void 0,occlusionTexture:et,emissionTexture:he?z[he.index]:void 0,defined:M.defined===void 0}}(P!==void 0?n.json.materials[P]:{defined:!1},s),p}function Y5(i,n,s){const{matrix:u,rotation:h,translation:p,scale:m,mesh:v,extras:w,children:E}=i,A={};if(A.matrix=u||a.ae.fromRotationTranslationScale([],h||[0,0,0,1],p||[0,0,0],m||[1,1,1]),v!==void 0){A.meshes=s[v];const P=A.anchor=[0,0];for(const M of A.meshes){const{min:z,max:B}=M.aabb;P[0]+=z[0]+B[0],P[1]+=z[1]+B[1]}P[0]=Math.floor(P[0]/A.meshes.length/2),P[1]=Math.floor(P[1]/A.meshes.length/2)}if(w&&(w.id&&(A.id=w.id),w.lights&&(A.lights=function(P){if(!P.length)return[];const M=function(Y){const fe=atob(Y),he=new Uint8Array(fe.length);for(let me=0;me<fe.length;me++)he[me]=fe.codePointAt(me);return he}(P),z=[],B=M.length/24,U=new Uint16Array(M.buffer),$=new Float32Array(M.buffer);for(let Y=0;Y<B;Y++){const fe=U[2*Y*6]/30,he=U[2*Y*6+1]/30,me=U[2*Y*6+10]/100,Ae=$[6*Y+1],Ce=$[6*Y+2],Le=$[6*Y+3],Ve=$[6*Y+4],He=Le-Ae,et=Ve-Ce,Ze=Math.hypot(He,et);z.push({pos:[Ae+.5*He,Ce+.5*et,he],normal:[et/Ze,-He/Ze,0],width:Ze,height:fe,depth:me,points:[Ae,Ce,Le,Ve]})}return z}(w.lights))),E){const P=[];for(const M of E)P.push(Y5(n.json.nodes[M],n,s));A.children=P}return A}function UJ(i){if(i.vertices.length===0||i.indices.length===0)return null;const n=new AP(i.vertices,i.indices,8,256),[s,u]=[n.min.clone(),n.max.clone()];return{vertices:i.vertices,indices:i.indices,grid:n,min:s,max:u}}function VJ(i){if(!i.extras||!i.extras.ground)return null;const n=i.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;const s=n[0];if(!s||!Array.isArray(s)||s.length===0)return null;const u=[];for(const m of s){if(!Array.isArray(m)||m.length!==2)continue;const v=m[0],w=m[1];typeof v=="number"&&typeof w=="number"&&u.push(new Dt(v,w))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let h=0;for(let m=0;m<u.length;m++){const v=u[m],w=u[(m+1)%u.length],E=u[(m+2)%u.length];h+=(v.x-w.x)*(E.y-w.y)-(E.x-w.x)*(v.y-w.y)}h>0&&u.reverse();const p=Z0(u.flatMap(m=>[m.x,m.y]),[]);return p.length===0?null:{vertices:u,indices:p}}function $J(i,n){const s=[],u=[];let h=0;const p=[];for(const m of i){h=s.length;const v=m.vertexArray.float32,w=m.indexArray.uint16;for(let E=0;E<m.vertexArray.length;E++)p[0]=v[3*E+0],p[1]=v[3*E+1],p[2]=v[3*E+2],a.$.transformMat4(p,p,n),s.push(new Dt(p[0],p[1]));for(let E=0;E<3*m.indexArray.length;E++)u.push(w[E]+h)}if(u.length%3!=0)return null;for(let m=0;m<u.length;m+=3){const v=s[u[m+0]],w=s[u[m+1]],E=s[u[m+2]];(v.x-w.x)*(E.y-w.y)-(E.x-w.x)*(v.y-w.y)>0&&([u[m+1],u[m+2]]=[u[m+2],u[m+1]])}return{vertices:s,indices:u}}function Q5(i){const n=function(w,E){const A=[],P=WebGL2RenderingContext;if(w.json.textures)for(const M of w.json.textures){const z={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};M.sampler!==void 0&&Object.assign(z,w.json.samplers[M.sampler]),A.push({image:E[M.source],sampler:z,uploaded:!1})}return A}(i,i.images),s=function(w,E){const A=[];for(const P of w.json.meshes){const M=[];for(const z of P.primitives)M.push(jJ(z,w,E));A.push(M)}return A}(i,n),{scenes:u,scene:h,nodes:p}=i.json,m=u?u[h||0].nodes:p,v=[];for(const w of m)v.push(Y5(p[w],i,s));return function(w,E,A){const P={},M=new Set;for(let z=0;z<w.length;z++){const B=A[E[z]];if(!B.extras)continue;const U=B.extras["mapbox:footprint:version"],$=B.extras["mapbox:footprint:id"];(U||$)&&M.add(z),U==="1.0.0"&&$&&(P[$]=z)}for(let z=0;z<w.length;z++){if(M.has(z))continue;const B=w[z],U=A[E[z]];if(!U.extras)continue;let $=null;B.id in P&&($=$J(w[P[B.id]].meshes,B.matrix)),$||($=VJ(U)),$&&(B.footprint=UJ($))}if(M.size>0){const z=Array.from(M.values()).sort((B,U)=>B-U);for(let B=z.length-1;B>=0;B--)w.splice(z[B],1)}}(v,m,i.json.nodes),v}function GJ(i){i.heightmap=new Float32Array(4096),i.heightmap.fill(-1);const n=i.vertexArray.float32,s=i.aabb.min[0]-1,u=i.aabb.min[1]-1,h=qp/(i.aabb.max[0]-s+2),p=qp/(i.aabb.max[1]-u+2);for(let m=0;m<n.length;m+=3){const v=n[m+2],w=(n[m+0]-s)*h|0,E=(n[m+1]-u)*p|0;v>i.heightmap[E*qp+w]&&(i.heightmap[E*qp+w]=v)}}function qJ(i,n){const s={};s.indexArray=new js,s.indexArray.reserve(4*i.length),s.vertexArray=new Md,s.vertexArray.reserve(10*i.length),s.colorArray=new Rd,s.vertexArray.reserve(10*i.length);let u=0;for(const m of i){const v=Math.min(10,Math.max(4,1.3*m.height))*n,w=[-m.normal[1],m.normal[0],0],E=Math.min(.29,.1*m.width/m.depth),A=m.width-2*m.depth*n*(E+.01),P=a.$.scaleAndAdd([],m.pos,w,A/2),M=a.$.scaleAndAdd([],m.pos,w,-A/2),z=[P[0],P[1],P[2]+m.height],B=[M[0],M[1],M[2]+m.height],U=a.$.scaleAndAdd([],m.normal,w,E);a.$.scale(U,U,v);const $=a.$.scaleAndAdd([],m.normal,w,-E);a.$.scale($,$,v),a.$.add(U,P,U),a.$.add($,M,$),P[2]+=.1,M[2]+=.1,s.vertexArray.emplaceBack(U[0],U[1],U[2]),s.vertexArray.emplaceBack($[0],$[1],$[2]),s.vertexArray.emplaceBack(P[0],P[1],P[2]),s.vertexArray.emplaceBack(M[0],M[1],M[2]),s.vertexArray.emplaceBack(z[0],z[1],z[2]),s.vertexArray.emplaceBack(B[0],B[1],B[2]),s.vertexArray.emplaceBack(P[0],P[1],P[2]),s.vertexArray.emplaceBack(M[0],M[1],M[2]),s.vertexArray.emplaceBack(U[0],U[1],U[2]),s.vertexArray.emplaceBack($[0],$[1],$[2]);const Y=A/v/2;s.colorArray.emplaceBack(-Y-E,-1,Y,.8),s.colorArray.emplaceBack(Y+E,-1,Y,.8),s.colorArray.emplaceBack(-Y,0,Y,1.3),s.colorArray.emplaceBack(Y,0,Y,1.3),s.colorArray.emplaceBack(Y+E,-.8,Y,.7),s.colorArray.emplaceBack(Y+E,-.8,Y,.7),s.colorArray.emplaceBack(0,0,Y,1.3),s.colorArray.emplaceBack(0,0,Y,1.3),s.colorArray.emplaceBack(Y+E,-1.2,Y,.8),s.colorArray.emplaceBack(Y+E,-1.2,Y,.8),s.indexArray.emplaceBack(6+u,4+u,8+u),s.indexArray.emplaceBack(7+u,9+u,5+u),s.indexArray.emplaceBack(0+u,1+u,2+u),s.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const h={defined:!0,emissiveFactor:[0,0,0]},p={};return p.baseColorFactor=Ar.white,h.pbrMetallicRoughness=p,s.material=h,s.aabb=new mi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}const hR=new Float32Array(262144),Hp=new Uint8Array(262144);function J5(i){let n=0;if(i.meshes)for(const s of i.meshes)n=Math.max(n,s.aabb.max[2]);if(i.children)for(const s of i.children)n=Math.max(n,J5(s));return n}function eB(i,n,s){if(i.meshes)for(const u of i.meshes)u.aabb.min[0]!==1/0&&s.insert(n,u.aabb.min[0],u.aabb.min[1],u.aabb.max[0],u.aabb.max[1]);if(i.children)for(const u of i.children)eB(u,n,s)}const tB=["","wall","door","roof","window","lamp","logo"];class nB{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:n.id,geometry:[],properties:{height:J5(n)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new mi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let n=0;const s=new mi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==n&&(u.transformedAabb=mi.applyTransformFast(u.aabb,this.node.matrix),s.encapsulate(u.transformedAabb)),n++;this.aabb=s}return this.aabb}}class mT{constructor(n,s,u,h,p,m){this.id=s,this.modelTraits|=h_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=h_.HasMapboxMeshFeatures),h&&(this.modelTraits|=h_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const v of n)this.nodesInfo.push(new nB(v)),eB(v,m.featureIndexArray.length,m.grid),m.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,m.bucketLayerIDs.length-1,0)}updateFootprints(n,s){for(const u of this.getNodesInfo()){const h=u.node;h.footprint&&s.push({footprint:h.footprint,id:n})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;const s=this.getNodesInfo();for(const u of s){const h=u.node;this.uploaded?this.updatePbrBuffer(h):iR(h,n,!0)}for(const u of s)uT(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let s=!1;if(!n.meshes)return s;for(const u of n.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),s=!0);return s}needsReEvaluation(n,s,u){const h=n.transform.projectionOptions,p=n.style.getBrightness(),m=this.brightness!==p;return!!(!this.uploaded||this.dirty||h.name!==this.projection.name||Tv(u.paint.get("model-color").value,m)||Tv(u.paint.get("model-color-mix-intensity").value,m)||Tv(u.paint.get("model-roughness").value,m)||Tv(u.paint.get("model-emissive-strength").value,m)||Tv(u.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=h,this.brightness=p,!0)}evaluateScale(n,s){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;const u=this.getNodesInfo(),h=this.id.canonical;for(const p of u){const m=p.feature;p.evaluatedScale=s.paint.get("model-scale").evaluate(m,{},h)}}evaluate(n){const s=this.getNodesInfo();for(const u of s){if(!u.node.meshes)continue;const h=u.feature,p=u.node.meshes&&u.node.meshes[0].featureData,m=u.evaluatedColor[2],v=u.evaluatedRMEA[2],w=this.id.canonical;if(u.hasTranslucentParts=!1,p){for(let E=0;E<tB.length;E++){const A=tB[E];A.length&&(h.properties.part=A);const P=n.paint.get("model-color").evaluate(h,{},w).toRenderColor(null),M=n.paint.get("model-color-mix-intensity").evaluate(h,{},w);u.evaluatedColor[E]=[P.r,P.g,P.b,M],u.evaluatedRMEA[E][0]=n.paint.get("model-roughness").evaluate(h,{},w),u.evaluatedRMEA[E][2]=n.paint.get("model-emissive-strength").evaluate(h,{},w),u.evaluatedRMEA[E][3]=P.a,u.emissionHeightBasedParams[E]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,{},w),!u.hasTranslucentParts&&P.a<1&&(u.hasTranslucentParts=!0)}delete h.properties.part,HJ(u,m!==u.evaluatedColor[2]||v!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(h,{},w);u.evaluatedScale=n.paint.get("model-scale").evaluate(h,{},w),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,s,u,h){const p=n.findDEMTileFor(u);if(p&&(p.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const m=e_.create(n,u,p);if(!m)return;this.modelTraits&h_.HasMapboxMeshFeatures&&this.updateDEM(n,m,u,h);for(const v of this.getNodesInfo()){const w=v.node;if(!w.footprint||!w.footprint.vertices||!w.footprint.vertices.length)continue;const E=w.footprint.vertices;let A=m.getElevationAt(E[0].x,E[0].y,!0,!0);for(let P=1;P<E.length;P++)A=Math.min(A,m.getElevationAt(E[P].x,E[P].y,!0,!0));w.elevation=A}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=s}}updateDEM(n,s,u,h){let p=s._dem._modifiedForSources[h];if(p===void 0&&(s._dem._modifiedForSources[h]=[],p=s._dem._modifiedForSources[h]),p.includes(u.canonical))return;const m=s._dem.dim;p.push(u.canonical);let v=!1;for(const w of this.getNodesInfo()){const E=w.node;if(!E.footprint||!E.footprint.grid)continue;const A=E.footprint.grid,P=s.tileCoordToPixel(A.min.x,A.min.y),M=s.tileCoordToPixel(A.max.x,A.max.y),z=Math.min(Math.min(m-M.y,P.x),Math.min(P.y,m-M.x));if(z<0)continue;const B=Kn(z,2,5);let U=Math.max(0,P.x-B),$=Math.max(0,P.y-B),Y=Math.min(M.x+B,m-1),fe=Math.min(M.y+B,m-1);for(let Ce=$;Ce<=fe;++Ce)for(let Le=U;Le<=Y;++Le)Hp[Ce*m+Le]=255;let he=0,me=0;for(let Ce=0;Ce<A.cellsY;++Ce)for(let Le=0;Le<A.cellsX;++Le){if(!A.cells[Ce*A.cellsX+Le])continue;const Ve=s.tileCoordToPixel(A.min.x+Le/A.xScale,A.min.y+Ce/A.yScale),He=s.tileCoordToPixel(A.min.x+(Le+1)/A.xScale,A.min.y+(Ce+1)/A.yScale);for(let et=Ve.y;et<=Math.min(He.y+1,m-1);++et)for(let Ze=Ve.x;Ze<=Math.min(He.x+1,m-1);++Ze)Hp[et*m+Ze]===255&&(Hp[et*m+Ze]=0,he+=s.getElevationAtPixel(Ze,et),me++)}const Ae=he/me;U=Math.max(1,P.x-B),$=Math.max(1,P.y-B),Y=Math.min(M.x+B,m-2),fe=Math.min(M.y+B,m-2),v=!0;for(let Ce=$;Ce<=fe;++Ce)for(let Le=U;Le<=Y;++Le)Hp[Ce*m+Le]===0&&(hR[Ce*m+Le]=s._dem.set(Le,Ce,Ae));for(let Ce=1;Ce<B;++Ce){U=Math.max(1,P.x-Ce),$=Math.max(1,P.y-Ce),Y=Math.min(M.x+Ce,m-2),fe=Math.min(M.y+Ce,m-2);for(let Le=$;Le<=fe;++Le)for(let Ve=U;Ve<=Y;++Ve){const He=Le*m+Ve;if(Hp[He]===255){let et=0,Ze=0,st=-1,yt=-1;for(let ot=-1;ot<=1;++ot)for(let bt=-1;bt<=1;++bt){const rt=(Le+ot)*m+Ve+bt;if(Hp[rt]>=Ce)continue;const dt=hR[rt],It=Math.abs(dt);It>Ze&&(et=dt,Ze=It,st=bt,yt=ot)}if(Ze>.1){const ot=1-(Ce+.5*Math.abs(st*yt))/B;let bt=s._dem.get(Ve,Le)+et*ot;const rt=s._dem.get(Ve+st,Le+yt),dt=s._dem.get(Ve-st,Le-yt,!0);(bt-rt)*(bt-dt)>0&&(bt=(rt+dt)/2),hR[He]=s._dem.set(Ve,Le,bt),Hp[He]=Ce}}}}}v&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=rn.now())}getNodesInfo(){return this.nodesInfo}destroy(){const n=this.getNodesInfo();for(const s of n)uT(s.node),sR(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(n,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const u=s.getReplacementRegionsForTile(n.toUnwrapped()),h=this.getNodesInfo();for(let p=0;p<this.nodesInfo.length;p++){const m=h[p].node;h[p].hiddenByReplacement=!!m.footprint&&!u.find(v=>v.footprint===m.footprint)}}getHeightAtTileCoord(n,s){const u=this.getNodesInfo(),h=[],p=[0,0,0],m=a.ae.identity([]);for(let v=0;v<this.nodesInfo.length;v++){const w=u[v],E=w.node.meshes[0],A=E.transformedAabb;if(n<A.min[0]||s<A.min[1]||n>A.max[0]||s>A.max[1])continue;if(w.node.hidden===!0)return{height:0,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};a.ae.invert(m,w.node.matrix),p[0]=n,p[1]=s,a.$.transformMat4(p,p,m);const P=(p[0]-E.aabb.min[0])/(E.aabb.max[0]-E.aabb.min[0])*qp|0,M=Math.min(63,(p[1]-E.aabb.min[1])/(E.aabb.max[1]-E.aabb.min[1])*qp|0)*qp+Math.min(63,P),z=E.heightmap[M];if(!(z<0&&w.node.footprint))return w.hiddenByReplacement?void 0:{height:z,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};if(w.node.footprint.grid.query(new Dt(n,s),new Dt(n,s),h),h.length>0)return{height:void 0,maxHeight:w.feature.properties.height,hidden:w.hiddenByReplacement,verticalScale:w.evaluatedScale[2]}}}}function Tv(i,n){return!i.isLightConstant&&n}function WJ(i,n,s,u,h,p,m,v){let w=(61440&n|(61440&n)>>4)>>8,E=(3840&n|(3840&n)>>4)>>4,A=240&n|(240&n)>>4;s[3]>0&&(w=En(w,255*s[0],s[3]),E=En(E,255*s[1],s[3]),A=En(A,255*s[2],s[3]));const P=w<<8|E,M=A<<8|Math.floor(255*u[3]),z=function(Ce){const Le=Kn(Ce,0,2);return Math.min(Math.round(.5*Le*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],B=Kn(h[0],0,1),U=Kn(h[1],0,1),$=Kn(h[2],0,1),Y=Kn(h[3],0,1);let fe,he,me,Ae;if(B!==U&&m!==p&&U!==B){const Ce=m-p;he=1/(Ce*(U-B)),me=-(p+Ce*B)/(Ce*(U-B));const Le=Kn(h[4],-1,1);Ae=Math.pow(10,Le),fe=255*$<<8|255*Y}else fe=65535,he=0,me=1,Ae=1;if(i.emplaceBack(P,M,z,fe,he,me,Ae),v){const Ce=v.length;v.clear();for(let Le=0;Le<Ce;Le++)v.emplaceBack(P,M,z,fe,he,me,Ae)}}function HJ(i,n,s){const u=i.node;let h=0;const p=s&h_.HasMeshoptCompression;for(const m of u.meshes){if(u.lights&&u.lightMeshIndex===h||!m.featureData)continue;m.featureArray=new mw,m.featureArray.reserve(m.featureData.length);let v=n;for(const w of m.featureData){const E=p?65535&w:w>>16&65535,A=p?w>>16&65535:65535&w,P=(15&A)<8?15&A:0,M=i.evaluatedRMEA[P],z=i.evaluatedColor[P],B=i.emissionHeightBasedParams[P];let U;if(v&&P===2&&u.lights&&(U=new mw,U.resize(10*u.lights.length)),WJ(m.featureArray,E,z,M,B,m.aabb.min[2],m.aabb.max[2],U),U&&v){v=!1;const $=u.meshes[u.lightMeshIndex];$.featureArray=U,$.featureArray._trim()}}m.featureArray._trim(),h++}}function rB(i,n,s,u){const h=1<<i.z;n.lat=Xs((u/Mt+i.y)/h),n.lng=ya((s/Mt+i.x)/h)}Ue(mT,"Tiled3dModelBucket",{omit:["layers"]}),Ue(nB,"Tiled3dModelFeature");const ZJ={circle:class extends _a{constructor(i,n,s,u){super(i,{layout:Bz||(Bz=new Zr({"circle-sort-key":new ln(Ke.layout_circle["circle-sort-key"]),visibility:new xt(Ke.layout_circle.visibility)})),paint:jz||(jz=new Zr({"circle-radius":new ln(Ke.paint_circle["circle-radius"]),"circle-color":new ln(Ke.paint_circle["circle-color"]),"circle-blur":new ln(Ke.paint_circle["circle-blur"]),"circle-opacity":new ln(Ke.paint_circle["circle-opacity"]),"circle-translate":new xt(Ke.paint_circle["circle-translate"]),"circle-translate-anchor":new xt(Ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new xt(Ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new xt(Ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ln(Ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ln(Ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ln(Ke.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new xt(Ke.paint_circle["circle-emissive-strength"])}))},n,s,u)}createBucket(i){return new cP(i)}queryRadius(i){const n=i;return Yg("circle-radius",this,n)+Yg("circle-stroke-width",this,n)+bw(this.paint.get("circle-translate"))}queryIntersectsFeature(i,n,s,u,h,p,m,v){const w=Fz(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(n,s)+this.paint.get("circle-stroke-width").evaluate(n,s);return tN(i,u,p,m,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(i,n,s){const u=eN(this);return{config:new zp(this,{zoom:n,lut:s}),defines:u,overrideFog:!1}}},heatmap:class extends _a{createBucket(i){return new rN(i)}constructor(i,n,s,u){super(i,{layout:aN||(aN=new Zr({visibility:new xt(Ke.layout_heatmap.visibility)})),paint:lN||(lN=new Zr({"heatmap-radius":new ln(Ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ln(Ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new xt(Ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xo(Ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new xt(Ke.paint_heatmap["heatmap-opacity"])}))},n,s,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=H0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Yg("heatmap-radius",this,i)}queryIntersectsFeature(i,n,s,u,h,p,m,v){const w=this.paint.get("heatmap-radius").evaluate(n,s);return tN(i,u,p,m,v,!0,!0,new Dt(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(i,n,s){return i==="heatmap"?{config:new zp(this,{zoom:n,lut:s}),overrideFog:!1}:{}}},hillshade:class extends _a{constructor(i,n,s,u){super(i,{layout:cN||(cN=new Zr({visibility:new xt(Ke.layout_hillshade.visibility)})),paint:uN||(uN=new Zr({"hillshade-illumination-direction":new xt(Ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new xt(Ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new xt(Ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new xt(Ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new xt(Ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new xt(Ke.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new xt(Ke.paint_hillshade["hillshade-emissive-strength"])}))},n,s,u)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(i,n,s){return{overrideFog:!1}}},fill:class extends _a{constructor(i,n,s,u){super(i,{layout:mN||(mN=new Zr({"fill-sort-key":new ln(Ke.layout_fill["fill-sort-key"]),visibility:new xt(Ke.layout_fill.visibility)})),paint:gN||(gN=new Zr({"fill-antialias":new xt(Ke.paint_fill["fill-antialias"]),"fill-opacity":new ln(Ke.paint_fill["fill-opacity"]),"fill-color":new ln(Ke.paint_fill["fill-color"]),"fill-outline-color":new ln(Ke.paint_fill["fill-outline-color"]),"fill-translate":new xt(Ke.paint_fill["fill-translate"]),"fill-translate-anchor":new xt(Ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new ln(Ke.paint_fill["fill-pattern"]),"fill-emissive-strength":new xt(Ke.paint_fill["fill-emissive-strength"])}))},n,s,u)}getProgramIds(){const i=this.paint.get("fill-pattern"),n=i&&i.constantOr(1),s=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(i,n,s){return{config:new zp(this,{zoom:n,lut:s}),overrideFog:!1}}recalculate(i,n){super.recalculate(i,n);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Rw(i)}queryRadius(){return bw(this.paint.get("fill-translate"))}queryIntersectsFeature(i,n,s,u,h,p){return!i.queryGeometry.isAboveHorizon&&Dz(Nz(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends _a{constructor(i,n,s,u){super(i,{layout:eF||(eF=new Zr({visibility:new xt(Ke["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new xt(Ke["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:tF||(tF=new Zr({"fill-extrusion-opacity":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ln(Ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ln(Ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ln(Ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ln(Ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ln(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ln(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new ln(Ke["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-line-alignment":new xt(Ke["paint_fill-extrusion"]["fill-extrusion-line-alignment"])}))},n,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new Fw(i)}queryRadius(){return bw(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(i,n,s,u,h,p,m,v,w){const E=Fz(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(n,s),P=this.paint.get("fill-extrusion-base").evaluate(n,s),M=[0,0],z=v&&p.elevation,B=p.elevation?p.elevation.exaggeration():1,U=i.tile.getBucket(this);if(z&&U instanceof Fw){const me=U.centroidVertexArray,Ae=w+1;Ae<me.length&&(M[0]=me.geta_centroid_pos0(Ae),M[1]=me.geta_centroid_pos1(Ae))}if(M[0]===0&&M[1]===1)return!1;p.projection.name==="globe"&&(u=JN([u],[new Dt(0,0),new Dt(Mt,Mt)],i.tileID.canonical).map(me=>me.polygon).flat());const $=z?v:null,[Y,fe]=function(me,Ae,Ce,Le,Ve,He,et,Ze,st,yt,ot){return me.projection.name==="globe"?function(bt,rt,dt,It,at,Ot,Et,vt,vn,dn,Yt){const kt=[],Mn=[],pn=bt.projection.upVectorScale(Yt,bt.center.lat,bt.worldSize).metersToTile,an=[0,0,0,1],Fn=[0,0,0,1],jn=(Xn,_r,cr,Wr)=>{Xn[0]=_r,Xn[1]=cr,Xn[2]=Wr,Xn[3]=1},Bn=QN();dt>0&&(dt+=Bn),It+=Bn;for(const Xn of rt){const _r=[],cr=[];for(const Wr of Xn){const Xr=Wr.x+at.x,Un=Wr.y+at.y,zr=bt.projection.projectTilePoint(Xr,Un,Yt),Br=bt.projection.upVector(Yt,Wr.x,Wr.y);let oi=dt,Fi=It;if(Et){const Qi=rF(Xr,Un,dt,It,Et,vt,vn,dn);oi+=Qi.base,Fi+=Qi.top}dt!==0?jn(an,zr.x+Br[0]*pn*oi,zr.y+Br[1]*pn*oi,zr.z+Br[2]*pn*oi):jn(an,zr.x,zr.y,zr.z),jn(Fn,zr.x+Br[0]*pn*Fi,zr.y+Br[1]*pn*Fi,zr.z+Br[2]*pn*Fi),a.$.transformMat4(an,an,Ot),a.$.transformMat4(Fn,Fn,Ot),_r.push(new Up(an[0],an[1],an[2])),cr.push(new Up(Fn[0],Fn[1],Fn[2]))}kt.push(_r),Mn.push(cr)}return[kt,Mn]}(me,Ae,Ce,Le,Ve,He,et,Ze,st,yt,ot):et?function(bt,rt,dt,It,at,Ot,Et,vt,vn){const dn=[],Yt=[],kt=[0,0,0,1];for(const Mn of bt){const pn=[],an=[];for(const Fn of Mn){const jn=Fn.x+It.x,Bn=Fn.y+It.y,Xn=rF(jn,Bn,rt,dt,Ot,Et,vt,vn);kt[0]=jn,kt[1]=Bn,kt[2]=Xn.base,kt[3]=1,a.aB.transformMat4(kt,kt,at),kt[3]=Math.max(kt[3],1e-5);const _r=new Up(kt[0]/kt[3],kt[1]/kt[3],kt[2]/kt[3]);kt[0]=jn,kt[1]=Bn,kt[2]=Xn.top,kt[3]=1,a.aB.transformMat4(kt,kt,at),kt[3]=Math.max(kt[3],1e-5);const cr=new Up(kt[0]/kt[3],kt[1]/kt[3],kt[2]/kt[3]);pn.push(_r),an.push(cr)}dn.push(pn),Yt.push(an)}return[dn,Yt]}(Ae,Ce,Le,Ve,He,et,Ze,st,yt):function(bt,rt,dt,It,at){const Ot=[],Et=[],vt=at[8]*rt,vn=at[9]*rt,dn=at[10]*rt,Yt=at[11]*rt,kt=at[8]*dt,Mn=at[9]*dt,pn=at[10]*dt,an=at[11]*dt;for(const Fn of bt){const jn=[],Bn=[];for(const Xn of Fn){const _r=Xn.x+It.x,cr=Xn.y+It.y,Wr=at[0]*_r+at[4]*cr+at[12],Xr=at[1]*_r+at[5]*cr+at[13],Un=at[2]*_r+at[6]*cr+at[14],zr=at[3]*_r+at[7]*cr+at[15],Br=Wr+vt,oi=Xr+vn,Fi=Un+dn,Qi=Math.max(zr+Yt,1e-5),Bi=Wr+kt,Ai=Xr+Mn,Us=Un+pn,ps=Math.max(zr+an,1e-5);jn.push(new Up(Br/Qi,oi/Qi,Fi/Qi)),Bn.push(new Up(Bi/ps,Ai/ps,Us/ps))}Ot.push(jn),Et.push(Bn)}return[Ot,Et]}(Ae,Ce,Le,Ve,He)}(p,u,P,A,E,m,$,M,B,p.center.lat,i.tileID.canonical),he=i.queryGeometry;return function(me,Ae,Ce){let Le=1/0;Dz(Ce,Ae)&&(Le=nF(Ce,Ae[0]));for(let Ve=0;Ve<Ae.length;Ve++){const He=Ae[Ve],et=me[Ve];for(let Ze=0;Ze<He.length-1;Ze++){const st=He[Ze],yt=[st,He[Ze+1],et[Ze+1],et[Ze],st];uP(Ce,yt)&&(Le=Math.min(Le,nF(Ce,yt)))}}return Le!==1/0&&Le}(Y,fe,he.isPointQuery()?he.screenBounds:he.screenGeometry)}},line:class extends _a{constructor(i,n,s,u){const h=d5();super(i,h,n,s,u),h.layout&&(this.layout=new Zs(h.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof Id,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,n){super.recalculate(i,n),this.paint._values["line-floorwidth"]=(()=>{if(_v)return _v;const s=d5();return _v=new bJ(s.paint.properties["line-width"].specification),_v.useIntegerZoom=!0,_v})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Bw(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(i,n,s){const u=fF(this);return{config:new zp(this,{zoom:n,lut:s}),defines:u,overrideFog:!1}}queryRadius(i){const n=i,s=m5(Yg("line-width",this,n),Yg("line-gap-width",this,n)),u=Yg("line-offset",this,n);return s/2+Math.abs(u)+bw(this.paint.get("line-translate"))}queryIntersectsFeature(i,n,s,u,h,p){if(i.queryGeometry.isAboveHorizon)return!1;const m=Nz(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),v=i.pixelToTileUnitsFactor/2*m5(this.paint.get("line-width").evaluate(n,s),this.paint.get("line-gap-width").evaluate(n,s)),w=this.paint.get("line-offset").evaluate(n,s);return w&&(u=function(E,A){const P=[],M=new Dt(0,0);for(let z=0;z<E.length;z++){const B=E[z],U=[];for(let $=0;$<B.length;$++){const Y=B[$],fe=B[$+1],he=$===0?M:Y.sub(B[$-1])._unit()._perp(),me=$===B.length-1?M:fe.sub(Y)._unit()._perp(),Ae=he._add(me)._unit();Ae._mult(1/(Ae.x*me.x+Ae.y*me.y)),U.push(Ae._mult(A)._add(Y))}P.push(U)}return P}(u,w*i.pixelToTileUnitsFactor)),function(E,A,P){for(let M=0;M<A.length;M++){const z=A[M];if(E.length>=3){for(let B=0;B<z.length;B++)if(Nd(E,z[B]))return!0}if(HK(E,z,P))return!0}return!1}(m,u,v)}isTileClipped(){return!0}isDraped(i){const n=this.layout.get("line-z-offset");return n.isConstant()&&!n.constantOr(0)}},symbol:iT,background:class extends _a{constructor(i,n,s,u){super(i,{layout:_5||(_5=new Zr({visibility:new xt(Ke.layout_background.visibility)})),paint:y5||(y5=new Zr({"background-color":new xt(Ke.paint_background["background-color"]),"background-pattern":new xt(Ke.paint_background["background-pattern"]),"background-opacity":new xt(Ke.paint_background["background-opacity"]),"background-emissive-strength":new xt(Ke.paint_background["background-emissive-strength"])}))},n,s,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(i,n,s){return{overrideFog:!1}}},raster:T5,"raster-particle":P5,sky:class extends _a{constructor(i,n,s,u){super(i,{layout:I5||(I5=new Zr({visibility:new xt(Ke.layout_sky.visibility)})),paint:A5||(A5=new Zr({"sky-type":new xt(Ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new xt(Ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new xt(Ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new xt(Ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new xt(Ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new xo(Ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new xt(Ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new xt(Ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new xt(Ke.paint_sky["sky-opacity"])}))},n,s,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=H0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(i,n){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),h=!u,p=i.style.light,m=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&Ii("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?tR(m.azimuthal,90-m.polar,n):tR(u[0],90-u[1],n)}const s=this.paint.get("sky-gradient-center");return tR(s[0],90-s[1],n)}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}},slot:class extends _a{constructor(i,n,s,u){super(i,{paint:C5||(C5=new Zr({}))},n,null)}},model:class extends _a{constructor(i,n,s,u){super(i,{layout:B5||(B5=new Zr({visibility:new xt(Ke.layout_model.visibility),"model-id":new ln(Ke.layout_model["model-id"])})),paint:j5||(j5=new Zr({"model-opacity":new xt(Ke.paint_model["model-opacity"]),"model-rotation":new ln(Ke.paint_model["model-rotation"]),"model-scale":new ln(Ke.paint_model["model-scale"]),"model-translation":new ln(Ke.paint_model["model-translation"]),"model-color":new ln(Ke.paint_model["model-color"]),"model-color-mix-intensity":new ln(Ke.paint_model["model-color-mix-intensity"]),"model-type":new xt(Ke.paint_model["model-type"]),"model-cast-shadows":new xt(Ke.paint_model["model-cast-shadows"]),"model-receive-shadows":new xt(Ke.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new xt(Ke.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ln(Ke.paint_model["model-emissive-strength"]),"model-roughness":new ln(Ke.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ln(Ke.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new xt(Ke.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new xt(Ke.paint_model["model-front-cutoff"])}))},n,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new rR(i)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(i){return i instanceof mT?Mt-1:0}queryIntersectsFeature(i,n,s,u,h,p){if(!this.modelManager)return!1;const m=this.modelManager,v=i.tile.getBucket(this);if(!(v&&v instanceof rR))return!1;const w=v;for(const E in w.instancesPerModel){const A=w.instancesPerModel[E],P=n.id!==void 0?n.id:n.properties&&n.properties.hasOwnProperty("id")?n.properties.id:void 0;if(A.idToFeaturesIndex.hasOwnProperty(P)){const M=A.features[A.idToFeaturesIndex[P]],z=m.getModel(E,this.scope);if(!z)return!1;let B=a.ae.create();const U=new Sr(0,0),$=w.canonical;let Y=Number.MAX_VALUE;for(let fe=0;fe<M.instancedDataCount;++fe){const he=16*(M.instancedDataOffset+fe),me=A.instancedDataArray.float32,Ae=[me[he+4],me[he+5],me[he+6]];rB($,U,me[he],0|me[he+1]),U5(B,z,p,U,M.rotation,M.scale,Ae,!1,!1,!1),p.projection.name==="globe"&&(B=nR(B,p));const Ce=a.ae.multiply([],p.projMatrix,B),Le=i.queryGeometry,Ve=L5(Le.isPointQuery()?Le.screenBounds:Le.screenGeometry,p,Ce,z.aabb);Ve!=null&&(Y=Math.min(Ve,Y))}return Y!==Number.MAX_VALUE&&Y}}return!1}_handleOverridablePaintPropertyUpdate(i,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven()||i!=="model-color"&&i!=="model-color-mix-intensity"&&i!=="model-rotation"&&i!=="model-scale"&&i!=="model-translation"&&i!=="model-emissive-strength")}_isPropertyZoomDependent(i){const n=this._transitionablePaint._values[i];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof Se}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(i,n,s,u){const h=i.tile,p=h.getBucket(this);let m=null,v=Number.MAX_VALUE;if(!(p&&p instanceof mT))return{queryFeature:m,intersectionZ:v};const w=p.getNodesInfo()[n];if(w.hiddenByReplacement||!w.node.meshes||!s.filter(new kn(h.tileID.overscaledZ),w.feature,h.tileID.canonical))return{queryFeature:m,intersectionZ:v};const E=w.node,A=u.calculatePosMatrix(h.tileID.toUnwrapped(),u.worldSize),P=w.evaluatedScale;let M=0;u.elevation&&E.elevation&&(M=E.elevation*u.elevation.exaggeration()),a.ae.translate(A,A,[(E.anchor?E.anchor[0]:0)*(P[0]-1),(E.anchor?E.anchor[1]:0)*(P[1]-1),M]),a.ae.scale(A,A,P),a.ae.multiply(A,A,E.matrix);const z=i.queryGeometry,B=z.isPointQuery()?z.screenBounds:z.screenGeometry,U=function(Y){const fe=a.ae.multiply([],A,Y.matrix),he=a.ae.multiply(fe,u.expandedFarZProjMatrix,fe);for(let me=0;me<Y.meshes.length;++me){const Ae=Y.meshes[me];if(me===Y.lightMeshIndex)continue;const Ce=L5(B,u,he,Ae.aabb);Ce!=null&&(v=Math.min(Ce,v))}if(Y.children)for(const me of Y.children)U(me)};if(U(E),v===Number.MAX_VALUE)return{queryFeature:m,intersectionZ:v};const $=new Sr(0,0);return rB(h.tileID.canonical,$,w.node.anchor[0],w.node.anchor[1]),m={type:"Feature",geometry:{type:"Point",coordinates:[$.lng,$.lat]},properties:w.feature.properties,id:w.feature.id,state:{},layer:this.serialize()},{queryFeature:m,intersectionZ:v}}},clip:class extends _a{constructor(i,n,s,u){super(i,{layout:_N||(_N=new Zr({"clip-layer-types":new xt(Ke.layout_clip["clip-layer-types"]),"clip-layer-scope":new xt(Ke.layout_clip["clip-layer-scope"])})),paint:yN||(yN=new Zr({}))},n,s,u)}recalculate(i,n){super.recalculate(i,n)}createBucket(i){return new vN(i)}isTileClipped(){return!0}is3D(){return!0}}};Ue(c5,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const iB=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class dR{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,u]=new Uint8Array(n,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=u>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=iB[15&u];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(n,2,1),[v]=new Uint32Array(n,4,1);return new dR(v,m,p,n)}constructor(n,s=64,u=Float64Array,h){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=u,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const p=iB.indexOf(this.ArrayType),m=2*n*this.ArrayType.BYTES_PER_ELEMENT,v=n*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${u}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+v+w,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+m+v+w),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+v+w,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=n)}add(n,s){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=n,this.coords[this._pos++]=s,u}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return fR(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,s,u,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:v}=this,w=[0,p.length-1,0],E=[];for(;w.length;){const A=w.pop()||0,P=w.pop()||0,M=w.pop()||0;if(P-M<=v){for(let $=M;$<=P;$++){const Y=m[2*$],fe=m[2*$+1];Y>=n&&Y<=u&&fe>=s&&fe<=h&&E.push(p[$])}continue}const z=M+P>>1,B=m[2*z],U=m[2*z+1];B>=n&&B<=u&&U>=s&&U<=h&&E.push(p[z]),(A===0?n<=B:s<=U)&&(w.push(M),w.push(z-1),w.push(1-A)),(A===0?u>=B:h>=U)&&(w.push(z+1),w.push(P),w.push(1-A))}return E}within(n,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:m}=this,v=[0,h.length-1,0],w=[],E=u*u;for(;v.length;){const A=v.pop()||0,P=v.pop()||0,M=v.pop()||0;if(P-M<=m){for(let $=M;$<=P;$++)oB(p[2*$],p[2*$+1],n,s)<=E&&w.push(h[$]);continue}const z=M+P>>1,B=p[2*z],U=p[2*z+1];oB(B,U,n,s)<=E&&w.push(h[z]),(A===0?n-u<=B:s-u<=U)&&(v.push(M),v.push(z-1),v.push(1-A)),(A===0?n+u>=B:s+u>=U)&&(v.push(z+1),v.push(P),v.push(1-A))}return w}}function fR(i,n,s,u,h,p){if(h-u<=s)return;const m=u+h>>1;sB(i,n,m,u,h,p),fR(i,n,s,u,m-1,1-p),fR(i,n,s,m+1,h,1-p)}function sB(i,n,s,u,h,p){for(;h>u;){if(h-u>600){const E=h-u+1,A=s-u+1,P=Math.log(E),M=.5*Math.exp(2*P/3),z=.5*Math.sqrt(P*M*(E-M)/E)*(A-E/2<0?-1:1);sB(i,n,s,Math.max(u,Math.floor(s-A*M/E+z)),Math.min(h,Math.floor(s+(E-A)*M/E+z)),p)}const m=n[2*s+p];let v=u,w=h;for(Ev(i,n,u,s),n[2*h+p]>m&&Ev(i,n,u,h);v<w;){for(Ev(i,n,v,w),v++,w--;n[2*v+p]<m;)v++;for(;n[2*w+p]>m;)w--}n[2*u+p]===m?Ev(i,n,u,w):(w++,Ev(i,n,w,h)),w<=s&&(u=w+1),s<=w&&(h=w-1)}}function Ev(i,n,s,u){pR(i,s,u),pR(n,2*s,2*u),pR(n,2*s+1,2*u+1)}function pR(i,n,s){const u=i[n];i[n]=i[s],i[s]=u}function oB(i,n,s,u){const h=i-s,p=n-u;return h*h+p*p}a.A=kg,a.B=Ap,a.C=Ar,a.D=Sp,a.E=ah,a.F=Go,a.H=yc,a.I=$p,a.J=N,a.K=C,a.L=function(i){const n=i.value;let s=[];if(!n)return s;const u=su(n);return u!=="string"?(s=s.concat([new cT(i.key,n,`string expected, "${u}" found`)]),s):(z5(n,!0)||(s=s.concat([new cT(i.key,n,`invalid url "${n}"`)])),s)},a.M=class{constructor(i,n,s,u){this.id=i,this.position=n!=null?new Sr(n[0],n[1]):new Sr(0,0),this.orientation=s??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new mi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(i,n){if(a.ae.multiply(i.matrix,n,i.matrix),i.meshes)for(const s of i.meshes){const u=mi.applyTransformFast(s.aabb,i.matrix);this.aabb.encapsulate(u)}if(i.children)for(const s of i.children)this._applyTransformations(s,i.matrix)}computeBoundsAndApplyParent(){const i=a.ae.identity([]);for(const n of this.nodes)this._applyTransformations(n,i)}computeModelMatrix(i,n,s,u,h,p,m=!1){U5(this.matrix,this,i.transform,this.position,n,s,u,h,p,m)}upload(i){if(!this.uploaded){for(const n of this.nodes)iR(n,i);for(const n of this.nodes)uT(n);this.uploaded=!0}}destroy(){for(const i of this.nodes)sR(i)}},a.N=Ke,a.O=ao,a.P=Dt,a.Q=Rs,a.R=op,a.S=ZC,a.T=kl,a.U=Zr,a.V=cT,a.W=xt,a.X=class{constructor(i){this.specification=i}possiblyEvaluate(i,n){return uc(i.expression.evaluate(n))}interpolate(i,n,s){return{x:En(i.x,n.x,s),y:En(i.y,n.y,s),z:En(i.z,n.z,s),azimuthal:En(i.azimuthal,n.azimuthal,s),polar:En(i.polar,n.polar,s)}}},a.Y=kn,a.Z=Se,a._=bo,a.a=Ma,a.a$=mP,a.a0=aa,a.a1=Zs,a.a2=bh,a.a3=En,a.a4=Mt,a.a5=m0,a.a6=class{constructor(i){this.specification=i}possiblyEvaluate(i,n){return function([s,u]){const h=uc([1,s,u]);return{x:h.x,y:h.y,z:h.z}}(i.expression.evaluate(n))}interpolate(i,n,s){return{x:En(i.x,n.x,s),y:En(i.y,n.y,s),z:En(i.z,n.z,s)}}},a.a7=U0,a.a8=_w,a.a9=_h,a.aA=function(i,n,s){i[4*n+0]=s[0],i[4*n+1]=s[1],i[4*n+2]=s[2],i[4*n+3]=s[3]},a.aC=function(i,n){const{x:s,y:u}=i.point,h=Yz(s,u,i.worldSize/i._pixelsPerMercatorPixel,0,0);return a.ae.multiply(h,h,vP(fu(n)))},a.aE=r_,a.aF=nl,a.aG=Vw,a.aH=function(i,n,s,u,h){const p=5*n+2;i.float32[p+0]=s,i.float32[p+1]=u,i.float32[p+2]=h},a.aI=Jw,a.aJ=Sr,a.aK=QF,a.aL=Az,a.aM=gP,a.aN=M5,a.aO=Fp,a.aP=Zz,a.aQ=ws,a.aR=function(i,n,s,u,h,p,m,v,w){if(w.name==="globe")return Zz(i,n,new Fp(s,u,h),!1);const E=Vp({z:s,x:u,y:h},w);return new mi([(p+E.x/E.scale)*n,n*(E.y/E.scale),m],[(p+E.x2/E.scale)*n,n*(E.y2/E.scale),v])},a.aS=function(i,n,s){let u=0;for(let h=0;h<2;++h)i[h]>0&&(u+=(i[h]-0)*(i[h]-0)),n[h]<0&&(u+=(0-n[h])*(0-n[h]));return u},a.aT=Wi,a.aU=pP,a.aV=Sz,a.aW=function(i){const n=a.ae.identity(new Float64Array(16));a.ae.multiply(n,i.pixelMatrix,i.globeMatrix);const s=[0,Rl,0],u=[0,Ml,0];return a.$.transformMat4(s,s,n),a.$.transformMat4(u,u,n),[s[0]>0&&s[0]<=i.width&&s[1]>0&&s[1]<=i.height&&!bP(i,new Sr(i.center.lat,90)),u[0]>0&&u[0]<=i.width&&u[1]>0&&u[1]<=i.height&&!bP(i,new Sr(i.center.lat,-90))]},a.aX=function(i,n){const{scale:s}=i.tileTransform,u=s*Mt/(i.tileSize*Math.pow(2,n.zoom-i.tileID.overscaledZ+i.tileID.canonical.z));return a.aD.scale(new Float32Array(4),n.inverseAdjustmentMatrix,[u,u])},a.aY=aT,a.aZ=R5,a.a_=function(i){const n=R5(i,!0);return a.aD.invert([],[n[0],n[1],n[4],n[5]])},a.aa=Tz,a.ab=qo,a.ac=sr,a.ad=function(i,n,s){const u=Math.sqrt(i*i+n*n+s*s),h=u>0?Math.acos(s/u)*fi:0;let p=i!==0||n!==0?Math.atan2(-n,-i)*fi+90:0;return p<0&&(p+=360),[u,p,h]},a.af=c_,a.ag=Sc,a.ah=qP,a.ai=function(i,n){const s={};for(let u=0;u<n.length;u++){const h=n[u];h in i&&(s[h]=i[h])}return s},a.aj=zd,a.ak=hu,a.al=du,a.am=oz,a.an=function(i){fg++,fg>Ds&&(i.getActor().send("enforceCacheSizeLimit",ks),fg=0)},a.ao=u0,a.ap=class{constructor(i){this.entries={},this.scheduler=i}request(i,n,s,u){const h=this.entries[i]=this.entries[i]||{callbacks:[]};if(h.result){const[p,m]=h.result;return this.scheduler?this.scheduler.add(()=>{u(p,m)},n):u(p,m),()=>{}}return h.callbacks.push(u),h.cancel||(h.cancel=s((p,m)=>{h.result=[p,m];for(const v of h.callbacks)this.scheduler?this.scheduler.add(()=>{v(p,m)},n):v(p,m);setTimeout(()=>delete this.entries[i],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(p=>p!==u),h.callbacks.length||(h.cancel(),delete this.entries[i]))}}},a.aq=function(i,n,s){const u=JSON.stringify(i.request);return i.data&&(this.deduped.entries[u]={result:[null,i.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},h=>{const p=rh(i.request,(m,v,w,E)=>{m?h(m):v&&h(null,{vectorTile:s?void 0:new CP(new nv(v)),rawData:v,cacheControl:w,expires:E})});return()=>{p.cancel(),h()}},n)},a.ar=QC,a.as=class extends gh{constructor(i){super(i),this.current=DK}set(i,n,s){if(this.fetchUniformLocation(i,n)){for(let u=0;u<9;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},a.at=JC,a.au=Kn,a.av=oc,a.ax=R,a.ay=Ho,a.az=Xs,a.b=wi,a.b$=UK,a.b0=function(i){const{x:n,y:s}=i.point,{lng:u,lat:h}=i._center;return Yz(n,s,i.worldSize,u,h)},a.b1=io,a.b2=Xg,a.b3=nP,a.b4=function(i){const n=Math.round((i+45+360)%360/90)%4;return Jc[n]},a.b5=45,a.b6=sP,a.b7=yw,a.b8=mi,a.b9=uc,a.bA=rT,a.bB=oN,a.bC=function(i,n){return[Math.pow(i[0],2.2)*n,Math.pow(i[1],2.2)*n,Math.pow(i[2],2.2)*n]},a.bD=uF,a.bF=Kz,a.bG=ct,a.bH=Me,a.bI=256,a.bJ=function(i,n){const s=[0,0,0],u=W0(fu(n.canonical));return a.$.transformMat4(s,s,u),a.$.transformMat4(s,s,i),s},a.bK=i=>({u_camera_to_center_distance:new qo(i),u_extrude_scale:new eP(i),u_device_pixel_ratio:new qo(i),u_matrix:new U0(i),u_inv_rot_matrix:new U0(i),u_merc_center:new _h(i),u_tile_id:new QC(i),u_zoom_transition:new qo(i),u_up_dir:new QC(i),u_emissive_strength:new qo(i)}),a.bL=i=>({u_matrix:new U0(i),u_pixels_to_tile_units:new eP(i),u_device_pixel_ratio:new qo(i),u_units_to_pixels:new _h(i),u_dash_image:new _w(i),u_gradient_image:new _w(i),u_image_height:new qo(i),u_texsize:new _h(i),u_tile_units_to_pixels:new qo(i),u_alpha_discard_threshold:new qo(i),u_trim_offset:new _h(i),u_trim_fade_range:new _h(i),u_trim_color:new JC(i),u_emissive_strength:new qo(i)}),a.bM=i=>({u_matrix:new U0(i),u_texsize:new _h(i),u_pixels_to_tile_units:new eP(i),u_device_pixel_ratio:new qo(i),u_image:new _w(i),u_units_to_pixels:new _h(i),u_tile_units_to_pixels:new qo(i),u_alpha_discard_threshold:new qo(i),u_trim_offset:new _h(i)}),a.bN=UC,a.bO=nQ,a.bP=uo,a.bQ=vQ,a.bR=$F,a.bS=zP,a.bT=eN,a.bU=(i,n,s,u,h,p)=>{const m=i.transform,v=m.projection.name==="globe";let w;if(p.paint.get("circle-pitch-alignment")==="map")if(v){const A=Kz(m.zoom,n.canonical)*m._pixelsPerMercatorPixel;w=Float32Array.from([A,0,0,A])}else w=m.calculatePixelsToTileUnitsMatrix(s);else w=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:i.transform.getCameraToCenterDistance(m.projection),u_matrix:i.translatePosMatrix(n.projMatrix,s,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:rn.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:tY,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(v){E.u_inv_rot_matrix=u,E.u_merc_center=h,E.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],E.u_zoom_transition=bh(m.zoom);const A=h[0]*Mt,P=h[1]*Mt;E.u_up_dir=m.projection.upVector(new Fp(0,0,0),A,P)}return E},a.bV=fF,a.bW=(i,n,s,u,h,p)=>{const m=i.transform;return{u_matrix:dF(i,n,s,u),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:m.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:h,u_image:0,u_tile_units_to_pixels:hF(n,m),u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:p}},a.bX=(i,n,s,u,h,p,m)=>{const v=i.transform,w=v.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:dF(i,n,s,u),u_pixels_to_tile_units:w,u_device_pixel_ratio:p,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:pF(s)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:hF(n,i.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toRenderColor(s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength")}},a.bY=Ia,a.bZ=H0,a.b_=QN,a.ba=function(i){return[Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2)]},a.bb=Ju,a.bc=function(i,n,s){const u=bh(s.zoom),h=i.style.map._antialias,p=n.options.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return u===0&&!h&&!p},a.bd=function(i){const n=i.pixelsPerMeter,s=n/Ho(1,i.center.lat),u=a.ae.identity(new Float64Array(16));return a.ae.translate(u,u,[i.point.x,i.point.y,0]),a.ae.scale(u,u,[s,s,n]),Float32Array.from(u)},a.be=Ew,a.bf=function(i){const n=Wi-5;i=Kn(i,-n,n)/n*90;const s=Math.pow(Math.abs(Math.sin(sr(i))),3);return Math.round(s*(rP.length-1))},a.bg=function(i,n,s,u){const h=n.getNorth(),p=n.getSouth(),m=n.getWest(),v=n.getEast(),w=1<<i.z,E=v-m,A=h-p,P=E/Wg,M=-A/rP[s],z=[0,P,0,M,0,0,h,m,0];if(i.z>0){const B=180/u;a.bE.multiply(z,z,[B/E+1,0,0,0,B/A+1,0,-.5*B/P,.5*B/M,1])}return z[2]=w,z[5]=i.x,z[8]=i.y,z},a.bh=W0,a.bi=fu,a.bj=function(i,n,s){const u=a.ae.identity(new Float64Array(16)),h=(n/(1<<i)-.5)*Math.PI*2;return a.ae.rotateY(u,s.globeMatrix,h),Float32Array.from(u)},a.bk=Tt,a.bl=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},a.bm=T5,a.bn=P5,a.bo=w5,a.bp=function(i,n){const s=document.createElement("video");s.muted=!0,s.onloadstart=function(){n(null,s)};for(let u=0;u<i.length;u++){const h=document.createElement("source");lC(i[u])||(s.crossOrigin="Anonymous"),h.src=i[u],s.appendChild(h)}return{cancel:()=>{}}},a.bq=eT,a.br=nh,a.bs=class{isDataAvailableAtPoint(i){const n=this._source();if(this.isUsingMockSource()||!n||i.y<0||i.y>1)return!1;const s=n.getSource().maxzoom,u=1<<s,h=Math.floor(i.x),p=Math.floor((i.x-h)*u),m=Math.floor(i.y*u),v=this.findDEMTileFor(new ws(s,h,s,p,m));return!(!v||!v.dem)}getAtPointOrZero(i,n=0){return this.getAtPoint(i,n)||0}getAtPoint(i,n,s=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const u=this._source();if(!u||i.y<0||i.y>1)return n;const h=u.getSource().maxzoom,p=1<<h,m=Math.floor(i.x),v=i.x-m,w=new ws(h,m,h,Math.floor(v*p),Math.floor(i.y*p)),E=this.findDEMTileFor(w);if(!E||!E.dem)return n;const A=E.dem,P=1<<E.tileID.canonical.z,M=(v*P-E.tileID.canonical.x)*A.dim,z=(i.y*P-E.tileID.canonical.y)*A.dim,B=Math.floor(M),U=Math.floor(z);return(s?this.exaggeration():1)*En(En(A.get(B,U),A.get(B,U+1),z-U),En(A.get(B+1,U),A.get(B+1,U+1),z-U),M-B)}getAtTileOffset(i,n,s){const u=1<<i.canonical.z;return this.getAtPointOrZero(new bo(i.wrap+(i.canonical.x+n/Mt)/u,(i.canonical.y+s/Mt)/u))}getAtTileOffsetFunc(i,n,s,u){return h=>{const p=this.getAtTileOffset(i,h.x,h.y),m=u.upVector(i.canonical,h.x,h.y),v=u.upVectorScale(i.canonical,n,s).metersToTile;return a.$.scale(m,m,p*v),m}}getForTilePoints(i,n,s,u){if(this.isUsingMockSource())return!1;const h=e_.create(this,i,u);return!!h&&(n.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],s)}),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(i);if(!n||!n.dem)return null;const s=n.dem.tree,u=n.tileID,h=1<<i.canonical.z-u.canonical.z;let p=i.canonical.x/h-u.canonical.x,m=i.canonical.y/h-u.canonical.y,v=0;for(let w=0;w<i.canonical.z-u.canonical.z&&!s.leaves[v];w++){p*=2,m*=2;const E=2*Math.floor(m)+Math.floor(p);v=s.childOffsets[v]+E,p%=1,m%=1}return{min:this.exaggeration()*s.minimums[v],max:this.exaggeration()*s.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,n,s){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const i=this.visibleDemTiles;if(i.length===0)return null;let n=!1,s=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const h of i){const p=this.getMinMaxForTile(h.tileID);p&&(s=Math.min(s,p.min),u=Math.max(u,p.max),n=!0)}return n?{min:s,max:u}:null}},a.bt=G0,a.bu=Tw,a.bv=xc,a.bw=js,a.bx=Gp,a.by=d_,a.bz=hT,a.c=Q5,a.c$=function(i,n,s,u){return i.type==="custom"?new TJ(i,n):new ZJ[i.type](i,n,s,u)},a.c0=Fw,a.c1=jd,a.c2=450,a.c3=7,a.c4=wJ,a.c5=u5,a.c6=256,a.c7=Wz,a.c8=vP,a.c9=Lr,a.cA=zz,a.cB=function(i,n,s=0){return a.$.fromValues(((n.x-s)*i.scale-i.x)*Mt,(n.y*i.scale-i.y)*Mt,Cz(n.z,n.y))},a.cC=function(i){let n=1/0,s=1/0,u=-1/0,h=-1/0;for(const p of i)n=Math.min(n,p.x),s=Math.min(s,p.y),u=Math.max(u,p.x),h=Math.max(h,p.y);return{min:new Dt(n,s),max:new Dt(u,h)}},a.cD=Nd,a.cE=Mz,a.cF=Wo,a.cG=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.cH=zF,a.cI=uP,a.cJ=IN,a.cK=MN,a.cL=kN,a.cM=jP,a.cN=dR,a.cO=function(i){return i({pluginStatus:Vr,pluginURL:gr}),nr.on("pluginStateChange",i),i},a.cP=s_,a.cQ=FP,a.cR=o0,a.cS=jr,a.cT=Z,a.cU=xs,a.cV=_g,a.cW=Fs,a.cX=function(i){const n=i.indexOf(uw);return n>=0?i.slice(0,n):i},a.cY=function(i){return i.indexOf(uw)>=0},a.cZ=function(i){const n=i.indexOf(uw);return n>=0?i.slice(n+1):""},a.c_=function(i){const n=[],s=i.id;return s===void 0&&n.push({message:`layers.${s}: missing required property "id"`}),i.render===void 0&&n.push({message:`layers.${s}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&n.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),n},a.ca=Md,a.cb=Lp,a.cc=1,a.cd=hv,a.ce=0,a.cf=qC,a.cg=function(i,n,s,u,h){return Kn((i-n)/(s-n)*(h-u)+u,u,h)},a.ch=aw,a.ci=Bp,a.cj=class{constructor(i,n,s,u){this.context=i,this.format=u,this.size=s,this.texture=i.gl.createTexture();const[h,p,m]=this.size,{gl:v}=i;v.bindTexture(v.TEXTURE_3D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(!1);let w=this.format,E=v.UNSIGNED_BYTE;this.format===v.DEPTH_COMPONENT&&(w=v.DEPTH_COMPONENT16,E=v.UNSIGNED_SHORT),this.format===v.R8&&(u=v.RED),this.format===v.R32F&&(E=v.FLOAT,u=v.RED),v.texImage3D(v.TEXTURE_3D,0,w,h,p,m,0,u,E,n.data)}bind(i,n){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_3D,this.texture),i!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,i),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,i),this.minFilter=i),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}},a.ck=nR,a.cl=[1,1,1],a.cm=e_,a.cn=h_,a.co=Dd,a.cp=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Dt(1/0,1/0),max:new Dt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(i,n=!1){const s=CN(new Dt(0,0),new Dt(Mt,Mt),i),u=[];if(n&&!PP(s,this._globalClipBounds))return u;for(const h of this._activeRegions){if(h.hiddenByOverlap||!PP(s,h))continue;const p=MY(h.min,h.max,i);u.push({min:p.min,max:p.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return u}setSources(i){this._setSources(i.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const s=[];for(const u of n.cache.getVisibleCoordinates()){const h=n.cache.getTile(u).buckets[n.layer];h&&h.updateFootprints(u.toUnwrapped(),s)}return s},getOrder:()=>n.order,getClipMask:()=>n.clipMask,getClipScope:()=>n.clipScope})))}_addSource(i){const n=i.getFootprints();if(n.length===0)return;const s=i.getOrder(),u=i.getClipMask(),h=i.getClipScope();for(const p of n){if(!p.footprint)continue;const m=CN(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:s,clipMask:u,clipScope:h})}this._sourceIds.push(i.getSourceId())}_computeReplacement(){this._activeRegions.sort((n,s)=>n.priority-s.priority||Lw(n.min,s.min)||Lw(n.max,s.max)||n.order-s.order||n.clipMask-s.clipMask||function(u,h){const p=(m,v)=>m+v;return u.length-h.length||u.reduce(p,"").localeCompare(h.reduce(p,""))}(n.clipScope,s.clipScope));let i=this._activeRegions.length!==this._prevRegions.length;if(!i){let n=0;for(;!i&&n!==this._activeRegions.length;){const s=this._activeRegions[n],u=this._prevRegions[n];i=s.priority!==u.priority||!AN(s,u)||s.order!==u.order||s.clipMask!==u.clipMask||!sc(s.clipScope,u.clipScope),++n}}if(i){++this._updateTime;for(const s of this._activeRegions)s.order!==Ow&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));const n=s=>{const u=this._activeRegions;if(s>=u.length)return s;const h=u[s].priority;for(;s<u.length&&u[s].priority===h;)++s;return s};if(this._sourceIds.length>1){let s=0,u=n(s);for(;s!==u;){let h=s;const p=s;for(;h!==u;){const m=this._activeRegions[h];m.hiddenByOverlap=!1;for(let v=0;v<p;v++){const w=this._activeRegions[v];if(!w.hiddenByOverlap&&m.order===Ow&&PP(m,w)&&(m.hiddenByOverlap=RN(m.footprint,m.tileId,w.footprint,w.tileId),m.hiddenByOverlap))break}++h}s=u,u=n(s)}}}}_setSources(i){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=i.length-1;n>=0;n--)this._addSource(i[n]);this._computeReplacement()}},a.cq=mh,a.cr=nT,a.cs=F0,a.ct=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy()}_fillGridMeshWithLods(i,n){const s=new xc,u=new js,h=[],p=i+1+2,m=n[0]+1,v=n[0]+1+(1+n.length),w=(E,A,P)=>{let M=E===p-1?E-2:E===0?E:E-1;return M+=P?24575:0,[M,A]};for(let E=0;E<p;++E)s.emplaceBack(...w(E,0,!0));for(let E=0;E<m;++E)for(let A=0;A<p;++A)s.emplaceBack(...w(A,E,(A===0||A===p-1)&&!0));for(let E=0;E<n.length;++E){const A=n[E];for(let P=0;P<p;++P)s.emplaceBack(...w(P,A,!0))}for(let E=0;E<n.length;++E){const A=u.length,P=n[E]+1+2,M=new js;for(let U=0;U<P-1;U++){const $=U===P-2,Y=$?p*(v-n.length+E-U):p;for(let fe=0;fe<p-1;fe++){const he=U*p+fe;U===0||$||fe===0||fe===p-2?(M.emplaceBack(he+1,he,he+Y),M.emplaceBack(he+Y,he+Y+1,he+1)):(u.emplaceBack(he+1,he,he+Y),u.emplaceBack(he+Y,he+Y+1,he+1))}}const z=wi.simpleSegment(0,A,s.length,u.length-A);for(let U=0;U<M.uint16.length;U+=3)u.emplaceBack(M.uint16[U],M.uint16[U+1],M.uint16[U+2]);const B=wi.simpleSegment(0,A,s.length,u.length-A);h.push({withoutSkirts:z,withSkirts:B})}return{vertices:s,indices:u,segments:h}}_createGrid(i){const n=this._fillGridMeshWithLods(Wg,rP);this._gridSegments=n.segments,this._gridBuffer=i.createVertexBuffer(n.vertices,G0.members),this._gridIndexBuffer=i.createIndexBuffer(n.indices,!0)}_createPoles(i){const n=new js;for(let m=0;m<=Wg;m++)n.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=i.createIndexBuffer(n,!0);const s=new Lp,u=new Lp,h=new Lp,p=new Lp;this._poleSegments=[];for(let m=0,v=0;m<nP;m++){const w=360/(1<<m);s.emplaceBack(0,-Wo,0,.5,0),u.emplaceBack(0,-Wo,0,.5,1),h.emplaceBack(0,-Wo,0,.5,.5),p.emplaceBack(0,-Wo,0,.5,.5);for(let E=0;E<=Wg;E++){let A=E/Wg,P=0;const M=En(0,w,A),[z,B,U]=Hg(JK,eY,M,Wo);s.emplaceBack(z,B,U,A,P),u.emplaceBack(z,B,U,A,1-P);const $=sr(M);A=.5+.5*Math.sin($),P=.5+.5*Math.cos($),h.emplaceBack(z,B,U,A,P),p.emplaceBack(z,B,U,A,1-P)}this._poleSegments.push(wi.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(s,ww,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(u,ww,!1),this._texturedPoleNorthVertexBuffer=i.createVertexBuffer(h,ww,!1),this._texturedPoleSouthVertexBuffer=i.createVertexBuffer(p,ww,!1)}getGridBuffers(i,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}},a.cu=function(i){return hp.has(i)},a.cv=Ow,a.cw=jN,a.cx=function(i,n,s=0,u=!0){const h=new Dt(s,s),p=i.sub(h),m=n.add(h),v=[p,new Dt(m.x,p.y),m,new Dt(p.x,m.y)];return u&&v.push(p.clone()),v},a.cy=function(i,n){const s=[];for(let u=0;u<i.length;u++){const h=oc(u-1,-1,i.length-1),p=oc(u+1,-1,i.length-1),m=i[u],v=i[p],w=i[h].sub(m).unit(),E=v.sub(m).unit(),A=E.angleWithSep(w.x,w.y),P=w.add(E).unit().mult(-1*n/Math.sin(A/2));s.push(m.add(P))}return s},a.cz=HF,a.d=sc,a.d$=mv,a.d0=Ms,a.d1=nr,a.d2=Il,a.d3=eh,a.d4=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.d5=yo,a.d6=Rz,a.d7=Np,a.d8=function([i,n,s]){const u=Math.hypot(i,n,s),h=Math.atan2(i,s),p=.5*Math.PI-Math.acos(-n/u);return new Sr(io(h),io(p))},a.d9=ya,a.dA=function(){hT().acquire(oR)},a.dB=function(){const i=bv;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(oR),bv=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.dC=xv,a.dD=function(i){const n=pd();if(!n)return;const s=n.delete(Hr);i&&s.catch(i).then(()=>i())},a.dE=vv,a.dF=$5,a.dG=function(i){aR=rn.resolveURL(i),p_||(p_=new d_(hT(),new ah)),p_.broadcast("setDracoUrl",aR)},a.dH=G5,a.dI=function(i){f_=rn.resolveURL(i),p_||(p_=new d_(hT(),new ah)),p_.broadcast("setMeshoptUrl",f_)},a.dJ=ac,a.dK=Ue,a.dL=Fd,a.dM=Ec,a.dN=Vp,a.dO=KC,a.dP=mF,a.dQ=wF,a.dR=oF,a.dS=eu,a.dT=FF,a.dU=l_,a.dV=function(i,n,s,u,h,p,m,v,w,E,A){i.createArrays(),i.tilePixelRatio=Mt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const P=i.layers[0].layout,M=i.layers[0]._unevaluatedLayout._values,z={};if(i.textSizeData.kind==="composite"){const{minZoom:Y,maxZoom:fe}=i.textSizeData;z.compositeTextSizes=[M["text-size"].possiblyEvaluate(new kn(Y),v),M["text-size"].possiblyEvaluate(new kn(fe),v)]}if(i.iconSizeData.kind==="composite"){const{minZoom:Y,maxZoom:fe}=i.iconSizeData;z.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new kn(Y),v),M["icon-size"].possiblyEvaluate(new kn(fe),v)]}z.layoutTextSize=M["text-size"].possiblyEvaluate(new kn(w+1),v),z.layoutIconSize=M["icon-size"].possiblyEvaluate(new kn(w+1),v),z.textMaxSize=M["text-size"].possiblyEvaluate(new kn(18),v);const B=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",U=P.get("text-size");let $=!1;for(const Y of i.features)if(Y.icon&&Y.icon.nameSecondary){$=!0;break}for(const Y of i.features){const fe=P.get("text-font").evaluate(Y,{},v).join(","),he=U.evaluate(Y,{},v),me=z.layoutTextSize.evaluate(Y,{},v),Ae=(z.layoutIconSize.evaluate(Y,{},v),{horizontal:{},vertical:void 0}),Ce=Y.text;let Le,Ve=[0,0];if(Ce){const Ze=Ce.toString(),st=P.get("text-letter-spacing").evaluate(Y,{},v)*uo,yt=P.get("text-line-height").evaluate(Y,{},v)*uo,ot=ft(Ze)?st:0,bt=P.get("text-anchor").evaluate(Y,{},v),rt=P.get("text-variable-anchor");if(!rt){const Et=P.get("text-radial-offset").evaluate(Y,{},v);Ve=Et?$F(bt,[Et*uo,BP]):P.get("text-offset").evaluate(Y,{},v).map(vt=>vt*uo)}let dt=B?"center":P.get("text-justify").evaluate(Y,{},v);const It=P.get("symbol-placement")==="point",at=It?P.get("text-max-width").evaluate(Y,{},v)*uo:1/0,Ot=Et=>{i.allowVerticalPlacement&&ht(Ze)&&(Ae.vertical=LP(Ce,n,s,h,fe,at,yt,bt,Et,ot,Ve,nl.vertical,!0,me,he))};if(!B&&rt){const Et=dt==="auto"?rt.map(vn=>jP(vn)):[dt];let vt=!1;for(let vn=0;vn<Et.length;vn++){const dn=Et[vn];if(!Ae.horizontal[dn])if(vt)Ae.horizontal[dn]=Ae.horizontal[0];else{const Yt=LP(Ce,n,s,h,fe,at,yt,"center",dn,ot,Ve,nl.horizontal,!1,me,he);Yt&&(Ae.horizontal[dn]=Yt,vt=Yt.positionedLines.length===1)}}Ot("left")}else{if(dt==="auto"&&(dt=jP(bt)),It||P.get("text-writing-mode").indexOf("horizontal")>=0||!ht(Ze)){const Et=LP(Ce,n,s,h,fe,at,yt,bt,dt,ot,Ve,nl.horizontal,!1,me,he);Et&&(Ae.horizontal[dt]=Et)}Ot(It?"left":dt)}}let He=!1;if(Y.icon&&Y.icon.namePrimary){const Ze=u[Y.icon.namePrimary];Ze&&(Le=CQ(h[Y.icon.namePrimary],Y.icon.nameSecondary?h[Y.icon.nameSecondary]:void 0,P.get("icon-offset").evaluate(Y,{},v),P.get("icon-anchor").evaluate(Y,{},v)),He=Ze.sdf,i.sdfIcons===void 0?i.sdfIcons=Ze.sdf:i.sdfIcons!==Ze.sdf&&Ii("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ze.pixelRatio!==i.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const et=qF(Ae.horizontal)||Ae.vertical;i.iconsInText||(i.iconsInText=!!et&&et.iconsInText),(et||Le)&&LQ(i,Y,Ae,Le,u,z,me,0,Ve,He,m,v,E,A,$)}p&&i.generateCollisionDebugBuffers(w,i.collisionBoxArray)},a.dW=Bw,a.dX=Rw,a.dY=CP,a.dZ=nv,a.d_=zw,a.da=Zg,a.db=O,a.dc=bP,a.dd=Qz,a.de=function(i){const n=[0,0,0],s=a.ae.identity(new Float64Array(16));return a.ae.multiply(s,i.pixelMatrix,i.globeMatrix),a.$.transformMat4(n,n,s),new Dt(n[0],n[1])},a.df=Q,a.dg=W,a.dh=function(i){const n=i.navigator?i.navigator.userAgent:null;return!!function(s){if(iu==null){const u=s.navigator?s.navigator.userAgent:null;iu=!!s.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return iu}(i)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.di=lc,a.dj=class{constructor(i,n,s){this._transformRequestFn=i,this._customAccessToken=n,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const i=function(){let n="";for(let s=0;s<10;s++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",a0,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,n){return this._transformRequestFn&&this._transformRequestFn(i,n)||{url:i}}normalizeStyleURL(i,n){if(!Z(i))return i;const s=Aa(i);return s.params.push(`sdk=js-${I}`),s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||n)}normalizeGlyphsURL(i,n){if(!Z(i))return i;const s=Aa(i);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||n)}normalizeModelURL(i,n){if(!Z(i))return i;const s=Aa(i);return s.path=`/models/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||n)}normalizeSourceURL(i,n,s,u){if(!Z(i))return i;const h=Aa(i);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),s&&h.params.push(`language=${s}`),u&&h.params.push(`worldview=${u}`),this._makeAPIURL(h,this._customAccessToken||n)}normalizeSpriteURL(i,n,s,u){const h=Aa(i);return Z(i)?(h.path=`/styles/v1${h.path}/sprite${n}${s}`,this._makeAPIURL(h,this._customAccessToken||u)):(h.path+=`${n}${s}`,ih(h))}normalizeTileURL(i,n,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Z(i))return i;const u=Aa(i);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||s&&u.authority!=="raster"&&s===512?"@2x":""}${pg.supported?".webp":"$1"}`),u.authority==="raster"?u.path=`/${O.RASTER_URL_PREFIX}${u.path}`:u.authority==="rasterarrays"?u.path=`/${O.RASTERARRAYS_URL_PREFIX}${u.path}`:u.authority==="3dtiles"?u.path=`/${O.TILES3D_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${O.TILE_URL_VERSION}${u.path}`);const h=this._customAccessToken||function(p){for(const m of p){const v=m.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(u.params)||O.ACCESS_TOKEN;return O.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,h)}canonicalizeTileURL(i,n){const s=Aa(i);if(!s.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!s.path.match(/\.[\w]+$/))return i;let u="mapbox://";s.path.match(/^\/raster\/v1\//)?u+=`raster/${s.path.replace(`/${O.RASTER_URL_PREFIX}/`,"")}`:s.path.match(/^\/rasterarrays\/v1\//)?u+=`rasterarrays/${s.path.replace(`/${O.RASTERARRAYS_URL_PREFIX}/`,"")}`:u+=`tiles/${s.path.replace(`/${O.TILE_URL_VERSION}/`,"")}`;let h=s.params;return n&&(h=h.filter(p=>!p.match(/^access_token=/))),h.length&&(u+=`?${h.join("&")}`),u}canonicalizeTileset(i,n){const s=!!n&&Z(n),u=[];for(const h of i.tiles||[])F(h)?u.push(this.canonicalizeTileURL(h,s)):u.push(h);return u}_makeAPIURL(i,n){const s="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=Aa(O.API_URL);if(i.protocol=u.protocol,i.authority=u.authority,i.protocol==="http"){const h=i.params.indexOf("secure");h>=0&&i.params.splice(h,1)}if(u.path!=="/"&&(i.path=`${u.path}${i.path}`),!O.REQUIRE_ACCESS_TOKEN)return ih(i);if(n=n||O.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return i.params=i.params.filter(h=>h.indexOf("access_token")===-1),i.params.push(`access_token=${n||""}`),ih(i)}},a.dk=function(i,n){n?hp.add(i):hp.delete(i)},a.dl=pg,a.dm=uC,a.dn=h0,a.dp=l0,a.dq=kb,a.dr=Db,a.ds=function(i){hp.delete(i)},a.dt=up,a.du=_d,a.dv=th,a.dw=I,a.dx=function(i,n){ks=i,Ds=n},a.dy=function(i,n,s=!1){if(Vr===Sn||Vr===Zn||Vr===pr)throw new Error("setRTLTextPlugin cannot be called multiple times.");gr=rn.resolveURL(i),Vr=Sn,ti=n,Yn(),s||Tr()},a.dz=$n,a.e=rn,a.e0=kw,a.e1=Mw,a.e2=Qc,a.e3=gF,a.e4=pe,a.e5=rh,a.e6=function(i){let n=0;if(new Uint32Array(i,0,1)[0]!==W5){const s=new Uint32Array(i,0,7),[,,u,h,p,m]=s;n=s.byteLength+h+p+m+p,(u!==i.byteLength||n>=i.byteLength)&&Ii("Invalid b3dm header information.")}return K5(i,n)},a.e7=function(i,n){const s=Q5(i);for(const u of s){for(const h of u.meshes)GJ(h);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(qJ(u.lights,n)))}return s},a.e8=mT,a.e9=V5,a.ea=or,a.eb=function(i){ip(),ds&&ds.then(n=>{n.keys().then(s=>{for(let u=0;u<s.length-i;u++)n.delete(s[u])})})},a.f=dp,a.g=Al,a.h=function(i,n){return Il(Rs(i,{type:"json"}),n)},a.i=lp,a.j=tl,a.k=NF,a.l=function(i){return fetch(i).then(n=>n.arrayBuffer()).then(n=>K5(n,0,i))},a.m=NP,a.n=class extends cT{},a.o=su,a.p=ZQ,a.q=vd,a.r=S,a.s=L,a.t=k,a.u=_c,a.v=ve,a.w=Ii,a.x=el,a.y=Ie,a.z=_e}),_(["./shared"],function(a){function I(Be){const te=Be?Be.url.toString():void 0;return te?performance.getEntriesByName(te):[]}function D(Be){if(typeof Be=="number"||typeof Be=="boolean"||typeof Be=="string"||Be==null)return JSON.stringify(Be);if(Array.isArray(Be)){let le="[";for(const xe of Be)le+=`${D(xe)},`;return`${le}]`}let te="{";for(const le of Object.keys(Be).sort())te+=`${le}:${D(Be[le])},`;return`${te}}`}function O(Be){let te="";for(const le of a.cG)te+=`/${D(Be[le])}`;return te}class F{constructor(te){this.keyCache={},this._layers={},this._layerConfigs={},te&&this.replace(te)}replace(te,le){this._layerConfigs={},this._layers={},this.update(te,[],le)}update(te,le,xe){this._options=xe;for(const De of te)this._layerConfigs[De.id]=De,(this._layers[De.id]=a.c$(De,this.scope,null,this._options)).compileFilter(),this.keyCache[De.id]&&delete this.keyCache[De.id];for(const De of le)delete this.keyCache[De],delete this._layerConfigs[De],delete this._layers[De];this.familiesBySource={};const Oe=function(De,Ge){const tt={};for(let Je=0;Je<De.length;Je++){const mt=Ge&&Ge[De[Je].id]||O(De[Je]);Ge&&(Ge[De[Je].id]=mt);let gt=tt[mt];gt||(gt=tt[mt]=[]),gt.push(De[Je])}const $e=[];for(const Je in tt)$e.push(tt[Je]);return $e}(a.dJ(this._layerConfigs),this.keyCache);for(const De of Oe){const Ge=De.map($t=>this._layers[$t.id]),tt=Ge[0];if(tt.visibility==="none")continue;const $e=tt.source||"";let Je=this.familiesBySource[$e];Je||(Je=this.familiesBySource[$e]={});const mt=tt.sourceLayer||"_geojsonTileLayer";let gt=Je[mt];gt||(gt=Je[mt]=[]),gt.push(Ge)}}}const Z=1*a.dM;class J{constructor(te){const le={},xe=[];for(const tt in te){const $e=te[tt],Je=le[tt]={};for(const mt in $e.glyphs){const gt=$e.glyphs[+mt];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const $t=gt.metrics.localGlyph?Z:1,_n={x:0,y:0,w:gt.bitmap.width+2*$t,h:gt.bitmap.height+2*$t};xe.push(_n),Je[mt]=_n}}const{w:Oe,h:De}=a.k(xe),Ge=new a.dL({width:Oe||1,height:De||1});for(const tt in te){const $e=te[tt];for(const Je in $e.glyphs){const mt=$e.glyphs[+Je];if(!mt||mt.bitmap.width===0||mt.bitmap.height===0)continue;const gt=le[tt][Je],$t=mt.metrics.localGlyph?Z:1;a.dL.copy(mt.bitmap,Ge,{x:0,y:0},{x:gt.x+$t,y:gt.y+$t},mt.bitmap)}}this.image=Ge,this.positions=le}}a.dK(J,"GlyphAtlas");class ne{constructor(te){this.tileID=new a.aQ(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.lut=te.lut,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.scope=te.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.collectResourceTiming,this.promoteId=te.promoteId,this.isSymbolTile=te.isSymbolTile,this.tileTransform=a.dN(te.tileID.canonical,te.projection),this.projection=te.projection,this.brightness=te.brightness,this.extraShadowCaster=!!te.extraShadowCaster,this.tessellationStep=te.tessellationStep}parse(te,le,xe,Oe,De){this.status="parsing",this.data=te,this.collisionBoxArray=new a.dO;const Ge=new a.dP(Object.keys(te.layers).sort()),tt=new a.dQ(this.tileID,this.promoteId);tt.bucketLayerIDs=[];const $e={},Je=new a.dR(256,256),mt={featureIndex:tt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Je,availableImages:xe,brightness:this.brightness},gt=le.familiesBySource[this.source];for(const cn in gt){const ei=te.layers[cn];if(!ei)continue;let vr=!1,dr=!1,xi=!1;for(const Ps of gt[cn])Ps[0].type==="symbol"?vr=!0:dr=!0,Ps[0].is3D()&&Ps[0].type!=="model"&&(xi=!0);if(this.extraShadowCaster&&!xi||this.isSymbolTile===!0&&!vr||this.isSymbolTile===!1&&!dr)continue;ei.version===1&&a.w(`Vector tile source "${this.source}" layer "${cn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const bi=Ge.encode(cn),Ki=[];for(let Ps=0;Ps<ei.length;Ps++){const Ws=ei.feature(Ps),nc=tt.getId(Ws,cn);Ki.push({feature:Ws,id:nc,index:Ps,sourceLayerIndex:bi})}for(const Ps of gt[cn]){const Ws=Ps[0];(!this.extraShadowCaster||Ws.is3D()&&Ws.type!=="model")&&(this.isSymbolTile!==void 0&&Ws.type==="symbol"!==this.isSymbolTile||Ws.minzoom&&this.zoom<Math.floor(Ws.minzoom)||Ws.maxzoom&&this.zoom>=Ws.maxzoom||Ws.visibility!=="none"&&(se(Ps,this.zoom,mt.brightness,xe),($e[Ws.id]=Ws.createBucket({index:tt.bucketLayerIDs.length,layers:Ps,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:bi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Ki,mt,this.tileID.canonical,this.tileTransform),tt.bucketLayerIDs.push(Ps.map(nc=>nc.id))))}}let $t,_n,An,ur;Je.trim();const Dn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},hr=()=>{if($t)return this.status="done",De($t);if(this.extraShadowCaster)this.status="done",De(null,{buckets:a.dJ($e).filter(cn=>!cn.isEmpty()),featureIndex:tt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:mt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(_n&&An&&ur){const cn=new J(_n),ei=new a.dT(An,ur,this.lut);for(const vr in $e){const dr=$e[vr];dr instanceof a.dU?(se(dr.layers,this.zoom,mt.brightness,xe),a.dV(dr,_n,cn.positions,An,ei.iconPositions,this.showCollisionBoxes,xe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):dr.hasPattern&&(dr instanceof a.dW||dr instanceof a.dX||dr instanceof a.c0)&&(se(dr.layers,this.zoom,mt.brightness,xe),dr.addFeatures(mt,this.tileID.canonical,ei.patternPositions,xe,this.tileTransform,this.brightness))}this.status="done",De(null,{buckets:a.dJ($e).filter(vr=>!vr.isEmpty()),featureIndex:tt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:cn.image,lineAtlas:Je,imageAtlas:ei,brightness:mt.brightness})}};if(!this.extraShadowCaster){const cn=a.dS(mt.glyphDependencies,dr=>Object.keys(dr).map(Number));Object.keys(cn).length?Oe.send("getGlyphs",{uid:this.uid,stacks:cn,scope:this.scope},(dr,xi)=>{$t||($t=dr,_n=xi,hr())},void 0,!1,Dn):_n={};const ei=Object.keys(mt.iconDependencies);ei.length?Oe.send("getImages",{icons:ei,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(dr,xi)=>{$t||($t=dr,An=xi,hr())},void 0,!1,Dn):An={};const vr=Object.keys(mt.patternDependencies);vr.length?Oe.send("getImages",{icons:vr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(dr,xi)=>{$t||($t=dr,ur=xi,hr())},void 0,!1,Dn):ur={}}hr()}}function se(Be,te,le,xe){const Oe=new a.Y(te,{brightness:le});for(const De of Be)De.recalculate(Oe,xe)}class W extends a.E{constructor(te,le,xe,Oe,De,Ge){super(),this.actor=te,this.layerIndex=le,this.availableImages=xe,this.loadVectorData=De||a.aq,this.loading={},this.loaded={},this.deduped=new a.ap(te.scheduler),this.isSpriteLoaded=Oe,this.scheduler=te.scheduler,this.brightness=Ge}loadTile(te,le){const xe=te.uid,Oe=te&&te.request,De=Oe&&Oe.collectResourceTiming,Ge=this.loading[xe]=new ne(te);Ge.abort=this.loadVectorData(te,(tt,$e)=>{const Je=!this.loading[xe];if(delete this.loading[xe],Je||tt||!$e)return Ge.status="done",Je||(this.loaded[xe]=Ge),le(tt);const mt=$e.rawData,gt={};$e.expires&&(gt.expires=$e.expires),$e.cacheControl&&(gt.cacheControl=$e.cacheControl),Ge.vectorTile=$e.vectorTile||new a.dY(new a.dZ(mt));const $t=()=>{Ge.parse(Ge.vectorTile,this.layerIndex,this.availableImages,this.actor,(_n,An)=>{if(_n||!An)return le(_n);const ur={};if(De){const Dn=I(Oe);Dn.length>0&&(ur.resourceTiming=JSON.parse(JSON.stringify(Dn)))}le(null,a.Q({rawTileData:mt.slice(0)},An,gt,ur))})};this.isSpriteLoaded?$t():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add($t,{type:"parseTile",isSymbolTile:te.isSymbolTile,zoom:te.tileZoom}):$t()}),this.loaded=this.loaded||{},this.loaded[xe]=Ge})}reloadTile(te,le){const xe=this.loaded,Oe=te.uid;if(xe&&xe[Oe]){const De=xe[Oe];De.showCollisionBoxes=te.showCollisionBoxes,De.projection=te.projection,De.brightness=te.brightness,De.tileTransform=a.dN(te.tileID.canonical,te.projection),De.extraShadowCaster=te.extraShadowCaster,De.lut=te.lut;const Ge=(tt,$e)=>{const Je=De.reloadCallback;Je&&(delete De.reloadCallback,De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,Je)),le(tt,$e)};De.status==="parsing"?De.reloadCallback=Ge:De.status==="done"&&(De.vectorTile?De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,Ge):Ge())}else le(null,void 0)}abortTile(te,le){const xe=te.uid,Oe=this.loading[xe];Oe&&(Oe.abort&&Oe.abort(),delete this.loading[xe]),le()}removeTile(te,le){const xe=this.loaded,Oe=te.uid;xe&&xe[Oe]&&delete xe[Oe],le()}}class Q{loadTile(te,le){const{uid:xe,encoding:Oe,rawImageData:De,padding:Ge}=te,tt=ImageBitmap&&De instanceof ImageBitmap?this.getImageData(De,Ge):De;le(null,new a.d_(xe,tt,Oe,Ge<1))}getImageData(te,le){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const xe=this.offscreenCanvasContext.getImageData(-le,-le,te.width+2*le,te.height+2*le);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),xe}}a.d$.setPbf(a.dZ);class K{decodeRasterArray({task:te,buffer:le},xe){a.d$.performDecoding(le,te).then(Oe=>{xe(null,Oe)},Oe=>{xe(Oe)})}}const pe=a.e0.prototype.toGeoJSON;let Te=class{constructor(Be){this._feature=Be,this.extent=a.a4,this.type=Be.type,this.properties=Be.tags,"id"in Be&&!isNaN(Be.id)&&(this.id=parseInt(Be.id,10))}loadGeometry(){if(this._feature.type===1){const Be=[];for(const te of this._feature.geometry)Be.push([new a.P(te[0],te[1])]);return Be}{const Be=[];for(const te of this._feature.geometry){const le=[];for(const xe of te)le.push(new a.P(xe[0],xe[1]));Be.push(le)}return Be}}toGeoJSON(Be,te,le){return pe.call(this,Be,te,le)}},we=class{constructor(Be){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.a4,this.length=Be.length,this._features=Be}feature(Be){return new Te(this._features[Be])}};const oe=64/4096,de=128;class X{constructor(){this.features=new Map}clear(){this.features.clear()}load(te=[],le){for(const xe of te){const Oe=xe.id;if(Oe==null)continue;let De=this.features.get(Oe);De&&this.updateCache(De,le),xe.geometry?(De=be(xe),this.updateCache(De,le),this.features.set(Oe,De)):this.features.delete(Oe),this.updateCache(De,le)}}updateCache(te,le){for(const{canonical:xe,uid:Oe}of Object.values(le)){const{z:De,x:Ge,y:tt}=xe;ge(te,Math.pow(2,De),Ge,tt)&&delete le[Oe]}}getTile(te,le,xe){const Oe=Math.pow(2,te),De=[];for(const Ge of this.features.values())ge(Ge,Oe,le,xe)&&De.push(jt(Ge,Oe,le,xe));return{features:De}}getFeatures(){return[...this.features.values()]}}function ge({minX:Be,minY:te,maxX:le,maxY:xe},Oe,De,Ge){return Be<(De+1+oe)/Oe&&te<(Ge+1+oe)/Oe&&le>(De-oe)/Oe&&xe>(Ge-oe)/Oe}function be(Be){const{id:te,geometry:le,properties:xe}=Be;if(!le)return;if(le.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Oe,coordinates:De}=le,Ge={id:te,type:1,geometry:[],tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},tt=Ge.geometry;if(Oe==="Point")ke(De,tt,Ge);else if(Oe==="MultiPoint")for(const $e of De)ke($e,tt,Ge);else if(Oe==="LineString")Ge.type=2,Ee(De,tt,Ge);else if(Oe==="MultiLineString")Ge.type=2,Lt(De,tt,Ge);else if(Oe==="Polygon")Ge.type=3,Lt(De,tt,Ge,!0);else{if(Oe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ge.type=3;for(const $e of De)Lt($e,tt,Ge,!0)}return Ge}function ke([Be,te],le,xe){const Oe=a.ak(Be);let De=a.al(te);De=De<0?0:De>1?1:De,le.push(Oe,De),xe.minX=Math.min(xe.minX,Oe),xe.minY=Math.min(xe.minY,De),xe.maxX=Math.max(xe.maxX,Oe),xe.maxY=Math.max(xe.maxY,De)}function Ee(Be,te,le,xe=!1,Oe=!1){const De=[];for(const Ge of Be)ke(Ge,De,le);te.push(De),xe&&function(Ge,tt){let $e=0;for(let Je=0,mt=Ge.length,gt=mt-2;Je<mt;gt=Je,Je+=2)$e+=(Ge[Je]-Ge[gt])*(Ge[Je+1]+Ge[gt+1]);if($e>0===tt)for(let Je=0,mt=Ge.length;Je<mt/2;Je+=2){const gt=Ge[Je],$t=Ge[Je+1];Ge[Je]=Ge[mt-2-Je],Ge[Je+1]=Ge[mt-1-Je],Ge[mt-2-Je]=gt,Ge[mt-1-Je]=$t}}(De,Oe)}function Lt(Be,te,le,xe=!1){for(let Oe=0;Oe<Be.length;Oe++)Ee(Be[Oe],te,le,xe,Oe===0)}function jt(Be,te,le,xe){const{id:Oe,type:De,geometry:Ge,tags:tt}=Be,$e=[];if(De===1)(function(Je,mt,gt,$t,_n){for(let An=0;An<Je.length;An+=2){const ur=Math.round(a.a4*(Je[An+0]*mt-gt)),Dn=Math.round(a.a4*(Je[An+1]*mt-$t));_n.push([ur,Dn])}})(Ge,te,le,xe,$e);else for(const Je of Ge)Qt(Je,te,le,xe,$e);return{id:Oe,type:De,geometry:$e,tags:tt}}function Qt(Be,te,le,xe,Oe){const De=-de,Ge=a.a4+de;let tt;for(let $e=0;$e<Be.length-2;$e+=2){let Je=Math.round(a.a4*(Be[$e+0]*te-le)),mt=Math.round(a.a4*(Be[$e+1]*te-xe)),gt=Math.round(a.a4*(Be[$e+2]*te-le)),$t=Math.round(a.a4*(Be[$e+3]*te-xe));const _n=gt-Je,An=$t-mt;Je<De&&gt<De||(Je<De?(mt+=Math.round(An*((De-Je)/_n)),Je=De):gt<De&&($t=mt+Math.round(An*((De-Je)/_n)),gt=De),mt<De&&$t<De||(mt<De?(Je+=Math.round(_n*((De-mt)/An)),mt=De):$t<De&&(gt=Je+Math.round(_n*((De-mt)/An)),$t=De),Je>=Ge&&gt>=Ge||(Je>=Ge?(mt+=Math.round(An*((Ge-Je)/_n)),Je=Ge):gt>=Ge&&($t=mt+Math.round(An*((Ge-Je)/_n)),gt=Ge),mt>=Ge&&$t>=Ge||(mt>=Ge?(Je+=Math.round(_n*((Ge-mt)/An)),mt=Ge):$t>=Ge&&(gt=Je+Math.round(_n*((Ge-mt)/An)),$t=Ge),tt&&Je===tt[tt.length-1][0]&&mt===tt[tt.length-1][1]||(tt=[[Je,mt]],Oe.push(tt)),tt.push([gt,$t])))))}}var Pt={exports:{}},lt=a.e2,At=a.e1.VectorTileFeature,nn=fn;function fn(Be,te){this.options=te||{},this.features=Be,this.length=Be.length}function mn(Be,te){this.id=typeof Be.id=="number"?Be.id:void 0,this.type=Be.type,this.rawGeometry=Be.type===1?[Be.geometry]:Be.geometry,this.properties=Be.tags,this.extent=te||4096}fn.prototype.feature=function(Be){return new mn(this.features[Be],this.options.extent)},mn.prototype.loadGeometry=function(){var Be=this.rawGeometry;this.geometry=[];for(var te=0;te<Be.length;te++){for(var le=Be[te],xe=[],Oe=0;Oe<le.length;Oe++)xe.push(new lt(le[Oe][0],le[Oe][1]));this.geometry.push(xe)}return this.geometry},mn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Be=this.geometry,te=1/0,le=-1/0,xe=1/0,Oe=-1/0,De=0;De<Be.length;De++)for(var Ge=Be[De],tt=0;tt<Ge.length;tt++){var $e=Ge[tt];te=Math.min(te,$e.x),le=Math.max(le,$e.x),xe=Math.min(xe,$e.y),Oe=Math.max(Oe,$e.y)}return[te,xe,le,Oe]},mn.prototype.toGeoJSON=At.prototype.toGeoJSON;var Vt=a.e3,wn=nn;function Ht(Be){var te=new Vt;return function(le,xe){for(var Oe in le.layers)xe.writeMessage(3,Hn,le.layers[Oe])}(Be,te),te.finish()}function Hn(Be,te){var le;te.writeVarintField(15,Be.version||1),te.writeStringField(1,Be.name||""),te.writeVarintField(5,Be.extent||4096);var xe={keys:[],values:[],keycache:{},valuecache:{}};for(le=0;le<Be.length;le++)xe.feature=Be.feature(le),te.writeMessage(2,Jn,xe);var Oe=xe.keys;for(le=0;le<Oe.length;le++)te.writeStringField(3,Oe[le]);var De=xe.values;for(le=0;le<De.length;le++)te.writeMessage(4,xn,De[le])}function Jn(Be,te){var le=Be.feature;le.id!==void 0&&te.writeVarintField(1,le.id),te.writeMessage(2,ir,Be),te.writeVarintField(3,le.type),te.writeMessage(4,qt,le)}function ir(Be,te){var le=Be.feature,xe=Be.keys,Oe=Be.values,De=Be.keycache,Ge=Be.valuecache;for(var tt in le.properties){var $e=le.properties[tt],Je=De[tt];if($e!==null){Je===void 0&&(xe.push(tt),De[tt]=Je=xe.length-1),te.writeVarint(Je);var mt=typeof $e;mt!=="string"&&mt!=="boolean"&&mt!=="number"&&($e=JSON.stringify($e));var gt=mt+":"+$e,$t=Ge[gt];$t===void 0&&(Oe.push($e),Ge[gt]=$t=Oe.length-1),te.writeVarint($t)}}}function Zt(Be,te){return(te<<3)+(7&Be)}function zt(Be){return Be<<1^Be>>31}function qt(Be,te){for(var le=Be.loadGeometry(),xe=Be.type,Oe=0,De=0,Ge=le.length,tt=0;tt<Ge;tt++){var $e=le[tt],Je=1;xe===1&&(Je=$e.length),te.writeVarint(Zt(1,Je));for(var mt=xe===3?$e.length-1:$e.length,gt=0;gt<mt;gt++){gt===1&&xe!==1&&te.writeVarint(Zt(2,mt-1));var $t=$e[gt].x-Oe,_n=$e[gt].y-De;te.writeVarint(zt($t)),te.writeVarint(zt(_n)),Oe+=$t,De+=_n}xe===3&&te.writeVarint(Zt(7,1))}}function xn(Be,te){var le=typeof Be;le==="string"?te.writeStringField(1,Be):le==="boolean"?te.writeBooleanField(7,Be):le==="number"&&(Be%1!=0?te.writeDoubleField(3,Be):Be<0?te.writeSVarintField(6,Be):te.writeVarintField(5,Be))}Pt.exports=Ht,Pt.exports.fromVectorTileJs=Ht,Pt.exports.fromGeojsonVt=function(Be,te){te=te||{};var le={};for(var xe in Be)le[xe]=new wn(Be[xe].features,te),le[xe].name=xe,le[xe].version=te.version,le[xe].extent=te.extent;return Ht({layers:le})},Pt.exports.GeoJSONWrapper=wn;var rr=a.e4(Pt.exports);const Gn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Be=>Be},yr=Math.fround||(Gr=new Float32Array(1),Be=>(Gr[0]=+Be,Gr[0]));var Gr;const mr=3,wr=5,wt=6;class St{constructor(te){this.options=Object.assign(Object.create(Gn),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:le,minZoom:xe,maxZoom:Oe}=this.options;le&&console.time("total time");const De=`prepare ${te.length} points`;le&&console.time(De),this.points=te;const Ge=[];for(let $e=0;$e<te.length;$e++){const Je=te[$e];if(!Je.geometry)continue;const[mt,gt]=Je.geometry.coordinates,$t=yr(pt(mt)),_n=yr(Jt(gt));Ge.push($t,_n,1/0,$e,-1,1),this.options.reduce&&Ge.push(0)}let tt=this.trees[Oe+1]=this._createTree(Ge);le&&console.timeEnd(De);for(let $e=Oe;$e>=xe;$e--){const Je=+Date.now();tt=this.trees[$e]=this._createTree(this._cluster(tt,$e)),le&&console.log("z%d: %d clusters in %dms",$e,tt.numItems,+Date.now()-Je)}return le&&console.timeEnd("total time"),this}getClusters(te,le){let xe=((te[0]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,te[1]));let De=te[2]===180?180:((te[2]+180)%360+360)%360-180;const Ge=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)xe=-180,De=180;else if(xe>De){const gt=this.getClusters([xe,Oe,180,Ge],le),$t=this.getClusters([-180,Oe,De,Ge],le);return gt.concat($t)}const tt=this.trees[this._limitZoom(le)],$e=tt.range(pt(xe),Jt(Ge),pt(De),Jt(Oe)),Je=tt.data,mt=[];for(const gt of $e){const $t=this.stride*gt;mt.push(Je[$t+wr]>1?Ct(Je,$t,this.clusterProps):this.points[Je[$t+mr]])}return mt}getChildren(te){const le=this._getOriginId(te),xe=this._getOriginZoom(te),Oe="No cluster with the specified id.",De=this.trees[xe];if(!De)throw new Error(Oe);const Ge=De.data;if(le*this.stride>=Ge.length)throw new Error(Oe);const tt=this.options.radius/(this.options.extent*Math.pow(2,xe-1)),$e=De.within(Ge[le*this.stride],Ge[le*this.stride+1],tt),Je=[];for(const mt of $e){const gt=mt*this.stride;Ge[gt+4]===te&&Je.push(Ge[gt+wr]>1?Ct(Ge,gt,this.clusterProps):this.points[Ge[gt+mr]])}if(Je.length===0)throw new Error(Oe);return Je}getLeaves(te,le,xe){const Oe=[];return this._appendLeaves(Oe,te,le=le||10,xe=xe||0,0),Oe}getTile(te,le,xe){const Oe=this.trees[this._limitZoom(te)],De=Math.pow(2,te),{extent:Ge,radius:tt}=this.options,$e=tt/Ge,Je=(xe-$e)/De,mt=(xe+1+$e)/De,gt={features:[]};return this._addTileFeatures(Oe.range((le-$e)/De,Je,(le+1+$e)/De,mt),Oe.data,le,xe,De,gt),le===0&&this._addTileFeatures(Oe.range(1-$e/De,Je,1,mt),Oe.data,De,xe,De,gt),le===De-1&&this._addTileFeatures(Oe.range(0,Je,$e/De,mt),Oe.data,-1,xe,De,gt),gt.features.length?gt:null}getClusterExpansionZoom(te){let le=this._getOriginZoom(te)-1;for(;le<=this.options.maxZoom;){const xe=this.getChildren(te);if(le++,xe.length!==1)break;te=xe[0].properties.cluster_id}return le}_appendLeaves(te,le,xe,Oe,De){const Ge=this.getChildren(le);for(const tt of Ge){const $e=tt.properties;if($e&&$e.cluster?De+$e.point_count<=Oe?De+=$e.point_count:De=this._appendLeaves(te,$e.cluster_id,xe,Oe,De):De<Oe?De++:te.push(tt),te.length===xe)break}return De}_createTree(te){const le=new a.cN(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let xe=0;xe<te.length;xe+=this.stride)le.add(te[xe],te[xe+1]);return le.finish(),le.data=te,le}_addTileFeatures(te,le,xe,Oe,De,Ge){for(const tt of te){const $e=tt*this.stride,Je=le[$e+wr]>1;let mt,gt,$t;if(Je)mt=it(le,$e,this.clusterProps),gt=le[$e],$t=le[$e+1];else{const ur=this.points[le[$e+mr]];mt=ur.properties;const[Dn,hr]=ur.geometry.coordinates;gt=pt(Dn),$t=Jt(hr)}const _n={type:1,geometry:[[Math.round(this.options.extent*(gt*De-xe)),Math.round(this.options.extent*($t*De-Oe))]],tags:mt};let An;An=Je||this.options.generateId?le[$e+mr]:this.points[le[$e+mr]].id,An!==void 0&&(_n.id=An),Ge.features.push(_n)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,le){const{radius:xe,extent:Oe,reduce:De,minPoints:Ge}=this.options,tt=xe/(Oe*Math.pow(2,le)),$e=te.data,Je=[],mt=this.stride;for(let gt=0;gt<$e.length;gt+=mt){if($e[gt+2]<=le)continue;$e[gt+2]=le;const $t=$e[gt],_n=$e[gt+1],An=te.within($e[gt],$e[gt+1],tt),ur=$e[gt+wr];let Dn=ur;for(const hr of An){const cn=hr*mt;$e[cn+2]>le&&(Dn+=$e[cn+wr])}if(Dn>ur&&Dn>=Ge){let hr,cn=$t*ur,ei=_n*ur,vr=-1;const dr=(gt/mt<<5)+(le+1)+this.points.length;for(const xi of An){const bi=xi*mt;if($e[bi+2]<=le)continue;$e[bi+2]=le;const Ki=$e[bi+wr];cn+=$e[bi]*Ki,ei+=$e[bi+1]*Ki,$e[bi+4]=dr,De&&(hr||(hr=this._map($e,gt,!0),vr=this.clusterProps.length,this.clusterProps.push(hr)),De(hr,this._map($e,bi)))}$e[gt+4]=dr,Je.push(cn/Dn,ei/Dn,1/0,dr,-1,Dn),De&&Je.push(vr)}else{for(let hr=0;hr<mt;hr++)Je.push($e[gt+hr]);if(Dn>1)for(const hr of An){const cn=hr*mt;if(!($e[cn+2]<=le)){$e[cn+2]=le;for(let ei=0;ei<mt;ei++)Je.push($e[cn+ei])}}}}return Je}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,le,xe){if(te[le+wr]>1){const Ge=this.clusterProps[te[le+wt]];return xe?Object.assign({},Ge):Ge}const Oe=this.points[te[le+mr]].properties,De=this.options.map(Oe);return xe&&De===Oe?Object.assign({},De):De}}function Ct(Be,te,le){return{type:"Feature",id:Be[te+mr],properties:it(Be,te,le),geometry:{type:"Point",coordinates:[(xe=Be[te],360*(xe-.5)),In(Be[te+1])]}};var xe}function it(Be,te,le){const xe=Be[te+wr],Oe=xe>=1e4?`${Math.round(xe/1e3)}k`:xe>=1e3?Math.round(xe/100)/10+"k":xe,De=Be[te+wt],Ge=De===-1?{}:Object.assign({},le[De]);return Object.assign(Ge,{cluster:!0,cluster_id:Be[te+mr],point_count:xe,point_count_abbreviated:Oe})}function pt(Be){return Be/360+.5}function Jt(Be){const te=Math.sin(Be*Math.PI/180),le=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return le<0?0:le>1?1:le}function In(Be){const te=(180-360*Be)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function en(Be,te,le,xe){let Oe=xe;const De=te+(le-te>>1);let Ge,tt=le-te;const $e=Be[te],Je=Be[te+1],mt=Be[le],gt=Be[le+1];for(let $t=te+3;$t<le;$t+=3){const _n=Ye(Be[$t],Be[$t+1],$e,Je,mt,gt);if(_n>Oe)Ge=$t,Oe=_n;else if(_n===Oe){const An=Math.abs($t-De);An<tt&&(Ge=$t,tt=An)}}Oe>xe&&(Ge-te>3&&en(Be,te,Ge,xe),Be[Ge+2]=Oe,le-Ge>3&&en(Be,Ge,le,xe))}function Ye(Be,te,le,xe,Oe,De){let Ge=Oe-le,tt=De-xe;if(Ge!==0||tt!==0){const $e=((Be-le)*Ge+(te-xe)*tt)/(Ge*Ge+tt*tt);$e>1?(le=Oe,xe=De):$e>0&&(le+=Ge*$e,xe+=tt*$e)}return Ge=Be-le,tt=te-xe,Ge*Ge+tt*tt}function Rt(Be,te,le,xe){const Oe={id:Be??null,type:te,geometry:le,tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(te==="Point"||te==="MultiPoint"||te==="LineString")bn(Oe,le);else if(te==="Polygon")bn(Oe,le[0]);else if(te==="MultiLineString")for(const De of le)bn(Oe,De);else if(te==="MultiPolygon")for(const De of le)bn(Oe,De[0]);return Oe}function bn(Be,te){for(let le=0;le<te.length;le+=3)Be.minX=Math.min(Be.minX,te[le]),Be.minY=Math.min(Be.minY,te[le+1]),Be.maxX=Math.max(Be.maxX,te[le]),Be.maxY=Math.max(Be.maxY,te[le+1])}function Pn(Be,te,le,xe){if(!te.geometry)return;const Oe=te.geometry.coordinates;if(Oe&&Oe.length===0)return;const De=te.geometry.type,Ge=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2);let tt=[],$e=te.id;if(le.promoteId?$e=te.properties[le.promoteId]:le.generateId&&($e=xe||0),De==="Point")gn(Oe,tt);else if(De==="MultiPoint")for(const Je of Oe)gn(Je,tt);else if(De==="LineString")er(Oe,tt,Ge,!1);else if(De==="MultiLineString"){if(le.lineMetrics){for(const Je of Oe)tt=[],er(Je,tt,Ge,!1),Be.push(Rt($e,"LineString",tt,te.properties));return}Ur(Oe,tt,Ge,!1)}else if(De==="Polygon")Ur(Oe,tt,Ge,!0);else{if(De!=="MultiPolygon"){if(De==="GeometryCollection"){for(const Je of te.geometry.geometries)Pn(Be,{id:$e,geometry:Je,properties:te.properties},le,xe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Je of Oe){const mt=[];Ur(Je,mt,Ge,!0),tt.push(mt)}}Be.push(Rt($e,De,tt,te.properties))}function gn(Be,te){te.push(hn(Be[0]),Rn(Be[1]),0)}function er(Be,te,le,xe){let Oe,De,Ge=0;for(let $e=0;$e<Be.length;$e++){const Je=hn(Be[$e][0]),mt=Rn(Be[$e][1]);te.push(Je,mt,0),$e>0&&(Ge+=xe?(Oe*mt-Je*De)/2:Math.sqrt(Math.pow(Je-Oe,2)+Math.pow(mt-De,2))),Oe=Je,De=mt}const tt=te.length-3;te[2]=1,en(te,0,tt,le),te[tt+2]=1,te.size=Math.abs(Ge),te.start=0,te.end=te.size}function Ur(Be,te,le,xe){for(let Oe=0;Oe<Be.length;Oe++){const De=[];er(Be[Oe],De,le,xe),te.push(De)}}function hn(Be){return Be/360+.5}function Rn(Be){const te=Math.sin(Be*Math.PI/180),le=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return le<0?0:le>1?1:le}function Kt(Be,te,le,xe,Oe,De,Ge,tt){if(xe/=te,De>=(le/=te)&&Ge<xe)return Be;if(Ge<le||De>=xe)return null;const $e=[];for(const Je of Be){const mt=Je.geometry;let gt=Je.type;const $t=Oe===0?Je.minX:Je.minY,_n=Oe===0?Je.maxX:Je.maxY;if($t>=le&&_n<xe){$e.push(Je);continue}if(_n<le||$t>=xe)continue;let An=[];if(gt==="Point"||gt==="MultiPoint")zi(mt,An,le,xe,Oe);else if(gt==="LineString")li(mt,An,le,xe,Oe,!1,tt.lineMetrics);else if(gt==="MultiLineString")go(mt,An,le,xe,Oe,!1);else if(gt==="Polygon")go(mt,An,le,xe,Oe,!0);else if(gt==="MultiPolygon")for(const ur of mt){const Dn=[];go(ur,Dn,le,xe,Oe,!0),Dn.length&&An.push(Dn)}if(An.length){if(tt.lineMetrics&&gt==="LineString"){for(const ur of An)$e.push(Rt(Je.id,gt,ur,Je.tags));continue}gt!=="LineString"&&gt!=="MultiLineString"||(An.length===1?(gt="LineString",An=An[0]):gt="MultiLineString"),gt!=="Point"&&gt!=="MultiPoint"||(gt=An.length===3?"Point":"MultiPoint"),$e.push(Rt(Je.id,gt,An,Je.tags))}}return $e.length?$e:null}function zi(Be,te,le,xe,Oe){for(let De=0;De<Be.length;De+=3){const Ge=Be[De+Oe];Ge>=le&&Ge<=xe&&Xi(te,Be[De],Be[De+1],Be[De+2])}}function li(Be,te,le,xe,Oe,De,Ge){let tt=vi(Be);const $e=Oe===0?Ao:Za;let Je,mt,gt=Be.start;for(let Dn=0;Dn<Be.length-3;Dn+=3){const hr=Be[Dn],cn=Be[Dn+1],ei=Be[Dn+2],vr=Be[Dn+3],dr=Be[Dn+4],xi=Oe===0?hr:cn,bi=Oe===0?vr:dr;let Ki=!1;Ge&&(Je=Math.sqrt(Math.pow(hr-vr,2)+Math.pow(cn-dr,2))),xi<le?bi>le&&(mt=$e(tt,hr,cn,vr,dr,le),Ge&&(tt.start=gt+Je*mt)):xi>xe?bi<xe&&(mt=$e(tt,hr,cn,vr,dr,xe),Ge&&(tt.start=gt+Je*mt)):Xi(tt,hr,cn,ei),bi<le&&xi>=le&&(mt=$e(tt,hr,cn,vr,dr,le),Ki=!0),bi>xe&&xi<=xe&&(mt=$e(tt,hr,cn,vr,dr,xe),Ki=!0),!De&&Ki&&(Ge&&(tt.end=gt+Je*mt),te.push(tt),tt=vi(Be)),Ge&&(gt+=Je)}let $t=Be.length-3;const _n=Be[$t],An=Be[$t+1],ur=Oe===0?_n:An;ur>=le&&ur<=xe&&Xi(tt,_n,An,Be[$t+2]),$t=tt.length-3,De&&$t>=3&&(tt[$t]!==tt[0]||tt[$t+1]!==tt[1])&&Xi(tt,tt[0],tt[1],tt[2]),tt.length&&te.push(tt)}function vi(Be){const te=[];return te.size=Be.size,te.start=Be.start,te.end=Be.end,te}function go(Be,te,le,xe,Oe,De){for(const Ge of Be)li(Ge,te,le,xe,Oe,De,!1)}function Xi(Be,te,le,xe){Be.push(te,le,xe)}function Ao(Be,te,le,xe,Oe,De){const Ge=(De-te)/(xe-te);return Xi(Be,De,le+(Oe-le)*Ge,1),Ge}function Za(Be,te,le,xe,Oe,De){const Ge=(De-le)/(Oe-le);return Xi(Be,te+(xe-te)*Ge,De,1),Ge}function _o(Be,te){const le=[];for(let xe=0;xe<Be.length;xe++){const Oe=Be[xe],De=Oe.type;let Ge;if(De==="Point"||De==="MultiPoint"||De==="LineString")Ge=Wt(Oe.geometry,te);else if(De==="MultiLineString"||De==="Polygon"){Ge=[];for(const tt of Oe.geometry)Ge.push(Wt(tt,te))}else if(De==="MultiPolygon"){Ge=[];for(const tt of Oe.geometry){const $e=[];for(const Je of tt)$e.push(Wt(Je,te));Ge.push($e)}}le.push(Rt(Oe.id,De,Ge,Oe.tags))}return le}function Wt(Be,te){const le=[];le.size=Be.size,Be.start!==void 0&&(le.start=Be.start,le.end=Be.end);for(let xe=0;xe<Be.length;xe+=3)le.push(Be[xe]+te,Be[xe+1],Be[xe+2]);return le}function Ln(Be,te){if(Be.transformed)return Be;const le=1<<Be.z,xe=Be.x,Oe=Be.y;for(const De of Be.features){const Ge=De.geometry,tt=De.type;if(De.geometry=[],tt===1)for(let $e=0;$e<Ge.length;$e+=2)De.geometry.push(Or(Ge[$e],Ge[$e+1],te,le,xe,Oe));else for(let $e=0;$e<Ge.length;$e++){const Je=[];for(let mt=0;mt<Ge[$e].length;mt+=2)Je.push(Or(Ge[$e][mt],Ge[$e][mt+1],te,le,xe,Oe));De.geometry.push(Je)}}return Be.transformed=!0,Be}function Or(Be,te,le,xe,Oe,De){return[Math.round(le*(Be*xe-Oe)),Math.round(le*(te*xe-De))]}function Pr(Be,te,le,xe,Oe){const De=te===Oe.maxZoom?0:Oe.tolerance/((1<<te)*Oe.extent),Ge={features:[],numPoints:0,numSimplified:0,numFeatures:Be.length,source:null,x:le,y:xe,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const tt of Be)Ei(Ge,tt,De,Oe);return Ge}function Ei(Be,te,le,xe){const Oe=te.geometry,De=te.type,Ge=[];if(Be.minX=Math.min(Be.minX,te.minX),Be.minY=Math.min(Be.minY,te.minY),Be.maxX=Math.max(Be.maxX,te.maxX),Be.maxY=Math.max(Be.maxY,te.maxY),De==="Point"||De==="MultiPoint")for(let tt=0;tt<Oe.length;tt+=3)Ge.push(Oe[tt],Oe[tt+1]),Be.numPoints++,Be.numSimplified++;else if(De==="LineString")Rr(Ge,Oe,Be,le,!1,!1);else if(De==="MultiLineString"||De==="Polygon")for(let tt=0;tt<Oe.length;tt++)Rr(Ge,Oe[tt],Be,le,De==="Polygon",tt===0);else if(De==="MultiPolygon")for(let tt=0;tt<Oe.length;tt++){const $e=Oe[tt];for(let Je=0;Je<$e.length;Je++)Rr(Ge,$e[Je],Be,le,!0,Je===0)}if(Ge.length){let tt=te.tags||null;if(De==="LineString"&&xe.lineMetrics){tt={};for(const Je in te.tags)tt[Je]=te.tags[Je];tt.mapbox_clip_start=Oe.start/Oe.size,tt.mapbox_clip_end=Oe.end/Oe.size}const $e={geometry:Ge,type:De==="Polygon"||De==="MultiPolygon"?3:De==="LineString"||De==="MultiLineString"?2:1,tags:tt};te.id!==null&&($e.id=te.id),Be.features.push($e)}}function Rr(Be,te,le,xe,Oe,De){const Ge=xe*xe;if(xe>0&&te.size<(Oe?Ge:xe))return void(le.numPoints+=te.length/3);const tt=[];for(let $e=0;$e<te.length;$e+=3)(xe===0||te[$e+2]>Ge)&&(le.numSimplified++,tt.push(te[$e],te[$e+1])),le.numPoints++;Oe&&function($e,Je){let mt=0;for(let gt=0,$t=$e.length,_n=$t-2;gt<$t;_n=gt,gt+=2)mt+=($e[gt]-$e[_n])*($e[gt+1]+$e[_n+1]);if(mt>0===Je)for(let gt=0,$t=$e.length;gt<$t/2;gt+=2){const _n=$e[gt],An=$e[gt+1];$e[gt]=$e[$t-2-gt],$e[gt+1]=$e[$t-1-gt],$e[$t-2-gt]=_n,$e[$t-1-gt]=An}}(tt,De),Be.push(tt)}const us={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class $i{constructor(te,le){const xe=(le=this.options=function(De,Ge){for(const tt in Ge)De[tt]=Ge[tt];return De}(Object.create(us),le)).debug;if(xe&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");let Oe=function(De,Ge){const tt=[];if(De.type==="FeatureCollection")for(let $e=0;$e<De.features.length;$e++)Pn(tt,De.features[$e],Ge,$e);else Pn(tt,De.type==="Feature"?De:{geometry:De},Ge);return tt}(te,le);this.tiles={},this.tileCoords=[],xe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Oe=function(De,Ge){const tt=Ge.buffer/Ge.extent;let $e=De;const Je=Kt(De,1,-1-tt,tt,0,-1,2,Ge),mt=Kt(De,1,1-tt,2+tt,0,-1,2,Ge);return(Je||mt)&&($e=Kt(De,1,-tt,1+tt,0,-1,2,Ge)||[],Je&&($e=_o(Je,1).concat($e)),mt&&($e=$e.concat(_o(mt,-1)))),$e}(Oe,le),Oe.length&&this.splitTile(Oe,0,0,0),xe&&(Oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(te,le,xe,Oe,De,Ge,tt){const $e=[te,le,xe,Oe],Je=this.options,mt=Je.debug;for(;$e.length;){Oe=$e.pop(),xe=$e.pop(),le=$e.pop(),te=$e.pop();const gt=1<<le,$t=si(le,xe,Oe);let _n=this.tiles[$t];if(!_n&&(mt>1&&console.time("creation"),_n=this.tiles[$t]=Pr(te,le,xe,Oe,Je),this.tileCoords.push({z:le,x:xe,y:Oe}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,xe,Oe,_n.numFeatures,_n.numPoints,_n.numSimplified),console.timeEnd("creation"));const Ki=`z${le}`;this.stats[Ki]=(this.stats[Ki]||0)+1,this.total++}if(_n.source=te,De==null){if(le===Je.indexMaxZoom||_n.numPoints<=Je.indexMaxPoints)continue}else{if(le===Je.maxZoom||le===De)continue;if(De!=null){const Ki=De-le;if(xe!==Ge>>Ki||Oe!==tt>>Ki)continue}}if(_n.source=null,te.length===0)continue;mt>1&&console.time("clipping");const An=.5*Je.buffer/Je.extent,ur=.5-An,Dn=.5+An,hr=1+An;let cn=null,ei=null,vr=null,dr=null,xi=Kt(te,gt,xe-An,xe+Dn,0,_n.minX,_n.maxX,Je),bi=Kt(te,gt,xe+ur,xe+hr,0,_n.minX,_n.maxX,Je);te=null,xi&&(cn=Kt(xi,gt,Oe-An,Oe+Dn,1,_n.minY,_n.maxY,Je),ei=Kt(xi,gt,Oe+ur,Oe+hr,1,_n.minY,_n.maxY,Je),xi=null),bi&&(vr=Kt(bi,gt,Oe-An,Oe+Dn,1,_n.minY,_n.maxY,Je),dr=Kt(bi,gt,Oe+ur,Oe+hr,1,_n.minY,_n.maxY,Je),bi=null),mt>1&&console.timeEnd("clipping"),$e.push(cn||[],le+1,2*xe,2*Oe),$e.push(ei||[],le+1,2*xe,2*Oe+1),$e.push(vr||[],le+1,2*xe+1,2*Oe),$e.push(dr||[],le+1,2*xe+1,2*Oe+1)}}getTile(te,le,xe){te=+te,le=+le,xe=+xe;const Oe=this.options,{extent:De,debug:Ge}=Oe;if(te<0||te>24)return null;const tt=1<<te,$e=si(te,le=le+tt&tt-1,xe);if(this.tiles[$e])return Ln(this.tiles[$e],De);Ge>1&&console.log("drilling down to z%d-%d-%d",te,le,xe);let Je,mt=te,gt=le,$t=xe;for(;!Je&&mt>0;)mt--,gt>>=1,$t>>=1,Je=this.tiles[si(mt,gt,$t)];return Je&&Je.source?(Ge>1&&(console.log("found parent tile z%d-%d-%d",mt,gt,$t),console.time("drilling down")),this.splitTile(Je.source,mt,gt,$t,te,le,xe),Ge>1&&console.timeEnd("drilling down"),this.tiles[$e]?Ln(this.tiles[$e],De):null):null}}function si(Be,te,le){return 32*((1<<Be)*le+te)+Be}function no(Be,te){const le=Be.tileID.canonical;if(!this._geoJSONIndex)return te(null,null);const xe=this._geoJSONIndex.getTile(le.z,le.x,le.y);if(!xe)return te(null,null);const Oe=new we(xe.features);let De=rr(Oe);De.byteOffset===0&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),te(null,{vectorTile:Oe,rawData:De.buffer})}class ro extends W{constructor(te,le,xe,Oe,De,Ge){super(te,le,xe,Oe,no,Ge),De&&(this.loadGeoJSON=De),this._dynamicIndex=new X}loadData(te,le){const xe=te&&te.request,Oe=xe&&xe.collectResourceTiming;this.loadGeoJSON(te,(De,Ge)=>{if(De||!Ge)return le(De);if(typeof Ge!="object")return le(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{try{if(te.filter){const $e=a.z(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if($e.result==="error")throw new Error($e.value.map(Je=>`${Je.key}: ${Je.message}`).join(", "));Ge.features=Ge.features.filter(Je=>$e.value.evaluate({zoom:0},Je))}te.dynamic?(Ge.type==="Feature"&&(Ge={type:"FeatureCollection",features:[Ge]}),te.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ge.features,this.loaded),te.cluster&&(Ge.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=te.cluster?new St(function({superclusterOptions:$e,clusterProperties:Je}){if(!Je||!$e)return $e;const mt={},gt={},$t={accumulated:null,zoom:0},_n={properties:null},An=Object.keys(Je);for(const ur of An){const[Dn,hr]=Je[ur],cn=a.z(hr),ei=a.z(typeof Dn=="string"?[Dn,["accumulated"],["get",ur]]:Dn);mt[ur]=cn.value,gt[ur]=ei.value}return $e.map=ur=>{_n.properties=ur;const Dn={};for(const hr of An)Dn[hr]=mt[hr].evaluate($t,_n);return Dn},$e.reduce=(ur,Dn)=>{_n.properties=Dn;for(const hr of An)$t.accumulated=ur[hr],ur[hr]=gt[hr].evaluate($t,_n)},$e}(te)).load(Ge.features):te.dynamic?this._dynamicIndex:function($e,Je){return new $i($e,Je)}(Ge,te.geojsonVtOptions)}catch($e){return le($e)}const tt={};if(Oe){const $e=I(xe);$e&&(tt.resourceTiming={},tt.resourceTiming[te.source]=JSON.parse(JSON.stringify($e)))}le(null,tt)}})}reloadTile(te,le){const xe=this.loaded;return xe&&xe[te.uid]?te.partial?le(null,void 0):super.reloadTile(te,le):this.loadTile(te,le)}loadGeoJSON(te,le){if(te.request)a.h(te.request,le);else{if(typeof te.data!="string")return le(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));try{return le(null,JSON.parse(te.data))}catch{return le(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(te,le){try{le(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(xe){le(xe)}}getClusterChildren(te,le){try{le(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(xe){le(xe)}}getClusterLeaves(te,le){try{le(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(xe){le(xe)}}}class qr{constructor(te,le){this.tileID=new a.aQ(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=te.projection,this.brightness=le}parse(te,le,xe,Oe){this.status="parsing";const De=new a.aQ(xe.tileID.overscaledZ,xe.tileID.wrap,xe.tileID.canonical.z,xe.tileID.canonical.x,xe.tileID.canonical.y),Ge={},tt=le.familiesBySource[xe.source],$e=new a.dQ(De,xe.promoteId);return $e.bucketLayerIDs=[],$e.is3DTile=!0,a.e6(te).then(Je=>{if(!Je)return Oe(new Error("Could not parse tile"));const mt=a.e7(Je,1/a.b7(xe.tileID.canonical)),gt=Je.json.extensionsUsed&&Je.json.extensionsUsed.includes("MAPBOX_mesh_features")||Je.json.asset.extras&&Je.json.asset.extras.MAPBOX_mesh_features,$t=Je.json.extensionsUsed&&Je.json.extensionsUsed.includes("EXT_meshopt_compression"),_n=new a.Y(this.zoom,{brightness:this.brightness});for(const An in tt)for(const ur of tt[An]){const Dn=ur[0];$e.bucketLayerIDs.push(ur.map(cn=>cn.id)),Dn.recalculate(_n,[]);const hr=new a.e8(mt,De,gt,$t,this.brightness,$e);gt||(hr.needsUpload=!0),Ge[Dn.fqid]=hr,hr.evaluate(Dn)}this.status="done",Oe(null,{buckets:Ge,featureIndex:$e})}).catch(Je=>Oe(new Error(Je.message)))}}class Si{constructor(te,le,xe,Oe,De,Ge){this.actor=te,this.layerIndex=le,this.brightness=Ge,this.loading={},this.loaded={}}loadTile(te,le){const xe=te.uid,Oe=this.loading[xe]=new qr(te,this.brightness);a.e5(te.request,(De,Ge)=>{const tt=!this.loading[xe];return delete this.loading[xe],tt||De?(Oe.status="done",tt||(this.loaded[xe]=Oe),le(De)):Ge&&Ge.byteLength!==0?void Oe.parse(Ge,this.layerIndex,te,($e,Je)=>{Oe.status="done",this.loaded=this.loaded||{},this.loaded[xe]=Oe,$e||!Je?le($e):le(null,Je)}):(Oe.status="done",this.loaded[xe]=Oe,le())})}reloadTile(te,le){const xe=this.loaded,Oe=te.uid;if(xe&&xe[Oe]){const De=xe[Oe];De.projection=te.projection,De.brightness=te.brightness;const Ge=(tt,$e)=>{De.reloadCallback&&(delete De.reloadCallback,this.loadTile(te,le)),le(tt,$e)};De.status==="parsing"?De.reloadCallback=Ge:De.status==="done"&&this.loadTile(te,le)}}abortTile(te,le){const xe=te.uid;this.loading[xe]&&delete this.loading[xe],le()}removeTile(te,le){const xe=this.loaded,Oe=te.uid;xe&&xe[Oe]&&delete xe[Oe],le()}}class El{constructor(te){this.self=te,this.actor=new a.e9(te,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.aK({name:"mercator"}),this.workerSourceTypes={vector:W,geojson:ro,"batched-model":Si},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(le,xe)=>{if(this.workerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.workerSourceTypes[le]=xe},this.self.registerRTLTextPlugin=le=>{if(a.ea.isParsed())throw new Error("RTL text plugin already registered.");a.ea.applyArabicShaping=le.applyArabicShaping,a.ea.processBidirectionalText=le.processBidirectionalText,a.ea.processStyledBidirectionalText=le.processStyledBidirectionalText}}clearCaches(te,le,xe){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],delete this.demWorkerSources[te],delete this.rasterArrayWorkerSource,xe()}checkIfReady(te,le,xe){xe()}setReferrer(te,le){this.referrer=le}spriteLoaded(te,{scope:le,isLoaded:xe}){if(this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),this.isSpriteLoaded[te][le]=xe,this.workerSources[te]&&this.workerSources[te][le])for(const Oe in this.workerSources[te][le]){const De=this.workerSources[te][le][Oe];for(const Ge in De){const tt=De[Ge];tt instanceof W&&(tt.isSpriteLoaded=xe,tt.fire(new a.g("isSpriteLoaded")))}}}setImages(te,{scope:le,images:xe},Oe){if(this.availableImages[te]||(this.availableImages[te]={}),this.availableImages[te][le]=xe,this.workerSources[te]&&this.workerSources[te][le]){for(const De in this.workerSources[te][le]){const Ge=this.workerSources[te][le][De];for(const tt in Ge)Ge[tt].availableImages=xe}Oe()}else Oe()}setProjection(te,le){this.projections[te]=a.aK(le)}setBrightness(te,le,xe){this.brightness=le,xe()}setLayers(te,le,xe){this.getLayerIndex(te,le.scope).replace(le.layers,le.options),xe()}updateLayers(te,le,xe){this.getLayerIndex(te,le.scope).update(le.layers,le.removedIds,le.options),xe()}loadTile(te,le,xe){le.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,le.type,le.source,le.scope).loadTile(le,xe)}loadDEMTile(te,le,xe){this.getDEMWorkerSource(te,le.source,le.scope).loadTile(le,xe)}decodeRasterArray(te,le,xe){this.getRasterArrayWorkerSource().decodeRasterArray(le,xe)}reloadTile(te,le,xe){le.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,le.type,le.source,le.scope).reloadTile(le,xe)}abortTile(te,le,xe){this.getWorkerSource(te,le.type,le.source,le.scope).abortTile(le,xe)}removeTile(te,le,xe){this.getWorkerSource(te,le.type,le.source,le.scope).removeTile(le,xe)}removeSource(te,le,xe){if(!(this.workerSources[te]&&this.workerSources[te][le.scope]&&this.workerSources[te][le.scope][le.type]&&this.workerSources[te][le.scope][le.type][le.source]))return;const Oe=this.workerSources[te][le.scope][le.type][le.source];delete this.workerSources[te][le.scope][le.type][le.source],Oe.removeSource!==void 0?Oe.removeSource(le,xe):xe()}loadWorkerSource(te,le,xe){try{this.self.importScripts(le.url),xe()}catch(Oe){xe(Oe.toString())}}syncRTLPluginState(te,le,xe){try{a.ea.setState(le);const Oe=a.ea.getPluginURL();if(a.ea.isLoaded()&&!a.ea.isParsed()&&Oe!=null){this.self.importScripts(Oe);const De=a.ea.isParsed();xe(De?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Oe}`),De)}}catch(Oe){xe(Oe.toString())}}setDracoUrl(te,le){this.dracoUrl=le}getAvailableImages(te,le){this.availableImages[te]||(this.availableImages[te]={});let xe=this.availableImages[te][le];return xe||(xe=[]),xe}getLayerIndex(te,le){this.layerIndexes[te]||(this.layerIndexes[te]={});let xe=this.layerIndexes[te][le];return xe||(xe=this.layerIndexes[te][le]=new F,xe.scope=le),xe}getWorkerSource(te,le,xe,Oe){return this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][Oe]||(this.workerSources[te][Oe]={}),this.workerSources[te][Oe][le]||(this.workerSources[te][Oe][le]={}),this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),this.workerSources[te][Oe][le][xe]||(this.workerSources[te][Oe][le][xe]=new this.workerSourceTypes[le]({send:(De,Ge,tt,$e,Je,mt)=>{this.actor.send(De,Ge,tt,te,Je,mt)},scheduler:this.actor.scheduler},this.getLayerIndex(te,Oe),this.getAvailableImages(te,Oe),this.isSpriteLoaded[te][Oe],void 0,this.brightness)),this.workerSources[te][Oe][le][xe]}getDEMWorkerSource(te,le,xe){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][xe]||(this.demWorkerSources[te][xe]={}),this.demWorkerSources[te][xe][le]||(this.demWorkerSources[te][xe][le]=new Q),this.demWorkerSources[te][xe][le]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new K),this.rasterArrayWorkerSource}enforceCacheSizeLimit(te,le){a.eb(le)}getWorkerPerformanceMetrics(te,le,xe){xe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new El(self)),El}),_(["./shared"],function(a){var I=D;function D(g){return!function(l){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,b,T=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(T);try{b=new Worker(S),y=!0}catch{y=!1}return b&&b.terminate(),URL.revokeObjectURL(S),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var b=y.getContext("2d");if(!b)return!1;var T=b.getImageData(0,0,1,1);return T&&T.width===y.width}()?(O[d=l&&l.failIfMajorPerformanceCaveat]===void 0&&(O[d]=function(y){var b,T=function(S){var C=document.createElement("canvas"),k=Object.create(D.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=S,C.getContext("webgl2",k)}(y);if(!T)return!1;try{b=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!b||T.isContextLost())&&(T.shaderSource(b,"void main() {}"),T.compileShader(b),T.getShaderParameter(b,T.COMPILE_STATUS)===!0)}(d)),O[d]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var d}(g)}var O={};function F(g,l,d){const y=document.createElement(g);return l!=null&&(y.className=l),d&&d.appendChild(y),y}function Z(g,l,d){const y=document.createElementNS("http://www.w3.org/2000/svg",g);for(const b of Object.keys(l))y.setAttributeNS(null,b,String(l[b]));return d&&d.appendChild(y),y}D.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const J=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ne=J&&J.userSelect!==void 0?"userSelect":"WebkitUserSelect";let se;function W(){J&&ne&&(se=J[ne],J[ne]="none")}function Q(){J&&ne&&(J[ne]=se)}function K(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",K,!0)}function pe(){window.addEventListener("click",K,!0),window.setTimeout(()=>{window.removeEventListener("click",K,!0)},0)}function Te(g,l){const d=g.getBoundingClientRect();return de(g,d,l)}function we(g,l){const d=g.getBoundingClientRect(),y=[];for(let b=0;b<l.length;b++)y.push(de(g,d,l[b]));return y}function oe(g){return window.InstallTrigger!==void 0&&g.button===2&&g.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function de(g,l,d){const y=g.offsetWidth===l.width?1:g.offsetWidth/l.width;return new a.P((d.clientX-l.left)*y,(d.clientY-l.top)*y)}class X{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(l,d){this._updatedSourceCaches[l]=d,this.setDirty()}discardSourceCacheUpdate(l){delete this._updatedSourceCaches[l]}updateLayer(l){const d=l.scope;this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._updatedLayers[d].add(l.id),this.setDirty()}removeLayer(l){const d=l.scope;this._removedLayers[d]=this._removedLayers[d]||{},this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._removedLayers[d][l.id]=l,this._updatedLayers[d].delete(l.id),this._updatedPaintProps.delete(l.fqid),this.setDirty()}getRemovedLayer(l){return this._removedLayers[l.scope]?this._removedLayers[l.scope][l.id]:null}discardLayerRemoval(l){this._removedLayers[l.scope]&&delete this._removedLayers[l.scope][l.id]}getLayerUpdatesByScope(){const l={};for(const d in this._updatedLayers)l[d]=l[d]||{},l[d].updatedIds=Array.from(this._updatedLayers[d].values());for(const d in this._removedLayers)l[d]=l[d]||{},l[d].removedIds=Object.keys(this._removedLayers[d]);return l}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(l){this._updatedPaintProps.add(l.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(l){this._updatedImages.add(l),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const ge={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class be{constructor(l,d,y,b,T,S){this.length=d.length,this.attributes=y,this.itemSize=d.bytesPerElement,this.dynamicDraw=b,this.instanceCount=S,this.context=l;const C=l.gl;this.buffer=C.createBuffer(),l.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||T||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,d){for(let y=0;y<this.attributes.length;y++){const b=d.attributes[this.attributes[y].name];b!==void 0&&l.enableVertexAttribArray(b)}}setVertexAttribPointers(l,d,y){for(let b=0;b<this.attributes.length;b++){const T=this.attributes[b],S=d.attributes[T.name];S!==void 0&&l.vertexAttribPointer(S,T.components,l[ge[T.type]],!1,this.itemSize,T.offset+this.itemSize*(y||0))}}setVertexAttribDivisor(l,d,y){for(let b=0;b<this.attributes.length;b++){const T=d.attributes[this.attributes[b].name];T!==void 0&&this.instanceCount&&this.instanceCount>0&&l.vertexAttribDivisor(T,y)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ke{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ee extends ke{getDefault(){return a.C.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Lt extends ke{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class jt extends ke{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Qt extends ke{getDefault(){return[!0,!0,!0,!0]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Pt extends ke{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class lt extends ke{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class At extends ke{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const d=this.current;(l.func!==d.func||l.ref!==d.ref||l.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class nn extends ke{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class fn extends ke{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=l,this.dirty=!1}}class mn extends ke{getDefault(){return[0,1]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class Vt extends ke{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=l,this.dirty=!1}}class wn extends ke{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Ht extends ke{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.BLEND):d.disable(d.BLEND),this.current=l,this.dirty=!1}}class Hn extends ke{getDefault(){const l=this.gl;return[l.ONE,l.ZERO,l.ONE,l.ZERO]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.blendFuncSeparate(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Jn extends ke{getDefault(){return a.C.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class ir extends ke{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(l,l),this.current=l,this.dirty=!1)}}class Zt extends ke{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=l,this.dirty=!1}}class zt extends ke{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class qt extends ke{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let xn=class extends ke{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class rr extends ke{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class Gn extends ke{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class yr extends ke{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Gr extends ke{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class mr extends ke{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class wr extends ke{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class wt extends ke{getDefault(){return null}set(l){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class St extends ke{getDefault(){return null}set(l){this.gl&&(l!==this.current||this.dirty)&&(this.gl.bindVertexArray(l),this.current=l,this.dirty=!1)}}class Ct extends ke{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class it extends ke{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class pt extends ke{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Jt extends ke{constructor(l,d){super(l),this.context=l,this.parent=d}getDefault(){return null}}class In extends Jt{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class en extends Jt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Ye extends Jt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,this.attachment(),d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Rt extends en{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class bn{constructor(l,d,y,b,T){this.context=l,this.width=d,this.height=y;const S=this.framebuffer=l.gl.createFramebuffer();b&&(this.colorAttachment=new In(l,S)),T&&(this.depthAttachmentType=T,this.depthAttachment=T==="renderbuffer"?new en(l,S):new Ye(l,S))}destroy(){const l=this.context.gl;if(this.colorAttachment){const d=this.colorAttachment.get();d&&l.deleteTexture(d)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const d=this.depthAttachment.get();d&&l.deleteRenderbuffer(d)}else{const d=this.depthAttachment.get();d&&l.deleteTexture(d)}l.deleteFramebuffer(this.framebuffer)}}class Pn{constructor(l,d){this.gl=l,this.clearColor=new Ee(this),this.clearDepth=new Lt(this),this.clearStencil=new jt(this),this.colorMask=new Qt(this),this.depthMask=new Pt(this),this.stencilMask=new lt(this),this.stencilFunc=new At(this),this.stencilOp=new nn(this),this.stencilTest=new fn(this),this.depthRange=new mn(this),this.depthTest=new Vt(this),this.depthFunc=new wn(this),this.blend=new Ht(this),this.blendFunc=new Hn(this),this.blendColor=new Jn(this),this.blendEquation=new ir(this),this.cullFace=new Zt(this),this.cullFaceSide=new zt(this),this.frontFace=new qt(this),this.program=new xn(this),this.activeTexture=new rr(this),this.viewport=new Gn(this),this.bindFramebuffer=new yr(this),this.bindRenderbuffer=new Gr(this),this.bindTexture=new mr(this),this.bindVertexBuffer=new wr(this),this.bindElementBuffer=new wt(this),this.bindVertexArrayOES=new St(this),this.pixelStoreUnpack=new Ct(this),this.pixelStoreUnpackPremultiplyAlpha=new it(this),this.pixelStoreUnpackFlipY=new pt(this),this.options=d?{...d}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=l.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),this.maxPointSize=l.getParameter(l.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,d,y){return new a.I(this,l,d,y)}createVertexBuffer(l,d,y,b,T){return new be(this,l,d,y,b,T)}createRenderbuffer(l,d,y){const b=this.gl,T=b.createRenderbuffer();return this.bindRenderbuffer.set(T),b.renderbufferStorage(b.RENDERBUFFER,l,d,y),this.bindRenderbuffer.set(null),T}createFramebuffer(l,d,y,b){return new bn(this,l,d,y,b)}clear({color:l,depth:d,stencil:y,colorMask:b}){const T=this.gl;let S=0;l&&(S|=T.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set(b||[!0,!0,!0,!0])),d!==void 0&&(S|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),y!==void 0&&(S|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),T.clear(S)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){a.d(l.blendFunction,a.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor),l.blendEquation?this.blendEquation.set(l.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(l.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class gn{constructor(l,d,y,b){const T={width:y[0],height:y[1],data:null},S=l.gl;this.targetColorTexture=new a.T(l,T,S.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new a.T(l,T,S.RGBA,{useMipmap:!1}),this.context=l,this.updateParticleTexture(d,b),this.lastInvalidatedAt=0}updateParticleTexture(l,d){if(this.particleTextureDimension===d.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const y=this.context.gl,b=d.width*d.height;this.particleTexture0=new a.T(this.context,d,y.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new a.T(this.context,d,y.RGBA,{premultiply:!1,useMipmap:!1});const T=new a.S;T.reserve(b);for(let S=0;S<b;S++)T.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(T,a.p.members,!0),this.particleSegment=a.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=d.width}update(l){return!(this.lastInvalidatedAt<l&&(this.lastInvalidatedAt=a.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class er extends a.E{constructor(l){super(),this.requestManager=l,this.models={"":{}},this.numModelsLoading={}}loadModel(l,d){return a.l(this.requestManager.transformRequest(d,a.R.Model).url).then(y=>{if(!y)return;const b=a.c(y),T=new a.M(l,void 0,void 0,b);return T.computeBoundsAndApplyParent(),T}).catch(y=>{if(y&&y.status===404)return null;this.fire(new a.f(new Error(`Could not load model ${l} from ${d}: ${y.message}`)))})}load(l,d){this.models[d]||(this.models[d]={});const y=Object.keys(l);this.numModelsLoading[d]=(this.numModelsLoading[d]||0)+y.length;const b=[];for(const T of y)b.push(this.loadModel(T,l[T]));Promise.allSettled(b).then(T=>{for(let S=0;S<T.length;S++){const{status:C,value:k}=T[S];C==="fulfilled"&&k&&(this.models[d][y[S]]={model:k,numReferences:1})}this.numModelsLoading[d]-=y.length,this.fire(new a.g("data",{dataType:"style"}))}).catch(T=>{this.fire(new a.f(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const l in this.numModelsLoading)if(this.numModelsLoading[l]>0)return!1;return!0}hasModel(l,d){return!!this.getModel(l,d)}getModel(l,d){return this.models[d]||(this.models[d]={}),this.models[d][l]?this.models[d][l].model:void 0}addModel(l,d,y){this.models[y]||(this.models[y]={}),this.hasModel(l,y)&&this.models[y][l].numReferences++,this.load({[l]:this.requestManager.normalizeModelURL(d)},y)}addModels(l,d){this.models[d]||(this.models[d]={});const y={};for(const b in l)this.models[d][b]={},y[b]=this.requestManager.normalizeModelURL(l[b]);this.load(y,d)}addModelsFromBucket(l,d){this.models[d]||(this.models[d]={});const y={};for(const b of l)this.hasModel(b,d)?this.models[d][b].numReferences++:y[b]=this.requestManager.normalizeModelURL(b);this.load(y,d)}removeModel(l,d){if(this.models[d]&&this.models[d][l]&&(this.models[d][l].numReferences--,this.models[d][l].numReferences===0)){const y=this.models[d][l].model;delete this.models[d][l],y.destroy()}}listModels(l){return this.models[l]||(this.models[l]={}),Object.keys(this.models[l])}upload(l,d){this.models[d]||(this.models[d]={});for(const y in this.models[d])this.models[d][y].model&&this.models[d][y].model.upload(l.context)}}function Ur(g){const{userImage:l}=g;return!!(l&&l.render&&l.render())&&(g.data.replace(new Uint8Array(l.data.buffer)),!0)}class hn extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(l){this.images[l]={},this.loaded[l]=!1,this.updatedImages[l]={},this.patterns[l]={},this.callbackDispatchedThisFrame[l]={},this.atlasImage[l]=new a.j({width:1,height:1})}isLoaded(){for(const l in this.loaded)if(!this.loaded[l])return!1;return!0}setLoaded(l,d){if(this.loaded[d]!==l&&(this.loaded[d]=l,l)){for(const{ids:y,callback:b}of this.requestors)this._notify(y,d,b);this.requestors=[]}}hasImage(l,d){return!!this.getImage(l,d)}getImage(l,d){return this.images[d][l]}addImage(l,d,y){this._validate(l,y)&&(this.images[d][l]=y)}_validate(l,d){let y=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new a.f(new Error(`Image "${l}" has invalid "stretchX" value`))),y=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new a.f(new Error(`Image "${l}" has invalid "stretchY" value`))),y=!1),this._validateContent(d.content,d)||(this.fire(new a.f(new Error(`Image "${l}" has invalid "content" value`))),y=!1),y}_validateStretch(l,d){if(!l)return!0;let y=0;for(const b of l){if(b[0]<y||b[1]<b[0]||d<b[1])return!1;y=b[1]}return!0}_validateContent(l,d){return!(l&&(l.length!==4||l[0]<0||d.data.width<l[0]||l[1]<0||d.data.height<l[1]||l[2]<0||d.data.width<l[2]||l[3]<0||d.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,d,y){y.version=this.images[d][l].version+1,this.images[d][l]=y,this.updatedImages[d][l]=!0}removeImage(l,d){const y=this.images[d][l];delete this.images[d][l],delete this.patterns[d][l],y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(l){return Object.keys(this.images[l])}getImages(l,d,y){let b=!0;const T=!!this.loaded[d];if(!T)for(const S of l)this.images[d][S]||(b=!1);T||b?this._notify(l,d,y):this.requestors.push({ids:l,scope:d,callback:y})}getUpdatedImages(l){return this.updatedImages[l]}_notify(l,d,y){const b={};for(const T of l){this.images[d][T]||this.fire(new a.g("styleimagemissing",{id:T}));const S=this.images[d][T];S?b[T]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:a.w(`Image "${T}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}y(null,b)}getPixelSize(l){const{width:d,height:y}=this.atlasImage[l];return{width:d,height:y}}getPattern(l,d,y){const b=this.patterns[d][l],T=this.getImage(l,d);if(!T)return null;if(b&&b.position.version===T.version)return b.position;if(b)b.position.version=T.version;else{const S={w:T.data.width+2,h:T.data.height+2,x:0,y:0},C=new a.m(S,T);this.patterns[d][l]={bin:S,position:C}}return this._updatePatternAtlas(d,y),this.patterns[d][l].position}bind(l,d){const y=l.gl;let b=this.atlasTexture[d];b?this.dirty&&(b.update(this.atlasImage[d]),this.dirty=!1):(b=new a.T(l,this.atlasImage[d],y.RGBA),this.atlasTexture[d]=b),b.bind(y.LINEAR,y.CLAMP_TO_EDGE)}_updatePatternAtlas(l,d){const y=[];for(const C in this.patterns[l])y.push(this.patterns[l][C].bin);const{w:b,h:T}=a.k(y),S=this.atlasImage[l];S.resize({width:b||1,height:T||1});for(const C in this.patterns[l]){const{bin:k}=this.patterns[l][C],L=k.x+1,N=k.y+1,j=this.images[l][C].data,G=j.width,q=j.height;a.j.copy(j,S,{x:0,y:0},{x:L,y:N},{width:G,height:q},d),a.j.copy(j,S,{x:0,y:q-1},{x:L,y:N-1},{width:G,height:1},d),a.j.copy(j,S,{x:0,y:0},{x:L,y:N+q},{width:G,height:1},d),a.j.copy(j,S,{x:G-1,y:0},{x:L-1,y:N},{width:1,height:q},d),a.j.copy(j,S,{x:0,y:0},{x:L+G,y:N},{width:1,height:q},d)}this.dirty=!0}beginFrame(){for(const l in this.images)this.callbackDispatchedThisFrame[l]={}}dispatchRenderCallbacks(l,d){for(const y of l){if(this.callbackDispatchedThisFrame[d][y])continue;this.callbackDispatchedThisFrame[d][y]=!0;const b=this.images[d][y];Ur(b)&&this.updateImage(y,d,b)}}}function Rn(g){const l=g.key,d=g.value,y=g.valueSpec||{},b=g.objectElementValidators||{},T=g.style,S=g.styleSpec;let C=[];const k=a.o(d);if(k!=="object")return[new a.V(l,d,`object expected, ${k} found`)];for(const L in d){const N=L.split(".")[0];let j;b[N]?j=b[N]:y[N]?j=Si:b["*"]?j=b["*"]:y["*"]&&(j=Si),j?C=C.concat(j({key:(l&&`${l}.`)+L,value:d[L],valueSpec:y[N]||y["*"],style:T,styleSpec:S,object:d,objectKey:L},d)):C.push(new a.n(l,d[L],`unknown property "${L}"`))}for(const L in y)b[L]||y[L].required&&y[L].default===void 0&&d[L]===void 0&&C.push(new a.V(l,d,`missing required property "${L}"`));return C}function Kt(g){const l=g.value,d=g.valueSpec,y=g.style,b=g.styleSpec,T=g.key,S=g.arrayElementValidator||Si;if(a.o(l)!=="array")return[new a.V(T,l,`array expected, ${a.o(l)} found`)];if(d.length&&l.length!==d.length)return[new a.V(T,l,`array length ${d.length} expected, length ${l.length} found`)];if(d["min-length"]&&l.length<d["min-length"])return[new a.V(T,l,`array length at least ${d["min-length"]} expected, length ${l.length} found`)];let C={type:d.value,values:d.values,minimum:d.minimum,maximum:d.maximum,function:void 0};b.$version<7&&(C.function=d.function),a.o(d.value)==="object"&&(C=d.value);let k=[];for(let L=0;L<l.length;L++)k=k.concat(S({array:l,arrayIndex:L,value:l[L],valueSpec:C,style:y,styleSpec:b,key:`${T}[${L}]`},!0));return k}function zi(g){const l=g.key,d=g.value,y=g.valueSpec;let b=a.o(d);if(b==="number"&&d!=d&&(b="NaN"),b!=="number")return[new a.V(l,d,`number expected, ${b} found`)];if("minimum"in y){let T=y.minimum;if(a.o(y.minimum)==="array"&&(T=y.minimum[g.arrayIndex]),d<T)return[new a.V(l,d,`${d} is less than the minimum value ${T}`)]}if("maximum"in y){let T=y.maximum;if(a.o(y.maximum)==="array"&&(T=y.maximum[g.arrayIndex]),d>T)return[new a.V(l,d,`${d} is greater than the maximum value ${T}`)]}return[]}function li(g){const l=g.valueSpec,d=a.u(g.value.type);let y,b,T,S={};const C=d!=="categorical"&&g.value.property===void 0,k=!C,L=a.o(g.value.stops)==="array"&&a.o(g.value.stops[0])==="array"&&a.o(g.value.stops[0][0])==="object",N=Rn({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(q){if(d==="identity")return[new a.V(q.key,q.value,'identity function may not have a "stops" property')];let re=[];const ie=q.value;return re=re.concat(Kt({key:q.key,value:ie,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:j})),a.o(ie)==="array"&&ie.length===0&&re.push(new a.V(q.key,ie,"array must have at least one stop")),re},default:function(q){return Si({key:q.key,value:q.value,valueSpec:l,style:q.style,styleSpec:q.styleSpec})}}});return d==="identity"&&C&&N.push(new a.V(g.key,g.value,'missing required property "property"')),d==="identity"||g.value.stops||N.push(new a.V(g.key,g.value,'missing required property "stops"')),d==="exponential"&&g.valueSpec.expression&&!a.s(g.valueSpec)&&N.push(new a.V(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(k&&!a.r(g.valueSpec)?N.push(new a.V(g.key,g.value,"property functions not supported")):C&&!a.t(g.valueSpec)&&N.push(new a.V(g.key,g.value,"zoom functions not supported"))),d!=="categorical"&&!L||g.value.property!==void 0||N.push(new a.V(g.key,g.value,'"property" property is required')),N;function j(q){let re=[];const ie=q.value,ae=q.key;if(a.o(ie)!=="array")return[new a.V(ae,ie,`array expected, ${a.o(ie)} found`)];if(ie.length!==2)return[new a.V(ae,ie,`array length 2 expected, length ${ie.length} found`)];if(L){if(a.o(ie[0])!=="object")return[new a.V(ae,ie,`object expected, ${a.o(ie[0])} found`)];if(ie[0].zoom===void 0)return[new a.V(ae,ie,"object stop key must have zoom")];if(ie[0].value===void 0)return[new a.V(ae,ie,"object stop key must have value")];const ce=a.u(ie[0].zoom);if(typeof ce!="number")return[new a.V(ae,ie[0].zoom,"stop zoom values must be numbers")];if(T&&T>ce)return[new a.V(ae,ie[0].zoom,"stop zoom values must appear in ascending order")];ce!==T&&(T=ce,b=void 0,S={}),re=re.concat(Rn({key:`${ae}[0]`,value:ie[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:zi,value:G}}))}else re=re.concat(G({key:`${ae}[0]`,value:ie[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},ie));return a.v(a.x(ie[1]))?re.concat([new a.V(`${ae}[1]`,ie[1],"expressions are not allowed in function stops.")]):re.concat(Si({key:`${ae}[1]`,value:ie[1],valueSpec:l,style:q.style,styleSpec:q.styleSpec}))}function G(q,re){const ie=a.o(q.value),ae=a.u(q.value),ce=q.value!==null?q.value:re;if(y){if(ie!==y)return[new a.V(q.key,ce,`${ie} stop domain type must match previous stop domain type ${y}`)]}else y=ie;if(ie!=="number"&&ie!=="string"&&ie!=="boolean"&&typeof ae!="number"&&typeof ae!="string"&&typeof ae!="boolean")return[new a.V(q.key,ce,"stop domain value must be a number, string, or boolean")];if(ie!=="number"&&d!=="categorical"){let ye=`number expected, ${ie} found`;return a.r(l)&&d===void 0&&(ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new a.V(q.key,ce,ye)]}return d!=="categorical"||ie!=="number"||typeof ae=="number"&&isFinite(ae)&&Math.floor(ae)===ae?d!=="categorical"&&ie==="number"&&typeof ae=="number"&&typeof b=="number"&&b!==void 0&&ae<b?[new a.V(q.key,ce,"stop domain values must appear in ascending order")]:(b=ae,d==="categorical"&&ae in S?[new a.V(q.key,ce,"stop domain values must be unique")]:(S[ae]=!0,[])):[new a.V(q.key,ce,`integer expected, found ${String(ae)}`)]}}function vi(g){const l=(g.expressionContext==="property"?a.y:a.z)(a.x(g.value),g.valueSpec);if(l.result==="error")return l.value.map(y=>new a.V(`${g.key}${y.key}`,g.value,y.message));const d=l.value.expression||l.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!d.outputDefined())return[new a.V(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!a.A(d))return[new a.V(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter")return go(d,g);if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!a.B(d,["zoom","feature-state"]))return[new a.V(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!a.D(d))return[new a.V(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function go(g,l){const d=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(l.valueSpec&&l.valueSpec.expression)for(const b of l.valueSpec.expression.parameters)d.delete(b);if(d.size===0)return[];const y=[];return g instanceof a.F&&d.has(g.name)?[new a.V(l.key,l.value,`["${g.name}"] expression is not supported in a filter for a ${l.object.type} layer with id: ${l.object.id}`)]:(g.eachChild(b=>{y.push(...go(b,l))}),y)}function Xi(g){const l=g.key,d=g.value,y=g.valueSpec,b=[];return Array.isArray(y.values)?y.values.indexOf(a.u(d))===-1&&b.push(new a.V(l,d,`expected one of [${y.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(y.values).indexOf(a.u(d))===-1&&b.push(new a.V(l,d,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(d)} found`)),b}function Ao(g){return a.H(a.x(g.value))?vi(a.q({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):Za(g)}function Za(g){const l=g.value,d=g.key;if(a.o(l)!=="array")return[new a.V(d,l,`array expected, ${a.o(l)} found`)];const y=g.styleSpec;let b,T=[];if(l.length<1)return[new a.V(d,l,"filter array must have at least 1 element")];switch(T=T.concat(Xi({key:`${d}[0]`,value:l[0],valueSpec:y.filter_operator,style:g.style,styleSpec:g.styleSpec})),a.u(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&a.u(l[1])==="$type"&&T.push(new a.V(d,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&T.push(new a.V(d,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(b=a.o(l[1]),b!=="string"&&T.push(new a.V(`${d}[1]`,l[1],`string expected, ${b} found`)));for(let S=2;S<l.length;S++)b=a.o(l[S]),a.u(l[1])==="$type"?T=T.concat(Xi({key:`${d}[${S}]`,value:l[S],valueSpec:y.geometry_type,style:g.style,styleSpec:g.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&T.push(new a.V(`${d}[${S}]`,l[S],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let S=1;S<l.length;S++)T=T.concat(Za({key:`${d}[${S}]`,value:l[S],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":b=a.o(l[1]),l.length!==2?T.push(new a.V(d,l,`filter array for "${l[0]}" operator must have 2 elements`)):b!=="string"&&T.push(new a.V(`${d}[1]`,l[1],`string expected, ${b} found`))}return T}function _o(g,l){const d=g.key,y=g.style,b=g.layer,T=g.styleSpec,S=g.value,C=g.objectKey,k=T[`${l}_${g.layerType}`];if(!k)return[];const L=C.match(/^(.*)-transition$/);if(l==="paint"&&L&&k[L[1]]&&k[L[1]].transition)return Si({key:d,value:S,valueSpec:T.transition,style:y,styleSpec:T});const N=g.valueSpec||k[C];if(!N)return[new a.n(d,S,`unknown property "${C}"`)];let j;if(a.o(S)==="string"&&a.r(N)&&!N.tokens&&(j=/^{([^}]+)}$/.exec(S))){const q=`\`{ "type": "identity", "property": ${j?JSON.stringify(j[1]):'"_"'} }\``;return[new a.V(d,S,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${q}.`)]}const G=[];if(g.layerType==="symbol")C!=="text-field"||!y||y.glyphs||y.imports||G.push(new a.V(d,S,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&a.J(a.x(S))&&a.u(S.type)==="identity"&&G.push(new a.V(d,S,'"text-font" does not support identity functions'));else if(g.layerType==="model"&&l==="paint"&&b&&b.layout&&b.layout.hasOwnProperty("model-id")&&a.r(N)&&(a.K(N)||a.t(N))){const q=a.y(a.x(S),N),re=q.value.expression||q.value._styleExpression.expression;re&&!a.B(re,["measure-light"])&&(C==="model-emissive-strength"&&a.D(re)&&a.A(re)||G.push(new a.V(d,S,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return G.concat(Si({key:g.key,value:S,valueSpec:N,style:y,styleSpec:T,expressionContext:"property",propertyType:l,propertyKey:C}))}function Wt(g){return _o(g,"paint")}function Ln(g){return _o(g,"layout")}function Or(g){let l=[];const d=g.value,y=g.key,b=g.style,T=g.styleSpec;d.type||d.ref||l.push(new a.V(y,d,'either "type" or "ref" is required'));let S=a.u(d.type);const C=a.u(d.ref);if(d.id){const k=a.u(d.id);for(let L=0;L<g.arrayIndex;L++){const N=b.layers[L];a.u(N.id)===k&&l.push(new a.V(y,d.id,`duplicate layer id "${d.id}", previously used at line ${N.id.__line__}`))}}if("ref"in d){let k;["type","source","source-layer","filter","layout"].forEach(L=>{L in d&&l.push(new a.V(y,d[L],`"${L}" is prohibited for ref layers`))}),b.layers.forEach(L=>{a.u(L.id)===C&&(k=L)}),k?k.ref?l.push(new a.V(y,d.ref,"ref cannot reference another ref layer")):S=a.u(k.type):typeof C=="string"&&l.push(new a.V(y,d.ref,`ref layer "${C}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(d.source){const k=b.sources&&b.sources[d.source],L=k&&a.u(k.type);k?L==="vector"&&S==="raster"?l.push(new a.V(y,d.source,`layer "${d.id}" requires a raster source`)):L==="raster"&&S!=="raster"?l.push(new a.V(y,d.source,`layer "${d.id}" requires a vector source`)):L!=="vector"||d["source-layer"]?L==="raster-dem"&&S!=="hillshade"?l.push(new a.V(y,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!d.paint||!d.paint["line-gradient"]&&!d.paint["line-trim-offset"]||L==="geojson"&&k.lineMetrics?S==="raster-particle"&&L!=="raster-array"&&l.push(new a.V(y,d.source,`layer "${d.id}" requires a 'raster-array' source.`)):l.push(new a.V(y,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new a.V(y,d.source,"raster-array source can only be used with layer type 'raster'.")):l.push(new a.V(y,d,`layer "${d.id}" must specify a "source-layer"`)):l.push(new a.V(y,d.source,`source "${d.source}" not found`))}else l.push(new a.V(y,d,'missing required property "source"'));return l=l.concat(Rn({key:y,value:d,valueSpec:T.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Si({key:`${y}.type`,value:d.type,valueSpec:T.layer.type,style:g.style,styleSpec:g.styleSpec,object:d,objectKey:"type"}),filter:k=>Ao(a.q({layerType:S},k)),layout:k=>Rn({layer:d,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":L=>Ln(a.q({layerType:S},L))}}),paint:k=>Rn({layer:d,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":L=>Wt(a.q({layerType:S,layer:d},L))}})}})),l}function Pr(g){const l=g.value,d=g.key,y=a.o(l);return y!=="string"?[new a.V(d,l,`string expected, ${y} found`)]:[]}const Ei={promoteId:function({key:g,value:l}){if(a.o(l)==="string")return Pr({key:g,value:l});{const d=[];for(const y in l)d.push(...Pr({key:`${g}.${y}`,value:l[y]}));return d}}};function Rr(g){const l=g.value,d=g.key,y=g.styleSpec,b=g.style;if(!l.type)return[new a.V(d,l,'"type" is required')];const T=a.u(l.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(T)&&(l.url||l.tiles||S.push(new a.n(d,l,'Either "url" or "tiles" is required.'))),T){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(Rn({key:d,value:l,valueSpec:y[`source_${T.replace("-","_")}`],style:g.style,styleSpec:y,objectElementValidators:Ei})),S;case"geojson":if(S=Rn({key:d,value:l,valueSpec:y.source_geojson,style:b,styleSpec:y,objectElementValidators:Ei}),l.cluster)for(const C in l.clusterProperties){const[k,L]=l.clusterProperties[C],N=typeof k=="string"?[k,["accumulated"],["get",C]]:k;S.push(...vi({key:`${d}.${C}.map`,value:L,expressionContext:"cluster-map"})),S.push(...vi({key:`${d}.${C}.reduce`,value:N,expressionContext:"cluster-reduce"}))}return S;case"video":return Rn({key:d,value:l,valueSpec:y.source_video,style:b,styleSpec:y});case"image":return Rn({key:d,value:l,valueSpec:y.source_image,style:b,styleSpec:y});case"canvas":return[new a.V(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xi({key:`${d}.type`,value:l.type,valueSpec:{values:us(y)},style:b,styleSpec:y})}}function us(g){return g.source.reduce((l,d)=>{const y=g[d];return y.type.type==="enum"&&(l=l.concat(Object.keys(y.type.values))),l},[])}function $i(g){const l=g.value,d=g.styleSpec,y=d.light,b=g.style;let T=[];const S=a.o(l);if(l===void 0)return T;if(S!=="object")return T=T.concat([new a.V("light",l,`object expected, ${S} found`)]),T;for(const C in l){const k=C.match(/^(.*)-transition$/);T=T.concat(k&&y[k[1]]&&y[k[1]].transition?Si({key:C,value:l[C],valueSpec:d.transition,style:b,styleSpec:d}):y[C]?Si({key:C,value:l[C],valueSpec:y[C],style:b,styleSpec:d}):[new a.V(C,l[C],`unknown property "${C}"`)])}return T}function si(g){const l=g.value;let d=[];if(!l)return d;const y=a.o(l);if(y!=="object")return d=d.concat([new a.V("light-3d",l,`object expected, ${y} found`)]),d;const b=g.styleSpec,T=b["light-3d"],S=g.key,C=g.style,k=g.style.lights;for(const j of["type","id"])if(!(j in l))return d=d.concat([new a.V("light-3d",l,`missing property ${j} on light`)]),d;if(l.type&&k)for(let j=0;j<g.arrayIndex;j++){const G=a.u(l.type),q=k[j];a.u(q.type)===G&&d.push(new a.V(S,l.id,`duplicate light type "${l.type}", previously defined at line ${q.id.__line__}`))}const L=`properties_light_${l.type}`;if(!(L in b))return d=d.concat([new a.V("light-3d",l,`Invalid light type ${l.type}`)]),d;const N=b[L];for(const j in l)if(j==="properties"){const G=l[j],q=a.o(G);if(q!=="object")return d=d.concat([new a.V("properties",G,`object expected, ${q} found`)]),d;for(const re in G)d=d.concat(N[re]?Si({key:re,value:G[re],valueSpec:N[re],style:C,styleSpec:b}):[new a.n(g.key,G[re],`unknown property "${re}"`)])}else{const G=j.match(/^(.*)-transition$/);d=d.concat(G&&T[G[1]]&&T[G[1]].transition?Si({key:j,value:l[j],valueSpec:b.transition,style:C,styleSpec:b}):T[j]?Si({key:j,value:l[j],valueSpec:T[j],style:C,styleSpec:b}):[new a.n(j,l[j],`unknown property "${j}"`)])}return d}function no(g){const l=g.value,d=g.key,y=g.style,b=g.styleSpec,T=b.terrain;let S=[];const C=a.o(l);if(l===void 0||C==="null")return S;if(C!=="object")return S=S.concat([new a.V("terrain",l,`object expected, ${C} found`)]),S;for(const k in l){const L=k.match(/^(.*)-transition$/);S=S.concat(L&&T[L[1]]&&T[L[1]].transition?Si({key:k,value:l[k],valueSpec:b.transition,style:y,styleSpec:b}):T[k]?Si({key:k,value:l[k],valueSpec:T[k],style:y,styleSpec:b}):[new a.n(k,l[k],`unknown property "${k}"`)])}if(l.source){const k=y.sources&&y.sources[l.source],L=k&&a.u(k.type);k?L!=="raster-dem"&&S.push(new a.V(d,l.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):S.push(new a.V(d,l.source,`source "${l.source}" not found`))}else S.push(new a.V(d,l,'terrain is missing required property "source"'));return S}function ro(g){const l=g.value,d=g.style,y=g.styleSpec,b=y.fog;let T=[];const S=a.o(l);if(l===void 0)return T;if(S!=="object")return T=T.concat([new a.V("fog",l,`object expected, ${S} found`)]),T;for(const C in l){const k=C.match(/^(.*)-transition$/);T=T.concat(k&&b[k[1]]&&b[k[1]].transition?Si({key:C,value:l[C],valueSpec:y.transition,style:d,styleSpec:y}):b[C]?Si({key:C,value:l[C],valueSpec:b[C],style:d,styleSpec:y}):[new a.n(C,l[C],`unknown property "${C}"`)])}return T}const qr={"*":()=>[],array:Kt,boolean:function(g){const l=g.value,d=g.key,y=a.o(l);return y!=="boolean"?[new a.V(d,l,`boolean expected, ${y} found`)]:[]},number:zi,color:function(g){const l=g.key,d=g.value,y=a.o(d);return y!=="string"?[new a.V(l,d,`color expected, ${y} found`)]:a.G(d)===null?[new a.V(l,d,`color expected, "${d}" found`)]:[]},enum:Xi,filter:Ao,function:li,layer:Or,object:Rn,source:Rr,model:a.L,light:$i,"light-3d":si,terrain:no,fog:ro,string:Pr,formatted:function(g){return Pr(g).length===0?[]:vi(g)},resolvedImage:function(g){return Pr(g).length===0?[]:vi(g)},projection:function(g){const l=g.value,d=g.styleSpec,y=d.projection,b=g.style;let T=[];const S=a.o(l);if(S==="object")for(const C in l)T=T.concat(Si({key:C,value:l[C],valueSpec:y[C],style:b,styleSpec:d}));else S!=="string"&&(T=T.concat([new a.V("projection",l,`object or string expected, ${S} found`)]));return T},import:function(g){const{value:l,styleSpec:d}=g,{data:y,...b}=l;Object.defineProperty(b,"__line__",{value:l.__line__,enumerable:!1});let T=Rn(a.q({},g,{value:b,valueSpec:d.import}));return a.u(b.id)===""&&T.push(new a.V(`${g.key}.id`,b,"import id can't be an empty string")),y&&(T=T.concat(Be(y,d,{key:`${g.key}.data`}))),T}};function Si(g,l=!1){const d=g.value,y=g.valueSpec,b=g.styleSpec;if(y.expression&&a.J(a.u(d)))return li(g);if(y.expression&&a.v(a.x(d)))return vi(g);if(y.type&&qr[y.type]){const T=qr[y.type](g);return l===!0&&T.length>0&&a.o(g.value)==="array"?vi(g):T}return Rn(a.q({},g,{valueSpec:y.type?b[y.type]:y}))}function El(g){const l=g.value,d=g.key,y=Pr(g);return y.length||(l.indexOf("{fontstack}")===-1&&y.push(new a.V(d,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&y.push(new a.V(d,l,'"glyphs" url must include a "{range}" token'))),y}function Be(g,l=a.N,d={}){return Si({key:d.key||"",value:g,valueSpec:l.$root,styleSpec:l,style:g,objectElementValidators:{glyphs:El,"*":()=>[]}})}function te(g,l=a.N){return $t(Be(g,l))}const le=g=>$t(Rr(g)),xe=g=>$t($i(g)),Oe=g=>$t(si(g)),De=g=>$t(no(g)),Ge=g=>$t(ro(g)),tt=g=>$t(Or(g)),$e=g=>$t(Ao(g)),Je=g=>$t(Wt(g)),mt=g=>$t(Ln(g)),gt=g=>$t(a.L(g));function $t(g){return g.slice().sort((l,d)=>l.line&&d.line?l.line-d.line:0)}function _n(g,l){let d=!1;if(l&&l.length)for(const y of l)y instanceof a.n?a.w(y.message):(g.fire(new a.f(new Error(y.message))),d=!0);return d}let An;class ur extends a.E{constructor(l,d="flat"){super(),this._transitionable=new a.O(An||(An=new a.U({anchor:new a.W(a.N.light.anchor),position:new a.X(a.N.light.position),color:new a.W(a.N.light.color),intensity:new a.W(a.N.light.intensity)}))),this.setLight(l,d),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,d,y={}){this._validate(xe,l,y)||(this._transitionable.setTransitionOrValue(l),this.id=d)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,y){return(!y||y.validate!==!1)&&_n(this,l.call(te,a.Q({value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.N})))}}const Dn=new a.U({source:new a.W(a.N.terrain.source),exaggeration:new a.W(a.N.terrain.exaggeration)});let hr=class extends a.E{constructor(g,l,d,y){super(),this.scope=d,this._transitionable=new a.O(Dn,d,y),this._transitionable.setTransitionOrValue(g,y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(g,l){this._transitionable.setTransitionOrValue(g,l)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new a.Y(g)).get("exaggeration")}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof a.Z}};const cn=45,ei=65,vr=.05;function dr(g,l,d,y){const b=a.a0(cn,ei,d),[T,S]=xi(g,y);let C=1-Math.min(1,Math.exp((l-T)/(S-T)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*b*g.alpha}function xi(g,l){const d=.5/Math.tan(.5*l);return[g.range[0]+d,g.range[1]+d]}function bi(g,l,d,y,b){const T=a.$.transformMat4([],[l,d,y],b.mercatorFogMatrix);return dr(g,a.$.length(T),b.pitch,b._fov)}function Ki(g,l,d,y,b,T,S){const C=[[d,y,0],[b,y,0],[b,T,0],[d,T,0]];let k=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const N of C){const j=a.$.transformMat4([],N,l),G=a.$.length(j);k=Math.min(k,G),L=Math.max(L,G)}return[dr(g,k,S.pitch,S._fov),dr(g,L,S.pitch,S._fov)]}const Ps=new a.U({range:new a.W(a.N.fog.range),color:new a.W(a.N.fog.color),"high-color":new a.W(a.N.fog["high-color"]),"space-color":new a.W(a.N.fog["space-color"]),"horizon-blend":new a.W(a.N.fog["horizon-blend"]),"star-intensity":new a.W(a.N.fog["star-intensity"]),"vertical-range":new a.W(a.N.fog["vertical-range"])});class Ws extends a.E{constructor(l,d,y,b){super(),this._transitionable=new a.O(Ps,y,new Map(b)),this.set(l,b),this._transitioning=this._transitionable.untransitioned(),this._transform=d,this.properties=new a.a1(Ps),this.scope=y}get state(){const l=this._transform,d=l.projection.name==="globe",y=a.a2(l.zoom),b=this.properties.get("range"),T=[.5,3];return{range:d?[a.a3(T[0],b[0],y),a.a3(T[1],b[1],y)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,d,y={}){if(this._validate(Ge,l,y))return;const b=a.Q({},l);for(const T of Object.keys(a.N.fog))b[T]===void 0&&(b[T]=a.N.fog[T].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,d)}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.a0(cn,ei,l))*d.a}getOpacityAtLatLng(l,d){return this._transform.projection.supportsFog?function(y,b,T){const S=a._.fromLngLat(b),C=T.elevation?T.elevation.getAtPointOrZero(S):0;return bi(y,S.x,S.y,C,T)}(this.state,l,d):0}getOpacityForTile(l){if(!this._transform.projection.supportsFog)return[1,1];const d=this._transform.calculateFogTileMatrix(l.toUnwrapped());return Ki(this.state,d,0,0,a.a4,a.a4,this._transform)}getOpacityForBounds(l,d,y,b,T){return this._transform.projection.supportsFog?Ki(this.state,l,d,y,b,T,this._transform):[1,1]}getFovAdjustedRange(l){return this._transform.projection.supportsFog?xi(this.state,l):[0,1]}isVisibleOnFrustum(l){if(!this._transform.projection.supportsFog)return!1;const d=[4,5,6,7];for(const y of d){const b=l.points[y];let T;if(b[2]>=0)T=b;else{const S=l.points[y-4];T=a.a5(S,b,S[2]/(S[2]-b[2]))}if(bi(this.state,T[0],T[1],0,this._transform)>=vr)return!0}return!1}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,y){return(!y||y.validate!==!1)&&_n(this,l.call(te,a.Q({value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.N})))}}class nc extends a.E{constructor(l,d,y,b){super(),this.scope=y,this._options=l,this.properties=new a.a1(d),this._transitionable=new a.O(d,y,new Map(b)),this._transitionable.setTransitionOrValue(l.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(l){this._transitionable.setTransitionOrValue(this._options.properties,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(l,d){this._options=l,this._transitionable.setTransitionOrValue(l.properties,d)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let od,ad;var Yu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,zn=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Uo=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,sa="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",qc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,ld=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,di=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Wc=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,rc=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,ic=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,tp=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Hc=[];Co(Yu,Hc),Co(Uo,Hc),Co(zn,Hc);const Qu={"_prelude_fog.vertex.glsl":ld,"_prelude_terrain.vertex.glsl":qc,"_prelude_shadow.vertex.glsl":ic,"_prelude_fog.fragment.glsl":di,"_prelude_shadow.fragment.glsl":tp,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Wc,"_prelude_raster_particle.glsl":rc},cd={};fr("",qc),fr(di,ld),fr(tp,ic),fr(Wc,""),fr(rc,"");const ud=fr(zn,Uo),ag=Yu;var Zc={background:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:fr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:fr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:fr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:fr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:fr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:fr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);scaled_pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);scaled_pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:fr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_alignment;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);p.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);p.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:fr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:fr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:fr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:fr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:fr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:fr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:fr(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);v_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:fr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:fr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:fr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:fr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,sa),skyboxGradient:fr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,sa),skyboxCapture:fr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:fr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:fr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:fr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:fr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Co(g,l){const d=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let y of d)if(y=y.trim(),y[0]==="#"&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=y.split(" ");for(const T of b)l.includes(T)||l.push(T)}}function fr(g,l){const d=/#include\s+"([^"]+)"/g,y=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let b=l.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);b&&(b=b.map(L=>{const N=L.split(" ");return N[N.length-1]}),b=[...new Set(b)]);const T={},S=[],C=[];if(g=g.replace(d,(L,N)=>(C.push(N),"")),(l=l.replace(d,(L,N)=>(S.push(N),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let k=[...Hc];Co(g,k),Co(l,k);for(const L of[...S,...C])Qu[L]||console.error(`Undefined include: ${L}`),cd[L]||(cd[L]=[],Co(Qu[L],cd[L])),k=[...k,...cd[L]];return{fragmentSource:g=g.replace(y,(L,N,j,G,q)=>(T[q]=!0,N==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${j} ${G} ${q};
#else
uniform ${j} ${G} u_${q};
#endif
`:N==="initialize"?`
#ifdef HAS_UNIFORM_u_${q}
    ${j} ${G} ${q} = u_${q};
#endif
`:N==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${j} ${G} ${q};
#endif
`:N==="initialize-attribute"?"":void 0)),vertexSource:l=l.replace(y,(L,N,j,G,q)=>{const re=G==="float"?"vec2":G,ie=q.match(/color/)?"color":re;return N==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${q}
in ${j} ${G} a_${q};
#endif
`:T[q]?N==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${j} ${re} a_${q};
out ${j} ${G} ${q};
#else
uniform ${j} ${G} u_${q};
#endif
`:N==="initialize"?ie==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${j} ${G} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${ie}(a_${q}, u_${q}_t);
#else
    ${j} ${G} ${q} = u_${q};
#endif
`:N==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${j} ${G} a_${q};
    out ${j} ${G} ${q};
#endif
`:N==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${q} = a_${q};
#endif
`:void 0:N==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${j} ${re} a_${q};
#else
uniform ${j} ${G} u_${q};
#endif
`:N==="define-instanced"?ie==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${q}0;
in vec4 a_${q}1;
in vec4 a_${q}2;
in vec4 a_${q}3;
#else
uniform ${j} ${G} u_${q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${j} ${re} a_${q};
#else
uniform ${j} ${G} u_${q};
#endif
`:N==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${j} ${G} ${q} = a_${q};
#endif
`:ie==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${j} ${G} ${q} = a_${q};
#else
    ${j} ${G} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${j} ${G} ${q} = unpack_mix_${ie}(a_${q}, u_${q}_t);
#else
    ${j} ${G} ${q} = u_${q};
#endif
`}),staticAttributes:b,usedDefines:k,vertexIncludes:S,fragmentIncludes:C}}class lg{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,d,y,b,T,S,C,k){this.context=l;let L=this.boundPaintVertexBuffers.length!==b.length;for(let j=0;!L&&j<b.length;j++)this.boundPaintVertexBuffers[j]!==b[j]&&(L=!0);let N=this.boundDynamicVertexBuffers.length!==C.length;for(let j=0;!N&&j<C.length;j++)this.boundDynamicVertexBuffers[j]!==C[j]&&(N=!0);if(!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==y||L||N||this.boundIndexBuffer!==T||this.boundVertexOffset!==S)this.freshBind(d,y,b,T,S,C,k);else{l.bindVertexArrayOES.set(this.vao);for(const j of C)j&&(j.bind(),k&&j.instanceCount&&j.setVertexAttribDivisor(l.gl,d,k));T&&T.dynamicDraw&&T.bind()}}freshBind(l,d,y,b,T,S,C){const k=l.numAttributes,L=this.context,N=L.gl;this.vao&&this.destroy(),this.vao=L.gl.createVertexArray(),L.bindVertexArrayOES.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=b,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=S,d.enableAttributes(N,l),d.bind(),d.setVertexAttribPointers(N,l,T);for(const j of y)j.enableAttributes(N,l),j.bind(),j.setVertexAttribPointers(N,l,T);for(const j of S)j&&(j.enableAttributes(N,l),j.bind(),j.setVertexAttribPointers(N,l,T),C&&j.instanceCount&&j.setVertexAttribDivisor(N,l,C));b&&b.bind(),L.currentNumAttributes=k}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function cg(g,l){const d=Math.pow(2,l.canonical.z),y=l.canonical.y;return[new a._(0,y/d).toLngLat().lat,new a._(0,(y+1)/d).toLngLat().lat]}function Xc(g,l,d,y,b,T,S){const C=g.context,k=C.gl,L=d.hillshadeFBO;if(!L)return;g.prepareDrawTile();const N=g.isTileAffectedByFog(l),j=g.getOrCreateProgram("hillshade",{overrideFog:N});C.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,L.colorAttachment.get());const G=((ae,ce,ye,ve)=>{const _e=ye.paint.get("hillshade-shadow-color"),Re=ye.paint.get("hillshade-highlight-color"),Se=ye.paint.get("hillshade-accent-color"),Ie=ye.paint.get("hillshade-emissive-strength");let ze=a.ac(ye.paint.get("hillshade-illumination-direction"));if(ye.paint.get("hillshade-illumination-anchor")==="viewport")ze-=ae.transform.angle;else if(ae.style&&ae.style.enable3dLights()&&ae.style.directionalLight){const qe=ae.style.directionalLight.properties.get("direction"),Fe=a.ad(qe.x,qe.y,qe.z);ze=a.ac(Fe[1])}const Ne=!ae.options.moving;return{u_matrix:ve||ae.transform.calculateProjMatrix(ce.tileID.toUnwrapped(),Ne),u_image:0,u_latrange:cg(0,ce.tileID),u_light:[ye.paint.get("hillshade-exaggeration"),ze],u_shadow:_e.toRenderColor(ye.lut),u_highlight:Re.toRenderColor(ye.lut),u_emissive_strength:Ie,u_accent:Se.toRenderColor(ye.lut)}})(g,d,y,g.terrain?l.projMatrix:null);g.uploadCommonUniforms(C,j,l.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:re,tileBoundsSegments:ie}=g.getTileBoundsBuffers(d);j.draw(g,k.TRIANGLES,b,T,S,a.ag.disabled,G,y.id,q,re,ie)}function ug(g,l,d){if(!l.needsDEMTextureUpload)return;const y=g.context,b=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||g.getTileTexture(d.stride);const T=d.getPixels();l.demTexture?l.demTexture.update(T,{premultiply:!1}):l.demTexture=new a.T(y,T,b.R32F,{premultiply:!1}),l.needsDEMTextureUpload=!1}function i0(g,l,d){const y=g.context,b=y.gl;if(!l.dem)return;const T=l.dem;if(y.activeTexture.set(b.TEXTURE1),ug(g,l,T),!l.demTexture)return;l.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const S=T.dim;y.activeTexture.set(b.TEXTURE0);let C=l.hillshadeFBO;if(!C){const G=new a.T(y,{width:S,height:S,data:null},b.RGBA);G.bind(b.LINEAR,b.CLAMP_TO_EDGE),C=l.hillshadeFBO=y.createFramebuffer(S,S,!0,"renderbuffer"),C.colorAttachment.set(G.texture)}y.bindFramebuffer.set(C.framebuffer),y.viewport.set([0,0,S,S]);const{tileBoundsBuffer:k,tileBoundsIndexBuffer:L,tileBoundsSegments:N}=g.getMercatorTileBoundsBuffers(),j=[];g.linearFloatFilteringSupported()&&j.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:j}).draw(g,b.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.unblended,a.ag.disabled,((G,q)=>{const re=q.stride,ie=a.ae.create();return a.ae.ortho(ie,0,a.a4,-a.a4,0,0,1),a.ae.translate(ie,ie,[0,-a.a4,0]),{u_matrix:ie,u_image:1,u_dimension:[re,re],u_zoom:G.overscaledZ}})(l.tileID,T),d.id,k,L,N),l.needsHillshadePrepare=!1}function np(g,l,d,y,b){const T=function(C,k){if(C)return b(C);if(k){if(g.url&&k.tiles&&g.tiles&&delete g.tiles,k.variants){if(!Array.isArray(k.variants))return b(new Error("variants must be an array"));for(const N of k.variants){if(N==null||typeof N!="object"||N.constructor!==Object)return b(new Error("variant must be an object"));if(!Array.isArray(N.capabilities))return b(new Error("capabilities must be an array"));if(N.capabilities.length===1&&N.capabilities[0]==="meshopt"){k=a.Q(k,N);break}}}const L=a.ai(a.Q(k,g),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(L.vectorLayers=k.vector_layers,L.vectorLayerIds=L.vectorLayers.map(N=>N.id)),k.raster_layers&&(L.rasterLayers=k.raster_layers,L.rasterLayerIds=L.rasterLayers.map(N=>N.id)),L.tiles=l.canonicalizeTileset(L,g.url),b(null,L)}},S=function(C,k,L){if(!C)return null;if(!k&&!L)return C;L=L||C.worldview_default;const N=Object.values(C.language||{});if(N.length===0)return null;const j=Object.values(C.worldview||{});if(j.length===0)return null;const G=N.every(re=>re===k),q=j.every(re=>re===L);return G&&q?C:k in(C.language_options||{})||L in(C.worldview_options||{})?null:C.language_options&&C.worldview_options?C:null}(g.data,d,y);return S?a.e.frame(()=>T(null,S)):g.url?a.h(l.transformRequest(l.normalizeSourceURL(g.url,null,d,y),a.R.Source),T):a.e.frame(()=>{const{data:C,...k}=g;T(null,k)})}class Vo{constructor(l,d,y){this.bounds=a.aj.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=y||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const d=Math.pow(2,l.z),y=Math.floor(a.ak(this.bounds.getWest())*d),b=Math.floor(a.al(this.bounds.getNorth())*d),T=Math.ceil(a.ak(this.bounds.getEast())*d),S=Math.ceil(a.al(this.bounds.getSouth())*d);return l.x>=y&&l.x<T&&l.y>=b&&l.y<S}}class Po extends a.E{constructor(l,d,y,b){super(),this.id=l,this.dispatcher=y,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.Q({type:"raster"},d),a.Q(this,a.ai(d,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"})),this._tileJSONRequest=np(this._options,this.map._requestManager,null,null,(d,y)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new a.f(d)):y&&(a.Q(this,y),y.bounds&&(this.tileBounds=new Vo(y.bounds,this.minzoom,this.maxzoom)),a.ao(y.tiles),this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))),l&&l(d)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=a.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return a.Q({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,d){const y=a.e.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);l.request=a.i(this.map._requestManager.transformRequest(b,a.R.Tile),(T,S,C,k)=>(delete l.request,l.aborted?(l.state="unloaded",d(null)):T?(l.state="errored",d(T)):S?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:C,expires:k}),l.setTexture(S,this.map.painter),l.state="loaded",a.an(this.dispatcher),void d(null)):d(null)))}abortTile(l,d){l.request&&(l.request.cancel(),delete l.request),d&&d()}unloadTile(l,d){l.texture&&l.texture instanceof a.T?(l.destroy(!0),l.texture&&l.texture instanceof a.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),d&&d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class hg extends a.E{constructor(l,d,y,b){if(super(),this.id=l,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.Q(this,a.ai(d,["url","scheme","tileSize","promoteId"])),this._options=a.Q({type:"vector"},d),this._collectResourceTiming=!!d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new a.ap}load(l){this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map._worldview;this._tileJSONRequest=np(this._options,this.map._requestManager,d,y,(b,T)=>{this._tileJSONRequest=null,this._loaded=!0,b?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),y&&y.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new a.f(b))):T&&(a.Q(this,T),T.bounds&&(this.tileBounds=new Vo(T.bounds,this.minzoom,this.maxzoom)),a.ao(T.tiles,this.map._requestManager._customAccessToken),this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))),l&&l(b)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=a.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return a.Q({},this._options)}loadTile(l,d){const y=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),b=this.map._requestManager.transformRequest(y,a.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,S={request:b,data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,lut:T?{image:T.image.clone()}:null,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(S.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=d:l.request=l.actor.send("reloadTile",S,C.bind(this));else if(l.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",S,C.bind(this),void 0,!0);else{const k=a.aq.call({deduped:this._deduped},S,(L,N)=>{L||!N?C.call(this,L):(S.data={cacheControl:N.cacheControl,expires:N.expires,rawData:N.rawData.slice(0)},l.actor&&l.actor.send("loadTile",S,C.bind(this),void 0,!0))},!0);l.request={cancel:k}}function C(k,L){return delete l.request,l.aborted?d(null):k&&k.status!==404?d(k):(L&&L.resourceTiming&&(l.resourceTiming=L.resourceTiming),this.map._refreshExpiredTiles&&L&&l.setExpiryData(L),l.loadVectorData(L,this.map.painter),a.an(this.dispatcher),d(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(l,d){l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const Kc=(g,l,d)=>({u_matrix:g,u_image0:0,u_skirt_height:l,u_ground_shadow_factor:d}),Yc=(g,l,d,y,b,T,S,C,k,L,N,j,G,q,re,ie)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:d,u_zoom_transition:b,u_merc_center:T,u_image0:0,u_frustum_tl:S,u_frustum_tr:C,u_frustum_br:k,u_frustum_bl:L,u_globe_pos:N,u_globe_radius:j,u_viewport:G,u_grid_matrix:ie?Float32Array.from(ie):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:re});class Qc{constructor(l=0,d=0,y=0,b=0){if(isNaN(l)||l<0||isNaN(d)||d<0||isNaN(y)||y<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=y,this.right=b}interpolate(l,d,y){return d.top!=null&&l.top!=null&&(this.top=a.a3(l.top,d.top,y)),d.bottom!=null&&l.bottom!=null&&(this.bottom=a.a3(l.bottom,d.bottom,y)),d.left!=null&&l.left!=null&&(this.left=a.a3(l.left,d.left,y)),d.right!=null&&l.right!=null&&(this.right=a.a3(l.right,d.right,y)),this}getCenter(l,d){const y=a.au((this.left+l-this.right)/2,0,l),b=a.au((this.top+d-this.bottom)/2,0,d);return new a.P(y,b)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Qc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function oa(g,l){const d=a.ax(g,3);a.ae.fromQuat(g,l),a.aA(g,3,d)}function Dt(g,l){const d=a.aw.identity([]);return a.aw.rotateZ(d,d,-l),a.aw.rotateX(d,d,-g),d}function sc(g,l){const d=[g[0],g[1],0],y=[l[0],l[1],0];if(a.$.length(d)>=1e-15){const S=a.$.normalize([],d);a.$.scale(y,S,a.$.dot(y,S)),l[0]=y[0],l[1]=y[1]}const b=a.$.cross([],l,g);if(a.$.len(b)<1e-15)return null;const T=Math.atan2(-b[1],b[0]);return Dt(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),T)}class hd{constructor(l,d){this.position=l,this.orientation=d}get position(){return this._position}set position(l){if(l){const d=l instanceof a._?l:new a._(l[0],l[1],l[2]);this._renderWorldCopies&&(d.x=a.av(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(l,d){if(this.orientation=null,!this.position)return;const y=this.position,b=this._elevation?this._elevation.getAtPointOrZero(a._.fromLngLat(l)):0,T=a._.fromLngLat(l,b),S=[T.x-y.x,T.y-y.y,T.z-y.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=sc(S,d)}setPitchBearing(l,d){this.orientation=Dt(a.ac(l),a.ac(-d))}}class fi{constructor(l,d){this._transform=a.ae.identity([]),this.orientation=d,this.position=l}get mercatorPosition(){const l=this.position;return new a._(l[0],l[1],l[2])}get position(){const l=a.ax(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var d;l&&a.aA(this._transform,3,[(d=l)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||a.aw.identity([]),l&&oa(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,d){this._orientation=Dt(l,d),oa(this._transform,this._orientation)}forward(){const l=a.ax(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=a.ax(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=a.ax(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,d){const y=new Float64Array(16);return a.ae.invert(y,this.getWorldToCamera(l,d)),y}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(l,d,y){const b=this.position;a.$.scale(b,b,-l);const T=new Float64Array(16);return a.ae.fromScaling(T,[y,y,y]),a.ae.translate(T,T,b),T[10]*=d,T}getWorldToCamera(l,d){const y=new Float64Array(16),b=new Float64Array(4),T=this.position;return a.aw.conjugate(b,this._orientation),a.$.scale(T,T,-l),a.ae.fromQuat(y,b),a.ae.translate(y,y,T),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=d,y[9]*=d,y[10]*=d,y[11]*=d,y}getCameraToClipPerspective(l,d,y,b){const T=new Float64Array(16);return a.ae.perspective(T,l,d,y,b),T}getCameraToClipOrthographic(l,d,y,b,T,S){const C=new Float64Array(16);return a.ae.ortho(C,l,d,y,b,T,S),C}getDistanceToElevation(l,d=!1){const y=l===0?0:a.ay(l,d?a.az(this.position[1]):this.position[1]),b=this.forward();return(y-this.position[2])/b[2]}clone(){return new fi([...this.position],[...this.orientation])}}const sr={unknown:0,flipRequired:1,flipNotRequired:2},io=Math.tan(85*Math.PI/180);function Jc(g,l,d,y,b,T,S){const C=a.ae.create();if(d)if(T.name==="globe"){const k=a.aC(b,l);a.ae.multiply(C,C,k)}else{const k=a.aD.invert([],S);C[0]=k[0],C[1]=k[1],C[4]=k[2],C[5]=k[3],y||a.ae.rotateZ(C,C,b.angle)}else a.ae.multiply(C,b.labelPlaneMatrix,g);return C}function Ju(g,l,d,y,b,T,S){const C=Jc(g,l,d,y,b,T,S);return T.name==="globe"&&d||(C[2]=C[6]=C[10]=C[14]=0),C}function eh(g,l,d,y,b,T,S){if(d){if(T.name==="globe"){const C=Jc(g,l,d,y,b,T,S);return a.ae.invert(C,C),a.ae.multiply(C,g,C),C}{const C=a.ae.clone(g),k=a.ae.identity([]);return k[0]=S[0],k[1]=S[1],k[4]=S[2],k[5]=S[3],a.ae.multiply(C,C,k),y||a.ae.rotateZ(C,C,-b.angle),C}}return b.glCoordMatrix}function yo(g,l,d,y){const b=[g,l,d,1];d?a.aB.transformMat4(b,b,y):rp(b,b,y);const T=b[3];return b[0]/=T,b[1]/=T,b[2]/=T,b}function Kn(g,l){return Math.min(.5+g/l*.5,1.5)}function aa(g,l){const d=g[0]/g[3],y=g[1]/g[3];return d>=-l[0]&&d<=l[0]&&y>=-l[1]&&y<=l[1]}function oc(g,l,d,y,b,T,S,C,k,L){const N=d.transform,j=y?g.textSizeData:g.iconSizeData,G=a.aE(j,d.transform.zoom),q=N.projection.name==="globe",re=[256/d.width*2+1,256/d.height*2+1],ie=y?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;ie.clear();let ae=null;q&&(ae=y?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const ce=g.lineVertexArray,ye=y?g.text.placedSymbolArray:g.icon.placedSymbolArray,ve=d.transform.width/d.transform.height;let _e,Re=!1;for(let Se=0;Se<ye.length;Se++){const Ie=ye.get(Se),{numGlyphs:ze,writingMode:Ne}=Ie;if(Ne!==a.aF.vertical||Re||_e===a.aF.horizontal||(Re=!0),_e=Ne,(Ie.hidden||Ne===a.aF.vertical)&&!Re){Ia(ze,ie);continue}Re=!1;const qe=new a.P(Ie.tileAnchorX,Ie.tileAnchorY);let{x:Fe,y:Pe,z:Qe}=N.projection.projectTilePoint(qe.x,qe.y,L.canonical);if(k){const[Nt,Bt,on]=k(qe);Fe+=Nt,Pe+=Bt,Qe+=on}const Xe=[Fe,Pe,Qe,1];if(a.aB.transformMat4(Xe,Xe,l),!aa(Xe,re)){Ia(ze,ie);continue}const Ue=Xe[3],_t=Kn(d.transform.getCameraToCenterDistance(N.projection),Ue),ut=a.aG(j,G,Ie),We=S?ut/_t:ut*_t,nt=yo(Fe,Pe,Qe,b);if(nt[3]<=0){Ia(ze,ie);continue}let je={};const ht=S?null:k,ft=Rs(Ie,We,!1,C,l,b,T,g.glyphOffsetArray,ce,ie,ae,nt,qe,je,ve,ht,N.projection,L,S);Re=ft.useVertical,ht&&ft.needsFlipping&&(je={}),(ft.notEnoughRoom||Re||ft.needsFlipping&&Rs(Ie,We,!0,C,l,b,T,g.glyphOffsetArray,ce,ie,ae,nt,qe,je,ve,ht,N.projection,L,S).notEnoughRoom)&&Ia(ze,ie)}y?(g.text.dynamicLayoutVertexBuffer.updateData(ie),ae&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(ae)):(g.icon.dynamicLayoutVertexBuffer.updateData(ie),ae&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(ae))}function th(g,l,d,y,b,T,S,C,k,L,N,j,G,q,re,ie){const{lineStartIndex:ae,glyphStartIndex:ce,segment:ye}=C,ve=ce+C.numGlyphs,_e=ae+C.lineLength,Re=l.getoffsetX(ce),Se=l.getoffsetX(ve-1),Ie=cc(g*Re,d,y,b,T,S,ye,ae,_e,k,L,N,j,G,!0,q,re,ie);if(!Ie)return null;const ze=cc(g*Se,d,y,b,T,S,ye,ae,_e,k,L,N,j,G,!0,q,re,ie);return ze?{first:Ie,last:ze}:null}function ac(g,l,d,y){return g===a.aF.horizontal&&Math.abs(y)>Math.abs(d)?{useVertical:!0}:g===a.aF.vertical?y>0?{needsFlipping:!0}:null:l!==sr.unknown&&function(b,T){return b===0||Math.abs(T/b)>io}(d,y)?l===sr.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null}function Rs(g,l,d,y,b,T,S,C,k,L,N,j,G,q,re,ie,ae,ce,ye){const ve=l/24,_e=g.lineOffsetX*ve,Re=g.lineOffsetY*ve,{lineStartIndex:Se,glyphStartIndex:Ie,numGlyphs:ze,segment:Ne,writingMode:qe,flipState:Fe}=g,Pe=Se+g.lineLength,Qe=Xe=>{if(N){const[We,nt,je]=Xe.up,ht=L.length;a.aH(N,ht+0,We,nt,je),a.aH(N,ht+1,We,nt,je),a.aH(N,ht+2,We,nt,je),a.aH(N,ht+3,We,nt,je)}const[Ue,_t,ut]=Xe.point;a.aI(L,Ue,_t,ut,Xe.angle)};if(ze>1){const Xe=th(ve,C,_e,Re,d,j,G,g,k,T,q,ie,!1,ae,ce,ye);if(!Xe)return{notEnoughRoom:!0};if(y&&!d){let[Ue,_t,ut]=Xe.first.point,[We,nt,je]=Xe.last.point;[Ue,_t]=yo(Ue,_t,ut,S),[We,nt]=yo(We,nt,je,S);const ht=ac(qe,Fe,(We-Ue)*re,nt-_t);if(g.flipState=ht&&ht.needsFlipping?sr.flipRequired:sr.flipNotRequired,ht)return ht}Qe(Xe.first);for(let Ue=Ie+1;Ue<Ie+ze-1;Ue++){const _t=cc(ve*C.getoffsetX(Ue),_e,Re,d,j,G,Ne,Se,Pe,k,T,q,ie,!1,!1,ae,ce,ye);if(!_t)return L.length-=4*(Ue-Ie),{notEnoughRoom:!0};Qe(_t)}Qe(Xe.last)}else{if(y&&!d){const Ue=yo(G.x,G.y,0,b),_t=Se+Ne+1,ut=new a.P(k.getx(_t),k.gety(_t)),We=yo(ut.x,ut.y,0,b),nt=We[3]>0?We:lc(G,ut,Ue,1,b,void 0,ae,ce.canonical),je=ac(qe,Fe,(nt[0]-Ue[0])*re,nt[1]-Ue[1]);if(g.flipState=je&&je.needsFlipping?sr.flipRequired:sr.flipNotRequired,je)return je}const Xe=cc(ve*C.getoffsetX(Ie),_e,Re,d,j,G,Ne,Se,Pe,k,T,q,ie,!1,!1,ae,ce,ye);if(!Xe)return{notEnoughRoom:!0};Qe(Xe)}return{}}function dd(g,l,d,y,b){const{x:T,y:S,z:C}=y.projectTilePoint(g.x,g.y,l);if(!b)return yo(T,S,C,d);const[k,L,N]=b(g);return yo(T+k,S+L,C+N,d)}function lc(g,l,d,y,b,T,S,C){const k=dd(g.sub(l)._unit()._add(g),C,b,S,T);return a.$.sub(k,d,k),a.$.normalize(k,k),a.$.scaleAndAdd(k,d,k,y)}function cc(g,l,d,y,b,T,S,C,k,L,N,j,G,q,re,ie,ae,ce){const ye=y?g-l:g+l;let ve=ye>0?1:-1,_e=0;y&&(ve*=-1,_e=Math.PI),ve<0&&(_e+=Math.PI);let Re=C+S+(ve>0?0:1)|0,Se=b,Ie=b,ze=0,Ne=0;const qe=Math.abs(ye),Fe=[],Pe=[];let Qe=T,Xe=Qe;const Ue=()=>lc(Xe,Qe,Ie,qe-ze+1,N,G,ie,ae.canonical);for(;ze+Ne<=qe;){if(Re+=ve,Re<C||Re>=k)return null;if(Ie=Se,Xe=Qe,Fe.push(Ie),q&&Pe.push(Xe),Qe=new a.P(L.getx(Re),L.gety(Re)),Se=j[Re],!Se){const Bt=dd(Qe,ae.canonical,N,ie,G);Se=Bt[3]>0?j[Re]=Bt:Ue()}ze+=Ne,Ne=a.$.distance(Ie,Se)}re&&G&&(j[Re]&&(Se=Ue(),Ne=a.$.distance(Ie,Se)),j[Re]=Se);const _t=(qe-ze)/Ne,ut=Qe.sub(Xe)._mult(_t)._add(Xe),We=a.$.sub([],Se,Ie),nt=a.$.scaleAndAdd([],Ie,We,_t);let je=[0,0,1],ht=We[0],ft=We[1];if(ce&&(je=ie.upVector(ae.canonical,ut.x,ut.y),je[0]!==0||je[1]!==0||je[2]!==1)){const Bt=[je[2],0,-je[0]],on=a.$.cross([],je,Bt);a.$.normalize(Bt,Bt),a.$.normalize(on,on),ht=a.$.dot(We,Bt),ft=a.$.dot(We,on)}if(d){const Bt=a.$.cross([],je,We);a.$.normalize(Bt,Bt),a.$.scaleAndAdd(nt,nt,Bt,d*ve)}const Nt=_e+Math.atan2(ft,ht);return Fe.push(nt),q&&Pe.push(ut),{point:nt,angle:Nt,path:Fe,tilePath:Pe,up:je}}function Ia(g,l){const d=l.length,y=d+4*g;l.resize(y),l.float32.fill(-1/0,4*d,4*y)}function rp(g,l,d){const y=l[0],b=l[1];return g[0]=d[0]*y+d[4]*b+d[12],g[1]=d[1]*y+d[5]*b+d[13],g[3]=d[3]*y+d[7]*b+d[15],g}const nh=(g,l,d)=>(1-d)*g+d*l,Xa=g=>g*g*g*g*g;class eu{constructor(l,d,y,b,T,S,C){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=y??0,this._maxPitch=b??60,this.setProjection(S),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new a.aJ(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Qc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new fi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const l=new eu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(l,d=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||y)&&this._updateCameraOnTerrain(),(l||y)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return a.ai(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=a.aK(this.projectionOptions);const y=this.getProjection(),b=!a.d(d,y);return b&&this._calcMatrices(),this.mercatorFromTransition=!1,b}setOrthographicProjectionAtLowPitch(l){return this._orthographicProjectionAtLowPitch!==l&&(this._orthographicProjectionAtLowPitch=l,this._calcMatrices(),!0)}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.aK({name:"mercator"});const d=l!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.ay(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.av(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const d=-l*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=a.aD.create(),a.aD.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const d=a.au(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=a.ac(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const d=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(l){this._tileCoverLift!==l&&(this._tileCoverLift=l)}_updateCameraOnTerrain(){const l=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,d=this.elevation&&l===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||l===Number.NEGATIVE_INFINITY&&(!d||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const y=this._elevation;d||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&y.exaggeration()&&this._centerAltitudeValidForExaggeration!==y.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*y.exaggeration(),this._centerAltitudeValidForExaggeration=y.exaggeration()):(this._centerAltitude=l||0,this._centerAltitudeValidForExaggeration=y.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let b=0,T=0;for(let S=0;S<d.length;S++){const C=new a.P(d[S][0]*this.width,y+d[S][1]*(this.height-y)),k=l.pointCoordinate(C);if(!k)continue;const L=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);b+=k[3]*L,T+=L}return T===0?NaN:b/T}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const l=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*d,b=this._mercatorZfromZoom(l),T=this._mercatorZfromZoom(this._maxZoom),S=Math.max(b-y,T);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let y;y=l.z<this._camera.position[2]?[d.x,d.y,d.z]:[l.x,l.y,l.z];const b=a.$.length(a.$.sub([],this._camera.position,y));return a.au(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let d=!1;if(l.orientation&&!a.aw.exactEquals(l.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(l.orientation)),l.position){const y=[l.position.x,l.position.y,l.position.z];a.$.exactEquals(y,this._camera.position)||(this._setCameraPosition(y),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,d=new hd;return d.position=new a._(l[0],l[1],l[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(l){if(!a.aw.length(l))return!1;a.aw.normalize(l,l);const d=a.$.transformQuat([],[0,0,-1],l),y=a.$.transformQuat([],[0,-1,0],l);if(y[2]<0)return!1;const b=sc(d,y);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(l){const d=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;l[2]=a.au(l[2],b/y,b/d),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,d,y){this._unmodified=!1,this._edgeInsets.interpolate(l,d,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const d=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(l){const d=[new a.aL(0,l)];if(this.renderWorldCopies){const y=this.pointCoordinate(new a.P(0,0)),b=this.pointCoordinate(new a.P(this.width,0)),T=this.pointCoordinate(new a.P(this.width,this.height)),S=this.pointCoordinate(new a.P(0,this.height)),C=Math.floor(Math.min(y.x,b.x,T.x,S.x)),k=Math.floor(Math.max(y.x,b.x,T.x,S.x)),L=1;for(let N=C-L;N<=k+L;N++)N!==0&&d.push(new a.aL(N,l))}return d}isLODDisabled(l){return(!l||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(l,d,y){let b=[];const T=y!==void 0,S=!T;if(S&&this.zoom<d||T&&y[0]===0&&y[1]===0)return b;const C=new Set,k=(N,j,G,q,re)=>{const ie=a.b2(j,N,G,q,re);C.has(ie)||(b.push(new a.aQ(N,j,G,q,re)),C.add(ie))};for(let N=0;N<l.length;N++){const j=l[N];if(S&&j.canonical.z!==d)continue;const G=j.canonical,q=j.overscaledZ,re=j.wrap,ie=1<<G.z,ae=G.x+1<ie,ce=G.x>0,ye=G.y+1<ie,ve=G.y>0,_e=j.wrap-(ce?0:1),Re=j.wrap+(ae?0:1),Se=ce?G.x-1:ie-1,Ie=ae?G.x+1:0;if(T)y[0]<0?(k(q,Re,G.z,Ie,G.y),y[1]<0&&ye&&(k(q,re,G.z,G.x,G.y+1),k(q,Re,G.z,Ie,G.y+1)),y[1]>0&&ve&&(k(q,re,G.z,G.x,G.y-1),k(q,Re,G.z,Ie,G.y-1))):y[0]>0?(k(q,_e,G.z,Se,G.y),y[1]<0&&ye&&(k(q,re,G.z,G.x,G.y+1),k(q,_e,G.z,Se,G.y+1)),y[1]>0&&ve&&(k(q,re,G.z,G.x,G.y-1),k(q,_e,G.z,Se,G.y-1))):y[1]<0&&ye?k(q,re,G.z,G.x,G.y+1):ve&&k(q,re,G.z,G.x,G.y-1);else{const ze=j.visibleQuadrants;1&ze&&(k(q,_e,G.z,Se,G.y),ve&&(k(q,re,G.z,G.x,G.y-1),k(q,_e,G.z,Se,G.y-1))),2&ze&&(k(q,Re,G.z,Ie,G.y),ve&&(k(q,re,G.z,G.x,G.y-1),k(q,Re,G.z,Ie,G.y-1))),4&ze&&(k(q,_e,G.z,Se,G.y),ye&&(k(q,re,G.z,G.x,G.y+1),k(q,_e,G.z,Se,G.y+1))),8&ze&&(k(q,Re,G.z,Ie,G.y),ye&&(k(q,re,G.z,G.x,G.y+1),k(q,Re,G.z,Ie,G.y+1)))}}const L=[];for(const N of b)b.some(j=>N.isChildOf(j))||L.push(N);if(b=L.filter(N=>!l.some(j=>!!(N.overscaledZ<d&&j.isChildOf(N))||N.equals(j)||N.isChildOf(j))),S){const N=1<<d,j=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=[N*j.x,N*j.y],q=4,re=q*q;b=b.filter(ie=>{const ae=ie.canonical.x+.5-G[0],ce=ie.canonical.y+.5-G[1];return ae*ae+ce*ce<re})}return b}coveringTiles(l){let d=this.coveringZoomLevel(l);const y=d,b=this.elevation&&this.elevation.exaggeration(),T=b&&!l.isTerrainDEM,S=this.projection.name==="mercator";if(l.minzoom!==void 0&&d<l.minzoom)return[];l.maxzoom!==void 0&&d>l.maxzoom&&(d=l.maxzoom);const C=this.locationCoordinate(this.center),k=this.center.lat,L=1<<d,N=[L*C.x,L*C.y,0],j=this.projection.name==="globe",G=!j,q=a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,G),re=j?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ie=L*a.ay(1,this.center.lat),ae=this._camera.position[2]/a.ay(1,this.center.lat),ce=[L*re.x,L*re.y,ae*(G?1:ie)],ye=j||b,ve=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),_e=this.isLODDisabled(!0)?d:0;let Re;if(this._elevation&&l.isTerrainDEM)Re=1e4*this._elevation.exaggeration();else if(this._elevation){const We=this._elevation.getMinMaxForVisibleTiles();Re=We?We.max:this._centerAltitude}else Re=this._centerAltitude;const Se=l.isTerrainDEM?-Re:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ie=this.projection.isReprojectedInTileSpace?a.aN(this):1,ze=We=>{const je=new a._(We.x+25e-6,We.y,We.z),ht=new a._(We.x,We.y+25e-6,We.z),ft=We.toLngLat(),Nt=je.toLngLat(),Bt=ht.toLngLat(),on=this.locationCoordinate(ft),Gt=this.locationCoordinate(Nt),Tn=this.locationCoordinate(Bt),Vn=Math.hypot(Gt.x-on.x,Gt.y-on.y),Sn=Math.hypot(Tn.x-on.x,Tn.y-on.y);return Math.sqrt(Vn*Sn)*Ie/25e-6},Ne=We=>{const nt=Re,je=Se;return{aabb:a.aR(this,L,0,0,0,We,je,nt,this.projection),zoom:0,x:0,y:0,minZ:je,maxZ:nt,wrap:We,fullyVisible:!1}},qe=[];let Fe=[];const Pe=d,Qe=l.reparseOverscaled?y:d,Xe=(ae-this._centerAltitude)*ie,Ue=We=>{if(!this._elevation||!We.tileID||!S)return;const nt=this._elevation.getMinMaxForTile(We.tileID),je=We.aabb;nt?(je.min[2]=nt.min,je.max[2]=nt.max,je.center[2]=(je.min[2]+je.max[2])/2):(We.shouldSplit=ut(We),We.shouldSplit||(je.min[2]=je.max[2]=je.center[2]=this._centerAltitude))},_t=(We,nt)=>{if(.707*nt<We)return 1;const je=nt/We;return je/(1.4144271570014144+(Math.pow(1.1,je-1.4144271570014144+1)-1)/(1.1-1)-1)},ut=We=>{if(We.zoom<_e)return!0;if(We.zoom===Pe)return!1;if(We.shouldSplit!=null)return We.shouldSplit;const nt=We.aabb.distanceX(ce),je=We.aabb.distanceY(ce);let ht=Xe,ft=1;if(j){ht=We.aabb.distanceZ(ce);const Sn=Math.pow(2,We.zoom),Zn=a.az((We.y+1)/Sn),pr=a.az(We.y/Sn),ti=Math.min(Math.max(k,Zn),pr),Vr=a.b6(ti)/a.b6(k);if(ft=ti===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Vr/this._mercatorScaleRatio),this.zoom<=a.b3&&We.zoom===Pe-1&&Vr>=.9)return!0}else if(T&&(ht=We.aabb.distanceZ(ce)*ie),this.projection.isReprojectedInTileSpace&&y<=5){const Sn=Math.pow(2,We.zoom),Zn=ze(new a._((We.x+.5)/Sn,(We.y+.5)/Sn));ft=Zn>.85?1:Zn}if(!S){const Sn=Math.sqrt(nt*nt+je*je+ht*ht);let Zn=(1<<Pe-We.zoom)*ve*ft;return Zn*=_t(Math.max(ht,Xe),Sn),Sn<Zn}let Nt=Number.MAX_VALUE,Bt=0;const on=We.aabb.getCorners(),Gt=[];for(const Sn of on){a.$.sub(Gt,Sn,ce),j||(T?Gt[2]*=ie:Gt[2]=Xe);const Zn=a.$.dot(Gt,this._camera.forward());Zn<Nt&&(Nt=Zn,Bt=Math.abs(Gt[2]))}let Tn=(1<<Pe-We.zoom)*ve*ft;if(Tn*=_t(Math.max(Bt,Xe),Nt),Nt<Tn)return!0;const Vn=We.aabb.closestPoint(N);return Vn[0]===N[0]&&Vn[1]===N[1]};if(this.renderWorldCopies)for(let We=1;We<=3;We++)qe.push(Ne(-We)),qe.push(Ne(We));for(qe.push(Ne(0));qe.length>0;){const We=qe.pop(),nt=We.x,je=We.y;let ht=We.fullyVisible;const ft=()=>this.projection.name==="globe"&&(We.y===0||We.y===(1<<We.zoom)-1);if(!ht){let Nt=ye?We.aabb.intersects(q):We.aabb.intersectsFlat(q);if(Nt===0&&ft()){const Bt=new a.aO(We.zoom,nt,je);Nt=a.aP(this,L,Bt,!0).intersects(q)}if(Nt===0)continue;ht=Nt===2}if(We.zoom!==Pe&&ut(We))for(let Nt=0;Nt<4;Nt++){const Bt=(nt<<1)+Nt%2,on=(je<<1)+(Nt>>1),Gt={aabb:S?We.aabb.quadrant(Nt):a.aR(this,L,We.zoom+1,Bt,on,We.wrap,We.minZ,We.maxZ,this.projection),zoom:We.zoom+1,x:Bt,y:on,wrap:We.wrap,fullyVisible:ht,tileID:void 0,shouldSplit:void 0,minZ:We.minZ,maxZ:We.maxZ};T&&!j&&(Gt.tileID=new a.aQ(We.zoom+1===Pe?Qe:We.zoom+1,We.wrap,We.zoom+1,Bt,on),Ue(Gt)),qe.push(Gt)}else{const Nt=We.zoom===Pe?Qe:We.zoom;if(l.minzoom&&l.minzoom>Nt)continue;let Bt=0;if(!ht){let Vn=ye?We.aabb.intersectsPrecise(q):We.aabb.intersectsPreciseFlat(q);if(Vn===0&&ft()){const Sn=new a.aO(We.zoom,nt,je);Vn=a.aP(this,L,Sn,!0).intersectsPrecise(q)}if(Vn===0)continue;if(l.calculateQuadrantVisibility)if(q.containsPoint(We.aabb.center))Bt=15;else for(let Sn=0;Sn<4;Sn++)We.aabb.quadrant(Sn).intersects(q)!==0&&(Bt|=1<<Sn)}const on=N[0]-(.5+nt+(We.wrap<<We.zoom))*(1<<d-We.zoom),Gt=N[1]-.5-je,Tn=We.tileID?We.tileID:new a.aQ(Nt,We.wrap,We.zoom,nt,je);l.calculateQuadrantVisibility&&(Tn.visibleQuadrants=Bt),Fe.push({tileID:Tn,distanceSq:on*on+Gt*Gt})}}if(this.fogCullDistSq){const We=this.fogCullDistSq,nt=this.horizonLineFromTop();Fe=Fe.filter(je=>{const ht=[0,0,0,1],ft=[a.a4,a.a4,0,1],Nt=this.calculateFogTileMatrix(je.tileID.toUnwrapped());a.aB.transformMat4(ht,ht,Nt),a.aB.transformMat4(ft,ft,Nt);const Bt=a.aB.min([],ht,ft),on=a.aB.max([],ht,ft),Gt=a.aS(Bt,on);if(Gt===0)return!0;let Tn=!1;const Vn=this._elevation;if(Vn&&Gt>We&&nt!==0){const Sn=this.calculateProjMatrix(je.tileID.toUnwrapped());let Zn;l.isTerrainDEM||(Zn=Vn.getMinMaxForTile(je.tileID)),Zn||(Zn={min:Se,max:Re});const pr=a.b4(this.rotation),ti=[pr[0]*a.a4,pr[1]*a.a4,Zn.max];a.$.transformMat4(ti,ti,Sn),Tn=(1-ti[1])*this.height*.5<nt}return Gt<We||Tn})}return Fe.sort((We,nt)=>We.distanceSq-nt.distanceSq).map(We=>We.tileID)}resize(l,d){this.width=l,this.height=d,this.pixelsToGLUnits=[2/l,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const d=a.au(l.lat,-a.aT,a.aT),y=this.projection.project(l.lng,d);return new a.P(y.x*this.worldSize,y.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.ay(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,d){let y,b;const T=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;y=(d.x-T.x)/C,b=(d.y-T.y)/C}else{const C=this.pointCoordinate(d),k=this.pointCoordinate(T);y=C.x-k.x,b=C.y-k.y}const S=this.locationCoordinate(l);this.setLocation(new a._(S.x-y,S.y-b))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,d){const y=d?a.ay(d,l.lat):void 0,b=this.projection.project(l.lng,l.lat);return new a._(b.x,b.y,y)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,d){const y=d??this._centerAltitude,b=[l.x,l.y,0,1],T=[l.x,l.y,1,1];a.aB.transformMat4(b,b,this.pixelMatrixInverse),a.aB.transformMat4(T,T,this.pixelMatrixInverse);const S=T[3];a.aB.scale(b,b,1/b[3]),a.aB.scale(T,T,1/S);const C=b[2],k=T[2];return{p0:b,p1:T,t:C===k?0:(y-C)/(k-C)}}screenPointToMercatorRay(l){const d=[l.x,l.y,0,1],y=[l.x,l.y,1,1];return a.aB.transformMat4(d,d,this.pixelMatrixInverse),a.aB.transformMat4(y,y,this.pixelMatrixInverse),a.aB.scale(d,d,1/d[3]),a.aB.scale(y,y,1/y[3]),d[2]=a.ay(d[2],this._center.lat)*this.worldSize,y[2]=a.ay(y[2],this._center.lat)*this.worldSize,a.aB.scale(d,d,1/this.worldSize),a.aB.scale(y,y,1/this.worldSize),new a.aU([d[0],d[1],d[2]],a.$.normalize([],a.$.sub([],y,d)))}rayIntersectionCoordinate(l){const{p0:d,p1:y,t:b}=l,T=a.ay(d[2],this._center.lat),S=a.ay(y[2],this._center.lat);return new a._(a.a3(d[0],y[0],b)/this.worldSize,a.a3(d[1],y[1],b)/this.worldSize,a.a3(T,S,b))}pointCoordinate(l,d=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,d)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let d=this.projection.pointCoordinate3D(this,l.x,l.y);if(d)return new a._(d[0],d[1],d[2]);let y=0,b=this.horizonLineFromTop();if(l.y>b)return this.pointCoordinate(l);const T=.02*b,S=l.clone();for(let C=0;C<10&&b-y>T;C++){S.y=a.a3(y,b,.66);const k=this.projection.pointCoordinate3D(this,S.x,S.y);k?(b=S.y,d=k):y=S.y}return d?new a._(d[0],d[1],d[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=a.aV)return!this.isPointAboveHorizon(l);const d=this.pointCoordinate(l);return d.y>=0&&d.y<=1}_coordinatePoint(l,d){const y=d&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,b=[l.x*this.worldSize,l.y*this.worldSize,y+l.toAltitude(),1];return a.aB.transformMat4(b,b,this.pixelMatrix),b[3]>0?new a.P(b[0]/b[3],b[1]/b[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:d}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,T=this.pointLocation3D(new a.P(d,l)),S=this.pointLocation3D(new a.P(b,l)),C=this.pointLocation3D(new a.P(b,y)),k=this.pointLocation3D(new a.P(d,y));let L=Math.min(T.lng,S.lng,C.lng,k.lng),N=Math.max(T.lng,S.lng,C.lng,k.lng),j=Math.min(T.lat,S.lat,C.lat,k.lat),G=Math.max(T.lat,S.lat,C.lat,k.lat);const q=Math.pow(2,-this.zoom)/16*270,re=this.projection.name==="globe"?1:4,ie=(ae,ce,ye,ve,_e)=>{const Re=(ae+ye)/2,Se=(ce+ve)/2,Ie=new a.P(Re,Se),{lng:ze,lat:Ne}=this.pointLocation3D(Ie),qe=Math.max(0,L-ze,j-Ne,ze-N,Ne-G);L=Math.min(L,ze),N=Math.max(N,ze),j=Math.min(j,Ne),G=Math.max(G,Ne),(_e<re||qe>q)&&(ie(ae,ce,Re,Se,_e+1),ie(Re,Se,ye,ve,_e+1))};if(ie(d,l,b,l,1),ie(b,l,b,y,1),ie(b,y,d,y,1),ie(d,y,d,l,1),this.projection.name==="globe"){const[ae,ce]=a.aW(this);ae?(G=90,N=180,L=-180):ce&&(j=-90,N=180,L=-180)}return new a.aj(new a.aJ(L,j),new a.aJ(N,G))}_getBoundsRectangular(l,d){const{top:y,left:b}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,C=new a.P(b,y),k=new a.P(S,y),L=new a.P(S,T),N=new a.P(b,T);let j=this.pointCoordinate(C,l),G=this.pointCoordinate(k,l);const q=this.pointCoordinate(L,d),re=this.pointCoordinate(N,d),ie=(ae,ce)=>(ce.y-ae.y)/(ce.x-ae.x);return j.y>1&&G.y>=0?j=new a._((1-re.y)/ie(re,j)+re.x,1):j.y<0&&G.y<=1&&(j=new a._(-re.y/ie(re,j)+re.x,0)),G.y>1&&j.y>=0?G=new a._((1-q.y)/ie(q,G)+q.x,1):G.y<0&&j.y<=1&&(G=new a._(-q.y/ie(q,G)+q.x,0)),new a.aj().extend(this.coordinateLocation(j)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(re)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=l.visibleDemTiles.reduce((y,b)=>{if(b.dem){const T=b.dem.tree;y.min=Math.min(y.min,T.minimums[0]),y.max=Math.max(y.max,T.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*l.exaggeration(),d.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,y=this.height/2-d*(1-this._horizonShift);return l?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-a.aT,this.maxLat=a.aT,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.ak(this.minLng)*this.tileSize,this.worldMaxX=a.ak(this.maxLng)*this.tileSize,this.worldMinY=a.al(this.maxLat)*this.tileSize,this.worldMaxY=a.al(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,d){return this.projection.createTileMatrix(this,d,l)}calculateDistanceTileData(l){const d=l.key,y=this._distanceTileDataCache;if(y[d])return y[d];const b=l.canonical,T=1/this.height,S=this.cameraWorldSize,C=S/this.zoomScale(b.z),k=(b.x+Math.pow(2,b.z)*l.wrap)*C,L=b.y*C,N=this.point;N.x*=S/this.worldSize,N.y*=S/this.worldSize;const j=this.angle,G=Math.sin(-j),q=-Math.cos(-j);return y[d]={bearing:[G,q],center:[(N.x-k)*T,(N.y-L)*T],scale:C/a.a4*T},y[d]}calculateFogTileMatrix(l){const d=l.key,y=this._fogTileMatrixCache;if(y[d])return y[d];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return a.ae.multiply(b,this.worldToFogMatrix,b),y[d]=new Float32Array(b),y[d]}calculateProjMatrix(l,d=!1,y=!1){const b=l.key;let T;if(T=y?this._expandedProjMatrixCache:d?this._alignedProjMatrixCache:this._projMatrixCache,T[b])return T[b];const S=this.calculatePosMatrix(l,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:y?this.expandedFarZProjMatrix:d?this.alignedProjMatrix:this.projMatrix,a.ae.multiply(S,C,S),T[b]=new Float32Array(S),T[b]}calculatePixelsToTileUnitsMatrix(l){const d=l.tileID.key,y=this._pixelsToTileUnitsCache;if(y[d])return y[d];const b=a.aX(l,this);return y[d]=b,y[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const l=1/this.worldSize,d=a.ae.fromScaling([],[l,l,l]);return a.ae.multiply(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const l=this._elevation;this._updateCameraState();const d=a.ay(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(d),b=this._camera.forward(),T=a.ay(1,this._center.lat);y[2]/=T,b[2]/=T,a.$.normalize(b,b);const S=l.raycast(y,b,l.exaggeration());if(S){const C=a.$.scaleAndAdd([],y,b,S),k=new a._(C[0],C[1],a.ay(C[2],a.az(C[1]))),L=(k.z+a.$.length([k.x-y[0],k.y-y[1],k.z-y[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const d=this._elevation,y=a.ay(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(y),T=d.getAtPointOrZero(new a._(...b)),S=this.pixelsPerMeter/this.worldSize*T,C=this._minimumHeightOverTerrain(),k=b[2]-S;if(k<=C)if(k<0||l){const L=this.locationCoordinate(this._center,this._centerAltitude),N=[b[0],b[1],L.z-b[2]],j=a.$.length(N);N[2]-=(C-k)/this._pixelsPerMercatorPixel;const G=a.$.length(N);if(G===0)return;a.$.scale(N,N,j/G*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],L.z*this._pixelsPerMercatorPixel-N[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const G=this.center;return G.lat=a.au(G.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(G.lng=a.au(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}const d=this._unmodified,{x:y,y:b}=this.point;let T=0,S=y,C=b;const k=this.width/2,L=this.height/2,N=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(b-L<N&&(C=N+L),b+L>j&&(C=j-L),j-N<this.height&&(T=Math.max(T,this.height/(j-N)),C=(j+N)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const G=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,re=this.worldSize/2-(G+q)/2;S=(y+re+this.worldSize)%this.worldSize-re,S-k<G&&(S=G+k),S+k>q&&(S=q-k),q-G<this.width&&(T=Math.max(T,this.width/(q-G)),S=(q+G)/2)}S===y&&C===b||(this.center=this.unproject(new a.P(S,C))),T&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,d=this.projection.name==="globe",y=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.ay(1,this.center.lat)/a.ay(1,a.b5));const b=a.aY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const T=this.projection.zAxisUnit==="meters"?y:1,S=this._camera.getWorldToCamera(this.worldSize,T);let C;const k=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(k[8]=2*-l.x/this.width,k[9]=2*l.y/this.height,this.isOrthographic){let Ne=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),qe=Ne*this.aspect,Fe=-qe,Pe=-Ne;qe-=l.x,Fe-=l.x,Ne+=l.y,Pe+=l.y,C=this._camera.getCameraToClipOrthographic(Fe,qe,Pe,Ne,this._nearZ,this._farZ),((Qe,Xe,Ue,_t)=>{for(let ut=0;ut<16;ut++)Qe[ut]=nh(Xe[ut],Ue[ut],_t)})(C,C,k,Xa(this.pitch>=15?1:this.pitch/15))}else C=k;const L=a.ae.mul([],k,S);let N=a.ae.mul([],C,S);if(this.projection.isReprojectedInTileSpace){const Ne=this.locationCoordinate(this.center),qe=a.ae.identity([]);a.ae.translate(qe,qe,[Ne.x*this.worldSize,Ne.y*this.worldSize,0]),a.ae.multiply(qe,qe,a.aZ(this)),a.ae.translate(qe,qe,[-Ne.x*this.worldSize,-Ne.y*this.worldSize,0]),a.ae.multiply(N,N,qe),a.ae.multiply(L,L,qe),this.inverseAdjustmentMatrix=a.a_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.ae.scale([],N,[this.worldSize,this.worldSize,this.worldSize/T,1]),this.projMatrix=N,this.invProjMatrix=a.ae.invert(new Float64Array(16),this.projMatrix),d){const Ne=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ne[8]=2*-l.x/this.width,Ne[9]=2*l.y/this.height,this.expandedFarZProjMatrix=a.ae.mul([],Ne,S)}else this.expandedFarZProjMatrix=this.projMatrix;const j=a.ae.invert([],C);this.frustumCorners=a.a$.fromInvProjectionMatrix(j,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!d);const G=new Float32Array(16);a.ae.identity(G),a.ae.scale(G,G,[1,-1,1]),a.ae.rotateX(G,G,this._pitch),a.ae.rotateZ(G,G,this.angle);const q=a.ae.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.ae.clone(q);const re=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-l.x/this.width,q[9]=2*(l.y+re)/this.height,this.skyboxMatrix=a.ae.multiply(G,q,G);const ie=this.point,ae=ie.x,ce=ie.y,ye=this.width%2/2,ve=this.height%2/2,_e=Math.cos(this.angle),Re=Math.sin(this.angle),Se=ae-Math.round(ae)+_e*ye+Re*ve,Ie=ce-Math.round(ce)+_e*ve+Re*ye,ze=new Float64Array(N);if(a.ae.translate(ze,ze,[Se>.5?Se-1:Se,Ie>.5?Ie-1:Ie,0]),this.alignedProjMatrix=ze,N=a.ae.create(),a.ae.scale(N,N,[this.width/2,-this.height/2,1]),a.ae.translate(N,N,[1,-1,0]),this.labelPlaneMatrix=N,N=a.ae.create(),a.ae.scale(N,N,[1,-1,1]),a.ae.translate(N,N,[-1,-1,0]),a.ae.scale(N,N,[2/this.width,2/this.height,1]),this.glCoordMatrix=N,this.pixelMatrix=a.ae.multiply(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},N=a.ae.invert(new Float64Array(16),this.pixelMatrix),!N)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=N,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.b0(this);const Ne=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.$.transformMat4(Ne,Ne,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=N;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,y=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,T=[l,l,d];a.$.scale(T,T,b),a.$.scale(y,y,-1),a.$.multiply(y,y,T);const S=a.ae.create();a.ae.translate(S,S,y),a.ae.scale(S,S,T),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,d,b)}_computeCameraPosition(l){const d=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),b=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-l/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-y[0]*T,b.y/this.worldSize-y[1]*T,l/this.worldSize*this._centerAltitude-y[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],b=l[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(T=Math.min((d-y)/b,1)),this._camera.position=a.$.scaleAndAdd([],this._camera.position,l,T),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,d=this._camera.forward(),{pitch:y,bearing:b}=this._camera.getPitchBearing(),T=a.ay(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.ac(this._maxPitch)),C=Math.max((l[2]-T)/Math.cos(y),S),k=this._zoomFromMercatorZ(C);a.$.scaleAndAdd(l,l,d,C),this._pitch=a.au(y,a.ac(this.minPitch),a.ac(this.maxPitch)),this.angle=a.av(b,-Math.PI,Math.PI),this._setZoom(a.au(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a._(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let d=0,y=a.aV,b=0,T=1/0;for(;y-d>1e-6&&y>d;){const S=d+.5*(y-d),C=this.tileSize*Math.pow(2,S),k=this.getCameraToCenterDistance(this.projection,S,C),L=this.scaleZoom(k/(l*this.tileSize)),N=Math.abs(S-L);N<T&&(T=N,b=S),S<L?d=S:y=S}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,d){const y=Math.min(l.x,d.x),b=Math.max(l.x,d.x),T=Math.min(l.y,d.y),S=Math.max(l.y,d.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new a.P(y,T),new a.P(b,S),new a.P(y,S),new a.P(b,T)],k=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const N of C){const j=this.pointRayIntersection(N);if(j.t<0)return!0;const G=this.rayIntersectionCoordinate(j);if(G.x<k||G.y<0||G.x>L||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.b1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(l,d){const y=a.$.length(a.$.sub([],this._camera.position,l)),b=this._zoomFromMercatorZ(y)+d;return y-this._mercatorZfromZoom(b)}getCameraPoint(){if(this.projection.name==="globe"){const l=function([d,y,b],T){const S=[d,y,b,1];a.aB.transformMat4(S,S,T);const C=S[3]=Math.max(S[3],1e-6);return S[0]/=C,S[1]/=C,S[2]/=C,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,l))}}getCameraToCenterDistance(l,d=this.zoom,y=this.worldSize){const b=a.aY(l,d,this.width,this.height,1024),T=l.pixelSpaceConversion(this.center.lat,y,b);let S=.5/Math.tan(.5*this._fov)*this.height*T;return this.isOrthographic&&(S=nh(1,S,Xa(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.ae.multiply(l,l,this.globeMatrix),l}getFrustum(l){return a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,this.projection.zAxisUnit==="meters")}}const Ms={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},Fs=(g,l)=>{if(l>0&&g.terrain&&a.w("Cutoff is currently disabled on terrain"),l<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const d=g.transform,y=Math.max(Math.abs(d._zoom-(g.minCutoffZoom-1)),1),b=d.isLODDisabled(!1)?a.a0(60,45,d.pitch):a.a0(30,15,d.pitch),T=d._farZ-d._nearZ,S=l*d.height,C=((1-(k=b))*d.cameraToCenterDistance+k*(d._farZ+S))*y;var k;return{shouldRenderCutoff:b<1,uniformValues:{u_cutoff_params:[d._nearZ,d._farZ,(C-d._nearZ)/T,(C-S-d._nearZ)/T]}}},vs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Ii{constructor(l,d){this.aabb=l,this.lastCascade=d}}class la{add(l,d){const y=this.receivers[l.key];y!==void 0?(y.aabb.min[0]=Math.min(y.aabb.min[0],d.min[0]),y.aabb.min[1]=Math.min(y.aabb.min[1],d.min[1]),y.aabb.min[2]=Math.min(y.aabb.min[2],d.min[2]),y.aabb.max[0]=Math.max(y.aabb.max[0],d.max[0]),y.aabb.max[1]=Math.max(y.aabb.max[1],d.max[1]),y.aabb.max[2]=Math.max(y.aabb.max[2],d.max[2])):this.receivers[l.key]=new Ii(d,null)}clear(){this.receivers={}}get(l){return this.receivers[l.key]}computeRequiredCascades(l,d,y){const b=a.b8.fromPoints(l.points);let T=0;for(const S in this.receivers){const C=this.receivers[S];if(!C||!b.intersectsAabb(C.aabb))continue;C.aabb.min=b.closestPoint(C.aabb.min),C.aabb.max=b.closestPoint(C.aabb.max);const k=C.aabb.getCorners();for(let L=0;L<y.length;L++){let N=!0;for(const j of k){const G=[j[0]*d,j[1]*d,j[2]];if(a.$.transformMat4(G,G,y[L].matrix),G[0]<-1||G[0]>1||G[1]<-1||G[1]>1){N=!1;break}}if(C.lastCascade=L,T=Math.max(T,L),N)break}}return T+1}}class dg{constructor(l){this.painter=l,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new la,this._depthMode=new a.af(l.context.gl.LEQUAL,a.af.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,l.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),l.tp.registerParameter(vs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),l.tp.registerParameter(vs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),l.tp.registerParameter(vs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),l.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const l of this._cascades)l.texture.destroy(),l.framebuffer.destroy();this._cascades=[]}updateShadowParameters(l,d){const y=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!d||!d.properties)return;const b=d.properties.get("shadow-intensity");if(!d.shadowsEnabled()||b<=0||(this._shadowLayerCount=y.style.order.reduce((re,ie)=>{const ae=y.style._mergedLayers[ie];return re+(ae.hasShadowPass()&&!ae.isHidden(l.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const T=y.context,S=vs.shadowMapResolution,C=vs.shadowMapResolution;if(this._cascades.length===0||vs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let re=0;re<vs.cascadeCount;++re){const ie=y._shadowMapDebug,ae=T.gl,ce=T.createFramebuffer(S,C,ie,"texture"),ye=new a.T(T,{width:S,height:C,data:null},ae.DEPTH_COMPONENT);if(ce.depthAttachment.set(ye.texture),ie){const ve=new a.T(T,{width:S,height:C,data:null},ae.RGBA);ce.colorAttachment.set(ve.texture)}this._cascades.push({framebuffer:ce,texture:ye,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.aM,scale:0})}}this.shadowDirection=$o(d);let k=0;if(l.elevation){const re=l.elevation,ie=[1e4,-1e4];re.visibleDemTiles.filter(ae=>ae.dem).forEach(ae=>{const ce=ae.dem.tree;ie[0]=Math.min(ie[0],ce.minimums[0]),ie[1]=Math.max(ie[1],ce.maximums[0])}),ie[0]!==1e4&&(k=(ie[1]-ie[0])*re.exaggeration())}const L=1.5*l.cameraToCenterDistance,N=3*L,j=new Float64Array(16);for(let re=0;re<this._cascades.length;++re){const ie=this._cascades[re];let ae=l.height/50,ce=1;vs.cascadeCount===1?ce=N:re===0?ce=L:(ae=L,ce=N);const[ye,ve]=fd(l,this.shadowDirection,ae,ce,vs.shadowMapResolution,k);ie.scale=l.scale,ie.matrix=ye,ie.boundingSphereRadius=ve,a.ae.invert(j,ie.matrix),ie.frustum=a.aM.fromInvProjectionMatrix(j,1,0,!0),ie.far=ce}const G=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[G].far,this._cascades[G].far],this._uniformValues.u_shadow_intensity=b,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/vs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=vs.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ms.ShadowMap0,this._uniformValues.u_shadowmap_1=Ms.ShadowMap0+1,this._groundShadowTiles=y.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const q=y.transform.elevation;for(const re of this._groundShadowTiles){let ie={min:0,max:0};if(q){const ae=q.getMinMaxForTile(re);ae&&(ie=ae)}this.addShadowReceiver(re.toUnwrapped(),ie.min,ie.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(l){this._enabled=l}drawShadowPass(l,d){if(!this.enabled)return;const y=this.painter,b=y.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(y.transform.getFrustum(0),y.transform.worldSize,this._cascades),b.viewport.set([0,0,vs.shadowMapResolution,vs.shadowMapResolution]);for(let T=0;T<this._numCascadesToRender;++T){y.currentShadowCascade=T,b.bindFramebuffer.set(this._cascades[T].framebuffer.framebuffer),b.clear({color:a.C.white,depth:1});for(const S of l.order){const C=l._mergedLayers[S];if(!C.hasShadowPass()||C.isHidden(y.transform.zoom))continue;const k=l.getLayerSourceCache(C),L=k?d[k.id]:void 0;(C.type==="model"||L&&L.length)&&y.renderLayer(y,k,C,L)}}y.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const l=this.painter,d=l.style,y=l.context,b=d.directionalLight,T=d.ambientLight;if(!b||!T)return;const S=[],C=Fs(l,l.longestCutoffRange);C.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const k=tu(d,b,T),L=new a.af(y.gl.LEQUAL,a.af.ReadOnly,l.depthRangeFor3D);for(const N of this._groundShadowTiles){const j=N.toUnwrapped(),G=l.isTileAffectedByFog(N),q=l.getOrCreateProgram("groundShadow",{defines:S,overrideFog:G});this.setupShadows(j,q),l.uploadCommonUniforms(y,q,j,null,C);const re={u_matrix:l.transform.calculateProjMatrix(j),u_ground_shadow_factor:k};q.draw(l,y.gl.TRIANGLES,L,a.ah.disabled,a.a.multiply,a.ag.disabled,re,"ground_shadow",l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments,{},l.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?a.a.unblended:a.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(l){const d=this.painter.transform,y=d.calculatePosMatrix(l,d.worldSize);return a.ae.multiply(y,this._cascades[this.painter.currentShadowCascade].matrix,y),Float32Array.from(y)}calculateShadowPassMatrixFromMatrix(l){return a.ae.multiply(l,this._cascades[this.painter.currentShadowCascade].matrix,l),Float32Array.from(l)}setupShadows(l,d,y,b=0){if(!this.enabled)return;const T=this.painter.transform,S=this.painter.context,C=S.gl,k=this._uniformValues,L=new Float64Array(16),N=T.calculatePosMatrix(l,T.worldSize);for(let j=0;j<this._cascades.length;j++)a.ae.multiply(L,this._cascades[j].matrix,N),k[j===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),S.activeTexture.set(C.TEXTURE0+Ms.ShadowMap0+j),this._cascades[j].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=!!y,this.useNormalOffset){const j=a.b7(l.canonical),G=2/T.tileSize*a.a4/vs.shadowMapResolution,q=G*this._cascades[0].boundingSphereRadius,re=G*this._cascades[this._cascades.length-1].boundingSphereRadius,ie=(y==="vector-tile"?1:3)/Math.pow(2,b-l.canonical.z-(1-T.zoom+Math.floor(T.zoom)));k.u_shadow_normal_offset=[j,q*ie,re*ie],k.u_shadow_bias=[6e-5,.0012,.012]}else k.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(S,k)}setupShadowsFromMatrix(l,d,y=!1){if(!this.enabled)return;const b=this.painter.context,T=b.gl,S=this._uniformValues,C=new Float64Array(16);for(let k=0;k<vs.cascadeCount;k++)a.ae.multiply(C,this._cascades[k].matrix,l),S[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),b.activeTexture.set(T.TEXTURE0+Ms.ShadowMap0+k),this._cascades[k].texture.bind(T.NEAREST,T.CLAMP_TO_EDGE);if(this.useNormalOffset=y,y){const k=vs.normalOffset;S.u_shadow_normal_offset=[1,k,k],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(b,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(l,d,y,b){if(b[2]>=0)return{};const T=function(k,L,N){const j=N/(1<<k.canonical.z);return new a.b8([k.canonical.x*j+k.wrap*N,k.canonical.y*j+k.wrap*N,0],[(k.canonical.x+1)*j+k.wrap*N,(k.canonical.y+1)*j+k.wrap*N,L])}(l,d,y).getCorners(),S=d/-b[2];b[0]<0?(a.$.add(T[0],T[0],[b[0]*S,0,0]),a.$.add(T[3],T[3],[b[0]*S,0,0])):b[0]>0&&(a.$.add(T[1],T[1],[b[0]*S,0,0]),a.$.add(T[2],T[2],[b[0]*S,0,0])),b[1]<0?(a.$.add(T[0],T[0],[0,b[1]*S,0]),a.$.add(T[1],T[1],[0,b[1]*S,0])):b[1]>0&&(a.$.add(T[2],T[2],[0,b[1]*S,0]),a.$.add(T[3],T[3],[0,b[1]*S,0]));const C={};return C.vertices=T,C.planes=[uc(T[1],T[0],T[4]),uc(T[2],T[1],T[5]),uc(T[3],T[2],T[6]),uc(T[0],T[3],T[7])],C}addShadowReceiver(l,d,y){this._receivers.add(l,a.b8.fromTileIdAndHeight(l,d,y))}getMaxCascadeForTile(l){const d=this._receivers.get(l);return d&&d.lastCascade?d.lastCascade:0}}function uc(g,l,d){const y=a.$.sub([],d,l),b=a.$.sub([],g,l),T=a.$.cross([],y,b),S=a.$.length(T);return S===0?[0,0,1,0]:(a.$.scale(T,T,1/S),[T[0],T[1],T[2],-a.$.dot(T,l)])}function $o(g){const l=g.properties.get("direction"),d=a.ad(l.x,l.y,l.z);d[2]=a.au(d[2],0,75);const y=a.b9([d[0],d[1],d[2]]);return a.$.fromValues(y.x,y.y,y.z)}function tu(g,l,d){const y=l.properties.get("color"),b=l.properties.get("intensity"),T=l.properties.get("direction"),S=[T.x,T.y,T.z],C=d.properties.get("color"),k=d.properties.get("intensity"),L=Math.max(a.$.dot([0,0,1],S),0),N=[0,0,0];a.$.scale(N,C.toRenderColor(g.getLut(l.scope)).toArray01Linear().slice(0,3),k);const j=[0,0,0];return a.$.scale(j,y.toRenderColor(g.getLut(d.scope)).toArray01Linear().slice(0,3),L*b),a.ba([N[0]>0?N[0]/(N[0]+j[0]):0,N[1]>0?N[1]/(N[1]+j[1]):0,N[2]>0?N[2]/(N[2]+j[2]):0])}function fd(g,l,d,y,b,T){const S=g.zoom,C=g.scale,k=g.worldSize,L=1/k,N=g.aspect,j=Math.sqrt(1+N*N)*Math.tan(.5*g.fovX),G=j*j,q=y-d,re=y+d;let ie,ae;G>q/re?(ie=y,ae=y*j):(ie=.5*re*(1+G),ae=.5*Math.sqrt(q*q+2*(y*y+d*d)*G+re*re*G*G));const ce=g.projection.pixelsPerMeter(g.center.lat,k),ye=g._camera.getCameraToWorldMercator(),ve=[0,0,-ie*L];a.$.transformMat4(ve,ve,ye);let _e=ae*L;const Re=g._edgeInsets;if(!(Re.left===0&&Re.top===0&&Re.right===0&&Re.bottom===0||Re.left===Re.right&&Re.top===Re.bottom)){const ht=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?ce:1),ft=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,d,y);ft[8]=2*-g.centerOffset.x/g.width,ft[9]=2*g.centerOffset.y/g.height;const Nt=new Float64Array(16);a.ae.mul(Nt,ft,ht);const Bt=new Float64Array(16);a.ae.invert(Bt,Nt);const on=a.aM.fromInvProjectionMatrix(Bt,k,S,!0);for(const Gt of on.points){const Tn=((Se=Gt)[0]/=C,Se[1]/=C,Se[2]=a.ay(Se[2],g._center.lat),Se);_e=Math.max(_e,a.$.len(a.$.subtract([],ve,Tn)))}}var Se;_e*=b/(b-1);const Ie=Math.acos(l[2]),ze=Math.atan2(-l[0],-l[1]),Ne=new fi;Ne.position=ve,Ne.setPitchBearing(Ie,ze);const qe=Ne.getWorldToCamera(k,ce),Fe=_e*k,Pe=Math.min(g._mercatorZfromZoom(17)*k*-2,-2*Fe),Qe=Ne.getCameraToClipOrthographic(-Fe,Fe,-Fe,Fe,Pe,(Fe+T*ce)/l[2]),Xe=new Float64Array(16);a.ae.multiply(Xe,Qe,qe);const Ue=a.$.fromValues(Math.floor(1e6*ve[0])/1e6*k,Math.floor(1e6*ve[1])/1e6*k,0),_t=.5*b,ut=[0,0,0];a.$.transformMat4(ut,Ue,Xe),a.$.scale(ut,ut,_t);const We=[Math.floor(ut[0]),Math.floor(ut[1]),Math.floor(ut[2])],nt=[0,0,0];a.$.sub(nt,ut,We),a.$.scale(nt,nt,-1/_t);const je=new Float64Array(16);return a.ae.identity(je),a.ae.translate(je,je,nt),a.ae.multiply(Xe,je,Xe),[Xe,Fe]}function nu(g,l){return g!=null&&l!=null&&!(!g.hasData()||!l.hasData())&&g.demTexture!=null&&l.demTexture!=null&&g.tileID.key!==l.tileID.key}const Ka=new class{constructor(){this.operations={}}newMorphing(g,l,d,y,b){if(g in this.operations){const T=this.operations[g];T.to.tileID.key!==d.tileID.key&&(T.queued=d)}else this.operations[g]={startTime:y,phase:0,duration:b,from:l,to:d,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const l=this.operations[g];return{from:l.from,to:l.to,phase:l.phase}}update(g){for(const l in this.operations){const d=this.operations[l];for(d.phase=(g-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,g)){delete this.operations[l];break}}}_nextOp(g,l){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=l,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Sl={0:null,1:"TERRAIN_VERTEX_MORPHING"};function hs(g,l,d){if(l===0)return 0;const y=l<1&&d===514?.25/l:1;return 6*Math.pow(1.5,22-g)*Math.max(l,1)*y}function ru(g,l){const d=1<<g.z;return!l&&(g.x===0||g.x===d-1)||g.y===0||g.y===d-1}const iu=g=>({u_matrix:g});function Ya(g,l,d,y,b){if(b>0){const T=a.e.now(),S=(T-g.timeAdded)/b,C=l?(T-l.timeAdded)/b:-1,k=d.getSource(),L=y.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),N=!l||Math.abs(l.tileID.overscaledZ-L)>Math.abs(g.tileID.overscaledZ-L),j=N&&g.refreshedUponExpiration?1:a.au(N?S:1-C,0,1);return g.refreshedUponExpiration&&S>=1&&(g.refreshedUponExpiration=!1),l?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class R extends Po{constructor(l,d,y,b){super(l,d,y,b),this.type="raster-array",this.maxzoom=22,this._options=a.Q({type:"raster-array"},d)}triggerRepaint(l){const d=this.map.painter._terrain,y=this.map.style.getSourceCache(this.id);d&&d.enabled&&y&&d._clearRenderCacheForTile(y.id,l.tileID),this.map.triggerRepaint()}loadTile(l,d){const y=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(y,a.R.Tile);l.requestParams=b,l.actor||(l.actor=this.dispatcher.getActor()),l.request=l.fetchHeader(void 0,(T,S,C,k)=>{if(delete l.request,l.aborted)return l.state="unloaded",d(null);if(T)return T.code===20?void 0:(l.state="errored",d(T));this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:C,expires:k}),l.state="empty",d(null)})}unloadTile(l,d){const y=l.texture;y&&y instanceof a.T?(l.destroy(!0),this.map.painter.saveTileTexture(y)):(l.destroy(),l.flushQueues(),l._isHeaderLoaded=!1,delete l._mrt,delete l.textureDescriptor),l.fbo&&(l.fbo.destroy(),delete l.fbo),delete l.request,delete l.requestParams,delete l.neighboringTiles,l.state="unloaded"}prepareTile(l,d,y){l._isHeaderLoaded&&(l.state!=="empty"&&(l.state="reloading"),l.fetchBand(d,y,(b,T)=>{if(b)return l.state="errored",this.fire(new a.f(b)),void this.triggerRepaint(l);T&&(l.setTexture(T,this.map.painter),l.state="loaded",this.triggerRepaint(l))}))}getInitialBand(l){if(!this.rasterLayers)return 0;const d=this.rasterLayers.find(({id:T})=>T===l),y=d&&d.fields,b=y&&y.bands&&y.bands;return b?b[0]:0}getTextureDescriptor(l,d,y){if(!l)return;const b=d.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!b)return;let T=null;d instanceof a.bm?T=d.paint.get("raster-array-band"):d instanceof a.bn&&(T=d.paint.get("raster-particle-array-band"));const S=T||this.getInitialBand(b);if(S!=null)if(l.textureDescriptor){if(!l.updateNeeded(b,S)||y)return Object.assign({},l.textureDescriptor,{texture:l.texture})}else this.prepareTile(l,b,S)}}const H={vector:hg,raster:Po,"raster-dem":class extends Po{constructor(g,l,d,y){super(g,l,d,y),this.type="raster-dem",this.maxzoom=22,this._options=a.Q({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(g,l){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(b,T){b&&(g.state="errored",l(b)),T&&(g.dem=T,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",l(null))}g.request=a.i(this.map._requestManager.transformRequest(d,a.R.Tile),(function(b,T,S,C){if(delete g.request,g.aborted)g.state="unloaded",l(null);else if(b)g.state="errored",l(b);else if(T){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:S,expires:C});const k=ImageBitmap&&T instanceof ImageBitmap&&a.bk(),L=1-(T.width-a.bl(T.width))/2;L<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const N=k?T:a.e.getImageData(T,L),j={uid:g.uid,coord:g.tileID,source:this.id,scope:this.scope,rawImageData:N,encoding:this.encoding,padding:L};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",j,y.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const l=g.canonical,d=Math.pow(2,l.z),y=(l.x-1+d)%d,b=l.x===0?g.wrap-1:g.wrap,T=(l.x+1+d)%d,S=l.x+1===d?g.wrap+1:g.wrap,C={};return C[new a.aQ(g.overscaledZ,b,l.z,y,l.y).key]={backfilled:!1},C[new a.aQ(g.overscaledZ,S,l.z,T,l.y).key]={backfilled:!1},l.y>0&&(C[new a.aQ(g.overscaledZ,b,l.z,y,l.y-1).key]={backfilled:!1},C[new a.aQ(g.overscaledZ,g.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},C[new a.aQ(g.overscaledZ,S,l.z,T,l.y-1).key]={backfilled:!1}),l.y+1<d&&(C[new a.aQ(g.overscaledZ,b,l.z,y,l.y+1).key]={backfilled:!1},C[new a.aQ(g.overscaledZ,g.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},C[new a.aQ(g.overscaledZ,S,l.z,T,l.y+1).key]={backfilled:!1}),C}},"raster-array":R,geojson:class extends a.E{constructor(g,l,d,y){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(y),this._data=l.data,this._options=a.Q({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.minzoom!==void 0&&(this.minzoom=l.minzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const b=a.a4/this.tileSize;this.workerOptions=a.Q({source:this.id,scope:this.scope,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*b,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*b,extent:a.a4,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:a.a4,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*b,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter,dynamic:l.dynamic},l.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){if(!this._options.dynamic)return this.fire(new a.f(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof g!="string"&&(g.type==="Feature"&&(g={type:"FeatureCollection",features:[g]}),g.type!=="FeatureCollection"))return this.fire(new a.f(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof g!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const l=new Map;for(const d of this._data.features)l.set(d.id,d);for(const d of g.features)l.set(d.id,d);this._data.features=[...l.values()]}else this._data=g;return this._updateWorkerData(!0),this}getClusterExpansionZoom(g,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterChildren(g,l){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterLeaves(g,l,d,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:l,offset:d},y),this}_updateWorkerData(g=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.g("dataloading",{dataType:"source"})),this._loaded=!1;const l=a.Q({append:g},this.workerOptions);l.scope=this.scope;const d=this._data;typeof d=="string"?(l.request=this.map._requestManager.transformRequest(a.e.resolveURL(d),a.R.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(d),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(y,b)=>{if(this._loaded=!0,this._pendingLoad=null,y)this.fire(new a.f(y));else{const T={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&b&&b.resourceTiming&&b.resourceTiming[this.id]&&(T.resourceTiming=b.resourceTiming[this.id]),g&&(this._partialReload=!0),this.fire(new a.g("data",T)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(g),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,l){const d=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const y=this.map.style?this.map.style.getLut(this.scope):null,b=this._partialReload,T={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y?{image:y.image.clone()}:null,scope:this.scope,pixelRatio:a.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:b};g.request=this.actor.send(d,T,(S,C)=>b&&!C?(g.state="loaded",l(null)):(delete g.request,g.destroy(),g.aborted?l(null):S?l(S):(g.loadVectorData(C,this.map.painter,d==="reloadTile"),l(null))),void 0,d==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g,l){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(g){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.Q({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.bo{constructor(g,l,d,y){super(g,l,d,y),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const l of g.urls)this.urls.push(this.map._requestManager.transformRequest(l,a.R.Source).url);a.bp(this.urls,(l,d)=>{this._loaded=!0,l?this.fire(new a.f(l)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const l=this.video.seekable;g<l.start(0)||g>l.end(0)?this.fire(new a.f(new a.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,l=g.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(g,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.bo,model:class extends a.E{constructor(g,l,d,y){super(),this.id=g,this.type="model",this.models=[],this._loaded=!1,this._options=l}load(){const g=[];for(const l in this._options.models){const d=this._options.models[l],y=a.l(this.map._requestManager.transformRequest(d.uri,a.R.Model).url).then(b=>{if(!b)return;const T=a.c(b),S=new a.M(l,d.position,d.orientation,T);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(b=>{this.fire(new a.f(new Error(`Could not load model ${l} from ${d.uri}: ${b.message}`)))});g.push(y)}return Promise.allSettled(g).then(()=>{this._loaded=!0,this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(l=>{this.fire(new a.f(new Error(`Could not load models: ${l.message}`)))})}onAdd(g){this.map=g,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(g,l){}serialize(){return{type:"model"}}},"batched-model":class extends a.E{constructor(g,l,d,y){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=l,this.tiles=this._options.tiles,this.maxzoom=l.maxzoom||19,this.minzoom=l.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=d,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(y)}onAdd(g){this.map=g,this.load()}load(g){this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map._worldview;this._tileJSONRequest=np(this._options,this.map._requestManager,l,d,(y,b)=>{this._tileJSONRequest=null,this._loaded=!0,y?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),d&&d.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new a.f(y))):b&&(a.Q(this,b),b.bounds&&(this.tileBounds=new Vo(b.bounds,this.minzoom,this.maxzoom)),a.ao(b.tiles,this.map._requestManager._customAccessToken),this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))),g&&g(y)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,l){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(d,a.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=l;else{if(g.buckets){const T=Object.values(g.buckets);for(const S of T)S.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",y,b.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",y,b.bind(this),void 0,!0);function b(T,S){return g.aborted?l(null):T&&T.status!==404?l(T):(S&&(S.resourceTiming&&(g.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&g.setExpiryData(S),g.buckets={...g.buckets,...S.buckets},S.featureIndex&&(g.latestFeatureIndex=S.featureIndex)),g.state="loaded",void l(null))}}serialize(){return a.Q({},this._options)}},canvas:class extends a.bo{constructor(g,l,d,y){super(g,l,d,y),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(T=>typeof T!="number"))||this.fire(new a.f(new a.V(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.f(new a.V(`sources.${g}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new a.f(new a.V(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new a.f(new a.V(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.f(new a.V(`sources.${g}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.f(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(g){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof a.bq||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends a.E{constructor(g,l,d,y){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=l,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.f(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.f(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Vo(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),a.Q(this,a.ai(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.ai(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this.map=g,this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:l,y:d,z:y}=g.canonical;return this._implementation.hasTile({x:l,y:d,z:y})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,l){const{x:d,y,z:b}=g.tileID.canonical,T=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:d,y,z:b},{signal:T.signal})).then((function(S){return delete g.request,g.aborted?(g.state="unloaded",l(null)):S===void 0?(g.state="errored",l(null)):S===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",l(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(S)?(this.loadTileData(g,S),g.state="loaded",void l(null)):(g.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(g.state="errored",l(S))}),g.request.cancel=()=>T.abort()}loadTileData(g,l){g.setTexture(l,this.map.painter)}unloadTile(g,l){if(g.texture&&g.texture instanceof a.T?(g.destroy(!0),g.texture&&g.texture instanceof a.T&&this.map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:d,y,z:b}=g.tileID.canonical;this._implementation.unloadTile({x:d,y,z:b})}l&&l()}abortTile(g,l){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),l&&l()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=a.am(this.id,this.scope);this.map.style.clearSource(g)}_update(){this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))}}},ue=function(g,l,d,y){const b=new H[l.type](g,l,d,y);if(b.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${b.id}`);return a.br(["load","abort","unload","serialize","prepare"],b),b};class Me extends a.bx{constructor(l){const d={type:"raster-dem",maxzoom:l.transform.maxZoom},y=new a.by(a.bz(),null),b=ue("mock-dem",d,y,l.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,d){l.state="loaded",d(null)}}class ct extends a.bx{constructor(l){const d=ue("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new a.by(a.bz(),null),l.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,d,y){if(l.freezeTileCoverage)return;this.transform=l;const b=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((T,S)=>{if(T[S.key]="",!this._tiles[S.key]){const C=new a.bA(S,this._source.tileSize*S.overscaleFactor(),l.tileZoom);C.state="loaded",this._tiles[S.key]=C}return T},{});for(const T in this._tiles)T in b||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(l){const d=this.proxyCachedFBO[l];if(d!==void 0){const y=Object.values(d);this.renderCachePool.push(...y),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Tt extends a.aQ{constructor(l,d,y){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=d,this.projMatrix=y}}class rn extends a.bs{constructor(l,d){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},l.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,b,T]=function(k){const L=new a.bv,N=new a.bw,j=131;L.reserve(17161),N.reserve(33800);const G=a.a4/128,q=a.a4+G/2,re=q+G;for(let ae=-G;ae<re;ae+=G)for(let ce=-G;ce<re;ce+=G){const ye=ce<0||ce>q||ae<0||ae>q?24575:0,ve=a.au(Math.round(ce),0,a.a4),_e=a.au(Math.round(ae),0,a.a4);L.emplaceBack(ve+ye,_e)}const ie=(ae,ce)=>{const ye=ce*j+ae;N.emplaceBack(ye+1,ye,ye+j),N.emplaceBack(ye+j,ye+j+1,ye+1)};for(let ae=1;ae<129;ae++)for(let ce=1;ce<129;ce++)ie(ce,ae);return[0,129].forEach(ae=>{for(let ce=0;ce<130;ce++)ie(ce,ae),ie(ae,ce)}),[L,N,32768]}(),S=l.context;this.gridBuffer=S.createVertexBuffer(y,a.bt.members),this.gridIndexBuffer=S.createIndexBuffer(b),this.gridSegments=a.b.simpleSegment(0,0,y.length,b.length),this.gridNoSkirtSegments=a.b.simpleSegment(0,0,y.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ct(d.map),this.orthoMatrix=a.ae.create(),a.ae.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.a4,0,a.a4,0,1);const C=S.gl;this._overlapStencilMode=new a.ah({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Me(d.map),this._pendingGroundEffectLayers=[]}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),this._style=l,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,d,y){if(l&&l.terrain){this._style!==l&&(this.style=l,this._evaluationZoom=void 0);const b=l.terrain.properties,T=l.terrain.drapeRenderMode===0,S=l.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.e.now();const C=l.terrain&&l.terrain.scope,k=b.get("source"),L=T?this._mockSourceCache:l.getSourceCache(k,C);if(!L)return void a.w(`Couldn't find terrain source "${k}".`);if(this.sourceCache=L,this._exaggeration=S?this.calculateExaggeration(d):b.get("exaggeration"),!d.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const N=()=>{this.sourceCache.used&&a.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const j=this.getScaledDemTileSize();this.sourceCache.update(d,j,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,N(),this._initializing=!0),N(),d.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0,this._previousZoom=d.zoom}else this._disable()}calculateExaggeration(l){const d=this._previousCameraAltitude,y=l.getFreeCameraOptions().position.z/l.pixelsPerMeter*l.worldSize;this._previousCameraAltitude=y;const b=d!=null?y-d:Number.MAX_VALUE;if(Math.abs(b)<2)return this._exaggeration;const T=l.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(T);let C=T-this._previousZoom;const k=this._previousUpdateTimestamp;let L=T;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(T-L)>.5&&(C=.5*(T-L+C)),C*b<0&&(L+=C)),this._evaluationZoom=L;const N=S.getExaggeration(L),j=N===S.getExaggeration(Math.max(0,L-.1));if(j&&Math.abs(N-this._exaggeration)<.01)return N;let G=Math.min(.1,.00375*(this._updateTimestamp-k));return(j||N<.1||Math.abs(C)<1e-4)&&(G=Math.min(.2,4*G)),a.a3(this._exaggeration,N,G)}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(l){l.coord&&l.dataType==="source"?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._mergedSourceCaches)this._style._mergedSourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=y._centerAltitude===0&&this.getAtPointOrZero(a._.fromLngLat(y.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=d.getIds().map(k=>{const L=d.getTileByID(k).tileID;return L.projMatrix=y.calculateProjMatrix(L.toUnwrapped()),L});(function(k,L){const N=L.transform.pointCoordinate(L.transform.getCameraPoint()),j=new a.P(N.x,N.y);k.sort((G,q)=>{if(q.overscaledZ-G.overscaledZ)return q.overscaledZ-G.overscaledZ;const re=new a.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),ie=new a.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),ae=j.mult(1<<G.canonical.z);return ae.x-=.5,ae.y-=.5,ae.distSqr(re)-ae.distSqr(ie)})})(b,this.painter);const T=this.proxyToSource||{};this.proxyToSource={},b.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const k in S){const L=S[k];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,l[k],T),L.usedForTerrain))continue;const N=l[k];L.getSource().reparseOverscaled&&this._assignTerrainTiles(N)}this.proxiedCoords[d.id]=b.map(k=>new Tt(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const L=this.terrainTileForTile[k.key];if(!L)continue;const N=L.tileID.key;N in C||(this._visibleDemTiles.push(L),C[N]=N)}}_assignTerrainTiles(l){this._initializing||l.forEach(d=>{if(this.terrainTileForTile[d.key])return;const y=this._findTileCoveringTileID(d,this.sourceCache);y&&(this.terrainTileForTile[d.key]=y)})}_prepareDEMTextures(){const l=this.painter.context,d=l.gl;for(const y in this.terrainTileForTile){const b=this.terrainTileForTile[y],T=b.dem;!T||b.demTexture&&!b.needsDEMTextureUpload||(l.activeTexture.set(d.TEXTURE1),ug(this.painter,b,T))}}_prepareDemTileUniforms(l,d,y,b){if(!d||d.demTexture==null)return!1;const T=l.tileID.canonical,S=Math.pow(2,d.tileID.canonical.z-T.z),C=b||"";return y[`u_dem_tl${C}`]=[T.x*S%1,T.y*S%1],y[`u_dem_scale${C}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let l=0;const d=this._visibleDemTiles.reduce((y,b)=>{if(!b.dem)return y;const T=b.dem.tree.minimums[0];return T>0&&l++,y+T},0);return l?d/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,d=l.gl;l.activeTexture.set(d.TEXTURE2);const y=this._getLoadedAreaMinimum(),[b,T]=(()=>{const C=new a.bB({width:1,height:1},new Float32Array([y]));return[d.R32F,C]})();this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(T,{premultiply:!1}):S=this._emptyDEMTexture=new a.T(l,T,b,{premultiply:!1}),S}setupElevationDraw(l,d,y){const b=this.painter.context,T=b.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let C=null,k=null,L=1;if(y&&y.morphing&&this._useVertexMorphing){const q=y.morphing.srcDemTile,re=y.morphing.dstDemTile;L=y.morphing.phase,q&&re&&(this._prepareDemTileUniforms(l,q,S,"_prev")&&(k=q),this._prepareDemTileUniforms(l,re,S)&&(C=re))}const N=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?T.LINEAR:T.NEAREST;let j=null;var G;if(this.enabled?k&&C?(j=C.demTexture,b.activeTexture.set(T.TEXTURE4),k.demTexture.bind(N(k),T.CLAMP_TO_EDGE),S.u_dem_lerp=L):(C=this.terrainTileForTile[l.tileID.key],j=this._prepareDemTileUniforms(l,C,S)?C.demTexture:this.emptyDEMTexture):j=this.emptyDEMTexture,b.activeTexture.set(T.TEXTURE2),j&&(S.u_dem_size=(G=j).size[0]===1?1:G.size[0]-2,j.bind(N(C),T.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(y&&y.useDepthForOcclusion,d,S),y&&y.useMeterToDem&&C){const q=(1<<C.tileID.canonical.z)*a.ay(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=q}if(y&&y.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),d.setTerrainUniformValues(b,S),this.painter.transform.projection.name==="globe"){const q=this.globeUniformValues(this.painter.transform,l.tileID.canonical,y&&y.useDenormalizedUpVectorScale);d.setGlobeUniformValues(b,q)}}globeUniformValues(l,d,y){const b=l.projection;return{u_tile_tl_up:b.upVector(d,0,0),u_tile_tr_up:b.upVector(d,a.a4,0),u_tile_br_up:b.upVector(d,a.a4,a.a4),u_tile_bl_up:b.upVector(d,0,a.a4),u_tile_up_scale:y?a.bu(1):b.upVectorScale(d,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const d=this.painter,y=this.painter.context;l.length!==0&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,T,S,C,k){if(b.transform.projection.name==="globe")(function(L,N,j,G,q){const re=L.context,ie=re.gl;let ae,ce;const ye=L.transform,ve=a.bc(L,re,ye),_e=(Qe,Xe)=>{if(ce===Xe)return;const Ue=[Sl[Xe],"PROJECTION_GLOBE_VIEW"];ve&&Ue.push("CUSTOM_ANTIALIASING");const _t=L.isTileAffectedByFog(Qe);ae=L.getOrCreateProgram("globeRaster",{defines:Ue,overrideFog:_t}),ce=Xe},Re=L.colorModeForRenderPass(),Se=new a.af(ie.LEQUAL,a.af.ReadWrite,L.depthRangeFor3D);Ka.update(q);const Ie=a.bd(ye),ze=[a.ak(ye.center.lng),a.al(ye.center.lat)],Ne=L.globeSharedBuffers,qe=[ye.width*a.e.devicePixelRatio,ye.height*a.e.devicePixelRatio],Fe=Float32Array.from(ye.globeMatrix),Pe={useDenormalizedUpVectorScale:!0};{const Qe=L.transform,Xe=hs(Qe.zoom,N.exaggeration(),N.sourceCache._source.tileSize);ce=-1;const Ue=ie.TRIANGLES;for(const _t of G){const ut=j.getTile(_t),We=a.ah.disabled,nt=N.prevTerrainTileForTile[_t.key],je=N.terrainTileForTile[_t.key];nu(nt,je)&&Ka.newMorphing(_t.key,nt,je,q,250),re.activeTexture.set(ie.TEXTURE0),ut.texture&&ut.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const ht=Ka.getMorphValuesForProxy(_t.key),ft=ht?1:0;ht&&a.q(Pe,{morphing:{srcDemTile:ht.from,dstDemTile:ht.to,phase:a.bb(ht.phase)}});const Nt=a.be(_t.canonical),Bt=a.bf(Nt.getCenter().lat),on=a.bg(_t.canonical,Nt,Bt,Qe.worldSize/Qe._pixelsPerMercatorPixel),Gt=a.bh(a.bi(_t.canonical)),Tn=Yc(Qe.expandedFarZProjMatrix,Fe,Ie,Gt,a.a2(Qe.zoom),ze,Qe.frustumCorners.TL,Qe.frustumCorners.TR,Qe.frustumCorners.BR,Qe.frustumCorners.BL,Qe.globeCenterInViewSpace,Qe.globeRadius,qe,Xe,Qe._farZ,on);if(_e(_t,ft),ae&&(N.setupElevationDraw(ut,ae,Pe),L.uploadCommonUniforms(re,ae,_t.toUnwrapped()),Ne)){const[Vn,Sn,Zn]=Ne.getGridBuffers(Bt,Xe!==0);ae.draw(L,Ue,Se,We,Re,a.ag.backCCW,Tn,"globe_raster",Vn,Sn,Zn)}}}if(Ne&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const Qe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ve&&Qe.push("CUSTOM_ANTIALIASING"),ae=L.getOrCreateProgram("globeRaster",{defines:Qe});for(const Xe of G){const{x:Ue,y:_t,z:ut}=Xe.canonical,We=_t===0,nt=_t===(1<<ut)-1,[je,ht,ft,Nt]=Ne.getPoleBuffers(ut,!1);if(Nt&&(We||nt)){const Bt=j.getTile(Xe);re.activeTexture.set(ie.TEXTURE0),Bt.texture&&Bt.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);let on=a.bj(ut,Ue,ye);const Gt=a.bh(a.bi(Xe.canonical)),Tn=(Vn,Sn)=>Vn.draw(L,ie.TRIANGLES,Se,a.ah.disabled,Re,a.ag.disabled,Yc(ye.expandedFarZProjMatrix,on,on,Gt,0,ze,ye.frustumCorners.TL,ye.frustumCorners.TR,ye.frustumCorners.BR,ye.frustumCorners.BL,ye.globeCenterInViewSpace,ye.globeRadius,qe,0,ye._farZ),"globe_pole_raster",Sn,ft,Nt);N.setupElevationDraw(Bt,ae,Pe),L.uploadCommonUniforms(re,ae,Xe.toUnwrapped()),We&&L.renderDefaultNorthPole&&Tn(ae,je),nt&&L.renderDefaultSouthPole&&(on=a.ae.scale(a.ae.create(),on,[1,-1,1]),Tn(ae,ht))}}}})(b,T,S,C,k);else{const L=b.context,N=L.gl;let j,G;const q=b.shadowRenderer,re=Fs(b,b.longestCutoffRange),ie=Re=>{if(G===Re)return;const Se=[];Se.push(Sl[Re]),re.shouldRenderCutoff&&Se.push("RENDER_CUTOFF"),j=b.getOrCreateProgram("terrainRaster",{defines:Se}),G=Re},ae=b.colorModeForRenderPass(),ce=new a.af(N.LEQUAL,a.af.ReadWrite,b.depthRangeFor3D);Ka.update(k);const ye=b.transform,ve=hs(ye.zoom,T.exaggeration(),T.sourceCache._source.tileSize);let _e=[0,0,0];if(q){const Re=b.style.directionalLight,Se=b.style.ambientLight;Re&&Se&&(_e=tu(b.style,Re,Se))}{G=-1;const Re=N.TRIANGLES,[Se,Ie]=[T.gridIndexBuffer,T.gridSegments];for(const ze of C){const Ne=S.getTile(ze),qe=a.ah.disabled,Fe=T.prevTerrainTileForTile[ze.key],Pe=T.terrainTileForTile[ze.key];nu(Fe,Pe)&&Ka.newMorphing(ze.key,Fe,Pe,k,250),L.activeTexture.set(N.TEXTURE0),Ne.texture&&Ne.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const Qe=Ka.getMorphValuesForProxy(ze.key),Xe=Qe?1:0;let Ue;Qe&&(Ue={morphing:{srcDemTile:Qe.from,dstDemTile:Qe.to,phase:a.bb(Qe.phase)}});const _t=Kc(ze.projMatrix,ru(ze.canonical,ye.renderWorldCopies)?ve/10:ve,_e);if(ie(Xe),!j)continue;T.setupElevationDraw(Ne,j,Ue);const ut=ze.toUnwrapped();q&&q.setupShadows(ut,j),b.uploadCommonUniforms(L,j,ut,null,re),j.draw(b,Re,ce,qe,ae,a.ag.backCCW,_t,"terrain_raster",T.gridBuffer,Se,Ie)}}}}(d,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;const d=this.painter,y=this.painter.context,b=this.proxySourceCache,T=this.proxiedCoords[b.id],S=this._drapedRenderBatches.shift(),C=d.style.order,k=[];let L=0;for(const N of T){const j=b.getTileByID(N.proxyTileKey),G=b.proxyCachedFBO[N.key]?b.proxyCachedFBO[N.key][l]:void 0,q=G!==void 0?b.renderCache[G]:this.pool[L++],re=G!==void 0;if(j.texture=q.tex,re&&!q.dirty){k.push(j.tileID);continue}let ie;y.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(y.clear({color:a.C.transparent,stencil:0}),q.dirty=!1);for(let ae=S.start;ae<=S.end;++ae){const ce=d.style._mergedLayers[C[ae]];if(ce.isHidden(d.transform.zoom))continue;const ye=d.style.getLayerSourceCache(ce),ve=ye?this.proxyToSource[N.key][ye.id]:[N];if(!ve)continue;const _e=ve;y.viewport.set([0,0,q.fb.width,q.fb.height]),ie!==(ye?ye.id:null)&&(this._setupStencil(q,ve,ce,ye),ie=ye?ye.id:null),d.renderLayer(d,ye,ce,_e)}if(this._drapedRenderBatches.length===0)for(const ae of this._pendingGroundEffectLayers){const ce=d.style._mergedLayers[C[ae]];if(ce.isHidden(d.transform.zoom))continue;const ye=d.style.getLayerSourceCache(ce),ve=ye?this.proxyToSource[N.key][ye.id]:[N];if(!ve)continue;const _e=ve;y.viewport.set([0,0,q.fb.width,q.fb.height]),ie!==(ye?ye.id:null)&&(this._setupStencil(q,ve,ce,ye),ie=ye?ye.id:null),d.renderLayer(d,ye,ce,_e)}this.renderedToTile?(q.dirty=!0,k.push(j.tileID)):re||--L,L===5&&(L=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height]),S.end+1}postRender(){}isLayerOrderingCorrect(l){const d=l.order.length;let y=-1,b=d;for(let T=0;T<d;++T)this._style.isLayerDraped(l._mergedLayers[l.order[T]])?y=Math.max(y,T):b=Math.min(b,T);return b>y}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{l=Math.min(l,d.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,d,y){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(T=>T.dem).map(T=>{const S=T.tileID,C=1<<S.overscaledZ,{x:k,y:L}=S.canonical,N=k/C,j=(k+1)/C,G=L/C,q=(L+1)/C;return{minx:N,miny:G,maxx:j,maxy:q,t:T.dem.tree.raycastRoot(N,G,j,q,l,d,y),tile:T}});b.sort((T,S)=>(T.t!==null?T.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const T of b){if(T.t==null)return null;const S=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,l,d,y);if(S!=null)return S}return null}_createFBO(){const l=this.painter.context,d=l.gl,y=this.drapeBufferSize;l.activeTexture.set(d.TEXTURE0);const b=new a.T(l,{width:y[0],height:y[1],data:null},d.RGBA);b.bind(d.LINEAR,d.CLAMP_TO_EDGE);const T=l.createFramebuffer(y[0],y[1],!0,null);return T.colorAttachment.set(b.texture),T.depthAttachment=new Rt(l,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:T,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const l in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const d=this._style._mergedLayers[l],y=d.isHidden(this.painter.transform.zoom);return d.type==="custom"?!y&&d.shouldRedrape():!y&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const y of this._style.getSources())if(y instanceof hg){l=!0;break}if(!l)return;const d={};for(let y=0;y<this._style.order.length;++y){const b=this._style._mergedLayers[this._style.order[y]],T=this._style.getLayerSourceCache(b);if(T&&!d[T.id]&&!b.isHidden(this.painter.transform.zoom)&&b.type==="line"&&b.widthExpression()instanceof a.Z){d[T.id]=!0;for(const S of this.proxyCoords){const C=this.proxyToSource[S.key][T.id];if(C)for(const k of C)this._clearRenderCacheForTile(T.id,k)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const y in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[y]._source instanceof Po){l=!0;break}if(!l)return;const d={};for(let y=0;y<this._style.order.length;++y){const b=this._style._mergedLayers[this._style.order[y]],T=this._style.getLayerSourceCache(b);if(!T||d[T.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="raster")continue;const S=b.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const k=this.proxyToSource[C.key][T.id];if(k)for(const L of k){const N=Ya(T.getTile(L),T.findLoadedParent(L,0),T,this.painter.transform,S);(N.opacity!==1||N.mix!==0)&&this._clearRenderCacheForTile(T.id,L)}}}}_setupDrapedRenderBatches(){const l=this._style.order,d=l.length;if(d===0)return;const y=[];this._pendingGroundEffectLayers=[];let b,T=0,S=this._style._mergedLayers[l[T]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++T<d;)S=this._style._mergedLayers[l[T]];for(;T<d;++T){const C=this._style._mergedLayers[l[T]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?b===void 0&&(b=T):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(T),b!==void 0&&(y.push({start:b,end:T-1}),b=void 0)))}if(b!==void 0&&y.push({start:b,end:T-1}),y.length!==0){const C=y[y.length-1];this._pendingGroundEffectLayers.every(k=>k>C.end)||a.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=y}_setupRenderCache(l){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const S=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let C=0;C<S.length;++C){const k=Object.values(S[C]);d.renderCachePool.push(...k)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,b=this._tilesDirty;for(let S=y.length-1;S>=0;S--){const C=y[S];if(d.getTileByID(C.key),d.proxyCachedFBO[C.key]!==void 0){const k=l[C.key],L=this.proxyToSource[C.key];let N=0;for(const j in L){const G=L[j],q=k[j];if(!q||q.length!==G.length||G.some((re,ie)=>re!==q[ie]||b[j]&&b[j].hasOwnProperty(re.key))){N=-1;break}++N}for(const j in d.proxyCachedFBO[C.key])d.renderCache[d.proxyCachedFBO[C.key][j]].dirty=N<0||N!==Object.values(k).length}}const T=[...this._drapedRenderBatches];T.sort((S,C)=>C.end-C.start-(S.end-S.start));for(const S of T)for(const C of y){if(d.proxyCachedFBO[C.key])continue;let k=d.renderCachePool.pop();k===void 0&&d.renderCache.length<50&&(k=d.renderCache.length,d.renderCache.push(this._createFBO())),k!==void 0&&(d.proxyCachedFBO[C.key]={},d.proxyCachedFBO[C.key][S.start]=k,d.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(l,d,y,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,S=T.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let C;if(y.isTileClipped())C=d.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):a.ah.disabled}_renderTileClippingMasks(l,d){const y=this.painter,b=this.painter.context,T=b.gl;y._tileClippingMaskIDs={},b.setColorMode(a.a.disabled),b.setDepthMode(a.af.disabled);const S=y.getOrCreateProgram("clippingMask");for(const C of l){const k=y._tileClippingMaskIDs[C.key]=--d;S.draw(y,T.TRIANGLES,a.af.disabled,new a.ah({func:T.ALWAYS,mask:0},k,255,T.KEEP,T.KEEP,T.REPLACE),a.a.disabled,a.ag.disabled,iu(C.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(l){const d=this.painter.transform;if(l.x<0||l.x>d.width||l.y<0||l.y>d.height)return null;const y=[l.x,l.y,1,1];a.aB.transformMat4(y,y,d.pixelMatrixInverse),a.aB.scale(y,y,1/y[3]),y[0]/=d.worldSize,y[1]/=d.worldSize;const b=d._camera.position,T=a.ay(1,d.center.lat),S=[b[0],b[1],b[2]/T,0],C=a.$.subtract([],y.slice(0,3),S);a.$.normalize(C,C);const k=this.raycast(S,C,this._exaggeration);return k!==null&&k?(a.$.scaleAndAdd(S,S,C,k),S[3]=S[2],S[2]*=T,S):null}_setupProxiedCoordsForOrtho(l,d,y){if(l.getSource()instanceof a.bo)return this._setupProxiedCoordsForImageSource(l,d,y);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const b=this.proxiedCoords[l.id]=[],T=this.proxyCoords;for(let k=0;k<T.length;k++){const L=T[k],N=this._findTileCoveringTileID(L,l);if(N){const j=this._createProxiedId(L,N,y[L.key]&&y[L.key][l.id]);b.push(j),this.proxyToSource[L.key][l.id]=[j]}}let S=!1;const C=new Set;for(let k=0;k<d.length;k++){const L=l.getTile(d[k]);if(!L||!L.hasData())continue;const N=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(N&&N.tileID.canonical.z!==L.tileID.canonical.z){const j=this.proxyToSource[N.tileID.key][l.id],G=this._createProxiedId(N.tileID,L,y[N.tileID.key]&&y[N.tileID.key][l.id]);j?j.splice(j.length-1,0,G):this.proxyToSource[N.tileID.key][l.id]=[G];const q=this.proxyToSource[N.tileID.key][l.id];C.has(q)||C.add(q),b.push(G),S=!0}}if(this._sourceTilesOverlap[l.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const k of C)k.sort((L,N)=>N.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(l,d,y){if(!l.getSource().loaded())return;const b=this.proxiedCoords[l.id]=[],T=this.proxyCoords,S=l.getSource(),C=S.tileID;if(!C)return;const k=new a.P(C.x,C.y)._div(1<<C.z),L=S.coordinates.map(a._.fromLngLat).reduce((j,G)=>(j.min.x=Math.min(j.min.x,G.x-k.x),j.min.y=Math.min(j.min.y,G.y-k.y),j.max.x=Math.max(j.max.x,G.x-k.x),j.max.y=Math.max(j.max.y,G.y-k.y),j),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),N=(j,G)=>{const q=j.wrap+j.canonical.x/(1<<j.canonical.z),re=j.canonical.y/(1<<j.canonical.z),ie=a.a4/(1<<j.canonical.z),ae=G.wrap+G.canonical.x/(1<<G.canonical.z),ce=G.canonical.y/(1<<G.canonical.z);return q+ie<ae+L.min.x||q>ae+L.max.x||re+ie<ce+L.min.y||re>ce+L.max.y};for(let j=0;j<T.length;j++){const G=T[j];for(let q=0;q<d.length;q++){const re=l.getTile(d[q]);if(!re||!re.hasData()||N(G,re.tileID))continue;const ie=this._createProxiedId(G,re,y[G.key]&&y[G.key][l.id]),ae=this.proxyToSource[G.key][l.id];ae?ae.push(ie):this.proxyToSource[G.key][l.id]=[ie],b.push(ie)}}}_createProxiedId(l,d,y){let b=this.orthoMatrix;if(y){const T=y.find(S=>S.key===d.tileID.key);if(T)return T}if(d.tileID.key!==l.key){const T=l.canonical.z-d.tileID.canonical.z;let S,C,k;b=a.ae.create();const L=d.tileID.wrap-l.wrap<<l.overscaledZ;T>0?(S=a.a4>>T,C=S*((d.tileID.canonical.x<<T)-l.canonical.x+L),k=S*((d.tileID.canonical.y<<T)-l.canonical.y)):(S=a.a4<<-T,C=a.a4*(d.tileID.canonical.x-(l.canonical.x+L<<-T)),k=a.a4*(d.tileID.canonical.y-(l.canonical.y<<-T))),a.ae.ortho(b,0,S,0,S,0,1),a.ae.translate(b,b,[C,k,0])}return new Tt(d.tileID,l.key,b)}_findTileCoveringTileID(l,d){let y=d.getTile(l);if(y&&y.hasData())return y;const b=this._findCoveringTileCache[d.id],T=b[l.key];if(y=T?d.getTileByID(T):null,y&&y.hasData()||T===null)return y;let S=y?y.tileID:l,C=S.overscaledZ;const k=d.getSource().minzoom,L=[];if(!T){const j=d.getSource().maxzoom;if(l.canonical.z>=j){const G=l.canonical.z-j;d.getSource().reparseOverscaled?(C=Math.max(l.canonical.z+2,d.transform.tileZoom),S=new a.aQ(C,l.wrap,j,l.canonical.x>>G,l.canonical.y>>G)):G!==0&&(C=j,S=new a.aQ(C,l.wrap,j,l.canonical.x>>G,l.canonical.y>>G))}S.key!==l.key&&(L.push(S.key),y=d.getTile(S))}const N=j=>{L.forEach(G=>{b[G]=j}),L.length=0};for(C-=1;C>=k&&(!y||!y.hasData());C--){y&&N(y.tileID.key);const j=S.calculateScaledKey(C);if(y=d.getTileByID(j),y&&y.hasData())break;const G=b[j];if(G===null)break;G===void 0?L.push(j):y=d.getTileByID(G)}return N(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,d){let y=this._tilesDirty[l];y||(y=this._tilesDirty[l]={}),y[d.key]=!0}}function ui(g,l,d){const y=function(C,k,L){const N=a.$.dot(k,C),j=a.$.dot(L,[.2126,.7152,.0722]),G=(re,ie,ae)=>(1-ae)*re+ae*ie,q=G(1-.3*Math.min(j,1),1,Math.min(N+1,1));return G(.92,1,Math.asin(a.au(k[2],-1,1))/Math.PI+.5)*q}(g,[0,0,1],l),b=[0,0,0];a.$.scale(b,d.slice(0,3),y);const T=[0,0,0];a.$.scale(T,l.slice(0,3),g[2]);const S=[0,0,0];return a.$.add(S,b,T),a.ba(S)}const xs=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Hr=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class ks{static cacheKey(l,d,y,b){let T=`${d}${b?b.cacheKey:""}`;for(const S of y)l.usedDefines.includes(S)&&(T+=`/${S}`);return T}constructor(l,d,y,b,T,S){const C=l.gl;this.program=C.createProgram(),this.configuration=b,this.name=d,this.fixedDefines=[...S];const k=b?b.getBinderAttributes():[],L=(y.staticAttributes||[]).concat(k);let N=b?b.defines():[];N=N.concat(S.map(ae=>`#define ${ae}`));const j=`#version 300 es
`;let G=j+N.concat("precision mediump float;",ag,ud.fragmentSource).join(`
`);for(const ae of y.fragmentIncludes)G+=`
${Qu[ae]}`;G+=`
${y.fragmentSource}`;let q=j+N.concat("precision highp float;",ag,ud.vertexSource).join(`
`);for(const ae of y.vertexIncludes)q+=`
${Qu[ae]}`;q+=`
${y.vertexSource}`;const re=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(re,G),C.compileShader(re),C.attachShader(this.program,re);const ie=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(ie,q),C.compileShader(ie),C.attachShader(this.program,ie),this.attributes={},this.numAttributes=L.length;for(let ae=0;ae<this.numAttributes;ae++)if(L[ae]){const ce=L[ae].startsWith("a_")?L[ae]:`a_${L[ae]}`;C.bindAttribLocation(this.program,ae,ce),this.attributes[ce]=ae}C.linkProgram(this.program),C.deleteShader(ie),C.deleteShader(re),this.fixedUniforms=T(l),this.binderUniforms=b?b.getUniforms(l):[],(S.includes("TERRAIN")||d.indexOf("symbol")!==-1||d.indexOf("circle")!==-1)&&(this.terrainUniforms=(ae=>({u_dem:new a.a8(ae),u_dem_prev:new a.a8(ae),u_dem_tl:new a.a9(ae),u_dem_scale:new a.ab(ae),u_dem_tl_prev:new a.a9(ae),u_dem_scale_prev:new a.ab(ae),u_dem_size:new a.ab(ae),u_dem_lerp:new a.ab(ae),u_exaggeration:new a.ab(ae),u_depth:new a.a8(ae),u_depth_size_inv:new a.a9(ae),u_depth_range_unpack:new a.a9(ae),u_occluder_half_size:new a.ab(ae),u_occlusion_depth_offset:new a.ab(ae),u_meter_to_dem:new a.ab(ae),u_label_plane_matrix_inv:new a.a7(ae)}))(l)),S.includes("GLOBE")&&(this.globeUniforms=(ae=>({u_tile_tl_up:new a.ar(ae),u_tile_tr_up:new a.ar(ae),u_tile_br_up:new a.ar(ae),u_tile_bl_up:new a.ar(ae),u_tile_up_scale:new a.ab(ae)}))(l)),S.includes("FOG")&&(this.fogUniforms=(ae=>({u_fog_matrix:new a.a7(ae),u_fog_range:new a.a9(ae),u_fog_color:new a.at(ae),u_fog_horizon_blend:new a.ab(ae),u_fog_vertical_limit:new a.a9(ae),u_fog_temporal_offset:new a.ab(ae),u_frustum_tl:new a.ar(ae),u_frustum_tr:new a.ar(ae),u_frustum_br:new a.ar(ae),u_frustum_bl:new a.ar(ae),u_globe_pos:new a.ar(ae),u_globe_radius:new a.ab(ae),u_globe_transition:new a.ab(ae),u_is_globe:new a.a8(ae),u_viewport:new a.a9(ae)}))(l)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ae=>({u_cutoff_params:new a.at(ae)}))(l)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ae=>({u_lighting_ambient_color:new a.ar(ae),u_lighting_directional_dir:new a.ar(ae),u_lighting_directional_color:new a.ar(ae),u_ground_radiance:new a.ar(ae)}))(l)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ae=>({u_light_matrix_0:new a.a7(ae),u_light_matrix_1:new a.a7(ae),u_fade_range:new a.a9(ae),u_shadow_normal_offset:new a.ar(ae),u_shadow_intensity:new a.ab(ae),u_shadow_texel_size:new a.ab(ae),u_shadow_map_resolution:new a.ab(ae),u_shadow_direction:new a.ar(ae),u_shadow_bias:new a.ar(ae),u_shadowmap_0:new a.a8(ae),u_shadowmap_1:new a.a8(ae)}))(l))}}setTerrainUniformValues(l,d){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in d)y[b]&&y[b].set(this.program,b,d[b])}}setGlobeUniformValues(l,d){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in d)y[b]&&y[b].set(this.program,b,d[b])}}setFogUniformValues(l,d){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}}setCutoffUniformValues(l,d){if(!this.cutoffUniforms)return;const y=this.cutoffUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}}setLightsUniformValues(l,d){if(!this.lightsUniforms)return;const y=this.lightsUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}}setShadowUniformValues(l,d){if(this.failedToCreate||!this.shadowUniforms)return;const y=this.shadowUniforms;l.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}_drawDebugWireframe(l,d,y,b,T,S,C,k,L,N){const j=l.options.wireframe;if(j.terrain===!1&&j.layers2D===!1&&j.layers3D===!1)return;const G=l.context;if(!(!(!j.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!j.layers2D||l._terrain&&l._terrain.renderingToTexture||!xs.includes(this.name))||!(!j.layers3D||!Hr.includes(this.name))))return;const q=G.gl,re=l.wireframeDebugCache.getLinesFromTrianglesBuffer(l.frameCounter,T,G);if(!re)return;const ie=[...this.fixedDefines];ie.push("DEBUG_WIREFRAME");const ae=l.getOrCreateProgram(this.name,{config:this.configuration,defines:ie});G.program.set(ae.program);const ce=(_e,Re,Se)=>{if(Re[_e]&&Se[_e])for(const Ie in Re[_e])Se[_e][Ie]&&Se[_e][Ie].set(Se.program,Ie,Re[_e][Ie].current)};L&&L.setUniforms(ae.program,G,ae.binderUniforms,C,{zoom:k}),ce("fixedUniforms",this,ae),ce("terrainUniforms",this,ae),ce("globeUniforms",this,ae),ce("fogUniforms",this,ae),ce("lightsUniforms",this,ae),ce("shadowUniforms",this,ae),re.bind(),G.setColorMode(new a.a([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],a.C.transparent,[!0,!0,!0,!1])),G.setDepthMode(new a.af(d.func===q.LESS?q.LEQUAL:d.func,a.af.ReadOnly,d.range)),G.setStencilMode(a.ah.disabled);const ye=3*S.primitiveLength*2,ve=3*S.primitiveOffset*2*2;N&&N>1?q.drawElementsInstanced(q.LINES,ye,q.UNSIGNED_SHORT,ve,N):q.drawElements(q.LINES,ye,q.UNSIGNED_SHORT,ve),T.bind(),G.program.set(this.program),G.setDepthMode(d),G.setStencilMode(y),G.setColorMode(b)}draw(l,d,y,b,T,S,C,k,L,N,j,G,q,re,ie,ae){const ce=l.context,ye=ce.gl;if(this.failedToCreate)return;ce.program.set(this.program),ce.setDepthMode(y),ce.setStencilMode(b),ce.setColorMode(T),ce.setCullFace(S);for(const Re of Object.keys(this.fixedUniforms))this.fixedUniforms[Re].set(this.program,Re,C[Re]);re&&re.setUniforms(this.program,ce,this.binderUniforms,G,{zoom:q});const ve={[ye.POINTS]:1,[ye.LINES]:2,[ye.TRIANGLES]:3,[ye.LINE_STRIP]:1}[d],_e=ae&&ae>0?1:void 0;for(const Re of j.get()){const Se=Re.vaos||(Re.vaos={});(Se[k]||(Se[k]=new lg)).bind(ce,this,L,re?re.getPaintVertexBuffers():[],N,Re.vertexOffset,ie||[],_e),ae&&ae>1?ye.drawElementsInstanced(d,Re.primitiveLength*ve,ye.UNSIGNED_SHORT,Re.primitiveOffset*ve*2,ae):N?ye.drawElements(d,Re.primitiveLength*ve,ye.UNSIGNED_SHORT,Re.primitiveOffset*ve*2):ye.drawArrays(d,Re.vertexOffset,Re.vertexLength),d===ye.TRIANGLES&&N&&this._drawDebugWireframe(l,y,b,T,N,Re,G,q,re,ae)}}}function Ds(g,l){const d=Math.pow(2,l.tileID.overscaledZ),y=l.tileSize*Math.pow(2,g.transform.tileZoom)/d,b=y*(l.tileID.canonical.x+l.tileID.wrap*d),T=y*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture?l.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.bD(l,1,g.transform.tileZoom),u_pixel_coord_upper:[b>>16,T>>16],u_pixel_coord_lower:[65535&b,65535&T]}}const hc=a.ae.create(),ds=(g,l,d,y,b,T,S,C,k,L,N,j,G,q,re,ie,ae,ce)=>{const ye=l.style.light,ve=ye.properties.get("position"),_e=[ve.x,ve.y,ve.z],Re=a.bE.create();ye.properties.get("anchor")==="viewport"&&(a.bE.fromRotation(Re,-l.transform.angle),a.$.transformMat3(_e,_e,Re));const Se=ye.properties.get("color"),Ie=l.transform,ze={u_matrix:g,u_lightpos:_e,u_lightintensity:ye.properties.get("intensity"),u_lightcolor:[Se.r,Se.g,Se.b],u_vertical_gradient:+d,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:hc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:T,u_alignment:S,u_width_scale:C,u_flood_light_color:q,u_vertical_scale:re,u_flood_light_intensity:ie,u_ground_shadow_factor:ae,u_emissive_strength:ce};return Ie.projection.name==="globe"&&(ze.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],ze.u_zoom_transition=N,ze.u_inv_rot_matrix=G,ze.u_merc_center=j,ze.u_up_dir=Ie.projection.upVector(new a.aO(0,0,0),j[0]*a.a4,j[1]*a.a4),ze.u_height_lift=L),ze},dc=(g,l,d,y,b)=>({u_matrix:g,u_edge_radius:l,u_alignment:d,u_width_scale:y,u_vertical_scale:b}),pd=(g,l,d,y,b,T,S,C,k,L,N,j,G,q,re,ie)=>{const ae=ds(g,l,d,y,b,T,S,C,k,N,j,G,q,re,ie,1,[0,0,0],0),ce={u_height_factor:-Math.pow(2,k.overscaledZ)/L.tileSize/8};return a.Q(ae,Ds(l,L),ce)},ip=(g,l)=>({u_matrix:g,u_emissive_strength:l}),fg=(g,l,d,y)=>a.Q(ip(g,l),Ds(d,y)),pg=(g,l,d)=>({u_matrix:g,u_world:d,u_emissive_strength:l}),sp=(g,l,d,y,b)=>a.Q(fg(g,l,d,y),{u_world:b}),md=(g,l,d,y)=>{const b=a.a4/d.tileSize;return{u_matrix:g,u_camera_to_center_distance:l.getCameraToCenterDistance(y),u_extrude_scale:[l.pixelsToGLUnits[0]/b,l.pixelsToGLUnits[1]/b]}},mg=(g,l,d=1)=>({u_matrix:g,u_color:l.toRenderColor(null),u_overlay:0,u_overlay_scale:d}),Ab=a.ae.create(),Cb=(g,l,d,y,b,T,S)=>{const C=g.transform,k=C.projection.name==="globe",L=k?a.bF(C.zoom,l.canonical)*C._pixelsPerMercatorPixel:a.bD(d,1,T),N={u_matrix:l.projMatrix,u_extrude_scale:L,u_intensity:S,u_inv_rot_matrix:Ab,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){N.u_inv_rot_matrix=y,N.u_merc_center=b,N.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],N.u_zoom_transition=a.a2(C.zoom);const j=b[0]*a.a4,G=b[1]*a.a4;N.u_up_dir=C.projection.upVector(new a.aO(0,0,0),j,G)}return N};function s0(g,[l,d,y,b],[T,S]){if(T===S)return[0,0,0,0];const C=255*(g-1)/(g*(S-T));return[l*C,d*C,y*C,b*C]}function op(g,l,[d,y]){return d===y?0:.5/g+(l-d)*(g-1)/(g*(y-d))}const gg=(g,l,d,y,b,T,S,C,k,L,N,j,G,q,re,ie,ae,ce,ye,ve,_e)=>({u_matrix:g,u_normalize_matrix:l,u_globe_matrix:d,u_merc_matrix:y,u_grid_matrix:b,u_tl_parent:T,u_scale_parent:L,u_fade_t:N.mix,u_opacity:N.opacity*j.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:j.paint.get("raster-brightness-min"),u_brightness_high:j.paint.get("raster-brightness-max"),u_saturation_factor:a.bG(j.paint.get("raster-saturation")),u_contrast_factor:a.bH(j.paint.get("raster-contrast")),u_spin_weights:o0(j.paint.get("raster-hue-rotate")),u_perspective_transform:G,u_raster_elevation:q,u_zoom_transition:S,u_merc_center:C,u_cutoff_params:k,u_colorization_mix:s0(a.bI,ie,ce),u_colorization_offset:op(a.bI,ae,ce),u_color_ramp:re,u_texture_offset:[ve/(ye+2*ve),ye/(ye+2*ve)],u_texture_res:[ye+2*ve,ye+2*ve],u_emissive_strength:_e});function o0(g){g*=Math.PI/180;const l=Math.sin(g),d=Math.cos(g);return[(2*d+1)/3,(-Math.sqrt(3)*l-d+1)/3,(Math.sqrt(3)*l-d+1)/3]}const Il=.05,rh=(g,l,d,y,b,T,S,C,k,L,N,j)=>({u_matrix:g,u_normalize_matrix:l,u_globe_matrix:d,u_merc_matrix:y,u_grid_matrix:b,u_tl_parent:T,u_scale_parent:L,u_fade_t:N.mix,u_opacity:N.opacity,u_image0:0,u_image1:1,u_raster_elevation:j,u_zoom_transition:S,u_merc_center:C,u_cutoff_params:k}),lC=(g,l,d,y,b,T,S,C,k,L)=>({u_particle_texture:g,u_particle_texture_side_len:l,u_tile_offset:d,u_velocity:y,u_color_ramp:T,u_velocity_res:b,u_max_speed:S,u_uv_offset:C,u_data_scale:[255*k[0],255*k[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Il,Il]}),Pb=(g,l,d,y,b,T,S,C,k,L)=>({u_particle_texture:g,u_particle_texture_side_len:l,u_velocity:d,u_velocity_res:y,u_max_speed:b,u_speed_factor:T,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:[255*k[0],255*k[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Il,Il]}),ap=a.ae.create(),gd=(g,l,d,y,b,T,S,C,k,L,N,j,G,q,re,ie,ae,ce)=>{const ye=b.transform,ve={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:ye.getCameraToCenterDistance(ie),u_rotate_symbol:+d,u_aspect_ratio:ye.width/ye.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:S,u_coord_matrix:C,u_is_text:+k,u_pitch_with_map:+y,u_texsize:L,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ap,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ap,u_up_vector:[0,-1,0],u_color_adj_mat:ae,u_icon_transition:ce||0};return ie.name==="globe"&&(ve.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],ve.u_zoom_transition=j,ve.u_inv_rot_matrix=q,ve.u_merc_center=G,ve.u_camera_forward=ye._camera.forward(),ve.u_ecef_origin=a.bJ(ye.globeMatrix,N.toUnwrapped()),ve.u_tile_matrix=Float32Array.from(ye.globeMatrix),ve.u_up_vector=re),ve},lp=(g,l,d,y,b,T,S,C,k,L,N,j,G,q,re,ie,ae)=>a.Q(gd(g,l,d,y,b,T,S,C,k,L,j,G,q,re,ie,ae),{u_gamma_scale:y?b.transform.getCameraToCenterDistance(ae)*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:a.e.devicePixelRatio,u_is_halo:+N,undefined:void 0}),a0=(g,l,d,y,b,T,S,C,k,L,N,j,G,q,re,ie)=>a.Q(lp(g,l,d,y,b,T,S,C,!0,k,!0,N,j,G,q,re,ie),{u_texsize_icon:L,u_texture_icon:1}),l0=(g,l,d,y)=>({u_matrix:g,u_emissive_strength:l,u_opacity:d,u_color:y}),cC=(g,l,d,y,b,T,S,C)=>a.Q(function(k,L,N,j,G){const{width:q,height:re}=j.imageManager.getPixelSize(L),ie=Math.pow(2,G.tileID.overscaledZ),ae=G.tileSize*Math.pow(2,j.transform.tileZoom)/ie,ce=ae*(G.tileID.canonical.x+G.tileID.wrap*ie),ye=ae*G.tileID.canonical.y;return{u_image:0,u_pattern_tl:N.tl,u_pattern_br:N.br,u_texsize:[q,re],u_pattern_size:N.displaySize,u_tile_units_to_pixels:1/a.bD(G,1,j.transform.tileZoom),u_pixel_coord_upper:[ce>>16,ye>>16],u_pixel_coord_lower:[65535&ce,65535&ye]}}(0,T,S,y,C),{u_matrix:g,u_emissive_strength:l,u_opacity:d}),Aa=new Float32Array(a.ae.identity([])),ih=(g,l,d,y,b,T,S,C,k,L,N,j,G,q=[0,0,0],re)=>{const ie=b.style.light,ae=ie.properties.get("position"),ce=[-ae.x,-ae.y,ae.z],ye=a.bE.create();ie.properties.get("anchor")==="viewport"&&(a.bE.fromRotation(ye,-b.transform.angle),a.$.transformMat3(ce,ce,ye));const ve=N.alphaMode==="MASK",_e=ie.properties.get("color").toRenderColor(null),Re=G.paint.get("model-ambient-occlusion-intensity"),Se=G.paint.get("model-color").constantOr(a.C.white).toRenderColor(null),Ie=G.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:g,u_lighting_matrix:l,u_normal_matrix:d,u_node_matrix:y||Aa,u_lightpos:ce,u_lightintensity:ie.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_camera_pos:q,u_opacity:T,u_baseTextureIsAlpha:0,u_alphaMask:+ve,u_alphaCutoff:N.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[C[0],C[1],C[2],1],u_metallicFactor:k,u_roughnessFactor:L,u_baseColorTexture:Ms.BaseColor,u_metallicRoughnessTexture:Ms.MetallicRoughness,u_normalTexture:Ms.Normal,u_occlusionTexture:Ms.Occlusion,u_emissionTexture:Ms.Emission,u_lutTexture:Ms.LUT,u_color_mix:[Se.r,Se.g,Se.b,Ie],u_aoIntensity:Re,u_emissive_strength:j,u_occlusionTextureTransform:re||[0,0,0,0]}},c0=(g,l=Aa,d=Aa)=>({u_matrix:g,u_instance:l,u_node_matrix:d}),Rb={fillExtrusion:g=>({u_matrix:new a.a7(g),u_lightpos:new a.ar(g),u_lightintensity:new a.ab(g),u_lightcolor:new a.ar(g),u_vertical_gradient:new a.ab(g),u_opacity:new a.ab(g),u_edge_radius:new a.ab(g),u_alignment:new a.ab(g),u_width_scale:new a.ab(g),u_ao:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_up_dir:new a.ar(g),u_height_lift:new a.ab(g),u_flood_light_color:new a.ar(g),u_vertical_scale:new a.ab(g),u_flood_light_intensity:new a.ab(g),u_ground_shadow_factor:new a.ar(g),u_emissive_strength:new a.ab(g)}),fillExtrusionDepth:g=>({u_matrix:new a.a7(g),u_edge_radius:new a.ab(g),u_alignment:new a.ab(g),u_width_scale:new a.ab(g),u_vertical_scale:new a.ab(g)}),fillExtrusionPattern:g=>({u_matrix:new a.a7(g),u_lightpos:new a.ar(g),u_lightintensity:new a.ab(g),u_lightcolor:new a.ar(g),u_vertical_gradient:new a.ab(g),u_height_factor:new a.ab(g),u_edge_radius:new a.ab(g),u_alignment:new a.ab(g),u_width_scale:new a.ab(g),u_ao:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_up_dir:new a.ar(g),u_height_lift:new a.ab(g),u_image:new a.a8(g),u_texsize:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g),u_opacity:new a.ab(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new a.a7(g),u_opacity:new a.ab(g),u_ao_pass:new a.ab(g),u_meter_to_tile:new a.ab(g),u_ao:new a.a9(g),u_flood_light_intensity:new a.ab(g),u_flood_light_color:new a.ar(g),u_attenuation:new a.ab(g),u_edge_radius:new a.ab(g),u_fb:new a.a8(g),u_fb_size:new a.ab(g)}),fill:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g)}),fillPattern:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_image:new a.a8(g),u_texsize:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g)}),fillOutline:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_world:new a.a9(g)}),fillOutlinePattern:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_world:new a.a9(g),u_image:new a.a8(g),u_texsize:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g)}),circle:a.bK,collisionBox:g=>({u_matrix:new a.a7(g),u_camera_to_center_distance:new a.ab(g),u_extrude_scale:new a.a9(g)}),collisionCircle:g=>({u_matrix:new a.a7(g),u_inv_matrix:new a.a7(g),u_camera_to_center_distance:new a.ab(g),u_viewport_size:new a.a9(g)}),debug:g=>({u_color:new a.aa(g),u_matrix:new a.a7(g),u_overlay:new a.a8(g),u_overlay_scale:new a.ab(g)}),clippingMask:g=>({u_matrix:new a.a7(g)}),heatmap:g=>({u_extrude_scale:new a.ab(g),u_intensity:new a.ab(g),u_matrix:new a.a7(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_up_dir:new a.ar(g)}),heatmapTexture:g=>({u_image:new a.a8(g),u_color_ramp:new a.a8(g),u_opacity:new a.ab(g)}),hillshade:g=>({u_matrix:new a.a7(g),u_image:new a.a8(g),u_latrange:new a.a9(g),u_light:new a.a9(g),u_shadow:new a.aa(g),u_highlight:new a.aa(g),u_emissive_strength:new a.ab(g),u_accent:new a.aa(g)}),hillshadePrepare:g=>({u_matrix:new a.a7(g),u_image:new a.a8(g),u_dimension:new a.a9(g),u_zoom:new a.ab(g)}),line:a.bL,linePattern:a.bM,raster:g=>({u_matrix:new a.a7(g),u_normalize_matrix:new a.a7(g),u_globe_matrix:new a.a7(g),u_merc_matrix:new a.a7(g),u_grid_matrix:new a.as(g),u_tl_parent:new a.a9(g),u_scale_parent:new a.ab(g),u_fade_t:new a.ab(g),u_opacity:new a.ab(g),u_image0:new a.a8(g),u_image1:new a.a8(g),u_brightness_low:new a.ab(g),u_brightness_high:new a.ab(g),u_saturation_factor:new a.ab(g),u_contrast_factor:new a.ab(g),u_spin_weights:new a.ar(g),u_perspective_transform:new a.a9(g),u_raster_elevation:new a.ab(g),u_zoom_transition:new a.ab(g),u_merc_center:new a.a9(g),u_cutoff_params:new a.at(g),u_colorization_mix:new a.at(g),u_colorization_offset:new a.ab(g),u_color_ramp:new a.a8(g),u_texture_offset:new a.a9(g),u_texture_res:new a.a9(g),u_emissive_strength:new a.ab(g)}),rasterParticle:g=>({u_matrix:new a.a7(g),u_normalize_matrix:new a.a7(g),u_globe_matrix:new a.a7(g),u_merc_matrix:new a.a7(g),u_grid_matrix:new a.as(g),u_tl_parent:new a.a9(g),u_scale_parent:new a.ab(g),u_fade_t:new a.ab(g),u_opacity:new a.ab(g),u_image0:new a.a8(g),u_image1:new a.a8(g),u_raster_elevation:new a.ab(g),u_zoom_transition:new a.ab(g),u_merc_center:new a.a9(g),u_cutoff_params:new a.at(g)}),rasterParticleTexture:g=>({u_texture:new a.a8(g),u_opacity:new a.ab(g)}),rasterParticleDraw:g=>({u_particle_texture:new a.a8(g),u_particle_texture_side_len:new a.ab(g),u_tile_offset:new a.a9(g),u_velocity:new a.a8(g),u_color_ramp:new a.a8(g),u_velocity_res:new a.a9(g),u_max_speed:new a.ab(g),u_uv_offset:new a.a9(g),u_data_scale:new a.a9(g),u_data_offset:new a.ab(g),u_particle_pos_scale:new a.ab(g),u_particle_pos_offset:new a.a9(g)}),rasterParticleUpdate:g=>({u_particle_texture:new a.a8(g),u_particle_texture_side_len:new a.ab(g),u_velocity:new a.a8(g),u_velocity_res:new a.a9(g),u_max_speed:new a.ab(g),u_speed_factor:new a.ab(g),u_reset_rate:new a.ab(g),u_rand_seed:new a.ab(g),u_uv_offset:new a.a9(g),u_data_scale:new a.a9(g),u_data_offset:new a.ab(g),u_particle_pos_scale:new a.ab(g),u_particle_pos_offset:new a.a9(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new a.a8(g),u_is_size_feature_constant:new a.a8(g),u_size_t:new a.ab(g),u_size:new a.ab(g),u_camera_to_center_distance:new a.ab(g),u_rotate_symbol:new a.a8(g),u_aspect_ratio:new a.ab(g),u_fade_change:new a.ab(g),u_matrix:new a.a7(g),u_label_plane_matrix:new a.a7(g),u_coord_matrix:new a.a7(g),u_is_text:new a.a8(g),u_pitch_with_map:new a.a8(g),u_texsize:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_camera_forward:new a.ar(g),u_tile_matrix:new a.a7(g),u_up_vector:new a.ar(g),u_ecef_origin:new a.ar(g),u_texture:new a.a8(g),u_icon_transition:new a.ab(g),u_color_adj_mat:new a.a7(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new a.a8(g),u_is_size_feature_constant:new a.a8(g),u_size_t:new a.ab(g),u_size:new a.ab(g),u_camera_to_center_distance:new a.ab(g),u_rotate_symbol:new a.a8(g),u_aspect_ratio:new a.ab(g),u_fade_change:new a.ab(g),u_matrix:new a.a7(g),u_label_plane_matrix:new a.a7(g),u_coord_matrix:new a.a7(g),u_is_text:new a.a8(g),u_pitch_with_map:new a.a8(g),u_texsize:new a.a9(g),u_texture:new a.a8(g),u_gamma_scale:new a.ab(g),u_device_pixel_ratio:new a.ab(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_camera_forward:new a.ar(g),u_tile_matrix:new a.a7(g),u_up_vector:new a.ar(g),u_ecef_origin:new a.ar(g),u_is_halo:new a.a8(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new a.a8(g),u_is_size_feature_constant:new a.a8(g),u_size_t:new a.ab(g),u_size:new a.ab(g),u_camera_to_center_distance:new a.ab(g),u_rotate_symbol:new a.a8(g),u_aspect_ratio:new a.ab(g),u_fade_change:new a.ab(g),u_matrix:new a.a7(g),u_label_plane_matrix:new a.a7(g),u_coord_matrix:new a.a7(g),u_is_text:new a.a8(g),u_pitch_with_map:new a.a8(g),u_texsize:new a.a9(g),u_texsize_icon:new a.a9(g),u_texture:new a.a8(g),u_texture_icon:new a.a8(g),u_gamma_scale:new a.ab(g),u_device_pixel_ratio:new a.ab(g),u_is_halo:new a.a8(g)}),background:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_opacity:new a.ab(g),u_color:new a.aa(g)}),backgroundPattern:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_opacity:new a.ab(g),u_image:new a.a8(g),u_pattern_tl:new a.a9(g),u_pattern_br:new a.a9(g),u_texsize:new a.a9(g),u_pattern_size:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g)}),terrainRaster:g=>({u_matrix:new a.a7(g),u_image0:new a.a8(g),u_skirt_height:new a.ab(g),u_ground_shadow_factor:new a.ar(g)}),skybox:g=>({u_matrix:new a.a7(g),u_sun_direction:new a.ar(g),u_cubemap:new a.a8(g),u_opacity:new a.ab(g),u_temporal_offset:new a.ab(g)}),skyboxGradient:g=>({u_matrix:new a.a7(g),u_color_ramp:new a.a8(g),u_center_direction:new a.ar(g),u_radius:new a.ab(g),u_opacity:new a.ab(g),u_temporal_offset:new a.ab(g)}),skyboxCapture:g=>({u_matrix_3f:new a.as(g),u_sun_direction:new a.ar(g),u_sun_intensity:new a.ab(g),u_color_tint_r:new a.at(g),u_color_tint_m:new a.at(g),u_luminance:new a.ab(g)}),globeRaster:g=>({u_proj_matrix:new a.a7(g),u_globe_matrix:new a.a7(g),u_normalize_matrix:new a.a7(g),u_merc_matrix:new a.a7(g),u_zoom_transition:new a.ab(g),u_merc_center:new a.a9(g),u_image0:new a.a8(g),u_grid_matrix:new a.as(g),u_skirt_height:new a.ab(g),u_far_z_cutoff:new a.ab(g),u_frustum_tl:new a.ar(g),u_frustum_tr:new a.ar(g),u_frustum_br:new a.ar(g),u_frustum_bl:new a.ar(g),u_globe_pos:new a.ar(g),u_globe_radius:new a.ab(g),u_viewport:new a.a9(g)}),globeAtmosphere:g=>({u_frustum_tl:new a.ar(g),u_frustum_tr:new a.ar(g),u_frustum_br:new a.ar(g),u_frustum_bl:new a.ar(g),u_horizon:new a.ab(g),u_transition:new a.ab(g),u_fadeout_range:new a.ab(g),u_color:new a.at(g),u_high_color:new a.at(g),u_space_color:new a.at(g),u_temporal_offset:new a.ab(g),u_horizon_angle:new a.ab(g)}),model:g=>({u_matrix:new a.a7(g),u_lighting_matrix:new a.a7(g),u_normal_matrix:new a.a7(g),u_node_matrix:new a.a7(g),u_lightpos:new a.ar(g),u_lightintensity:new a.ab(g),u_lightcolor:new a.ar(g),u_camera_pos:new a.ar(g),u_opacity:new a.ab(g),u_baseColorFactor:new a.at(g),u_emissiveFactor:new a.at(g),u_metallicFactor:new a.ab(g),u_roughnessFactor:new a.ab(g),u_baseTextureIsAlpha:new a.a8(g),u_alphaMask:new a.a8(g),u_alphaCutoff:new a.ab(g),u_baseColorTexture:new a.a8(g),u_metallicRoughnessTexture:new a.a8(g),u_normalTexture:new a.a8(g),u_occlusionTexture:new a.a8(g),u_emissionTexture:new a.a8(g),u_lutTexture:new a.a8(g),u_color_mix:new a.at(g),u_aoIntensity:new a.ab(g),u_emissive_strength:new a.ab(g),u_occlusionTextureTransform:new a.at(g)}),modelDepth:g=>({u_matrix:new a.a7(g),u_instance:new a.a7(g),u_node_matrix:new a.a7(g)}),groundShadow:g=>({u_matrix:new a.a7(g),u_ground_shadow_factor:new a.ar(g)}),stars:g=>({u_matrix:new a.a7(g),u_up:new a.ar(g),u_right:new a.ar(g),u_intensity_multiplier:new a.ab(g)}),occlusion:g=>({u_matrix:new a.a7(g),u_anchorPos:new a.ar(g),u_screenSizePx:new a.a9(g),u_occluderSizePx:new a.a9(g),u_color:new a.at(g)})};function sh(g,l,d){const y=l.createTileMatrix(g,g.worldSize,d.toUnwrapped());return a.ae.multiply(new Float32Array(16),g.projMatrix,y)}function Mb(g,l,d){if(l.projection.name===d.projection.name)return g.projMatrix;const y=d.clone();return y.setProjection(l.projection),sh(y,l.getProjection(),g)}function u0(g,l,d){return l.name===d.projection.name?g.projMatrix:sh(d,l,g)}let _d;function kb(g,l,d,y,b,T,S){const C=g.context,k=C.gl,L=g.transform,N=g.getOrCreateProgram("collisionBox"),j=[];let G=0,q=0;for(let _e=0;_e<y.length;_e++){const Re=y[_e],Se=l.getTile(Re),Ie=Se.getBucket(d);if(!Ie)continue;const ze=Mb(Re,Ie,L);let Ne=ze;b[0]===0&&b[1]===0||(Ne=g.translatePosMatrix(ze,Se,b,T));const qe=S?Ie.textCollisionBox:Ie.iconCollisionBox,Fe=Ie.collisionCircleArray;if(Fe.length>0){const Pe=a.ae.create(),Qe=Ne;a.ae.mul(Pe,Ie.placementInvProjMatrix,L.glCoordMatrix),a.ae.mul(Pe,Pe,Ie.placementViewportMatrix),j.push({circleArray:Fe,circleOffset:q,transform:Qe,invTransform:Pe,projection:Ie.getProjection()}),G+=Fe.length/4,q=G}qe&&(g.terrain&&g.terrain.setupElevationDraw(Se,N),N.draw(g,k.LINES,a.af.disabled,a.ah.disabled,g.colorModeForRenderPass(),a.ag.disabled,md(Ne,L,Se,Ie.getProjection()),d.id,qe.layoutVertexBuffer,qe.indexBuffer,qe.segments,null,L.zoom,null,[qe.collisionVertexBuffer,qe.collisionVertexBufferExt]))}if(!S||!j.length)return;const re=g.getOrCreateProgram("collisionCircle"),ie=new a.bN;ie.resize(4*G),ie._trim();let ae=0;for(const _e of j)for(let Re=0;Re<_e.circleArray.length/4;Re++){const Se=4*Re,Ie=_e.circleArray[Se+0],ze=_e.circleArray[Se+1],Ne=_e.circleArray[Se+2],qe=_e.circleArray[Se+3];ie.emplace(ae++,Ie,ze,Ne,qe,0),ie.emplace(ae++,Ie,ze,Ne,qe,1),ie.emplace(ae++,Ie,ze,Ne,qe,2),ie.emplace(ae++,Ie,ze,Ne,qe,3)}(!_d||_d.length<2*G)&&(_d=function(_e){const Re=2*_e,Se=new a.bw;Se.resize(Re),Se._trim();for(let Ie=0;Ie<Re;Ie++){const ze=6*Ie;Se.uint16[ze+0]=4*Ie+0,Se.uint16[ze+1]=4*Ie+1,Se.uint16[ze+2]=4*Ie+2,Se.uint16[ze+3]=4*Ie+2,Se.uint16[ze+4]=4*Ie+3,Se.uint16[ze+5]=4*Ie+0}return Se}(G));const ce=C.createIndexBuffer(_d,!0),ye=C.createVertexBuffer(ie,a.bO.members,!0);for(const _e of j){const Re={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(ve=L).getCameraToCenterDistance(_e.projection),u_viewport_size:[ve.width,ve.height]};re.draw(g,k.TRIANGLES,a.af.disabled,a.ah.disabled,g.colorModeForRenderPass(),a.ag.disabled,Re,d.id,ye,ce,a.b.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,L.zoom)}var ve;ye.destroy(),ce.destroy()}const cp=a.ae.create();function Db(g){const l=g._camera.getWorldToCamera(g.worldSize,1),d=a.ae.multiply([],l,g.globeMatrix);a.ae.invert(d,d);const y=[0,0,0],b=[0,1,0,0];return a.aB.transformMat4(b,b,d),y[0]=b[0],y[1]=b[1],y[2]=b[2],a.$.normalize(y,y),y}function Ob({width:g,height:l,anchor:d,textOffset:y,textScale:b},T){const{horizontalAlign:S,verticalAlign:C}=a.bS(d),k=-(S-.5)*g,L=-(C-.5)*l,N=a.bR(d,y);return new a.P((k/b+N[0])*T,(L/b+N[1])*T)}function uC(g,l,d,y,b,T,S,C,k,L,N){const j=g.text.placedSymbolArray,G=g.text.dynamicLayoutVertexArray,q=g.icon.dynamicLayoutVertexArray,re={},ie=g.getProjection(),ae=u0(C,ie,T),ce=T.elevation,ye=ie.upVectorScale(C.canonical,T.center.lat,T.worldSize).metersToTile;G.clear();for(let ve=0;ve<j.length;ve++){const _e=j.get(ve),{tileAnchorX:Re,tileAnchorY:Se,numGlyphs:Ie}=_e,ze=_e.hidden||!_e.crossTileID||g.allowVerticalPlacement&&!_e.placedOrientation?null:y[_e.crossTileID];if(ze){let Ne=0,qe=0,Fe=0;if(ce){const je=ce?ce.getAtTileOffset(C,Re,Se):0,[ht,ft,Nt]=ie.upVector(C.canonical,Re,Se);Ne=je*ht*ye,qe=je*ft*ye,Fe=je*Nt*ye}let[Pe,Qe,Xe,Ue]=yo(_e.projectedAnchorX+Ne,_e.projectedAnchorY+qe,_e.projectedAnchorZ+Fe,d?ae:S);const _t=Kn(T.getCameraToCenterDistance(ie),Ue);let ut=b.evaluateSizeForFeature(g.textSizeData,L,_e)*_t/a.bP;d&&(ut*=g.tilePixelRatio/k);const We=Ob(ze,ut);d?({x:Pe,y:Qe,z:Xe}=ie.projectTilePoint(Re+We.x,Se+We.y,C.canonical),[Pe,Qe,Xe]=yo(Pe+Ne,Qe+qe,Xe+Fe,S)):(l&&We._rotate(-T.angle),Pe+=We.x,Qe+=We.y,Xe=0);const nt=g.allowVerticalPlacement&&_e.placedOrientation===a.aF.vertical?Math.PI/2:0;for(let je=0;je<Ie;je++)a.aI(G,Pe,Qe,Xe,nt);N&&_e.associatedIconIndex>=0&&(re[_e.associatedIconIndex]={x:Pe,y:Qe,z:Xe,angle:nt})}else Ia(Ie,G)}if(N){q.clear();const ve=g.icon.placedSymbolArray;for(let _e=0;_e<ve.length;_e++){const Re=ve.get(_e),{numGlyphs:Se}=Re,Ie=re[_e];if(Re.hidden||!Ie)Ia(Se,q);else{const{x:ze,y:Ne,z:qe,angle:Fe}=Ie;for(let Pe=0;Pe<Se;Pe++)a.aI(q,ze,Ne,qe,Fe)}}g.icon.dynamicLayoutVertexBuffer.updateData(q)}g.text.dynamicLayoutVertexBuffer.updateData(G)}function up(g,l,d,y,b,T,S={}){const C=d.paint.get("icon-translate"),k=d.paint.get("text-translate"),L=d.paint.get("icon-translate-anchor"),N=d.paint.get("text-translate-anchor"),j=d.layout.get("icon-rotation-alignment"),G=d.layout.get("text-rotation-alignment"),q=d.layout.get("icon-pitch-alignment"),re=d.layout.get("text-pitch-alignment"),ie=d.layout.get("icon-keep-upright"),ae=d.layout.get("text-keep-upright"),ce=d.paint.get("icon-color-saturation"),ye=d.paint.get("icon-color-contrast"),ve=d.paint.get("icon-color-brightness-min"),_e=d.paint.get("icon-color-brightness-max");d.paint.get("icon-occlusion-opacity").constantOr(0),d.paint.get("text-occlusion-opacity").constantOr(0);const Re=g.context,Se=Re.gl,Ie=g.transform,ze=j==="map",Ne=G==="map",qe=q==="map",Fe=re==="map",Pe=d.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Qe=!1;const Xe=g.depthModeForSublayer(0,a.af.ReadOnly),Ue=[a.ak(Ie.center.lng),a.al(Ie.center.lat)],_t=d.layout.get("text-variable-anchor"),ut=Ie.projection.name==="globe",We=[],nt=[0,-1,0];for(const je of y){const ht=l.getTile(je),ft=ht.getBucket(d);if(!ft||ft.projection.name==="mercator"&&ut||ft.fullyClipped)continue;const Nt=ft.projection.name==="globe",Bt=Nt?a.a2(Ie.zoom):0,on=u0(je,ft.getProjection(),Ie),Gt=Ie.calculatePixelsToTileUnitsMatrix(ht),Tn=_t&&ft.hasTextData(),Vn=ft.hasIconTextFit()&&Tn&&ft.hasIconData(),Sn=ft.getProjection().createInversionMatrix(Ie,je.canonical),Zn=Tr=>{Ie.depthOcclusionForSymbolsAndCircles&&(d.hasInitialOcclusionOpacityProperties||g.terrain)&&(Tr.push("DEPTH_D24"),Tr.push("DEPTH_OCCLUSION"))},pr=()=>{const Tr=ze&&d.layout.get("symbol-placement")!=="point",or=[];Zn(or);const kn=Tr||Vn,Gi=d.paint.get("icon-image-cross-fade").constantOr(0);g.terrainRenderModeElevated()&&qe&&or.push("PITCH_WITH_MAP_TERRAIN"),Nt&&(or.push("PROJECTION_GLOBE_VIEW"),kn&&or.push("PROJECTED_POS_ON_VIEWPORT")),Gi>0&&or.push("ICON_TRANSITION"),ft.icon.zOffsetVertexBuffer&&or.push("Z_OFFSET"),ce===0&&ye===0&&ve===0&&_e===1||or.push("COLOR_ADJUSTMENT");const qi=ft.icon.programConfigurations.get(d.id),ao=g.getOrCreateProgram(ft.sdfIcons?"symbolSDF":"symbolIcon",{config:qi,defines:or});let lo;const Hs=ht.imageAtlasTexture?ht.imageAtlasTexture.size:[0,0],co=ft.iconSizeData,Bs=a.aE(co,Ie.zoom),Zs=qe||Ie.pitch!==0,xt=Jc(on,ht.tileID.canonical,qe,ze,Ie,ft.getProjection(),Gt),ln=eh(on,ht.tileID.canonical,qe,ze,Ie,ft.getProjection(),Gt),xo=g.translatePosMatrix(ln,ht,C,L,!0),Zr=g.translatePosMatrix(on,ht,C,L),Ke=kn?cp:xt,_c=ze&&!qe&&!Tr;let el=nt;!ut&&!Ie.mercatorFromTransition||ze||(el=Db(Ie));const yc=Nt?el:nt;if(ft.sdfIcons&&!ft.iconsInText)lo=lp(co.kind,Bs,_c,qe,g,Zr,Ke,xo,!1,Hs,!0,je,Bt,Ue,Sn,yc,ft.getProjection());else{const ph=d.getColorAdjustmentMatrix(ce,ye,ve,_e);lo=gd(co.kind,Bs,_c,qe,g,Zr,Ke,xo,!1,Hs,je,Bt,Ue,Sn,yc,ft.getProjection(),ph,Gi)}const vc=ht.imageAtlasTexture?ht.imageAtlasTexture:null,Ug=d.layout.get("icon-size").constantOr(0)!==1||ft.iconsNeedLinear,Vg=ft.sdfIcons||g.options.rotating||g.options.zooming||Ug||Zs?Se.LINEAR:Se.NEAREST,uu=ft.sdfIcons&&d.paint.get("icon-halo-width").constantOr(1)!==0,z0=g.terrain&&qe&&Tr?a.ae.invert(a.ae.create(),xt):cp;if(Tr&&ft.icon){const ph=Ie.elevation,$g=ph?ph.getAtTileOffsetFunc(je,Ie.center.lat,Ie.worldSize,ft.getProjection()):null,Pd=Ju(on,ht.tileID.canonical,qe,ze,Ie,ft.getProjection(),Gt);oc(ft,on,g,!1,Pd,ln,qe,ie,$g,je)}return{program:ao,buffers:ft.icon,uniformValues:lo,atlasTexture:vc,atlasTextureIcon:null,atlasInterpolation:Vg,atlasInterpolationIcon:null,isSDF:ft.sdfIcons,hasHalo:uu,tile:ht,labelPlaneMatrixInv:z0}},ti=()=>{const Tr=Ne&&d.layout.get("symbol-placement")!=="point",or=[],kn=Tr||_t||Vn;g.terrainRenderModeElevated()&&Fe&&or.push("PITCH_WITH_MAP_TERRAIN"),Nt&&(or.push("PROJECTION_GLOBE_VIEW"),kn&&or.push("PROJECTED_POS_ON_VIEWPORT")),ft.text.zOffsetVertexBuffer&&or.push("Z_OFFSET"),Zn(or);const Gi=ft.text.programConfigurations.get(d.id),qi=g.getOrCreateProgram(ft.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Gi,defines:or});let ao,lo=[0,0],Hs=null;const co=ft.textSizeData;ft.iconsInText&&(lo=ht.imageAtlasTexture?ht.imageAtlasTexture.size:[0,0],Hs=ht.imageAtlasTexture?ht.imageAtlasTexture:null,ao=Fe||Ie.pitch!==0||g.options.rotating||g.options.zooming||co.kind==="composite"||co.kind==="camera"?Se.LINEAR:Se.NEAREST);const Bs=ht.glyphAtlasTexture?ht.glyphAtlasTexture.size:[0,0],Zs=a.aE(co,Ie.zoom),xt=Jc(on,ht.tileID.canonical,Fe,Ne,Ie,ft.getProjection(),Gt),ln=eh(on,ht.tileID.canonical,Fe,Ne,Ie,ft.getProjection(),Gt),xo=g.translatePosMatrix(ln,ht,k,N,!0),Zr=g.translatePosMatrix(on,ht,k,N),Ke=kn?cp:xt,_c=Ne&&!Fe&&!Tr;let el=nt;!ut&&!Ie.mercatorFromTransition||Ne||(el=Db(Ie));const yc=Nt?el:nt;let vc;vc=ft.iconsInText?a0(co.kind,Zs,_c,Fe,g,Zr,Ke,xo,Bs,lo,je,Bt,Ue,Sn,yc,ft.getProjection()):lp(co.kind,Zs,_c,Fe,g,Zr,Ke,xo,!0,Bs,!0,je,Bt,Ue,Sn,yc,ft.getProjection());const Ug=ht.glyphAtlasTexture?ht.glyphAtlasTexture:null,Vg=Se.LINEAR,uu=d.paint.get("text-halo-width").constantOr(1)!==0,z0=g.terrain&&Fe&&Tr?a.ae.invert(a.ae.create(),xt):cp;if(Tr&&ft.text){const ph=Ie.elevation,$g=ph?ph.getAtTileOffsetFunc(je,Ie.center.lat,Ie.worldSize,ft.getProjection()):null,Pd=Ju(on,ht.tileID.canonical,Fe,Ne,Ie,ft.getProjection(),Gt);oc(ft,on,g,!0,Pd,ln,Fe,ae,$g,je)}return{program:qi,buffers:ft.text,uniformValues:vc,atlasTexture:Ug,atlasTextureIcon:Hs,atlasInterpolation:Vg,atlasInterpolationIcon:ao,isSDF:!0,hasHalo:uu,tile:ht,labelPlaneMatrixInv:z0}},Vr=ft.icon.segments.get().length,gr=ft.text.segments.get().length,jr=Vr&&!S.onlyText?pr():null,Yn=gr&&!S.onlyIcons?ti():null,nr=d.paint.get("icon-opacity").constantOr(1),$n=d.paint.get("text-opacity").constantOr(1);if(Pe&&ft.canOverlap){Qe=!0;const Tr=nr&&!S.onlyText?ft.icon.segments.get():[],or=$n&&!S.onlyIcons?ft.text.segments.get():[];for(const kn of Tr)We.push({segments:new a.b([kn]),sortKey:kn.sortKey,state:jr});for(const kn of or)We.push({segments:new a.b([kn]),sortKey:kn.sortKey,state:Yn})}else S.onlyText||We.push({segments:nr?ft.icon.segments:new a.b([]),sortKey:0,state:jr}),S.onlyIcons||We.push({segments:$n?ft.text.segments:new a.b([]),sortKey:0,state:Yn})}Qe&&We.sort((je,ht)=>je.sortKey-ht.sortKey);for(const je of We){const ht=je.state;if(ht)if(g.terrain?g.terrain.setupElevationDraw(ht.tile,ht.program,{useDepthForOcclusion:Ie.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ht.labelPlaneMatrixInv}):g.setupDepthForOcclusion(Ie.depthOcclusionForSymbolsAndCircles,ht.program),Re.activeTexture.set(Se.TEXTURE0),ht.atlasTexture&&ht.atlasTexture.bind(ht.atlasInterpolation,Se.CLAMP_TO_EDGE,!0),ht.atlasTextureIcon&&(Re.activeTexture.set(Se.TEXTURE1),ht.atlasTextureIcon&&ht.atlasTextureIcon.bind(ht.atlasInterpolationIcon,Se.CLAMP_TO_EDGE,!0)),g.uploadCommonLightUniforms(g.context,ht.program),ht.hasHalo){const ft=ht.uniformValues;ft.u_is_halo=1,h0(ht.buffers,je.segments,d,g,ht.program,Xe,b,T,ft,2),ft.u_is_halo=0}else{if(ht.isSDF){const ft=ht.uniformValues;ht.hasHalo&&(ft.u_is_halo=1,h0(ht.buffers,je.segments,d,g,ht.program,Xe,b,T,ft,1)),ft.u_is_halo=0}h0(ht.buffers,je.segments,d,g,ht.program,Xe,b,T,ht.uniformValues,1)}}}function h0(g,l,d,y,b,T,S,C,k,L){const N=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer];b.draw(y,y.context.gl.TRIANGLES,T,S,C,a.ag.disabled,k,d.id,g.layoutVertexBuffer,g.indexBuffer,l,d.paint,y.transform.zoom,g.programConfigurations.get(d.id),N,L)}function hp(g,l,d,y,b,T,S){const C=g.context.gl,k=d.paint.get("fill-pattern"),L=k&&k.constantOr(1);let N,j,G,q,re;S?(j=L&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=C.LINES):(j=L?"fillPattern":"fill",N=C.TRIANGLES);for(const ie of y){const ae=l.getTile(ie);if(L&&!ae.patternsLoaded())continue;const ce=ae.getBucket(d);if(!ce)continue;g.prepareDrawTile();const ye=ce.programConfigurations.get(d.id),ve=g.isTileAffectedByFog(ie),_e=g.getOrCreateProgram(j,{config:ye,overrideFog:ve});L&&(g.context.activeTexture.set(C.TEXTURE0),ae.imageAtlasTexture&&ae.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ye.updatePaintBuffers());const Re=k.constantOr(null);if(Re&&ae.imageAtlas){const ze=ae.imageAtlas.patternPositions[Re.toString()];ze&&ye.setConstantPatternPositions(ze)}const Se=g.translatePosMatrix(ie.projMatrix,ae,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor")),Ie=d.paint.get("fill-emissive-strength");if(S){q=ce.indexBuffer2,re=ce.segments2;const ze=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];G=j==="fillOutlinePattern"&&L?sp(Se,Ie,g,ae,ze):pg(Se,Ie,ze)}else q=ce.indexBuffer,re=ce.segments,G=L?fg(Se,Ie,g,ae):ip(Se,Ie);g.uploadCommonUniforms(g.context,_e,ie.toUnwrapped()),_e.draw(g,N,b,g.stencilModeForClipping(ie),T,a.ag.disabled,G,d.id,ce.layoutVertexBuffer,q,re,d.paint,g.transform.zoom,ye,void 0)}}function oh(g,l,d,y,b,T,S,C){d.resetLayerRenderingStats(g);const k=g.context,L=k.gl,N=g.transform,j=d.paint.get("fill-extrusion-pattern"),G=j.constantOr(1),q=d.paint.get("fill-extrusion-opacity"),re=g.style.enable3dLights(),ie=d.paint.get(re&&!G?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ae=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),ie],ce=d.layout.get("fill-extrusion-edge-radius"),ye=ce>0&&!d.paint.get("fill-extrusion-rounded-roof"),ve=ye?0:ce,_e=N.projection.name==="globe"?a.b_():0,Re=N.projection.name==="globe",Se=Re?a.a2(N.zoom):0,Ie=[a.ak(N.center.lng),a.al(N.center.lat)],ze=d.paint.get("fill-extrusion-flood-light-color").toRenderColor(d.lut).toArray01().slice(0,3),Ne=d.paint.get("fill-extrusion-flood-light-intensity"),qe=d.paint.get("fill-extrusion-vertical-scale"),Fe=d.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Pe=Fs(g,d.paint.get("fill-extrusion-cutoff-fade-range")),Qe=d.paint.get("fill-extrusion-emissive-strength"),Xe=[];Re&&Xe.push("PROJECTION_GLOBE_VIEW"),ae[0]>0&&Xe.push("FAUX_AO"),ye&&Xe.push("ZERO_ROOF_RADIUS"),C&&Xe.push("HAS_CENTROID"),Ne>0&&Xe.push("FLOOD_LIGHT"),Pe.shouldRenderCutoff&&Xe.push("RENDER_CUTOFF"),Fe&&Xe.push("RENDER_WALL_MODE");const Ue=(()=>{const Nt=d.paint.get("fill-extrusion-line-alignment");switch(Nt){case"inside":return 1;case"outside":return-1;case"center":return 0;default:return a.w(`Unsupported value for fill-extrusion-line-alignment: ${Nt}`),0}})();let _t;const ut=g.renderPass==="shadow",We=g.shadowRenderer,nt=ut&&!!We;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let je=[0,0,0];if(We){const Nt=g.style.directionalLight,Bt=g.style.ambientLight;Nt&&Bt&&(je=tu(g.style,Nt,Bt)),_t=Xe.concat(["SHADOWS_SINGLE_CASCADE"])}const ht=nt?"fillExtrusionDepth":G?"fillExtrusionPattern":"fillExtrusion",ft=d.getLayerRenderingStats();for(const Nt of y){const Bt=l.getTile(Nt),on=Bt.getBucket(d);if(!on||on.projection.name!==N.projection.name)continue;let Gt=!1;We&&(Gt=We.getMaxCascadeForTile(Nt.toUnwrapped())===0);const Tn=g.isTileAffectedByFog(Nt),Vn=on.programConfigurations.get(d.id),Sn=g.getOrCreateProgram(ht,{config:Vn,defines:Gt?_t:Xe,overrideFog:Tn});if(g.terrain&&g.terrain.setupElevationDraw(Bt,Sn,{useMeterToDem:!0}),!on.centroidVertexBuffer){const Yn=Sn.attributes.a_centroid_pos;Yn!==void 0&&L.vertexAttrib2f(Yn,0,0)}!ut&&We&&We.setupShadows(Bt.tileID.toUnwrapped(),Sn,"vector-tile",Bt.tileID.overscaledZ),G&&(g.context.activeTexture.set(L.TEXTURE0),Bt.imageAtlasTexture&&Bt.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Vn.updatePaintBuffers());const Zn=j.constantOr(null);if(Zn&&Bt.imageAtlas){const Yn=Bt.imageAtlas.patternPositions[Zn.toString()];Yn&&Vn.setConstantPatternPositions(Yn)}const pr=d.paint.get("fill-extrusion-vertical-gradient"),ti=1/on.tileToMeter;let Vr;if(ut&&We){if(Al(Bt.tileID,on,g))continue;const Yn=We.calculateShadowPassMatrixFromTile(Bt.tileID.toUnwrapped());Vr=dc(Yn,ve,Ue,ti,qe)}else{const Yn=g.translatePosMatrix(Nt.expandedProjMatrix,Bt,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),nr=N.projection.createInversionMatrix(N,Nt.canonical);Vr=G?pd(Yn,g,pr,q,ae,ve,Ue,ti,Nt,Bt,_e,Se,Ie,nr,ze,qe):ds(Yn,g,pr,q,ae,ve,Ue,ti,Nt,_e,Se,Ie,nr,ze,qe,Ne,je,Qe)}g.uploadCommonUniforms(k,Sn,Nt.toUnwrapped(),null,Pe);let gr=on.segments;if(N.projection.name==="mercator"&&!ut&&(gr=on.getVisibleSegments(Bt.tileID,g.terrain,g.transform.getFrustum(0)),!gr.get().length))continue;if(ft)if(ut)for(const Yn of gr.get())ft.numRenderedVerticesInShadowPass+=Yn.primitiveLength;else for(const Yn of gr.get())ft.numRenderedVerticesInTransparentPass+=Yn.primitiveLength;const jr=[];(g.terrain||C)&&jr.push(on.centroidVertexBuffer),Re&&jr.push(on.layoutVertexExtBuffer),Fe&&jr.push(on.wallVertexBuffer),Sn.draw(g,k.gl.TRIANGLES,b,T,S,a.ag.backCCW,Vr,d.id,on.layoutVertexBuffer,on.indexBuffer,gr,d.paint,g.transform.zoom,Vn,jr)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}function yd(g,l,d,y,b,T,S,C,k,L,N,j,G,q,re,ie,ae,ce,ye){const ve=g.context,_e=ve.gl,Re=g.transform,Se=g.transform.zoom,Ie=[],ze=Fs(g,d.paint.get("fill-extrusion-cutoff-fade-range"));L==="clear"?(Ie.push("CLEAR_SUBPASS"),ye&&(Ie.push("CLEAR_FROM_TEXTURE"),ve.activeTexture.set(_e.TEXTURE0),ye.bind(_e.LINEAR,_e.CLAMP_TO_EDGE))):L==="sdf"&&Ie.push("SDF_SUBPASS"),ae&&Ie.push("HAS_CENTROID"),ze.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF");const Ne=d.layout.get("fill-extrusion-edge-radius"),qe=(Fe,Pe,Qe,Xe,Ue)=>{const _t=Pe.programConfigurations.get(d.id),ut=g.isTileAffectedByFog(Fe),We=g.getOrCreateProgram("fillExtrusionGroundEffect",{config:_t,defines:Ie,overrideFog:ut}),nt=((ht,ft,Nt,Bt,on,Gt,Tn,Vn,Sn,Zn,pr)=>({u_matrix:ft,u_opacity:Nt,u_ao_pass:Bt?1:0,u_meter_to_tile:on,u_ao:Gt,u_flood_light_intensity:Tn,u_flood_light_color:Vn,u_attenuation:Sn,u_edge_radius:Zn,u_fb:0,u_fb_size:pr}))(0,Xe,N,k,Ue,[j,G*Ue],q,re,ie,Se>=17?0:Ne*Ue,ye?ye.size[0]:0),je=[];ae&&je.push(Pe.hiddenByLandmarkVertexBuffer),g.uploadCommonUniforms(ve,We,Fe.toUnwrapped(),null,ze),We.draw(g,ve.gl.TRIANGLES,b,T,S,C,nt,d.id,Pe.vertexBuffer,Pe.indexBuffer,Qe,d.paint,Se,_t,je)};for(const Fe of y){const Pe=l.getTile(Fe),Qe=Pe.getBucket(d);if(!Qe||Qe.projection.name!==Re.projection.name||!Qe.groundEffect||Qe.groundEffect&&!Qe.groundEffect.hasData())continue;const Xe=Qe.groundEffect,Ue=1/Qe.tileToMeter;{const _t=g.translatePosMatrix(Fe.projMatrix,Pe,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),ut=Xe.getDefaultSegment();qe(Fe,Xe,ut,_t,Ue)}if(ce)for(let _t=0;_t<4;_t++){const ut=a.b$[_t](Fe),We=l.getTile(ut);if(!We)continue;const nt=We.getBucket(d);if(!nt||nt.projection.name!==Re.projection.name||!nt.groundEffect||nt.groundEffect&&!nt.groundEffect.hasData())continue;const je=nt.groundEffect;let ht,ft;_t===0?(ht=[-a.a4,0,0],ft=1):_t===1?(ht=[a.a4,0,0],ft=0):_t===2?(ht=[0,-a.a4,0],ft=3):(ht=[0,a.a4,0],ft=2);const Nt=je.regionSegments[ft];if(!Nt)continue;const Bt=new Float32Array(16);a.ae.translate(Bt,Fe.projMatrix,ht),qe(Fe,je,Nt,g.translatePosMatrix(Bt,Pe,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Ue)}}}function hC(g,l,d,y,b,T,S){y.centroidVertexArray.length===0&&y.createCentroidsBuffer();const C=T?T.findDEMTileFor(d):null;if(!(C&&C.dem||S))return;const k=ce=>new a.P(Math.ceil((ce+a.c2)*a.c3),0),L=ce=>{const ye=l.getSource().minzoom,ve=Re=>{const Se=l.getTileByID(Re);if(Se&&Se.hasData())return Se.getBucket(b)},_e=[0,-1,1];for(const Re of _e){if(ce.overscaledZ+Re<ye)continue;const Se=ve(ce.calculateScaledKey(ce.overscaledZ+Re));if(Se)return Se}},N=[0,0,0],j=(ce,ye)=>(N[0]=Math.min(ce.min.y,ye.min.y),N[1]=Math.max(ce.max.y,ye.max.y),N[2]=a.a4-ye.min.x>ce.max.x?ye.min.x-a.a4:ce.max.x,N),G=(ce,ye)=>(N[0]=Math.min(ce.min.x,ye.min.x),N[1]=Math.max(ce.max.x,ye.max.x),N[2]=a.a4-ye.min.y>ce.max.y?ye.min.y-a.a4:ce.max.y,N),q=[(ce,ye)=>j(ce,ye),(ce,ye)=>j(ye,ce),(ce,ye)=>G(ce,ye),(ce,ye)=>G(ye,ce)],re=(ce,ye,ve,_e,Re,Se,Ie)=>{if(!T)return 0;const ze=[[Se?ve:ce,Se?ce:ve,0],[Se?ve:ye,Se?ye:ve,0]],Ne=Ie<0?a.a4+Ie:Ie,qe=[Se?Ne:(ce+ye)/2,Se?(ce+ye)/2:Ne,0];return ve===0&&Ie<0||ve!==0&&Ie>0?T.getForTilePoints(Re,[qe],!0,_e):ze.push(qe),T.getForTilePoints(d,ze,!0,C),Math.max(ze[0][2],ze[1][2],qe[2])/T.exaggeration()};for(let ce=0;ce<4;ce++){const ye=y.borderFeatureIndices[ce];if(ye.length===0)continue;const ve=a.b$[ce](d),_e=L(ve);if(!(_e&&_e instanceof a.c0)||y.borderDoneWithNeighborZ[ce]===_e.canonical.z)continue;_e.centroidVertexArray.length===0&&_e.createCentroidsBuffer();const Re=T?T.findDEMTileFor(ve):null;if(!(Re&&Re.dem||S))continue;const Se=(ce<2?1:5)-ce,Ie=_e.borderDoneWithNeighborZ[Se]!==y.canonical.z,ze=_e.borderFeatureIndices[Se];let Ne=0;if(y.canonical.z!==_e.canonical.z){for(const qe of ye)y.showCentroid(y.featuresOnBorder[qe]);if(Ie)for(const qe of ze)_e.showCentroid(_e.featuresOnBorder[qe]);y.borderDoneWithNeighborZ[ce]=_e.canonical.z,_e.borderDoneWithNeighborZ[Se]=y.canonical.z}for(const qe of ye){const Fe=y.featuresOnBorder[qe],Pe=y.centroidData[Fe.centroidDataIndex],Qe=Fe.borders[ce];let Xe;for(;Ne<ze.length;){Xe=_e.featuresOnBorder[ze[Ne]];const Ue=Xe.borders[Se];if(Ue[1]>Qe[0]+3||Ue[0]>Qe[0]-3)break;_e.showCentroid(Xe),Ne++}if(Xe&&Ne<ze.length){const Ue=Ne;let _t=0;for(;!(Xe.borders[Se][0]>Qe[1]-3)&&(_t++,++Ne!==ze.length);)Xe=_e.featuresOnBorder[ze[Ne]];if(Xe=_e.featuresOnBorder[ze[Ue]],_t>1){const nt=Xe.borders[Se];Math.abs(Qe[0]-nt[0])<3&&Math.abs(Qe[1]-nt[1])<3&&(_t=1,Ne=Ue+1)}else if(_t===0){y.showCentroid(Fe);continue}const ut=_e.centroidData[Xe.centroidDataIndex];S&&_t===1&&(((ie=Pe).flags|(ae=ut).flags)&a.c1?(ie.flags|=a.c1,ae.flags|=a.c1):(ie.flags&=~a.c1,ae.flags&=~a.c1));const We=Fe.intersectsCount()>1||Xe.intersectsCount()>1;if(_t>1)Ne=Ue,Pe.centroidXY=ut.centroidXY=new a.P(0,0);else if(Re&&Re.dem&&!We){const nt=q[ce](Pe,ut),je=ce%2?a.a4-1:0,ht=re(nt[0],Math.min(a.a4-1,nt[1]),je,Re,ve,ce<2,nt[2]);Pe.centroidXY=ut.centroidXY=k(ht)}else We?Pe.centroidXY=ut.centroidXY=new a.P(0,0):(Pe.centroidXY=y.encodeBorderCentroid(Fe),ut.centroidXY=_e.encodeBorderCentroid(Xe));y.writeCentroidToBuffer(Pe),_e.writeCentroidToBuffer(ut)}else y.showCentroid(Fe)}y.borderDoneWithNeighborZ[ce]=_e.canonical.z,_e.borderDoneWithNeighborZ[Se]=y.canonical.z}var ie,ae;(y.needsCentroidUpdate||!y.centroidVertexBuffer&&y.centroidVertexArray.length!==0)&&y.uploadCentroid(g)}const Lb=[1,0,0],dC=[0,1,0],_g=[0,0,1];function Al(g,l,d){const y=d.transform,b=d.shadowRenderer;if(!b)return!0;const T=g.toUnwrapped(),S=y.tileSize*b._cascades[d.currentShadowCascade].scale;let C=l.maxHeight;if(y.elevation){const ie=y.elevation.getMinMaxForTile(g);ie&&(C+=ie.max)}const k=[...b.shadowDirection];k[2]=-k[2];const L=b.computeSimplifiedTileShadowVolume(T,C,S,k);if(!L)return!1;const N=[Lb,dC,_g,k,[k[0],0,k[2]],[0,k[1],k[2]]],j=y.projection.name==="globe",G=y.scaleZoom(S),q=a.aM.fromInvProjectionMatrix(y.invProjMatrix,y.worldSize,G,!j),re=b.getCurrentCascadeFrustum();return q.intersectsPrecise(L.vertices,L.planes,N)===0||re.intersectsPrecise(L.vertices,L.planes,N)===0}function dp(g){return[g[0]*a.c4,g[1]*a.c4,g[2]*a.c4,0]}function yg(g,l,d,y,b,T,S,C,k){const L=y.getSource(),N=d.globeSharedBuffers;if(!N)return;let j,G,q;if(l&&(j=y.getTile(l)),L instanceof a.bo?(G=L.texture,q=a.bj(0,0,d.transform)):j&&l&&(G=j.texture,q=a.bj(l.canonical.z,l.canonical.x,d.transform)),!G||!q)return;g||(q=a.ae.scale(a.ae.create(),q,[1,-1,1]));const re=d.context,ie=re.gl,ae=b.paint.get("raster-resampling")==="nearest"?ie.NEAREST:ie.LINEAR,ce=d.colorModeForDrapableLayerRenderPass(T),ye=S.defines;ye.push("GLOBE_POLES");const ve=new a.af(ie.LEQUAL,a.af.ReadWrite,d.depthRangeFor3D),_e=Float32Array.from(d.transform.expandedFarZProjMatrix),Re=Float32Array.from(a.bh(a.bi(new a.aO(0,0,0))));d.terrain&&d.terrain.prepareDrawTile(),re.activeTexture.set(ie.TEXTURE0),G.bind(ae,ie.CLAMP_TO_EDGE),re.activeTexture.set(ie.TEXTURE1),G.bind(ae,ie.CLAMP_TO_EDGE),G.useMipmap&&re.extTextureFilterAnisotropic&&d.transform.pitch>20&&ie.texParameterf(ie.TEXTURE_2D,re.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,re.extTextureFilterAnisotropicMax);const[Se,Ie,ze,Ne]=l?N.getPoleBuffers(l.canonical.z,!1):N.getPoleBuffers(0,!0),qe=b.paint.get("raster-elevation");let Fe;g?(Fe=Se,d.renderDefaultNorthPole=qe!==0):(Fe=Ie,d.renderDefaultSouthPole=qe!==0);const Pe=dp(S.mix),Qe=((Ue,_t,ut,We,nt,je,ht,ft,Nt,Bt,on,Gt,Tn)=>gg(Ue,_t,ut,new Float32Array(16),new Float32Array(9),[0,0],We,[0,0],[0,0,0,0],1,{opacity:1,mix:0},je,[0,0],ft,2,Bt,on,Gt,1,0,Tn))(_e,Re,q,a.a2(d.transform.zoom),0,b,0,qe,0,Pe,S.offset,S.range,T),Xe=d.getOrCreateProgram("raster",{defines:ye});d.uploadCommonUniforms(re,Xe,null),Xe.draw(d,ie.TRIANGLES,ve,k,ce,C,Qe,b.id,Fe,ze,Ne)}function d0(g){const l=g._nearZ,d=g.projection.farthestPixelDistance(g),y=d-l,b=.2*g.height,T=l+b;return[l,d,(T-b-l)/y,(T-l)/y]}function ah(g,l,d,y){if(g)return l instanceof R&&g instanceof a.c5?l.getTextureDescriptor(g,d,!0):{texture:g.texture,mix:dp(y.mix),offset:y.offset,buffer:0,tileSize:1}}function zb(g,l,d){if(!g)return null;const y=l.getTextureDescriptor(g,d,!0);if(!y)return null;let{texture:b,mix:T,offset:S,tileSize:C,buffer:k,format:L}=y;if(!b||!L)return null;let N=!1;return L==="uint32"&&(N=!0,T[3]=0,T=s0(a.c6,T,[0,d.paint.get("raster-particle-max-speed")]),S=op(a.c6,S,[0,d.paint.get("raster-particle-max-speed")])),{texture:b,textureOffset:[k/(C+2*k),C/(C+2*k)],tileSize:C,scalarData:N,scale:T,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function vg(g){const l=g._nearZ,d=g.projection.farthestPixelDistance(g),y=d-l,b=.2*g.height,T=l+b;return[l,d,(T-b-l)/y,(T-l)/y]}const f0=new a.C(1,0,0,1),xg=new a.C(0,1,0,1),p0=new a.C(0,0,1,1),Ar=new a.C(1,0,1,1),fC=new a.C(0,1,1,1);function En(g,l,d,y,b,T,S){const C=g.context,k=g.transform,L=C.gl,N=k.projection.name==="globe",j=N?["PROJECTION_GLOBE_VIEW"]:[];let G=a.ae.clone(d.projMatrix);if(N&&a.a2(k.zoom)>0){const Pe=a.c7(d.canonical,k),Qe=a.c8(Pe);G=a.ae.multiply(new Float32Array(16),k.globeMatrix,Qe),a.ae.multiply(G,k.projMatrix,G)}const q=a.ae.create();q[12]+=2*b/(a.e.devicePixelRatio*k.width),q[13]+=2*T/(a.e.devicePixelRatio*k.height),a.ae.multiply(G,q,G);const re=g.getOrCreateProgram("debug",{defines:j}),ie=l.getTileByID(d.key);g.terrain&&g.terrain.setupElevationDraw(ie,re);const ae=a.af.disabled,ce=a.ah.disabled,ye=g.colorModeForRenderPass(),ve="$debug";C.activeTexture.set(L.TEXTURE0),g.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),N?ie._makeGlobeTileDebugBuffers(g.context,k):ie._makeDebugTileBoundsBuffers(g.context,k.projection);const _e=ie._tileDebugBuffer||g.debugBuffer,Re=ie._tileDebugIndexBuffer||g.debugIndexBuffer,Se=ie._tileDebugSegments||g.debugSegments;if(re.draw(g,L.LINE_STRIP,ae,ce,ye,a.ag.disabled,mg(G,y),ve,_e,Re,Se,null,null,null,[ie._globeTileDebugBorderBuffer]),S){const Pe=ie.latestRawTileData,Qe=Math.floor((Pe&&Pe.byteLength||0)/1024);let Xe=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Xe+=` => ${d.overscaledZ}`),Xe+=` ${ie.state}`,Xe+=` ${Qe}kb`,function(Ue,_t){Ue.initDebugOverlayCanvas();const ut=Ue.debugOverlayCanvas,We=Ue.context.gl,nt=Ue.debugOverlayCanvas.getContext("2d");nt.clearRect(0,0,ut.width,ut.height),nt.shadowColor="white",nt.shadowBlur=2,nt.lineWidth=1.5,nt.strokeStyle="white",nt.textBaseline="top",nt.font="bold 36px Open Sans, sans-serif",nt.fillText(_t,5,5),nt.strokeText(_t,5,5),Ue.debugOverlayTexture.update(ut),Ue.debugOverlayTexture.bind(We.LINEAR,We.CLAMP_TO_EDGE)}(g,Xe)}const Ie=l.getTile(d).tileSize,ze=512/Math.min(Ie,512)*(d.overscaledZ/k.zoom)*.5,Ne=ie._tileDebugTextBuffer||g.debugBuffer,qe=ie._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,Fe=ie._tileDebugTextSegments||g.debugSegments;re.draw(g,L.TRIANGLES,ae,ce,a.a.alphaBlended,a.ag.disabled,mg(G,a.C.transparent,ze),ve,Ne,qe,Fe,null,null,null,[ie._globeTileDebugTextBuffer])}function m0(g,l,d,y){vd(g,0,l+d/2,g.transform.width,d,y)}function fp(g,l,d,y){vd(g,l-d/2,0,d,g.transform.height,y)}function vd(g,l,d,y,b,T){const S=g.context,C=S.gl;C.enable(C.SCISSOR_TEST),C.scissor(l*a.e.devicePixelRatio,d*a.e.devicePixelRatio,y*a.e.devicePixelRatio,b*a.e.devicePixelRatio),S.clear({color:T}),C.disable(C.SCISSOR_TEST)}const Cl=a.c9([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:g0}=Cl;function ca(g,l,d,y){g.emplaceBack(l,d,y)}class tn{constructor(l){this.vertexArray=new a.ca,this.indices=new a.bw,ca(this.vertexArray,-1,-1,1),ca(this.vertexArray,1,-1,1),ca(this.vertexArray,-1,1,1),ca(this.vertexArray,1,1,1),ca(this.vertexArray,-1,-1,-1),ca(this.vertexArray,1,-1,-1),ca(this.vertexArray,-1,1,-1),ca(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,g0),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=a.b.simpleSegment(0,0,36,12)}}function xr(g,l,d,y,b,T){const S=g.context.gl,C=l.paint.get("sky-atmosphere-color"),k=l.paint.get("sky-atmosphere-halo-color"),L=l.paint.get("sky-atmosphere-sun-intensity"),N=((j,G,q,re,ie)=>({u_matrix_3f:j,u_sun_direction:G,u_sun_intensity:q,u_color_tint_r:[re.r,re.g,re.b,re.a],u_color_tint_m:[ie.r,ie.g,ie.b,ie.a],u_luminance:5e-5}))(a.bE.fromMat4(a.bE.create(),y),b,L,C,k);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+T,l.skyboxTexture,0),d.draw(g,S.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.unblended,a.ag.frontCW,N,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const Mr=a.c9([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ca{constructor(l){const d=new a.cb;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const y=new a.bw;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(d,Mr.members),this.indexBuffer=l.createIndexBuffer(y),this.segments=a.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const xd=a.c9([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Er{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class bg{constructor(l){this.colorModeAlphaBlendedWriteRGB=new a.a([a.cc,a.cd,a.cc,a.cd],a.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new a.a([a.cc,a.ce,a.cc,a.ce],a.C.transparent,[!1,!1,!1,!0]),this.params=new Er,this.updateNeeded=!0,l.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),l.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(l){const d=l.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ca(d);const y=this.params.sizeRange,b=this.params.intensityRange,T=function(N){const j=a.ch(30),G=[];for(let q=0;q<N;++q){const re=2*Math.PI*j(),ie=Math.acos(1-2*j())-.5*Math.PI;G.push(a.$.fromValues(Math.cos(ie)*Math.cos(re),Math.cos(ie)*Math.sin(re),Math.sin(ie)))}return G}(this.params.starsCount),S=a.ch(300),C=new a.cf,k=new a.bw;let L=0;for(let N=0;N<T.length;++N){const j=a.$.scale([],T[N],200),G=Math.max(0,1+.01*y*(1*S()-.5)),q=Math.max(0,1+.01*b*(1*S()-.5));C.emplaceBack(j[0],j[1],j[2],-1,-1,G,q),C.emplaceBack(j[0],j[1],j[2],1,-1,G,q),C.emplaceBack(j[0],j[1],j[2],1,1,G,q),C.emplaceBack(j[0],j[1],j[2],-1,1,G,q),k.emplaceBack(L+0,L+1,L+2),k.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=d.createVertexBuffer(C,xd.members),this.starsIdx=d.createIndexBuffer(k),this.starsSegments=a.b.simpleSegment(0,0,C.length,k.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(l,d){const y=l.context,b=y.gl,T=l.transform,S=new a.af(b.LEQUAL,a.af.ReadOnly,[0,1]),C=a.a2(T.zoom),k=l.style.getLut(d.scope),L=d.properties.get("color").toRenderColor(k).toArray01(),N=d.properties.get("high-color").toRenderColor(k).toArray01(),j=d.properties.get("space-color").toRenderColor(k).toArray01PremultipliedAlpha(),G=5e-4,q=a.cg(d.properties.get("horizon-blend"),0,1,G,.25),re=a.bc(l,y,T)&&q===G?T.worldSize/(2*Math.PI*1.025)-1:T.globeRadius,ie=l.frameCounter/1e3%1,ae=a.$.length(T.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(ae,2)-Math.pow(re,2)),ye=Math.acos(ce/ae),ve=_e=>{const Re=T.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];_e&&Re.push("ALPHA_PASS");const Se=l.getOrCreateProgram("globeAtmosphere",{defines:Re}),Ie=((Ne,qe,Fe,Pe,Qe,Xe,Ue,_t,ut,We,nt,je)=>({u_frustum_tl:Ne,u_frustum_tr:qe,u_frustum_br:Fe,u_frustum_bl:Pe,u_horizon:Qe,u_transition:Xe,u_fadeout_range:Ue,u_color:_t,u_high_color:ut,u_space_color:We,u_temporal_offset:nt,u_horizon_angle:je}))(T.frustumCorners.TL,T.frustumCorners.TR,T.frustumCorners.BR,T.frustumCorners.BL,T.frustumCorners.horizon,C,q,L,N,j,ie,ye);l.uploadCommonUniforms(y,Se);const ze=this.atmosphereBuffer;ze&&Se.draw(l,b.TRIANGLES,S,a.ah.disabled,_e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,a.ag.backCW,Ie,_e?"atmosphere_glow_alpha":"atmosphere_glow",ze.vertexBuffer,ze.indexBuffer,ze.segments)};ve(!1),ve(!0)}drawStars(l,d){const y=a.au(d.properties.get("star-intensity"),0,1);if(y===0)return;const b=l.context,T=b.gl,S=l.transform,C=l.getOrCreateProgram("stars"),k=a.aw.identity([]);a.aw.rotateX(k,k,-S._pitch),a.aw.rotateZ(k,k,-S.angle),a.aw.rotateX(k,k,a.ac(S._center.lat)),a.aw.rotateY(k,k,-a.ac(S._center.lng));const L=a.ae.fromQuat(new Float32Array(16),k),N=a.ae.multiply([],S.starsProjMatrix,L),j=a.bE.fromMat4([],L),G=a.bE.invert([],j),q=[0,1,0];a.$.transformMat3(q,q,G),a.$.scale(q,q,this.params.sizeMultiplier);const re=[1,0,0];a.$.transformMat3(re,re,G),a.$.scale(re,re,this.params.sizeMultiplier);const ie=(ae=q,ce=re,ye=y,{u_matrix:Float32Array.from(N),u_up:ae,u_right:ce,u_intensity_multiplier:ye});var ae,ce,ye;l.uploadCommonUniforms(b,C),this.starsVx&&this.starsIdx&&C.draw(l,T.TRIANGLES,a.af.disabled,a.ah.disabled,this.colorModeAlphaBlendedWriteRGB,a.ag.disabled,ie,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function bd(g,l){const d=[...g],y=l.cameraWorldSizeForFog/l.worldSize,b=a.ae.identity([]);return a.ae.scale(b,b,[y,y,1]),a.ae.multiply(d,b,d),a.ae.multiply(d,l.worldToFogMatrix,d),d}function lh(g,l,d,y,b){const T=d.material,S=y.context,{baseColorTexture:C,metallicRoughnessTexture:k}=T.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:N,emissionTexture:j}=T;function G(q,re,ie){if(q&&(g.push(re),S.activeTexture.set(S.gl.TEXTURE0+ie),q.gfxTexture)){const{minFilter:ae,magFilter:ce,wrapS:ye,wrapT:ve}=q.sampler;q.gfxTexture.bindExtraParam(ae,ce,ye,ve)}}G(C,"HAS_TEXTURE_u_baseColorTexture",Ms.BaseColor),G(k,"HAS_TEXTURE_u_metallicRoughnessTexture",Ms.MetallicRoughness),G(L,"HAS_TEXTURE_u_normalTexture",Ms.Normal),G(N,"HAS_TEXTURE_u_occlusionTexture",Ms.Occlusion),G(j,"HAS_TEXTURE_u_emissionTexture",Ms.Emission),b&&(b.texture||(b.texture=new a.cj(y.context,b.image,[b.image.height,b.image.height,b.image.height],S.gl.RGBA)),S.activeTexture.set(S.gl.TEXTURE0+Ms.LUT),b.texture&&b.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),g.push("APPLY_LUT_ON_GPU")),d.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),l.push(d.texcoordBuffer)),d.colorBuffer&&(g.push(d.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),l.push(d.colorBuffer)),d.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),l.push(d.normalBuffer)),d.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),l.push(d.pbrBuffer)),T.alphaMode!=="OPAQUE"&&T.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),T.defined||g.push("DIFFUSE_SHADED"),g.push("USE_STANDARD_DERIVATIVES")}function so(g,l,d,y,b,T){const S=d.paint.get("model-opacity"),C=l.context,k=new a.af(l.context.gl.LEQUAL,a.af.ReadWrite,l.depthRangeFor3D),L=l.transform,N=g.mesh,j=N.material,G=j.pbrMetallicRoughness,q=l.style.fog;let re;re=l.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:a.ae.multiply([],y.zScaleMatrix,g.nodeModelMatrix),a.ae.multiply(re,y.negCameraPosMatrix,re);const ie=a.ae.invert([],re);a.ae.transpose(ie,ie);const ae=d.paint.get("model-emissive-strength").constantOr(0),ce=ih(new Float32Array(g.worldViewProjection),new Float32Array(re),new Float32Array(ie),null,l,S,G.baseColorFactor.toRenderColor(null),j.emissiveFactor,G.metallicFactor,G.roughnessFactor,j,ae,d),ye={defines:[]},ve=[];lh(ye.defines,ve,N,l,d.lut);const _e=l.shadowRenderer;_e&&(_e.useNormalOffset=!1);let Re=null;if(q){const ze=bd(g.nodeModelMatrix,l.transform);if(Re=new Float32Array(ze),L.projection.name!=="globe"){const Ne=N.aabb.min,qe=N.aabb.max,[Fe,Pe]=q.getOpacityForBounds(ze,Ne[0],Ne[1],qe[0],qe[1]);ye.overrideFog=Fe>=vr||Pe>=vr}}const Se=Fs(l,d.paint.get("model-cutoff-fade-range"));Se.shouldRenderCutoff&&ye.defines.push("RENDER_CUTOFF");const Ie=l.getOrCreateProgram("model",ye);l.uploadCommonUniforms(C,Ie,null,Re,Se),l.renderPass!=="shadow"&&_e&&_e.setupShadowsFromMatrix(g.nodeModelMatrix,Ie),Ie.draw(l,C.gl.TRIANGLES,k,b,T,N.material.doubleSided?a.ag.disabled:a.ag.backCCW,ce,d.id,N.vertexBuffer,N.indexBuffer,N.segments,d.paint,l.transform.zoom,void 0,ve)}function Ni(g,l,d,y,b,T,S){let C;C=g.projection.name==="globe"?a.ck(d,g):[...d],a.ae.multiply(C,C,l.matrix);const k=a.ae.multiply([],y,C);if(l.meshes)for(const L of l.meshes){if(L.material.alphaMode!=="BLEND"){S.push({mesh:L,depth:0,modelIndex:b,worldViewProjection:k,nodeModelMatrix:C});continue}const N=a.$.transformMat4([],L.centroid,k);N[2]>0&&T.push({mesh:L,depth:N[2],modelIndex:b,worldViewProjection:k,nodeModelMatrix:C})}if(l.children)for(const L of l.children)Ni(g,L,d,y,b,T,S)}function _0(g,l,d,y){const b=d.shadowRenderer;if(!b)return;const T=b.getShadowPassDepthMode(),S=b.getShadowPassColorMode(),C=b.calculateShadowPassMatrixFromMatrix(l),k=c0(C);d.getOrCreateProgram("modelDepth",{defines:d._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(d,d.context.gl.TRIANGLES,T,a.ah.disabled,S,a.ag.backCCW,k,y.id,g.vertexBuffer,g.indexBuffer,g.segments,y.paint,d.transform.zoom,void 0,void 0)}function pp(g,l,d){const y=l.updateZoomBasedPaintProperties(),b=function(T,S,C){let k,L,N,j=T.terrain?T.terrain.exaggeration():0;if(T.terrain&&j>0){const G=T.terrain,q=G.findDEMTileFor(C);q&&q.dem?k=a.cm.create(G,C,q):j=0}if(j===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),j===S.validForExaggeration&&(j===0||k&&k._demTile&&k._demTile.tileID===S.validForDEMTile.id&&k._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const G in S.instancesPerModel){const q=S.instancesPerModel[G];for(let re=0;re<q.instancedDataArray.length;++re){const ie=(k?j*k.getElevationAt(0|q.instancedDataArray.float32[16*re],0|q.instancedDataArray.float32[16*re+1],!0,!0):0)+q.instancesEvaluatedElevation[re];q.instancedDataArray.float32[16*re+6]=ie,L=L?Math.min(S.terrainElevationMin,ie):ie,N=N?Math.max(S.terrainElevationMax,ie):ie}}return S.terrainElevationMin=L||0,S.terrainElevationMax=N||0,S.validForExaggeration=j,S.validForDEMTile=k&&k._demTile?{id:k._demTile.tileID,timestamp:k._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,l,d);(y||b)&&(l.uploaded=!1,l.upload(g.context))}const Pa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.b8([0,0,0],[a.a4,a.a4,0])};function mp(g,l){const d=1<<g.canonical.z,y=l.getFreeCameraOptions().position,b=l.elevation,T=g.canonical.x/d,S=(g.canonical.x+1)/d,C=g.canonical.y/d,k=(g.canonical.y+1)/d;let L=l._centerAltitude;if(b){const q=b.getMinMaxForTile(g);q&&q.max>L&&(L=q.max)}const N=a.au(y.x,T,S)-y.x,j=a.au(y.y,C,k)-y.y,G=a.ay(L,l.center.lat)-y.z;return l._zoomFromMercatorZ(Math.sqrt(N*N+j*j+G*G))}function wg(g,l,d,y,b,T,S){const C=g.context,k=g.renderPass==="shadow",L=g.shadowRenderer,N=k&&L?L.getShadowPassDepthMode():new a.af(C.gl.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D),j=g.isTileAffectedByFog(T);if(d.meshes)for(const G of d.meshes){const q=["MODEL_POSITION_ON_GPU"],re=[];let ie,ae,ce;y.instancedDataArray.length>20&&q.push("INSTANCED_ARRAYS");const ye=Fs(g,l.paint.get("model-cutoff-fade-range"));if(ye.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),k&&L)ie=g.getOrCreateProgram("modelDepth",{defines:q}),ae=c0(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(d.matrix)),ce=L.getShadowPassColorMode();else{lh(q,re,G,g,l.lut),ie=g.getOrCreateProgram("model",{defines:q,overrideFog:j});const _e=G.material,Re=_e.pbrMetallicRoughness,Se=l.paint.get("model-opacity"),Ie=l.paint.get("model-emissive-strength").constantOr(0);ae=ih(T.expandedProjMatrix,Float32Array.from(d.matrix),new Float32Array(16),null,g,Se,Re.baseColorFactor.toRenderColor(null),_e.emissiveFactor,Re.metallicFactor,Re.roughnessFactor,_e,Ie,l,b),L&&(S.shadowUniformsInitialized?ie.setShadowUniformValues(C,L.getShadowUniformValues()):(L.setupShadows(T.toUnwrapped(),ie,"model-tile",T.overscaledZ),S.shadowUniformsInitialized=!0)),ce=ye.shouldRenderCutoff||Se<1||_e.alphaMode!=="OPAQUE"?a.a.alphaBlended:a.a.unblended}g.uploadCommonUniforms(C,ie,T.toUnwrapped(),null,ye);const ve=G.material.doubleSided?a.ag.disabled:a.ag.backCCW;if(y.instancedDataArray.length>20)re.push(y.instancedDataBuffer),ie.draw(g,C.gl.TRIANGLES,N,a.ah.disabled,ce,ve,ae,l.id,G.vertexBuffer,G.indexBuffer,G.segments,l.paint,g.transform.zoom,void 0,re,y.instancedDataArray.length);else{const _e=k?"u_instance":"u_normal_matrix";for(let Re=0;Re<y.instancedDataArray.length;++Re)ae[_e]=new Float32Array(y.instancedDataArray.arrayBuffer,64*Re,16),ie.draw(g,C.gl.TRIANGLES,N,a.ah.disabled,ce,ve,ae,l.id,G.vertexBuffer,G.indexBuffer,G.segments,l.paint,g.transform.zoom,void 0,re)}}if(d.children)for(const G of d.children)wg(g,l,G,y,b,T,S)}const Tg=[1,-1,1];function vo(g,l,d,y){if(!d.modelManager)return!0;const b=d.modelManager;if(!d.shadowRenderer)return!0;const T=d.shadowRenderer,S=l.aabb;let C=!0,k=g.maxHeight;if(k===0){let N=0;for(const j in g.instancesPerModel){const G=b.getModel(j,y);G?N=Math.max(N,Math.max(Math.max(G.aabb.max[0],G.aabb.max[1]),G.aabb.max[2])):C=!1}k=g.maxScale*N*1.41+g.maxVerticalOffset,C&&(g.maxHeight=k)}S.max[2]=k,S.min[2]+=g.terrainElevationMin,S.max[2]+=g.terrainElevationMax,a.$.transformMat4(S.min,S.min,l.tileMatrix),a.$.transformMat4(S.max,S.max,l.tileMatrix);const L=S.intersects(T.getCurrentCascadeFrustum());return d.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=L===2),L===0}function ua(g,l){const d=g.uniformValues.u_cutoff_params[0],y=g.uniformValues.u_cutoff_params[1],b=g.uniformValues.u_cutoff_params[2],T=g.uniformValues.u_cutoff_params[3];return y===d||T===b?1:a.au(((l-d)/(y-d)-b)/(T-b),0,1)}function Nb(g,l,d,y){if(l.pitch<20)return 1;const b=l.getWorldToCameraMatrix(),T=a.ae.multiply([],b,g),S=[...d.min,1];let C=a.aB.transformMat4([],S,T),k=C,L=C;S[1]=d.max[1],C=a.aB.transformMat4([],S,T),k=C[1]<k[1]?C:k,L=C[1]>L[1]?C:L,S[0]=d.max[0],C=a.aB.transformMat4([],S,T),k=C[1]<k[1]?C:k,L=C[1]>L[1]?C:L,S[1]=d.min[1],C=a.aB.transformMat4([],S,T),k=C[1]<k[1]?C:k,L=C[1]>L[1]?C:L;const N=a.au(y[0],0,1),j=100*l.pixelsPerMeter*a.au(y[1],0,1),G=a.au(y[2],0,1),q=a.$.lerp([],k,L,N),re=Math.tan(.5*l.fovX),ie=-q[2]*re;if(j===0)return q[1]<-Math.abs(ie)?G:1;const ae=(-Math.abs(ie)-q[1])/j,ce=(ve,_e,Re)=>(1-Re)*ve+Re*_e,ye=a.au(ce(1,G,ae),G,1);return ce(1,ye,a.au((l.pitch-20)/20,0,1))}class wd{}class fs{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(l,d,y){{const j=this._storage.get(d.id);if(j)return j.lastUsedFrameIdx=l,j.buf}const b=y.gl,T=b.getBufferParameter(b.ELEMENT_ARRAY_BUFFER,b.BUFFER_SIZE),S=new ArrayBuffer(T),C=new Int16Array(S);b.getBufferSubData(b.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const k=new a.co;for(let j=0;j<T/2;j+=3){const G=C[j],q=C[j+1],re=C[j+2];k.emplaceBack(G,q),k.emplaceBack(q,re),k.emplaceBack(re,G)}const L=y.bindVertexArrayOES.current,N=new wd;return N.buf=new a.I(y,k),N.lastUsedFrameIdx=l,this._storage.set(d.id,N),y.bindVertexArrayOES.set(L),N.buf}update(l){for(const[d,y]of this._storage)l-y.lastUsedFrameIdx>30&&(y.buf.destroy(),this._storage.delete(d))}destroy(){for(const[l,d]of this._storage)d.buf.destroy(),this._storage.delete(l)}}class Qa{constructor(l){this.occluderSize=30,this.depthOffset=-1e-4,l.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),l.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Ja={symbol:function(g,l,d,y,b){if(g.renderPass!=="translucent")return;const T=a.ah.disabled,S=g.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(L,N,j,G,q,re,ie){const ae=N.transform,ce=q==="map",ye=re==="map";for(const ve of L){const _e=G.getTile(ve),Re=_e.getBucket(j);if(!Re||!Re.text||!Re.text.segments.get().length)continue;const Se=a.aE(Re.textSizeData,ae.zoom),Ie=u0(ve,Re.getProjection(),ae),ze=ae.calculatePixelsToTileUnitsMatrix(_e),Ne=Jc(Ie,_e.tileID.canonical,ye,ce,ae,Re.getProjection(),ze),qe=Re.hasIconTextFit()&&Re.hasIconData();if(Se){const Fe=Math.pow(2,ae.zoom-_e.tileID.overscaledZ);uC(Re,ce,ye,ie,a.bQ,ae,Ne,ve,Fe,Se,qe)}}}(y,g,d,l,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),b);const C=d.paint.get("icon-opacity").constantOr(1)!==0,k=d.paint.get("text-opacity").constantOr(1)!==0;d.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(C||k)?up(g,l,d,y,T,S):(C&&up(g,l,d,y,T,S,{onlyIcons:!0}),k&&up(g,l,d,y,T,S,{onlyText:!0})),l.map.showCollisionBoxes&&(kb(g,l,d,y,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),kb(g,l,d,y,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(g,l,d,y){if(g.renderPass!=="translucent")return;const b=d.paint.get("circle-opacity"),T=d.paint.get("circle-stroke-width"),S=d.paint.get("circle-stroke-opacity"),C=d.layout.get("circle-sort-key").constantOr(1)!==void 0,k=d.paint.get("circle-emissive-strength");if(b.constantOr(1)===0&&(T.constantOr(1)===0||S.constantOr(1)===0))return;const L=g.context,N=L.gl,j=g.transform,G=g.depthModeForSublayer(0,a.af.ReadOnly),q=a.ah.disabled,re=g.colorModeForDrapableLayerRenderPass(k),ie=j.projection.name==="globe",ae=[a.ak(j.center.lng),a.al(j.center.lat)],ce=[];for(let ve=0;ve<y.length;ve++){const _e=y[ve],Re=l.getTile(_e),Se=Re.getBucket(d);if(!Se||Se.projection.name!==j.projection.name)continue;const Ie=Se.programConfigurations.get(d.id),ze=a.bT(d),Ne=g.isTileAffectedByFog(_e);ie&&ze.push("PROJECTION_GLOBE_VIEW"),ze.push("DEPTH_D24"),g.terrain&&j.depthOcclusionForSymbolsAndCircles&&ze.push("DEPTH_OCCLUSION");const qe=g.getOrCreateProgram("circle",{config:Ie,defines:ze,overrideFog:Ne}),Fe=Se.layoutVertexBuffer,Pe=Se.globeExtVertexBuffer,Qe=Se.indexBuffer,Xe=j.projection.createInversionMatrix(j,_e.canonical),Ue={programConfiguration:Ie,program:qe,layoutVertexBuffer:Fe,globeExtVertexBuffer:Pe,indexBuffer:Qe,uniformValues:a.bU(g,_e,Re,Xe,ae,d),tile:Re};if(C){const _t=Se.segments.get();for(const ut of _t)ce.push({segments:new a.b([ut]),sortKey:ut.sortKey,state:Ue})}else ce.push({segments:Se.segments,sortKey:0,state:Ue})}C&&ce.sort((ve,_e)=>ve.sortKey-_e.sortKey);const ye={useDepthForOcclusion:j.depthOcclusionForSymbolsAndCircles};for(const ve of ce){const{programConfiguration:_e,program:Re,layoutVertexBuffer:Se,globeExtVertexBuffer:Ie,indexBuffer:ze,uniformValues:Ne,tile:qe}=ve.state,Fe=ve.segments;g.terrain&&g.terrain.setupElevationDraw(qe,Re,ye),g.uploadCommonUniforms(L,Re,qe.tileID.toUnwrapped()),Re.draw(g,N.TRIANGLES,G,q,re,a.ag.disabled,Ne,d.id,Se,ze,Fe,d.paint,j.zoom,_e,[Ie])}},heatmap:function(g,l,d,y){if(d.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const b=g.context,T=b.gl,S=a.ah.disabled,C=new a.a([T.ONE,T.ONE,T.ONE,T.ONE],a.C.transparent,[!0,!0,!0,!0]);(function(q,re,ie,ae){const ce=q.gl,ye=re.width*ae,ve=re.height*ae;q.activeTexture.set(ce.TEXTURE1),q.viewport.set([0,0,ye,ve]);let _e=ie.heatmapFbo;if(!_e||_e&&(_e.width!==ye||_e.height!==ve)){_e&&_e.destroy();const Re=ce.createTexture();ce.bindTexture(ce.TEXTURE_2D,Re),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MAG_FILTER,ce.LINEAR),_e=ie.heatmapFbo=q.createFramebuffer(ye,ve,!0,null),function(Se,Ie,ze,Ne,qe,Fe){const Pe=Se.gl;Pe.texImage2D(Pe.TEXTURE_2D,0,Se.extRenderToTextureHalfFloat?Pe.RGBA16F:Pe.RGBA,qe,Fe,0,Pe.RGBA,Se.extRenderToTextureHalfFloat?Pe.HALF_FLOAT:Pe.UNSIGNED_BYTE,null),Ne.colorAttachment.set(ze)}(q,0,Re,_e,ye,ve)}else ce.bindTexture(ce.TEXTURE_2D,_e.colorAttachment.get()),q.bindFramebuffer.set(_e.framebuffer)})(b,g,d,g.transform.projection.name==="globe"?.5:.25),b.clear({color:a.C.transparent});const k=g.transform,L=k.projection.name==="globe",N=L?["PROJECTION_GLOBE_VIEW"]:[],j=L?a.ag.frontCCW:a.ag.disabled,G=[a.ak(k.center.lng),a.al(k.center.lat)];for(let q=0;q<y.length;q++){const re=y[q];if(l.hasRenderableParent(re))continue;const ie=l.getTile(re),ae=ie.getBucket(d);if(!ae||ae.projection.name!==k.projection.name)continue;const ce=g.isTileAffectedByFog(re),ye=ae.programConfigurations.get(d.id),ve=g.getOrCreateProgram("heatmap",{config:ye,defines:N,overrideFog:ce}),{zoom:_e}=g.transform;g.terrain&&g.terrain.setupElevationDraw(ie,ve),g.uploadCommonUniforms(b,ve,re.toUnwrapped());const Re=k.projection.createInversionMatrix(k,re.canonical);ve.draw(g,T.TRIANGLES,a.af.disabled,S,C,j,Cb(g,re,ie,Re,G,_e,d.paint.get("heatmap-intensity")),d.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,d.paint,g.transform.zoom,ye,L?[ae.globeExtVertexBuffer]:null)}b.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(b,T){const S=b.context,C=S.gl,k=T.heatmapFbo;if(!k)return;S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,k.colorAttachment.get()),S.activeTexture.set(C.TEXTURE1);let L=T.colorRampTexture;L||(L=T.colorRampTexture=new a.T(S,T.colorRamp,C.RGBA)),L.bind(C.LINEAR,C.CLAMP_TO_EDGE),b.getOrCreateProgram("heatmapTexture").draw(b,C.TRIANGLES,a.af.disabled,a.ah.disabled,b.colorModeForRenderPass(),a.ag.disabled,((N,j,G,q)=>({u_image:0,u_color_ramp:1,u_opacity:j.paint.get("heatmap-opacity")}))(0,T),T.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,T.paint,b.transform.zoom)}(g,d))},line:function(g,l,d,y){if(g.renderPass!=="translucent")return;const b=d.paint.get("line-opacity"),T=d.paint.get("line-width");if(b.constantOr(1)===0||T.constantOr(1)===0)return;const S=d.paint.get("line-emissive-strength"),C=d.paint.get("line-occlusion-opacity"),k=g.context,L=k.gl,N=d.layout.get("line-z-offset"),j=!N.isConstant()||!!N.constantOr(0),G=j?new a.af(g.depthOcclusion?L.GREATER:L.LEQUAL,a.af.ReadOnly,g.depthRangeFor3D):g.depthModeForSublayer(0,a.af.ReadOnly),q=g.colorModeForDrapableLayerRenderPass(S),re=g.terrain&&g.terrain.renderingToTexture,ie=re?1:a.e.devicePixelRatio,ae=d.paint.get("line-dasharray"),ce=ae.constantOr(1),ye=d.layout.get("line-cap"),ve=ae.constantOr(null),_e=ye.constantOr(null),Re=d.paint.get("line-pattern"),Se=Re.constantOr(1),Ie=Re.constantOr(null),ze=d.paint.get("line-opacity").constantOr(1);let Ne=!Se&&ze!==1||g.depthOcclusion&&C>0&&C<1;const qe=d.paint.get("line-gradient"),Fe=Se?"linePattern":"line",Pe=a.bV(d);let Qe;if(re&&g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(Ne=!1),C!==0&&g.depthOcclusion){const Ue=d.paint._values["line-opacity"];Ue&&Ue.value&&Ue.value.kind==="constant"?Qe=Ue.value:a.w(`Occlusion opacity for layer ${d.id} is supported only when line-opacity isn't data-driven.`)}if(j&&(g.forceTerrainMode=!0),!j&&C!==0&&g.terrain&&!re)return void a.w(`Occlusion opacity for layer ${d.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const Xe=Ne&&j?g.stencilModeFor3D():a.ah.disabled;for(const Ue of y){const _t=l.getTile(Ue);if(Se&&!_t.patternsLoaded())continue;const ut=_t.getBucket(d);if(!ut)continue;g.prepareDrawTile();const We=ut.programConfigurations.get(d.id),nt=g.isTileAffectedByFog(Ue),je=g.getOrCreateProgram(Fe,{config:We,defines:j?[...Pe,"ELEVATED"]:Pe,overrideFog:nt});if(Ie&&_t.imageAtlas){const Gt=_t.imageAtlas.patternPositions[Ie.toString()];Gt&&We.setConstantPatternPositions(Gt)}if(!Se&&ve&&_e&&_t.lineAtlas){const Gt=_t.lineAtlas.getDash(ve,_e);Gt&&We.setConstantPatternPositions(Gt)}let[ht,ft]=d.paint.get("line-trim-offset");(_e==="round"||_e==="square")&&ht!==ft&&(ht===0&&(ht-=1),ft===1&&(ft+=1));const Nt=re?Ue.projMatrix:null,Bt=Se?a.bW(g,_t,d,Nt,ie,[ht,ft]):a.bX(g,_t,d,Nt,ut.lineClipsArray.length,ie,[ht,ft]);if(qe){const Gt=ut.gradients[d.id];let Tn=Gt.texture;if(d.gradientVersion!==Gt.version){let Vn=256;if(d.stepInterpolant){const Sn=l.getSource().maxzoom,Zn=Ue.canonical.z===Sn?Math.ceil(1<<g.transform.maxZoom-Ue.canonical.z):1;Vn=a.au(a.bY(ut.maxLineLength/a.a4*1024*Zn),256,k.maxTextureSize)}Gt.gradient=a.bZ({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Vn,image:Gt.gradient||void 0,clips:ut.lineClipsArray}),Gt.texture?Gt.texture.update(Gt.gradient):Gt.texture=new a.T(k,Gt.gradient,L.RGBA),Gt.version=d.gradientVersion,Tn=Gt.texture}k.activeTexture.set(L.TEXTURE1),Tn.bind(d.stepInterpolant?L.NEAREST:L.LINEAR,L.CLAMP_TO_EDGE)}ce&&(k.activeTexture.set(L.TEXTURE0),_t.lineAtlasTexture&&_t.lineAtlasTexture.bind(L.LINEAR,L.REPEAT),We.updatePaintBuffers()),Se&&(k.activeTexture.set(L.TEXTURE0),_t.imageAtlasTexture&&_t.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),We.updatePaintBuffers()),j&&g.terrain.setupElevationDraw(_t,je),g.uploadCommonUniforms(k,je,Ue.toUnwrapped());const on=Gt=>{Qe!=null&&(Qe.value=ze*C),je.draw(g,L.TRIANGLES,G,Gt,q,a.ag.disabled,Bt,d.id,ut.layoutVertexBuffer,ut.indexBuffer,ut.segments,d.paint,g.transform.zoom,We,[ut.layoutVertexBuffer2,ut.patternVertexBuffer,ut.zOffsetVertexBuffer]),Qe!=null&&(Qe.value=ze)};if(Ne&&!j){const Gt=g.stencilModeForClipping(Ue).ref;Gt===0&&re&&k.clear({stencil:0});const Tn={func:L.EQUAL,mask:255};Bt.u_alpha_discard_threshold=.8,on(new a.ah(Tn,Gt,255,L.KEEP,L.KEEP,L.INVERT)),Bt.u_alpha_discard_threshold=0,on(new a.ah(Tn,Gt,255,L.KEEP,L.KEEP,L.KEEP))}else Ne&&j&&(Bt.u_alpha_discard_threshold=.001),on(j?Xe:g.stencilModeForClipping(Ue))}Ne&&(g.resetStencilClippingMasks(),re&&k.clear({stencil:0})),C===0||g.depthOcclusion||re||g.layersWithOcclusionOpacity.push(g.currentLayer),j&&(g.forceTerrainMode=!1)},fill:function(g,l,d,y){const b=d.paint.get("fill-color"),T=d.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const S=d.paint.get("fill-emissive-strength"),C=g.colorModeForDrapableLayerRenderPass(S),k=d.paint.get("fill-pattern"),L=g.opaquePassEnabledForLayer()&&!k.constantOr(1)&&b.constantOr(a.C.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===L){const N=g.depthModeForSublayer(1,g.renderPass==="opaque"?a.af.ReadWrite:a.af.ReadOnly);hp(g,l,d,y,N,C,!1)}if(g.renderPass==="translucent"&&d.paint.get("fill-antialias")){const N=g.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,a.af.ReadOnly);hp(g,l,d,y,N,C,!0)}},"fill-extrusion":function(g,l,d,y){const b=d.paint.get("fill-extrusion-opacity"),T=g.context,S=T.gl,C=g.terrain,k=C&&C.renderingToTexture;if(b===0)return;const L=g.conflationActive&&g.style.isLayerClipped(d,l.getSource()),N=g.style.order.indexOf(d.fqid);if(L&&function(j,G,q,re,ie){for(const ae of re){const ce=G.getTile(ae).getBucket(q);ce&&(ce.updateReplacement(ae,j.replacementSource,ie),ce.uploadCentroid(j.context))}}(g,l,d,y,N),C||L)for(const j of y){const G=l.getTile(j).getBucket(d);G&&hC(g.context,l,j,G,d,C,L)}if(g.renderPass==="shadow"&&g.shadowRenderer){const j=g.shadowRenderer;if(C&&b<.65&&d._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.Z)return;const G=j.getShadowPassDepthMode(),q=j.getShadowPassColorMode();oh(g,l,d,y,G,a.ah.disabled,q,L)}else if(g.renderPass==="translucent"){const j=!d.paint.get("fill-extrusion-pattern").constantOr(1),G=d.paint.get("fill-extrusion-color").constantOr(a.C.white);if(!k&&G.a!==0){const q=new a.af(g.context.gl.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D);b===1&&j?oh(g,l,d,y,q,a.ah.disabled,a.a.unblended,L):(oh(g,l,d,y,q,a.ah.disabled,a.a.disabled,L),oh(g,l,d,y,q,g.stencilModeFor3D(),g.colorModeForRenderPass(),L),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&j&&(!C&&g.transform.projection.name!=="globe"||k)){const q=d.paint.get("fill-extrusion-opacity"),re=d.paint.get("fill-extrusion-ambient-occlusion-intensity"),ie=d.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ae=d.paint.get("fill-extrusion-flood-light-intensity"),ce=d.paint.get("fill-extrusion-flood-light-color").toRenderColor(d.lut).toArray01().slice(0,3),ye=re>0&&ie>0,ve=ae>0,_e=(Se,Ie,ze)=>(1-ze)*Se+ze*Ie,Re=Se=>{const Ie=g.depthModeForSublayer(1,a.af.ReadOnly,S.LEQUAL,!0),ze=d.paint.get(Se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ne=_e(.1,3,ze),qe=g._showOverdrawInspector;if(!qe){const Fe=new a.ah({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Pe=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0],S.MIN);yd(g,l,d,y,Ie,Fe,Pe,a.ag.disabled,Se,"sdf",q,re,ie,ae,ce,Ne,L,!1)}{const Fe=qe?a.ah.disabled:new a.ah({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Pe=qe?g.colorModeForRenderPass():new a.a([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],a.C.transparent,[!0,!0,!0,!0]);yd(g,l,d,y,Ie,Fe,Pe,a.ag.disabled,Se,"color",q,re,ie,ae,ce,Ne,L,!1)}};if(k){const Se=(Ie,ze,Ne)=>{const qe=g.depthModeForSublayer(1,a.af.ReadOnly,S.LEQUAL,!1),Fe=d.paint.get(Ie?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Pe=_e(.1,3,Fe);{const Qe=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0]);yd(g,l,d,y,qe,a.ah.disabled,Qe,a.ag.disabled,Ie,"clear",q,re,ie,ae,ce,Pe,L,ze)}{const Qe=new a.ah({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Xe=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0],S.MIN);yd(g,l,d,y,qe,Qe,Xe,a.ag.disabled,Ie,"sdf",q,re,ie,ae,ce,Pe,L,ze)}{const Qe=Ie?S.ZERO:S.ONE_MINUS_DST_ALPHA,Xe=new a.ah({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Ue=new a.a([Qe,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],a.C.transparent,[!0,!0,!0,!0]);yd(g,l,d,y,qe,Xe,Ue,a.ag.disabled,Ie,"color",q,re,ie,ae,ce,Pe,L,ze)}{const Qe=new a.a([S.ONE,S.ONE,S.ONE,Ie?S.ZERO:S.ONE],a.C.transparent,[!1,!1,!1,!0],Ie?S.FUNC_ADD:S.MAX);yd(g,l,d,y,qe,a.ah.disabled,Qe,a.ag.disabled,Ie,"clear",q,re,ie,ae,ce,Pe,L,ze,Ne)}};if(ye||ve){let Ie;if(g.prepareDrawTile(),C){const ze=C.drapeBufferSize[0],Ne=C.drapeBufferSize[1];Ie=C.framebufferCopyTexture,Ie&&(!Ie||Ie.size[0]===ze&&Ie.size[1]===Ne)||(Ie&&Ie.destroy(),Ie=C.framebufferCopyTexture=new a.T(T,new a.j({width:ze,height:Ne}),S.RGBA)),Ie.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexImage2D(S.TEXTURE_2D,0,S.RGBA,0,0,ze,Ne,0)}ye&&Se(!0,!1,Ie),ve&&Se(!1,!0,Ie)}}else ye&&Re(!0),ve&&Re(!1),(ye||ve)&&g.resetStencilClippingMasks()}}},hillshade:function(g,l,d,y){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const b=g.context,T=g.terrain&&g.terrain.renderingToTexture,[S,C]=g.renderPass!=="translucent"||T?[{},y]:g.stencilConfigForOverlap(y);for(const k of C){const L=l.getTile(k);if(L.needsHillshadePrepare&&g.renderPass==="offscreen")i0(g,L,d);else if(g.renderPass==="translucent"){const N=g.depthModeForSublayer(0,a.af.ReadOnly),j=d.paint.get("hillshade-emissive-strength"),G=g.colorModeForDrapableLayerRenderPass(j),q=T&&g.terrain?g.terrain.stencilModeForRTTOverlap(k):S[k.overscaledZ];Xc(g,k,L,d,N,q,G)}}b.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,l,d,y,b,T){if(g.renderPass!=="translucent"||d.paint.get("raster-opacity")===0)return;const S=g.transform.projection.name==="globe",C=d.paint.get("raster-elevation")!==0,k=C&&S;if(g.renderElevatedRasterBackface&&!k)return;const L=g.context,N=L.gl,j=l.getSource(),G=function(Se,Ie,ze,Ne){const qe=Ie.paint.get("raster-color"),Fe=Se.type==="raster-array",Pe=[],Qe=Ie.paint.get("raster-resampling"),Xe=Ie.paint.get("raster-color-mix");let Ue=Ie.paint.get("raster-color-range");const _t=[Xe[0],Xe[1],Xe[2],0],ut=Xe[3];let We=Qe==="nearest"?Ne.NEAREST:Ne.LINEAR;if(Fe&&(Pe.push("RASTER_ARRAY"),qe||Pe.push("RASTER_COLOR"),Qe==="linear"&&Pe.push("RASTER_ARRAY_LINEAR"),We=Ne.NEAREST,!Ue&&Se.rasterLayers)){const nt=Se.rasterLayers.find(({id:je})=>je===Ie.sourceLayer);nt&&nt.fields&&nt.fields.range&&(Ue=nt.fields.range)}if(Ue=Ue||[0,1],qe){Pe.push("RASTER_COLOR"),ze.activeTexture.set(Ne.TEXTURE2),Ie.updateColorRamp(Ue);let nt=Ie.colorRampTexture;nt||(nt=Ie.colorRampTexture=new a.T(ze,Ie.colorRamp,Ne.RGBA)),nt.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE)}return{mix:_t,range:Ue,offset:ut,defines:Pe,resampling:We}}(j,d,L,N);if(j instanceof a.bo&&!y.length&&!S)return;const q=d.paint.get("raster-emissive-strength"),re=g.colorModeForDrapableLayerRenderPass(q),ie=g.terrain&&g.terrain.renderingToTexture,ae=!g.options.moving,ce=d.paint.get("raster-resampling")==="nearest"?N.NEAREST:N.LINEAR;if(j instanceof a.bo&&!y.length&&(j.onNorthPole||j.onSouthPole)){const Se=C?g.stencilModeFor3D():a.ah.disabled;return void yg(!!j.onNorthPole,null,g,l,d,q,G,a.ag.disabled,Se)}if(!y.length)return;const[ye,ve]=j instanceof a.bo||ie?[{},y]:g.stencilConfigForOverlap(y),_e=ve[ve.length-1].overscaledZ;k&&G.defines.push("PROJECTION_GLOBE_VIEW"),C&&G.defines.push("RENDER_CUTOFF");const Re=(Se,Ie,ze)=>{for(const Ne of Se){const qe=Ne.toUnwrapped(),Fe=l.getTile(Ne);if(ie&&(!Fe||!Fe.hasData()))continue;L.activeTexture.set(N.TEXTURE0);const Pe=ah(Fe,j,d,G);if(!Pe||!Pe.texture)continue;const{texture:Qe,mix:Xe,offset:Ue,tileSize:_t,buffer:ut}=Pe;let We,nt;ie?(We=a.af.disabled,nt=Ne.projMatrix):C?(We=new a.af(N.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D),nt=S?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(qe,ae)):(We=g.depthModeForSublayer(Ne.overscaledZ-_e,d.paint.get("raster-opacity")===1?a.af.ReadWrite:a.af.ReadOnly,N.LESS),nt=g.transform.calculateProjMatrix(qe,ae));const je=g.terrain&&ie?g.terrain.stencilModeForRTTOverlap(Ne):ye[Ne.overscaledZ],ht=T?0:d.paint.get("raster-fade-duration");Fe.registerFadeDuration(ht);const ft=l.findLoadedParent(Ne,0),Nt=Ya(Fe,ft,l,g.transform,ht);let Bt,on;g.terrain&&g.terrain.prepareDrawTile(),L.activeTexture.set(N.TEXTURE0),Qe.bind(ce,N.CLAMP_TO_EDGE),L.activeTexture.set(N.TEXTURE1),ft?(ft.texture&&ft.texture.bind(ce,N.CLAMP_TO_EDGE),Bt=Math.pow(2,ft.tileID.overscaledZ-Fe.tileID.overscaledZ),on=[Fe.tileID.canonical.x*Bt%1,Fe.tileID.canonical.y*Bt%1]):Qe.bind(ce,N.CLAMP_TO_EDGE),Qe.useMipmap&&L.extTextureFilterAnisotropic&&g.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const Gt=g.transform;let Tn;const Vn=C?d0(Gt):[0,0,0,0];let Sn,Zn,pr,ti,Vr,gr=0;if(k&&j instanceof a.bo&&j.coordinates.length>3)Sn=Float32Array.from(a.bh(a.bi(new a.aO(0,0,0)))),Zn=Float32Array.from(Gt.globeMatrix),pr=Float32Array.from(a.bd(Gt)),ti=[a.ak(Gt.center.lng),a.al(Gt.center.lat)],Tn=j.elevatedGlobePerspectiveTransform,Vr=j.elevatedGlobeGridMatrix||new Float32Array(9);else if(k){const $n=a.be(Ne.canonical);gr=a.bf($n.getCenter().lat),Sn=Float32Array.from(a.bh(a.bi(Ne.canonical))),Zn=Float32Array.from(Gt.globeMatrix),pr=Float32Array.from(a.bd(Gt)),ti=[a.ak(Gt.center.lng),a.al(Gt.center.lat)],Tn=[0,0],Vr=Float32Array.from(a.bg(Ne.canonical,$n,gr,Gt.worldSize/Gt._pixelsPerMercatorPixel))}else Tn=j instanceof a.bo?j.perspectiveTransform:[0,0],Sn=new Float32Array(16),Zn=new Float32Array(9),pr=new Float32Array(16),ti=[0,0],Vr=new Float32Array(9);const jr=gg(nt,Sn,Zn,pr,Vr,on||[0,0],a.a2(g.transform.zoom),ti,Vn,Bt||1,Nt,d,Tn,C?d.paint.get("raster-elevation"):0,2,Xe,Ue,G.range,_t,ut,q),Yn=g.isTileAffectedByFog(Ne),nr=g.getOrCreateProgram("raster",{defines:G.defines,overrideFog:Yn});if(g.uploadCommonUniforms(L,nr,qe),j instanceof a.bo){const $n=j.elevatedGlobeVertexBuffer,Tr=j.elevatedGlobeIndexBuffer;if(ie||!S)j.boundsBuffer&&j.boundsSegments&&nr.draw(g,N.TRIANGLES,We,a.ah.disabled,re,a.ag.disabled,jr,d.id,j.boundsBuffer,g.quadTriangleIndexBuffer,j.boundsSegments);else if($n&&Tr){const or=Gt.zoom<=a.b3?j.elevatedGlobeSegments:j.getSegmentsForLongitude(Gt.center.lng);or&&nr.draw(g,N.TRIANGLES,We,a.ah.disabled,re,Ie,jr,d.id,$n,Tr,or)}}else if(k){We=new a.af(N.LEQUAL,a.af.ReadOnly,g.depthRangeFor3D);const $n=g.globeSharedBuffers;if($n){const[Tr,or,kn]=$n.getGridBuffers(gr,!1);nr.draw(g,N.TRIANGLES,We,ze||je,g.colorModeForRenderPass(),Ie,jr,d.id,Tr,or,kn)}}else{const{tileBoundsBuffer:$n,tileBoundsIndexBuffer:Tr,tileBoundsSegments:or}=g.getTileBoundsBuffers(Fe);nr.draw(g,N.TRIANGLES,We,je,re,a.ag.disabled,jr,d.id,$n,Tr,or)}}if(!(j instanceof a.bo)&&k)for(const Ne of Se){const qe=Ne.canonical.y===(1<<Ne.canonical.z)-1;Ne.canonical.y===0&&yg(!0,Ne,g,l,d,q,G,Ie,ze||a.ah.disabled),qe&&yg(!1,Ne,g,l,d,q,G,Ie===a.ag.frontCW?a.ag.backCW:a.ag.frontCW,ze||a.ah.disabled)}};k?Re(ve,g.renderElevatedRasterBackface?a.ag.backCW:a.ag.frontCW,g.stencilModeFor3D()):Re(ve,a.ag.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,l,d,y,b,T){g.renderPass==="offscreen"&&function(S,C,k,L){if(!L.length)return;const N=S.context,j=N.gl,G=C.getSource();if(!(G instanceof R))return;const q=Math.ceil(Math.sqrt(k.paint.get("raster-particle-count")));let re=k.particlePositionRGBAImage;if(!re||re.width!==q){const ve=function(_e){const Re=_e*_e,Se=new Uint8Array(4*Re),Ie=function(Ne){return Ne|=0,Ne=Math.imul(2747636419^Ne,2654435769),Ne=Math.imul(Ne^Ne>>>16,2654435769),((Ne=Math.imul(Ne^Ne>>>16,2654435769))>>>0)/4294967296},ze=1/1.1;for(let Ne=0;Ne<Re;Ne++){const qe=ze*(Ie(2*Ne+0)+Il),Fe=ze*(Ie(2*Ne+1)+Il),Pe=255*qe%1,Qe=255*Fe%1,Xe=Pe,Ue=Fe-Qe/255,_t=Qe;Se[4*Ne+0]=255*(qe-Pe/255),Se[4*Ne+1]=255*Xe,Se[4*Ne+2]=255*Ue,Se[4*Ne+3]=255*_t}return Se}(q);re=k.particlePositionRGBAImage=new a.j({width:q,height:q},ve)}let ie=k.particleFramebuffer;ie?ie.width!==q&&(ie.destroy(),ie=k.particleFramebuffer=N.createFramebuffer(q,q,!0,null)):ie=k.particleFramebuffer=N.createFramebuffer(q,q,!0,null);const ae=[];for(const ve of L){const _e=C.getTile(ve);if(!(_e instanceof a.c5))continue;const Re=zb(_e,G,k);if(!Re)continue;const Se=[_e.tileSize,_e.tileSize];let Ie=k.tileFramebuffer;Ie||(Ie=k.tileFramebuffer=N.createFramebuffer(Se[0],Se[1],!0,null));let ze=_e.rasterParticleState;ze||(ze=_e.rasterParticleState=new gn(N,ve,Se,re));const Ne=ze.update(k.lastInvalidatedAt);ze.particleTextureDimension!==q&&ze.updateParticleTexture(ve,re);const qe=ze.targetColorTexture;ze.targetColorTexture=ze.backgroundColorTexture,ze.backgroundColorTexture=qe;const Fe=ze.particleTexture0;ze.particleTexture0=ze.particleTexture1,ze.particleTexture1=Fe,ae.push([ve,Re,ze,Ne])}if(ae.length===0)return;const ce=a.e.now(),ye=k.previousDrawTimestamp?.001*(ce-k.previousDrawTimestamp):.0167;if(k.previousDrawTimestamp=ce,k.hasColorMap()){N.activeTexture.set(j.TEXTURE0+2);let ve=k.colorRampTexture;ve||(ve=k.colorRampTexture=new a.T(N,k.colorRamp,j.RGBA)),ve.bind(j.LINEAR,j.CLAMP_TO_EDGE)}N.bindFramebuffer.set(k.tileFramebuffer.framebuffer),function(ve,_e,Re){const Se=ve.context,Ie=Se.gl,ze=_e.tileFramebuffer;Se.activeTexture.set(Ie.TEXTURE0);const Ne={u_texture:0,u_opacity:1.05*(Fe=_e.paint.get("raster-particle-fade-opacity-factor"))/(Fe+.05)},qe=ve.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Fe;for(const Pe of Re){const[,,Qe,Xe]=Pe;ze.colorAttachment.set(Qe.targetColorTexture.texture),Se.viewport.set([0,0,ze.width,ze.height]),Se.clear({color:a.C.transparent}),Xe&&(Qe.backgroundColorTexture.bind(Ie.NEAREST,Ie.CLAMP_TO_EDGE),qe.draw(ve,Ie.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.alphaBlended,a.ag.disabled,Ne,_e.id,ve.viewportBuffer,ve.quadTriangleIndexBuffer,ve.viewportSegments))}}(S,k,ae),function(ve,_e,Re,Se){const Ie=ve.context,ze=Ie.gl,Ne=Re.tileFramebuffer,qe=ve.transform.projection.name==="globe",Fe=Re.paint.get("raster-particle-max-speed");for(const Pe of Se){const[Qe,Xe,Ue]=Pe;Ie.activeTexture.set(ze.TEXTURE0+0),Xe.texture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Ne.colorAttachment.set(Ue.targetColorTexture.texture);const _t=ve.getOrCreateProgram("rasterParticleDraw",{defines:Xe.defines,overrideFog:!1});Ie.activeTexture.set(ze.TEXTURE0+1);const ut=Xe.scalarData?[]:[0,1,2,3].map(je=>a.b$[je](Qe));ut.push(Qe);const We=Qe.canonical.x,nt=Qe.canonical.y;for(const je of ut){const ht=_e.getTile(qe?je.wrapped():je);if(!ht)continue;const ft=ht.rasterParticleState;if(!ft)continue;const Nt=je.canonical.x+(1<<je.canonical.z)*(je.wrap-Qe.wrap),Bt=je.canonical.y;ft.particleTexture0.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);const on=lC(1,ft.particleTexture0.size[0],[Nt-We,Bt-nt],0,Xe.texture.size,2,Fe,Xe.textureOffset,Xe.scale,Xe.offset);_t.draw(ve,ze.POINTS,a.af.disabled,a.ah.disabled,a.a.alphaBlended,a.ag.disabled,on,Re.id,ft.particleIndexBuffer,void 0,ft.particleSegment)}}}(S,C,k,ae),N.bindFramebuffer.set(k.particleFramebuffer.framebuffer),function(ve,_e,Re,Se){const Ie=ve.context,ze=Ie.gl,Ne=_e.paint.get("raster-particle-max-speed"),qe=Se*_e.paint.get("raster-particle-speed-factor")*.15,Fe=function(Qe){return Math.pow(Qe,6)}(.01+1*_e.paint.get("raster-particle-reset-rate-factor")),Pe=_e.particleFramebuffer;Ie.viewport.set([0,0,Pe.width,Pe.height]);for(const Qe of Re){const[,Xe,Ue]=Qe;Ie.activeTexture.set(ze.TEXTURE0+0),Xe.texture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Ie.activeTexture.set(ze.TEXTURE0+1);const _t=Ue.particleTexture0;_t.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);const ut=Pb(1,_t.size[0],0,Xe.texture.size,Ne,qe,Fe,Xe.textureOffset,Xe.scale,Xe.offset);Pe.colorAttachment.set(Ue.particleTexture1.texture),Ie.clear({color:a.C.transparent}),ve.getOrCreateProgram("rasterParticleUpdate",{defines:Xe.defines}).draw(ve,ze.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.unblended,a.ag.disabled,ut,_e.id,ve.viewportBuffer,ve.quadTriangleIndexBuffer,ve.viewportSegments)}}(S,k,ae,ye)}(g,l,d,y),g.renderPass==="translucent"&&(function(S,C,k,L,N){const j=S.context,G=j.gl,q=C.getSource().tileSize,re=5*(1-a.a0(a.aV,a.aV+1,S.transform.zoom))*q+k.paint.get("raster-particle-elevation"),ie=!S.options.moving,ae=S.transform.projection.name==="globe";if(!L.length)return;const[ce,ye]=S.stencilConfigForOverlap(L),ve=[];ae&&ve.push("PROJECTION_GLOBE_VIEW");const _e=S.stencilModeFor3D();for(const Re of ye){const Se=Re.toUnwrapped(),Ie=C.getTile(Re);if(!Ie.rasterParticleState)continue;const ze=Ie.rasterParticleState,Ne=100;Ie.registerFadeDuration(Ne);const qe=C.findLoadedParent(Re,0),Fe=Ya(Ie,qe,C,S.transform,Ne);let Pe,Qe;S.terrain&&S.terrain.prepareDrawTile(),j.activeTexture.set(G.TEXTURE0),ze.targetColorTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),j.activeTexture.set(G.TEXTURE1),qe&&qe.rasterParticleState?(qe.rasterParticleState.targetColorTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Pe=Math.pow(2,qe.tileID.overscaledZ-Ie.tileID.overscaledZ),Qe=[Ie.tileID.canonical.x*Pe%1,Ie.tileID.canonical.y*Pe%1]):ze.targetColorTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const Xe=ae?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(Se,ie),Ue=S.transform,_t=vg(Ue),ut=a.be(Re.canonical),We=a.bf(ut.getCenter().lat);let nt,je,ht,ft,Nt;ae?(nt=Float32Array.from(a.bh(a.bi(Re.canonical))),je=Float32Array.from(Ue.globeMatrix),ht=Float32Array.from(a.bd(Ue)),ft=[a.ak(Ue.center.lng),a.al(Ue.center.lat)],Nt=Float32Array.from(a.bg(Re.canonical,ut,We,Ue.worldSize/Ue._pixelsPerMercatorPixel))):(nt=new Float32Array(16),je=new Float32Array(9),ht=new Float32Array(16),ft=[0,0],Nt=new Float32Array(9));const Bt=rh(Xe,nt,je,ht,Nt,Qe||[0,0],a.a2(S.transform.zoom),ft,_t,Pe||1,Fe,re),on=S.isTileAffectedByFog(Re),Gt=S.getOrCreateProgram("rasterParticle",{defines:ve,overrideFog:on});if(S.uploadCommonUniforms(j,Gt,Se),ae){const Tn=new a.af(G.LEQUAL,a.af.ReadOnly,S.depthRangeFor3D),Vn=0,Sn=S.globeSharedBuffers;if(Sn){const[Zn,pr,ti]=Sn.getGridBuffers(We,Vn!==0);Gt.draw(S,G.TRIANGLES,Tn,_e,a.a.alphaBlended,S.renderElevatedRasterBackface?a.ag.frontCCW:a.ag.backCCW,Bt,k.id,Zn,pr,ti)}}else{const Tn=S.depthModeForSublayer(0,a.af.ReadOnly),Vn=ce[Re.overscaledZ],{tileBoundsBuffer:Sn,tileBoundsIndexBuffer:Zn,tileBoundsSegments:pr}=S.getTileBoundsBuffers(Ie);Gt.draw(S,G.TRIANGLES,Tn,Vn,a.a.alphaBlended,a.ag.disabled,Bt,k.id,Sn,Zn,pr)}}S.resetStencilClippingMasks()}(g,l,d,y),g.style.map.triggerRepaint())},background:function(g,l,d,y){const b=d.paint.get("background-color"),T=d.paint.get("background-opacity"),S=d.paint.get("background-emissive-strength");if(T===0)return;const C=g.context,k=C.gl,L=g.transform,N=L.tileSize,j=d.paint.get("background-pattern");let G;if(j!==void 0&&(j===null||(G=g.imageManager.getPattern(j.toString(),d.scope,g.style.getLut(d.scope)),!G)))return;const q=!j&&b.a===1&&T===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==q)return;const re=a.ah.disabled,ie=g.depthModeForSublayer(0,q==="opaque"?a.af.ReadWrite:a.af.ReadOnly),ae=g.colorModeForDrapableLayerRenderPass(S),ce=j?"backgroundPattern":"background";let ye,ve=y;ve||(ye=g.getBackgroundTiles(),ve=Object.values(ye).map(_e=>_e.tileID)),j&&(C.activeTexture.set(k.TEXTURE0),g.imageManager.bind(g.context,d.scope));for(const _e of ve){const Re=g.isTileAffectedByFog(_e),Se=g.getOrCreateProgram(ce,{overrideFog:Re}),Ie=_e.toUnwrapped(),ze=y?_e.projMatrix:g.transform.calculateProjMatrix(Ie);g.prepareDrawTile();const Ne=l?l.getTile(_e):ye?ye[_e.key]:new a.bA(_e,N,L.zoom,g),qe=j?cC(ze,S,T,g,0,d.scope,G,{tileID:_e,tileSize:N}):l0(ze,S,T,b.toRenderColor(d.lut));g.uploadCommonUniforms(C,Se,Ie);const{tileBoundsBuffer:Fe,tileBoundsIndexBuffer:Pe,tileBoundsSegments:Qe}=g.getTileBoundsBuffers(Ne);Se.draw(g,k.TRIANGLES,ie,re,ae,a.ag.disabled,qe,d.id,Fe,Pe,Qe)}},sky:function(g,l,d){const y=g._atmosphere?a.a2(g.transform.zoom):1,b=d.paint.get("sky-opacity")*y;if(b===0)return;const T=g.context,S=d.paint.get("sky-type"),C=new a.af(T.gl.LEQUAL,a.af.ReadOnly,[0,1]),k=g.frameCounter/1e3%1;S==="atmosphere"?g.renderPass==="offscreen"?d.needsSkyboxCapture(g)&&(function(L,N,j,G){const q=L.context,re=q.gl;let ie=N.skyboxFbo;if(!ie){ie=N.skyboxFbo=q.createFramebuffer(32,32,!0,null),N.skyboxGeometry=new tn(q),N.skyboxTexture=q.gl.createTexture(),re.bindTexture(re.TEXTURE_CUBE_MAP,N.skyboxTexture),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MAG_FILTER,re.LINEAR);for(let ve=0;ve<6;++ve)re.texImage2D(re.TEXTURE_CUBE_MAP_POSITIVE_X+ve,0,re.RGBA,32,32,0,re.RGBA,re.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(ie.framebuffer),q.viewport.set([0,0,32,32]);const ae=N.getCenter(L,!0),ce=L.getOrCreateProgram("skyboxCapture"),ye=new Float64Array(16);a.ae.identity(ye),a.ae.rotateY(ye,ye,.5*-Math.PI),xr(L,N,ce,ye,ae,0),a.ae.identity(ye),a.ae.rotateY(ye,ye,.5*Math.PI),xr(L,N,ce,ye,ae,1),a.ae.identity(ye),a.ae.rotateX(ye,ye,.5*-Math.PI),xr(L,N,ce,ye,ae,2),a.ae.identity(ye),a.ae.rotateX(ye,ye,.5*Math.PI),xr(L,N,ce,ye,ae,3),a.ae.identity(ye),xr(L,N,ce,ye,ae,4),a.ae.identity(ye),a.ae.rotateY(ye,ye,Math.PI),xr(L,N,ce,ye,ae,5),q.viewport.set([0,0,L.width,L.height])}(g,d),d.markSkyboxValid(g)):g.renderPass==="sky"&&function(L,N,j,G,q){const re=L.context,ie=re.gl,ae=L.transform,ce=L.getOrCreateProgram("skybox");re.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_CUBE_MAP,N.skyboxTexture);const ye=((ve,_e,Re,Se,Ie)=>({u_matrix:ve,u_sun_direction:_e,u_cubemap:0,u_opacity:Se,u_temporal_offset:Ie}))(ae.skyboxMatrix,N.getCenter(L,!1),0,G,q);L.uploadCommonUniforms(re,ce),ce.draw(L,ie.TRIANGLES,j,a.ah.disabled,L.colorModeForRenderPass(),a.ag.backCW,ye,"skybox",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(g,d,C,b,k):S==="gradient"&&g.renderPass==="sky"&&function(L,N,j,G,q){const re=L.context,ie=re.gl,ae=L.transform,ce=L.getOrCreateProgram("skyboxGradient");N.skyboxGeometry||(N.skyboxGeometry=new tn(re)),re.activeTexture.set(ie.TEXTURE0);let ye=N.colorRampTexture;ye||(ye=N.colorRampTexture=new a.T(re,N.colorRamp,ie.RGBA)),ye.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const ve=((_e,Re,Se,Ie,ze)=>({u_matrix:_e,u_color_ramp:0,u_center_direction:Re,u_radius:a.ac(Se),u_opacity:Ie,u_temporal_offset:ze}))(ae.skyboxMatrix,N.getCenter(L,!1),N.paint.get("sky-gradient-radius"),G,q);L.uploadCommonUniforms(re,ce),ce.draw(L,ie.TRIANGLES,j,a.ah.disabled,L.colorModeForRenderPass(),a.ag.backCW,ve,"skyboxGradient",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(g,d,C,b,k)},debug:function(g,l,d,y,b,T){for(let S=0;S<d.length;S++)if(b){const L=new a.C(y.r*.8,y.g*.8,y.b*.8,1);En(g,l,d[S],y,-1,-1,T),En(g,l,d[S],y,-1,1,T),En(g,l,d[S],y,1,1,T),En(g,l,d[S],y,1,-1,T),En(g,l,d[S],L,0,0,T)}else En(g,l,d[S],y,0,0,T)},custom:function(g,l,d,y){const b=g.context,T=d.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&d.isDraped(l)){if(g.renderPass==="offscreen"){const S=T.prerender;if(S){if(g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const C=g.transform.pointMerc;S.call(T,b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),a.a2(g.transform.zoom),[C.x,C.y],g.transform.pixelsPerMeterRatio)}else S.call(T,b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const C=T.renderToTile;if(C){const k=y[0].canonical,L=new a._(k.x+y[0].wrap*(1<<k.z),k.y,k.z);b.setDepthMode(a.af.disabled),b.setStencilMode(a.ah.disabled),b.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),C.call(T,b.gl,L),b.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),b.setStencilMode(a.ah.disabled);const S=T.renderingMode==="3d"?new a.af(g.context.gl.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,a.af.ReadOnly);if(b.setDepthMode(S),g.transform.projection.name==="globe"){const C=g.transform.pointMerc;T.render(b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),a.a2(g.transform.zoom),[C.x,C.y],g.transform.pixelsPerMeterRatio)}else T.render(b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState(),b.bindFramebuffer.set(null)}}else a.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,l,d,y){if(g.renderPass==="opaque")return;const b=d.paint.get("model-opacity");if(b===0)return;const T=d.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!T||g.terrain&&b<.65&&d._transitionablePaint._values["model-opacity"].value.expression instanceof a.Z))return;const S=g.shadowRenderer,C=d.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,C||(S.enabled=!1));const k=()=>{S&&(S.useNormalOffset=!0,C||(S.enabled=!0))},L=l.getSource();if(g.renderPass==="light-beam"&&L.type!=="batched-model")return;if(L.type==="vector"||L.type==="geojson")return function(ce,ye,ve,_e,Re){const Se=ce.transform;if(Se.projection.name!=="mercator")return void a.w(`Drawing 3D models for ${Se.projection.name} projection is not yet implemented`);const Ie=Se.getFreeCameraOptions().position;if(!ce.modelManager)return;const ze=ce.modelManager;ve.modelManager=ze;const Ne=ce.shadowRenderer;if(!ve._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const qe=ve._unevaluatedLayout._values["model-id"],Fe={...ve.layout.get("model-id").parameters},Pe=ce.style.order.indexOf(ve.fqid);for(const Qe of _e){const Xe=ye.getTile(Qe).getBucket(ve);if(!Xe||Xe.projection.name!==Se.projection.name)continue;const Ue=Xe.getModelUris();Ue&&!Xe.modelsRequested&&(ze.addModelsFromBucket(Ue,Re),Xe.modelsRequested=!0);const _t=mp(Qe,Se);Fe.zoom=_t;const ut=qe.possiblyEvaluate(Fe);if(pp(ce,Xe,Qe),Pa.shadowUniformsInitialized=!1,Pa.useSingleShadowCascade=!!Ne&&Ne.getMaxCascadeForTile(Qe.toUnwrapped())===0,ce.renderPass==="shadow"&&Ne){if(ce.currentShadowCascade===1&&Xe.isInsideFirstShadowMapFrustum)continue;const je=Se.calculatePosMatrix(Qe.toUnwrapped(),Se.worldSize);if(Pa.tileMatrix.set(je),Pa.shadowTileMatrix=Float32Array.from(Ne.calculateShadowPassMatrixFromMatrix(je)),Pa.aabb.min.fill(0),Pa.aabb.max[0]=Pa.aabb.max[1]=a.a4,Pa.aabb.max[2]=0,vo(Xe,Pa,ce,ve.scope))continue}const We=1<<Qe.canonical.z,nt=[((Ie.x-Qe.wrap)*We-Qe.canonical.x)*a.a4,(Ie.y*We-Qe.canonical.y)*a.a4,Ie.z*We*a.a4];ce.conflationActive&&Object.keys(Xe.instancesPerModel).length>0&&ce.style.isLayerClipped(ve,ye.getSource())&&Xe.updateReplacement(Qe,ce.replacementSource,Pe,Re)&&(Xe.uploaded=!1,Xe.upload(ce.context));for(let je in Xe.instancesPerModel){const ht=Xe.instancesPerModel[je];ht.features.length>0&&(je=ut.evaluate(ht.features[0].feature,{}));const ft=ze.getModel(je,Re);if(ft&&ft.uploaded)for(const Nt of ft.nodes)wg(ce,ve,Nt,ht,nt,Qe,Pa)}}}(g,l,d,y,L.type==="vector"?d.scope:""),void k();if(!L.loaded())return;if(L.type==="batched-model")return function(ce,ye,ve,_e){ve.resetLayerRenderingStats(ce);const Re=ce.context,Se=ce.transform,Ie=ce.style.fog,ze=ce.shadowRenderer;if(Se.projection.name!=="mercator")return void a.w(`Drawing 3D landmark models for ${Se.projection.name} projection is not yet implemented`);const Ne=ce.transform.getFreeCameraOptions().position,qe=a.$.scale([],[Ne.x,Ne.y,Ne.z],ce.transform.worldSize);a.$.negate(qe,qe);const Fe=a.ae.identity([]),Pe=a.ci(Se.center.lat,Se.zoom),Qe=a.ae.fromScaling([],[1,1,1/Pe]);a.ae.translate(Fe,Fe,qe);const Xe=ve.paint.get("model-opacity"),Ue=new a.af(Re.gl.LEQUAL,a.af.ReadWrite,ce.depthRangeFor3D),_t=new a.af(Re.gl.LEQUAL,a.af.ReadOnly,ce.depthRangeFor3D),ut=new a.b8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),We=ce.renderPass==="shadow",nt=We&&ze?ze.getCurrentCascadeFrustum():Se.getFrustum(Se.scaleZoom(Se.worldSize)),je=ve.paint.get("model-front-cutoff"),ht=je[2]<1,ft=Fs(ce,ve.paint.get("model-cutoff-fade-range")),Nt=ve.getLayerRenderingStats();(function(Bt,on,Gt,Tn){const Vn=Bt.terrain?Bt.terrain.exaggeration():0,Sn=Bt.transform.zoom;for(const Zn of Tn){const pr=on.getTile(Zn).getBucket(Gt);pr&&(Bt.conflationActive&&pr.updateReplacement(Zn,Bt.replacementSource),pr.evaluateScale(Bt,Gt),Bt.terrain&&Vn>0&&pr.elevationUpdate(Bt.terrain,Vn,Zn,Gt.source),pr.needsReEvaluation(Bt,Sn,Gt)&&pr.evaluate(Gt))}})(ce,ye,ve,_e),function(){let Bt,on,Gt;ht?(Bt=_e.length-1,on=-1,Gt=-1):(Bt=0,on=_e.length,Gt=1);for(let Tn=Bt;Tn!==on;Tn+=Gt){const Vn=_e[Tn],Sn=ye.getTile(Vn).getBucket(ve);if(!Sn||!Sn.uploaded)continue;let Zn=!1;ze&&(Zn=ze.getMaxCascadeForTile(Vn.toUnwrapped())===0);const pr=Se.calculatePosMatrix(Vn.toUnwrapped(),Se.worldSize),ti=Sn.modelTraits,Vr=[];for(const gr of Sn.getNodesInfo()){if(gr.hiddenByReplacement||!gr.node.meshes)continue;const jr=gr.node;let Yn=0;ce.terrain&&jr.elevation&&(Yn=jr.elevation*ce.terrain.exaggeration());const nr=gr.evaluatedScale;if(nr[0]<=1&&nr[1]<=1&&nr[2]<=1&&(()=>{const Hs=gr.aabb;return ut.min=[...Hs.min],ut.max=[...Hs.max],ut.min[2]+=Yn,ut.max[2]+=Yn,a.$.transformMat4(ut.min,ut.min,pr),a.$.transformMat4(ut.max,ut.max,pr),ut})().intersects(nt)===0)continue;const $n=[...pr],Tr=jr.anchor?jr.anchor[0]:0,or=jr.anchor?jr.anchor[1]:0;a.ae.translate($n,$n,[Tr*(nr[0]-1),or*(nr[1]-1),Yn]),a.$.exactEquals(nr,a.cl)||a.ae.scale($n,$n,nr);const kn=a.ae.multiply([],$n,jr.matrix),Gi=a.ae.multiply([],Se.expandedFarZProjMatrix,kn),qi=a.ae.multiply([],Se.expandedFarZProjMatrix,$n),ao=a.aB.transformMat4([],[Tr,or,Yn,1],Gi)[2];jr.hidden=!1;let lo=Xe;We||(ht&&(lo*=Nb($n,Se,gr.aabb,je)),lo*=ua(ft,ao)),lo!==0?Vr.push({nodeInfo:gr,depth:ao,opacity:lo,wvpForNode:Gi,wvpForTile:qi,nodeModelMatrix:kn,tileModelMatrix:$n}):jr.hidden=!0}We||Vr.sort((gr,jr)=>!ht||gr.opacity===1&&jr.opacity===1?gr.depth<jr.depth?-1:1:gr.opacity===1?-1:jr.opacity===1?1:gr.depth>jr.depth?-1:1);for(const gr of Vr){const jr=gr.nodeInfo,Yn=jr.node;let nr=a.ae.multiply([],Qe,gr.tileModelMatrix);a.ae.multiply(nr,Fe,nr);const $n=a.ae.invert([],nr);a.ae.transpose($n,$n),a.ae.scale($n,$n,Tg),nr=a.ae.multiply(nr,nr,Yn.matrix);const Tr=ce.renderPass==="light-beam",or=ti&a.cn.HasMapboxMeshFeatures,kn=or?0:jr.evaluatedRMEA[0][2];for(let Gi=0;Gi<Yn.meshes.length;++Gi){const qi=Yn.meshes[Gi],ao=Gi===Yn.lightMeshIndex;let lo=gr.wvpForNode;if(ao){if(!Tr&&!ce.terrain&&ce.shadowRenderer){ce.currentLayer<ce.firstLightBeamLayer&&(ce.firstLightBeamLayer=ce.currentLayer);continue}lo=gr.wvpForTile}else if(Tr)continue;const Hs={defines:[]},co=[];if(lh(Hs.defines,co,qi,ce,ve.lut),or||Hs.defines.push("DIFFUSE_SHADED"),Zn&&Hs.defines.push("SHADOWS_SINGLE_CASCADE"),Nt&&(We?Nt.numRenderedVerticesInShadowPass+=qi.vertexArray.length:Nt.numRenderedVerticesInTransparentPass+=qi.vertexArray.length),We){_0(qi,gr.nodeModelMatrix,ce,ve);continue}let Bs=null;if(Ie){const Ke=bd(gr.nodeModelMatrix,ce.transform);if(Bs=new Float32Array(Ke),Se.projection.name!=="globe"){const _c=qi.aabb.min,el=qi.aabb.max,[yc,vc]=Ie.getOpacityForBounds(Ke,_c[0],_c[1],el[0],el[1]);Hs.overrideFog=yc>=vr||vc>=vr}}const Zs=qi.material;let xt;Zs.occlusionTexture&&Zs.occlusionTexture.offsetScale&&(xt=Zs.occlusionTexture.offsetScale,Hs.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!We&&ze&&(ze.useNormalOffset=!!qi.normalBuffer);const ln=ce.getOrCreateProgram("model",Hs);!We&&ze&&ze.setupShadowsFromMatrix(gr.tileModelMatrix,ln,ze.useNormalOffset),ce.uploadCommonUniforms(Re,ln,null,Bs);const xo=Zs.pbrMetallicRoughness;xo.metallicFactor=.9,xo.roughnessFactor=.5;const Zr=ih(new Float32Array(lo),new Float32Array(nr),new Float32Array($n),new Float32Array(Yn.matrix),ce,gr.opacity,xo.baseColorFactor.toRenderColor(null),Zs.emissiveFactor,xo.metallicFactor,xo.roughnessFactor,Zs,kn,ve,[0,0,0],xt);!ao&&(jr.hasTranslucentParts||gr.opacity<1)&&ln.draw(ce,Re.gl.TRIANGLES,Ue,a.ah.disabled,a.a.disabled,a.ag.backCCW,Zr,ve.id,qi.vertexBuffer,qi.indexBuffer,qi.segments,ve.paint,ce.transform.zoom,void 0,co),ln.draw(ce,Re.gl.TRIANGLES,ao?_t:Ue,a.ah.disabled,ao||gr.opacity<1||jr.hasTranslucentParts?a.a.alphaBlended:a.a.unblended,a.ag.backCCW,Zr,ve.id,qi.vertexBuffer,qi.indexBuffer,qi.segments,ve.paint,ce.transform.zoom,void 0,co)}}}}()}(g,l,d,y),void k();if(L.type!=="model")return;const N=L.getModels(),j=[],G=g.transform.getFreeCameraOptions().position,q=a.$.scale([],[G.x,G.y,G.z],g.transform.worldSize);a.$.negate(q,q);const re=[],ie=[];let ae=0;for(const ce of N){const ye=d.paint.get("model-rotation").constantOr(null),ve=d.paint.get("model-scale").constantOr(null),_e=d.paint.get("model-translation").constantOr(null);ce.computeModelMatrix(g,ye,ve,_e,!0,!0,!1);const Re=a.ae.identity([]),Se=a.ci(ce.position.lat,g.transform.zoom),Ie=a.ae.fromScaling([],[1,1,1/Se]);a.ae.translate(Re,Re,q),j.push({zScaleMatrix:Ie,negCameraPosMatrix:Re});for(const ze of ce.nodes)Ni(g.transform,ze,ce.matrix,g.transform.expandedFarZProjMatrix,ae,re,ie);ae++}if(re.sort((ce,ye)=>ye.depth-ce.depth),g.renderPass!=="shadow"){if(b===1)for(const ce of ie)so(ce,g,d,j[ce.modelIndex],a.ah.disabled,g.colorModeForRenderPass());else{for(const ce of ie)so(ce,g,d,j[ce.modelIndex],a.ah.disabled,a.a.disabled);for(const ce of ie)so(ce,g,d,j[ce.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}for(const ce of re)so(ce,g,d,j[ce.modelIndex],a.ah.disabled,g.colorModeForRenderPass());k()}else{for(const ce of ie)_0(ce.mesh,ce.nodeModelMatrix,g,d);for(const ce of re)_0(ce.mesh,ce.nodeModelMatrix,g,d);k()}}},bs={model:function(g,l,d){const y=l.getSource();if(!y.loaded())return;if(y.type==="vector"||y.type==="geojson")return void(d.modelManager&&d.modelManager.upload(d,y.type==="vector"?g.scope:""));if(y.type==="batched-model"||y.type!=="model")return;const b=y.getModels();for(const T of b)T.upload(d.context)},raster:function(g,l,d){const y=l.getSource();if(!(y instanceof R&&y.loaded()))return;const b=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!b)return;const T=g.paint.get("raster-array-band")||y.getInitialBand(b);if(T==null)return;const S=l.getIds().map(C=>l.getTileByID(C));for(const C of S)C.updateNeeded(b,T)&&y.prepareTile(C,b,T)},"raster-particle":function(g,l,d){const y=l.getSource();if(!(y instanceof R&&y.loaded()))return;const b=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!b)return;const T=g.paint.get("raster-particle-array-band")||y.getInitialBand(b);if(T==null)return;const S=l.getIds().map(C=>l.getTileByID(C));for(const C of S)C.updateNeeded(b,T)&&y.prepareTile(C,b,T)}};class y0{constructor(l,d,y,b){this.context=new Pn(l,d),this.transform=y,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=a.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const C of T)this._debugParams.enabledLayers[C]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const C of T)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],C);this.occlusionParams=new Qa(b),this.setup(),this.numSublayers=a.bx.maxUnderzooming+a.bx.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.cp,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new dg(this),this._wireframeDebugCache=new fs,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const S=new a.j({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new a.T(this.context,S,l.RGBA)}updateTerrain(l,d){const y=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new rn(this,l));const b=this._terrain;this.transform.elevation=y?b:null,b.update(l,this.transform,d),this.transform.elevation&&!b.enabled&&(this.transform.elevation=null)}_updateFog(l){const d=l.fog;if(!d||this.transform.projection.name==="globe"||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,b]=d.getFovAdjustedRange(this.transform._fov);if(y>b)return void(this.transform.fogCullDistSq=null);const T=y+.78*(b-y);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(l){l&&!this._terrain&&(this._terrain=new rn(this,this.style)),this._forceTerrainMode=l}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(l,d){if(this.width=l*a.e.devicePixelRatio,this.height=d*a.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._mergedLayers[y].resize()}setup(){const l=this.context,d=new a.bv;d.emplaceBack(0,0),d.emplaceBack(a.a4,0),d.emplaceBack(0,a.a4),d.emplaceBack(a.a4,a.a4),this.tileExtentBuffer=l.createVertexBuffer(d,a.bt.members),this.tileExtentSegments=a.b.simpleSegment(0,0,4,2);const y=new a.bv;y.emplaceBack(0,0),y.emplaceBack(a.a4,0),y.emplaceBack(0,a.a4),y.emplaceBack(a.a4,a.a4),this.debugBuffer=l.createVertexBuffer(y,a.bt.members),this.debugSegments=a.b.simpleSegment(0,0,4,5);const b=new a.bv;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(b,a.bt.members),this.viewportSegments=a.b.simpleSegment(0,0,4,2);const T=new a.cq;T.emplaceBack(0,0,0,0),T.emplaceBack(a.a4,0,a.a4,0),T.emplaceBack(0,a.a4,0,a.a4),T.emplaceBack(a.a4,a.a4,a.a4,a.a4),this.mercatorBoundsBuffer=l.createVertexBuffer(T,a.cr.members),this.mercatorBoundsSegments=a.b.simpleSegment(0,0,4,2);const S=new a.bw;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(S);const C=new a.cs;for(const L of[0,1,3,2,0])C.emplaceBack(L);this.debugIndexBuffer=l.createIndexBuffer(C),this.emptyTexture=new a.T(l,new a.j({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=a.ae.create();const k=this.context.gl;this.stencilClearMode=new a.ah({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,l.TRIANGLES,a.af.disabled,this.stencilClearMode,a.a.disabled,a.ag.disabled,iu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,d,y){if(!d||this.currentStencilSource===d.id||!l.isTileClipped()||!y||y.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const k of y)if(this._tileClippingMaskIDs[k.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=d.id;const b=this.context,T=b.gl;this.nextStencilID+y.length>256&&this.clearStencil(),b.setColorMode(a.a.disabled),b.setDepthMode(a.af.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of y){const k=d.getTile(C),L=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:N,tileBoundsIndexBuffer:j,tileBoundsSegments:G}=this.getTileBoundsBuffers(k);S.draw(this,T.TRIANGLES,a.af.disabled,new a.ah({func:T.ALWAYS,mask:0},L,255,T.KEEP,T.KEEP,T.REPLACE),a.a.disabled,a.ag.disabled,iu(C.projMatrix),"$clipping",N,j,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,d=this.context.gl;return new a.ah({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const d=this.context.gl;return new a.ah({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(l){const d=this.context.gl,y=l.sort((S,C)=>C.overscaledZ-S.overscaledZ),b=y[y.length-1].overscaledZ,T=y[0].overscaledZ-b+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const S={};for(let C=0;C<T;C++)S[C+b]=new a.ah({func:d.GEQUAL,mask:255},C+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=T,[S,y]}return[{[b]:a.ah.disabled},y]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new a.a([l.CONSTANT_COLOR,l.ONE,l.CONSTANT_COLOR,l.ONE],new a.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.a.unblended:a.a.alphaBlended}colorModeForDrapableLayerRenderPass(l){const d=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new a.a([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.CONSTANT_ALPHA,d.ONE_MINUS_SRC_ALPHA],new a.C(0,0,0,l===void 0?0:l),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(l,d,y,b=!1){if(this.depthOcclusion)return new a.af(this.context.gl.GREATER,a.af.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!b)return a.af.disabled;const T=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new a.af(y||this.context.gl.LEQUAL,d,[T,T])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const l=this.context.gl,d=Math.ceil(this.width),y=Math.ceil(this.height),b=this.context.bindFramebuffer.get(),T=l.getParameter(l.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===d&&this.depthFBO.height===y||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),d!==0&&y!==0&&(this.depthFBO=new bn(this.context,d,y,!1,"texture"),this.depthTexture=new a.T(this.context,{width:d,height:y,data:null},l.DEPTH_STENCIL),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(b),l.bindTexture(l.TEXTURE_2D,T),this.depthFBO&&(l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),l.blitFramebuffer(0,0,d,y,0,0,d,y,l.DEPTH_BUFFER_BIT,l.NEAREST),l.bindFramebuffer(l.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((l,d)=>l+d/this._fpsHistory.length,0))}render(l,d){const y=a.e.now();this._dt=y-this._timeStamp,this._timeStamp=y,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=l.map.repaint,this.style=l,this.options=d;const b=this.style._mergedLayers,T=this.style.order.filter(Fe=>{const Pe=b[Fe];return!(Pe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Pe.type]});let S=!1,C=!1;for(const Fe of T){const Pe=b[Fe];Pe.type==="circle"&&(S=!0),Pe.type==="symbol"&&(Pe.hasInitialOcclusionOpacityProperties?C=!0:S=!0)}const k=T.map(Fe=>b[Fe]),L=this.style._mergedSourceCaches;this.imageManager=l.imageManager,this.modelManager=l.modelManager,this.symbolFadeChange=l.placement.symbolFadeChange(a.e.now()),this.imageManager.beginFrame();let N=0,j=!1;for(const Fe in L){const Pe=L[Fe];Pe.used&&(Pe.prepare(this.context),Pe.getSource().usedInConflation&&++N)}let G=!1;for(const Fe of k)Fe.isHidden(this.transform.zoom)||(Fe.type==="clip"&&(G=!0),this.prepareLayer(Fe));const q={},re={},ie={},ae={},ce={};for(const Fe in L){const Pe=L[Fe];q[Fe]=Pe.getVisibleCoordinates(),re[Fe]=q[Fe].slice().reverse(),ie[Fe]=Pe.getVisibleCoordinates(!0).reverse(),ae[Fe]=Pe.getShadowCasterCoordinates(),ce[Fe]=Pe.sortCoordinatesByDistance(q[Fe])}const ye=Fe=>{const Pe=this.style.getLayerSourceCache(Fe);return Pe&&Pe.used?Pe.getSource():null};if(N||G){const Fe=[],Pe=[];let Qe=0;for(const Xe of k)this.isSourceForClippingOrConflation(Xe,ye(Xe))&&(Fe.push(Xe),Pe.push(Qe)),Qe++;if(Fe&&(G||Fe.length>1)){const Xe=[];for(let Ue=0;Ue<Fe.length;Ue++){const _t=Fe[Ue],ut=Pe[Ue],We=this.style.getLayerSourceCache(_t);if(!We||!We.used||!We.getSource().usedInConflation&&_t.type!=="clip")continue;let nt=a.cv,je=a.cw.None;const ht=[];if(_t.type==="clip"){nt=ut;for(const ft of _t.layout.get("clip-layer-types"))je|=ft==="model"?a.cw.Model:ft==="symbol"?a.cw.Symbol:a.cw.FillExtrusion;for(const ft of _t.layout.get("clip-layer-scope"))ht.push(ft)}Xe.push({layer:_t.fqid,cache:We,order:nt,clipMask:je,clipScope:ht})}this.replacementSource.setSources(Xe),j=!0}}j||this.replacementSource.clear(),this.conflationActive=j,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Fe=0;Fe<k.length;Fe++){const Pe=k[Fe],Qe=Pe.cutoffRange();if(this.longestCutoffRange=Math.max(Qe,this.longestCutoffRange),Qe>0){const Xe=ye(Pe);Xe&&(this.minCutoffZoom=Math.max(Xe.minzoom,this.minCutoffZoom)),Pe.minzoom&&(this.minCutoffZoom=Math.max(Pe.minzoom,this.minCutoffZoom))}Pe.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Fe),this._lastOcclusionLayer=Fe)}const ve=this.style&&this.style.fog;ve?(this._fogVisible=ve.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ve.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ie),this.opaquePassCutoff=0);const _e=this._shadowRenderer;if(_e){_e.updateShadowParameters(this.transform,this.style.directionalLight);for(const Fe in L)for(const Pe of q[Fe]){let Qe={min:0,max:0};this.terrain&&(Qe=this.terrain.getMinMaxForTile(Pe)||Qe),_e.addShadowReceiver(Pe.toUnwrapped(),Qe.min,Qe.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.ct(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new bg(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!a.cu(this.context.gl))return;this.renderPass="offscreen";for(const Fe of k){const Pe=l.getLayerSourceCache(Fe);if(!Fe.hasOffscreenPass()||Fe.isHidden(this.transform.zoom))continue;const Qe=Pe?re[Pe.id]:void 0;(Fe.type==="custom"||Fe.type==="raster"||Fe.type==="raster-particle"||Fe.isSky()||Qe&&Qe.length)&&this.renderLayer(this,Pe,Fe,Qe)}this.depthRangeFor3D=[0,1-(k.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ae)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Re=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Se=(()=>{if(d.showOverdrawInspector)return a.C.black;const Fe=this.style.fog;if(Fe&&this.transform.projection.supportsFog){const Pe=this.style.getLut(Fe.scope);if(!Re){const Qe=Fe.properties.get("color").toRenderColor(Pe).toArray01();return new a.C(...Qe)}if(Re){const Qe=Fe.properties.get("space-color").toRenderColor(Pe).toArray01();return new a.C(...Qe)}}return a.C.transparent})();if(this.context.clear({color:Se,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Re&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=T.length-1;this.currentLayer>=0;this.currentLayer--){const Fe=k[this.currentLayer],Pe=l.getLayerSourceCache(Fe);if(Fe.isSky())continue;const Qe=Pe?(Fe.is3D()?ce:re)[Pe.id]:void 0;this._renderTileClippingMasks(Fe,Pe,Qe),this.renderLayer(this,Pe,Fe,Qe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Re&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.a2(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<T.length;this.currentLayer++){const Fe=k[this.currentLayer],Pe=l.getLayerSourceCache(Fe);Fe.isSky()&&this.renderLayer(this,Pe,Fe,Pe?re[Pe.id]:void 0)}function Ie(Fe,Pe){let Qe;return Pe&&(Qe=(Fe.type==="symbol"?ie:Fe.is3D()?ce:re)[Pe.id]),Qe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<T.length;){const Fe=k[this.currentLayer];if(Fe.type==="raster"||Fe.type==="raster-particle"){const Pe=l.getLayerSourceCache(Fe);this.renderLayer(this,Pe,Fe,Ie(Fe,Pe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ze=0;_e&&(ze=_e.getShadowCastingLayerCount());let Ne=!1,qe=-1;for(let Fe=0;Fe<T.length;++Fe){const Pe=k[Fe];Pe.isHidden(this.transform.zoom)||Pe.is3D()&&(qe=Fe)}for(C&&qe===-1&&(S=!0);this.currentLayer<T.length;){const Fe=k[this.currentLayer],Pe=l.getLayerSourceCache(Fe);if(Fe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Fe)){if(Fe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(S&&!Ne&&this.terrain&&!this.transform.isOrthographic&&(Ne=!0,this.blitDepth()),C&&qe!==-1&&this.currentLayer===qe+1&&!this.transform.isOrthographic&&this.blitDepth(),Fe.is3D()||this.terrain||this._renderTileClippingMasks(Fe,Pe,Pe?q[Pe.id]:void 0),this.renderLayer(this,Pe,Fe,Ie(Fe,Pe)),!this.terrain&&_e&&ze>0&&Fe.hasShadowPass()&&--ze==0&&(_e.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Qe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Qe;this.currentLayer++){const Xe=k[this.currentLayer];if(!Xe.hasLightBeamPass())continue;const Ue=l.getLayerSourceCache(Xe);this.renderLayer(this,Ue,Xe,Ue?re[Ue.id]:void 0)}this.currentLayer=Qe,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Qe=this.currentLayer;this.depthOcclusion=!0;for(const Xe of this.layersWithOcclusionOpacity){this.currentLayer=Xe;const Ue=k[this.currentLayer],_t=l.getLayerSourceCache(Ue),ut=_t?re[_t.id]:void 0;Ue.is3D()||this.terrain||this._renderTileClippingMasks(Ue,_t,_t?q[_t.id]:void 0),this.renderLayer(this,_t,Ue,ut)}this.depthOcclusion=!1,this.currentLayer=Qe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Fe=null;k.forEach(Pe=>{const Qe=l.getLayerSourceCache(Pe);Qe&&!Pe.isHidden(this.transform.zoom)&&Qe.getVisibleCoordinates().length&&(!Fe||Fe.getSource().maxzoom<Qe.getSource().maxzoom)&&(Fe=Qe)}),Fe&&this.options.showTileBoundaries&&Ja.debug(this,Fe,Fe.getVisibleCoordinates(),a.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ja.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Fe){const Pe=Fe.transform.padding;m0(Fe,Fe.transform.height-(Pe.top||0),3,f0),m0(Fe,Pe.bottom||0,3,xg),fp(Fe,Pe.left||0,3,p0),fp(Fe,Fe.transform.width-(Pe.right||0),3,Ar);const Qe=Fe.transform.centerPoint;(function(Xe,Ue,_t,ut){vd(Xe,Ue-1,_t-10,2,20,ut),vd(Xe,Ue-10,_t-1,20,2,ut)})(Fe,Qe.x,Fe.transform.height-Qe.y,fC)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),j||(this.conflationActive=!1)}prepareLayer(l){this.gpuTimingStart(l);const{unsupportedLayers:d}=this.transform.projection,y=!d||!d.includes(l.type);if(bs[l.type]&&(y||this.terrain&&l.type==="custom")){const b=this.style.getLayerSourceCache(l);bs[l.type](l,b,this)}this.gpuTimingEnd()}renderLayer(l,d,y,b){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="sky"||y.type==="custom"||y.type==="model"||y.type==="raster"||y.type==="raster-particle"||b&&b.length)&&(this.id=y.id,this.gpuTimingStart(y),l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes(y.type)&&(!l.terrain||y.type!=="custom")||y.type==="clip"||Ja[y.type](l,d,y,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery,y=this.context.gl;let b=this.gpuTimers[l.id];b||(b=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:y.createQuery()}),b.calls++,y.beginQuery(d.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,d=this.context.gl,y=d.createQuery();this.deferredRenderGpuTimeQueries.push(y),d.beginQuery(l.TIME_ELAPSED_EXT,y)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const d={};for(const y in l){const b=l[y],T=this.context.extTimerQuery,S=T.getQueryParameter(b.query,this.context.gl.QUERY_RESULT)/1e6;T.deleteQueryEXT(b.query),d[y]=S}return d}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.extTimerQuery,y=this.context.gl;let b=0;for(const T of l)b+=d.getQueryParameter(T,y.QUERY_RESULT)/1e6,d.deleteQueryEXT(T);return b}translatePosMatrix(l,d,y,b,T){if(!y[0]&&!y[1])return l;const S=T?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(S){const L=Math.sin(S),N=Math.cos(S);y=[y[0]*N-y[1]*L,y[0]*L+y[1]*N]}const C=[T?y[0]:a.bD(d,y[0],this.transform.zoom),T?y[1]:a.bD(d,y[1],this.transform.zoom),0],k=new Float32Array(16);return a.ae.translate(k,l,C),k}saveTileTexture(l){const d=l.size[0],y=this._tileTextures[d];y?y.push(l):this._tileTextures[d]=[l]}getTileTexture(l){const d=this._tileTextures[l];return d&&d.length>0?d.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(l,d,y){const b=y===void 0?this.terrain&&this.terrain.renderingToTexture:y,T=[];return this.style&&this.style.enable3dLights()&&(l==="globeRaster"||l==="terrainRaster"?(T.push("LIGHTING_3D_MODE"),T.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):b||T.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||T.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?T.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):T.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(T.push("TERRAIN"),this.linearFloatFilteringSupported()&&T.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&T.push("GLOBE"),!this._fogVisible||b||d!==void 0&&!d||T.push("FOG","FOG_DITHERING"),b&&T.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&T.push("OVERDRAW_INSPECTOR"),T}getOrCreateProgram(l,d){this.cache=this.cache||{};const y=d&&d.defines||[],b=d&&d.config,T=this.currentGlobalDefines(l,d&&d.overrideFog,d&&d.overrideRtt).concat(y),S=ks.cacheKey(Zc[l],l,T,b);return this.cache[S]||(this.cache[S]=new ks(this.context,l,Zc[l],b,Rb[l],T)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(l,d){if(this.style.enable3dLights()){const y=this.style.directionalLight,b=this.style.ambientLight;if(y&&b){const T=((S,C,k)=>{const L=S.properties.get("direction"),N=S.properties.get("color").toRenderColor(k.getLut(S.scope)).toArray01(),j=S.properties.get("intensity"),G=C.properties.get("color").toRenderColor(k.getLut(C.scope)).toArray01(),q=C.properties.get("intensity"),re=[L.x,L.y,L.z],ie=a.bC(G,q),ae=a.bC(N,j);return{u_lighting_ambient_color:ie,u_lighting_directional_dir:re,u_lighting_directional_color:ae,u_ground_radiance:ui(re,ae,ie)}})(y,b,this.style);d.setLightsUniformValues(l,T)}}}uploadCommonUniforms(l,d,y,b,T){if(this.uploadCommonLightUniforms(l,d),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const C=S.getOpacity(this.transform.pitch),k=((L,N,j,G,q,re,ie,ae,ce,ye,ve,_e)=>{const Re=L.transform,Se=N.properties.get("color").toRenderColor(L.style.getLut(N.scope)).toArray01();Se[3]=G;const Ie=L.frameCounter/1e3%1,[ze,Ne]=N.properties.get("vertical-range");return{u_fog_matrix:j?Re.calculateFogTileMatrix(j):_e||L.identityMat,u_fog_range:N.getFovAdjustedRange(Re._fov),u_fog_color:Se,u_fog_horizon_blend:N.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ze,Ne),Ne],u_fog_temporal_offset:Ie,u_frustum_tl:q,u_frustum_tr:re,u_frustum_br:ie,u_frustum_bl:ae,u_globe_pos:ce,u_globe_radius:ye,u_viewport:ve,u_globe_transition:a.a2(Re.zoom),u_is_globe:+(Re.projection.name==="globe")}})(this,S,y,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.e.devicePixelRatio,this.transform.height*a.e.devicePixelRatio],b);d.setFogUniformValues(l,k)}T&&d.setCutoffUniformValues(l,T.uniformValues)}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,d=l.createTexture();return l.bindTexture(l.TEXTURE_2D,d),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const l=this._backgroundTiles,d=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const b of y)d[b.key]=l[b.key]||new a.bA(b,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(l,d){return!(!l.is3D()||l.minzoom&&l.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||l.sourceLayer!=="building")&&l.type!=="clip"&&(!d||d.type!=="batched-model"))}isTileAffectedByFog(l){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let d=this._cachedTileFogOpacities[l.key];return d||(this._cachedTileFogOpacities[l.key]=d=this.style.fog.getOpacityForTile(l)),d[0]>=vr||d[1]>=vr}setupDepthForOcclusion(l,d,y){const b=this.context,T=b.gl,S=!!y;var C;y||(y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),b.activeTexture.set(T.TEXTURE3),l&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),y.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],y.u_depth_range_unpack=[2/((C=this.depthRangeFor3D)[1]-C[0]),-1-2*C[0]/(C[1]-C[0])],y.u_occluder_half_size=.5*this.occlusionParams.occluderSize,y.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),b.activeTexture.set(T.TEXTURE0),S||d.setTerrainUniformValues(b,y)}}class ha{constructor(l,d,y,b){this.screenBounds=l,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(l,d){let y,b;if(l instanceof a.P||typeof l[0]=="number"){const T=a.P.convert(l);y=[T],b=d.isPointAboveHorizon(T)}else{const T=a.P.convert(l[0]),S=a.P.convert(l[1]);y=[T,S],b=a.cx(T,S).every(C=>d.isPointAboveHorizon(C))}return new ha(y,d.getCameraPoint(),b,d)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return a.cx(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const d=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],b=a.cx(d,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<y.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?b[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(b[3]=this.cameraPoint)),a.cy(b,l)}bufferedCameraGeometryGlobe(l){const d=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],b=a.cx(d,y,l),T=this.cameraPoint.clone();switch(3*((T.y>d.y)+(T.y>y.y))+((T.x>d.x)+(T.x>y.x))){case 0:b[0]=T,b[4]=T.clone();break;case 1:b.splice(1,0,T);break;case 2:b[1]=T;break;case 3:b.splice(4,0,T);break;case 5:b.splice(2,0,T);break;case 6:b[3]=T;break;case 7:b.splice(3,0,T);break;case 8:b[2]=T}return b}containsTile(l,d,y,b=0){const T=l.queryPadding/d._pixelsPerMercatorPixel+1,S=y?this._bufferedCameraMercator(T,d):this._bufferedScreenMercator(T,d);let C=l.tileID.wrap+(S.unwrapped?b:0);const k=S.polygon.map(ae=>a.cz(l.tileTransform,ae,C));if(!a.cA(k,0,0,a.a4,a.a4))return;C=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const L=this.screenGeometryMercator.polygon.map(ae=>a.cB(l.tileTransform,ae,C)),N=L.map(ae=>new a.P(ae[0],ae[1])),j=d.getFreeCameraOptions().position||new a._(0,0,0),G=a.cB(l.tileTransform,j,C),q=L.map(ae=>{const ce=a.$.sub(ae,ae,G);return a.$.normalize(ce,ce),new a.aU(G,ce)}),re=a.bD(l,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:N,tilespaceRays:q,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(ie=a.cC(k),ie.min.x=a.au(ie.min.x,0,a.a4),ie.min.y=a.au(ie.min.y,0,a.a4),ie.max.x=a.au(ie.max.x,0,a.a4),ie.max.y=a.au(ie.max.y,0,a.a4),ie),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:re};var ie}_bufferedScreenMercator(l,d){const y=su(l);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let b;return b=d.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),d):{polygon:this.bufferedScreenGeometry(l).map(T=>d.pointCoordinate3D(T)),unwrapped:!0},this._screenRaycastCache[y]=b,b}}_bufferedCameraMercator(l,d){const y=su(l);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let b;return b=d.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),d):{polygon:this.bufferedCameraGeometry(l).map(T=>d.pointCoordinate3D(T)),unwrapped:!0},this._cameraRaycastCache[y]=b,b}}_projectAndResample(l,d){const y=function(T,S){const C=a.ae.multiply([],S.pixelMatrix,S.globeMatrix),k=[0,-a.cF,0,1],L=[0,a.cF,0,1],N=[0,0,0,1];a.aB.transformMat4(k,k,C),a.aB.transformMat4(L,L,C),a.aB.transformMat4(N,N,C);const j=new a.P(k[0]/k[3],k[1]/k[3]),G=new a.P(L[0]/L[3],L[1]/L[3]),q=a.cD(T,j)&&k[3]<N[3],re=a.cD(T,G)&&L[3]<N[3];if(!q&&!re)return null;const ie=function(Ie,ze,Ne){for(let qe=1;qe<Ie.length;qe++){const Fe=fc(ze.pointCoordinate3D(Ie[qe-1]).x),Pe=fc(ze.pointCoordinate3D(Ie[qe]).x);if(Ne<0){if(Fe<Pe)return{idx:qe,t:-Fe/(Pe-1-Fe)}}else if(Pe<Fe)return{idx:qe,t:(1-Fe)/(Pe+1-Fe)}}return null}(T,S,q?-1:1);if(!ie)return null;const{idx:ae,t:ce}=ie;let ye=ae>1?ch(T.slice(0,ae),S):[],ve=ae<T.length?ch(T.slice(ae),S):[];ye=ye.map(Ie=>new a.P(fc(Ie.x),Ie.y)),ve=ve.map(Ie=>new a.P(fc(Ie.x),Ie.y));const _e=[...ye];_e.length===0&&_e.push(ve[ve.length-1]);const Re=a.a3(_e[_e.length-1].y,(ve.length===0?ye[0]:ve[0]).y,ce);let Se;return Se=q?[new a.P(0,Re),new a.P(0,0),new a.P(1,0),new a.P(1,Re)]:[new a.P(1,Re),new a.P(1,1),new a.P(0,1),new a.P(0,Re)],_e.push(...Se),ve.length===0?_e.push(ye[0]):_e.push(...ve),{polygon:_e.map(Ie=>new a._(Ie.x,Ie.y)),unwrapped:!1}}(l,d);if(y)return y;const b=function(T,S){let C=!1,k=-1/0,L=0;for(let j=0;j<T.length-1;j++)T[j].x>k&&(k=T[j].x,L=j);for(let j=0;j<T.length-1;j++){const G=(L+j)%(T.length-1),q=T[G],re=T[G+1];Math.abs(q.x-re.x)>.5&&(q.x<re.x?(q.x+=1,G===0&&(T[T.length-1].x+=1)):(re.x+=1,G+1===T.length-1&&(T[0].x+=1)),C=!0)}const N=a.ak(S.center.lng);return C&&N<Math.abs(N-1)&&T.forEach(j=>{j.x-=1}),{polygon:T,unwrapped:C}}(ch(l,d).map(T=>new a.P(fc(T.x),T.y)),d);return{polygon:b.polygon.map(T=>new a._(T.x,T.y)),unwrapped:b.unwrapped}}}function ch(g,l){return a.cE(g,d=>{const y=l.pointCoordinate3D(d);d.x=y.x,d.y=y.y},1/256)}function fc(g){return g<0?1+g%1:g%1}function su(g){return 100*g|0}function pC(g,l){const d=a.ae.identity([]);return a.ae.scale(d,d,[.5*g.width,.5*-g.height,1]),a.ae.translate(d,d,[1,-1,0]),a.ae.multiply(d,d,g.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(d)}function pc(g,l,d,y,b,T,S,C=!1){const k=g.tilesIn(y,S,C);k.sort(v0);const L=[];for(const j of k)L.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(l,d,g._state,j,b,T,pC(g.transform,j.tile.tileID),C)});const N=function(j){const G={},q={};for(const re of j){const ie=re.queryResults,ae=re.wrappedTileID,ce=q[ae]=q[ae]||{};for(const ye in ie){const ve=ie[ye],_e=ce[ye]=ce[ye]||{},Re=G[ye]=G[ye]||[];for(const Se of ve)_e[Se.featureIndex]||(_e[Se.featureIndex]=!0,Re.push(Se))}}return G}(L);for(const j in N)N[j].forEach(G=>{const q=G.feature,re=q.layer;re&&re.type!=="background"&&re.type!=="sky"&&re.type!=="slot"&&(q.source=re.source,re["source-layer"]&&(q.sourceLayer=re["source-layer"]),q.state=q.id!==void 0?g.getFeatureState(re["source-layer"],q.id):{})});return N}function mC(g,l){const d=g.getRenderableIds().map(T=>g.getTileByID(T)),y=[],b={};for(let T=0;T<d.length;T++){const S=d[T],C=S.tileID.canonical.key;b[C]||(b[C]=!0,S.querySourceFeatures(y,l))}return y}function v0(g,l){const d=g.tileID,y=l.tileID;return d.overscaledZ-y.overscaledZ||d.canonical.y-y.canonical.y||d.wrap-y.wrap||d.canonical.x-y.canonical.x}class Go{constructor(l){this.style=l,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const l=!1,d=!1;for(const y in this.style._mergedLayers){const b=this.style._mergedLayers[y];if(b.type==="fill-extrusion")this.layers.push({layer:b,visible:l,visibilityChanged:d});else if(b.type==="model"){const T=this.style.getLayerSource(b);T&&T.type==="batched-model"&&this.layers.push({layer:b,visible:l,visibilityChanged:d})}}}onNewFrame(l){this.layersGotHidden=!1;for(const d of this.layers){const y=d.layer;let b=!1;y.type==="fill-extrusion"?b=!y.isHidden(l)&&y.paint.get("fill-extrusion-opacity")>0:y.type==="model"&&(b=!y.isHidden(l)&&y.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!b&&d.visible,d.visible=b}}updateZOffset(l,d){this.currentBuildingBuckets=[];for(const b of this.layers){const T=b.layer,S=this.style.getLayerSourceCache(T);let C=1;T.type==="fill-extrusion"&&(C=b.visible?T.paint.get("fill-extrusion-vertical-scale"):0);let k=S?S.getTile(d):null;if(!k&&S&&d.canonical.z>S.getSource().minzoom){let L=d.scaledTo(Math.min(S.getSource().maxzoom,d.overscaledZ-1));for(;L.overscaledZ>=S.getSource().minzoom&&(k=S.getTile(L),!k&&L.overscaledZ!==0);)L=L.scaledTo(L.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:k?k.getBucket(T):null,tileID:k?k.tileID:d,verticalScale:C})}l.hasAnyZOffset=!1;let y=!1;for(let b=0;b<l.symbolInstances.length;b++){const T=l.symbolInstances.get(b),S=T.zOffset,C=this._getHeightAtTileOffset(d,T.tileAnchorX,T.tileAnchorY);T.zOffset=C!==Number.NEGATIVE_INFINITY?C:S,y||S===T.zOffset||(y=!0),l.hasAnyZOffset||T.zOffset===0||(l.hasAnyZOffset=!0)}y&&(l.zOffsetBuffersNeedUpload=!0,l.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(l,d,y,b){let T=d,S=y;if(l.canonical.z!==b.canonical.z){const C=b.canonical,k=1/(1<<l.canonical.z-C.z);T=(d+l.canonical.x*a.a4)*k-C.x*a.a4|0,S=(y+l.canonical.y*a.a4)*k-C.y*a.a4|0}return{tileX:T,tileY:S}}_getHeightAtTileOffset(l,d,y){let b,T;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;const{bucket:C,tileID:k,verticalScale:L}=this.currentBuildingBuckets[S];if(!C)continue;const{tileX:N,tileY:j}=this._mapCoordToOverlappingTile(l,d,y,k),G=C.getHeightAtTileCoord(N,j);G&&G.height!==void 0&&(G.hidden?b=G.height:T=Math.max(G.height*L,T||0))}if(T!==void 0)return T;for(let S=0;S<this.layers.length;++S){const C=this.layers[S];if(C.layer.type!=="model"||!C.visible)continue;const{bucket:k,tileID:L}=this.currentBuildingBuckets[S];if(!k)continue;const{tileX:N,tileY:j}=this._mapCoordToOverlappingTile(l,d,y,L),G=k.getHeightAtTileCoord(N,j);if(G&&!G.hidden)return G.height===void 0&&b!==void 0?Math.min(G.maxHeight,b)*G.verticalScale:G.height?G.height*G.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function gC(g,l){const d={};for(const y in g)y!=="ref"&&(d[y]=g[y]);return a.cG.forEach(y=>{y in l&&(d[y]=l[y])}),d}function gp(g){g=g.slice();const l=Object.create(null);for(let d=0;d<g.length;d++)l[g[d].id]=g[d];for(let d=0;d<g.length;d++)"ref"in g[d]&&(g[d]=gC(g[d],l[g[d].ref]));return g}const Cr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Td(g,l,d){d.push({command:Cr.addSource,args:[g,l[g]]})}function Fb(g,l,d){l.push({command:Cr.removeSource,args:[g]}),d[g]=!0}function _C(g,l,d,y){Fb(g,d,y),Td(g,l,d)}function _p(g,l,d){let y;for(y in g[d])if(g[d].hasOwnProperty(y)&&y!=="data"&&!a.d(g[d][y],l[d][y]))return!1;for(y in l[d])if(l[d].hasOwnProperty(y)&&y!=="data"&&!a.d(g[d][y],l[d][y]))return!1;return!0}function ou(g,l,d,y,b,T){let S;for(S in l=l||{},g=g||{})g.hasOwnProperty(S)&&(a.d(g[S],l[S])||d.push({command:T,args:[y,S,l[S],b]}));for(S in l)l.hasOwnProperty(S)&&!g.hasOwnProperty(S)&&(a.d(g[S],l[S])||d.push({command:T,args:[y,S,l[S],b]}))}function Eg(g){return g.id}function mc(g,l){return g[l.id]=l,g}class Bb{constructor(l,d){this.reset(l,d)}reset(l,d){this.points=l||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=a.au(l,0,1);let d=1,y=this._distances[d];const b=l*this.paddedLength+this.padding;for(;y<b&&d<this._distances.length;)y=this._distances[++d];const T=d-1,S=this._distances[T],C=y-S,k=C>0?(b-S)/C:0;return this.points[T].mult(1-k).add(this.points[d].mult(k))}}class yp{constructor(l,d,y){const b=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(l/y),this.yCellCount=Math.ceil(d/y);for(let S=0;S<this.xCellCount*this.yCellCount;S++)b.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,d,y,b,T){this._forEachCell(d,y,b,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(b),this.bboxes.push(T)}insertCircle(l,d,y,b){this._forEachCell(d-b,y-b,d+b,y+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(y),this.circles.push(b)}_insertBoxCell(l,d,y,b,T,S){this.boxCells[T].push(S)}_insertCircleCell(l,d,y,b,T,S){this.circleCells[T].push(S)}_query(l,d,y,b,T,S){if(y<0||l>this.width||b<0||d>this.height)return!T&&[];const C=[];if(l<=0&&d<=0&&this.width<=y&&this.height<=b){if(T)return!0;for(let k=0;k<this.boxKeys.length;k++)C.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const L=this.circles[3*k],N=this.circles[3*k+1],j=this.circles[3*k+2];C.push({key:this.circleKeys[k],x1:L-j,y1:N-j,x2:L+j,y2:N+j})}return S?C.filter(S):C}return this._forEachCell(l,d,y,b,this._queryCell,C,{hitTest:T,seenUids:{box:{},circle:{}}},S),T?C.length>0:C}_queryCircle(l,d,y,b,T){const S=l-y,C=l+y,k=d-y,L=d+y;if(C<0||S>this.width||L<0||k>this.height)return!b&&[];const N=[];return this._forEachCell(S,k,C,L,this._queryCellCircle,N,{hitTest:b,circle:{x:l,y:d,radius:y},seenUids:{box:{},circle:{}}},T),b?N.length>0:N}query(l,d,y,b,T){return this._query(l,d,y,b,!1,T)}hitTest(l,d,y,b,T){return this._query(l,d,y,b,!0,T)}hitTestCircle(l,d,y,b){return this._queryCircle(l,d,y,!0,b)}_queryCell(l,d,y,b,T,S,C,k){const L=C.seenUids,N=this.boxCells[T];if(N!==null){const G=this.bboxes;for(const q of N)if(!L.box[q]){L.box[q]=!0;const re=4*q;if(l<=G[re+2]&&d<=G[re+3]&&y>=G[re+0]&&b>=G[re+1]&&(!k||k(this.boxKeys[q]))){if(C.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[q],x1:G[re],y1:G[re+1],x2:G[re+2],y2:G[re+3]})}}}const j=this.circleCells[T];if(j!==null){const G=this.circles;for(const q of j)if(!L.circle[q]){L.circle[q]=!0;const re=3*q;if(this._circleAndRectCollide(G[re],G[re+1],G[re+2],l,d,y,b)&&(!k||k(this.circleKeys[q]))){if(C.hitTest)return S.push(!0),!0;{const ie=G[re],ae=G[re+1],ce=G[re+2];S.push({key:this.circleKeys[q],x1:ie-ce,y1:ae-ce,x2:ie+ce,y2:ae+ce})}}}}}_queryCellCircle(l,d,y,b,T,S,C,k){const L=C.circle,N=C.seenUids,j=this.boxCells[T];if(j!==null){const q=this.bboxes;for(const re of j)if(!N.box[re]){N.box[re]=!0;const ie=4*re;if(this._circleAndRectCollide(L.x,L.y,L.radius,q[ie+0],q[ie+1],q[ie+2],q[ie+3])&&(!k||k(this.boxKeys[re])))return S.push(!0),!0}}const G=this.circleCells[T];if(G!==null){const q=this.circles;for(const re of G)if(!N.circle[re]){N.circle[re]=!0;const ie=3*re;if(this._circlesCollide(q[ie],q[ie+1],q[ie+2],L.x,L.y,L.radius)&&(!k||k(this.circleKeys[re])))return S.push(!0),!0}}}_forEachCell(l,d,y,b,T,S,C,k){const L=this._convertToXCellCoord(l),N=this._convertToYCellCoord(d),j=this._convertToXCellCoord(y),G=this._convertToYCellCoord(b);for(let q=L;q<=j;q++)for(let re=N;re<=G;re++)if(T.call(this,l,d,y,b,this.xCellCount*re+q,S,C,k))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,d,y,b,T,S){const C=b-l,k=T-d,L=y+S;return L*L>C*C+k*k}_circleAndRectCollide(l,d,y,b,T,S,C){const k=(S-b)/2,L=Math.abs(l-(b+k));if(L>k+y)return!1;const N=(C-T)/2,j=Math.abs(d-(T+N));if(j>N+y)return!1;if(L<=k||j<=N)return!0;const G=L-k,q=j-N;return G*G+q*q<=y*y}}const oo=100;class yC{constructor(l,d,y=new yp(l.width+200,l.height+200,25),b=new yp(l.width+200,l.height+200,25)){this.transform=l,this.grid=y,this.ignoredGrid=b,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+oo,this.screenBottomBoundary=l.height+oo,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=d}placeCollisionBox(l,d,y,b,T,S,C,k){let L=y.projectedAnchorX,N=y.projectedAnchorY,j=y.projectedAnchorZ;const G=y.elevation,q=y.tileID,re=l.getProjection();if(G&&q){const[Se,Ie,ze]=re.upVector(q.canonical,y.tileAnchorX,y.tileAnchorY),Ne=re.upVectorScale(q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=Se*G*Ne,N+=Ie*G*Ne,j+=ze*G*Ne}const ie=this.projectAndGetPerspectiveRatio(C,L,N,j,y.tileID,re.name==="globe"||!!G||this.transform.pitch>0,re),ae=S*ie.perspectiveRatio,ce=(y.x1*d+b.x-y.padding)*ae+ie.point.x,ye=(y.y1*d+b.y-y.padding)*ae+ie.point.y,ve=(y.x2*d+b.x+y.padding)*ae+ie.point.x,_e=(y.y2*d+b.y+y.padding)*ae+ie.point.y,Re=ie.perspectiveRatio<=.55||ie.occluded;return!this.isInsideGrid(ce,ye,ve,_e)||!T&&this.grid.hitTest(ce,ye,ve,_e,k)||Re?{box:[],offscreen:!1,occluded:ie.occluded}:{box:[ce,ye,ve,_e],offscreen:this.isOffscreen(ce,ye,ve,_e),occluded:!1}}placeCollisionCircles(l,d,y,b,T,S,C,k,L,N,j,G,q,re,ie){const ae=[],ce=this.transform.elevation,ye=l.getProjection(),ve=ce?ce.getAtTileOffsetFunc(ie,this.transform.center.lat,this.transform.worldSize,ye):null,_e=new a.P(y.tileAnchorX,y.tileAnchorY);let{x:Re,y:Se,z:Ie}=ye.projectTilePoint(_e.x,_e.y,ie.canonical);if(ve){const[ut,We,nt]=ve(_e);Re+=ut,Se+=We,Ie+=nt}const ze=ye.name==="globe",Ne=this.projectAndGetPerspectiveRatio(C,Re,Se,Ie,ie,ze||!!ce||this.transform.pitch>0,ye),{perspectiveRatio:qe}=Ne,Fe=(j?S/qe:S*qe)/a.bP,Pe=yo(Re,Se,Ie,k),Qe=Ne.signedDistanceFromCamera>0?th(Fe,T,y.lineOffsetX*Fe,y.lineOffsetY*Fe,!1,Pe,_e,y,b,k,{},ce&&!j?ve:null,j&&!!ce,ye,ie,j):null;let Xe=!1,Ue=!1,_t=!0;if(Qe&&!Ne.occluded){const ut=.5*q*qe+re,We=new a.P(-100,-100),nt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),je=new Bb,{first:ht,last:ft}=Qe,Nt=ht.path.length;let Bt=[];for(let Tn=Nt-1;Tn>=1;Tn--)Bt.push(ht.path[Tn]);for(let Tn=1;Tn<ft.path.length;Tn++)Bt.push(ft.path[Tn]);const on=2.5*ut;L&&(Bt=Bt.map(([Tn,Vn,Sn],Zn)=>(ve&&!ze&&(Sn=ve(Zn<Nt-1?ht.tilePath[Nt-1-Zn]:ft.tilePath[Zn-Nt+2])[2]),yo(Tn,Vn,Sn,L))),Bt.some(Tn=>Tn[3]<=0)&&(Bt=[]));let Gt=[];if(Bt.length>0){let Tn=1/0,Vn=-1/0,Sn=1/0,Zn=-1/0;for(const pr of Bt)Tn=Math.min(Tn,pr[0]),Sn=Math.min(Sn,pr[1]),Vn=Math.max(Vn,pr[0]),Zn=Math.max(Zn,pr[1]);Vn>=We.x&&Tn<=nt.x&&Zn>=We.y&&Sn<=nt.y&&(Gt=[Bt.map(pr=>new a.P(pr[0],pr[1]))],(Tn<We.x||Vn>nt.x||Sn<We.y||Zn>nt.y)&&(Gt=a.cH(Gt,We.x,We.y,nt.x,nt.y)))}for(const Tn of Gt){je.reset(Tn,.25*ut);let Vn=0;Vn=je.length<=.5*ut?1:Math.ceil(je.paddedLength/on)+1;for(let Sn=0;Sn<Vn;Sn++){const Zn=Sn/Math.max(Vn-1,1),pr=je.lerp(Zn),ti=pr.x+oo,Vr=pr.y+oo;ae.push(ti,Vr,ut,0);const gr=ti-ut,jr=Vr-ut,Yn=ti+ut,nr=Vr+ut;if(_t=_t&&this.isOffscreen(gr,jr,Yn,nr),Ue=Ue||this.isInsideGrid(gr,jr,Yn,nr),!d&&this.grid.hitTestCircle(ti,Vr,ut,G)&&(Xe=!0,!N))return{circles:[],offscreen:!1,collisionDetected:Xe,occluded:!1}}}}return{circles:!N&&Xe||!Ue?[]:ae,offscreen:_t,collisionDetected:Xe,occluded:Ne.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let y=1/0,b=1/0,T=-1/0,S=-1/0;for(const N of l){const j=new a.P(N.x+oo,N.y+oo);y=Math.min(y,j.x),b=Math.min(b,j.y),T=Math.max(T,j.x),S=Math.max(S,j.y),d.push(j)}const C=this.grid.query(y,b,T,S).concat(this.ignoredGrid.query(y,b,T,S)),k={},L={};for(const N of C){const j=N.key;if(k[j.bucketInstanceId]===void 0&&(k[j.bucketInstanceId]={}),k[j.bucketInstanceId][j.featureIndex])continue;const G=[new a.P(N.x1,N.y1),new a.P(N.x2,N.y1),new a.P(N.x2,N.y2),new a.P(N.x1,N.y2)];a.cI(d,G)&&(k[j.bucketInstanceId][j.featureIndex]=!0,L[j.bucketInstanceId]===void 0&&(L[j.bucketInstanceId]=[]),L[j.bucketInstanceId].push(j.featureIndex))}return L}insertCollisionBox(l,d,y,b,T){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:b,collisionGroupID:T},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,d,y,b,T){const S=d?this.ignoredGrid:this.grid,C={bucketInstanceId:y,featureIndex:b,collisionGroupID:T};for(let k=0;k<l.length;k+=4)S.insertCircle(C,l[k],l[k+1],l[k+2])}projectAndGetPerspectiveRatio(l,d,y,b,T,S,C){const k=[d,y,b,1];let L=!1;b||this.transform.pitch>0?(a.aB.transformMat4(k,k,l),this.fogState&&T&&C.name!=="globe"&&(L=function(G,q,re,ie,ae,ce){const ye=ce.calculateFogTileMatrix(ae),ve=[q,re,ie];return a.$.transformMat4(ve,ve,ye),dr(G,a.$.length(ve),ce.pitch,ce._fov)}(this.fogState,d,y,b,T.toUnwrapped(),this.transform)>.9)):rp(k,k,l);const N=k[3];return{point:new a.P((k[0]/N+1)/2*this.transform.width+oo,(-k[1]/N+1)/2*this.transform.height+oo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/N*.5,1.5),signedDistanceFromCamera:N,occluded:S&&k[2]>N||L}}isOffscreen(l,d,y,b){return y<oo||l>=this.screenRightBoundary||b<oo||d>this.screenBottomBoundary}isInsideGrid(l,d,y,b){return y>=0&&l<this.gridRightBoundary&&b>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const l=a.ae.identity([]);return a.ae.translate(l,l,[-100,-100,0]),l}}class jb{constructor(l,d,y,b){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):b&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class vp{constructor(l,d,y,b,T,S=!1){this.text=new jb(l?l.text:null,d,y,T),this.icon=new jb(l?l.icon:null,d,b,T),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Sg{constructor(l,d,y,b=!1){this.text=l,this.icon=d,this.skipFade=y,this.clipped=b}}class vC{constructor(){this.invProjMatrix=a.ae.create(),this.viewportMatrix=a.ae.create(),this.circles=[]}}class x0{constructor(l,d,y,b,T){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=y,this.bucketIndex=b,this.tileID=T}}class Ub{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:y=>y.collisionGroupID===d}}return this.collisionGroups[l]}}function b0(g,l,d,y,b){const{horizontalAlign:T,verticalAlign:S}=a.bS(g),C=-(T-.5)*l,k=-(S-.5)*d,L=a.bR(g,y);return new a.P(C+L[0]*b,k+L[1]*b)}function Ig(g,l,d,y,b){const T=new a.P(g,l);return d&&T._rotate(y?b:-b),T}class Vb{constructor(l,d,y,b,T,S){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new yC(this.transform,T),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Ub(y),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,d,y,b){const T=y.getBucket(d),S=y.latestFeatureIndex;if(!T||!S||d.fqid!==T.layerIds[0])return;const C=T.layers[0].layout,k=y.collisionBoxArray,L=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),N=y.tileSize/a.a4,j=y.tileID.toUnwrapped();this.transform.setProjection(T.projection);const G=(q=y.tileID,re=T.getProjection(),ie=this.transform,re.name===this.projection?ie.calculateProjMatrix(q.toUnwrapped()):sh(ie,re,q));var q,re,ie;const ae=C.get("text-pitch-alignment")==="map",ce=C.get("text-rotation-alignment")==="map";d.compileFilter();const ye=d.dynamicFilter(),ve=d.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(y),Re=Ju(G,y.tileID.canonical,ae,ce,this.transform,T.getProjection(),_e);let Se=null;if(ae){const Ne=eh(G,y.tileID.canonical,ae,ce,this.transform,T.getProjection(),_e);Se=a.ae.multiply([],this.transform.labelPlaneMatrix,Ne)}let Ie=null;ye&&y.latestFeatureIndex&&(Ie={unwrappedTileID:j,dynamicFilter:ye,dynamicFilterNeedsFeature:ve,featureIndex:y.latestFeatureIndex}),this.retainedQueryData[T.bucketInstanceId]=new x0(T.bucketInstanceId,S,T.sourceLayerIndex,T.index,y.tileID);const ze={bucket:T,layout:C,posMatrix:G,textLabelPlaneMatrix:Re,labelToScreenMatrix:Se,clippingData:Ie,scale:L,textPixelRatio:N,holdingForFade:y.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:a.aE(T.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.aE(T.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(b)for(const Ne of T.sortKeyRanges){const{sortKey:qe,symbolInstanceStart:Fe,symbolInstanceEnd:Pe}=Ne;l.push({sortKey:qe,symbolInstanceStart:Fe,symbolInstanceEnd:Pe,parameters:ze})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:ze})}attemptAnchorPlacement(l,d,y,b,T,S,C,k,L,N,j,G,q,re,ie,ae,ce,ye){const{textOffset0:ve,textOffset1:_e,crossTileID:Re}=G,Se=[ve,_e],Ie=b0(l,y,b,Se,T),ze=this.collisionIndex.placeCollisionBox(re,T,d,Ig(Ie.x,Ie.y,S,C,this.transform.angle),j,k,L,N.predicate);if(ae){const Ne=re.getSymbolInstanceIconSize(ye,this.transform.zoom,G.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(re,Ne,ae,Ig(Ie.x,Ie.y,S,C,this.transform.angle),j,k,L,N.predicate).box.length===0)return}if(ze.box.length>0){let Ne;return this.prevPlacement&&this.prevPlacement.variableOffsets[Re]&&this.prevPlacement.placements[Re]&&this.prevPlacement.placements[Re].text&&(Ne=this.prevPlacement.variableOffsets[Re].anchor),this.variableOffsets[Re]={textOffset:Se,width:y,height:b,anchor:l,textScale:T,prevAnchor:Ne},this.markUsedJustification(re,l,G,ie),re.allowVerticalPlacement&&(this.markUsedOrientation(re,ie,G),this.placedOrientations[Re]=ie),{shift:Ie,placedGlyphBoxes:ze}}}placeLayerBucketPart(l,d,y,b){const{bucket:T,layout:S,posMatrix:C,textLabelPlaneMatrix:k,labelToScreenMatrix:L,clippingData:N,textPixelRatio:j,holdingForFade:G,collisionBoxArray:q,partiallyEvaluatedTextSize:re,partiallyEvaluatedIconSize:ie,collisionGroup:ae}=l.parameters,ce=S.get("text-optional"),ye=S.get("icon-optional"),ve=S.get("text-allow-overlap"),_e=S.get("icon-allow-overlap"),Re=S.get("text-rotation-alignment")==="map",Se=S.get("text-pitch-alignment")==="map",Ie=S.get("symbol-z-order")==="viewport-y",ze=S.get("symbol-z-elevate");this.transform.setProjection(T.projection);let Ne=ve&&(_e||!T.hasIconData()||ye),qe=_e&&(ve||!T.hasTextData()||ce);!T.collisionArrays&&q&&T.deserializeCollisionBoxes(q),y&&b&&T.updateCollisionDebugBuffers(this.transform.zoom,q);const Fe=(Pe,Qe,Xe)=>{const{crossTileID:Ue,numVerticalGlyphVertices:_t}=Pe;if(N){const Yn={zoom:this.transform.zoom,pitch:this.transform.pitch};let nr=null;if(N.dynamicFilterNeedsFeature){const $n=this.retainedQueryData[T.bucketInstanceId];nr=N.featureIndex.loadFeature({featureIndex:Pe.featureIndex,bucketIndex:$n.bucketIndex,sourceLayerIndex:$n.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,N.dynamicFilter)(Yn,nr,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new a.P(Pe.tileAnchorX,Pe.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[Ue]=new Sg(!1,!1,!1,!0),void d.add(Ue)}if(d.has(Ue))return;if(G)return void(this.placements[Ue]=new Sg(!1,!1,!1));let ut=!1,We=!1,nt=!0,je=!1,ht=!1,ft=null,Nt={box:null,offscreen:null,occluded:null},Bt={box:null,offscreen:null,occluded:null},on=null,Gt=null,Tn=null,Vn=0,Sn=0,Zn=0;Xe.textFeatureIndex?Vn=Xe.textFeatureIndex:Pe.useRuntimeCollisionCircles&&(Vn=Pe.featureIndex),Xe.verticalTextFeatureIndex&&(Sn=Xe.verticalTextFeatureIndex);const pr=Yn=>{Yn.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const nr=this.transform.elevation;Yn.elevation=Pe.zOffset+(nr?nr.getAtTileOffset(Yn.tileID,Yn.tileAnchorX,Yn.tileAnchorY):0)},ti=Xe.textBox;if(ti){pr(ti);const Yn=$n=>{let Tr=a.aF.horizontal;if(T.allowVerticalPlacement&&!$n&&this.prevPlacement){const or=this.prevPlacement.placedOrientations[Ue];or&&(this.placedOrientations[Ue]=or,Tr=or,this.markUsedOrientation(T,Tr,Pe))}return Tr},nr=($n,Tr)=>{if(T.allowVerticalPlacement&&_t>0&&Xe.verticalTextBox){for(const or of T.writingModes)if(or===a.aF.vertical?(Nt=Tr(),Bt=Nt):Nt=$n(),Nt&&Nt.box&&Nt.box.length)break}else Nt=$n()};if(S.get("text-variable-anchor")){let $n=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ue]){const kn=this.prevPlacement.variableOffsets[Ue];$n.indexOf(kn.anchor)>0&&($n=$n.filter(Gi=>Gi!==kn.anchor),$n.unshift(kn.anchor))}const Tr=(kn,Gi,qi)=>{const ao=T.getSymbolInstanceTextSize(re,Pe,this.transform.zoom,Qe),lo=(kn.x2-kn.x1)*ao+2*kn.padding,Hs=(kn.y2-kn.y1)*ao+2*kn.padding,co=Pe.hasIconTextFit&&!_e?Gi:null;co&&pr(co);let Bs={box:[],offscreen:!1,occluded:!1};const Zs=ve?2*$n.length:$n.length;for(let xt=0;xt<Zs;++xt){const ln=this.attemptAnchorPlacement($n[xt%$n.length],kn,lo,Hs,ao,Re,Se,j,C,ae,xt>=$n.length,Pe,Qe,T,qi,co,re,ie);if(ln&&(Bs=ln.placedGlyphBoxes,Bs&&Bs.box&&Bs.box.length)){ut=!0,ft=ln.shift;break}}return Bs};nr(()=>Tr(ti,Xe.iconBox,a.aF.horizontal),()=>{const kn=Xe.verticalTextBox;return kn&&pr(kn),T.allowVerticalPlacement&&!(Nt&&Nt.box&&Nt.box.length)&&_t>0&&kn?Tr(kn,Xe.verticalIconBox,a.aF.vertical):{box:null,offscreen:null,occluded:null}}),Nt&&(ut=Nt.box,nt=Nt.offscreen,je=Nt.occluded);const or=Yn(!(!Nt||!Nt.box));if(!ut&&this.prevPlacement){const kn=this.prevPlacement.variableOffsets[Ue];kn&&(this.variableOffsets[Ue]=kn,this.markUsedJustification(T,kn.anchor,Pe,or))}}else{const $n=(Tr,or)=>{const kn=T.getSymbolInstanceTextSize(re,Pe,this.transform.zoom,Qe),Gi=this.collisionIndex.placeCollisionBox(T,kn,Tr,new a.P(0,0),ve,j,C,ae.predicate);return Gi&&Gi.box&&Gi.box.length&&(this.markUsedOrientation(T,or,Pe),this.placedOrientations[Ue]=or),Gi};nr(()=>$n(ti,a.aF.horizontal),()=>{const Tr=Xe.verticalTextBox;return T.allowVerticalPlacement&&_t>0&&Tr?(pr(Tr),$n(Tr,a.aF.vertical)):{box:null,offscreen:null,occluded:null}}),Yn(!!(Nt&&Nt.box&&Nt.box.length))}}if(on=Nt,ut=on&&on.box&&on.box.length>0,nt=on&&on.offscreen,je=on&&on.occluded,Pe.useRuntimeCollisionCircles){const Yn=T.text.placedSymbolArray.get(Pe.centerJustifiedTextSymbolIndex>=0?Pe.centerJustifiedTextSymbolIndex:Pe.verticalPlacedTextSymbolIndex),nr=a.aG(T.textSizeData,re,Yn),$n=S.get("text-padding");Gt=this.collisionIndex.placeCollisionCircles(T,ve,Yn,T.lineVertexArray,T.glyphOffsetArray,nr,C,k,L,y,Se,ae.predicate,Pe.collisionCircleDiameter*nr/a.bP,$n,this.retainedQueryData[T.bucketInstanceId].tileID),ut=ve||Gt.circles.length>0&&!Gt.collisionDetected,nt=nt&&Gt.offscreen,je=Gt.occluded}if(Xe.iconFeatureIndex&&(Zn=Xe.iconFeatureIndex),Xe.iconBox){const Yn=nr=>{pr(nr);const $n=Pe.hasIconTextFit&&ft?Ig(ft.x,ft.y,Re,Se,this.transform.angle):new a.P(0,0),Tr=T.getSymbolInstanceIconSize(ie,this.transform.zoom,Pe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Tr,nr,$n,_e,j,C,ae.predicate)};Bt&&Bt.box&&Bt.box.length&&Xe.verticalIconBox?(Tn=Yn(Xe.verticalIconBox),We=Tn.box.length>0):(Tn=Yn(Xe.iconBox),We=Tn.box.length>0),nt=nt&&Tn.offscreen,ht=Tn.occluded}const Vr=ce||Pe.numHorizontalGlyphVertices===0&&_t===0,gr=ye||Pe.numIconVertices===0;if(Vr||gr?gr?Vr||(We=We&&ut):ut=We&&ut:We=ut=We&&ut,ut&&on&&on.box&&this.collisionIndex.insertCollisionBox(on.box,S.get("text-ignore-placement"),T.bucketInstanceId,Bt&&Bt.box&&Sn?Sn:Vn,ae.ID),We&&Tn&&this.collisionIndex.insertCollisionBox(Tn.box,S.get("icon-ignore-placement"),T.bucketInstanceId,Zn,ae.ID),Gt&&(ut&&this.collisionIndex.insertCollisionCircles(Gt.circles,S.get("text-ignore-placement"),T.bucketInstanceId,Vn,ae.ID),y)){const Yn=T.bucketInstanceId;let nr=this.collisionCircleArrays[Yn];nr===void 0&&(nr=this.collisionCircleArrays[Yn]=new vC);for(let $n=0;$n<Gt.circles.length;$n+=4)nr.circles.push(Gt.circles[$n+0]),nr.circles.push(Gt.circles[$n+1]),nr.circles.push(Gt.circles[$n+2]),nr.circles.push(Gt.collisionDetected?1:0)}const jr=T.projection.name!=="globe";Ne=Ne&&(jr||!je),qe=qe&&(jr||!ht),this.placements[Ue]=new Sg(ut||Ne,We||qe,nt||T.justReloaded),d.add(Ue)};if(ze&&this.buildingIndex&&(this.buildingIndex.updateZOffset(T,this.retainedQueryData[T.bucketInstanceId].tileID),T.updateZOffset()),Ie){const Pe=T.getSortedSymbolIndexes(this.transform.angle);for(let Qe=Pe.length-1;Qe>=0;--Qe){const Xe=Pe[Qe];Fe(T.symbolInstances.get(Xe),Xe,T.collisionArrays[Xe])}T.hasAnyZOffset&&a.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const Pe=T.getSortedIndexesByZOffset();for(let Qe=0;Qe<Pe.length;++Qe){const Xe=Pe[Qe];Fe(T.symbolInstances.get(Xe),Xe,T.collisionArrays[Xe])}}else for(let Pe=l.symbolInstanceStart;Pe<l.symbolInstanceEnd;Pe++)Fe(T.symbolInstances.get(Pe),Pe,T.collisionArrays[Pe]);if(y&&T.bucketInstanceId in this.collisionCircleArrays){const Pe=this.collisionCircleArrays[T.bucketInstanceId];a.ae.invert(Pe.invProjMatrix,C),Pe.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(l,d,y,b){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:k,crossTileID:L}=y,N=a.cM(d),j=b===a.aF.vertical?k:N==="left"?T:N==="center"?S:N==="right"?C:-1;T>=0&&(l.text.placedSymbolArray.get(T).crossTileID=j>=0&&T!==j?0:L),S>=0&&(l.text.placedSymbolArray.get(S).crossTileID=j>=0&&S!==j?0:L),C>=0&&(l.text.placedSymbolArray.get(C).crossTileID=j>=0&&C!==j?0:L),k>=0&&(l.text.placedSymbolArray.get(k).crossTileID=j>=0&&k!==j?0:L)}markUsedOrientation(l,d,y){const b=d===a.aF.horizontal||d===a.aF.horizontalOnly?d:0,T=d===a.aF.vertical?d:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:L}=y,N=l.text.placedSymbolArray;S>=0&&(N.get(S).placedOrientation=b),C>=0&&(N.get(C).placedOrientation=b),k>=0&&(N.get(k).placedOrientation=b),L>=0&&(N.get(L).placedOrientation=T)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let y=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const b=d?d.symbolFadeChange(l):1,T=d?d.opacities:{},S=d?d.variableOffsets:{},C=d?d.placedOrientations:{};for(const k in this.placements){const L=this.placements[k],N=T[k];N?(this.opacities[k]=new vp(N,b,L.text,L.icon,null,L.clipped),y=y||L.text!==N.text.placed||L.icon!==N.icon.placed):(this.opacities[k]=new vp(null,b,L.text,L.icon,L.skipFade,L.clipped),y=y||L.text||L.icon)}for(const k in T){const L=T[k];if(!this.opacities[k]){const N=new vp(L,b,!1,!1);N.isHidden()||(this.opacities[k]=N,y=y||L.text.placed||L.icon.placed)}}for(const k in S)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=S[k]);for(const k in C)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=C[k]);y?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)}updateLayerOpacities(l,d,y,b){const T=new Set;for(const S of d){const C=S.getBucket(l);C&&S.latestFeatureIndex&&l.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,T,S.collisionBoxArray,y,b,S.tileID,l.scope),C.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,S.tileID),C.updateZOffset()))}}updateBucketOpacities(l,d,y,b,T,S,C){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const k=l.layers[0].layout,L=!!l.layers[0].dynamicFilter(),N=new vp(null,0,!1,!1,!0),j=k.get("text-allow-overlap"),G=k.get("icon-allow-overlap"),q=k.get("text-variable-anchor"),re=k.get("text-rotation-alignment")==="map",ie=k.get("text-pitch-alignment")==="map",ae=new vp(null,0,j&&(G||!l.hasIconData()||k.get("icon-optional")),G&&(j||!l.hasTextData()||k.get("text-optional")),!0);!l.collisionArrays&&y&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(y);const ce=(ve,_e,Re)=>{for(let Se=0;Se<_e/4;Se++)ve.opacityVertexArray.emplaceBack(Re)};let ye=0;T&&l.updateReplacement(S,T);for(let ve=0;ve<l.symbolInstances.length;ve++){const _e=l.symbolInstances.get(ve),{numHorizontalGlyphVertices:Re,numVerticalGlyphVertices:Se,crossTileID:Ie,numIconVertices:ze,tileAnchorX:Ne,tileAnchorY:qe}=_e,Fe=d.has(Ie);let Pe=this.opacities[Ie];Fe?Pe=N:Pe||(Pe=ae,this.opacities[Ie]=Pe),d.add(Ie);const Qe=Re>0||Se>0,Xe=ze>0,Ue=this.placedOrientations[Ie],_t=Ue===a.aF.vertical,ut=Ue===a.aF.horizontal||Ue===a.aF.horizontalOnly;!Qe&&!Xe||Pe.isHidden()||ye++;let We=!1;if((Qe||Xe)&&T)for(const nt of l.activeReplacements){if(a.cJ(nt,b,a.cw.Symbol,C)||nt.min.x>Ne||Ne>nt.max.x||nt.min.y>qe||qe>nt.max.y)continue;const je=a.cK(Ne,qe,S.canonical,nt.footprintTileId.canonical);if(We=a.cL(je,nt),We)break}if(Qe){const nt=We?au:da(Pe.text);ce(l.text,Re,_t?au:nt),ce(l.text,Se,ut?au:nt);const je=Pe.text.isHidden(),{leftJustifiedTextSymbolIndex:ht,centerJustifiedTextSymbolIndex:ft,rightJustifiedTextSymbolIndex:Nt,verticalPlacedTextSymbolIndex:Bt}=_e,on=l.text.placedSymbolArray,Gt=je||_t?1:0;ht>=0&&(on.get(ht).hidden=Gt),ft>=0&&(on.get(ft).hidden=Gt),Nt>=0&&(on.get(Nt).hidden=Gt),Bt>=0&&(on.get(Bt).hidden=je||ut?1:0);const Tn=this.variableOffsets[Ie];Tn&&this.markUsedJustification(l,Tn.anchor,_e,Ue);const Vn=this.placedOrientations[Ie];Vn&&(this.markUsedJustification(l,"left",_e,Vn),this.markUsedOrientation(l,Vn,_e))}if(Xe){const nt=We?au:da(Pe.icon),{placedIconSymbolIndex:je,verticalPlacedIconSymbolIndex:ht}=_e,ft=l.icon.placedSymbolArray,Nt=Pe.icon.isHidden()?1:0;je>=0&&(ce(l.icon,ze,_t?au:nt),ft.get(je).hidden=Nt),ht>=0&&(ce(l.icon,_e.numVerticalIconVertices,ut?au:nt),ft.get(ht).hidden=Nt)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const nt=l.collisionArrays[ve];if(nt){let je=new a.P(0,0),ht=!0;if(nt.textBox||nt.verticalTextBox){if(q){const Nt=this.variableOffsets[Ie];Nt?(je=b0(Nt.anchor,Nt.width,Nt.height,Nt.textOffset,Nt.textScale),re&&je._rotate(ie?this.transform.angle:-this.transform.angle)):ht=!1}L&&(ht=!Pe.clipped),nt.textBox&&Pl(l.textCollisionBox.collisionVertexArray,Pe.text.placed,!ht||_t,je.x,je.y),nt.verticalTextBox&&Pl(l.textCollisionBox.collisionVertexArray,Pe.text.placed,!ht||ut,je.x,je.y)}const ft=ht&&!!(!ut&&nt.verticalIconBox);nt.iconBox&&Pl(l.iconCollisionBox.collisionVertexArray,Pe.icon.placed,ft,_e.hasIconTextFit?je.x:0,_e.hasIconTextFit?je.y:0),nt.verticalIconBox&&Pl(l.iconCollisionBox.collisionVertexArray,Pe.icon.placed,!ft,_e.hasIconTextFit?je.x:0,_e.hasIconTextFit?je.y:0)}}}if(l.fullyClipped=ye===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const ve=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=ve.invProjMatrix,l.placementViewportMatrix=ve.viewportMatrix,l.collisionCircleArray=ve.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,d){const y=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*y>l}setStale(){this.stale=!0}}function Pl(g,l,d,y,b){g.emplaceBack(l?1:0,d?1:0,y||0,b||0),g.emplaceBack(l?1:0,d?1:0,y||0,b||0),g.emplaceBack(l?1:0,d?1:0,y||0,b||0),g.emplaceBack(l?1:0,d?1:0,y||0,b||0)}const Ag=Math.pow(2,25),$b=Math.pow(2,24),Gb=Math.pow(2,17),xp=Math.pow(2,16),bp=Math.pow(2,9),qb=Math.pow(2,8),w0=Math.pow(2,1);function da(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const l=g.placed?1:0,d=Math.floor(127*g.opacity);return d*Ag+l*$b+d*Gb+l*xp+d*bp+l*qb+d*w0+l}const au=0;class Mt{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,d,y,b,T){const S=this._bucketParts;for(;this._currentTileIndex<l.length;)if(d.getBucketParts(S,b,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((C,k)=>C.sortKey-k.sortKey));this._currentPartIndex<S.length;){const C=S[this._currentPartIndex];if(d.placeLayerBucketPart(C,this._seenCrossTileIDs,y,C.symbolInstanceStart===0),this._currentPartIndex++,T())return!0}return!1}}class Wb{constructor(l,d,y,b,T,S,C,k,L){this.placement=new Vb(l,T,S,C,k,L),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(l,d,y,b){const T=a.e.now(),S=()=>{const C=a.e.now()-T;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=d[l[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=k)&&(!C.maxzoom||C.maxzoom>k)){const L=C,N=L.layout.get("symbol-z-elevate"),j=this._inProgressLayer=this._inProgressLayer||new Mt(L),G=a.am(C.source,C.scope);if(j.continuePlacement(N?b[G]:y[G],this.placement,this._showCollisionBoxes,C,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const wp=512/a.a4/2;class T0{constructor(l,d,y){this.tileID=l,this.bucketInstanceId=y,this.index=new a.cN(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=l.canonical.x*a.a4,T=l.canonical.y*a.a4;for(let S=0;S<d.length;S++){const{key:C,crossTileID:k,tileAnchorX:L,tileAnchorY:N}=d.get(S),j=Math.floor((b+L)*wp),G=Math.floor((T+N)*wp);this.index.add(j,G),this.keys.push(C),this.crossTileIDs.push(k)}this.index.finish()}findMatches(l,d,y){const b=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),T=wp/Math.pow(2,d.canonical.z-this.tileID.canonical.z),S=d.canonical.x*a.a4,C=d.canonical.y*a.a4;for(let k=0;k<l.length;k++){const L=l.get(k);if(L.crossTileID)continue;const{key:N,tileAnchorX:j,tileAnchorY:G}=L,q=Math.floor((S+j)*T),re=Math.floor((C+G)*T),ie=this.index.range(q-b,re-b,q+b,re+b);for(const ae of ie){const ce=this.crossTileIDs[ae];if(this.keys[ae]===N&&!y.has(ce)){y.add(ce),L.crossTileID=ce;break}}}}}class Hb{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Cg{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const d=Math.round((l-this.lng)/360);if(d!==0)for(const y in this.indexes){const b=this.indexes[y],T={};for(const S in b){const C=b[S];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+d),T[C.tileID.key]=C}this.indexes[y]=T}this.lng=l}addBucket(l,d,y){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let T=0;T<d.symbolInstances.length;T++)d.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const b=this.usedCrossTileIDs[l.overscaledZ];for(const T in this.indexes){const S=this.indexes[T];if(Number(T)>l.overscaledZ)for(const C in S){const k=S[C];k.tileID.isChildOf(l)&&k.findMatches(d.symbolInstances,l,b)}else{const C=S[l.scaledTo(Number(T)).key];C&&C.findMatches(d.symbolInstances,l,b)}}for(let T=0;T<d.symbolInstances.length;T++){const S=d.symbolInstances.get(T);S.crossTileID||(S.crossTileID=y.generate(),b.add(S.crossTileID))}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new T0(l,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(l,d){for(const y of d.crossTileIDs)this.usedCrossTileIDs[l].delete(y)}removeStaleBuckets(l){let d=!1;for(const y in this.indexes){const b=this.indexes[y];for(const T in b)l[b[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,b[T]),delete b[T],d=!0)}return d}}class gc{constructor(){this.layerIndexes={},this.crossTileIDs=new Hb,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,d,y,b){let T=this.layerIndexes[l.fqid];T===void 0&&(T=this.layerIndexes[l.fqid]=new Cg);let S=!1;const C={};b.name!=="globe"&&T.handleWrapJump(y);for(const k of d){const L=k.getBucket(l);L&&l.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(k.tileID,L,this.crossTileIDs)&&(S=!0),C[L.bucketInstanceId]=!0)}return T.removeStaleBuckets(C)&&(S=!0),S}pruneUnusedLayers(l){const d={};l.forEach(y=>{d[y]=!0});for(const y in this.layerIndexes)d[y]||delete this.layerIndexes[y]}}const E0=new a.U({data:new a.W(a.N.colorTheme.data)}),fa=(g,l)=>_n(g,l&&l.filter(d=>d.identifier!=="source.canvas")),Pg=a.ai(Cr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Ed=a.ai(Cr,["setCenter","setZoom","setBearing","setPitch"]),Zb={version:8,layers:[],sources:{}},Xb={duration:300,delay:0};class pa extends a.E{constructor(l,d={}){super(),this.map=l,this.scope=d.scope||"",this.globalId=null,this.fragments=[],this.importDepth=d.importDepth||0,this.importsCache=d.importsCache||new Map,this.resolvedImports=d.resolvedImports||new Set,this.transition=a.Q({},Xb),this._buildingIndex=new Go(this),this.crossTileSymbolIndex=new gc,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=d.styleChanges||new X,this.dispatcher=d.dispatcher?d.dispatcher:new a.by(a.bz(),this),d.imageManager?this.imageManager=d.imageManager:(this.imageManager=new hn,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=d.glyphManager?d.glyphManager:new a.cP(l._requestManager,d.localFontFamily?a.cQ.all:d.localIdeographFontFamily?a.cQ.ideographs:a.cQ.none,d.localFontFamily||d.localIdeographFontFamily),d.modelManager?this.modelManager=d.modelManager:(this.modelManager=new er(l._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=d.configOptions?d.configOptions:new Map,this._configDependentLayers=d.configDependentLayers?d.configDependentLayers:new Set,this._config=d.config,this._initialConfig=d.initialConfig,this.dispatcher.broadcast("setReferrer",a.cR());const y=this;this._rtlTextPluginCallback=pa.registerForPluginStateChange(b=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(T,S)=>{if(a.cS(T),S&&S.every(C=>C))for(const C in y._sourceCaches){const k=y._sourceCaches[C],L=k.getSource().type;L!=="vector"&&L!=="geojson"||k.reload()}})}),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const T=this.getOwnSource(b.sourceId);if(T&&T.vectorLayerIds)for(const S in this._layers){const C=this._layers[S];C.source===T.id&&this._validateLayer(C)}})}load(l){return l?(typeof l=="string"?this.loadURL(l):this.loadJSON(l),this):this}_getGlobalId(l){if(!l)return null;if(typeof l=="string"){if(a.cT(l))return l;const d=a.cU(l);if(!d.startsWith("http"))try{return new URL(d,location.href).toString()}catch{return d}return d}return`json://${a.cV(JSON.stringify(l))}`}_diffStyle(l,d,y){this.globalId=this._getGlobalId(l);const b=(T,S)=>{try{S(null,this.setState(T,y))}catch(C){S(C,!1)}};if(typeof l=="string"){const T=this.map._requestManager.normalizeStyleURL(l),S=this.map._requestManager.transformRequest(T,a.R.Style);a.h(S,(C,k)=>{C?this.fire(new a.f(C)):k&&b(k,d)})}else typeof l=="object"&&b(l,d)}loadURL(l,d={}){this.fire(new a.g("dataloading",{dataType:"style"}));const y=typeof d.validate=="boolean"?d.validate:!a.cT(l);this.globalId=this._getGlobalId(l),l=this.map._requestManager.normalizeStyleURL(l,d.accessToken),this.resolvedImports.add(l);const b=this.importsCache.get(l);if(b)return this._load(b,y);const T=this.map._requestManager.transformRequest(l,a.R.Style);this._request=a.h(T,(S,C)=>{if(this._request=null,S)this.fire(new a.f(S));else if(C)return this.importsCache.set(l,C),this._load(C,y)})}loadJSON(l,d={}){this.fire(new a.g("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(l),this._request=a.e.frame(()=>{this._request=null,this._load(l,d.validate!==!1)})}loadEmpty(){this.fire(new a.g("dataloading",{dataType:"style"})),this._load(Zb,!1)}_loadImports(l,d,y){if(this.importDepth>=4)return a.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const b=[];for(const T of l){const S=this._createFragmentStyle(T),C=new Promise(N=>{S.once("style.import.load",N),S.once("error",N)}).then(()=>this.mergeAll());if(b.push(C),this.resolvedImports.has(T.url)){S.loadEmpty();continue}const k=T.data||this.importsCache.get(T.url);k?(S.loadJSON(k,{validate:d}),this._isInternalStyle(k)&&(S.globalId=null)):T.url?S.loadURL(T.url,{validate:d}):S.loadEmpty();const L={style:S,id:T.id,config:T.config};if(y){const N=this.fragments.findIndex(({id:j})=>j===y);this.fragments=this.fragments.slice(0,N).concat(L).concat(this.fragments.slice(N))}else this.fragments.push(L)}return Promise.allSettled(b)}getImportGlobalIds(l=this,d=new Set){for(const y of l.fragments)y.style.globalId&&d.add(y.style.globalId),this.getImportGlobalIds(y.style,d);return[...d.values()]}_createFragmentStyle(l){const d=this.scope?a.am(l.id,this.scope):l.id;let y;const b=this._initialConfig&&this._initialConfig[d];(l.config||b)&&(y=a.Q({},l.config,b));const T=new pa(this.map,{scope:d,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:y,configOptions:this.options,configDependentLayers:this._configDependentLayers});return T.setEventedParent(this.map,{style:T}),T}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(l){return this.isRootStyle()&&(l.fragment||!!l.schema&&l.fragment!==!1)}_load(l,d){const y=l.schema;if(this._isInternalStyle(l)){const S=a.Q({},Zb,{imports:[{id:"basemap",data:l,url:""}]});return void this._load(S,d)}if(this.updateConfig(this._config,y),d&&fa(this,te(l)))return;this._loaded=!0,this.stylesheet=a.cW(l);const b=()=>{for(const L in l.sources)this.addSource(L,l.sources[L],{validate:!1,isInitialLoad:!0});l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(l.glyphs,this.scope);const S=gp(this.stylesheet.layers);if(this._order=S.map(L=>L.id),this.stylesheet.light&&a.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const L=this.stylesheet.lights[0];this.light=new ur(L.properties,L.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ur(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const L of S){const N=a.c$(L,this.scope,this._styleColorTheme.lut,this.options);N.configDependencies.size!==0&&this._configDependentLayers.add(N.fqid),N.setEventedParent(this,{layer:{id:N.id}}),this._layers[N.id]=N,this._serializedLayers[N.id]=N.serialize();const j=this.getOwnLayerSourceCache(N),G=!!this.directionalLight&&this.directionalLight.shadowsEnabled();j&&N.canCastShadows()&&G&&(j.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const C=this.stylesheet.terrain;C&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(C,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.g("data",{dataType:"style"}));const k=this.isRootStyle();l.imports?this._loadImports(l.imports,d).then(()=>{this._reloadImports(),this.fire(new a.g(k?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new a.g(k?"style.load":"style.import.load")))},T=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=T,T){const S=this._evaluateColorThemeData(T);this._loadColorTheme(S).then(()=>{b()}).catch(C=>{a.w(`Couldn't load color theme from the stylesheet: ${C}`),b()})}else this._styleColorTheme.lut=null,b()}isRootStyle(){return this.importDepth===0}mergeAll(){let l,d,y,b,T,S,C,k;const L={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(N=>{if(N.stylesheet){if(N.light!=null&&(l=N.light),N.stylesheet.lights)for(const j of N.stylesheet.lights)j.type==="ambient"&&N.ambientLight!=null&&(d=N.ambientLight),j.type==="directional"&&N.directionalLight!=null&&(y=N.directionalLight);b=this._prioritizeTerrain(b,N.terrain,N.stylesheet.terrain),N.stylesheet.fog&&N.fog!=null&&(T=N.fog),N.stylesheet.camera!=null&&(k=N.stylesheet.camera),N.stylesheet.projection!=null&&(S=N.stylesheet.projection),N.stylesheet.transition!=null&&(C=N.stylesheet.transition),L[N.scope]=N._styleColorTheme}}),this.light=l,this.ambientLight=d,this.directionalLight=y,this.fog=T,this._styleColorThemeForScope=L,b===null?delete this.terrain:this.terrain=b,this.camera=k||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=a.Q({},Xb,C),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(l){const d=y=>{for(const b of y.fragments)d(b.style);l(y)};d(this)}_prioritizeTerrain(l,d,y){const b=l&&l.drapeRenderMode===0;return y===null?d&&d.drapeRenderMode===0?d:b?l:null:d!=null&&(!l||b||d&&d.drapeRenderMode===1)?d:l}mergeTerrain(){let l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(d=>{l=this._prioritizeTerrain(l,d.terrain,d.stylesheet.terrain)}),l===null?delete this.terrain:this.terrain=l}mergeProjection(){let l;this.forEachFragmentStyle(d=>{d.stylesheet.projection!=null&&(l=d.stylesheet.projection)}),this.projection=l||{name:"mercator"}}mergeSources(){const l={},d={},y={};this.forEachFragmentStyle(b=>{for(const T in b._sourceCaches){const S=a.am(T,b.scope);l[S]=b._sourceCaches[T]}for(const T in b._otherSourceCaches){const S=a.am(T,b.scope);d[S]=b._otherSourceCaches[T]}for(const T in b._symbolSourceCaches){const S=a.am(T,b.scope);y[S]=b._symbolSourceCaches[T]}}),this._mergedSourceCaches=l,this._mergedOtherSourceCaches=d,this._mergedSymbolSourceCaches=y}mergeLayers(){const l={},d=[],y={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(const C of S._order){const k=S._layers[C];if(k.type==="slot"){const L=a.cX(C);if(l[L])continue;l[L]=[]}k.slot&&l[k.slot]?l[k.slot].push(k):d.push(k)}}),this._mergedOrder=[],this._clipLayerIndices=[];let b=0;const T=(S=[])=>{for(const C of S)if(C.type==="slot"){const k=a.cX(C.id);l[k]&&T(l[k]),this._mergedSlots.push(k)}else{const k=a.am(C.id,C.scope);this._mergedOrder.push(k),y[k]=C,C.is3D()&&(this._has3DLayers=!0),C.type==="circle"&&(this._hasCircleLayers=!0),C.type==="symbol"&&(this._hasSymbolLayers=!0),C.type==="clip"&&this._clipLayerIndices.push(b),b++}};T(d),this._mergedOrder.sort((S,C)=>{const k=y[S],L=y[C];return k.hasInitialOcclusionOpacityProperties?L.is3D()?1:0:k.is3D()&&L.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=y,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(l){return this.stylesheet.camera=a.Q({},this.stylesheet.camera,l),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(l){return l.data?function(d,y,b){const T=a.Q({},y);for(const C of Object.keys(a.N.colorTheme))T[C]===void 0&&(T[C]=a.N.colorTheme[C].default);const S=new a.O(E0,d,new Map(b));return S.setTransitionOrValue(T,b),S.untransitioned().possiblyEvaluate(new a.Y(0))}(this.scope,l,this.options).get("data"):null}_loadColorTheme(l){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const d=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((y,b)=>{const T="data:image/png;base64,";if(!l||l.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void y();let S=l;S.startsWith(T)||(S=T+S);const C="mapbox-reserved-lut",k=new Image;k.src=S,k.onerror=()=>{this._styleColorTheme.lutLoading=!1,b(new Error("Failed to load image data"))},k.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==d)return void y();this._styleColorTheme.lutLoading=!1;const{width:L,height:N,data:j}=a.e.getImageData(k);if(N>32)return void b(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==N*N)return void b(new Error("The width of the image must be equal to the height squared."));this.getImage(C)&&this.removeImage(C),this.addImage(C,{data:new a.j({width:L,height:N},j),pixelRatio:1,sdf:!1,version:0});const G=this.imageManager.getImage(C,this.scope);G?(this._styleColorTheme.lut={image:G.data,data:l},y()):b(new Error("Missing LUT image."))}})}getLut(l){const d=this._styleColorThemeForScope[l];return d?d.lut:null}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(l){this._spriteRequest=function(d,y,b){let T,S,C;const k=a.e.devicePixelRatio>1?"@2x":"";let L=a.h(y.transformRequest(y.normalizeSpriteURL(d,k,".json"),a.R.SpriteJSON),(G,q)=>{L=null,C||(C=G,T=q,j())}),N=a.i(y.transformRequest(y.normalizeSpriteURL(d,k,".png"),a.R.SpriteImage),(G,q)=>{N=null,C||(C=G,S=q,j())});function j(){if(C)b(C);else if(T&&S){const G=a.e.getImageData(S),q={};for(const re in T){const{width:ie,height:ae,x:ce,y:ye,sdf:ve,pixelRatio:_e,stretchX:Re,stretchY:Se,content:Ie}=T[re],ze=new a.j({width:ie,height:ae});a.j.copy(G,ze,{x:ce,y:ye},{x:0,y:0},{width:ie,height:ae},null),q[re]={data:ze,pixelRatio:_e,sdf:ve,stretchX:Re,stretchY:Se,content:Ie}}b(null,q)}}return{cancel(){L&&(L.cancel(),L=null),N&&(N.cancel(),N=null)}}}(l,this.map._requestManager,(d,y)=>{if(this._spriteRequest=null,d)this.fire(new a.f(d));else if(y)for(const b in y)this.imageManager.addImage(b,this.scope,y[b]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.g("data",{dataType:"style"}))})}_validateLayer(l){const d=this.getOwnSource(l.source);if(!d)return;const y=l.sourceLayer;y&&(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(y)===-1)&&this.fire(new a.f(new Error(`Source layer "${y}" does not exist on source "${d.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:l}of this.fragments)if(!l.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((l,d)=>{const y=this.fragments[d];return y&&y.style&&(l.data=y.style.serialize()),l})}_serializeSources(){const l={};for(const d in this._sourceCaches){const y=this._sourceCaches[d].getSource();l[y.id]||(l[y.id]=y.serialize())}return l}_serializeLayers(l){const d=[];for(const y of l){const b=this._layers[y];b&&b.type!=="custom"&&d.push(b.serialize())}return d}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(l){return!!this.terrain&&l.isDraped(this.getLayerSourceCache(l))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(l){const d=this.getOwnLayer(l);if(d)return d;this.fire(new a.f(new Error(`The layer '${l}' does not exist in the map's style.`)))}_checkSource(l){const d=this.getOwnSource(l);if(d)return d;this.fire(new a.f(new Error(`The source '${l}' does not exist in the map's style.`)))}precompilePrograms(l,d){const y=this.map.painter;if(y)for(let b=l.minzoom||0;b<(l.maxzoom||25.5);b++){const T=l.getProgramIds();if(T)for(const S of T){const C=l.getDefaultProgramParams(S,d.zoom,this._styleColorTheme.lut);C&&(y.style=this,this.fog&&(y._fogVisible=!0,C.overrideFog=!0,y.getOrCreateProgram(S,C)),y._fogVisible=!1,C.overrideFog=!1,y.getOrCreateProgram(S,C),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(C.overrideRtt=!0,y.getOrCreateProgram(S,C)))}}}update(l){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(l),this.directionalLight&&this.directionalLight.recalculate(l);const d=this.calculateLightsBrightness();l.brightness=d||0,d!==this._brightness&&(this._brightness=d,this.dispatcher.broadcast("setBrightness",d));const y=this._changes.isDirty();let b=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const C in S){const{updatedIds:k,removedIds:L}=S[C];(k||L)&&(this._updateWorkerLayers(C,k,L),b=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(l),this.light&&this.light.updateTransitions(l),this.ambientLight&&this.ambientLight.updateTransitions(l),this.directionalLight&&this.directionalLight.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._changes.reset()}const T={};for(const S in this._mergedSourceCaches){const C=this._mergedSourceCaches[S];T[S]=C.used,C.used=!1,C.tileCoverLift=0}for(const S of this._mergedOrder){const C=this._mergedLayers[S];if(C.recalculate(l,this._availableImages),!C.isHidden(l.zoom)){const k=this.getLayerSourceCache(C);k&&(k.used=!0,k.tileCoverLift=Math.max(k.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(C,l)}):this.precompilePrograms(C,l))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&b&&this.mergeLayers();for(const S in T){const C=this._mergedSourceCaches[S];T[S]!==C.used&&C.getSource().fire(new a.g("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),y&&this.fire(new a.g("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=this._changes.getUpdatedImages();if(l.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],l);this._changes.resetUpdatedImages()}}_updateWorkerLayers(l,d,y){const b=this.getFragmentStyle(l);b&&this.dispatcher.broadcast("updateLayers",{layers:d?b._serializeLayers(d):[],scope:l,removedIds:y||[],options:b.options})}setState(l,d){if(this._checkLoaded(),fa(this,te(l)))return!1;(l=a.cW(l)).layers=gp(l.layers);const y=function(S,C){if(!S)return[{command:Cr.setStyle,args:[C]}];let k=[];try{if(!a.d(S.version,C.version))return[{command:Cr.setStyle,args:[C]}];if(a.d(S.center,C.center)||k.push({command:Cr.setCenter,args:[C.center]}),a.d(S.zoom,C.zoom)||k.push({command:Cr.setZoom,args:[C.zoom]}),a.d(S.bearing,C.bearing)||k.push({command:Cr.setBearing,args:[C.bearing]}),a.d(S.pitch,C.pitch)||k.push({command:Cr.setPitch,args:[C.pitch]}),a.d(S.sprite,C.sprite)||k.push({command:Cr.setSprite,args:[C.sprite]}),a.d(S.glyphs,C.glyphs)||k.push({command:Cr.setGlyphs,args:[C.glyphs]}),a.d(S.imports,C.imports)||function(q=[],re=[],ie){re=re||[];const ae=(q=q||[]).map(Eg),ce=re.map(Eg),ye=q.reduce(mc,{}),ve=re.reduce(mc,{}),_e=ae.slice();let Re,Se,Ie,ze;for(Re=0,Se=0;Re<ae.length;Re++)Ie=ae[Re],ve.hasOwnProperty(Ie)?Se++:(ie.push({command:Cr.removeImport,args:[Ie]}),_e.splice(_e.indexOf(Ie,Se),1));for(Re=0,Se=0;Re<ce.length;Re++)Ie=ce[ce.length-1-Re],_e[_e.length-1-Re]!==Ie&&(ye.hasOwnProperty(Ie)?(ie.push({command:Cr.removeImport,args:[Ie]}),_e.splice(_e.lastIndexOf(Ie,_e.length-Se),1)):Se++,ze=_e[_e.length-Re],ie.push({command:Cr.addImport,args:[ve[Ie],ze]}),_e.splice(_e.length-Re,0,Ie));for(const Ne of re){const qe=ye[Ne.id];qe&&!a.d(qe,Ne)&&ie.push({command:Cr.updateImport,args:[Ne.id,Ne]})}}(S.imports,C.imports,k),a.d(S.transition,C.transition)||k.push({command:Cr.setTransition,args:[C.transition]}),a.d(S.light,C.light)||k.push({command:Cr.setLight,args:[C.light]}),a.d(S.fog,C.fog)||k.push({command:Cr.setFog,args:[C.fog]}),a.d(S.projection,C.projection)||k.push({command:Cr.setProjection,args:[C.projection]}),a.d(S.lights,C.lights)||k.push({command:Cr.setLights,args:[C.lights]}),a.d(S.camera,C.camera)||k.push({command:Cr.setCamera,args:[C.camera]}),!a.d(S["color-theme"],C["color-theme"]))return[{command:Cr.setStyle,args:[C]}];const L={},N=[];(function(q,re,ie,ae){let ce;for(ce in re=re||{},q=q||{})q.hasOwnProperty(ce)&&(re.hasOwnProperty(ce)||Fb(ce,ie,ae));for(ce in re){if(!re.hasOwnProperty(ce))continue;const ye=re[ce];q.hasOwnProperty(ce)?a.d(q[ce],ye)||(q[ce].type==="geojson"&&ye.type==="geojson"&&_p(q,re,ce)?ie.push({command:Cr.setGeoJSONSourceData,args:[ce,ye.data]}):_C(ce,re,ie,ae)):Td(ce,re,ie)}})(S.sources,C.sources,N,L);const j=[];S.layers&&S.layers.forEach(q=>{q.source&&L[q.source]?k.push({command:Cr.removeLayer,args:[q.id]}):j.push(q)});let G=S.terrain;G&&L[G.source]&&(k.push({command:Cr.setTerrain,args:[void 0]}),G=void 0),k=k.concat(N),a.d(G,C.terrain)||k.push({command:Cr.setTerrain,args:[C.terrain]}),function(q,re,ie){re=re||[];const ae=(q=q||[]).map(Eg),ce=re.map(Eg),ye=q.reduce(mc,{}),ve=re.reduce(mc,{}),_e=ae.slice(),Re=Object.create(null);let Se,Ie,ze,Ne,qe,Fe,Pe;for(Se=0,Ie=0;Se<ae.length;Se++)ze=ae[Se],ve.hasOwnProperty(ze)?Ie++:(ie.push({command:Cr.removeLayer,args:[ze]}),_e.splice(_e.indexOf(ze,Ie),1));for(Se=0,Ie=0;Se<ce.length;Se++)ze=ce[ce.length-1-Se],_e[_e.length-1-Se]!==ze&&(ye.hasOwnProperty(ze)?(ie.push({command:Cr.removeLayer,args:[ze]}),_e.splice(_e.lastIndexOf(ze,_e.length-Ie),1)):Ie++,Fe=_e[_e.length-Se],ie.push({command:Cr.addLayer,args:[ve[ze],Fe]}),_e.splice(_e.length-Se,0,ze),Re[ze]=!0);for(Se=0;Se<ce.length;Se++)if(ze=ce[Se],Ne=ye[ze],qe=ve[ze],!Re[ze]&&!a.d(Ne,qe))if(a.d(Ne.source,qe.source)&&a.d(Ne["source-layer"],qe["source-layer"])&&a.d(Ne.type,qe.type)){for(Pe in ou(Ne.layout,qe.layout,ie,ze,null,Cr.setLayoutProperty),ou(Ne.paint,qe.paint,ie,ze,null,Cr.setPaintProperty),a.d(Ne.slot,qe.slot)||ie.push({command:Cr.setSlot,args:[ze,qe.slot]}),a.d(Ne.filter,qe.filter)||ie.push({command:Cr.setFilter,args:[ze,qe.filter]}),a.d(Ne.minzoom,qe.minzoom)&&a.d(Ne.maxzoom,qe.maxzoom)||ie.push({command:Cr.setLayerZoomRange,args:[ze,qe.minzoom,qe.maxzoom]}),Ne)Ne.hasOwnProperty(Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&Pe!=="slot"&&(Pe.indexOf("paint.")===0?ou(Ne[Pe],qe[Pe],ie,ze,Pe.slice(6),Cr.setPaintProperty):a.d(Ne[Pe],qe[Pe])||ie.push({command:Cr.setLayerProperty,args:[ze,Pe,qe[Pe]]}));for(Pe in qe)qe.hasOwnProperty(Pe)&&!Ne.hasOwnProperty(Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&Pe!=="slot"&&(Pe.indexOf("paint.")===0?ou(Ne[Pe],qe[Pe],ie,ze,Pe.slice(6),Cr.setPaintProperty):a.d(Ne[Pe],qe[Pe])||ie.push({command:Cr.setLayerProperty,args:[ze,Pe,qe[Pe]]}))}else ie.push({command:Cr.removeLayer,args:[ze]}),Fe=_e[_e.lastIndexOf(ze)+1],ie.push({command:Cr.addLayer,args:[qe,Fe]})}(j,C.layers,k)}catch(L){console.warn("Unable to compute style diff:",L),k=[{command:Cr.setStyle,args:[C]}]}return k}(this.serialize(),l).filter(S=>!(S.command in Ed));if(y.length===0)return!1;const b=y.filter(S=>!(S.command in Pg));if(b.length>0)throw new Error(`Unimplemented: ${b.map(S=>S.command).join(", ")}.`);const T=[];return y.forEach(S=>{T.push(this[S.command].apply(this,S.args))}),d&&Promise.all(T).then(d),this.stylesheet=l,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(l,d){return this.getImage(l)?this.fire(new a.f(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,this.scope,d),this._afterImageUpdated(l),this)}updateImage(l,d){this.imageManager.updateImage(l,this.scope,d)}getImage(l){return this.imageManager.getImage(l,this.scope)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l,this.scope),this._afterImageUpdated(l),this):this.fire(new a.f(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(l),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new a.g("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(l,d,y={}){return this._checkLoaded(),this._validate(gt,`models.${l}`,d,null,y)||(this.modelManager.addModel(l,d,this.scope),this._changes.setDirty()),this}hasModel(l){return this.modelManager.hasModel(l,this.scope)}removeModel(l){return this.hasModel(l)?(this.modelManager.removeModel(l,this.scope),this):this.fire(new a.f(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(l,d,y={}){if(this._checkLoaded(),this.getOwnSource(l)!==void 0)throw new Error(`There is already a source with ID "${l}".`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(le,`sources.${l}`,d,null,y))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const b=ue(l,d,this.dispatcher,this);b.scope=this.scope,b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(b.id),source:b.serialize(),sourceId:b.id}));const T=S=>{const C=(S?"symbol:":"other:")+b.id,k=a.am(C,this.scope),L=this._sourceCaches[C]=new a.bx(k,b,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[b.id]=L,L.onAdd(this.map)};T(!1),d.type!=="vector"&&d.type!=="geojson"||T(!0),b.onAdd&&b.onAdd(this.map),y.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(l){this._checkLoaded();const d=this.getOwnSource(l);if(!d)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===l)return this.fire(new a.f(new Error(`Source "${l}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===l)return this.fire(new a.f(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const y=this.getOwnSourceCaches(l);for(const b of y){const T=a.cX(b.id);delete this._sourceCaches[T],this._changes.discardSourceCacheUpdate(b.id),b.fire(new a.g("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles()}return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],this.mergeSources(),d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(l,d){this._checkLoaded(),this.getOwnSource(l).setData(d),this._changes.setDirty()}getOwnSource(l){const d=this.getOwnSourceCache(l);return d&&d.getSource()}getOwnSources(){const l=[];for(const d in this._otherSourceCaches){const y=this.getOwnSourceCache(d);y&&l.push(y.getSource())}return l}areTilesLoaded(){const l=this._mergedSourceCaches;for(const d in l){const y=l[d]._tiles;for(const b in y){const T=y[b];if(T.state!=="loaded"&&T.state!=="errored")return!1}}return!0}setLights(l){if(this._checkLoaded(),!l)return delete this.ambientLight,void delete this.directionalLight;const d=this._getTransitionParameters();for(const b of l){if(this._validate(Oe,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(b),T.updateTransitions(d)}else this.ambientLight=new nc(b,od||(od=new a.U({color:new a.W(a.N.properties_light_ambient.color),intensity:new a.W(a.N.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(b),T.updateTransitions(d)}else this.directionalLight=new nc(b,ad||(ad=new a.U({direction:new a.a6(a.N.properties_light_directional.direction),color:new a.W(a.N.properties_light_directional.color),intensity:new a.W(a.N.properties_light_directional.intensity),"cast-shadows":new a.W(a.N.properties_light_directional["cast-shadows"]),"shadow-intensity":new a.W(a.N.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const y=new a.Y(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const l=this.directionalLight,d=this.ambientLight;if(!l||!d)return;const y=j=>.2126*(j[0]<=.03928?j[0]/12.92:Math.pow((j[0]+.055)/1.055,2.4))+.7152*(j[1]<=.03928?j[1]/12.92:Math.pow((j[1]+.055)/1.055,2.4))+.0722*(j[2]<=.03928?j[2]/12.92:Math.pow((j[2]+.055)/1.055,2.4)),b=l.properties.get("color").toRenderColor(null).toArray01(),T=l.properties.get("intensity"),S=l.properties.get("direction"),C=1-a.ad(S.x,S.y,S.z)[2]/90,k=y(b)*T*C,L=d.properties.get("color").toRenderColor(null).toArray01(),N=d.properties.get("intensity");return(k+y(L)*N)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const l=[];return this.directionalLight&&l.push(this.directionalLight.get()),this.ambientLight&&l.push(this.ambientLight.get()),l}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(l){if(!l)return this;if(a.cY(l)){const d=a.cZ(l),y=this.fragments.find(({id:T})=>T===d);if(!y)throw new Error(`Style import not found: ${l}`);const b=a.cX(l);return y.style.getFragmentStyle(b)}{const d=this.fragments.find(({id:y})=>y===l);if(!d)throw new Error(`Style import not found: ${l}`);return d.style}}getConfigProperty(l,d){const y=this.getFragmentStyle(l);if(!y)return null;const b=a.am(d,y.scope),T=y.options.get(b),S=T?T.value||T.default:null;return S?S.serialize():null}setConfigProperty(l,d,y){const b=this.getFragmentStyle(l);if(!b)return;const T=b.stylesheet.schema;if(!T||!T[d])return;const S=a.z(y);if(S.result!=="success")return void fa(this,S.value);const C=S.value.expression,k=a.am(d,b.scope),L=b.options.get(k);if(!L)return;let N;const{minValue:j,maxValue:G,stepValue:q,type:re,values:ie}=T[d],ae=a.z(T[d].default);ae.result==="success"&&(N=ae.value.expression),N?(this.options.set(k,{...L,value:C,default:N,minValue:j,maxValue:G,stepValue:q,type:re,values:ie}),this.updateConfigDependencies(d)):this.fire(new a.f(new Error(`No schema defined for the config option "${d}" in the "${l}" fragment.`)))}getConfig(l){const d=this.getFragmentStyle(l);if(!d)return null;const y=d.stylesheet.schema;if(!y)return null;const b={};for(const T in y){const S=a.am(T,d.scope),C=d.options.get(S),k=C?C.value||C.default:null;b[T]=k?k.serialize():null}return b}setConfig(l,d){const y=this.getFragmentStyle(l);y&&(y.updateConfig(d,y.stylesheet.schema),this.updateConfigDependencies())}getSchema(l){const d=this.getFragmentStyle(l);return d?d.stylesheet.schema:null}setSchema(l,d){const y=this.getFragmentStyle(l);y&&(y.stylesheet.schema=d,y.updateConfig(y._config,d),this.updateConfigDependencies())}updateConfig(l,d){if(this._config=l,l||d)if(d)for(const y in d){let b,T;const S=a.z(d[y].default);if(S.result==="success"&&(b=S.value.expression),l&&l[y]!==void 0){const G=a.z(l[y]);G.result==="success"&&(T=G.value.expression)}const{minValue:C,maxValue:k,stepValue:L,type:N,values:j}=d[y];if(b){const G=a.am(y,this.scope);this.options.set(G,{default:b,value:T,minValue:C,maxValue:k,stepValue:L,type:N,values:j})}else this.fire(new a.f(new Error(`No schema defined for config option "${y}".`)))}else this.fire(new a.f(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(l){for(const d of this._configDependentLayers){const y=this.getLayer(d);if(y){if(l&&!y.configDependencies.has(l))continue;y.possiblyEvaluateVisibility(),this._updateLayer(y)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(d=>{if(d._styleColorTheme.colorTheme){const y=d._evaluateColorThemeData(d._styleColorTheme.colorTheme);(!d._styleColorTheme.lut&&y!==""||d._styleColorTheme.lut&&y!==d._styleColorTheme.lut.data)&&d.setColorTheme(d._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(l,d,y={}){this._checkLoaded();const b=l.id;if(this._layers[b])return void this.fire(new a.f(new Error(`Layer with id "${b}" already exists on this map`)));let T;if(l.type==="custom"){if(fa(this,a.c_(l)))return;T=a.c$(l,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof l.source=="object"&&(this.addSource(b,l.source),l=a.cW(l),l=a.Q(l,{source:b})),this._validate(tt,`layers.${b}`,l,{arrayIndex:-1},y))return;T=a.c$(l,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(T),T.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[T.id]=T.serialize()}T.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid);let S=this._order.length;if(d){const N=this._order.indexOf(d);if(N===-1)return void this.fire(new a.f(new Error(`Layer with id "${d}" does not exist on this map.`)));T.slot===this._layers[d].slot?S=N:a.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,b),this._layerOrderChanged=!0,this._layers[b]=T;const C=this.getOwnLayerSourceCache(T),k=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&T.canCastShadows()&&k&&(C.castsShadows=!0);const L=this._changes.getRemovedLayer(T);if(L&&T.source&&C&&T.type!=="custom"){this._changes.discardLayerRemoval(T);const N=a.am(T.source,T.scope);L.type!==T.type?this._changes.updateSourceCache(N,"clear"):(this._changes.updateSourceCache(N,"reload"),C.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),T.scope=this.scope,this.mergeLayers()}moveLayer(l,d){this._checkLoaded();const y=this._checkLayer(l);if(!y||l===d)return;const b=this._order.indexOf(l);this._order.splice(b,1);let T=this._order.length;if(d){const S=this._order.indexOf(d);if(S===-1)return void this.fire(new a.f(new Error(`Layer with id "${d}" does not exist on this map.`)));y.slot===this._layers[d].slot?T=S:a.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,l),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(l){this._checkLoaded();const d=this._checkLayer(l);if(!d)return;d.setEventedParent(null);const y=this._order.indexOf(l);this._order.splice(y,1),delete this._layers[l],delete this._serializedLayers[l],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(d.fqid),this._changes.removeLayer(d);const b=this.getOwnLayerSourceCache(d);if(b&&b.castsShadows){let T=!1;for(const S in this._layers)if(this._layers[S].source===d.source&&this._layers[S].canCastShadows()){T=!0;break}b.castsShadows=T}d.onRemove&&d.onRemove(this.map),this.mergeLayers()}getOwnLayer(l){return this._layers[l]}hasLayer(l){return l in this._mergedLayers}hasLayerType(l){for(const d in this._layers)if(this._layers[d].type===l)return!0;return!1}setLayerZoomRange(l,d,y){this._checkLoaded();const b=this._checkLayer(l);b&&(b.minzoom===d&&b.maxzoom===y||(d!=null&&(b.minzoom=d),y!=null&&(b.maxzoom=y),this._updateLayer(b)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(l,d){this._checkLoaded();const y=this._checkLayer(l);y&&y.slot!==d&&(y.slot=d,this._updateLayer(y))}setFilter(l,d,y={}){this._checkLoaded();const b=this._checkLayer(l);if(b&&!a.d(b.filter,d))return d==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate($e,`layers.${b.id}.filter`,d,{layerType:b.type},y)||(b.filter=a.cW(d),this._updateLayer(b)))}getFilter(l){const d=this._checkLayer(l);if(d)return a.cW(d.filter)}setLayoutProperty(l,d,y,b={}){this._checkLoaded();const T=this._checkLayer(l);if(T&&!a.d(T.getLayoutProperty(d),y)){if(y!=null&&(!b||b.validate!==!1)&&fa(T,mt.call(te,{key:`layers.${l}.layout.${d}`,layerType:T.type,objectKey:d,value:y,styleSpec:a.N,style:{glyphs:!0,sprite:!0}})))return;T.setLayoutProperty(d,y),T.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),this._updateLayer(T)}}getLayoutProperty(l,d){const y=this._checkLayer(l);if(y)return y.getLayoutProperty(d)}setPaintProperty(l,d,y,b={}){this._checkLoaded();const T=this._checkLayer(l);if(!T||a.d(T.getPaintProperty(d),y)||y!=null&&(!b||b.validate!==!1)&&fa(T,Je.call(te,{key:`layers.${l}.paint.${d}`,layerType:T.type,objectKey:d,value:y,styleSpec:a.N})))return;const S=T.setPaintProperty(d,y);T.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),S&&this._updateLayer(T),this._changes.updatePaintProperties(T)}getPaintProperty(l,d){const y=this._checkLayer(l);if(y)return y.getPaintProperty(d)}setFeatureState(l,d){this._checkLoaded();const y=l.source,b=l.sourceLayer,T=this._checkSource(y);if(!T)return;const S=T.type;if(S==="geojson"&&b)return void this.fire(new a.f(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!b)return void this.fire(new a.f(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new a.f(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(y);for(const k of C)k.setFeatureState(b,l.id,d)}removeFeatureState(l,d){this._checkLoaded();const y=l.source,b=this._checkSource(y);if(!b)return;const T=b.type,S=T==="vector"?l.sourceLayer:void 0;if(T==="vector"&&!S)return void this.fire(new a.f(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new a.f(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(y);for(const k of C)k.removeFeatureState(S,l.id,d)}getFeatureState(l){this._checkLoaded();const d=l.source,y=l.sourceLayer,b=this._checkSource(d);if(b){if(b.type!=="vector"||y)return l.id===void 0&&this.fire(new a.f(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(d)[0].getFeatureState(y,l.id);this.fire(new a.f(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(l){return this.stylesheet.transition=a.Q({},this.stylesheet.transition,l),this.transition=this.stylesheet.transition,this}getTransition(){return a.Q({},this.stylesheet.transition)}serialize(){this._checkLoaded();const l=this.getTerrain(),d=l&&this.terrain&&this.terrain.scope===this.scope?l:this.stylesheet.terrain;return a.d0({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:d,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},y=>y!==void 0)}_updateLayer(l){this._changes.updateLayer(l);const d=this.getLayerSourceCache(l),y=a.am(l.source,l.scope),b=this._changes.getUpdatedSourceCaches();l.source&&!b[y]&&d&&d.getSource().type!=="raster"&&(this._changes.updateSourceCache(y,"reload"),d.pause()),l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const d=C=>this._mergedLayers[C].type==="fill-extrusion"||this._mergedLayers[C].type==="model",y=this.order,b={},T=[];for(let C=y.length-1;C>=0;C--){const k=y[C];if(d(k)){b[k]=C;for(const L of l){const N=L[k];if(N)for(const j of N)T.push(j)}}}T.sort((C,k)=>k.intersectionZ-C.intersectionZ);const S=[];for(let C=y.length-1;C>=0;C--){const k=y[C];if(d(k))for(let L=T.length-1;L>=0;L--){const N=T[L].feature;if(N.layer&&b[N.layer.id]<C)break;S.push(N),T.pop()}else for(const L of l){const N=L[k];if(N)for(const j of N)S.push(j.feature)}}return S}queryRenderedFeatures(l,d,y){d&&d.filter&&this._validate($e,"queryRenderedFeatures.filter",d.filter,null,d),d.scope=this.scope,d.availableImages=this._availableImages,d.serializedLayers=this._serializedLayers;const b={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new a.f(new Error("parameters.layers must be an Array."))),[];for(const L of d.layers){const N=this._mergedLayers[L];if(!N)return this.fire(new a.f(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];b[N.source]=!0}}const T=[],S=d.serializedLayers||{},C=d&&d.layers?d.layers.some(L=>{const N=this.getLayer(L);return N&&N.is3D()}):this.has3DLayers(),k=ha.createFromScreenPoints(l,y);for(const L in this._mergedSourceCaches){const N=this._mergedSourceCaches[L].getSource();if(!N||N.scope!==d.scope)continue;const j=this._mergedSourceCaches[L].getSource().id;d.layers&&!b[j]||T.push(pc(this._mergedSourceCaches[L],this._mergedLayers,S,k,d,y,C,!!this.map._showQueryGeometry))}return this.placement&&T.push(function(L,N,j,G,q,re,ie){const ae={},ce=re.queryRenderedSymbols(G),ye=[];for(const ve of Object.keys(ce).map(Number))ye.push(ie[ve]);ye.sort(v0);for(const ve of ye){const _e=ve.featureIndex.lookupSymbolFeatures(ce[ve.bucketInstanceId],N,ve.bucketIndex,ve.sourceLayerIndex,q.filter,q.layers,q.availableImages,L);for(const Re in _e){const Se=ae[Re]=ae[Re]||[],Ie=_e[Re];Ie.sort((ze,Ne)=>{const qe=ve.featureSortOrder;if(qe){const Fe=qe.indexOf(ze.featureIndex);return qe.indexOf(Ne.featureIndex)-Fe}return Ne.featureIndex-ze.featureIndex});for(const ze of Ie)Se.push(ze)}}for(const ve in ae)ae[ve].forEach(_e=>{const Re=_e.feature,Se=j(L[ve]);if(!Se)return;const Ie=Se.getFeatureState(Re.layer["source-layer"],Re.id);Re.source=Re.layer.source,Re.layer["source-layer"]&&(Re.sourceLayer=Re.layer["source-layer"]),Re.state=Ie});return ae}(this._mergedLayers,S,this.getLayerSourceCache.bind(this),k.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(l,d){d&&d.filter&&this._validate($e,"querySourceFeatures.filter",d.filter,null,d);const y=this.getOwnSourceCaches(l);let b=[];for(const T of y)b=b.concat(mC(T,d));return b}addSourceType(l,d,y){return pa.getSourceType(l)?y(new Error(`A source type called "${l}" already exists.`)):(pa.setSourceType(l,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:d.workerSourceURL},y):y(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(l,d,y={}){this._checkLoaded();const b=this.light.getLight();let T=!1;for(const C in l)if(!a.d(l[C],b[C])){T=!0;break}if(!T)return;const S=this._getTransitionParameters();this.light.setLight(l,d,y),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=a.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&a.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(l,d=1){if(this._checkLoaded(),!l)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),d===0&&delete this.terrain,l===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let y=l;const b=l.source==null;if(d===1){if(this.disableElevatedTerrain)return;if(typeof y.source=="object"){const C="terrain-dem-src";this.addSource(C,y.source),y=a.cW(y),y=a.Q(y,{source:C})}const T=a.Q({},y),S={};if(this.terrain&&b){T.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(S.style=C.serialize())}if(this._validate(De,"terrain",T,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!b||this.terrain&&d!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,d),this.fire(new a.g("data",{dataType:"style"}))}else{const T=this.terrain,S=T.get();for(const C of Object.keys(a.N.terrain))!y.hasOwnProperty(C)&&a.N.terrain[C].default&&(y[C]=a.N.terrain[C].default);for(const C in l)if(!a.d(l[C],S[C])){T.set(l,this.options),this.stylesheet.terrain=l;const k=this._getTransitionParameters({duration:0});T.updateTransitions(k),this.fire(new a.g("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const d=this.fog=new Ws(l,this.map.transform,this.scope,this.options);this.stylesheet.fog=d.get();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog;if(!a.d(d.get(),l)){d.set(l,this.options),this.stylesheet.fog=d.get();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}}else this._createFog(l);this._markersNeedUpdate=!0}setColorTheme(l){this._checkLoaded();const d=()=>{for(const b in this._layers)this._layers[b].lut=this._styleColorTheme.lut;for(const b in this._sourceCaches)this._sourceCaches[b].clearTiles()};if(this._styleColorTheme.colorTheme=l,!l)return this._styleColorTheme.lut=null,void d();const y=this._evaluateColorThemeData(l);this._loadColorTheme(y).then(()=>{this.fire(new a.g("colorthemeset")),d()}).catch(b=>{a.w(`Couldn't set color theme: ${b}`)})}_getTransitionParameters(l){return{now:a.e.now(),transition:a.Q(this.transition,l)}}updateDrapeFirstLayers(){if(!this.terrain)return;const l=[],d=[];for(const y of this._mergedOrder)this.isLayerDraped(this._mergedLayers[y])?l.push(y):d.push(y);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...d)}_createTerrain(l,d){const y=this.terrain=new hr(l,d,this.scope,this.options);d===1&&(this.stylesheet.terrain=l),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const b=this._getTransitionParameters({duration:0});y.updateTransitions(b)}_force3DLayerUpdate(){for(const l in this._layers){const d=this._layers[l];d.type==="fill-extrusion"&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const d=this._layers[l];d.type==="symbol"&&this._updateLayer(d)}}_validate(l,d,y,b,T={}){if(T&&T.validate===!1)return!1;const S=a.Q({},this.serialize());return fa(this,l.call(te,a.Q({key:d,style:S,value:y,styleSpec:a.N},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.d1.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._mergedLayers)this._mergedLayers[l].setEventedParent(null);for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles(),this._mergedSourceCaches[l].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(l){const d=this.getSourceCaches(l);for(const y of d)y.clearTiles()}clearSources(){for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles()}reloadSource(l){const d=this.getSourceCaches(l);for(const y of d)y.resume(),y.reload()}reloadSources(){for(const l of this.getSources())l.reload&&l.reload()}updateSources(l){let d;this.directionalLight&&(d=$o(this.directionalLight));for(const y in this._mergedSourceCaches)this._mergedSourceCaches[y].update(l,void 0,void 0,d)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const d=this._sourceCaches[l];d.resume(),d.reload()}}_updatePlacement(l,d,y,b,T,S,C=!1){let k=!1,L=!1;const N={},j={};for(const G of this._mergedOrder){const q=this._mergedLayers[G];if(q.type!=="symbol")continue;const re=a.am(q.source,q.scope);let ie=N[re];if(!ie){const ce=this.getLayerSourceCache(q);if(!ce)continue;const ye=ce.getRenderableIds(!0).map(ve=>ce.getTileByID(ve));j[re]=ye.slice(),ie=N[re]=ye.sort((ve,_e)=>_e.tileID.overscaledZ-ve.tileID.overscaledZ||(ve.tileID.isLessThan(_e.tileID)?-1:1))}const ae=this.crossTileSymbolIndex.addLayer(q,ie,d.center.lng,d.projection);k=k||ae}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||b===0,this._layerOrderChanged&&this.fire(new a.g("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.e.now(),d.zoom))&&(this.pauseablePlacement=new Wb(d,this._mergedOrder,C,y,b,T,this.placement,this.fog&&d.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,N,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.e.now()),L=!0),k&&this.pauseablePlacement.placement.setStale()),L||k){this._buildingIndex.onNewFrame(d.zoom);for(let G=0;G<this._mergedOrder.length;G++){const q=this._mergedLayers[this._mergedOrder[G]];if(q.type!=="symbol")continue;const re=this.isLayerClipped(q)&&this._clipLayerIndices.some(ie=>G<ie);this.placement.updateLayerOpacities(q,N[a.am(q.source,q.scope)],G,re?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.e.now())}}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}addImport(l,d){this._checkLoaded();const y=this.stylesheet.imports=this.stylesheet.imports||[];if(y.findIndex(({id:T})=>T===l.id)!==-1)return void this.fire(new a.f(new Error(`Import with id '${l.id}' already exists in the map's style.`)));if(!d)return y.push(l),this._loadImports([l],!0);const b=y.findIndex(({id:T})=>T===d);return b===-1&&this.fire(new a.f(new Error(`Import with id "${d}" does not exist on this map.`))),this.stylesheet.imports=y.slice(0,b).concat(l).concat(y.slice(b)),this._loadImports([l],!0,d)}updateImport(l,d){this._checkLoaded();const y=this.stylesheet.imports||[],b=this.getImportIndex(l);return b===-1?this:typeof d=="string"?(this.setImportUrl(l,d),this):(d.url&&d.url!==y[b].url&&this.setImportUrl(l,d.url),a.d(d.config,y[b].config)||this.setImportConfig(l,d.config),a.d(d.data,y[b].data)||this.setImportData(l,d.data),this)}moveImport(l,d){this._checkLoaded();let y=this.stylesheet.imports||[];const b=this.getImportIndex(l);if(b===-1)return this;const T=this.getImportIndex(d);if(T===-1)return this;const S=y[b],C=this.fragments[b];return y=y.filter(({id:k})=>k!==l),this.fragments=this.fragments.filter(({id:k})=>k!==l),this.stylesheet.imports=y.slice(0,T).concat(S).concat(y.slice(T)),this.fragments=this.fragments.slice(0,T).concat(C).concat(this.fragments.slice(T)),this.mergeLayers(),this}setImportUrl(l,d){this._checkLoaded();const y=this.stylesheet.imports||[],b=this.getImportIndex(l);if(b===-1)return this;y[b].url=d;const T=this.fragments[b];return T.style=this._createFragmentStyle(y[b]),T.style.on("style.import.load",()=>this.mergeAll()),T.style.loadURL(d),this}setImportData(l,d){this._checkLoaded();const y=this.getImportIndex(l),b=this.stylesheet.imports||[];return y===-1?this:d?(this.fragments[y].style.setState(d),this._reloadImports(),this):(delete b[y].data,this.setImportUrl(l,b[y].url))}setImportConfig(l,d){this._checkLoaded();const y=this.getImportIndex(l),b=this.stylesheet.imports||[];if(y===-1)return this;d?b[y].config=d:delete b[y].config;const T=this.fragments[y],S=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=d,T.style.updateConfig(d,S),this.updateConfigDependencies(),this}removeImport(l){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(l);y!==-1&&(d.splice(y,1),this.fragments[y].style._remove(),this.fragments.splice(y,1),this._reloadImports())}getImportIndex(l){const d=(this.stylesheet.imports||[]).findIndex(y=>y.id===l);return d===-1&&this.fire(new a.f(new Error(`Import '${l}' does not exist in the map's style and cannot be updated.`))),d}getLayer(l){return this._mergedLayers[l]}getSources(){const l=[];for(const d in this._mergedOtherSourceCaches){const y=this._mergedOtherSourceCaches[d];y&&l.push(y.getSource())}return l}getSource(l,d){const y=this.getSourceCache(l,d);return y&&y.getSource()}getLayerSource(l){const d=this.getLayerSourceCache(l);return d&&d.getSource()}getSourceCache(l,d){const y=a.am(l,d);return this._mergedOtherSourceCaches[y]}getLayerSourceCache(l){const d=a.am(l.source,l.scope);return l.type==="symbol"?this._mergedSymbolSourceCaches[d]:this._mergedOtherSourceCaches[d]}getSourceCaches(l){if(l==null)return Object.values(this._mergedSourceCaches);const d=[];return this._mergedOtherSourceCaches[l]&&d.push(this._mergedOtherSourceCaches[l]),this._mergedSymbolSourceCaches[l]&&d.push(this._mergedSymbolSourceCaches[l]),d}updateSourceCaches(){const l=this._changes.getUpdatedSourceCaches();for(const d in l){const y=l[d];y==="reload"?this.reloadSource(d):y==="clear"&&this.clearSource(d)}}updateLayers(l){const d=this._changes.getUpdatedPaintProperties();for(const y of d){const b=this.getLayer(y);b&&b.updateTransitions(l)}}getImages(l,d,y){this.imageManager.getImages(d.icons,d.scope,y),this._updateTilesForChangedImages();const b=T=>{T&&T.setDependencies(d.tileID.key,d.type,d.icons)};b(this._otherSourceCaches[d.source]),b(this._symbolSourceCaches[d.source])}getGlyphs(l,d,y){this.glyphManager.getGlyphs(d.stacks,d.scope,y)}getResource(l,d,y){return a.d2(d,y)}getOwnSourceCache(l){return this._otherSourceCaches[l]}getOwnLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}getOwnSourceCaches(l){const d=[];return this._otherSourceCaches[l]&&d.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&d.push(this._symbolSourceCaches[l]),d}_isSourceCacheLoaded(l){const d=this.getOwnSourceCaches(l);return d.length===0?(this.fire(new a.f(new Error(`There is no source with ID '${l}'`))),!1):d.every(y=>y.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(l,d){if(this._clipLayerIndices.length===0&&l.type!=="fill-extrusion")return!1;const y=l.type==="fill-extrusion"&&l.sourceLayer==="building";let b=0;if(l.is3D()){if(y||d&&d.type==="batched-model")return!0;l.type==="model"&&(b=a.cw.Model)}else l.type==="symbol"&&(b=a.cw.Symbol);for(const T of this._clipLayerIndices){const S=this._mergedLayers[this._mergedOrder[T]];if(!S)continue;const C=[];for(const k of S.layout.get("clip-layer-types"))C.push(k==="model"?a.cw.Model:k==="symbol"?a.cw.Symbol:a.cw.FillExtrusion);for(const k of C)if(b&k)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(l=>{l.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Kb(g,l){let d=!1,y=null;const b=()=>{y=null,d&&(g(),y=setTimeout(b,l),d=!1)};return()=>(d=!0,y||b(),y)}pa.getSourceType=function(g){return H[g]},pa.setSourceType=function(g,l){H[g]=l},pa.registerForPluginStateChange=a.cO;class Yb{constructor(l){this._hashName=l&&encodeURIComponent(l),a.br(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Kb(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const d=S0(l);if(this._hashName){const y=this._hashName;let b=!1;const T=location.hash.slice(1).split("&").map(S=>{const C=S.split("=")[0];return C===y?(b=!0,`${C}=${d}`):S}).filter(S=>S);return b||T.push(`${y}=${d}`),`#${T.join("&")}`}return`#${d}`}_getCurrentHash(){const l=location.hash.replace("#","");if(this._hashName){let d;return l.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(d=y)}),(d&&d[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(y=>isNaN(y))){const y=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(d[3]||0):l.getBearing();return l.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:y,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function S0(g,l){const d=g.getCenter(),y=Math.round(100*g.getZoom())/100,b=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,b),S=Math.round(d.lng*T)/T,C=Math.round(d.lat*T)/T,k=g.getBearing(),L=g.getPitch();let N=l?`/${S}/${C}/${y}`:`${y}/${C}/${S}`;return(k||L)&&(N+="/"+Math.round(10*k)/10),L&&(N+=`/${Math.round(L)}`),N}const Sd={linearity:.3,easing:a.d3(0,0,.3,1)},xC=a.Q({deceleration:2500,maxSpeed:1400},Sd),bC=a.Q({deceleration:20,maxSpeed:1400},Sd),wC=a.Q({deceleration:1e3,maxSpeed:360},Sd),TC=a.Q({deceleration:1e3,maxSpeed:90},Sd);class Qb{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.e.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,d=a.e.now();for(;l.length>0&&d-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)d.zoom+=T.zoomDelta||0,d.bearing+=T.bearingDelta||0,d.pitch+=T.pitchDelta||0,T.panDelta&&d.pan._add(T.panDelta),T.around&&(d.around=T.around),T.pinchAround&&(d.pinchAround=T.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(d.pan.mag()){const T=uh(d.pan.mag(),y,a.Q({},xC,l||{}));b.offset=d.pan.mult(T.amount/d.pan.mag()),b.center=this._map.transform.center,Rg(b,T)}if(d.zoom){const T=uh(d.zoom,y,bC);b.zoom=this._map.transform.zoom+T.amount,Rg(b,T)}if(d.bearing){const T=uh(d.bearing,y,wC);b.bearing=this._map.transform.bearing+a.au(T.amount,-179,179),Rg(b,T)}if(d.pitch){const T=uh(d.pitch,y,TC);b.pitch=this._map.transform.pitch+T.amount,Rg(b,T)}if(b.zoom||b.bearing){const T=d.pinchAround===void 0?d.around:d.pinchAround;b.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function Rg(g,l){(!g.duration||g.duration<l.duration)&&(g.duration=l.duration,g.easing=l.easing)}function uh(g,l,d){const{maxSpeed:y,linearity:b,deceleration:T}=d,S=a.au(g*b/(l/1e3),-y,y),C=Math.abs(S)/(T*b);return{easing:d.easing,duration:1e3*C,amount:S*(C/2)}}class ma extends a.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,y,b={}){const T=Te(d.getCanvasContainer(),y),S=d.unproject(T);super(l,a.Q({point:T,lngLat:S,originalEvent:y},b)),this._defaultPrevented=!1,this.target=d}}class Tp extends a.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,y){const b=l==="touchend"?y.changedTouches:y.touches,T=we(d.getCanvasContainer(),b),S=T.map(k=>d.unproject(k)),C=T.reduce((k,L,N,j)=>k.add(L.div(j.length)),new a.P(0,0));super(l,{points:T,point:C,lngLats:S,lngLat:d.unproject(C),originalEvent:y}),this._defaultPrevented=!1}}class I0 extends a.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d){super("wheel",{originalEvent:d}),this._defaultPrevented=!1}}class Mg{constructor(l,d){this._map=l,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new I0(this._map,l))}mousedown(l,d){return this._mousedownPos=d,this._firePreventable(new ma(l.type,this._map,l))}mouseup(l){this._map.fire(new ma(l.type,this._map,l))}preclick(l){const d=a.Q({},l);d.type="preclick",this._map.fire(new ma(d.type,this._map,d))}click(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(l),this._map.fire(new ma(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new ma(l.type,this._map,l))}mouseover(l){this._map.fire(new ma(l.type,this._map,l))}mouseout(l){this._map.fire(new ma(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Tp(l.type,this._map,l))}touchmove(l){this._map.fire(new Tp(l.type,this._map,l))}touchend(l){this._map.fire(new Tp(l.type,this._map,l))}touchcancel(l){this._map.fire(new Tp(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class A0{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new ma(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ma("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new ma(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hh{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,d){this.isEnabled()&&l.shiftKey&&l.button===0&&(W(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(l,d){if(!this._active)return;const y=d,b=this._startPos,T=this._lastPos;if(!b||!T||T.equals(y)||!this._box&&y.dist(b)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=F("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const S=Math.min(b.x,y.x),C=Math.max(b.x,y.x),k=Math.min(b.y,y.y),L=Math.max(b.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${k}px)`,this._box.style.width=C-S+"px",this._box.style.height=L-k+"px")})}mouseupWindow(l,d){if(!this._active)return;const y=this._startPos,b=d;if(y&&l.button===0){if(this.reset(),pe(),y.x!==b.x||y.y!==b.y)return this._map.fire(new a.g("boxzoomend",{originalEvent:l})),{cameraAnimation:T=>T.fitScreenCoordinates(y,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Q(),delete this._startPos,delete this._lastPos}_fireEvent(l,d){return this._map.fire(new a.g(l,{originalEvent:d}))}}function Ep(g,l){const d={};for(let y=0;y<g.length;y++)d[g[y].identifier]=l[y];return d}class Jb{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,d,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),y.length===this.numTouches&&(this.centroid=function(b){const T=new a.P(0,0);for(const S of b)T._add(S);return T.div(b.length)}(d),this.touches=Ep(y,d)))}touchmove(l,d,y){if(this.aborted||!this.centroid)return;const b=Ep(y,d);for(const T in this.touches){const S=b[T];(!S||S.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(l,d,y){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class lu{constructor(l){this.singleTap=new Jb(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,d,y){this.singleTap.touchstart(l,d,y)}touchmove(l,d,y){this.singleTap.touchmove(l,d,y)}touchend(l,d,y){const b=this.singleTap.touchend(l,d,y);if(b){const T=l.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(b)<30;if(T&&S||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Sp{constructor(){this._zoomIn=new lu({numTouches:1,numTaps:2}),this._zoomOut=new lu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,d,y){this._zoomIn.touchstart(l,d,y),this._zoomOut.touchstart(l,d,y)}touchmove(l,d,y){this._zoomIn.touchmove(l,d,y),this._zoomOut.touchmove(l,d,y)}touchend(l,d,y){const b=this._zoomIn.touchend(l,d,y),T=this._zoomOut.touchend(l,d,y);return b?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(b)},{originalEvent:l})}):T?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(T)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const kg={0:1,2:2};class Ip{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,d){return!1}_move(l,d){return{}}mousedown(l,d){if(this._lastPoint)return;const y=oe(l);this._correctButton(l,y)&&(this._lastPoint=d,this._eventButton=y)}mousemoveWindow(l,d){const y=this._lastPoint;if(y){if(l.preventDefault(),this._eventButton!=null&&function(b,T){const S=kg[T];return b.buttons===void 0||(b.buttons&S)!==S}(l,this._eventButton))this.reset();else if(this._moved||!(d.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(y,d)}}mouseupWindow(l){this._lastPoint&&oe(l)===this._eventButton&&(this._moved&&pe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ap extends Ip{mousedown(l,d){super.mousedown(l,d),this._lastPoint&&(this._active=!0)}_correctButton(l,d){return d===0&&!l.ctrlKey}_move(l,d){return{around:d,panDelta:d.sub(l)}}}class Cp extends Ip{_correctButton(l,d){return d===0&&l.ctrlKey||d===2}_move(l,d){const y=.8*(d.x-l.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(l){l.preventDefault()}}class Dg extends Ip{_correctButton(l,d){return d===0&&l.ctrlKey||d===2}_move(l,d){const y=-.5*(d.y-l.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(l){l.preventDefault()}}class ew{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),a.br(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(l,d,y){return this._calculateTransform(l,d,y)}touchmove(l,d,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(y.length===1&&!a.d4())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,d,y)}}touchend(l,d,y){this._calculateTransform(l,d,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,d,y){y.length>0&&(this._active=!0);const b=Ep(y,d),T=new a.P(0,0),S=new a.P(0,0);let C=0;for(const L in b){const N=b[L],j=this._touches[L];j&&(T._add(N),S._add(N.sub(j)),C++,b[L]=N)}if(this._touches=b,C<this._minTouches||!S.mag())return;const k=S.div(C);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(C),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=F("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Pp{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,d,y){return{}}touchstart(l,d,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([d[0],d[1]]))}touchmove(l,d,y){const b=this._firstTwoTouches;if(!b)return;l.preventDefault();const[T,S]=b,C=dh(y,d,T),k=dh(y,d,S);if(!C||!k)return;const L=this._aroundCenter?null:C.add(k).div(2);return this._move([C,k],L,l)}touchend(l,d,y){if(!this._firstTwoTouches)return;const[b,T]=this._firstTwoTouches,S=dh(y,d,b),C=dh(y,d,T);S&&C||(this._active&&pe(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function dh(g,l,d){for(let y=0;y<g.length;y++)if(g[y].identifier===d)return l[y]}function Id(g,l){return Math.log(g/l)/Math.LN2}class tw extends Pp{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,d){const y=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Id(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Id(this._distance,y),pinchAround:d}}}function C0(g,l){return 180*g.angleWith(l)/Math.PI}class nw extends Pp{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,d){const y=this._vector;if(this._vector=l[0].sub(l[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:C0(this._vector,y),pinchAround:d}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const d=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const b=C0(l,y);return Math.abs(b)<d}}function cu(g){return Math.abs(g.y)>Math.abs(g.x)}class rw extends Pp{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,cu(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,d,y){const b=this._lastPoints;if(!b)return;const T=l[0].sub(b[0]),S=l[1].sub(b[1]);return this._map._cooperativeGestures&&!a.d4()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(T,S,y.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(T.y+S.y)/2*-.5})}gestureBeginsVertically(l,d,y){if(this._valid!==void 0)return this._valid;const b=l.mag()>=2,T=d.mag()>=2;if(!b&&!T)return;if(!b||!T)return this._firstMove==null&&(this._firstMove=y),y-this._firstMove<100&&void 0;const S=l.y>0==d.y>0;return cu(l)&&cu(d)&&S}}const EC={panStep:100,bearingStep:15,pitchStep:10};class SC{constructor(){const l=EC;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let d=0,y=0,b=0,T=0,S=0;switch(l.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:l.shiftKey?y=-1:(l.preventDefault(),T=-1);break;case 39:l.shiftKey?y=1:(l.preventDefault(),T=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),S=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(y=0,b=0),{cameraAnimation:C=>{const k=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:IC,zoom:d?Math.round(k)+d*(l.shiftKey?2:1):k,bearing:C.getBearing()+y*this._bearingStep,pitch:C.getPitch()+b*this._pitchStep,offset:[-T*this._panStep,-S*this._panStep],center:C.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function IC(g){return g*(2-g)}const Og=4.000244140625,P0=1/450;class R0{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._handler=d,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=P0,a.br(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||a.d4()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const y=a.e.now(),b=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,d!==0&&d%Og==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=d,this._timeout=window.setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(b*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=Te(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>Og?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&N!==0&&(N=1/N);const j=d(),G=Math.pow(2,j),q=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):G;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(q*N))),this._type==="wheel"&&(this._startZoom=j,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:d(),b=this._startZoom,T=this._easing;let S,C=!1;if(this._type==="wheel"&&b&&T){const L=Math.min((a.e.now()-this._lastWheelEventTime)/200,1),N=T(L);S=a.a3(b,y,N),L<1?this._frameId||(this._frameId=!0):C=!0}else S=y,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let k=S-d();return k*this._lastDelta<0&&(k=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:k,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let d=a.d5;if(this._prevEase){const y=this._prevEase,b=(a.e.now()-y.start)/y.duration,T=y.easing(b+.01)-y.easing(b),S=.27/Math.sqrt(T*T+1e-4)*.01,C=Math.sqrt(.0729-S*S);d=a.d3(S,C,.25,1)}return this._prevEase={start:a.e.now(),duration:l,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=F("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class M0{constructor(l,d){this._clickZoom=l,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class iw{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,d){return l.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(l.shiftKey?-1:1),around:y.unproject(d)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sw{constructor(){this._tap=new lu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,d,y){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=d[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(l,d,y))}touchmove(l,d,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const b=d[0],T=b.y-this._swipePoint.y;return this._swipePoint=b,l.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(l,d,y)}touchend(l,d,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(l,d,y)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class AC{constructor(l,d,y){this._el=l,this._mousePan=d,this._touchPan=y}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Rp{constructor(l,d,y){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=d,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Mp{constructor(l,d,y,b){this._el=l,this._touchZoom=d,this._touchRotate=y,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const kp=g=>g.zoom||g.drag||g.pitch||g.rotate;class ga extends a.g{}class k0{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,d){const y=a.$.sub([],d,l);this.radius=a.$.length(y[2]<0?a.$.div([],y,this.constants):[y[0],y[1],0])}projectRay(l){a.$.div(l,l,this.constants),a.$.normalize(l,l),a.$.mul(l,l,this.constants);const d=a.$.scale([],l,this.radius);if(d[2]>0){const y=a.$.scale([],[0,0,1],a.$.dot(d,[0,0,1])),b=a.$.scale([],a.$.normalize([],[d[0],d[1],0]),this.radius),T=a.$.add([],d,a.$.scale([],a.$.sub([],a.$.add([],b,y),d),2));d[0]=T[0],d[1]=T[1]}return d}}function fh(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Lg{constructor(l,d){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qb(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new k0,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),a.br(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,T,S]of this._listeners){const C=b===document?this.handleWindowEvent:this.handleEvent;b.addEventListener(T,C,S)}}destroy(){for(const[l,d,y]of this._listeners){const b=l===document?this.handleWindowEvent:this.handleEvent;l.removeEventListener(d,b,y)}}_addDefaultHandlers(l){const d=this._map,y=d.getCanvasContainer();this._add("mapEvent",new Mg(d,l));const b=d.boxZoom=new hh(d,l);this._add("boxZoom",b);const T=new Sp,S=new iw;d.doubleClickZoom=new M0(S,T),this._add("tapZoom",T),this._add("clickZoom",S);const C=new sw;this._add("tapDragZoom",C);const k=d.touchPitch=new rw(d);this._add("touchPitch",k);const L=new Cp(l),N=new Dg(l);d.dragRotate=new Rp(l,L,N),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);const j=new Ap(l),G=new ew(d,l);d.dragPan=new AC(y,j,G),this._add("mousePan",j),this._add("touchPan",G,["touchZoom","touchRotate"]);const q=new nw,re=new tw;d.touchZoomRotate=new Mp(y,re,q,C),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),this._add("blockableMapEvent",new A0(d));const ie=d.scrollZoom=new R0(d,this);this._add("scrollZoom",ie,["mousePan"]);const ae=d.keyboard=new SC;this._add("keyboard",ae);for(const ce of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[ce]&&d[ce].enable(l[ce])}_add(l,d,y){this._handlers.push({handlerName:l,handler:d,allowed:y}),this._handlersById[l]=d}stop(l){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!kp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,d,y){for(const b in l)if(b!==y&&(!d||d.indexOf(b)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const d=[];for(const y of l)this._el.contains(y.target)&&d.push(y);return d}handleEvent(l,d){this._updatingCamera=!0;const y=l.type==="renderFrame",b=y?void 0:l,T={needsRenderFrame:!1},S={},C={},k=l.touches?this._getMapTouches(l.touches):void 0,L=k?we(this._el,k):y?void 0:Te(this._el,l);for(const{handlerName:G,handler:q,allowed:re}of this._handlers){if(!q.isEnabled())continue;let ie;this._blockedByActive(C,re,G)?q.reset():q[d||l.type]&&(ie=q[d||l.type](l,L,k),this.mergeHandlerResult(T,S,ie,G,b),ie&&ie.needsRenderFrame&&this._triggerRenderFrame()),(ie||q.isActive())&&(C[G]=q)}const N={};for(const G in this._previousActiveHandlers)C[G]||(N[G]=b);this._previousActiveHandlers=C,(Object.keys(N).length||fh(T))&&(this._changes.push([T,S,N]),this._triggerRenderFrame()),(Object.keys(C).length||fh(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=T;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(l,d,y,b,T){if(!y)return;a.Q(l,y);const S={handlerName:b,originalEvent:y.originalEvent||T};y.zoomDelta!==void 0&&(d.zoom=S),y.panDelta!==void 0&&(d.drag=S),y.pitchDelta!==void 0&&(d.pitch=S),y.bearingDelta!==void 0&&(d.rotate=S)}_applyChanges(){const l={},d={},y={};for(const[b,T,S]of this._changes)b.panDelta&&(l.panDelta=(l.panDelta||new a.P(0,0))._add(b.panDelta)),b.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(l.around=b.around),b.aroundCoord!==void 0&&(l.aroundCoord=b.aroundCoord),b.pinchAround!==void 0&&(l.pinchAround=b.pinchAround),b.noInertia&&(l.noInertia=b.noInertia),a.Q(d,T),a.Q(y,S);this._updateMapTransform(l,d,y),this._changes=[]}_updateMapTransform(l,d,y){const b=this._map,T=b.transform,S=ye=>[ye.x,ye.y,ye.z];if((ye=>{const ve=this._eventsInProgress.drag;return ve&&!this._handlersById[ve.handlerName].isActive()})()&&!fh(l)){const ye=T.zoom;T.cameraElevationReference="sea",this._originalZoom!=null&&T._orthographicProjectionAtLowPitch&&T.projection.name!=="globe"&&T.pitch===0?(T.cameraElevationReference="ground",T.zoom=this._originalZoom):(T.recenterOnTerrain(),T.cameraElevationReference="ground"),ye!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&b._stop(!0),!fh(l))return void this._fireEvents(d,y,!0);let{panDelta:C,zoomDelta:k,bearingDelta:L,pitchDelta:N,around:j,aroundCoord:G,pinchAround:q}=l;T._isCameraConstrained&&(k>0&&(k=0),T._isCameraConstrained=!1),q!==void 0&&(j=q),(k||(ye=>d[ye]&&!this._eventsInProgress[ye])("drag"))&&j&&(this._dragOrigin=S(T.pointCoordinate3D(j)),this._originalZoom=T.zoom,this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",b._stop(!0),j=j||b.transform.centerPoint,L&&(T.bearing+=L),N&&(T.pitch+=N),T._updateCameraState();const re=[0,0,0];if(C)if(T.projection.name==="mercator"){const ye=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(j).dir),ve=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(j.sub(C)).dir);re[0]=ve[0]-ye[0],re[1]=ve[1]-ye[1]}else{const ye=T.pointCoordinate(j);if(T.projection.name==="globe"){C=C.rotate(-T.angle);const ve=T._pixelsPerMercatorPixel/T.worldSize;re[0]=-C.x*a.d6(a.az(ye.y))*ve,re[1]=-C.y*a.d6(T.center.lat)*ve}else{const ve=T.pointCoordinate(j.sub(C));ye&&ve&&(re[0]=ve.x-ye.x,re[1]=ve.y-ye.y)}}const ie=T.zoom,ae=[0,0,0];if(k){const ye=S(G||T.pointCoordinate3D(j)),ve={dir:a.$.normalize([],a.$.sub([],ye,T._camera.position))};if(ve.dir[2]<0){const _e=T.zoomDeltaToMovement(ye,k);a.$.scale(ae,ve.dir,_e)}}const ce=a.$.add(re,re,ae);T._translateCameraConstrained(ce),k&&Math.abs(T.zoom-ie)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,y,!0)}_fireEvents(l,d,y){const b=kp(this._eventsInProgress),T=kp(l),S={};for(const N in l){const{originalEvent:j}=l[N];this._eventsInProgress[N]||(S[`${N}start`]=j),this._eventsInProgress[N]=l[N]}!b&&T&&this._fireEvent("movestart",T.originalEvent);for(const N in S)this._fireEvent(N,S[N]);T&&this._fireEvent("move",T.originalEvent);for(const N in l){const{originalEvent:j}=l[N];this._fireEvent(N,j)}const C={};let k;for(const N in this._eventsInProgress){const{handlerName:j,originalEvent:G}=this._eventsInProgress[N];this._handlersById[j].isActive()||(delete this._eventsInProgress[N],k=d[j]||G,C[`${N}end`]=k)}for(const N in C)this._fireEvent(N,C[N]);const L=kp(this._eventsInProgress);if(y&&(b||T)&&!L){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;N?(j(N.bearing||this._map.getBearing())&&(N.bearing=0),this._map.easeTo(N,{originalEvent:k})):(this._map.fire(new a.g("moveend",{originalEvent:k})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,d){this._map.fire(new a.g(l,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new ga("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const zg="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class D0 extends a.E{constructor(l,d){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=d.respectPrefersReducedMotion!==!1,a.br(["_renderFrameCallback"],this)}getCenter(){return new a.aJ(this.transform.center.lng,this.transform.center.lat)}setCenter(l,d){return this.jumpTo({center:l},d)}panBy(l,d,y){return l=a.P.convert(l).mult(-1),this.panTo(this.transform.center,a.Q({offset:l},d),y)}panTo(l,d,y){return this.easeTo(a.Q({center:l},d),y)}getZoom(){return this.transform.zoom}setZoom(l,d){return this.jumpTo({zoom:l},d),this}zoomTo(l,d,y){return this.easeTo(a.Q({zoom:l},d),y)}zoomIn(l,d){return this.zoomTo(this.getZoom()+1,l,d),this}zoomOut(l,d){return this.zoomTo(this.getZoom()-1,l,d),this}getBearing(){return this.transform.bearing}setBearing(l,d){return this.jumpTo({bearing:l},d),this}getPadding(){return this.transform.padding}setPadding(l,d){return this.jumpTo({padding:l},d),this}rotateTo(l,d,y){return this.easeTo(a.Q({bearing:l},d),y)}resetNorth(l,d){return this.rotateTo(0,a.Q({duration:1e3},l),d),this}resetNorthPitch(l,d){return this.easeTo(a.Q({bearing:0,pitch:0,duration:1e3},l),d),this}snapToNorth(l,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,d):this}getPitch(){return this.transform.pitch}setPitch(l,d){return this.jumpTo({pitch:l},d),this}cameraForBounds(l,d){l=a.aj.convert(l);const y=d&&d.bearing||0,b=d&&d.pitch||0,T=l.getNorthWest(),S=l.getSouthEast();return this._cameraForBounds(this.transform,T,S,y,b,d)}_extendPadding(l){const d={top:0,right:0,bottom:0,left:0};return l==null?a.Q({},d,this.transform.padding):typeof l=="number"?{top:l,bottom:l,right:l,left:l}:a.Q({},d,l)}_extendCameraOptions(l){return(l=a.Q({offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=this._extendPadding(l.padding),l}_minimumAABBFrustumDistance(l,d){const y=d.max[0]-d.min[0],b=d.max[1]-d.min[1];return y/b>l.aspect?y/(2*Math.tan(.5*l.fovX)*l.aspect):b/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,d,y,b,T,S){const C=l.clone(),k=this._extendCameraOptions(S);C.bearing=b,C.pitch=T;const L=a.aJ.convert(d),N=a.aJ.convert(y),j=.5*(L.lat+N.lat),G=.5*(L.lng+N.lng),q=a.d7(j,G),re=a.$.normalize([],q),ie=a.$.normalize([],a.$.cross([],re,[0,1,0])),ae=a.$.cross([],ie,re),ce=[ie[0],ie[1],ie[2],0,ae[0],ae[1],ae[2],0,re[0],re[1],re[2],0,0,0,0,1],ye=[q,a.d7(L.lat,L.lng),a.d7(N.lat,L.lng),a.d7(N.lat,N.lng),a.d7(L.lat,N.lng),a.d7(j,L.lng),a.d7(j,N.lng),a.d7(L.lat,G),a.d7(N.lat,G)];let ve=a.b8.fromPoints(ye.map(je=>[a.$.dot(ie,je),a.$.dot(ae,je),a.$.dot(re,je)]));const _e=a.$.transformMat4([],ve.center,ce);a.$.squaredLength(_e)===0&&a.$.set(_e,0,0,1),a.$.normalize(_e,_e),a.$.scale(_e,_e,a.cF),C.center=a.d8(_e);const Re=C.getWorldToCameraMatrix(),Se=a.ae.invert(new Float64Array(16),Re);ve=a.b8.applyTransform(ve,a.ae.multiply([],Re,ce));const Ie=this._extendAABB(ve,C,k,b);if(!Ie)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ve=Ie,a.$.transformMat4(_e,_e,Re);const ze=.5*(ve.max[2]-ve.min[2]),Ne=this._minimumAABBFrustumDistance(C,ve),qe=a.$.scale([],[0,0,1],ze),Fe=a.$.add(qe,_e,qe),Pe=Ne+(C.pitch===0?0:a.$.distance(_e,Fe)),Qe=C.globeCenterInViewSpace,Xe=a.$.sub([],_e,[Qe[0],Qe[1],Qe[2]]);a.$.normalize(Xe,Xe),a.$.scale(Xe,Xe,Pe);const Ue=a.$.add([],_e,Xe);a.$.transformMat4(Ue,Ue,Se);const _t=a.da/a.cF,ut=a.$.length(Ue),We=a.ay(Math.max(ut*_t-a.da,Number.EPSILON),0),nt=Math.min(C.zoomFromMercatorZAdjusted(We),k.maxZoom);return nt>.5*(a.b3+a.aV)?(C.setProjection({name:"mercator"}),C.zoom=nt,this._cameraForBounds(C,d,y,b,T,S)):{center:C.center,zoom:nt,bearing:b,pitch:T}}_extendAABB(l,d,y,b){const T=.5*((y.padding.left||0)+(y.padding.right||0)),S=.5*((y.padding.top||0)+(y.padding.bottom||0)),C=S,k=T,L=T,N=S,j=d.width-(k+L),G=d.height-(C+N),q=a.$.sub([],l.max,l.min),re=Math.min(j/q[0],G/q[1]),ie=Math.min(d.scaleZoom(d.scale*re),y.maxZoom);if(isNaN(ie))return null;const ae=d.scale/d.zoomScale(ie),ce=new a.b8([l.min[0]-k*ae,l.min[1]-N*ae,l.min[2]],[l.max[0]+L*ae,l.max[1]+C*ae,l.max[2]]),ye=(typeof y.offset.x=="number"&&typeof y.offset.y=="number"?new a.P(y.offset.x,y.offset.y):a.P.convert(y.offset)).rotate(-a.ac(b));return ce.center[0]-=ye.x*ae,ce.center[1]+=ye.y*ae,ce}queryTerrainElevation(l,d){const y=this.transform.elevation;return y?(d=a.Q({},{exaggerated:!0},d),y.getAtPoint(a._.fromLngLat(l),null,d.exaggerated)):null}_cameraForBounds(l,d,y,b,T,S){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,d,y,b,T,S);const C=l.clone(),k=this._extendCameraOptions(S);C.bearing=b,C.pitch=T;const L=a.aJ.convert(d),N=a.aJ.convert(y),j=new a.aJ(L.lng,N.lat),G=new a.aJ(N.lng,L.lat),q=C.project(L),re=C.project(N),ie=this.queryTerrainElevation(L),ae=this.queryTerrainElevation(N),ce=this.queryTerrainElevation(j),ye=this.queryTerrainElevation(G),ve=[[q.x,q.y,Math.min(ie||0,ae||0,ce||0,ye||0)],[re.x,re.y,Math.max(ie||0,ae||0,ce||0,ye||0)]];let _e=a.b8.fromPoints(ve);const Re=C.getWorldToCameraMatrix(),Se=a.ae.invert(new Float64Array(16),Re);_e=a.b8.applyTransform(_e,Re);const Ie=this._extendAABB(_e,C,k,b);if(!Ie)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");_e=Ie;const ze=.5*a.$.sub([],_e.max,_e.min)[2],Ne=this._minimumAABBFrustumDistance(C,_e),qe=[0,0,1,0];a.aB.transformMat4(qe,qe,Re),a.aB.normalize(qe,qe);const Fe=a.$.scale([],qe,Ne+ze),Pe=a.$.add([],_e.center,Fe);a.$.transformMat4(_e.center,_e.center,Se),a.$.transformMat4(Pe,Pe,Se);const Qe=[_e.center[0],_e.center[1],Pe[2]*C.pixelsPerMeter];a.$.scale(Qe,Qe,1/C.worldSize);const Xe=a.d9(Qe[0]),Ue=a.az(Qe[1]),_t=Math.min(C._zoomFromMercatorZ(Qe[2]),k.maxZoom),ut=new a.aJ(Xe,Ue);return C.mercatorFromTransition&&_t<.5*(a.b3+a.aV)?(C.setProjection({name:"globe"}),C.zoom=_t,this._cameraForBounds(C,d,y,b,T,S)):{center:ut,zoom:_t,bearing:b,pitch:T}}fitBounds(l,d,y){const b=this.cameraForBounds(l,d);return this._fitInternal(b,d,y)}fitScreenCoordinates(l,d,y,b,T){const S=a.P.convert(l),C=a.P.convert(d),k=new a.P(Math.min(S.x,C.x),Math.min(S.y,C.y)),L=new a.P(Math.max(S.x,C.x),Math.max(S.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,C))return this;const N=this.transform.pointLocation3D(k),j=this.transform.pointLocation3D(L),G=this.transform.pointLocation3D(new a.P(k.x,L.y)),q=this.transform.pointLocation3D(new a.P(L.x,k.y)),re=[Math.min(N.lng,j.lng,G.lng,q.lng),Math.min(N.lat,j.lat,G.lat,q.lat)],ie=[Math.max(N.lng,j.lng,G.lng,q.lng),Math.max(N.lat,j.lat,G.lat,q.lat)],ae=b&&b.pitch?b.pitch:this.getPitch(),ce=this._cameraForBounds(this.transform,re,ie,y,ae,b);return this._fitInternal(ce,b,T)}_fitInternal(l,d,y){return l?(d=a.Q(l,d)).linear?this.easeTo(d,y):this.flyTo(d,y):this}jumpTo(l,d){this.stop();const y=l.preloadOnly?this.transform.clone():this.transform;let b=!1,T=!1,S=!1;if("zoom"in l&&y.zoom!==+l.zoom&&(b=!0,y.zoom=+l.zoom),l.center!==void 0&&(y.center=a.aJ.convert(l.center)),"bearing"in l&&y.bearing!==+l.bearing&&(T=!0,y.bearing=+l.bearing),"pitch"in l&&y.pitch!==+l.pitch&&(S=!0,y.pitch=+l.pitch),l.padding!=null){const C=typeof l.padding=="number"?this._extendPadding(l.padding):l.padding;y.isPaddingEqual(C)||(y.padding=C)}return l.preloadOnly?(this._preloadTiles(y),this):(this.fire(new a.g("movestart",d)).fire(new a.g("move",d)),b&&this.fire(new a.g("zoomstart",d)).fire(new a.g("zoom",d)).fire(new a.g("zoomend",d)),T&&this.fire(new a.g("rotatestart",d)).fire(new a.g("rotate",d)).fire(new a.g("rotateend",d)),S&&this.fire(new a.g("pitchstart",d)).fire(new a.g("pitch",d)).fire(new a.g("pitchend",d)),this.fire(new a.g("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.w(zg),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,d){const y=this.transform;if(!y.projection.supportsFreeCamera)return a.w(zg),this;this.stop();const b=y.zoom,T=y.pitch,S=y.bearing;y.setFreeCameraOptions(l);const C=b!==y.zoom,k=T!==y.pitch,L=S!==y.bearing;return this.fire(new a.g("movestart",d)).fire(new a.g("move",d)),C&&this.fire(new a.g("zoomstart",d)).fire(new a.g("zoom",d)).fire(new a.g("zoomend",d)),L&&this.fire(new a.g("rotatestart",d)).fire(new a.g("rotate",d)).fire(new a.g("rotateend",d)),k&&this.fire(new a.g("pitchstart",d)).fire(new a.g("pitch",d)).fire(new a.g("pitchend",d)),this.fire(new a.g("moveend",d)),this}easeTo(l,d){this._stop(!1,l.easeId),((l=a.Q({offset:[0,0],duration:500,easing:a.d5},l)).animate===!1||this._prefersReducedMotion(l))&&(l.duration=0);const y=this.transform,b=this.getZoom(),T=this.getBearing(),S=this.getPitch(),C=this.getPadding(),k="zoom"in l?+l.zoom:b,L="bearing"in l?this._normalizeBearing(l.bearing,T):T,N="pitch"in l?+l.pitch:S,j=this._extendPadding(l.padding),G=a.P.convert(l.offset);let q,re,ie;if(y.projection.name==="globe"){const Ne=a._.fromLngLat(y.center),qe=G.rotate(-y.angle);Ne.x+=qe.x/y.worldSize,Ne.y+=qe.y/y.worldSize;const Fe=Ne.toLngLat(),Pe=a.aJ.convert(l.center||Fe);this._normalizeCenter(Pe),q=y.centerPoint.add(qe),re=new a.P(Ne.x,Ne.y).mult(y.worldSize),ie=new a.P(a.ak(Pe.lng),a.al(Pe.lat)).mult(y.worldSize).sub(re)}else{q=y.centerPoint.add(G);const Ne=y.pointLocation(q),qe=a.aJ.convert(l.center||Ne);this._normalizeCenter(qe),re=y.project(Ne),ie=y.project(qe).sub(re)}const ae=y.zoomScale(k-b);let ce,ye;l.around&&(ce=a.aJ.convert(l.around),ye=y.locationPoint(ce));const ve=this._zooming||k!==b,_e=this._rotating||T!==L,Re=this._pitching||N!==S,Se=!y.isPaddingEqual(j),Ie=Ne=>qe=>{if(ve&&(Ne.zoom=a.a3(b,k,qe)),_e&&(Ne.bearing=a.a3(T,L,qe)),Re&&(Ne.pitch=a.a3(S,N,qe)),Se&&(Ne.interpolatePadding(C,j,qe),q=Ne.centerPoint.add(G)),ce)Ne.setLocationAtPoint(ce,ye);else{const Fe=Ne.zoomScale(Ne.zoom-b),Pe=k>b?Math.min(2,ae):Math.max(.5,ae),Qe=Math.pow(Pe,1-qe),Xe=Ne.unproject(re.add(ie.mult(qe*Qe)).mult(Fe));Ne.setLocationAtPoint(Ne.renderWorldCopies?Xe.wrap():Xe,q)}return l.preloadOnly||this._fireMoveEvents(d),Ne};if(l.preloadOnly){const Ne=this._emulate(Ie,l.duration,y);return this._preloadTiles(Ne),this}const ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ve,this._rotating=_e,this._pitching=Re,this._padding=Se,this._easeId=l.easeId,this._prepareEase(d,l.noMoveStart,ze),this._ease(Ie(y),Ne=>{y.cameraElevationReference==="sea"&&y.recenterOnTerrain(),this._afterEase(d,Ne)},l),this}_prepareEase(l,d,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),d||y.moving||this.fire(new a.g("movestart",l)),this._zooming&&!y.zooming&&this.fire(new a.g("zoomstart",l)),this._rotating&&!y.rotating&&this.fire(new a.g("rotatestart",l)),this._pitching&&!y.pitching&&this.fire(new a.g("pitchstart",l))}_fireMoveEvents(l){this.fire(new a.g("move",l)),this._zooming&&this.fire(new a.g("zoom",l)),this._rotating&&this.fire(new a.g("rotate",l)),this._pitching&&this.fire(new a.g("pitch",l))}_afterEase(l,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,b=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new a.g("zoomend",l)),b&&this.fire(new a.g("rotateend",l)),T&&this.fire(new a.g("pitchend",l)),this.fire(new a.g("moveend",l))}flyTo(l,d){if(this._prefersReducedMotion(l)){const nt=a.ai(l,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(nt,d)}this.stop(),l=a.Q({offset:[0,0],speed:1.2,curve:1.42,easing:a.d5},l);const y=this.transform,b=this.getZoom(),T=this.getBearing(),S=this.getPitch(),C=this.getPadding(),k="zoom"in l?a.au(+l.zoom,y.minZoom,y.maxZoom):b,L="bearing"in l?this._normalizeBearing(l.bearing,T):T,N="pitch"in l?+l.pitch:S,j=this._extendPadding(l.padding),G=y.zoomScale(k-b),q=a.P.convert(l.offset);let re=y.centerPoint.add(q);const ie=y.pointLocation(re),ae=a.aJ.convert(l.center||ie);this._normalizeCenter(ae);const ce=y.project(ie),ye=y.project(ae).sub(ce);let ve=l.curve;const _e=Math.max(y.width,y.height),Re=_e/G,Se=ye.mag();if("minZoom"in l){const nt=a.au(Math.min(l.minZoom,b,k),y.minZoom,y.maxZoom),je=_e/y.zoomScale(nt-b);ve=Math.sqrt(je/Se*2)}const Ie=ve*ve;function ze(nt){const je=(Re*Re-_e*_e+(nt?-1:1)*Ie*Ie*Se*Se)/(2*(nt?Re:_e)*Ie*Se);return Math.log(Math.sqrt(je*je+1)-je)}function Ne(nt){return(Math.exp(nt)-Math.exp(-nt))/2}function qe(nt){return(Math.exp(nt)+Math.exp(-nt))/2}const Fe=ze(0);let Pe=function(nt){return qe(Fe)/qe(Fe+ve*nt)},Qe=function(nt){return _e*((qe(Fe)*(Ne(je=Fe+ve*nt)/qe(je))-Ne(Fe))/Ie)/Se;var je},Xe=(ze(1)-Fe)/ve;if(Math.abs(Se)<1e-6||!isFinite(Xe)){if(Math.abs(_e-Re)<1e-6)return this.easeTo(l,d);const nt=Re<_e?-1:1;Xe=Math.abs(Math.log(Re/_e))/ve,Qe=function(){return 0},Pe=function(je){return Math.exp(nt*ve*je)}}l.duration="duration"in l?+l.duration:1e3*Xe/("screenSpeed"in l?+l.screenSpeed/ve:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const Ue=T!==L,_t=N!==S,ut=!y.isPaddingEqual(j),We=nt=>je=>{const ht=je*Xe,ft=1/Pe(ht);nt.zoom=je===1?k:b+nt.scaleZoom(ft),Ue&&(nt.bearing=a.a3(T,L,je)),_t&&(nt.pitch=a.a3(S,N,je)),ut&&(nt.interpolatePadding(C,j,je),re=nt.centerPoint.add(q));const Nt=je===1?ae:nt.unproject(ce.add(ye.mult(Qe(ht))).mult(ft));return nt.setLocationAtPoint(nt.renderWorldCopies?Nt.wrap():Nt,re),nt._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(d),nt};if(l.preloadOnly){const nt=this._emulate(We,l.duration,y);return this._preloadTiles(nt),this}return this._zooming=!0,this._rotating=Ue,this._pitching=_t,this._padding=ut,this._prepareEase(d,!1),this._ease(We(y),()=>this._afterEase(d),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(l){}_cancelRenderFrame(l){}_stop(l,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,d)}if(!l){const y=this.handlers;y&&y.stop(!1)}return this}_ease(l,d,y){y.animate===!1||y.duration===0?(l(1),d()):(this._easeStart=a.e.now(),this._easeOptions=y,this._onEaseFrame=l,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((a.e.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,d){l=a.av(l,-180,180);const y=Math.abs(l-d);return Math.abs(l-360-d)<y&&(l-=360),Math.abs(l+360-d)<y&&(l+=360),l}_normalizeCenter(l){const d=this.transform;if(d.maxBounds||d.projection.name!=="globe"&&!d.renderWorldCopies)return;const y=l.lng-d.center.lng;l.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&a.e.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,d,y){const b=Math.ceil(15*d/1e3),T=[],S=l(y.clone());for(let C=0;C<=b;C++){const k=S(C/b);T.push(k.clone())}return T}_preloadTiles(l,d){}}class Dp{constructor(l={}){this.options=l,a.br(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const d=this.options&&this.options.compact,y=l._getUIString("AttributionControl.ToggleAttribution");this._map=l,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=F("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",y);const b=F("span","mapboxgl-ctrl-icon",this._compactButton);return b.setAttribute("aria-hidden","true"),b.setAttribute("title",y),this._innerContainer=F("div","mapboxgl-ctrl-attrib-inner",this._container),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.db.ACCESS_TOKEN}];if(l){const y=d.reduce((b,T,S)=>(T.value&&(b+=`${T.key}=${T.value}${S<d.length-1?"&":""}`),b),"?");l.href=`${a.db.FEEDBACK_URL}/${y}#${S0(this._map,!0)}`,l.rel="noopener nofollow"}}_updateData(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const d=this._map.style._mergedSourceCaches;for(const b in d){const T=d[b];if(T.used){const S=T.getSource();S.attribution&&l.indexOf(S.attribution)<0&&l.push(S.attribution)}}l.sort((b,T)=>b.length-T.length),l=l.filter((b,T)=>{for(let S=T+1;S<l.length;S++)if(l[S].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const y=l.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,l.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ng{constructor(){a.br(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=F("div","mapboxgl-ctrl");const d=F("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(const d in l){const y=l[d].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const d=l[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class Fg{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d}remove(l){const d=this._currentlyRunning,y=d?this._queue.concat(d):this._queue;for(const b of y)if(b.id===l)return void(b.cancelled=!0)}run(l=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const y of d)if(!y.cancelled&&(y.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Op(g,l,d){if(g=new a.aJ(g.lng,g.lat),l){const y=new a.aJ(g.lng-360,g.lat),b=new a.aJ(g.lng+360,g.lat),T=360*Math.ceil(Math.abs(g.lng-d.center.lng)/360),S=d.locationPoint(g).distSqr(l),C=l.x<0||l.y<0||l.x>d.width||l.y>d.height;d.locationPoint(y).distSqr(l)<S&&(C||Math.abs(y.lng-d.center.lng)<T)?g=y:d.locationPoint(b).distSqr(l)<S&&(C||Math.abs(b.lng-d.center.lng)<T)&&(g=b)}for(;Math.abs(g.lng-d.center.lng)>180;){const y=d.locationPoint(g);if(y.x>=0&&y.y>=0&&y.x<=d.width&&y.y<=d.height)break;g.lng>d.center.lng?g.lng-=360:g.lng+=360}return g}const Bg={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class jg extends a.E{constructor(l,d){if(super(),(l instanceof HTMLElement||d)&&(l=a.Q({element:l},d)),a.br(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=a.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=F("div");const T=41,S=27,C=Z("svg",{display:"block",height:T*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${T}`},this._element),k=Z("radialGradient",{id:"shadowGradient"},Z("defs",{},C));Z("stop",{offset:"10%","stop-opacity":.4},k),Z("stop",{offset:"100%","stop-opacity":.05},k),Z("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),Z("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),Z("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),Z("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=a.P.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",T=>{T.preventDefault()}),this._element.addEventListener("mousedown",T=>{T.preventDefault()});const y=this._element.classList;for(const T in Bg)y.remove(`mapboxgl-marker-anchor-${T}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`);const b=l&&l.className?l.className.trim().split(/\s+/):[];y.add(...b),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=a.aJ.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const d=l.code,y=l.charCode||l.keyCode;d!=="Space"&&d!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(l){const d=l.originalEvent.target,y=this._element;this._popup&&(d===y||y.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,d=this._pos;if(!l||!d)return!1;const y=l.unproject(d),b=l.getFreeCameraOptions();if(!b.position)return!1;const T=b.position.toLngLat();return T.distanceTo(y)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const d=this._pos;if(!d||d.x<0||d.x>l.transform.width||d.y<0||d.y>l.transform.height)return void this._clearFadeTimer();const y=l.unproject(d);let b;l._showingGlobe()&&a.dc(l.transform,this._lngLat)?b=0:(b=1-l._queryFogOpacity(y),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${Bg[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${d.x}px,${d.y}px)
        `}_calculateXYTransform(){const l=this._pos,d=this._map,y=this.getPitchAlignment();if(!d||!l||y!=="map")return"";if(!d._showingGlobe()){const k=d.getPitch();return k?`rotateX(${k}deg)`:""}const b=a.b1(a.dd(d.transform,this._lngLat)),T=l.sub(a.de(d.transform)),S=Math.abs(T.x)+Math.abs(T.y);if(S===0)return"";const C=b/S;return`rotateX(${-T.y*C}deg) rotateY(${T.x*C}deg)`}_calculateZTransform(){const l=this._pos,d=this._map;if(!d||!l)return"";let y=0;const b=this.getRotationAlignment();if(b==="map")if(d._showingGlobe()){const T=d.project(new a.aJ(this._lngLat.lng,this._lngLat.lat+.001)),S=d.project(new a.aJ(this._lngLat.lng,this._lngLat.lat-.001)).sub(T);y=a.b1(Math.atan2(S.y,S.x))-90}else y=-d.getBearing();else if(b==="horizon"){const T=a.a0(4,6,d.getZoom()),S=a.de(d.transform);S.y+=T*d.transform.height;const C=l.sub(S),k=a.b1(Math.atan2(C.y,C.x));y=(k>90?k-270:k+90)*(1-T)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(l){cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Op(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),l===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=a.P.convert(l),this._update(),this}addClassName(l){return this._element.classList.add(l),this}removeClassName(l){return this._element.classList.remove(l),this}toggleClassName(l){return this._element.classList.toggle(l)}_onMove(l){const d=this._map;if(!d)return;const y=this._pointerdownPos,b=this._positionDelta;if(y&&b){if(!this._isDragging){const T=this._clickTolerance||d._clickTolerance;if(l.point.dist(y)<T)return;this._isDragging=!0}this._pos=l.point.sub(b),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.g("dragstart"))),this.fire(new a.g("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.g("dragend")),this._state="inactive"}_addDragHandler(l){const d=this._map,y=this._pos;d&&y&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(y),this._pointerdownPos=l.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const d=this._map;return d&&(l?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ad={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},CC=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ow(g=new a.P(0,0),l="bottom"){if(typeof g=="number"){const d=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(l){case"top":return new a.P(0,g);case"top-left":return new a.P(d,d);case"top-right":return new a.P(-d,d);case"bottom":return new a.P(0,-g);case"bottom-left":return new a.P(d,-d);case"bottom-right":return new a.P(-d,-d);case"left":return new a.P(g,0);case"right":return new a.P(-g,0)}return new a.P(0,0)}return g instanceof a.P||Array.isArray(g)?a.P.convert(g):a.P.convert(g[l]||[0,0])}class PC{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const d=a.bb((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,d,y){this._start=this.getValue(d),this._end=l,this._startTime=d,this._endTime=d+y}}const RC={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class MC{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const kC={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},O0={showCompass:!0,showZoom:!0,visualizePitch:!1};class L0{constructor(l,d,y=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new Cp({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,y&&(this.mousePitch=new Dg({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),a.br(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(l,d){this.mouseRotate.mousedown(l,d),this.mousePitch&&this.mousePitch.mousedown(l,d),W()}move(l,d){const y=this.map,b=this.mouseRotate.mousemoveWindow(l,d),T=b&&b.bearingDelta;if(T&&y.setBearing(y.getBearing()+T),this.mousePitch){const S=this.mousePitch.mousemoveWindow(l,d),C=S&&S.pitchDelta;C&&y.setPitch(y.getPitch()+C)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Q(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(a.Q({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),Te(this.element,l)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,Te(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=we(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=we(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const aw={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Cd={maxWidth:100,unit:"metric"},lw={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:a.dw,supported:I,setRTLTextPlugin:a.dy,getRTLTextPluginStatus:a.dz,Map:class extends D0{constructor(g){a.df.mark(a.dg.create);const l=g;if((g=a.Q({},kC,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&a.dh(window)&&(g.antialias=!1,a.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new eu(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._repaint=!!g.repaint,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new Fg,this._domRenderTaskQueue=new Fg,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.di(),this._locale=a.Q({},RC,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._tessellationStep=g.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=g.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new PC(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new a.dj(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?{...g.contextCreateOptions}:{},typeof g.container=="string"){const d=document.getElementById(g.container);if(!d)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=d}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&a.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),a.br(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new MC),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Lg(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||a.db.DEFAULT_STYLE,{config:g.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),g.hash&&(this._hash=new Yb(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){l.center==null&&l.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const d=g.bounds;d&&(this.resize(),this.fitBounds(d,a.Q({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new Dp({customAttribution:g.customAttribution})),this._logoControl=new Ng,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new a.g(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new a.g(`${d.dataType}dataloading`,d))})}_getMapId(){return this._mapId}addControl(g,l){if(l===void 0&&(l=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new a.f(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=g.onAdd(this);this._controls.push(g);const y=this._controlPositions[l];return l.indexOf("bottom")!==-1?y.insertBefore(d,y.firstChild):y.appendChild(d),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new a.f(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(g);return l>-1&&this._controls.splice(l,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new a.g("movestart",g)).fire(new a.g("move",g)),this.fire(new a.g("resize",g)),l&&this.fire(new a.g("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(a.aj.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new a.g("zoomstart")).fire(new a.g("zoom")).fire(new a.g("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new a.g("zoomstart")).fire(new a.g("zoom")).fire(new a.g("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new a.g("pitchstart")).fire(new a.g("pitch")).fire(new a.g("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new a.g("pitchstart")).fire(new a.g("pitch")).fire(new a.g("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(l=>l==="auto"?navigator.language:l):g}setLanguage(g){const l=this._parseLanguage(g);if(!this.style||l===this._language)return this;this._language=l,this.style.reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,l=g.projection.name;let d;l==="globe"&&g.zoom>=a.aV?(g.setMercatorFromTransition(),d=!0):l==="mercator"&&g.zoom<a.aV&&(g.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,l){return this._updateProjection(g||l||{name:"mercator"})}_updateProjection(g){let l;return l=g.name==="globe"&&this.transform.zoom>=a.aV?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),l&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g){return this.transform.locationPoint3D(a.aJ.convert(g))}unproject(g){return this.transform.pointLocation3D(a.P.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,l,d){if(g==="mouseenter"||g==="mouseover"){let y=!1;const b=S=>{const C=l.filter(L=>this.getLayer(L)),k=C.length?this.queryRenderedFeatures(S.point,{layers:C}):[];k.length?y||(y=!0,d.call(this,new ma(g,this,S.originalEvent,{features:k}))):y=!1},T=()=>{y=!1};return{layers:new Set(l),listener:d,delegates:{mousemove:b,mouseout:T}}}if(g==="mouseleave"||g==="mouseout"){let y=!1;const b=S=>{const C=l.filter(k=>this.getLayer(k));(C.length?this.queryRenderedFeatures(S.point,{layers:C}):[]).length?y=!0:y&&(y=!1,d.call(this,new ma(g,this,S.originalEvent)))},T=S=>{y&&(y=!1,d.call(this,new ma(g,this,S.originalEvent)))};return{layers:new Set(l),listener:d,delegates:{mousemove:b,mouseout:T}}}{const y=b=>{const T=l.filter(C=>this.getLayer(C)),S=T.length?this.queryRenderedFeatures(b.point,{layers:T}):[];S.length&&(b.features=S,d.call(this,b),delete b.features)};return{layers:new Set(l),listener:d,delegates:{[g]:y}}}}on(g,l,d){if(typeof l=="function"||d===void 0)return super.on(g,l);if(Array.isArray(l)||(l=[l]),l){for(const b of l)if(!this._isValidId(b))return this}const y=this._createDelegatedListener(g,l,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(y);for(const b in y.delegates)this.on(b,y.delegates[b]);return this}once(g,l,d){if(typeof l=="function"||d===void 0)return super.once(g,l);if(Array.isArray(l)||(l=[l]),l){for(const b of l)if(!this._isValidId(b))return this}const y=this._createDelegatedListener(g,l,d);for(const b in y.delegates)this.once(b,y.delegates[b]);return this}off(g,l,d){if(typeof l=="function"||d===void 0)return super.off(g,l);const y=new Set(Array.isArray(l)?l:[l]);for(const S of y)if(!this._isValidId(S))return this;const b=(S,C)=>{if(S.size!==C.size)return!1;for(const k of S)if(!C.has(k))return!1;return!0},T=this._delegatedListeners?this._delegatedListeners[g]:void 0;return T&&(S=>{for(let C=0;C<S.length;C++){const k=S[C];if(k.listener===d&&b(k.layers,y)){for(const L in k.delegates)this.off(L,k.delegates[L]);return S.splice(C,1),this}}})(T),this}queryRenderedFeatures(g,l){if(!this.style)return[];if(l!==void 0||g===void 0||g instanceof a.P||Array.isArray(g)||(l=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],(l=l||{}).layers&&Array.isArray(l.layers)){for(const d of l.layers)if(!this._isValidId(d))return[]}return this.style.queryRenderedFeatures(g,l,this.transform)}querySourceFeatures(g,l){return this._isValidId(g)?this.style.querySourceFeatures(g,l):[]}isPointOnSurface(g){const{name:l}=this.transform.projection;return l!=="globe"&&l!=="mercator"&&a.w(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(g))}setStyle(g,l){return l=a.Q({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l),this.style&&g&&l.diff!==!1&&l.localFontFamily===this._localFontFamily&&l.localIdeographFontFamily===this._localIdeographFontFamily&&!l.config?(this.style._diffStyle(g,(d,y)=>{d?(a.w(`Unable to perform style diff: ${String(d.message||d.error||d)}. Rebuilding the style from scratch.`),this._updateStyle(g,l)):y&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(g,l))}_getUIString(g){const l=this._locale[g];if(l==null)throw new Error(`Missing UI string '${g}'`);return l}_updateStyle(g,l){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g){const d=a.Q({},l);l&&l.config&&(d.initialConfig=l.config,delete d.config),this.style=new pa(this,d).load(g),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new pa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.w("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new a.f(new Error("IDs can't be empty."))),!1):!a.cY(g)||(this.fire(new a.f(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}addSource(g,l){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,l),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,l,d){this._lazyInitEmptyStyle(),this.style.addSourceType(g,l,d)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,l,{pixelRatio:d=1,sdf:y=!1,stretchX:b,stretchY:T,content:S}={}){if(this._lazyInitEmptyStyle(),l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap){const{width:C,height:k,data:L}=a.e.getImageData(l);this.style.addImage(g,{data:new a.j({width:C,height:k},L),pixelRatio:d,stretchX:b,stretchY:T,content:S,sdf:y,version:0})}else if(l.width===void 0||l.height===void 0)this.fire(new a.f(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:k}=l,L=l;this.style.addImage(g,{data:new a.j({width:C,height:k},new Uint8Array(L.data)),pixelRatio:d,stretchX:b,stretchY:T,content:S,sdf:y,version:0,userImage:L}),L.onAdd&&L.onAdd(this,g)}}updateImage(g,l){this._lazyInitEmptyStyle();const d=this.style.getImage(g);if(!d)return void this.fire(new a.f(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap?a.e.getImageData(l):l,{width:b,height:T,data:S}=y;if(b===void 0||T===void 0)return void this.fire(new a.f(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==d.data.width||T!==d.data.height)return void this.fire(new a.f(new Error(`The width and height of the updated image (${b}, ${T})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const C=!(l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap);d.data.replace(S,C),this.style.updateImage(g,d)}hasImage(g){return g?!!this.style&&!!this.style.getImage(g):(this.fire(new a.f(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,l){a.i(this._requestManager.transformRequest(g,a.R.Image),(d,y)=>{l(d,y instanceof HTMLImageElement?a.e.getImageData(y):y)})}listImages(){return this.style.listImages()}addModel(g,l){this._lazyInitEmptyStyle(),this.style.addModel(g,l)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new a.f(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,l){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,l),this._update(!0)):this}getSlot(g){const l=this.getLayer(g);return l&&l.slot||null}setSlot(g,l){return this.style.setSlot(g,l),this.style.mergeLayers(),this._update(!0)}addImport(g,l){return this.style.addImport(g,l),this}updateImport(g,l){return typeof l!="string"&&l.id!==g?(this.removeImport(g),this.addImport(l)):(this.style.updateImport(g,l),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,l){return this.style.moveImport(g,l),this._update(!0)}moveLayer(g,l){return this._isValidId(g)?(this.style.moveLayer(g,l),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){if(!this._isValidId(g))return null;const l=this.style.getOwnLayer(g);return l?l.type==="custom"?l.implementation:l.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(g,l,d){return this._isValidId(g)?(this.style.setLayerZoomRange(g,l,d),this._update(!0)):this}setFilter(g,l,d={}){return this._isValidId(g)?(this.style.setFilter(g,l,d),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,l,d,y={}){return this._isValidId(g)?(this.style.setPaintProperty(g,l,d,y),this._update(!0)):this}getPaintProperty(g,l){return this._isValidId(g)?this.style.getPaintProperty(g,l):null}setLayoutProperty(g,l,d,y={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,l,d,y),this._update(!0)):this}getLayoutProperty(g,l){return this._isValidId(g)?this.style.getLayoutProperty(g,l):null}getSchema(g){return this.style.getSchema(g)}setSchema(g,l){return this.style.setSchema(g,l),this._update(!0)}getConfig(g){return this.style.getConfig(g)}setConfig(g,l){return this.style.setConfig(g,l),this._update(!0)}getConfigProperty(g,l){return this.style.getConfigProperty(g,l)}setConfigProperty(g,l,d){return this.style.setConfigProperty(g,l,d),this._update(!0)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const l=g[0];l.properties?this.style.setFlatLight(l.properties,l.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,l={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(g){return this._lazyInitEmptyStyle(),this.style.setColorTheme(g),this._update(!0)}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.aJ.convert(g),this.transform):0}setFeatureState(g,l){return this._isValidId(g.source)?(this.style.setFeatureState(g,l),this._update()):this}removeFeatureState(g,l){return this._isValidId(g.source)?(this.style.removeFeatureState(g,l),this._update()):this}getFeatureState(g){return this._isValidId(g.source)?this.style.getFeatureState(g):null}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let d,y,b,T=this._container;for(;T&&(!y||!b);){const S=window.getComputedStyle(T).transform;S&&S!=="none"&&(d=S.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&d[0]!=="0"&&d[0]!=="1"&&(y=d[0]),d[3]&&d[3]!=="0"&&d[3]!=="1"&&(b=d[3])),T=T.parentElement}this._containerWidth=y?Math.abs(g/y):g,this._containerHeight=b?Math.abs(l/b):l}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=F("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=F("div","mapboxgl-canvas-container",g);this._canvas=F("canvas","mapboxgl-canvas",l),this._interactive&&(l.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=F("div","mapboxgl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{y[b]=F("div",`mapboxgl-ctrl-${b}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,l){const d=a.e.devicePixelRatio||1;this._canvas.width=d*Math.ceil(g),this._canvas.height=d*Math.ceil(l),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${l}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const l=this._markers.indexOf(g);l!==-1&&this._markers.splice(l,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const l=this._popups.indexOf(g);l!==-1&&this._popups.splice(l,1)}_setupPainter(){const g=a.Q({},I.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl2",g);l?(a.dk(l,!0),this.painter=new y0(l,this._contextCreateOptions,this.transform,this._tp),this.on("data",d=>{d.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.dl.testSupport(l)):this.fire(new a.f(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.g("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new a.g("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let l;this.fire(new a.g("renderstart")),++this._frameId;const d=this.painter.context.extTimerQuery,y=a.e.now(),b=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(l=b.createQuery(),b.beginQuery(d.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,N=this.transform.pitch,j=a.e.now(),G=new a.Y(L,{now:j,fadeDuration:T,pitch:N,transition:this.style.transition});this.style.update(G)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(y),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(y);const C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions,this.painter.replacementSource);if(C&&(this._placementDirty=C.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.g("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.df.mark(a.dg.load),this.fire(new a.g("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const L=a.e.now()-y;b.endQuery(d.TIME_ELAPSED_EXT),setTimeout(()=>{const N=b.getQueryParameter(l,b.QUERY_RESULT)/1e6;b.deleteQuery(l),this.fire(new a.g("gpu-timing-frame",{cpuTime:L,gpuTime:N}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const N=this.painter.queryGpuTimers(L);this.fire(new a.g("gpu-timing-layer",{layerTimes:N}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const N=this.painter.queryGpuTimeDeferredRender(L);this.fire(new a.g("gpu-timing-deferred-render",{gpuTime:N}))},50)}const k=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(k||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(S=this._updateAverageElevation(y,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new a.g("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const N=this._calculateSpeedIndex();this.fire(new a.g("speedindexcompleted",{speedIndex:N})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,a.df.mark(a.dg.fullLoad),this._performanceMetricsCollection&&a.dm(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const l of this._markers)g&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!g||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(g,l=!1){const d=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&d(0);const y=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(y||(l||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const b=this.transform.averageElevation;let T=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(T)?T=0:this._averageElevationLastSampledAt=g;const S=Math.abs(b-T);if(S>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(T),d(T);this._averageElevation.easeTo(T,g,300)}else if(S>1e-4)return this._averageElevation.jumpTo(T),d(T)}return!!this._averageElevation.isEasing(g)&&d(this._averageElevation.getValue(g))}_authenticate(){a.dn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===a.dp||g.status===401)){const l=this.painter.context.gl;a.dk(l,!1),this._logoControl instanceof Ng&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.f(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.dq(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&a.dr(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const d=this.painter.context.gl,y=d.createFramebuffer();function b(T){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,T,0);const S=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,S),S}return d.bindFramebuffer(d.FRAMEBUFFER,y),this._canvasPixelComparison(b(g),l.canvasCopies.map(b),l.timeStamps)}_canvasPixelComparison(g,l,d){let y=d[1]-d[0];const b=g.length/4;for(let T=0;T<l.length;T++){const S=l[T];let C=0;for(let k=0;k<S.length;k+=4)S[k]===g[k]&&S[k+1]===g[k+1]&&S[k+2]===g[k+2]&&S[k+3]===g[k+3]&&(C+=1);y+=(d[T+2]-d[T+1])*(1-C/b)}return y}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.ds(this.painter.context.gl),a.dt.remove(),a.du.remove(),this._removed=!0,this.fire(new a.g("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=a.e.frame(l=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(l)}))}_preloadTiles(g){const l=this.style?this.style.getSourceCaches():[];return a.dv(l,(d,y)=>d._preloadTiles(g,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,this._tp.refreshUI(),g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,this._tp.refreshUI(),g&&this._update())}_setCacheLimits(g,l){a.dx(g,l)}get version(){return a.dw}},NavigationControl:class{constructor(g={}){this.options=a.Q({},O0,g),this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(a.br(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),F("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),F("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.br(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:l}):d.resetNorth({},{originalEvent:l}))}),this._compassIcon=F("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const l=g.getZoom(),d=l===g.getMaxZoom(),y=l===g.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new L0(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,l){const d=F("button",g,this._container);return d.type="button",d.addEventListener("click",l),d}_setButtonTitle(g,l){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${l}`);g.setAttribute("aria-label",d),g.firstElementChild&&g.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends a.E{constructor(g={}){super();const l=navigator.geolocation;this.options=a.Q({geolocation:l},aw,g),a.br(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Kb(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const l=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,g(d)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(d=>l(d.state!=="denied")).catch(()=>l()):l()}_isOutOfMapMaxBounds(g){const l=this._map.getMaxBounds(),d=g.coords;return!!l&&(d.longitude<l.getWest()||d.longitude>l.getEast()||d.latitude<l.getSouth()||d.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new a.g("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.g("geolocate",g)),this._finish()}}_updateCamera(g){const l=new a.aJ(g.coords.longitude,g.coords.latitude),d=g.coords.accuracy,y=this._map.getBearing(),b=a.Q({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(d),b,{geolocateSource:!0})}_updateMarker(g){if(g){const l=new a.aJ(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,l=a.ay(1,g._center.lat)*g.worldSize,d=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.g("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=F("button","mapboxgl-ctrl-geolocate",this._container),F("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F("div","mapboxgl-user-location"),this._dotElement.appendChild(F("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(F("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new jg({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=F("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jg({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.g("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.g("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.g("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.g("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Dp,ScaleControl:class{constructor(g={}){this.options=a.Q({},Cd,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.br(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,l=this._map,d=l._containerHeight/2,y=l._containerWidth/2-g/2,b=l.unproject([y,d]),T=l.unproject([y+g,d]),S=b.distanceTo(T);if(this.options.unit==="imperial"){const C=3.2808*S;C>5280?this._setScale(g,C/5280,"mile"):this._setScale(g,C,"foot")}else this.options.unit==="nautical"?this._setScale(g,S/1852,"nautical-mile"):S>=1e3?this._setScale(g,S/1e3,"kilometer"):this._setScale(g,S,"meter")}_setScale(g,l,d){this._map._requestDomTask(()=>{const y=function(T){const S=Math.pow(10,`${Math.floor(T)}`.length-1);let C=T/S;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(k){const L=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*L)/L}(C),S*C}(l),b=y/l;this._container.innerHTML=this._isNumberFormatSupported&&d!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(y):`${y}&nbsp;${lw[d]}`,this._container.style.width=g*b+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g={}){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:a.w("Full screen control 'container' must be a DOM element.")),a.br(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=F("button","mapboxgl-ctrl-fullscreen",this._controlContainer);F("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.E{constructor(g){super(),this.options=a.Q(Object.create(Ad),g),a.br(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new a.g("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new a.g("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=a.aJ.convert(g),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const l=document.createDocumentFragment(),d=document.createElement("body");let y;for(d.innerHTML=g;y=d.firstChild,y;)l.appendChild(y);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=F("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(g),this.options.closeButton){const d=this._closeButton=F("button","mapboxgl-popup-close-button",l);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let l;return this._classList.delete(g)?l=!1:(this._classList.add(g),l=!0),this._updateClassList(),l}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const l=this._map,d=this._container,y=this._pos;if(!l||!d||!y)return"bottom";const b=d.offsetWidth,T=d.offsetHeight,S=y.x<b/2,C=y.x>l.transform.width-b/2;if(y.y+g<T)return S?"top-left":C?"top-right":"top";if(y.y>l.transform.height-T){if(S)return"bottom-left";if(C)return"bottom-right"}return S?"left":C?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),g.className=l.join(" ")}_update(g){const l=this._map,d=this._content;if(!l||!this._lngLat&&!this._trackPointer||!d)return;let y=this._container;if(y||(y=this._container=F("div","mapboxgl-popup",l.getContainer()),this._tip=F("div","mapboxgl-popup-tip",y),y.appendChild(d)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Op(this._lngLat,this._pos,l.transform)),!this._trackPointer||g){const b=this._pos=this._trackPointer&&g instanceof a.P?g:l.project(this._lngLat),T=ow(this.options.offset),S=this._anchor=this._getAnchor(T.y),C=ow(this.options.offset,S),k=b.add(C).round();l._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Bg[S]} translate(${k.x}px,${k.y}px)`)})}if(!this._marker&&l._showingGlobe()){const b=a.dc(l.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(CC);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:jg,Style:pa,LngLat:a.aJ,LngLatBounds:a.aj,Point:a.P,MercatorCoordinate:a._,FreeCameraOptions:hd,Evented:a.E,config:a.db,prewarm:a.dA,clearPrewarmedResources:a.dB,get accessToken(){return a.db.ACCESS_TOKEN},set accessToken(g){a.db.ACCESS_TOKEN=g},get baseApiUrl(){return a.db.API_URL},set baseApiUrl(g){a.db.API_URL=g},get workerCount(){return a.dC.workerCount},set workerCount(g){a.dC.workerCount=g},get maxParallelImageRequests(){return a.db.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){a.db.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){a.dD(g)},get workerUrl(){return a.dE.workerUrl},set workerUrl(g){a.dE.workerUrl=g},get workerClass(){return a.dE.workerClass},set workerClass(g){a.dE.workerClass=g},get workerParams(){return a.dE.workerParams},set workerParams(g){a.dE.workerParams=g},get dracoUrl(){return a.dF()},set dracoUrl(g){a.dG(g)},get meshoptUrl(){return a.dH()},set meshoptUrl(g){a.dI(g)},setNow:a.e.setNow,restoreNow:a.e.restoreNow}});var x=f;return x})})(OX);var UEe=OX.exports;const $m=Wm(UEe),zX="pk.eyJ1Ijoia3lpbTUwIiwiYSI6ImNsempkdjZibDAzM2MybXE4bDJmcnZ6ZGsifQ.-ie6lQO1TWYrL8c6h2W41g";$m.accessToken=zX;let tE=null,j$=!1;const Fl={},VEe=async(t,e)=>{if(Ut.currentUser){const r=ar(Cn,"users",Ut.currentUser.uid);try{await Ns(r,{location:{latitude:t,longitude:e,timestamp:new Date().toISOString()}})}catch(o){console.error("Error updating location:",o)}}},NX=(t,e,r,o)=>{if(console.log("Adding marker for user:",o),!t||typeof t.addLayer!="function")return console.error("Invalid map object in addMarker"),null;if(!t.loaded())return console.log("Map not yet loaded, waiting..."),t.on("load",()=>NX(t,e,r,o)),null;const c=document.createElement("div");c.className="marker-container";const f=document.createElement("img");f.src=o.profilePhoto||"/default-profile.png",f.alt=o.name||"User",f.className="marker-image";let _=!1;f.onerror=()=>{_||(console.warn(`Failed to load image for ${o.name||"user"}, default profile used.`),_=!0),f.src="/default-profile.png"},c.appendChild(f);const x=document.createElement("div");x.className="marker-dot",c.appendChild(x);try{const a=new $m.Marker(c).setLngLat([r,e]).addTo(t);console.log("Marker created:",a);const I=new $m.Popup({offset:25,closeButton:!1,closeOnClick:!1,maxWidth:"none"}),D=document.createElement("div");D.className="custom-popup",D.innerHTML=`
      <div class="profile-container">
        <div class="profile-header">
          <div class="profile-photo-container">
            <img src="${o.profilePhoto||"/default-profile.png"}" alt="${o.name||"User"}" class="profile-photo">
          </div>
          <div class="profile-info">
            <h2 class="profile-name">${o.name||"Unknown User"}</h2>
            <p class="profile-status"><span class="status-dot"></span> Active</p>
            <p class="profile-bio">${o.bio||"No bio available"}</p>
          </div>
        </div>
        <div class="tags-container">
          ${(o.tags||[]).map(F=>`<div class="tag">${F}</div>`).join("")}
        </div>
        <button class="add-friend-button">Add Friend</button>
      </div>
    `;const O=D.querySelector(".add-friend-button");return O.addEventListener("click",async()=>{console.log("Add friend button clicked");try{const F=ar(Cn,"users",Ut.currentUser.uid),ne=(await ns(F)).data().friends||[];ne.includes(o.id)||(await Ns(F,{friends:[...ne,o.id]}),O.textContent="Friend Added",O.disabled=!0)}catch(F){console.error("Error adding friend:",F)}}),I.setDOMContent(D),a.setPopup(I),a.getElement().addEventListener("click",F=>{console.log("Marker clicked:",o),F.stopPropagation(),I.addTo(t)}),a}catch(a){return console.error("Error creating marker:",a),null}},FX=(t,e)=>{if(console.log("Setting up user locations listener"),!t||typeof t.addLayer!="function")return console.error("Invalid map object in setupUserLocationsListener"),()=>{};if(!t.loaded())return t.on("load",()=>FX(t,e)),()=>{};const r=rs(Cn,"users"),o=Oo(r,Di("isActive","==",!0));return Df(o,async c=>{console.log("User locations snapshot received");const f=new Set,_=Ut.currentUser;if(!_){console.warn("No authenticated user found");return}const a=(await ns(ar(Cn,"users",_.uid))).data(),I=(a==null?void 0:a.friends)||[],D=(a==null?void 0:a.isPrivate)||!1;c.forEach(async O=>{const F=O.id,Z=O.data();console.log("Processing user:",F,Z);const J=!Z.isPrivate||F===_.uid||D&&I.includes(F)||!D&&I.includes(F);if(Z.isActive&&Z.location&&J){f.add(F);const ne=new Date(Z.location.timestamp).getTime();if(new Date().getTime()-ne>3e5)console.log("Removing inactive user:",F),Fl[F]&&(Fl[F].remove(),delete Fl[F]);else if(Fl[F])console.log("Updating marker for user:",F),Fl[F].setLngLat([Z.location.longitude,Z.location.latitude]);else{console.log("Adding new marker for user:",F);const Q=NX(t,Z.location.latitude,Z.location.longitude,{id:F,name:Z.name,profilePhoto:Z.profilePhoto,bio:Z.bio,tags:Z.tags});Q&&(Fl[F]=Q)}}else console.log("Removing marker for non-visible user:",F),Fl[F]&&(Fl[F].remove(),delete Fl[F])}),Object.keys(Fl).forEach(O=>{f.has(O)||(console.log("Removing marker for user no longer in snapshot:",O),Fl[O].remove(),delete Fl[O])}),typeof e=="function"?e([...f]):console.warn("setCurrentUserIds is not a function")})},$Ee=(t,e)=>{if(console.log("Setting up user location tracking"),!t||typeof t.addLayer!="function"){console.error("Invalid map object in trackUserLocation");return}if("geolocation"in navigator)return navigator.geolocation.watchPosition(o=>{const{latitude:c,longitude:f}=o.coords;VEe(c,f),(!tE||!j$||Math.abs(c-tE.latitude)>.001||Math.abs(f-tE.longitude)>.001)&&(t.flyTo({center:[f,c],zoom:15}),tE={latitude:c,longitude:f},j$=!0),fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${f},${c}.json?access_token=${zX}`).then(x=>x.json()).then(x=>{x.features&&x.features.length>0&&e(x.features[0].place_name)}).catch(x=>{console.error("Error fetching address:",x)})},o=>{console.error("Error getting location:",o)},{enableHighAccuracy:!0,maximumAge:0,timeout:27e3});console.error("Geolocation is not supported by this browser.")},oD=async(t,e)=>{if(!t){console.error("Map object is not available");return}try{const o=(await ns(ar(Cn,"users",e))).data();o&&o.location?t.flyTo({center:[o.location.longitude,o.location.latitude],zoom:15,duration:1e3}):console.warn(`No location data found for user ${e}`)}catch(r){console.error("Error centering map on user:",r)}},aD=async t=>{if(Ut.currentUser){const e=ar(Cn,"users",Ut.currentUser.uid);try{await Ns(e,{isActive:t})}catch(r){console.error("Error updating active status:",r)}}},GEe=t=>Ut.onAuthStateChanged(e=>{e?aD(!0):(aD(!1),t("/login"))}),qEe=(t,e)=>{Ut.currentUser?aD(!1).then(()=>{localStorage.clear(),Ut.signOut().then(()=>{t("/login")}).catch(r=>{console.error("Error signing out:",r)})}):(localStorage.clear(),Ut.signOut().then(()=>{t("/login")}).catch(r=>{console.error("Error signing out:",r)}))},WEe=t=>{t.getLayer("route")&&t.removeLayer("route"),t.getSource("route")&&t.removeSource("route")},HEe=({currentUserIds:t,map:e,setLockedUserId:r,lockedUserId:o,lockedUserData:c})=>{const[f,_]=ee.useState(!1),[x,a]=ee.useState(""),[I,D]=ee.useState(""),[O,F]=ee.useState(""),[Z,J]=ee.useState([]),[ne,se]=ee.useState(""),[W,Q]=ee.useState([]),[K,pe]=ee.useState(null),[Te,we]=ee.useState(!1),[oe,de]=ee.useState(!1),[X,ge]=ee.useState(null),[be,ke]=ee.useState(null),[Ee,Lt]=ee.useState(null),[jt,Qt]=ee.useState({acceptors:[],pendingAcceptors:[]}),[Pt,lt]=ee.useState(!1);ee.useState(null),ee.useState(!1);const[At,nn]=ee.useState([]),[fn,mn]=ee.useState("public"),[Vt,wn]=ee.useState(window.innerHeight*.5),{showNotification:Ht}=Eb();ee.useEffect(()=>{(async()=>{try{const Rt=Oo(rs(Cn,"users")),bn=Df(Rt,Pn=>{if(Pn.empty){console.error("No users found."),Q([]);return}const gn=Pn.docs.map(er=>({id:er.id,...er.data()}));Q(gn)});return()=>bn()}catch(Rt){console.error("Error fetching users:",Rt)}})()},[]),ee.useEffect(()=>{Ut.currentUser&&(async()=>{try{const Rt=Oo(rs(Cn,"quests"),Di("isPublic","==",!0)),bn=Oo(rs(Cn,"quests"),Di("uid","==",Ut.currentUser.uid)),Pn=Oo(rs(Cn,"quests"),Di("targetUser","==",Ut.currentUser.uid)),[gn,er,Ur]=await Promise.all([cl(Rt),cl(bn),cl(Pn)]),hn=gn.docs.map(vi=>({id:vi.id,...vi.data()})),Rn=er.docs.map(vi=>({id:vi.id,...vi.data()})),Kt=await Promise.all(Ur.docs.map(async vi=>{const go=vi.data(),Xi=await ns(ar(Cn,"users",go.uid)),Ao=Xi.exists()?Xi.data():{};return{id:vi.id,...go,senderName:Ao.name||"Unknown sender"}})),zi=[...hn,...Rn,...Kt],li=new Map(zi.map(vi=>[vi.id,vi]));J(Array.from(li.values()))}catch(Rt){console.error("Error fetching quests:",Rt)}})()},[Ut.currentUser,Ht,W]);const Hn=W.filter(Ye=>Ye.name.toLowerCase().includes(ne.toLowerCase())),Jn=()=>{if(!Ut.currentUser)return;const Ye={uid:Ut.currentUser.uid,title:x,description:I,timeFrame:O,createdAt:new Date,isPublic:Te,targetUser:Te?null:K.id,status:"pending",acceptedBy:Te?[]:null};ge(Ye),de(!0),_(!1)},ir=async()=>{if(Ut.currentUser){if(!X){console.error("Pending quest is null.");return}try{const Ye=ar(rs(Cn,"quests"));if(X.isPublic)await xm(Ye,{...X,id:Ye.id,uid:Ut.currentUser.uid,acceptedBy:[],pendingAcceptors:[]});else{if(!X.targetUser){console.error("Target user is missing in the quest");return}const Rt=Oo(rs(Cn,"quests"),Di("uid","==",Ut.currentUser.uid),Di("targetUser","==",X.targetUser),Di("title","==",X.title),Di("description","==",X.description),Di("isPublic","==",!1));if(!(await cl(Rt)).empty){Ht("A similar private quest already exists for this user.","info");return}await xm(Ye,{...X,id:Ye.id,uid:Ut.currentUser.uid,acceptedBy:[],pendingAcceptors:[]})}Ht("Quest created!","success"),ge(null),de(!1),a(""),D(""),F(""),pe(null),se(""),we(!1)}catch(Ye){console.error("Error creating quest:",Ye),Ht("Failed to create quest.","error")}}},Zt=async Ye=>{if(Ut.currentUser)try{const Rt=ar(Cn,"quests",Ye),Pn=(await ns(Rt)).data();if(!Pn.isPublic&&Pn.targetUser===Ut.currentUser.uid)await kx(Rt),J(Z.filter(gn=>gn.id!==Ye)),Ht("Quest declined!","success");else if(Pn.isPublic)await Ns(Rt,{declinedBy:Dx(Ut.currentUser.uid)}),J(Z.filter(gn=>gn.id!==Ye)),Ht("Quest declined!","success");else{const gn=Pn.acceptedBy.filter(er=>er!==Ut.currentUser.uid);await Ns(Rt,{acceptedBy:gn}),J(Z.map(er=>er.id===Ye?{...er,acceptedBy:gn}:er)),Ht("Quest declined!","success")}}catch(Rt){console.error("Error declining quest:",Rt),Ht("Failed to decline quest.","error")}},zt=async Ye=>{if(!Ut.currentUser){console.error("No authenticated user"),Ht("You must be logged in to accept quests.","error");return}if(!Ye.id){console.error("Quest ID is missing"),Ht("Invalid quest. Please try again.","error");return}try{const Rt=ar(Cn,"quests",Ye.id),bn=await ns(Rt);if(!bn.exists()){console.error("Quest does not exist"),Ht("This quest no longer exists.","error");return}let gn={...bn.data(),status:Ye.isPublic?"pending":"accepted"};Ye.isPublic?gn.pendingAcceptors=Dx(Ut.currentUser.uid):gn.acceptedBy=Ut.currentUser.uid;const er=await ns(ar(Cn,"users",Ye.uid)),Ur=await ns(ar(Cn,"users",Ut.currentUser.uid));if(!er.exists()||!Ur.exists()){console.error("Sender or receiver data not found"),Ht("Unable to process quest. User data missing.","error");return}const hn=er.data(),Rn=Ur.data();if(!hn.location||!Rn.location?(console.error("Sender or receiver location missing"),Ht("Location data is missing. Unable to display route.","warning")):gn.routeInfo={senderLocation:hn.location,receiverLocation:Rn.location},await Ns(Rt,gn),J(Kt=>Kt.map(zi=>zi.id===Ye.id?gn:zi)),Ye.isPublic||(nn(Kt=>[...Kt,gn]),gn.routeInfo&&e&&qt(e,gn.routeInfo.senderLocation,gn.routeInfo.receiverLocation)),Ht("Quest accepted!","success"),Ye.isPublic){const Kt=ar(rs(Cn,"notifications"));await xm(Kt,{type:"quest_accepted",questId:Ye.id,recipientId:Ye.uid,senderId:Ut.currentUser.uid,content:`${Ut.currentUser.displayName||"Someone"} has accepted your quest: ${Ye.title}`,createdAt:new Date,read:!1})}}catch(Rt){console.error("Error accepting quest:",Rt),Ht("Failed to accept quest. Please try again.","error")}},qt=ee.useCallback((Ye,Rt)=>{if(!e||!e.loaded()){console.error("Map is not fully loaded");return}if(!Ye||!Rt){console.error("Invalid locations for route display");return}const bn=`https://api.mapbox.com/directions/v5/mapbox/walking/${Ye.longitude},${Ye.latitude};${Rt.longitude},${Rt.latitude}?geometries=geojson&access_token=${$m.accessToken}`;fetch(bn).then(Pn=>Pn.json()).then(Pn=>{if(!Pn.routes||Pn.routes.length===0){console.error("No route found in the response");return}const gn=Pn.routes[0].geometry;e.getSource("route")?e.getSource("route").setData(gn):e.addLayer({id:"route",type:"line",source:{type:"geojson",data:gn},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#00FFFF","line-width":5,"line-opacity":.75}});const er=new $m.LngLatBounds().extend([Ye.longitude,Ye.latitude]).extend([Rt.longitude,Rt.latitude]);e.fitBounds(er,{padding:50})}).catch(Pn=>{console.error("Error fetching or displaying route:",Pn)})},[e]);ee.useEffect(()=>{if(Ut.currentUser&&e){const Ye=Df(Oo(rs(Cn,"quests"),Di("status","in",["approved","accepted"]),Di("uid","==",Ut.currentUser.uid)),Rt=>{const bn=Rt.docs.map(Pn=>({id:Pn.id,...Pn.data()}));nn(bn),bn.forEach(Pn=>{!Pn.isPublic&&Pn.routeInfo&&qt(Pn.routeInfo.senderLocation,Pn.routeInfo.receiverLocation)})});return()=>Ye()}},[Ut.currentUser,e,qt]);const xn=async(Ye,Rt)=>{if(console.log("Approving acceptor:",Rt),!Rt||!Rt.id){console.error("Selected acceptor is not defined or missing id."),Ht("Invalid acceptor data.","error");return}try{const bn=ar(Cn,"quests",Ye),Pn=await ns(bn);if(!Pn.exists()){console.error("Quest document does not exist."),Ht("Quest not found.","error");return}const gn=Pn.data(),er={...gn,pendingAcceptors:w3(Rt.id),acceptedBy:Dx(Rt.id),targetUser:Rt.id,status:"approved"};if(Ut.currentUser){const Ur=ar(Cn,"users",Ut.currentUser.uid),hn=ar(Cn,"users",Rt.id),[Rn,Kt]=await Promise.all([ns(Ur),ns(hn)]);if(Rn.exists()&&Kt.exists()){const zi=Rn.data(),li=Kt.data();zi.location&&li.location&&(er.routeInfo={senderLocation:zi.location,receiverLocation:li.location})}}await Ns(bn,er),J(Ur=>Ur.map(hn=>hn.id===Ye?{...hn,...er}:hn)),nn(Ur=>[...Ur,{...gn,...er,id:Ye}]),er.routeInfo&&e&&qt(e,er.routeInfo.senderLocation,er.routeInfo.receiverLocation),Ht(`Quest approved for ${Rt.name}!`,"success"),lt(!1)}catch(bn){console.error("Error approving acceptor:",bn),Ht("Failed to approve acceptor.","error")}},rr=async Ye=>{try{const Rt=ar(Cn,"quests",Ye);await kx(Rt),J(Z.filter(bn=>bn.id!==Ye)),nn(At.filter(bn=>bn.id!==Ye)),e&&WEe(e),Ht("Quest completed and deleted!","success")}catch(Rt){console.error("Error completing quest:",Rt),Ht("Failed to complete quest.","error")}},Gn=async Ye=>{try{const Rt=ar(Cn,"quests",Ye);await kx(Rt),J(Z.filter(bn=>bn.id!==Ye)),Ht("Quest canceled!","success")}catch(Rt){console.error("Error canceling quest:",Rt),Ht("Failed to cancel quest.","error")}},yr=async Ye=>{try{const Rt=ar(Cn,"quests",Ye.id),Pn=(await ns(Rt)).data(),gn=Pn.acceptedBy||[],er=Pn.pendingAcceptors||[],Ur=await Promise.all(gn.map(async Rn=>{const Kt=await ns(ar(Cn,"users",Rn));return{id:Rn,...Kt.data()}})),hn=await Promise.all(er.map(async Rn=>{const Kt=await ns(ar(Cn,"users",Rn));return{id:Rn,...Kt.data()}}));Qt({acceptors:Ur,pendingAcceptors:hn}),Lt(Ye),lt(!0)}catch(Rt){console.error("Error fetching acceptors:",Rt),Ht("Failed to fetch acceptors.","error")}},Gr=Ye=>{se(Ye.target.value)},mr=Z.filter(Ye=>{var Rt,bn,Pn,gn;return Ye.isPublic?Ye.uid===((Rt=Ut.currentUser)==null?void 0:Rt.uid)||Ye.approvedUser===((bn=Ut.currentUser)==null?void 0:bn.uid):Ye.targetUser===((Pn=Ut.currentUser)==null?void 0:Pn.uid)||Ye.uid===((gn=Ut.currentUser)==null?void 0:gn.uid)}),wr=Ye=>{pe(Ye),se("")},wt=()=>{_(!f)},St=()=>{we(!Te)},Ct=Ye=>{Ye.target.value.split(/\s+/).length<=300&&D(Ye.target.value)},it=async(Ye,Rt)=>{try{const bn=ar(Cn,"quests",Ye.id);await Ns(bn,{acceptedBy:Rt.id,pendingAcceptors:[]}),J(Z.map(Pn=>Pn.id===Ye.id?{...Pn,acceptedBy:Rt.id,pendingAcceptors:[]}:Pn)),Qt([]),Ht(`Quest assigned to ${Rt.name}!`,"success")}catch(bn){console.error("Error selecting acceptor:",bn),Ht("Failed to assign quest.","error")}},pt=()=>{ke(null)},Jt=()=>{switch(fn){case"public":return V.jsxs("div",{className:"quests-column",children:[V.jsx("h3",{children:"Public Quests"}),mr.filter(Ye=>{var Rt;return Ye.isPublic&&(!Ye.declinedBy||!Ye.declinedBy.includes((Rt=Ut.currentUser)==null?void 0:Rt.uid))}).length>0?mr.filter(Ye=>{var Rt;return Ye.isPublic&&(!Ye.declinedBy||!Ye.declinedBy.includes((Rt=Ut.currentUser)==null?void 0:Rt.uid))}).map(Ye=>{var Pn,gn,er,Ur,hn;const bn=(W.find(Rn=>Rn.id===Ye.uid)||{}).name||"";return V.jsxs("div",{className:"quest-item",children:[V.jsxs("p",{children:[V.jsx("strong",{children:"Title:"})," ",Ye.title]}),V.jsxs("p",{children:[V.jsx("strong",{children:"Description:"})," ",Ye.description]}),V.jsxs("p",{children:[V.jsx("strong",{children:"Time Frame:"})," ",Ye.timeFrame]}),V.jsxs("p",{children:[V.jsx("strong",{children:"Sender:"})," ",bn]}),Ye.isPublic&&((Pn=Ut.currentUser)==null?void 0:Pn.uid)!==Ye.uid&&!(Array.isArray(Ye.acceptedBy)&&Ye.acceptedBy.includes((gn=Ut.currentUser)==null?void 0:gn.uid))&&!(Array.isArray(Ye.pendingAcceptors)&&Ye.pendingAcceptors.includes((er=Ut.currentUser)==null?void 0:er.uid))&&V.jsxs("div",{className:"quest-actions",children:[V.jsx("button",{className:"confirm-button",onClick:()=>zt(Ye),children:"Accept"}),V.jsx("button",{className:"cancel-button",onClick:()=>Zt(Ye.id),children:"Decline"})]}),Ye.uid===((Ur=Ut.currentUser)==null?void 0:Ur.uid)&&V.jsxs("div",{className:"quest-actions",children:[V.jsx("button",{className:"select-button",onClick:()=>yr(Ye),children:"View Pending Acceptors"}),V.jsx("button",{className:"cancel-button",onClick:()=>Gn(Ye.id),children:"Cancel Quest"})]}),Array.isArray(Ye.acceptedBy)&&Ye.acceptedBy.includes((hn=Ut.currentUser)==null?void 0:hn.uid)&&V.jsx("div",{className:"quest-actions",children:V.jsx("button",{className:"confirm-button",onClick:()=>rr(Ye.id),children:"Complete"})})]},Ye.id)}):V.jsx("p",{children:"No public quests."})]});case"received":return V.jsxs("div",{className:"quests-column",children:[V.jsx("h3",{children:"Received Quests"}),Z.filter(Ye=>{var Rt;return Ye.targetUser===((Rt=Ut.currentUser)==null?void 0:Rt.uid)&&!Ye.isPublic}).length>0?Z.filter(Ye=>{var Rt;return Ye.targetUser===((Rt=Ut.currentUser)==null?void 0:Rt.uid)&&!Ye.isPublic}).map(Ye=>{var er,Ur,hn,Rn;const bn=(W.find(Kt=>Kt.id===Ye.uid)||{}).name||"",Pn=Ye.targetUser===((er=Ut.currentUser)==null?void 0:er.uid),gn=Ye.uid===((Ur=Ut.currentUser)==null?void 0:Ur.uid);return V.jsxs("div",{className:"quest-item",children:[V.jsxs("p",{children:[V.jsx("strong",{children:"Title:"})," ",Ye.title]}),V.jsxs("p",{children:[V.jsx("strong",{children:"Description:"})," ",Ye.description]}),V.jsxs("p",{children:[V.jsx("strong",{children:"Time Frame:"})," ",Ye.timeFrame]}),V.jsxs("p",{children:[V.jsx("strong",{children:"Sender:"})," ",bn]}),Pn&&Ye.status==="accepted"&&V.jsxs("div",{className:"quest-actions",children:[V.jsx("button",{className:"confirm-button",onClick:()=>rr(Ye.id),children:"Complete"}),V.jsx("button",{className:"cancel-button",onClick:()=>Gn(Ye.id),children:"Cancel"})]}),Pn&&Ye.status==="pending"&&V.jsxs("div",{className:"quest-actions",children:[V.jsx("button",{className:"confirm-button",onClick:()=>zt(Ye),children:"Accept"}),V.jsx("button",{className:"cancel-button",onClick:()=>Zt(Ye.id),children:"Decline"})]}),gn&&V.jsxs("p",{children:["Status: ",Ye.status]}),Ye.acceptedBy&&V.jsxs("div",{children:[V.jsxs("p",{children:[V.jsx("strong",{children:"Accepted By:"})," ",((hn=W.find(Kt=>Kt.id===Ye.acceptedBy))==null?void 0:hn.name)||"Pending acceptance"]}),V.jsx("img",{src:((Rn=W.find(Kt=>Kt.id===Ye.acceptedBy))==null?void 0:Rn.profilePhotoUrl)||"/default-profile.png",alt:"Profile",className:"user-pfp"})]})]},Ye.id)}):V.jsx("p",{children:"No received quests."})]});case"sent":return V.jsxs("div",{className:"quests-column",children:[V.jsx("h3",{children:"Sent Quests"}),Z.filter(Ye=>{var Rt;return Ye.uid===((Rt=Ut.currentUser)==null?void 0:Rt.uid)&&!Ye.isPublic}).length>0?Z.filter(Ye=>{var Rt;return Ye.uid===((Rt=Ut.currentUser)==null?void 0:Rt.uid)&&!Ye.isPublic}).map(Ye=>{const Rt=W.find(gn=>gn.id===Ye.acceptedBy)||{},bn=Rt.name||"",Pn=W.filter(gn=>Ye.pendingAcceptors&&Ye.pendingAcceptors.includes(gn.id));return V.jsxs("div",{className:"quest-item",children:[V.jsxs("p",{children:[V.jsx("strong",{children:"Title:"})," ",Ye.title]}),V.jsxs("p",{children:[V.jsx("strong",{children:"Description:"})," ",Ye.description]}),V.jsxs("p",{children:[V.jsx("strong",{children:"Time Frame:"})," ",Ye.timeFrame]}),V.jsxs("p",{children:[V.jsx("strong",{children:"Status:"})," ",Ye.status]}),Pn.length>0&&V.jsxs("div",{children:[V.jsx("p",{children:V.jsx("strong",{children:"Pending Acceptors:"})}),V.jsx("ul",{children:Pn.map(gn=>V.jsxs("li",{onClick:()=>it(Ye,gn),children:[gn.name,V.jsx("img",{src:gn.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"user-pfp"})]},gn.id))})]}),Ye.acceptedBy&&V.jsxs("div",{children:[V.jsxs("p",{children:[V.jsx("strong",{children:"Accepted By:"})," ",bn]}),V.jsx("img",{src:Rt.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"user-pfp"})]})]},Ye.id)}):V.jsx("p",{children:"No sent quests."})]});default:return null}},In=bb(({movement:[,Ye],down:Rt})=>{if(Rt){const bn=window.innerHeight*.5-Ye;wn(Math.max(100,Math.min(bn,window.innerHeight-60)))}}),en=yb({height:Vt,config:{tension:300,friction:30}});return V.jsxs(vb.div,{className:"quests-page",style:en,children:[V.jsx("div",{className:"drag-handle",...In()}),V.jsxs("div",{className:"quests-header",children:[V.jsx("h2",{children:"Quests"}),V.jsx("button",{onClick:wt,children:"+"})]}),V.jsxs("div",{className:"tabs",children:[V.jsx("button",{className:`tab-button ${fn==="public"?"active":""}`,onClick:()=>mn("public"),children:"Public Quests"}),V.jsx("button",{className:`tab-button ${fn==="received"?"active":""}`,onClick:()=>mn("received"),children:"Received Quests"}),V.jsx("button",{className:`tab-button ${fn==="sent"?"active":""}`,onClick:()=>mn("sent"),children:"Sent Quests"})]}),Jt(),f&&V.jsx("div",{className:"modal-overlay",children:V.jsxs("div",{className:"modal quest-popup",children:[V.jsx("h3",{children:"Create a New Quest"}),V.jsx("input",{type:"text",placeholder:"Title",value:x,onChange:Ye=>a(Ye.target.value)}),V.jsx("textarea",{placeholder:"Description",value:I,onChange:Ct}),V.jsxs("select",{value:O,onChange:Ye=>F(Ye.target.value),children:[V.jsx("option",{value:"",children:"Select Time Frame"}),V.jsx("option",{value:"5 mins",children:"5 mins"}),V.jsx("option",{value:"10 mins",children:"10 mins"}),V.jsx("option",{value:"15 mins",children:"15 mins"}),V.jsx("option",{value:"30 mins",children:"30 mins"}),V.jsx("option",{value:"1 hour",children:"1 hour"})]}),V.jsxs("div",{className:"toggle-container",children:[V.jsxs("label",{className:"switch",children:[V.jsx("input",{type:"checkbox",checked:Te,onChange:St}),V.jsx("span",{className:"slider"})]}),V.jsx("span",{children:Te?"Public":"Private"})]}),!Te&&V.jsxs(V.Fragment,{children:[V.jsx("input",{type:"text",placeholder:"Search user",value:ne,onChange:Gr}),ne&&Hn.length>0&&V.jsx("div",{className:"user-search-results",children:Hn.map(Ye=>V.jsxs("div",{className:"user-search-result",onClick:()=>wr(Ye),children:[V.jsx("img",{src:Ye.profilePhoto||"/default-profile.png",alt:"Profile",className:"user-pfp"}),Ye.name]},Ye.id))}),K&&V.jsx("div",{className:"selected-user",children:V.jsxs("p",{children:["Selected User: ",K.name]})})]}),V.jsxs("div",{className:"modal-actions",children:[V.jsx("button",{className:"confirm-button",onClick:Jn,children:"Prepare Quest"}),V.jsx("button",{className:"cancel-button",onClick:wt,children:"Cancel"})]})]})}),oe&&X&&V.jsx("div",{className:"modal-overlay",children:V.jsxs("div",{className:"modal confirmation-dialog",children:[V.jsx("h3",{children:"Confirm Quest Sending"}),V.jsx("p",{children:"Are you sure you want to send the quest with the following details?"}),V.jsxs("p",{children:[V.jsx("strong",{children:"Title:"})," ",X.title]}),V.jsxs("p",{children:[V.jsx("strong",{children:"Description:"})," ",X.description]}),V.jsxs("p",{children:[V.jsx("strong",{children:"Time Frame:"})," ",X.timeFrame]}),V.jsxs("div",{className:"modal-actions",children:[V.jsx("button",{className:"confirm-button",onClick:ir,children:"Confirm"}),V.jsx("button",{className:"cancel-button",onClick:()=>de(!1),children:"Cancel"})]})]})}),be&&V.jsx("div",{className:"modal-overlay",children:V.jsxs("div",{className:"modal profile-popup",children:[V.jsx("button",{className:"close-button",onClick:pt,children:"X"}),V.jsx("h3",{children:be.name}),V.jsx("img",{src:be.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"profile-pic"}),V.jsxs("p",{children:[V.jsx("strong",{children:"Bio:"})," ",be.bio]})]})}),Pt&&V.jsx("div",{className:"modal-overlay",children:V.jsxs("div",{className:"modal acceptors-modal",children:[V.jsx("h3",{children:"Accepted By"}),V.jsx("ul",{children:jt.acceptors.map((Ye,Rt)=>V.jsx("li",{children:Ye.name},Rt))}),V.jsx("h3",{children:"Pending Acceptors"}),V.jsx("ul",{children:jt.pendingAcceptors.map((Ye,Rt)=>V.jsx("li",{onClick:()=>xn(Ee.id,Ye),className:"selectable-user",children:Ye.name},Rt))}),V.jsx("button",{className:"close-button",onClick:()=>lt(!1),children:"Close"})]})})]})},BX=({isOpen:t,quests:e,currentUserIds:r,map:o})=>V.jsx("div",{className:`quests-window ${t?"show-section":"hide-section"}`,children:V.jsx(HEe,{quests:e,currentUserIds:r,map:o})}),jX={"--background-color":"rgb(33,33,35)","--text-color":"#ffffff","--accent-color":"#0a91ff","--nav-background":"#1a1a1a","--card-background":"#2c2c2c","--hover-color":"#3a3a3a","--border-color":"#333333"},UX={"--background-color":"#f5f5f5","--text-color":"#333333","--accent-color":"#3c68c6","--nav-background":"#ffffff","--card-background":"#ffffff","--hover-color":"#e0e0e0","--border-color":"#e0e0e0"},ZEe="mapbox://styles/mapbox/dark-v10",XEe="mapbox://styles/mapbox/light-v10";function lD(t){for(let[e,r]of Object.entries(t))document.documentElement.style.setProperty(e,r)}function VX(t,e){t&&t.setStyle&&t.setStyle(e?XEe:ZEe)}function KEe(){const t=document.body.classList.toggle("light-mode");lD(t?UX:jX),localStorage.setItem("theme",t?"light":"dark");const r=window.currentMap;VX(r,t),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{isLightMode:t}}))}function $X(){const e=localStorage.getItem("theme")==="light";e?(lD(UX),document.body.classList.add("light-mode")):lD(jX);const r=window.currentMap;VX(r,e)}function YEe(){return document.body.classList.contains("light-mode")?"light":"dark"}const GX="pk.eyJ1Ijoia3lpbTUwIiwiYSI6ImNsempkdjZibDAzM2MybXE4bDJmcnZ6ZGsifQ.-ie6lQO1TWYrL8c6h2W41g";$m.accessToken=GX;const U$="mapbox://styles/kyim50/clzniqnmq009s01qgee0a13s0",V$="mapbox://styles/mapbox/light-v10",Hv=({address:t,setAddress:e,setCurrentUserIds:r,setMap:o,activeSection:c,lockedUser:f,showAddressBar:_,isFullScreen:x})=>{const a=ee.useRef(null),I=ee.useRef(null),[D,O]=ee.useState(!1),[F,Z]=ee.useState([]),J=ee.useRef({}),ne=ee.useCallback(()=>{if(!I.current){const Q=JSON.parse(localStorage.getItem("mapState")),K=YEe();I.current=new $m.Map({container:a.current,style:K==="light"?V$:U$,center:(Q==null?void 0:Q.center)||[0,0],zoom:(Q==null?void 0:Q.zoom)||2,attributionControl:!1}),I.current.on("load",()=>{O(!0),o(I.current),window.currentMap=I.current}),I.current.on("moveend",()=>{const pe=I.current.getCenter(),Te=I.current.getZoom();localStorage.setItem("mapState",JSON.stringify({center:pe,zoom:Te}))})}},[o]);ee.useEffect(()=>(ne(),$X(),()=>{if(I.current){const Q=I.current.getCenter(),K=I.current.getZoom();localStorage.setItem("mapState",JSON.stringify({center:Q,zoom:K})),I.current.remove(),I.current=null,window.currentMap=null}}),[ne]),ee.useEffect(()=>{const Q=K=>{const{isLightMode:pe}=K.detail;I.current&&D&&I.current.setStyle(pe?V$:U$)};return window.addEventListener("themeChanged",Q),()=>{window.removeEventListener("themeChanged",Q)}},[D]),ee.useEffect(()=>{let Q;return D&&I.current&&($Ee(I.current,e),Q=FX(I.current,(K,pe)=>{Z(K),r(K),J.current=pe})),()=>{Q&&Q()}},[D,e,r]),ee.useEffect(()=>{if(I.current&&D){const Q=()=>{I.current.resize()};return Q(),window.addEventListener("resize",Q),()=>window.removeEventListener("resize",Q)}},[D,c,x]),ee.useEffect(()=>{I.current&&D&&f&&(oD(I.current,f),Object.keys(J.current).forEach(Q=>{const pe=J.current[Q].getElement(),Te=pe.querySelector(".lock-indicator");if(Q===f){if(!Te){const we=document.createElement("div");we.className="lock-indicator",pe.appendChild(we)}}else Te&&pe.removeChild(Te)}))},[D,f]);const se=async Q=>{if(I.current&&Q.senderLocation){const{lng:K,lat:pe}=Q.senderLocation;I.current.flyTo({center:[K,pe],zoom:14});const Te=await W(I.current,Q.senderLocation);if(Te){const we=`route-${Q.id}`;I.current.getLayer(we)&&(I.current.removeLayer(we),I.current.removeSource(we)),I.current.addLayer({id:we,type:"line",source:{type:"geojson",data:Te},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#888","line-width":8}})}}},W=async(Q,K)=>{const pe=Q.getCenter(),Te=`https://api.mapbox.com/directions/v5/mapbox/driving/${pe.lng},${pe.lat};${K.lng},${K.lat}?geometries=geojson&access_token=${GX}`;try{const oe=await(await fetch(Te)).json();if(oe.routes&&oe.routes.length>0)return oe.routes[0].geometry}catch(we){console.error("Error fetching route:",we)}return null};return V.jsxs(V.Fragment,{children:[V.jsx("div",{ref:a,className:`map-placeholder ${x?"full-screen":""}`,style:{width:"100%",height:"100%"}}),_&&V.jsx("div",{className:"address-bar",id:"address-bar",children:t}),I.current&&V.jsx(BX,{map:I.current,currentUserIds:F,onQuestAccepted:se})]})},QEe=({activeSection:t,showSection:e,logo:r,title:o})=>{const c=[{id:"home",icon:"/home.png",label:"Feed"},{id:"profile",icon:"/user-avatar.png",label:"Profile"},{id:"connections",icon:"/happy.png",label:"Connections"},{id:"quests",icon:"/letter.png",label:"Quests"},{id:"privacy",icon:"/privacy1.png",label:"Privacy"}];return V.jsxs("div",{className:"nav-bar",children:[V.jsxs("div",{className:"nav-header",children:[V.jsx("img",{src:r,alt:"Quests Logo",className:"qlogo"}),V.jsx("span",{className:"nav-title",children:o})]}),V.jsx("nav",{children:c.map(f=>V.jsxs("button",{onClick:()=>e(f.id),className:`nav-button ${t===f.id?"active":""}`,children:[V.jsx("img",{src:f.icon,alt:f.label}),V.jsx("span",{children:f.label})]},f.id))})]})},qX=ee.createContext(),JEe=()=>ee.useContext(qX),eSe=({children:t})=>{const[e,r]=ee.useState("offline"),[o,c]=ee.useState(Date.now());ee.useEffect(()=>{const x=Ut.onAuthStateChanged(a=>{a?(r("online"),c(Date.now()),_(a.uid,"online"),f(a.uid)):(r("offline"),c(Date.now()))});return()=>{x()}},[]);const f=x=>{const a=["mousedown","keydown","scroll","touchstart"],I=()=>{c(Date.now()),e!=="online"&&(r("online"),_(x,"online"))};a.forEach(F=>{window.addEventListener(F,I)});const D=setInterval(()=>{Date.now()-o>3*60*1e3&&(r("idle"),_(x,"idle"))},60*1e3),O=()=>{document.hidden?(r("offline"),_(x,"offline")):(r("online"),c(Date.now()),_(x,"online"))};return document.addEventListener("visibilitychange",O),()=>{a.forEach(F=>{window.removeEventListener(F,I)}),clearInterval(D),document.removeEventListener("visibilitychange",O)}},_=async(x,a)=>{try{const I=ar(Cn,"users",x);await Ns(I,{status:a})}catch(I){console.error("Error updating user status in Firestore:",I)}};return ee.useEffect(()=>{if(Ut.currentUser){const x=ar(Cn,"users",Ut.currentUser.uid),a=Df(x,I=>{I.exists()&&I.data().activeQuest&&r("on quest")});return()=>a()}},[]),V.jsx(qX.Provider,{value:{userStatus:e,setUserStatus:r},children:t})},$$=()=>{};let W4={},WX={},HX=null,ZX={mark:$$,measure:$$};try{typeof window<"u"&&(W4=window),typeof document<"u"&&(WX=document),typeof MutationObserver<"u"&&(HX=MutationObserver),typeof performance<"u"&&(ZX=performance)}catch{}const{userAgent:G$=""}=W4.navigator||{},$f=W4,os=WX,q$=HX,nE=ZX;$f.document;const sd=!!os.documentElement&&!!os.head&&typeof os.addEventListener=="function"&&typeof os.createElement=="function",XX=~G$.indexOf("MSIE")||~G$.indexOf("Trident/");var ys="classic",KX="duotone",_l="sharp",yl="sharp-duotone",tSe=[ys,KX,_l,yl],nSe={classic:{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},sharp:{900:"fass",400:"fasr",300:"fasl",100:"fast"},"sharp-duotone":{900:"fasds"}},W$={kit:{fak:"kit","fa-kit":"kit"},"kit-duotone":{fakd:"kit-duotone","fa-kit-duotone":"kit-duotone"}},rSe=["kit"],iSe=/fa(s|r|l|t|d|b|k|kd|ss|sr|sl|st|sds)?[\-\ ]/,sSe=/Font ?Awesome ?([56 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Sharp Duotone|Sharp|Kit)?.*/i,oSe={"Font Awesome 5 Free":{900:"fas",400:"far"},"Font Awesome 5 Pro":{900:"fas",400:"far",normal:"far",300:"fal"},"Font Awesome 5 Brands":{400:"fab",normal:"fab"},"Font Awesome 5 Duotone":{900:"fad"}},aSe={"Font Awesome 6 Free":{900:"fas",400:"far"},"Font Awesome 6 Pro":{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},"Font Awesome 6 Brands":{400:"fab",normal:"fab"},"Font Awesome 6 Duotone":{900:"fad"},"Font Awesome 6 Sharp":{900:"fass",400:"fasr",normal:"fasr",300:"fasl",100:"fast"},"Font Awesome 6 Sharp Duotone":{900:"fasds"}},lSe={classic:{"fa-brands":"fab","fa-duotone":"fad","fa-light":"fal","fa-regular":"far","fa-solid":"fas","fa-thin":"fat"},sharp:{"fa-solid":"fass","fa-regular":"fasr","fa-light":"fasl","fa-thin":"fast"},"sharp-duotone":{"fa-solid":"fasds"}},cSe={classic:["fas","far","fal","fat"],sharp:["fass","fasr","fasl","fast"],"sharp-duotone":["fasds"]},uSe={classic:{fab:"fa-brands",fad:"fa-duotone",fal:"fa-light",far:"fa-regular",fas:"fa-solid",fat:"fa-thin"},sharp:{fass:"fa-solid",fasr:"fa-regular",fasl:"fa-light",fast:"fa-thin"},"sharp-duotone":{fasds:"fa-solid"}},hSe={classic:{solid:"fas",regular:"far",light:"fal",thin:"fat",duotone:"fad",brands:"fab"},sharp:{solid:"fass",regular:"fasr",light:"fasl",thin:"fast"},"sharp-duotone":{solid:"fasds"}},YX={classic:{fa:"solid",fas:"solid","fa-solid":"solid",far:"regular","fa-regular":"regular",fal:"light","fa-light":"light",fat:"thin","fa-thin":"thin",fad:"duotone","fa-duotone":"duotone",fab:"brands","fa-brands":"brands"},sharp:{fa:"solid",fass:"solid","fa-solid":"solid",fasr:"regular","fa-regular":"regular",fasl:"light","fa-light":"light",fast:"thin","fa-thin":"thin"},"sharp-duotone":{fa:"solid",fasds:"solid","fa-solid":"solid"}},dSe=["solid","regular","light","thin","duotone","brands"],QX=[1,2,3,4,5,6,7,8,9,10],fSe=QX.concat([11,12,13,14,15,16,17,18,19,20]),dx={GROUP:"duotone-group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},pSe=[...Object.keys(cSe),...dSe,"2xs","xs","sm","lg","xl","2xl","beat","border","fade","beat-fade","bounce","flip-both","flip-horizontal","flip-vertical","flip","fw","inverse","layers-counter","layers-text","layers","li","pull-left","pull-right","pulse","rotate-180","rotate-270","rotate-90","rotate-by","shake","spin-pulse","spin-reverse","spin","stack-1x","stack-2x","stack","ul",dx.GROUP,dx.SWAP_OPACITY,dx.PRIMARY,dx.SECONDARY].concat(QX.map(t=>"".concat(t,"x"))).concat(fSe.map(t=>"w-".concat(t))),mSe={"Font Awesome Kit":{400:"fak",normal:"fak"},"Font Awesome Kit Duotone":{400:"fakd",normal:"fakd"}},gSe={kit:{"fa-kit":"fak"},"kit-duotone":{"fa-kit-duotone":"fakd"}},_Se={kit:{fak:"fa-kit"},"kit-duotone":{fakd:"fa-kit-duotone"}},H$={kit:{kit:"fak"},"kit-duotone":{"kit-duotone":"fakd"}};const Jh="___FONT_AWESOME___",cD=16,JX="fa",eK="svg-inline--fa",Gm="data-fa-i2svg",uD="data-fa-pseudo-element",ySe="data-fa-pseudo-element-pending",H4="data-prefix",Z4="data-icon",Z$="fontawesome-i2svg",vSe="async",xSe=["HTML","HEAD","STYLE","SCRIPT"],tK=(()=>{try{return!0}catch{return!1}})(),nK=[ys,_l,yl];function Sb(t){return new Proxy(t,{get(e,r){return r in e?e[r]:e[ys]}})}const rK={...YX};rK[ys]={...YX[ys],...W$.kit,...W$["kit-duotone"]};const Em=Sb(rK),hD={...hSe};hD[ys]={...hD[ys],...H$.kit,...H$["kit-duotone"]};const F1=Sb(hD),dD={...uSe};dD[ys]={...dD[ys],..._Se.kit};const Sm=Sb(dD),fD={...lSe};fD[ys]={...fD[ys],...gSe.kit};const bSe=Sb(fD),wSe=iSe,iK="fa-layers-text",TSe=sSe,ESe={...nSe};Sb(ESe);const SSe=["class","data-prefix","data-icon","data-fa-transform","data-fa-mask"],FM=dx,By=new Set;Object.keys(F1[ys]).map(By.add.bind(By));Object.keys(F1[_l]).map(By.add.bind(By));Object.keys(F1[yl]).map(By.add.bind(By));const ISe=[...rSe,...pSe],Gx=$f.FontAwesomeConfig||{};function ASe(t){var e=os.querySelector("script["+t+"]");if(e)return e.getAttribute(t)}function CSe(t){return t===""?!0:t==="false"?!1:t==="true"?!0:t}os&&typeof os.querySelector=="function"&&[["data-family-prefix","familyPrefix"],["data-css-prefix","cssPrefix"],["data-family-default","familyDefault"],["data-style-default","styleDefault"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(e=>{let[r,o]=e;const c=CSe(ASe(r));c!=null&&(Gx[o]=c)});const sK={styleDefault:"solid",familyDefault:"classic",cssPrefix:JX,replacementClass:eK,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0};Gx.familyPrefix&&(Gx.cssPrefix=Gx.familyPrefix);const jy={...sK,...Gx};jy.autoReplaceSvg||(jy.observeMutations=!1);const Wn={};Object.keys(sK).forEach(t=>{Object.defineProperty(Wn,t,{enumerable:!0,set:function(e){jy[t]=e,qx.forEach(r=>r(Wn))},get:function(){return jy[t]}})});Object.defineProperty(Wn,"familyPrefix",{enumerable:!0,set:function(t){jy.cssPrefix=t,qx.forEach(e=>e(Wn))},get:function(){return jy.cssPrefix}});$f.FontAwesomeConfig=Wn;const qx=[];function PSe(t){return qx.push(t),()=>{qx.splice(qx.indexOf(t),1)}}const Jd=cD,Du={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function RSe(t){if(!t||!sd)return;const e=os.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=t;const r=os.head.childNodes;let o=null;for(let c=r.length-1;c>-1;c--){const f=r[c],_=(f.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(_)>-1&&(o=f)}return os.head.insertBefore(e,o),t}const MSe="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function B1(){let t=12,e="";for(;t-- >0;)e+=MSe[Math.random()*62|0];return e}function r0(t){const e=[];for(let r=(t||[]).length>>>0;r--;)e[r]=t[r];return e}function X4(t){return t.classList?r0(t.classList):(t.getAttribute("class")||"").split(" ").filter(e=>e)}function oK(t){return"".concat(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function kSe(t){return Object.keys(t||{}).reduce((e,r)=>e+"".concat(r,'="').concat(oK(t[r]),'" '),"").trim()}function iC(t){return Object.keys(t||{}).reduce((e,r)=>e+"".concat(r,": ").concat(t[r].trim(),";"),"")}function K4(t){return t.size!==Du.size||t.x!==Du.x||t.y!==Du.y||t.rotate!==Du.rotate||t.flipX||t.flipY}function DSe(t){let{transform:e,containerWidth:r,iconWidth:o}=t;const c={transform:"translate(".concat(r/2," 256)")},f="translate(".concat(e.x*32,", ").concat(e.y*32,") "),_="scale(".concat(e.size/16*(e.flipX?-1:1),", ").concat(e.size/16*(e.flipY?-1:1),") "),x="rotate(".concat(e.rotate," 0 0)"),a={transform:"".concat(f," ").concat(_," ").concat(x)},I={transform:"translate(".concat(o/2*-1," -256)")};return{outer:c,inner:a,path:I}}function OSe(t){let{transform:e,width:r=cD,height:o=cD,startCentered:c=!1}=t,f="";return c&&XX?f+="translate(".concat(e.x/Jd-r/2,"em, ").concat(e.y/Jd-o/2,"em) "):c?f+="translate(calc(-50% + ".concat(e.x/Jd,"em), calc(-50% + ").concat(e.y/Jd,"em)) "):f+="translate(".concat(e.x/Jd,"em, ").concat(e.y/Jd,"em) "),f+="scale(".concat(e.size/Jd*(e.flipX?-1:1),", ").concat(e.size/Jd*(e.flipY?-1:1),") "),f+="rotate(".concat(e.rotate,"deg) "),f}var LSe=`:root, :host {
  --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Free";
  --fa-font-regular: normal 400 1em/1 "Font Awesome 6 Free";
  --fa-font-light: normal 300 1em/1 "Font Awesome 6 Pro";
  --fa-font-thin: normal 100 1em/1 "Font Awesome 6 Pro";
  --fa-font-duotone: normal 900 1em/1 "Font Awesome 6 Duotone";
  --fa-font-brands: normal 400 1em/1 "Font Awesome 6 Brands";
  --fa-font-sharp-solid: normal 900 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-regular: normal 400 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-light: normal 300 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-thin: normal 100 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-duotone-solid: normal 900 1em/1 "Font Awesome 6 Sharp Duotone";
}

svg:not(:root).svg-inline--fa, svg:not(:host).svg-inline--fa {
  overflow: visible;
  box-sizing: content-box;
}

.svg-inline--fa {
  display: var(--fa-display, inline-block);
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-2xs {
  vertical-align: 0.1em;
}
.svg-inline--fa.fa-xs {
  vertical-align: 0em;
}
.svg-inline--fa.fa-sm {
  vertical-align: -0.0714285705em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.2em;
}
.svg-inline--fa.fa-xl {
  vertical-align: -0.25em;
}
.svg-inline--fa.fa-2xl {
  vertical-align: -0.3125em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-li {
  width: var(--fa-li-width, 2em);
  top: 0.25em;
}
.svg-inline--fa.fa-fw {
  width: var(--fa-fw-width, 1.25em);
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  transform-origin: center center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  transform-origin: center center;
}

.fa-layers-counter {
  background-color: var(--fa-counter-background-color, #ff253a);
  border-radius: var(--fa-counter-border-radius, 1em);
  box-sizing: border-box;
  color: var(--fa-inverse, #fff);
  line-height: var(--fa-counter-line-height, 1);
  max-width: var(--fa-counter-max-width, 5em);
  min-width: var(--fa-counter-min-width, 1.5em);
  overflow: hidden;
  padding: var(--fa-counter-padding, 0.25em 0.5em);
  right: var(--fa-right, 0);
  text-overflow: ellipsis;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-counter-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: var(--fa-bottom, 0);
  right: var(--fa-right, 0);
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: var(--fa-bottom, 0);
  left: var(--fa-left, 0);
  right: auto;
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom left;
}

.fa-layers-top-right {
  top: var(--fa-top, 0);
  right: var(--fa-right, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-top-left {
  left: var(--fa-left, 0);
  right: auto;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top left;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-2xs {
  font-size: 0.625em;
  line-height: 0.1em;
  vertical-align: 0.225em;
}

.fa-xs {
  font-size: 0.75em;
  line-height: 0.0833333337em;
  vertical-align: 0.125em;
}

.fa-sm {
  font-size: 0.875em;
  line-height: 0.0714285718em;
  vertical-align: 0.0535714295em;
}

.fa-lg {
  font-size: 1.25em;
  line-height: 0.05em;
  vertical-align: -0.075em;
}

.fa-xl {
  font-size: 1.5em;
  line-height: 0.0416666682em;
  vertical-align: -0.125em;
}

.fa-2xl {
  font-size: 2em;
  line-height: 0.03125em;
  vertical-align: -0.1875em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: var(--fa-li-margin, 2.5em);
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: calc(-1 * var(--fa-li-width, 2em));
  position: absolute;
  text-align: center;
  width: var(--fa-li-width, 2em);
  line-height: inherit;
}

.fa-border {
  border-color: var(--fa-border-color, #eee);
  border-radius: var(--fa-border-radius, 0.1em);
  border-style: var(--fa-border-style, solid);
  border-width: var(--fa-border-width, 0.08em);
  padding: var(--fa-border-padding, 0.2em 0.25em 0.15em);
}

.fa-pull-left {
  float: left;
  margin-right: var(--fa-pull-margin, 0.3em);
}

.fa-pull-right {
  float: right;
  margin-left: var(--fa-pull-margin, 0.3em);
}

.fa-beat {
  animation-name: fa-beat;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-bounce {
  animation-name: fa-bounce;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
}

.fa-fade {
  animation-name: fa-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-beat-fade {
  animation-name: fa-beat-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-flip {
  animation-name: fa-flip;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-shake {
  animation-name: fa-shake;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin {
  animation-name: fa-spin;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 2s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin-reverse {
  --fa-animation-direction: reverse;
}

.fa-pulse,
.fa-spin-pulse {
  animation-name: fa-spin;
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, steps(8));
}

@media (prefers-reduced-motion: reduce) {
  .fa-beat,
.fa-bounce,
.fa-fade,
.fa-beat-fade,
.fa-flip,
.fa-pulse,
.fa-shake,
.fa-spin,
.fa-spin-pulse {
    animation-delay: -1ms;
    animation-duration: 1ms;
    animation-iteration-count: 1;
    transition-delay: 0s;
    transition-duration: 0s;
  }
}
@keyframes fa-beat {
  0%, 90% {
    transform: scale(1);
  }
  45% {
    transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@keyframes fa-bounce {
  0% {
    transform: scale(1, 1) translateY(0);
  }
  10% {
    transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    transform: scale(1, 1) translateY(0);
  }
  100% {
    transform: scale(1, 1) translateY(0);
  }
}
@keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    transform: scale(1);
  }
  50% {
    opacity: 1;
    transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@keyframes fa-flip {
  50% {
    transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@keyframes fa-shake {
  0% {
    transform: rotate(-15deg);
  }
  4% {
    transform: rotate(15deg);
  }
  8%, 24% {
    transform: rotate(-18deg);
  }
  12%, 28% {
    transform: rotate(18deg);
  }
  16% {
    transform: rotate(-22deg);
  }
  20% {
    transform: rotate(22deg);
  }
  32% {
    transform: rotate(-12deg);
  }
  36% {
    transform: rotate(12deg);
  }
  40%, 100% {
    transform: rotate(0deg);
  }
}
@keyframes fa-spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  transform: rotate(90deg);
}

.fa-rotate-180 {
  transform: rotate(180deg);
}

.fa-rotate-270 {
  transform: rotate(270deg);
}

.fa-flip-horizontal {
  transform: scale(-1, 1);
}

.fa-flip-vertical {
  transform: scale(1, -1);
}

.fa-flip-both,
.fa-flip-horizontal.fa-flip-vertical {
  transform: scale(-1, -1);
}

.fa-rotate-by {
  transform: rotate(var(--fa-rotate-angle, 0));
}

.fa-stack {
  display: inline-block;
  vertical-align: middle;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
  z-index: var(--fa-stack-z-index, auto);
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: var(--fa-inverse, #fff);
}

.sr-only,
.fa-sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.sr-only-focusable:not(:focus),
.fa-sr-only-focusable:not(:focus) {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse,
.fa-duotone.fa-inverse {
  color: var(--fa-inverse, #fff);
}`;function aK(){const t=JX,e=eK,r=Wn.cssPrefix,o=Wn.replacementClass;let c=LSe;if(r!==t||o!==e){const f=new RegExp("\\.".concat(t,"\\-"),"g"),_=new RegExp("\\--".concat(t,"\\-"),"g"),x=new RegExp("\\.".concat(e),"g");c=c.replace(f,".".concat(r,"-")).replace(_,"--".concat(r,"-")).replace(x,".".concat(o))}return c}let X$=!1;function BM(){Wn.autoAddCss&&!X$&&(RSe(aK()),X$=!0)}var zSe={mixout(){return{dom:{css:aK,insertCss:BM}}},hooks(){return{beforeDOMElementCreation(){BM()},beforeI2svg(){BM()}}}};const ed=$f||{};ed[Jh]||(ed[Jh]={});ed[Jh].styles||(ed[Jh].styles={});ed[Jh].hooks||(ed[Jh].hooks={});ed[Jh].shims||(ed[Jh].shims=[]);var Ou=ed[Jh];const lK=[],cK=function(){os.removeEventListener("DOMContentLoaded",cK),iI=1,lK.map(t=>t())};let iI=!1;sd&&(iI=(os.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(os.readyState),iI||os.addEventListener("DOMContentLoaded",cK));function NSe(t){sd&&(iI?setTimeout(t,0):lK.push(t))}function Ib(t){const{tag:e,attributes:r={},children:o=[]}=t;return typeof t=="string"?oK(t):"<".concat(e," ").concat(kSe(r),">").concat(o.map(Ib).join(""),"</").concat(e,">")}function K$(t,e,r){if(t&&t[e]&&t[e][r])return{prefix:e,iconName:r,icon:t[e][r]}}var jM=function(e,r,o,c){var f=Object.keys(e),_=f.length,x=r,a,I,D;for(o===void 0?(a=1,D=e[f[0]]):(a=0,D=o);a<_;a++)I=f[a],D=x(D,e[I],I,e);return D};function FSe(t){const e=[];let r=0;const o=t.length;for(;r<o;){const c=t.charCodeAt(r++);if(c>=55296&&c<=56319&&r<o){const f=t.charCodeAt(r++);(f&64512)==56320?e.push(((c&1023)<<10)+(f&1023)+65536):(e.push(c),r--)}else e.push(c)}return e}function pD(t){const e=FSe(t);return e.length===1?e[0].toString(16):null}function BSe(t,e){const r=t.length;let o=t.charCodeAt(e),c;return o>=55296&&o<=56319&&r>e+1&&(c=t.charCodeAt(e+1),c>=56320&&c<=57343)?(o-55296)*1024+c-56320+65536:o}function Y$(t){return Object.keys(t).reduce((e,r)=>{const o=t[r];return!!o.icon?e[o.iconName]=o.icon:e[r]=o,e},{})}function mD(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{skipHooks:o=!1}=r,c=Y$(e);typeof Ou.hooks.addPack=="function"&&!o?Ou.hooks.addPack(t,Y$(e)):Ou.styles[t]={...Ou.styles[t]||{},...c},t==="fas"&&mD("fa",e)}const{styles:am,shims:jSe}=Ou,USe={[ys]:Object.values(Sm[ys]),[_l]:Object.values(Sm[_l]),[yl]:Object.values(Sm[yl])};let Y4=null,uK={},hK={},dK={},fK={},pK={};const VSe={[ys]:Object.keys(Em[ys]),[_l]:Object.keys(Em[_l]),[yl]:Object.keys(Em[yl])};function $Se(t){return~ISe.indexOf(t)}function GSe(t,e){const r=e.split("-"),o=r[0],c=r.slice(1).join("-");return o===t&&c!==""&&!$Se(c)?c:null}const mK=()=>{const t=o=>jM(am,(c,f,_)=>(c[_]=jM(f,o,{}),c),{});uK=t((o,c,f)=>(c[3]&&(o[c[3]]=f),c[2]&&c[2].filter(x=>typeof x=="number").forEach(x=>{o[x.toString(16)]=f}),o)),hK=t((o,c,f)=>(o[f]=f,c[2]&&c[2].filter(x=>typeof x=="string").forEach(x=>{o[x]=f}),o)),pK=t((o,c,f)=>{const _=c[2];return o[f]=f,_.forEach(x=>{o[x]=f}),o});const e="far"in am||Wn.autoFetchSvg,r=jM(jSe,(o,c)=>{const f=c[0];let _=c[1];const x=c[2];return _==="far"&&!e&&(_="fas"),typeof f=="string"&&(o.names[f]={prefix:_,iconName:x}),typeof f=="number"&&(o.unicodes[f.toString(16)]={prefix:_,iconName:x}),o},{names:{},unicodes:{}});dK=r.names,fK=r.unicodes,Y4=sC(Wn.styleDefault,{family:Wn.familyDefault})};PSe(t=>{Y4=sC(t.styleDefault,{family:Wn.familyDefault})});mK();function Q4(t,e){return(uK[t]||{})[e]}function qSe(t,e){return(hK[t]||{})[e]}function vf(t,e){return(pK[t]||{})[e]}function gK(t){return dK[t]||{prefix:null,iconName:null}}function WSe(t){const e=fK[t],r=Q4("fas",t);return e||(r?{prefix:"fas",iconName:r}:null)||{prefix:null,iconName:null}}function Gf(){return Y4}const J4=()=>({prefix:null,iconName:null,rest:[]});function sC(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{family:r=ys}=e,o=Em[r][t],c=F1[r][t]||F1[r][o],f=t in Ou.styles?t:null;return c||f||null}const HSe={[ys]:Object.keys(Sm[ys]),[_l]:Object.keys(Sm[_l]),[yl]:Object.keys(Sm[yl])};function oC(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{skipLookups:r=!1}=e,o={[ys]:"".concat(Wn.cssPrefix,"-").concat(ys),[_l]:"".concat(Wn.cssPrefix,"-").concat(_l),[yl]:"".concat(Wn.cssPrefix,"-").concat(yl)};let c=null,f=ys;const _=tSe.filter(a=>a!==KX);_.forEach(a=>{(t.includes(o[a])||t.some(I=>HSe[a].includes(I)))&&(f=a)});const x=t.reduce((a,I)=>{const D=GSe(Wn.cssPrefix,I);if(am[I]?(I=USe[f].includes(I)?bSe[f][I]:I,c=I,a.prefix=I):VSe[f].indexOf(I)>-1?(c=I,a.prefix=sC(I,{family:f})):D?a.iconName=D:I!==Wn.replacementClass&&!_.some(O=>I===o[O])&&a.rest.push(I),!r&&a.prefix&&a.iconName){const O=c==="fa"?gK(a.iconName):{},F=vf(a.prefix,a.iconName);O.prefix&&(c=null),a.iconName=O.iconName||F||a.iconName,a.prefix=O.prefix||a.prefix,a.prefix==="far"&&!am.far&&am.fas&&!Wn.autoFetchSvg&&(a.prefix="fas")}return a},J4());return(t.includes("fa-brands")||t.includes("fab"))&&(x.prefix="fab"),(t.includes("fa-duotone")||t.includes("fad"))&&(x.prefix="fad"),!x.prefix&&f===_l&&(am.fass||Wn.autoFetchSvg)&&(x.prefix="fass",x.iconName=vf(x.prefix,x.iconName)||x.iconName),!x.prefix&&f===yl&&(am.fasds||Wn.autoFetchSvg)&&(x.prefix="fasds",x.iconName=vf(x.prefix,x.iconName)||x.iconName),(x.prefix==="fa"||c==="fa")&&(x.prefix=Gf()||"fas"),x}class ZSe{constructor(){this.definitions={}}add(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];const c=r.reduce(this._pullDefinitions,{});Object.keys(c).forEach(f=>{this.definitions[f]={...this.definitions[f]||{},...c[f]},mD(f,c[f]);const _=Sm[ys][f];_&&mD(_,c[f]),mK()})}reset(){this.definitions={}}_pullDefinitions(e,r){const o=r.prefix&&r.iconName&&r.icon?{0:r}:r;return Object.keys(o).map(c=>{const{prefix:f,iconName:_,icon:x}=o[c],a=x[2];e[f]||(e[f]={}),a.length>0&&a.forEach(I=>{typeof I=="string"&&(e[f][I]=x)}),e[f][_]=x}),e}}let Q$=[],X_={};const dy={},XSe=Object.keys(dy);function KSe(t,e){let{mixoutsTo:r}=e;return Q$=t,X_={},Object.keys(dy).forEach(o=>{XSe.indexOf(o)===-1&&delete dy[o]}),Q$.forEach(o=>{const c=o.mixout?o.mixout():{};if(Object.keys(c).forEach(f=>{typeof c[f]=="function"&&(r[f]=c[f]),typeof c[f]=="object"&&Object.keys(c[f]).forEach(_=>{r[f]||(r[f]={}),r[f][_]=c[f][_]})}),o.hooks){const f=o.hooks();Object.keys(f).forEach(_=>{X_[_]||(X_[_]=[]),X_[_].push(f[_])})}o.provides&&o.provides(dy)}),r}function gD(t,e){for(var r=arguments.length,o=new Array(r>2?r-2:0),c=2;c<r;c++)o[c-2]=arguments[c];return(X_[t]||[]).forEach(_=>{e=_.apply(null,[e,...o])}),e}function qm(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];(X_[t]||[]).forEach(f=>{f.apply(null,r)})}function qf(){const t=arguments[0],e=Array.prototype.slice.call(arguments,1);return dy[t]?dy[t].apply(null,e):void 0}function _D(t){t.prefix==="fa"&&(t.prefix="fas");let{iconName:e}=t;const r=t.prefix||Gf();if(e)return e=vf(r,e)||e,K$(_K.definitions,r,e)||K$(Ou.styles,r,e)}const _K=new ZSe,YSe=()=>{Wn.autoReplaceSvg=!1,Wn.observeMutations=!1,qm("noAuto")},QSe={i2svg:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return sd?(qm("beforeI2svg",t),qf("pseudoElements2svg",t),qf("i2svg",t)):Promise.reject(new Error("Operation requires a DOM of some kind."))},watch:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{autoReplaceSvgRoot:e}=t;Wn.autoReplaceSvg===!1&&(Wn.autoReplaceSvg=!0),Wn.observeMutations=!0,NSe(()=>{eIe({autoReplaceSvgRoot:e}),qm("watch",t)})}},JSe={icon:t=>{if(t===null)return null;if(typeof t=="object"&&t.prefix&&t.iconName)return{prefix:t.prefix,iconName:vf(t.prefix,t.iconName)||t.iconName};if(Array.isArray(t)&&t.length===2){const e=t[1].indexOf("fa-")===0?t[1].slice(3):t[1],r=sC(t[0]);return{prefix:r,iconName:vf(r,e)||e}}if(typeof t=="string"&&(t.indexOf("".concat(Wn.cssPrefix,"-"))>-1||t.match(wSe))){const e=oC(t.split(" "),{skipLookups:!0});return{prefix:e.prefix||Gf(),iconName:vf(e.prefix,e.iconName)||e.iconName}}if(typeof t=="string"){const e=Gf();return{prefix:e,iconName:vf(e,t)||t}}}},Tl={noAuto:YSe,config:Wn,dom:QSe,parse:JSe,library:_K,findIconDefinition:_D,toHtml:Ib},eIe=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{autoReplaceSvgRoot:e=os}=t;(Object.keys(Ou.styles).length>0||Wn.autoFetchSvg)&&sd&&Wn.autoReplaceSvg&&Tl.dom.i2svg({node:e})};function aC(t,e){return Object.defineProperty(t,"abstract",{get:e}),Object.defineProperty(t,"html",{get:function(){return t.abstract.map(r=>Ib(r))}}),Object.defineProperty(t,"node",{get:function(){if(!sd)return;const r=os.createElement("div");return r.innerHTML=t.html,r.children}}),t}function tIe(t){let{children:e,main:r,mask:o,attributes:c,styles:f,transform:_}=t;if(K4(_)&&r.found&&!o.found){const{width:x,height:a}=r,I={x:x/a/2,y:.5};c.style=iC({...f,"transform-origin":"".concat(I.x+_.x/16,"em ").concat(I.y+_.y/16,"em")})}return[{tag:"svg",attributes:c,children:e}]}function nIe(t){let{prefix:e,iconName:r,children:o,attributes:c,symbol:f}=t;const _=f===!0?"".concat(e,"-").concat(Wn.cssPrefix,"-").concat(r):f;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:{...c,id:_},children:o}]}]}function ez(t){const{icons:{main:e,mask:r},prefix:o,iconName:c,transform:f,symbol:_,title:x,maskId:a,titleId:I,extra:D,watchable:O=!1}=t,{width:F,height:Z}=r.found?r:e,J=o==="fak",ne=[Wn.replacementClass,c?"".concat(Wn.cssPrefix,"-").concat(c):""].filter(Te=>D.classes.indexOf(Te)===-1).filter(Te=>Te!==""||!!Te).concat(D.classes).join(" ");let se={children:[],attributes:{...D.attributes,"data-prefix":o,"data-icon":c,class:ne,role:D.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(F," ").concat(Z)}};const W=J&&!~D.classes.indexOf("fa-fw")?{width:"".concat(F/Z*16*.0625,"em")}:{};O&&(se.attributes[Gm]=""),x&&(se.children.push({tag:"title",attributes:{id:se.attributes["aria-labelledby"]||"title-".concat(I||B1())},children:[x]}),delete se.attributes.title);const Q={...se,prefix:o,iconName:c,main:e,mask:r,maskId:a,transform:f,symbol:_,styles:{...W,...D.styles}},{children:K,attributes:pe}=r.found&&e.found?qf("generateAbstractMask",Q)||{children:[],attributes:{}}:qf("generateAbstractIcon",Q)||{children:[],attributes:{}};return Q.children=K,Q.attributes=pe,_?nIe(Q):tIe(Q)}function J$(t){const{content:e,width:r,height:o,transform:c,title:f,extra:_,watchable:x=!1}=t,a={..._.attributes,...f?{title:f}:{},class:_.classes.join(" ")};x&&(a[Gm]="");const I={..._.styles};K4(c)&&(I.transform=OSe({transform:c,startCentered:!0,width:r,height:o}),I["-webkit-transform"]=I.transform);const D=iC(I);D.length>0&&(a.style=D);const O=[];return O.push({tag:"span",attributes:a,children:[e]}),f&&O.push({tag:"span",attributes:{class:"sr-only"},children:[f]}),O}function rIe(t){const{content:e,title:r,extra:o}=t,c={...o.attributes,...r?{title:r}:{},class:o.classes.join(" ")},f=iC(o.styles);f.length>0&&(c.style=f);const _=[];return _.push({tag:"span",attributes:c,children:[e]}),r&&_.push({tag:"span",attributes:{class:"sr-only"},children:[r]}),_}const{styles:UM}=Ou;function yD(t){const e=t[0],r=t[1],[o]=t.slice(4);let c=null;return Array.isArray(o)?c={tag:"g",attributes:{class:"".concat(Wn.cssPrefix,"-").concat(FM.GROUP)},children:[{tag:"path",attributes:{class:"".concat(Wn.cssPrefix,"-").concat(FM.SECONDARY),fill:"currentColor",d:o[0]}},{tag:"path",attributes:{class:"".concat(Wn.cssPrefix,"-").concat(FM.PRIMARY),fill:"currentColor",d:o[1]}}]}:c={tag:"path",attributes:{fill:"currentColor",d:o}},{found:!0,width:e,height:r,icon:c}}const iIe={found:!1,width:512,height:512};function sIe(t,e){!tK&&!Wn.showMissingIcons&&t&&console.error('Icon with name "'.concat(t,'" and prefix "').concat(e,'" is missing.'))}function vD(t,e){let r=e;return e==="fa"&&Wn.styleDefault!==null&&(e=Gf()),new Promise((o,c)=>{if(r==="fa"){const f=gK(t)||{};t=f.iconName||t,e=f.prefix||e}if(t&&e&&UM[e]&&UM[e][t]){const f=UM[e][t];return o(yD(f))}sIe(t,e),o({...iIe,icon:Wn.showMissingIcons&&t?qf("missingIconAbstract")||{}:{}})})}const e8=()=>{},xD=Wn.measurePerformance&&nE&&nE.mark&&nE.measure?nE:{mark:e8,measure:e8},fx='FA "6.6.0"',oIe=t=>(xD.mark("".concat(fx," ").concat(t," begins")),()=>yK(t)),yK=t=>{xD.mark("".concat(fx," ").concat(t," ends")),xD.measure("".concat(fx," ").concat(t),"".concat(fx," ").concat(t," begins"),"".concat(fx," ").concat(t," ends"))};var tz={begin:oIe,end:yK};const NE=()=>{};function t8(t){return typeof(t.getAttribute?t.getAttribute(Gm):null)=="string"}function aIe(t){const e=t.getAttribute?t.getAttribute(H4):null,r=t.getAttribute?t.getAttribute(Z4):null;return e&&r}function lIe(t){return t&&t.classList&&t.classList.contains&&t.classList.contains(Wn.replacementClass)}function cIe(){return Wn.autoReplaceSvg===!0?FE.replace:FE[Wn.autoReplaceSvg]||FE.replace}function uIe(t){return os.createElementNS("http://www.w3.org/2000/svg",t)}function hIe(t){return os.createElement(t)}function vK(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{ceFn:r=t.tag==="svg"?uIe:hIe}=e;if(typeof t=="string")return os.createTextNode(t);const o=r(t.tag);return Object.keys(t.attributes||[]).forEach(function(f){o.setAttribute(f,t.attributes[f])}),(t.children||[]).forEach(function(f){o.appendChild(vK(f,{ceFn:r}))}),o}function dIe(t){let e=" ".concat(t.outerHTML," ");return e="".concat(e,"Font Awesome fontawesome.com "),e}const FE={replace:function(t){const e=t[0];if(e.parentNode)if(t[1].forEach(r=>{e.parentNode.insertBefore(vK(r),e)}),e.getAttribute(Gm)===null&&Wn.keepOriginalSource){let r=os.createComment(dIe(e));e.parentNode.replaceChild(r,e)}else e.remove()},nest:function(t){const e=t[0],r=t[1];if(~X4(e).indexOf(Wn.replacementClass))return FE.replace(t);const o=new RegExp("".concat(Wn.cssPrefix,"-.*"));if(delete r[0].attributes.id,r[0].attributes.class){const f=r[0].attributes.class.split(" ").reduce((_,x)=>(x===Wn.replacementClass||x.match(o)?_.toSvg.push(x):_.toNode.push(x),_),{toNode:[],toSvg:[]});r[0].attributes.class=f.toSvg.join(" "),f.toNode.length===0?e.removeAttribute("class"):e.setAttribute("class",f.toNode.join(" "))}const c=r.map(f=>Ib(f)).join(`
`);e.setAttribute(Gm,""),e.innerHTML=c}};function n8(t){t()}function xK(t,e){const r=typeof e=="function"?e:NE;if(t.length===0)r();else{let o=n8;Wn.mutateApproach===vSe&&(o=$f.requestAnimationFrame||n8),o(()=>{const c=cIe(),f=tz.begin("mutate");t.map(c),f(),r()})}}let nz=!1;function bK(){nz=!0}function bD(){nz=!1}let sI=null;function r8(t){if(!q$||!Wn.observeMutations)return;const{treeCallback:e=NE,nodeCallback:r=NE,pseudoElementsCallback:o=NE,observeMutationsRoot:c=os}=t;sI=new q$(f=>{if(nz)return;const _=Gf();r0(f).forEach(x=>{if(x.type==="childList"&&x.addedNodes.length>0&&!t8(x.addedNodes[0])&&(Wn.searchPseudoElements&&o(x.target),e(x.target)),x.type==="attributes"&&x.target.parentNode&&Wn.searchPseudoElements&&o(x.target.parentNode),x.type==="attributes"&&t8(x.target)&&~SSe.indexOf(x.attributeName))if(x.attributeName==="class"&&aIe(x.target)){const{prefix:a,iconName:I}=oC(X4(x.target));x.target.setAttribute(H4,a||_),I&&x.target.setAttribute(Z4,I)}else lIe(x.target)&&r(x.target)})}),sd&&sI.observe(c,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}function fIe(){sI&&sI.disconnect()}function pIe(t){const e=t.getAttribute("style");let r=[];return e&&(r=e.split(";").reduce((o,c)=>{const f=c.split(":"),_=f[0],x=f.slice(1);return _&&x.length>0&&(o[_]=x.join(":").trim()),o},{})),r}function mIe(t){const e=t.getAttribute("data-prefix"),r=t.getAttribute("data-icon"),o=t.innerText!==void 0?t.innerText.trim():"";let c=oC(X4(t));return c.prefix||(c.prefix=Gf()),e&&r&&(c.prefix=e,c.iconName=r),c.iconName&&c.prefix||(c.prefix&&o.length>0&&(c.iconName=qSe(c.prefix,t.innerText)||Q4(c.prefix,pD(t.innerText))),!c.iconName&&Wn.autoFetchSvg&&t.firstChild&&t.firstChild.nodeType===Node.TEXT_NODE&&(c.iconName=t.firstChild.data)),c}function gIe(t){const e=r0(t.attributes).reduce((c,f)=>(c.name!=="class"&&c.name!=="style"&&(c[f.name]=f.value),c),{}),r=t.getAttribute("title"),o=t.getAttribute("data-fa-title-id");return Wn.autoA11y&&(r?e["aria-labelledby"]="".concat(Wn.replacementClass,"-title-").concat(o||B1()):(e["aria-hidden"]="true",e.focusable="false")),e}function _Ie(){return{iconName:null,title:null,titleId:null,prefix:null,transform:Du,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}}}function i8(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{styleParser:!0};const{iconName:r,prefix:o,rest:c}=mIe(t),f=gIe(t),_=gD("parseNodeAttributes",{},t);let x=e.styleParser?pIe(t):[];return{iconName:r,title:t.getAttribute("title"),titleId:t.getAttribute("data-fa-title-id"),prefix:o,transform:Du,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:c,styles:x,attributes:f},..._}}const{styles:yIe}=Ou;function wK(t){const e=Wn.autoReplaceSvg==="nest"?i8(t,{styleParser:!1}):i8(t);return~e.extra.classes.indexOf(iK)?qf("generateLayersText",t,e):qf("generateSvgReplacementMutation",t,e)}let Wu=new Set;nK.map(t=>{Wu.add("fa-".concat(t))});Object.keys(Em[ys]).map(Wu.add.bind(Wu));Object.keys(Em[_l]).map(Wu.add.bind(Wu));Object.keys(Em[yl]).map(Wu.add.bind(Wu));Wu=[...Wu];function s8(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!sd)return Promise.resolve();const r=os.documentElement.classList,o=D=>r.add("".concat(Z$,"-").concat(D)),c=D=>r.remove("".concat(Z$,"-").concat(D)),f=Wn.autoFetchSvg?Wu:nK.map(D=>"fa-".concat(D)).concat(Object.keys(yIe));f.includes("fa")||f.push("fa");const _=[".".concat(iK,":not([").concat(Gm,"])")].concat(f.map(D=>".".concat(D,":not([").concat(Gm,"])"))).join(", ");if(_.length===0)return Promise.resolve();let x=[];try{x=r0(t.querySelectorAll(_))}catch{}if(x.length>0)o("pending"),c("complete");else return Promise.resolve();const a=tz.begin("onTree"),I=x.reduce((D,O)=>{try{const F=wK(O);F&&D.push(F)}catch(F){tK||F.name==="MissingIcon"&&console.error(F)}return D},[]);return new Promise((D,O)=>{Promise.all(I).then(F=>{xK(F,()=>{o("active"),o("complete"),c("pending"),typeof e=="function"&&e(),a(),D()})}).catch(F=>{a(),O(F)})})}function vIe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;wK(t).then(r=>{r&&xK([r],e)})}function xIe(t){return function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o=(e||{}).icon?e:_D(e||{});let{mask:c}=r;return c&&(c=(c||{}).icon?c:_D(c||{})),t(o,{...r,mask:c})}}const bIe=function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{transform:r=Du,symbol:o=!1,mask:c=null,maskId:f=null,title:_=null,titleId:x=null,classes:a=[],attributes:I={},styles:D={}}=e;if(!t)return;const{prefix:O,iconName:F,icon:Z}=t;return aC({type:"icon",...t},()=>(qm("beforeDOMElementCreation",{iconDefinition:t,params:e}),Wn.autoA11y&&(_?I["aria-labelledby"]="".concat(Wn.replacementClass,"-title-").concat(x||B1()):(I["aria-hidden"]="true",I.focusable="false")),ez({icons:{main:yD(Z),mask:c?yD(c.icon):{found:!1,width:null,height:null,icon:{}}},prefix:O,iconName:F,transform:{...Du,...r},symbol:o,title:_,maskId:f,titleId:x,extra:{attributes:I,styles:D,classes:a}})))};var wIe={mixout(){return{icon:xIe(bIe)}},hooks(){return{mutationObserverCallbacks(t){return t.treeCallback=s8,t.nodeCallback=vIe,t}}},provides(t){t.i2svg=function(e){const{node:r=os,callback:o=()=>{}}=e;return s8(r,o)},t.generateSvgReplacementMutation=function(e,r){const{iconName:o,title:c,titleId:f,prefix:_,transform:x,symbol:a,mask:I,maskId:D,extra:O}=r;return new Promise((F,Z)=>{Promise.all([vD(o,_),I.iconName?vD(I.iconName,I.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(J=>{let[ne,se]=J;F([e,ez({icons:{main:ne,mask:se},prefix:_,iconName:o,transform:x,symbol:a,maskId:D,title:c,titleId:f,extra:O,watchable:!0})])}).catch(Z)})},t.generateAbstractIcon=function(e){let{children:r,attributes:o,main:c,transform:f,styles:_}=e;const x=iC(_);x.length>0&&(o.style=x);let a;return K4(f)&&(a=qf("generateAbstractTransformGrouping",{main:c,transform:f,containerWidth:c.width,iconWidth:c.width})),r.push(a||c.icon),{children:r,attributes:o}}}},TIe={mixout(){return{layer(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{classes:r=[]}=e;return aC({type:"layer"},()=>{qm("beforeDOMElementCreation",{assembler:t,params:e});let o=[];return t(c=>{Array.isArray(c)?c.map(f=>{o=o.concat(f.abstract)}):o=o.concat(c.abstract)}),[{tag:"span",attributes:{class:["".concat(Wn.cssPrefix,"-layers"),...r].join(" ")},children:o}]})}}}},EIe={mixout(){return{counter(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{title:r=null,classes:o=[],attributes:c={},styles:f={}}=e;return aC({type:"counter",content:t},()=>(qm("beforeDOMElementCreation",{content:t,params:e}),rIe({content:t.toString(),title:r,extra:{attributes:c,styles:f,classes:["".concat(Wn.cssPrefix,"-layers-counter"),...o]}})))}}}},SIe={mixout(){return{text(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{transform:r=Du,title:o=null,classes:c=[],attributes:f={},styles:_={}}=e;return aC({type:"text",content:t},()=>(qm("beforeDOMElementCreation",{content:t,params:e}),J$({content:t,transform:{...Du,...r},title:o,extra:{attributes:f,styles:_,classes:["".concat(Wn.cssPrefix,"-layers-text"),...c]}})))}}},provides(t){t.generateLayersText=function(e,r){const{title:o,transform:c,extra:f}=r;let _=null,x=null;if(XX){const a=parseInt(getComputedStyle(e).fontSize,10),I=e.getBoundingClientRect();_=I.width/a,x=I.height/a}return Wn.autoA11y&&!o&&(f.attributes["aria-hidden"]="true"),Promise.resolve([e,J$({content:e.innerHTML,width:_,height:x,transform:c,title:o,extra:f,watchable:!0})])}}};const IIe=new RegExp('"',"ug"),o8=[1105920,1112319],a8={FontAwesome:{normal:"fas",400:"fas"},...aSe,...oSe,...mSe},wD=Object.keys(a8).reduce((t,e)=>(t[e.toLowerCase()]=a8[e],t),{}),AIe=Object.keys(wD).reduce((t,e)=>{const r=wD[e];return t[e]=r[900]||[...Object.entries(r)][0][1],t},{});function CIe(t){const e=t.replace(IIe,""),r=BSe(e,0),o=r>=o8[0]&&r<=o8[1],c=e.length===2?e[0]===e[1]:!1;return{value:pD(c?e[0]:e),isSecondary:o||c}}function PIe(t,e){const r=t.replace(/^['"]|['"]$/g,"").toLowerCase(),o=parseInt(e),c=isNaN(o)?"normal":o;return(wD[r]||{})[c]||AIe[r]}function l8(t,e){const r="".concat(ySe).concat(e.replace(":","-"));return new Promise((o,c)=>{if(t.getAttribute(r)!==null)return o();const _=r0(t.children).filter(F=>F.getAttribute(uD)===e)[0],x=$f.getComputedStyle(t,e),a=x.getPropertyValue("font-family"),I=a.match(TSe),D=x.getPropertyValue("font-weight"),O=x.getPropertyValue("content");if(_&&!I)return t.removeChild(_),o();if(I&&O!=="none"&&O!==""){const F=x.getPropertyValue("content");let Z=PIe(a,D);const{value:J,isSecondary:ne}=CIe(F),se=I[0].startsWith("FontAwesome");let W=Q4(Z,J),Q=W;if(se){const K=WSe(J);K.iconName&&K.prefix&&(W=K.iconName,Z=K.prefix)}if(W&&!ne&&(!_||_.getAttribute(H4)!==Z||_.getAttribute(Z4)!==Q)){t.setAttribute(r,Q),_&&t.removeChild(_);const K=_Ie(),{extra:pe}=K;pe.attributes[uD]=e,vD(W,Z).then(Te=>{const we=ez({...K,icons:{main:Te,mask:J4()},prefix:Z,iconName:Q,extra:pe,watchable:!0}),oe=os.createElementNS("http://www.w3.org/2000/svg","svg");e==="::before"?t.insertBefore(oe,t.firstChild):t.appendChild(oe),oe.outerHTML=we.map(de=>Ib(de)).join(`
`),t.removeAttribute(r),o()}).catch(c)}else o()}else o()})}function RIe(t){return Promise.all([l8(t,"::before"),l8(t,"::after")])}function MIe(t){return t.parentNode!==document.head&&!~xSe.indexOf(t.tagName.toUpperCase())&&!t.getAttribute(uD)&&(!t.parentNode||t.parentNode.tagName!=="svg")}function c8(t){if(sd)return new Promise((e,r)=>{const o=r0(t.querySelectorAll("*")).filter(MIe).map(RIe),c=tz.begin("searchPseudoElements");bK(),Promise.all(o).then(()=>{c(),bD(),e()}).catch(()=>{c(),bD(),r()})})}var kIe={hooks(){return{mutationObserverCallbacks(t){return t.pseudoElementsCallback=c8,t}}},provides(t){t.pseudoElements2svg=function(e){const{node:r=os}=e;Wn.searchPseudoElements&&c8(r)}}};let u8=!1;var DIe={mixout(){return{dom:{unwatch(){bK(),u8=!0}}}},hooks(){return{bootstrap(){r8(gD("mutationObserverCallbacks",{}))},noAuto(){fIe()},watch(t){const{observeMutationsRoot:e}=t;u8?bD():r8(gD("mutationObserverCallbacks",{observeMutationsRoot:e}))}}}};const h8=t=>{let e={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return t.toLowerCase().split(" ").reduce((r,o)=>{const c=o.toLowerCase().split("-"),f=c[0];let _=c.slice(1).join("-");if(f&&_==="h")return r.flipX=!0,r;if(f&&_==="v")return r.flipY=!0,r;if(_=parseFloat(_),isNaN(_))return r;switch(f){case"grow":r.size=r.size+_;break;case"shrink":r.size=r.size-_;break;case"left":r.x=r.x-_;break;case"right":r.x=r.x+_;break;case"up":r.y=r.y-_;break;case"down":r.y=r.y+_;break;case"rotate":r.rotate=r.rotate+_;break}return r},e)};var OIe={mixout(){return{parse:{transform:t=>h8(t)}}},hooks(){return{parseNodeAttributes(t,e){const r=e.getAttribute("data-fa-transform");return r&&(t.transform=h8(r)),t}}},provides(t){t.generateAbstractTransformGrouping=function(e){let{main:r,transform:o,containerWidth:c,iconWidth:f}=e;const _={transform:"translate(".concat(c/2," 256)")},x="translate(".concat(o.x*32,", ").concat(o.y*32,") "),a="scale(".concat(o.size/16*(o.flipX?-1:1),", ").concat(o.size/16*(o.flipY?-1:1),") "),I="rotate(".concat(o.rotate," 0 0)"),D={transform:"".concat(x," ").concat(a," ").concat(I)},O={transform:"translate(".concat(f/2*-1," -256)")},F={outer:_,inner:D,path:O};return{tag:"g",attributes:{...F.outer},children:[{tag:"g",attributes:{...F.inner},children:[{tag:r.icon.tag,children:r.icon.children,attributes:{...r.icon.attributes,...F.path}}]}]}}}};const VM={x:0,y:0,width:"100%",height:"100%"};function d8(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return t.attributes&&(t.attributes.fill||e)&&(t.attributes.fill="black"),t}function LIe(t){return t.tag==="g"?t.children:[t]}var zIe={hooks(){return{parseNodeAttributes(t,e){const r=e.getAttribute("data-fa-mask"),o=r?oC(r.split(" ").map(c=>c.trim())):J4();return o.prefix||(o.prefix=Gf()),t.mask=o,t.maskId=e.getAttribute("data-fa-mask-id"),t}}},provides(t){t.generateAbstractMask=function(e){let{children:r,attributes:o,main:c,mask:f,maskId:_,transform:x}=e;const{width:a,icon:I}=c,{width:D,icon:O}=f,F=DSe({transform:x,containerWidth:D,iconWidth:a}),Z={tag:"rect",attributes:{...VM,fill:"white"}},J=I.children?{children:I.children.map(d8)}:{},ne={tag:"g",attributes:{...F.inner},children:[d8({tag:I.tag,attributes:{...I.attributes,...F.path},...J})]},se={tag:"g",attributes:{...F.outer},children:[ne]},W="mask-".concat(_||B1()),Q="clip-".concat(_||B1()),K={tag:"mask",attributes:{...VM,id:W,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"},children:[Z,se]},pe={tag:"defs",children:[{tag:"clipPath",attributes:{id:Q},children:LIe(O)},K]};return r.push(pe,{tag:"rect",attributes:{fill:"currentColor","clip-path":"url(#".concat(Q,")"),mask:"url(#".concat(W,")"),...VM}}),{children:r,attributes:o}}}},NIe={provides(t){let e=!1;$f.matchMedia&&(e=$f.matchMedia("(prefers-reduced-motion: reduce)").matches),t.missingIconAbstract=function(){const r=[],o={fill:"currentColor"},c={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};r.push({tag:"path",attributes:{...o,d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"}});const f={...c,attributeName:"opacity"},_={tag:"circle",attributes:{...o,cx:"256",cy:"364",r:"28"},children:[]};return e||_.children.push({tag:"animate",attributes:{...c,attributeName:"r",values:"28;14;28;28;14;28;"}},{tag:"animate",attributes:{...f,values:"1;0;1;1;0;1;"}}),r.push(_),r.push({tag:"path",attributes:{...o,opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"},children:e?[]:[{tag:"animate",attributes:{...f,values:"1;0;0;0;0;1;"}}]}),e||r.push({tag:"path",attributes:{...o,opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"},children:[{tag:"animate",attributes:{...f,values:"0;0;1;1;0;0;"}}]}),{tag:"g",attributes:{class:"missing"},children:r}}}},FIe={hooks(){return{parseNodeAttributes(t,e){const r=e.getAttribute("data-fa-symbol"),o=r===null?!1:r===""?!0:r;return t.symbol=o,t}}}},BIe=[zSe,wIe,TIe,EIe,SIe,kIe,DIe,OIe,zIe,NIe,FIe];KSe(BIe,{mixoutsTo:Tl});Tl.noAuto;Tl.config;Tl.library;Tl.dom;const TD=Tl.parse;Tl.findIconDefinition;Tl.toHtml;const jIe=Tl.icon;Tl.layer;Tl.text;Tl.counter;function f8(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),r.push.apply(r,o)}return r}function Cu(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?f8(Object(r),!0).forEach(function(o){K_(t,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):f8(Object(r)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(r,o))})}return t}function oI(t){"@babel/helpers - typeof";return oI=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oI(t)}function K_(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function UIe(t,e){if(t==null)return{};var r={},o=Object.keys(t),c,f;for(f=0;f<o.length;f++)c=o[f],!(e.indexOf(c)>=0)&&(r[c]=t[c]);return r}function VIe(t,e){if(t==null)return{};var r=UIe(t,e),o,c;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(t);for(c=0;c<f.length;c++)o=f[c],!(e.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(t,o)&&(r[o]=t[o])}return r}function ED(t){return $Ie(t)||GIe(t)||qIe(t)||WIe()}function $Ie(t){if(Array.isArray(t))return SD(t)}function GIe(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function qIe(t,e){if(t){if(typeof t=="string")return SD(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return SD(t,e)}}function SD(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,o=new Array(e);r<e;r++)o[r]=t[r];return o}function WIe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HIe(t){var e,r=t.beat,o=t.fade,c=t.beatFade,f=t.bounce,_=t.shake,x=t.flash,a=t.spin,I=t.spinPulse,D=t.spinReverse,O=t.pulse,F=t.fixedWidth,Z=t.inverse,J=t.border,ne=t.listItem,se=t.flip,W=t.size,Q=t.rotation,K=t.pull,pe=(e={"fa-beat":r,"fa-fade":o,"fa-beat-fade":c,"fa-bounce":f,"fa-shake":_,"fa-flash":x,"fa-spin":a,"fa-spin-reverse":D,"fa-spin-pulse":I,"fa-pulse":O,"fa-fw":F,"fa-inverse":Z,"fa-border":J,"fa-li":ne,"fa-flip":se===!0,"fa-flip-horizontal":se==="horizontal"||se==="both","fa-flip-vertical":se==="vertical"||se==="both"},K_(e,"fa-".concat(W),typeof W<"u"&&W!==null),K_(e,"fa-rotate-".concat(Q),typeof Q<"u"&&Q!==null&&Q!==0),K_(e,"fa-pull-".concat(K),typeof K<"u"&&K!==null),K_(e,"fa-swap-opacity",t.swapOpacity),e);return Object.keys(pe).map(function(Te){return pe[Te]?Te:null}).filter(function(Te){return Te})}function ZIe(t){return t=t-0,t===t}function TK(t){return ZIe(t)?t:(t=t.replace(/[\-_\s]+(.)?/g,function(e,r){return r?r.toUpperCase():""}),t.substr(0,1).toLowerCase()+t.substr(1))}var XIe=["style"];function KIe(t){return t.charAt(0).toUpperCase()+t.slice(1)}function YIe(t){return t.split(";").map(function(e){return e.trim()}).filter(function(e){return e}).reduce(function(e,r){var o=r.indexOf(":"),c=TK(r.slice(0,o)),f=r.slice(o+1).trim();return c.startsWith("webkit")?e[KIe(c)]=f:e[c]=f,e},{})}function EK(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof e=="string")return e;var o=(e.children||[]).map(function(a){return EK(t,a)}),c=Object.keys(e.attributes||{}).reduce(function(a,I){var D=e.attributes[I];switch(I){case"class":a.attrs.className=D,delete e.attributes.class;break;case"style":a.attrs.style=YIe(D);break;default:I.indexOf("aria-")===0||I.indexOf("data-")===0?a.attrs[I.toLowerCase()]=D:a.attrs[TK(I)]=D}return a},{attrs:{}}),f=r.style,_=f===void 0?{}:f,x=VIe(r,XIe);return c.attrs.style=Cu(Cu({},c.attrs.style),_),t.apply(void 0,[e.tag,Cu(Cu({},c.attrs),x)].concat(ED(o)))}var SK=!1;try{SK=!0}catch{}function QIe(){if(!SK&&console&&typeof console.error=="function"){var t;(t=console).error.apply(t,arguments)}}function p8(t){if(t&&oI(t)==="object"&&t.prefix&&t.iconName&&t.icon)return t;if(TD.icon)return TD.icon(t);if(t===null)return null;if(t&&oI(t)==="object"&&t.prefix&&t.iconName)return t;if(Array.isArray(t)&&t.length===2)return{prefix:t[0],iconName:t[1]};if(typeof t=="string")return{prefix:"fas",iconName:t}}function $M(t,e){return Array.isArray(e)&&e.length>0||!Array.isArray(e)&&e?K_({},t,e):{}}var m8={border:!1,className:"",mask:null,maskId:null,fixedWidth:!1,inverse:!1,flip:!1,icon:null,listItem:!1,pull:null,pulse:!1,rotation:null,size:null,spin:!1,spinPulse:!1,spinReverse:!1,beat:!1,fade:!1,beatFade:!1,bounce:!1,shake:!1,symbol:!1,title:"",titleId:null,transform:null,swapOpacity:!1},rz=Qr.forwardRef(function(t,e){var r=Cu(Cu({},m8),t),o=r.icon,c=r.mask,f=r.symbol,_=r.className,x=r.title,a=r.titleId,I=r.maskId,D=p8(o),O=$M("classes",[].concat(ED(HIe(r)),ED((_||"").split(" ")))),F=$M("transform",typeof r.transform=="string"?TD.transform(r.transform):r.transform),Z=$M("mask",p8(c)),J=jIe(D,Cu(Cu(Cu(Cu({},O),F),Z),{},{symbol:f,title:x,titleId:a,maskId:I}));if(!J)return QIe("Could not find icon",D),null;var ne=J.abstract,se={ref:e};return Object.keys(r).forEach(function(W){m8.hasOwnProperty(W)||(se[W]=r[W])}),JIe(ne[0],se)});rz.displayName="FontAwesomeIcon";rz.propTypes={beat:Kr.bool,border:Kr.bool,beatFade:Kr.bool,bounce:Kr.bool,className:Kr.string,fade:Kr.bool,flash:Kr.bool,mask:Kr.oneOfType([Kr.object,Kr.array,Kr.string]),maskId:Kr.string,fixedWidth:Kr.bool,inverse:Kr.bool,flip:Kr.oneOf([!0,!1,"horizontal","vertical","both"]),icon:Kr.oneOfType([Kr.object,Kr.array,Kr.string]),listItem:Kr.bool,pull:Kr.oneOf(["right","left"]),pulse:Kr.bool,rotation:Kr.oneOf([0,90,180,270]),shake:Kr.bool,size:Kr.oneOf(["2xs","xs","sm","lg","xl","2xl","1x","2x","3x","4x","5x","6x","7x","8x","9x","10x"]),spin:Kr.bool,spinPulse:Kr.bool,spinReverse:Kr.bool,symbol:Kr.oneOfType([Kr.bool,Kr.string]),title:Kr.string,titleId:Kr.string,transform:Kr.oneOfType([Kr.string,Kr.object]),swapOpacity:Kr.bool};var JIe=EK.bind(null,Qr.createElement);const eAe={prefix:"fas",iconName:"lock",icon:[448,512,[128274],"f023","M144 144l0 48 160 0 0-48c0-44.2-35.8-80-80-80s-80 35.8-80 80zM80 192l0-48C80 64.5 144.5 0 224 0s144 64.5 144 144l0 48 16 0c35.3 0 64 28.7 64 64l0 192c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 256c0-35.3 28.7-64 64-64l16 0z"]},tAe={prefix:"fas",iconName:"unlock",icon:[448,512,[128275],"f09c","M144 144c0-44.2 35.8-80 80-80c31.9 0 59.4 18.6 72.3 45.7c7.6 16 26.7 22.8 42.6 15.2s22.8-26.7 15.2-42.6C331 33.7 281.5 0 224 0C144.5 0 80 64.5 80 144l0 48-16 0c-35.3 0-64 28.7-64 64L0 448c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-192c0-35.3-28.7-64-64-64l-240 0 0-48z"]},nAe=({isPrivate:t=!1,onPrivacyModeChange:e})=>{const[r,o]=ee.useState(t),{showNotification:c}=Eb();ee.useEffect(()=>{o(t)},[t]);const f=async()=>{try{const _=!r,x=ar(Cn,"users",Ut.currentUser.uid);await Ns(x,{isPrivate:_}),o(_),typeof e=="function"?e(_):console.error("onPrivacyModeChange is not a function"),c("Privacy settings updated successfully!","success")}catch(_){console.error("Error updating privacy settings:",_),c("Error updating privacy settings","error")}};return V.jsx("div",{className:"privacy-settings",onClick:f,children:V.jsx(rz,{icon:r?eAe:tAe})})},rAe=({handleLogout:t,isNavExpanded:e})=>{const[r,o]=ee.useState("placeholder.jpg"),[c,f]=ee.useState("Default Name"),[_,x]=ee.useState("default_username"),[a,I]=ee.useState("Default Bio"),[D,O]=ee.useState(!1),[F,Z]=ee.useState(!1),[J,ne]=ee.useState(null),[se,W]=ee.useState([]),[Q,K]=ee.useState(!1),[pe,Te]=ee.useState([]),[we,oe]=ee.useState(null),de=ee.useRef(null),{showNotification:X}=Eb(),{userStatus:ge}=JEe(),[be,ke]=ee.useState(window.innerWidth<768),[Ee,Lt]=ee.useState(window.innerHeight*.5),jt=[{img:"/education.png",value:"education"},{img:"/food.png",value:"food"},{img:"/games.png",value:"games"},{img:"/other.png",value:"other"}];ee.useEffect(()=>{const zt=()=>{ke(window.innerWidth<768)};return window.addEventListener("resize",zt),()=>window.removeEventListener("resize",zt)},[]),ee.useEffect(()=>{Ut.currentUser&&(Qt(),Pt(),lt())},[]);const Qt=async()=>{try{const zt=await Lx(Ut.currentUser.uid);zt&&(f(zt.name||"Default Name"),x(zt.username||"default_username"),o(zt.profilePhoto||"placeholder.jpg"),I(zt.bio||"Default Bio"),Z(zt.isPrivate||!1),W(zt.tags||[]))}catch(zt){console.error("Error fetching user data:",zt),X("Failed to load user data","error")}},Pt=async()=>{if(Ut.currentUser)try{const zt=Oo(rs(Cn,"quests"),Di("uid","==",Ut.currentUser.uid),RS("createdAt","desc"),WW(5)),xn=(await cl(zt)).docs.map(rr=>({id:rr.id,...rr.data()}));Te(xn)}catch(zt){console.error("Error fetching recent quests:",zt),X("Failed to load recent quests","error")}},lt=async()=>{if(Ut.currentUser)try{const zt=Oo(rs(Cn,"quests"),Di("uid","==",Ut.currentUser.uid),Di("status","==","accepted")),qt=await cl(zt);if(qt.empty)oe(null);else{const xn=qt.docs[0].data();if(xn.targetUser){const rr=await Lx(xn.targetUser);oe({...xn,partnerName:(rr==null?void 0:rr.name)||"Unknown",partnerPhoto:(rr==null?void 0:rr.profilePhoto)||"placeholder.jpg",partnerUsername:(rr==null?void 0:rr.username)||"unknown_user"})}else oe(xn)}}catch(zt){console.error("Error fetching active quest:",zt),X("Failed to load active quest","error")}},At=async zt=>{Z(zt);try{await sx(Ut.currentUser.uid,{isPrivate:zt}),X("Privacy settings updated","success")}catch(qt){console.error("Error updating privacy mode:",qt),X("Failed to update privacy settings","error")}},nn=()=>{O(!D)},fn=async()=>{try{let zt=r;J&&(zt=await oge(J)),await sx(Ut.currentUser.uid,{name:c,username:_,bio:a,profilePhoto:zt,tags:se}),O(!1),ne(null),X("Profile updated successfully!","success")}catch(zt){console.error("Error updating profile:",zt),X("Failed to update profile","error")}},mn=zt=>{const qt=zt.target.files[0];qt&&(ne(qt),o(URL.createObjectURL(qt)))},Vt=()=>{D&&de.current.click()},wn=async zt=>{if(se.length<3&&!se.includes(zt)){const qt=[...se,zt];W(qt);try{await sx(Ut.currentUser.uid,{tags:qt}),X("Tag added successfully","success")}catch(xn){console.error("Error adding tag:",xn),X("Failed to add tag","error")}}},Ht=async zt=>{const qt=se.filter(xn=>xn!==zt);W(qt);try{await sx(Ut.currentUser.uid,{tags:qt}),X("Tag removed successfully","success")}catch(xn){console.error("Error removing tag:",xn),X("Failed to remove tag","error")}},Hn=()=>{K(!Q)},Jn=()=>{switch(ge){case"online":return"green";case"idle":return"yellow";case"on quest":return"red";case"offline":default:return"grey"}},ir=bb(({movement:[,zt],down:qt,event:xn})=>{if(be){if(qt){const rr=window.innerHeight*.5-zt;Lt(Math.max(100,Math.min(rr,window.innerHeight-60)))}xn.preventDefault()}},{delay:0,threshold:5}),Zt=yb({height:be?Ee:"auto",config:{tension:300,friction:30}});return V.jsxs(vb.div,{className:`profile-container ${be?"mobile":"desktop"} ${e?"nav-expanded":""}`,style:be?Zt:{},children:[be&&V.jsx("div",{className:"drag-handle",...ir()}),V.jsxs("div",{className:"profile-content",children:[V.jsxs("div",{className:"profile-header",children:[V.jsxs("div",{className:"profile-photo-container",onClick:Vt,children:[V.jsx("img",{src:r,alt:"Profile",className:"profile-photo"}),D&&V.jsxs(V.Fragment,{children:[V.jsx("input",{type:"file",ref:de,onChange:mn,style:{display:"none"}}),V.jsx("div",{className:"edit-photo-overlay",children:"Edit Profile Photo"})]})]}),V.jsxs("div",{className:"profile-name-status",children:[V.jsx("h2",{className:"profile-name",children:c}),V.jsxs("p",{className:"profile-username",children:["@",_]}),V.jsxs("p",{className:"profile-status",children:[V.jsx("span",{className:`status-dot ${Jn()}`}),ge.charAt(0).toUpperCase()+ge.slice(1)]})]}),V.jsx("div",{className:"privacy-icon",children:V.jsx(nAe,{isPrivate:F,onPrivacyChange:At})})]}),D?V.jsxs("div",{className:"profile-section",children:[V.jsx("h3",{className:"section-title",children:"Edit Profile"}),V.jsxs("div",{className:"nameedit",children:[V.jsx("input",{type:"text",value:c,onChange:zt=>f(zt.target.value),className:"profile-input",placeholder:"Name"}),V.jsx("input",{type:"text",value:_,onChange:zt=>x(zt.target.value),className:"profile-input",placeholder:"Username"})]}),V.jsx("textarea",{value:a,onChange:zt=>I(zt.target.value),className:"profile-bio-edit",placeholder:"Bio",maxLength:150})]}):V.jsxs("div",{className:"profile-section",children:[V.jsx("h3",{className:"section-title",children:"Bio"}),V.jsx("p",{className:"profile-bio",children:a})]}),V.jsxs("div",{className:"profile-actions",children:[V.jsxs("button",{className:"edit-profile-button",onClick:D?fn:nn,children:[V.jsx("i",{className:"fas fa-user-edit"})," ",D?"Save Profile":"Edit Profile"]}),V.jsxs("div",{className:"add-tag",children:[V.jsx("button",{onClick:Hn,children:"Add Tags"}),Q&&V.jsx("div",{className:"tag-options",children:jt.map(({img:zt,value:qt})=>V.jsx("button",{onClick:()=>wn(qt),children:V.jsx("img",{src:zt,alt:qt,className:"tag-icon"})},qt))})]})]}),V.jsxs("div",{className:"profile-section",children:[V.jsx("h3",{className:"section-title",children:"Tags"}),V.jsx("div",{className:"tags-container",children:se.map(zt=>{var qt;return V.jsxs("div",{className:"tag",children:[V.jsx("img",{src:((qt=jt.find(xn=>xn.value===zt))==null?void 0:qt.img)||"/other.png",alt:zt,className:"tag-icon"}),V.jsx("button",{onClick:()=>Ht(zt),children:"x"})]},zt)})})]}),V.jsxs("div",{className:"profile-section",children:[V.jsx("h3",{className:"section-title",children:"Active Quests"}),we?V.jsxs("div",{className:"quest-item",children:[V.jsxs("p",{children:['"',we.title,'" with']}),we.partnerName&&V.jsxs("div",{className:"quest-partner",children:[V.jsx("img",{src:we.partnerPhoto||"placeholder.jpg",alt:we.partnerName,className:"partner-photo"}),V.jsxs("p",{children:[we.partnerName," @",we.partnerUsername]})]})]}):V.jsx("div",{className:"no-quests",children:V.jsx("p",{children:"No quests ongoing. Ready to start a new adventure?"})})]}),V.jsxs("div",{className:"profile-section",children:[V.jsx("h3",{className:"section-title",children:"Recent Quests"}),pe.length>0?pe.map(zt=>V.jsxs("div",{className:"quest-item",children:[V.jsx("p",{children:zt.title}),zt.targetUser&&V.jsxs("p",{children:["with ",typeof zt.targetUser=="string"?zt.targetUser:zt.targetUser.name||"Unknown User"]})]},zt.id)):V.jsx("div",{className:"no-quests",children:V.jsx("p",{children:"No recent quests. Time to explore!"})})]}),V.jsxs("button",{className:"logout-button",onClick:t,children:[V.jsx("img",{src:"/logout.png",alt:"Logout"}),V.jsx("p",{className:"logouttext",children:"Logout"})]})]})]})},GM="/assets/chatbubble-DDibP9i3.png",iAe=({currentUserIds:t,map:e,setLockedUserId:r,lockedUserId:o,lockedUserData:c})=>{const[f,_]=ee.useState([]),[x,a]=ee.useState([]),[I,D]=ee.useState([]),[O,F]=ee.useState(null),[Z,J]=ee.useState(""),[ne,se]=ee.useState(""),[W,Q]=ee.useState(null),[K,pe]=ee.useState([]),[Te,we]=ee.useState(""),[oe,de]=ee.useState([]),[X,ge]=ee.useState(!1),[be,ke]=ee.useState(null),[Ee,Lt]=ee.useState(null),[jt,Qt]=ee.useState("friends"),[Pt,lt]=ee.useState(window.innerHeight*.5),At=ee.useCallback(async()=>{if(!Ut.currentUser){console.error("User is not authenticated");return}const wt=rs(Cn,"users"),St=Oo(wt,Di("isActive","==",!0)),it=(await cl(St)).docs.map(pt=>({id:pt.id,...pt.data()})).filter(pt=>pt.id!==Ut.currentUser.uid&&!x.some(Jt=>Jt.id===pt.id)&&t.includes(pt.id));_(it)},[x,t]),nn=ee.useCallback(async()=>{if(!Ut.currentUser){console.error("User is not authenticated");return}try{const wt=ar(Cn,"users",Ut.currentUser.uid),Ct=(await ns(wt)).data(),it=(Ct==null?void 0:Ct.friends)||[],pt=await Promise.all(it.map(async Jt=>{const In=ar(Cn,"users",Jt),en=await ns(In);return{id:Jt,...en.data()}}));a(pt)}catch(wt){console.error("Error fetching friends:",wt)}},[]);ee.useEffect(()=>{if(!Ut.currentUser){console.error("User is not authenticated");return}const wt=Df(rs(Cn,"friend_requests"),async St=>{const Ct=St.docs.map(en=>({id:en.id,...en.data()})),it=Ct.filter(en=>en.status==="pending"&&en.receiverId===Ut.currentUser.uid),Jt=Ct.filter(en=>en.status==="accepted"&&(en.senderId===Ut.currentUser.uid||en.receiverId===Ut.currentUser.uid)).map(en=>en.senderId===Ut.currentUser.uid?en.receiverId:en.senderId);nn().then(()=>{a(en=>en.filter(Ye=>Jt.includes(Ye.id)))});const In=await Promise.all(it.map(async en=>{const Ye=ar(Cn,"users",en.senderId),bn=(await ns(Ye)).data();return{id:en.id,senderId:en.senderId,senderName:(bn==null?void 0:bn.name)||"User",senderPhoto:(bn==null?void 0:bn.profilePhoto)||"default_photo_url"}}));D(In),At()});return nn(),()=>wt()},[At,nn]);const fn=async wt=>{if(console.log("Attempting to send friend request to:",wt),!wt){console.error("Receiver ID is undefined.");return}try{const St=Oo(rs(Cn,"friend_requests"),Di("senderId","==",Ut.currentUser.uid),Di("receiverId","==",wt),Di("status","==","pending"));if(!(await cl(St)).empty){console.log("Friend request already exists"),se("Friend request already exists!");return}await x3(rs(Cn,"friend_requests"),{senderId:Ut.currentUser.uid,senderName:Ut.currentUser.displayName,senderPhoto:Ut.currentUser.photoURL,receiverId:wt,status:"pending",timestamp:b3()}),se("Friend request sent!")}catch(St){console.error("Error sending friend request:",St)}},mn=async(wt,St)=>{try{await Ns(ar(Cn,"friend_requests",wt),{status:"accepted"}),await Ns(ar(Cn,"users",Ut.currentUser.uid),{friends:Dx(St)}),await Ns(ar(Cn,"users",St),{friends:Dx(Ut.currentUser.uid)}),se("Friend request accepted!"),nn()}catch(Ct){console.error("Error accepting friend request:",Ct)}},Vt=async wt=>{try{await kx(ar(Cn,"friend_requests",wt)),se("Friend request declined!")}catch(St){console.error("Error declining friend request:",St)}},wn=async wt=>{try{await Ns(ar(Cn,"users",Ut.currentUser.uid),{friends:w3(wt)}),await Ns(ar(Cn,"users",wt),{friends:w3(Ut.currentUser.uid)}),a(St=>St.filter(Ct=>Ct.id!==wt)),se("Friend removed!")}catch(St){console.error("Error removing friend:",St)}},Ht=async wt=>{if(Ee===wt.id)Lt(null),e&&Ut.currentUser&&(oD(e,Ut.currentUser.uid),setTimeout(()=>e.resize(),300));else{Lt(wt.id);const Ct=(await ns(ar(Cn,"users",wt.id))).data();Ct&&Ct.location&&e&&(oD(e,wt.id),setTimeout(()=>e.resize(),300))}},Hn=()=>{F(null)},Jn=wt=>{J(wt.target.value)},ir=wt=>{Q(wt),qt(wt.id),zt(wt)},Zt=()=>{Q(null),pe([])},zt=wt=>{de(St=>{const Ct=St.filter(it=>it.id!==wt.id);return[wt,...Ct]})},qt=async wt=>{if(!Ut.currentUser){console.error("User is not authenticated");return}const St=rs(Cn,"messages"),Ct=Oo(St,Di("senderId","in",[Ut.currentUser.uid,wt]),Di("receiverId","in",[Ut.currentUser.uid,wt]),RS("timestamp","desc"),WW(20)),pt=(await cl(Ct)).docs.map(Jt=>({id:Jt.id,...Jt.data()})).reverse();pe(pt)},xn=async()=>{if(Te.trim())try{await x3(rs(Cn,"messages"),{senderId:Ut.currentUser.uid,receiverId:W.id,content:Te,timestamp:b3()}),we(""),zt(W)}catch(wt){console.error("Error sending message:",wt)}},rr=wt=>{we(wt.target.value),be&&clearTimeout(be),Ns(ar(Cn,"users",Ut.currentUser.uid),{isTyping:!0});const St=setTimeout(()=>{Ns(ar(Cn,"users",Ut.currentUser.uid),{isTyping:!1})},2e3);ke(St)};ee.useEffect(()=>{if(W){const wt=Df(Oo(rs(Cn,"messages"),Di("senderId","in",[Ut.currentUser.uid,W.id]),Di("receiverId","in",[Ut.currentUser.uid,W.id]),RS("timestamp")),Ct=>{const it=Ct.docs.map(pt=>({id:pt.id,...pt.data()}));pe(it)}),St=Df(ar(Cn,"users",W.id),Ct=>{const it=Ct.data();it&&it.isTyping?ge(!0):ge(!1)});return()=>{wt(),St()}}},[W]);const Gn=f.filter(wt=>wt.name.toLowerCase().includes(Z.toLowerCase())),yr=()=>{if(!Ee)return null;const wt=f.find(St=>St.id===Ee)||x.find(St=>St.id===Ee);return wt?(x.some(St=>St.id===wt.id),V.jsxs("div",{className:"profile-container",children:[V.jsxs("div",{className:"profile-header",children:[V.jsx("div",{className:"profile-photo-container",children:V.jsx("img",{src:wt.profilePhoto,alt:"Profile",className:"profile-photo"})}),V.jsxs("div",{className:"profile-name-status",children:[V.jsx("h2",{className:"profile-name",children:wt.name}),V.jsxs("p",{className:"profile-status",children:[V.jsx("span",{className:"status-dot"})," Active"]})]})]}),V.jsxs("div",{className:"profile-section",children:[V.jsx("h3",{className:"section-title",children:"Bio"}),V.jsx("p",{className:"profile-bio",children:wt.bio||"No bio available"})]}),V.jsxs("div",{className:"profile-section",children:[V.jsx("h3",{className:"section-title",children:"Tags"}),V.jsx("div",{className:"tags-container",children:wt.tags&&wt.tags.map(St=>V.jsx("div",{className:"tag",children:St},St))})]}),V.jsxs("div",{className:"profile-actions",children:[V.jsx("button",{className:"add-friend-btn1",onClick:()=>fn(wt.id),children:"Add Friend"}),V.jsx("button",{className:"chat-btn2",onClick:()=>ir(wt),children:V.jsx("img",{src:GM,alt:"Chat",className:"icon-img"})})]}),V.jsx("button",{className:"unlock-btn1",onClick:()=>Lt(null),children:"Unlock User"})]})):null},Gr=()=>{switch(jt){case"friends":return V.jsxs("div",{className:"friends-section",children:[V.jsx("h2",{children:"Friends"}),x.map(wt=>V.jsxs("div",{className:"friend-item1",onClick:()=>Ht(wt),children:[V.jsx("img",{src:wt.profilePhoto,alt:"Friend"}),V.jsx("div",{children:wt.name}),V.jsxs("div",{className:"button-group",children:[V.jsx("button",{className:"remove-friend-btn1",onClick:St=>{St.stopPropagation(),wn(wt.id)},children:"Remove"}),V.jsx("button",{className:"chat-btn1",onClick:St=>{St.stopPropagation(),ir(wt)},children:V.jsx("img",{src:GM,alt:"Chat",className:"icon-img"})})]})]},wt.id))]});case"pending":return V.jsxs("div",{className:"pending-requests-section",children:[V.jsx("h2",{children:"Pending Requests"}),I.map(wt=>V.jsxs("div",{className:"pending-request",children:[V.jsx("img",{src:wt.senderPhoto,alt:"User"}),V.jsx("div",{children:wt.senderName}),V.jsxs("div",{className:"button-group",children:[V.jsx("button",{className:"accept-btn",onClick:()=>mn(wt.id,wt.senderId),children:"Accept"}),V.jsx("button",{className:"decline-btn",onClick:()=>Vt(wt.id),children:"Decline"})]})]},wt.id))]});case"people":return V.jsxs("div",{className:"people-section",children:[V.jsx("h2",{children:"People"}),Gn.map(wt=>V.jsxs("div",{className:`people-item ${Ee===wt.id?"locked":""}`,onClick:()=>Ht(wt),children:[V.jsx("img",{src:wt.profilePhoto,alt:"User"}),V.jsx("div",{children:wt.name}),V.jsxs("div",{className:"button-group",children:[V.jsx("button",{className:"add-friend-btn1",onClick:St=>{St.stopPropagation(),fn(wt.id)},children:"Add Friend"}),V.jsx("button",{className:"chat-btn1",onClick:St=>{St.stopPropagation(),ir(wt)},children:V.jsx("img",{src:GM,alt:"Chat",className:"icon-img"})})]})]},wt.id))]});case"recentChats":return V.jsxs("div",{className:"recent-chats-section",children:[V.jsx("h2",{children:"Recent Chats"}),oe.map(wt=>V.jsxs("div",{className:"chat-history-item",onClick:()=>ir(wt),children:[V.jsx("img",{src:wt.profilePhoto,alt:"Profile"}),V.jsx("div",{children:wt.name})]},wt.id))]});default:return null}},mr=bb(({movement:[,wt],down:St})=>{if(St){const Ct=window.innerHeight*.5-wt;lt(Math.max(100,Math.min(Ct,window.innerHeight-60)))}}),wr=yb({height:Pt,config:{tension:300,friction:30}});return V.jsxs(vb.div,{className:`connections-container1 ${Ee?"user-locked1":""}`,style:wr,children:[V.jsx("div",{className:"drag-handle",...mr()}),ne&&V.jsx("div",{className:"notification1",children:ne}),Ee?yr():V.jsxs(V.Fragment,{children:[V.jsx("div",{className:"search-bar1",children:V.jsx("input",{type:"text",placeholder:"Search users...",value:Z,onChange:Jn})}),V.jsxs("div",{className:"tabs1",children:[V.jsx("button",{className:`tab-button1 ${jt==="friends"?"active1":""}`,onClick:()=>Qt("friends"),children:"Friends"}),V.jsx("button",{className:`tab-button1 ${jt==="pending"?"active1":""}`,onClick:()=>Qt("pending"),children:"Pending Requests"}),V.jsx("button",{className:`tab-button1 ${jt==="people"?"active1":""}`,onClick:()=>Qt("people"),children:"People"}),V.jsx("button",{className:`tab-button1 ${jt==="recentChats"?"active1":""}`,onClick:()=>Qt("recentChats"),children:"Recent Chats"})]}),Gr()]}),O&&V.jsxs("div",{className:"user-popup1",children:[V.jsx("button",{className:"close-popup1",onClick:Hn,children:""}),V.jsx("img",{src:O.profilePhoto,alt:"Profile"}),V.jsx("div",{children:O.name}),V.jsx("div",{children:O.bio}),V.jsx("button",{className:"view-profile-btn1",onClick:()=>fn(O.id),children:"Add Friend"}),V.jsx("button",{className:"remove-friend-btn1",onClick:()=>wn(O.id),children:"Remove"})]}),W&&V.jsxs("div",{className:"chat-container1",children:[V.jsxs("div",{className:"chat-header1",children:[V.jsx("button",{className:"back-btn1",onClick:Zt,children:""}),V.jsx("img",{src:W.profilePhoto,alt:"Profile"}),V.jsx("div",{children:W.name})]}),V.jsxs("div",{className:"chat-messages1",children:[K.map(wt=>V.jsx("div",{className:`message1 ${wt.senderId===Ut.currentUser.uid?"sent1":"received1"}`,children:V.jsx("div",{children:wt.content})},wt.id)),X&&V.jsxs("div",{className:"typing-indicator1",children:[V.jsx("span",{}),V.jsx("span",{}),V.jsx("span",{})]})]}),V.jsxs("div",{className:"chat-input1",children:[V.jsx("input",{type:"text",placeholder:"Type a message...",value:Te,onChange:rr}),V.jsx("button",{onClick:xn,children:V.jsx("img",{className:"sendchatimg",src:"sendchat.png",alt:"Send"})})]})]})]})},sAe=()=>{const[t,e]=ee.useState({friendsCanSeeLocation:!0,quietMap:!1,canSeeOtherMarkers:!0,useCustomVisibilityList:!1}),[r,o]=ee.useState([]),[c,f]=ee.useState(""),[_,x]=ee.useState([]),[a,I]=ee.useState(window.innerHeight*.5);ee.useEffect(()=>{D()},[]);const D=async()=>{try{const Q=(await ns(ar(Cn,"users",Ut.currentUser.uid))).data();e(Q.privacySettings||{friendsCanSeeLocation:!0,quietMap:!1,canSeeOtherMarkers:!0,useCustomVisibilityList:!1}),o(Q.customVisibilityList||[])}catch(W){console.error("Error fetching privacy settings:",W)}},O=async(W,Q)=>{try{const K={...t,[W]:Q};e(K),await Ns(ar(Cn,"users",Ut.currentUser.uid),{privacySettings:K})}catch(K){console.error("Error updating privacy setting:",K)}},F=async W=>{if(f(W.target.value),W.target.value.length>2)try{const Q=rs(Cn,"users"),K=Oo(Q,Di("username",">=",W.target.value),Di("username","<=",W.target.value+"")),Te=(await cl(K)).docs.map(we=>({id:we.id,...we.data()}));x(Te)}catch(Q){console.error("Error searching users:",Q)}else x([])},Z=async W=>{if(W&&!r.some(Q=>Q.id===W.id)){const Q=[...r,W];o(Q),f(""),x([]);try{await Ns(ar(Cn,"users",Ut.currentUser.uid),{customVisibilityList:Q})}catch(K){console.error("Error updating custom list:",K)}}},J=async W=>{const Q=r.filter(K=>K.id!==W);o(Q);try{await Ns(ar(Cn,"users",Ut.currentUser.uid),{customVisibilityList:Q})}catch(K){console.error("Error updating custom list:",K)}},ne=bb(({movement:[,W],down:Q})=>{if(Q){const K=window.innerHeight*.5-W;I(Math.max(100,Math.min(K,window.innerHeight-60)))}}),se=yb({height:a,config:{tension:300,friction:30}});return V.jsxs(vb.div,{className:"privacy-container",style:se,children:[V.jsx("div",{className:"drag-handle",...ne()}),V.jsx("h2",{children:"Privacy Settings"}),V.jsxs("div",{className:"privacy-section",children:[V.jsx("h3",{className:"section-title1",children:"Location Visibility"}),V.jsxs("div",{className:"privacy-option",children:[V.jsxs("label",{className:"toggle-switch",children:[V.jsx("input",{type:"checkbox",checked:t.friendsCanSeeLocation,onChange:W=>O("friendsCanSeeLocation",W.target.checked)}),V.jsx("span",{className:"slider round"})]}),V.jsx("span",{children:"Friends can see my location in privacy mode"})]}),V.jsxs("div",{className:"privacy-option",children:[V.jsxs("label",{className:"toggle-switch",children:[V.jsx("input",{type:"checkbox",checked:t.quietMap,onChange:W=>O("quietMap",W.target.checked)}),V.jsx("span",{className:"slider round"})]}),V.jsx("span",{children:"Quiet Map (Hide my location from everyone)"})]}),V.jsxs("div",{className:"privacy-option",children:[V.jsxs("label",{className:"toggle-switch",children:[V.jsx("input",{type:"checkbox",checked:t.canSeeOtherMarkers,onChange:W=>O("canSeeOtherMarkers",W.target.checked)}),V.jsx("span",{className:"slider round"})]}),V.jsx("span",{children:"See other users' markers on the map"})]})]}),V.jsxs("div",{className:"privacy-section",children:[V.jsx("h3",{className:"section-title1",children:"Custom Visibility List"}),V.jsxs("div",{className:"privacy-option",children:[V.jsxs("label",{className:"toggle-switch",children:[V.jsx("input",{type:"checkbox",checked:t.useCustomVisibilityList,onChange:W=>O("useCustomVisibilityList",W.target.checked)}),V.jsx("span",{className:"slider round"})]}),V.jsx("span",{children:"Use Custom Visibility List"})]}),t.useCustomVisibilityList&&V.jsxs(V.Fragment,{children:[V.jsxs("div",{className:"search-user",children:[V.jsx("input",{type:"text",value:c,onChange:F,placeholder:"Search users..."}),V.jsx("div",{className:"search-results",children:_.map(W=>V.jsxs("div",{className:"search-result-item",onClick:()=>Z(W),children:[V.jsx("img",{src:W.profilePhoto||"/default-profile.png",alt:W.username,className:"user-avatar"}),V.jsx("span",{children:W.username})]},W.id))})]}),V.jsx("div",{className:"custom-list",children:r.map(W=>V.jsxs("div",{className:"custom-list-item",children:[V.jsx("img",{src:W.profilePhoto||"/default-profile.png",alt:W.username,className:"user-avatar"}),V.jsx("span",{children:W.username}),V.jsx("button",{onClick:()=>J(W.id),children:"Remove"})]},W.id))})]})]})]})},oAe=Gc("div")({position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(5px)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2e3}),aAe=Gc("div")({backgroundColor:"#000000",borderRadius:"20px",width:"90%",maxWidth:"500px",height:"90%",display:"flex",flexDirection:"column",overflow:"hidden"}),lAe=Gc("div")({position:"relative",width:"100%",height:"calc(100% - 150px)",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",backgroundColor:"#000000"}),cAe=Gc("img")({maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}),uAe=Gc("div")({position:"absolute",border:"2px solid white",boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.5)",cursor:"move"}),hAe=Gc("div")({padding:"20px",backgroundColor:"#000000"}),dAe=Gc(W1e)({display:"flex",justifyContent:"space-between",marginBottom:"20px"}),fAe=Gc($1e)({color:"white","&.Mui-checked":{color:"white"}}),pAe=Gc(Lxe)({"& .MuiFormControlLabel-label":{color:"white"}}),mAe=Gc("div")({display:"flex",justifyContent:"space-between"}),g8=Gc(N3)({flex:1,margin:"0 5px",fontWeight:"bold",borderRadius:"25px",padding:"12px 0"}),gAe=[{value:"1:1",label:"1:1"},{value:"4:5",label:"4:5"},{value:"3:4",label:"3:4"},{value:"2:3",label:"2:3"},{value:"9:16",label:"9:16"}],_Ae=({photoPreview:t,onUpload:e,onCancel:r})=>{const[o,c]=ee.useState("1:1"),[f,_]=ee.useState({x:0,y:0}),[x,a]=ee.useState({width:0,height:0}),[I,D]=ee.useState({width:0,height:0}),O=ee.useRef(null),F=ee.useRef(null),Z=ee.useRef(null);ee.useEffect(()=>{const W=new Image;W.onload=()=>{D({width:W.width,height:W.height})},W.src=t},[t]),ee.useEffect(()=>{J()},[o,I]);const J=()=>{if(O.current&&I.width&&I.height){const W=O.current.getBoundingClientRect(),[Q,K]=o.split(":").map(Number);W.width/W.height;const pe=I.width/I.height,Te=Q/K;let we,oe;Te>pe?(we=W.width,oe=we/Te):(oe=W.height,we=oe*Te),a({width:we,height:oe}),_({x:(W.width-we)/2,y:(W.height-oe)/2})}},ne=W=>{W.preventDefault();const Q=W.clientX-f.x,K=W.clientY-f.y,pe=we=>{if(O.current&&Z.current&&F.current){const oe=O.current.getBoundingClientRect(),de=F.current.getBoundingClientRect();let X=we.clientX-Q,ge=we.clientY-K;X=Math.max(de.left-oe.left,Math.min(X,de.right-oe.left-x.width)),ge=Math.max(de.top-oe.top,Math.min(ge,de.bottom-oe.top-x.height)),_({x:X,y:ge})}},Te=()=>{document.removeEventListener("mousemove",pe),document.removeEventListener("mouseup",Te)};document.addEventListener("mousemove",pe),document.addEventListener("mouseup",Te)},se=()=>{if(F.current&&Z.current){const W=F.current.getBoundingClientRect(),Q=Z.current.getBoundingClientRect(),K={x:(Q.left-W.left)/W.width,y:(Q.top-W.top)/W.height,width:Q.width/W.width,height:Q.height/W.height};e(K,o)}};return V.jsx(oAe,{children:V.jsxs(aAe,{children:[V.jsxs(lAe,{ref:O,children:[V.jsx(cAe,{ref:F,src:t,alt:"Preview"}),V.jsx(uAe,{ref:Z,style:{width:`${x.width}px`,height:`${x.height}px`,left:`${f.x}px`,top:`${f.y}px`},onMouseDown:ne})]}),V.jsxs(hAe,{children:[V.jsx(dAe,{row:!0,"aria-label":"aspect-ratio",name:"aspect-ratio",value:o,onChange:W=>c(W.target.value),children:gAe.map(W=>V.jsx(pAe,{value:W.value,control:V.jsx(fAe,{}),label:W.label},W.value))}),V.jsxs(mAe,{children:[V.jsx(g8,{onClick:se,variant:"contained",color:"primary",children:"Done"}),V.jsx(g8,{onClick:r,variant:"outlined",children:"Cancel"})]})]})]})})},yAe="/assets/notification-bPXQTjjH.png",vAe="/assets/day-and-night-DlaE3U3y.png",xAe=Qr.memo(()=>{const[t,e]=ee.useState(""),[r,o]=ee.useState([]),[c,f]=ee.useState("Loading address..."),[_,x]=ee.useState(null),[a,I]=ee.useState(null),[D,O]=ee.useState(null);ee.useState(null);const[F,Z]=ee.useState("environment"),[J,ne]=ee.useState(!1),[se,W]=ee.useState(null),[Q,K]=ee.useState(!1),[pe,Te]=ee.useState(null);ee.useState("medium"),ee.useState([]);const[we,oe]=ee.useState(!1),[de,X]=ee.useState(null),[ge,be]=ee.useState(""),[ke,Ee]=ee.useState([]);ee.useState("");const[Lt,jt]=ee.useState([]),[Qt,Pt]=ee.useState(!0),[lt,At]=ee.useState(null),[nn,fn]=ee.useState(!1),[mn,Vt]=ee.useState([]),[wn,Ht]=ee.useState(!0),[Hn,Jn]=ee.useState({width:1920,height:1080}),[ir,Zt]=ee.useState([]),[zt,qt]=ee.useState(!1),[xn,rr]=ee.useState(window.innerHeight*.5),[Gn,yr]=ee.useState(window.innerWidth<=768),Gr=II(),{showNotification:mr}=Eb(),wr=ee.useRef(null);ee.useRef(null);const wt=ee.useCallback(async Wt=>await Lx(Wt),[]);ee.useEffect(()=>{const Wt=Ut.onAuthStateChanged(async Ln=>{if(Ln){const Or=await wt(Ln.uid);Or?(At({uid:Ln.uid,...Or}),W(Or),St(Ln.uid),Ct(Ln.uid)):console.error("User document not found")}else At(null),W(null),Zt([]),jt([]);Pt(!1)});return()=>Wt()},[wt]),ee.useEffect(()=>{const Wt=GEe(Gr);return()=>Wt()},[Gr]),ee.useEffect(()=>{const Wt=()=>{yr(window.innerWidth<=768)};return window.addEventListener("resize",Wt),()=>window.removeEventListener("resize",Wt)},[]),ee.useEffect(()=>{const Wt=()=>{const Ln=window.innerWidth>=1024;Jn(Ln?{width:3840,height:2160}:{width:1920,height:1080})};return Wt(),window.addEventListener("resize",Wt),()=>window.removeEventListener("resize",Wt)},[]);const St=ee.useCallback(async Wt=>{const Ln=ar(Cn,"users",Wt),Or=await ns(Ln);if(Or.exists()){const Ei=Or.data().friends||[],Rr=await Promise.all(Ei.map(async us=>{const $i=ar(Cn,"users",us),si=await ns($i);if(si.exists()){const no=si.data(),ro=Oo(rs(Cn,"quests"),Di("uid","==",us),Di("status","==","accepted")),qr=await cl(ro);let Si="Idle",El=null;if(!qr.empty){const Be=qr.docs[0].data();if(Si="On a quest",Be.targetUser){const te=await ns(ar(Cn,"users",Be.targetUser));te.exists()&&(El=te.data())}}return{id:us,name:no.name,username:no.username,profilePhoto:no.profilePhoto,status:Si,questPartner:El}}return null}));Zt(Rr.filter(us=>us!==null))}},[]),Ct=ee.useCallback(async Wt=>{if(Wt)try{const Ln=ar(Cn,"users",Wt),Or=await ns(Ln);if(Or.exists()){const Ei=Or.data().friends||[],Rr=rs(Cn,"photos"),us=Oo(Rr,Di("userId","in",[Wt,...Ei]),RS("timestamp","desc")),$i=await cl(us),si=await Promise.all($i.docs.map(async no=>{const ro=no.data(),qr=await Lx(ro.userId);return{id:no.id,...ro,username:(qr==null?void 0:qr.name)||"Unknown User",user:{name:(qr==null?void 0:qr.name)||"Unknown User",profilePhoto:(qr==null?void 0:qr.profilePhoto)||"/default-profile-image.jpg"}}}));jt(si)}}catch(Ln){console.error("Error fetching grid data:",Ln),mr("Failed to load posts. Please try again.")}},[Lx,mr]),it=ee.useCallback(Wt=>{e(Ln=>{const Or=Wt===Ln?"":Wt;return Ht(Or===""||Or==="home"),K(!1),Or})},[]),pt=ee.useCallback(async Wt=>{if(Wt)try{const Ln=await wt(Wt);Ln?(I(Wt),O({id:Wt,...Ln}),e("connections"),_&&_.flyTo({center:[Ln.location.longitude,Ln.location.latitude],zoom:15})):console.error("No user found with ID:",Wt)}catch(Ln){console.error("Error fetching user data:",Ln)}else if(I(null),O(null),_&&Ut.currentUser){const Ln=await wt(Ut.currentUser.uid);_.flyTo({center:[Ln.location.longitude,Ln.location.latitude],zoom:15})}},[_,wt]),Jt=ee.useCallback(()=>{if(wr.current){const Wt=wr.current.takePhoto(),Ln=new Image;Ln.onload=()=>{const Or=document.createElement("canvas");Or.width=Ln.width,Or.height=Ln.height,Or.getContext("2d").drawImage(Ln,0,0,Ln.width,Ln.height);const Ei=Or.toDataURL("image/png",1);Te(Ei),ne(!1)},Ln.src=Wt}},[]),In=ee.useCallback(()=>{Z(Wt=>Wt==="user"?"environment":"user")},[]),en=ee.useCallback(()=>{ne(Wt=>!Wt),qt(Wt=>!Wt)},[]),Ye=ee.useCallback(()=>{K(Wt=>{const Ln=!Wt;return!Ln&&_&&(se!=null&&se.location)&&_.flyTo({center:[se.location.longitude,se.location.latitude],zoom:15,duration:2e3}),Ln})},[_,se]),Rt=ee.useCallback(Wt=>{X(Wt),oe(Ln=>!Ln),Wt&&bn(Wt.id)},[]),bn=ee.useCallback(async Wt=>{const Ln=rs(Cn,"photos",Wt,"comments"),Or=await cl(Ln),Pr=await Promise.all(Or.docs.map(async Ei=>{const Rr=Ei.data(),us=await wt(Rr.userId);return{id:Ei.id,...Rr,userProfileImage:us.profilePhoto}}));Ee(Pr)},[wt]),Pn=ee.useCallback(async Wt=>{if(Wt.trim()&&de){const Ln=await x3(rs(Cn,"photos",de.id,"comments"),{text:Wt,userId:Ut.currentUser.uid,username:Ut.currentUser.displayName,timestamp:new Date}),Or=await wt(Ut.currentUser.uid);Ee(Pr=>[...Pr,{id:Ln.id,text:Wt,userId:Ut.currentUser.uid,username:Ut.currentUser.displayName,timestamp:new Date,userProfileImage:Or.profilePhoto}])}},[de,wt]),gn=ee.useCallback(async(Wt,Ln,Or="")=>{if(Ut.currentUser&&pe)try{const Pr=ar(rs(Cn,"photos")),Ei={id:Pr.id,userId:Ut.currentUser.uid,user:{name:Ut.currentUser.displayName||"Unknown User",profilePhoto:(lt==null?void 0:lt.profilePhoto)||null},image:pe,aspectRatio:Ln,caption:Or,cropInfo:Wt,timestamp:b3()};await xm(Pr,Ei),mr("Photo uploaded successfully"),Te(null),be(""),jt(Rr=>[Ei,...Rr]),Ct(Ut.currentUser.uid)}catch(Pr){console.error("Error uploading photo:",Pr),mr("Failed to upload photo. Please try again.")}},[Ut.currentUser,pe,lt,mr,Ct]),er=ee.useCallback(async()=>{if(de&&de.userId===Ut.currentUser.uid)try{await kx(ar(Cn,"photos",de.id)),oe(!1),jt(Wt=>Wt.filter(Ln=>Ln.id!==de.id)),mr("Post deleted successfully"),Ct(Ut.currentUser.uid)}catch(Wt){console.error("Error deleting post:",Wt),mr("Failed to delete post. Please try again.")}},[de,mr,Ct]),Ur=ee.useCallback(()=>fn(Wt=>!Wt),[]),hn=ee.useCallback(()=>Vt([]),[]),Rn=bb(({movement:[,Wt],down:Ln})=>{if(Ln&&Gn){const Or=window.innerHeight*.5-Wt;rr(Math.max(100,Math.min(Or,window.innerHeight-60)))}}),Kt=yb({height:xn,config:{tension:300,friction:30}}),zi=ee.useMemo(()=>()=>V.jsxs("div",{className:"profile-display",children:[V.jsx("div",{className:"profile-photo-container",children:V.jsx("img",{src:(lt==null?void 0:lt.profilePhoto)||"/default-profile-image.jpg",alt:(lt==null?void 0:lt.name)||"Profile",className:"profile-photo"})}),V.jsxs("div",{className:"profile-name-status",children:[V.jsx("h2",{className:"profile-name",children:(lt==null?void 0:lt.name)||"Loading..."}),V.jsxs("p",{className:"profile-status",children:[V.jsx("span",{className:"status-dot"}),"Active now"]})]})]}),[lt]),li=Qr.memo(({items:Wt,onItemClick:Ln})=>{const Or=Pr=>{const[Ei,Rr]=Pr.split(":").map(Number),us=Rr/Ei;return us<=1?"landscape":us<=1.5?"portrait":"tall"};return V.jsx("div",{className:"pin-container",children:Wt.map(Pr=>{const Ei=Or(Pr.aspectRatio||"1:1");return V.jsxs("div",{className:`pin-item ${Ei}`,children:[V.jsx("div",{className:"card-wrapper",children:V.jsx("div",{className:"card",onClick:()=>Ln(Pr),children:V.jsx("div",{className:"card-image-container",children:V.jsx("img",{src:Pr.image,alt:Pr.caption||`Photo by ${Pr.user.name}`,className:"card-image"})})})}),V.jsxs("div",{className:"card-info",children:[V.jsxs("div",{className:"card-user-info",children:[V.jsx("img",{src:Pr.user.profilePhoto||"/default-profile-image.jpg",alt:Pr.user.name,className:"card-user-avatar"}),V.jsx("span",{className:"card-username",children:Pr.user.name})]}),Pr.caption&&V.jsx("p",{className:"card-caption",children:Pr.caption})]})]},Pr.id)})})}),vi=Qr.memo(({selectedImage:Wt,comments:Ln,onClose:Or,onAddComment:Pr,onDeletePost:Ei})=>{var si,no,ro;const[Rr,us]=ee.useState(""),$i=()=>{Pr(Rr),us("")};return V.jsx("div",{className:"image-preview-overlay",onClick:Or,children:V.jsxs("div",{className:"image-preview-content",onClick:qr=>qr.stopPropagation(),children:[V.jsx("div",{className:"image-preview-main",children:V.jsx("img",{src:Wt==null?void 0:Wt.image,alt:"Preview",className:"preview-image"})}),V.jsxs("div",{className:"image-preview-sidebar",children:[V.jsxs("div",{className:"image-preview-header",children:[V.jsxs("div",{className:"user-info",children:[V.jsx("img",{src:((si=Wt==null?void 0:Wt.user)==null?void 0:si.profilePhoto)||"/default-profile-image.jpg",alt:"User",className:"user-avatar"}),V.jsx("span",{className:"username",children:((no=Wt==null?void 0:Wt.user)==null?void 0:no.name)||"Unknown User"})]}),V.jsx(Ih,{onClick:Or,className:"close-button",children:V.jsx(lbe,{})})]}),V.jsx("div",{className:"quest-info",children:Wt!=null&&Wt.questTitle?V.jsx("p",{className:"quest-title",children:Wt.questTitle}):V.jsx("p",{className:"quest-break",children:"Taking a break from quests"})}),(Wt==null?void 0:Wt.caption)&&V.jsx("p",{className:"image-caption",children:Wt.caption}),V.jsx("div",{className:"comments-section",children:Ln.map(qr=>V.jsxs("div",{className:"comment",children:[V.jsx("img",{src:qr.userProfileImage||"/default-profile-image.jpg",alt:qr.username,className:"comment-user-avatar"}),V.jsxs("div",{className:"comment-content",children:[V.jsx("strong",{children:qr.username}),V.jsx("p",{children:qr.text})]})]},qr.id))}),V.jsx("div",{className:"add-comment",children:V.jsx(O6,{value:Rr,onChange:qr=>us(qr.target.value),placeholder:"Add a comment...",fullWidth:!0,InputProps:{endAdornment:V.jsx(Ih,{onClick:$i,children:V.jsx(dbe,{})})}})}),(Wt==null?void 0:Wt.userId)===((ro=Ut.currentUser)==null?void 0:ro.uid)&&V.jsx(N3,{startIcon:V.jsx(cbe,{}),onClick:Ei,className:"delete-button",children:"Delete Post"})]})]})})}),go=ee.useCallback(()=>V.jsxs("div",{className:"home-content",children:[V.jsxs("div",{className:"top-bar",children:[V.jsx(zi,{}),V.jsx("div",{className:"top-bar-center",children:V.jsx(O6,{className:"search-bar-home",placeholder:"Search...",variant:"outlined",fullWidth:!0,InputProps:{startAdornment:V.jsx(Ih,{children:V.jsx(hbe,{})})}})}),V.jsxs("div",{className:"top-bar-right",children:[V.jsx(Ih,{onClick:Ur,children:V.jsx(Gve,{badgeContent:mn.length,color:"primary",children:V.jsx("img",{src:yAe,alt:"Notifications",className:"top-bar-icon"})})}),V.jsx(Ih,{onClick:KEe,children:V.jsx("img",{src:vAe,alt:"Toggle Theme",className:"top-bar-icon"})})]})]}),V.jsx("div",{className:"section-container",children:V.jsx("div",{className:"friends-list2",children:ir.map(Wt=>V.jsxs("div",{className:"friend-item",children:[V.jsx("div",{className:"friend-photo-container",children:V.jsx("img",{src:Wt.profilePhoto||"/default-profile-image.jpg",alt:Wt.name,className:"friend-photo"})}),V.jsxs("div",{className:"friend-info",children:[V.jsx("div",{className:"friend-name",children:Wt.name}),V.jsxs("div",{className:"friend-username",children:["@",Wt.username]}),V.jsxs("div",{className:`friend-status ${Wt.status==="Idle"?"idle":"on-quest"}`,children:[Wt.status,Wt.status==="On a quest"&&Wt.questPartner&&V.jsxs("span",{className:"quest-partner",children:["with ",V.jsx("img",{src:Wt.questPartner.profilePhoto||"/default-profile-image.jpg",alt:Wt.questPartner.name,className:"partner-photo"}),"@",Wt.questPartner.username]})]})]})]},Wt.id))})}),nn&&V.jsxs("div",{className:"notifications-dropdown",children:[V.jsx("h3",{children:"Notifications"}),mn.map((Wt,Ln)=>V.jsx("div",{className:"notification-item",children:Wt},Ln)),V.jsx(N3,{onClick:hn,children:"Clear All"})]}),V.jsx("div",{className:"main-area",children:Gn?V.jsxs("div",{className:"mobile-layout",children:[V.jsx("div",{className:"full-map-container",children:V.jsx(Hv,{address:c,setAddress:f,setCurrentUserIds:o,setMap:x,activeSection:t,lockedUser:a,showAddressBar:!1,isFullScreen:!0})}),V.jsxs(vb.div,{className:"draggable-container",style:Kt,children:[V.jsx("div",{className:"drag-handle",...Rn()}),V.jsxs("div",{className:"mobile-content",children:[V.jsx("div",{className:"camera-button",onClick:en,children:V.jsx(z6,{})}),V.jsxs("div",{className:"section-container",children:[V.jsx("h2",{className:"section-title3",children:"Feed"}),V.jsx(li,{items:Lt,onItemClick:Rt})]})]})]})]}):V.jsxs(V.Fragment,{children:[V.jsx("div",{className:"grid-area",children:V.jsxs("div",{className:"section-container",children:[V.jsx("h2",{className:"section-title3",children:"Feed"}),V.jsx(li,{items:Lt,onItemClick:Rt})]})}),V.jsx("div",{className:"side-area",children:V.jsxs("div",{className:"section-container",children:[V.jsx("h2",{className:"section-title",children:"Camera & Map"}),V.jsxs("div",{className:"camera-map-area",children:[zt?V.jsxs("div",{className:"full-screen-camera",children:[V.jsx(kX,{ref:wr,facingMode:F,aspectRatio:"cover",errorMessages:{},videoSourceDeviceId:void 0,numberOfCamerasCallback:Wt=>console.log(Wt),videoResolution:Hn}),V.jsxs("div",{className:"camera-controls",children:[V.jsx(Ih,{onClick:en,className:"back-button",children:V.jsx(L6,{})}),V.jsx(Ih,{onClick:Jt,className:"capture-button",children:V.jsx("div",{className:"capture-button-inner"})}),V.jsx(Ih,{onClick:In,className:"flip-button",children:V.jsx(ube,{})})]})]}):V.jsxs("div",{className:"camera-placeholder",onClick:en,children:[V.jsx(z6,{}),V.jsx("span",{children:"Open Camera"})]}),V.jsx("div",{className:"mini-map",onClick:Ye,children:V.jsx(Hv,{address:c,setAddress:f,setCurrentUserIds:o,setMap:x,activeSection:t,lockedUser:a,showAddressBar:!1,isFullScreen:!1})})]})]})})]})}),V.jsxs(wbe,{children:[we&&V.jsx(vi,{selectedImage:de,comments:ke,onClose:()=>oe(!1),onAddComment:Pn,onDeletePost:er}),pe&&V.jsx(_Ae,{photoPreview:pe,onUpload:gn,onCancel:()=>Te(null),currentUser:lt})]})]}),[J,F,en,Jt,In,Ye,c,t,a,we,de,ke,Pn,er,pe,gn,lt,mn,Ur,hn,Hn,ir,Lt,Gn,Kt,Rn]),Xi=ee.useCallback(()=>V.jsxs("div",{className:"full-map-container",children:[V.jsx(Ih,{onClick:Ye,className:"back-button",children:V.jsx(L6,{})}),V.jsx(Hv,{address:c,setAddress:f,setCurrentUserIds:o,setMap:x,activeSection:t,lockedUser:a,showAddressBar:!0,isFullScreen:!0})]}),[Ye,c,t,a]),Ao=ee.useCallback(async()=>{try{await qEe(),mr("Logged out successfully"),Gr("/login")}catch(Wt){console.error("Logout failed:",Wt),mr("Logout failed. Please try again.")}},[mr,Gr]),Za=ee.useCallback(()=>{const Wt=wn?go():V.jsx("div",{className:`section-content ${Gn?"mobile-section":""}`,children:(()=>{switch(t){case"profile":return V.jsx(rAe,{handleLogout:Ao});case"quests":return V.jsx(BX,{currentUserIds:r,map:_});case"connections":return V.jsx(iAe,{currentUserIds:r,map:_,setLockedUser:pt,lockedUser:a,lockedUserData:D});case"privacy":return V.jsx(sAe,{});default:return null}})()});return Gn&&!wn?V.jsxs("div",{className:"mobile-section-with-map",children:[V.jsx("div",{className:"mobile-map-container",children:V.jsx(Hv,{address:c,setAddress:f,setCurrentUserIds:o,setMap:x,activeSection:t,lockedUser:a,showAddressBar:!1,isFullScreen:!1})}),V.jsx("div",{className:"mobile-section-content",children:Wt})]}):Wt},[t,wn,r,_,pt,a,D,go,Ao,Gn,c]),_o=ee.useCallback(()=>wn?"home-active":t==="profile"||t==="privacy"?`${t}-active`:t==="connections"?a?"connections-locked-active":"connections-active":t?`${t}-active`:"",[t,a,wn]);return ee.useEffect(()=>{wn&&x(null)},[wn]),V.jsxs("div",{className:`home-screen-container2 ${Gn?"mobile-view":""}`,children:[V.jsx(QEe,{activeSection:t,showSection:it,logo:"Questslogo blue.png",title:"QUESTS"}),Gn&&V.jsx("nav",{className:"mobile-nav-bar-container",children:V.jsxs("nav",{className:"mobile-nav-bar",children:[V.jsx("a",{href:"#home",className:`mobile-nav-button ${t===""?"active":""}`,onClick:()=>it(""),children:V.jsx("img",{src:"home.png",alt:"Home"})}),V.jsx("a",{href:"#profile",className:`mobile-nav-button ${t==="profile"?"active":""}`,onClick:()=>it("profile"),children:V.jsx("img",{src:"user-avatar.png",alt:"Profile"})}),V.jsx("a",{href:"#connections",className:`mobile-nav-button ${t==="connections"?"active":""}`,onClick:()=>it("connections"),children:V.jsx("img",{src:"happy.png",alt:"Connections"})}),V.jsx("a",{href:"#quests",className:`mobile-nav-button ${t==="quests"?"active":""}`,onClick:()=>it("quests"),children:V.jsx("img",{src:"letter.png",alt:"Quests"})}),V.jsx("a",{href:"#privacy",className:`mobile-nav-button ${t==="privacy"?"active":""}`,onClick:()=>it("privacy"),children:V.jsx("img",{src:"privacy1.png",alt:"Privacy"})})]})}),V.jsxs("div",{className:`main-content2 ${_o()}`,children:[Q?Xi():Za(),!wn&&!Q&&!Gn&&V.jsx("div",{className:"map-container2",children:V.jsx(Hv,{address:c,setAddress:f,setCurrentUserIds:o,setMap:x,activeSection:t,lockedUser:a,showAddressBar:!0,isFullScreen:!1})})]})]})}),_8=()=>{const{notifications:t}=Eb();return V.jsx("div",{className:"notification-container",children:t.map(e=>V.jsx("div",{className:`notification ${e.type} ${e.show?"show":"hide"}`,children:e.message},e.id))})};function bAe(){return V.jsxs("div",{className:"landing-page",children:[V.jsx("header",{className:"landing-header",children:V.jsx("img",{src:"quests logo.png",alt:"Quests Logo",className:"logo"})}),V.jsxs("main",{className:"landing-main",children:[V.jsx("div",{className:"FirstSection"}),V.jsxs("div",{className:"headline",children:["Connect ",V.jsx("div",{className:"Today",children:"Today"})]}),V.jsx("div",{className:"mainheadline",children:"Promoting daily connections & making networking easier than ever"}),V.jsx("div",{className:"subtext",children:"Quests makes networking easy by encouraging you to connect with nearby individuals, helping you build meaningful relationships effortlessly and fostering stronger communities."}),V.jsx("button",{className:"login-button",onClick:()=>window.location.href="/login",children:"Get Started"})]}),V.jsxs("div",{className:"Functions",children:[V.jsx("div",{className:"Functionsh1",children:"Functions"}),V.jsxs("div",{className:"functions-container",children:[V.jsxs("div",{className:"function-box",children:[V.jsx("div",{className:"functionicon",children:V.jsx("img",{src:"profile_hover.png",alt:"profile"})}),V.jsxs("div",{className:"functionrectheader",children:["Create a ",V.jsx("span",{children:"profile"})]}),V.jsx("div",{className:"functiontext",children:"Express yourself and give others insight to who you are by uploading a profile photo, creating a bio, showing your current status and more. You can choose to make your account public or private"})]}),V.jsxs("div",{className:"function-box",children:[V.jsx("div",{className:"functionicon",children:V.jsx("img",{src:"connections_hover.png",alt:"connections icon"})}),V.jsxs("div",{className:"functionrectheader",children:["Make a ",V.jsx("span",{children:"friend"})]}),V.jsx("div",{className:"functiontext",children:"You can search for existing users who you may know, add someone you went on a quest with as a friend, view your friends profile and so much more."})]}),V.jsxs("div",{className:"function-box",children:[V.jsx("div",{className:"functionicon",children:V.jsx("img",{src:"quest_hover.png",alt:"quests icon"})}),V.jsxs("div",{className:"functionrectheader",children:["Go on a ",V.jsx("span",{children:"quest"})]}),V.jsx("div",{className:"functiontext",children:"Using built in map functions and interactive social features to allow you to create public or private quests which you can accept, decline, complete, and view current quests."})]}),V.jsxs("div",{className:"function-box",children:[V.jsx("div",{className:"functionicon",children:V.jsx("img",{src:"privacy.png",alt:"privacy icon"})}),V.jsxs("div",{className:"functionrectheader",children:[V.jsx("span",{children:"Privacy"})," & ",V.jsx("span",{children:"Security"})]}),V.jsxs("div",{className:"functiontext",children:["We ensure you and your data are safe and sound. Once your account is private, you wont be seen by and cant see people neaby unless they are a friend. Additionaly there is an ",V.jsx("span",{children:"SOS"})," feature that alerts nearby personnel that you are in danger or in need of help."]})]}),V.jsxs("div",{className:"function-box",children:[V.jsx("div",{className:"functionicon",children:V.jsx("img",{src:"history_hover.png",alt:"history icon"})}),V.jsx("div",{className:"functionrectheader",children:V.jsx("span",{children:"History"})}),V.jsx("div",{className:"functiontext",children:"Keep track of previous quests and specific details of that quest such as the location, date, time and who you went on that quest with."})]}),V.jsxs("div",{className:"function-box",children:[V.jsx("div",{className:"functionicon",children:V.jsx("img",{src:"feed.png",alt:"feed icon"})}),V.jsxs("div",{className:"functionrectheader",children:["Photo ",V.jsx("span",{children:"Feed"})]}),V.jsx("div",{className:"functiontext",children:"Look at pictures from quests your friends are currently on and take pictures of your own. Like and leave a message on your friends pictures."})]}),"          "]})]}),V.jsx("footer",{className:"landing-footer",children:V.jsx("p",{children:" 2024 Quests. All rights reserved."})})]})}function wAe(){return ee.useEffect(()=>{$X()},[]),V.jsx(jEe,{children:V.jsxs(eSe,{children:[" ",V.jsx(xne,{children:V.jsxs(fne,{children:[V.jsx(C_,{path:"/",element:V.jsx(bAe,{})}),V.jsx(C_,{path:"/login",element:V.jsx(pge,{})}),V.jsx(C_,{path:"/register",element:V.jsx(mge,{})}),V.jsx(C_,{path:"/home",element:V.jsxs(V.Fragment,{children:[V.jsx(xAe,{}),V.jsx(_8,{})]})}),V.jsx(C_,{path:"/adventure-feed",element:V.jsx(V.Fragment,{children:V.jsx(_8,{})})})]})})]})})}R7(document.getElementById("root")).render(V.jsx(ee.StrictMode,{children:V.jsx(wAe,{})}))});export default TAe();
