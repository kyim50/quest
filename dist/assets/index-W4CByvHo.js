var _K=Object.defineProperty;var yK=(t,e,r)=>e in t?_K(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var F0=(t,e,r)=>yK(t,typeof e!="symbol"?e+"":e,r);function vK(t,e){for(var r=0;r<e.length;r++){const o=e[r];if(typeof o!="string"&&!Array.isArray(o)){for(const u in o)if(u!=="default"&&!(u in t)){const f=Object.getOwnPropertyDescriptor(o,u);f&&Object.defineProperty(t,u,f.get?f:{enumerable:!0,get:()=>o[u]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))o(u);new MutationObserver(u=>{for(const f of u)if(f.type==="childList")for(const y of f.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&o(y)}).observe(document,{childList:!0,subtree:!0});function r(u){const f={};return u.integrity&&(f.integrity=u.integrity),u.referrerPolicy&&(f.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?f.credentials="include":u.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function o(u){if(u.ep)return;u.ep=!0;const f=r(u);fetch(u.href,f)}})();var PV=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function HE(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var RV={exports:{}},ZE={},MV={exports:{}},qr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nx=Symbol.for("react.element"),xK=Symbol.for("react.portal"),bK=Symbol.for("react.fragment"),wK=Symbol.for("react.strict_mode"),TK=Symbol.for("react.profiler"),EK=Symbol.for("react.provider"),SK=Symbol.for("react.context"),IK=Symbol.for("react.forward_ref"),AK=Symbol.for("react.suspense"),CK=Symbol.for("react.memo"),PK=Symbol.for("react.lazy"),gN=Symbol.iterator;function RK(t){return t===null||typeof t!="object"?null:(t=gN&&t[gN]||t["@@iterator"],typeof t=="function"?t:null)}var kV={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},DV=Object.assign,OV={};function ey(t,e,r){this.props=t,this.context=e,this.refs=OV,this.updater=r||kV}ey.prototype.isReactComponent={};ey.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ey.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function LV(){}LV.prototype=ey.prototype;function Vk(t,e,r){this.props=t,this.context=e,this.refs=OV,this.updater=r||kV}var jk=Vk.prototype=new LV;jk.constructor=Vk;DV(jk,ey.prototype);jk.isPureReactComponent=!0;var _N=Array.isArray,zV=Object.prototype.hasOwnProperty,$k={current:null},NV={key:!0,ref:!0,__self:!0,__source:!0};function FV(t,e,r){var o,u={},f=null,y=null;if(e!=null)for(o in e.ref!==void 0&&(y=e.ref),e.key!==void 0&&(f=""+e.key),e)zV.call(e,o)&&!NV.hasOwnProperty(o)&&(u[o]=e[o]);var T=arguments.length-2;if(T===1)u.children=r;else if(1<T){for(var a=Array(T),A=0;A<T;A++)a[A]=arguments[A+2];u.children=a}if(t&&t.defaultProps)for(o in T=t.defaultProps,T)u[o]===void 0&&(u[o]=T[o]);return{$$typeof:Nx,type:t,key:f,ref:y,props:u,_owner:$k.current}}function MK(t,e){return{$$typeof:Nx,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Gk(t){return typeof t=="object"&&t!==null&&t.$$typeof===Nx}function kK(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var yN=/\/+/g;function YC(t,e){return typeof t=="object"&&t!==null&&t.key!=null?kK(""+t.key):e.toString(36)}function Xw(t,e,r,o,u){var f=typeof t;(f==="undefined"||f==="boolean")&&(t=null);var y=!1;if(t===null)y=!0;else switch(f){case"string":case"number":y=!0;break;case"object":switch(t.$$typeof){case Nx:case xK:y=!0}}if(y)return y=t,u=u(y),t=o===""?"."+YC(y,0):o,_N(u)?(r="",t!=null&&(r=t.replace(yN,"$&/")+"/"),Xw(u,e,r,"",function(A){return A})):u!=null&&(Gk(u)&&(u=MK(u,r+(!u.key||y&&y.key===u.key?"":(""+u.key).replace(yN,"$&/")+"/")+t)),e.push(u)),1;if(y=0,o=o===""?".":o+":",_N(t))for(var T=0;T<t.length;T++){f=t[T];var a=o+YC(f,T);y+=Xw(f,e,r,a,u)}else if(a=RK(t),typeof a=="function")for(t=a.call(t),T=0;!(f=t.next()).done;)f=f.value,a=o+YC(f,T++),y+=Xw(f,e,r,a,u);else if(f==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return y}function lw(t,e,r){if(t==null)return t;var o=[],u=0;return Xw(t,o,"","",function(f){return e.call(r,f,u++)}),o}function DK(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var ma={current:null},Kw={transition:null},OK={ReactCurrentDispatcher:ma,ReactCurrentBatchConfig:Kw,ReactCurrentOwner:$k};function BV(){throw Error("act(...) is not supported in production builds of React.")}qr.Children={map:lw,forEach:function(t,e,r){lw(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return lw(t,function(){e++}),e},toArray:function(t){return lw(t,function(e){return e})||[]},only:function(t){if(!Gk(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};qr.Component=ey;qr.Fragment=bK;qr.Profiler=TK;qr.PureComponent=Vk;qr.StrictMode=wK;qr.Suspense=AK;qr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=OK;qr.act=BV;qr.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var o=DV({},t.props),u=t.key,f=t.ref,y=t._owner;if(e!=null){if(e.ref!==void 0&&(f=e.ref,y=$k.current),e.key!==void 0&&(u=""+e.key),t.type&&t.type.defaultProps)var T=t.type.defaultProps;for(a in e)zV.call(e,a)&&!NV.hasOwnProperty(a)&&(o[a]=e[a]===void 0&&T!==void 0?T[a]:e[a])}var a=arguments.length-2;if(a===1)o.children=r;else if(1<a){T=Array(a);for(var A=0;A<a;A++)T[A]=arguments[A+2];o.children=T}return{$$typeof:Nx,type:t.type,key:u,ref:f,props:o,_owner:y}};qr.createContext=function(t){return t={$$typeof:SK,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:EK,_context:t},t.Consumer=t};qr.createElement=FV;qr.createFactory=function(t){var e=FV.bind(null,t);return e.type=t,e};qr.createRef=function(){return{current:null}};qr.forwardRef=function(t){return{$$typeof:IK,render:t}};qr.isValidElement=Gk;qr.lazy=function(t){return{$$typeof:PK,_payload:{_status:-1,_result:t},_init:DK}};qr.memo=function(t,e){return{$$typeof:CK,type:t,compare:e===void 0?null:e}};qr.startTransition=function(t){var e=Kw.transition;Kw.transition={};try{t()}finally{Kw.transition=e}};qr.unstable_act=BV;qr.useCallback=function(t,e){return ma.current.useCallback(t,e)};qr.useContext=function(t){return ma.current.useContext(t)};qr.useDebugValue=function(){};qr.useDeferredValue=function(t){return ma.current.useDeferredValue(t)};qr.useEffect=function(t,e){return ma.current.useEffect(t,e)};qr.useId=function(){return ma.current.useId()};qr.useImperativeHandle=function(t,e,r){return ma.current.useImperativeHandle(t,e,r)};qr.useInsertionEffect=function(t,e){return ma.current.useInsertionEffect(t,e)};qr.useLayoutEffect=function(t,e){return ma.current.useLayoutEffect(t,e)};qr.useMemo=function(t,e){return ma.current.useMemo(t,e)};qr.useReducer=function(t,e,r){return ma.current.useReducer(t,e,r)};qr.useRef=function(t){return ma.current.useRef(t)};qr.useState=function(t){return ma.current.useState(t)};qr.useSyncExternalStore=function(t,e,r){return ma.current.useSyncExternalStore(t,e,r)};qr.useTransition=function(){return ma.current.useTransition()};qr.version="18.3.1";MV.exports=qr;var ue=MV.exports;const vi=HE(ue),gR=vK({__proto__:null,default:vi},[ue]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LK=ue,zK=Symbol.for("react.element"),NK=Symbol.for("react.fragment"),FK=Object.prototype.hasOwnProperty,BK=LK.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,UK={key:!0,ref:!0,__self:!0,__source:!0};function UV(t,e,r){var o,u={},f=null,y=null;r!==void 0&&(f=""+r),e.key!==void 0&&(f=""+e.key),e.ref!==void 0&&(y=e.ref);for(o in e)FK.call(e,o)&&!UK.hasOwnProperty(o)&&(u[o]=e[o]);if(t&&t.defaultProps)for(o in e=t.defaultProps,e)u[o]===void 0&&(u[o]=e[o]);return{$$typeof:zK,type:t,key:f,ref:y,props:u,_owner:BK.current}}ZE.Fragment=NK;ZE.jsx=UV;ZE.jsxs=UV;RV.exports=ZE;var J=RV.exports,VV={exports:{}},ul={},jV={exports:{}},$V={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(at,Ct){var Zt=at.length;at.push(Ct);e:for(;0<Zt;){var rt=Zt-1>>>1,wt=at[rt];if(0<u(wt,Ct))at[rt]=Ct,at[Zt]=wt,Zt=rt;else break e}}function r(at){return at.length===0?null:at[0]}function o(at){if(at.length===0)return null;var Ct=at[0],Zt=at.pop();if(Zt!==Ct){at[0]=Zt;e:for(var rt=0,wt=at.length,pt=wt>>>1;rt<pt;){var jt=2*(rt+1)-1,Mt=at[jt],pn=jt+1,un=at[pn];if(0>u(Mt,Zt))pn<wt&&0>u(un,Mt)?(at[rt]=un,at[pn]=Zt,rt=pn):(at[rt]=Mt,at[jt]=Zt,rt=jt);else if(pn<wt&&0>u(un,Zt))at[rt]=un,at[pn]=Zt,rt=pn;else break e}}return Ct}function u(at,Ct){var Zt=at.sortIndex-Ct.sortIndex;return Zt!==0?Zt:at.id-Ct.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;t.unstable_now=function(){return f.now()}}else{var y=Date,T=y.now();t.unstable_now=function(){return y.now()-T}}var a=[],A=[],D=1,O=null,B=3,H=!1,Q=!1,re=!1,se=typeof setTimeout=="function"?setTimeout:null,G=typeof clearTimeout=="function"?clearTimeout:null,Y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Z(at){for(var Ct=r(A);Ct!==null;){if(Ct.callback===null)o(A);else if(Ct.startTime<=at)o(A),Ct.sortIndex=Ct.expirationTime,e(a,Ct);else break;Ct=r(A)}}function fe(at){if(re=!1,Z(at),!Q)if(r(a)!==null)Q=!0,Bt(Te);else{var Ct=r(A);Ct!==null&&bt(fe,Ct.startTime-at)}}function Te(at,Ct){Q=!1,re&&(re=!1,G(he),he=-1),H=!0;var Zt=B;try{for(Z(Ct),O=r(a);O!==null&&(!(O.expirationTime>Ct)||at&&!_e());){var rt=O.callback;if(typeof rt=="function"){O.callback=null,B=O.priorityLevel;var wt=rt(O.expirationTime<=Ct);Ct=t.unstable_now(),typeof wt=="function"?O.callback=wt:O===r(a)&&o(a),Z(Ct)}else o(a);O=r(a)}if(O!==null)var pt=!0;else{var jt=r(A);jt!==null&&bt(fe,jt.startTime-Ct),pt=!1}return pt}finally{O=null,B=Zt,H=!1}}var Pe=!1,ce=null,he=-1,W=5,ge=-1;function _e(){return!(t.unstable_now()-ge<W)}function Ee(){if(ce!==null){var at=t.unstable_now();ge=at;var Ct=!0;try{Ct=ce(!0,at)}finally{Ct?we():(Pe=!1,ce=null)}}else Pe=!1}var we;if(typeof Y=="function")we=function(){Y(Ee)};else if(typeof MessageChannel<"u"){var xt=new MessageChannel,Rt=xt.port2;xt.port1.onmessage=Ee,we=function(){Rt.postMessage(null)}}else we=function(){se(Ee,0)};function Bt(at){ce=at,Pe||(Pe=!0,we())}function bt(at,Ct){he=se(function(){at(t.unstable_now())},Ct)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(at){at.callback=null},t.unstable_continueExecution=function(){Q||H||(Q=!0,Bt(Te))},t.unstable_forceFrameRate=function(at){0>at||125<at?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):W=0<at?Math.floor(1e3/at):5},t.unstable_getCurrentPriorityLevel=function(){return B},t.unstable_getFirstCallbackNode=function(){return r(a)},t.unstable_next=function(at){switch(B){case 1:case 2:case 3:var Ct=3;break;default:Ct=B}var Zt=B;B=Ct;try{return at()}finally{B=Zt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(at,Ct){switch(at){case 1:case 2:case 3:case 4:case 5:break;default:at=3}var Zt=B;B=at;try{return Ct()}finally{B=Zt}},t.unstable_scheduleCallback=function(at,Ct,Zt){var rt=t.unstable_now();switch(typeof Zt=="object"&&Zt!==null?(Zt=Zt.delay,Zt=typeof Zt=="number"&&0<Zt?rt+Zt:rt):Zt=rt,at){case 1:var wt=-1;break;case 2:wt=250;break;case 5:wt=1073741823;break;case 4:wt=1e4;break;default:wt=5e3}return wt=Zt+wt,at={id:D++,callback:Ct,priorityLevel:at,startTime:Zt,expirationTime:wt,sortIndex:-1},Zt>rt?(at.sortIndex=Zt,e(A,at),r(a)===null&&at===r(A)&&(re?(G(he),he=-1):re=!0,bt(fe,Zt-rt))):(at.sortIndex=wt,e(a,at),Q||H||(Q=!0,Bt(Te))),at},t.unstable_shouldYield=_e,t.unstable_wrapCallback=function(at){var Ct=B;return function(){var Zt=B;B=Ct;try{return at.apply(this,arguments)}finally{B=Zt}}}})($V);jV.exports=$V;var VK=jV.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jK=ue,cl=VK;function an(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var GV=new Set,Xv={};function fm(t,e){I_(t,e),I_(t+"Capture",e)}function I_(t,e){for(Xv[t]=e,t=0;t<e.length;t++)GV.add(e[t])}var Eh=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),_R=Object.prototype.hasOwnProperty,$K=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,vN={},xN={};function GK(t){return _R.call(xN,t)?!0:_R.call(vN,t)?!1:$K.test(t)?xN[t]=!0:(vN[t]=!0,!1)}function qK(t,e,r,o){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return o?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function WK(t,e,r,o){if(e===null||typeof e>"u"||qK(t,e,r,o))return!0;if(o)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ga(t,e,r,o,u,f,y){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=o,this.attributeNamespace=u,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=f,this.removeEmptyString=y}var Ao={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ao[t]=new ga(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ao[e]=new ga(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ao[t]=new ga(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ao[t]=new ga(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ao[t]=new ga(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ao[t]=new ga(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ao[t]=new ga(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ao[t]=new ga(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ao[t]=new ga(t,5,!1,t.toLowerCase(),null,!1,!1)});var qk=/[\-:]([a-z])/g;function Wk(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(qk,Wk);Ao[e]=new ga(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(qk,Wk);Ao[e]=new ga(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(qk,Wk);Ao[e]=new ga(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ao[t]=new ga(t,1,!1,t.toLowerCase(),null,!1,!1)});Ao.xlinkHref=new ga("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ao[t]=new ga(t,1,!1,t.toLowerCase(),null,!0,!0)});function Hk(t,e,r,o){var u=Ao.hasOwnProperty(e)?Ao[e]:null;(u!==null?u.type!==0:o||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(WK(e,r,u,o)&&(r=null),o||u===null?GK(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):u.mustUseProperty?t[u.propertyName]=r===null?u.type===3?!1:"":r:(e=u.attributeName,o=u.attributeNamespace,r===null?t.removeAttribute(e):(u=u.type,r=u===3||u===4&&r===!0?"":""+r,o?t.setAttributeNS(o,e,r):t.setAttribute(e,r))))}var Fh=jK.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,cw=Symbol.for("react.element"),Wg=Symbol.for("react.portal"),Hg=Symbol.for("react.fragment"),Zk=Symbol.for("react.strict_mode"),yR=Symbol.for("react.profiler"),qV=Symbol.for("react.provider"),WV=Symbol.for("react.context"),Xk=Symbol.for("react.forward_ref"),vR=Symbol.for("react.suspense"),xR=Symbol.for("react.suspense_list"),Kk=Symbol.for("react.memo"),Nd=Symbol.for("react.lazy"),HV=Symbol.for("react.offscreen"),bN=Symbol.iterator;function B0(t){return t===null||typeof t!="object"?null:(t=bN&&t[bN]||t["@@iterator"],typeof t=="function"?t:null)}var gs=Object.assign,QC;function sv(t){if(QC===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);QC=e&&e[1]||""}return`
`+QC+t}var JC=!1;function eP(t,e){if(!t||JC)return"";JC=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(A){var o=A}Reflect.construct(t,[],e)}else{try{e.call()}catch(A){o=A}t.call(e.prototype)}else{try{throw Error()}catch(A){o=A}t()}}catch(A){if(A&&o&&typeof A.stack=="string"){for(var u=A.stack.split(`
`),f=o.stack.split(`
`),y=u.length-1,T=f.length-1;1<=y&&0<=T&&u[y]!==f[T];)T--;for(;1<=y&&0<=T;y--,T--)if(u[y]!==f[T]){if(y!==1||T!==1)do if(y--,T--,0>T||u[y]!==f[T]){var a=`
`+u[y].replace(" at new "," at ");return t.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",t.displayName)),a}while(1<=y&&0<=T);break}}}finally{JC=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?sv(t):""}function HK(t){switch(t.tag){case 5:return sv(t.type);case 16:return sv("Lazy");case 13:return sv("Suspense");case 19:return sv("SuspenseList");case 0:case 2:case 15:return t=eP(t.type,!1),t;case 11:return t=eP(t.type.render,!1),t;case 1:return t=eP(t.type,!0),t;default:return""}}function bR(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Hg:return"Fragment";case Wg:return"Portal";case yR:return"Profiler";case Zk:return"StrictMode";case vR:return"Suspense";case xR:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case WV:return(t.displayName||"Context")+".Consumer";case qV:return(t._context.displayName||"Context")+".Provider";case Xk:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Kk:return e=t.displayName||null,e!==null?e:bR(t.type)||"Memo";case Nd:e=t._payload,t=t._init;try{return bR(t(e))}catch{}}return null}function ZK(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return bR(e);case 8:return e===Zk?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ff(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function ZV(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function XK(t){var e=ZV(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),o=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var u=r.get,f=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return u.call(this)},set:function(y){o=""+y,f.call(this,y)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return o},setValue:function(y){o=""+y},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function uw(t){t._valueTracker||(t._valueTracker=XK(t))}function XV(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),o="";return t&&(o=ZV(t)?t.checked?"true":"false":t.value),t=o,t!==r?(e.setValue(t),!0):!1}function MT(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function wR(t,e){var r=e.checked;return gs({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function wN(t,e){var r=e.defaultValue==null?"":e.defaultValue,o=e.checked!=null?e.checked:e.defaultChecked;r=ff(e.value!=null?e.value:r),t._wrapperState={initialChecked:o,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function KV(t,e){e=e.checked,e!=null&&Hk(t,"checked",e,!1)}function TR(t,e){KV(t,e);var r=ff(e.value),o=e.type;if(r!=null)o==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(o==="submit"||o==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?ER(t,e.type,r):e.hasOwnProperty("defaultValue")&&ER(t,e.type,ff(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function TN(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var o=e.type;if(!(o!=="submit"&&o!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function ER(t,e,r){(e!=="number"||MT(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var ov=Array.isArray;function u_(t,e,r,o){if(t=t.options,e){e={};for(var u=0;u<r.length;u++)e["$"+r[u]]=!0;for(r=0;r<t.length;r++)u=e.hasOwnProperty("$"+t[r].value),t[r].selected!==u&&(t[r].selected=u),u&&o&&(t[r].defaultSelected=!0)}else{for(r=""+ff(r),e=null,u=0;u<t.length;u++){if(t[u].value===r){t[u].selected=!0,o&&(t[u].defaultSelected=!0);return}e!==null||t[u].disabled||(e=t[u])}e!==null&&(e.selected=!0)}}function SR(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(an(91));return gs({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function EN(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(an(92));if(ov(r)){if(1<r.length)throw Error(an(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:ff(r)}}function YV(t,e){var r=ff(e.value),o=ff(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),o!=null&&(t.defaultValue=""+o)}function SN(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function QV(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function IR(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?QV(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var hw,JV=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,o,u){MSApp.execUnsafeLocalFunction(function(){return t(e,r,o,u)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(hw=hw||document.createElement("div"),hw.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=hw.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Kv(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var bv={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},KK=["Webkit","ms","Moz","O"];Object.keys(bv).forEach(function(t){KK.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),bv[e]=bv[t]})});function ej(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||bv.hasOwnProperty(t)&&bv[t]?(""+e).trim():e+"px"}function tj(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var o=r.indexOf("--")===0,u=ej(r,e[r],o);r==="float"&&(r="cssFloat"),o?t.setProperty(r,u):t[r]=u}}var YK=gs({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function AR(t,e){if(e){if(YK[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(an(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(an(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(an(61))}if(e.style!=null&&typeof e.style!="object")throw Error(an(62))}}function CR(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var PR=null;function Yk(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var RR=null,h_=null,d_=null;function IN(t){if(t=Ux(t)){if(typeof RR!="function")throw Error(an(280));var e=t.stateNode;e&&(e=JE(e),RR(t.stateNode,t.type,e))}}function nj(t){h_?d_?d_.push(t):d_=[t]:h_=t}function rj(){if(h_){var t=h_,e=d_;if(d_=h_=null,IN(t),e)for(t=0;t<e.length;t++)IN(e[t])}}function ij(t,e){return t(e)}function sj(){}var tP=!1;function oj(t,e,r){if(tP)return t(e,r);tP=!0;try{return ij(t,e,r)}finally{tP=!1,(h_!==null||d_!==null)&&(sj(),rj())}}function Yv(t,e){var r=t.stateNode;if(r===null)return null;var o=JE(r);if(o===null)return null;r=o[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(t=t.type,o=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!o;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(an(231,e,typeof r));return r}var MR=!1;if(Eh)try{var U0={};Object.defineProperty(U0,"passive",{get:function(){MR=!0}}),window.addEventListener("test",U0,U0),window.removeEventListener("test",U0,U0)}catch{MR=!1}function QK(t,e,r,o,u,f,y,T,a){var A=Array.prototype.slice.call(arguments,3);try{e.apply(r,A)}catch(D){this.onError(D)}}var wv=!1,kT=null,DT=!1,kR=null,JK={onError:function(t){wv=!0,kT=t}};function eY(t,e,r,o,u,f,y,T,a){wv=!1,kT=null,QK.apply(JK,arguments)}function tY(t,e,r,o,u,f,y,T,a){if(eY.apply(this,arguments),wv){if(wv){var A=kT;wv=!1,kT=null}else throw Error(an(198));DT||(DT=!0,kR=A)}}function pm(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function aj(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function AN(t){if(pm(t)!==t)throw Error(an(188))}function nY(t){var e=t.alternate;if(!e){if(e=pm(t),e===null)throw Error(an(188));return e!==t?null:t}for(var r=t,o=e;;){var u=r.return;if(u===null)break;var f=u.alternate;if(f===null){if(o=u.return,o!==null){r=o;continue}break}if(u.child===f.child){for(f=u.child;f;){if(f===r)return AN(u),t;if(f===o)return AN(u),e;f=f.sibling}throw Error(an(188))}if(r.return!==o.return)r=u,o=f;else{for(var y=!1,T=u.child;T;){if(T===r){y=!0,r=u,o=f;break}if(T===o){y=!0,o=u,r=f;break}T=T.sibling}if(!y){for(T=f.child;T;){if(T===r){y=!0,r=f,o=u;break}if(T===o){y=!0,o=f,r=u;break}T=T.sibling}if(!y)throw Error(an(189))}}if(r.alternate!==o)throw Error(an(190))}if(r.tag!==3)throw Error(an(188));return r.stateNode.current===r?t:e}function lj(t){return t=nY(t),t!==null?cj(t):null}function cj(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=cj(t);if(e!==null)return e;t=t.sibling}return null}var uj=cl.unstable_scheduleCallback,CN=cl.unstable_cancelCallback,rY=cl.unstable_shouldYield,iY=cl.unstable_requestPaint,Ls=cl.unstable_now,sY=cl.unstable_getCurrentPriorityLevel,Qk=cl.unstable_ImmediatePriority,hj=cl.unstable_UserBlockingPriority,OT=cl.unstable_NormalPriority,oY=cl.unstable_LowPriority,dj=cl.unstable_IdlePriority,XE=null,yu=null;function aY(t){if(yu&&typeof yu.onCommitFiberRoot=="function")try{yu.onCommitFiberRoot(XE,t,void 0,(t.current.flags&128)===128)}catch{}}var Ec=Math.clz32?Math.clz32:uY,lY=Math.log,cY=Math.LN2;function uY(t){return t>>>=0,t===0?32:31-(lY(t)/cY|0)|0}var dw=64,fw=4194304;function av(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function LT(t,e){var r=t.pendingLanes;if(r===0)return 0;var o=0,u=t.suspendedLanes,f=t.pingedLanes,y=r&268435455;if(y!==0){var T=y&~u;T!==0?o=av(T):(f&=y,f!==0&&(o=av(f)))}else y=r&~u,y!==0?o=av(y):f!==0&&(o=av(f));if(o===0)return 0;if(e!==0&&e!==o&&!(e&u)&&(u=o&-o,f=e&-e,u>=f||u===16&&(f&4194240)!==0))return e;if(o&4&&(o|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=o;0<e;)r=31-Ec(e),u=1<<r,o|=t[r],e&=~u;return o}function hY(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dY(t,e){for(var r=t.suspendedLanes,o=t.pingedLanes,u=t.expirationTimes,f=t.pendingLanes;0<f;){var y=31-Ec(f),T=1<<y,a=u[y];a===-1?(!(T&r)||T&o)&&(u[y]=hY(T,e)):a<=e&&(t.expiredLanes|=T),f&=~T}}function DR(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function fj(){var t=dw;return dw<<=1,!(dw&4194240)&&(dw=64),t}function nP(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function Fx(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ec(e),t[e]=r}function fY(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var o=t.eventTimes;for(t=t.expirationTimes;0<r;){var u=31-Ec(r),f=1<<u;e[u]=0,o[u]=-1,t[u]=-1,r&=~f}}function Jk(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var o=31-Ec(r),u=1<<o;u&e|t[o]&e&&(t[o]|=e),r&=~u}}var xi=0;function pj(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var mj,e3,gj,_j,yj,OR=!1,pw=[],Jd=null,ef=null,tf=null,Qv=new Map,Jv=new Map,Bd=[],pY="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function PN(t,e){switch(t){case"focusin":case"focusout":Jd=null;break;case"dragenter":case"dragleave":ef=null;break;case"mouseover":case"mouseout":tf=null;break;case"pointerover":case"pointerout":Qv.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jv.delete(e.pointerId)}}function V0(t,e,r,o,u,f){return t===null||t.nativeEvent!==f?(t={blockedOn:e,domEventName:r,eventSystemFlags:o,nativeEvent:f,targetContainers:[u]},e!==null&&(e=Ux(e),e!==null&&e3(e)),t):(t.eventSystemFlags|=o,e=t.targetContainers,u!==null&&e.indexOf(u)===-1&&e.push(u),t)}function mY(t,e,r,o,u){switch(e){case"focusin":return Jd=V0(Jd,t,e,r,o,u),!0;case"dragenter":return ef=V0(ef,t,e,r,o,u),!0;case"mouseover":return tf=V0(tf,t,e,r,o,u),!0;case"pointerover":var f=u.pointerId;return Qv.set(f,V0(Qv.get(f)||null,t,e,r,o,u)),!0;case"gotpointercapture":return f=u.pointerId,Jv.set(f,V0(Jv.get(f)||null,t,e,r,o,u)),!0}return!1}function vj(t){var e=Op(t.target);if(e!==null){var r=pm(e);if(r!==null){if(e=r.tag,e===13){if(e=aj(r),e!==null){t.blockedOn=e,yj(t.priority,function(){gj(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Yw(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=LR(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var o=new r.constructor(r.type,r);PR=o,r.target.dispatchEvent(o),PR=null}else return e=Ux(r),e!==null&&e3(e),t.blockedOn=r,!1;e.shift()}return!0}function RN(t,e,r){Yw(t)&&r.delete(e)}function gY(){OR=!1,Jd!==null&&Yw(Jd)&&(Jd=null),ef!==null&&Yw(ef)&&(ef=null),tf!==null&&Yw(tf)&&(tf=null),Qv.forEach(RN),Jv.forEach(RN)}function j0(t,e){t.blockedOn===e&&(t.blockedOn=null,OR||(OR=!0,cl.unstable_scheduleCallback(cl.unstable_NormalPriority,gY)))}function ex(t){function e(u){return j0(u,t)}if(0<pw.length){j0(pw[0],t);for(var r=1;r<pw.length;r++){var o=pw[r];o.blockedOn===t&&(o.blockedOn=null)}}for(Jd!==null&&j0(Jd,t),ef!==null&&j0(ef,t),tf!==null&&j0(tf,t),Qv.forEach(e),Jv.forEach(e),r=0;r<Bd.length;r++)o=Bd[r],o.blockedOn===t&&(o.blockedOn=null);for(;0<Bd.length&&(r=Bd[0],r.blockedOn===null);)vj(r),r.blockedOn===null&&Bd.shift()}var f_=Fh.ReactCurrentBatchConfig,zT=!0;function _Y(t,e,r,o){var u=xi,f=f_.transition;f_.transition=null;try{xi=1,t3(t,e,r,o)}finally{xi=u,f_.transition=f}}function yY(t,e,r,o){var u=xi,f=f_.transition;f_.transition=null;try{xi=4,t3(t,e,r,o)}finally{xi=u,f_.transition=f}}function t3(t,e,r,o){if(zT){var u=LR(t,e,r,o);if(u===null)dP(t,e,o,NT,r),PN(t,o);else if(mY(u,t,e,r,o))o.stopPropagation();else if(PN(t,o),e&4&&-1<pY.indexOf(t)){for(;u!==null;){var f=Ux(u);if(f!==null&&mj(f),f=LR(t,e,r,o),f===null&&dP(t,e,o,NT,r),f===u)break;u=f}u!==null&&o.stopPropagation()}else dP(t,e,o,null,r)}}var NT=null;function LR(t,e,r,o){if(NT=null,t=Yk(o),t=Op(t),t!==null)if(e=pm(t),e===null)t=null;else if(r=e.tag,r===13){if(t=aj(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return NT=t,null}function xj(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(sY()){case Qk:return 1;case hj:return 4;case OT:case oY:return 16;case dj:return 536870912;default:return 16}default:return 16}}var Wd=null,n3=null,Qw=null;function bj(){if(Qw)return Qw;var t,e=n3,r=e.length,o,u="value"in Wd?Wd.value:Wd.textContent,f=u.length;for(t=0;t<r&&e[t]===u[t];t++);var y=r-t;for(o=1;o<=y&&e[r-o]===u[f-o];o++);return Qw=u.slice(t,1<o?1-o:void 0)}function Jw(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function mw(){return!0}function MN(){return!1}function hl(t){function e(r,o,u,f,y){this._reactName=r,this._targetInst=u,this.type=o,this.nativeEvent=f,this.target=y,this.currentTarget=null;for(var T in t)t.hasOwnProperty(T)&&(r=t[T],this[T]=r?r(f):f[T]);return this.isDefaultPrevented=(f.defaultPrevented!=null?f.defaultPrevented:f.returnValue===!1)?mw:MN,this.isPropagationStopped=MN,this}return gs(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=mw)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=mw)},persist:function(){},isPersistent:mw}),e}var ty={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},r3=hl(ty),Bx=gs({},ty,{view:0,detail:0}),vY=hl(Bx),rP,iP,$0,KE=gs({},Bx,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:i3,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==$0&&($0&&t.type==="mousemove"?(rP=t.screenX-$0.screenX,iP=t.screenY-$0.screenY):iP=rP=0,$0=t),rP)},movementY:function(t){return"movementY"in t?t.movementY:iP}}),kN=hl(KE),xY=gs({},KE,{dataTransfer:0}),bY=hl(xY),wY=gs({},Bx,{relatedTarget:0}),sP=hl(wY),TY=gs({},ty,{animationName:0,elapsedTime:0,pseudoElement:0}),EY=hl(TY),SY=gs({},ty,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),IY=hl(SY),AY=gs({},ty,{data:0}),DN=hl(AY),CY={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},PY={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},RY={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function MY(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=RY[t])?!!e[t]:!1}function i3(){return MY}var kY=gs({},Bx,{key:function(t){if(t.key){var e=CY[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Jw(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?PY[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:i3,charCode:function(t){return t.type==="keypress"?Jw(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Jw(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),DY=hl(kY),OY=gs({},KE,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ON=hl(OY),LY=gs({},Bx,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:i3}),zY=hl(LY),NY=gs({},ty,{propertyName:0,elapsedTime:0,pseudoElement:0}),FY=hl(NY),BY=gs({},KE,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),UY=hl(BY),VY=[9,13,27,32],s3=Eh&&"CompositionEvent"in window,Tv=null;Eh&&"documentMode"in document&&(Tv=document.documentMode);var jY=Eh&&"TextEvent"in window&&!Tv,wj=Eh&&(!s3||Tv&&8<Tv&&11>=Tv),LN=" ",zN=!1;function Tj(t,e){switch(t){case"keyup":return VY.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ej(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Zg=!1;function $Y(t,e){switch(t){case"compositionend":return Ej(e);case"keypress":return e.which!==32?null:(zN=!0,LN);case"textInput":return t=e.data,t===LN&&zN?null:t;default:return null}}function GY(t,e){if(Zg)return t==="compositionend"||!s3&&Tj(t,e)?(t=bj(),Qw=n3=Wd=null,Zg=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return wj&&e.locale!=="ko"?null:e.data;default:return null}}var qY={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function NN(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!qY[t.type]:e==="textarea"}function Sj(t,e,r,o){nj(o),e=FT(e,"onChange"),0<e.length&&(r=new r3("onChange","change",null,r,o),t.push({event:r,listeners:e}))}var Ev=null,tx=null;function WY(t){zj(t,0)}function YE(t){var e=Yg(t);if(XV(e))return t}function HY(t,e){if(t==="change")return e}var Ij=!1;if(Eh){var oP;if(Eh){var aP="oninput"in document;if(!aP){var FN=document.createElement("div");FN.setAttribute("oninput","return;"),aP=typeof FN.oninput=="function"}oP=aP}else oP=!1;Ij=oP&&(!document.documentMode||9<document.documentMode)}function BN(){Ev&&(Ev.detachEvent("onpropertychange",Aj),tx=Ev=null)}function Aj(t){if(t.propertyName==="value"&&YE(tx)){var e=[];Sj(e,tx,t,Yk(t)),oj(WY,e)}}function ZY(t,e,r){t==="focusin"?(BN(),Ev=e,tx=r,Ev.attachEvent("onpropertychange",Aj)):t==="focusout"&&BN()}function XY(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return YE(tx)}function KY(t,e){if(t==="click")return YE(e)}function YY(t,e){if(t==="input"||t==="change")return YE(e)}function QY(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ac=typeof Object.is=="function"?Object.is:QY;function nx(t,e){if(Ac(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(o=0;o<r.length;o++){var u=r[o];if(!_R.call(e,u)||!Ac(t[u],e[u]))return!1}return!0}function UN(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function VN(t,e){var r=UN(t);t=0;for(var o;r;){if(r.nodeType===3){if(o=t+r.textContent.length,t<=e&&o>=e)return{node:r,offset:e-t};t=o}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=UN(r)}}function Cj(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Cj(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Pj(){for(var t=window,e=MT();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=MT(t.document)}return e}function o3(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function JY(t){var e=Pj(),r=t.focusedElem,o=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&Cj(r.ownerDocument.documentElement,r)){if(o!==null&&o3(r)){if(e=o.start,t=o.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var u=r.textContent.length,f=Math.min(o.start,u);o=o.end===void 0?f:Math.min(o.end,u),!t.extend&&f>o&&(u=o,o=f,f=u),u=VN(r,f);var y=VN(r,o);u&&y&&(t.rangeCount!==1||t.anchorNode!==u.node||t.anchorOffset!==u.offset||t.focusNode!==y.node||t.focusOffset!==y.offset)&&(e=e.createRange(),e.setStart(u.node,u.offset),t.removeAllRanges(),f>o?(t.addRange(e),t.extend(y.node,y.offset)):(e.setEnd(y.node,y.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var eQ=Eh&&"documentMode"in document&&11>=document.documentMode,Xg=null,zR=null,Sv=null,NR=!1;function jN(t,e,r){var o=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;NR||Xg==null||Xg!==MT(o)||(o=Xg,"selectionStart"in o&&o3(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),Sv&&nx(Sv,o)||(Sv=o,o=FT(zR,"onSelect"),0<o.length&&(e=new r3("onSelect","select",null,e,r),t.push({event:e,listeners:o}),e.target=Xg)))}function gw(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var Kg={animationend:gw("Animation","AnimationEnd"),animationiteration:gw("Animation","AnimationIteration"),animationstart:gw("Animation","AnimationStart"),transitionend:gw("Transition","TransitionEnd")},lP={},Rj={};Eh&&(Rj=document.createElement("div").style,"AnimationEvent"in window||(delete Kg.animationend.animation,delete Kg.animationiteration.animation,delete Kg.animationstart.animation),"TransitionEvent"in window||delete Kg.transitionend.transition);function QE(t){if(lP[t])return lP[t];if(!Kg[t])return t;var e=Kg[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in Rj)return lP[t]=e[r];return t}var Mj=QE("animationend"),kj=QE("animationiteration"),Dj=QE("animationstart"),Oj=QE("transitionend"),Lj=new Map,$N="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Tf(t,e){Lj.set(t,e),fm(e,[t])}for(var cP=0;cP<$N.length;cP++){var uP=$N[cP],tQ=uP.toLowerCase(),nQ=uP[0].toUpperCase()+uP.slice(1);Tf(tQ,"on"+nQ)}Tf(Mj,"onAnimationEnd");Tf(kj,"onAnimationIteration");Tf(Dj,"onAnimationStart");Tf("dblclick","onDoubleClick");Tf("focusin","onFocus");Tf("focusout","onBlur");Tf(Oj,"onTransitionEnd");I_("onMouseEnter",["mouseout","mouseover"]);I_("onMouseLeave",["mouseout","mouseover"]);I_("onPointerEnter",["pointerout","pointerover"]);I_("onPointerLeave",["pointerout","pointerover"]);fm("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fm("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fm("onBeforeInput",["compositionend","keypress","textInput","paste"]);fm("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fm("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fm("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lv="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rQ=new Set("cancel close invalid load scroll toggle".split(" ").concat(lv));function GN(t,e,r){var o=t.type||"unknown-event";t.currentTarget=r,tY(o,e,void 0,t),t.currentTarget=null}function zj(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var o=t[r],u=o.event;o=o.listeners;e:{var f=void 0;if(e)for(var y=o.length-1;0<=y;y--){var T=o[y],a=T.instance,A=T.currentTarget;if(T=T.listener,a!==f&&u.isPropagationStopped())break e;GN(u,T,A),f=a}else for(y=0;y<o.length;y++){if(T=o[y],a=T.instance,A=T.currentTarget,T=T.listener,a!==f&&u.isPropagationStopped())break e;GN(u,T,A),f=a}}}if(DT)throw t=kR,DT=!1,kR=null,t}function qi(t,e){var r=e[jR];r===void 0&&(r=e[jR]=new Set);var o=t+"__bubble";r.has(o)||(Nj(e,t,2,!1),r.add(o))}function hP(t,e,r){var o=0;e&&(o|=4),Nj(r,t,o,e)}var _w="_reactListening"+Math.random().toString(36).slice(2);function rx(t){if(!t[_w]){t[_w]=!0,GV.forEach(function(r){r!=="selectionchange"&&(rQ.has(r)||hP(r,!1,t),hP(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[_w]||(e[_w]=!0,hP("selectionchange",!1,e))}}function Nj(t,e,r,o){switch(xj(e)){case 1:var u=_Y;break;case 4:u=yY;break;default:u=t3}r=u.bind(null,e,r,t),u=void 0,!MR||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(u=!0),o?u!==void 0?t.addEventListener(e,r,{capture:!0,passive:u}):t.addEventListener(e,r,!0):u!==void 0?t.addEventListener(e,r,{passive:u}):t.addEventListener(e,r,!1)}function dP(t,e,r,o,u){var f=o;if(!(e&1)&&!(e&2)&&o!==null)e:for(;;){if(o===null)return;var y=o.tag;if(y===3||y===4){var T=o.stateNode.containerInfo;if(T===u||T.nodeType===8&&T.parentNode===u)break;if(y===4)for(y=o.return;y!==null;){var a=y.tag;if((a===3||a===4)&&(a=y.stateNode.containerInfo,a===u||a.nodeType===8&&a.parentNode===u))return;y=y.return}for(;T!==null;){if(y=Op(T),y===null)return;if(a=y.tag,a===5||a===6){o=f=y;continue e}T=T.parentNode}}o=o.return}oj(function(){var A=f,D=Yk(r),O=[];e:{var B=Lj.get(t);if(B!==void 0){var H=r3,Q=t;switch(t){case"keypress":if(Jw(r)===0)break e;case"keydown":case"keyup":H=DY;break;case"focusin":Q="focus",H=sP;break;case"focusout":Q="blur",H=sP;break;case"beforeblur":case"afterblur":H=sP;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":H=kN;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":H=bY;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":H=zY;break;case Mj:case kj:case Dj:H=EY;break;case Oj:H=FY;break;case"scroll":H=vY;break;case"wheel":H=UY;break;case"copy":case"cut":case"paste":H=IY;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":H=ON}var re=(e&4)!==0,se=!re&&t==="scroll",G=re?B!==null?B+"Capture":null:B;re=[];for(var Y=A,Z;Y!==null;){Z=Y;var fe=Z.stateNode;if(Z.tag===5&&fe!==null&&(Z=fe,G!==null&&(fe=Yv(Y,G),fe!=null&&re.push(ix(Y,fe,Z)))),se)break;Y=Y.return}0<re.length&&(B=new H(B,Q,null,r,D),O.push({event:B,listeners:re}))}}if(!(e&7)){e:{if(B=t==="mouseover"||t==="pointerover",H=t==="mouseout"||t==="pointerout",B&&r!==PR&&(Q=r.relatedTarget||r.fromElement)&&(Op(Q)||Q[Sh]))break e;if((H||B)&&(B=D.window===D?D:(B=D.ownerDocument)?B.defaultView||B.parentWindow:window,H?(Q=r.relatedTarget||r.toElement,H=A,Q=Q?Op(Q):null,Q!==null&&(se=pm(Q),Q!==se||Q.tag!==5&&Q.tag!==6)&&(Q=null)):(H=null,Q=A),H!==Q)){if(re=kN,fe="onMouseLeave",G="onMouseEnter",Y="mouse",(t==="pointerout"||t==="pointerover")&&(re=ON,fe="onPointerLeave",G="onPointerEnter",Y="pointer"),se=H==null?B:Yg(H),Z=Q==null?B:Yg(Q),B=new re(fe,Y+"leave",H,r,D),B.target=se,B.relatedTarget=Z,fe=null,Op(D)===A&&(re=new re(G,Y+"enter",Q,r,D),re.target=Z,re.relatedTarget=se,fe=re),se=fe,H&&Q)t:{for(re=H,G=Q,Y=0,Z=re;Z;Z=Pg(Z))Y++;for(Z=0,fe=G;fe;fe=Pg(fe))Z++;for(;0<Y-Z;)re=Pg(re),Y--;for(;0<Z-Y;)G=Pg(G),Z--;for(;Y--;){if(re===G||G!==null&&re===G.alternate)break t;re=Pg(re),G=Pg(G)}re=null}else re=null;H!==null&&qN(O,B,H,re,!1),Q!==null&&se!==null&&qN(O,se,Q,re,!0)}}e:{if(B=A?Yg(A):window,H=B.nodeName&&B.nodeName.toLowerCase(),H==="select"||H==="input"&&B.type==="file")var Te=HY;else if(NN(B))if(Ij)Te=YY;else{Te=XY;var Pe=ZY}else(H=B.nodeName)&&H.toLowerCase()==="input"&&(B.type==="checkbox"||B.type==="radio")&&(Te=KY);if(Te&&(Te=Te(t,A))){Sj(O,Te,r,D);break e}Pe&&Pe(t,B,A),t==="focusout"&&(Pe=B._wrapperState)&&Pe.controlled&&B.type==="number"&&ER(B,"number",B.value)}switch(Pe=A?Yg(A):window,t){case"focusin":(NN(Pe)||Pe.contentEditable==="true")&&(Xg=Pe,zR=A,Sv=null);break;case"focusout":Sv=zR=Xg=null;break;case"mousedown":NR=!0;break;case"contextmenu":case"mouseup":case"dragend":NR=!1,jN(O,r,D);break;case"selectionchange":if(eQ)break;case"keydown":case"keyup":jN(O,r,D)}var ce;if(s3)e:{switch(t){case"compositionstart":var he="onCompositionStart";break e;case"compositionend":he="onCompositionEnd";break e;case"compositionupdate":he="onCompositionUpdate";break e}he=void 0}else Zg?Tj(t,r)&&(he="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(he="onCompositionStart");he&&(wj&&r.locale!=="ko"&&(Zg||he!=="onCompositionStart"?he==="onCompositionEnd"&&Zg&&(ce=bj()):(Wd=D,n3="value"in Wd?Wd.value:Wd.textContent,Zg=!0)),Pe=FT(A,he),0<Pe.length&&(he=new DN(he,t,null,r,D),O.push({event:he,listeners:Pe}),ce?he.data=ce:(ce=Ej(r),ce!==null&&(he.data=ce)))),(ce=jY?$Y(t,r):GY(t,r))&&(A=FT(A,"onBeforeInput"),0<A.length&&(D=new DN("onBeforeInput","beforeinput",null,r,D),O.push({event:D,listeners:A}),D.data=ce))}zj(O,e)})}function ix(t,e,r){return{instance:t,listener:e,currentTarget:r}}function FT(t,e){for(var r=e+"Capture",o=[];t!==null;){var u=t,f=u.stateNode;u.tag===5&&f!==null&&(u=f,f=Yv(t,r),f!=null&&o.unshift(ix(t,f,u)),f=Yv(t,e),f!=null&&o.push(ix(t,f,u))),t=t.return}return o}function Pg(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function qN(t,e,r,o,u){for(var f=e._reactName,y=[];r!==null&&r!==o;){var T=r,a=T.alternate,A=T.stateNode;if(a!==null&&a===o)break;T.tag===5&&A!==null&&(T=A,u?(a=Yv(r,f),a!=null&&y.unshift(ix(r,a,T))):u||(a=Yv(r,f),a!=null&&y.push(ix(r,a,T)))),r=r.return}y.length!==0&&t.push({event:e,listeners:y})}var iQ=/\r\n?/g,sQ=/\u0000|\uFFFD/g;function WN(t){return(typeof t=="string"?t:""+t).replace(iQ,`
`).replace(sQ,"")}function yw(t,e,r){if(e=WN(e),WN(t)!==e&&r)throw Error(an(425))}function BT(){}var FR=null,BR=null;function UR(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var VR=typeof setTimeout=="function"?setTimeout:void 0,oQ=typeof clearTimeout=="function"?clearTimeout:void 0,HN=typeof Promise=="function"?Promise:void 0,aQ=typeof queueMicrotask=="function"?queueMicrotask:typeof HN<"u"?function(t){return HN.resolve(null).then(t).catch(lQ)}:VR;function lQ(t){setTimeout(function(){throw t})}function fP(t,e){var r=e,o=0;do{var u=r.nextSibling;if(t.removeChild(r),u&&u.nodeType===8)if(r=u.data,r==="/$"){if(o===0){t.removeChild(u),ex(e);return}o--}else r!=="$"&&r!=="$?"&&r!=="$!"||o++;r=u}while(r);ex(e)}function nf(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function ZN(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var ny=Math.random().toString(36).slice(2),fu="__reactFiber$"+ny,sx="__reactProps$"+ny,Sh="__reactContainer$"+ny,jR="__reactEvents$"+ny,cQ="__reactListeners$"+ny,uQ="__reactHandles$"+ny;function Op(t){var e=t[fu];if(e)return e;for(var r=t.parentNode;r;){if(e=r[Sh]||r[fu]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=ZN(t);t!==null;){if(r=t[fu])return r;t=ZN(t)}return e}t=r,r=t.parentNode}return null}function Ux(t){return t=t[fu]||t[Sh],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Yg(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(an(33))}function JE(t){return t[sx]||null}var $R=[],Qg=-1;function Ef(t){return{current:t}}function Zi(t){0>Qg||(t.current=$R[Qg],$R[Qg]=null,Qg--)}function Vi(t,e){Qg++,$R[Qg]=t.current,t.current=e}var pf={},Zo=Ef(pf),Oa=Ef(!1),Xp=pf;function A_(t,e){var r=t.type.contextTypes;if(!r)return pf;var o=t.stateNode;if(o&&o.__reactInternalMemoizedUnmaskedChildContext===e)return o.__reactInternalMemoizedMaskedChildContext;var u={},f;for(f in r)u[f]=e[f];return o&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=u),u}function La(t){return t=t.childContextTypes,t!=null}function UT(){Zi(Oa),Zi(Zo)}function XN(t,e,r){if(Zo.current!==pf)throw Error(an(168));Vi(Zo,e),Vi(Oa,r)}function Fj(t,e,r){var o=t.stateNode;if(e=e.childContextTypes,typeof o.getChildContext!="function")return r;o=o.getChildContext();for(var u in o)if(!(u in e))throw Error(an(108,ZK(t)||"Unknown",u));return gs({},r,o)}function VT(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||pf,Xp=Zo.current,Vi(Zo,t),Vi(Oa,Oa.current),!0}function KN(t,e,r){var o=t.stateNode;if(!o)throw Error(an(169));r?(t=Fj(t,e,Xp),o.__reactInternalMemoizedMergedChildContext=t,Zi(Oa),Zi(Zo),Vi(Zo,t)):Zi(Oa),Vi(Oa,r)}var fh=null,eS=!1,pP=!1;function Bj(t){fh===null?fh=[t]:fh.push(t)}function hQ(t){eS=!0,Bj(t)}function Sf(){if(!pP&&fh!==null){pP=!0;var t=0,e=xi;try{var r=fh;for(xi=1;t<r.length;t++){var o=r[t];do o=o(!0);while(o!==null)}fh=null,eS=!1}catch(u){throw fh!==null&&(fh=fh.slice(t+1)),uj(Qk,Sf),u}finally{xi=e,pP=!1}}return null}var Jg=[],e_=0,jT=null,$T=0,Pl=[],Rl=0,Kp=null,mh=1,gh="";function Ip(t,e){Jg[e_++]=$T,Jg[e_++]=jT,jT=t,$T=e}function Uj(t,e,r){Pl[Rl++]=mh,Pl[Rl++]=gh,Pl[Rl++]=Kp,Kp=t;var o=mh;t=gh;var u=32-Ec(o)-1;o&=~(1<<u),r+=1;var f=32-Ec(e)+u;if(30<f){var y=u-u%5;f=(o&(1<<y)-1).toString(32),o>>=y,u-=y,mh=1<<32-Ec(e)+u|r<<u|o,gh=f+t}else mh=1<<f|r<<u|o,gh=t}function a3(t){t.return!==null&&(Ip(t,1),Uj(t,1,0))}function l3(t){for(;t===jT;)jT=Jg[--e_],Jg[e_]=null,$T=Jg[--e_],Jg[e_]=null;for(;t===Kp;)Kp=Pl[--Rl],Pl[Rl]=null,gh=Pl[--Rl],Pl[Rl]=null,mh=Pl[--Rl],Pl[Rl]=null}var il=null,Ja=null,os=!1,bc=null;function Vj(t,e){var r=zl(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function YN(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,il=t,Ja=nf(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,il=t,Ja=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=Kp!==null?{id:mh,overflow:gh}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=zl(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,il=t,Ja=null,!0):!1;default:return!1}}function GR(t){return(t.mode&1)!==0&&(t.flags&128)===0}function qR(t){if(os){var e=Ja;if(e){var r=e;if(!YN(t,e)){if(GR(t))throw Error(an(418));e=nf(r.nextSibling);var o=il;e&&YN(t,e)?Vj(o,r):(t.flags=t.flags&-4097|2,os=!1,il=t)}}else{if(GR(t))throw Error(an(418));t.flags=t.flags&-4097|2,os=!1,il=t}}}function QN(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;il=t}function vw(t){if(t!==il)return!1;if(!os)return QN(t),os=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!UR(t.type,t.memoizedProps)),e&&(e=Ja)){if(GR(t))throw jj(),Error(an(418));for(;e;)Vj(t,e),e=nf(e.nextSibling)}if(QN(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(an(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){Ja=nf(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}Ja=null}}else Ja=il?nf(t.stateNode.nextSibling):null;return!0}function jj(){for(var t=Ja;t;)t=nf(t.nextSibling)}function C_(){Ja=il=null,os=!1}function c3(t){bc===null?bc=[t]:bc.push(t)}var dQ=Fh.ReactCurrentBatchConfig;function G0(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(an(309));var o=r.stateNode}if(!o)throw Error(an(147,t));var u=o,f=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===f?e.ref:(e=function(y){var T=u.refs;y===null?delete T[f]:T[f]=y},e._stringRef=f,e)}if(typeof t!="string")throw Error(an(284));if(!r._owner)throw Error(an(290,t))}return t}function xw(t,e){throw t=Object.prototype.toString.call(e),Error(an(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function JN(t){var e=t._init;return e(t._payload)}function $j(t){function e(G,Y){if(t){var Z=G.deletions;Z===null?(G.deletions=[Y],G.flags|=16):Z.push(Y)}}function r(G,Y){if(!t)return null;for(;Y!==null;)e(G,Y),Y=Y.sibling;return null}function o(G,Y){for(G=new Map;Y!==null;)Y.key!==null?G.set(Y.key,Y):G.set(Y.index,Y),Y=Y.sibling;return G}function u(G,Y){return G=af(G,Y),G.index=0,G.sibling=null,G}function f(G,Y,Z){return G.index=Z,t?(Z=G.alternate,Z!==null?(Z=Z.index,Z<Y?(G.flags|=2,Y):Z):(G.flags|=2,Y)):(G.flags|=1048576,Y)}function y(G){return t&&G.alternate===null&&(G.flags|=2),G}function T(G,Y,Z,fe){return Y===null||Y.tag!==6?(Y=bP(Z,G.mode,fe),Y.return=G,Y):(Y=u(Y,Z),Y.return=G,Y)}function a(G,Y,Z,fe){var Te=Z.type;return Te===Hg?D(G,Y,Z.props.children,fe,Z.key):Y!==null&&(Y.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===Nd&&JN(Te)===Y.type)?(fe=u(Y,Z.props),fe.ref=G0(G,Y,Z),fe.return=G,fe):(fe=oT(Z.type,Z.key,Z.props,null,G.mode,fe),fe.ref=G0(G,Y,Z),fe.return=G,fe)}function A(G,Y,Z,fe){return Y===null||Y.tag!==4||Y.stateNode.containerInfo!==Z.containerInfo||Y.stateNode.implementation!==Z.implementation?(Y=wP(Z,G.mode,fe),Y.return=G,Y):(Y=u(Y,Z.children||[]),Y.return=G,Y)}function D(G,Y,Z,fe,Te){return Y===null||Y.tag!==7?(Y=Vp(Z,G.mode,fe,Te),Y.return=G,Y):(Y=u(Y,Z),Y.return=G,Y)}function O(G,Y,Z){if(typeof Y=="string"&&Y!==""||typeof Y=="number")return Y=bP(""+Y,G.mode,Z),Y.return=G,Y;if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case cw:return Z=oT(Y.type,Y.key,Y.props,null,G.mode,Z),Z.ref=G0(G,null,Y),Z.return=G,Z;case Wg:return Y=wP(Y,G.mode,Z),Y.return=G,Y;case Nd:var fe=Y._init;return O(G,fe(Y._payload),Z)}if(ov(Y)||B0(Y))return Y=Vp(Y,G.mode,Z,null),Y.return=G,Y;xw(G,Y)}return null}function B(G,Y,Z,fe){var Te=Y!==null?Y.key:null;if(typeof Z=="string"&&Z!==""||typeof Z=="number")return Te!==null?null:T(G,Y,""+Z,fe);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case cw:return Z.key===Te?a(G,Y,Z,fe):null;case Wg:return Z.key===Te?A(G,Y,Z,fe):null;case Nd:return Te=Z._init,B(G,Y,Te(Z._payload),fe)}if(ov(Z)||B0(Z))return Te!==null?null:D(G,Y,Z,fe,null);xw(G,Z)}return null}function H(G,Y,Z,fe,Te){if(typeof fe=="string"&&fe!==""||typeof fe=="number")return G=G.get(Z)||null,T(Y,G,""+fe,Te);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case cw:return G=G.get(fe.key===null?Z:fe.key)||null,a(Y,G,fe,Te);case Wg:return G=G.get(fe.key===null?Z:fe.key)||null,A(Y,G,fe,Te);case Nd:var Pe=fe._init;return H(G,Y,Z,Pe(fe._payload),Te)}if(ov(fe)||B0(fe))return G=G.get(Z)||null,D(Y,G,fe,Te,null);xw(Y,fe)}return null}function Q(G,Y,Z,fe){for(var Te=null,Pe=null,ce=Y,he=Y=0,W=null;ce!==null&&he<Z.length;he++){ce.index>he?(W=ce,ce=null):W=ce.sibling;var ge=B(G,ce,Z[he],fe);if(ge===null){ce===null&&(ce=W);break}t&&ce&&ge.alternate===null&&e(G,ce),Y=f(ge,Y,he),Pe===null?Te=ge:Pe.sibling=ge,Pe=ge,ce=W}if(he===Z.length)return r(G,ce),os&&Ip(G,he),Te;if(ce===null){for(;he<Z.length;he++)ce=O(G,Z[he],fe),ce!==null&&(Y=f(ce,Y,he),Pe===null?Te=ce:Pe.sibling=ce,Pe=ce);return os&&Ip(G,he),Te}for(ce=o(G,ce);he<Z.length;he++)W=H(ce,G,he,Z[he],fe),W!==null&&(t&&W.alternate!==null&&ce.delete(W.key===null?he:W.key),Y=f(W,Y,he),Pe===null?Te=W:Pe.sibling=W,Pe=W);return t&&ce.forEach(function(_e){return e(G,_e)}),os&&Ip(G,he),Te}function re(G,Y,Z,fe){var Te=B0(Z);if(typeof Te!="function")throw Error(an(150));if(Z=Te.call(Z),Z==null)throw Error(an(151));for(var Pe=Te=null,ce=Y,he=Y=0,W=null,ge=Z.next();ce!==null&&!ge.done;he++,ge=Z.next()){ce.index>he?(W=ce,ce=null):W=ce.sibling;var _e=B(G,ce,ge.value,fe);if(_e===null){ce===null&&(ce=W);break}t&&ce&&_e.alternate===null&&e(G,ce),Y=f(_e,Y,he),Pe===null?Te=_e:Pe.sibling=_e,Pe=_e,ce=W}if(ge.done)return r(G,ce),os&&Ip(G,he),Te;if(ce===null){for(;!ge.done;he++,ge=Z.next())ge=O(G,ge.value,fe),ge!==null&&(Y=f(ge,Y,he),Pe===null?Te=ge:Pe.sibling=ge,Pe=ge);return os&&Ip(G,he),Te}for(ce=o(G,ce);!ge.done;he++,ge=Z.next())ge=H(ce,G,he,ge.value,fe),ge!==null&&(t&&ge.alternate!==null&&ce.delete(ge.key===null?he:ge.key),Y=f(ge,Y,he),Pe===null?Te=ge:Pe.sibling=ge,Pe=ge);return t&&ce.forEach(function(Ee){return e(G,Ee)}),os&&Ip(G,he),Te}function se(G,Y,Z,fe){if(typeof Z=="object"&&Z!==null&&Z.type===Hg&&Z.key===null&&(Z=Z.props.children),typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case cw:e:{for(var Te=Z.key,Pe=Y;Pe!==null;){if(Pe.key===Te){if(Te=Z.type,Te===Hg){if(Pe.tag===7){r(G,Pe.sibling),Y=u(Pe,Z.props.children),Y.return=G,G=Y;break e}}else if(Pe.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===Nd&&JN(Te)===Pe.type){r(G,Pe.sibling),Y=u(Pe,Z.props),Y.ref=G0(G,Pe,Z),Y.return=G,G=Y;break e}r(G,Pe);break}else e(G,Pe);Pe=Pe.sibling}Z.type===Hg?(Y=Vp(Z.props.children,G.mode,fe,Z.key),Y.return=G,G=Y):(fe=oT(Z.type,Z.key,Z.props,null,G.mode,fe),fe.ref=G0(G,Y,Z),fe.return=G,G=fe)}return y(G);case Wg:e:{for(Pe=Z.key;Y!==null;){if(Y.key===Pe)if(Y.tag===4&&Y.stateNode.containerInfo===Z.containerInfo&&Y.stateNode.implementation===Z.implementation){r(G,Y.sibling),Y=u(Y,Z.children||[]),Y.return=G,G=Y;break e}else{r(G,Y);break}else e(G,Y);Y=Y.sibling}Y=wP(Z,G.mode,fe),Y.return=G,G=Y}return y(G);case Nd:return Pe=Z._init,se(G,Y,Pe(Z._payload),fe)}if(ov(Z))return Q(G,Y,Z,fe);if(B0(Z))return re(G,Y,Z,fe);xw(G,Z)}return typeof Z=="string"&&Z!==""||typeof Z=="number"?(Z=""+Z,Y!==null&&Y.tag===6?(r(G,Y.sibling),Y=u(Y,Z),Y.return=G,G=Y):(r(G,Y),Y=bP(Z,G.mode,fe),Y.return=G,G=Y),y(G)):r(G,Y)}return se}var P_=$j(!0),Gj=$j(!1),GT=Ef(null),qT=null,t_=null,u3=null;function h3(){u3=t_=qT=null}function d3(t){var e=GT.current;Zi(GT),t._currentValue=e}function WR(t,e,r){for(;t!==null;){var o=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,o!==null&&(o.childLanes|=e)):o!==null&&(o.childLanes&e)!==e&&(o.childLanes|=e),t===r)break;t=t.return}}function p_(t,e){qT=t,u3=t_=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(ka=!0),t.firstContext=null)}function Bl(t){var e=t._currentValue;if(u3!==t)if(t={context:t,memoizedValue:e,next:null},t_===null){if(qT===null)throw Error(an(308));t_=t,qT.dependencies={lanes:0,firstContext:t}}else t_=t_.next=t;return e}var Lp=null;function f3(t){Lp===null?Lp=[t]:Lp.push(t)}function qj(t,e,r,o){var u=e.interleaved;return u===null?(r.next=r,f3(e)):(r.next=u.next,u.next=r),e.interleaved=r,Ih(t,o)}function Ih(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var Fd=!1;function p3(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Wj(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function xh(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function rf(t,e,r){var o=t.updateQueue;if(o===null)return null;if(o=o.shared,ni&2){var u=o.pending;return u===null?e.next=e:(e.next=u.next,u.next=e),o.pending=e,Ih(t,r)}return u=o.interleaved,u===null?(e.next=e,f3(o)):(e.next=u.next,u.next=e),o.interleaved=e,Ih(t,r)}function eT(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var o=e.lanes;o&=t.pendingLanes,r|=o,e.lanes=r,Jk(t,r)}}function eF(t,e){var r=t.updateQueue,o=t.alternate;if(o!==null&&(o=o.updateQueue,r===o)){var u=null,f=null;if(r=r.firstBaseUpdate,r!==null){do{var y={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};f===null?u=f=y:f=f.next=y,r=r.next}while(r!==null);f===null?u=f=e:f=f.next=e}else u=f=e;r={baseState:o.baseState,firstBaseUpdate:u,lastBaseUpdate:f,shared:o.shared,effects:o.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function WT(t,e,r,o){var u=t.updateQueue;Fd=!1;var f=u.firstBaseUpdate,y=u.lastBaseUpdate,T=u.shared.pending;if(T!==null){u.shared.pending=null;var a=T,A=a.next;a.next=null,y===null?f=A:y.next=A,y=a;var D=t.alternate;D!==null&&(D=D.updateQueue,T=D.lastBaseUpdate,T!==y&&(T===null?D.firstBaseUpdate=A:T.next=A,D.lastBaseUpdate=a))}if(f!==null){var O=u.baseState;y=0,D=A=a=null,T=f;do{var B=T.lane,H=T.eventTime;if((o&B)===B){D!==null&&(D=D.next={eventTime:H,lane:0,tag:T.tag,payload:T.payload,callback:T.callback,next:null});e:{var Q=t,re=T;switch(B=e,H=r,re.tag){case 1:if(Q=re.payload,typeof Q=="function"){O=Q.call(H,O,B);break e}O=Q;break e;case 3:Q.flags=Q.flags&-65537|128;case 0:if(Q=re.payload,B=typeof Q=="function"?Q.call(H,O,B):Q,B==null)break e;O=gs({},O,B);break e;case 2:Fd=!0}}T.callback!==null&&T.lane!==0&&(t.flags|=64,B=u.effects,B===null?u.effects=[T]:B.push(T))}else H={eventTime:H,lane:B,tag:T.tag,payload:T.payload,callback:T.callback,next:null},D===null?(A=D=H,a=O):D=D.next=H,y|=B;if(T=T.next,T===null){if(T=u.shared.pending,T===null)break;B=T,T=B.next,B.next=null,u.lastBaseUpdate=B,u.shared.pending=null}}while(!0);if(D===null&&(a=O),u.baseState=a,u.firstBaseUpdate=A,u.lastBaseUpdate=D,e=u.shared.interleaved,e!==null){u=e;do y|=u.lane,u=u.next;while(u!==e)}else f===null&&(u.shared.lanes=0);Qp|=y,t.lanes=y,t.memoizedState=O}}function tF(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var o=t[e],u=o.callback;if(u!==null){if(o.callback=null,o=r,typeof u!="function")throw Error(an(191,u));u.call(o)}}}var Vx={},vu=Ef(Vx),ox=Ef(Vx),ax=Ef(Vx);function zp(t){if(t===Vx)throw Error(an(174));return t}function m3(t,e){switch(Vi(ax,e),Vi(ox,t),Vi(vu,Vx),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:IR(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=IR(e,t)}Zi(vu),Vi(vu,e)}function R_(){Zi(vu),Zi(ox),Zi(ax)}function Hj(t){zp(ax.current);var e=zp(vu.current),r=IR(e,t.type);e!==r&&(Vi(ox,t),Vi(vu,r))}function g3(t){ox.current===t&&(Zi(vu),Zi(ox))}var ps=Ef(0);function HT(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var mP=[];function _3(){for(var t=0;t<mP.length;t++)mP[t]._workInProgressVersionPrimary=null;mP.length=0}var tT=Fh.ReactCurrentDispatcher,gP=Fh.ReactCurrentBatchConfig,Yp=0,ms=null,ro=null,mo=null,ZT=!1,Iv=!1,lx=0,fQ=0;function Fo(){throw Error(an(321))}function y3(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!Ac(t[r],e[r]))return!1;return!0}function v3(t,e,r,o,u,f){if(Yp=f,ms=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,tT.current=t===null||t.memoizedState===null?_Q:yQ,t=r(o,u),Iv){f=0;do{if(Iv=!1,lx=0,25<=f)throw Error(an(301));f+=1,mo=ro=null,e.updateQueue=null,tT.current=vQ,t=r(o,u)}while(Iv)}if(tT.current=XT,e=ro!==null&&ro.next!==null,Yp=0,mo=ro=ms=null,ZT=!1,e)throw Error(an(300));return t}function x3(){var t=lx!==0;return lx=0,t}function au(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return mo===null?ms.memoizedState=mo=t:mo=mo.next=t,mo}function Ul(){if(ro===null){var t=ms.alternate;t=t!==null?t.memoizedState:null}else t=ro.next;var e=mo===null?ms.memoizedState:mo.next;if(e!==null)mo=e,ro=t;else{if(t===null)throw Error(an(310));ro=t,t={memoizedState:ro.memoizedState,baseState:ro.baseState,baseQueue:ro.baseQueue,queue:ro.queue,next:null},mo===null?ms.memoizedState=mo=t:mo=mo.next=t}return mo}function cx(t,e){return typeof e=="function"?e(t):e}function _P(t){var e=Ul(),r=e.queue;if(r===null)throw Error(an(311));r.lastRenderedReducer=t;var o=ro,u=o.baseQueue,f=r.pending;if(f!==null){if(u!==null){var y=u.next;u.next=f.next,f.next=y}o.baseQueue=u=f,r.pending=null}if(u!==null){f=u.next,o=o.baseState;var T=y=null,a=null,A=f;do{var D=A.lane;if((Yp&D)===D)a!==null&&(a=a.next={lane:0,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null}),o=A.hasEagerState?A.eagerState:t(o,A.action);else{var O={lane:D,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null};a===null?(T=a=O,y=o):a=a.next=O,ms.lanes|=D,Qp|=D}A=A.next}while(A!==null&&A!==f);a===null?y=o:a.next=T,Ac(o,e.memoizedState)||(ka=!0),e.memoizedState=o,e.baseState=y,e.baseQueue=a,r.lastRenderedState=o}if(t=r.interleaved,t!==null){u=t;do f=u.lane,ms.lanes|=f,Qp|=f,u=u.next;while(u!==t)}else u===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function yP(t){var e=Ul(),r=e.queue;if(r===null)throw Error(an(311));r.lastRenderedReducer=t;var o=r.dispatch,u=r.pending,f=e.memoizedState;if(u!==null){r.pending=null;var y=u=u.next;do f=t(f,y.action),y=y.next;while(y!==u);Ac(f,e.memoizedState)||(ka=!0),e.memoizedState=f,e.baseQueue===null&&(e.baseState=f),r.lastRenderedState=f}return[f,o]}function Zj(){}function Xj(t,e){var r=ms,o=Ul(),u=e(),f=!Ac(o.memoizedState,u);if(f&&(o.memoizedState=u,ka=!0),o=o.queue,b3(Qj.bind(null,r,o,t),[t]),o.getSnapshot!==e||f||mo!==null&&mo.memoizedState.tag&1){if(r.flags|=2048,ux(9,Yj.bind(null,r,o,u,e),void 0,null),_o===null)throw Error(an(349));Yp&30||Kj(r,e,u)}return u}function Kj(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=ms.updateQueue,e===null?(e={lastEffect:null,stores:null},ms.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function Yj(t,e,r,o){e.value=r,e.getSnapshot=o,Jj(e)&&e$(t)}function Qj(t,e,r){return r(function(){Jj(e)&&e$(t)})}function Jj(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!Ac(t,r)}catch{return!0}}function e$(t){var e=Ih(t,1);e!==null&&Sc(e,t,1,-1)}function nF(t){var e=au();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:cx,lastRenderedState:t},e.queue=t,t=t.dispatch=gQ.bind(null,ms,t),[e.memoizedState,t]}function ux(t,e,r,o){return t={tag:t,create:e,destroy:r,deps:o,next:null},e=ms.updateQueue,e===null?(e={lastEffect:null,stores:null},ms.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(o=r.next,r.next=t,t.next=o,e.lastEffect=t)),t}function t$(){return Ul().memoizedState}function nT(t,e,r,o){var u=au();ms.flags|=t,u.memoizedState=ux(1|e,r,void 0,o===void 0?null:o)}function tS(t,e,r,o){var u=Ul();o=o===void 0?null:o;var f=void 0;if(ro!==null){var y=ro.memoizedState;if(f=y.destroy,o!==null&&y3(o,y.deps)){u.memoizedState=ux(e,r,f,o);return}}ms.flags|=t,u.memoizedState=ux(1|e,r,f,o)}function rF(t,e){return nT(8390656,8,t,e)}function b3(t,e){return tS(2048,8,t,e)}function n$(t,e){return tS(4,2,t,e)}function r$(t,e){return tS(4,4,t,e)}function i$(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function s$(t,e,r){return r=r!=null?r.concat([t]):null,tS(4,4,i$.bind(null,e,t),r)}function w3(){}function o$(t,e){var r=Ul();e=e===void 0?null:e;var o=r.memoizedState;return o!==null&&e!==null&&y3(e,o[1])?o[0]:(r.memoizedState=[t,e],t)}function a$(t,e){var r=Ul();e=e===void 0?null:e;var o=r.memoizedState;return o!==null&&e!==null&&y3(e,o[1])?o[0]:(t=t(),r.memoizedState=[t,e],t)}function l$(t,e,r){return Yp&21?(Ac(r,e)||(r=fj(),ms.lanes|=r,Qp|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,ka=!0),t.memoizedState=r)}function pQ(t,e){var r=xi;xi=r!==0&&4>r?r:4,t(!0);var o=gP.transition;gP.transition={};try{t(!1),e()}finally{xi=r,gP.transition=o}}function c$(){return Ul().memoizedState}function mQ(t,e,r){var o=of(t);if(r={lane:o,action:r,hasEagerState:!1,eagerState:null,next:null},u$(t))h$(e,r);else if(r=qj(t,e,r,o),r!==null){var u=pa();Sc(r,t,o,u),d$(r,e,o)}}function gQ(t,e,r){var o=of(t),u={lane:o,action:r,hasEagerState:!1,eagerState:null,next:null};if(u$(t))h$(e,u);else{var f=t.alternate;if(t.lanes===0&&(f===null||f.lanes===0)&&(f=e.lastRenderedReducer,f!==null))try{var y=e.lastRenderedState,T=f(y,r);if(u.hasEagerState=!0,u.eagerState=T,Ac(T,y)){var a=e.interleaved;a===null?(u.next=u,f3(e)):(u.next=a.next,a.next=u),e.interleaved=u;return}}catch{}finally{}r=qj(t,e,u,o),r!==null&&(u=pa(),Sc(r,t,o,u),d$(r,e,o))}}function u$(t){var e=t.alternate;return t===ms||e!==null&&e===ms}function h$(t,e){Iv=ZT=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function d$(t,e,r){if(r&4194240){var o=e.lanes;o&=t.pendingLanes,r|=o,e.lanes=r,Jk(t,r)}}var XT={readContext:Bl,useCallback:Fo,useContext:Fo,useEffect:Fo,useImperativeHandle:Fo,useInsertionEffect:Fo,useLayoutEffect:Fo,useMemo:Fo,useReducer:Fo,useRef:Fo,useState:Fo,useDebugValue:Fo,useDeferredValue:Fo,useTransition:Fo,useMutableSource:Fo,useSyncExternalStore:Fo,useId:Fo,unstable_isNewReconciler:!1},_Q={readContext:Bl,useCallback:function(t,e){return au().memoizedState=[t,e===void 0?null:e],t},useContext:Bl,useEffect:rF,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,nT(4194308,4,i$.bind(null,e,t),r)},useLayoutEffect:function(t,e){return nT(4194308,4,t,e)},useInsertionEffect:function(t,e){return nT(4,2,t,e)},useMemo:function(t,e){var r=au();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var o=au();return e=r!==void 0?r(e):e,o.memoizedState=o.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},o.queue=t,t=t.dispatch=mQ.bind(null,ms,t),[o.memoizedState,t]},useRef:function(t){var e=au();return t={current:t},e.memoizedState=t},useState:nF,useDebugValue:w3,useDeferredValue:function(t){return au().memoizedState=t},useTransition:function(){var t=nF(!1),e=t[0];return t=pQ.bind(null,t[1]),au().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var o=ms,u=au();if(os){if(r===void 0)throw Error(an(407));r=r()}else{if(r=e(),_o===null)throw Error(an(349));Yp&30||Kj(o,e,r)}u.memoizedState=r;var f={value:r,getSnapshot:e};return u.queue=f,rF(Qj.bind(null,o,f,t),[t]),o.flags|=2048,ux(9,Yj.bind(null,o,f,r,e),void 0,null),r},useId:function(){var t=au(),e=_o.identifierPrefix;if(os){var r=gh,o=mh;r=(o&~(1<<32-Ec(o)-1)).toString(32)+r,e=":"+e+"R"+r,r=lx++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=fQ++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},yQ={readContext:Bl,useCallback:o$,useContext:Bl,useEffect:b3,useImperativeHandle:s$,useInsertionEffect:n$,useLayoutEffect:r$,useMemo:a$,useReducer:_P,useRef:t$,useState:function(){return _P(cx)},useDebugValue:w3,useDeferredValue:function(t){var e=Ul();return l$(e,ro.memoizedState,t)},useTransition:function(){var t=_P(cx)[0],e=Ul().memoizedState;return[t,e]},useMutableSource:Zj,useSyncExternalStore:Xj,useId:c$,unstable_isNewReconciler:!1},vQ={readContext:Bl,useCallback:o$,useContext:Bl,useEffect:b3,useImperativeHandle:s$,useInsertionEffect:n$,useLayoutEffect:r$,useMemo:a$,useReducer:yP,useRef:t$,useState:function(){return yP(cx)},useDebugValue:w3,useDeferredValue:function(t){var e=Ul();return ro===null?e.memoizedState=t:l$(e,ro.memoizedState,t)},useTransition:function(){var t=yP(cx)[0],e=Ul().memoizedState;return[t,e]},useMutableSource:Zj,useSyncExternalStore:Xj,useId:c$,unstable_isNewReconciler:!1};function vc(t,e){if(t&&t.defaultProps){e=gs({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}function HR(t,e,r,o){e=t.memoizedState,r=r(o,e),r=r==null?e:gs({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var nS={isMounted:function(t){return(t=t._reactInternals)?pm(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var o=pa(),u=of(t),f=xh(o,u);f.payload=e,r!=null&&(f.callback=r),e=rf(t,f,u),e!==null&&(Sc(e,t,u,o),eT(e,t,u))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var o=pa(),u=of(t),f=xh(o,u);f.tag=1,f.payload=e,r!=null&&(f.callback=r),e=rf(t,f,u),e!==null&&(Sc(e,t,u,o),eT(e,t,u))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=pa(),o=of(t),u=xh(r,o);u.tag=2,e!=null&&(u.callback=e),e=rf(t,u,o),e!==null&&(Sc(e,t,o,r),eT(e,t,o))}};function iF(t,e,r,o,u,f,y){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(o,f,y):e.prototype&&e.prototype.isPureReactComponent?!nx(r,o)||!nx(u,f):!0}function f$(t,e,r){var o=!1,u=pf,f=e.contextType;return typeof f=="object"&&f!==null?f=Bl(f):(u=La(e)?Xp:Zo.current,o=e.contextTypes,f=(o=o!=null)?A_(t,u):pf),e=new e(r,f),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=nS,t.stateNode=e,e._reactInternals=t,o&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=u,t.__reactInternalMemoizedMaskedChildContext=f),e}function sF(t,e,r,o){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,o),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,o),e.state!==t&&nS.enqueueReplaceState(e,e.state,null)}function ZR(t,e,r,o){var u=t.stateNode;u.props=r,u.state=t.memoizedState,u.refs={},p3(t);var f=e.contextType;typeof f=="object"&&f!==null?u.context=Bl(f):(f=La(e)?Xp:Zo.current,u.context=A_(t,f)),u.state=t.memoizedState,f=e.getDerivedStateFromProps,typeof f=="function"&&(HR(t,e,f,r),u.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(e=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),e!==u.state&&nS.enqueueReplaceState(u,u.state,null),WT(t,r,u,o),u.state=t.memoizedState),typeof u.componentDidMount=="function"&&(t.flags|=4194308)}function M_(t,e){try{var r="",o=e;do r+=HK(o),o=o.return;while(o);var u=r}catch(f){u=`
Error generating stack: `+f.message+`
`+f.stack}return{value:t,source:e,stack:u,digest:null}}function vP(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function XR(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var xQ=typeof WeakMap=="function"?WeakMap:Map;function p$(t,e,r){r=xh(-1,r),r.tag=3,r.payload={element:null};var o=e.value;return r.callback=function(){YT||(YT=!0,sM=o),XR(t,e)},r}function m$(t,e,r){r=xh(-1,r),r.tag=3;var o=t.type.getDerivedStateFromError;if(typeof o=="function"){var u=e.value;r.payload=function(){return o(u)},r.callback=function(){XR(t,e)}}var f=t.stateNode;return f!==null&&typeof f.componentDidCatch=="function"&&(r.callback=function(){XR(t,e),typeof o!="function"&&(sf===null?sf=new Set([this]):sf.add(this));var y=e.stack;this.componentDidCatch(e.value,{componentStack:y!==null?y:""})}),r}function oF(t,e,r){var o=t.pingCache;if(o===null){o=t.pingCache=new xQ;var u=new Set;o.set(e,u)}else u=o.get(e),u===void 0&&(u=new Set,o.set(e,u));u.has(r)||(u.add(r),t=OQ.bind(null,t,e,r),e.then(t,t))}function aF(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function lF(t,e,r,o,u){return t.mode&1?(t.flags|=65536,t.lanes=u,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=xh(-1,1),e.tag=2,rf(r,e,1))),r.lanes|=1),t)}var bQ=Fh.ReactCurrentOwner,ka=!1;function da(t,e,r,o){e.child=t===null?Gj(e,null,r,o):P_(e,t.child,r,o)}function cF(t,e,r,o,u){r=r.render;var f=e.ref;return p_(e,u),o=v3(t,e,r,o,f,u),r=x3(),t!==null&&!ka?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~u,Ah(t,e,u)):(os&&r&&a3(e),e.flags|=1,da(t,e,o,u),e.child)}function uF(t,e,r,o,u){if(t===null){var f=r.type;return typeof f=="function"&&!R3(f)&&f.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=f,g$(t,e,f,o,u)):(t=oT(r.type,null,o,e,e.mode,u),t.ref=e.ref,t.return=e,e.child=t)}if(f=t.child,!(t.lanes&u)){var y=f.memoizedProps;if(r=r.compare,r=r!==null?r:nx,r(y,o)&&t.ref===e.ref)return Ah(t,e,u)}return e.flags|=1,t=af(f,o),t.ref=e.ref,t.return=e,e.child=t}function g$(t,e,r,o,u){if(t!==null){var f=t.memoizedProps;if(nx(f,o)&&t.ref===e.ref)if(ka=!1,e.pendingProps=o=f,(t.lanes&u)!==0)t.flags&131072&&(ka=!0);else return e.lanes=t.lanes,Ah(t,e,u)}return KR(t,e,r,o,u)}function _$(t,e,r){var o=e.pendingProps,u=o.children,f=t!==null?t.memoizedState:null;if(o.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Vi(r_,Ya),Ya|=r;else{if(!(r&1073741824))return t=f!==null?f.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Vi(r_,Ya),Ya|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},o=f!==null?f.baseLanes:r,Vi(r_,Ya),Ya|=o}else f!==null?(o=f.baseLanes|r,e.memoizedState=null):o=r,Vi(r_,Ya),Ya|=o;return da(t,e,u,r),e.child}function y$(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function KR(t,e,r,o,u){var f=La(r)?Xp:Zo.current;return f=A_(e,f),p_(e,u),r=v3(t,e,r,o,f,u),o=x3(),t!==null&&!ka?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~u,Ah(t,e,u)):(os&&o&&a3(e),e.flags|=1,da(t,e,r,u),e.child)}function hF(t,e,r,o,u){if(La(r)){var f=!0;VT(e)}else f=!1;if(p_(e,u),e.stateNode===null)rT(t,e),f$(e,r,o),ZR(e,r,o,u),o=!0;else if(t===null){var y=e.stateNode,T=e.memoizedProps;y.props=T;var a=y.context,A=r.contextType;typeof A=="object"&&A!==null?A=Bl(A):(A=La(r)?Xp:Zo.current,A=A_(e,A));var D=r.getDerivedStateFromProps,O=typeof D=="function"||typeof y.getSnapshotBeforeUpdate=="function";O||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(T!==o||a!==A)&&sF(e,y,o,A),Fd=!1;var B=e.memoizedState;y.state=B,WT(e,o,y,u),a=e.memoizedState,T!==o||B!==a||Oa.current||Fd?(typeof D=="function"&&(HR(e,r,D,o),a=e.memoizedState),(T=Fd||iF(e,r,T,o,B,a,A))?(O||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(e.flags|=4194308)):(typeof y.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=o,e.memoizedState=a),y.props=o,y.state=a,y.context=A,o=T):(typeof y.componentDidMount=="function"&&(e.flags|=4194308),o=!1)}else{y=e.stateNode,Wj(t,e),T=e.memoizedProps,A=e.type===e.elementType?T:vc(e.type,T),y.props=A,O=e.pendingProps,B=y.context,a=r.contextType,typeof a=="object"&&a!==null?a=Bl(a):(a=La(r)?Xp:Zo.current,a=A_(e,a));var H=r.getDerivedStateFromProps;(D=typeof H=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(T!==O||B!==a)&&sF(e,y,o,a),Fd=!1,B=e.memoizedState,y.state=B,WT(e,o,y,u);var Q=e.memoizedState;T!==O||B!==Q||Oa.current||Fd?(typeof H=="function"&&(HR(e,r,H,o),Q=e.memoizedState),(A=Fd||iF(e,r,A,o,B,Q,a)||!1)?(D||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(o,Q,a),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(o,Q,a)),typeof y.componentDidUpdate=="function"&&(e.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof y.componentDidUpdate!="function"||T===t.memoizedProps&&B===t.memoizedState||(e.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||T===t.memoizedProps&&B===t.memoizedState||(e.flags|=1024),e.memoizedProps=o,e.memoizedState=Q),y.props=o,y.state=Q,y.context=a,o=A):(typeof y.componentDidUpdate!="function"||T===t.memoizedProps&&B===t.memoizedState||(e.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||T===t.memoizedProps&&B===t.memoizedState||(e.flags|=1024),o=!1)}return YR(t,e,r,o,f,u)}function YR(t,e,r,o,u,f){y$(t,e);var y=(e.flags&128)!==0;if(!o&&!y)return u&&KN(e,r,!1),Ah(t,e,f);o=e.stateNode,bQ.current=e;var T=y&&typeof r.getDerivedStateFromError!="function"?null:o.render();return e.flags|=1,t!==null&&y?(e.child=P_(e,t.child,null,f),e.child=P_(e,null,T,f)):da(t,e,T,f),e.memoizedState=o.state,u&&KN(e,r,!0),e.child}function v$(t){var e=t.stateNode;e.pendingContext?XN(t,e.pendingContext,e.pendingContext!==e.context):e.context&&XN(t,e.context,!1),m3(t,e.containerInfo)}function dF(t,e,r,o,u){return C_(),c3(u),e.flags|=256,da(t,e,r,o),e.child}var QR={dehydrated:null,treeContext:null,retryLane:0};function JR(t){return{baseLanes:t,cachePool:null,transitions:null}}function x$(t,e,r){var o=e.pendingProps,u=ps.current,f=!1,y=(e.flags&128)!==0,T;if((T=y)||(T=t!==null&&t.memoizedState===null?!1:(u&2)!==0),T?(f=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(u|=1),Vi(ps,u&1),t===null)return qR(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(y=o.children,t=o.fallback,f?(o=e.mode,f=e.child,y={mode:"hidden",children:y},!(o&1)&&f!==null?(f.childLanes=0,f.pendingProps=y):f=sS(y,o,0,null),t=Vp(t,o,r,null),f.return=e,t.return=e,f.sibling=t,e.child=f,e.child.memoizedState=JR(r),e.memoizedState=QR,t):T3(e,y));if(u=t.memoizedState,u!==null&&(T=u.dehydrated,T!==null))return wQ(t,e,y,o,T,u,r);if(f){f=o.fallback,y=e.mode,u=t.child,T=u.sibling;var a={mode:"hidden",children:o.children};return!(y&1)&&e.child!==u?(o=e.child,o.childLanes=0,o.pendingProps=a,e.deletions=null):(o=af(u,a),o.subtreeFlags=u.subtreeFlags&14680064),T!==null?f=af(T,f):(f=Vp(f,y,r,null),f.flags|=2),f.return=e,o.return=e,o.sibling=f,e.child=o,o=f,f=e.child,y=t.child.memoizedState,y=y===null?JR(r):{baseLanes:y.baseLanes|r,cachePool:null,transitions:y.transitions},f.memoizedState=y,f.childLanes=t.childLanes&~r,e.memoizedState=QR,o}return f=t.child,t=f.sibling,o=af(f,{mode:"visible",children:o.children}),!(e.mode&1)&&(o.lanes=r),o.return=e,o.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=o,e.memoizedState=null,o}function T3(t,e){return e=sS({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function bw(t,e,r,o){return o!==null&&c3(o),P_(e,t.child,null,r),t=T3(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function wQ(t,e,r,o,u,f,y){if(r)return e.flags&256?(e.flags&=-257,o=vP(Error(an(422))),bw(t,e,y,o)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(f=o.fallback,u=e.mode,o=sS({mode:"visible",children:o.children},u,0,null),f=Vp(f,u,y,null),f.flags|=2,o.return=e,f.return=e,o.sibling=f,e.child=o,e.mode&1&&P_(e,t.child,null,y),e.child.memoizedState=JR(y),e.memoizedState=QR,f);if(!(e.mode&1))return bw(t,e,y,null);if(u.data==="$!"){if(o=u.nextSibling&&u.nextSibling.dataset,o)var T=o.dgst;return o=T,f=Error(an(419)),o=vP(f,o,void 0),bw(t,e,y,o)}if(T=(y&t.childLanes)!==0,ka||T){if(o=_o,o!==null){switch(y&-y){case 4:u=2;break;case 16:u=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:u=32;break;case 536870912:u=268435456;break;default:u=0}u=u&(o.suspendedLanes|y)?0:u,u!==0&&u!==f.retryLane&&(f.retryLane=u,Ih(t,u),Sc(o,t,u,-1))}return P3(),o=vP(Error(an(421))),bw(t,e,y,o)}return u.data==="$?"?(e.flags|=128,e.child=t.child,e=LQ.bind(null,t),u._reactRetry=e,null):(t=f.treeContext,Ja=nf(u.nextSibling),il=e,os=!0,bc=null,t!==null&&(Pl[Rl++]=mh,Pl[Rl++]=gh,Pl[Rl++]=Kp,mh=t.id,gh=t.overflow,Kp=e),e=T3(e,o.children),e.flags|=4096,e)}function fF(t,e,r){t.lanes|=e;var o=t.alternate;o!==null&&(o.lanes|=e),WR(t.return,e,r)}function xP(t,e,r,o,u){var f=t.memoizedState;f===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:o,tail:r,tailMode:u}:(f.isBackwards=e,f.rendering=null,f.renderingStartTime=0,f.last=o,f.tail=r,f.tailMode=u)}function b$(t,e,r){var o=e.pendingProps,u=o.revealOrder,f=o.tail;if(da(t,e,o.children,r),o=ps.current,o&2)o=o&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&fF(t,r,e);else if(t.tag===19)fF(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}o&=1}if(Vi(ps,o),!(e.mode&1))e.memoizedState=null;else switch(u){case"forwards":for(r=e.child,u=null;r!==null;)t=r.alternate,t!==null&&HT(t)===null&&(u=r),r=r.sibling;r=u,r===null?(u=e.child,e.child=null):(u=r.sibling,r.sibling=null),xP(e,!1,u,r,f);break;case"backwards":for(r=null,u=e.child,e.child=null;u!==null;){if(t=u.alternate,t!==null&&HT(t)===null){e.child=u;break}t=u.sibling,u.sibling=r,r=u,u=t}xP(e,!0,r,null,f);break;case"together":xP(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function rT(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ah(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),Qp|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(an(153));if(e.child!==null){for(t=e.child,r=af(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=af(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function TQ(t,e,r){switch(e.tag){case 3:v$(e),C_();break;case 5:Hj(e);break;case 1:La(e.type)&&VT(e);break;case 4:m3(e,e.stateNode.containerInfo);break;case 10:var o=e.type._context,u=e.memoizedProps.value;Vi(GT,o._currentValue),o._currentValue=u;break;case 13:if(o=e.memoizedState,o!==null)return o.dehydrated!==null?(Vi(ps,ps.current&1),e.flags|=128,null):r&e.child.childLanes?x$(t,e,r):(Vi(ps,ps.current&1),t=Ah(t,e,r),t!==null?t.sibling:null);Vi(ps,ps.current&1);break;case 19:if(o=(r&e.childLanes)!==0,t.flags&128){if(o)return b$(t,e,r);e.flags|=128}if(u=e.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),Vi(ps,ps.current),o)break;return null;case 22:case 23:return e.lanes=0,_$(t,e,r)}return Ah(t,e,r)}var w$,eM,T$,E$;w$=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};eM=function(){};T$=function(t,e,r,o){var u=t.memoizedProps;if(u!==o){t=e.stateNode,zp(vu.current);var f=null;switch(r){case"input":u=wR(t,u),o=wR(t,o),f=[];break;case"select":u=gs({},u,{value:void 0}),o=gs({},o,{value:void 0}),f=[];break;case"textarea":u=SR(t,u),o=SR(t,o),f=[];break;default:typeof u.onClick!="function"&&typeof o.onClick=="function"&&(t.onclick=BT)}AR(r,o);var y;r=null;for(A in u)if(!o.hasOwnProperty(A)&&u.hasOwnProperty(A)&&u[A]!=null)if(A==="style"){var T=u[A];for(y in T)T.hasOwnProperty(y)&&(r||(r={}),r[y]="")}else A!=="dangerouslySetInnerHTML"&&A!=="children"&&A!=="suppressContentEditableWarning"&&A!=="suppressHydrationWarning"&&A!=="autoFocus"&&(Xv.hasOwnProperty(A)?f||(f=[]):(f=f||[]).push(A,null));for(A in o){var a=o[A];if(T=u!=null?u[A]:void 0,o.hasOwnProperty(A)&&a!==T&&(a!=null||T!=null))if(A==="style")if(T){for(y in T)!T.hasOwnProperty(y)||a&&a.hasOwnProperty(y)||(r||(r={}),r[y]="");for(y in a)a.hasOwnProperty(y)&&T[y]!==a[y]&&(r||(r={}),r[y]=a[y])}else r||(f||(f=[]),f.push(A,r)),r=a;else A==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,T=T?T.__html:void 0,a!=null&&T!==a&&(f=f||[]).push(A,a)):A==="children"?typeof a!="string"&&typeof a!="number"||(f=f||[]).push(A,""+a):A!=="suppressContentEditableWarning"&&A!=="suppressHydrationWarning"&&(Xv.hasOwnProperty(A)?(a!=null&&A==="onScroll"&&qi("scroll",t),f||T===a||(f=[])):(f=f||[]).push(A,a))}r&&(f=f||[]).push("style",r);var A=f;(e.updateQueue=A)&&(e.flags|=4)}};E$=function(t,e,r,o){r!==o&&(e.flags|=4)};function q0(t,e){if(!os)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var o=null;r!==null;)r.alternate!==null&&(o=r),r=r.sibling;o===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:o.sibling=null}}function Bo(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,o=0;if(e)for(var u=t.child;u!==null;)r|=u.lanes|u.childLanes,o|=u.subtreeFlags&14680064,o|=u.flags&14680064,u.return=t,u=u.sibling;else for(u=t.child;u!==null;)r|=u.lanes|u.childLanes,o|=u.subtreeFlags,o|=u.flags,u.return=t,u=u.sibling;return t.subtreeFlags|=o,t.childLanes=r,e}function EQ(t,e,r){var o=e.pendingProps;switch(l3(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Bo(e),null;case 1:return La(e.type)&&UT(),Bo(e),null;case 3:return o=e.stateNode,R_(),Zi(Oa),Zi(Zo),_3(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(t===null||t.child===null)&&(vw(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,bc!==null&&(lM(bc),bc=null))),eM(t,e),Bo(e),null;case 5:g3(e);var u=zp(ax.current);if(r=e.type,t!==null&&e.stateNode!=null)T$(t,e,r,o,u),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!o){if(e.stateNode===null)throw Error(an(166));return Bo(e),null}if(t=zp(vu.current),vw(e)){o=e.stateNode,r=e.type;var f=e.memoizedProps;switch(o[fu]=e,o[sx]=f,t=(e.mode&1)!==0,r){case"dialog":qi("cancel",o),qi("close",o);break;case"iframe":case"object":case"embed":qi("load",o);break;case"video":case"audio":for(u=0;u<lv.length;u++)qi(lv[u],o);break;case"source":qi("error",o);break;case"img":case"image":case"link":qi("error",o),qi("load",o);break;case"details":qi("toggle",o);break;case"input":wN(o,f),qi("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!f.multiple},qi("invalid",o);break;case"textarea":EN(o,f),qi("invalid",o)}AR(r,f),u=null;for(var y in f)if(f.hasOwnProperty(y)){var T=f[y];y==="children"?typeof T=="string"?o.textContent!==T&&(f.suppressHydrationWarning!==!0&&yw(o.textContent,T,t),u=["children",T]):typeof T=="number"&&o.textContent!==""+T&&(f.suppressHydrationWarning!==!0&&yw(o.textContent,T,t),u=["children",""+T]):Xv.hasOwnProperty(y)&&T!=null&&y==="onScroll"&&qi("scroll",o)}switch(r){case"input":uw(o),TN(o,f,!0);break;case"textarea":uw(o),SN(o);break;case"select":case"option":break;default:typeof f.onClick=="function"&&(o.onclick=BT)}o=u,e.updateQueue=o,o!==null&&(e.flags|=4)}else{y=u.nodeType===9?u:u.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=QV(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=y.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof o.is=="string"?t=y.createElement(r,{is:o.is}):(t=y.createElement(r),r==="select"&&(y=t,o.multiple?y.multiple=!0:o.size&&(y.size=o.size))):t=y.createElementNS(t,r),t[fu]=e,t[sx]=o,w$(t,e,!1,!1),e.stateNode=t;e:{switch(y=CR(r,o),r){case"dialog":qi("cancel",t),qi("close",t),u=o;break;case"iframe":case"object":case"embed":qi("load",t),u=o;break;case"video":case"audio":for(u=0;u<lv.length;u++)qi(lv[u],t);u=o;break;case"source":qi("error",t),u=o;break;case"img":case"image":case"link":qi("error",t),qi("load",t),u=o;break;case"details":qi("toggle",t),u=o;break;case"input":wN(t,o),u=wR(t,o),qi("invalid",t);break;case"option":u=o;break;case"select":t._wrapperState={wasMultiple:!!o.multiple},u=gs({},o,{value:void 0}),qi("invalid",t);break;case"textarea":EN(t,o),u=SR(t,o),qi("invalid",t);break;default:u=o}AR(r,u),T=u;for(f in T)if(T.hasOwnProperty(f)){var a=T[f];f==="style"?tj(t,a):f==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&JV(t,a)):f==="children"?typeof a=="string"?(r!=="textarea"||a!=="")&&Kv(t,a):typeof a=="number"&&Kv(t,""+a):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(Xv.hasOwnProperty(f)?a!=null&&f==="onScroll"&&qi("scroll",t):a!=null&&Hk(t,f,a,y))}switch(r){case"input":uw(t),TN(t,o,!1);break;case"textarea":uw(t),SN(t);break;case"option":o.value!=null&&t.setAttribute("value",""+ff(o.value));break;case"select":t.multiple=!!o.multiple,f=o.value,f!=null?u_(t,!!o.multiple,f,!1):o.defaultValue!=null&&u_(t,!!o.multiple,o.defaultValue,!0);break;default:typeof u.onClick=="function"&&(t.onclick=BT)}switch(r){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}}o&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Bo(e),null;case 6:if(t&&e.stateNode!=null)E$(t,e,t.memoizedProps,o);else{if(typeof o!="string"&&e.stateNode===null)throw Error(an(166));if(r=zp(ax.current),zp(vu.current),vw(e)){if(o=e.stateNode,r=e.memoizedProps,o[fu]=e,(f=o.nodeValue!==r)&&(t=il,t!==null))switch(t.tag){case 3:yw(o.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&yw(o.nodeValue,r,(t.mode&1)!==0)}f&&(e.flags|=4)}else o=(r.nodeType===9?r:r.ownerDocument).createTextNode(o),o[fu]=e,e.stateNode=o}return Bo(e),null;case 13:if(Zi(ps),o=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(os&&Ja!==null&&e.mode&1&&!(e.flags&128))jj(),C_(),e.flags|=98560,f=!1;else if(f=vw(e),o!==null&&o.dehydrated!==null){if(t===null){if(!f)throw Error(an(318));if(f=e.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(an(317));f[fu]=e}else C_(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Bo(e),f=!1}else bc!==null&&(lM(bc),bc=null),f=!0;if(!f)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(o=o!==null,o!==(t!==null&&t.memoizedState!==null)&&o&&(e.child.flags|=8192,e.mode&1&&(t===null||ps.current&1?so===0&&(so=3):P3())),e.updateQueue!==null&&(e.flags|=4),Bo(e),null);case 4:return R_(),eM(t,e),t===null&&rx(e.stateNode.containerInfo),Bo(e),null;case 10:return d3(e.type._context),Bo(e),null;case 17:return La(e.type)&&UT(),Bo(e),null;case 19:if(Zi(ps),f=e.memoizedState,f===null)return Bo(e),null;if(o=(e.flags&128)!==0,y=f.rendering,y===null)if(o)q0(f,!1);else{if(so!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(y=HT(t),y!==null){for(e.flags|=128,q0(f,!1),o=y.updateQueue,o!==null&&(e.updateQueue=o,e.flags|=4),e.subtreeFlags=0,o=r,r=e.child;r!==null;)f=r,t=o,f.flags&=14680066,y=f.alternate,y===null?(f.childLanes=0,f.lanes=t,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=y.childLanes,f.lanes=y.lanes,f.child=y.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=y.memoizedProps,f.memoizedState=y.memoizedState,f.updateQueue=y.updateQueue,f.type=y.type,t=y.dependencies,f.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return Vi(ps,ps.current&1|2),e.child}t=t.sibling}f.tail!==null&&Ls()>k_&&(e.flags|=128,o=!0,q0(f,!1),e.lanes=4194304)}else{if(!o)if(t=HT(y),t!==null){if(e.flags|=128,o=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),q0(f,!0),f.tail===null&&f.tailMode==="hidden"&&!y.alternate&&!os)return Bo(e),null}else 2*Ls()-f.renderingStartTime>k_&&r!==1073741824&&(e.flags|=128,o=!0,q0(f,!1),e.lanes=4194304);f.isBackwards?(y.sibling=e.child,e.child=y):(r=f.last,r!==null?r.sibling=y:e.child=y,f.last=y)}return f.tail!==null?(e=f.tail,f.rendering=e,f.tail=e.sibling,f.renderingStartTime=Ls(),e.sibling=null,r=ps.current,Vi(ps,o?r&1|2:r&1),e):(Bo(e),null);case 22:case 23:return C3(),o=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==o&&(e.flags|=8192),o&&e.mode&1?Ya&1073741824&&(Bo(e),e.subtreeFlags&6&&(e.flags|=8192)):Bo(e),null;case 24:return null;case 25:return null}throw Error(an(156,e.tag))}function SQ(t,e){switch(l3(e),e.tag){case 1:return La(e.type)&&UT(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return R_(),Zi(Oa),Zi(Zo),_3(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return g3(e),null;case 13:if(Zi(ps),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(an(340));C_()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Zi(ps),null;case 4:return R_(),null;case 10:return d3(e.type._context),null;case 22:case 23:return C3(),null;case 24:return null;default:return null}}var ww=!1,$o=!1,IQ=typeof WeakSet=="function"?WeakSet:Set,kn=null;function n_(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(o){Cs(t,e,o)}else r.current=null}function tM(t,e,r){try{r()}catch(o){Cs(t,e,o)}}var pF=!1;function AQ(t,e){if(FR=zT,t=Pj(),o3(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var o=r.getSelection&&r.getSelection();if(o&&o.rangeCount!==0){r=o.anchorNode;var u=o.anchorOffset,f=o.focusNode;o=o.focusOffset;try{r.nodeType,f.nodeType}catch{r=null;break e}var y=0,T=-1,a=-1,A=0,D=0,O=t,B=null;t:for(;;){for(var H;O!==r||u!==0&&O.nodeType!==3||(T=y+u),O!==f||o!==0&&O.nodeType!==3||(a=y+o),O.nodeType===3&&(y+=O.nodeValue.length),(H=O.firstChild)!==null;)B=O,O=H;for(;;){if(O===t)break t;if(B===r&&++A===u&&(T=y),B===f&&++D===o&&(a=y),(H=O.nextSibling)!==null)break;O=B,B=O.parentNode}O=H}r=T===-1||a===-1?null:{start:T,end:a}}else r=null}r=r||{start:0,end:0}}else r=null;for(BR={focusedElem:t,selectionRange:r},zT=!1,kn=e;kn!==null;)if(e=kn,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,kn=t;else for(;kn!==null;){e=kn;try{var Q=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(Q!==null){var re=Q.memoizedProps,se=Q.memoizedState,G=e.stateNode,Y=G.getSnapshotBeforeUpdate(e.elementType===e.type?re:vc(e.type,re),se);G.__reactInternalSnapshotBeforeUpdate=Y}break;case 3:var Z=e.stateNode.containerInfo;Z.nodeType===1?Z.textContent="":Z.nodeType===9&&Z.documentElement&&Z.removeChild(Z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(an(163))}}catch(fe){Cs(e,e.return,fe)}if(t=e.sibling,t!==null){t.return=e.return,kn=t;break}kn=e.return}return Q=pF,pF=!1,Q}function Av(t,e,r){var o=e.updateQueue;if(o=o!==null?o.lastEffect:null,o!==null){var u=o=o.next;do{if((u.tag&t)===t){var f=u.destroy;u.destroy=void 0,f!==void 0&&tM(e,r,f)}u=u.next}while(u!==o)}}function rS(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var o=r.create;r.destroy=o()}r=r.next}while(r!==e)}}function nM(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function S$(t){var e=t.alternate;e!==null&&(t.alternate=null,S$(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[fu],delete e[sx],delete e[jR],delete e[cQ],delete e[uQ])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function I$(t){return t.tag===5||t.tag===3||t.tag===4}function mF(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||I$(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function rM(t,e,r){var o=t.tag;if(o===5||o===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=BT));else if(o!==4&&(t=t.child,t!==null))for(rM(t,e,r),t=t.sibling;t!==null;)rM(t,e,r),t=t.sibling}function iM(t,e,r){var o=t.tag;if(o===5||o===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(o!==4&&(t=t.child,t!==null))for(iM(t,e,r),t=t.sibling;t!==null;)iM(t,e,r),t=t.sibling}var bo=null,xc=!1;function Md(t,e,r){for(r=r.child;r!==null;)A$(t,e,r),r=r.sibling}function A$(t,e,r){if(yu&&typeof yu.onCommitFiberUnmount=="function")try{yu.onCommitFiberUnmount(XE,r)}catch{}switch(r.tag){case 5:$o||n_(r,e);case 6:var o=bo,u=xc;bo=null,Md(t,e,r),bo=o,xc=u,bo!==null&&(xc?(t=bo,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):bo.removeChild(r.stateNode));break;case 18:bo!==null&&(xc?(t=bo,r=r.stateNode,t.nodeType===8?fP(t.parentNode,r):t.nodeType===1&&fP(t,r),ex(t)):fP(bo,r.stateNode));break;case 4:o=bo,u=xc,bo=r.stateNode.containerInfo,xc=!0,Md(t,e,r),bo=o,xc=u;break;case 0:case 11:case 14:case 15:if(!$o&&(o=r.updateQueue,o!==null&&(o=o.lastEffect,o!==null))){u=o=o.next;do{var f=u,y=f.destroy;f=f.tag,y!==void 0&&(f&2||f&4)&&tM(r,e,y),u=u.next}while(u!==o)}Md(t,e,r);break;case 1:if(!$o&&(n_(r,e),o=r.stateNode,typeof o.componentWillUnmount=="function"))try{o.props=r.memoizedProps,o.state=r.memoizedState,o.componentWillUnmount()}catch(T){Cs(r,e,T)}Md(t,e,r);break;case 21:Md(t,e,r);break;case 22:r.mode&1?($o=(o=$o)||r.memoizedState!==null,Md(t,e,r),$o=o):Md(t,e,r);break;default:Md(t,e,r)}}function gF(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new IQ),e.forEach(function(o){var u=zQ.bind(null,t,o);r.has(o)||(r.add(o),o.then(u,u))})}}function yc(t,e){var r=e.deletions;if(r!==null)for(var o=0;o<r.length;o++){var u=r[o];try{var f=t,y=e,T=y;e:for(;T!==null;){switch(T.tag){case 5:bo=T.stateNode,xc=!1;break e;case 3:bo=T.stateNode.containerInfo,xc=!0;break e;case 4:bo=T.stateNode.containerInfo,xc=!0;break e}T=T.return}if(bo===null)throw Error(an(160));A$(f,y,u),bo=null,xc=!1;var a=u.alternate;a!==null&&(a.return=null),u.return=null}catch(A){Cs(u,e,A)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)C$(e,t),e=e.sibling}function C$(t,e){var r=t.alternate,o=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(yc(e,t),ru(t),o&4){try{Av(3,t,t.return),rS(3,t)}catch(re){Cs(t,t.return,re)}try{Av(5,t,t.return)}catch(re){Cs(t,t.return,re)}}break;case 1:yc(e,t),ru(t),o&512&&r!==null&&n_(r,r.return);break;case 5:if(yc(e,t),ru(t),o&512&&r!==null&&n_(r,r.return),t.flags&32){var u=t.stateNode;try{Kv(u,"")}catch(re){Cs(t,t.return,re)}}if(o&4&&(u=t.stateNode,u!=null)){var f=t.memoizedProps,y=r!==null?r.memoizedProps:f,T=t.type,a=t.updateQueue;if(t.updateQueue=null,a!==null)try{T==="input"&&f.type==="radio"&&f.name!=null&&KV(u,f),CR(T,y);var A=CR(T,f);for(y=0;y<a.length;y+=2){var D=a[y],O=a[y+1];D==="style"?tj(u,O):D==="dangerouslySetInnerHTML"?JV(u,O):D==="children"?Kv(u,O):Hk(u,D,O,A)}switch(T){case"input":TR(u,f);break;case"textarea":YV(u,f);break;case"select":var B=u._wrapperState.wasMultiple;u._wrapperState.wasMultiple=!!f.multiple;var H=f.value;H!=null?u_(u,!!f.multiple,H,!1):B!==!!f.multiple&&(f.defaultValue!=null?u_(u,!!f.multiple,f.defaultValue,!0):u_(u,!!f.multiple,f.multiple?[]:"",!1))}u[sx]=f}catch(re){Cs(t,t.return,re)}}break;case 6:if(yc(e,t),ru(t),o&4){if(t.stateNode===null)throw Error(an(162));u=t.stateNode,f=t.memoizedProps;try{u.nodeValue=f}catch(re){Cs(t,t.return,re)}}break;case 3:if(yc(e,t),ru(t),o&4&&r!==null&&r.memoizedState.isDehydrated)try{ex(e.containerInfo)}catch(re){Cs(t,t.return,re)}break;case 4:yc(e,t),ru(t);break;case 13:yc(e,t),ru(t),u=t.child,u.flags&8192&&(f=u.memoizedState!==null,u.stateNode.isHidden=f,!f||u.alternate!==null&&u.alternate.memoizedState!==null||(I3=Ls())),o&4&&gF(t);break;case 22:if(D=r!==null&&r.memoizedState!==null,t.mode&1?($o=(A=$o)||D,yc(e,t),$o=A):yc(e,t),ru(t),o&8192){if(A=t.memoizedState!==null,(t.stateNode.isHidden=A)&&!D&&t.mode&1)for(kn=t,D=t.child;D!==null;){for(O=kn=D;kn!==null;){switch(B=kn,H=B.child,B.tag){case 0:case 11:case 14:case 15:Av(4,B,B.return);break;case 1:n_(B,B.return);var Q=B.stateNode;if(typeof Q.componentWillUnmount=="function"){o=B,r=B.return;try{e=o,Q.props=e.memoizedProps,Q.state=e.memoizedState,Q.componentWillUnmount()}catch(re){Cs(o,r,re)}}break;case 5:n_(B,B.return);break;case 22:if(B.memoizedState!==null){yF(O);continue}}H!==null?(H.return=B,kn=H):yF(O)}D=D.sibling}e:for(D=null,O=t;;){if(O.tag===5){if(D===null){D=O;try{u=O.stateNode,A?(f=u.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none"):(T=O.stateNode,a=O.memoizedProps.style,y=a!=null&&a.hasOwnProperty("display")?a.display:null,T.style.display=ej("display",y))}catch(re){Cs(t,t.return,re)}}}else if(O.tag===6){if(D===null)try{O.stateNode.nodeValue=A?"":O.memoizedProps}catch(re){Cs(t,t.return,re)}}else if((O.tag!==22&&O.tag!==23||O.memoizedState===null||O===t)&&O.child!==null){O.child.return=O,O=O.child;continue}if(O===t)break e;for(;O.sibling===null;){if(O.return===null||O.return===t)break e;D===O&&(D=null),O=O.return}D===O&&(D=null),O.sibling.return=O.return,O=O.sibling}}break;case 19:yc(e,t),ru(t),o&4&&gF(t);break;case 21:break;default:yc(e,t),ru(t)}}function ru(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(I$(r)){var o=r;break e}r=r.return}throw Error(an(160))}switch(o.tag){case 5:var u=o.stateNode;o.flags&32&&(Kv(u,""),o.flags&=-33);var f=mF(t);iM(t,f,u);break;case 3:case 4:var y=o.stateNode.containerInfo,T=mF(t);rM(t,T,y);break;default:throw Error(an(161))}}catch(a){Cs(t,t.return,a)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function CQ(t,e,r){kn=t,P$(t)}function P$(t,e,r){for(var o=(t.mode&1)!==0;kn!==null;){var u=kn,f=u.child;if(u.tag===22&&o){var y=u.memoizedState!==null||ww;if(!y){var T=u.alternate,a=T!==null&&T.memoizedState!==null||$o;T=ww;var A=$o;if(ww=y,($o=a)&&!A)for(kn=u;kn!==null;)y=kn,a=y.child,y.tag===22&&y.memoizedState!==null?vF(u):a!==null?(a.return=y,kn=a):vF(u);for(;f!==null;)kn=f,P$(f),f=f.sibling;kn=u,ww=T,$o=A}_F(t)}else u.subtreeFlags&8772&&f!==null?(f.return=u,kn=f):_F(t)}}function _F(t){for(;kn!==null;){var e=kn;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:$o||rS(5,e);break;case 1:var o=e.stateNode;if(e.flags&4&&!$o)if(r===null)o.componentDidMount();else{var u=e.elementType===e.type?r.memoizedProps:vc(e.type,r.memoizedProps);o.componentDidUpdate(u,r.memoizedState,o.__reactInternalSnapshotBeforeUpdate)}var f=e.updateQueue;f!==null&&tF(e,f,o);break;case 3:var y=e.updateQueue;if(y!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}tF(e,y,r)}break;case 5:var T=e.stateNode;if(r===null&&e.flags&4){r=T;var a=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&r.focus();break;case"img":a.src&&(r.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var A=e.alternate;if(A!==null){var D=A.memoizedState;if(D!==null){var O=D.dehydrated;O!==null&&ex(O)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(an(163))}$o||e.flags&512&&nM(e)}catch(B){Cs(e,e.return,B)}}if(e===t){kn=null;break}if(r=e.sibling,r!==null){r.return=e.return,kn=r;break}kn=e.return}}function yF(t){for(;kn!==null;){var e=kn;if(e===t){kn=null;break}var r=e.sibling;if(r!==null){r.return=e.return,kn=r;break}kn=e.return}}function vF(t){for(;kn!==null;){var e=kn;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{rS(4,e)}catch(a){Cs(e,r,a)}break;case 1:var o=e.stateNode;if(typeof o.componentDidMount=="function"){var u=e.return;try{o.componentDidMount()}catch(a){Cs(e,u,a)}}var f=e.return;try{nM(e)}catch(a){Cs(e,f,a)}break;case 5:var y=e.return;try{nM(e)}catch(a){Cs(e,y,a)}}}catch(a){Cs(e,e.return,a)}if(e===t){kn=null;break}var T=e.sibling;if(T!==null){T.return=e.return,kn=T;break}kn=e.return}}var PQ=Math.ceil,KT=Fh.ReactCurrentDispatcher,E3=Fh.ReactCurrentOwner,Nl=Fh.ReactCurrentBatchConfig,ni=0,_o=null,qs=null,So=0,Ya=0,r_=Ef(0),so=0,hx=null,Qp=0,iS=0,S3=0,Cv=null,Pa=null,I3=0,k_=1/0,ch=null,YT=!1,sM=null,sf=null,Tw=!1,Hd=null,QT=0,Pv=0,oM=null,iT=-1,sT=0;function pa(){return ni&6?Ls():iT!==-1?iT:iT=Ls()}function of(t){return t.mode&1?ni&2&&So!==0?So&-So:dQ.transition!==null?(sT===0&&(sT=fj()),sT):(t=xi,t!==0||(t=window.event,t=t===void 0?16:xj(t.type)),t):1}function Sc(t,e,r,o){if(50<Pv)throw Pv=0,oM=null,Error(an(185));Fx(t,r,o),(!(ni&2)||t!==_o)&&(t===_o&&(!(ni&2)&&(iS|=r),so===4&&Ud(t,So)),za(t,o),r===1&&ni===0&&!(e.mode&1)&&(k_=Ls()+500,eS&&Sf()))}function za(t,e){var r=t.callbackNode;dY(t,e);var o=LT(t,t===_o?So:0);if(o===0)r!==null&&CN(r),t.callbackNode=null,t.callbackPriority=0;else if(e=o&-o,t.callbackPriority!==e){if(r!=null&&CN(r),e===1)t.tag===0?hQ(xF.bind(null,t)):Bj(xF.bind(null,t)),aQ(function(){!(ni&6)&&Sf()}),r=null;else{switch(pj(o)){case 1:r=Qk;break;case 4:r=hj;break;case 16:r=OT;break;case 536870912:r=dj;break;default:r=OT}r=N$(r,R$.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function R$(t,e){if(iT=-1,sT=0,ni&6)throw Error(an(327));var r=t.callbackNode;if(m_()&&t.callbackNode!==r)return null;var o=LT(t,t===_o?So:0);if(o===0)return null;if(o&30||o&t.expiredLanes||e)e=JT(t,o);else{e=o;var u=ni;ni|=2;var f=k$();(_o!==t||So!==e)&&(ch=null,k_=Ls()+500,Up(t,e));do try{kQ();break}catch(T){M$(t,T)}while(!0);h3(),KT.current=f,ni=u,qs!==null?e=0:(_o=null,So=0,e=so)}if(e!==0){if(e===2&&(u=DR(t),u!==0&&(o=u,e=aM(t,u))),e===1)throw r=hx,Up(t,0),Ud(t,o),za(t,Ls()),r;if(e===6)Ud(t,o);else{if(u=t.current.alternate,!(o&30)&&!RQ(u)&&(e=JT(t,o),e===2&&(f=DR(t),f!==0&&(o=f,e=aM(t,f))),e===1))throw r=hx,Up(t,0),Ud(t,o),za(t,Ls()),r;switch(t.finishedWork=u,t.finishedLanes=o,e){case 0:case 1:throw Error(an(345));case 2:Ap(t,Pa,ch);break;case 3:if(Ud(t,o),(o&130023424)===o&&(e=I3+500-Ls(),10<e)){if(LT(t,0)!==0)break;if(u=t.suspendedLanes,(u&o)!==o){pa(),t.pingedLanes|=t.suspendedLanes&u;break}t.timeoutHandle=VR(Ap.bind(null,t,Pa,ch),e);break}Ap(t,Pa,ch);break;case 4:if(Ud(t,o),(o&4194240)===o)break;for(e=t.eventTimes,u=-1;0<o;){var y=31-Ec(o);f=1<<y,y=e[y],y>u&&(u=y),o&=~f}if(o=u,o=Ls()-o,o=(120>o?120:480>o?480:1080>o?1080:1920>o?1920:3e3>o?3e3:4320>o?4320:1960*PQ(o/1960))-o,10<o){t.timeoutHandle=VR(Ap.bind(null,t,Pa,ch),o);break}Ap(t,Pa,ch);break;case 5:Ap(t,Pa,ch);break;default:throw Error(an(329))}}}return za(t,Ls()),t.callbackNode===r?R$.bind(null,t):null}function aM(t,e){var r=Cv;return t.current.memoizedState.isDehydrated&&(Up(t,e).flags|=256),t=JT(t,e),t!==2&&(e=Pa,Pa=r,e!==null&&lM(e)),t}function lM(t){Pa===null?Pa=t:Pa.push.apply(Pa,t)}function RQ(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var o=0;o<r.length;o++){var u=r[o],f=u.getSnapshot;u=u.value;try{if(!Ac(f(),u))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ud(t,e){for(e&=~S3,e&=~iS,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-Ec(e),o=1<<r;t[r]=-1,e&=~o}}function xF(t){if(ni&6)throw Error(an(327));m_();var e=LT(t,0);if(!(e&1))return za(t,Ls()),null;var r=JT(t,e);if(t.tag!==0&&r===2){var o=DR(t);o!==0&&(e=o,r=aM(t,o))}if(r===1)throw r=hx,Up(t,0),Ud(t,e),za(t,Ls()),r;if(r===6)throw Error(an(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ap(t,Pa,ch),za(t,Ls()),null}function A3(t,e){var r=ni;ni|=1;try{return t(e)}finally{ni=r,ni===0&&(k_=Ls()+500,eS&&Sf())}}function Jp(t){Hd!==null&&Hd.tag===0&&!(ni&6)&&m_();var e=ni;ni|=1;var r=Nl.transition,o=xi;try{if(Nl.transition=null,xi=1,t)return t()}finally{xi=o,Nl.transition=r,ni=e,!(ni&6)&&Sf()}}function C3(){Ya=r_.current,Zi(r_)}function Up(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,oQ(r)),qs!==null)for(r=qs.return;r!==null;){var o=r;switch(l3(o),o.tag){case 1:o=o.type.childContextTypes,o!=null&&UT();break;case 3:R_(),Zi(Oa),Zi(Zo),_3();break;case 5:g3(o);break;case 4:R_();break;case 13:Zi(ps);break;case 19:Zi(ps);break;case 10:d3(o.type._context);break;case 22:case 23:C3()}r=r.return}if(_o=t,qs=t=af(t.current,null),So=Ya=e,so=0,hx=null,S3=iS=Qp=0,Pa=Cv=null,Lp!==null){for(e=0;e<Lp.length;e++)if(r=Lp[e],o=r.interleaved,o!==null){r.interleaved=null;var u=o.next,f=r.pending;if(f!==null){var y=f.next;f.next=u,o.next=y}r.pending=o}Lp=null}return t}function M$(t,e){do{var r=qs;try{if(h3(),tT.current=XT,ZT){for(var o=ms.memoizedState;o!==null;){var u=o.queue;u!==null&&(u.pending=null),o=o.next}ZT=!1}if(Yp=0,mo=ro=ms=null,Iv=!1,lx=0,E3.current=null,r===null||r.return===null){so=1,hx=e,qs=null;break}e:{var f=t,y=r.return,T=r,a=e;if(e=So,T.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var A=a,D=T,O=D.tag;if(!(D.mode&1)&&(O===0||O===11||O===15)){var B=D.alternate;B?(D.updateQueue=B.updateQueue,D.memoizedState=B.memoizedState,D.lanes=B.lanes):(D.updateQueue=null,D.memoizedState=null)}var H=aF(y);if(H!==null){H.flags&=-257,lF(H,y,T,f,e),H.mode&1&&oF(f,A,e),e=H,a=A;var Q=e.updateQueue;if(Q===null){var re=new Set;re.add(a),e.updateQueue=re}else Q.add(a);break e}else{if(!(e&1)){oF(f,A,e),P3();break e}a=Error(an(426))}}else if(os&&T.mode&1){var se=aF(y);if(se!==null){!(se.flags&65536)&&(se.flags|=256),lF(se,y,T,f,e),c3(M_(a,T));break e}}f=a=M_(a,T),so!==4&&(so=2),Cv===null?Cv=[f]:Cv.push(f),f=y;do{switch(f.tag){case 3:f.flags|=65536,e&=-e,f.lanes|=e;var G=p$(f,a,e);eF(f,G);break e;case 1:T=a;var Y=f.type,Z=f.stateNode;if(!(f.flags&128)&&(typeof Y.getDerivedStateFromError=="function"||Z!==null&&typeof Z.componentDidCatch=="function"&&(sf===null||!sf.has(Z)))){f.flags|=65536,e&=-e,f.lanes|=e;var fe=m$(f,T,e);eF(f,fe);break e}}f=f.return}while(f!==null)}O$(r)}catch(Te){e=Te,qs===r&&r!==null&&(qs=r=r.return);continue}break}while(!0)}function k$(){var t=KT.current;return KT.current=XT,t===null?XT:t}function P3(){(so===0||so===3||so===2)&&(so=4),_o===null||!(Qp&268435455)&&!(iS&268435455)||Ud(_o,So)}function JT(t,e){var r=ni;ni|=2;var o=k$();(_o!==t||So!==e)&&(ch=null,Up(t,e));do try{MQ();break}catch(u){M$(t,u)}while(!0);if(h3(),ni=r,KT.current=o,qs!==null)throw Error(an(261));return _o=null,So=0,so}function MQ(){for(;qs!==null;)D$(qs)}function kQ(){for(;qs!==null&&!rY();)D$(qs)}function D$(t){var e=z$(t.alternate,t,Ya);t.memoizedProps=t.pendingProps,e===null?O$(t):qs=e,E3.current=null}function O$(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=SQ(r,e),r!==null){r.flags&=32767,qs=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{so=6,qs=null;return}}else if(r=EQ(r,e,Ya),r!==null){qs=r;return}if(e=e.sibling,e!==null){qs=e;return}qs=e=t}while(e!==null);so===0&&(so=5)}function Ap(t,e,r){var o=xi,u=Nl.transition;try{Nl.transition=null,xi=1,DQ(t,e,r,o)}finally{Nl.transition=u,xi=o}return null}function DQ(t,e,r,o){do m_();while(Hd!==null);if(ni&6)throw Error(an(327));r=t.finishedWork;var u=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(an(177));t.callbackNode=null,t.callbackPriority=0;var f=r.lanes|r.childLanes;if(fY(t,f),t===_o&&(qs=_o=null,So=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||Tw||(Tw=!0,N$(OT,function(){return m_(),null})),f=(r.flags&15990)!==0,r.subtreeFlags&15990||f){f=Nl.transition,Nl.transition=null;var y=xi;xi=1;var T=ni;ni|=4,E3.current=null,AQ(t,r),C$(r,t),JY(BR),zT=!!FR,BR=FR=null,t.current=r,CQ(r),iY(),ni=T,xi=y,Nl.transition=f}else t.current=r;if(Tw&&(Tw=!1,Hd=t,QT=u),f=t.pendingLanes,f===0&&(sf=null),aY(r.stateNode),za(t,Ls()),e!==null)for(o=t.onRecoverableError,r=0;r<e.length;r++)u=e[r],o(u.value,{componentStack:u.stack,digest:u.digest});if(YT)throw YT=!1,t=sM,sM=null,t;return QT&1&&t.tag!==0&&m_(),f=t.pendingLanes,f&1?t===oM?Pv++:(Pv=0,oM=t):Pv=0,Sf(),null}function m_(){if(Hd!==null){var t=pj(QT),e=Nl.transition,r=xi;try{if(Nl.transition=null,xi=16>t?16:t,Hd===null)var o=!1;else{if(t=Hd,Hd=null,QT=0,ni&6)throw Error(an(331));var u=ni;for(ni|=4,kn=t.current;kn!==null;){var f=kn,y=f.child;if(kn.flags&16){var T=f.deletions;if(T!==null){for(var a=0;a<T.length;a++){var A=T[a];for(kn=A;kn!==null;){var D=kn;switch(D.tag){case 0:case 11:case 15:Av(8,D,f)}var O=D.child;if(O!==null)O.return=D,kn=O;else for(;kn!==null;){D=kn;var B=D.sibling,H=D.return;if(S$(D),D===A){kn=null;break}if(B!==null){B.return=H,kn=B;break}kn=H}}}var Q=f.alternate;if(Q!==null){var re=Q.child;if(re!==null){Q.child=null;do{var se=re.sibling;re.sibling=null,re=se}while(re!==null)}}kn=f}}if(f.subtreeFlags&2064&&y!==null)y.return=f,kn=y;else e:for(;kn!==null;){if(f=kn,f.flags&2048)switch(f.tag){case 0:case 11:case 15:Av(9,f,f.return)}var G=f.sibling;if(G!==null){G.return=f.return,kn=G;break e}kn=f.return}}var Y=t.current;for(kn=Y;kn!==null;){y=kn;var Z=y.child;if(y.subtreeFlags&2064&&Z!==null)Z.return=y,kn=Z;else e:for(y=Y;kn!==null;){if(T=kn,T.flags&2048)try{switch(T.tag){case 0:case 11:case 15:rS(9,T)}}catch(Te){Cs(T,T.return,Te)}if(T===y){kn=null;break e}var fe=T.sibling;if(fe!==null){fe.return=T.return,kn=fe;break e}kn=T.return}}if(ni=u,Sf(),yu&&typeof yu.onPostCommitFiberRoot=="function")try{yu.onPostCommitFiberRoot(XE,t)}catch{}o=!0}return o}finally{xi=r,Nl.transition=e}}return!1}function bF(t,e,r){e=M_(r,e),e=p$(t,e,1),t=rf(t,e,1),e=pa(),t!==null&&(Fx(t,1,e),za(t,e))}function Cs(t,e,r){if(t.tag===3)bF(t,t,r);else for(;e!==null;){if(e.tag===3){bF(e,t,r);break}else if(e.tag===1){var o=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(sf===null||!sf.has(o))){t=M_(r,t),t=m$(e,t,1),e=rf(e,t,1),t=pa(),e!==null&&(Fx(e,1,t),za(e,t));break}}e=e.return}}function OQ(t,e,r){var o=t.pingCache;o!==null&&o.delete(e),e=pa(),t.pingedLanes|=t.suspendedLanes&r,_o===t&&(So&r)===r&&(so===4||so===3&&(So&130023424)===So&&500>Ls()-I3?Up(t,0):S3|=r),za(t,e)}function L$(t,e){e===0&&(t.mode&1?(e=fw,fw<<=1,!(fw&130023424)&&(fw=4194304)):e=1);var r=pa();t=Ih(t,e),t!==null&&(Fx(t,e,r),za(t,r))}function LQ(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),L$(t,r)}function zQ(t,e){var r=0;switch(t.tag){case 13:var o=t.stateNode,u=t.memoizedState;u!==null&&(r=u.retryLane);break;case 19:o=t.stateNode;break;default:throw Error(an(314))}o!==null&&o.delete(e),L$(t,r)}var z$;z$=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||Oa.current)ka=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return ka=!1,TQ(t,e,r);ka=!!(t.flags&131072)}else ka=!1,os&&e.flags&1048576&&Uj(e,$T,e.index);switch(e.lanes=0,e.tag){case 2:var o=e.type;rT(t,e),t=e.pendingProps;var u=A_(e,Zo.current);p_(e,r),u=v3(null,e,o,t,u,r);var f=x3();return e.flags|=1,typeof u=="object"&&u!==null&&typeof u.render=="function"&&u.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,La(o)?(f=!0,VT(e)):f=!1,e.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,p3(e),u.updater=nS,e.stateNode=u,u._reactInternals=e,ZR(e,o,t,r),e=YR(null,e,o,!0,f,r)):(e.tag=0,os&&f&&a3(e),da(null,e,u,r),e=e.child),e;case 16:o=e.elementType;e:{switch(rT(t,e),t=e.pendingProps,u=o._init,o=u(o._payload),e.type=o,u=e.tag=FQ(o),t=vc(o,t),u){case 0:e=KR(null,e,o,t,r);break e;case 1:e=hF(null,e,o,t,r);break e;case 11:e=cF(null,e,o,t,r);break e;case 14:e=uF(null,e,o,vc(o.type,t),r);break e}throw Error(an(306,o,""))}return e;case 0:return o=e.type,u=e.pendingProps,u=e.elementType===o?u:vc(o,u),KR(t,e,o,u,r);case 1:return o=e.type,u=e.pendingProps,u=e.elementType===o?u:vc(o,u),hF(t,e,o,u,r);case 3:e:{if(v$(e),t===null)throw Error(an(387));o=e.pendingProps,f=e.memoizedState,u=f.element,Wj(t,e),WT(e,o,null,r);var y=e.memoizedState;if(o=y.element,f.isDehydrated)if(f={element:o,isDehydrated:!1,cache:y.cache,pendingSuspenseBoundaries:y.pendingSuspenseBoundaries,transitions:y.transitions},e.updateQueue.baseState=f,e.memoizedState=f,e.flags&256){u=M_(Error(an(423)),e),e=dF(t,e,o,r,u);break e}else if(o!==u){u=M_(Error(an(424)),e),e=dF(t,e,o,r,u);break e}else for(Ja=nf(e.stateNode.containerInfo.firstChild),il=e,os=!0,bc=null,r=Gj(e,null,o,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(C_(),o===u){e=Ah(t,e,r);break e}da(t,e,o,r)}e=e.child}return e;case 5:return Hj(e),t===null&&qR(e),o=e.type,u=e.pendingProps,f=t!==null?t.memoizedProps:null,y=u.children,UR(o,u)?y=null:f!==null&&UR(o,f)&&(e.flags|=32),y$(t,e),da(t,e,y,r),e.child;case 6:return t===null&&qR(e),null;case 13:return x$(t,e,r);case 4:return m3(e,e.stateNode.containerInfo),o=e.pendingProps,t===null?e.child=P_(e,null,o,r):da(t,e,o,r),e.child;case 11:return o=e.type,u=e.pendingProps,u=e.elementType===o?u:vc(o,u),cF(t,e,o,u,r);case 7:return da(t,e,e.pendingProps,r),e.child;case 8:return da(t,e,e.pendingProps.children,r),e.child;case 12:return da(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(o=e.type._context,u=e.pendingProps,f=e.memoizedProps,y=u.value,Vi(GT,o._currentValue),o._currentValue=y,f!==null)if(Ac(f.value,y)){if(f.children===u.children&&!Oa.current){e=Ah(t,e,r);break e}}else for(f=e.child,f!==null&&(f.return=e);f!==null;){var T=f.dependencies;if(T!==null){y=f.child;for(var a=T.firstContext;a!==null;){if(a.context===o){if(f.tag===1){a=xh(-1,r&-r),a.tag=2;var A=f.updateQueue;if(A!==null){A=A.shared;var D=A.pending;D===null?a.next=a:(a.next=D.next,D.next=a),A.pending=a}}f.lanes|=r,a=f.alternate,a!==null&&(a.lanes|=r),WR(f.return,r,e),T.lanes|=r;break}a=a.next}}else if(f.tag===10)y=f.type===e.type?null:f.child;else if(f.tag===18){if(y=f.return,y===null)throw Error(an(341));y.lanes|=r,T=y.alternate,T!==null&&(T.lanes|=r),WR(y,r,e),y=f.sibling}else y=f.child;if(y!==null)y.return=f;else for(y=f;y!==null;){if(y===e){y=null;break}if(f=y.sibling,f!==null){f.return=y.return,y=f;break}y=y.return}f=y}da(t,e,u.children,r),e=e.child}return e;case 9:return u=e.type,o=e.pendingProps.children,p_(e,r),u=Bl(u),o=o(u),e.flags|=1,da(t,e,o,r),e.child;case 14:return o=e.type,u=vc(o,e.pendingProps),u=vc(o.type,u),uF(t,e,o,u,r);case 15:return g$(t,e,e.type,e.pendingProps,r);case 17:return o=e.type,u=e.pendingProps,u=e.elementType===o?u:vc(o,u),rT(t,e),e.tag=1,La(o)?(t=!0,VT(e)):t=!1,p_(e,r),f$(e,o,u),ZR(e,o,u,r),YR(null,e,o,!0,t,r);case 19:return b$(t,e,r);case 22:return _$(t,e,r)}throw Error(an(156,e.tag))};function N$(t,e){return uj(t,e)}function NQ(t,e,r,o){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zl(t,e,r,o){return new NQ(t,e,r,o)}function R3(t){return t=t.prototype,!(!t||!t.isReactComponent)}function FQ(t){if(typeof t=="function")return R3(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Xk)return 11;if(t===Kk)return 14}return 2}function af(t,e){var r=t.alternate;return r===null?(r=zl(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function oT(t,e,r,o,u,f){var y=2;if(o=t,typeof t=="function")R3(t)&&(y=1);else if(typeof t=="string")y=5;else e:switch(t){case Hg:return Vp(r.children,u,f,e);case Zk:y=8,u|=8;break;case yR:return t=zl(12,r,e,u|2),t.elementType=yR,t.lanes=f,t;case vR:return t=zl(13,r,e,u),t.elementType=vR,t.lanes=f,t;case xR:return t=zl(19,r,e,u),t.elementType=xR,t.lanes=f,t;case HV:return sS(r,u,f,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case qV:y=10;break e;case WV:y=9;break e;case Xk:y=11;break e;case Kk:y=14;break e;case Nd:y=16,o=null;break e}throw Error(an(130,t==null?t:typeof t,""))}return e=zl(y,r,e,u),e.elementType=t,e.type=o,e.lanes=f,e}function Vp(t,e,r,o){return t=zl(7,t,o,e),t.lanes=r,t}function sS(t,e,r,o){return t=zl(22,t,o,e),t.elementType=HV,t.lanes=r,t.stateNode={isHidden:!1},t}function bP(t,e,r){return t=zl(6,t,null,e),t.lanes=r,t}function wP(t,e,r){return e=zl(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function BQ(t,e,r,o,u){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=nP(0),this.expirationTimes=nP(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nP(0),this.identifierPrefix=o,this.onRecoverableError=u,this.mutableSourceEagerHydrationData=null}function M3(t,e,r,o,u,f,y,T,a){return t=new BQ(t,e,r,T,a),e===1?(e=1,f===!0&&(e|=8)):e=0,f=zl(3,null,null,e),t.current=f,f.stateNode=t,f.memoizedState={element:o,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},p3(f),t}function UQ(t,e,r){var o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Wg,key:o==null?null:""+o,children:t,containerInfo:e,implementation:r}}function F$(t){if(!t)return pf;t=t._reactInternals;e:{if(pm(t)!==t||t.tag!==1)throw Error(an(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(La(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(an(171))}if(t.tag===1){var r=t.type;if(La(r))return Fj(t,r,e)}return e}function B$(t,e,r,o,u,f,y,T,a){return t=M3(r,o,!0,t,u,f,y,T,a),t.context=F$(null),r=t.current,o=pa(),u=of(r),f=xh(o,u),f.callback=e??null,rf(r,f,u),t.current.lanes=u,Fx(t,u,o),za(t,o),t}function oS(t,e,r,o){var u=e.current,f=pa(),y=of(u);return r=F$(r),e.context===null?e.context=r:e.pendingContext=r,e=xh(f,y),e.payload={element:t},o=o===void 0?null:o,o!==null&&(e.callback=o),t=rf(u,e,y),t!==null&&(Sc(t,u,y,f),eT(t,u,y)),y}function eE(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function wF(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function k3(t,e){wF(t,e),(t=t.alternate)&&wF(t,e)}function VQ(){return null}var U$=typeof reportError=="function"?reportError:function(t){console.error(t)};function D3(t){this._internalRoot=t}aS.prototype.render=D3.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(an(409));oS(t,e,null,null)};aS.prototype.unmount=D3.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Jp(function(){oS(null,t,null,null)}),e[Sh]=null}};function aS(t){this._internalRoot=t}aS.prototype.unstable_scheduleHydration=function(t){if(t){var e=_j();t={blockedOn:null,target:t,priority:e};for(var r=0;r<Bd.length&&e!==0&&e<Bd[r].priority;r++);Bd.splice(r,0,t),r===0&&vj(t)}};function O3(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function lS(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function TF(){}function jQ(t,e,r,o,u){if(u){if(typeof o=="function"){var f=o;o=function(){var A=eE(y);f.call(A)}}var y=B$(e,o,t,0,null,!1,!1,"",TF);return t._reactRootContainer=y,t[Sh]=y.current,rx(t.nodeType===8?t.parentNode:t),Jp(),y}for(;u=t.lastChild;)t.removeChild(u);if(typeof o=="function"){var T=o;o=function(){var A=eE(a);T.call(A)}}var a=M3(t,0,!1,null,null,!1,!1,"",TF);return t._reactRootContainer=a,t[Sh]=a.current,rx(t.nodeType===8?t.parentNode:t),Jp(function(){oS(e,a,r,o)}),a}function cS(t,e,r,o,u){var f=r._reactRootContainer;if(f){var y=f;if(typeof u=="function"){var T=u;u=function(){var a=eE(y);T.call(a)}}oS(e,y,t,u)}else y=jQ(r,e,t,u,o);return eE(y)}mj=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=av(e.pendingLanes);r!==0&&(Jk(e,r|1),za(e,Ls()),!(ni&6)&&(k_=Ls()+500,Sf()))}break;case 13:Jp(function(){var o=Ih(t,1);if(o!==null){var u=pa();Sc(o,t,1,u)}}),k3(t,1)}};e3=function(t){if(t.tag===13){var e=Ih(t,134217728);if(e!==null){var r=pa();Sc(e,t,134217728,r)}k3(t,134217728)}};gj=function(t){if(t.tag===13){var e=of(t),r=Ih(t,e);if(r!==null){var o=pa();Sc(r,t,e,o)}k3(t,e)}};_j=function(){return xi};yj=function(t,e){var r=xi;try{return xi=t,e()}finally{xi=r}};RR=function(t,e,r){switch(e){case"input":if(TR(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var o=r[e];if(o!==t&&o.form===t.form){var u=JE(o);if(!u)throw Error(an(90));XV(o),TR(o,u)}}}break;case"textarea":YV(t,r);break;case"select":e=r.value,e!=null&&u_(t,!!r.multiple,e,!1)}};ij=A3;sj=Jp;var $Q={usingClientEntryPoint:!1,Events:[Ux,Yg,JE,nj,rj,A3]},W0={findFiberByHostInstance:Op,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},GQ={bundleType:W0.bundleType,version:W0.version,rendererPackageName:W0.rendererPackageName,rendererConfig:W0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Fh.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=lj(t),t===null?null:t.stateNode},findFiberByHostInstance:W0.findFiberByHostInstance||VQ,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ew=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ew.isDisabled&&Ew.supportsFiber)try{XE=Ew.inject(GQ),yu=Ew}catch{}}ul.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$Q;ul.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!O3(e))throw Error(an(200));return UQ(t,e,null,r)};ul.createRoot=function(t,e){if(!O3(t))throw Error(an(299));var r=!1,o="",u=U$;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(o=e.identifierPrefix),e.onRecoverableError!==void 0&&(u=e.onRecoverableError)),e=M3(t,1,!1,null,null,r,!1,o,u),t[Sh]=e.current,rx(t.nodeType===8?t.parentNode:t),new D3(e)};ul.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(an(188)):(t=Object.keys(t).join(","),Error(an(268,t)));return t=lj(e),t=t===null?null:t.stateNode,t};ul.flushSync=function(t){return Jp(t)};ul.hydrate=function(t,e,r){if(!lS(e))throw Error(an(200));return cS(null,t,e,!0,r)};ul.hydrateRoot=function(t,e,r){if(!O3(t))throw Error(an(405));var o=r!=null&&r.hydratedSources||null,u=!1,f="",y=U$;if(r!=null&&(r.unstable_strictMode===!0&&(u=!0),r.identifierPrefix!==void 0&&(f=r.identifierPrefix),r.onRecoverableError!==void 0&&(y=r.onRecoverableError)),e=B$(e,null,t,1,r??null,u,!1,f,y),t[Sh]=e.current,rx(t),o)for(t=0;t<o.length;t++)r=o[t],u=r._getVersion,u=u(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,u]:e.mutableSourceEagerHydrationData.push(r,u);return new aS(e)};ul.render=function(t,e,r){if(!lS(e))throw Error(an(200));return cS(null,t,e,!1,r)};ul.unmountComponentAtNode=function(t){if(!lS(t))throw Error(an(40));return t._reactRootContainer?(Jp(function(){cS(null,null,t,!1,function(){t._reactRootContainer=null,t[Sh]=null})}),!0):!1};ul.unstable_batchedUpdates=A3;ul.unstable_renderSubtreeIntoContainer=function(t,e,r,o){if(!lS(r))throw Error(an(200));if(t==null||t._reactInternals===void 0)throw Error(an(38));return cS(t,e,r,!1,o)};ul.version="18.3.1-next-f1338f8080-20240426";function V$(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(V$)}catch(t){console.error(t)}}V$(),VV.exports=ul;var L3=VV.exports;const Sw=HE(L3);/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function cM(){return cM=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},cM.apply(this,arguments)}var EF;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(EF||(EF={}));function bh(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function SF(t){let{pathname:e="/",search:r="",hash:o=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),o&&o!=="#"&&(e+=o.charAt(0)==="#"?o:"#"+o),e}function j$(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let o=t.indexOf("?");o>=0&&(e.search=t.substr(o),t=t.substr(0,o)),t&&(e.pathname=t)}return e}var IF;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(IF||(IF={}));function qQ(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,o=t.charAt(r);return o&&o!=="/"?null:t.slice(r)||"/"}function WQ(t,e){e===void 0&&(e="/");let{pathname:r,search:o="",hash:u=""}=typeof t=="string"?j$(t):t;return{pathname:r?r.startsWith("/")?r:HQ(r,e):e,search:XQ(o),hash:KQ(u)}}function HQ(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(u=>{u===".."?r.length>1&&r.pop():u!=="."&&r.push(u)}),r.length>1?r.join("/"):"/"}function TP(t,e,r,o){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(o)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function ZQ(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function $$(t,e){let r=ZQ(t);return e?r.map((o,u)=>u===r.length-1?o.pathname:o.pathnameBase):r.map(o=>o.pathnameBase)}function G$(t,e,r,o){o===void 0&&(o=!1);let u;typeof t=="string"?u=j$(t):(u=cM({},t),bh(!u.pathname||!u.pathname.includes("?"),TP("?","pathname","search",u)),bh(!u.pathname||!u.pathname.includes("#"),TP("#","pathname","hash",u)),bh(!u.search||!u.search.includes("#"),TP("#","search","hash",u)));let f=t===""||u.pathname==="",y=f?"/":u.pathname,T;if(y==null)T=r;else{let O=e.length-1;if(!o&&y.startsWith("..")){let B=y.split("/");for(;B[0]==="..";)B.shift(),O-=1;u.pathname=B.join("/")}T=O>=0?e[O]:"/"}let a=WQ(u,T),A=y&&y!=="/"&&y.endsWith("/"),D=(f||y===".")&&r.endsWith("/");return!a.pathname.endsWith("/")&&(A||D)&&(a.pathname+="/"),a}const q$=t=>t.join("/").replace(/\/\/+/g,"/"),XQ=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,KQ=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,W$=["post","put","patch","delete"];new Set(W$);const YQ=["get",...W$];new Set(YQ);/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function uM(){return uM=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},uM.apply(this,arguments)}const H$=ue.createContext(null),jx=ue.createContext(null),Z$=ue.createContext(null),uS=ue.createContext({outlet:null,matches:[],isDataRoute:!1});function QQ(t,e){let{relative:r}=e===void 0?{}:e;z3()||bh(!1);let{basename:o,navigator:u}=ue.useContext(jx),{hash:f,pathname:y,search:T}=K$(t,{relative:r}),a=y;return o!=="/"&&(a=y==="/"?o:q$([o,y])),u.createHref({pathname:a,search:T,hash:f})}function z3(){return ue.useContext(Z$)!=null}function N3(){return z3()||bh(!1),ue.useContext(Z$).location}function X$(t){ue.useContext(jx).static||ue.useLayoutEffect(t)}function F3(){let{isDataRoute:t}=ue.useContext(uS);return t?rJ():JQ()}function JQ(){z3()||bh(!1);let t=ue.useContext(H$),{basename:e,future:r,navigator:o}=ue.useContext(jx),{matches:u}=ue.useContext(uS),{pathname:f}=N3(),y=JSON.stringify($$(u,r.v7_relativeSplatPath)),T=ue.useRef(!1);return X$(()=>{T.current=!0}),ue.useCallback(function(A,D){if(D===void 0&&(D={}),!T.current)return;if(typeof A=="number"){o.go(A);return}let O=G$(A,JSON.parse(y),f,D.relative==="path");t==null&&e!=="/"&&(O.pathname=O.pathname==="/"?e:q$([e,O.pathname])),(D.replace?o.replace:o.push)(O,D.state,D)},[e,o,y,f,t])}function K$(t,e){let{relative:r}=e===void 0?{}:e,{future:o}=ue.useContext(jx),{matches:u}=ue.useContext(uS),{pathname:f}=N3(),y=JSON.stringify($$(u,o.v7_relativeSplatPath));return ue.useMemo(()=>G$(t,JSON.parse(y),f,r==="path"),[t,y,f,r])}var Y$=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(Y$||{}),Q$=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Q$||{});function eJ(t){let e=ue.useContext(H$);return e||bh(!1),e}function tJ(t){let e=ue.useContext(uS);return e||bh(!1),e}function nJ(t){let e=tJ(),r=e.matches[e.matches.length-1];return r.route.id||bh(!1),r.route.id}function rJ(){let{router:t}=eJ(Y$.UseNavigateStable),e=nJ(Q$.UseNavigateStable),r=ue.useRef(!1);return X$(()=>{r.current=!0}),ue.useCallback(function(u,f){f===void 0&&(f={}),r.current&&(typeof u=="number"?t.navigate(u):t.navigate(u,uM({fromRouteId:e},f)))},[t,e])}new Promise(()=>{});/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function hM(){return hM=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},hM.apply(this,arguments)}function iJ(t,e){if(t==null)return{};var r={},o=Object.keys(t),u,f;for(f=0;f<o.length;f++)u=o[f],!(e.indexOf(u)>=0)&&(r[u]=t[u]);return r}function sJ(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function oJ(t,e){return t.button===0&&(!e||e==="_self")&&!sJ(t)}const aJ=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],lJ="6";try{window.__reactRouterVersion=lJ}catch{}const cJ=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",uJ=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,hJ=ue.forwardRef(function(e,r){let{onClick:o,relative:u,reloadDocument:f,replace:y,state:T,target:a,to:A,preventScrollReset:D,unstable_viewTransition:O}=e,B=iJ(e,aJ),{basename:H}=ue.useContext(jx),Q,re=!1;if(typeof A=="string"&&uJ.test(A)&&(Q=A,cJ))try{let Z=new URL(window.location.href),fe=A.startsWith("//")?new URL(Z.protocol+A):new URL(A),Te=qQ(fe.pathname,H);fe.origin===Z.origin&&Te!=null?A=Te+fe.search+fe.hash:re=!0}catch{}let se=QQ(A,{relative:u}),G=dJ(A,{replace:y,state:T,target:a,preventScrollReset:D,relative:u,unstable_viewTransition:O});function Y(Z){o&&o(Z),Z.defaultPrevented||G(Z)}return ue.createElement("a",hM({},B,{href:Q||se,onClick:re||f?o:Y,ref:r,target:a}))});var AF;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(AF||(AF={}));var CF;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(CF||(CF={}));function dJ(t,e){let{target:r,replace:o,state:u,preventScrollReset:f,relative:y,unstable_viewTransition:T}=e===void 0?{}:e,a=F3(),A=N3(),D=K$(t,{relative:y});return ue.useCallback(O=>{if(oJ(O,r)){O.preventDefault();let B=o!==void 0?o:SF(A)===SF(D);a(t,{replace:B,state:u,preventScrollReset:f,relative:y,unstable_viewTransition:T})}},[A,a,D,o,u,r,t,f,y,T])}var J$={exports:{}},bi={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yo=typeof Symbol=="function"&&Symbol.for,B3=yo?Symbol.for("react.element"):60103,U3=yo?Symbol.for("react.portal"):60106,hS=yo?Symbol.for("react.fragment"):60107,dS=yo?Symbol.for("react.strict_mode"):60108,fS=yo?Symbol.for("react.profiler"):60114,pS=yo?Symbol.for("react.provider"):60109,mS=yo?Symbol.for("react.context"):60110,V3=yo?Symbol.for("react.async_mode"):60111,gS=yo?Symbol.for("react.concurrent_mode"):60111,_S=yo?Symbol.for("react.forward_ref"):60112,yS=yo?Symbol.for("react.suspense"):60113,fJ=yo?Symbol.for("react.suspense_list"):60120,vS=yo?Symbol.for("react.memo"):60115,xS=yo?Symbol.for("react.lazy"):60116,pJ=yo?Symbol.for("react.block"):60121,mJ=yo?Symbol.for("react.fundamental"):60117,gJ=yo?Symbol.for("react.responder"):60118,_J=yo?Symbol.for("react.scope"):60119;function dl(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case B3:switch(t=t.type,t){case V3:case gS:case hS:case fS:case dS:case yS:return t;default:switch(t=t&&t.$$typeof,t){case mS:case _S:case xS:case vS:case pS:return t;default:return e}}case U3:return e}}}function e8(t){return dl(t)===gS}bi.AsyncMode=V3;bi.ConcurrentMode=gS;bi.ContextConsumer=mS;bi.ContextProvider=pS;bi.Element=B3;bi.ForwardRef=_S;bi.Fragment=hS;bi.Lazy=xS;bi.Memo=vS;bi.Portal=U3;bi.Profiler=fS;bi.StrictMode=dS;bi.Suspense=yS;bi.isAsyncMode=function(t){return e8(t)||dl(t)===V3};bi.isConcurrentMode=e8;bi.isContextConsumer=function(t){return dl(t)===mS};bi.isContextProvider=function(t){return dl(t)===pS};bi.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===B3};bi.isForwardRef=function(t){return dl(t)===_S};bi.isFragment=function(t){return dl(t)===hS};bi.isLazy=function(t){return dl(t)===xS};bi.isMemo=function(t){return dl(t)===vS};bi.isPortal=function(t){return dl(t)===U3};bi.isProfiler=function(t){return dl(t)===fS};bi.isStrictMode=function(t){return dl(t)===dS};bi.isSuspense=function(t){return dl(t)===yS};bi.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===hS||t===gS||t===fS||t===dS||t===yS||t===fJ||typeof t=="object"&&t!==null&&(t.$$typeof===xS||t.$$typeof===vS||t.$$typeof===pS||t.$$typeof===mS||t.$$typeof===_S||t.$$typeof===mJ||t.$$typeof===gJ||t.$$typeof===_J||t.$$typeof===pJ)};bi.typeOf=dl;J$.exports=bi;var yJ=J$.exports,t8=yJ,vJ={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},xJ={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},n8={};n8[t8.ForwardRef]=vJ;n8[t8.Memo]=xJ;function mm(t){this._maxSize=t,this.clear()}mm.prototype.clear=function(){this._size=0,this._values=Object.create(null)};mm.prototype.get=function(t){return this._values[t]};mm.prototype.set=function(t,e){return this._size>=this._maxSize&&this.clear(),t in this._values||this._size++,this._values[t]=e};var bJ=/[^.^\]^[]+|(?=\[\]|\.\.)/g,r8=/^\d+$/,wJ=/^\d/,TJ=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g,EJ=/^\s*(['"]?)(.*?)(\1)\s*$/,j3=512,PF=new mm(j3),RF=new mm(j3),MF=new mm(j3),i8={Cache:mm,split:dM,normalizePath:EP,setter:function(t){var e=EP(t);return RF.get(t)||RF.set(t,function(o,u){for(var f=0,y=e.length,T=o;f<y-1;){var a=e[f];if(a==="__proto__"||a==="constructor"||a==="prototype")return o;T=T[e[f++]]}T[e[f]]=u})},getter:function(t,e){var r=EP(t);return MF.get(t)||MF.set(t,function(u){for(var f=0,y=r.length;f<y;)if(u!=null||!e)u=u[r[f++]];else return;return u})},join:function(t){return t.reduce(function(e,r){return e+($3(r)||r8.test(r)?"["+r+"]":(e?".":"")+r)},"")},forEach:function(t,e,r){SJ(Array.isArray(t)?t:dM(t),e,r)}};function EP(t){return PF.get(t)||PF.set(t,dM(t).map(function(e){return e.replace(EJ,"$2")}))}function dM(t){return t.match(bJ)||[""]}function SJ(t,e,r){var o=t.length,u,f,y,T;for(f=0;f<o;f++)u=t[f],u&&(CJ(u)&&(u='"'+u+'"'),T=$3(u),y=!T&&/^\d+$/.test(u),e.call(r,u,T,y,f,t))}function $3(t){return typeof t=="string"&&t&&["'",'"'].indexOf(t.charAt(0))!==-1}function IJ(t){return t.match(wJ)&&!t.match(r8)}function AJ(t){return TJ.test(t)}function CJ(t){return!$3(t)&&(IJ(t)||AJ(t))}var s8={exports:{}};s8.exports=function(t){return o8(PJ(t),t)};s8.exports.array=o8;function o8(t,e){var r=t.length,o=new Array(r),u={},f=r,y=RJ(e),T=MJ(t);for(e.forEach(function(A){if(!T.has(A[0])||!T.has(A[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")});f--;)u[f]||a(t[f],f,new Set);return o;function a(A,D,O){if(O.has(A)){var B;try{B=", node was:"+JSON.stringify(A)}catch{B=""}throw new Error("Cyclic dependency"+B)}if(!T.has(A))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(A));if(!u[D]){u[D]=!0;var H=y.get(A)||new Set;if(H=Array.from(H),D=H.length){O.add(A);do{var Q=H[--D];a(Q,T.get(Q),O)}while(D);O.delete(A)}o[--r]=A}}}function PJ(t){for(var e=new Set,r=0,o=t.length;r<o;r++){var u=t[r];e.add(u[0]),e.add(u[1])}return Array.from(e)}function RJ(t){for(var e=new Map,r=0,o=t.length;r<o;r++){var u=t[r];e.has(u[0])||e.set(u[0],new Set),e.has(u[1])||e.set(u[1],new Set),e.get(u[0]).add(u[1])}return e}function MJ(t){for(var e=new Map,r=0,o=t.length;r<o;r++)e.set(t[r],r);return e}const kJ=Object.prototype.toString,DJ=Error.prototype.toString,OJ=RegExp.prototype.toString,LJ=typeof Symbol<"u"?Symbol.prototype.toString:()=>"",zJ=/^Symbol\((.*)\)(.*)$/;function NJ(t){return t!=+t?"NaN":t===0&&1/t<0?"-0":""+t}function kF(t,e=!1){if(t==null||t===!0||t===!1)return""+t;const r=typeof t;if(r==="number")return NJ(t);if(r==="string")return e?`"${t}"`:t;if(r==="function")return"[Function "+(t.name||"anonymous")+"]";if(r==="symbol")return LJ.call(t).replace(zJ,"Symbol($1)");const o=kJ.call(t).slice(8,-1);return o==="Date"?isNaN(t.getTime())?""+t:t.toISOString(t):o==="Error"||t instanceof Error?"["+DJ.call(t)+"]":o==="RegExp"?OJ.call(t):null}function lf(t,e){let r=kF(t,e);return r!==null?r:JSON.stringify(t,function(o,u){let f=kF(this[o],e);return f!==null?f:u},2)}function a8(t){return t==null?[]:[].concat(t)}let l8,c8,u8,FJ=/\$\{\s*(\w+)\s*\}/g;l8=Symbol.toStringTag;class DF{constructor(e,r,o,u){this.name=void 0,this.message=void 0,this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=void 0,this.inner=void 0,this[l8]="Error",this.name="ValidationError",this.value=r,this.path=o,this.type=u,this.errors=[],this.inner=[],a8(e).forEach(f=>{if(Ra.isError(f)){this.errors.push(...f.errors);const y=f.inner.length?f.inner:[f];this.inner.push(...y)}else this.errors.push(f)}),this.message=this.errors.length>1?`${this.errors.length} errors occurred`:this.errors[0]}}c8=Symbol.hasInstance;u8=Symbol.toStringTag;class Ra extends Error{static formatError(e,r){const o=r.label||r.path||"this";return o!==r.path&&(r=Object.assign({},r,{path:o})),typeof e=="string"?e.replace(FJ,(u,f)=>lf(r[f])):typeof e=="function"?e(r):e}static isError(e){return e&&e.name==="ValidationError"}constructor(e,r,o,u,f){const y=new DF(e,r,o,u);if(f)return y;super(),this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=[],this.inner=[],this[u8]="Error",this.name=y.name,this.message=y.message,this.type=y.type,this.value=y.value,this.path=y.path,this.errors=y.errors,this.inner=y.inner,Error.captureStackTrace&&Error.captureStackTrace(this,Ra)}static[c8](e){return DF[Symbol.hasInstance](e)||super[Symbol.hasInstance](e)}}let uh={default:"${path} is invalid",required:"${path} is a required field",defined:"${path} must be defined",notNull:"${path} cannot be null",oneOf:"${path} must be one of the following values: ${values}",notOneOf:"${path} must not be one of the following values: ${values}",notType:({path:t,type:e,value:r,originalValue:o})=>{const u=o!=null&&o!==r?` (cast from the value \`${lf(o,!0)}\`).`:".";return e!=="mixed"?`${t} must be a \`${e}\` type, but the final value was: \`${lf(r,!0)}\``+u:`${t} must match the configured type. The validated value was: \`${lf(r,!0)}\``+u}},BJ={length:"${path} must be exactly ${length} characters",min:"${path} must be at least ${min} characters",max:"${path} must be at most ${max} characters",matches:'${path} must match the following: "${regex}"',email:"${path} must be a valid email",url:"${path} must be a valid URL",uuid:"${path} must be a valid UUID",datetime:"${path} must be a valid ISO date-time",datetime_precision:"${path} must be a valid ISO date-time with a sub-second precision of exactly ${precision} digits",datetime_offset:'${path} must be a valid ISO date-time with UTC "Z" timezone',trim:"${path} must be a trimmed string",lowercase:"${path} must be a lowercase string",uppercase:"${path} must be a upper case string"},UJ={min:"${path} must be greater than or equal to ${min}",max:"${path} must be less than or equal to ${max}",lessThan:"${path} must be less than ${less}",moreThan:"${path} must be greater than ${more}",positive:"${path} must be a positive number",negative:"${path} must be a negative number",integer:"${path} must be an integer"},fM={min:"${path} field must be later than ${min}",max:"${path} field must be at earlier than ${max}"},VJ={isValue:"${path} field must be ${value}"},jJ={noUnknown:"${path} field has unspecified keys: ${unknown}"},$J={min:"${path} field must have at least ${min} items",max:"${path} field must have less than or equal to ${max} items",length:"${path} must have ${length} items"},GJ={notType:t=>{const{path:e,value:r,spec:o}=t,u=o.types.length;if(Array.isArray(r)){if(r.length<u)return`${e} tuple value has too few items, expected a length of ${u} but got ${r.length} for value: \`${lf(r,!0)}\``;if(r.length>u)return`${e} tuple value has too many items, expected a length of ${u} but got ${r.length} for value: \`${lf(r,!0)}\``}return Ra.formatError(uh.notType,t)}};Object.assign(Object.create(null),{mixed:uh,string:BJ,number:UJ,date:fM,object:jJ,array:$J,boolean:VJ,tuple:GJ});const h8=t=>t&&t.__isYupSchema__;class tE{static fromOptions(e,r){if(!r.then&&!r.otherwise)throw new TypeError("either `then:` or `otherwise:` is required for `when()` conditions");let{is:o,then:u,otherwise:f}=r,y=typeof o=="function"?o:(...T)=>T.every(a=>a===o);return new tE(e,(T,a)=>{var A;let D=y(...T)?u:f;return(A=D==null?void 0:D(a))!=null?A:a})}constructor(e,r){this.fn=void 0,this.refs=e,this.refs=e,this.fn=r}resolve(e,r){let o=this.refs.map(f=>f.getValue(r==null?void 0:r.value,r==null?void 0:r.parent,r==null?void 0:r.context)),u=this.fn(o,e,r);if(u===void 0||u===e)return e;if(!h8(u))throw new TypeError("conditions must return a schema object");return u.resolve(r)}}const Iw={context:"$",value:"."};let $x=class{constructor(e,r={}){if(this.key=void 0,this.isContext=void 0,this.isValue=void 0,this.isSibling=void 0,this.path=void 0,this.getter=void 0,this.map=void 0,typeof e!="string")throw new TypeError("ref must be a string, got: "+e);if(this.key=e.trim(),e==="")throw new TypeError("ref must be a non-empty string");this.isContext=this.key[0]===Iw.context,this.isValue=this.key[0]===Iw.value,this.isSibling=!this.isContext&&!this.isValue;let o=this.isContext?Iw.context:this.isValue?Iw.value:"";this.path=this.key.slice(o.length),this.getter=this.path&&i8.getter(this.path,!0),this.map=r.map}getValue(e,r,o){let u=this.isContext?o:this.isValue?e:r;return this.getter&&(u=this.getter(u||{})),this.map&&(u=this.map(u)),u}cast(e,r){return this.getValue(e,r==null?void 0:r.parent,r==null?void 0:r.context)}resolve(){return this}describe(){return{type:"ref",key:this.key}}toString(){return`Ref(${this.key})`}static isRef(e){return e&&e.__isYupRef}};$x.prototype.__isYupRef=!0;const d8=t=>t==null;function Rg(t){function e({value:r,path:o="",options:u,originalValue:f,schema:y},T,a){const{name:A,test:D,params:O,message:B,skipAbsent:H}=t;let{parent:Q,context:re,abortEarly:se=y.spec.abortEarly,disableStackTrace:G=y.spec.disableStackTrace}=u;function Y(_e){return $x.isRef(_e)?_e.getValue(r,Q,re):_e}function Z(_e={}){const Ee=Object.assign({value:r,originalValue:f,label:y.spec.label,path:_e.path||o,spec:y.spec,disableStackTrace:_e.disableStackTrace||G},O,_e.params);for(const xt of Object.keys(Ee))Ee[xt]=Y(Ee[xt]);const we=new Ra(Ra.formatError(_e.message||B,Ee),r,Ee.path,_e.type||A,Ee.disableStackTrace);return we.params=Ee,we}const fe=se?T:a;let Te={path:o,parent:Q,type:A,from:u.from,createError:Z,resolve:Y,options:u,originalValue:f,schema:y};const Pe=_e=>{Ra.isError(_e)?fe(_e):_e?a(null):fe(Z())},ce=_e=>{Ra.isError(_e)?fe(_e):T(_e)};if(H&&d8(r))return Pe(!0);let W;try{var ge;if(W=D.call(Te,r,Te),typeof((ge=W)==null?void 0:ge.then)=="function"){if(u.sync)throw new Error(`Validation test of type: "${Te.type}" returned a Promise during a synchronous validate. This test will finish after the validate call has returned`);return Promise.resolve(W).then(Pe,ce)}}catch(_e){ce(_e);return}Pe(W)}return e.OPTIONS=t,e}function qJ(t,e,r,o=r){let u,f,y;return e?(i8.forEach(e,(T,a,A)=>{let D=a?T.slice(1,T.length-1):T;t=t.resolve({context:o,parent:u,value:r});let O=t.type==="tuple",B=A?parseInt(D,10):0;if(t.innerType||O){if(O&&!A)throw new Error(`Yup.reach cannot implicitly index into a tuple type. the path part "${y}" must contain an index to the tuple element, e.g. "${y}[0]"`);if(r&&B>=r.length)throw new Error(`Yup.reach cannot resolve an array item at index: ${T}, in the path: ${e}. because there is no value at that index. `);u=r,r=r&&r[B],t=O?t.spec.types[B]:t.innerType}if(!A){if(!t.fields||!t.fields[D])throw new Error(`The schema does not contain the path: ${e}. (failed at: ${y} which is a type: "${t.type}")`);u=r,r=r&&r[D],t=t.fields[D]}f=D,y=a?"["+T+"]":"."+T}),{schema:t,parent:u,parentPath:f}):{parent:u,parentPath:e,schema:t}}class nE extends Set{describe(){const e=[];for(const r of this.values())e.push($x.isRef(r)?r.describe():r);return e}resolveAll(e){let r=[];for(const o of this.values())r.push(e(o));return r}clone(){return new nE(this.values())}merge(e,r){const o=this.clone();return e.forEach(u=>o.add(u)),r.forEach(u=>o.delete(u)),o}}function i_(t,e=new Map){if(h8(t)||!t||typeof t!="object")return t;if(e.has(t))return e.get(t);let r;if(t instanceof Date)r=new Date(t.getTime()),e.set(t,r);else if(t instanceof RegExp)r=new RegExp(t),e.set(t,r);else if(Array.isArray(t)){r=new Array(t.length),e.set(t,r);for(let o=0;o<t.length;o++)r[o]=i_(t[o],e)}else if(t instanceof Map){r=new Map,e.set(t,r);for(const[o,u]of t.entries())r.set(o,i_(u,e))}else if(t instanceof Set){r=new Set,e.set(t,r);for(const o of t)r.add(i_(o,e))}else if(t instanceof Object){r={},e.set(t,r);for(const[o,u]of Object.entries(t))r[o]=i_(u,e)}else throw Error(`Unable to clone ${t}`);return r}class em{constructor(e){this.type=void 0,this.deps=[],this.tests=void 0,this.transforms=void 0,this.conditions=[],this._mutate=void 0,this.internalTests={},this._whitelist=new nE,this._blacklist=new nE,this.exclusiveTests=Object.create(null),this._typeCheck=void 0,this.spec=void 0,this.tests=[],this.transforms=[],this.withMutation(()=>{this.typeError(uh.notType)}),this.type=e.type,this._typeCheck=e.check,this.spec=Object.assign({strip:!1,strict:!1,abortEarly:!0,recursive:!0,disableStackTrace:!1,nullable:!1,optional:!0,coerce:!0},e==null?void 0:e.spec),this.withMutation(r=>{r.nonNullable()})}get _type(){return this.type}clone(e){if(this._mutate)return e&&Object.assign(this.spec,e),this;const r=Object.create(Object.getPrototypeOf(this));return r.type=this.type,r._typeCheck=this._typeCheck,r._whitelist=this._whitelist.clone(),r._blacklist=this._blacklist.clone(),r.internalTests=Object.assign({},this.internalTests),r.exclusiveTests=Object.assign({},this.exclusiveTests),r.deps=[...this.deps],r.conditions=[...this.conditions],r.tests=[...this.tests],r.transforms=[...this.transforms],r.spec=i_(Object.assign({},this.spec,e)),r}label(e){let r=this.clone();return r.spec.label=e,r}meta(...e){if(e.length===0)return this.spec.meta;let r=this.clone();return r.spec.meta=Object.assign(r.spec.meta||{},e[0]),r}withMutation(e){let r=this._mutate;this._mutate=!0;let o=e(this);return this._mutate=r,o}concat(e){if(!e||e===this)return this;if(e.type!==this.type&&this.type!=="mixed")throw new TypeError(`You cannot \`concat()\` schema's of different types: ${this.type} and ${e.type}`);let r=this,o=e.clone();const u=Object.assign({},r.spec,o.spec);return o.spec=u,o.internalTests=Object.assign({},r.internalTests,o.internalTests),o._whitelist=r._whitelist.merge(e._whitelist,e._blacklist),o._blacklist=r._blacklist.merge(e._blacklist,e._whitelist),o.tests=r.tests,o.exclusiveTests=r.exclusiveTests,o.withMutation(f=>{e.tests.forEach(y=>{f.test(y.OPTIONS)})}),o.transforms=[...r.transforms,...o.transforms],o}isType(e){return e==null?!!(this.spec.nullable&&e===null||this.spec.optional&&e===void 0):this._typeCheck(e)}resolve(e){let r=this;if(r.conditions.length){let o=r.conditions;r=r.clone(),r.conditions=[],r=o.reduce((u,f)=>f.resolve(u,e),r),r=r.resolve(e)}return r}resolveOptions(e){var r,o,u,f;return Object.assign({},e,{from:e.from||[],strict:(r=e.strict)!=null?r:this.spec.strict,abortEarly:(o=e.abortEarly)!=null?o:this.spec.abortEarly,recursive:(u=e.recursive)!=null?u:this.spec.recursive,disableStackTrace:(f=e.disableStackTrace)!=null?f:this.spec.disableStackTrace})}cast(e,r={}){let o=this.resolve(Object.assign({value:e},r)),u=r.assert==="ignore-optionality",f=o._cast(e,r);if(r.assert!==!1&&!o.isType(f)){if(u&&d8(f))return f;let y=lf(e),T=lf(f);throw new TypeError(`The value of ${r.path||"field"} could not be cast to a value that satisfies the schema type: "${o.type}". 

attempted value: ${y} 
`+(T!==y?`result of cast: ${T}`:""))}return f}_cast(e,r){let o=e===void 0?e:this.transforms.reduce((u,f)=>f.call(this,u,e,this),e);return o===void 0&&(o=this.getDefault(r)),o}_validate(e,r={},o,u){let{path:f,originalValue:y=e,strict:T=this.spec.strict}=r,a=e;T||(a=this._cast(a,Object.assign({assert:!1},r)));let A=[];for(let D of Object.values(this.internalTests))D&&A.push(D);this.runTests({path:f,value:a,originalValue:y,options:r,tests:A},o,D=>{if(D.length)return u(D,a);this.runTests({path:f,value:a,originalValue:y,options:r,tests:this.tests},o,u)})}runTests(e,r,o){let u=!1,{tests:f,value:y,originalValue:T,path:a,options:A}=e,D=re=>{u||(u=!0,r(re,y))},O=re=>{u||(u=!0,o(re,y))},B=f.length,H=[];if(!B)return O([]);let Q={value:y,originalValue:T,path:a,options:A,schema:this};for(let re=0;re<f.length;re++){const se=f[re];se(Q,D,function(Y){Y&&(Array.isArray(Y)?H.push(...Y):H.push(Y)),--B<=0&&O(H)})}}asNestedTest({key:e,index:r,parent:o,parentPath:u,originalParent:f,options:y}){const T=e??r;if(T==null)throw TypeError("Must include `key` or `index` for nested validations");const a=typeof T=="number";let A=o[T];const D=Object.assign({},y,{strict:!0,parent:o,value:A,originalValue:f[T],key:void 0,[a?"index":"key"]:T,path:a||T.includes(".")?`${u||""}[${a?T:`"${T}"`}]`:(u?`${u}.`:"")+e});return(O,B,H)=>this.resolve(D)._validate(A,D,B,H)}validate(e,r){var o;let u=this.resolve(Object.assign({},r,{value:e})),f=(o=r==null?void 0:r.disableStackTrace)!=null?o:u.spec.disableStackTrace;return new Promise((y,T)=>u._validate(e,r,(a,A)=>{Ra.isError(a)&&(a.value=A),T(a)},(a,A)=>{a.length?T(new Ra(a,A,void 0,void 0,f)):y(A)}))}validateSync(e,r){var o;let u=this.resolve(Object.assign({},r,{value:e})),f,y=(o=r==null?void 0:r.disableStackTrace)!=null?o:u.spec.disableStackTrace;return u._validate(e,Object.assign({},r,{sync:!0}),(T,a)=>{throw Ra.isError(T)&&(T.value=a),T},(T,a)=>{if(T.length)throw new Ra(T,e,void 0,void 0,y);f=a}),f}isValid(e,r){return this.validate(e,r).then(()=>!0,o=>{if(Ra.isError(o))return!1;throw o})}isValidSync(e,r){try{return this.validateSync(e,r),!0}catch(o){if(Ra.isError(o))return!1;throw o}}_getDefault(e){let r=this.spec.default;return r==null?r:typeof r=="function"?r.call(this,e):i_(r)}getDefault(e){return this.resolve(e||{})._getDefault(e)}default(e){return arguments.length===0?this._getDefault():this.clone({default:e})}strict(e=!0){return this.clone({strict:e})}nullability(e,r){const o=this.clone({nullable:e});return o.internalTests.nullable=Rg({message:r,name:"nullable",test(u){return u===null?this.schema.spec.nullable:!0}}),o}optionality(e,r){const o=this.clone({optional:e});return o.internalTests.optionality=Rg({message:r,name:"optionality",test(u){return u===void 0?this.schema.spec.optional:!0}}),o}optional(){return this.optionality(!0)}defined(e=uh.defined){return this.optionality(!1,e)}nullable(){return this.nullability(!0)}nonNullable(e=uh.notNull){return this.nullability(!1,e)}required(e=uh.required){return this.clone().withMutation(r=>r.nonNullable(e).defined(e))}notRequired(){return this.clone().withMutation(e=>e.nullable().optional())}transform(e){let r=this.clone();return r.transforms.push(e),r}test(...e){let r;if(e.length===1?typeof e[0]=="function"?r={test:e[0]}:r=e[0]:e.length===2?r={name:e[0],test:e[1]}:r={name:e[0],message:e[1],test:e[2]},r.message===void 0&&(r.message=uh.default),typeof r.test!="function")throw new TypeError("`test` is a required parameters");let o=this.clone(),u=Rg(r),f=r.exclusive||r.name&&o.exclusiveTests[r.name]===!0;if(r.exclusive&&!r.name)throw new TypeError("Exclusive tests must provide a unique `name` identifying the test");return r.name&&(o.exclusiveTests[r.name]=!!r.exclusive),o.tests=o.tests.filter(y=>!(y.OPTIONS.name===r.name&&(f||y.OPTIONS.test===u.OPTIONS.test))),o.tests.push(u),o}when(e,r){!Array.isArray(e)&&typeof e!="string"&&(r=e,e=".");let o=this.clone(),u=a8(e).map(f=>new $x(f));return u.forEach(f=>{f.isSibling&&o.deps.push(f.key)}),o.conditions.push(typeof r=="function"?new tE(u,r):tE.fromOptions(u,r)),o}typeError(e){let r=this.clone();return r.internalTests.typeError=Rg({message:e,name:"typeError",skipAbsent:!0,test(o){return this.schema._typeCheck(o)?!0:this.createError({params:{type:this.schema.type}})}}),r}oneOf(e,r=uh.oneOf){let o=this.clone();return e.forEach(u=>{o._whitelist.add(u),o._blacklist.delete(u)}),o.internalTests.whiteList=Rg({message:r,name:"oneOf",skipAbsent:!0,test(u){let f=this.schema._whitelist,y=f.resolveAll(this.resolve);return y.includes(u)?!0:this.createError({params:{values:Array.from(f).join(", "),resolved:y}})}}),o}notOneOf(e,r=uh.notOneOf){let o=this.clone();return e.forEach(u=>{o._blacklist.add(u),o._whitelist.delete(u)}),o.internalTests.blacklist=Rg({message:r,name:"notOneOf",test(u){let f=this.schema._blacklist,y=f.resolveAll(this.resolve);return y.includes(u)?this.createError({params:{values:Array.from(f).join(", "),resolved:y}}):!0}}),o}strip(e=!0){let r=this.clone();return r.spec.strip=e,r}describe(e){const r=(e?this.resolve(e):this).clone(),{label:o,meta:u,optional:f,nullable:y}=r.spec;return{meta:u,label:o,optional:f,nullable:y,default:r.getDefault(e),type:r.type,oneOf:r._whitelist.describe(),notOneOf:r._blacklist.describe(),tests:r.tests.map(a=>({name:a.OPTIONS.name,params:a.OPTIONS.params})).filter((a,A,D)=>D.findIndex(O=>O.name===a.name)===A)}}}em.prototype.__isYupSchema__=!0;for(const t of["validate","validateSync"])em.prototype[`${t}At`]=function(e,r,o={}){const{parent:u,parentPath:f,schema:y}=qJ(this,e,r,o.context);return y[t](u&&u[f],Object.assign({},o,{parent:u,path:e}))};for(const t of["equals","is"])em.prototype[t]=em.prototype.oneOf;for(const t of["not","nope"])em.prototype[t]=em.prototype.notOneOf;const WJ=/^(\d{4}|[+-]\d{6})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:[ T]?(\d{2}):?(\d{2})(?::?(\d{2})(?:[,.](\d{1,}))?)?(?:(Z)|([+-])(\d{2})(?::?(\d{2}))?)?)?$/;function HJ(t){const e=ZJ(t);if(!e)return Date.parse?Date.parse(t):Number.NaN;if(e.z===void 0&&e.plusMinus===void 0)return new Date(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond).valueOf();let r=0;return e.z!=="Z"&&e.plusMinus!==void 0&&(r=e.hourOffset*60+e.minuteOffset,e.plusMinus==="+"&&(r=0-r)),Date.UTC(e.year,e.month,e.day,e.hour,e.minute+r,e.second,e.millisecond)}function ZJ(t){var e,r;const o=WJ.exec(t);return o?{year:oh(o[1]),month:oh(o[2],1)-1,day:oh(o[3],1),hour:oh(o[4]),minute:oh(o[5]),second:oh(o[6]),millisecond:o[7]?oh(o[7].substring(0,3)):0,precision:(e=(r=o[7])==null?void 0:r.length)!=null?e:void 0,z:o[8]||void 0,plusMinus:o[9]||void 0,hourOffset:oh(o[10]),minuteOffset:oh(o[11])}:null}function oh(t,e=0){return Number(t)||e}let XJ=new Date(""),KJ=t=>Object.prototype.toString.call(t)==="[object Date]";class G3 extends em{constructor(){super({type:"date",check(e){return KJ(e)&&!isNaN(e.getTime())}}),this.withMutation(()=>{this.transform((e,r,o)=>!o.spec.coerce||o.isType(e)||e===null?e:(e=HJ(e),isNaN(e)?G3.INVALID_DATE:new Date(e)))})}prepareParam(e,r){let o;if($x.isRef(e))o=e;else{let u=this.cast(e);if(!this._typeCheck(u))throw new TypeError(`\`${r}\` must be a Date or a value that can be \`cast()\` to a Date`);o=u}return o}min(e,r=fM.min){let o=this.prepareParam(e,"min");return this.test({message:r,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(u){return u>=this.resolve(o)}})}max(e,r=fM.max){let o=this.prepareParam(e,"max");return this.test({message:r,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(u){return u<=this.resolve(o)}})}}G3.INVALID_DATE=XJ;var OF={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f8=function(t){const e=[];let r=0;for(let o=0;o<t.length;o++){let u=t.charCodeAt(o);u<128?e[r++]=u:u<2048?(e[r++]=u>>6|192,e[r++]=u&63|128):(u&64512)===55296&&o+1<t.length&&(t.charCodeAt(o+1)&64512)===56320?(u=65536+((u&1023)<<10)+(t.charCodeAt(++o)&1023),e[r++]=u>>18|240,e[r++]=u>>12&63|128,e[r++]=u>>6&63|128,e[r++]=u&63|128):(e[r++]=u>>12|224,e[r++]=u>>6&63|128,e[r++]=u&63|128)}return e},YJ=function(t){const e=[];let r=0,o=0;for(;r<t.length;){const u=t[r++];if(u<128)e[o++]=String.fromCharCode(u);else if(u>191&&u<224){const f=t[r++];e[o++]=String.fromCharCode((u&31)<<6|f&63)}else if(u>239&&u<365){const f=t[r++],y=t[r++],T=t[r++],a=((u&7)<<18|(f&63)<<12|(y&63)<<6|T&63)-65536;e[o++]=String.fromCharCode(55296+(a>>10)),e[o++]=String.fromCharCode(56320+(a&1023))}else{const f=t[r++],y=t[r++];e[o++]=String.fromCharCode((u&15)<<12|(f&63)<<6|y&63)}}return e.join("")},p8={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let u=0;u<t.length;u+=3){const f=t[u],y=u+1<t.length,T=y?t[u+1]:0,a=u+2<t.length,A=a?t[u+2]:0,D=f>>2,O=(f&3)<<4|T>>4;let B=(T&15)<<2|A>>6,H=A&63;a||(H=64,y||(B=64)),o.push(r[D],r[O],r[B],r[H])}return o.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(f8(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):YJ(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let u=0;u<t.length;){const f=r[t.charAt(u++)],T=u<t.length?r[t.charAt(u)]:0;++u;const A=u<t.length?r[t.charAt(u)]:64;++u;const O=u<t.length?r[t.charAt(u)]:64;if(++u,f==null||T==null||A==null||O==null)throw new QJ;const B=f<<2|T>>4;if(o.push(B),A!==64){const H=T<<4&240|A>>2;if(o.push(H),O!==64){const Q=A<<6&192|O;o.push(Q)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class QJ extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const JJ=function(t){const e=f8(t);return p8.encodeByteArray(e,!0)},rE=function(t){return JJ(t).replace(/\./g,"")},m8=function(t){try{return p8.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e2(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t2=()=>e2().__FIREBASE_DEFAULTS__,n2=()=>{if(typeof process>"u"||typeof OF>"u")return;const t=OF.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},r2=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&m8(t[1]);return e&&JSON.parse(e)},bS=()=>{try{return t2()||n2()||r2()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},g8=t=>{var e,r;return(r=(e=bS())===null||e===void 0?void 0:e.emulatorHosts)===null||r===void 0?void 0:r[t]},_8=t=>{const e=g8(t);if(!e)return;const r=e.lastIndexOf(":");if(r<=0||r+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(r+1),10);return e[0]==="["?[e.substring(1,r-1),o]:[e.substring(0,r),o]},y8=()=>{var t;return(t=bS())===null||t===void 0?void 0:t.config},v8=t=>{var e;return(e=bS())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i2{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}wrapCallback(e){return(r,o)=>{r?this.reject(r):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(r):e(r,o))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x8(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r={alg:"none",type:"JWT"},o=e||"demo-project",u=t.iat||0,f=t.sub||t.user_id;if(!f)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const y=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:u,exp:u+3600,auth_time:u,sub:f,user_id:f,firebase:{sign_in_provider:"custom",identities:{}}},t);return[rE(JSON.stringify(r)),rE(JSON.stringify(y)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xo(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function s2(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Xo())}function o2(){var t;const e=(t=bS())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function a2(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function l2(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function c2(){const t=Xo();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function u2(){return!o2()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function h2(){try{return typeof indexedDB=="object"}catch{return!1}}function d2(){return new Promise((t,e)=>{try{let r=!0;const o="validate-browser-context-for-indexeddb-analytics-module",u=self.indexedDB.open(o);u.onsuccess=()=>{u.result.close(),r||self.indexedDB.deleteDatabase(o),t(!0)},u.onupgradeneeded=()=>{r=!1},u.onerror=()=>{var f;e(((f=u.error)===null||f===void 0?void 0:f.message)||"")}}catch(r){e(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f2="FirebaseError";class Pu extends Error{constructor(e,r,o){super(r),this.code=e,this.customData=o,this.name=f2,Object.setPrototypeOf(this,Pu.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Gx.prototype.create)}}class Gx{constructor(e,r,o){this.service=e,this.serviceName=r,this.errors=o}create(e,...r){const o=r[0]||{},u=`${this.service}/${e}`,f=this.errors[e],y=f?p2(f,o):"Error",T=`${this.serviceName}: ${y} (${u}).`;return new Pu(u,T,o)}}function p2(t,e){return t.replace(m2,(r,o)=>{const u=e[o];return u!=null?String(u):`<${o}?>`})}const m2=/\{\$([^}]+)}/g;function g2(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function D_(t,e){if(t===e)return!0;const r=Object.keys(t),o=Object.keys(e);for(const u of r){if(!o.includes(u))return!1;const f=t[u],y=e[u];if(LF(f)&&LF(y)){if(!D_(f,y))return!1}else if(f!==y)return!1}for(const u of o)if(!r.includes(u))return!1;return!0}function LF(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qx(t){const e=[];for(const[r,o]of Object.entries(t))Array.isArray(o)?o.forEach(u=>{e.push(encodeURIComponent(r)+"="+encodeURIComponent(u))}):e.push(encodeURIComponent(r)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function _2(t,e){const r=new y2(t,e);return r.subscribe.bind(r)}class y2{constructor(e,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{e(this)}).catch(o=>{this.error(o)})}next(e){this.forEachObserver(r=>{r.next(e)})}error(e){this.forEachObserver(r=>{r.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,r,o){let u;if(e===void 0&&r===void 0&&o===void 0)throw new Error("Missing Observer.");v2(e,["next","error","complete"])?u=e:u={next:e,error:r,complete:o},u.next===void 0&&(u.next=SP),u.error===void 0&&(u.error=SP),u.complete===void 0&&(u.complete=SP);const f=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?u.error(this.finalError):u.complete()}catch{}}),this.observers.push(u),f}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,e)}sendOne(e,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{r(this.observers[e])}catch(o){typeof console<"u"&&console.error&&console.error(o)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function v2(t,e){if(typeof t!="object"||t===null)return!1;for(const r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}function SP(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hs(t){return t&&t._delegate?t._delegate:t}class mf{constructor(e,r,o){this.name=e,this.instanceFactory=r,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cp="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x2{constructor(e,r){this.name=e,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const r=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(r)){const o=new i2;if(this.instancesDeferred.set(r,o),this.isInitialized(r)||this.shouldAutoInitialize())try{const u=this.getOrInitializeService({instanceIdentifier:r});u&&o.resolve(u)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(e){var r;const o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),u=(r=e==null?void 0:e.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(f){if(u)return null;throw f}else{if(u)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(w2(e))try{this.getOrInitializeService({instanceIdentifier:Cp})}catch{}for(const[r,o]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(r);try{const f=this.getOrInitializeService({instanceIdentifier:u});o.resolve(f)}catch{}}}}clearInstance(e=Cp){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...e.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Cp){return this.instances.has(e)}getOptions(e=Cp){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:r={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const u=this.getOrInitializeService({instanceIdentifier:o,options:r});for(const[f,y]of this.instancesDeferred.entries()){const T=this.normalizeInstanceIdentifier(f);o===T&&y.resolve(u)}return u}onInit(e,r){var o;const u=this.normalizeInstanceIdentifier(r),f=(o=this.onInitCallbacks.get(u))!==null&&o!==void 0?o:new Set;f.add(e),this.onInitCallbacks.set(u,f);const y=this.instances.get(u);return y&&e(y,u),()=>{f.delete(e)}}invokeOnInitCallbacks(e,r){const o=this.onInitCallbacks.get(r);if(o)for(const u of o)try{u(e,r)}catch{}}getOrInitializeService({instanceIdentifier:e,options:r={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:b2(e),options:r}),this.instances.set(e,o),this.instancesOptions.set(e,r),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=Cp){return this.component?this.component.multipleInstances?e:Cp:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function b2(t){return t===Cp?void 0:t}function w2(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T2{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const r=this.getProvider(e.name);if(r.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);r.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const r=new x2(e,this);return this.providers.set(e,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kr;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Kr||(Kr={}));const E2={debug:Kr.DEBUG,verbose:Kr.VERBOSE,info:Kr.INFO,warn:Kr.WARN,error:Kr.ERROR,silent:Kr.SILENT},S2=Kr.INFO,I2={[Kr.DEBUG]:"log",[Kr.VERBOSE]:"log",[Kr.INFO]:"info",[Kr.WARN]:"warn",[Kr.ERROR]:"error"},A2=(t,e,...r)=>{if(e<t.logLevel)return;const o=new Date().toISOString(),u=I2[e];if(u)console[u](`[${o}]  ${t.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class q3{constructor(e){this.name=e,this._logLevel=S2,this._logHandler=A2,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Kr))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?E2[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Kr.DEBUG,...e),this._logHandler(this,Kr.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Kr.VERBOSE,...e),this._logHandler(this,Kr.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Kr.INFO,...e),this._logHandler(this,Kr.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Kr.WARN,...e),this._logHandler(this,Kr.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Kr.ERROR,...e),this._logHandler(this,Kr.ERROR,...e)}}const C2=(t,e)=>e.some(r=>t instanceof r);let zF,NF;function P2(){return zF||(zF=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function R2(){return NF||(NF=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const b8=new WeakMap,pM=new WeakMap,w8=new WeakMap,IP=new WeakMap,W3=new WeakMap;function M2(t){const e=new Promise((r,o)=>{const u=()=>{t.removeEventListener("success",f),t.removeEventListener("error",y)},f=()=>{r(cf(t.result)),u()},y=()=>{o(t.error),u()};t.addEventListener("success",f),t.addEventListener("error",y)});return e.then(r=>{r instanceof IDBCursor&&b8.set(r,t)}).catch(()=>{}),W3.set(e,t),e}function k2(t){if(pM.has(t))return;const e=new Promise((r,o)=>{const u=()=>{t.removeEventListener("complete",f),t.removeEventListener("error",y),t.removeEventListener("abort",y)},f=()=>{r(),u()},y=()=>{o(t.error||new DOMException("AbortError","AbortError")),u()};t.addEventListener("complete",f),t.addEventListener("error",y),t.addEventListener("abort",y)});pM.set(t,e)}let mM={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return pM.get(t);if(e==="objectStoreNames")return t.objectStoreNames||w8.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return cf(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function D2(t){mM=t(mM)}function O2(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){const o=t.call(AP(this),e,...r);return w8.set(o,e.sort?e.sort():[e]),cf(o)}:R2().includes(t)?function(...e){return t.apply(AP(this),e),cf(b8.get(this))}:function(...e){return cf(t.apply(AP(this),e))}}function L2(t){return typeof t=="function"?O2(t):(t instanceof IDBTransaction&&k2(t),C2(t,P2())?new Proxy(t,mM):t)}function cf(t){if(t instanceof IDBRequest)return M2(t);if(IP.has(t))return IP.get(t);const e=L2(t);return e!==t&&(IP.set(t,e),W3.set(e,t)),e}const AP=t=>W3.get(t);function z2(t,e,{blocked:r,upgrade:o,blocking:u,terminated:f}={}){const y=indexedDB.open(t,e),T=cf(y);return o&&y.addEventListener("upgradeneeded",a=>{o(cf(y.result),a.oldVersion,a.newVersion,cf(y.transaction),a)}),r&&y.addEventListener("blocked",a=>r(a.oldVersion,a.newVersion,a)),T.then(a=>{f&&a.addEventListener("close",()=>f()),u&&a.addEventListener("versionchange",A=>u(A.oldVersion,A.newVersion,A))}).catch(()=>{}),T}const N2=["get","getKey","getAll","getAllKeys","count"],F2=["put","add","delete","clear"],CP=new Map;function FF(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(CP.get(e))return CP.get(e);const r=e.replace(/FromIndex$/,""),o=e!==r,u=F2.includes(r);if(!(r in(o?IDBIndex:IDBObjectStore).prototype)||!(u||N2.includes(r)))return;const f=async function(y,...T){const a=this.transaction(y,u?"readwrite":"readonly");let A=a.store;return o&&(A=A.index(T.shift())),(await Promise.all([A[r](...T),u&&a.done]))[0]};return CP.set(e,f),f}D2(t=>({...t,get:(e,r,o)=>FF(e,r)||t.get(e,r,o),has:(e,r)=>!!FF(e,r)||t.has(e,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B2{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(U2(r)){const o=r.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(r=>r).join(" ")}}function U2(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const gM="@firebase/app",BF="0.10.10";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ch=new q3("@firebase/app"),V2="@firebase/app-compat",j2="@firebase/analytics-compat",$2="@firebase/analytics",G2="@firebase/app-check-compat",q2="@firebase/app-check",W2="@firebase/auth",H2="@firebase/auth-compat",Z2="@firebase/database",X2="@firebase/database-compat",K2="@firebase/functions",Y2="@firebase/functions-compat",Q2="@firebase/installations",J2="@firebase/installations-compat",eee="@firebase/messaging",tee="@firebase/messaging-compat",nee="@firebase/performance",ree="@firebase/performance-compat",iee="@firebase/remote-config",see="@firebase/remote-config-compat",oee="@firebase/storage",aee="@firebase/storage-compat",lee="@firebase/firestore",cee="@firebase/vertexai-preview",uee="@firebase/firestore-compat",hee="firebase",dee="10.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _M="[DEFAULT]",fee={[gM]:"fire-core",[V2]:"fire-core-compat",[$2]:"fire-analytics",[j2]:"fire-analytics-compat",[q2]:"fire-app-check",[G2]:"fire-app-check-compat",[W2]:"fire-auth",[H2]:"fire-auth-compat",[Z2]:"fire-rtdb",[X2]:"fire-rtdb-compat",[K2]:"fire-fn",[Y2]:"fire-fn-compat",[Q2]:"fire-iid",[J2]:"fire-iid-compat",[eee]:"fire-fcm",[tee]:"fire-fcm-compat",[nee]:"fire-perf",[ree]:"fire-perf-compat",[iee]:"fire-rc",[see]:"fire-rc-compat",[oee]:"fire-gcs",[aee]:"fire-gcs-compat",[lee]:"fire-fst",[uee]:"fire-fst-compat",[cee]:"fire-vertex","fire-js":"fire-js",[hee]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iE=new Map,pee=new Map,yM=new Map;function UF(t,e){try{t.container.addComponent(e)}catch(r){Ch.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,r)}}function tm(t){const e=t.name;if(yM.has(e))return Ch.debug(`There were multiple attempts to register component ${e}.`),!1;yM.set(e,t);for(const r of iE.values())UF(r,t);for(const r of pee.values())UF(r,t);return!0}function wS(t,e){const r=t.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),t.container.getProvider(e)}function Zd(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mee={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},uf=new Gx("app","Firebase",mee);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gee{constructor(e,r,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new mf("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw uf.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gm=dee;function T8(t,e={}){let r=t;typeof e!="object"&&(e={name:e});const o=Object.assign({name:_M,automaticDataCollectionEnabled:!1},e),u=o.name;if(typeof u!="string"||!u)throw uf.create("bad-app-name",{appName:String(u)});if(r||(r=y8()),!r)throw uf.create("no-options");const f=iE.get(u);if(f){if(D_(r,f.options)&&D_(o,f.config))return f;throw uf.create("duplicate-app",{appName:u})}const y=new T2(u);for(const a of yM.values())y.addComponent(a);const T=new gee(r,o,y);return iE.set(u,T),T}function H3(t=_M){const e=iE.get(t);if(!e&&t===_M&&y8())return T8();if(!e)throw uf.create("no-app",{appName:t});return e}function xu(t,e,r){var o;let u=(o=fee[t])!==null&&o!==void 0?o:t;r&&(u+=`-${r}`);const f=u.match(/\s|\//),y=e.match(/\s|\//);if(f||y){const T=[`Unable to register library "${u}" with version "${e}":`];f&&T.push(`library name "${u}" contains illegal characters (whitespace or "/")`),f&&y&&T.push("and"),y&&T.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ch.warn(T.join(" "));return}tm(new mf(`${u}-version`,()=>({library:u,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _ee="firebase-heartbeat-database",yee=1,dx="firebase-heartbeat-store";let PP=null;function E8(){return PP||(PP=z2(_ee,yee,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(dx)}catch(r){console.warn(r)}}}}).catch(t=>{throw uf.create("idb-open",{originalErrorMessage:t.message})})),PP}async function vee(t){try{const r=(await E8()).transaction(dx),o=await r.objectStore(dx).get(S8(t));return await r.done,o}catch(e){if(e instanceof Pu)Ch.warn(e.message);else{const r=uf.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ch.warn(r.message)}}}async function VF(t,e){try{const o=(await E8()).transaction(dx,"readwrite");await o.objectStore(dx).put(e,S8(t)),await o.done}catch(r){if(r instanceof Pu)Ch.warn(r.message);else{const o=uf.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});Ch.warn(o.message)}}}function S8(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xee=1024,bee=30*24*60*60*1e3;class wee{constructor(e){this.container=e,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new Eee(r),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){var e,r;try{const u=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),f=jF();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===f||this._heartbeatsCache.heartbeats.some(y=>y.date===f)?void 0:(this._heartbeatsCache.heartbeats.push({date:f,agent:u}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(y=>{const T=new Date(y.date).valueOf();return Date.now()-T<=bee}),this._storage.overwrite(this._heartbeatsCache))}catch(o){Ch.warn(o)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const r=jF(),{heartbeatsToSend:o,unsentEntries:u}=Tee(this._heartbeatsCache.heartbeats),f=rE(JSON.stringify({version:2,heartbeats:o}));return this._heartbeatsCache.lastSentHeartbeatDate=r,u.length>0?(this._heartbeatsCache.heartbeats=u,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),f}catch(r){return Ch.warn(r),""}}}function jF(){return new Date().toISOString().substring(0,10)}function Tee(t,e=xee){const r=[];let o=t.slice();for(const u of t){const f=r.find(y=>y.agent===u.agent);if(f){if(f.dates.push(u.date),$F(r)>e){f.dates.pop();break}}else if(r.push({agent:u.agent,dates:[u.date]}),$F(r)>e){r.pop();break}o=o.slice(1)}return{heartbeatsToSend:r,unsentEntries:o}}class Eee{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return h2()?d2().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const r=await vee(this.app);return r!=null&&r.heartbeats?r:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var r;if(await this._canUseIndexedDBPromise){const u=await this.read();return VF(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:u.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var r;if(await this._canUseIndexedDBPromise){const u=await this.read();return VF(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:u.lastSentHeartbeatDate,heartbeats:[...u.heartbeats,...e.heartbeats]})}else return}}function $F(t){return rE(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function See(t){tm(new mf("platform-logger",e=>new B2(e),"PRIVATE")),tm(new mf("heartbeat",e=>new wee(e),"PRIVATE")),xu(gM,BF,t),xu(gM,BF,"esm2017"),xu("fire-js","")}See("");var Iee="firebase",Aee="10.13.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */xu(Iee,Aee,"app");function Z3(t,e){var r={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(r[o]=t[o]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,o=Object.getOwnPropertySymbols(t);u<o.length;u++)e.indexOf(o[u])<0&&Object.prototype.propertyIsEnumerable.call(t,o[u])&&(r[o[u]]=t[o[u]]);return r}function I8(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Cee=I8,A8=new Gx("auth","Firebase",I8());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sE=new q3("@firebase/auth");function Pee(t,...e){sE.logLevel<=Kr.WARN&&sE.warn(`Auth (${gm}): ${t}`,...e)}function aT(t,...e){sE.logLevel<=Kr.ERROR&&sE.error(`Auth (${gm}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ph(t,...e){throw X3(t,...e)}function bu(t,...e){return X3(t,...e)}function C8(t,e,r){const o=Object.assign(Object.assign({},Cee()),{[e]:r});return new Gx("auth","Firebase",o).create(e,{appName:t.name})}function jp(t){return C8(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function X3(t,...e){if(typeof t!="string"){const r=e[0],o=[...e.slice(1)];return o[0]&&(o[0].appName=t.name),t._errorFactory.create(r,...o)}return A8.create(t,...e)}function vr(t,e,...r){if(!t)throw X3(e,...r)}function _h(t){const e="INTERNAL ASSERTION FAILED: "+t;throw aT(e),new Error(e)}function Rh(t,e){t||_h(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vM(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function Ree(){return GF()==="http:"||GF()==="https:"}function GF(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mee(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Ree()||a2()||"connection"in navigator)?navigator.onLine:!0}function kee(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wx{constructor(e,r){this.shortDelay=e,this.longDelay=r,Rh(r>e,"Short delay should be less than long delay!"),this.isMobile=s2()||l2()}get(){return Mee()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K3(t,e){Rh(t.emulator,"Emulator should always be set here");const{url:r}=t.emulator;return e?`${r}${e.startsWith("/")?e.slice(1):e}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P8{static initialize(e,r,o){this.fetchImpl=e,r&&(this.headersImpl=r),o&&(this.responseImpl=o)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;_h("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;_h("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;_h("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dee={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oee=new Wx(3e4,6e4);function Y3(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function ry(t,e,r,o,u={}){return R8(t,u,async()=>{let f={},y={};o&&(e==="GET"?y=o:f={body:JSON.stringify(o)});const T=qx(Object.assign({key:t.config.apiKey},y)).slice(1),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/json",t.languageCode&&(a["X-Firebase-Locale"]=t.languageCode),P8.fetch()(M8(t,t.config.apiHost,r,T),Object.assign({method:e,headers:a,referrerPolicy:"no-referrer"},f))})}async function R8(t,e,r){t._canInitEmulator=!1;const o=Object.assign(Object.assign({},Dee),e);try{const u=new zee(t),f=await Promise.race([r(),u.promise]);u.clearNetworkTimeout();const y=await f.json();if("needConfirmation"in y)throw Aw(t,"account-exists-with-different-credential",y);if(f.ok&&!("errorMessage"in y))return y;{const T=f.ok?y.errorMessage:y.error.message,[a,A]=T.split(" : ");if(a==="FEDERATED_USER_ID_ALREADY_LINKED")throw Aw(t,"credential-already-in-use",y);if(a==="EMAIL_EXISTS")throw Aw(t,"email-already-in-use",y);if(a==="USER_DISABLED")throw Aw(t,"user-disabled",y);const D=o[a]||a.toLowerCase().replace(/[_\s]+/g,"-");if(A)throw C8(t,D,A);Ph(t,D)}}catch(u){if(u instanceof Pu)throw u;Ph(t,"network-request-failed",{message:String(u)})}}async function Lee(t,e,r,o,u={}){const f=await ry(t,e,r,o,u);return"mfaPendingCredential"in f&&Ph(t,"multi-factor-auth-required",{_serverResponse:f}),f}function M8(t,e,r,o){const u=`${e}${r}?${o}`;return t.config.emulator?K3(t.config,u):`${t.config.apiScheme}://${u}`}class zee{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((r,o)=>{this.timer=setTimeout(()=>o(bu(this.auth,"network-request-failed")),Oee.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Aw(t,e,r){const o={appName:t.name};r.email&&(o.email=r.email),r.phoneNumber&&(o.phoneNumber=r.phoneNumber);const u=bu(t,e,o);return u.customData._tokenResponse=r,u}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nee(t,e){return ry(t,"POST","/v1/accounts:delete",e)}async function k8(t,e){return ry(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rv(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Fee(t,e=!1){const r=Hs(t),o=await r.getIdToken(e),u=Q3(o);vr(u&&u.exp&&u.auth_time&&u.iat,r.auth,"internal-error");const f=typeof u.firebase=="object"?u.firebase:void 0,y=f==null?void 0:f.sign_in_provider;return{claims:u,token:o,authTime:Rv(RP(u.auth_time)),issuedAtTime:Rv(RP(u.iat)),expirationTime:Rv(RP(u.exp)),signInProvider:y||null,signInSecondFactor:(f==null?void 0:f.sign_in_second_factor)||null}}function RP(t){return Number(t)*1e3}function Q3(t){const[e,r,o]=t.split(".");if(e===void 0||r===void 0||o===void 0)return aT("JWT malformed, contained fewer than 3 sections"),null;try{const u=m8(r);return u?JSON.parse(u):(aT("Failed to decode base64 JWT payload"),null)}catch(u){return aT("Caught error parsing JWT payload as JSON",u==null?void 0:u.toString()),null}}function qF(t){const e=Q3(t);return vr(e,"internal-error"),vr(typeof e.exp<"u","internal-error"),vr(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fx(t,e,r=!1){if(r)return e;try{return await e}catch(o){throw o instanceof Pu&&Bee(o)&&t.auth.currentUser===t&&await t.auth.signOut(),o}}function Bee({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uee{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var r;if(e){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const u=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,u)}}schedule(e=!1){if(!this.isRunning)return;const r=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xM{constructor(e,r){this.createdAt=e,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=Rv(this.lastLoginAt),this.creationTime=Rv(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oE(t){var e;const r=t.auth,o=await t.getIdToken(),u=await fx(t,k8(r,{idToken:o}));vr(u==null?void 0:u.users.length,r,"internal-error");const f=u.users[0];t._notifyReloadListener(f);const y=!((e=f.providerUserInfo)===null||e===void 0)&&e.length?D8(f.providerUserInfo):[],T=jee(t.providerData,y),a=t.isAnonymous,A=!(t.email&&f.passwordHash)&&!(T!=null&&T.length),D=a?A:!1,O={uid:f.localId,displayName:f.displayName||null,photoURL:f.photoUrl||null,email:f.email||null,emailVerified:f.emailVerified||!1,phoneNumber:f.phoneNumber||null,tenantId:f.tenantId||null,providerData:T,metadata:new xM(f.createdAt,f.lastLoginAt),isAnonymous:D};Object.assign(t,O)}async function Vee(t){const e=Hs(t);await oE(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function jee(t,e){return[...t.filter(o=>!e.some(u=>u.providerId===o.providerId)),...e]}function D8(t){return t.map(e=>{var{providerId:r}=e,o=Z3(e,["providerId"]);return{providerId:r,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $ee(t,e){const r=await R8(t,{},async()=>{const o=qx({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:u,apiKey:f}=t.config,y=M8(t,u,"/v1/token",`key=${f}`),T=await t._getAdditionalHeaders();return T["Content-Type"]="application/x-www-form-urlencoded",P8.fetch()(y,{method:"POST",headers:T,body:o})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function Gee(t,e){return ry(t,"POST","/v2/accounts:revokeToken",Y3(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g_{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){vr(e.idToken,"internal-error"),vr(typeof e.idToken<"u","internal-error"),vr(typeof e.refreshToken<"u","internal-error");const r="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):qF(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,r)}updateFromIdToken(e){vr(e.length!==0,"internal-error");const r=qF(e);this.updateTokensAndExpiration(e,null,r)}async getToken(e,r=!1){return!r&&this.accessToken&&!this.isExpired?this.accessToken:(vr(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,r){const{accessToken:o,refreshToken:u,expiresIn:f}=await $ee(e,r);this.updateTokensAndExpiration(o,u,Number(f))}updateTokensAndExpiration(e,r,o){this.refreshToken=r||null,this.accessToken=e||null,this.expirationTime=Date.now()+o*1e3}static fromJSON(e,r){const{refreshToken:o,accessToken:u,expirationTime:f}=r,y=new g_;return o&&(vr(typeof o=="string","internal-error",{appName:e}),y.refreshToken=o),u&&(vr(typeof u=="string","internal-error",{appName:e}),y.accessToken=u),f&&(vr(typeof f=="number","internal-error",{appName:e}),y.expirationTime=f),y}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new g_,this.toJSON())}_performRefresh(){return _h("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kd(t,e){vr(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class yh{constructor(e){var{uid:r,auth:o,stsTokenManager:u}=e,f=Z3(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Uee(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=o,this.stsTokenManager=u,this.accessToken=u.accessToken,this.displayName=f.displayName||null,this.email=f.email||null,this.emailVerified=f.emailVerified||!1,this.phoneNumber=f.phoneNumber||null,this.photoURL=f.photoURL||null,this.isAnonymous=f.isAnonymous||!1,this.tenantId=f.tenantId||null,this.providerData=f.providerData?[...f.providerData]:[],this.metadata=new xM(f.createdAt||void 0,f.lastLoginAt||void 0)}async getIdToken(e){const r=await fx(this,this.stsTokenManager.getToken(this.auth,e));return vr(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(e){return Fee(this,e)}reload(){return Vee(this)}_assign(e){this!==e&&(vr(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(r=>Object.assign({},r)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const r=new yh(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(e){vr(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,r=!1){let o=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),o=!0),r&&await oE(this),await this.auth._persistUserIfCurrent(this),o&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Zd(this.auth.app))return Promise.reject(jp(this.auth));const e=await this.getIdToken();return await fx(this,Nee(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,r){var o,u,f,y,T,a,A,D;const O=(o=r.displayName)!==null&&o!==void 0?o:void 0,B=(u=r.email)!==null&&u!==void 0?u:void 0,H=(f=r.phoneNumber)!==null&&f!==void 0?f:void 0,Q=(y=r.photoURL)!==null&&y!==void 0?y:void 0,re=(T=r.tenantId)!==null&&T!==void 0?T:void 0,se=(a=r._redirectEventId)!==null&&a!==void 0?a:void 0,G=(A=r.createdAt)!==null&&A!==void 0?A:void 0,Y=(D=r.lastLoginAt)!==null&&D!==void 0?D:void 0,{uid:Z,emailVerified:fe,isAnonymous:Te,providerData:Pe,stsTokenManager:ce}=r;vr(Z&&ce,e,"internal-error");const he=g_.fromJSON(this.name,ce);vr(typeof Z=="string",e,"internal-error"),kd(O,e.name),kd(B,e.name),vr(typeof fe=="boolean",e,"internal-error"),vr(typeof Te=="boolean",e,"internal-error"),kd(H,e.name),kd(Q,e.name),kd(re,e.name),kd(se,e.name),kd(G,e.name),kd(Y,e.name);const W=new yh({uid:Z,auth:e,email:B,emailVerified:fe,displayName:O,isAnonymous:Te,photoURL:Q,phoneNumber:H,tenantId:re,stsTokenManager:he,createdAt:G,lastLoginAt:Y});return Pe&&Array.isArray(Pe)&&(W.providerData=Pe.map(ge=>Object.assign({},ge))),se&&(W._redirectEventId=se),W}static async _fromIdTokenResponse(e,r,o=!1){const u=new g_;u.updateFromServerResponse(r);const f=new yh({uid:r.localId,auth:e,stsTokenManager:u,isAnonymous:o});return await oE(f),f}static async _fromGetAccountInfoResponse(e,r,o){const u=r.users[0];vr(u.localId!==void 0,"internal-error");const f=u.providerUserInfo!==void 0?D8(u.providerUserInfo):[],y=!(u.email&&u.passwordHash)&&!(f!=null&&f.length),T=new g_;T.updateFromIdToken(o);const a=new yh({uid:u.localId,auth:e,stsTokenManager:T,isAnonymous:y}),A={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:f,metadata:new xM(u.createdAt,u.lastLoginAt),isAnonymous:!(u.email&&u.passwordHash)&&!(f!=null&&f.length)};return Object.assign(a,A),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WF=new Map;function vh(t){Rh(t instanceof Function,"Expected a class definition");let e=WF.get(t);return e?(Rh(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,WF.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O8{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,r){this.storage[e]=r}async _get(e){const r=this.storage[e];return r===void 0?null:r}async _remove(e){delete this.storage[e]}_addListener(e,r){}_removeListener(e,r){}}O8.type="NONE";const HF=O8;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lT(t,e,r){return`firebase:${t}:${e}:${r}`}class __{constructor(e,r,o){this.persistence=e,this.auth=r,this.userKey=o;const{config:u,name:f}=this.auth;this.fullUserKey=lT(this.userKey,u.apiKey,f),this.fullPersistenceKey=lT("persistence",u.apiKey,f),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?yh._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,r,o="authUser"){if(!r.length)return new __(vh(HF),e,o);const u=(await Promise.all(r.map(async A=>{if(await A._isAvailable())return A}))).filter(A=>A);let f=u[0]||vh(HF);const y=lT(o,e.config.apiKey,e.name);let T=null;for(const A of r)try{const D=await A._get(y);if(D){const O=yh._fromJSON(e,D);A!==f&&(T=O),f=A;break}}catch{}const a=u.filter(A=>A._shouldAllowMigration);return!f._shouldAllowMigration||!a.length?new __(f,e,o):(f=a[0],T&&await f._set(y,T.toJSON()),await Promise.all(r.map(async A=>{if(A!==f)try{await A._remove(y)}catch{}})),new __(f,e,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZF(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(F8(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(L8(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(U8(e))return"Blackberry";if(V8(e))return"Webos";if(z8(e))return"Safari";if((e.includes("chrome/")||N8(e))&&!e.includes("edge/"))return"Chrome";if(B8(e))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,o=t.match(r);if((o==null?void 0:o.length)===2)return o[1]}return"Other"}function L8(t=Xo()){return/firefox\//i.test(t)}function z8(t=Xo()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function N8(t=Xo()){return/crios\//i.test(t)}function F8(t=Xo()){return/iemobile/i.test(t)}function B8(t=Xo()){return/android/i.test(t)}function U8(t=Xo()){return/blackberry/i.test(t)}function V8(t=Xo()){return/webos/i.test(t)}function J3(t=Xo()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function qee(t=Xo()){var e;return J3(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Wee(){return c2()&&document.documentMode===10}function j8(t=Xo()){return J3(t)||B8(t)||V8(t)||U8(t)||/windows phone/i.test(t)||F8(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $8(t,e=[]){let r;switch(t){case"Browser":r=ZF(Xo());break;case"Worker":r=`${ZF(Xo())}-${t}`;break;default:r=t}const o=e.length?e.join(","):"FirebaseCore-web";return`${r}/JsCore/${gm}/${o}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hee{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,r){const o=f=>new Promise((y,T)=>{try{const a=e(f);y(a)}catch(a){T(a)}});o.onAbort=r,this.queue.push(o);const u=this.queue.length-1;return()=>{this.queue[u]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const r=[];try{for(const o of this.queue)await o(e),o.onAbort&&r.push(o.onAbort)}catch(o){r.reverse();for(const u of r)try{u()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:o==null?void 0:o.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zee(t,e={}){return ry(t,"GET","/v2/passwordPolicy",Y3(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xee=6;class Kee{constructor(e){var r,o,u,f;const y=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(r=y.minPasswordLength)!==null&&r!==void 0?r:Xee,y.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=y.maxPasswordLength),y.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=y.containsLowercaseCharacter),y.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=y.containsUppercaseCharacter),y.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=y.containsNumericCharacter),y.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=y.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(u=(o=e.allowedNonAlphanumericCharacters)===null||o===void 0?void 0:o.join(""))!==null&&u!==void 0?u:"",this.forceUpgradeOnSignin=(f=e.forceUpgradeOnSignin)!==null&&f!==void 0?f:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var r,o,u,f,y,T;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=(r=a.meetsMinPasswordLength)!==null&&r!==void 0?r:!0),a.isValid&&(a.isValid=(o=a.meetsMaxPasswordLength)!==null&&o!==void 0?o:!0),a.isValid&&(a.isValid=(u=a.containsLowercaseLetter)!==null&&u!==void 0?u:!0),a.isValid&&(a.isValid=(f=a.containsUppercaseLetter)!==null&&f!==void 0?f:!0),a.isValid&&(a.isValid=(y=a.containsNumericCharacter)!==null&&y!==void 0?y:!0),a.isValid&&(a.isValid=(T=a.containsNonAlphanumericCharacter)!==null&&T!==void 0?T:!0),a}validatePasswordLengthOptions(e,r){const o=this.customStrengthOptions.minPasswordLength,u=this.customStrengthOptions.maxPasswordLength;o&&(r.meetsMinPasswordLength=e.length>=o),u&&(r.meetsMaxPasswordLength=e.length<=u)}validatePasswordCharacterOptions(e,r){this.updatePasswordCharacterOptionsStatuses(r,!1,!1,!1,!1);let o;for(let u=0;u<e.length;u++)o=e.charAt(u),this.updatePasswordCharacterOptionsStatuses(r,o>="a"&&o<="z",o>="A"&&o<="Z",o>="0"&&o<="9",this.allowedNonAlphanumericCharacters.includes(o))}updatePasswordCharacterOptionsStatuses(e,r,o,u,f){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=r)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=o)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=u)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yee{constructor(e,r,o,u){this.app=e,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=o,this.config=u,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new XF(this),this.idTokenSubscription=new XF(this),this.beforeStateQueue=new Hee(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=A8,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=u.sdkClientVersion}_initializeWithPersistence(e,r){return r&&(this._popupRedirectResolver=vh(r)),this._initializationPromise=this.queue(async()=>{var o,u;if(!this._deleted&&(this.persistenceManager=await __.create(this,e),!this._deleted)){if(!((o=this._popupRedirectResolver)===null||o===void 0)&&o._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((u=this.currentUser)===null||u===void 0?void 0:u.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const r=await k8(this,{idToken:e}),o=await yh._fromGetAccountInfoResponse(this,r,e);await this.directlySetCurrentUser(o)}catch(r){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",r),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var r;if(Zd(this.app)){const y=this.app.settings.authIdToken;return y?new Promise(T=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(y).then(T,T))}):this.directlySetCurrentUser(null)}const o=await this.assertedPersistence.getCurrentUser();let u=o,f=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const y=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,T=u==null?void 0:u._redirectEventId,a=await this.tryRedirectSignIn(e);(!y||y===T)&&(a!=null&&a.user)&&(u=a.user,f=!0)}if(!u)return this.directlySetCurrentUser(null);if(!u._redirectEventId){if(f)try{await this.beforeStateQueue.runMiddleware(u)}catch(y){u=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(y))}return u?this.reloadAndSetCurrentUserOrClear(u):this.directlySetCurrentUser(null)}return vr(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===u._redirectEventId?this.directlySetCurrentUser(u):this.reloadAndSetCurrentUserOrClear(u)}async tryRedirectSignIn(e){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(e){try{await oE(e)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=kee()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Zd(this.app))return Promise.reject(jp(this));const r=e?Hs(e):null;return r&&vr(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(e,r=!1){if(!this._deleted)return e&&vr(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Zd(this.app)?Promise.reject(jp(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Zd(this.app)?Promise.reject(jp(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(vh(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const r=this._getPasswordPolicyInternal();return r.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):r.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Zee(this),r=new Kee(e);this.tenantId===null?this._projectPasswordPolicy=r:this._tenantPasswordPolicies[this.tenantId]=r}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Gx("auth","Firebase",e())}onAuthStateChanged(e,r,o){return this.registerStateListener(this.authStateSubscription,e,r,o)}beforeAuthStateChanged(e,r){return this.beforeStateQueue.pushCallback(e,r)}onIdTokenChanged(e,r,o){return this.registerStateListener(this.idTokenSubscription,e,r,o)}authStateReady(){return new Promise((e,r)=>{if(this.currentUser)e();else{const o=this.onAuthStateChanged(()=>{o(),e()},r)}})}async revokeAccessToken(e){if(this.currentUser){const r=await this.currentUser.getIdToken(),o={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:r};this.tenantId!=null&&(o.tenantId=this.tenantId),await Gee(this,o)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,r){const o=await this.getOrInitRedirectPersistenceManager(r);return e===null?o.removeCurrentUser():o.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const r=e&&vh(e)||this._popupRedirectResolver;vr(r,this,"argument-error"),this.redirectPersistenceManager=await __.create(this,[vh(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var r,o;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===e?this._currentUser:((o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const o=(r=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==o&&(this.lastNotifiedUid=o,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,r,o,u){if(this._deleted)return()=>{};const f=typeof r=="function"?r:r.next.bind(r);let y=!1;const T=this._isInitialized?Promise.resolve():this._initializationPromise;if(vr(T,this,"internal-error"),T.then(()=>{y||f(this.currentUser)}),typeof r=="function"){const a=e.addObserver(r,o,u);return()=>{y=!0,a()}}else{const a=e.addObserver(r);return()=>{y=!0,a()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return vr(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=$8(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const r={"X-Client-Version":this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const o=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());o&&(r["X-Firebase-Client"]=o);const u=await this._getAppCheckToken();return u&&(r["X-Firebase-AppCheck"]=u),r}async _getAppCheckToken(){var e;const r=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return r!=null&&r.error&&Pee(`Error while retrieving App Check token: ${r.error}`),r==null?void 0:r.token}}function eD(t){return Hs(t)}class XF{constructor(e){this.auth=e,this.observer=null,this.addObserver=_2(r=>this.observer=r)}get next(){return vr(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tD={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Qee(t){tD=t}function Jee(t){return tD.loadJS(t)}function ete(){return tD.gapiScript}function tte(t){return`__${t}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nte(t,e){const r=wS(t,"auth");if(r.isInitialized()){const u=r.getImmediate(),f=r.getOptions();if(D_(f,e??{}))return u;Ph(u,"already-initialized")}return r.initialize({options:e})}function rte(t,e){const r=(e==null?void 0:e.persistence)||[],o=(Array.isArray(r)?r:[r]).map(vh);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(o,e==null?void 0:e.popupRedirectResolver)}function ite(t,e,r){const o=eD(t);vr(o._canInitEmulator,o,"emulator-config-failed"),vr(/^https?:\/\//.test(e),o,"invalid-emulator-scheme");const u=!1,f=G8(e),{host:y,port:T}=ste(e),a=T===null?"":`:${T}`;o.config.emulator={url:`${f}//${y}${a}/`},o.settings.appVerificationDisabledForTesting=!0,o.emulatorConfig=Object.freeze({host:y,port:T,protocol:f.replace(":",""),options:Object.freeze({disableWarnings:u})}),ote()}function G8(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function ste(t){const e=G8(t),r=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!r)return{host:"",port:null};const o=r[2].split("@").pop()||"",u=/^(\[[^\]]+\])(:|$)/.exec(o);if(u){const f=u[1];return{host:f,port:KF(o.substr(f.length+1))}}else{const[f,y]=o.split(":");return{host:f,port:KF(y)}}}function KF(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function ote(){function t(){const e=document.createElement("p"),r=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q8{constructor(e,r){this.providerId=e,this.signInMethod=r}toJSON(){return _h("not implemented")}_getIdTokenResponse(e){return _h("not implemented")}_linkToIdToken(e,r){return _h("not implemented")}_getReauthenticationResolver(e){return _h("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y_(t,e){return Lee(t,"POST","/v1/accounts:signInWithIdp",Y3(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ate="http://localhost";class nm extends q8{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const r=new nm(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(r.idToken=e.idToken),e.accessToken&&(r.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(r.nonce=e.nonce),e.pendingToken&&(r.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(r.accessToken=e.oauthToken,r.secret=e.oauthTokenSecret):Ph("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e,{providerId:o,signInMethod:u}=r,f=Z3(r,["providerId","signInMethod"]);if(!o||!u)return null;const y=new nm(o,u);return y.idToken=f.idToken||void 0,y.accessToken=f.accessToken||void 0,y.secret=f.secret,y.nonce=f.nonce,y.pendingToken=f.pendingToken||null,y}_getIdTokenResponse(e){const r=this.buildRequest();return y_(e,r)}_linkToIdToken(e,r){const o=this.buildRequest();return o.idToken=r,y_(e,o)}_getReauthenticationResolver(e){const r=this.buildRequest();return r.autoCreate=!1,y_(e,r)}buildRequest(){const e={requestUri:ate,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),e.postBody=qx(r)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W8{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hx extends W8{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vd extends Hx{constructor(){super("facebook.com")}static credential(e){return nm._fromParams({providerId:Vd.PROVIDER_ID,signInMethod:Vd.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Vd.credentialFromTaggedObject(e)}static credentialFromError(e){return Vd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Vd.credential(e.oauthAccessToken)}catch{return null}}}Vd.FACEBOOK_SIGN_IN_METHOD="facebook.com";Vd.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ph extends Hx{constructor(){super("google.com"),this.addScope("profile")}static credential(e,r){return nm._fromParams({providerId:ph.PROVIDER_ID,signInMethod:ph.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:r})}static credentialFromResult(e){return ph.credentialFromTaggedObject(e)}static credentialFromError(e){return ph.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:r,oauthAccessToken:o}=e;if(!r&&!o)return null;try{return ph.credential(r,o)}catch{return null}}}ph.GOOGLE_SIGN_IN_METHOD="google.com";ph.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jd extends Hx{constructor(){super("github.com")}static credential(e){return nm._fromParams({providerId:jd.PROVIDER_ID,signInMethod:jd.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return jd.credentialFromTaggedObject(e)}static credentialFromError(e){return jd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return jd.credential(e.oauthAccessToken)}catch{return null}}}jd.GITHUB_SIGN_IN_METHOD="github.com";jd.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $d extends Hx{constructor(){super("twitter.com")}static credential(e,r){return nm._fromParams({providerId:$d.PROVIDER_ID,signInMethod:$d.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:r})}static credentialFromResult(e){return $d.credentialFromTaggedObject(e)}static credentialFromError(e){return $d.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:r,oauthTokenSecret:o}=e;if(!r||!o)return null;try{return $d.credential(r,o)}catch{return null}}}$d.TWITTER_SIGN_IN_METHOD="twitter.com";$d.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O_{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,r,o,u=!1){const f=await yh._fromIdTokenResponse(e,o,u),y=YF(o);return new O_({user:f,providerId:y,_tokenResponse:o,operationType:r})}static async _forOperation(e,r,o){await e._updateTokensIfNecessary(o,!0);const u=YF(o);return new O_({user:e,providerId:u,_tokenResponse:o,operationType:r})}}function YF(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aE extends Pu{constructor(e,r,o,u){var f;super(r.code,r.message),this.operationType=o,this.user=u,Object.setPrototypeOf(this,aE.prototype),this.customData={appName:e.name,tenantId:(f=e.tenantId)!==null&&f!==void 0?f:void 0,_serverResponse:r.customData._serverResponse,operationType:o}}static _fromErrorAndOperation(e,r,o,u){return new aE(e,r,o,u)}}function H8(t,e,r,o){return(e==="reauthenticate"?r._getReauthenticationResolver(t):r._getIdTokenResponse(t)).catch(f=>{throw f.code==="auth/multi-factor-auth-required"?aE._fromErrorAndOperation(t,f,e,o):f})}async function lte(t,e,r=!1){const o=await fx(t,e._linkToIdToken(t.auth,await t.getIdToken()),r);return O_._forOperation(t,"link",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cte(t,e,r=!1){const{auth:o}=t;if(Zd(o.app))return Promise.reject(jp(o));const u="reauthenticate";try{const f=await fx(t,H8(o,u,e,t),r);vr(f.idToken,o,"internal-error");const y=Q3(f.idToken);vr(y,o,"internal-error");const{sub:T}=y;return vr(t.uid===T,o,"user-mismatch"),O_._forOperation(t,u,f)}catch(f){throw(f==null?void 0:f.code)==="auth/user-not-found"&&Ph(o,"user-mismatch"),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ute(t,e,r=!1){if(Zd(t.app))return Promise.reject(jp(t));const o="signIn",u=await H8(t,o,e),f=await O_._fromIdTokenResponse(t,o,u);return r||await t._updateCurrentUser(f.user),f}function hte(t,e,r,o){return Hs(t).onIdTokenChanged(e,r,o)}function dte(t,e,r){return Hs(t).beforeAuthStateChanged(e,r)}const lE="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z8{constructor(e,r){this.storageRetriever=e,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(lE,"1"),this.storage.removeItem(lE),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,r){return this.storage.setItem(e,JSON.stringify(r)),Promise.resolve()}_get(e){const r=this.storage.getItem(e);return Promise.resolve(r?JSON.parse(r):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fte=1e3,pte=10;class X8 extends Z8{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,r)=>this.onStorageEvent(e,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=j8(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){const o=this.storage.getItem(r),u=this.localCache[r];o!==u&&e(r,u,o)}}onStorageEvent(e,r=!1){if(!e.key){this.forAllChangedKeys((y,T,a)=>{this.notifyListeners(y,a)});return}const o=e.key;r?this.detachListener():this.stopPolling();const u=()=>{const y=this.storage.getItem(o);!r&&this.localCache[o]===y||this.notifyListeners(o,y)},f=this.storage.getItem(o);Wee()&&f!==e.newValue&&e.newValue!==e.oldValue?setTimeout(u,pte):u()}notifyListeners(e,r){this.localCache[e]=r;const o=this.listeners[e];if(o)for(const u of Array.from(o))u(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,r,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:r,newValue:o}),!0)})},fte)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,r){await super._set(e,r),this.localCache[e]=JSON.stringify(r)}async _get(e){const r=await super._get(e);return this.localCache[e]=JSON.stringify(r),r}async _remove(e){await super._remove(e),delete this.localCache[e]}}X8.type="LOCAL";const mte=X8;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K8 extends Z8{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,r){}_removeListener(e,r){}}K8.type="SESSION";const Y8=K8;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gte(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TS{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const r=this.receivers.find(u=>u.isListeningto(e));if(r)return r;const o=new TS(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const r=e,{eventId:o,eventType:u,data:f}=r.data,y=this.handlersMap[u];if(!(y!=null&&y.size))return;r.ports[0].postMessage({status:"ack",eventId:o,eventType:u});const T=Array.from(y).map(async A=>A(r.origin,f)),a=await gte(T);r.ports[0].postMessage({status:"done",eventId:o,eventType:u,response:a})}_subscribe(e,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(r)}_unsubscribe(e,r){this.handlersMap[e]&&r&&this.handlersMap[e].delete(r),(!r||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}TS.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nD(t="",e=10){let r="";for(let o=0;o<e;o++)r+=Math.floor(Math.random()*10);return t+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _te{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,r,o=50){const u=typeof MessageChannel<"u"?new MessageChannel:null;if(!u)throw new Error("connection_unavailable");let f,y;return new Promise((T,a)=>{const A=nD("",20);u.port1.start();const D=setTimeout(()=>{a(new Error("unsupported_event"))},o);y={messageChannel:u,onMessage(O){const B=O;if(B.data.eventId===A)switch(B.data.status){case"ack":clearTimeout(D),f=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(f),T(B.data.response);break;default:clearTimeout(D),clearTimeout(f),a(new Error("invalid_response"));break}}},this.handlers.add(y),u.port1.addEventListener("message",y.onMessage),this.target.postMessage({eventType:e,eventId:A,data:r},[u.port2])}).finally(()=>{y&&this.removeMessageHandler(y)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wu(){return window}function yte(t){wu().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q8(){return typeof wu().WorkerGlobalScope<"u"&&typeof wu().importScripts=="function"}async function vte(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function xte(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function bte(){return Q8()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J8="firebaseLocalStorageDb",wte=1,cE="firebaseLocalStorage",e9="fbase_key";class Zx{constructor(e){this.request=e}toPromise(){return new Promise((e,r)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function ES(t,e){return t.transaction([cE],e?"readwrite":"readonly").objectStore(cE)}function Tte(){const t=indexedDB.deleteDatabase(J8);return new Zx(t).toPromise()}function bM(){const t=indexedDB.open(J8,wte);return new Promise((e,r)=>{t.addEventListener("error",()=>{r(t.error)}),t.addEventListener("upgradeneeded",()=>{const o=t.result;try{o.createObjectStore(cE,{keyPath:e9})}catch(u){r(u)}}),t.addEventListener("success",async()=>{const o=t.result;o.objectStoreNames.contains(cE)?e(o):(o.close(),await Tte(),e(await bM()))})})}async function QF(t,e,r){const o=ES(t,!0).put({[e9]:e,value:r});return new Zx(o).toPromise()}async function Ete(t,e){const r=ES(t,!1).get(e),o=await new Zx(r).toPromise();return o===void 0?null:o.value}function JF(t,e){const r=ES(t,!0).delete(e);return new Zx(r).toPromise()}const Ste=800,Ite=3;class t9{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await bM(),this.db)}async _withRetries(e){let r=0;for(;;)try{const o=await this._openDb();return await e(o)}catch(o){if(r++>Ite)throw o;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Q8()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=TS._getInstance(bte()),this.receiver._subscribe("keyChanged",async(e,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(e,r)=>["keyChanged"])}async initializeSender(){var e,r;if(this.activeServiceWorker=await vte(),!this.activeServiceWorker)return;this.sender=new _te(this.activeServiceWorker);const o=await this.sender._send("ping",{},800);o&&!((e=o[0])===null||e===void 0)&&e.fulfilled&&!((r=o[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||xte()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await bM();return await QF(e,lE,"1"),await JF(e,lE),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,r){return this._withPendingWrite(async()=>(await this._withRetries(o=>QF(o,e,r)),this.localCache[e]=r,this.notifyServiceWorker(e)))}async _get(e){const r=await this._withRetries(o=>Ete(o,e));return this.localCache[e]=r,r}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(r=>JF(r,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(u=>{const f=ES(u,!1).getAll();return new Zx(f).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const r=[],o=new Set;if(e.length!==0)for(const{fbase_key:u,value:f}of e)o.add(u),JSON.stringify(this.localCache[u])!==JSON.stringify(f)&&(this.notifyListeners(u,f),r.push(u));for(const u of Object.keys(this.localCache))this.localCache[u]&&!o.has(u)&&(this.notifyListeners(u,null),r.push(u));return r}notifyListeners(e,r){this.localCache[e]=r;const o=this.listeners[e];if(o)for(const u of Array.from(o))u(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Ste)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}t9.type="LOCAL";const Ate=t9;new Wx(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cte(t,e){return e?vh(e):(vr(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rD extends q8{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return y_(e,this._buildIdpRequest())}_linkToIdToken(e,r){return y_(e,this._buildIdpRequest(r))}_getReauthenticationResolver(e){return y_(e,this._buildIdpRequest())}_buildIdpRequest(e){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(r.idToken=e),r}}function Pte(t){return ute(t.auth,new rD(t),t.bypassAuthState)}function Rte(t){const{auth:e,user:r}=t;return vr(r,e,"internal-error"),cte(r,new rD(t),t.bypassAuthState)}async function Mte(t){const{auth:e,user:r}=t;return vr(r,e,"internal-error"),lte(r,new rD(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n9{constructor(e,r,o,u,f=!1){this.auth=e,this.resolver=o,this.user=u,this.bypassAuthState=f,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise(async(e,r)=>{this.pendingPromise={resolve:e,reject:r};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(o){this.reject(o)}})}async onAuthEvent(e){const{urlResponse:r,sessionId:o,postBody:u,tenantId:f,error:y,type:T}=e;if(y){this.reject(y);return}const a={auth:this.auth,requestUri:r,sessionId:o,tenantId:f||void 0,postBody:u||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(T)(a))}catch(A){this.reject(A)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Pte;case"linkViaPopup":case"linkViaRedirect":return Mte;case"reauthViaPopup":case"reauthViaRedirect":return Rte;default:Ph(this.auth,"internal-error")}}resolve(e){Rh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Rh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kte=new Wx(2e3,1e4);class s_ extends n9{constructor(e,r,o,u,f){super(e,r,u,f),this.provider=o,this.authWindow=null,this.pollId=null,s_.currentPopupAction&&s_.currentPopupAction.cancel(),s_.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return vr(e,this.auth,"internal-error"),e}async onExecution(){Rh(this.filter.length===1,"Popup operations only handle one event");const e=nD();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(bu(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(bu(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,s_.currentPopupAction=null}pollUserCancellation(){const e=()=>{var r,o;if(!((o=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||o===void 0)&&o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(bu(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,kte.get())};e()}}s_.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dte="pendingRedirect",cT=new Map;class Ote extends n9{constructor(e,r,o=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,o),this.eventId=null}async execute(){let e=cT.get(this.auth._key());if(!e){try{const o=await Lte(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(o)}catch(r){e=()=>Promise.reject(r)}cT.set(this.auth._key(),e)}return this.bypassAuthState||cT.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const r=await this.auth._redirectUserForId(e.eventId);if(r)return this.user=r,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Lte(t,e){const r=Fte(e),o=Nte(t);if(!await o._isAvailable())return!1;const u=await o._get(r)==="true";return await o._remove(r),u}function zte(t,e){cT.set(t._key(),e)}function Nte(t){return vh(t._redirectPersistence)}function Fte(t){return lT(Dte,t.config.apiKey,t.name)}async function Bte(t,e,r=!1){if(Zd(t.app))return Promise.reject(jp(t));const o=eD(t),u=Cte(o,e),y=await new Ote(o,u,r).execute();return y&&!r&&(delete y.user._redirectEventId,await o._persistUserIfCurrent(y.user),await o._setRedirectUser(null,e)),y}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ute=10*60*1e3;class Vte{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let r=!1;return this.consumers.forEach(o=>{this.isEventForConsumer(e,o)&&(r=!0,this.sendToConsumer(e,o),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!jte(e)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=e,r=!0)),r}sendToConsumer(e,r){var o;if(e.error&&!r9(e)){const u=((o=e.error.code)===null||o===void 0?void 0:o.split("auth/")[1])||"internal-error";r.onError(bu(this.auth,u))}else r.onAuthEvent(e)}isEventForConsumer(e,r){const o=r.eventId===null||!!e.eventId&&e.eventId===r.eventId;return r.filter.includes(e.type)&&o}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Ute&&this.cachedEventUids.clear(),this.cachedEventUids.has(eB(e))}saveEventToCache(e){this.cachedEventUids.add(eB(e)),this.lastProcessedEventTime=Date.now()}}function eB(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function r9({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function jte(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return r9(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $te(t,e={}){return ry(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gte=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,qte=/^https?/;async function Wte(t){if(t.config.emulator)return;const{authorizedDomains:e}=await $te(t);for(const r of e)try{if(Hte(r))return}catch{}Ph(t,"unauthorized-domain")}function Hte(t){const e=vM(),{protocol:r,hostname:o}=new URL(e);if(t.startsWith("chrome-extension://")){const y=new URL(t);return y.hostname===""&&o===""?r==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):r==="chrome-extension:"&&y.hostname===o}if(!qte.test(r))return!1;if(Gte.test(t))return o===t;const u=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+u+"|"+u+")$","i").test(o)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zte=new Wx(3e4,6e4);function tB(){const t=wu().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let r=0;r<t.CP.length;r++)t.CP[r]=null}}function Xte(t){return new Promise((e,r)=>{var o,u,f;function y(){tB(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{tB(),r(bu(t,"network-request-failed"))},timeout:Zte.get()})}if(!((u=(o=wu().gapi)===null||o===void 0?void 0:o.iframes)===null||u===void 0)&&u.Iframe)e(gapi.iframes.getContext());else if(!((f=wu().gapi)===null||f===void 0)&&f.load)y();else{const T=tte("iframefcb");return wu()[T]=()=>{gapi.load?y():r(bu(t,"network-request-failed"))},Jee(`${ete()}?onload=${T}`).catch(a=>r(a))}}).catch(e=>{throw uT=null,e})}let uT=null;function Kte(t){return uT=uT||Xte(t),uT}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yte=new Wx(5e3,15e3),Qte="__/auth/iframe",Jte="emulator/auth/iframe",ene={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},tne=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function nne(t){const e=t.config;vr(e.authDomain,t,"auth-domain-config-required");const r=e.emulator?K3(e,Jte):`https://${t.config.authDomain}/${Qte}`,o={apiKey:e.apiKey,appName:t.name,v:gm},u=tne.get(t.config.apiHost);u&&(o.eid=u);const f=t._getFrameworks();return f.length&&(o.fw=f.join(",")),`${r}?${qx(o).slice(1)}`}async function rne(t){const e=await Kte(t),r=wu().gapi;return vr(r,t,"internal-error"),e.open({where:document.body,url:nne(t),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ene,dontclear:!0},o=>new Promise(async(u,f)=>{await o.restyle({setHideOnLeave:!1});const y=bu(t,"network-request-failed"),T=wu().setTimeout(()=>{f(y)},Yte.get());function a(){wu().clearTimeout(T),u(o)}o.ping(a).then(a,()=>{f(y)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ine={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},sne=500,one=600,ane="_blank",lne="http://localhost";class nB{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function cne(t,e,r,o=sne,u=one){const f=Math.max((window.screen.availHeight-u)/2,0).toString(),y=Math.max((window.screen.availWidth-o)/2,0).toString();let T="";const a=Object.assign(Object.assign({},ine),{width:o.toString(),height:u.toString(),top:f,left:y}),A=Xo().toLowerCase();r&&(T=N8(A)?ane:r),L8(A)&&(e=e||lne,a.scrollbars="yes");const D=Object.entries(a).reduce((B,[H,Q])=>`${B}${H}=${Q},`,"");if(qee(A)&&T!=="_self")return une(e||"",T),new nB(null);const O=window.open(e||"",T,D);vr(O,t,"popup-blocked");try{O.focus()}catch{}return new nB(O)}function une(t,e){const r=document.createElement("a");r.href=t,r.target=e;const o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hne="__/auth/handler",dne="emulator/auth/handler",fne=encodeURIComponent("fac");async function rB(t,e,r,o,u,f){vr(t.config.authDomain,t,"auth-domain-config-required"),vr(t.config.apiKey,t,"invalid-api-key");const y={apiKey:t.config.apiKey,appName:t.name,authType:r,redirectUrl:o,v:gm,eventId:u};if(e instanceof W8){e.setDefaultLanguage(t.languageCode),y.providerId=e.providerId||"",g2(e.getCustomParameters())||(y.customParameters=JSON.stringify(e.getCustomParameters()));for(const[D,O]of Object.entries({}))y[D]=O}if(e instanceof Hx){const D=e.getScopes().filter(O=>O!=="");D.length>0&&(y.scopes=D.join(","))}t.tenantId&&(y.tid=t.tenantId);const T=y;for(const D of Object.keys(T))T[D]===void 0&&delete T[D];const a=await t._getAppCheckToken(),A=a?`#${fne}=${encodeURIComponent(a)}`:"";return`${pne(t)}?${qx(T).slice(1)}${A}`}function pne({config:t}){return t.emulator?K3(t,dne):`https://${t.authDomain}/${hne}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MP="webStorageSupport";class mne{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Y8,this._completeRedirectFn=Bte,this._overrideRedirectResult=zte}async _openPopup(e,r,o,u){var f;Rh((f=this.eventManagers[e._key()])===null||f===void 0?void 0:f.manager,"_initialize() not called before _openPopup()");const y=await rB(e,r,o,vM(),u);return cne(e,y,nD())}async _openRedirect(e,r,o,u){await this._originValidation(e);const f=await rB(e,r,o,vM(),u);return yte(f),new Promise(()=>{})}_initialize(e){const r=e._key();if(this.eventManagers[r]){const{manager:u,promise:f}=this.eventManagers[r];return u?Promise.resolve(u):(Rh(f,"If manager is not set, promise should be"),f)}const o=this.initAndGetManager(e);return this.eventManagers[r]={promise:o},o.catch(()=>{delete this.eventManagers[r]}),o}async initAndGetManager(e){const r=await rne(e),o=new Vte(e);return r.register("authEvent",u=>(vr(u==null?void 0:u.authEvent,e,"invalid-auth-event"),{status:o.onEvent(u.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:o},this.iframes[e._key()]=r,o}_isIframeWebStorageSupported(e,r){this.iframes[e._key()].send(MP,{type:MP},u=>{var f;const y=(f=u==null?void 0:u[0])===null||f===void 0?void 0:f[MP];y!==void 0&&r(!!y),Ph(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const r=e._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=Wte(e)),this.originValidationPromises[r]}get _shouldInitProactively(){return j8()||z8()||J3()}}const gne=mne;var iB="@firebase/auth",sB="1.7.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _ne{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const r=this.auth.onIdTokenChanged(o=>{e((o==null?void 0:o.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,r),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const r=this.internalListeners.get(e);r&&(this.internalListeners.delete(e),r(),this.updateProactiveRefresh())}assertAuthConfigured(){vr(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yne(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function vne(t){tm(new mf("auth",(e,{options:r})=>{const o=e.getProvider("app").getImmediate(),u=e.getProvider("heartbeat"),f=e.getProvider("app-check-internal"),{apiKey:y,authDomain:T}=o.options;vr(y&&!y.includes(":"),"invalid-api-key",{appName:o.name});const a={apiKey:y,authDomain:T,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:$8(t)},A=new Yee(o,u,f,a);return rte(A,r),A},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,r,o)=>{e.getProvider("auth-internal").initialize()})),tm(new mf("auth-internal",e=>{const r=eD(e.getProvider("auth").getImmediate());return(o=>new _ne(o))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),xu(iB,sB,yne(t)),xu(iB,sB,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xne=5*60,bne=v8("authIdTokenMaxAge")||xne;let oB=null;const wne=t=>async e=>{const r=e&&await e.getIdTokenResult(),o=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(o&&o>bne)return;const u=r==null?void 0:r.token;oB!==u&&(oB=u,await fetch(t,{method:u?"POST":"DELETE",headers:u?{Authorization:`Bearer ${u}`}:{}}))};function Tne(t=H3()){const e=wS(t,"auth");if(e.isInitialized())return e.getImmediate();const r=nte(t,{popupRedirectResolver:gne,persistence:[Ate,mte,Y8]}),o=v8("authTokenSyncURL");if(o&&typeof isSecureContext=="boolean"&&isSecureContext){const f=new URL(o,location.origin);if(location.origin===f.origin){const y=wne(f.toString());dte(r,y,()=>y(r.currentUser)),hte(r,T=>y(T))}}const u=g8("auth");return u&&ite(r,`http://${u}`),r}function Ene(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}Qee({loadJS(t){return new Promise((e,r)=>{const o=document.createElement("script");o.setAttribute("src",t),o.onload=e,o.onerror=u=>{const f=bu("internal-error");f.customData=u,r(f)},o.type="text/javascript",o.charset="UTF-8",Ene().appendChild(o)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});vne("Browser");var aB=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var $p,i9;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(ce,he){function W(){}W.prototype=he.prototype,ce.D=he.prototype,ce.prototype=new W,ce.prototype.constructor=ce,ce.C=function(ge,_e,Ee){for(var we=Array(arguments.length-2),xt=2;xt<arguments.length;xt++)we[xt-2]=arguments[xt];return he.prototype[_e].apply(ge,we)}}function r(){this.blockSize=-1}function o(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(o,r),o.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function u(ce,he,W){W||(W=0);var ge=Array(16);if(typeof he=="string")for(var _e=0;16>_e;++_e)ge[_e]=he.charCodeAt(W++)|he.charCodeAt(W++)<<8|he.charCodeAt(W++)<<16|he.charCodeAt(W++)<<24;else for(_e=0;16>_e;++_e)ge[_e]=he[W++]|he[W++]<<8|he[W++]<<16|he[W++]<<24;he=ce.g[0],W=ce.g[1],_e=ce.g[2];var Ee=ce.g[3],we=he+(Ee^W&(_e^Ee))+ge[0]+3614090360&4294967295;he=W+(we<<7&4294967295|we>>>25),we=Ee+(_e^he&(W^_e))+ge[1]+3905402710&4294967295,Ee=he+(we<<12&4294967295|we>>>20),we=_e+(W^Ee&(he^W))+ge[2]+606105819&4294967295,_e=Ee+(we<<17&4294967295|we>>>15),we=W+(he^_e&(Ee^he))+ge[3]+3250441966&4294967295,W=_e+(we<<22&4294967295|we>>>10),we=he+(Ee^W&(_e^Ee))+ge[4]+4118548399&4294967295,he=W+(we<<7&4294967295|we>>>25),we=Ee+(_e^he&(W^_e))+ge[5]+1200080426&4294967295,Ee=he+(we<<12&4294967295|we>>>20),we=_e+(W^Ee&(he^W))+ge[6]+2821735955&4294967295,_e=Ee+(we<<17&4294967295|we>>>15),we=W+(he^_e&(Ee^he))+ge[7]+4249261313&4294967295,W=_e+(we<<22&4294967295|we>>>10),we=he+(Ee^W&(_e^Ee))+ge[8]+1770035416&4294967295,he=W+(we<<7&4294967295|we>>>25),we=Ee+(_e^he&(W^_e))+ge[9]+2336552879&4294967295,Ee=he+(we<<12&4294967295|we>>>20),we=_e+(W^Ee&(he^W))+ge[10]+4294925233&4294967295,_e=Ee+(we<<17&4294967295|we>>>15),we=W+(he^_e&(Ee^he))+ge[11]+2304563134&4294967295,W=_e+(we<<22&4294967295|we>>>10),we=he+(Ee^W&(_e^Ee))+ge[12]+1804603682&4294967295,he=W+(we<<7&4294967295|we>>>25),we=Ee+(_e^he&(W^_e))+ge[13]+4254626195&4294967295,Ee=he+(we<<12&4294967295|we>>>20),we=_e+(W^Ee&(he^W))+ge[14]+2792965006&4294967295,_e=Ee+(we<<17&4294967295|we>>>15),we=W+(he^_e&(Ee^he))+ge[15]+1236535329&4294967295,W=_e+(we<<22&4294967295|we>>>10),we=he+(_e^Ee&(W^_e))+ge[1]+4129170786&4294967295,he=W+(we<<5&4294967295|we>>>27),we=Ee+(W^_e&(he^W))+ge[6]+3225465664&4294967295,Ee=he+(we<<9&4294967295|we>>>23),we=_e+(he^W&(Ee^he))+ge[11]+643717713&4294967295,_e=Ee+(we<<14&4294967295|we>>>18),we=W+(Ee^he&(_e^Ee))+ge[0]+3921069994&4294967295,W=_e+(we<<20&4294967295|we>>>12),we=he+(_e^Ee&(W^_e))+ge[5]+3593408605&4294967295,he=W+(we<<5&4294967295|we>>>27),we=Ee+(W^_e&(he^W))+ge[10]+38016083&4294967295,Ee=he+(we<<9&4294967295|we>>>23),we=_e+(he^W&(Ee^he))+ge[15]+3634488961&4294967295,_e=Ee+(we<<14&4294967295|we>>>18),we=W+(Ee^he&(_e^Ee))+ge[4]+3889429448&4294967295,W=_e+(we<<20&4294967295|we>>>12),we=he+(_e^Ee&(W^_e))+ge[9]+568446438&4294967295,he=W+(we<<5&4294967295|we>>>27),we=Ee+(W^_e&(he^W))+ge[14]+3275163606&4294967295,Ee=he+(we<<9&4294967295|we>>>23),we=_e+(he^W&(Ee^he))+ge[3]+4107603335&4294967295,_e=Ee+(we<<14&4294967295|we>>>18),we=W+(Ee^he&(_e^Ee))+ge[8]+1163531501&4294967295,W=_e+(we<<20&4294967295|we>>>12),we=he+(_e^Ee&(W^_e))+ge[13]+2850285829&4294967295,he=W+(we<<5&4294967295|we>>>27),we=Ee+(W^_e&(he^W))+ge[2]+4243563512&4294967295,Ee=he+(we<<9&4294967295|we>>>23),we=_e+(he^W&(Ee^he))+ge[7]+1735328473&4294967295,_e=Ee+(we<<14&4294967295|we>>>18),we=W+(Ee^he&(_e^Ee))+ge[12]+2368359562&4294967295,W=_e+(we<<20&4294967295|we>>>12),we=he+(W^_e^Ee)+ge[5]+4294588738&4294967295,he=W+(we<<4&4294967295|we>>>28),we=Ee+(he^W^_e)+ge[8]+2272392833&4294967295,Ee=he+(we<<11&4294967295|we>>>21),we=_e+(Ee^he^W)+ge[11]+1839030562&4294967295,_e=Ee+(we<<16&4294967295|we>>>16),we=W+(_e^Ee^he)+ge[14]+4259657740&4294967295,W=_e+(we<<23&4294967295|we>>>9),we=he+(W^_e^Ee)+ge[1]+2763975236&4294967295,he=W+(we<<4&4294967295|we>>>28),we=Ee+(he^W^_e)+ge[4]+1272893353&4294967295,Ee=he+(we<<11&4294967295|we>>>21),we=_e+(Ee^he^W)+ge[7]+4139469664&4294967295,_e=Ee+(we<<16&4294967295|we>>>16),we=W+(_e^Ee^he)+ge[10]+3200236656&4294967295,W=_e+(we<<23&4294967295|we>>>9),we=he+(W^_e^Ee)+ge[13]+681279174&4294967295,he=W+(we<<4&4294967295|we>>>28),we=Ee+(he^W^_e)+ge[0]+3936430074&4294967295,Ee=he+(we<<11&4294967295|we>>>21),we=_e+(Ee^he^W)+ge[3]+3572445317&4294967295,_e=Ee+(we<<16&4294967295|we>>>16),we=W+(_e^Ee^he)+ge[6]+76029189&4294967295,W=_e+(we<<23&4294967295|we>>>9),we=he+(W^_e^Ee)+ge[9]+3654602809&4294967295,he=W+(we<<4&4294967295|we>>>28),we=Ee+(he^W^_e)+ge[12]+3873151461&4294967295,Ee=he+(we<<11&4294967295|we>>>21),we=_e+(Ee^he^W)+ge[15]+530742520&4294967295,_e=Ee+(we<<16&4294967295|we>>>16),we=W+(_e^Ee^he)+ge[2]+3299628645&4294967295,W=_e+(we<<23&4294967295|we>>>9),we=he+(_e^(W|~Ee))+ge[0]+4096336452&4294967295,he=W+(we<<6&4294967295|we>>>26),we=Ee+(W^(he|~_e))+ge[7]+1126891415&4294967295,Ee=he+(we<<10&4294967295|we>>>22),we=_e+(he^(Ee|~W))+ge[14]+2878612391&4294967295,_e=Ee+(we<<15&4294967295|we>>>17),we=W+(Ee^(_e|~he))+ge[5]+4237533241&4294967295,W=_e+(we<<21&4294967295|we>>>11),we=he+(_e^(W|~Ee))+ge[12]+1700485571&4294967295,he=W+(we<<6&4294967295|we>>>26),we=Ee+(W^(he|~_e))+ge[3]+2399980690&4294967295,Ee=he+(we<<10&4294967295|we>>>22),we=_e+(he^(Ee|~W))+ge[10]+4293915773&4294967295,_e=Ee+(we<<15&4294967295|we>>>17),we=W+(Ee^(_e|~he))+ge[1]+2240044497&4294967295,W=_e+(we<<21&4294967295|we>>>11),we=he+(_e^(W|~Ee))+ge[8]+1873313359&4294967295,he=W+(we<<6&4294967295|we>>>26),we=Ee+(W^(he|~_e))+ge[15]+4264355552&4294967295,Ee=he+(we<<10&4294967295|we>>>22),we=_e+(he^(Ee|~W))+ge[6]+2734768916&4294967295,_e=Ee+(we<<15&4294967295|we>>>17),we=W+(Ee^(_e|~he))+ge[13]+1309151649&4294967295,W=_e+(we<<21&4294967295|we>>>11),we=he+(_e^(W|~Ee))+ge[4]+4149444226&4294967295,he=W+(we<<6&4294967295|we>>>26),we=Ee+(W^(he|~_e))+ge[11]+3174756917&4294967295,Ee=he+(we<<10&4294967295|we>>>22),we=_e+(he^(Ee|~W))+ge[2]+718787259&4294967295,_e=Ee+(we<<15&4294967295|we>>>17),we=W+(Ee^(_e|~he))+ge[9]+3951481745&4294967295,ce.g[0]=ce.g[0]+he&4294967295,ce.g[1]=ce.g[1]+(_e+(we<<21&4294967295|we>>>11))&4294967295,ce.g[2]=ce.g[2]+_e&4294967295,ce.g[3]=ce.g[3]+Ee&4294967295}o.prototype.u=function(ce,he){he===void 0&&(he=ce.length);for(var W=he-this.blockSize,ge=this.B,_e=this.h,Ee=0;Ee<he;){if(_e==0)for(;Ee<=W;)u(this,ce,Ee),Ee+=this.blockSize;if(typeof ce=="string"){for(;Ee<he;)if(ge[_e++]=ce.charCodeAt(Ee++),_e==this.blockSize){u(this,ge),_e=0;break}}else for(;Ee<he;)if(ge[_e++]=ce[Ee++],_e==this.blockSize){u(this,ge),_e=0;break}}this.h=_e,this.o+=he},o.prototype.v=function(){var ce=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);ce[0]=128;for(var he=1;he<ce.length-8;++he)ce[he]=0;var W=8*this.o;for(he=ce.length-8;he<ce.length;++he)ce[he]=W&255,W/=256;for(this.u(ce),ce=Array(16),he=W=0;4>he;++he)for(var ge=0;32>ge;ge+=8)ce[W++]=this.g[he]>>>ge&255;return ce};function f(ce,he){var W=T;return Object.prototype.hasOwnProperty.call(W,ce)?W[ce]:W[ce]=he(ce)}function y(ce,he){this.h=he;for(var W=[],ge=!0,_e=ce.length-1;0<=_e;_e--){var Ee=ce[_e]|0;ge&&Ee==he||(W[_e]=Ee,ge=!1)}this.g=W}var T={};function a(ce){return-128<=ce&&128>ce?f(ce,function(he){return new y([he|0],0>he?-1:0)}):new y([ce|0],0>ce?-1:0)}function A(ce){if(isNaN(ce)||!isFinite(ce))return O;if(0>ce)return se(A(-ce));for(var he=[],W=1,ge=0;ce>=W;ge++)he[ge]=ce/W|0,W*=4294967296;return new y(he,0)}function D(ce,he){if(ce.length==0)throw Error("number format error: empty string");if(he=he||10,2>he||36<he)throw Error("radix out of range: "+he);if(ce.charAt(0)=="-")return se(D(ce.substring(1),he));if(0<=ce.indexOf("-"))throw Error('number format error: interior "-" character');for(var W=A(Math.pow(he,8)),ge=O,_e=0;_e<ce.length;_e+=8){var Ee=Math.min(8,ce.length-_e),we=parseInt(ce.substring(_e,_e+Ee),he);8>Ee?(Ee=A(Math.pow(he,Ee)),ge=ge.j(Ee).add(A(we))):(ge=ge.j(W),ge=ge.add(A(we)))}return ge}var O=a(0),B=a(1),H=a(16777216);t=y.prototype,t.m=function(){if(re(this))return-se(this).m();for(var ce=0,he=1,W=0;W<this.g.length;W++){var ge=this.i(W);ce+=(0<=ge?ge:4294967296+ge)*he,he*=4294967296}return ce},t.toString=function(ce){if(ce=ce||10,2>ce||36<ce)throw Error("radix out of range: "+ce);if(Q(this))return"0";if(re(this))return"-"+se(this).toString(ce);for(var he=A(Math.pow(ce,6)),W=this,ge="";;){var _e=fe(W,he).g;W=G(W,_e.j(he));var Ee=((0<W.g.length?W.g[0]:W.h)>>>0).toString(ce);if(W=_e,Q(W))return Ee+ge;for(;6>Ee.length;)Ee="0"+Ee;ge=Ee+ge}},t.i=function(ce){return 0>ce?0:ce<this.g.length?this.g[ce]:this.h};function Q(ce){if(ce.h!=0)return!1;for(var he=0;he<ce.g.length;he++)if(ce.g[he]!=0)return!1;return!0}function re(ce){return ce.h==-1}t.l=function(ce){return ce=G(this,ce),re(ce)?-1:Q(ce)?0:1};function se(ce){for(var he=ce.g.length,W=[],ge=0;ge<he;ge++)W[ge]=~ce.g[ge];return new y(W,~ce.h).add(B)}t.abs=function(){return re(this)?se(this):this},t.add=function(ce){for(var he=Math.max(this.g.length,ce.g.length),W=[],ge=0,_e=0;_e<=he;_e++){var Ee=ge+(this.i(_e)&65535)+(ce.i(_e)&65535),we=(Ee>>>16)+(this.i(_e)>>>16)+(ce.i(_e)>>>16);ge=we>>>16,Ee&=65535,we&=65535,W[_e]=we<<16|Ee}return new y(W,W[W.length-1]&-2147483648?-1:0)};function G(ce,he){return ce.add(se(he))}t.j=function(ce){if(Q(this)||Q(ce))return O;if(re(this))return re(ce)?se(this).j(se(ce)):se(se(this).j(ce));if(re(ce))return se(this.j(se(ce)));if(0>this.l(H)&&0>ce.l(H))return A(this.m()*ce.m());for(var he=this.g.length+ce.g.length,W=[],ge=0;ge<2*he;ge++)W[ge]=0;for(ge=0;ge<this.g.length;ge++)for(var _e=0;_e<ce.g.length;_e++){var Ee=this.i(ge)>>>16,we=this.i(ge)&65535,xt=ce.i(_e)>>>16,Rt=ce.i(_e)&65535;W[2*ge+2*_e]+=we*Rt,Y(W,2*ge+2*_e),W[2*ge+2*_e+1]+=Ee*Rt,Y(W,2*ge+2*_e+1),W[2*ge+2*_e+1]+=we*xt,Y(W,2*ge+2*_e+1),W[2*ge+2*_e+2]+=Ee*xt,Y(W,2*ge+2*_e+2)}for(ge=0;ge<he;ge++)W[ge]=W[2*ge+1]<<16|W[2*ge];for(ge=he;ge<2*he;ge++)W[ge]=0;return new y(W,0)};function Y(ce,he){for(;(ce[he]&65535)!=ce[he];)ce[he+1]+=ce[he]>>>16,ce[he]&=65535,he++}function Z(ce,he){this.g=ce,this.h=he}function fe(ce,he){if(Q(he))throw Error("division by zero");if(Q(ce))return new Z(O,O);if(re(ce))return he=fe(se(ce),he),new Z(se(he.g),se(he.h));if(re(he))return he=fe(ce,se(he)),new Z(se(he.g),he.h);if(30<ce.g.length){if(re(ce)||re(he))throw Error("slowDivide_ only works with positive integers.");for(var W=B,ge=he;0>=ge.l(ce);)W=Te(W),ge=Te(ge);var _e=Pe(W,1),Ee=Pe(ge,1);for(ge=Pe(ge,2),W=Pe(W,2);!Q(ge);){var we=Ee.add(ge);0>=we.l(ce)&&(_e=_e.add(W),Ee=we),ge=Pe(ge,1),W=Pe(W,1)}return he=G(ce,_e.j(he)),new Z(_e,he)}for(_e=O;0<=ce.l(he);){for(W=Math.max(1,Math.floor(ce.m()/he.m())),ge=Math.ceil(Math.log(W)/Math.LN2),ge=48>=ge?1:Math.pow(2,ge-48),Ee=A(W),we=Ee.j(he);re(we)||0<we.l(ce);)W-=ge,Ee=A(W),we=Ee.j(he);Q(Ee)&&(Ee=B),_e=_e.add(Ee),ce=G(ce,we)}return new Z(_e,ce)}t.A=function(ce){return fe(this,ce).h},t.and=function(ce){for(var he=Math.max(this.g.length,ce.g.length),W=[],ge=0;ge<he;ge++)W[ge]=this.i(ge)&ce.i(ge);return new y(W,this.h&ce.h)},t.or=function(ce){for(var he=Math.max(this.g.length,ce.g.length),W=[],ge=0;ge<he;ge++)W[ge]=this.i(ge)|ce.i(ge);return new y(W,this.h|ce.h)},t.xor=function(ce){for(var he=Math.max(this.g.length,ce.g.length),W=[],ge=0;ge<he;ge++)W[ge]=this.i(ge)^ce.i(ge);return new y(W,this.h^ce.h)};function Te(ce){for(var he=ce.g.length+1,W=[],ge=0;ge<he;ge++)W[ge]=ce.i(ge)<<1|ce.i(ge-1)>>>31;return new y(W,ce.h)}function Pe(ce,he){var W=he>>5;he%=32;for(var ge=ce.g.length-W,_e=[],Ee=0;Ee<ge;Ee++)_e[Ee]=0<he?ce.i(Ee+W)>>>he|ce.i(Ee+W+1)<<32-he:ce.i(Ee+W);return new y(_e,ce.h)}o.prototype.digest=o.prototype.v,o.prototype.reset=o.prototype.s,o.prototype.update=o.prototype.u,i9=o,y.prototype.add=y.prototype.add,y.prototype.multiply=y.prototype.j,y.prototype.modulo=y.prototype.A,y.prototype.compare=y.prototype.l,y.prototype.toNumber=y.prototype.m,y.prototype.toString=y.prototype.toString,y.prototype.getBits=y.prototype.i,y.fromNumber=A,y.fromString=D,$p=y}).apply(typeof aB<"u"?aB:typeof self<"u"?self:typeof window<"u"?window:{});var Cw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var s9,o9,cv,a9,hT,wM,l9,c9,u9;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(R,X,le){return R==Array.prototype||R==Object.prototype||(R[X]=le.value),R};function r(R){R=[typeof globalThis=="object"&&globalThis,R,typeof window=="object"&&window,typeof self=="object"&&self,typeof Cw=="object"&&Cw];for(var X=0;X<R.length;++X){var le=R[X];if(le&&le.Math==Math)return le}throw Error("Cannot find global object")}var o=r(this);function u(R,X){if(X)e:{var le=o;R=R.split(".");for(var ke=0;ke<R.length-1;ke++){var ht=R[ke];if(!(ht in le))break e;le=le[ht]}R=R[R.length-1],ke=le[R],X=X(ke),X!=ke&&X!=null&&e(le,R,{configurable:!0,writable:!0,value:X})}}function f(R,X){R instanceof String&&(R+="");var le=0,ke=!1,ht={next:function(){if(!ke&&le<R.length){var kt=le++;return{value:X(kt,R[kt]),done:!1}}return ke=!0,{done:!0,value:void 0}}};return ht[Symbol.iterator]=function(){return ht},ht}u("Array.prototype.values",function(R){return R||function(){return f(this,function(X,le){return le})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var y=y||{},T=this||self;function a(R){var X=typeof R;return X=X!="object"?X:R?Array.isArray(R)?"array":X:"null",X=="array"||X=="object"&&typeof R.length=="number"}function A(R){var X=typeof R;return X=="object"&&R!=null||X=="function"}function D(R,X,le){return R.call.apply(R.bind,arguments)}function O(R,X,le){if(!R)throw Error();if(2<arguments.length){var ke=Array.prototype.slice.call(arguments,2);return function(){var ht=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(ht,ke),R.apply(X,ht)}}return function(){return R.apply(X,arguments)}}function B(R,X,le){return B=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?D:O,B.apply(null,arguments)}function H(R,X){var le=Array.prototype.slice.call(arguments,1);return function(){var ke=le.slice();return ke.push.apply(ke,arguments),R.apply(this,ke)}}function Q(R,X){function le(){}le.prototype=X.prototype,R.aa=X.prototype,R.prototype=new le,R.prototype.constructor=R,R.Qb=function(ke,ht,kt){for(var Qt=Array(arguments.length-2),ri=2;ri<arguments.length;ri++)Qt[ri-2]=arguments[ri];return X.prototype[ht].apply(ke,Qt)}}function re(R){const X=R.length;if(0<X){const le=Array(X);for(let ke=0;ke<X;ke++)le[ke]=R[ke];return le}return[]}function se(R,X){for(let le=1;le<arguments.length;le++){const ke=arguments[le];if(a(ke)){const ht=R.length||0,kt=ke.length||0;R.length=ht+kt;for(let Qt=0;Qt<kt;Qt++)R[ht+Qt]=ke[Qt]}else R.push(ke)}}class G{constructor(X,le){this.i=X,this.j=le,this.h=0,this.g=null}get(){let X;return 0<this.h?(this.h--,X=this.g,this.g=X.next,X.next=null):X=this.i(),X}}function Y(R){return/^[\s\xa0]*$/.test(R)}function Z(){var R=T.navigator;return R&&(R=R.userAgent)?R:""}function fe(R){return fe[" "](R),R}fe[" "]=function(){};var Te=Z().indexOf("Gecko")!=-1&&!(Z().toLowerCase().indexOf("webkit")!=-1&&Z().indexOf("Edge")==-1)&&!(Z().indexOf("Trident")!=-1||Z().indexOf("MSIE")!=-1)&&Z().indexOf("Edge")==-1;function Pe(R,X,le){for(const ke in R)X.call(le,R[ke],ke,R)}function ce(R,X){for(const le in R)X.call(void 0,R[le],le,R)}function he(R){const X={};for(const le in R)X[le]=R[le];return X}const W="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ge(R,X){let le,ke;for(let ht=1;ht<arguments.length;ht++){ke=arguments[ht];for(le in ke)R[le]=ke[le];for(let kt=0;kt<W.length;kt++)le=W[kt],Object.prototype.hasOwnProperty.call(ke,le)&&(R[le]=ke[le])}}function _e(R){var X=1;R=R.split(":");const le=[];for(;0<X&&R.length;)le.push(R.shift()),X--;return R.length&&le.push(R.join(":")),le}function Ee(R){T.setTimeout(()=>{throw R},0)}function we(){var R=Ct;let X=null;return R.g&&(X=R.g,R.g=R.g.next,R.g||(R.h=null),X.next=null),X}class xt{constructor(){this.h=this.g=null}add(X,le){const ke=Rt.get();ke.set(X,le),this.h?this.h.next=ke:this.g=ke,this.h=ke}}var Rt=new G(()=>new Bt,R=>R.reset());class Bt{constructor(){this.next=this.g=this.h=null}set(X,le){this.h=X,this.g=le,this.next=null}reset(){this.next=this.g=this.h=null}}let bt,at=!1,Ct=new xt,Zt=()=>{const R=T.Promise.resolve(void 0);bt=()=>{R.then(rt)}};var rt=()=>{for(var R;R=we();){try{R.h.call(R.g)}catch(le){Ee(le)}var X=Rt;X.j(R),100>X.h&&(X.h++,R.next=X.g,X.g=R)}at=!1};function wt(){this.s=this.s,this.C=this.C}wt.prototype.s=!1,wt.prototype.ma=function(){this.s||(this.s=!0,this.N())},wt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function pt(R,X){this.type=R,this.g=this.target=X,this.defaultPrevented=!1}pt.prototype.h=function(){this.defaultPrevented=!0};var jt=function(){if(!T.addEventListener||!Object.defineProperty)return!1;var R=!1,X=Object.defineProperty({},"passive",{get:function(){R=!0}});try{const le=()=>{};T.addEventListener("test",le,X),T.removeEventListener("test",le,X)}catch{}return R}();function Mt(R,X){if(pt.call(this,R?R.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,R){var le=this.type=R.type,ke=R.changedTouches&&R.changedTouches.length?R.changedTouches[0]:null;if(this.target=R.target||R.srcElement,this.g=X,X=R.relatedTarget){if(Te){e:{try{fe(X.nodeName);var ht=!0;break e}catch{}ht=!1}ht||(X=null)}}else le=="mouseover"?X=R.fromElement:le=="mouseout"&&(X=R.toElement);this.relatedTarget=X,ke?(this.clientX=ke.clientX!==void 0?ke.clientX:ke.pageX,this.clientY=ke.clientY!==void 0?ke.clientY:ke.pageY,this.screenX=ke.screenX||0,this.screenY=ke.screenY||0):(this.clientX=R.clientX!==void 0?R.clientX:R.pageX,this.clientY=R.clientY!==void 0?R.clientY:R.pageY,this.screenX=R.screenX||0,this.screenY=R.screenY||0),this.button=R.button,this.key=R.key||"",this.ctrlKey=R.ctrlKey,this.altKey=R.altKey,this.shiftKey=R.shiftKey,this.metaKey=R.metaKey,this.pointerId=R.pointerId||0,this.pointerType=typeof R.pointerType=="string"?R.pointerType:pn[R.pointerType]||"",this.state=R.state,this.i=R,R.defaultPrevented&&Mt.aa.h.call(this)}}Q(Mt,pt);var pn={2:"touch",3:"pen",4:"mouse"};Mt.prototype.h=function(){Mt.aa.h.call(this);var R=this.i;R.preventDefault?R.preventDefault():R.returnValue=!1};var un="closure_listenable_"+(1e6*Math.random()|0),_n=0;function St(R,X,le,ke,ht){this.listener=R,this.proxy=null,this.src=X,this.type=le,this.capture=!!ke,this.ha=ht,this.key=++_n,this.da=this.fa=!1}function ln(R){R.da=!0,R.listener=null,R.proxy=null,R.src=null,R.ha=null}function Kt(R){this.src=R,this.g={},this.h=0}Kt.prototype.add=function(R,X,le,ke,ht){var kt=R.toString();R=this.g[kt],R||(R=this.g[kt]=[],this.h++);var Qt=Er(R,X,ke,ht);return-1<Qt?(X=R[Qt],le||(X.fa=!1)):(X=new St(X,this.src,kt,!!ke,ht),X.fa=le,R.push(X)),X};function xn(R,X){var le=X.type;if(le in R.g){var ke=R.g[le],ht=Array.prototype.indexOf.call(ke,X,void 0),kt;(kt=0<=ht)&&Array.prototype.splice.call(ke,ht,1),kt&&(ln(X),R.g[le].length==0&&(delete R.g[le],R.h--))}}function Er(R,X,le,ke){for(var ht=0;ht<R.length;++ht){var kt=R[ht];if(!kt.da&&kt.listener==X&&kt.capture==!!le&&kt.ha==ke)return ht}return-1}var Dn="closure_lm_"+(1e6*Math.random()|0),hr={};function Fr(R,X,le,ke,ht){if(Array.isArray(X)){for(var kt=0;kt<X.length;kt++)Fr(R,X[kt],le,ke,ht);return null}return le=Sr(le),R&&R[un]?R.K(X,le,A(ke)?!!ke.capture:!!ke,ht):ar(R,X,le,!1,ke,ht)}function ar(R,X,le,ke,ht,kt){if(!X)throw Error("Invalid event type");var Qt=A(ht)?!!ht.capture:!!ht,ri=Pt(R);if(ri||(R[Dn]=ri=new Kt(R)),le=ri.add(X,le,ke,Qt,kt),le.proxy)return le;if(ke=Yn(),le.proxy=ke,ke.src=R,ke.listener=le,R.addEventListener)jt||(ht=Qt),ht===void 0&&(ht=!1),R.addEventListener(X.toString(),ke,ht);else if(R.attachEvent)R.attachEvent(st(X.toString()),ke);else if(R.addListener&&R.removeListener)R.addListener(ke);else throw Error("addEventListener and attachEvent are unavailable.");return le}function Yn(){function R(le){return X.call(R.src,R.listener,le)}const X=rn;return R}function De(R,X,le,ke,ht){if(Array.isArray(X))for(var kt=0;kt<X.length;kt++)De(R,X[kt],le,ke,ht);else ke=A(ke)?!!ke.capture:!!ke,le=Sr(le),R&&R[un]?(R=R.i,X=String(X).toString(),X in R.g&&(kt=R.g[X],le=Er(kt,le,ke,ht),-1<le&&(ln(kt[le]),Array.prototype.splice.call(kt,le,1),kt.length==0&&(delete R.g[X],R.h--)))):R&&(R=Pt(R))&&(X=R.g[X.toString()],R=-1,X&&(R=Er(X,le,ke,ht)),(le=-1<R?X[R]:null)&&Ze(le))}function Ze(R){if(typeof R!="number"&&R&&!R.da){var X=R.src;if(X&&X[un])xn(X.i,R);else{var le=R.type,ke=R.proxy;X.removeEventListener?X.removeEventListener(le,ke,R.capture):X.detachEvent?X.detachEvent(st(le),ke):X.addListener&&X.removeListener&&X.removeListener(ke),(le=Pt(X))?(xn(le,R),le.h==0&&(le.src=null,X[Dn]=null)):ln(R)}}}function st(R){return R in hr?hr[R]:hr[R]="on"+R}function rn(R,X){if(R.da)R=!0;else{X=new Mt(X,this);var le=R.listener,ke=R.ha||R.src;R.fa&&Ze(R),R=le.call(ke,X)}return R}function Pt(R){return R=R[Dn],R instanceof Kt?R:null}var vn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Sr(R){return typeof R=="function"?R:(R[vn]||(R[vn]=function(X){return R.handleEvent(X)}),R[vn])}function yn(){wt.call(this),this.i=new Kt(this),this.M=this,this.F=null}Q(yn,wt),yn.prototype[un]=!0,yn.prototype.removeEventListener=function(R,X,le,ke){De(this,R,X,le,ke)};function Zn(R,X){var le,ke=R.F;if(ke)for(le=[];ke;ke=ke.F)le.push(ke);if(R=R.M,ke=X.type||X,typeof X=="string")X=new pt(X,R);else if(X instanceof pt)X.target=X.target||R;else{var ht=X;X=new pt(ke,R),ge(X,ht)}if(ht=!0,le)for(var kt=le.length-1;0<=kt;kt--){var Qt=X.g=le[kt];ht=br(Qt,ke,!0,X)&&ht}if(Qt=X.g=R,ht=br(Qt,ke,!0,X)&&ht,ht=br(Qt,ke,!1,X)&&ht,le)for(kt=0;kt<le.length;kt++)Qt=X.g=le[kt],ht=br(Qt,ke,!1,X)&&ht}yn.prototype.N=function(){if(yn.aa.N.call(this),this.i){var R=this.i,X;for(X in R.g){for(var le=R.g[X],ke=0;ke<le.length;ke++)ln(le[ke]);delete R.g[X],R.h--}}this.F=null},yn.prototype.K=function(R,X,le,ke){return this.i.add(String(R),X,!1,le,ke)},yn.prototype.L=function(R,X,le,ke){return this.i.add(String(R),X,!0,le,ke)};function br(R,X,le,ke){if(X=R.i.g[String(X)],!X)return!0;X=X.concat();for(var ht=!0,kt=0;kt<X.length;++kt){var Qt=X[kt];if(Qt&&!Qt.da&&Qt.capture==le){var ri=Qt.listener,us=Qt.ha||Qt.src;Qt.fa&&xn(R.i,Qt),ht=ri.call(us,ke)!==!1&&ht}}return ht&&!ke.defaultPrevented}function Lr(R,X,le){if(typeof R=="function")le&&(R=B(R,le));else if(R&&typeof R.handleEvent=="function")R=B(R.handleEvent,R);else throw Error("Invalid listener argument");return 2147483647<Number(X)?-1:T.setTimeout(R,X||0)}function Li(R){R.g=Lr(()=>{R.g=null,R.i&&(R.i=!1,Li(R))},R.l);const X=R.h;R.h=null,R.m.apply(null,X)}class dr extends wt{constructor(X,le){super(),this.m=X,this.l=le,this.h=null,this.i=!1,this.g=null}j(X){this.h=arguments,this.g?this.i=!0:Li(this)}N(){super.N(),this.g&&(T.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function zi(R){wt.call(this),this.h=R,this.g={}}Q(zi,wt);var ls=[];function Sn(R){Pe(R.g,function(X,le){this.g.hasOwnProperty(le)&&Ze(X)},R),R.g={}}zi.prototype.N=function(){zi.aa.N.call(this),Sn(this)},zi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var lr=T.JSON.stringify,hn=T.JSON.parse,Zs=class{stringify(R){return T.JSON.stringify(R,void 0)}parse(R){return T.JSON.parse(R,void 0)}};function Ei(){}Ei.prototype.h=null;function ao(R){return R.h||(R.h=R.i())}function _a(){}var en={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Kn(){pt.call(this,"d")}Q(Kn,pt);function ei(){pt.call(this,"c")}Q(ei,pt);var Ai={},vs=null;function xs(){return vs=vs||new yn}Ai.La="serverreachability";function Ps(R){pt.call(this,Ai.La,R)}Q(Ps,pt);function Ns(R){const X=xs();Zn(X,new Ps(X))}Ai.STAT_EVENT="statevent";function Ro(R,X){pt.call(this,Ai.STAT_EVENT,R),this.stat=X}Q(Ro,pt);function Ur(R){const X=xs();Zn(X,new Ro(X,R))}Ai.Ma="timingevent";function Ua(R,X){pt.call(this,Ai.Ma,R),this.size=X}Q(Ua,pt);function ti(R,X){if(typeof R!="function")throw Error("Fn must not be null and must be a function");return T.setTimeout(function(){R()},X)}function gi(){this.g=!0}gi.prototype.xa=function(){this.g=!1};function pl(R,X,le,ke,ht,kt){R.info(function(){if(R.g)if(kt)for(var Qt="",ri=kt.split("&"),us=0;us<ri.length;us++){var Vr=ri[us].split("=");if(1<Vr.length){var Es=Vr[0];Vr=Vr[1];var Ss=Es.split("_");Qt=2<=Ss.length&&Ss[1]=="type"?Qt+(Es+"="+Vr+"&"):Qt+(Es+"=redacted&")}}else Qt=null;else Qt=kt;return"XMLHTTP REQ ("+ke+") [attempt "+ht+"]: "+X+`
`+le+`
`+Qt})}function ya(R,X,le,ke,ht,kt,Qt){R.info(function(){return"XMLHTTP RESP ("+ke+") [ attempt "+ht+"]: "+X+`
`+le+`
`+kt+" "+Qt})}function lo(R,X,le,ke){R.info(function(){return"XMLHTTP TEXT ("+X+"): "+ku(R,le)+(ke?" "+ke:"")})}function Ni(R,X){R.info(function(){return"TIMEOUT: "+X})}gi.prototype.info=function(){};function ku(R,X){if(!R.g)return X;if(!X)return null;try{var le=JSON.parse(X);if(le){for(R=0;R<le.length;R++)if(Array.isArray(le[R])){var ke=le[R];if(!(2>ke.length)){var ht=ke[1];if(Array.isArray(ht)&&!(1>ht.length)){var kt=ht[0];if(kt!="noop"&&kt!="stop"&&kt!="close")for(var Qt=1;Qt<ht.length;Qt++)ht[Qt]=""}}}}return lr(le)}catch{return X}}var Ve={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ee={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},oe;function be(){}Q(be,Ei),be.prototype.g=function(){return new XMLHttpRequest},be.prototype.i=function(){return{}},oe=new be;function Le(R,X,le,ke){this.j=R,this.i=X,this.l=le,this.R=ke||1,this.U=new zi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Oe}function Oe(){this.i=null,this.g="",this.h=!1}var qe={},nt={};function Ge(R,X,le){R.L=1,R.v=Mc(Mo(X)),R.m=le,R.P=!0,et(R,null)}function et(R,X){R.F=Date.now(),Gt(R),R.A=Mo(R.v);var le=R.A,ke=R.R;Array.isArray(ke)||(ke=[String(ke)]),wm(le.i,"t",ke),R.C=0,le=R.j.J,R.h=new Oe,R.g=Vc(R.j,le?X:null,!R.m),0<R.O&&(R.M=new dr(B(R.Y,R,R.g),R.O)),X=R.U,le=R.g,ke=R.ca;var ht="readystatechange";Array.isArray(ht)||(ht&&(ls[0]=ht.toString()),ht=ls);for(var kt=0;kt<ht.length;kt++){var Qt=Fr(le,ht[kt],ke||X.handleEvent,!1,X.h||X);if(!Qt)break;X.g[Qt.key]=Qt}X=R.H?he(R.H):{},R.m?(R.u||(R.u="POST"),X["Content-Type"]="application/x-www-form-urlencoded",R.g.ea(R.A,R.u,R.m,X)):(R.u="GET",R.g.ea(R.A,R.u,null,X)),Ns(),pl(R.i,R.u,R.A,R.l,R.R,R.m)}Le.prototype.ca=function(R){R=R.target;const X=this.M;X&&Qo(R)==3?X.j():this.Y(R)},Le.prototype.Y=function(R){try{if(R==this.g)e:{const Ss=Qo(this.g);var X=this.g.Ba();const Jl=this.g.Z();if(!(3>Ss)&&(Ss!=3||this.g&&(this.h.h||this.g.oa()||Zl(this.g)))){this.J||Ss!=4||X==7||(X==8||0>=Jl?Ns(3):Ns(2)),En(this);var le=this.g.Z();this.X=le;t:if(_t(this)){var ke=Zl(this.g);R="";var ht=ke.length,kt=Qo(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Cn(this),nr(this);var Qt="";break t}this.h.i=new T.TextDecoder}for(X=0;X<ht;X++)this.h.h=!0,R+=this.h.i.decode(ke[X],{stream:!(kt&&X==ht-1)});ke.length=0,this.h.g+=R,this.C=0,Qt=this.h.g}else Qt=this.g.oa();if(this.o=le==200,ya(this.i,this.u,this.A,this.l,this.R,Ss,le),this.o){if(this.T&&!this.K){t:{if(this.g){var ri,us=this.g;if((ri=us.g?us.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Y(ri)){var Vr=ri;break t}}Vr=null}if(le=Vr)lo(this.i,this.l,le,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,rr(this,le);else{this.o=!1,this.s=3,Ur(12),Cn(this),nr(this);break e}}if(this.P){le=!0;let es;for(;!this.J&&this.C<Qt.length;)if(es=yt(this,Qt),es==nt){Ss==4&&(this.s=4,Ur(14),le=!1),lo(this.i,this.l,null,"[Incomplete Response]");break}else if(es==qe){this.s=4,Ur(15),lo(this.i,this.l,Qt,"[Invalid Chunk]"),le=!1;break}else lo(this.i,this.l,es,null),rr(this,es);if(_t(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ss!=4||Qt.length!=0||this.h.h||(this.s=1,Ur(16),le=!1),this.o=this.o&&le,!le)lo(this.i,this.l,Qt,"[Invalid Chunked Response]"),Cn(this),nr(this);else if(0<Qt.length&&!this.W){this.W=!0;var Es=this.j;Es.g==this&&Es.ba&&!Es.M&&(Es.j.info("Great, no buffering proxy detected. Bytes received: "+Qt.length),cs(Es),Es.M=!0,Ur(11))}}else lo(this.i,this.l,Qt,null),rr(this,Qt);Ss==4&&Cn(this),this.o&&!this.J&&(Ss==4?Sm(this.j,this):(this.o=!1,Gt(this)))}else Nu(this.g),le==400&&0<Qt.indexOf("Unknown SID")?(this.s=3,Ur(12)):(this.s=0,Ur(13)),Cn(this),nr(this)}}}catch{}finally{}};function _t(R){return R.g?R.u=="GET"&&R.L!=2&&R.j.Ca:!1}function yt(R,X){var le=R.C,ke=X.indexOf(`
`,le);return ke==-1?nt:(le=Number(X.substring(le,ke)),isNaN(le)?qe:(ke+=1,ke+le>X.length?nt:(X=X.slice(ke,ke+le),R.C=ke+le,X)))}Le.prototype.cancel=function(){this.J=!0,Cn(this)};function Gt(R){R.S=Date.now()+R.I,fn(R,R.I)}function fn(R,X){if(R.B!=null)throw Error("WatchDog timer not null");R.B=ti(B(R.ba,R),X)}function En(R){R.B&&(T.clearTimeout(R.B),R.B=null)}Le.prototype.ba=function(){this.B=null;const R=Date.now();0<=R-this.S?(Ni(this.i,this.A),this.L!=2&&(Ns(),Ur(17)),Cn(this),this.s=2,nr(this)):fn(this,this.S-R)};function nr(R){R.j.G==0||R.J||Sm(R.j,R)}function Cn(R){En(R);var X=R.M;X&&typeof X.ma=="function"&&X.ma(),R.M=null,Sn(R.U),R.g&&(X=R.g,R.g=null,X.abort(),X.ma())}function rr(R,X){try{var le=R.j;if(le.G!=0&&(le.g==R||di(le.h,R))){if(!R.K&&di(le.h,R)&&le.G==3){try{var ke=le.Da.g.parse(X)}catch{ke=null}if(Array.isArray(ke)&&ke.length==3){var ht=ke;if(ht[0]==0){e:if(!le.u){if(le.g)if(le.g.F+3e3<R.F)Jo(le),Kl(le);else break e;Rs(le),Ur(18)}}else le.za=ht[1],0<le.za-le.T&&37500>ht[2]&&le.F&&le.v==0&&!le.C&&(le.C=ti(B(le.Za,le),6e3));if(1>=ir(le.h)&&le.ca){try{le.ca()}catch{}le.ca=void 0}}else Do(le,11)}else if((R.K||le.g==R)&&Jo(le),!Y(X))for(ht=le.Da.g.parse(X),X=0;X<ht.length;X++){let Vr=ht[X];if(le.T=Vr[0],Vr=Vr[1],le.G==2)if(Vr[0]=="c"){le.K=Vr[1],le.ia=Vr[2];const Es=Vr[3];Es!=null&&(le.la=Es,le.j.info("VER="+le.la));const Ss=Vr[4];Ss!=null&&(le.Aa=Ss,le.j.info("SVER="+le.Aa));const Jl=Vr[5];Jl!=null&&typeof Jl=="number"&&0<Jl&&(ke=1.5*Jl,le.L=ke,le.j.info("backChannelRequestTimeoutMs_="+ke)),ke=le;const es=R.g;if(es){const ec=es.g?es.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ec){var kt=ke.h;kt.g||ec.indexOf("spdy")==-1&&ec.indexOf("quic")==-1&&ec.indexOf("h2")==-1||(kt.j=kt.l,kt.g=new Set,kt.h&&(fi(kt,kt.h),kt.h=null))}if(ke.D){const Kh=es.g?es.g.getResponseHeader("X-HTTP-Session-Id"):null;Kh&&(ke.ya=Kh,si(ke.I,ke.D,Kh))}}le.G=3,le.l&&le.l.ua(),le.ba&&(le.R=Date.now()-R.F,le.j.info("Handshake RTT: "+le.R+"ms")),ke=le;var Qt=R;if(ke.qa=Xh(ke,ke.J?ke.ia:null,ke.W),Qt.K){ji(ke.h,Qt);var ri=Qt,us=ke.L;us&&(ri.I=us),ri.B&&(En(ri),Gt(ri)),ke.g=Qt}else Ts(ke);0<le.i.length&&va(le)}else Vr[0]!="stop"&&Vr[0]!="close"||Do(le,7);else le.G==3&&(Vr[0]=="stop"||Vr[0]=="close"?Vr[0]=="stop"?Do(le,7):Zh(le):Vr[0]!="noop"&&le.l&&le.l.ta(Vr),le.v=0)}}Ns(4)}catch{}}var on=class{constructor(R,X){this.g=R,this.map=X}};function Hr(R){this.l=R||10,T.PerformanceNavigationTiming?(R=T.performance.getEntriesByType("navigation"),R=0<R.length&&(R[0].nextHopProtocol=="hq"||R[0].nextHopProtocol=="h2")):R=!!(T.chrome&&T.chrome.loadTimes&&T.chrome.loadTimes()&&T.chrome.loadTimes().wasFetchedViaSpdy),this.j=R?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function fr(R){return R.h?!0:R.g?R.g.size>=R.j:!1}function ir(R){return R.h?1:R.g?R.g.size:0}function di(R,X){return R.h?R.h==X:R.g?R.g.has(X):!1}function fi(R,X){R.g?R.g.add(X):R.h=X}function ji(R,X){R.h&&R.h==X?R.h=null:R.g&&R.g.has(X)&&R.g.delete(X)}Hr.prototype.cancel=function(){if(this.i=bs(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const R of this.g.values())R.cancel();this.g.clear()}};function bs(R){if(R.h!=null)return R.i.concat(R.h.D);if(R.g!=null&&R.g.size!==0){let X=R.i;for(const le of R.g.values())X=X.concat(le.D);return X}return re(R.i)}function Fs(R){if(R.V&&typeof R.V=="function")return R.V();if(typeof Map<"u"&&R instanceof Map||typeof Set<"u"&&R instanceof Set)return Array.from(R.values());if(typeof R=="string")return R.split("");if(a(R)){for(var X=[],le=R.length,ke=0;ke<le;ke++)X.push(R[ke]);return X}X=[],le=0;for(ke in R)X[le++]=R[ke];return X}function Gl(R){if(R.na&&typeof R.na=="function")return R.na();if(!R.V||typeof R.V!="function"){if(typeof Map<"u"&&R instanceof Map)return Array.from(R.keys());if(!(typeof Set<"u"&&R instanceof Set)){if(a(R)||typeof R=="string"){var X=[];R=R.length;for(var le=0;le<R;le++)X.push(le);return X}X=[],le=0;for(const ke in R)X[le++]=ke;return X}}}function jh(R,X){if(R.forEach&&typeof R.forEach=="function")R.forEach(X,void 0);else if(a(R)||typeof R=="string")Array.prototype.forEach.call(R,X,void 0);else for(var le=Gl(R),ke=Fs(R),ht=ke.length,kt=0;kt<ht;kt++)X.call(void 0,ke[kt],le&&le[kt],R)}var $h=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Du(R,X){if(R){R=R.split("&");for(var le=0;le<R.length;le++){var ke=R[le].indexOf("="),ht=null;if(0<=ke){var kt=R[le].substring(0,ke);ht=R[le].substring(ke+1)}else kt=R[le];X(kt,ht?decodeURIComponent(ht.replace(/\+/g," ")):"")}}}function Mn(R){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,R instanceof Mn){this.h=R.h,Ko(this,R.j),this.o=R.o,this.g=R.g,Rc(this,R.s),this.l=R.l;var X=R.i,le=new Dc;le.i=X.i,X.g&&(le.g=new Map(X.g),le.h=X.h),Gh(this,le),this.m=R.m}else R&&(X=String(R).match($h))?(this.h=!1,Ko(this,X[1]||"",!0),this.o=ql(X[2]||""),this.g=ql(X[3]||"",!0),Rc(this,X[4]),this.l=ql(X[5]||"",!0),Gh(this,X[6]||"",!0),this.m=ql(X[7]||"")):(this.h=!1,this.i=new Dc(null,this.h))}Mn.prototype.toString=function(){var R=[],X=this.j;X&&R.push(Wl(X,kc,!0),":");var le=this.g;return(le||X=="file")&&(R.push("//"),(X=this.o)&&R.push(Wl(X,kc,!0),"@"),R.push(encodeURIComponent(String(le)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),le=this.s,le!=null&&R.push(":",String(le))),(le=this.l)&&(this.g&&le.charAt(0)!="/"&&R.push("/"),R.push(Wl(le,le.charAt(0)=="/"?qh:Ou,!0))),(le=this.i.toString())&&R.push("?",le),(le=this.m)&&R.push("#",Wl(le,xm)),R.join("")};function Mo(R){return new Mn(R)}function Ko(R,X,le){R.j=le?ql(X,!0):X,R.j&&(R.j=R.j.replace(/:$/,""))}function Rc(R,X){if(X){if(X=Number(X),isNaN(X)||0>X)throw Error("Bad port number "+X);R.s=X}else R.s=null}function Gh(R,X,le){X instanceof Dc?(R.i=X,Tm(R.i,R.h)):(le||(X=Wl(X,Wh)),R.i=new Dc(X,R.h))}function si(R,X,le){R.i.set(X,le)}function Mc(R){return si(R,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),R}function ql(R,X){return R?X?decodeURI(R.replace(/%25/g,"%2525")):decodeURIComponent(R):""}function Wl(R,X,le){return typeof R=="string"?(R=encodeURI(R).replace(X,Cf),le&&(R=R.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),R):null}function Cf(R){return R=R.charCodeAt(0),"%"+(R>>4&15).toString(16)+(R&15).toString(16)}var kc=/[#\/\?@]/g,Ou=/[#\?:]/g,qh=/[#\?]/g,Wh=/[#\?@]/g,xm=/#/g;function Dc(R,X){this.h=this.g=null,this.i=R||null,this.j=!!X}function vo(R){R.g||(R.g=new Map,R.h=0,R.i&&Du(R.i,function(X,le){R.add(decodeURIComponent(X.replace(/\+/g," ")),le)}))}t=Dc.prototype,t.add=function(R,X){vo(this),this.i=null,R=Oc(this,R);var le=this.g.get(R);return le||this.g.set(R,le=[]),le.push(X),this.h+=1,this};function sr(R,X){vo(R),X=Oc(R,X),R.g.has(X)&&(R.i=null,R.h-=R.g.get(X).length,R.g.delete(X))}function bm(R,X){return vo(R),X=Oc(R,X),R.g.has(X)}t.forEach=function(R,X){vo(this),this.g.forEach(function(le,ke){le.forEach(function(ht){R.call(X,ht,ke,this)},this)},this)},t.na=function(){vo(this);const R=Array.from(this.g.values()),X=Array.from(this.g.keys()),le=[];for(let ke=0;ke<X.length;ke++){const ht=R[ke];for(let kt=0;kt<ht.length;kt++)le.push(X[ke])}return le},t.V=function(R){vo(this);let X=[];if(typeof R=="string")bm(this,R)&&(X=X.concat(this.g.get(Oc(this,R))));else{R=Array.from(this.g.values());for(let le=0;le<R.length;le++)X=X.concat(R[le])}return X},t.set=function(R,X){return vo(this),this.i=null,R=Oc(this,R),bm(this,R)&&(this.h-=this.g.get(R).length),this.g.set(R,[X]),this.h+=1,this},t.get=function(R,X){return R?(R=this.V(R),0<R.length?String(R[0]):X):X};function wm(R,X,le){sr(R,X),0<le.length&&(R.i=null,R.g.set(Oc(R,X),re(le)),R.h+=le.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const R=[],X=Array.from(this.g.keys());for(var le=0;le<X.length;le++){var ke=X[le];const kt=encodeURIComponent(String(ke)),Qt=this.V(ke);for(ke=0;ke<Qt.length;ke++){var ht=kt;Qt[ke]!==""&&(ht+="="+encodeURIComponent(String(Qt[ke]))),R.push(ht)}}return this.i=R.join("&")};function Oc(R,X){return X=String(X),R.j&&(X=X.toLowerCase()),X}function Tm(R,X){X&&!R.j&&(vo(R),R.i=null,R.g.forEach(function(le,ke){var ht=ke.toLowerCase();ke!=ht&&(sr(this,ke),wm(this,ht,le))},R)),R.j=X}function gy(R,X){const le=new gi;if(T.Image){const ke=new Image;ke.onload=H(ko,le,"TestLoadImage: loaded",!0,X,ke),ke.onerror=H(ko,le,"TestLoadImage: error",!1,X,ke),ke.onabort=H(ko,le,"TestLoadImage: abort",!1,X,ke),ke.ontimeout=H(ko,le,"TestLoadImage: timeout",!1,X,ke),T.setTimeout(function(){ke.ontimeout&&ke.ontimeout()},1e4),ke.src=R}else X(!1)}function Pf(R,X){const le=new gi,ke=new AbortController,ht=setTimeout(()=>{ke.abort(),ko(le,"TestPingServer: timeout",!1,X)},1e4);fetch(R,{signal:ke.signal}).then(kt=>{clearTimeout(ht),kt.ok?ko(le,"TestPingServer: ok",!0,X):ko(le,"TestPingServer: server error",!1,X)}).catch(()=>{clearTimeout(ht),ko(le,"TestPingServer: error",!1,X)})}function ko(R,X,le,ke,ht){try{ht&&(ht.onload=null,ht.onerror=null,ht.onabort=null,ht.ontimeout=null),ke(le)}catch{}}function xo(){this.g=new Zs}function Em(R,X,le){const ke=le||"";try{jh(R,function(ht,kt){let Qt=ht;A(ht)&&(Qt=lr(ht)),X.push(ke+kt+"="+encodeURIComponent(Qt))})}catch(ht){throw X.push(ke+"type="+encodeURIComponent("_badmap")),ht}}function Lc(R){this.l=R.Ub||null,this.j=R.eb||!1}Q(Lc,Ei),Lc.prototype.g=function(){return new zc(this.l,this.j)},Lc.prototype.i=function(R){return function(){return R}}({});function zc(R,X){yn.call(this),this.D=R,this.o=X,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}Q(zc,yn),t=zc.prototype,t.open=function(R,X){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=R,this.A=X,this.readyState=1,Nt(this)},t.send=function(R){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const X={headers:this.u,method:this.B,credentials:this.m,cache:void 0};R&&(X.body=R),(this.D||T).fetch(new Request(this.A,X)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Yo(this)),this.readyState=0},t.Sa=function(R){if(this.g&&(this.l=R,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=R.headers,this.readyState=2,Nt(this)),this.g&&(this.readyState=3,Nt(this),this.g)))if(this.responseType==="arraybuffer")R.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof T.ReadableStream<"u"&&"body"in R){if(this.j=R.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Nc(this)}else R.text().then(this.Ra.bind(this),this.ga.bind(this))};function Nc(R){R.j.read().then(R.Pa.bind(R)).catch(R.ga.bind(R))}t.Pa=function(R){if(this.g){if(this.o&&R.value)this.response.push(R.value);else if(!this.o){var X=R.value?R.value:new Uint8Array(0);(X=this.v.decode(X,{stream:!R.done}))&&(this.response=this.responseText+=X)}R.done?Yo(this):Nt(this),this.readyState==3&&Nc(this)}},t.Ra=function(R){this.g&&(this.response=this.responseText=R,Yo(this))},t.Qa=function(R){this.g&&(this.response=R,Yo(this))},t.ga=function(){this.g&&Yo(this)};function Yo(R){R.readyState=4,R.l=null,R.j=null,R.v=null,Nt(R)}t.setRequestHeader=function(R,X){this.u.append(R,X)},t.getResponseHeader=function(R){return this.h&&this.h.get(R.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const R=[],X=this.h.entries();for(var le=X.next();!le.done;)le=le.value,R.push(le[0]+": "+le[1]),le=X.next();return R.join(`\r
`)};function Nt(R){R.onreadystatechange&&R.onreadystatechange.call(R)}Object.defineProperty(zc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(R){this.m=R?"include":"same-origin"}});function Hl(R){let X="";return Pe(R,function(le,ke){X+=ke,X+=":",X+=le,X+=`\r
`}),X}function Hh(R,X,le){e:{for(ke in le){var ke=!1;break e}ke=!0}ke||(le=Hl(le),typeof R=="string"?le!=null&&encodeURIComponent(String(le)):si(R,X,le))}function oi(R){yn.call(this),this.headers=new Map,this.o=R||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}Q(oi,yn);var Qn=/^https?$/i,Xs=["POST","PUT"];t=oi.prototype,t.Ha=function(R){this.J=R},t.ea=function(R,X,le,ke){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+R);X=X?X.toUpperCase():"GET",this.D=R,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():oe.g(),this.v=this.o?ao(this.o):ao(oe),this.g.onreadystatechange=B(this.Ea,this);try{this.B=!0,this.g.open(X,String(R),!0),this.B=!1}catch(kt){Fc(this,kt);return}if(R=le||"",le=new Map(this.headers),ke)if(Object.getPrototypeOf(ke)===Object.prototype)for(var ht in ke)le.set(ht,ke[ht]);else if(typeof ke.keys=="function"&&typeof ke.get=="function")for(const kt of ke.keys())le.set(kt,ke.get(kt));else throw Error("Unknown input type for opt_headers: "+String(ke));ke=Array.from(le.keys()).find(kt=>kt.toLowerCase()=="content-type"),ht=T.FormData&&R instanceof T.FormData,!(0<=Array.prototype.indexOf.call(Xs,X,void 0))||ke||ht||le.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[kt,Qt]of le)this.g.setRequestHeader(kt,Qt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Gn(this),this.u=!0,this.g.send(R),this.u=!1}catch(kt){Fc(this,kt)}};function Fc(R,X){R.h=!1,R.g&&(R.j=!0,R.g.abort(),R.j=!1),R.l=X,R.m=5,Lu(R),co(R)}function Lu(R){R.A||(R.A=!0,Zn(R,"complete"),Zn(R,"error"))}t.abort=function(R){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=R||7,Zn(this,"complete"),Zn(this,"abort"),co(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),co(this,!0)),oi.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?zu(this):this.bb())},t.bb=function(){zu(this)};function zu(R){if(R.h&&typeof y<"u"&&(!R.v[1]||Qo(R)!=4||R.Z()!=2)){if(R.u&&Qo(R)==4)Lr(R.Ea,0,R);else if(Zn(R,"readystatechange"),Qo(R)==4){R.h=!1;try{const Qt=R.Z();e:switch(Qt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var X=!0;break e;default:X=!1}var le;if(!(le=X)){var ke;if(ke=Qt===0){var ht=String(R.D).match($h)[1]||null;!ht&&T.self&&T.self.location&&(ht=T.self.location.protocol.slice(0,-1)),ke=!Qn.test(ht?ht.toLowerCase():"")}le=ke}if(le)Zn(R,"complete"),Zn(R,"success");else{R.m=6;try{var kt=2<Qo(R)?R.g.statusText:""}catch{kt=""}R.l=kt+" ["+R.Z()+"]",Lu(R)}}finally{co(R)}}}}function co(R,X){if(R.g){Gn(R);const le=R.g,ke=R.v[0]?()=>{}:null;R.g=null,R.v=null,X||Zn(R,"ready");try{le.onreadystatechange=ke}catch{}}}function Gn(R){R.I&&(T.clearTimeout(R.I),R.I=null)}t.isActive=function(){return!!this.g};function Qo(R){return R.g?R.g.readyState:0}t.Z=function(){try{return 2<Qo(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(R){if(this.g){var X=this.g.responseText;return R&&X.indexOf(R)==0&&(X=X.substring(R.length)),hn(X)}};function Zl(R){try{if(!R.g)return null;if("response"in R.g)return R.g.response;switch(R.H){case"":case"text":return R.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in R.g)return R.g.mozResponseArrayBuffer}return null}catch{return null}}function Nu(R){const X={};R=(R.g&&2<=Qo(R)&&R.g.getAllResponseHeaders()||"").split(`\r
`);for(let ke=0;ke<R.length;ke++){if(Y(R[ke]))continue;var le=_e(R[ke]);const ht=le[0];if(le=le[1],typeof le!="string")continue;le=le.trim();const kt=X[ht]||[];X[ht]=kt,kt.push(le)}ce(X,function(ke){return ke.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Xl(R,X,le){return le&&le.internalChannelParams&&le.internalChannelParams[R]||X}function ws(R){this.Aa=0,this.i=[],this.j=new gi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Xl("failFast",!1,R),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Xl("baseRetryDelayMs",5e3,R),this.cb=Xl("retryDelaySeedMs",1e4,R),this.Wa=Xl("forwardChannelMaxRetries",2,R),this.wa=Xl("forwardChannelRequestTimeoutMs",2e4,R),this.pa=R&&R.xmlHttpFactory||void 0,this.Xa=R&&R.Tb||void 0,this.Ca=R&&R.useFetchStreams||!1,this.L=void 0,this.J=R&&R.supportsCrossDomainXhr||!1,this.K="",this.h=new Hr(R&&R.concurrentRequestLimit),this.Da=new xo,this.P=R&&R.fastHandshake||!1,this.O=R&&R.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=R&&R.Rb||!1,R&&R.xa&&this.j.xa(),R&&R.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&R&&R.detectBufferingProxy||!1,this.ja=void 0,R&&R.longPollingTimeout&&0<R.longPollingTimeout&&(this.ja=R.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=ws.prototype,t.la=8,t.G=1,t.connect=function(R,X,le,ke){Ur(0),this.W=R,this.H=X||{},le&&ke!==void 0&&(this.H.OSID=le,this.H.OAID=ke),this.F=this.X,this.I=Xh(this,null,this.W),va(this)};function Zh(R){if(Yl(R),R.G==3){var X=R.U++,le=Mo(R.I);if(si(le,"SID",R.K),si(le,"RID",X),si(le,"TYPE","terminate"),Va(R,le),X=new Le(R,R.j,X),X.L=2,X.v=Mc(Mo(le)),le=!1,T.navigator&&T.navigator.sendBeacon)try{le=T.navigator.sendBeacon(X.v.toString(),"")}catch{}!le&&T.Image&&(new Image().src=X.v,le=!0),le||(X.g=Vc(X.j,null),X.g.ea(X.v)),X.F=Date.now(),Gt(X)}Uc(R)}function Kl(R){R.g&&(cs(R),R.g.cancel(),R.g=null)}function Yl(R){Kl(R),R.u&&(T.clearTimeout(R.u),R.u=null),Jo(R),R.h.cancel(),R.s&&(typeof R.s=="number"&&T.clearTimeout(R.s),R.s=null)}function va(R){if(!fr(R.h)&&!R.s){R.s=!0;var X=R.Ga;bt||Zt(),at||(bt(),at=!0),Ct.add(X,R),R.B=0}}function Rf(R,X){return ir(R.h)>=R.h.j-(R.s?1:0)?!1:R.s?(R.i=X.D.concat(R.i),!0):R.G==1||R.G==2||R.B>=(R.Va?0:R.Wa)?!1:(R.s=ti(B(R.Ga,R,X),Ql(R,R.B)),R.B++,!0)}t.Ga=function(R){if(this.s)if(this.s=null,this.G==1){if(!R){this.U=Math.floor(1e5*Math.random()),R=this.U++;const ht=new Le(this,this.j,R);let kt=this.o;if(this.S&&(kt?(kt=he(kt),ge(kt,this.S)):kt=this.S),this.m!==null||this.O||(ht.H=kt,kt=null),this.P)e:{for(var X=0,le=0;le<this.i.length;le++){t:{var ke=this.i[le];if("__data__"in ke.map&&(ke=ke.map.__data__,typeof ke=="string")){ke=ke.length;break t}ke=void 0}if(ke===void 0)break;if(X+=ke,4096<X){X=le;break e}if(X===4096||le===this.i.length-1){X=le+1;break e}}X=1e3}else X=1e3;X=Bc(this,ht,X),le=Mo(this.I),si(le,"RID",R),si(le,"CVER",22),this.D&&si(le,"X-HTTP-Session-Id",this.D),Va(this,le),kt&&(this.O?X="headers="+encodeURIComponent(String(Hl(kt)))+"&"+X:this.m&&Hh(le,this.m,kt)),fi(this.h,ht),this.Ua&&si(le,"TYPE","init"),this.P?(si(le,"$req",X),si(le,"SID","null"),ht.T=!0,Ge(ht,le,null)):Ge(ht,le,X),this.G=2}}else this.G==3&&(R?Fu(this,R):this.i.length==0||fr(this.h)||Fu(this))};function Fu(R,X){var le;X?le=X.l:le=R.U++;const ke=Mo(R.I);si(ke,"SID",R.K),si(ke,"RID",le),si(ke,"AID",R.T),Va(R,ke),R.m&&R.o&&Hh(ke,R.m,R.o),le=new Le(R,R.j,le,R.B+1),R.m===null&&(le.H=R.o),X&&(R.i=X.D.concat(R.i)),X=Bc(R,le,1e3),le.I=Math.round(.5*R.wa)+Math.round(.5*R.wa*Math.random()),fi(R.h,le),Ge(le,ke,X)}function Va(R,X){R.H&&Pe(R.H,function(le,ke){si(X,ke,le)}),R.l&&jh({},function(le,ke){si(X,ke,le)})}function Bc(R,X,le){le=Math.min(R.i.length,le);var ke=R.l?B(R.l.Na,R.l,R):null;e:{var ht=R.i;let kt=-1;for(;;){const Qt=["count="+le];kt==-1?0<le?(kt=ht[0].g,Qt.push("ofs="+kt)):kt=0:Qt.push("ofs="+kt);let ri=!0;for(let us=0;us<le;us++){let Vr=ht[us].g;const Es=ht[us].map;if(Vr-=kt,0>Vr)kt=Math.max(0,ht[us].g-100),ri=!1;else try{Em(Es,Qt,"req"+Vr+"_")}catch{ke&&ke(Es)}}if(ri){ke=Qt.join("&");break e}}}return R=R.i.splice(0,le),X.D=R,ke}function Ts(R){if(!R.g&&!R.u){R.Y=1;var X=R.Fa;bt||Zt(),at||(bt(),at=!0),Ct.add(X,R),R.v=0}}function Rs(R){return R.g||R.u||3<=R.v?!1:(R.Y++,R.u=ti(B(R.Fa,R),Ql(R,R.v)),R.v++,!0)}t.Fa=function(){if(this.u=null,_i(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var R=2*this.R;this.j.info("BP detection timer enabled: "+R),this.A=ti(B(this.ab,this),R)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ur(10),Kl(this),_i(this))};function cs(R){R.A!=null&&(T.clearTimeout(R.A),R.A=null)}function _i(R){R.g=new Le(R,R.j,"rpc",R.Y),R.m===null&&(R.g.H=R.o),R.g.O=0;var X=Mo(R.qa);si(X,"RID","rpc"),si(X,"SID",R.K),si(X,"AID",R.T),si(X,"CI",R.F?"0":"1"),!R.F&&R.ja&&si(X,"TO",R.ja),si(X,"TYPE","xmlhttp"),Va(R,X),R.m&&R.o&&Hh(X,R.m,R.o),R.L&&(R.g.I=R.L);var le=R.g;R=R.ia,le.L=1,le.v=Mc(Mo(X)),le.m=null,le.P=!0,et(le,R)}t.Za=function(){this.C!=null&&(this.C=null,Kl(this),Rs(this),Ur(19))};function Jo(R){R.C!=null&&(T.clearTimeout(R.C),R.C=null)}function Sm(R,X){var le=null;if(R.g==X){Jo(R),cs(R),R.g=null;var ke=2}else if(di(R.h,X))le=X.D,ji(R.h,X),ke=1;else return;if(R.G!=0){if(X.o)if(ke==1){le=X.m?X.m.length:0,X=Date.now()-X.F;var ht=R.B;ke=xs(),Zn(ke,new Ua(ke,le)),va(R)}else Ts(R);else if(ht=X.s,ht==3||ht==0&&0<X.X||!(ke==1&&Rf(R,X)||ke==2&&Rs(R)))switch(le&&0<le.length&&(X=R.h,X.i=X.i.concat(le)),ht){case 1:Do(R,5);break;case 4:Do(R,10);break;case 3:Do(R,6);break;default:Do(R,2)}}}function Ql(R,X){let le=R.Ta+Math.floor(Math.random()*R.cb);return R.isActive()||(le*=2),le*X}function Do(R,X){if(R.j.info("Error code "+X),X==2){var le=B(R.fb,R),ke=R.Xa;const ht=!ke;ke=new Mn(ke||"//www.google.com/images/cleardot.gif"),T.location&&T.location.protocol=="http"||Ko(ke,"https"),Mc(ke),ht?gy(ke.toString(),le):Pf(ke.toString(),le)}else Ur(2);R.G=0,R.l&&R.l.sa(X),Uc(R),Yl(R)}t.fb=function(R){R?(this.j.info("Successfully pinged google.com"),Ur(2)):(this.j.info("Failed to ping google.com"),Ur(1))};function Uc(R){if(R.G=0,R.ka=[],R.l){const X=bs(R.h);(X.length!=0||R.i.length!=0)&&(se(R.ka,X),se(R.ka,R.i),R.h.i.length=0,re(R.i),R.i.length=0),R.l.ra()}}function Xh(R,X,le){var ke=le instanceof Mn?Mo(le):new Mn(le);if(ke.g!="")X&&(ke.g=X+"."+ke.g),Rc(ke,ke.s);else{var ht=T.location;ke=ht.protocol,X=X?X+"."+ht.hostname:ht.hostname,ht=+ht.port;var kt=new Mn(null);ke&&Ko(kt,ke),X&&(kt.g=X),ht&&Rc(kt,ht),le&&(kt.l=le),ke=kt}return le=R.D,X=R.ya,le&&X&&si(ke,le,X),si(ke,"VER",R.la),Va(R,ke),ke}function Vc(R,X,le){if(X&&!R.J)throw Error("Can't create secondary domain capable XhrIo object.");return X=R.Ca&&!R.pa?new oi(new Lc({eb:le})):new oi(R.pa),X.Ha(R.J),X}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function ja(){}t=ja.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function ml(){}ml.prototype.g=function(R,X){return new Ji(R,X)};function Ji(R,X){yn.call(this),this.g=new ws(X),this.l=R,this.h=X&&X.messageUrlParams||null,R=X&&X.messageHeaders||null,X&&X.clientProtocolHeaderRequired&&(R?R["X-Client-Protocol"]="webchannel":R={"X-Client-Protocol":"webchannel"}),this.g.o=R,R=X&&X.initMessageHeaders||null,X&&X.messageContentType&&(R?R["X-WebChannel-Content-Type"]=X.messageContentType:R={"X-WebChannel-Content-Type":X.messageContentType}),X&&X.va&&(R?R["X-WebChannel-Client-Profile"]=X.va:R={"X-WebChannel-Client-Profile":X.va}),this.g.S=R,(R=X&&X.Sb)&&!Y(R)&&(this.g.m=R),this.v=X&&X.supportsCrossDomainXhr||!1,this.u=X&&X.sendRawJson||!1,(X=X&&X.httpSessionIdParam)&&!Y(X)&&(this.g.D=X,R=this.h,R!==null&&X in R&&(R=this.h,X in R&&delete R[X])),this.j=new $a(this)}Q(Ji,yn),Ji.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ji.prototype.close=function(){Zh(this.g)},Ji.prototype.o=function(R){var X=this.g;if(typeof R=="string"){var le={};le.__data__=R,R=le}else this.u&&(le={},le.__data__=lr(R),R=le);X.i.push(new on(X.Ya++,R)),X.G==3&&va(X)},Ji.prototype.N=function(){this.g.l=null,delete this.j,Zh(this.g),delete this.g,Ji.aa.N.call(this)};function jc(R){Kn.call(this),R.__headers__&&(this.headers=R.__headers__,this.statusCode=R.__status__,delete R.__headers__,delete R.__status__);var X=R.__sm__;if(X){e:{for(const le in X){R=le;break e}R=void 0}(this.i=R)&&(R=this.i,X=X!==null&&R in X?X[R]:void 0),this.data=X}else this.data=R}Q(jc,Kn);function $c(){ei.call(this),this.status=1}Q($c,ei);function $a(R){this.g=R}Q($a,ja),$a.prototype.ua=function(){Zn(this.g,"a")},$a.prototype.ta=function(R){Zn(this.g,new jc(R))},$a.prototype.sa=function(R){Zn(this.g,new $c)},$a.prototype.ra=function(){Zn(this.g,"b")},ml.prototype.createWebChannel=ml.prototype.g,Ji.prototype.send=Ji.prototype.o,Ji.prototype.open=Ji.prototype.m,Ji.prototype.close=Ji.prototype.close,u9=function(){return new ml},c9=function(){return xs()},l9=Ai,wM={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ve.NO_ERROR=0,Ve.TIMEOUT=8,Ve.HTTP_ERROR=6,hT=Ve,ee.COMPLETE="complete",a9=ee,_a.EventType=en,en.OPEN="a",en.CLOSE="b",en.ERROR="c",en.MESSAGE="d",yn.prototype.listen=yn.prototype.K,cv=_a,o9=Lc,oi.prototype.listenOnce=oi.prototype.L,oi.prototype.getLastError=oi.prototype.Ka,oi.prototype.getLastErrorCode=oi.prototype.Ba,oi.prototype.getStatus=oi.prototype.Z,oi.prototype.getResponseJson=oi.prototype.Oa,oi.prototype.getResponseText=oi.prototype.oa,oi.prototype.send=oi.prototype.ea,oi.prototype.setWithCredentials=oi.prototype.Ha,s9=oi}).apply(typeof Cw<"u"?Cw:typeof self<"u"?self:typeof window<"u"?window:{});const lB="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}jo.UNAUTHENTICATED=new jo(null),jo.GOOGLE_CREDENTIALS=new jo("google-credentials-uid"),jo.FIRST_PARTY=new jo("first-party-uid"),jo.MOCK_USER=new jo("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iy="10.13.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rm=new q3("@firebase/firestore");function H0(){return rm.logLevel}function Un(t,...e){if(rm.logLevel<=Kr.DEBUG){const r=e.map(iD);rm.debug(`Firestore (${iy}): ${t}`,...r)}}function Mh(t,...e){if(rm.logLevel<=Kr.ERROR){const r=e.map(iD);rm.error(`Firestore (${iy}): ${t}`,...r)}}function L_(t,...e){if(rm.logLevel<=Kr.WARN){const r=e.map(iD);rm.warn(`Firestore (${iy}): ${t}`,...r)}}function iD(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(r){return JSON.stringify(r)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xr(t="Unexpected state"){const e=`FIRESTORE (${iy}) INTERNAL ASSERTION FAILED: `+t;throw Mh(e),new Error(e)}function Oi(t,e){t||xr()}function Cr(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Pn extends Pu{constructor(e,r){super(e,r),this.code=e,this.message=r,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wh{constructor(){this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h9{constructor(e,r){this.user=r,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Sne{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,r){e.enqueueRetryable(()=>r(jo.UNAUTHENTICATED))}shutdown(){}}class Ine{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,r){this.changeListener=r,e.enqueueRetryable(()=>r(this.token.user))}shutdown(){this.changeListener=null}}class Ane{constructor(e){this.t=e,this.currentUser=jo.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,r){let o=this.i;const u=a=>this.i!==o?(o=this.i,r(a)):Promise.resolve();let f=new wh;this.o=()=>{this.i++,this.currentUser=this.u(),f.resolve(),f=new wh,e.enqueueRetryable(()=>u(this.currentUser))};const y=()=>{const a=f;e.enqueueRetryable(async()=>{await a.promise,await u(this.currentUser)})},T=a=>{Un("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=a,this.auth.addAuthTokenListener(this.o),y()};this.t.onInit(a=>T(a)),setTimeout(()=>{if(!this.auth){const a=this.t.getImmediate({optional:!0});a?T(a):(Un("FirebaseAuthCredentialsProvider","Auth not yet detected"),f.resolve(),f=new wh)}},0),y()}getToken(){const e=this.i,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(o=>this.i!==e?(Un("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(Oi(typeof o.accessToken=="string"),new h9(o.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Oi(e===null||typeof e=="string"),new jo(e)}}class Cne{constructor(e,r,o){this.l=e,this.h=r,this.P=o,this.type="FirstParty",this.user=jo.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Pne{constructor(e,r,o){this.l=e,this.h=r,this.P=o}getToken(){return Promise.resolve(new Cne(this.l,this.h,this.P))}start(e,r){e.enqueueRetryable(()=>r(jo.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Rne{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Mne{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,r){const o=f=>{f.error!=null&&Un("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${f.error.message}`);const y=f.token!==this.R;return this.R=f.token,Un("FirebaseAppCheckTokenProvider",`Received ${y?"new":"existing"} token.`),y?r(f.token):Promise.resolve()};this.o=f=>{e.enqueueRetryable(()=>o(f))};const u=f=>{Un("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=f,this.appCheck.addTokenListener(this.o)};this.A.onInit(f=>u(f)),setTimeout(()=>{if(!this.appCheck){const f=this.A.getImmediate({optional:!0});f?u(f):Un("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(r=>r?(Oi(typeof r.token=="string"),this.R=r.token,new Rne(r.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kne(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(r);else for(let o=0;o<t;o++)r[o]=Math.floor(256*Math.random());return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d9{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=Math.floor(256/e.length)*e.length;let o="";for(;o.length<20;){const u=kne(40);for(let f=0;f<u.length;++f)o.length<20&&u[f]<r&&(o+=e.charAt(u[f]%e.length))}return o}}function ii(t,e){return t<e?-1:t>e?1:0}function z_(t,e,r){return t.length===e.length&&t.every((o,u)=>r(o,e[u]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{constructor(e,r){if(this.seconds=e,this.nanoseconds=r,r<0)throw new Pn(Wt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new Pn(Wt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(e<-62135596800)throw new Pn(Wt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Pn(Wt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return oo.fromMillis(Date.now())}static fromDate(e){return oo.fromMillis(e.getTime())}static fromMillis(e){const r=Math.floor(e/1e3),o=Math.floor(1e6*(e-1e3*r));return new oo(r,o)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ii(this.nanoseconds,e.nanoseconds):ii(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ar(e)}static min(){return new Ar(new oo(0,0))}static max(){return new Ar(new oo(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class px{constructor(e,r,o){r===void 0?r=0:r>e.length&&xr(),o===void 0?o=e.length-r:o>e.length-r&&xr(),this.segments=e,this.offset=r,this.len=o}get length(){return this.len}isEqual(e){return px.comparator(this,e)===0}child(e){const r=this.segments.slice(this.offset,this.limit());return e instanceof px?e.forEach(o=>{r.push(o)}):r.push(e),this.construct(r)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}forEach(e){for(let r=this.offset,o=this.limit();r<o;r++)e(this.segments[r])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,r){const o=Math.min(e.length,r.length);for(let u=0;u<o;u++){const f=e.get(u),y=r.get(u);if(f<y)return-1;if(f>y)return 1}return e.length<r.length?-1:e.length>r.length?1:0}}class Hi extends px{construct(e,r,o){return new Hi(e,r,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const r=[];for(const o of e){if(o.indexOf("//")>=0)throw new Pn(Wt.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);r.push(...o.split("/").filter(u=>u.length>0))}return new Hi(r)}static emptyPath(){return new Hi([])}}const Dne=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Eo extends px{construct(e,r,o){return new Eo(e,r,o)}static isValidIdentifier(e){return Dne.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Eo.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Eo(["__name__"])}static fromServerFormat(e){const r=[];let o="",u=0;const f=()=>{if(o.length===0)throw new Pn(Wt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);r.push(o),o=""};let y=!1;for(;u<e.length;){const T=e[u];if(T==="\\"){if(u+1===e.length)throw new Pn(Wt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const a=e[u+1];if(a!=="\\"&&a!=="."&&a!=="`")throw new Pn(Wt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=a,u+=2}else T==="`"?(y=!y,u++):T!=="."||y?(o+=T,u++):(f(),u++)}if(f(),y)throw new Pn(Wt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Eo(r)}static emptyPath(){return new Eo([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(e){this.path=e}static fromPath(e){return new er(Hi.fromString(e))}static fromName(e){return new er(Hi.fromString(e).popFirst(5))}static empty(){return new er(Hi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Hi.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,r){return Hi.comparator(e.path,r.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new er(new Hi(e.slice()))}}function One(t,e){const r=t.toTimestamp().seconds,o=t.toTimestamp().nanoseconds+1,u=Ar.fromTimestamp(o===1e9?new oo(r+1,0):new oo(r,o));return new gf(u,er.empty(),e)}function Lne(t){return new gf(t.readTime,t.key,-1)}class gf{constructor(e,r,o){this.readTime=e,this.documentKey=r,this.largestBatchId=o}static min(){return new gf(Ar.min(),er.empty(),-1)}static max(){return new gf(Ar.max(),er.empty(),-1)}}function zne(t,e){let r=t.readTime.compareTo(e.readTime);return r!==0?r:(r=er.comparator(t.documentKey,e.documentKey),r!==0?r:ii(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nne="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Fne{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xx(t){if(t.code!==Wt.FAILED_PRECONDITION||t.message!==Nne)throw t;Un("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jt{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(r=>{this.isDone=!0,this.result=r,this.nextCallback&&this.nextCallback(r)},r=>{this.isDone=!0,this.error=r,this.catchCallback&&this.catchCallback(r)})}catch(e){return this.next(void 0,e)}next(e,r){return this.callbackAttached&&xr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(r,this.error):this.wrapSuccess(e,this.result):new Jt((o,u)=>{this.nextCallback=f=>{this.wrapSuccess(e,f).next(o,u)},this.catchCallback=f=>{this.wrapFailure(r,f).next(o,u)}})}toPromise(){return new Promise((e,r)=>{this.next(e,r)})}wrapUserFunction(e){try{const r=e();return r instanceof Jt?r:Jt.resolve(r)}catch(r){return Jt.reject(r)}}wrapSuccess(e,r){return e?this.wrapUserFunction(()=>e(r)):Jt.resolve(r)}wrapFailure(e,r){return e?this.wrapUserFunction(()=>e(r)):Jt.reject(r)}static resolve(e){return new Jt((r,o)=>{r(e)})}static reject(e){return new Jt((r,o)=>{o(e)})}static waitFor(e){return new Jt((r,o)=>{let u=0,f=0,y=!1;e.forEach(T=>{++u,T.next(()=>{++f,y&&f===u&&r()},a=>o(a))}),y=!0,f===u&&r()})}static or(e){let r=Jt.resolve(!1);for(const o of e)r=r.next(u=>u?Jt.resolve(u):o());return r}static forEach(e,r){const o=[];return e.forEach((u,f)=>{o.push(r.call(this,u,f))}),this.waitFor(o)}static mapArray(e,r){return new Jt((o,u)=>{const f=e.length,y=new Array(f);let T=0;for(let a=0;a<f;a++){const A=a;r(e[A]).next(D=>{y[A]=D,++T,T===f&&o(y)},D=>u(D))}})}static doWhile(e,r){return new Jt((o,u)=>{const f=()=>{e()===!0?r().next(()=>{f()},u):o()};f()})}}function Bne(t){const e=t.match(/Android ([\d.]+)/i),r=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(r)}function Kx(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sD{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=o=>this.ie(o),this.se=o=>r.writeSequenceNumber(o))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}sD.oe=-1;function SS(t){return t==null}function uE(t){return t===0&&1/t==-1/0}function Une(t){return typeof t=="number"&&Number.isInteger(t)&&!uE(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cB(t){let e=0;for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}function _m(t,e){for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e(r,t[r])}function f9(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s{constructor(e,r){this.comparator=e,this.root=r||wo.EMPTY}insert(e,r){return new _s(this.comparator,this.root.insert(e,r,this.comparator).copy(null,null,wo.BLACK,null,null))}remove(e){return new _s(this.comparator,this.root.remove(e,this.comparator).copy(null,null,wo.BLACK,null,null))}get(e){let r=this.root;for(;!r.isEmpty();){const o=this.comparator(e,r.key);if(o===0)return r.value;o<0?r=r.left:o>0&&(r=r.right)}return null}indexOf(e){let r=0,o=this.root;for(;!o.isEmpty();){const u=this.comparator(e,o.key);if(u===0)return r+o.left.size;u<0?o=o.left:(r+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((r,o)=>(e(r,o),!1))}toString(){const e=[];return this.inorderTraversal((r,o)=>(e.push(`${r}:${o}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Pw(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Pw(this.root,e,this.comparator,!1)}getReverseIterator(){return new Pw(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Pw(this.root,e,this.comparator,!0)}}class Pw{constructor(e,r,o,u){this.isReverse=u,this.nodeStack=[];let f=1;for(;!e.isEmpty();)if(f=r?o(e.key,r):1,r&&u&&(f*=-1),f<0)e=this.isReverse?e.left:e.right;else{if(f===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const r={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return r}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class wo{constructor(e,r,o,u,f){this.key=e,this.value=r,this.color=o??wo.RED,this.left=u??wo.EMPTY,this.right=f??wo.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,r,o,u,f){return new wo(e??this.key,r??this.value,o??this.color,u??this.left,f??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,o){let u=this;const f=o(e,u.key);return u=f<0?u.copy(null,null,null,u.left.insert(e,r,o),null):f===0?u.copy(null,r,null,null,null):u.copy(null,null,null,null,u.right.insert(e,r,o)),u.fixUp()}removeMin(){if(this.left.isEmpty())return wo.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,r){let o,u=this;if(r(e,u.key)<0)u.left.isEmpty()||u.left.isRed()||u.left.left.isRed()||(u=u.moveRedLeft()),u=u.copy(null,null,null,u.left.remove(e,r),null);else{if(u.left.isRed()&&(u=u.rotateRight()),u.right.isEmpty()||u.right.isRed()||u.right.left.isRed()||(u=u.moveRedRight()),r(e,u.key)===0){if(u.right.isEmpty())return wo.EMPTY;o=u.right.min(),u=u.copy(o.key,o.value,null,null,u.right.removeMin())}u=u.copy(null,null,null,null,u.right.remove(e,r))}return u.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,wo.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,wo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw xr();const e=this.left.check();if(e!==this.right.check())throw xr();return e+(this.isRed()?0:1)}}wo.EMPTY=null,wo.RED=!0,wo.BLACK=!1;wo.EMPTY=new class{constructor(){this.size=0}get key(){throw xr()}get value(){throw xr()}get color(){throw xr()}get left(){throw xr()}get right(){throw xr()}copy(e,r,o,u,f){return this}insert(e,r,o){return new wo(e,r)}remove(e,r){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Io{constructor(e){this.comparator=e,this.data=new _s(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((r,o)=>(e(r),!1))}forEachInRange(e,r){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const u=o.getNext();if(this.comparator(u.key,e[1])>=0)return;r(u.key)}}forEachWhile(e,r){let o;for(o=r!==void 0?this.data.getIteratorFrom(r):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const r=this.data.getIteratorFrom(e);return r.hasNext()?r.getNext().key:null}getIterator(){return new uB(this.data.getIterator())}getIteratorFrom(e){return new uB(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let r=this;return r.size<e.size&&(r=e,e=this),e.forEach(o=>{r=r.add(o)}),r}isEqual(e){if(!(e instanceof Io)||this.size!==e.size)return!1;const r=this.data.getIterator(),o=e.data.getIterator();for(;r.hasNext();){const u=r.getNext().key,f=o.getNext().key;if(this.comparator(u,f)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(r=>{e.push(r)}),e}toString(){const e=[];return this.forEach(r=>e.push(r)),"SortedSet("+e.toString()+")"}copy(e){const r=new Io(this.comparator);return r.data=e,r}}class uB{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class el{constructor(e){this.fields=e,e.sort(Eo.comparator)}static empty(){return new el([])}unionWith(e){let r=new Io(Eo.comparator);for(const o of this.fields)r=r.add(o);for(const o of e)r=r.add(o);return new el(r.toArray())}covers(e){for(const r of this.fields)if(r.isPrefixOf(e))return!0;return!1}isEqual(e){return z_(this.fields,e.fields,(r,o)=>r.isEqual(o))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p9 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Co{constructor(e){this.binaryString=e}static fromBase64String(e){const r=function(u){try{return atob(u)}catch(f){throw typeof DOMException<"u"&&f instanceof DOMException?new p9("Invalid base64 string: "+f):f}}(e);return new Co(r)}static fromUint8Array(e){const r=function(u){let f="";for(let y=0;y<u.length;++y)f+=String.fromCharCode(u[y]);return f}(e);return new Co(r)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(r){return btoa(r)}(this.binaryString)}toUint8Array(){return function(r){const o=new Uint8Array(r.length);for(let u=0;u<r.length;u++)o[u]=r.charCodeAt(u);return o}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ii(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Co.EMPTY_BYTE_STRING=new Co("");const Vne=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _f(t){if(Oi(!!t),typeof t=="string"){let e=0;const r=Vne.exec(t);if(Oi(!!r),r[1]){let u=r[1];u=(u+"000000000").substr(0,9),e=Number(u)}const o=new Date(t);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:Os(t.seconds),nanos:Os(t.nanos)}}function Os(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function im(t){return typeof t=="string"?Co.fromBase64String(t):Co.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oD(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="server_timestamp"}function aD(t){const e=t.mapValue.fields.__previous_value__;return oD(e)?aD(e):e}function mx(t){const e=_f(t.mapValue.fields.__local_write_time__.timestampValue);return new oo(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jne{constructor(e,r,o,u,f,y,T,a,A){this.databaseId=e,this.appId=r,this.persistenceKey=o,this.host=u,this.ssl=f,this.forceLongPolling=y,this.autoDetectLongPolling=T,this.longPollingOptions=a,this.useFetchStreams=A}}class gx{constructor(e,r){this.projectId=e,this.database=r||"(default)"}static empty(){return new gx("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof gx&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rw={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function sm(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?oD(t)?4:Gne(t)?9007199254740991:$ne(t)?10:11:xr()}function Iu(t,e){if(t===e)return!0;const r=sm(t);if(r!==sm(e))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return mx(t).isEqual(mx(e));case 3:return function(u,f){if(typeof u.timestampValue=="string"&&typeof f.timestampValue=="string"&&u.timestampValue.length===f.timestampValue.length)return u.timestampValue===f.timestampValue;const y=_f(u.timestampValue),T=_f(f.timestampValue);return y.seconds===T.seconds&&y.nanos===T.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(u,f){return im(u.bytesValue).isEqual(im(f.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(u,f){return Os(u.geoPointValue.latitude)===Os(f.geoPointValue.latitude)&&Os(u.geoPointValue.longitude)===Os(f.geoPointValue.longitude)}(t,e);case 2:return function(u,f){if("integerValue"in u&&"integerValue"in f)return Os(u.integerValue)===Os(f.integerValue);if("doubleValue"in u&&"doubleValue"in f){const y=Os(u.doubleValue),T=Os(f.doubleValue);return y===T?uE(y)===uE(T):isNaN(y)&&isNaN(T)}return!1}(t,e);case 9:return z_(t.arrayValue.values||[],e.arrayValue.values||[],Iu);case 10:case 11:return function(u,f){const y=u.mapValue.fields||{},T=f.mapValue.fields||{};if(cB(y)!==cB(T))return!1;for(const a in y)if(y.hasOwnProperty(a)&&(T[a]===void 0||!Iu(y[a],T[a])))return!1;return!0}(t,e);default:return xr()}}function _x(t,e){return(t.values||[]).find(r=>Iu(r,e))!==void 0}function N_(t,e){if(t===e)return 0;const r=sm(t),o=sm(e);if(r!==o)return ii(r,o);switch(r){case 0:case 9007199254740991:return 0;case 1:return ii(t.booleanValue,e.booleanValue);case 2:return function(f,y){const T=Os(f.integerValue||f.doubleValue),a=Os(y.integerValue||y.doubleValue);return T<a?-1:T>a?1:T===a?0:isNaN(T)?isNaN(a)?0:-1:1}(t,e);case 3:return hB(t.timestampValue,e.timestampValue);case 4:return hB(mx(t),mx(e));case 5:return ii(t.stringValue,e.stringValue);case 6:return function(f,y){const T=im(f),a=im(y);return T.compareTo(a)}(t.bytesValue,e.bytesValue);case 7:return function(f,y){const T=f.split("/"),a=y.split("/");for(let A=0;A<T.length&&A<a.length;A++){const D=ii(T[A],a[A]);if(D!==0)return D}return ii(T.length,a.length)}(t.referenceValue,e.referenceValue);case 8:return function(f,y){const T=ii(Os(f.latitude),Os(y.latitude));return T!==0?T:ii(Os(f.longitude),Os(y.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return dB(t.arrayValue,e.arrayValue);case 10:return function(f,y){var T,a,A,D;const O=f.fields||{},B=y.fields||{},H=(T=O.value)===null||T===void 0?void 0:T.arrayValue,Q=(a=B.value)===null||a===void 0?void 0:a.arrayValue,re=ii(((A=H==null?void 0:H.values)===null||A===void 0?void 0:A.length)||0,((D=Q==null?void 0:Q.values)===null||D===void 0?void 0:D.length)||0);return re!==0?re:dB(H,Q)}(t.mapValue,e.mapValue);case 11:return function(f,y){if(f===Rw.mapValue&&y===Rw.mapValue)return 0;if(f===Rw.mapValue)return 1;if(y===Rw.mapValue)return-1;const T=f.fields||{},a=Object.keys(T),A=y.fields||{},D=Object.keys(A);a.sort(),D.sort();for(let O=0;O<a.length&&O<D.length;++O){const B=ii(a[O],D[O]);if(B!==0)return B;const H=N_(T[a[O]],A[D[O]]);if(H!==0)return H}return ii(a.length,D.length)}(t.mapValue,e.mapValue);default:throw xr()}}function hB(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return ii(t,e);const r=_f(t),o=_f(e),u=ii(r.seconds,o.seconds);return u!==0?u:ii(r.nanos,o.nanos)}function dB(t,e){const r=t.values||[],o=e.values||[];for(let u=0;u<r.length&&u<o.length;++u){const f=N_(r[u],o[u]);if(f)return f}return ii(r.length,o.length)}function F_(t){return TM(t)}function TM(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(r){const o=_f(r);return`time(${o.seconds},${o.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(r){return im(r).toBase64()}(t.bytesValue):"referenceValue"in t?function(r){return er.fromName(r).toString()}(t.referenceValue):"geoPointValue"in t?function(r){return`geo(${r.latitude},${r.longitude})`}(t.geoPointValue):"arrayValue"in t?function(r){let o="[",u=!0;for(const f of r.values||[])u?u=!1:o+=",",o+=TM(f);return o+"]"}(t.arrayValue):"mapValue"in t?function(r){const o=Object.keys(r.fields||{}).sort();let u="{",f=!0;for(const y of o)f?f=!1:u+=",",u+=`${y}:${TM(r.fields[y])}`;return u+"}"}(t.mapValue):xr()}function fB(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function EM(t){return!!t&&"integerValue"in t}function lD(t){return!!t&&"arrayValue"in t}function pB(t){return!!t&&"nullValue"in t}function mB(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function dT(t){return!!t&&"mapValue"in t}function $ne(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="__vector__"}function Mv(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return _m(t.mapValue.fields,(r,o)=>e.mapValue.fields[r]=Mv(o)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let r=0;r<(t.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=Mv(t.arrayValue.values[r]);return e}return Object.assign({},t)}function Gne(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma{constructor(e){this.value=e}static empty(){return new Ma({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let r=this.value;for(let o=0;o<e.length-1;++o)if(r=(r.mapValue.fields||{})[e.get(o)],!dT(r))return null;return r=(r.mapValue.fields||{})[e.lastSegment()],r||null}}set(e,r){this.getFieldsMap(e.popLast())[e.lastSegment()]=Mv(r)}setAll(e){let r=Eo.emptyPath(),o={},u=[];e.forEach((y,T)=>{if(!r.isImmediateParentOf(T)){const a=this.getFieldsMap(r);this.applyChanges(a,o,u),o={},u=[],r=T.popLast()}y?o[T.lastSegment()]=Mv(y):u.push(T.lastSegment())});const f=this.getFieldsMap(r);this.applyChanges(f,o,u)}delete(e){const r=this.field(e.popLast());dT(r)&&r.mapValue.fields&&delete r.mapValue.fields[e.lastSegment()]}isEqual(e){return Iu(this.value,e.value)}getFieldsMap(e){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let o=0;o<e.length;++o){let u=r.mapValue.fields[e.get(o)];dT(u)&&u.mapValue.fields||(u={mapValue:{fields:{}}},r.mapValue.fields[e.get(o)]=u),r=u}return r.mapValue.fields}applyChanges(e,r,o){_m(r,(u,f)=>e[u]=f);for(const u of o)delete e[u]}clone(){return new Ma(Mv(this.value))}}function m9(t){const e=[];return _m(t.fields,(r,o)=>{const u=new Eo([r]);if(dT(o)){const f=m9(o.mapValue).fields;if(f.length===0)e.push(u);else for(const y of f)e.push(u.child(y))}else e.push(u)}),new el(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Go{constructor(e,r,o,u,f,y,T){this.key=e,this.documentType=r,this.version=o,this.readTime=u,this.createTime=f,this.data=y,this.documentState=T}static newInvalidDocument(e){return new Go(e,0,Ar.min(),Ar.min(),Ar.min(),Ma.empty(),0)}static newFoundDocument(e,r,o,u){return new Go(e,1,r,Ar.min(),o,u,0)}static newNoDocument(e,r){return new Go(e,2,r,Ar.min(),Ar.min(),Ma.empty(),0)}static newUnknownDocument(e,r){return new Go(e,3,r,Ar.min(),Ar.min(),Ma.empty(),2)}convertToFoundDocument(e,r){return!this.createTime.isEqual(Ar.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=r,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ma.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ma.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ar.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Go&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Go(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hE{constructor(e,r){this.position=e,this.inclusive=r}}function gB(t,e,r){let o=0;for(let u=0;u<t.position.length;u++){const f=e[u],y=t.position[u];if(f.field.isKeyField()?o=er.comparator(er.fromName(y.referenceValue),r.key):o=N_(y,r.data.field(f.field)),f.dir==="desc"&&(o*=-1),o!==0)break}return o}function _B(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let r=0;r<t.position.length;r++)if(!Iu(t.position[r],e.position[r]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yx{constructor(e,r="asc"){this.field=e,this.dir=r}}function qne(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g9{}class Ws extends g9{constructor(e,r,o){super(),this.field=e,this.op=r,this.value=o}static create(e,r,o){return e.isKeyField()?r==="in"||r==="not-in"?this.createKeyFieldInFilter(e,r,o):new Hne(e,r,o):r==="array-contains"?new Kne(e,o):r==="in"?new Yne(e,o):r==="not-in"?new Qne(e,o):r==="array-contains-any"?new Jne(e,o):new Ws(e,r,o)}static createKeyFieldInFilter(e,r,o){return r==="in"?new Zne(e,o):new Xne(e,o)}matches(e){const r=e.data.field(this.field);return this.op==="!="?r!==null&&this.matchesComparison(N_(r,this.value)):r!==null&&sm(this.value)===sm(r)&&this.matchesComparison(N_(r,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return xr()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Cc extends g9{constructor(e,r){super(),this.filters=e,this.op=r,this.ae=null}static create(e,r){return new Cc(e,r)}matches(e){return _9(this)?this.filters.find(r=>!r.matches(e))===void 0:this.filters.find(r=>r.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,r)=>e.concat(r.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function _9(t){return t.op==="and"}function y9(t){return Wne(t)&&_9(t)}function Wne(t){for(const e of t.filters)if(e instanceof Cc)return!1;return!0}function SM(t){if(t instanceof Ws)return t.field.canonicalString()+t.op.toString()+F_(t.value);if(y9(t))return t.filters.map(e=>SM(e)).join(",");{const e=t.filters.map(r=>SM(r)).join(",");return`${t.op}(${e})`}}function v9(t,e){return t instanceof Ws?function(o,u){return u instanceof Ws&&o.op===u.op&&o.field.isEqual(u.field)&&Iu(o.value,u.value)}(t,e):t instanceof Cc?function(o,u){return u instanceof Cc&&o.op===u.op&&o.filters.length===u.filters.length?o.filters.reduce((f,y,T)=>f&&v9(y,u.filters[T]),!0):!1}(t,e):void xr()}function x9(t){return t instanceof Ws?function(r){return`${r.field.canonicalString()} ${r.op} ${F_(r.value)}`}(t):t instanceof Cc?function(r){return r.op.toString()+" {"+r.getFilters().map(x9).join(" ,")+"}"}(t):"Filter"}class Hne extends Ws{constructor(e,r,o){super(e,r,o),this.key=er.fromName(o.referenceValue)}matches(e){const r=er.comparator(e.key,this.key);return this.matchesComparison(r)}}class Zne extends Ws{constructor(e,r){super(e,"in",r),this.keys=b9("in",r)}matches(e){return this.keys.some(r=>r.isEqual(e.key))}}class Xne extends Ws{constructor(e,r){super(e,"not-in",r),this.keys=b9("not-in",r)}matches(e){return!this.keys.some(r=>r.isEqual(e.key))}}function b9(t,e){var r;return(((r=e.arrayValue)===null||r===void 0?void 0:r.values)||[]).map(o=>er.fromName(o.referenceValue))}class Kne extends Ws{constructor(e,r){super(e,"array-contains",r)}matches(e){const r=e.data.field(this.field);return lD(r)&&_x(r.arrayValue,this.value)}}class Yne extends Ws{constructor(e,r){super(e,"in",r)}matches(e){const r=e.data.field(this.field);return r!==null&&_x(this.value.arrayValue,r)}}class Qne extends Ws{constructor(e,r){super(e,"not-in",r)}matches(e){if(_x(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const r=e.data.field(this.field);return r!==null&&!_x(this.value.arrayValue,r)}}class Jne extends Ws{constructor(e,r){super(e,"array-contains-any",r)}matches(e){const r=e.data.field(this.field);return!(!lD(r)||!r.arrayValue.values)&&r.arrayValue.values.some(o=>_x(this.value.arrayValue,o))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ere{constructor(e,r=null,o=[],u=[],f=null,y=null,T=null){this.path=e,this.collectionGroup=r,this.orderBy=o,this.filters=u,this.limit=f,this.startAt=y,this.endAt=T,this.ue=null}}function yB(t,e=null,r=[],o=[],u=null,f=null,y=null){return new ere(t,e,r,o,u,f,y)}function cD(t){const e=Cr(t);if(e.ue===null){let r=e.path.canonicalString();e.collectionGroup!==null&&(r+="|cg:"+e.collectionGroup),r+="|f:",r+=e.filters.map(o=>SM(o)).join(","),r+="|ob:",r+=e.orderBy.map(o=>function(f){return f.field.canonicalString()+f.dir}(o)).join(","),SS(e.limit)||(r+="|l:",r+=e.limit),e.startAt&&(r+="|lb:",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(o=>F_(o)).join(",")),e.endAt&&(r+="|ub:",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(o=>F_(o)).join(",")),e.ue=r}return e.ue}function uD(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let r=0;r<t.orderBy.length;r++)if(!qne(t.orderBy[r],e.orderBy[r]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let r=0;r<t.filters.length;r++)if(!v9(t.filters[r],e.filters[r]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!_B(t.startAt,e.startAt)&&_B(t.endAt,e.endAt)}function IM(t){return er.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy{constructor(e,r=null,o=[],u=[],f=null,y="F",T=null,a=null){this.path=e,this.collectionGroup=r,this.explicitOrderBy=o,this.filters=u,this.limit=f,this.limitType=y,this.startAt=T,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function tre(t,e,r,o,u,f,y,T){return new sy(t,e,r,o,u,f,y,T)}function IS(t){return new sy(t)}function vB(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function w9(t){return t.collectionGroup!==null}function kv(t){const e=Cr(t);if(e.ce===null){e.ce=[];const r=new Set;for(const f of e.explicitOrderBy)e.ce.push(f),r.add(f.field.canonicalString());const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(y){let T=new Io(Eo.comparator);return y.filters.forEach(a=>{a.getFlattenedFilters().forEach(A=>{A.isInequality()&&(T=T.add(A.field))})}),T})(e).forEach(f=>{r.has(f.canonicalString())||f.isKeyField()||e.ce.push(new yx(f,o))}),r.has(Eo.keyField().canonicalString())||e.ce.push(new yx(Eo.keyField(),o))}return e.ce}function Tu(t){const e=Cr(t);return e.le||(e.le=nre(e,kv(t))),e.le}function nre(t,e){if(t.limitType==="F")return yB(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(u=>{const f=u.dir==="desc"?"asc":"desc";return new yx(u.field,f)});const r=t.endAt?new hE(t.endAt.position,t.endAt.inclusive):null,o=t.startAt?new hE(t.startAt.position,t.startAt.inclusive):null;return yB(t.path,t.collectionGroup,e,t.filters,t.limit,r,o)}}function AM(t,e){const r=t.filters.concat([e]);return new sy(t.path,t.collectionGroup,t.explicitOrderBy.slice(),r,t.limit,t.limitType,t.startAt,t.endAt)}function dE(t,e,r){return new sy(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,r,t.startAt,t.endAt)}function AS(t,e){return uD(Tu(t),Tu(e))&&t.limitType===e.limitType}function T9(t){return`${cD(Tu(t))}|lt:${t.limitType}`}function Vg(t){return`Query(target=${function(r){let o=r.path.canonicalString();return r.collectionGroup!==null&&(o+=" collectionGroup="+r.collectionGroup),r.filters.length>0&&(o+=`, filters: [${r.filters.map(u=>x9(u)).join(", ")}]`),SS(r.limit)||(o+=", limit: "+r.limit),r.orderBy.length>0&&(o+=`, orderBy: [${r.orderBy.map(u=>function(y){return`${y.field.canonicalString()} (${y.dir})`}(u)).join(", ")}]`),r.startAt&&(o+=", startAt: ",o+=r.startAt.inclusive?"b:":"a:",o+=r.startAt.position.map(u=>F_(u)).join(",")),r.endAt&&(o+=", endAt: ",o+=r.endAt.inclusive?"a:":"b:",o+=r.endAt.position.map(u=>F_(u)).join(",")),`Target(${o})`}(Tu(t))}; limitType=${t.limitType})`}function CS(t,e){return e.isFoundDocument()&&function(o,u){const f=u.key.path;return o.collectionGroup!==null?u.key.hasCollectionId(o.collectionGroup)&&o.path.isPrefixOf(f):er.isDocumentKey(o.path)?o.path.isEqual(f):o.path.isImmediateParentOf(f)}(t,e)&&function(o,u){for(const f of kv(o))if(!f.field.isKeyField()&&u.data.field(f.field)===null)return!1;return!0}(t,e)&&function(o,u){for(const f of o.filters)if(!f.matches(u))return!1;return!0}(t,e)&&function(o,u){return!(o.startAt&&!function(y,T,a){const A=gB(y,T,a);return y.inclusive?A<=0:A<0}(o.startAt,kv(o),u)||o.endAt&&!function(y,T,a){const A=gB(y,T,a);return y.inclusive?A>=0:A>0}(o.endAt,kv(o),u))}(t,e)}function rre(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function E9(t){return(e,r)=>{let o=!1;for(const u of kv(t)){const f=ire(u,e,r);if(f!==0)return f;o=o||u.field.isKeyField()}return 0}}function ire(t,e,r){const o=t.field.isKeyField()?er.comparator(e.key,r.key):function(f,y,T){const a=y.data.field(f),A=T.data.field(f);return a!==null&&A!==null?N_(a,A):xr()}(t.field,e,r);switch(t.dir){case"asc":return o;case"desc":return-1*o;default:return xr()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oy{constructor(e,r){this.mapKeyFn=e,this.equalsFn=r,this.inner={},this.innerSize=0}get(e){const r=this.mapKeyFn(e),o=this.inner[r];if(o!==void 0){for(const[u,f]of o)if(this.equalsFn(u,e))return f}}has(e){return this.get(e)!==void 0}set(e,r){const o=this.mapKeyFn(e),u=this.inner[o];if(u===void 0)return this.inner[o]=[[e,r]],void this.innerSize++;for(let f=0;f<u.length;f++)if(this.equalsFn(u[f][0],e))return void(u[f]=[e,r]);u.push([e,r]),this.innerSize++}delete(e){const r=this.mapKeyFn(e),o=this.inner[r];if(o===void 0)return!1;for(let u=0;u<o.length;u++)if(this.equalsFn(o[u][0],e))return o.length===1?delete this.inner[r]:o.splice(u,1),this.innerSize--,!0;return!1}forEach(e){_m(this.inner,(r,o)=>{for(const[u,f]of o)e(u,f)})}isEmpty(){return f9(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sre=new _s(er.comparator);function kh(){return sre}const S9=new _s(er.comparator);function uv(...t){let e=S9;for(const r of t)e=e.insert(r.key,r);return e}function I9(t){let e=S9;return t.forEach((r,o)=>e=e.insert(r,o.overlayedDocument)),e}function Np(){return Dv()}function A9(){return Dv()}function Dv(){return new oy(t=>t.toString(),(t,e)=>t.isEqual(e))}const ore=new _s(er.comparator),are=new Io(er.comparator);function Wr(...t){let e=are;for(const r of t)e=e.add(r);return e}const lre=new Io(ii);function cre(){return lre}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hD(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:uE(e)?"-0":e}}function C9(t){return{integerValue:""+t}}function ure(t,e){return Une(e)?C9(e):hD(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PS{constructor(){this._=void 0}}function hre(t,e,r){return t instanceof vx?function(u,f){const y={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:u.seconds,nanos:u.nanoseconds}}}};return f&&oD(f)&&(f=aD(f)),f&&(y.fields.__previous_value__=f),{mapValue:y}}(r,e):t instanceof B_?R9(t,e):t instanceof U_?M9(t,e):function(u,f){const y=P9(u,f),T=xB(y)+xB(u.Pe);return EM(y)&&EM(u.Pe)?C9(T):hD(u.serializer,T)}(t,e)}function dre(t,e,r){return t instanceof B_?R9(t,e):t instanceof U_?M9(t,e):r}function P9(t,e){return t instanceof fE?function(o){return EM(o)||function(f){return!!f&&"doubleValue"in f}(o)}(e)?e:{integerValue:0}:null}class vx extends PS{}class B_ extends PS{constructor(e){super(),this.elements=e}}function R9(t,e){const r=k9(e);for(const o of t.elements)r.some(u=>Iu(u,o))||r.push(o);return{arrayValue:{values:r}}}class U_ extends PS{constructor(e){super(),this.elements=e}}function M9(t,e){let r=k9(e);for(const o of t.elements)r=r.filter(u=>!Iu(u,o));return{arrayValue:{values:r}}}class fE extends PS{constructor(e,r){super(),this.serializer=e,this.Pe=r}}function xB(t){return Os(t.integerValue||t.doubleValue)}function k9(t){return lD(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dD{constructor(e,r){this.field=e,this.transform=r}}function fre(t,e){return t.field.isEqual(e.field)&&function(o,u){return o instanceof B_&&u instanceof B_||o instanceof U_&&u instanceof U_?z_(o.elements,u.elements,Iu):o instanceof fE&&u instanceof fE?Iu(o.Pe,u.Pe):o instanceof vx&&u instanceof vx}(t.transform,e.transform)}class pre{constructor(e,r){this.version=e,this.transformResults=r}}class Fl{constructor(e,r){this.updateTime=e,this.exists=r}static none(){return new Fl}static exists(e){return new Fl(void 0,e)}static updateTime(e){return new Fl(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function fT(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class RS{}function D9(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new fD(t.key,Fl.none()):new Yx(t.key,t.data,Fl.none());{const r=t.data,o=Ma.empty();let u=new Io(Eo.comparator);for(let f of e.fields)if(!u.has(f)){let y=r.field(f);y===null&&f.length>1&&(f=f.popLast(),y=r.field(f)),y===null?o.delete(f):o.set(f,y),u=u.add(f)}return new If(t.key,o,new el(u.toArray()),Fl.none())}}function mre(t,e,r){t instanceof Yx?function(u,f,y){const T=u.value.clone(),a=wB(u.fieldTransforms,f,y.transformResults);T.setAll(a),f.convertToFoundDocument(y.version,T).setHasCommittedMutations()}(t,e,r):t instanceof If?function(u,f,y){if(!fT(u.precondition,f))return void f.convertToUnknownDocument(y.version);const T=wB(u.fieldTransforms,f,y.transformResults),a=f.data;a.setAll(O9(u)),a.setAll(T),f.convertToFoundDocument(y.version,a).setHasCommittedMutations()}(t,e,r):function(u,f,y){f.convertToNoDocument(y.version).setHasCommittedMutations()}(0,e,r)}function Ov(t,e,r,o){return t instanceof Yx?function(f,y,T,a){if(!fT(f.precondition,y))return T;const A=f.value.clone(),D=TB(f.fieldTransforms,a,y);return A.setAll(D),y.convertToFoundDocument(y.version,A).setHasLocalMutations(),null}(t,e,r,o):t instanceof If?function(f,y,T,a){if(!fT(f.precondition,y))return T;const A=TB(f.fieldTransforms,a,y),D=y.data;return D.setAll(O9(f)),D.setAll(A),y.convertToFoundDocument(y.version,D).setHasLocalMutations(),T===null?null:T.unionWith(f.fieldMask.fields).unionWith(f.fieldTransforms.map(O=>O.field))}(t,e,r,o):function(f,y,T){return fT(f.precondition,y)?(y.convertToNoDocument(y.version).setHasLocalMutations(),null):T}(t,e,r)}function gre(t,e){let r=null;for(const o of t.fieldTransforms){const u=e.data.field(o.field),f=P9(o.transform,u||null);f!=null&&(r===null&&(r=Ma.empty()),r.set(o.field,f))}return r||null}function bB(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(o,u){return o===void 0&&u===void 0||!(!o||!u)&&z_(o,u,(f,y)=>fre(f,y))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Yx extends RS{constructor(e,r,o,u=[]){super(),this.key=e,this.value=r,this.precondition=o,this.fieldTransforms=u,this.type=0}getFieldMask(){return null}}class If extends RS{constructor(e,r,o,u,f=[]){super(),this.key=e,this.data=r,this.fieldMask=o,this.precondition=u,this.fieldTransforms=f,this.type=1}getFieldMask(){return this.fieldMask}}function O9(t){const e=new Map;return t.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const o=t.data.field(r);e.set(r,o)}}),e}function wB(t,e,r){const o=new Map;Oi(t.length===r.length);for(let u=0;u<r.length;u++){const f=t[u],y=f.transform,T=e.data.field(f.field);o.set(f.field,dre(y,T,r[u]))}return o}function TB(t,e,r){const o=new Map;for(const u of t){const f=u.transform,y=r.data.field(u.field);o.set(u.field,hre(f,y,e))}return o}class fD extends RS{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class _re extends RS{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yre{constructor(e,r,o,u){this.batchId=e,this.localWriteTime=r,this.baseMutations=o,this.mutations=u}applyToRemoteDocument(e,r){const o=r.mutationResults;for(let u=0;u<this.mutations.length;u++){const f=this.mutations[u];f.key.isEqual(e.key)&&mre(f,e,o[u])}}applyToLocalView(e,r){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(r=Ov(o,e,r,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(r=Ov(o,e,r,this.localWriteTime));return r}applyToLocalDocumentSet(e,r){const o=A9();return this.mutations.forEach(u=>{const f=e.get(u.key),y=f.overlayedDocument;let T=this.applyToLocalView(y,f.mutatedFields);T=r.has(u.key)?null:T;const a=D9(y,T);a!==null&&o.set(u.key,a),y.isValidDocument()||y.convertToNoDocument(Ar.min())}),o}keys(){return this.mutations.reduce((e,r)=>e.add(r.key),Wr())}isEqual(e){return this.batchId===e.batchId&&z_(this.mutations,e.mutations,(r,o)=>bB(r,o))&&z_(this.baseMutations,e.baseMutations,(r,o)=>bB(r,o))}}class pD{constructor(e,r,o,u){this.batch=e,this.commitVersion=r,this.mutationResults=o,this.docVersions=u}static from(e,r,o){Oi(e.mutations.length===o.length);let u=function(){return ore}();const f=e.mutations;for(let y=0;y<f.length;y++)u=u.insert(f[y].key,o[y].version);return new pD(e,r,o,u)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vre{constructor(e,r){this.largestBatchId=e,this.mutation=r}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xre{constructor(e,r){this.count=e,this.unchangedNames=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var js,Jr;function bre(t){switch(t){default:return xr();case Wt.CANCELLED:case Wt.UNKNOWN:case Wt.DEADLINE_EXCEEDED:case Wt.RESOURCE_EXHAUSTED:case Wt.INTERNAL:case Wt.UNAVAILABLE:case Wt.UNAUTHENTICATED:return!1;case Wt.INVALID_ARGUMENT:case Wt.NOT_FOUND:case Wt.ALREADY_EXISTS:case Wt.PERMISSION_DENIED:case Wt.FAILED_PRECONDITION:case Wt.ABORTED:case Wt.OUT_OF_RANGE:case Wt.UNIMPLEMENTED:case Wt.DATA_LOSS:return!0}}function L9(t){if(t===void 0)return Mh("GRPC error has no .code"),Wt.UNKNOWN;switch(t){case js.OK:return Wt.OK;case js.CANCELLED:return Wt.CANCELLED;case js.UNKNOWN:return Wt.UNKNOWN;case js.DEADLINE_EXCEEDED:return Wt.DEADLINE_EXCEEDED;case js.RESOURCE_EXHAUSTED:return Wt.RESOURCE_EXHAUSTED;case js.INTERNAL:return Wt.INTERNAL;case js.UNAVAILABLE:return Wt.UNAVAILABLE;case js.UNAUTHENTICATED:return Wt.UNAUTHENTICATED;case js.INVALID_ARGUMENT:return Wt.INVALID_ARGUMENT;case js.NOT_FOUND:return Wt.NOT_FOUND;case js.ALREADY_EXISTS:return Wt.ALREADY_EXISTS;case js.PERMISSION_DENIED:return Wt.PERMISSION_DENIED;case js.FAILED_PRECONDITION:return Wt.FAILED_PRECONDITION;case js.ABORTED:return Wt.ABORTED;case js.OUT_OF_RANGE:return Wt.OUT_OF_RANGE;case js.UNIMPLEMENTED:return Wt.UNIMPLEMENTED;case js.DATA_LOSS:return Wt.DATA_LOSS;default:return xr()}}(Jr=js||(js={}))[Jr.OK=0]="OK",Jr[Jr.CANCELLED=1]="CANCELLED",Jr[Jr.UNKNOWN=2]="UNKNOWN",Jr[Jr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Jr[Jr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Jr[Jr.NOT_FOUND=5]="NOT_FOUND",Jr[Jr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Jr[Jr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Jr[Jr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Jr[Jr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Jr[Jr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Jr[Jr.ABORTED=10]="ABORTED",Jr[Jr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Jr[Jr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Jr[Jr.INTERNAL=13]="INTERNAL",Jr[Jr.UNAVAILABLE=14]="UNAVAILABLE",Jr[Jr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wre(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tre=new $p([4294967295,4294967295],0);function EB(t){const e=wre().encode(t),r=new i9;return r.update(e),new Uint8Array(r.digest())}function SB(t){const e=new DataView(t.buffer),r=e.getUint32(0,!0),o=e.getUint32(4,!0),u=e.getUint32(8,!0),f=e.getUint32(12,!0);return[new $p([r,o],0),new $p([u,f],0)]}class mD{constructor(e,r,o){if(this.bitmap=e,this.padding=r,this.hashCount=o,r<0||r>=8)throw new hv(`Invalid padding: ${r}`);if(o<0)throw new hv(`Invalid hash count: ${o}`);if(e.length>0&&this.hashCount===0)throw new hv(`Invalid hash count: ${o}`);if(e.length===0&&r!==0)throw new hv(`Invalid padding when bitmap length is 0: ${r}`);this.Ie=8*e.length-r,this.Te=$p.fromNumber(this.Ie)}Ee(e,r,o){let u=e.add(r.multiply($p.fromNumber(o)));return u.compare(Tre)===1&&(u=new $p([u.getBits(0),u.getBits(1)],0)),u.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const r=EB(e),[o,u]=SB(r);for(let f=0;f<this.hashCount;f++){const y=this.Ee(o,u,f);if(!this.de(y))return!1}return!0}static create(e,r,o){const u=e%8==0?0:8-e%8,f=new Uint8Array(Math.ceil(e/8)),y=new mD(f,u,r);return o.forEach(T=>y.insert(T)),y}insert(e){if(this.Ie===0)return;const r=EB(e),[o,u]=SB(r);for(let f=0;f<this.hashCount;f++){const y=this.Ee(o,u,f);this.Ae(y)}}Ae(e){const r=Math.floor(e/8),o=e%8;this.bitmap[r]|=1<<o}}class hv extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MS{constructor(e,r,o,u,f){this.snapshotVersion=e,this.targetChanges=r,this.targetMismatches=o,this.documentUpdates=u,this.resolvedLimboDocuments=f}static createSynthesizedRemoteEventForCurrentChange(e,r,o){const u=new Map;return u.set(e,Qx.createSynthesizedTargetChangeForCurrentChange(e,r,o)),new MS(Ar.min(),u,new _s(ii),kh(),Wr())}}class Qx{constructor(e,r,o,u,f){this.resumeToken=e,this.current=r,this.addedDocuments=o,this.modifiedDocuments=u,this.removedDocuments=f}static createSynthesizedTargetChangeForCurrentChange(e,r,o){return new Qx(o,r,Wr(),Wr(),Wr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pT{constructor(e,r,o,u){this.Re=e,this.removedTargetIds=r,this.key=o,this.Ve=u}}class z9{constructor(e,r){this.targetId=e,this.me=r}}class N9{constructor(e,r,o=Co.EMPTY_BYTE_STRING,u=null){this.state=e,this.targetIds=r,this.resumeToken=o,this.cause=u}}class IB{constructor(){this.fe=0,this.ge=CB(),this.pe=Co.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Wr(),r=Wr(),o=Wr();return this.ge.forEach((u,f)=>{switch(f){case 0:e=e.add(u);break;case 2:r=r.add(u);break;case 1:o=o.add(u);break;default:xr()}}),new Qx(this.pe,this.ye,e,r,o)}Ce(){this.we=!1,this.ge=CB()}Fe(e,r){this.we=!0,this.ge=this.ge.insert(e,r)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Oi(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Ere{constructor(e){this.Le=e,this.Be=new Map,this.ke=kh(),this.qe=AB(),this.Qe=new _s(ii)}Ke(e){for(const r of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(r,e.Ve):this.Ue(r,e.key,e.Ve);for(const r of e.removedTargetIds)this.Ue(r,e.key,e.Ve)}We(e){this.forEachTarget(e,r=>{const o=this.Ge(r);switch(e.state){case 0:this.ze(r)&&o.De(e.resumeToken);break;case 1:o.Oe(),o.Se||o.Ce(),o.De(e.resumeToken);break;case 2:o.Oe(),o.Se||this.removeTarget(r);break;case 3:this.ze(r)&&(o.Ne(),o.De(e.resumeToken));break;case 4:this.ze(r)&&(this.je(r),o.De(e.resumeToken));break;default:xr()}})}forEachTarget(e,r){e.targetIds.length>0?e.targetIds.forEach(r):this.Be.forEach((o,u)=>{this.ze(u)&&r(u)})}He(e){const r=e.targetId,o=e.me.count,u=this.Je(r);if(u){const f=u.target;if(IM(f))if(o===0){const y=new er(f.path);this.Ue(r,y,Go.newNoDocument(y,Ar.min()))}else Oi(o===1);else{const y=this.Ye(r);if(y!==o){const T=this.Ze(e),a=T?this.Xe(T,e,y):1;if(a!==0){this.je(r);const A=a===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(r,A)}}}}}Ze(e){const r=e.me.unchangedNames;if(!r||!r.bits)return null;const{bits:{bitmap:o="",padding:u=0},hashCount:f=0}=r;let y,T;try{y=im(o).toUint8Array()}catch(a){if(a instanceof p9)return L_("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{T=new mD(y,u,f)}catch(a){return L_(a instanceof hv?"BloomFilter error: ":"Applying bloom filter failed: ",a),null}return T.Ie===0?null:T}Xe(e,r,o){return r.me.count===o-this.nt(e,r.targetId)?0:2}nt(e,r){const o=this.Le.getRemoteKeysForTarget(r);let u=0;return o.forEach(f=>{const y=this.Le.tt(),T=`projects/${y.projectId}/databases/${y.database}/documents/${f.path.canonicalString()}`;e.mightContain(T)||(this.Ue(r,f,null),u++)}),u}rt(e){const r=new Map;this.Be.forEach((f,y)=>{const T=this.Je(y);if(T){if(f.current&&IM(T.target)){const a=new er(T.target.path);this.ke.get(a)!==null||this.it(y,a)||this.Ue(y,a,Go.newNoDocument(a,e))}f.be&&(r.set(y,f.ve()),f.Ce())}});let o=Wr();this.qe.forEach((f,y)=>{let T=!0;y.forEachWhile(a=>{const A=this.Je(a);return!A||A.purpose==="TargetPurposeLimboResolution"||(T=!1,!1)}),T&&(o=o.add(f))}),this.ke.forEach((f,y)=>y.setReadTime(e));const u=new MS(e,r,this.Qe,this.ke,o);return this.ke=kh(),this.qe=AB(),this.Qe=new _s(ii),u}$e(e,r){if(!this.ze(e))return;const o=this.it(e,r.key)?2:0;this.Ge(e).Fe(r.key,o),this.ke=this.ke.insert(r.key,r),this.qe=this.qe.insert(r.key,this.st(r.key).add(e))}Ue(e,r,o){if(!this.ze(e))return;const u=this.Ge(e);this.it(e,r)?u.Fe(r,1):u.Me(r),this.qe=this.qe.insert(r,this.st(r).delete(e)),o&&(this.ke=this.ke.insert(r,o))}removeTarget(e){this.Be.delete(e)}Ye(e){const r=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let r=this.Be.get(e);return r||(r=new IB,this.Be.set(e,r)),r}st(e){let r=this.qe.get(e);return r||(r=new Io(ii),this.qe=this.qe.insert(e,r)),r}ze(e){const r=this.Je(e)!==null;return r||Un("WatchChangeAggregator","Detected inactive target",e),r}Je(e){const r=this.Be.get(e);return r&&r.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new IB),this.Le.getRemoteKeysForTarget(e).forEach(r=>{this.Ue(e,r,null)})}it(e,r){return this.Le.getRemoteKeysForTarget(e).has(r)}}function AB(){return new _s(er.comparator)}function CB(){return new _s(er.comparator)}const Sre={asc:"ASCENDING",desc:"DESCENDING"},Ire={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Are={and:"AND",or:"OR"};class Cre{constructor(e,r){this.databaseId=e,this.useProto3Json=r}}function CM(t,e){return t.useProto3Json||SS(e)?e:{value:e}}function pE(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function F9(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Pre(t,e){return pE(t,e.toTimestamp())}function Eu(t){return Oi(!!t),Ar.fromTimestamp(function(r){const o=_f(r);return new oo(o.seconds,o.nanos)}(t))}function gD(t,e){return PM(t,e).canonicalString()}function PM(t,e){const r=function(u){return new Hi(["projects",u.projectId,"databases",u.database])}(t).child("documents");return e===void 0?r:r.child(e)}function B9(t){const e=Hi.fromString(t);return Oi(G9(e)),e}function RM(t,e){return gD(t.databaseId,e.path)}function kP(t,e){const r=B9(e);if(r.get(1)!==t.databaseId.projectId)throw new Pn(Wt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+t.databaseId.projectId);if(r.get(3)!==t.databaseId.database)throw new Pn(Wt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+t.databaseId.database);return new er(V9(r))}function U9(t,e){return gD(t.databaseId,e)}function Rre(t){const e=B9(t);return e.length===4?Hi.emptyPath():V9(e)}function MM(t){return new Hi(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function V9(t){return Oi(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function PB(t,e,r){return{name:RM(t,e),fields:r.value.mapValue.fields}}function Mre(t,e){let r;if("targetChange"in e){e.targetChange;const o=function(A){return A==="NO_CHANGE"?0:A==="ADD"?1:A==="REMOVE"?2:A==="CURRENT"?3:A==="RESET"?4:xr()}(e.targetChange.targetChangeType||"NO_CHANGE"),u=e.targetChange.targetIds||[],f=function(A,D){return A.useProto3Json?(Oi(D===void 0||typeof D=="string"),Co.fromBase64String(D||"")):(Oi(D===void 0||D instanceof Buffer||D instanceof Uint8Array),Co.fromUint8Array(D||new Uint8Array))}(t,e.targetChange.resumeToken),y=e.targetChange.cause,T=y&&function(A){const D=A.code===void 0?Wt.UNKNOWN:L9(A.code);return new Pn(D,A.message||"")}(y);r=new N9(o,u,f,T||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const u=kP(t,o.document.name),f=Eu(o.document.updateTime),y=o.document.createTime?Eu(o.document.createTime):Ar.min(),T=new Ma({mapValue:{fields:o.document.fields}}),a=Go.newFoundDocument(u,f,y,T),A=o.targetIds||[],D=o.removedTargetIds||[];r=new pT(A,D,a.key,a)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const u=kP(t,o.document),f=o.readTime?Eu(o.readTime):Ar.min(),y=Go.newNoDocument(u,f),T=o.removedTargetIds||[];r=new pT([],T,y.key,y)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const u=kP(t,o.document),f=o.removedTargetIds||[];r=new pT([],f,u,null)}else{if(!("filter"in e))return xr();{e.filter;const o=e.filter;o.targetId;const{count:u=0,unchangedNames:f}=o,y=new xre(u,f),T=o.targetId;r=new z9(T,y)}}return r}function kre(t,e){let r;if(e instanceof Yx)r={update:PB(t,e.key,e.value)};else if(e instanceof fD)r={delete:RM(t,e.key)};else if(e instanceof If)r={update:PB(t,e.key,e.data),updateMask:Vre(e.fieldMask)};else{if(!(e instanceof _re))return xr();r={verify:RM(t,e.key)}}return e.fieldTransforms.length>0&&(r.updateTransforms=e.fieldTransforms.map(o=>function(f,y){const T=y.transform;if(T instanceof vx)return{fieldPath:y.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(T instanceof B_)return{fieldPath:y.field.canonicalString(),appendMissingElements:{values:T.elements}};if(T instanceof U_)return{fieldPath:y.field.canonicalString(),removeAllFromArray:{values:T.elements}};if(T instanceof fE)return{fieldPath:y.field.canonicalString(),increment:T.Pe};throw xr()}(0,o))),e.precondition.isNone||(r.currentDocument=function(u,f){return f.updateTime!==void 0?{updateTime:Pre(u,f.updateTime)}:f.exists!==void 0?{exists:f.exists}:xr()}(t,e.precondition)),r}function Dre(t,e){return t&&t.length>0?(Oi(e!==void 0),t.map(r=>function(u,f){let y=u.updateTime?Eu(u.updateTime):Eu(f);return y.isEqual(Ar.min())&&(y=Eu(f)),new pre(y,u.transformResults||[])}(r,e))):[]}function Ore(t,e){return{documents:[U9(t,e.path)]}}function Lre(t,e){const r={structuredQuery:{}},o=e.path;let u;e.collectionGroup!==null?(u=o,r.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(u=o.popLast(),r.structuredQuery.from=[{collectionId:o.lastSegment()}]),r.parent=U9(t,u);const f=function(A){if(A.length!==0)return $9(Cc.create(A,"and"))}(e.filters);f&&(r.structuredQuery.where=f);const y=function(A){if(A.length!==0)return A.map(D=>function(B){return{field:jg(B.field),direction:Fre(B.dir)}}(D))}(e.orderBy);y&&(r.structuredQuery.orderBy=y);const T=CM(t,e.limit);return T!==null&&(r.structuredQuery.limit=T),e.startAt&&(r.structuredQuery.startAt=function(A){return{before:A.inclusive,values:A.position}}(e.startAt)),e.endAt&&(r.structuredQuery.endAt=function(A){return{before:!A.inclusive,values:A.position}}(e.endAt)),{_t:r,parent:u}}function zre(t){let e=Rre(t.parent);const r=t.structuredQuery,o=r.from?r.from.length:0;let u=null;if(o>0){Oi(o===1);const D=r.from[0];D.allDescendants?u=D.collectionId:e=e.child(D.collectionId)}let f=[];r.where&&(f=function(O){const B=j9(O);return B instanceof Cc&&y9(B)?B.getFilters():[B]}(r.where));let y=[];r.orderBy&&(y=function(O){return O.map(B=>function(Q){return new yx($g(Q.field),function(se){switch(se){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Q.direction))}(B))}(r.orderBy));let T=null;r.limit&&(T=function(O){let B;return B=typeof O=="object"?O.value:O,SS(B)?null:B}(r.limit));let a=null;r.startAt&&(a=function(O){const B=!!O.before,H=O.values||[];return new hE(H,B)}(r.startAt));let A=null;return r.endAt&&(A=function(O){const B=!O.before,H=O.values||[];return new hE(H,B)}(r.endAt)),tre(e,u,y,f,T,"F",a,A)}function Nre(t,e){const r=function(u){switch(u){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return xr()}}(e.purpose);return r==null?null:{"goog-listen-tags":r}}function j9(t){return t.unaryFilter!==void 0?function(r){switch(r.unaryFilter.op){case"IS_NAN":const o=$g(r.unaryFilter.field);return Ws.create(o,"==",{doubleValue:NaN});case"IS_NULL":const u=$g(r.unaryFilter.field);return Ws.create(u,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const f=$g(r.unaryFilter.field);return Ws.create(f,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const y=$g(r.unaryFilter.field);return Ws.create(y,"!=",{nullValue:"NULL_VALUE"});default:return xr()}}(t):t.fieldFilter!==void 0?function(r){return Ws.create($g(r.fieldFilter.field),function(u){switch(u){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return xr()}}(r.fieldFilter.op),r.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(r){return Cc.create(r.compositeFilter.filters.map(o=>j9(o)),function(u){switch(u){case"AND":return"and";case"OR":return"or";default:return xr()}}(r.compositeFilter.op))}(t):xr()}function Fre(t){return Sre[t]}function Bre(t){return Ire[t]}function Ure(t){return Are[t]}function jg(t){return{fieldPath:t.canonicalString()}}function $g(t){return Eo.fromServerFormat(t.fieldPath)}function $9(t){return t instanceof Ws?function(r){if(r.op==="=="){if(mB(r.value))return{unaryFilter:{field:jg(r.field),op:"IS_NAN"}};if(pB(r.value))return{unaryFilter:{field:jg(r.field),op:"IS_NULL"}}}else if(r.op==="!="){if(mB(r.value))return{unaryFilter:{field:jg(r.field),op:"IS_NOT_NAN"}};if(pB(r.value))return{unaryFilter:{field:jg(r.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:jg(r.field),op:Bre(r.op),value:r.value}}}(t):t instanceof Cc?function(r){const o=r.getFilters().map(u=>$9(u));return o.length===1?o[0]:{compositeFilter:{op:Ure(r.op),filters:o}}}(t):xr()}function Vre(t){const e=[];return t.fields.forEach(r=>e.push(r.canonicalString())),{fieldPaths:e}}function G9(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xd{constructor(e,r,o,u,f=Ar.min(),y=Ar.min(),T=Co.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=r,this.purpose=o,this.sequenceNumber=u,this.snapshotVersion=f,this.lastLimboFreeSnapshotVersion=y,this.resumeToken=T,this.expectedCount=a}withSequenceNumber(e){return new Xd(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,r){return new Xd(this.target,this.targetId,this.purpose,this.sequenceNumber,r,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Xd(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Xd(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jre{constructor(e){this.ct=e}}function $re(t){const e=zre({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?dE(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gre{constructor(){this.un=new qre}addToCollectionParentIndex(e,r){return this.un.add(r),Jt.resolve()}getCollectionParents(e,r){return Jt.resolve(this.un.getEntries(r))}addFieldIndex(e,r){return Jt.resolve()}deleteFieldIndex(e,r){return Jt.resolve()}deleteAllFieldIndexes(e){return Jt.resolve()}createTargetIndexes(e,r){return Jt.resolve()}getDocumentsMatchingTarget(e,r){return Jt.resolve(null)}getIndexType(e,r){return Jt.resolve(0)}getFieldIndexes(e,r){return Jt.resolve([])}getNextCollectionGroupToUpdate(e){return Jt.resolve(null)}getMinOffset(e,r){return Jt.resolve(gf.min())}getMinOffsetFromCollectionGroup(e,r){return Jt.resolve(gf.min())}updateCollectionGroup(e,r,o){return Jt.resolve()}updateIndexEntries(e,r){return Jt.resolve()}}class qre{constructor(){this.index={}}add(e){const r=e.lastSegment(),o=e.popLast(),u=this.index[r]||new Io(Hi.comparator),f=!u.has(o);return this.index[r]=u.add(o),f}has(e){const r=e.lastSegment(),o=e.popLast(),u=this.index[r];return u&&u.has(o)}getEntries(e){return(this.index[e]||new Io(Hi.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V_{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new V_(0)}static kn(){return new V_(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wre{constructor(){this.changes=new oy(e=>e.toString(),(e,r)=>e.isEqual(r)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,r){this.assertNotApplied(),this.changes.set(e,Go.newInvalidDocument(e).setReadTime(r))}getEntry(e,r){this.assertNotApplied();const o=this.changes.get(r);return o!==void 0?Jt.resolve(o):this.getFromCache(e,r)}getEntries(e,r){return this.getAllFromCache(e,r)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hre{constructor(e,r){this.overlayedDocument=e,this.mutatedFields=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zre{constructor(e,r,o,u){this.remoteDocumentCache=e,this.mutationQueue=r,this.documentOverlayCache=o,this.indexManager=u}getDocument(e,r){let o=null;return this.documentOverlayCache.getOverlay(e,r).next(u=>(o=u,this.remoteDocumentCache.getEntry(e,r))).next(u=>(o!==null&&Ov(o.mutation,u,el.empty(),oo.now()),u))}getDocuments(e,r){return this.remoteDocumentCache.getEntries(e,r).next(o=>this.getLocalViewOfDocuments(e,o,Wr()).next(()=>o))}getLocalViewOfDocuments(e,r,o=Wr()){const u=Np();return this.populateOverlays(e,u,r).next(()=>this.computeViews(e,r,u,o).next(f=>{let y=uv();return f.forEach((T,a)=>{y=y.insert(T,a.overlayedDocument)}),y}))}getOverlayedDocuments(e,r){const o=Np();return this.populateOverlays(e,o,r).next(()=>this.computeViews(e,r,o,Wr()))}populateOverlays(e,r,o){const u=[];return o.forEach(f=>{r.has(f)||u.push(f)}),this.documentOverlayCache.getOverlays(e,u).next(f=>{f.forEach((y,T)=>{r.set(y,T)})})}computeViews(e,r,o,u){let f=kh();const y=Dv(),T=function(){return Dv()}();return r.forEach((a,A)=>{const D=o.get(A.key);u.has(A.key)&&(D===void 0||D.mutation instanceof If)?f=f.insert(A.key,A):D!==void 0?(y.set(A.key,D.mutation.getFieldMask()),Ov(D.mutation,A,D.mutation.getFieldMask(),oo.now())):y.set(A.key,el.empty())}),this.recalculateAndSaveOverlays(e,f).next(a=>(a.forEach((A,D)=>y.set(A,D)),r.forEach((A,D)=>{var O;return T.set(A,new Hre(D,(O=y.get(A))!==null&&O!==void 0?O:null))}),T))}recalculateAndSaveOverlays(e,r){const o=Dv();let u=new _s((y,T)=>y-T),f=Wr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,r).next(y=>{for(const T of y)T.keys().forEach(a=>{const A=r.get(a);if(A===null)return;let D=o.get(a)||el.empty();D=T.applyToLocalView(A,D),o.set(a,D);const O=(u.get(T.batchId)||Wr()).add(a);u=u.insert(T.batchId,O)})}).next(()=>{const y=[],T=u.getReverseIterator();for(;T.hasNext();){const a=T.getNext(),A=a.key,D=a.value,O=A9();D.forEach(B=>{if(!f.has(B)){const H=D9(r.get(B),o.get(B));H!==null&&O.set(B,H),f=f.add(B)}}),y.push(this.documentOverlayCache.saveOverlays(e,A,O))}return Jt.waitFor(y)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(e,r){return this.remoteDocumentCache.getEntries(e,r).next(o=>this.recalculateAndSaveOverlays(e,o))}getDocumentsMatchingQuery(e,r,o,u){return function(y){return er.isDocumentKey(y.path)&&y.collectionGroup===null&&y.filters.length===0}(r)?this.getDocumentsMatchingDocumentQuery(e,r.path):w9(r)?this.getDocumentsMatchingCollectionGroupQuery(e,r,o,u):this.getDocumentsMatchingCollectionQuery(e,r,o,u)}getNextDocuments(e,r,o,u){return this.remoteDocumentCache.getAllFromCollectionGroup(e,r,o,u).next(f=>{const y=u-f.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,r,o.largestBatchId,u-f.size):Jt.resolve(Np());let T=-1,a=f;return y.next(A=>Jt.forEach(A,(D,O)=>(T<O.largestBatchId&&(T=O.largestBatchId),f.get(D)?Jt.resolve():this.remoteDocumentCache.getEntry(e,D).next(B=>{a=a.insert(D,B)}))).next(()=>this.populateOverlays(e,A,f)).next(()=>this.computeViews(e,a,A,Wr())).next(D=>({batchId:T,changes:I9(D)})))})}getDocumentsMatchingDocumentQuery(e,r){return this.getDocument(e,new er(r)).next(o=>{let u=uv();return o.isFoundDocument()&&(u=u.insert(o.key,o)),u})}getDocumentsMatchingCollectionGroupQuery(e,r,o,u){const f=r.collectionGroup;let y=uv();return this.indexManager.getCollectionParents(e,f).next(T=>Jt.forEach(T,a=>{const A=function(O,B){return new sy(B,null,O.explicitOrderBy.slice(),O.filters.slice(),O.limit,O.limitType,O.startAt,O.endAt)}(r,a.child(f));return this.getDocumentsMatchingCollectionQuery(e,A,o,u).next(D=>{D.forEach((O,B)=>{y=y.insert(O,B)})})}).next(()=>y))}getDocumentsMatchingCollectionQuery(e,r,o,u){let f;return this.documentOverlayCache.getOverlaysForCollection(e,r.path,o.largestBatchId).next(y=>(f=y,this.remoteDocumentCache.getDocumentsMatchingQuery(e,r,o,f,u))).next(y=>{f.forEach((a,A)=>{const D=A.getKey();y.get(D)===null&&(y=y.insert(D,Go.newInvalidDocument(D)))});let T=uv();return y.forEach((a,A)=>{const D=f.get(a);D!==void 0&&Ov(D.mutation,A,el.empty(),oo.now()),CS(r,A)&&(T=T.insert(a,A))}),T})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xre{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,r){return Jt.resolve(this.hr.get(r))}saveBundleMetadata(e,r){return this.hr.set(r.id,function(u){return{id:u.id,version:u.version,createTime:Eu(u.createTime)}}(r)),Jt.resolve()}getNamedQuery(e,r){return Jt.resolve(this.Pr.get(r))}saveNamedQuery(e,r){return this.Pr.set(r.name,function(u){return{name:u.name,query:$re(u.bundledQuery),readTime:Eu(u.readTime)}}(r)),Jt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kre{constructor(){this.overlays=new _s(er.comparator),this.Ir=new Map}getOverlay(e,r){return Jt.resolve(this.overlays.get(r))}getOverlays(e,r){const o=Np();return Jt.forEach(r,u=>this.getOverlay(e,u).next(f=>{f!==null&&o.set(u,f)})).next(()=>o)}saveOverlays(e,r,o){return o.forEach((u,f)=>{this.ht(e,r,f)}),Jt.resolve()}removeOverlaysForBatchId(e,r,o){const u=this.Ir.get(o);return u!==void 0&&(u.forEach(f=>this.overlays=this.overlays.remove(f)),this.Ir.delete(o)),Jt.resolve()}getOverlaysForCollection(e,r,o){const u=Np(),f=r.length+1,y=new er(r.child("")),T=this.overlays.getIteratorFrom(y);for(;T.hasNext();){const a=T.getNext().value,A=a.getKey();if(!r.isPrefixOf(A.path))break;A.path.length===f&&a.largestBatchId>o&&u.set(a.getKey(),a)}return Jt.resolve(u)}getOverlaysForCollectionGroup(e,r,o,u){let f=new _s((A,D)=>A-D);const y=this.overlays.getIterator();for(;y.hasNext();){const A=y.getNext().value;if(A.getKey().getCollectionGroup()===r&&A.largestBatchId>o){let D=f.get(A.largestBatchId);D===null&&(D=Np(),f=f.insert(A.largestBatchId,D)),D.set(A.getKey(),A)}}const T=Np(),a=f.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((A,D)=>T.set(A,D)),!(T.size()>=u)););return Jt.resolve(T)}ht(e,r,o){const u=this.overlays.get(o.key);if(u!==null){const y=this.Ir.get(u.largestBatchId).delete(o.key);this.Ir.set(u.largestBatchId,y)}this.overlays=this.overlays.insert(o.key,new vre(r,o));let f=this.Ir.get(r);f===void 0&&(f=Wr(),this.Ir.set(r,f)),this.Ir.set(r,f.add(o.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yre{constructor(){this.sessionToken=Co.EMPTY_BYTE_STRING}getSessionToken(e){return Jt.resolve(this.sessionToken)}setSessionToken(e,r){return this.sessionToken=r,Jt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _D{constructor(){this.Tr=new Io(po.Er),this.dr=new Io(po.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,r){const o=new po(e,r);this.Tr=this.Tr.add(o),this.dr=this.dr.add(o)}Rr(e,r){e.forEach(o=>this.addReference(o,r))}removeReference(e,r){this.Vr(new po(e,r))}mr(e,r){e.forEach(o=>this.removeReference(o,r))}gr(e){const r=new er(new Hi([])),o=new po(r,e),u=new po(r,e+1),f=[];return this.dr.forEachInRange([o,u],y=>{this.Vr(y),f.push(y.key)}),f}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const r=new er(new Hi([])),o=new po(r,e),u=new po(r,e+1);let f=Wr();return this.dr.forEachInRange([o,u],y=>{f=f.add(y.key)}),f}containsKey(e){const r=new po(e,0),o=this.Tr.firstAfterOrEqual(r);return o!==null&&e.isEqual(o.key)}}class po{constructor(e,r){this.key=e,this.wr=r}static Er(e,r){return er.comparator(e.key,r.key)||ii(e.wr,r.wr)}static Ar(e,r){return ii(e.wr,r.wr)||er.comparator(e.key,r.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qre{constructor(e,r){this.indexManager=e,this.referenceDelegate=r,this.mutationQueue=[],this.Sr=1,this.br=new Io(po.Er)}checkEmpty(e){return Jt.resolve(this.mutationQueue.length===0)}addMutationBatch(e,r,o,u){const f=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const y=new yre(f,r,o,u);this.mutationQueue.push(y);for(const T of u)this.br=this.br.add(new po(T.key,f)),this.indexManager.addToCollectionParentIndex(e,T.key.path.popLast());return Jt.resolve(y)}lookupMutationBatch(e,r){return Jt.resolve(this.Dr(r))}getNextMutationBatchAfterBatchId(e,r){const o=r+1,u=this.vr(o),f=u<0?0:u;return Jt.resolve(this.mutationQueue.length>f?this.mutationQueue[f]:null)}getHighestUnacknowledgedBatchId(){return Jt.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return Jt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,r){const o=new po(r,0),u=new po(r,Number.POSITIVE_INFINITY),f=[];return this.br.forEachInRange([o,u],y=>{const T=this.Dr(y.wr);f.push(T)}),Jt.resolve(f)}getAllMutationBatchesAffectingDocumentKeys(e,r){let o=new Io(ii);return r.forEach(u=>{const f=new po(u,0),y=new po(u,Number.POSITIVE_INFINITY);this.br.forEachInRange([f,y],T=>{o=o.add(T.wr)})}),Jt.resolve(this.Cr(o))}getAllMutationBatchesAffectingQuery(e,r){const o=r.path,u=o.length+1;let f=o;er.isDocumentKey(f)||(f=f.child(""));const y=new po(new er(f),0);let T=new Io(ii);return this.br.forEachWhile(a=>{const A=a.key.path;return!!o.isPrefixOf(A)&&(A.length===u&&(T=T.add(a.wr)),!0)},y),Jt.resolve(this.Cr(T))}Cr(e){const r=[];return e.forEach(o=>{const u=this.Dr(o);u!==null&&r.push(u)}),r}removeMutationBatch(e,r){Oi(this.Fr(r.batchId,"removed")===0),this.mutationQueue.shift();let o=this.br;return Jt.forEach(r.mutations,u=>{const f=new po(u.key,r.batchId);return o=o.delete(f),this.referenceDelegate.markPotentiallyOrphaned(e,u.key)}).next(()=>{this.br=o})}On(e){}containsKey(e,r){const o=new po(r,0),u=this.br.firstAfterOrEqual(o);return Jt.resolve(r.isEqual(u&&u.key))}performConsistencyCheck(e){return this.mutationQueue.length,Jt.resolve()}Fr(e,r){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const r=this.vr(e);return r<0||r>=this.mutationQueue.length?null:this.mutationQueue[r]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jre{constructor(e){this.Mr=e,this.docs=function(){return new _s(er.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,r){const o=r.key,u=this.docs.get(o),f=u?u.size:0,y=this.Mr(r);return this.docs=this.docs.insert(o,{document:r.mutableCopy(),size:y}),this.size+=y-f,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const r=this.docs.get(e);r&&(this.docs=this.docs.remove(e),this.size-=r.size)}getEntry(e,r){const o=this.docs.get(r);return Jt.resolve(o?o.document.mutableCopy():Go.newInvalidDocument(r))}getEntries(e,r){let o=kh();return r.forEach(u=>{const f=this.docs.get(u);o=o.insert(u,f?f.document.mutableCopy():Go.newInvalidDocument(u))}),Jt.resolve(o)}getDocumentsMatchingQuery(e,r,o,u){let f=kh();const y=r.path,T=new er(y.child("")),a=this.docs.getIteratorFrom(T);for(;a.hasNext();){const{key:A,value:{document:D}}=a.getNext();if(!y.isPrefixOf(A.path))break;A.path.length>y.length+1||zne(Lne(D),o)<=0||(u.has(D.key)||CS(r,D))&&(f=f.insert(D.key,D.mutableCopy()))}return Jt.resolve(f)}getAllFromCollectionGroup(e,r,o,u){xr()}Or(e,r){return Jt.forEach(this.docs,o=>r(o))}newChangeBuffer(e){return new eie(this)}getSize(e){return Jt.resolve(this.size)}}class eie extends Wre{constructor(e){super(),this.cr=e}applyChanges(e){const r=[];return this.changes.forEach((o,u)=>{u.isValidDocument()?r.push(this.cr.addEntry(e,u)):this.cr.removeEntry(o)}),Jt.waitFor(r)}getFromCache(e,r){return this.cr.getEntry(e,r)}getAllFromCache(e,r){return this.cr.getEntries(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tie{constructor(e){this.persistence=e,this.Nr=new oy(r=>cD(r),uD),this.lastRemoteSnapshotVersion=Ar.min(),this.highestTargetId=0,this.Lr=0,this.Br=new _D,this.targetCount=0,this.kr=V_.Bn()}forEachTarget(e,r){return this.Nr.forEach((o,u)=>r(u)),Jt.resolve()}getLastRemoteSnapshotVersion(e){return Jt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Jt.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),Jt.resolve(this.highestTargetId)}setTargetsMetadata(e,r,o){return o&&(this.lastRemoteSnapshotVersion=o),r>this.Lr&&(this.Lr=r),Jt.resolve()}Kn(e){this.Nr.set(e.target,e);const r=e.targetId;r>this.highestTargetId&&(this.kr=new V_(r),this.highestTargetId=r),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,r){return this.Kn(r),this.targetCount+=1,Jt.resolve()}updateTargetData(e,r){return this.Kn(r),Jt.resolve()}removeTargetData(e,r){return this.Nr.delete(r.target),this.Br.gr(r.targetId),this.targetCount-=1,Jt.resolve()}removeTargets(e,r,o){let u=0;const f=[];return this.Nr.forEach((y,T)=>{T.sequenceNumber<=r&&o.get(T.targetId)===null&&(this.Nr.delete(y),f.push(this.removeMatchingKeysForTargetId(e,T.targetId)),u++)}),Jt.waitFor(f).next(()=>u)}getTargetCount(e){return Jt.resolve(this.targetCount)}getTargetData(e,r){const o=this.Nr.get(r)||null;return Jt.resolve(o)}addMatchingKeys(e,r,o){return this.Br.Rr(r,o),Jt.resolve()}removeMatchingKeys(e,r,o){this.Br.mr(r,o);const u=this.persistence.referenceDelegate,f=[];return u&&r.forEach(y=>{f.push(u.markPotentiallyOrphaned(e,y))}),Jt.waitFor(f)}removeMatchingKeysForTargetId(e,r){return this.Br.gr(r),Jt.resolve()}getMatchingKeysForTargetId(e,r){const o=this.Br.yr(r);return Jt.resolve(o)}containsKey(e,r){return Jt.resolve(this.Br.containsKey(r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nie{constructor(e,r){this.qr={},this.overlays={},this.Qr=new sD(0),this.Kr=!1,this.Kr=!0,this.$r=new Yre,this.referenceDelegate=e(this),this.Ur=new tie(this),this.indexManager=new Gre,this.remoteDocumentCache=function(u){return new Jre(u)}(o=>this.referenceDelegate.Wr(o)),this.serializer=new jre(r),this.Gr=new Xre(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let r=this.overlays[e.toKey()];return r||(r=new Kre,this.overlays[e.toKey()]=r),r}getMutationQueue(e,r){let o=this.qr[e.toKey()];return o||(o=new Qre(r,this.referenceDelegate),this.qr[e.toKey()]=o),o}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,r,o){Un("MemoryPersistence","Starting transaction:",e);const u=new rie(this.Qr.next());return this.referenceDelegate.zr(),o(u).next(f=>this.referenceDelegate.jr(u).next(()=>f)).toPromise().then(f=>(u.raiseOnCommittedEvent(),f))}Hr(e,r){return Jt.or(Object.values(this.qr).map(o=>()=>o.containsKey(e,r)))}}class rie extends Fne{constructor(e){super(),this.currentSequenceNumber=e}}class yD{constructor(e){this.persistence=e,this.Jr=new _D,this.Yr=null}static Zr(e){return new yD(e)}get Xr(){if(this.Yr)return this.Yr;throw xr()}addReference(e,r,o){return this.Jr.addReference(o,r),this.Xr.delete(o.toString()),Jt.resolve()}removeReference(e,r,o){return this.Jr.removeReference(o,r),this.Xr.add(o.toString()),Jt.resolve()}markPotentiallyOrphaned(e,r){return this.Xr.add(r.toString()),Jt.resolve()}removeTarget(e,r){this.Jr.gr(r.targetId).forEach(u=>this.Xr.add(u.toString()));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,r.targetId).next(u=>{u.forEach(f=>this.Xr.add(f.toString()))}).next(()=>o.removeTargetData(e,r))}zr(){this.Yr=new Set}jr(e){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Jt.forEach(this.Xr,o=>{const u=er.fromPath(o);return this.ei(e,u).next(f=>{f||r.removeEntry(u,Ar.min())})}).next(()=>(this.Yr=null,r.apply(e)))}updateLimboDocument(e,r){return this.ei(e,r).next(o=>{o?this.Xr.delete(r.toString()):this.Xr.add(r.toString())})}Wr(e){return 0}ei(e,r){return Jt.or([()=>Jt.resolve(this.Jr.containsKey(r)),()=>this.persistence.getTargetCache().containsKey(e,r),()=>this.persistence.Hr(e,r)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vD{constructor(e,r,o,u){this.targetId=e,this.fromCache=r,this.$i=o,this.Ui=u}static Wi(e,r){let o=Wr(),u=Wr();for(const f of r.docChanges)switch(f.type){case 0:o=o.add(f.doc.key);break;case 1:u=u.add(f.doc.key)}return new vD(e,r.fromCache,o,u)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iie{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sie{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return u2()?8:Bne(Xo())>0?6:4}()}initialize(e,r){this.Ji=e,this.indexManager=r,this.Gi=!0}getDocumentsMatchingQuery(e,r,o,u){const f={result:null};return this.Yi(e,r).next(y=>{f.result=y}).next(()=>{if(!f.result)return this.Zi(e,r,u,o).next(y=>{f.result=y})}).next(()=>{if(f.result)return;const y=new iie;return this.Xi(e,r,y).next(T=>{if(f.result=T,this.zi)return this.es(e,r,y,T.size)})}).next(()=>f.result)}es(e,r,o,u){return o.documentReadCount<this.ji?(H0()<=Kr.DEBUG&&Un("QueryEngine","SDK will not create cache indexes for query:",Vg(r),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Jt.resolve()):(H0()<=Kr.DEBUG&&Un("QueryEngine","Query:",Vg(r),"scans",o.documentReadCount,"local documents and returns",u,"documents as results."),o.documentReadCount>this.Hi*u?(H0()<=Kr.DEBUG&&Un("QueryEngine","The SDK decides to create cache indexes for query:",Vg(r),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Tu(r))):Jt.resolve())}Yi(e,r){if(vB(r))return Jt.resolve(null);let o=Tu(r);return this.indexManager.getIndexType(e,o).next(u=>u===0?null:(r.limit!==null&&u===1&&(r=dE(r,null,"F"),o=Tu(r)),this.indexManager.getDocumentsMatchingTarget(e,o).next(f=>{const y=Wr(...f);return this.Ji.getDocuments(e,y).next(T=>this.indexManager.getMinOffset(e,o).next(a=>{const A=this.ts(r,T);return this.ns(r,A,y,a.readTime)?this.Yi(e,dE(r,null,"F")):this.rs(e,A,r,a)}))})))}Zi(e,r,o,u){return vB(r)||u.isEqual(Ar.min())?Jt.resolve(null):this.Ji.getDocuments(e,o).next(f=>{const y=this.ts(r,f);return this.ns(r,y,o,u)?Jt.resolve(null):(H0()<=Kr.DEBUG&&Un("QueryEngine","Re-using previous result from %s to execute query: %s",u.toString(),Vg(r)),this.rs(e,y,r,One(u,-1)).next(T=>T))})}ts(e,r){let o=new Io(E9(e));return r.forEach((u,f)=>{CS(e,f)&&(o=o.add(f))}),o}ns(e,r,o,u){if(e.limit===null)return!1;if(o.size!==r.size)return!0;const f=e.limitType==="F"?r.last():r.first();return!!f&&(f.hasPendingWrites||f.version.compareTo(u)>0)}Xi(e,r,o){return H0()<=Kr.DEBUG&&Un("QueryEngine","Using full collection scan to execute query:",Vg(r)),this.Ji.getDocumentsMatchingQuery(e,r,gf.min(),o)}rs(e,r,o,u){return this.Ji.getDocumentsMatchingQuery(e,o,u).next(f=>(r.forEach(y=>{f=f.insert(y.key,y)}),f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oie{constructor(e,r,o,u){this.persistence=e,this.ss=r,this.serializer=u,this.os=new _s(ii),this._s=new oy(f=>cD(f),uD),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(o)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Zre(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",r=>e.collect(r,this.os))}}function aie(t,e,r,o){return new oie(t,e,r,o)}async function q9(t,e){const r=Cr(t);return await r.persistence.runTransaction("Handle user change","readonly",o=>{let u;return r.mutationQueue.getAllMutationBatches(o).next(f=>(u=f,r.ls(e),r.mutationQueue.getAllMutationBatches(o))).next(f=>{const y=[],T=[];let a=Wr();for(const A of u){y.push(A.batchId);for(const D of A.mutations)a=a.add(D.key)}for(const A of f){T.push(A.batchId);for(const D of A.mutations)a=a.add(D.key)}return r.localDocuments.getDocuments(o,a).next(A=>({hs:A,removedBatchIds:y,addedBatchIds:T}))})})}function lie(t,e){const r=Cr(t);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",o=>{const u=e.batch.keys(),f=r.cs.newChangeBuffer({trackRemovals:!0});return function(T,a,A,D){const O=A.batch,B=O.keys();let H=Jt.resolve();return B.forEach(Q=>{H=H.next(()=>D.getEntry(a,Q)).next(re=>{const se=A.docVersions.get(Q);Oi(se!==null),re.version.compareTo(se)<0&&(O.applyToRemoteDocument(re,A),re.isValidDocument()&&(re.setReadTime(A.commitVersion),D.addEntry(re)))})}),H.next(()=>T.mutationQueue.removeMutationBatch(a,O))}(r,o,e,f).next(()=>f.apply(o)).next(()=>r.mutationQueue.performConsistencyCheck(o)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(o,u,e.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,function(T){let a=Wr();for(let A=0;A<T.mutationResults.length;++A)T.mutationResults[A].transformResults.length>0&&(a=a.add(T.batch.mutations[A].key));return a}(e))).next(()=>r.localDocuments.getDocuments(o,u))})}function W9(t){const e=Cr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",r=>e.Ur.getLastRemoteSnapshotVersion(r))}function cie(t,e){const r=Cr(t),o=e.snapshotVersion;let u=r.os;return r.persistence.runTransaction("Apply remote event","readwrite-primary",f=>{const y=r.cs.newChangeBuffer({trackRemovals:!0});u=r.os;const T=[];e.targetChanges.forEach((D,O)=>{const B=u.get(O);if(!B)return;T.push(r.Ur.removeMatchingKeys(f,D.removedDocuments,O).next(()=>r.Ur.addMatchingKeys(f,D.addedDocuments,O)));let H=B.withSequenceNumber(f.currentSequenceNumber);e.targetMismatches.get(O)!==null?H=H.withResumeToken(Co.EMPTY_BYTE_STRING,Ar.min()).withLastLimboFreeSnapshotVersion(Ar.min()):D.resumeToken.approximateByteSize()>0&&(H=H.withResumeToken(D.resumeToken,o)),u=u.insert(O,H),function(re,se,G){return re.resumeToken.approximateByteSize()===0||se.snapshotVersion.toMicroseconds()-re.snapshotVersion.toMicroseconds()>=3e8?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0}(B,H,D)&&T.push(r.Ur.updateTargetData(f,H))});let a=kh(),A=Wr();if(e.documentUpdates.forEach(D=>{e.resolvedLimboDocuments.has(D)&&T.push(r.persistence.referenceDelegate.updateLimboDocument(f,D))}),T.push(uie(f,y,e.documentUpdates).next(D=>{a=D.Ps,A=D.Is})),!o.isEqual(Ar.min())){const D=r.Ur.getLastRemoteSnapshotVersion(f).next(O=>r.Ur.setTargetsMetadata(f,f.currentSequenceNumber,o));T.push(D)}return Jt.waitFor(T).next(()=>y.apply(f)).next(()=>r.localDocuments.getLocalViewOfDocuments(f,a,A)).next(()=>a)}).then(f=>(r.os=u,f))}function uie(t,e,r){let o=Wr(),u=Wr();return r.forEach(f=>o=o.add(f)),e.getEntries(t,o).next(f=>{let y=kh();return r.forEach((T,a)=>{const A=f.get(T);a.isFoundDocument()!==A.isFoundDocument()&&(u=u.add(T)),a.isNoDocument()&&a.version.isEqual(Ar.min())?(e.removeEntry(T,a.readTime),y=y.insert(T,a)):!A.isValidDocument()||a.version.compareTo(A.version)>0||a.version.compareTo(A.version)===0&&A.hasPendingWrites?(e.addEntry(a),y=y.insert(T,a)):Un("LocalStore","Ignoring outdated watch update for ",T,". Current version:",A.version," Watch version:",a.version)}),{Ps:y,Is:u}})}function hie(t,e){const r=Cr(t);return r.persistence.runTransaction("Get next mutation batch","readonly",o=>(e===void 0&&(e=-1),r.mutationQueue.getNextMutationBatchAfterBatchId(o,e)))}function die(t,e){const r=Cr(t);return r.persistence.runTransaction("Allocate target","readwrite",o=>{let u;return r.Ur.getTargetData(o,e).next(f=>f?(u=f,Jt.resolve(u)):r.Ur.allocateTargetId(o).next(y=>(u=new Xd(e,y,"TargetPurposeListen",o.currentSequenceNumber),r.Ur.addTargetData(o,u).next(()=>u))))}).then(o=>{const u=r.os.get(o.targetId);return(u===null||o.snapshotVersion.compareTo(u.snapshotVersion)>0)&&(r.os=r.os.insert(o.targetId,o),r._s.set(e,o.targetId)),o})}async function kM(t,e,r){const o=Cr(t),u=o.os.get(e),f=r?"readwrite":"readwrite-primary";try{r||await o.persistence.runTransaction("Release target",f,y=>o.persistence.referenceDelegate.removeTarget(y,u))}catch(y){if(!Kx(y))throw y;Un("LocalStore",`Failed to update sequence numbers for target ${e}: ${y}`)}o.os=o.os.remove(e),o._s.delete(u.target)}function RB(t,e,r){const o=Cr(t);let u=Ar.min(),f=Wr();return o.persistence.runTransaction("Execute query","readwrite",y=>function(a,A,D){const O=Cr(a),B=O._s.get(D);return B!==void 0?Jt.resolve(O.os.get(B)):O.Ur.getTargetData(A,D)}(o,y,Tu(e)).next(T=>{if(T)return u=T.lastLimboFreeSnapshotVersion,o.Ur.getMatchingKeysForTargetId(y,T.targetId).next(a=>{f=a})}).next(()=>o.ss.getDocumentsMatchingQuery(y,e,r?u:Ar.min(),r?f:Wr())).next(T=>(fie(o,rre(e),T),{documents:T,Ts:f})))}function fie(t,e,r){let o=t.us.get(e)||Ar.min();r.forEach((u,f)=>{f.readTime.compareTo(o)>0&&(o=f.readTime)}),t.us.set(e,o)}class MB{constructor(){this.activeTargetIds=cre()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class pie{constructor(){this.so=new MB,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,r,o){}addLocalQueryTarget(e){return this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,r,o){this.oo[e]=r}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new MB,Promise.resolve()}handleUserChange(e,r,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mie{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kB{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Un("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){Un("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Mw=null;function DP(){return Mw===null?Mw=function(){return 268435456+Math.round(2147483648*Math.random())}():Mw++,"0x"+Mw.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gie={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _ie{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uo="WebChannelConnection";class yie extends class{constructor(r){this.databaseInfo=r,this.databaseId=r.databaseId;const o=r.ssl?"https":"http",u=encodeURIComponent(this.databaseId.projectId),f=encodeURIComponent(this.databaseId.database);this.Do=o+"://"+r.host,this.vo=`projects/${u}/databases/${f}`,this.Co=this.databaseId.database==="(default)"?`project_id=${u}`:`project_id=${u}&database_id=${f}`}get Fo(){return!1}Mo(r,o,u,f,y){const T=DP(),a=this.xo(r,o.toUriEncodedString());Un("RestConnection",`Sending RPC '${r}' ${T}:`,a,u);const A={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(A,f,y),this.No(r,a,A,u).then(D=>(Un("RestConnection",`Received RPC '${r}' ${T}: `,D),D),D=>{throw L_("RestConnection",`RPC '${r}' ${T} failed with error: `,D,"url: ",a,"request:",u),D})}Lo(r,o,u,f,y,T){return this.Mo(r,o,u,f,y)}Oo(r,o,u){r["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+iy}(),r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),o&&o.headers.forEach((f,y)=>r[y]=f),u&&u.headers.forEach((f,y)=>r[y]=f)}xo(r,o){const u=gie[r];return`${this.Do}/v1/${o}:${u}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,r,o,u){const f=DP();return new Promise((y,T)=>{const a=new s9;a.setWithCredentials(!0),a.listenOnce(a9.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case hT.NO_ERROR:const D=a.getResponseJson();Un(Uo,`XHR for RPC '${e}' ${f} received:`,JSON.stringify(D)),y(D);break;case hT.TIMEOUT:Un(Uo,`RPC '${e}' ${f} timed out`),T(new Pn(Wt.DEADLINE_EXCEEDED,"Request time out"));break;case hT.HTTP_ERROR:const O=a.getStatus();if(Un(Uo,`RPC '${e}' ${f} failed with status:`,O,"response text:",a.getResponseText()),O>0){let B=a.getResponseJson();Array.isArray(B)&&(B=B[0]);const H=B==null?void 0:B.error;if(H&&H.status&&H.message){const Q=function(se){const G=se.toLowerCase().replace(/_/g,"-");return Object.values(Wt).indexOf(G)>=0?G:Wt.UNKNOWN}(H.status);T(new Pn(Q,H.message))}else T(new Pn(Wt.UNKNOWN,"Server responded with status "+a.getStatus()))}else T(new Pn(Wt.UNAVAILABLE,"Connection failed."));break;default:xr()}}finally{Un(Uo,`RPC '${e}' ${f} completed.`)}});const A=JSON.stringify(u);Un(Uo,`RPC '${e}' ${f} sending request:`,u),a.send(r,"POST",A,o,15)})}Bo(e,r,o){const u=DP(),f=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],y=u9(),T=c9(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},A=this.longPollingOptions.timeoutSeconds;A!==void 0&&(a.longPollingTimeout=Math.round(1e3*A)),this.useFetchStreams&&(a.xmlHttpFactory=new o9({})),this.Oo(a.initMessageHeaders,r,o),a.encodeInitMessageHeaders=!0;const D=f.join("");Un(Uo,`Creating RPC '${e}' stream ${u}: ${D}`,a);const O=y.createWebChannel(D,a);let B=!1,H=!1;const Q=new _ie({Io:se=>{H?Un(Uo,`Not sending because RPC '${e}' stream ${u} is closed:`,se):(B||(Un(Uo,`Opening RPC '${e}' stream ${u} transport.`),O.open(),B=!0),Un(Uo,`RPC '${e}' stream ${u} sending:`,se),O.send(se))},To:()=>O.close()}),re=(se,G,Y)=>{se.listen(G,Z=>{try{Y(Z)}catch(fe){setTimeout(()=>{throw fe},0)}})};return re(O,cv.EventType.OPEN,()=>{H||(Un(Uo,`RPC '${e}' stream ${u} transport opened.`),Q.yo())}),re(O,cv.EventType.CLOSE,()=>{H||(H=!0,Un(Uo,`RPC '${e}' stream ${u} transport closed`),Q.So())}),re(O,cv.EventType.ERROR,se=>{H||(H=!0,L_(Uo,`RPC '${e}' stream ${u} transport errored:`,se),Q.So(new Pn(Wt.UNAVAILABLE,"The operation could not be completed")))}),re(O,cv.EventType.MESSAGE,se=>{var G;if(!H){const Y=se.data[0];Oi(!!Y);const Z=Y,fe=Z.error||((G=Z[0])===null||G===void 0?void 0:G.error);if(fe){Un(Uo,`RPC '${e}' stream ${u} received error:`,fe);const Te=fe.status;let Pe=function(W){const ge=js[W];if(ge!==void 0)return L9(ge)}(Te),ce=fe.message;Pe===void 0&&(Pe=Wt.INTERNAL,ce="Unknown error status: "+Te+" with message "+fe.message),H=!0,Q.So(new Pn(Pe,ce)),O.close()}else Un(Uo,`RPC '${e}' stream ${u} received:`,Y),Q.bo(Y)}}),re(T,l9.STAT_EVENT,se=>{se.stat===wM.PROXY?Un(Uo,`RPC '${e}' stream ${u} detected buffering proxy`):se.stat===wM.NOPROXY&&Un(Uo,`RPC '${e}' stream ${u} detected no buffering proxy`)}),setTimeout(()=>{Q.wo()},0),Q}}function OP(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kS(t){return new Cre(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H9{constructor(e,r,o=1e3,u=1.5,f=6e4){this.ui=e,this.timerId=r,this.ko=o,this.qo=u,this.Qo=f,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const r=Math.floor(this.Ko+this.zo()),o=Math.max(0,Date.now()-this.Uo),u=Math.max(0,r-o);u>0&&Un("ExponentialBackoff",`Backing off for ${u} ms (base delay: ${this.Ko} ms, delay with jitter: ${r} ms, last attempt: ${o} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,u,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z9{constructor(e,r,o,u,f,y,T,a){this.ui=e,this.Ho=o,this.Jo=u,this.connection=f,this.authCredentialsProvider=y,this.appCheckCredentialsProvider=T,this.listener=a,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new H9(e,r)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,r){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():r&&r.code===Wt.RESOURCE_EXHAUSTED?(Mh(r.toString()),Mh("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):r&&r.code===Wt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(r)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),r=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([o,u])=>{this.Yo===r&&this.P_(o,u)},o=>{e(()=>{const u=new Pn(Wt.UNKNOWN,"Fetching auth token failed: "+o.message);return this.I_(u)})})}P_(e,r){const o=this.h_(this.Yo);this.stream=this.T_(e,r),this.stream.Eo(()=>{o(()=>this.listener.Eo())}),this.stream.Ro(()=>{o(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(u=>{o(()=>this.I_(u))}),this.stream.onMessage(u=>{o(()=>++this.e_==1?this.E_(u):this.onNext(u))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return Un("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return r=>{this.ui.enqueueAndForget(()=>this.Yo===e?r():(Un("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class vie extends Z9{constructor(e,r,o,u,f,y){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,o,u,y),this.serializer=f}T_(e,r){return this.connection.Bo("Listen",e,r)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const r=Mre(this.serializer,e),o=function(f){if(!("targetChange"in f))return Ar.min();const y=f.targetChange;return y.targetIds&&y.targetIds.length?Ar.min():y.readTime?Eu(y.readTime):Ar.min()}(e);return this.listener.d_(r,o)}A_(e){const r={};r.database=MM(this.serializer),r.addTarget=function(f,y){let T;const a=y.target;if(T=IM(a)?{documents:Ore(f,a)}:{query:Lre(f,a)._t},T.targetId=y.targetId,y.resumeToken.approximateByteSize()>0){T.resumeToken=F9(f,y.resumeToken);const A=CM(f,y.expectedCount);A!==null&&(T.expectedCount=A)}else if(y.snapshotVersion.compareTo(Ar.min())>0){T.readTime=pE(f,y.snapshotVersion.toTimestamp());const A=CM(f,y.expectedCount);A!==null&&(T.expectedCount=A)}return T}(this.serializer,e);const o=Nre(this.serializer,e);o&&(r.labels=o),this.a_(r)}R_(e){const r={};r.database=MM(this.serializer),r.removeTarget=e,this.a_(r)}}class xie extends Z9{constructor(e,r,o,u,f,y){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,o,u,y),this.serializer=f}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,r){return this.connection.Bo("Write",e,r)}E_(e){return Oi(!!e.streamToken),this.lastStreamToken=e.streamToken,Oi(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Oi(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const r=Dre(e.writeResults,e.commitTime),o=Eu(e.commitTime);return this.listener.g_(o,r)}p_(){const e={};e.database=MM(this.serializer),this.a_(e)}m_(e){const r={streamToken:this.lastStreamToken,writes:e.map(o=>kre(this.serializer,o))};this.a_(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bie extends class{}{constructor(e,r,o,u){super(),this.authCredentials=e,this.appCheckCredentials=r,this.connection=o,this.serializer=u,this.y_=!1}w_(){if(this.y_)throw new Pn(Wt.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,r,o,u){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,y])=>this.connection.Mo(e,PM(r,o),u,f,y)).catch(f=>{throw f.name==="FirebaseError"?(f.code===Wt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new Pn(Wt.UNKNOWN,f.toString())})}Lo(e,r,o,u,f){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([y,T])=>this.connection.Lo(e,PM(r,o),u,y,T,f)).catch(y=>{throw y.name==="FirebaseError"?(y.code===Wt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),y):new Pn(Wt.UNKNOWN,y.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class wie{constructor(e,r){this.asyncQueue=e,this.onlineStateHandler=r,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const r=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Mh(r),this.D_=!1):Un("OnlineStateTracker",r)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tie{constructor(e,r,o,u,f){this.localStore=e,this.datastore=r,this.asyncQueue=o,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=f,this.k_._o(y=>{o.enqueueAndForget(async()=>{ym(this)&&(Un("RemoteStore","Restarting streams for network reachability change."),await async function(a){const A=Cr(a);A.L_.add(4),await Jx(A),A.q_.set("Unknown"),A.L_.delete(4),await DS(A)}(this))})}),this.q_=new wie(o,u)}}async function DS(t){if(ym(t))for(const e of t.B_)await e(!0)}async function Jx(t){for(const e of t.B_)await e(!1)}function X9(t,e){const r=Cr(t);r.N_.has(e.targetId)||(r.N_.set(e.targetId,e),TD(r)?wD(r):ay(r).r_()&&bD(r,e))}function xD(t,e){const r=Cr(t),o=ay(r);r.N_.delete(e),o.r_()&&K9(r,e),r.N_.size===0&&(o.r_()?o.o_():ym(r)&&r.q_.set("Unknown"))}function bD(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ar.min())>0){const r=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(r)}ay(t).A_(e)}function K9(t,e){t.Q_.xe(e),ay(t).R_(e)}function wD(t){t.Q_=new Ere({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),ay(t).start(),t.q_.v_()}function TD(t){return ym(t)&&!ay(t).n_()&&t.N_.size>0}function ym(t){return Cr(t).L_.size===0}function Y9(t){t.Q_=void 0}async function Eie(t){t.q_.set("Online")}async function Sie(t){t.N_.forEach((e,r)=>{bD(t,e)})}async function Iie(t,e){Y9(t),TD(t)?(t.q_.M_(e),wD(t)):t.q_.set("Unknown")}async function Aie(t,e,r){if(t.q_.set("Online"),e instanceof N9&&e.state===2&&e.cause)try{await async function(u,f){const y=f.cause;for(const T of f.targetIds)u.N_.has(T)&&(await u.remoteSyncer.rejectListen(T,y),u.N_.delete(T),u.Q_.removeTarget(T))}(t,e)}catch(o){Un("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),o),await mE(t,o)}else if(e instanceof pT?t.Q_.Ke(e):e instanceof z9?t.Q_.He(e):t.Q_.We(e),!r.isEqual(Ar.min()))try{const o=await W9(t.localStore);r.compareTo(o)>=0&&await function(f,y){const T=f.Q_.rt(y);return T.targetChanges.forEach((a,A)=>{if(a.resumeToken.approximateByteSize()>0){const D=f.N_.get(A);D&&f.N_.set(A,D.withResumeToken(a.resumeToken,y))}}),T.targetMismatches.forEach((a,A)=>{const D=f.N_.get(a);if(!D)return;f.N_.set(a,D.withResumeToken(Co.EMPTY_BYTE_STRING,D.snapshotVersion)),K9(f,a);const O=new Xd(D.target,a,A,D.sequenceNumber);bD(f,O)}),f.remoteSyncer.applyRemoteEvent(T)}(t,r)}catch(o){Un("RemoteStore","Failed to raise snapshot:",o),await mE(t,o)}}async function mE(t,e,r){if(!Kx(e))throw e;t.L_.add(1),await Jx(t),t.q_.set("Offline"),r||(r=()=>W9(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{Un("RemoteStore","Retrying IndexedDB access"),await r(),t.L_.delete(1),await DS(t)})}function Q9(t,e){return e().catch(r=>mE(t,r,e))}async function OS(t){const e=Cr(t),r=yf(e);let o=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;Cie(e);)try{const u=await hie(e.localStore,o);if(u===null){e.O_.length===0&&r.o_();break}o=u.batchId,Pie(e,u)}catch(u){await mE(e,u)}J9(e)&&e7(e)}function Cie(t){return ym(t)&&t.O_.length<10}function Pie(t,e){t.O_.push(e);const r=yf(t);r.r_()&&r.V_&&r.m_(e.mutations)}function J9(t){return ym(t)&&!yf(t).n_()&&t.O_.length>0}function e7(t){yf(t).start()}async function Rie(t){yf(t).p_()}async function Mie(t){const e=yf(t);for(const r of t.O_)e.m_(r.mutations)}async function kie(t,e,r){const o=t.O_.shift(),u=pD.from(o,e,r);await Q9(t,()=>t.remoteSyncer.applySuccessfulWrite(u)),await OS(t)}async function Die(t,e){e&&yf(t).V_&&await async function(o,u){if(function(y){return bre(y)&&y!==Wt.ABORTED}(u.code)){const f=o.O_.shift();yf(o).s_(),await Q9(o,()=>o.remoteSyncer.rejectFailedWrite(f.batchId,u)),await OS(o)}}(t,e),J9(t)&&e7(t)}async function DB(t,e){const r=Cr(t);r.asyncQueue.verifyOperationInProgress(),Un("RemoteStore","RemoteStore received new credentials");const o=ym(r);r.L_.add(3),await Jx(r),o&&r.q_.set("Unknown"),await r.remoteSyncer.handleCredentialChange(e),r.L_.delete(3),await DS(r)}async function Oie(t,e){const r=Cr(t);e?(r.L_.delete(2),await DS(r)):e||(r.L_.add(2),await Jx(r),r.q_.set("Unknown"))}function ay(t){return t.K_||(t.K_=function(r,o,u){const f=Cr(r);return f.w_(),new vie(o,f.connection,f.authCredentials,f.appCheckCredentials,f.serializer,u)}(t.datastore,t.asyncQueue,{Eo:Eie.bind(null,t),Ro:Sie.bind(null,t),mo:Iie.bind(null,t),d_:Aie.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),TD(t)?wD(t):t.q_.set("Unknown")):(await t.K_.stop(),Y9(t))})),t.K_}function yf(t){return t.U_||(t.U_=function(r,o,u){const f=Cr(r);return f.w_(),new xie(o,f.connection,f.authCredentials,f.appCheckCredentials,f.serializer,u)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Rie.bind(null,t),mo:Die.bind(null,t),f_:Mie.bind(null,t),g_:kie.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await OS(t)):(await t.U_.stop(),t.O_.length>0&&(Un("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ED{constructor(e,r,o,u,f){this.asyncQueue=e,this.timerId=r,this.targetTimeMs=o,this.op=u,this.removalCallback=f,this.deferred=new wh,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(y=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,r,o,u,f){const y=Date.now()+o,T=new ED(e,r,y,u,f);return T.start(o),T}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Pn(Wt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function SD(t,e){if(Mh("AsyncQueue",`${e}: ${t}`),Kx(t))return new Pn(Wt.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v_{constructor(e){this.comparator=e?(r,o)=>e(r,o)||er.comparator(r.key,o.key):(r,o)=>er.comparator(r.key,o.key),this.keyedMap=uv(),this.sortedSet=new _s(this.comparator)}static emptySet(e){return new v_(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const r=this.keyedMap.get(e);return r?this.sortedSet.indexOf(r):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((r,o)=>(e(r),!1))}add(e){const r=this.delete(e.key);return r.copy(r.keyedMap.insert(e.key,e),r.sortedSet.insert(e,null))}delete(e){const r=this.get(e);return r?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(r)):this}isEqual(e){if(!(e instanceof v_)||this.size!==e.size)return!1;const r=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;r.hasNext();){const u=r.getNext().key,f=o.getNext().key;if(!u.isEqual(f))return!1}return!0}toString(){const e=[];return this.forEach(r=>{e.push(r.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,r){const o=new v_;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=r,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OB{constructor(){this.W_=new _s(er.comparator)}track(e){const r=e.doc.key,o=this.W_.get(r);o?e.type!==0&&o.type===3?this.W_=this.W_.insert(r,e):e.type===3&&o.type!==1?this.W_=this.W_.insert(r,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.W_=this.W_.insert(r,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.W_=this.W_.remove(r):e.type===1&&o.type===2?this.W_=this.W_.insert(r,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):xr():this.W_=this.W_.insert(r,e)}G_(){const e=[];return this.W_.inorderTraversal((r,o)=>{e.push(o)}),e}}class j_{constructor(e,r,o,u,f,y,T,a,A){this.query=e,this.docs=r,this.oldDocs=o,this.docChanges=u,this.mutatedKeys=f,this.fromCache=y,this.syncStateChanged=T,this.excludesMetadataChanges=a,this.hasCachedResults=A}static fromInitialDocuments(e,r,o,u,f){const y=[];return r.forEach(T=>{y.push({type:0,doc:T})}),new j_(e,r,v_.emptySet(r),y,o,u,!0,!1,f)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&AS(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const r=this.docChanges,o=e.docChanges;if(r.length!==o.length)return!1;for(let u=0;u<r.length;u++)if(r[u].type!==o[u].type||!r[u].doc.isEqual(o[u].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lie{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class zie{constructor(){this.queries=LB(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(r,o){const u=Cr(r),f=u.queries;u.queries=LB(),f.forEach((y,T)=>{for(const a of T.j_)a.onError(o)})})(this,new Pn(Wt.ABORTED,"Firestore shutting down"))}}function LB(){return new oy(t=>T9(t),AS)}async function ID(t,e){const r=Cr(t);let o=3;const u=e.query;let f=r.queries.get(u);f?!f.H_()&&e.J_()&&(o=2):(f=new Lie,o=e.J_()?0:1);try{switch(o){case 0:f.z_=await r.onListen(u,!0);break;case 1:f.z_=await r.onListen(u,!1);break;case 2:await r.onFirstRemoteStoreListen(u)}}catch(y){const T=SD(y,`Initialization of query '${Vg(e.query)}' failed`);return void e.onError(T)}r.queries.set(u,f),f.j_.push(e),e.Z_(r.onlineState),f.z_&&e.X_(f.z_)&&CD(r)}async function AD(t,e){const r=Cr(t),o=e.query;let u=3;const f=r.queries.get(o);if(f){const y=f.j_.indexOf(e);y>=0&&(f.j_.splice(y,1),f.j_.length===0?u=e.J_()?0:1:!f.H_()&&e.J_()&&(u=2))}switch(u){case 0:return r.queries.delete(o),r.onUnlisten(o,!0);case 1:return r.queries.delete(o),r.onUnlisten(o,!1);case 2:return r.onLastRemoteStoreUnlisten(o);default:return}}function Nie(t,e){const r=Cr(t);let o=!1;for(const u of e){const f=u.query,y=r.queries.get(f);if(y){for(const T of y.j_)T.X_(u)&&(o=!0);y.z_=u}}o&&CD(r)}function Fie(t,e,r){const o=Cr(t),u=o.queries.get(e);if(u)for(const f of u.j_)f.onError(r);o.queries.delete(e)}function CD(t){t.Y_.forEach(e=>{e.next()})}var DM,zB;(zB=DM||(DM={})).ea="default",zB.Cache="cache";class PD{constructor(e,r,o){this.query=e,this.ta=r,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=o||{}}X_(e){if(!this.options.includeMetadataChanges){const o=[];for(const u of e.docChanges)u.type!==3&&o.push(u);e=new j_(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let r=!1;return this.na?this.ia(e)&&(this.ta.next(e),r=!0):this.sa(e,this.onlineState)&&(this.oa(e),r=!0),this.ra=e,r}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let r=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),r=!0),r}sa(e,r){if(!e.fromCache||!this.J_())return!0;const o=r!=="Offline";return(!this.options._a||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||r==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const r=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!r)&&this.options.includeMetadataChanges===!0}oa(e){e=j_.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==DM.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t7{constructor(e){this.key=e}}class n7{constructor(e){this.key=e}}class Bie{constructor(e,r){this.query=e,this.Ta=r,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Wr(),this.mutatedKeys=Wr(),this.Aa=E9(e),this.Ra=new v_(this.Aa)}get Va(){return this.Ta}ma(e,r){const o=r?r.fa:new OB,u=r?r.Ra:this.Ra;let f=r?r.mutatedKeys:this.mutatedKeys,y=u,T=!1;const a=this.query.limitType==="F"&&u.size===this.query.limit?u.last():null,A=this.query.limitType==="L"&&u.size===this.query.limit?u.first():null;if(e.inorderTraversal((D,O)=>{const B=u.get(D),H=CS(this.query,O)?O:null,Q=!!B&&this.mutatedKeys.has(B.key),re=!!H&&(H.hasLocalMutations||this.mutatedKeys.has(H.key)&&H.hasCommittedMutations);let se=!1;B&&H?B.data.isEqual(H.data)?Q!==re&&(o.track({type:3,doc:H}),se=!0):this.ga(B,H)||(o.track({type:2,doc:H}),se=!0,(a&&this.Aa(H,a)>0||A&&this.Aa(H,A)<0)&&(T=!0)):!B&&H?(o.track({type:0,doc:H}),se=!0):B&&!H&&(o.track({type:1,doc:B}),se=!0,(a||A)&&(T=!0)),se&&(H?(y=y.add(H),f=re?f.add(D):f.delete(D)):(y=y.delete(D),f=f.delete(D)))}),this.query.limit!==null)for(;y.size>this.query.limit;){const D=this.query.limitType==="F"?y.last():y.first();y=y.delete(D.key),f=f.delete(D.key),o.track({type:1,doc:D})}return{Ra:y,fa:o,ns:T,mutatedKeys:f}}ga(e,r){return e.hasLocalMutations&&r.hasCommittedMutations&&!r.hasLocalMutations}applyChanges(e,r,o,u){const f=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const y=e.fa.G_();y.sort((D,O)=>function(H,Q){const re=se=>{switch(se){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return xr()}};return re(H)-re(Q)}(D.type,O.type)||this.Aa(D.doc,O.doc)),this.pa(o),u=u!=null&&u;const T=r&&!u?this.ya():[],a=this.da.size===0&&this.current&&!u?1:0,A=a!==this.Ea;return this.Ea=a,y.length!==0||A?{snapshot:new j_(this.query,e.Ra,f,y,e.mutatedKeys,a===0,A,!1,!!o&&o.resumeToken.approximateByteSize()>0),wa:T}:{wa:T}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new OB,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(r=>this.Ta=this.Ta.add(r)),e.modifiedDocuments.forEach(r=>{}),e.removedDocuments.forEach(r=>this.Ta=this.Ta.delete(r)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Wr(),this.Ra.forEach(o=>{this.Sa(o.key)&&(this.da=this.da.add(o.key))});const r=[];return e.forEach(o=>{this.da.has(o)||r.push(new n7(o))}),this.da.forEach(o=>{e.has(o)||r.push(new t7(o))}),r}ba(e){this.Ta=e.Ts,this.da=Wr();const r=this.ma(e.documents);return this.applyChanges(r,!0)}Da(){return j_.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class Uie{constructor(e,r,o){this.query=e,this.targetId=r,this.view=o}}class Vie{constructor(e){this.key=e,this.va=!1}}class jie{constructor(e,r,o,u,f,y){this.localStore=e,this.remoteStore=r,this.eventManager=o,this.sharedClientState=u,this.currentUser=f,this.maxConcurrentLimboResolutions=y,this.Ca={},this.Fa=new oy(T=>T9(T),AS),this.Ma=new Map,this.xa=new Set,this.Oa=new _s(er.comparator),this.Na=new Map,this.La=new _D,this.Ba={},this.ka=new Map,this.qa=V_.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function $ie(t,e,r=!0){const o=l7(t);let u;const f=o.Fa.get(e);return f?(o.sharedClientState.addLocalQueryTarget(f.targetId),u=f.view.Da()):u=await r7(o,e,r,!0),u}async function Gie(t,e){const r=l7(t);await r7(r,e,!0,!1)}async function r7(t,e,r,o){const u=await die(t.localStore,Tu(e)),f=u.targetId,y=r?t.sharedClientState.addLocalQueryTarget(f):"not-current";let T;return o&&(T=await qie(t,e,f,y==="current",u.resumeToken)),t.isPrimaryClient&&r&&X9(t.remoteStore,u),T}async function qie(t,e,r,o,u){t.Ka=(O,B,H)=>async function(re,se,G,Y){let Z=se.view.ma(G);Z.ns&&(Z=await RB(re.localStore,se.query,!1).then(({documents:ce})=>se.view.ma(ce,Z)));const fe=Y&&Y.targetChanges.get(se.targetId),Te=Y&&Y.targetMismatches.get(se.targetId)!=null,Pe=se.view.applyChanges(Z,re.isPrimaryClient,fe,Te);return FB(re,se.targetId,Pe.wa),Pe.snapshot}(t,O,B,H);const f=await RB(t.localStore,e,!0),y=new Bie(e,f.Ts),T=y.ma(f.documents),a=Qx.createSynthesizedTargetChangeForCurrentChange(r,o&&t.onlineState!=="Offline",u),A=y.applyChanges(T,t.isPrimaryClient,a);FB(t,r,A.wa);const D=new Uie(e,r,y);return t.Fa.set(e,D),t.Ma.has(r)?t.Ma.get(r).push(e):t.Ma.set(r,[e]),A.snapshot}async function Wie(t,e,r){const o=Cr(t),u=o.Fa.get(e),f=o.Ma.get(u.targetId);if(f.length>1)return o.Ma.set(u.targetId,f.filter(y=>!AS(y,e))),void o.Fa.delete(e);o.isPrimaryClient?(o.sharedClientState.removeLocalQueryTarget(u.targetId),o.sharedClientState.isActiveQueryTarget(u.targetId)||await kM(o.localStore,u.targetId,!1).then(()=>{o.sharedClientState.clearQueryState(u.targetId),r&&xD(o.remoteStore,u.targetId),OM(o,u.targetId)}).catch(Xx)):(OM(o,u.targetId),await kM(o.localStore,u.targetId,!0))}async function Hie(t,e){const r=Cr(t),o=r.Fa.get(e),u=r.Ma.get(o.targetId);r.isPrimaryClient&&u.length===1&&(r.sharedClientState.removeLocalQueryTarget(o.targetId),xD(r.remoteStore,o.targetId))}async function Zie(t,e,r){const o=tse(t);try{const u=await function(y,T){const a=Cr(y),A=oo.now(),D=T.reduce((H,Q)=>H.add(Q.key),Wr());let O,B;return a.persistence.runTransaction("Locally write mutations","readwrite",H=>{let Q=kh(),re=Wr();return a.cs.getEntries(H,D).next(se=>{Q=se,Q.forEach((G,Y)=>{Y.isValidDocument()||(re=re.add(G))})}).next(()=>a.localDocuments.getOverlayedDocuments(H,Q)).next(se=>{O=se;const G=[];for(const Y of T){const Z=gre(Y,O.get(Y.key).overlayedDocument);Z!=null&&G.push(new If(Y.key,Z,m9(Z.value.mapValue),Fl.exists(!0)))}return a.mutationQueue.addMutationBatch(H,A,G,T)}).next(se=>{B=se;const G=se.applyToLocalDocumentSet(O,re);return a.documentOverlayCache.saveOverlays(H,se.batchId,G)})}).then(()=>({batchId:B.batchId,changes:I9(O)}))}(o.localStore,e);o.sharedClientState.addPendingMutation(u.batchId),function(y,T,a){let A=y.Ba[y.currentUser.toKey()];A||(A=new _s(ii)),A=A.insert(T,a),y.Ba[y.currentUser.toKey()]=A}(o,u.batchId,r),await e1(o,u.changes),await OS(o.remoteStore)}catch(u){const f=SD(u,"Failed to persist write");r.reject(f)}}async function i7(t,e){const r=Cr(t);try{const o=await cie(r.localStore,e);e.targetChanges.forEach((u,f)=>{const y=r.Na.get(f);y&&(Oi(u.addedDocuments.size+u.modifiedDocuments.size+u.removedDocuments.size<=1),u.addedDocuments.size>0?y.va=!0:u.modifiedDocuments.size>0?Oi(y.va):u.removedDocuments.size>0&&(Oi(y.va),y.va=!1))}),await e1(r,o,e)}catch(o){await Xx(o)}}function NB(t,e,r){const o=Cr(t);if(o.isPrimaryClient&&r===0||!o.isPrimaryClient&&r===1){const u=[];o.Fa.forEach((f,y)=>{const T=y.view.Z_(e);T.snapshot&&u.push(T.snapshot)}),function(y,T){const a=Cr(y);a.onlineState=T;let A=!1;a.queries.forEach((D,O)=>{for(const B of O.j_)B.Z_(T)&&(A=!0)}),A&&CD(a)}(o.eventManager,e),u.length&&o.Ca.d_(u),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function Xie(t,e,r){const o=Cr(t);o.sharedClientState.updateQueryState(e,"rejected",r);const u=o.Na.get(e),f=u&&u.key;if(f){let y=new _s(er.comparator);y=y.insert(f,Go.newNoDocument(f,Ar.min()));const T=Wr().add(f),a=new MS(Ar.min(),new Map,new _s(ii),y,T);await i7(o,a),o.Oa=o.Oa.remove(f),o.Na.delete(e),RD(o)}else await kM(o.localStore,e,!1).then(()=>OM(o,e,r)).catch(Xx)}async function Kie(t,e){const r=Cr(t),o=e.batch.batchId;try{const u=await lie(r.localStore,e);o7(r,o,null),s7(r,o),r.sharedClientState.updateMutationState(o,"acknowledged"),await e1(r,u)}catch(u){await Xx(u)}}async function Yie(t,e,r){const o=Cr(t);try{const u=await function(y,T){const a=Cr(y);return a.persistence.runTransaction("Reject batch","readwrite-primary",A=>{let D;return a.mutationQueue.lookupMutationBatch(A,T).next(O=>(Oi(O!==null),D=O.keys(),a.mutationQueue.removeMutationBatch(A,O))).next(()=>a.mutationQueue.performConsistencyCheck(A)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(A,D,T)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(A,D)).next(()=>a.localDocuments.getDocuments(A,D))})}(o.localStore,e);o7(o,e,r),s7(o,e),o.sharedClientState.updateMutationState(e,"rejected",r),await e1(o,u)}catch(u){await Xx(u)}}function s7(t,e){(t.ka.get(e)||[]).forEach(r=>{r.resolve()}),t.ka.delete(e)}function o7(t,e,r){const o=Cr(t);let u=o.Ba[o.currentUser.toKey()];if(u){const f=u.get(e);f&&(r?f.reject(r):f.resolve(),u=u.remove(e)),o.Ba[o.currentUser.toKey()]=u}}function OM(t,e,r=null){t.sharedClientState.removeLocalQueryTarget(e);for(const o of t.Ma.get(e))t.Fa.delete(o),r&&t.Ca.$a(o,r);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(o=>{t.La.containsKey(o)||a7(t,o)})}function a7(t,e){t.xa.delete(e.path.canonicalString());const r=t.Oa.get(e);r!==null&&(xD(t.remoteStore,r),t.Oa=t.Oa.remove(e),t.Na.delete(r),RD(t))}function FB(t,e,r){for(const o of r)o instanceof t7?(t.La.addReference(o.key,e),Qie(t,o)):o instanceof n7?(Un("SyncEngine","Document no longer in limbo: "+o.key),t.La.removeReference(o.key,e),t.La.containsKey(o.key)||a7(t,o.key)):xr()}function Qie(t,e){const r=e.key,o=r.path.canonicalString();t.Oa.get(r)||t.xa.has(o)||(Un("SyncEngine","New document in limbo: "+r),t.xa.add(o),RD(t))}function RD(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const r=new er(Hi.fromString(e)),o=t.qa.next();t.Na.set(o,new Vie(r)),t.Oa=t.Oa.insert(r,o),X9(t.remoteStore,new Xd(Tu(IS(r.path)),o,"TargetPurposeLimboResolution",sD.oe))}}async function e1(t,e,r){const o=Cr(t),u=[],f=[],y=[];o.Fa.isEmpty()||(o.Fa.forEach((T,a)=>{y.push(o.Ka(a,e,r).then(A=>{var D;if((A||r)&&o.isPrimaryClient){const O=A?!A.fromCache:(D=r==null?void 0:r.targetChanges.get(a.targetId))===null||D===void 0?void 0:D.current;o.sharedClientState.updateQueryState(a.targetId,O?"current":"not-current")}if(A){u.push(A);const O=vD.Wi(a.targetId,A);f.push(O)}}))}),await Promise.all(y),o.Ca.d_(u),await async function(a,A){const D=Cr(a);try{await D.persistence.runTransaction("notifyLocalViewChanges","readwrite",O=>Jt.forEach(A,B=>Jt.forEach(B.$i,H=>D.persistence.referenceDelegate.addReference(O,B.targetId,H)).next(()=>Jt.forEach(B.Ui,H=>D.persistence.referenceDelegate.removeReference(O,B.targetId,H)))))}catch(O){if(!Kx(O))throw O;Un("LocalStore","Failed to update sequence numbers: "+O)}for(const O of A){const B=O.targetId;if(!O.fromCache){const H=D.os.get(B),Q=H.snapshotVersion,re=H.withLastLimboFreeSnapshotVersion(Q);D.os=D.os.insert(B,re)}}}(o.localStore,f))}async function Jie(t,e){const r=Cr(t);if(!r.currentUser.isEqual(e)){Un("SyncEngine","User change. New user:",e.toKey());const o=await q9(r.localStore,e);r.currentUser=e,function(f,y){f.ka.forEach(T=>{T.forEach(a=>{a.reject(new Pn(Wt.CANCELLED,y))})}),f.ka.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await e1(r,o.hs)}}function ese(t,e){const r=Cr(t),o=r.Na.get(e);if(o&&o.va)return Wr().add(o.key);{let u=Wr();const f=r.Ma.get(e);if(!f)return u;for(const y of f){const T=r.Fa.get(y);u=u.unionWith(T.view.Va)}return u}}function l7(t){const e=Cr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=i7.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ese.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Xie.bind(null,e),e.Ca.d_=Nie.bind(null,e.eventManager),e.Ca.$a=Fie.bind(null,e.eventManager),e}function tse(t){const e=Cr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Kie.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Yie.bind(null,e),e}class BB{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=kS(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,r){return null}createIndexBackfillerScheduler(e,r){return null}createLocalStore(e){return aie(this.persistence,new sie,e.initialUser,this.serializer)}createPersistence(e){return new nie(yD.Zr,this.serializer)}createSharedClientState(e){return new pie}async terminate(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class nse{async initialize(e,r){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>NB(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=Jie.bind(null,this.syncEngine),await Oie(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new zie}()}createDatastore(e){const r=kS(e.databaseInfo.databaseId),o=function(f){return new yie(f)}(e.databaseInfo);return function(f,y,T,a){return new bie(f,y,T,a)}(e.authCredentials,e.appCheckCredentials,o,r)}createRemoteStore(e){return function(o,u,f,y,T){return new Tie(o,u,f,y,T)}(this.localStore,this.datastore,e.asyncQueue,r=>NB(this.syncEngine,r,0),function(){return kB.D()?new kB:new mie}())}createSyncEngine(e,r){return function(u,f,y,T,a,A,D){const O=new jie(u,f,y,T,a,A);return D&&(O.Qa=!0),O}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}async terminate(){var e,r;await async function(u){const f=Cr(u);Un("RemoteStore","RemoteStore shutting down."),f.L_.add(5),await Jx(f),f.k_.shutdown(),f.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MD{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):Mh("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,r){this.muted||setTimeout(()=>{this.muted||e(r)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rse{constructor(e,r,o,u){this.authCredentials=e,this.appCheckCredentials=r,this.asyncQueue=o,this.databaseInfo=u,this.user=jo.UNAUTHENTICATED,this.clientId=d9.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(o,async f=>{Un("FirestoreClient","Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(o,f=>(Un("FirestoreClient","Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Pn(Wt.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new wh;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){const o=SD(r,"Failed to shutdown persistence");e.reject(o)}}),e.promise}}async function LP(t,e){t.asyncQueue.verifyOperationInProgress(),Un("FirestoreClient","Initializing OfflineComponentProvider");const r=t.configuration;await e.initialize(r);let o=r.initialUser;t.setCredentialChangeListener(async u=>{o.isEqual(u)||(await q9(e.localStore,u),o=u)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function UB(t,e){t.asyncQueue.verifyOperationInProgress();const r=await sse(t);Un("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(r,t.configuration),t.setCredentialChangeListener(o=>DB(e.remoteStore,o)),t.setAppCheckTokenChangeListener((o,u)=>DB(e.remoteStore,u)),t._onlineComponents=e}function ise(t){return t.name==="FirebaseError"?t.code===Wt.FAILED_PRECONDITION||t.code===Wt.UNIMPLEMENTED:!(typeof DOMException<"u"&&t instanceof DOMException)||t.code===22||t.code===20||t.code===11}async function sse(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Un("FirestoreClient","Using user provided OfflineComponentProvider");try{await LP(t,t._uninitializedComponentsProvider._offline)}catch(e){const r=e;if(!ise(r))throw r;L_("Error using user provided cache. Falling back to memory cache: "+r),await LP(t,new BB)}}else Un("FirestoreClient","Using default OfflineComponentProvider"),await LP(t,new BB);return t._offlineComponents}async function c7(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Un("FirestoreClient","Using user provided OnlineComponentProvider"),await UB(t,t._uninitializedComponentsProvider._online)):(Un("FirestoreClient","Using default OnlineComponentProvider"),await UB(t,new nse))),t._onlineComponents}function ose(t){return c7(t).then(e=>e.syncEngine)}async function gE(t){const e=await c7(t),r=e.eventManager;return r.onListen=$ie.bind(null,e.syncEngine),r.onUnlisten=Wie.bind(null,e.syncEngine),r.onFirstRemoteStoreListen=Gie.bind(null,e.syncEngine),r.onLastRemoteStoreUnlisten=Hie.bind(null,e.syncEngine),r}function ase(t,e,r={}){const o=new wh;return t.asyncQueue.enqueueAndForget(async()=>function(f,y,T,a,A){const D=new MD({next:B=>{y.enqueueAndForget(()=>AD(f,O));const H=B.docs.has(T);!H&&B.fromCache?A.reject(new Pn(Wt.UNAVAILABLE,"Failed to get document because the client is offline.")):H&&B.fromCache&&a&&a.source==="server"?A.reject(new Pn(Wt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):A.resolve(B)},error:B=>A.reject(B)}),O=new PD(IS(T.path),D,{includeMetadataChanges:!0,_a:!0});return ID(f,O)}(await gE(t),t.asyncQueue,e,r,o)),o.promise}function lse(t,e,r={}){const o=new wh;return t.asyncQueue.enqueueAndForget(async()=>function(f,y,T,a,A){const D=new MD({next:B=>{y.enqueueAndForget(()=>AD(f,O)),B.fromCache&&a.source==="server"?A.reject(new Pn(Wt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):A.resolve(B)},error:B=>A.reject(B)}),O=new PD(T,D,{includeMetadataChanges:!0,_a:!0});return ID(f,O)}(await gE(t),t.asyncQueue,e,r,o)),o.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u7(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VB=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h7(t,e,r){if(!r)throw new Pn(Wt.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function cse(t,e,r,o){if(e===!0&&o===!0)throw new Pn(Wt.INVALID_ARGUMENT,`${t} and ${r} cannot be used together.`)}function jB(t){if(!er.isDocumentKey(t))throw new Pn(Wt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function $B(t){if(er.isDocumentKey(t))throw new Pn(Wt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function LS(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(o){return o.constructor?o.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":xr()}function Na(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Pn(Wt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=LS(t);throw new Pn(Wt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${r}`)}}return t}function use(t,e){if(e<=0)throw new Pn(Wt.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GB{constructor(e){var r,o;if(e.host===void 0){if(e.ssl!==void 0)throw new Pn(Wt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(r=e.ssl)===null||r===void 0||r;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Pn(Wt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}cse("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=u7((o=e.experimentalLongPollingOptions)!==null&&o!==void 0?o:{}),function(f){if(f.timeoutSeconds!==void 0){if(isNaN(f.timeoutSeconds))throw new Pn(Wt.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (must not be NaN)`);if(f.timeoutSeconds<5)throw new Pn(Wt.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (minimum allowed value is 5)`);if(f.timeoutSeconds>30)throw new Pn(Wt.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(o,u){return o.timeoutSeconds===u.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class zS{constructor(e,r,o,u){this._authCredentials=e,this._appCheckCredentials=r,this._databaseId=o,this._app=u,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new GB({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Pn(Wt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new Pn(Wt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new GB(e),e.credentials!==void 0&&(this._authCredentials=function(o){if(!o)return new Sne;switch(o.type){case"firstParty":return new Pne(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new Pn(Wt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(r){const o=VB.get(r);o&&(Un("ComponentProvider","Removing Datastore"),VB.delete(r),o.terminate())}(this),Promise.resolve()}}function hse(t,e,r,o={}){var u;const f=(t=Na(t,zS))._getSettings(),y=`${e}:${r}`;if(f.host!=="firestore.googleapis.com"&&f.host!==y&&L_("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},f),{host:y,ssl:!1})),o.mockUserToken){let T,a;if(typeof o.mockUserToken=="string")T=o.mockUserToken,a=jo.MOCK_USER;else{T=x8(o.mockUserToken,(u=t._app)===null||u===void 0?void 0:u.options.projectId);const A=o.mockUserToken.sub||o.mockUserToken.user_id;if(!A)throw new Pn(Wt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new jo(A)}t._authCredentials=new Ine(new h9(T,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bh{constructor(e,r,o){this.converter=r,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new Bh(this.firestore,e,this._query)}}class Wo{constructor(e,r,o){this.converter=r,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hf(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Wo(this.firestore,e,this._key)}}class hf extends Bh{constructor(e,r,o){super(e,r,IS(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Wo(this.firestore,null,new er(e))}withConverter(e){return new hf(this.firestore,e,this._path)}}function ss(t,e,...r){if(t=Hs(t),h7("collection","path",e),t instanceof zS){const o=Hi.fromString(e,...r);return $B(o),new hf(t,null,o)}{if(!(t instanceof Wo||t instanceof hf))throw new Pn(Wt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=t._path.child(Hi.fromString(e,...r));return $B(o),new hf(t.firestore,null,o)}}function gr(t,e,...r){if(t=Hs(t),arguments.length===1&&(e=d9.newId()),h7("doc","path",e),t instanceof zS){const o=Hi.fromString(e,...r);return jB(o),new Wo(t,null,new er(o))}{if(!(t instanceof Wo||t instanceof hf))throw new Pn(Wt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=t._path.child(Hi.fromString(e,...r));return jB(o),new Wo(t.firestore,t instanceof hf?t.converter:null,new er(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dse{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new H9(this,"async_queue_retry"),this.Eu=()=>{const r=OP();r&&Un("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()};const e=OP();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;const r=OP();r&&typeof r.removeEventListener=="function"&&r.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});const r=new wh;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(r.resolve,r.reject),r.promise)).then(()=>r.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}async Ru(){if(this.uu.length!==0){try{await this.uu[0](),this.uu.shift(),this.t_.reset()}catch(e){if(!Kx(e))throw e;Un("AsyncQueue","Operation failed with retryable error: "+e)}this.uu.length>0&&this.t_.Go(()=>this.Ru())}}Au(e){const r=this.au.then(()=>(this.Pu=!0,e().catch(o=>{this.hu=o,this.Pu=!1;const u=function(y){let T=y.message||"";return y.stack&&(T=y.stack.includes(y.message)?y.stack:y.message+`
`+y.stack),T}(o);throw Mh("INTERNAL UNHANDLED ERROR: ",u),o}).then(o=>(this.Pu=!1,o))));return this.au=r,r}enqueueAfterDelay(e,r,o){this.du(),this.Tu.indexOf(e)>-1&&(r=0);const u=ED.createAndSchedule(this,e,r,o,f=>this.Vu(f));return this.lu.push(u),u}du(){this.hu&&xr()}verifyOperationInProgress(){}async mu(){let e;do e=this.au,await e;while(e!==this.au)}fu(e){for(const r of this.lu)if(r.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((r,o)=>r.targetTimeMs-o.targetTimeMs);for(const r of this.lu)if(r.skipDelay(),e!=="all"&&r.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){const r=this.lu.indexOf(e);this.lu.splice(r,1)}}function qB(t){return function(r,o){if(typeof r!="object"||r===null)return!1;const u=r;for(const f of o)if(f in u&&typeof u[f]=="function")return!0;return!1}(t,["next","error","complete"])}class Dh extends zS{constructor(e,r,o,u){super(e,r,o,u),this.type="firestore",this._queue=function(){return new dse}(),this._persistenceKey=(u==null?void 0:u.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||d7(this),this._firestoreClient.terminate()}}function fse(t,e){const r=typeof t=="object"?t:H3(),o=typeof t=="string"?t:"(default)",u=wS(r,"firestore").getImmediate({identifier:o});if(!u._initialized){const f=_8("firestore");f&&hse(u,...f)}return u}function NS(t){return t._firestoreClient||d7(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function d7(t){var e,r,o;const u=t._freezeSettings(),f=function(T,a,A,D){return new jne(T,a,A,D.host,D.ssl,D.experimentalForceLongPolling,D.experimentalAutoDetectLongPolling,u7(D.experimentalLongPollingOptions),D.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,u);t._firestoreClient=new rse(t._authCredentials,t._appCheckCredentials,t._queue,f),!((r=u.localCache)===null||r===void 0)&&r._offlineComponentProvider&&(!((o=u.localCache)===null||o===void 0)&&o._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:u.localCache.kind,_offline:u.localCache._offlineComponentProvider,_online:u.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $_{constructor(e){this._byteString=e}static fromBase64String(e){try{return new $_(Co.fromBase64String(e))}catch(r){throw new Pn(Wt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+r)}}static fromUint8Array(e){return new $_(Co.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FS{constructor(...e){for(let r=0;r<e.length;++r)if(e[r].length===0)throw new Pn(Wt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Eo(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ly{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kD{constructor(e,r){if(!isFinite(e)||e<-90||e>90)throw new Pn(Wt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(r)||r<-180||r>180)throw new Pn(Wt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=e,this._long=r}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ii(this._lat,e._lat)||ii(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DD{constructor(e){this._values=(e||[]).map(r=>r)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(o,u){if(o.length!==u.length)return!1;for(let f=0;f<o.length;++f)if(o[f]!==u[f])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pse=/^__.*__$/;class mse{constructor(e,r,o){this.data=e,this.fieldMask=r,this.fieldTransforms=o}toMutation(e,r){return this.fieldMask!==null?new If(e,this.data,this.fieldMask,r,this.fieldTransforms):new Yx(e,this.data,r,this.fieldTransforms)}}class f7{constructor(e,r,o){this.data=e,this.fieldMask=r,this.fieldTransforms=o}toMutation(e,r){return new If(e,this.data,this.fieldMask,r,this.fieldTransforms)}}function p7(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw xr()}}class BS{constructor(e,r,o,u,f,y){this.settings=e,this.databaseId=r,this.serializer=o,this.ignoreUndefinedProperties=u,f===void 0&&this.yu(),this.fieldTransforms=f||[],this.fieldMask=y||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new BS(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var r;const o=(r=this.path)===null||r===void 0?void 0:r.child(e),u=this.Su({path:o,Du:!1});return u.vu(e),u}Cu(e){var r;const o=(r=this.path)===null||r===void 0?void 0:r.child(e),u=this.Su({path:o,Du:!1});return u.yu(),u}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return _E(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return this.fieldMask.find(r=>e.isPrefixOf(r))!==void 0||this.fieldTransforms.find(r=>e.isPrefixOf(r.field))!==void 0}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(e.length===0)throw this.Mu("Document fields must not be empty");if(p7(this.wu)&&pse.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}}class gse{constructor(e,r,o){this.databaseId=e,this.ignoreUndefinedProperties=r,this.serializer=o||kS(e)}Nu(e,r,o,u=!1){return new BS({wu:e,methodName:r,Ou:o,path:Eo.emptyPath(),Du:!1,xu:u},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function US(t){const e=t._freezeSettings(),r=kS(t._databaseId);return new gse(t._databaseId,!!e.ignoreUndefinedProperties,r)}function m7(t,e,r,o,u,f={}){const y=t.Nu(f.merge||f.mergeFields?2:0,e,r,u);ND("Data must be an object, but it was:",y,o);const T=_7(o,y);let a,A;if(f.merge)a=new el(y.fieldMask),A=y.fieldTransforms;else if(f.mergeFields){const D=[];for(const O of f.mergeFields){const B=LM(e,O,r);if(!y.contains(B))throw new Pn(Wt.INVALID_ARGUMENT,`Field '${B}' is specified in your field mask but missing from your input data.`);v7(D,B)||D.push(B)}a=new el(D),A=y.fieldTransforms.filter(O=>a.covers(O.field))}else a=null,A=y.fieldTransforms;return new mse(new Ma(T),a,A)}class VS extends ly{_toFieldTransform(e){if(e.wu!==2)throw e.wu===1?e.Mu(`${this._methodName}() can only appear at the top level of your update data`):e.Mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof VS}}function g7(t,e,r){return new BS({wu:3,Ou:e.settings.Ou,methodName:t._methodName,Du:r},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class OD extends ly{_toFieldTransform(e){return new dD(e.path,new vx)}isEqual(e){return e instanceof OD}}class LD extends ly{constructor(e,r){super(e),this.Lu=r}_toFieldTransform(e){const r=g7(this,e,!0),o=this.Lu.map(f=>vm(f,r)),u=new B_(o);return new dD(e.path,u)}isEqual(e){return e instanceof LD&&D_(this.Lu,e.Lu)}}class zD extends ly{constructor(e,r){super(e),this.Lu=r}_toFieldTransform(e){const r=g7(this,e,!0),o=this.Lu.map(f=>vm(f,r)),u=new U_(o);return new dD(e.path,u)}isEqual(e){return e instanceof zD&&D_(this.Lu,e.Lu)}}function _se(t,e,r,o){const u=t.Nu(1,e,r);ND("Data must be an object, but it was:",u,o);const f=[],y=Ma.empty();_m(o,(a,A)=>{const D=FD(e,a,r);A=Hs(A);const O=u.Cu(D);if(A instanceof VS)f.push(D);else{const B=vm(A,O);B!=null&&(f.push(D),y.set(D,B))}});const T=new el(f);return new f7(y,T,u.fieldTransforms)}function yse(t,e,r,o,u,f){const y=t.Nu(1,e,r),T=[LM(e,o,r)],a=[u];if(f.length%2!=0)throw new Pn(Wt.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let B=0;B<f.length;B+=2)T.push(LM(e,f[B])),a.push(f[B+1]);const A=[],D=Ma.empty();for(let B=T.length-1;B>=0;--B)if(!v7(A,T[B])){const H=T[B];let Q=a[B];Q=Hs(Q);const re=y.Cu(H);if(Q instanceof VS)A.push(H);else{const se=vm(Q,re);se!=null&&(A.push(H),D.set(H,se))}}const O=new el(A);return new f7(D,O,y.fieldTransforms)}function vse(t,e,r,o=!1){return vm(r,t.Nu(o?4:3,e))}function vm(t,e){if(y7(t=Hs(t)))return ND("Unsupported field value:",e,t),_7(t,e);if(t instanceof ly)return function(o,u){if(!p7(u.wu))throw u.Mu(`${o._methodName}() can only be used with update() and set()`);if(!u.path)throw u.Mu(`${o._methodName}() is not currently supported inside arrays`);const f=o._toFieldTransform(u);f&&u.fieldTransforms.push(f)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Du&&e.wu!==4)throw e.Mu("Nested arrays are not supported");return function(o,u){const f=[];let y=0;for(const T of o){let a=vm(T,u.Fu(y));a==null&&(a={nullValue:"NULL_VALUE"}),f.push(a),y++}return{arrayValue:{values:f}}}(t,e)}return function(o,u){if((o=Hs(o))===null)return{nullValue:"NULL_VALUE"};if(typeof o=="number")return ure(u.serializer,o);if(typeof o=="boolean")return{booleanValue:o};if(typeof o=="string")return{stringValue:o};if(o instanceof Date){const f=oo.fromDate(o);return{timestampValue:pE(u.serializer,f)}}if(o instanceof oo){const f=new oo(o.seconds,1e3*Math.floor(o.nanoseconds/1e3));return{timestampValue:pE(u.serializer,f)}}if(o instanceof kD)return{geoPointValue:{latitude:o.latitude,longitude:o.longitude}};if(o instanceof $_)return{bytesValue:F9(u.serializer,o._byteString)};if(o instanceof Wo){const f=u.databaseId,y=o.firestore._databaseId;if(!y.isEqual(f))throw u.Mu(`Document reference is for database ${y.projectId}/${y.database} but should be for database ${f.projectId}/${f.database}`);return{referenceValue:gD(o.firestore._databaseId||u.databaseId,o._key.path)}}if(o instanceof DD)return function(y,T){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:y.toArray().map(a=>{if(typeof a!="number")throw T.Mu("VectorValues must only contain numeric values.");return hD(T.serializer,a)})}}}}}}(o,u);throw u.Mu(`Unsupported field value: ${LS(o)}`)}(t,e)}function _7(t,e){const r={};return f9(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):_m(t,(o,u)=>{const f=vm(u,e.bu(o));f!=null&&(r[o]=f)}),{mapValue:{fields:r}}}function y7(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof oo||t instanceof kD||t instanceof $_||t instanceof Wo||t instanceof ly||t instanceof DD)}function ND(t,e,r){if(!y7(r)||!function(u){return typeof u=="object"&&u!==null&&(Object.getPrototypeOf(u)===Object.prototype||Object.getPrototypeOf(u)===null)}(r)){const o=LS(r);throw o==="an object"?e.Mu(t+" a custom object"):e.Mu(t+" "+o)}}function LM(t,e,r){if((e=Hs(e))instanceof FS)return e._internalPath;if(typeof e=="string")return FD(t,e);throw _E("Field path arguments must be of type string or ",t,!1,void 0,r)}const xse=new RegExp("[~\\*/\\[\\]]");function FD(t,e,r){if(e.search(xse)>=0)throw _E(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new FS(...e.split("."))._internalPath}catch{throw _E(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function _E(t,e,r,o,u){const f=o&&!o.isEmpty(),y=u!==void 0;let T=`Function ${e}() called with invalid data`;r&&(T+=" (via `toFirestore()`)"),T+=". ";let a="";return(f||y)&&(a+=" (found",f&&(a+=` in field ${o}`),y&&(a+=` in document ${u}`),a+=")"),new Pn(Wt.INVALID_ARGUMENT,T+t+a)}function v7(t,e){return t.some(r=>r.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x7{constructor(e,r,o,u,f){this._firestore=e,this._userDataWriter=r,this._key=o,this._document=u,this._converter=f}get id(){return this._key.path.lastSegment()}get ref(){return new Wo(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new bse(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const r=this._document.data.field(jS("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r)}}}class bse extends x7{data(){return super.data()}}function jS(t,e){return typeof e=="string"?FD(t,e):e instanceof FS?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b7(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Pn(Wt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class BD{}class UD extends BD{}function qo(t,e,...r){let o=[];e instanceof BD&&o.push(e),o=o.concat(r),function(f){const y=f.filter(a=>a instanceof VD).length,T=f.filter(a=>a instanceof $S).length;if(y>1||y>0&&T>0)throw new Pn(Wt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(o);for(const u of o)t=u._apply(t);return t}class $S extends UD{constructor(e,r,o){super(),this._field=e,this._op=r,this._value=o,this.type="where"}static _create(e,r,o){return new $S(e,r,o)}_apply(e){const r=this._parse(e);return T7(e._query,r),new Bh(e.firestore,e.converter,AM(e._query,r))}_parse(e){const r=US(e.firestore);return function(f,y,T,a,A,D,O){let B;if(A.isKeyField()){if(D==="array-contains"||D==="array-contains-any")throw new Pn(Wt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${D}' queries on documentId().`);if(D==="in"||D==="not-in"){HB(O,D);const H=[];for(const Q of O)H.push(WB(a,f,Q));B={arrayValue:{values:H}}}else B=WB(a,f,O)}else D!=="in"&&D!=="not-in"&&D!=="array-contains-any"||HB(O,D),B=vse(T,y,O,D==="in"||D==="not-in");return Ws.create(A,D,B)}(e._query,"where",r,e.firestore._databaseId,this._field,this._op,this._value)}}function Di(t,e,r){const o=e,u=jS("where",t);return $S._create(u,o,r)}class VD extends BD{constructor(e,r){super(),this.type=e,this._queryConstraints=r}static _create(e,r){return new VD(e,r)}_parse(e){const r=this._queryConstraints.map(o=>o._parse(e)).filter(o=>o.getFilters().length>0);return r.length===1?r[0]:Cc.create(r,this._getOperator())}_apply(e){const r=this._parse(e);return r.getFilters().length===0?e:(function(u,f){let y=u;const T=f.getFlattenedFilters();for(const a of T)T7(y,a),y=AM(y,a)}(e._query,r),new Bh(e.firestore,e.converter,AM(e._query,r)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class jD extends UD{constructor(e,r){super(),this._field=e,this._direction=r,this.type="orderBy"}static _create(e,r){return new jD(e,r)}_apply(e){const r=function(u,f,y){if(u.startAt!==null)throw new Pn(Wt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(u.endAt!==null)throw new Pn(Wt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new yx(f,y)}(e._query,this._field,this._direction);return new Bh(e.firestore,e.converter,function(u,f){const y=u.explicitOrderBy.concat([f]);return new sy(u.path,u.collectionGroup,y,u.filters.slice(),u.limit,u.limitType,u.startAt,u.endAt)}(e._query,r))}}function yE(t,e="asc"){const r=e,o=jS("orderBy",t);return jD._create(o,r)}class $D extends UD{constructor(e,r,o){super(),this.type=e,this._limit=r,this._limitType=o}static _create(e,r,o){return new $D(e,r,o)}_apply(e){return new Bh(e.firestore,e.converter,dE(e._query,this._limit,this._limitType))}}function w7(t){return use("limit",t),$D._create("limit",t,"F")}function WB(t,e,r){if(typeof(r=Hs(r))=="string"){if(r==="")throw new Pn(Wt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!w9(e)&&r.indexOf("/")!==-1)throw new Pn(Wt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);const o=e.path.child(Hi.fromString(r));if(!er.isDocumentKey(o))throw new Pn(Wt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${o}' is not because it has an odd number of segments (${o.length}).`);return fB(t,new er(o))}if(r instanceof Wo)return fB(t,r._key);throw new Pn(Wt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${LS(r)}.`)}function HB(t,e){if(!Array.isArray(t)||t.length===0)throw new Pn(Wt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function T7(t,e){const r=function(u,f){for(const y of u)for(const T of y.getFlattenedFilters())if(f.indexOf(T.op)>=0)return T.op;return null}(t.filters,function(u){switch(u){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(r!==null)throw r===e.op?new Pn(Wt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Pn(Wt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${r.toString()}' filters.`)}class wse{convertValue(e,r="none"){switch(sm(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Os(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,r);case 5:return e.stringValue;case 6:return this.convertBytes(im(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,r);case 11:return this.convertObject(e.mapValue,r);case 10:return this.convertVectorValue(e.mapValue);default:throw xr()}}convertObject(e,r){return this.convertObjectMap(e.fields,r)}convertObjectMap(e,r="none"){const o={};return _m(e,(u,f)=>{o[u]=this.convertValue(f,r)}),o}convertVectorValue(e){var r,o,u;const f=(u=(o=(r=e.fields)===null||r===void 0?void 0:r.value.arrayValue)===null||o===void 0?void 0:o.values)===null||u===void 0?void 0:u.map(y=>Os(y.doubleValue));return new DD(f)}convertGeoPoint(e){return new kD(Os(e.latitude),Os(e.longitude))}convertArray(e,r){return(e.values||[]).map(o=>this.convertValue(o,r))}convertServerTimestamp(e,r){switch(r){case"previous":const o=aD(e);return o==null?null:this.convertValue(o,r);case"estimate":return this.convertTimestamp(mx(e));default:return null}}convertTimestamp(e){const r=_f(e);return new oo(r.seconds,r.nanos)}convertDocumentKey(e,r){const o=Hi.fromString(e);Oi(G9(o));const u=new gx(o.get(1),o.get(3)),f=new er(o.popFirst(5));return u.isEqual(r)||Mh(`Document ${f} contains a document reference within a different database (${u.projectId}/${u.database}) which is not supported. It will be treated as a reference in the current database (${r.projectId}/${r.database}) instead.`),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E7(t,e,r){let o;return o=t?t.toFirestore(e):e,o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dv{constructor(e,r){this.hasPendingWrites=e,this.fromCache=r}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class S7 extends x7{constructor(e,r,o,u,f,y){super(e,r,o,u,y),this._firestore=e,this._firestoreImpl=e,this.metadata=f}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const r=new mT(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,r={}){if(this._document){const o=this._document.data.field(jS("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,r.serverTimestamps)}}}class mT extends S7{data(e={}){return super.data(e)}}class I7{constructor(e,r,o,u){this._firestore=e,this._userDataWriter=r,this._snapshot=u,this.metadata=new dv(u.hasPendingWrites,u.fromCache),this.query=o}get docs(){const e=[];return this.forEach(r=>e.push(r)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,r){this._snapshot.docs.forEach(o=>{e.call(r,new mT(this._firestore,this._userDataWriter,o.key,o,new dv(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const r=!!e.includeMetadataChanges;if(r&&this._snapshot.excludesMetadataChanges)throw new Pn(Wt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===r||(this._cachedChanges=function(u,f){if(u._snapshot.oldDocs.isEmpty()){let y=0;return u._snapshot.docChanges.map(T=>{const a=new mT(u._firestore,u._userDataWriter,T.doc.key,T.doc,new dv(u._snapshot.mutatedKeys.has(T.doc.key),u._snapshot.fromCache),u.query.converter);return T.doc,{type:"added",doc:a,oldIndex:-1,newIndex:y++}})}{let y=u._snapshot.oldDocs;return u._snapshot.docChanges.filter(T=>f||T.type!==3).map(T=>{const a=new mT(u._firestore,u._userDataWriter,T.doc.key,T.doc,new dv(u._snapshot.mutatedKeys.has(T.doc.key),u._snapshot.fromCache),u.query.converter);let A=-1,D=-1;return T.type!==0&&(A=y.indexOf(T.doc.key),y=y.delete(T.doc.key)),T.type!==1&&(y=y.add(T.doc),D=y.indexOf(T.doc.key)),{type:Tse(T.type),doc:a,oldIndex:A,newIndex:D}})}}(this,r),this._cachedChangesIncludeMetadataChanges=r),this._cachedChanges}}function Tse(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return xr()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function is(t){t=Na(t,Wo);const e=Na(t.firestore,Dh);return ase(NS(e),t._key).then(r=>A7(e,t,r))}class GD extends wse{constructor(e){super(),this.firestore=e}convertBytes(e){return new $_(e)}convertReference(e){const r=this.convertDocumentKey(e,this.firestore._databaseId);return new Wo(this.firestore,null,r)}}function tl(t){t=Na(t,Bh);const e=Na(t.firestore,Dh),r=NS(e),o=new GD(e);return b7(t._query),lse(r,t._query).then(u=>new I7(e,o,t,u))}function gT(t,e,r){t=Na(t,Wo);const o=Na(t.firestore,Dh),u=E7(t.converter,e);return GS(o,[m7(US(o),"setDoc",t._key,u,t.converter!==null,r).toMutation(t._key,Fl.none())])}function io(t,e,r,...o){t=Na(t,Wo);const u=Na(t.firestore,Dh),f=US(u);let y;return y=typeof(e=Hs(e))=="string"||e instanceof FS?yse(f,"updateDoc",t._key,e,r,o):_se(f,"updateDoc",t._key,e),GS(u,[y.toMutation(t._key,Fl.exists(!0))])}function Lv(t){return GS(Na(t.firestore,Dh),[new fD(t._key,Fl.none())])}function zM(t,e){const r=Na(t.firestore,Dh),o=gr(t),u=E7(t.converter,e);return GS(r,[m7(US(t.firestore),"addDoc",o._key,u,t.converter!==null,{}).toMutation(o._key,Fl.exists(!1))]).then(()=>o)}function x_(t,...e){var r,o,u;t=Hs(t);let f={includeMetadataChanges:!1,source:"default"},y=0;typeof e[y]!="object"||qB(e[y])||(f=e[y],y++);const T={includeMetadataChanges:f.includeMetadataChanges,source:f.source};if(qB(e[y])){const O=e[y];e[y]=(r=O.next)===null||r===void 0?void 0:r.bind(O),e[y+1]=(o=O.error)===null||o===void 0?void 0:o.bind(O),e[y+2]=(u=O.complete)===null||u===void 0?void 0:u.bind(O)}let a,A,D;if(t instanceof Wo)A=Na(t.firestore,Dh),D=IS(t._key.path),a={next:O=>{e[y]&&e[y](A7(A,t,O))},error:e[y+1],complete:e[y+2]};else{const O=Na(t,Bh);A=Na(O.firestore,Dh),D=O._query;const B=new GD(A);a={next:H=>{e[y]&&e[y](new I7(A,B,O,H))},error:e[y+1],complete:e[y+2]},b7(t._query)}return function(B,H,Q,re){const se=new MD(re),G=new PD(H,se,Q);return B.asyncQueue.enqueueAndForget(async()=>ID(await gE(B),G)),()=>{se.za(),B.asyncQueue.enqueueAndForget(async()=>AD(await gE(B),G))}}(NS(A),D,T,a)}function GS(t,e){return function(o,u){const f=new wh;return o.asyncQueue.enqueueAndForget(async()=>Zie(await ose(o),u,f)),f.promise}(NS(t),e)}function A7(t,e,r){const o=r.docs.get(e._key),u=new GD(t);return new S7(t,u,e._key,o,new dv(r.hasPendingWrites,r.fromCache),e.converter)}function NM(){return new OD("serverTimestamp")}function zv(...t){return new LD("arrayUnion",t)}function FM(...t){return new zD("arrayRemove",t)}(function(e,r=!0){(function(u){iy=u})(gm),tm(new mf("firestore",(o,{instanceIdentifier:u,options:f})=>{const y=o.getProvider("app").getImmediate(),T=new Dh(new Ane(o.getProvider("auth-internal")),new Mne(o.getProvider("app-check-internal")),function(A,D){if(!Object.prototype.hasOwnProperty.apply(A.options,["projectId"]))throw new Pn(Wt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new gx(A.options.projectId,D)}(y,u),y);return f=Object.assign({useFetchStreams:r},f),T._setSettings(f),T},"PUBLIC").setMultipleInstances(!0)),xu(lB,"4.7.1",e),xu(lB,"4.7.1","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C7="firebasestorage.googleapis.com",P7="storageBucket",Ese=2*60*1e3,Sse=10*60*1e3,Ise=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys extends Pu{constructor(e,r,o=0){super(zP(e),`Firebase Storage: ${r} (${zP(e)})`),this.status_=o,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ys.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return zP(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ki;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Ki||(Ki={}));function zP(t){return"storage/"+t}function qD(){const t="An unknown error occurred, please check the error payload for server response.";return new ys(Ki.UNKNOWN,t)}function Ase(t){return new ys(Ki.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function Cse(t){return new ys(Ki.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Pse(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new ys(Ki.UNAUTHENTICATED,t)}function Rse(){return new ys(Ki.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Mse(t){return new ys(Ki.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function R7(){return new ys(Ki.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function M7(){return new ys(Ki.CANCELED,"User canceled the upload/download.")}function kse(t){return new ys(Ki.INVALID_URL,"Invalid URL '"+t+"'.")}function Dse(t){return new ys(Ki.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function Ose(){return new ys(Ki.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+P7+"' property when initializing the app?")}function k7(){return new ys(Ki.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Lse(){return new ys(Ki.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function zse(){return new ys(Ki.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Nse(t){return new ys(Ki.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function BM(t){return new ys(Ki.INVALID_ARGUMENT,t)}function D7(){return new ys(Ki.APP_DELETED,"The Firebase app was deleted.")}function Fse(t){return new ys(Ki.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Nv(t,e){return new ys(Ki.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Z0(t){throw new ys(Ki.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl{constructor(e,r){this.bucket=e,this.path_=r}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,r){let o;try{o=nl.makeFromUrl(e,r)}catch{return new nl(e,"")}if(o.path==="")return o;throw Dse(e)}static makeFromUrl(e,r){let o=null;const u="([A-Za-z0-9.\\-_]+)";function f(fe){fe.path.charAt(fe.path.length-1)==="/"&&(fe.path_=fe.path_.slice(0,-1))}const y="(/(.*))?$",T=new RegExp("^gs://"+u+y,"i"),a={bucket:1,path:3};function A(fe){fe.path_=decodeURIComponent(fe.path)}const D="v[A-Za-z0-9_]+",O=r.replace(/[.]/g,"\\."),B="(/([^?#]*).*)?$",H=new RegExp(`^https?://${O}/${D}/b/${u}/o${B}`,"i"),Q={bucket:1,path:3},re=r===C7?"(?:storage.googleapis.com|storage.cloud.google.com)":r,se="([^?#]*)",G=new RegExp(`^https?://${re}/${u}/${se}`,"i"),Z=[{regex:T,indices:a,postModify:f},{regex:H,indices:Q,postModify:A},{regex:G,indices:{bucket:1,path:2},postModify:A}];for(let fe=0;fe<Z.length;fe++){const Te=Z[fe],Pe=Te.regex.exec(e);if(Pe){const ce=Pe[Te.indices.bucket];let he=Pe[Te.indices.path];he||(he=""),o=new nl(ce,he),Te.postModify(o);break}}if(o==null)throw kse(e);return o}}class Bse{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Use(t,e,r){let o=1,u=null,f=null,y=!1,T=0;function a(){return T===2}let A=!1;function D(...se){A||(A=!0,e.apply(null,se))}function O(se){u=setTimeout(()=>{u=null,t(H,a())},se)}function B(){f&&clearTimeout(f)}function H(se,...G){if(A){B();return}if(se){B(),D.call(null,se,...G);return}if(a()||y){B(),D.call(null,se,...G);return}o<64&&(o*=2);let Z;T===1?(T=2,Z=0):Z=(o+Math.random())*1e3,O(Z)}let Q=!1;function re(se){Q||(Q=!0,B(),!A&&(u!==null?(se||(T=2),clearTimeout(u),O(0)):se||(T=1)))}return O(0),f=setTimeout(()=>{y=!0,re(!0)},r),re}function Vse(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jse(t){return t!==void 0}function $se(t){return typeof t=="function"}function Gse(t){return typeof t=="object"&&!Array.isArray(t)}function qS(t){return typeof t=="string"||t instanceof String}function ZB(t){return WD()&&t instanceof Blob}function WD(){return typeof Blob<"u"}function XB(t,e,r,o){if(o<e)throw BM(`Invalid value for '${t}'. Expected ${e} or greater.`);if(o>r)throw BM(`Invalid value for '${t}'. Expected ${r} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t1(t,e,r){let o=e;return r==null&&(o=`https://${e}`),`${r}://${o}/v0${t}`}function O7(t){const e=encodeURIComponent;let r="?";for(const o in t)if(t.hasOwnProperty(o)){const u=e(o)+"="+e(t[o]);r=r+u+"&"}return r=r.slice(0,-1),r}var Gp;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(Gp||(Gp={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L7(t,e){const r=t>=500&&t<600,u=[408,429].indexOf(t)!==-1,f=e.indexOf(t)!==-1;return r||u||f}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qse{constructor(e,r,o,u,f,y,T,a,A,D,O,B=!0){this.url_=e,this.method_=r,this.headers_=o,this.body_=u,this.successCodes_=f,this.additionalRetryCodes_=y,this.callback_=T,this.errorCallback_=a,this.timeout_=A,this.progressCallback_=D,this.connectionFactory_=O,this.retry=B,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((H,Q)=>{this.resolve_=H,this.reject_=Q,this.start_()})}start_(){const e=(o,u)=>{if(u){o(!1,new kw(!1,null,!0));return}const f=this.connectionFactory_();this.pendingConnection_=f;const y=T=>{const a=T.loaded,A=T.lengthComputable?T.total:-1;this.progressCallback_!==null&&this.progressCallback_(a,A)};this.progressCallback_!==null&&f.addUploadProgressListener(y),f.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&f.removeUploadProgressListener(y),this.pendingConnection_=null;const T=f.getErrorCode()===Gp.NO_ERROR,a=f.getStatus();if(!T||L7(a,this.additionalRetryCodes_)&&this.retry){const D=f.getErrorCode()===Gp.ABORT;o(!1,new kw(!1,null,D));return}const A=this.successCodes_.indexOf(a)!==-1;o(!0,new kw(A,f))})},r=(o,u)=>{const f=this.resolve_,y=this.reject_,T=u.connection;if(u.wasSuccessCode)try{const a=this.callback_(T,T.getResponse());jse(a)?f(a):f()}catch(a){y(a)}else if(T!==null){const a=qD();a.serverResponse=T.getErrorText(),this.errorCallback_?y(this.errorCallback_(T,a)):y(a)}else if(u.canceled){const a=this.appDelete_?D7():M7();y(a)}else{const a=R7();y(a)}};this.canceled_?r(!1,new kw(!1,null,!0)):this.backoffId_=Use(e,r,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Vse(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class kw{constructor(e,r,o){this.wasSuccessCode=e,this.connection=r,this.canceled=!!o}}function Wse(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function Hse(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function Zse(t,e){e&&(t["X-Firebase-GMPID"]=e)}function Xse(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function Kse(t,e,r,o,u,f,y=!0){const T=O7(t.urlParams),a=t.url+T,A=Object.assign({},t.headers);return Zse(A,e),Wse(A,r),Hse(A,f),Xse(A,o),new qse(a,t.method,A,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,u,y)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yse(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function Qse(...t){const e=Yse();if(e!==void 0){const r=new e;for(let o=0;o<t.length;o++)r.append(t[o]);return r.getBlob()}else{if(WD())return new Blob(t);throw new ys(Ki.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function Jse(t,e,r){return t.webkitSlice?t.webkitSlice(e,r):t.mozSlice?t.mozSlice(e,r):t.slice?t.slice(e,r):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eoe(t){if(typeof atob>"u")throw Nse("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mu={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class NP{constructor(e,r){this.data=e,this.contentType=r||null}}function toe(t,e){switch(t){case mu.RAW:return new NP(z7(e));case mu.BASE64:case mu.BASE64URL:return new NP(N7(t,e));case mu.DATA_URL:return new NP(roe(e),ioe(e))}throw qD()}function z7(t){const e=[];for(let r=0;r<t.length;r++){let o=t.charCodeAt(r);if(o<=127)e.push(o);else if(o<=2047)e.push(192|o>>6,128|o&63);else if((o&64512)===55296)if(!(r<t.length-1&&(t.charCodeAt(r+1)&64512)===56320))e.push(239,191,189);else{const f=o,y=t.charCodeAt(++r);o=65536|(f&1023)<<10|y&1023,e.push(240|o>>18,128|o>>12&63,128|o>>6&63,128|o&63)}else(o&64512)===56320?e.push(239,191,189):e.push(224|o>>12,128|o>>6&63,128|o&63)}return new Uint8Array(e)}function noe(t){let e;try{e=decodeURIComponent(t)}catch{throw Nv(mu.DATA_URL,"Malformed data URL.")}return z7(e)}function N7(t,e){switch(t){case mu.BASE64:{const u=e.indexOf("-")!==-1,f=e.indexOf("_")!==-1;if(u||f)throw Nv(t,"Invalid character '"+(u?"-":"_")+"' found: is it base64url encoded?");break}case mu.BASE64URL:{const u=e.indexOf("+")!==-1,f=e.indexOf("/")!==-1;if(u||f)throw Nv(t,"Invalid character '"+(u?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let r;try{r=eoe(e)}catch(u){throw u.message.includes("polyfill")?u:Nv(t,"Invalid character found")}const o=new Uint8Array(r.length);for(let u=0;u<r.length;u++)o[u]=r.charCodeAt(u);return o}class F7{constructor(e){this.base64=!1,this.contentType=null;const r=e.match(/^data:([^,]+)?,/);if(r===null)throw Nv(mu.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const o=r[1]||null;o!=null&&(this.base64=soe(o,";base64"),this.contentType=this.base64?o.substring(0,o.length-7):o),this.rest=e.substring(e.indexOf(",")+1)}}function roe(t){const e=new F7(t);return e.base64?N7(mu.BASE64,e.rest):noe(e.rest)}function ioe(t){return new F7(t).contentType}function soe(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gd{constructor(e,r){let o=0,u="";ZB(e)?(this.data_=e,o=e.size,u=e.type):e instanceof ArrayBuffer?(r?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),o=this.data_.length):e instanceof Uint8Array&&(r?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),o=e.length),this.size_=o,this.type_=u}size(){return this.size_}type(){return this.type_}slice(e,r){if(ZB(this.data_)){const o=this.data_,u=Jse(o,e,r);return u===null?null:new Gd(u)}else{const o=new Uint8Array(this.data_.buffer,e,r-e);return new Gd(o,!0)}}static getBlob(...e){if(WD()){const r=e.map(o=>o instanceof Gd?o.data_:o);return new Gd(Qse.apply(null,r))}else{const r=e.map(y=>qS(y)?toe(mu.RAW,y).data:y.data_);let o=0;r.forEach(y=>{o+=y.byteLength});const u=new Uint8Array(o);let f=0;return r.forEach(y=>{for(let T=0;T<y.length;T++)u[f++]=y[T]}),new Gd(u,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B7(t){let e;try{e=JSON.parse(t)}catch{return null}return Gse(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ooe(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function aoe(t,e){const r=e.split("/").filter(o=>o.length>0).join("/");return t.length===0?r:t+"/"+r}function U7(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function loe(t,e){return e}class ha{constructor(e,r,o,u){this.server=e,this.local=r||e,this.writable=!!o,this.xform=u||loe}}let Dw=null;function coe(t){return!qS(t)||t.length<2?t:U7(t)}function V7(){if(Dw)return Dw;const t=[];t.push(new ha("bucket")),t.push(new ha("generation")),t.push(new ha("metageneration")),t.push(new ha("name","fullPath",!0));function e(f,y){return coe(y)}const r=new ha("name");r.xform=e,t.push(r);function o(f,y){return y!==void 0?Number(y):y}const u=new ha("size");return u.xform=o,t.push(u),t.push(new ha("timeCreated")),t.push(new ha("updated")),t.push(new ha("md5Hash",null,!0)),t.push(new ha("cacheControl",null,!0)),t.push(new ha("contentDisposition",null,!0)),t.push(new ha("contentEncoding",null,!0)),t.push(new ha("contentLanguage",null,!0)),t.push(new ha("contentType",null,!0)),t.push(new ha("metadata","customMetadata",!0)),Dw=t,Dw}function uoe(t,e){function r(){const o=t.bucket,u=t.fullPath,f=new nl(o,u);return e._makeStorageReference(f)}Object.defineProperty(t,"ref",{get:r})}function hoe(t,e,r){const o={};o.type="file";const u=r.length;for(let f=0;f<u;f++){const y=r[f];o[y.local]=y.xform(o,e[y.server])}return uoe(o,t),o}function j7(t,e,r){const o=B7(e);return o===null?null:hoe(t,o,r)}function doe(t,e,r,o){const u=B7(e);if(u===null||!qS(u.downloadTokens))return null;const f=u.downloadTokens;if(f.length===0)return null;const y=encodeURIComponent;return f.split(",").map(A=>{const D=t.bucket,O=t.fullPath,B="/b/"+y(D)+"/o/"+y(O),H=t1(B,r,o),Q=O7({alt:"media",token:A});return H+Q})[0]}function $7(t,e){const r={},o=e.length;for(let u=0;u<o;u++){const f=e[u];f.writable&&(r[f.server]=t[f.local])}return JSON.stringify(r)}class cy{constructor(e,r,o,u){this.url=e,this.method=r,this.handler=o,this.timeout=u,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Th(t){if(!t)throw qD()}function HD(t,e){function r(o,u){const f=j7(t,u,e);return Th(f!==null),f}return r}function foe(t,e){function r(o,u){const f=j7(t,u,e);return Th(f!==null),doe(f,u,t.host,t._protocol)}return r}function n1(t){function e(r,o){let u;return r.getStatus()===401?r.getErrorText().includes("Firebase App Check token is invalid")?u=Rse():u=Pse():r.getStatus()===402?u=Cse(t.bucket):r.getStatus()===403?u=Mse(t.path):u=o,u.status=r.getStatus(),u.serverResponse=o.serverResponse,u}return e}function G7(t){const e=n1(t);function r(o,u){let f=e(o,u);return o.getStatus()===404&&(f=Ase(t.path)),f.serverResponse=u.serverResponse,f}return r}function poe(t,e,r){const o=e.fullServerUrl(),u=t1(o,t.host,t._protocol),f="GET",y=t.maxOperationRetryTime,T=new cy(u,f,HD(t,r),y);return T.errorHandler=G7(e),T}function moe(t,e,r){const o=e.fullServerUrl(),u=t1(o,t.host,t._protocol),f="GET",y=t.maxOperationRetryTime,T=new cy(u,f,foe(t,r),y);return T.errorHandler=G7(e),T}function goe(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function q7(t,e,r){const o=Object.assign({},r);return o.fullPath=t.path,o.size=e.size(),o.contentType||(o.contentType=goe(null,e)),o}function _oe(t,e,r,o,u){const f=e.bucketOnlyServerUrl(),y={"X-Goog-Upload-Protocol":"multipart"};function T(){let Z="";for(let fe=0;fe<2;fe++)Z=Z+Math.random().toString().slice(2);return Z}const a=T();y["Content-Type"]="multipart/related; boundary="+a;const A=q7(e,o,u),D=$7(A,r),O="--"+a+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+D+`\r
--`+a+`\r
Content-Type: `+A.contentType+`\r
\r
`,B=`\r
--`+a+"--",H=Gd.getBlob(O,o,B);if(H===null)throw k7();const Q={name:A.fullPath},re=t1(f,t.host,t._protocol),se="POST",G=t.maxUploadRetryTime,Y=new cy(re,se,HD(t,r),G);return Y.urlParams=Q,Y.headers=y,Y.body=H.uploadData(),Y.errorHandler=n1(e),Y}class vE{constructor(e,r,o,u){this.current=e,this.total=r,this.finalized=!!o,this.metadata=u||null}}function ZD(t,e){let r=null;try{r=t.getResponseHeader("X-Goog-Upload-Status")}catch{Th(!1)}return Th(!!r&&(e||["active"]).indexOf(r)!==-1),r}function yoe(t,e,r,o,u){const f=e.bucketOnlyServerUrl(),y=q7(e,o,u),T={name:y.fullPath},a=t1(f,t.host,t._protocol),A="POST",D={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${o.size()}`,"X-Goog-Upload-Header-Content-Type":y.contentType,"Content-Type":"application/json; charset=utf-8"},O=$7(y,r),B=t.maxUploadRetryTime;function H(re){ZD(re);let se;try{se=re.getResponseHeader("X-Goog-Upload-URL")}catch{Th(!1)}return Th(qS(se)),se}const Q=new cy(a,A,H,B);return Q.urlParams=T,Q.headers=D,Q.body=O,Q.errorHandler=n1(e),Q}function voe(t,e,r,o){const u={"X-Goog-Upload-Command":"query"};function f(A){const D=ZD(A,["active","final"]);let O=null;try{O=A.getResponseHeader("X-Goog-Upload-Size-Received")}catch{Th(!1)}O||Th(!1);const B=Number(O);return Th(!isNaN(B)),new vE(B,o.size(),D==="final")}const y="POST",T=t.maxUploadRetryTime,a=new cy(r,y,f,T);return a.headers=u,a.errorHandler=n1(e),a}const KB=256*1024;function xoe(t,e,r,o,u,f,y,T){const a=new vE(0,0);if(y?(a.current=y.current,a.total=y.total):(a.current=0,a.total=o.size()),o.size()!==a.total)throw Lse();const A=a.total-a.current;let D=A;u>0&&(D=Math.min(D,u));const O=a.current,B=O+D;let H="";D===0?H="finalize":A===D?H="upload, finalize":H="upload";const Q={"X-Goog-Upload-Command":H,"X-Goog-Upload-Offset":`${a.current}`},re=o.slice(O,B);if(re===null)throw k7();function se(fe,Te){const Pe=ZD(fe,["active","final"]),ce=a.current+D,he=o.size();let W;return Pe==="final"?W=HD(e,f)(fe,Te):W=null,new vE(ce,he,Pe==="final",W)}const G="POST",Y=e.maxUploadRetryTime,Z=new cy(r,G,se,Y);return Z.headers=Q,Z.body=re.uploadData(),Z.progressCallback=T||null,Z.errorHandler=n1(t),Z}const Aa={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function FP(t){switch(t){case"running":case"pausing":case"canceling":return Aa.RUNNING;case"paused":return Aa.PAUSED;case"success":return Aa.SUCCESS;case"canceled":return Aa.CANCELED;case"error":return Aa.ERROR;default:return Aa.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class boe{constructor(e,r,o){if($se(e)||r!=null||o!=null)this.next=e,this.error=r??void 0,this.complete=o??void 0;else{const f=e;this.next=f.next,this.error=f.error,this.complete=f.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mg(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class woe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Gp.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Gp.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Gp.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,r,o,u){if(this.sent_)throw Z0("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(r,e,!0),u!==void 0)for(const f in u)u.hasOwnProperty(f)&&this.xhr_.setRequestHeader(f,u[f].toString());return o!==void 0?this.xhr_.send(o):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Z0("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Z0("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Z0("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Z0("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class Toe extends woe{initXhr(){this.xhr_.responseType="text"}}function Gg(){return new Toe}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eoe{constructor(e,r,o=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=r,this._metadata=o,this._mappings=V7(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=u=>{if(this._request=void 0,this._chunkMultiplier=1,u._codeEquals(Ki.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const f=this.isExponentialBackoffExpired();if(L7(u.status,[]))if(f)u=R7();else{this.sleepTime=Math.max(this.sleepTime*2,Ise),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=u,this._transition("error")}},this._metadataErrorHandler=u=>{this._request=void 0,u._codeEquals(Ki.CANCELED)?this.completeTransitions_():(this._error=u,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((u,f)=>{this._resolve=u,this._reject=f,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return r=>this._updateProgress(e+r)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([r,o])=>{switch(this._state){case"running":e(r,o);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,r)=>{const o=yoe(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),u=this._ref.storage._makeRequest(o,Gg,e,r);this._request=u,u.getPromise().then(f=>{this._request=void 0,this._uploadUrl=f,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((r,o)=>{const u=voe(this._ref.storage,this._ref._location,e,this._blob),f=this._ref.storage._makeRequest(u,Gg,r,o);this._request=f,f.getPromise().then(y=>{y=y,this._request=void 0,this._updateProgress(y.current),this._needToFetchStatus=!1,y.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=KB*this._chunkMultiplier,r=new vE(this._transferred,this._blob.size()),o=this._uploadUrl;this._resolveToken((u,f)=>{let y;try{y=xoe(this._ref._location,this._ref.storage,o,this._blob,e,this._mappings,r,this._makeProgressCallback())}catch(a){this._error=a,this._transition("error");return}const T=this._ref.storage._makeRequest(y,Gg,u,f,!1);this._request=T,T.getPromise().then(a=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(a.current),a.finalized?(this._metadata=a.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){KB*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,r)=>{const o=poe(this._ref.storage,this._ref._location,this._mappings),u=this._ref.storage._makeRequest(o,Gg,e,r);this._request=u,u.getPromise().then(f=>{this._request=void 0,this._metadata=f,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,r)=>{const o=_oe(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),u=this._ref.storage._makeRequest(o,Gg,e,r);this._request=u,u.getPromise().then(f=>{this._request=void 0,this._metadata=f,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const r=this._transferred;this._transferred=e,this._transferred!==r&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const r=this._state==="paused";this._state=e,r&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=M7(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=FP(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,r,o,u){const f=new boe(r||void 0,o||void 0,u||void 0);return this._addObserver(f),()=>{this._removeObserver(f)}}then(e,r){return this._promise.then(e,r)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const r=this._observers.indexOf(e);r!==-1&&this._observers.splice(r,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(r=>{this._notifyObserver(r)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(FP(this._state)){case Aa.SUCCESS:Mg(this._resolve.bind(null,this.snapshot))();break;case Aa.CANCELED:case Aa.ERROR:const r=this._reject;Mg(r.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(FP(this._state)){case Aa.RUNNING:case Aa.PAUSED:e.next&&Mg(e.next.bind(e,this.snapshot))();break;case Aa.SUCCESS:e.complete&&Mg(e.complete.bind(e))();break;case Aa.CANCELED:case Aa.ERROR:e.error&&Mg(e.error.bind(e,this._error))();break;default:e.error&&Mg(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class om{constructor(e,r){this._service=e,r instanceof nl?this._location=r:this._location=nl.makeFromUrl(r,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,r){return new om(e,r)}get root(){const e=new nl(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return U7(this._location.path)}get storage(){return this._service}get parent(){const e=ooe(this._location.path);if(e===null)return null;const r=new nl(this._location.bucket,e);return new om(this._service,r)}_throwIfRoot(e){if(this._location.path==="")throw Fse(e)}}function Soe(t,e,r){return t._throwIfRoot("uploadBytesResumable"),new Eoe(t,new Gd(e),r)}function Ioe(t){t._throwIfRoot("getDownloadURL");const e=moe(t.storage,t._location,V7());return t.storage.makeRequestWithTokens(e,Gg).then(r=>{if(r===null)throw zse();return r})}function Aoe(t,e){const r=aoe(t._location.path,e),o=new nl(t._location.bucket,r);return new om(t.storage,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Coe(t){return/^[A-Za-z]+:\/\//.test(t)}function Poe(t,e){return new om(t,e)}function W7(t,e){if(t instanceof XD){const r=t;if(r._bucket==null)throw Ose();const o=new om(r,r._bucket);return e!=null?W7(o,e):o}else return e!==void 0?Aoe(t,e):t}function Roe(t,e){if(e&&Coe(e)){if(t instanceof XD)return Poe(t,e);throw BM("To use ref(service, url), the first argument must be a Storage instance.")}else return W7(t,e)}function YB(t,e){const r=e==null?void 0:e[P7];return r==null?null:nl.makeFromBucketSpec(r,t)}function Moe(t,e,r,o={}){t.host=`${e}:${r}`,t._protocol="http";const{mockUserToken:u}=o;u&&(t._overrideAuthToken=typeof u=="string"?u:x8(u,t.app.options.projectId))}class XD{constructor(e,r,o,u,f){this.app=e,this._authProvider=r,this._appCheckProvider=o,this._url=u,this._firebaseVersion=f,this._bucket=null,this._host=C7,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Ese,this._maxUploadRetryTime=Sse,this._requests=new Set,u!=null?this._bucket=nl.makeFromBucketSpec(u,this._host):this._bucket=YB(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=nl.makeFromBucketSpec(this._url,e):this._bucket=YB(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){XB("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){XB("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const r=await e.getToken();if(r!==null)return r.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new om(this,e)}_makeRequest(e,r,o,u,f=!0){if(this._deleted)return new Bse(D7());{const y=Kse(e,this._appId,o,u,r,this._firebaseVersion,f);return this._requests.add(y),y.getPromise().then(()=>this._requests.delete(y),()=>this._requests.delete(y)),y}}async makeRequestWithTokens(e,r){const[o,u]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,r,o,u).getPromise()}}const QB="@firebase/storage",JB="0.13.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H7="storage";function koe(t,e,r){return t=Hs(t),Soe(t,e,r)}function Doe(t){return t=Hs(t),Ioe(t)}function Ooe(t,e){return t=Hs(t),Roe(t,e)}function Z7(t=H3(),e){t=Hs(t);const o=wS(t,H7).getImmediate({identifier:e}),u=_8("storage");return u&&Loe(o,...u),o}function Loe(t,e,r,o={}){Moe(t,e,r,o)}function zoe(t,{instanceIdentifier:e}){const r=t.getProvider("app").getImmediate(),o=t.getProvider("auth-internal"),u=t.getProvider("app-check-internal");return new XD(r,o,u,e,gm)}function Noe(){tm(new mf(H7,zoe,"PUBLIC").setMultipleInstances(!0)),xu(QB,JB,""),xu(QB,JB,"esm2017")}Noe();const Foe={apiKey:"AIzaSyBcfSX72wkSxZ7cPGaWrkJ7OreAjYmuCOo",authDomain:"quests-backup.firebaseapp.com",projectId:"quests-backup",storageBucket:"quests-backup.appspot.com",messagingSenderId:"512930742831",appId:"1:512930742831:web:cd58945dd92b3a4e6e3cda",measurementId:"G-EB4H740XB0"},KD=T8(Foe),Xt=Tne(KD),Rn=fse(KD);Z7(KD);new ph;const Boe=async t=>{const e=Z7(),r=Ooe(e,`profile_photos/${Xt.currentUser.uid}`),o=koe(r,t);return new Promise((u,f)=>{o.on("state_changed",y=>{},y=>{console.error("Error uploading image:",y),f(y)},async()=>{try{const y=await Doe(o.snapshot.ref);u(y)}catch(y){console.error("Error getting download URL:",y),f(y)}})})},eU=async(t,e)=>{try{console.log("Updating user profile:",t,e),await io(gr(Rn,"users",t),e),console.log("User profile updated successfully")}catch(r){console.error("Error updating user profile:",r)}},Fv=async t=>{try{const e=await is(gr(Rn,"users",t));if(e.exists())return e.data();console.log("No such document!")}catch(e){console.error("Error fetching user data:",e)}},xx={black:"#000",white:"#fff"},kg={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},Dg={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},Og={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},Lg={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},zg={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},X0={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},Uoe={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"};function Oh(t){let e="https://mui.com/production-error/?code="+t;for(let r=1;r<arguments.length;r+=1)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified MUI error #"+t+"; visit "+e+" for the full message."}const WS="$$material";function xE(){return xE=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)({}).hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},xE.apply(null,arguments)}function X7(t){var e=Object.create(null);return function(r){return e[r]===void 0&&(e[r]=t(r)),e[r]}}var Voe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,joe=X7(function(t){return Voe.test(t)||t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)<91}),$oe=!1;function Goe(t){if(t.sheet)return t.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===t)return document.styleSheets[e]}function qoe(t){var e=document.createElement("style");return e.setAttribute("data-emotion",t.key),t.nonce!==void 0&&e.setAttribute("nonce",t.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var Woe=function(){function t(r){var o=this;this._insertTag=function(u){var f;o.tags.length===0?o.insertionPoint?f=o.insertionPoint.nextSibling:o.prepend?f=o.container.firstChild:f=o.before:f=o.tags[o.tags.length-1].nextSibling,o.container.insertBefore(u,f),o.tags.push(u)},this.isSpeedy=r.speedy===void 0?!$oe:r.speedy,this.tags=[],this.ctr=0,this.nonce=r.nonce,this.key=r.key,this.container=r.container,this.prepend=r.prepend,this.insertionPoint=r.insertionPoint,this.before=null}var e=t.prototype;return e.hydrate=function(o){o.forEach(this._insertTag)},e.insert=function(o){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(qoe(this));var u=this.tags[this.tags.length-1];if(this.isSpeedy){var f=Goe(u);try{f.insertRule(o,f.cssRules.length)}catch{}}else u.appendChild(document.createTextNode(o));this.ctr++},e.flush=function(){this.tags.forEach(function(o){var u;return(u=o.parentNode)==null?void 0:u.removeChild(o)}),this.tags=[],this.ctr=0},t}(),Vo="-ms-",bE="-moz-",ui="-webkit-",K7="comm",YD="rule",QD="decl",Hoe="@import",Y7="@keyframes",Zoe="@layer",Xoe=Math.abs,HS=String.fromCharCode,Koe=Object.assign;function Yoe(t,e){return To(t,0)^45?(((e<<2^To(t,0))<<2^To(t,1))<<2^To(t,2))<<2^To(t,3):0}function Q7(t){return t.trim()}function Qoe(t,e){return(t=e.exec(t))?t[0]:t}function hi(t,e,r){return t.replace(e,r)}function UM(t,e){return t.indexOf(e)}function To(t,e){return t.charCodeAt(e)|0}function bx(t,e,r){return t.slice(e,r)}function cu(t){return t.length}function JD(t){return t.length}function Ow(t,e){return e.push(t),t}function Joe(t,e){return t.map(e).join("")}var ZS=1,G_=1,J7=0,Fa=0,$s=0,uy="";function XS(t,e,r,o,u,f,y){return{value:t,root:e,parent:r,type:o,props:u,children:f,line:ZS,column:G_,length:y,return:""}}function K0(t,e){return Koe(XS("",null,null,"",null,null,0),t,{length:-t.length},e)}function eae(){return $s}function tae(){return $s=Fa>0?To(uy,--Fa):0,G_--,$s===10&&(G_=1,ZS--),$s}function sl(){return $s=Fa<J7?To(uy,Fa++):0,G_++,$s===10&&(G_=1,ZS++),$s}function Su(){return To(uy,Fa)}function _T(){return Fa}function r1(t,e){return bx(uy,t,e)}function wx(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function eG(t){return ZS=G_=1,J7=cu(uy=t),Fa=0,[]}function tG(t){return uy="",t}function yT(t){return Q7(r1(Fa-1,VM(t===91?t+2:t===40?t+1:t)))}function nae(t){for(;($s=Su())&&$s<33;)sl();return wx(t)>2||wx($s)>3?"":" "}function rae(t,e){for(;--e&&sl()&&!($s<48||$s>102||$s>57&&$s<65||$s>70&&$s<97););return r1(t,_T()+(e<6&&Su()==32&&sl()==32))}function VM(t){for(;sl();)switch($s){case t:return Fa;case 34:case 39:t!==34&&t!==39&&VM($s);break;case 40:t===41&&VM(t);break;case 92:sl();break}return Fa}function iae(t,e){for(;sl()&&t+$s!==57;)if(t+$s===84&&Su()===47)break;return"/*"+r1(e,Fa-1)+"*"+HS(t===47?t:sl())}function sae(t){for(;!wx(Su());)sl();return r1(t,Fa)}function oae(t){return tG(vT("",null,null,null,[""],t=eG(t),0,[0],t))}function vT(t,e,r,o,u,f,y,T,a){for(var A=0,D=0,O=y,B=0,H=0,Q=0,re=1,se=1,G=1,Y=0,Z="",fe=u,Te=f,Pe=o,ce=Z;se;)switch(Q=Y,Y=sl()){case 40:if(Q!=108&&To(ce,O-1)==58){UM(ce+=hi(yT(Y),"&","&\f"),"&\f")!=-1&&(G=-1);break}case 34:case 39:case 91:ce+=yT(Y);break;case 9:case 10:case 13:case 32:ce+=nae(Q);break;case 92:ce+=rae(_T()-1,7);continue;case 47:switch(Su()){case 42:case 47:Ow(aae(iae(sl(),_T()),e,r),a);break;default:ce+="/"}break;case 123*re:T[A++]=cu(ce)*G;case 125*re:case 59:case 0:switch(Y){case 0:case 125:se=0;case 59+D:G==-1&&(ce=hi(ce,/\f/g,"")),H>0&&cu(ce)-O&&Ow(H>32?nU(ce+";",o,r,O-1):nU(hi(ce," ","")+";",o,r,O-2),a);break;case 59:ce+=";";default:if(Ow(Pe=tU(ce,e,r,A,D,u,T,Z,fe=[],Te=[],O),f),Y===123)if(D===0)vT(ce,e,Pe,Pe,fe,f,O,T,Te);else switch(B===99&&To(ce,3)===110?100:B){case 100:case 108:case 109:case 115:vT(t,Pe,Pe,o&&Ow(tU(t,Pe,Pe,0,0,u,T,Z,u,fe=[],O),Te),u,Te,O,T,o?fe:Te);break;default:vT(ce,Pe,Pe,Pe,[""],Te,0,T,Te)}}A=D=H=0,re=G=1,Z=ce="",O=y;break;case 58:O=1+cu(ce),H=Q;default:if(re<1){if(Y==123)--re;else if(Y==125&&re++==0&&tae()==125)continue}switch(ce+=HS(Y),Y*re){case 38:G=D>0?1:(ce+="\f",-1);break;case 44:T[A++]=(cu(ce)-1)*G,G=1;break;case 64:Su()===45&&(ce+=yT(sl())),B=Su(),D=O=cu(Z=ce+=sae(_T())),Y++;break;case 45:Q===45&&cu(ce)==2&&(re=0)}}return f}function tU(t,e,r,o,u,f,y,T,a,A,D){for(var O=u-1,B=u===0?f:[""],H=JD(B),Q=0,re=0,se=0;Q<o;++Q)for(var G=0,Y=bx(t,O+1,O=Xoe(re=y[Q])),Z=t;G<H;++G)(Z=Q7(re>0?B[G]+" "+Y:hi(Y,/&\f/g,B[G])))&&(a[se++]=Z);return XS(t,e,r,u===0?YD:T,a,A,D)}function aae(t,e,r){return XS(t,e,r,K7,HS(eae()),bx(t,2,-2),0)}function nU(t,e,r,o){return XS(t,e,r,QD,bx(t,0,o),bx(t,o+1,-1),o)}function b_(t,e){for(var r="",o=JD(t),u=0;u<o;u++)r+=e(t[u],u,t,e)||"";return r}function lae(t,e,r,o){switch(t.type){case Zoe:if(t.children.length)break;case Hoe:case QD:return t.return=t.return||t.value;case K7:return"";case Y7:return t.return=t.value+"{"+b_(t.children,o)+"}";case YD:t.value=t.props.join(",")}return cu(r=b_(t.children,o))?t.return=t.value+"{"+r+"}":""}function cae(t){var e=JD(t);return function(r,o,u,f){for(var y="",T=0;T<e;T++)y+=t[T](r,o,u,f)||"";return y}}function uae(t){return function(e){e.root||(e=e.return)&&t(e)}}var hae=function(e,r,o){for(var u=0,f=0;u=f,f=Su(),u===38&&f===12&&(r[o]=1),!wx(f);)sl();return r1(e,Fa)},dae=function(e,r){var o=-1,u=44;do switch(wx(u)){case 0:u===38&&Su()===12&&(r[o]=1),e[o]+=hae(Fa-1,r,o);break;case 2:e[o]+=yT(u);break;case 4:if(u===44){e[++o]=Su()===58?"&\f":"",r[o]=e[o].length;break}default:e[o]+=HS(u)}while(u=sl());return e},fae=function(e,r){return tG(dae(eG(e),r))},rU=new WeakMap,pae=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var r=e.value,o=e.parent,u=e.column===o.column&&e.line===o.line;o.type!=="rule";)if(o=o.parent,!o)return;if(!(e.props.length===1&&r.charCodeAt(0)!==58&&!rU.get(o))&&!u){rU.set(e,!0);for(var f=[],y=fae(r,f),T=o.props,a=0,A=0;a<y.length;a++)for(var D=0;D<T.length;D++,A++)e.props[A]=f[a]?y[a].replace(/&\f/g,T[D]):T[D]+" "+y[a]}}},mae=function(e){if(e.type==="decl"){var r=e.value;r.charCodeAt(0)===108&&r.charCodeAt(2)===98&&(e.return="",e.value="")}};function nG(t,e){switch(Yoe(t,e)){case 5103:return ui+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return ui+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return ui+t+bE+t+Vo+t+t;case 6828:case 4268:return ui+t+Vo+t+t;case 6165:return ui+t+Vo+"flex-"+t+t;case 5187:return ui+t+hi(t,/(\w+).+(:[^]+)/,ui+"box-$1$2"+Vo+"flex-$1$2")+t;case 5443:return ui+t+Vo+"flex-item-"+hi(t,/flex-|-self/,"")+t;case 4675:return ui+t+Vo+"flex-line-pack"+hi(t,/align-content|flex-|-self/,"")+t;case 5548:return ui+t+Vo+hi(t,"shrink","negative")+t;case 5292:return ui+t+Vo+hi(t,"basis","preferred-size")+t;case 6060:return ui+"box-"+hi(t,"-grow","")+ui+t+Vo+hi(t,"grow","positive")+t;case 4554:return ui+hi(t,/([^-])(transform)/g,"$1"+ui+"$2")+t;case 6187:return hi(hi(hi(t,/(zoom-|grab)/,ui+"$1"),/(image-set)/,ui+"$1"),t,"")+t;case 5495:case 3959:return hi(t,/(image-set\([^]*)/,ui+"$1$`$1");case 4968:return hi(hi(t,/(.+:)(flex-)?(.*)/,ui+"box-pack:$3"+Vo+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+ui+t+t;case 4095:case 3583:case 4068:case 2532:return hi(t,/(.+)-inline(.+)/,ui+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(cu(t)-1-e>6)switch(To(t,e+1)){case 109:if(To(t,e+4)!==45)break;case 102:return hi(t,/(.+:)(.+)-([^]+)/,"$1"+ui+"$2-$3$1"+bE+(To(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~UM(t,"stretch")?nG(hi(t,"stretch","fill-available"),e)+t:t}break;case 4949:if(To(t,e+1)!==115)break;case 6444:switch(To(t,cu(t)-3-(~UM(t,"!important")&&10))){case 107:return hi(t,":",":"+ui)+t;case 101:return hi(t,/(.+:)([^;!]+)(;|!.+)?/,"$1"+ui+(To(t,14)===45?"inline-":"")+"box$3$1"+ui+"$2$3$1"+Vo+"$2box$3")+t}break;case 5936:switch(To(t,e+11)){case 114:return ui+t+Vo+hi(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return ui+t+Vo+hi(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return ui+t+Vo+hi(t,/[svh]\w+-[tblr]{2}/,"lr")+t}return ui+t+Vo+t+t}return t}var gae=function(e,r,o,u){if(e.length>-1&&!e.return)switch(e.type){case QD:e.return=nG(e.value,e.length);break;case Y7:return b_([K0(e,{value:hi(e.value,"@","@"+ui)})],u);case YD:if(e.length)return Joe(e.props,function(f){switch(Qoe(f,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return b_([K0(e,{props:[hi(f,/:(read-\w+)/,":"+bE+"$1")]})],u);case"::placeholder":return b_([K0(e,{props:[hi(f,/:(plac\w+)/,":"+ui+"input-$1")]}),K0(e,{props:[hi(f,/:(plac\w+)/,":"+bE+"$1")]}),K0(e,{props:[hi(f,/:(plac\w+)/,Vo+"input-$1")]})],u)}return""})}},_ae=[gae],yae=function(e){var r=e.key;if(r==="css"){var o=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(o,function(re){var se=re.getAttribute("data-emotion");se.indexOf(" ")!==-1&&(document.head.appendChild(re),re.setAttribute("data-s",""))})}var u=e.stylisPlugins||_ae,f={},y,T=[];y=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+r+' "]'),function(re){for(var se=re.getAttribute("data-emotion").split(" "),G=1;G<se.length;G++)f[se[G]]=!0;T.push(re)});var a,A=[pae,mae];{var D,O=[lae,uae(function(re){D.insert(re)})],B=cae(A.concat(u,O)),H=function(se){return b_(oae(se),B)};a=function(se,G,Y,Z){D=Y,H(se?se+"{"+G.styles+"}":G.styles),Z&&(Q.inserted[G.name]=!0)}}var Q={key:r,sheet:new Woe({key:r,container:y,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:f,registered:{},insert:a};return Q.sheet.hydrate(T),Q},vae=!0;function xae(t,e,r){var o="";return r.split(" ").forEach(function(u){t[u]!==void 0?e.push(t[u]+";"):o+=u+" "}),o}var rG=function(e,r,o){var u=e.key+"-"+r.name;(o===!1||vae===!1)&&e.registered[u]===void 0&&(e.registered[u]=r.styles)},iG=function(e,r,o){rG(e,r,o);var u=e.key+"-"+r.name;if(e.inserted[r.name]===void 0){var f=r;do e.insert(r===f?"."+u:"",f,e.sheet,!0),f=f.next;while(f!==void 0)}};function bae(t){for(var e=0,r,o=0,u=t.length;u>=4;++o,u-=4)r=t.charCodeAt(o)&255|(t.charCodeAt(++o)&255)<<8|(t.charCodeAt(++o)&255)<<16|(t.charCodeAt(++o)&255)<<24,r=(r&65535)*1540483477+((r>>>16)*59797<<16),r^=r>>>24,e=(r&65535)*1540483477+((r>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(u){case 3:e^=(t.charCodeAt(o+2)&255)<<16;case 2:e^=(t.charCodeAt(o+1)&255)<<8;case 1:e^=t.charCodeAt(o)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var wae={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Tae=!1,Eae=/[A-Z]|^ms/g,Sae=/_EMO_([^_]+?)_([^]*?)_EMO_/g,sG=function(e){return e.charCodeAt(1)===45},iU=function(e){return e!=null&&typeof e!="boolean"},BP=X7(function(t){return sG(t)?t:t.replace(Eae,"-$&").toLowerCase()}),sU=function(e,r){switch(e){case"animation":case"animationName":if(typeof r=="string")return r.replace(Sae,function(o,u,f){return uu={name:u,styles:f,next:uu},u})}return wae[e]!==1&&!sG(e)&&typeof r=="number"&&r!==0?r+"px":r},Iae="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function Tx(t,e,r){if(r==null)return"";var o=r;if(o.__emotion_styles!==void 0)return o;switch(typeof r){case"boolean":return"";case"object":{var u=r;if(u.anim===1)return uu={name:u.name,styles:u.styles,next:uu},u.name;var f=r;if(f.styles!==void 0){var y=f.next;if(y!==void 0)for(;y!==void 0;)uu={name:y.name,styles:y.styles,next:uu},y=y.next;var T=f.styles+";";return T}return Aae(t,e,r)}case"function":{if(t!==void 0){var a=uu,A=r(t);return uu=a,Tx(t,e,A)}break}}var D=r;if(e==null)return D;var O=e[D];return O!==void 0?O:D}function Aae(t,e,r){var o="";if(Array.isArray(r))for(var u=0;u<r.length;u++)o+=Tx(t,e,r[u])+";";else for(var f in r){var y=r[f];if(typeof y!="object"){var T=y;e!=null&&e[T]!==void 0?o+=f+"{"+e[T]+"}":iU(T)&&(o+=BP(f)+":"+sU(f,T)+";")}else{if(f==="NO_COMPONENT_SELECTOR"&&Tae)throw new Error(Iae);if(Array.isArray(y)&&typeof y[0]=="string"&&(e==null||e[y[0]]===void 0))for(var a=0;a<y.length;a++)iU(y[a])&&(o+=BP(f)+":"+sU(f,y[a])+";");else{var A=Tx(t,e,y);switch(f){case"animation":case"animationName":{o+=BP(f)+":"+A+";";break}default:o+=f+"{"+A+"}"}}}}return o}var oU=/label:\s*([^\s;\n{]+)\s*(;|$)/g,uu;function eO(t,e,r){if(t.length===1&&typeof t[0]=="object"&&t[0]!==null&&t[0].styles!==void 0)return t[0];var o=!0,u="";uu=void 0;var f=t[0];if(f==null||f.raw===void 0)o=!1,u+=Tx(r,e,f);else{var y=f;u+=y[0]}for(var T=1;T<t.length;T++)if(u+=Tx(r,e,t[T]),o){var a=f;u+=a[T]}oU.lastIndex=0;for(var A="",D;(D=oU.exec(u))!==null;)A+="-"+D[1];var O=bae(u)+A;return{name:O,styles:u,next:uu}}var Cae=function(e){return e()},oG=gR.useInsertionEffect?gR.useInsertionEffect:!1,Pae=oG||Cae,aU=oG||ue.useLayoutEffect,aG=ue.createContext(typeof HTMLElement<"u"?yae({key:"css"}):null);aG.Provider;var lG=function(e){return ue.forwardRef(function(r,o){var u=ue.useContext(aG);return e(r,u,o)})},tO=ue.createContext({}),Rae=lG(function(t,e){var r=t.styles,o=eO([r],void 0,ue.useContext(tO)),u=ue.useRef();return aU(function(){var f=e.key+"-global",y=new e.sheet.constructor({key:f,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),T=!1,a=document.querySelector('style[data-emotion="'+f+" "+o.name+'"]');return e.sheet.tags.length&&(y.before=e.sheet.tags[0]),a!==null&&(T=!0,a.setAttribute("data-emotion",f),y.hydrate([a])),u.current=[y,T],function(){y.flush()}},[e]),aU(function(){var f=u.current,y=f[0],T=f[1];if(T){f[1]=!1;return}if(o.next!==void 0&&iG(e,o.next,!0),y.tags.length){var a=y.tags[y.tags.length-1].nextElementSibling;y.before=a,y.flush()}e.insert("",o,y,!1)},[e,o.name]),null});function Mae(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return eO(e)}var nO=function(){var e=Mae.apply(void 0,arguments),r="animation-"+e.name;return{name:r,styles:"@keyframes "+r+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},kae=joe,Dae=function(e){return e!=="theme"},lU=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?kae:Dae},cU=function(e,r,o){var u;if(r){var f=r.shouldForwardProp;u=e.__emotion_forwardProp&&f?function(y){return e.__emotion_forwardProp(y)&&f(y)}:f}return typeof u!="function"&&o&&(u=e.__emotion_forwardProp),u},Oae=!1,Lae=function(e){var r=e.cache,o=e.serialized,u=e.isStringTag;return rG(r,o,u),Pae(function(){return iG(r,o,u)}),null},zae=function t(e,r){var o=e.__emotion_real===e,u=o&&e.__emotion_base||e,f,y;r!==void 0&&(f=r.label,y=r.target);var T=cU(e,r,o),a=T||lU(u),A=!a("as");return function(){var D=arguments,O=o&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(f!==void 0&&O.push("label:"+f+";"),D[0]==null||D[0].raw===void 0)O.push.apply(O,D);else{O.push(D[0][0]);for(var B=D.length,H=1;H<B;H++)O.push(D[H],D[0][H])}var Q=lG(function(re,se,G){var Y=A&&re.as||u,Z="",fe=[],Te=re;if(re.theme==null){Te={};for(var Pe in re)Te[Pe]=re[Pe];Te.theme=ue.useContext(tO)}typeof re.className=="string"?Z=xae(se.registered,fe,re.className):re.className!=null&&(Z=re.className+" ");var ce=eO(O.concat(fe),se.registered,Te);Z+=se.key+"-"+ce.name,y!==void 0&&(Z+=" "+y);var he=A&&T===void 0?lU(Y):a,W={};for(var ge in re)A&&ge==="as"||he(ge)&&(W[ge]=re[ge]);return W.className=Z,G&&(W.ref=G),ue.createElement(ue.Fragment,null,ue.createElement(Lae,{cache:se,serialized:ce,isStringTag:typeof Y=="string"}),ue.createElement(Y,W))});return Q.displayName=f!==void 0?f:"Styled("+(typeof u=="string"?u:u.displayName||u.name||"Component")+")",Q.defaultProps=e.defaultProps,Q.__emotion_real=Q,Q.__emotion_base=u,Q.__emotion_styles=O,Q.__emotion_forwardProp=T,Object.defineProperty(Q,"toString",{value:function(){return y===void 0&&Oae?"NO_COMPONENT_SELECTOR":"."+y}}),Q.withComponent=function(re,se){return t(re,xE({},r,se,{shouldForwardProp:cU(Q,se,!0)})).apply(void 0,O)},Q}},Nae=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],jM=zae.bind();Nae.forEach(function(t){jM[t]=jM(t)});var cG={exports:{}},Fae="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Bae=Fae,Uae=Bae;function uG(){}function hG(){}hG.resetWarningCache=uG;var Vae=function(){function t(o,u,f,y,T,a){if(a!==Uae){var A=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw A.name="Invariant Violation",A}}t.isRequired=t;function e(){return t}var r={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:hG,resetWarningCache:uG};return r.PropTypes=r,r};cG.exports=Vae();var jae=cG.exports;const Gr=HE(jae);function $ae(t){return t==null||Object.keys(t).length===0}function Gae(t){const{styles:e,defaultTheme:r={}}=t,o=typeof e=="function"?u=>e($ae(u)?r:u):e;return J.jsx(Rae,{styles:o})}/**
 * @mui/styled-engine v6.0.2
 *
 * @license MIT
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function qae(t,e){return jM(t,e)}const Wae=(t,e)=>{Array.isArray(t.__emotion_styles)&&(t.__emotion_styles=e(t.__emotion_styles))};function pu(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function dG(t){if(!pu(t))return t;const e={};return Object.keys(t).forEach(r=>{e[r]=dG(t[r])}),e}function Ho(t,e,r={clone:!0}){const o=r.clone?{...t}:t;return pu(t)&&pu(e)&&Object.keys(e).forEach(u=>{pu(e[u])&&Object.prototype.hasOwnProperty.call(t,u)&&pu(t[u])?o[u]=Ho(t[u],e[u],r):r.clone?o[u]=pu(e[u])?dG(e[u]):e[u]:o[u]=e[u]}),o}const Hae=t=>{const e=Object.keys(t).map(r=>({key:r,val:t[r]}))||[];return e.sort((r,o)=>r.val-o.val),e.reduce((r,o)=>({...r,[o.key]:o.val}),{})};function Zae(t){const{values:e={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:r="px",step:o=5,...u}=t,f=Hae(e),y=Object.keys(f);function T(B){return`@media (min-width:${typeof e[B]=="number"?e[B]:B}${r})`}function a(B){return`@media (max-width:${(typeof e[B]=="number"?e[B]:B)-o/100}${r})`}function A(B,H){const Q=y.indexOf(H);return`@media (min-width:${typeof e[B]=="number"?e[B]:B}${r}) and (max-width:${(Q!==-1&&typeof e[y[Q]]=="number"?e[y[Q]]:H)-o/100}${r})`}function D(B){return y.indexOf(B)+1<y.length?A(B,y[y.indexOf(B)+1]):T(B)}function O(B){const H=y.indexOf(B);return H===0?T(y[1]):H===y.length-1?a(y[H]):A(B,y[y.indexOf(B)+1]).replace("@media","@media not all and")}return{keys:y,values:f,up:T,down:a,between:A,only:D,not:O,unit:r,...u}}function Xae(t,e){if(!t.containerQueries)return e;const r=Object.keys(e).filter(o=>o.startsWith("@container")).sort((o,u)=>{var y,T;const f=/min-width:\s*([0-9.]+)/;return+(((y=o.match(f))==null?void 0:y[1])||0)-+(((T=u.match(f))==null?void 0:T[1])||0)});return r.length?r.reduce((o,u)=>{const f=e[u];return delete o[u],o[u]=f,o},{...e}):e}function Kae(t,e){return e==="@"||e.startsWith("@")&&(t.some(r=>e.startsWith(`@${r}`))||!!e.match(/^@\d/))}function Yae(t,e){const r=e.match(/^@([^/]+)?\/?(.+)?$/);if(!r)return null;const[,o,u]=r,f=Number.isNaN(+o)?o||0:+o;return t.containerQueries(u).up(f)}function Qae(t){const e=(f,y)=>f.replace("@media",y?`@container ${y}`:"@container");function r(f,y){f.up=(...T)=>e(t.breakpoints.up(...T),y),f.down=(...T)=>e(t.breakpoints.down(...T),y),f.between=(...T)=>e(t.breakpoints.between(...T),y),f.only=(...T)=>e(t.breakpoints.only(...T),y),f.not=(...T)=>{const a=e(t.breakpoints.not(...T),y);return a.includes("not all and")?a.replace("not all and ","").replace("min-width:","width<").replace("max-width:","width>").replace("and","or"):a}}const o={},u=f=>(r(o,f),o);return r(u),{...t,containerQueries:u}}const Jae={borderRadius:4};function Bv(t,e){return e?Ho(t,e,{clone:!1}):t}const KS={xs:0,sm:600,md:900,lg:1200,xl:1536},uU={keys:["xs","sm","md","lg","xl"],up:t=>`@media (min-width:${KS[t]}px)`},ele={containerQueries:t=>({up:e=>{let r=typeof e=="number"?e:KS[e]||e;return typeof r=="number"&&(r=`${r}px`),t?`@container ${t} (min-width:${r})`:`@container (min-width:${r})`}})};function Lh(t,e,r){const o=t.theme||{};if(Array.isArray(e)){const f=o.breakpoints||uU;return e.reduce((y,T,a)=>(y[f.up(f.keys[a])]=r(e[a]),y),{})}if(typeof e=="object"){const f=o.breakpoints||uU;return Object.keys(e).reduce((y,T)=>{if(Kae(f.keys,T)){const a=Yae(o.containerQueries?o:ele,T);a&&(y[a]=r(e[T],T))}else if(Object.keys(f.values||KS).includes(T)){const a=f.up(T);y[a]=r(e[T],T)}else{const a=T;y[a]=e[a]}return y},{})}return r(e)}function tle(t={}){var r;return((r=t.keys)==null?void 0:r.reduce((o,u)=>{const f=t.up(u);return o[f]={},o},{}))||{}}function nle(t,e){return t.reduce((r,o)=>{const u=r[o];return(!u||Object.keys(u).length===0)&&delete r[o],r},e)}function Wn(t){if(typeof t!="string")throw new Error(Oh(7));return t.charAt(0).toUpperCase()+t.slice(1)}function YS(t,e,r=!0){if(!e||typeof e!="string")return null;if(t&&t.vars&&r){const o=`vars.${e}`.split(".").reduce((u,f)=>u&&u[f]?u[f]:null,t);if(o!=null)return o}return e.split(".").reduce((o,u)=>o&&o[u]!=null?o[u]:null,t)}function wE(t,e,r,o=r){let u;return typeof t=="function"?u=t(r):Array.isArray(t)?u=t[r]||o:u=YS(t,r)||o,e&&(u=e(u,o,t)),u}function zs(t){const{prop:e,cssProperty:r=t.prop,themeKey:o,transform:u}=t,f=y=>{if(y[e]==null)return null;const T=y[e],a=y.theme,A=YS(a,o)||{};return Lh(y,T,O=>{let B=wE(A,u,O);return O===B&&typeof O=="string"&&(B=wE(A,u,`${e}${O==="default"?"":Wn(O)}`,O)),r===!1?B:{[r]:B}})};return f.propTypes={},f.filterProps=[e],f}function rle(t){const e={};return r=>(e[r]===void 0&&(e[r]=t(r)),e[r])}const ile={m:"margin",p:"padding"},sle={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},hU={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},ole=rle(t=>{if(t.length>2)if(hU[t])t=hU[t];else return[t];const[e,r]=t.split(""),o=ile[e],u=sle[r]||"";return Array.isArray(u)?u.map(f=>o+f):[o+u]}),rO=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],iO=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...rO,...iO];function i1(t,e,r,o){const u=YS(t,e,!0)??r;return typeof u=="number"||typeof u=="string"?f=>typeof f=="string"?f:typeof u=="string"?`calc(${f} * ${u})`:u*f:Array.isArray(u)?f=>{if(typeof f=="string")return f;const y=Math.abs(f),T=u[y];return f>=0?T:typeof T=="number"?-T:`-${T}`}:typeof u=="function"?u:()=>{}}function sO(t){return i1(t,"spacing",8)}function s1(t,e){return typeof e=="string"||e==null?e:t(e)}function ale(t,e){return r=>t.reduce((o,u)=>(o[u]=s1(e,r),o),{})}function lle(t,e,r,o){if(!e.includes(r))return null;const u=ole(r),f=ale(u,o),y=t[r];return Lh(t,y,f)}function fG(t,e){const r=sO(t.theme);return Object.keys(t).map(o=>lle(t,e,o,r)).reduce(Bv,{})}function Is(t){return fG(t,rO)}Is.propTypes={};Is.filterProps=rO;function As(t){return fG(t,iO)}As.propTypes={};As.filterProps=iO;function pG(t=8,e=sO({spacing:t})){if(t.mui)return t;const r=(...o)=>(o.length===0?[1]:o).map(f=>{const y=e(f);return typeof y=="number"?`${y}px`:y}).join(" ");return r.mui=!0,r}function QS(...t){const e=t.reduce((o,u)=>(u.filterProps.forEach(f=>{o[f]=u}),o),{}),r=o=>Object.keys(o).reduce((u,f)=>e[f]?Bv(u,e[f](o)):u,{});return r.propTypes={},r.filterProps=t.reduce((o,u)=>o.concat(u.filterProps),[]),r}function Ml(t){return typeof t!="number"?t:`${t}px solid`}function jl(t,e){return zs({prop:t,themeKey:"borders",transform:e})}const cle=jl("border",Ml),ule=jl("borderTop",Ml),hle=jl("borderRight",Ml),dle=jl("borderBottom",Ml),fle=jl("borderLeft",Ml),ple=jl("borderColor"),mle=jl("borderTopColor"),gle=jl("borderRightColor"),_le=jl("borderBottomColor"),yle=jl("borderLeftColor"),vle=jl("outline",Ml),xle=jl("outlineColor"),JS=t=>{if(t.borderRadius!==void 0&&t.borderRadius!==null){const e=i1(t.theme,"shape.borderRadius",4),r=o=>({borderRadius:s1(e,o)});return Lh(t,t.borderRadius,r)}return null};JS.propTypes={};JS.filterProps=["borderRadius"];QS(cle,ule,hle,dle,fle,ple,mle,gle,_le,yle,JS,vle,xle);const eI=t=>{if(t.gap!==void 0&&t.gap!==null){const e=i1(t.theme,"spacing",8),r=o=>({gap:s1(e,o)});return Lh(t,t.gap,r)}return null};eI.propTypes={};eI.filterProps=["gap"];const tI=t=>{if(t.columnGap!==void 0&&t.columnGap!==null){const e=i1(t.theme,"spacing",8),r=o=>({columnGap:s1(e,o)});return Lh(t,t.columnGap,r)}return null};tI.propTypes={};tI.filterProps=["columnGap"];const nI=t=>{if(t.rowGap!==void 0&&t.rowGap!==null){const e=i1(t.theme,"spacing",8),r=o=>({rowGap:s1(e,o)});return Lh(t,t.rowGap,r)}return null};nI.propTypes={};nI.filterProps=["rowGap"];const ble=zs({prop:"gridColumn"}),wle=zs({prop:"gridRow"}),Tle=zs({prop:"gridAutoFlow"}),Ele=zs({prop:"gridAutoColumns"}),Sle=zs({prop:"gridAutoRows"}),Ile=zs({prop:"gridTemplateColumns"}),Ale=zs({prop:"gridTemplateRows"}),Cle=zs({prop:"gridTemplateAreas"}),Ple=zs({prop:"gridArea"});QS(eI,tI,nI,ble,wle,Tle,Ele,Sle,Ile,Ale,Cle,Ple);function w_(t,e){return e==="grey"?e:t}const Rle=zs({prop:"color",themeKey:"palette",transform:w_}),Mle=zs({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:w_}),kle=zs({prop:"backgroundColor",themeKey:"palette",transform:w_});QS(Rle,Mle,kle);function Qa(t){return t<=1&&t!==0?`${t*100}%`:t}const Dle=zs({prop:"width",transform:Qa}),oO=t=>{if(t.maxWidth!==void 0&&t.maxWidth!==null){const e=r=>{var u,f,y,T,a;const o=((y=(f=(u=t.theme)==null?void 0:u.breakpoints)==null?void 0:f.values)==null?void 0:y[r])||KS[r];return o?((a=(T=t.theme)==null?void 0:T.breakpoints)==null?void 0:a.unit)!=="px"?{maxWidth:`${o}${t.theme.breakpoints.unit}`}:{maxWidth:o}:{maxWidth:Qa(r)}};return Lh(t,t.maxWidth,e)}return null};oO.filterProps=["maxWidth"];const Ole=zs({prop:"minWidth",transform:Qa}),Lle=zs({prop:"height",transform:Qa}),zle=zs({prop:"maxHeight",transform:Qa}),Nle=zs({prop:"minHeight",transform:Qa});zs({prop:"size",cssProperty:"width",transform:Qa});zs({prop:"size",cssProperty:"height",transform:Qa});const Fle=zs({prop:"boxSizing"});QS(Dle,oO,Ole,Lle,zle,Nle,Fle);const o1={border:{themeKey:"borders",transform:Ml},borderTop:{themeKey:"borders",transform:Ml},borderRight:{themeKey:"borders",transform:Ml},borderBottom:{themeKey:"borders",transform:Ml},borderLeft:{themeKey:"borders",transform:Ml},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:Ml},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:JS},color:{themeKey:"palette",transform:w_},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:w_},backgroundColor:{themeKey:"palette",transform:w_},p:{style:As},pt:{style:As},pr:{style:As},pb:{style:As},pl:{style:As},px:{style:As},py:{style:As},padding:{style:As},paddingTop:{style:As},paddingRight:{style:As},paddingBottom:{style:As},paddingLeft:{style:As},paddingX:{style:As},paddingY:{style:As},paddingInline:{style:As},paddingInlineStart:{style:As},paddingInlineEnd:{style:As},paddingBlock:{style:As},paddingBlockStart:{style:As},paddingBlockEnd:{style:As},m:{style:Is},mt:{style:Is},mr:{style:Is},mb:{style:Is},ml:{style:Is},mx:{style:Is},my:{style:Is},margin:{style:Is},marginTop:{style:Is},marginRight:{style:Is},marginBottom:{style:Is},marginLeft:{style:Is},marginX:{style:Is},marginY:{style:Is},marginInline:{style:Is},marginInlineStart:{style:Is},marginInlineEnd:{style:Is},marginBlock:{style:Is},marginBlockStart:{style:Is},marginBlockEnd:{style:Is},displayPrint:{cssProperty:!1,transform:t=>({"@media print":{display:t}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:eI},rowGap:{style:nI},columnGap:{style:tI},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:Qa},maxWidth:{style:oO},minWidth:{transform:Qa},height:{transform:Qa},maxHeight:{transform:Qa},minHeight:{transform:Qa},boxSizing:{},font:{themeKey:"font"},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}};function Ble(...t){const e=t.reduce((o,u)=>o.concat(Object.keys(u)),[]),r=new Set(e);return t.every(o=>r.size===Object.keys(o).length)}function Ule(t,e){return typeof t=="function"?t(e):t}function Vle(){function t(r,o,u,f){const y={[r]:o,theme:u},T=f[r];if(!T)return{[r]:o};const{cssProperty:a=r,themeKey:A,transform:D,style:O}=T;if(o==null)return null;if(A==="typography"&&o==="inherit")return{[r]:o};const B=YS(u,A)||{};return O?O(y):Lh(y,o,Q=>{let re=wE(B,D,Q);return Q===re&&typeof Q=="string"&&(re=wE(B,D,`${r}${Q==="default"?"":Wn(Q)}`,Q)),a===!1?re:{[a]:re}})}function e(r){const{sx:o,theme:u={}}=r||{};if(!o)return null;const f=u.unstable_sxConfig??o1;function y(T){let a=T;if(typeof T=="function")a=T(u);else if(typeof T!="object")return T;if(!a)return null;const A=tle(u.breakpoints),D=Object.keys(A);let O=A;return Object.keys(a).forEach(B=>{const H=Ule(a[B],u);if(H!=null)if(typeof H=="object")if(f[B])O=Bv(O,t(B,H,u,f));else{const Q=Lh({theme:u},H,re=>({[B]:re}));Ble(Q,H)?O[B]=e({sx:H,theme:u}):O=Bv(O,Q)}else O=Bv(O,t(B,H,u,f))}),Xae(u,nle(D,O))}return Array.isArray(o)?o.map(y):y(o)}return e}const a1=Vle();a1.filterProps=["sx"];function jle(t,e){var o;const r=this;if(r.vars){if(!((o=r.colorSchemes)!=null&&o[t])||typeof r.getColorSchemeSelector!="function")return{};let u=r.getColorSchemeSelector(t);return(u.includes("data-")||u.includes("."))&&(u=`*:where(${u.replace(/\s*&$/,"")}) &`),{[u]:e}}return r.palette.mode===t?e:{}}function aO(t={},...e){const{breakpoints:r={},palette:o={},spacing:u,shape:f={},...y}=t,T=Zae(r),a=pG(u);let A=Ho({breakpoints:T,direction:"ltr",components:{},palette:{mode:"light",...o},spacing:a,shape:{...Jae,...f}},y);return A=Qae(A),A.applyStyles=jle,A=e.reduce((D,O)=>Ho(D,O),A),A.unstable_sxConfig={...o1,...y==null?void 0:y.unstable_sxConfig},A.unstable_sx=function(O){return a1({sx:O,theme:this})},A}function $le(t){return Object.keys(t).length===0}function Gle(t=null){const e=ue.useContext(tO);return!e||$le(e)?t:e}const qle=aO();function lO(t=qle){return Gle(t)}function Wle({styles:t,themeId:e,defaultTheme:r={}}){const o=lO(r),u=typeof t=="function"?t(e&&o[e]||o):t;return J.jsx(Gae,{styles:u})}const Hle=t=>{var o;const e={systemProps:{},otherProps:{}},r=((o=t==null?void 0:t.theme)==null?void 0:o.unstable_sxConfig)??o1;return Object.keys(t).forEach(u=>{r[u]?e.systemProps[u]=t[u]:e.otherProps[u]=t[u]}),e};function Zle(t){const{sx:e,...r}=t,{systemProps:o,otherProps:u}=Hle(r);let f;return Array.isArray(e)?f=[o,...e]:typeof e=="function"?f=(...y)=>{const T=e(...y);return pu(T)?{...o,...T}:o}:f={...o,...e},{...u,sx:f}}const dU=t=>t,Xle=()=>{let t=dU;return{configure(e){t=e},generate(e){return t(e)},reset(){t=dU}}},Kle=Xle();function mG(t){var e,r,o="";if(typeof t=="string"||typeof t=="number")o+=t;else if(typeof t=="object")if(Array.isArray(t)){var u=t.length;for(e=0;e<u;e++)t[e]&&(r=mG(t[e]))&&(o&&(o+=" "),o+=r)}else for(r in t)t[r]&&(o&&(o+=" "),o+=r);return o}function Mr(){for(var t,e,r=0,o="",u=arguments.length;r<u;r++)(t=arguments[r])&&(e=mG(t))&&(o&&(o+=" "),o+=e);return o}const Yle={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function wi(t,e,r="Mui"){const o=Yle[e];return o?`${r}-${o}`:`${Kle.generate(t)}-${e}`}function Ti(t,e,r="Mui"){const o={};return e.forEach(u=>{o[u]=wi(t,u,r)}),o}var Si={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cO=Symbol.for("react.element"),uO=Symbol.for("react.portal"),rI=Symbol.for("react.fragment"),iI=Symbol.for("react.strict_mode"),sI=Symbol.for("react.profiler"),oI=Symbol.for("react.provider"),aI=Symbol.for("react.context"),Qle=Symbol.for("react.server_context"),lI=Symbol.for("react.forward_ref"),cI=Symbol.for("react.suspense"),uI=Symbol.for("react.suspense_list"),hI=Symbol.for("react.memo"),dI=Symbol.for("react.lazy"),Jle=Symbol.for("react.offscreen"),gG;gG=Symbol.for("react.module.reference");function $l(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case cO:switch(t=t.type,t){case rI:case sI:case iI:case cI:case uI:return t;default:switch(t=t&&t.$$typeof,t){case Qle:case aI:case lI:case dI:case hI:case oI:return t;default:return e}}case uO:return e}}}Si.ContextConsumer=aI;Si.ContextProvider=oI;Si.Element=cO;Si.ForwardRef=lI;Si.Fragment=rI;Si.Lazy=dI;Si.Memo=hI;Si.Portal=uO;Si.Profiler=sI;Si.StrictMode=iI;Si.Suspense=cI;Si.SuspenseList=uI;Si.isAsyncMode=function(){return!1};Si.isConcurrentMode=function(){return!1};Si.isContextConsumer=function(t){return $l(t)===aI};Si.isContextProvider=function(t){return $l(t)===oI};Si.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===cO};Si.isForwardRef=function(t){return $l(t)===lI};Si.isFragment=function(t){return $l(t)===rI};Si.isLazy=function(t){return $l(t)===dI};Si.isMemo=function(t){return $l(t)===hI};Si.isPortal=function(t){return $l(t)===uO};Si.isProfiler=function(t){return $l(t)===sI};Si.isStrictMode=function(t){return $l(t)===iI};Si.isSuspense=function(t){return $l(t)===cI};Si.isSuspenseList=function(t){return $l(t)===uI};Si.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===rI||t===sI||t===iI||t===cI||t===uI||t===Jle||typeof t=="object"&&t!==null&&(t.$$typeof===dI||t.$$typeof===hI||t.$$typeof===oI||t.$$typeof===aI||t.$$typeof===lI||t.$$typeof===gG||t.getModuleId!==void 0)};Si.typeOf=$l;const ece=aO();function UP(t){return t!=="ownerState"&&t!=="theme"&&t!=="sx"&&t!=="as"}function $M(t,e,r){return nce(e)?r:e[t]||e}const Lw=Symbol("mui.processed_props");function zw(t,e,r){if(Lw in t)return t[Lw];const o={...t,theme:$M(e,t.theme,r)};return t[Lw]=o,o[Lw]=o,o}function tce(t){return t?(e,r)=>r[t]:null}function xT(t,e){var o;const r=typeof t=="function"?t(e):t;if(Array.isArray(r))return r.flatMap(u=>xT(u,e));if(Array.isArray(r==null?void 0:r.variants)){const{variants:u,...f}=r;let y=f,T;e:for(let a=0;a<u.length;a+=1){const A=u[a];if(typeof A.props=="function"){if(T??(T={...e,...e.ownerState,ownerState:e.ownerState}),!A.props(T))continue}else for(const D in A.props)if(e[D]!==A.props[D]&&((o=e.ownerState)==null?void 0:o[D])!==A.props[D])continue e;Array.isArray(y)||(y=[y]),typeof A.style=="function"?(T??(T={...e,...e.ownerState,ownerState:e.ownerState}),y.push(A.style(T))):y.push(A.style)}return y}return r}function _G(t={}){const{themeId:e,defaultTheme:r=ece,rootShouldForwardProp:o=UP,slotShouldForwardProp:u=UP}=t,f=T=>a1(zw(T,e,r));return f.__mui_systemSx=!0,(T,a={})=>{Wae(T,Pe=>Pe.filter(ce=>!(ce!=null&&ce.__mui_systemSx)));const{name:A,slot:D,skipVariantsResolver:O,skipSx:B,overridesResolver:H=tce(ice(D)),...Q}=a,re=O!==void 0?O:D&&D!=="Root"&&D!=="root"||!1,se=B||!1;let G,Y=UP;D==="Root"||D==="root"?Y=o:D?Y=u:rce(T)&&(Y=void 0);const Z=qae(T,{shouldForwardProp:Y,label:G,...Q}),fe=Pe=>typeof Pe=="function"&&Pe.__emotion_real!==Pe||pu(Pe)?ce=>xT(Pe,zw(ce,e,r)):Pe,Te=(Pe,...ce)=>{let he=fe(Pe);const W=ce?ce.map(fe):[];A&&H&&W.push(Ee=>{const we=$M(e,Ee.theme,r);if(!we.components||!we.components[A]||!we.components[A].styleOverrides)return null;const xt=we.components[A].styleOverrides,Rt={},Bt=zw(Ee,e,r);for(const bt in xt)Rt[bt]=xT(xt[bt],Bt);return H(Ee,Rt)}),A&&!re&&W.push(Ee=>{var Rt,Bt;const we=$M(e,Ee.theme,r),xt=(Bt=(Rt=we==null?void 0:we.components)==null?void 0:Rt[A])==null?void 0:Bt.variants;return xt?xT({variants:xt},zw(Ee,e,r)):null}),se||W.push(f);const ge=W.length-ce.length;if(Array.isArray(Pe)&&ge>0){const Ee=new Array(ge).fill("");he=[...Pe,...Ee],he.raw=[...Pe.raw,...Ee]}const _e=Z(he,...W);return T.muiName&&(_e.muiName=T.muiName),_e};return Z.withConfig&&(Te.withConfig=Z.withConfig),Te}}function nce(t){for(const e in t)return!1;return!0}function rce(t){return typeof t=="string"&&t.charCodeAt(0)>96}function ice(t){return t&&t.charAt(0).toLowerCase()+t.slice(1)}const Ru=_G();function Ex(t,e){const r={...e};for(const o in t)if(Object.prototype.hasOwnProperty.call(t,o)){const u=o;if(u==="components"||u==="slots")r[u]={...t[u],...r[u]};else if(u==="componentsProps"||u==="slotProps"){const f=t[u],y=e[u];if(!y)r[u]=f||{};else if(!f)r[u]=y;else{r[u]={...y};for(const T in f)if(Object.prototype.hasOwnProperty.call(f,T)){const a=T;r[u][a]=Ex(f[a],y[a])}}}else r[u]===void 0&&(r[u]=t[u])}return r}function sce(t){const{theme:e,name:r,props:o}=t;return!e||!e.components||!e.components[r]||!e.components[r].defaultProps?o:Ex(e.components[r].defaultProps,o)}function oce({props:t,name:e,defaultTheme:r,themeId:o}){let u=lO(r);return o&&(u=u[o]||u),sce({theme:u,name:e,props:t})}const am=typeof window<"u"?ue.useLayoutEffect:ue.useEffect;function ace(t,e=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER){return Math.max(e,Math.min(t,r))}function hO(t,e=0,r=1){return ace(t,e,r)}function lce(t){t=t.slice(1);const e=new RegExp(`.{1,${t.length>=6?2:1}}`,"g");let r=t.match(e);return r&&r[0].length===1&&(r=r.map(o=>o+o)),r?`rgb${r.length===4?"a":""}(${r.map((o,u)=>u<3?parseInt(o,16):Math.round(parseInt(o,16)/255*1e3)/1e3).join(", ")})`:""}function vf(t){if(t.type)return t;if(t.charAt(0)==="#")return vf(lce(t));const e=t.indexOf("("),r=t.substring(0,e);if(!["rgb","rgba","hsl","hsla","color"].includes(r))throw new Error(Oh(9,t));let o=t.substring(e+1,t.length-1),u;if(r==="color"){if(o=o.split(" "),u=o.shift(),o.length===4&&o[3].charAt(0)==="/"&&(o[3]=o[3].slice(1)),!["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].includes(u))throw new Error(Oh(10,u))}else o=o.split(",");return o=o.map(f=>parseFloat(f)),{type:r,values:o,colorSpace:u}}const cce=t=>{const e=vf(t);return e.values.slice(0,3).map((r,o)=>e.type.includes("hsl")&&o!==0?`${r}%`:r).join(" ")},fv=(t,e)=>{try{return cce(t)}catch{return t}};function fI(t){const{type:e,colorSpace:r}=t;let{values:o}=t;return e.includes("rgb")?o=o.map((u,f)=>f<3?parseInt(u,10):u):e.includes("hsl")&&(o[1]=`${o[1]}%`,o[2]=`${o[2]}%`),e.includes("color")?o=`${r} ${o.join(" ")}`:o=`${o.join(", ")}`,`${e}(${o})`}function yG(t){t=vf(t);const{values:e}=t,r=e[0],o=e[1]/100,u=e[2]/100,f=o*Math.min(u,1-u),y=(A,D=(A+r/30)%12)=>u-f*Math.max(Math.min(D-3,9-D,1),-1);let T="rgb";const a=[Math.round(y(0)*255),Math.round(y(8)*255),Math.round(y(4)*255)];return t.type==="hsla"&&(T+="a",a.push(e[3])),fI({type:T,values:a})}function GM(t){t=vf(t);let e=t.type==="hsl"||t.type==="hsla"?vf(yG(t)).values:t.values;return e=e.map(r=>(t.type!=="color"&&(r/=255),r<=.03928?r/12.92:((r+.055)/1.055)**2.4)),Number((.2126*e[0]+.7152*e[1]+.0722*e[2]).toFixed(3))}function uce(t,e){const r=GM(t),o=GM(e);return(Math.max(r,o)+.05)/(Math.min(r,o)+.05)}function Dl(t,e){return t=vf(t),e=hO(e),(t.type==="rgb"||t.type==="hsl")&&(t.type+="a"),t.type==="color"?t.values[3]=`/${e}`:t.values[3]=e,fI(t)}function Nw(t,e,r){try{return Dl(t,e)}catch{return t}}function dO(t,e){if(t=vf(t),e=hO(e),t.type.includes("hsl"))t.values[2]*=1-e;else if(t.type.includes("rgb")||t.type.includes("color"))for(let r=0;r<3;r+=1)t.values[r]*=1-e;return fI(t)}function Mi(t,e,r){try{return dO(t,e)}catch{return t}}function fO(t,e){if(t=vf(t),e=hO(e),t.type.includes("hsl"))t.values[2]+=(100-t.values[2])*e;else if(t.type.includes("rgb"))for(let r=0;r<3;r+=1)t.values[r]+=(255-t.values[r])*e;else if(t.type.includes("color"))for(let r=0;r<3;r+=1)t.values[r]+=(1-t.values[r])*e;return fI(t)}function ki(t,e,r){try{return fO(t,e)}catch{return t}}function hce(t,e=.15){return GM(t)>.5?dO(t,e):fO(t,e)}function Fw(t,e,r){try{return hce(t,e)}catch{return t}}function qM(...t){return t.reduce((e,r)=>r==null?e:function(...u){e.apply(this,u),r.apply(this,u)},()=>{})}function vG(t,e=166){let r;function o(...u){const f=()=>{t.apply(this,u)};clearTimeout(r),r=setTimeout(f,e)}return o.clear=()=>{clearTimeout(r)},o}function VP(t,e){var r,o,u;return ue.isValidElement(t)&&e.indexOf(t.type.muiName??((u=(o=(r=t.type)==null?void 0:r._payload)==null?void 0:o.value)==null?void 0:u.muiName))!==-1}function ol(t){return t&&t.ownerDocument||document}function lm(t){return ol(t).defaultView||window}function WM(t,e){typeof t=="function"?t(e):t&&(t.current=e)}let fU=0;function dce(t){const[e,r]=ue.useState(t),o=t||e;return ue.useEffect(()=>{e==null&&(fU+=1,r(`mui-${fU}`))},[e]),o}const pU=gR.useId;function pO(t){if(pU!==void 0){const e=pU();return t??e}return dce(t)}function TE({controlled:t,default:e,name:r,state:o="value"}){const{current:u}=ue.useRef(t!==void 0),[f,y]=ue.useState(e),T=u?t:f,a=ue.useCallback(A=>{u||y(A)},[]);return[T,a]}function o_(t){const e=ue.useRef(t);return am(()=>{e.current=t}),ue.useRef((...r)=>(0,e.current)(...r)).current}function Po(...t){return ue.useMemo(()=>t.every(e=>e==null)?null:e=>{t.forEach(r=>{WM(r,e)})},t)}const mU={};function xG(t,e){const r=ue.useRef(mU);return r.current===mU&&(r.current=t(e)),r}const fce=[];function pce(t){ue.useEffect(t,fce)}class mO{constructor(){F0(this,"currentId",null);F0(this,"clear",()=>{this.currentId!==null&&(clearTimeout(this.currentId),this.currentId=null)});F0(this,"disposeEffect",()=>this.clear)}static create(){return new mO}start(e,r){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,r()},e)}}function bG(){const t=xG(mO.create).current;return pce(t.disposeEffect),t}function gU(t){try{return t.matches(":focus-visible")}catch{}return!1}function wG(t){const e=t.documentElement.clientWidth;return Math.abs(window.innerWidth-e)}const TG=t=>{const e=ue.useRef({});return ue.useEffect(()=>{e.current=t}),e.current};function Ii(t,e,r=void 0){const o={};for(const u in t){const f=t[u];let y="",T=!0;for(let a=0;a<f.length;a+=1){const A=f[a];A&&(y+=(T===!0?"":" ")+e(A),T=!1,r&&r[A]&&(y+=" "+r[A]))}o[u]=y}return o}function mce(t){return typeof t=="string"}function EG(t,e,r){return t===void 0||mce(t)?e:{...e,ownerState:{...e.ownerState,...r}}}function SG(t,e=[]){if(t===void 0)return{};const r={};return Object.keys(t).filter(o=>o.match(/^on[A-Z]/)&&typeof t[o]=="function"&&!e.includes(o)).forEach(o=>{r[o]=t[o]}),r}function _U(t){if(t===void 0)return{};const e={};return Object.keys(t).filter(r=>!(r.match(/^on[A-Z]/)&&typeof t[r]=="function")).forEach(r=>{e[r]=t[r]}),e}function IG(t){const{getSlotProps:e,additionalProps:r,externalSlotProps:o,externalForwardedProps:u,className:f}=t;if(!e){const H=Mr(r==null?void 0:r.className,f,u==null?void 0:u.className,o==null?void 0:o.className),Q={...r==null?void 0:r.style,...u==null?void 0:u.style,...o==null?void 0:o.style},re={...r,...u,...o};return H.length>0&&(re.className=H),Object.keys(Q).length>0&&(re.style=Q),{props:re,internalRef:void 0}}const y=SG({...u,...o}),T=_U(o),a=_U(u),A=e(y),D=Mr(A==null?void 0:A.className,r==null?void 0:r.className,f,u==null?void 0:u.className,o==null?void 0:o.className),O={...A==null?void 0:A.style,...r==null?void 0:r.style,...u==null?void 0:u.style,...o==null?void 0:o.style},B={...A,...r,...a,...T};return D.length>0&&(B.className=D),Object.keys(O).length>0&&(B.style=O),{props:B,internalRef:A.ref}}function AG(t,e,r){return typeof t=="function"?t(e,r):t}function EE(t){var O;const{elementType:e,externalSlotProps:r,ownerState:o,skipResolvingSlotProps:u=!1,...f}=t,y=u?{}:AG(r,o),{props:T,internalRef:a}=IG({...f,externalSlotProps:y}),A=Po(a,y==null?void 0:y.ref,(O=t.additionalProps)==null?void 0:O.ref);return EG(e,{...T,ref:A},o)}function l1(t){return!t||!ue.isValidElement(t)?null:t.props.propertyIsEnumerable("ref")?t.props.ref:t.ref}const gce=ue.createContext(),_ce=()=>ue.useContext(gce)??!1,yce=ue.createContext(void 0);function vce(t){const{theme:e,name:r,props:o}=t;if(!e||!e.components||!e.components[r])return o;const u=e.components[r];return u.defaultProps?Ex(u.defaultProps,o):!u.styleOverrides&&!u.variants?Ex(u,o):o}function xce({props:t,name:e}){const r=ue.useContext(yce);return vce({props:t,name:e,theme:{components:r}})}function bce(t=""){function e(...o){if(!o.length)return"";const u=o[0];return typeof u=="string"&&!u.match(/(#|\(|\)|(-?(\d*\.)?\d+)(px|em|%|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc))|^(-?(\d*\.)?\d+)$|(\d+ \d+ \d+)/)?`, var(--${t?`${t}-`:""}${u}${e(...o.slice(1))})`:`, ${u}`}return(o,...u)=>`var(--${t?`${t}-`:""}${o}${e(...u)})`}const yU=(t,e,r,o=[])=>{let u=t;e.forEach((f,y)=>{y===e.length-1?Array.isArray(u)?u[Number(f)]=r:u&&typeof u=="object"&&(u[f]=r):u&&typeof u=="object"&&(u[f]||(u[f]=o.includes(f)?[]:{}),u=u[f])})},wce=(t,e,r)=>{function o(u,f=[],y=[]){Object.entries(u).forEach(([T,a])=>{(!r||r&&!r([...f,T]))&&a!=null&&(typeof a=="object"&&Object.keys(a).length>0?o(a,[...f,T],Array.isArray(a)?[...y,T]:y):e([...f,T],a,y))})}o(t)},Tce=(t,e)=>typeof e=="number"?["lineHeight","fontWeight","opacity","zIndex"].some(o=>t.includes(o))||t[t.length-1].toLowerCase().indexOf("opacity")>=0?e:`${e}px`:e;function jP(t,e){const{prefix:r,shouldSkipGeneratingVar:o}=e||{},u={},f={},y={};return wce(t,(T,a,A)=>{if((typeof a=="string"||typeof a=="number")&&(!o||!o(T,a))){const D=`--${r?`${r}-`:""}${T.join("-")}`,O=Tce(T,a);Object.assign(u,{[D]:O}),yU(f,T,`var(${D})`,A),yU(y,T,`var(${D}, ${O})`,A)}},T=>T[0]==="vars"),{css:u,vars:f,varsWithDefaults:y}}function Ece(t,e={}){const{getSelector:r=se,disableCssColorScheme:o,colorSchemeSelector:u}=e,{colorSchemes:f={},components:y,defaultColorScheme:T="light",...a}=t,{vars:A,css:D,varsWithDefaults:O}=jP(a,e);let B=O;const H={},{[T]:Q,...re}=f;if(Object.entries(re||{}).forEach(([Z,fe])=>{const{vars:Te,css:Pe,varsWithDefaults:ce}=jP(fe,e);B=Ho(B,ce),H[Z]={css:Pe,vars:Te}}),Q){const{css:Z,vars:fe,varsWithDefaults:Te}=jP(Q,e);B=Ho(B,Te),H[T]={css:Z,vars:fe}}function se(Z,fe){var Pe,ce;let Te=u;if(u==="class"&&(Te=".%s"),u==="data"&&(Te="[data-%s]"),u!=null&&u.startsWith("data-")&&!u.includes("%s")&&(Te=`[${u}="%s"]`),Z){if(Te==="media")return t.defaultColorScheme===Z?":root":{[`@media (prefers-color-scheme: ${((ce=(Pe=f[Z])==null?void 0:Pe.palette)==null?void 0:ce.mode)||Z})`]:{":root":fe}};if(Te)return t.defaultColorScheme===Z?`:root, ${Te.replace("%s",String(Z))}`:Te.replace("%s",String(Z))}return":root"}return{vars:B,generateThemeVars:()=>{let Z={...A};return Object.entries(H).forEach(([,{vars:fe}])=>{Z=Ho(Z,fe)}),Z},generateStyleSheets:()=>{var he,W;const Z=[],fe=t.defaultColorScheme||"light";function Te(ge,_e){Object.keys(_e).length&&Z.push(typeof ge=="string"?{[ge]:{..._e}}:ge)}Te(r(void 0,{...D}),D);const{[fe]:Pe,...ce}=H;if(Pe){const{css:ge}=Pe,_e=(W=(he=f[fe])==null?void 0:he.palette)==null?void 0:W.mode,Ee=!o&&_e?{colorScheme:_e,...ge}:{...ge};Te(r(fe,{...Ee}),Ee)}return Object.entries(ce).forEach(([ge,{css:_e}])=>{var xt,Rt;const Ee=(Rt=(xt=f[ge])==null?void 0:xt.palette)==null?void 0:Rt.mode,we=!o&&Ee?{colorScheme:Ee,..._e}:{..._e};Te(r(ge,{...we}),we)}),Z}}}function Sce(t){return function(r){return t==="media"?`@media (prefers-color-scheme: ${r})`:t?t.startsWith("data-")&&!t.includes("%s")?`[${t}="${r}"] &`:t==="class"?`.${r} &`:t==="data"?`[data-${r}] &`:`${t.replace("%s",r)} &`:"&"}}const vU={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:xx.white,default:xx.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},$P={text:{primary:xx.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:xx.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function xU(t,e,r,o){const u=o.light||o,f=o.dark||o*1.5;t[e]||(t.hasOwnProperty(r)?t[e]=t[r]:e==="light"?t.light=fO(t.main,u):e==="dark"&&(t.dark=dO(t.main,f)))}function Ice(t="light"){return t==="dark"?{main:Og[200],light:Og[50],dark:Og[400]}:{main:Og[700],light:Og[400],dark:Og[800]}}function Ace(t="light"){return t==="dark"?{main:Dg[200],light:Dg[50],dark:Dg[400]}:{main:Dg[500],light:Dg[300],dark:Dg[700]}}function Cce(t="light"){return t==="dark"?{main:kg[500],light:kg[300],dark:kg[700]}:{main:kg[700],light:kg[400],dark:kg[800]}}function Pce(t="light"){return t==="dark"?{main:Lg[400],light:Lg[300],dark:Lg[700]}:{main:Lg[700],light:Lg[500],dark:Lg[900]}}function Rce(t="light"){return t==="dark"?{main:zg[400],light:zg[300],dark:zg[700]}:{main:zg[800],light:zg[500],dark:zg[900]}}function Mce(t="light"){return t==="dark"?{main:X0[400],light:X0[300],dark:X0[700]}:{main:"#ed6c02",light:X0[500],dark:X0[900]}}function gO(t){const{mode:e="light",contrastThreshold:r=3,tonalOffset:o=.2,...u}=t,f=t.primary||Ice(e),y=t.secondary||Ace(e),T=t.error||Cce(e),a=t.info||Pce(e),A=t.success||Rce(e),D=t.warning||Mce(e);function O(re){return uce(re,$P.text.primary)>=r?$P.text.primary:vU.text.primary}const B=({color:re,name:se,mainShade:G=500,lightShade:Y=300,darkShade:Z=700})=>{if(re={...re},!re.main&&re[G]&&(re.main=re[G]),!re.hasOwnProperty("main"))throw new Error(Oh(11,se?` (${se})`:"",G));if(typeof re.main!="string")throw new Error(Oh(12,se?` (${se})`:"",JSON.stringify(re.main)));return xU(re,"light",Y,o),xU(re,"dark",Z,o),re.contrastText||(re.contrastText=O(re.main)),re},H={dark:$P,light:vU};return Ho({common:{...xx},mode:e,primary:B({color:f,name:"primary"}),secondary:B({color:y,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:B({color:T,name:"error"}),warning:B({color:D,name:"warning"}),info:B({color:a,name:"info"}),success:B({color:A,name:"success"}),grey:Uoe,contrastThreshold:r,getContrastText:O,augmentColor:B,tonalOffset:o,...H[e]},u)}function kce(t){const e={};return Object.entries(t).forEach(o=>{const[u,f]=o;typeof f=="object"&&(e[u]=`${f.fontStyle?`${f.fontStyle} `:""}${f.fontVariant?`${f.fontVariant} `:""}${f.fontWeight?`${f.fontWeight} `:""}${f.fontStretch?`${f.fontStretch} `:""}${f.fontSize||""}${f.lineHeight?`/${f.lineHeight} `:""}${f.fontFamily||""}`)}),e}function Dce(t,e){return{toolbar:{minHeight:56,[t.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[t.up("sm")]:{minHeight:64}},...e}}function Oce(t){return Math.round(t*1e5)/1e5}const bU={textTransform:"uppercase"},wU='"Roboto", "Helvetica", "Arial", sans-serif';function Lce(t,e){const{fontFamily:r=wU,fontSize:o=14,fontWeightLight:u=300,fontWeightRegular:f=400,fontWeightMedium:y=500,fontWeightBold:T=700,htmlFontSize:a=16,allVariants:A,pxToRem:D,...O}=typeof e=="function"?e(t):e,B=o/14,H=D||(se=>`${se/a*B}rem`),Q=(se,G,Y,Z,fe)=>({fontFamily:r,fontWeight:se,fontSize:H(G),lineHeight:Y,...r===wU?{letterSpacing:`${Oce(Z/G)}em`}:{},...fe,...A}),re={h1:Q(u,96,1.167,-1.5),h2:Q(u,60,1.2,-.5),h3:Q(f,48,1.167,0),h4:Q(f,34,1.235,.25),h5:Q(f,24,1.334,0),h6:Q(y,20,1.6,.15),subtitle1:Q(f,16,1.75,.15),subtitle2:Q(y,14,1.57,.1),body1:Q(f,16,1.5,.15),body2:Q(f,14,1.43,.15),button:Q(y,14,1.75,.4,bU),caption:Q(f,12,1.66,.4),overline:Q(f,12,2.66,1,bU),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return Ho({htmlFontSize:a,pxToRem:H,fontFamily:r,fontSize:o,fontWeightLight:u,fontWeightRegular:f,fontWeightMedium:y,fontWeightBold:T,...re},O,{clone:!1})}const zce=.2,Nce=.14,Fce=.12;function rs(...t){return[`${t[0]}px ${t[1]}px ${t[2]}px ${t[3]}px rgba(0,0,0,${zce})`,`${t[4]}px ${t[5]}px ${t[6]}px ${t[7]}px rgba(0,0,0,${Nce})`,`${t[8]}px ${t[9]}px ${t[10]}px ${t[11]}px rgba(0,0,0,${Fce})`].join(",")}const Bce=["none",rs(0,2,1,-1,0,1,1,0,0,1,3,0),rs(0,3,1,-2,0,2,2,0,0,1,5,0),rs(0,3,3,-2,0,3,4,0,0,1,8,0),rs(0,2,4,-1,0,4,5,0,0,1,10,0),rs(0,3,5,-1,0,5,8,0,0,1,14,0),rs(0,3,5,-1,0,6,10,0,0,1,18,0),rs(0,4,5,-2,0,7,10,1,0,2,16,1),rs(0,5,5,-3,0,8,10,1,0,3,14,2),rs(0,5,6,-3,0,9,12,1,0,3,16,2),rs(0,6,6,-3,0,10,14,1,0,4,18,3),rs(0,6,7,-4,0,11,15,1,0,4,20,3),rs(0,7,8,-4,0,12,17,2,0,5,22,4),rs(0,7,8,-4,0,13,19,2,0,5,24,4),rs(0,7,9,-4,0,14,21,2,0,5,26,4),rs(0,8,9,-5,0,15,22,2,0,6,28,5),rs(0,8,10,-5,0,16,24,2,0,6,30,5),rs(0,8,11,-5,0,17,26,2,0,6,32,5),rs(0,9,11,-5,0,18,28,2,0,7,34,6),rs(0,9,12,-6,0,19,29,2,0,7,36,6),rs(0,10,13,-6,0,20,31,3,0,8,38,7),rs(0,10,13,-6,0,21,33,3,0,8,40,7),rs(0,10,14,-6,0,22,35,3,0,8,42,7),rs(0,11,14,-7,0,23,36,3,0,9,44,8),rs(0,11,15,-7,0,24,38,3,0,9,46,8)],Uce={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},Vce={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function TU(t){return`${Math.round(t)}ms`}function jce(t){if(!t)return 0;const e=t/36;return Math.min(Math.round((4+15*e**.25+e/5)*10),3e3)}function $ce(t){const e={...Uce,...t.easing},r={...Vce,...t.duration};return{getAutoHeightDuration:jce,create:(u=["all"],f={})=>{const{duration:y=r.standard,easing:T=e.easeInOut,delay:a=0,...A}=f;return(Array.isArray(u)?u:[u]).map(D=>`${D} ${typeof y=="string"?y:TU(y)} ${T} ${typeof a=="string"?a:TU(a)}`).join(",")},...t,easing:e,duration:r}}const Gce={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};function HM(t={},...e){const{breakpoints:r,mixins:o={},spacing:u,palette:f={},transitions:y={},typography:T={},shape:a,...A}=t;if(t.vars)throw new Error(Oh(20));const D=gO(f),O=aO(t);let B=Ho(O,{mixins:Dce(O.breakpoints,o),palette:D,shadows:Bce.slice(),typography:Lce(D,T),transitions:$ce(y),zIndex:{...Gce}});return B=Ho(B,A),B=e.reduce((H,Q)=>Ho(H,Q),B),B.unstable_sxConfig={...o1,...A==null?void 0:A.unstable_sxConfig},B.unstable_sx=function(Q){return a1({sx:Q,theme:this})},B}function ZM(t){let e;return t<1?e=5.11916*t**2:e=4.5*Math.log(t+1)+2,Math.round(e*10)/1e3}const qce=[...Array(25)].map((t,e)=>{if(e===0)return;const r=ZM(e);return`linear-gradient(rgba(255 255 255 / ${r}), rgba(255 255 255 / ${r}))`});function CG(t){return{inputPlaceholder:t==="dark"?.5:.42,inputUnderline:t==="dark"?.7:.42,switchTrackDisabled:t==="dark"?.2:.12,switchTrack:t==="dark"?.3:.38}}function PG(t){return t==="dark"?qce:[]}function Wce(t){const{palette:e={mode:"light"},opacity:r,overlays:o,...u}=t,f=gO(e);return{palette:f,opacity:{...CG(f.mode),...r},overlays:o||PG(f.mode),...u}}function Hce(t){var e;return!!t[0].match(/(cssVarPrefix|colorSchemeSelector|typography|mixins|breakpoints|direction|transitions)/)||!!t[0].match(/sxConfig$/)||t[0]==="palette"&&!!((e=t[1])!=null&&e.match(/(mode|contrastThreshold|tonalOffset)/))}const Zce=t=>[...[...Array(24)].map((e,r)=>`--${t?`${t}-`:""}overlays-${r+1}`),`--${t?`${t}-`:""}palette-AppBar-darkBg`,`--${t?`${t}-`:""}palette-AppBar-darkColor`],Xce=t=>(e,r)=>{const o=t.colorSchemeSelector;let u=o;if(o==="class"&&(u=".%s"),o==="data"&&(u="[data-%s]"),o!=null&&o.startsWith("data-")&&!o.includes("%s")&&(u=`[${o}="%s"]`),t.defaultColorScheme===e){if(e==="dark"){const f={};return Zce(t.cssVarPrefix).forEach(y=>{f[y]=r[y],delete r[y]}),u==="media"?{":root":r,"@media (prefers-color-scheme: dark)":{":root":f}}:u?{[u.replace("%s",e)]:f,[`:root, ${u.replace("%s",e)}`]:r}:{":root":{...r,...f}}}if(u&&u!=="media")return`:root, ${u.replace("%s",String(e))}`}else if(e){if(u==="media")return{[`@media (prefers-color-scheme: ${String(e)})`]:{":root":r}};if(u)return u.replace("%s",String(e))}return":root"};function Kce(t){return pu(t)||typeof t>"u"||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||Array.isArray(t)}function Yce(t={}){const e={...t};function r(o){const u=Object.entries(o);for(let f=0;f<u.length;f++){const[y,T]=u[f];!Kce(T)||y.startsWith("unstable_")?delete o[y]:pu(T)&&(o[y]={...T},r(o[y]))}}return r(e),`import { unstable_createBreakpoints as createBreakpoints, createTransitions } from '@mui/material/styles';

const theme = ${JSON.stringify(e,null,2)};

theme.breakpoints = createBreakpoints(theme.breakpoints || {});
theme.transitions = createTransitions(theme.transitions || {});

export default theme;`}function Qce(t,e){e.forEach(r=>{t[r]||(t[r]={})})}function Vt(t,e,r){!t[e]&&r&&(t[e]=r)}function pv(t){return!t||!t.startsWith("hsl")?t:yG(t)}function ah(t,e){`${e}Channel`in t||(t[`${e}Channel`]=fv(pv(t[e]),`MUI: Can't create \`palette.${e}Channel\` because \`palette.${e}\` is not one of these formats: #nnn, #nnnnnn, rgb(), rgba(), hsl(), hsla(), color().
To suppress this warning, you need to explicitly provide the \`palette.${e}Channel\` as a string (in rgb format, for example "12 12 12") or undefined if you want to remove the channel token.`))}function Jce(t){return typeof t=="number"?`${t}px`:typeof t=="string"||typeof t=="function"||Array.isArray(t)?t:"8px"}const iu=t=>{try{return t()}catch{}},eue=(t="mui")=>bce(t);function GP(t,e,r,o){if(!e)return;e=e===!0?{}:e;const u=o==="dark"?"dark":"light";if(!r){t[o]=Wce({...e,palette:{mode:u,...e==null?void 0:e.palette}});return}const{palette:f,...y}=HM({...r,palette:{mode:u,...e==null?void 0:e.palette}});return t[o]={...e,palette:f,opacity:{...CG(u),...e==null?void 0:e.opacity},overlays:(e==null?void 0:e.overlays)||PG(u)},y}function tue(t={},...e){const{colorSchemes:r={light:!0},defaultColorScheme:o,disableCssColorScheme:u=!1,cssVarPrefix:f="mui",shouldSkipGeneratingVar:y=Hce,colorSchemeSelector:T=r.light&&r.dark?"media":void 0,...a}=t,A=Object.keys(r)[0],D=o||(r.light&&A!=="light"?"light":A),O=eue(f),{[D]:B,light:H,dark:Q,...re}=r,se={...re};let G=B;if((D==="dark"&&!("dark"in r)||D==="light"&&!("light"in r))&&(G=!0),!G)throw new Error(Oh(21,D));const Y=GP(se,G,a,D);H&&!se.light&&GP(se,H,void 0,"light"),Q&&!se.dark&&GP(se,Q,void 0,"dark");let Z={defaultColorScheme:D,...Y,cssVarPrefix:f,colorSchemeSelector:T,getCssVar:O,colorSchemes:se,font:{...kce(Y.typography),...Y.font},spacing:Jce(a.spacing)};Object.keys(Z.colorSchemes).forEach(he=>{const W=Z.colorSchemes[he].palette,ge=_e=>{const Ee=_e.split("-"),we=Ee[1],xt=Ee[2];return O(_e,W[we][xt])};if(W.mode==="light"&&(Vt(W.common,"background","#fff"),Vt(W.common,"onBackground","#000")),W.mode==="dark"&&(Vt(W.common,"background","#000"),Vt(W.common,"onBackground","#fff")),Qce(W,["Alert","AppBar","Avatar","Button","Chip","FilledInput","LinearProgress","Skeleton","Slider","SnackbarContent","SpeedDialAction","StepConnector","StepContent","Switch","TableCell","Tooltip"]),W.mode==="light"){Vt(W.Alert,"errorColor",Mi(W.error.light,.6)),Vt(W.Alert,"infoColor",Mi(W.info.light,.6)),Vt(W.Alert,"successColor",Mi(W.success.light,.6)),Vt(W.Alert,"warningColor",Mi(W.warning.light,.6)),Vt(W.Alert,"errorFilledBg",ge("palette-error-main")),Vt(W.Alert,"infoFilledBg",ge("palette-info-main")),Vt(W.Alert,"successFilledBg",ge("palette-success-main")),Vt(W.Alert,"warningFilledBg",ge("palette-warning-main")),Vt(W.Alert,"errorFilledColor",iu(()=>W.getContrastText(W.error.main))),Vt(W.Alert,"infoFilledColor",iu(()=>W.getContrastText(W.info.main))),Vt(W.Alert,"successFilledColor",iu(()=>W.getContrastText(W.success.main))),Vt(W.Alert,"warningFilledColor",iu(()=>W.getContrastText(W.warning.main))),Vt(W.Alert,"errorStandardBg",ki(W.error.light,.9)),Vt(W.Alert,"infoStandardBg",ki(W.info.light,.9)),Vt(W.Alert,"successStandardBg",ki(W.success.light,.9)),Vt(W.Alert,"warningStandardBg",ki(W.warning.light,.9)),Vt(W.Alert,"errorIconColor",ge("palette-error-main")),Vt(W.Alert,"infoIconColor",ge("palette-info-main")),Vt(W.Alert,"successIconColor",ge("palette-success-main")),Vt(W.Alert,"warningIconColor",ge("palette-warning-main")),Vt(W.AppBar,"defaultBg",ge("palette-grey-100")),Vt(W.Avatar,"defaultBg",ge("palette-grey-400")),Vt(W.Button,"inheritContainedBg",ge("palette-grey-300")),Vt(W.Button,"inheritContainedHoverBg",ge("palette-grey-A100")),Vt(W.Chip,"defaultBorder",ge("palette-grey-400")),Vt(W.Chip,"defaultAvatarColor",ge("palette-grey-700")),Vt(W.Chip,"defaultIconColor",ge("palette-grey-700")),Vt(W.FilledInput,"bg","rgba(0, 0, 0, 0.06)"),Vt(W.FilledInput,"hoverBg","rgba(0, 0, 0, 0.09)"),Vt(W.FilledInput,"disabledBg","rgba(0, 0, 0, 0.12)"),Vt(W.LinearProgress,"primaryBg",ki(W.primary.main,.62)),Vt(W.LinearProgress,"secondaryBg",ki(W.secondary.main,.62)),Vt(W.LinearProgress,"errorBg",ki(W.error.main,.62)),Vt(W.LinearProgress,"infoBg",ki(W.info.main,.62)),Vt(W.LinearProgress,"successBg",ki(W.success.main,.62)),Vt(W.LinearProgress,"warningBg",ki(W.warning.main,.62)),Vt(W.Skeleton,"bg",`rgba(${ge("palette-text-primaryChannel")} / 0.11)`),Vt(W.Slider,"primaryTrack",ki(W.primary.main,.62)),Vt(W.Slider,"secondaryTrack",ki(W.secondary.main,.62)),Vt(W.Slider,"errorTrack",ki(W.error.main,.62)),Vt(W.Slider,"infoTrack",ki(W.info.main,.62)),Vt(W.Slider,"successTrack",ki(W.success.main,.62)),Vt(W.Slider,"warningTrack",ki(W.warning.main,.62));const _e=Fw(W.background.default,.8);Vt(W.SnackbarContent,"bg",_e),Vt(W.SnackbarContent,"color",iu(()=>W.getContrastText(_e))),Vt(W.SpeedDialAction,"fabHoverBg",Fw(W.background.paper,.15)),Vt(W.StepConnector,"border",ge("palette-grey-400")),Vt(W.StepContent,"border",ge("palette-grey-400")),Vt(W.Switch,"defaultColor",ge("palette-common-white")),Vt(W.Switch,"defaultDisabledColor",ge("palette-grey-100")),Vt(W.Switch,"primaryDisabledColor",ki(W.primary.main,.62)),Vt(W.Switch,"secondaryDisabledColor",ki(W.secondary.main,.62)),Vt(W.Switch,"errorDisabledColor",ki(W.error.main,.62)),Vt(W.Switch,"infoDisabledColor",ki(W.info.main,.62)),Vt(W.Switch,"successDisabledColor",ki(W.success.main,.62)),Vt(W.Switch,"warningDisabledColor",ki(W.warning.main,.62)),Vt(W.TableCell,"border",ki(Nw(W.divider,1),.88)),Vt(W.Tooltip,"bg",Nw(W.grey[700],.92))}if(W.mode==="dark"){Vt(W.Alert,"errorColor",ki(W.error.light,.6)),Vt(W.Alert,"infoColor",ki(W.info.light,.6)),Vt(W.Alert,"successColor",ki(W.success.light,.6)),Vt(W.Alert,"warningColor",ki(W.warning.light,.6)),Vt(W.Alert,"errorFilledBg",ge("palette-error-dark")),Vt(W.Alert,"infoFilledBg",ge("palette-info-dark")),Vt(W.Alert,"successFilledBg",ge("palette-success-dark")),Vt(W.Alert,"warningFilledBg",ge("palette-warning-dark")),Vt(W.Alert,"errorFilledColor",iu(()=>W.getContrastText(W.error.dark))),Vt(W.Alert,"infoFilledColor",iu(()=>W.getContrastText(W.info.dark))),Vt(W.Alert,"successFilledColor",iu(()=>W.getContrastText(W.success.dark))),Vt(W.Alert,"warningFilledColor",iu(()=>W.getContrastText(W.warning.dark))),Vt(W.Alert,"errorStandardBg",Mi(W.error.light,.9)),Vt(W.Alert,"infoStandardBg",Mi(W.info.light,.9)),Vt(W.Alert,"successStandardBg",Mi(W.success.light,.9)),Vt(W.Alert,"warningStandardBg",Mi(W.warning.light,.9)),Vt(W.Alert,"errorIconColor",ge("palette-error-main")),Vt(W.Alert,"infoIconColor",ge("palette-info-main")),Vt(W.Alert,"successIconColor",ge("palette-success-main")),Vt(W.Alert,"warningIconColor",ge("palette-warning-main")),Vt(W.AppBar,"defaultBg",ge("palette-grey-900")),Vt(W.AppBar,"darkBg",ge("palette-background-paper")),Vt(W.AppBar,"darkColor",ge("palette-text-primary")),Vt(W.Avatar,"defaultBg",ge("palette-grey-600")),Vt(W.Button,"inheritContainedBg",ge("palette-grey-800")),Vt(W.Button,"inheritContainedHoverBg",ge("palette-grey-700")),Vt(W.Chip,"defaultBorder",ge("palette-grey-700")),Vt(W.Chip,"defaultAvatarColor",ge("palette-grey-300")),Vt(W.Chip,"defaultIconColor",ge("palette-grey-300")),Vt(W.FilledInput,"bg","rgba(255, 255, 255, 0.09)"),Vt(W.FilledInput,"hoverBg","rgba(255, 255, 255, 0.13)"),Vt(W.FilledInput,"disabledBg","rgba(255, 255, 255, 0.12)"),Vt(W.LinearProgress,"primaryBg",Mi(W.primary.main,.5)),Vt(W.LinearProgress,"secondaryBg",Mi(W.secondary.main,.5)),Vt(W.LinearProgress,"errorBg",Mi(W.error.main,.5)),Vt(W.LinearProgress,"infoBg",Mi(W.info.main,.5)),Vt(W.LinearProgress,"successBg",Mi(W.success.main,.5)),Vt(W.LinearProgress,"warningBg",Mi(W.warning.main,.5)),Vt(W.Skeleton,"bg",`rgba(${ge("palette-text-primaryChannel")} / 0.13)`),Vt(W.Slider,"primaryTrack",Mi(W.primary.main,.5)),Vt(W.Slider,"secondaryTrack",Mi(W.secondary.main,.5)),Vt(W.Slider,"errorTrack",Mi(W.error.main,.5)),Vt(W.Slider,"infoTrack",Mi(W.info.main,.5)),Vt(W.Slider,"successTrack",Mi(W.success.main,.5)),Vt(W.Slider,"warningTrack",Mi(W.warning.main,.5));const _e=Fw(W.background.default,.98);Vt(W.SnackbarContent,"bg",_e),Vt(W.SnackbarContent,"color",iu(()=>W.getContrastText(_e))),Vt(W.SpeedDialAction,"fabHoverBg",Fw(W.background.paper,.15)),Vt(W.StepConnector,"border",ge("palette-grey-600")),Vt(W.StepContent,"border",ge("palette-grey-600")),Vt(W.Switch,"defaultColor",ge("palette-grey-300")),Vt(W.Switch,"defaultDisabledColor",ge("palette-grey-600")),Vt(W.Switch,"primaryDisabledColor",Mi(W.primary.main,.55)),Vt(W.Switch,"secondaryDisabledColor",Mi(W.secondary.main,.55)),Vt(W.Switch,"errorDisabledColor",Mi(W.error.main,.55)),Vt(W.Switch,"infoDisabledColor",Mi(W.info.main,.55)),Vt(W.Switch,"successDisabledColor",Mi(W.success.main,.55)),Vt(W.Switch,"warningDisabledColor",Mi(W.warning.main,.55)),Vt(W.TableCell,"border",Mi(Nw(W.divider,1),.68)),Vt(W.Tooltip,"bg",Nw(W.grey[700],.92))}ah(W.background,"default"),ah(W.background,"paper"),ah(W.common,"background"),ah(W.common,"onBackground"),ah(W,"divider"),Object.keys(W).forEach(_e=>{const Ee=W[_e];Ee&&typeof Ee=="object"&&(Ee.main&&Vt(W[_e],"mainChannel",fv(pv(Ee.main))),Ee.light&&Vt(W[_e],"lightChannel",fv(pv(Ee.light))),Ee.dark&&Vt(W[_e],"darkChannel",fv(pv(Ee.dark))),Ee.contrastText&&Vt(W[_e],"contrastTextChannel",fv(pv(Ee.contrastText))),_e==="text"&&(ah(W[_e],"primary"),ah(W[_e],"secondary")),_e==="action"&&(Ee.active&&ah(W[_e],"active"),Ee.selected&&ah(W[_e],"selected")))})}),Z=e.reduce((he,W)=>Ho(he,W),Z);const fe={prefix:f,disableCssColorScheme:u,shouldSkipGeneratingVar:y,getSelector:Xce(Z)},{vars:Te,generateThemeVars:Pe,generateStyleSheets:ce}=Ece(Z,fe);return Z.vars=Te,Object.entries(Z.colorSchemes[Z.defaultColorScheme]).forEach(([he,W])=>{Z[he]=W}),Z.generateThemeVars=Pe,Z.generateStyleSheets=ce,Z.generateSpacing=function(){return pG(a.spacing,sO(this))},Z.getColorSchemeSelector=Sce(T),Z.spacing=Z.generateSpacing(),Z.shouldSkipGeneratingVar=y,Z.unstable_sxConfig={...o1,...a==null?void 0:a.unstable_sxConfig},Z.unstable_sx=function(W){return a1({sx:W,theme:this})},Z.toRuntimeSource=Yce,Z}function EU(t,e,r){t.colorSchemes&&r&&(t.colorSchemes[e]={...r!==!0&&r,palette:gO({...r===!0?{}:r.palette,mode:e})})}function nue(t={},...e){const{palette:r,cssVariables:o=!1,colorSchemes:u=r?void 0:{light:!0},defaultColorScheme:f=r==null?void 0:r.mode,...y}=t,T=f||"light",a=u==null?void 0:u[T],A={...u,...r?{[T]:{...typeof a!="boolean"&&a,palette:r}}:void 0};if(o===!1){if(!("colorSchemes"in t))return HM(t,...e);let D=r;"palette"in t||A[T]&&(A[T]!==!0?D=A[T].palette:T==="dark"&&(D={mode:"dark"}));const O=HM({...t,palette:D},...e);return O.defaultColorScheme=T,O.colorSchemes=A,O.palette.mode==="light"&&(O.colorSchemes.light={...A.light!==!0&&A.light,palette:O.palette},EU(O,"dark",A.dark)),O.palette.mode==="dark"&&(O.colorSchemes.dark={...A.dark!==!0&&A.dark,palette:O.palette},EU(O,"light",A.light)),O}return!r&&!("light"in A)&&T==="light"&&(A.light=!0),tue({...y,colorSchemes:A,defaultColorScheme:T,...typeof o!="boolean"&&o},...e)}const pI=nue();function _O(){const t=lO(pI);return t[WS]||t}function rue({props:t,name:e}){return oce({props:t,name:e,defaultTheme:pI,themeId:WS})}function RG(t){return t!=="ownerState"&&t!=="theme"&&t!=="sx"&&t!=="as"}const Ba=t=>RG(t)&&t!=="classes",Hn=_G({themeId:WS,defaultTheme:pI,rootShouldForwardProp:Ba});function iue(t){return J.jsx(Wle,{...t,defaultTheme:pI,themeId:WS})}function sue(t){return function(r){return J.jsx(iue,{styles:typeof t=="function"?o=>t({theme:o,...r}):t})}}function oue(){return Zle}const SU={theme:void 0};function Yi(t){let e,r;return o=>{let u=e;return(u===void 0||o.theme!==r)&&(SU.theme=o.theme,u=t(SU),e=u,r=o.theme),u}}function Qi(t){return xce(t)}function aue(t){return wi("MuiSvgIcon",t)}Ti("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const lue=t=>{const{color:e,fontSize:r,classes:o}=t,u={root:["root",e!=="inherit"&&`color${Wn(e)}`,`fontSize${Wn(r)}`]};return Ii(u,aue,o)},cue=Hn("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.color!=="inherit"&&e[`color${Wn(r.color)}`],e[`fontSize${Wn(r.fontSize)}`]]}})(Yi(({theme:t})=>{var e,r,o,u,f,y,T,a,A,D,O,B,H,Q;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",flexShrink:0,transition:(u=(e=t.transitions)==null?void 0:e.create)==null?void 0:u.call(e,"fill",{duration:(o=(r=(t.vars??t).transitions)==null?void 0:r.duration)==null?void 0:o.shorter}),variants:[{props:re=>!re.hasSvgAsChild,style:{fill:"currentColor"}},{props:{fontSize:"inherit"},style:{fontSize:"inherit"}},{props:{fontSize:"small"},style:{fontSize:((y=(f=t.typography)==null?void 0:f.pxToRem)==null?void 0:y.call(f,20))||"1.25rem"}},{props:{fontSize:"medium"},style:{fontSize:((a=(T=t.typography)==null?void 0:T.pxToRem)==null?void 0:a.call(T,24))||"1.5rem"}},{props:{fontSize:"large"},style:{fontSize:((D=(A=t.typography)==null?void 0:A.pxToRem)==null?void 0:D.call(A,35))||"2.1875rem"}},...Object.entries((t.vars??t).palette).filter(([,re])=>re&&re.main).map(([re])=>{var se,G;return{props:{color:re},style:{color:(G=(se=(t.vars??t).palette)==null?void 0:se[re])==null?void 0:G.main}}}),{props:{color:"action"},style:{color:(B=(O=(t.vars??t).palette)==null?void 0:O.action)==null?void 0:B.active}},{props:{color:"disabled"},style:{color:(Q=(H=(t.vars??t).palette)==null?void 0:H.action)==null?void 0:Q.disabled}},{props:{color:"inherit"},style:{color:void 0}}]}})),SE=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiSvgIcon"}),{children:u,className:f,color:y="inherit",component:T="svg",fontSize:a="medium",htmlColor:A,inheritViewBox:D=!1,titleAccess:O,viewBox:B="0 0 24 24",...H}=o,Q=ue.isValidElement(u)&&u.type==="svg",re={...o,color:y,component:T,fontSize:a,instanceFontSize:e.fontSize,inheritViewBox:D,viewBox:B,hasSvgAsChild:Q},se={};D||(se.viewBox=B);const G=lue(re);return J.jsxs(cue,{as:T,className:Mr(G.root,f),focusable:"false",color:A,"aria-hidden":O?void 0:!0,role:O?"img":void 0,ref:r,...se,...H,...Q&&u.props,ownerState:re,children:[Q?u.props.children:u,O?J.jsx("title",{children:O}):null]})});SE&&(SE.muiName="SvgIcon");function hy(t,e){function r(o,u){return J.jsx(SE,{"data-testid":`${e}Icon`,ref:u,...o,children:t})}return r.muiName=SE.muiName,ue.memo(ue.forwardRef(r))}function MG(t,e){if(t==null)return{};var r={};for(var o in t)if({}.hasOwnProperty.call(t,o)){if(e.includes(o))continue;r[o]=t[o]}return r}function XM(t,e){return XM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},XM(t,e)}function kG(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,XM(t,e)}const IU={disabled:!1},IE=vi.createContext(null);var uue=function(e){return e.scrollTop},mv="unmounted",Pp="exited",Rp="entering",qg="entered",KM="exiting",Mu=function(t){kG(e,t);function e(o,u){var f;f=t.call(this,o,u)||this;var y=u,T=y&&!y.isMounting?o.enter:o.appear,a;return f.appearStatus=null,o.in?T?(a=Pp,f.appearStatus=Rp):a=qg:o.unmountOnExit||o.mountOnEnter?a=mv:a=Pp,f.state={status:a},f.nextCallback=null,f}e.getDerivedStateFromProps=function(u,f){var y=u.in;return y&&f.status===mv?{status:Pp}:null};var r=e.prototype;return r.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},r.componentDidUpdate=function(u){var f=null;if(u!==this.props){var y=this.state.status;this.props.in?y!==Rp&&y!==qg&&(f=Rp):(y===Rp||y===qg)&&(f=KM)}this.updateStatus(!1,f)},r.componentWillUnmount=function(){this.cancelNextCallback()},r.getTimeouts=function(){var u=this.props.timeout,f,y,T;return f=y=T=u,u!=null&&typeof u!="number"&&(f=u.exit,y=u.enter,T=u.appear!==void 0?u.appear:y),{exit:f,enter:y,appear:T}},r.updateStatus=function(u,f){if(u===void 0&&(u=!1),f!==null)if(this.cancelNextCallback(),f===Rp){if(this.props.unmountOnExit||this.props.mountOnEnter){var y=this.props.nodeRef?this.props.nodeRef.current:Sw.findDOMNode(this);y&&uue(y)}this.performEnter(u)}else this.performExit();else this.props.unmountOnExit&&this.state.status===Pp&&this.setState({status:mv})},r.performEnter=function(u){var f=this,y=this.props.enter,T=this.context?this.context.isMounting:u,a=this.props.nodeRef?[T]:[Sw.findDOMNode(this),T],A=a[0],D=a[1],O=this.getTimeouts(),B=T?O.appear:O.enter;if(!u&&!y||IU.disabled){this.safeSetState({status:qg},function(){f.props.onEntered(A)});return}this.props.onEnter(A,D),this.safeSetState({status:Rp},function(){f.props.onEntering(A,D),f.onTransitionEnd(B,function(){f.safeSetState({status:qg},function(){f.props.onEntered(A,D)})})})},r.performExit=function(){var u=this,f=this.props.exit,y=this.getTimeouts(),T=this.props.nodeRef?void 0:Sw.findDOMNode(this);if(!f||IU.disabled){this.safeSetState({status:Pp},function(){u.props.onExited(T)});return}this.props.onExit(T),this.safeSetState({status:KM},function(){u.props.onExiting(T),u.onTransitionEnd(y.exit,function(){u.safeSetState({status:Pp},function(){u.props.onExited(T)})})})},r.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},r.safeSetState=function(u,f){f=this.setNextCallback(f),this.setState(u,f)},r.setNextCallback=function(u){var f=this,y=!0;return this.nextCallback=function(T){y&&(y=!1,f.nextCallback=null,u(T))},this.nextCallback.cancel=function(){y=!1},this.nextCallback},r.onTransitionEnd=function(u,f){this.setNextCallback(f);var y=this.props.nodeRef?this.props.nodeRef.current:Sw.findDOMNode(this),T=u==null&&!this.props.addEndListener;if(!y||T){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var a=this.props.nodeRef?[this.nextCallback]:[y,this.nextCallback],A=a[0],D=a[1];this.props.addEndListener(A,D)}u!=null&&setTimeout(this.nextCallback,u)},r.render=function(){var u=this.state.status;if(u===mv)return null;var f=this.props,y=f.children;f.in,f.mountOnEnter,f.unmountOnExit,f.appear,f.enter,f.exit,f.timeout,f.addEndListener,f.onEnter,f.onEntering,f.onEntered,f.onExit,f.onExiting,f.onExited,f.nodeRef;var T=MG(f,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return vi.createElement(IE.Provider,{value:null},typeof y=="function"?y(u,T):vi.cloneElement(vi.Children.only(y),T))},e}(vi.Component);Mu.contextType=IE;Mu.propTypes={};function Ng(){}Mu.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:Ng,onEntering:Ng,onEntered:Ng,onExit:Ng,onExiting:Ng,onExited:Ng};Mu.UNMOUNTED=mv;Mu.EXITED=Pp;Mu.ENTERING=Rp;Mu.ENTERED=qg;Mu.EXITING=KM;function hue(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function yO(t,e){var r=function(f){return e&&ue.isValidElement(f)?e(f):f},o=Object.create(null);return t&&ue.Children.map(t,function(u){return u}).forEach(function(u){o[u.key]=r(u)}),o}function due(t,e){t=t||{},e=e||{};function r(D){return D in e?e[D]:t[D]}var o=Object.create(null),u=[];for(var f in t)f in e?u.length&&(o[f]=u,u=[]):u.push(f);var y,T={};for(var a in e){if(o[a])for(y=0;y<o[a].length;y++){var A=o[a][y];T[o[a][y]]=r(A)}T[a]=r(a)}for(y=0;y<u.length;y++)T[u[y]]=r(u[y]);return T}function Fp(t,e,r){return r[e]!=null?r[e]:t.props[e]}function fue(t,e){return yO(t.children,function(r){return ue.cloneElement(r,{onExited:e.bind(null,r),in:!0,appear:Fp(r,"appear",t),enter:Fp(r,"enter",t),exit:Fp(r,"exit",t)})})}function pue(t,e,r){var o=yO(t.children),u=due(e,o);return Object.keys(u).forEach(function(f){var y=u[f];if(ue.isValidElement(y)){var T=f in e,a=f in o,A=e[f],D=ue.isValidElement(A)&&!A.props.in;a&&(!T||D)?u[f]=ue.cloneElement(y,{onExited:r.bind(null,y),in:!0,exit:Fp(y,"exit",t),enter:Fp(y,"enter",t)}):!a&&T&&!D?u[f]=ue.cloneElement(y,{in:!1}):a&&T&&ue.isValidElement(A)&&(u[f]=ue.cloneElement(y,{onExited:r.bind(null,y),in:A.props.in,exit:Fp(y,"exit",t),enter:Fp(y,"enter",t)}))}}),u}var mue=Object.values||function(t){return Object.keys(t).map(function(e){return t[e]})},gue={component:"div",childFactory:function(e){return e}},vO=function(t){kG(e,t);function e(o,u){var f;f=t.call(this,o,u)||this;var y=f.handleExited.bind(hue(f));return f.state={contextValue:{isMounting:!0},handleExited:y,firstRender:!0},f}var r=e.prototype;return r.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},r.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(u,f){var y=f.children,T=f.handleExited,a=f.firstRender;return{children:a?fue(u,T):pue(u,y,T),firstRender:!1}},r.handleExited=function(u,f){var y=yO(this.props.children);u.key in y||(u.props.onExited&&u.props.onExited(f),this.mounted&&this.setState(function(T){var a=xE({},T.children);return delete a[u.key],{children:a}}))},r.render=function(){var u=this.props,f=u.component,y=u.childFactory,T=MG(u,["component","childFactory"]),a=this.state.contextValue,A=mue(this.state.children).map(y);return delete T.appear,delete T.enter,delete T.exit,f===null?vi.createElement(IE.Provider,{value:a},A):vi.createElement(IE.Provider,{value:a},vi.createElement(f,T,A))},e}(vi.Component);vO.propTypes={};vO.defaultProps=gue;const DG=t=>t.scrollTop;function AE(t,e){const{timeout:r,easing:o,style:u={}}=t;return{duration:u.transitionDuration??(typeof r=="number"?r:r[e.mode]||0),easing:u.transitionTimingFunction??(typeof o=="object"?o[e.mode]:o),delay:u.transitionDelay}}function _ue(t){return wi("MuiPaper",t)}Ti("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const yue=t=>{const{square:e,elevation:r,variant:o,classes:u}=t,f={root:["root",o,!e&&"rounded",o==="elevation"&&`elevation${r}`]};return Ii(f,_ue,u)},vue=Hn("div",{name:"MuiPaper",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,e[r.variant],!r.square&&e.rounded,r.variant==="elevation"&&e[`elevation${r.elevation}`]]}})(Yi(({theme:t})=>({backgroundColor:(t.vars||t).palette.background.paper,color:(t.vars||t).palette.text.primary,transition:t.transitions.create("box-shadow"),variants:[{props:({ownerState:e})=>!e.square,style:{borderRadius:t.shape.borderRadius}},{props:{variant:"outlined"},style:{border:`1px solid ${(t.vars||t).palette.divider}`}},{props:{variant:"elevation"},style:{boxShadow:"var(--Paper-shadow)",backgroundImage:"var(--Paper-overlay)"}}]}))),xue=ue.forwardRef(function(e,r){var H;const o=Qi({props:e,name:"MuiPaper"}),u=_O(),{className:f,component:y="div",elevation:T=1,square:a=!1,variant:A="elevation",...D}=o,O={...o,component:y,elevation:T,square:a,variant:A},B=yue(O);return J.jsx(vue,{as:y,ownerState:O,className:Mr(B.root,f),ref:r,...D,style:{...A==="elevation"&&{"--Paper-shadow":(u.vars||u).shadows[T],...u.vars&&{"--Paper-overlay":(H=u.vars.overlays)==null?void 0:H[T]},...!u.vars&&u.palette.mode==="dark"&&{"--Paper-overlay":`linear-gradient(${Dl("#fff",ZM(T))}, ${Dl("#fff",ZM(T))})`}},...D.style}})});function Ol(t,e){const{className:r,elementType:o,ownerState:u,externalForwardedProps:f,getSlotOwnerState:y,internalForwardedProps:T,...a}=e,{component:A,slots:D={[t]:void 0},slotProps:O={[t]:void 0},...B}=f,H=D[t]||o,Q=AG(O[t],u),{props:{component:re,...se},internalRef:G}=IG({className:r,...a,externalForwardedProps:t==="root"?B:void 0,externalSlotProps:Q}),Y=Po(G,Q==null?void 0:Q.ref,e.ref),Z=y?y(se):{},fe={...u,...Z},Te=t==="root"?re||A:re,Pe=EG(H,{...t==="root"&&!A&&!D[t]&&T,...t!=="root"&&!D[t]&&T,...se,...Te&&{as:Te},ref:Y},fe);return Object.keys(Z).forEach(ce=>{delete Pe[ce]}),[H,Pe]}class CE{constructor(){F0(this,"mountEffect",()=>{this.shouldMount&&!this.didMount&&this.ref.current!==null&&(this.didMount=!0,this.mounted.resolve())});this.ref={current:null},this.mounted=null,this.didMount=!1,this.shouldMount=!1,this.setShouldMount=null}static create(){return new CE}static use(){const e=xG(CE.create).current,[r,o]=ue.useState(!1);return e.shouldMount=r,e.setShouldMount=o,ue.useEffect(e.mountEffect,[r]),e}mount(){return this.mounted||(this.mounted=wue(),this.shouldMount=!0,this.setShouldMount(this.shouldMount)),this.mounted}start(...e){this.mount().then(()=>{var r;return(r=this.ref.current)==null?void 0:r.start(...e)})}stop(...e){this.mount().then(()=>{var r;return(r=this.ref.current)==null?void 0:r.stop(...e)})}pulsate(...e){this.mount().then(()=>{var r;return(r=this.ref.current)==null?void 0:r.pulsate(...e)})}}function bue(){return CE.use()}function wue(){let t,e;const r=new Promise((o,u)=>{t=o,e=u});return r.resolve=t,r.reject=e,r}function Tue(t){const{className:e,classes:r,pulsate:o=!1,rippleX:u,rippleY:f,rippleSize:y,in:T,onExited:a,timeout:A}=t,[D,O]=ue.useState(!1),B=Mr(e,r.ripple,r.rippleVisible,o&&r.ripplePulsate),H={width:y,height:y,top:-(y/2)+f,left:-(y/2)+u},Q=Mr(r.child,D&&r.childLeaving,o&&r.childPulsate);return!T&&!D&&O(!0),ue.useEffect(()=>{if(!T&&a!=null){const re=setTimeout(a,A);return()=>{clearTimeout(re)}}},[a,T,A]),J.jsx("span",{className:B,style:H,children:J.jsx("span",{className:Q})})}const Cl=Ti("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),YM=550,Eue=80,Sue=nO`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`,Iue=nO`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`,Aue=nO`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`,Cue=Hn("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),Pue=Hn(Tue,{name:"MuiTouchRipple",slot:"Ripple"})`
  opacity: 0;
  position: absolute;

  &.${Cl.rippleVisible} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${Sue};
    animation-duration: ${YM}ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
  }

  &.${Cl.ripplePulsate} {
    animation-duration: ${({theme:t})=>t.transitions.duration.shorter}ms;
  }

  & .${Cl.child} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${Cl.childLeaving} {
    opacity: 0;
    animation-name: ${Iue};
    animation-duration: ${YM}ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
  }

  & .${Cl.childPulsate} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${Aue};
    animation-duration: 2500ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`,Rue=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiTouchRipple"}),{center:u=!1,classes:f={},className:y,...T}=o,[a,A]=ue.useState([]),D=ue.useRef(0),O=ue.useRef(null);ue.useEffect(()=>{O.current&&(O.current(),O.current=null)},[a]);const B=ue.useRef(!1),H=bG(),Q=ue.useRef(null),re=ue.useRef(null),se=ue.useCallback(fe=>{const{pulsate:Te,rippleX:Pe,rippleY:ce,rippleSize:he,cb:W}=fe;A(ge=>[...ge,J.jsx(Pue,{classes:{ripple:Mr(f.ripple,Cl.ripple),rippleVisible:Mr(f.rippleVisible,Cl.rippleVisible),ripplePulsate:Mr(f.ripplePulsate,Cl.ripplePulsate),child:Mr(f.child,Cl.child),childLeaving:Mr(f.childLeaving,Cl.childLeaving),childPulsate:Mr(f.childPulsate,Cl.childPulsate)},timeout:YM,pulsate:Te,rippleX:Pe,rippleY:ce,rippleSize:he},D.current)]),D.current+=1,O.current=W},[f]),G=ue.useCallback((fe={},Te={},Pe=()=>{})=>{const{pulsate:ce=!1,center:he=u||Te.pulsate,fakeElement:W=!1}=Te;if((fe==null?void 0:fe.type)==="mousedown"&&B.current){B.current=!1;return}(fe==null?void 0:fe.type)==="touchstart"&&(B.current=!0);const ge=W?null:re.current,_e=ge?ge.getBoundingClientRect():{width:0,height:0,left:0,top:0};let Ee,we,xt;if(he||fe===void 0||fe.clientX===0&&fe.clientY===0||!fe.clientX&&!fe.touches)Ee=Math.round(_e.width/2),we=Math.round(_e.height/2);else{const{clientX:Rt,clientY:Bt}=fe.touches&&fe.touches.length>0?fe.touches[0]:fe;Ee=Math.round(Rt-_e.left),we=Math.round(Bt-_e.top)}if(he)xt=Math.sqrt((2*_e.width**2+_e.height**2)/3),xt%2===0&&(xt+=1);else{const Rt=Math.max(Math.abs((ge?ge.clientWidth:0)-Ee),Ee)*2+2,Bt=Math.max(Math.abs((ge?ge.clientHeight:0)-we),we)*2+2;xt=Math.sqrt(Rt**2+Bt**2)}fe!=null&&fe.touches?Q.current===null&&(Q.current=()=>{se({pulsate:ce,rippleX:Ee,rippleY:we,rippleSize:xt,cb:Pe})},H.start(Eue,()=>{Q.current&&(Q.current(),Q.current=null)})):se({pulsate:ce,rippleX:Ee,rippleY:we,rippleSize:xt,cb:Pe})},[u,se,H]),Y=ue.useCallback(()=>{G({},{pulsate:!0})},[G]),Z=ue.useCallback((fe,Te)=>{if(H.clear(),(fe==null?void 0:fe.type)==="touchend"&&Q.current){Q.current(),Q.current=null,H.start(0,()=>{Z(fe,Te)});return}Q.current=null,A(Pe=>Pe.length>0?Pe.slice(1):Pe),O.current=Te},[H]);return ue.useImperativeHandle(r,()=>({pulsate:Y,start:G,stop:Z}),[Y,G,Z]),J.jsx(Cue,{className:Mr(Cl.root,f.root,y),ref:re,...T,children:J.jsx(vO,{component:null,exit:!0,children:a})})});function Mue(t){return wi("MuiButtonBase",t)}const kue=Ti("MuiButtonBase",["root","disabled","focusVisible"]),Due=t=>{const{disabled:e,focusVisible:r,focusVisibleClassName:o,classes:u}=t,y=Ii({root:["root",e&&"disabled",r&&"focusVisible"]},Mue,u);return r&&o&&(y.root+=` ${o}`),y},Oue=Hn("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(t,e)=>e.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${kue.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),xO=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiButtonBase"}),{action:u,centerRipple:f=!1,children:y,className:T,component:a="button",disabled:A=!1,disableRipple:D=!1,disableTouchRipple:O=!1,focusRipple:B=!1,focusVisibleClassName:H,LinkComponent:Q="a",onBlur:re,onClick:se,onContextMenu:G,onDragLeave:Y,onFocus:Z,onFocusVisible:fe,onKeyDown:Te,onKeyUp:Pe,onMouseDown:ce,onMouseLeave:he,onMouseUp:W,onTouchEnd:ge,onTouchMove:_e,onTouchStart:Ee,tabIndex:we=0,TouchRippleProps:xt,touchRippleRef:Rt,type:Bt,...bt}=o,at=ue.useRef(null),Ct=bue(),Zt=Po(Ct.ref,Rt),[rt,wt]=ue.useState(!1);A&&rt&&wt(!1),ue.useImperativeHandle(u,()=>({focusVisible:()=>{wt(!0),at.current.focus()}}),[]);const pt=Ct.shouldMount&&!D&&!A;ue.useEffect(()=>{rt&&B&&!D&&Ct.pulsate()},[D,B,rt,Ct]);function jt(Pt,vn,Sr=O){return o_(yn=>(vn&&vn(yn),Sr||Ct[Pt](yn),!0))}const Mt=jt("start",ce),pn=jt("stop",G),un=jt("stop",Y),_n=jt("stop",W),St=jt("stop",Pt=>{rt&&Pt.preventDefault(),he&&he(Pt)}),ln=jt("start",Ee),Kt=jt("stop",ge),xn=jt("stop",_e),Er=jt("stop",Pt=>{gU(Pt.target)||wt(!1),re&&re(Pt)},!1),Dn=o_(Pt=>{at.current||(at.current=Pt.currentTarget),gU(Pt.target)&&(wt(!0),fe&&fe(Pt)),Z&&Z(Pt)}),hr=()=>{const Pt=at.current;return a&&a!=="button"&&!(Pt.tagName==="A"&&Pt.href)},Fr=o_(Pt=>{B&&!Pt.repeat&&rt&&Pt.key===" "&&Ct.stop(Pt,()=>{Ct.start(Pt)}),Pt.target===Pt.currentTarget&&hr()&&Pt.key===" "&&Pt.preventDefault(),Te&&Te(Pt),Pt.target===Pt.currentTarget&&hr()&&Pt.key==="Enter"&&!A&&(Pt.preventDefault(),se&&se(Pt))}),ar=o_(Pt=>{B&&Pt.key===" "&&rt&&!Pt.defaultPrevented&&Ct.stop(Pt,()=>{Ct.pulsate(Pt)}),Pe&&Pe(Pt),se&&Pt.target===Pt.currentTarget&&hr()&&Pt.key===" "&&!Pt.defaultPrevented&&se(Pt)});let Yn=a;Yn==="button"&&(bt.href||bt.to)&&(Yn=Q);const De={};Yn==="button"?(De.type=Bt===void 0?"button":Bt,De.disabled=A):(!bt.href&&!bt.to&&(De.role="button"),A&&(De["aria-disabled"]=A));const Ze=Po(r,at),st={...o,centerRipple:f,component:a,disabled:A,disableRipple:D,disableTouchRipple:O,focusRipple:B,tabIndex:we,focusVisible:rt},rn=Due(st);return J.jsxs(Oue,{as:Yn,className:Mr(rn.root,T),ownerState:st,onBlur:Er,onClick:se,onContextMenu:pn,onFocus:Dn,onKeyDown:Fr,onKeyUp:ar,onMouseDown:Mt,onMouseLeave:St,onMouseUp:_n,onDragLeave:un,onTouchEnd:Kt,onTouchMove:xn,onTouchStart:ln,ref:Ze,tabIndex:A?-1:we,type:Bt,...De,...bt,children:[y,pt?J.jsx(Rue,{ref:Zt,center:f,...xt}):null]})});function Lue(t){return wi("MuiIconButton",t)}const zue=Ti("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge"]),Nue=t=>{const{classes:e,disabled:r,color:o,edge:u,size:f}=t,y={root:["root",r&&"disabled",o!=="default"&&`color${Wn(o)}`,u&&`edge${Wn(u)}`,`size${Wn(f)}`]};return Ii(y,Lue,e)},Fue=Hn(xO,{name:"MuiIconButton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.color!=="default"&&e[`color${Wn(r.color)}`],r.edge&&e[`edge${Wn(r.edge)}`],e[`size${Wn(r.size)}`]]}})(Yi(({theme:t})=>({textAlign:"center",flex:"0 0 auto",fontSize:t.typography.pxToRem(24),padding:8,borderRadius:"50%",color:(t.vars||t).palette.action.active,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),variants:[{props:{disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:Dl(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}},{props:{edge:"start"},style:{marginLeft:-12}},{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:{edge:"end"},style:{marginRight:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}}]})),Yi(({theme:t})=>({variants:[{props:{color:"inherit"},style:{color:"inherit"}},...Object.entries(t.palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e},style:{color:(t.vars||t).palette[e].main}})),...Object.entries(t.palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${(t.vars||t).palette[e].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:Dl((t.vars||t).palette[e].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}})),{props:{size:"small"},style:{padding:5,fontSize:t.typography.pxToRem(18)}},{props:{size:"large"},style:{padding:12,fontSize:t.typography.pxToRem(28)}}],[`&.${zue.disabled}`]:{backgroundColor:"transparent",color:(t.vars||t).palette.action.disabled}}))),Bw=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiIconButton"}),{edge:u=!1,children:f,className:y,color:T="default",disabled:a=!1,disableFocusRipple:A=!1,disableRipple:D=!1,size:O="medium",...B}=o,H={...o,edge:u,color:T,disabled:a,disableFocusRipple:A,disableRipple:D,size:O},Q=Nue(H);return J.jsx(Fue,{className:Mr(Q.root,y),centerRipple:!0,focusRipple:!A,disabled:a,disableRipple:D,ref:r,...B,ownerState:H,children:f})});function Bue(t){return wi("MuiTypography",t)}Ti("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const Uue={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},Vue=oue(),jue=t=>{const{align:e,gutterBottom:r,noWrap:o,paragraph:u,variant:f,classes:y}=t,T={root:["root",f,t.align!=="inherit"&&`align${Wn(e)}`,r&&"gutterBottom",o&&"noWrap",u&&"paragraph"]};return Ii(T,Bue,y)},$ue=Hn("span",{name:"MuiTypography",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.variant&&e[r.variant],r.align!=="inherit"&&e[`align${Wn(r.align)}`],r.noWrap&&e.noWrap,r.gutterBottom&&e.gutterBottom,r.paragraph&&e.paragraph]}})(Yi(({theme:t})=>{var e;return{margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(t.typography).filter(([r,o])=>r!=="inherit"&&o&&typeof o=="object").map(([r,o])=>({props:{variant:r},style:o})),...Object.entries(t.palette).filter(([,r])=>r&&r.main).map(([r])=>({props:{color:r},style:{color:(t.vars||t).palette[r].main}})),...Object.entries(((e=t.palette)==null?void 0:e.text)||{}).filter(([,r])=>typeof r=="string").map(([r])=>({props:{color:`text${Wn(r)}`},style:{color:(t.vars||t).palette.text[r]}})),{props:({ownerState:r})=>r.align!=="inherit",style:{textAlign:"var(--Typography-textAlign)"}},{props:({ownerState:r})=>r.noWrap,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:({ownerState:r})=>r.gutterBottom,style:{marginBottom:"0.35em"}},{props:({ownerState:r})=>r.paragraph,style:{marginBottom:16}}]}})),AU={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},CU=ue.forwardRef(function(e,r){const{color:o,...u}=Qi({props:e,name:"MuiTypography"}),f=!Uue[o],y=Vue({...u,...f&&{color:o}}),{align:T="inherit",className:a,component:A,gutterBottom:D=!1,noWrap:O=!1,paragraph:B=!1,variant:H="body1",variantMapping:Q=AU,...re}=y,se={...y,align:T,color:o,className:a,component:A,gutterBottom:D,noWrap:O,paragraph:B,variant:H,variantMapping:Q},G=A||(B?"p":Q[H]||AU[H])||"span",Y=jue(se);return J.jsx($ue,{as:G,ref:r,className:Mr(Y.root,a),...re,ownerState:se,style:{...T!=="inherit"&&{"--Typography-textAlign":T},...re.style}})});function Gue(t){return typeof t=="function"?t():t}const que=ue.forwardRef(function(e,r){const{children:o,container:u,disablePortal:f=!1}=e,[y,T]=ue.useState(null),a=Po(l1(o),r);if(am(()=>{f||T(Gue(u)||document.body)},[u,f]),am(()=>{if(y&&!f)return WM(r,y),()=>{WM(r,null)}},[r,y,f]),f){if(ue.isValidElement(o)){const A={ref:a};return ue.cloneElement(o,A)}return J.jsx(ue.Fragment,{children:o})}return J.jsx(ue.Fragment,{children:y&&L3.createPortal(o,y)})});function Uw(t){return parseInt(t,10)||0}const Wue={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}};function Hue(t){return t==null||Object.keys(t).length===0||t.outerHeightStyle===0&&!t.overflowing}const Zue=ue.forwardRef(function(e,r){const{onChange:o,maxRows:u,minRows:f=1,style:y,value:T,...a}=e,{current:A}=ue.useRef(T!=null),D=ue.useRef(null),O=Po(r,D),B=ue.useRef(null),H=ue.useRef(null),Q=ue.useCallback(()=>{const G=D.current,Z=lm(G).getComputedStyle(G);if(Z.width==="0px")return{outerHeightStyle:0,overflowing:!1};const fe=H.current;fe.style.width=Z.width,fe.value=G.value||e.placeholder||"x",fe.value.slice(-1)===`
`&&(fe.value+=" ");const Te=Z.boxSizing,Pe=Uw(Z.paddingBottom)+Uw(Z.paddingTop),ce=Uw(Z.borderBottomWidth)+Uw(Z.borderTopWidth),he=fe.scrollHeight;fe.value="x";const W=fe.scrollHeight;let ge=he;f&&(ge=Math.max(Number(f)*W,ge)),u&&(ge=Math.min(Number(u)*W,ge)),ge=Math.max(ge,W);const _e=ge+(Te==="border-box"?Pe+ce:0),Ee=Math.abs(ge-he)<=1;return{outerHeightStyle:_e,overflowing:Ee}},[u,f,e.placeholder]),re=ue.useCallback(()=>{const G=Q();if(Hue(G))return;const Y=G.outerHeightStyle,Z=D.current;B.current!==Y&&(B.current=Y,Z.style.height=`${Y}px`),Z.style.overflow=G.overflowing?"hidden":""},[Q]);am(()=>{const G=()=>{re()};let Y;const Z=vG(G),fe=D.current,Te=lm(fe);Te.addEventListener("resize",Z);let Pe;return typeof ResizeObserver<"u"&&(Pe=new ResizeObserver(G),Pe.observe(fe)),()=>{Z.clear(),cancelAnimationFrame(Y),Te.removeEventListener("resize",Z),Pe&&Pe.disconnect()}},[Q,re]),am(()=>{re()});const se=G=>{A||re(),o&&o(G)};return J.jsxs(ue.Fragment,{children:[J.jsx("textarea",{value:T,onChange:se,ref:O,rows:f,style:y,...a}),J.jsx("textarea",{"aria-hidden":!0,className:e.className,readOnly:!0,ref:H,tabIndex:-1,style:{...Wue.shadow,...y,paddingTop:0,paddingBottom:0}})]})});function QM(t){return typeof t=="string"}function Af({props:t,states:e,muiFormControl:r}){return e.reduce((o,u)=>(o[u]=t[u],r&&typeof t[u]>"u"&&(o[u]=r[u]),o),{})}const bO=ue.createContext(void 0);function Uh(){return ue.useContext(bO)}function PU(t){return t!=null&&!(Array.isArray(t)&&t.length===0)}function PE(t,e=!1){return t&&(PU(t.value)&&t.value!==""||e&&PU(t.defaultValue)&&t.defaultValue!=="")}function Xue(t){return t.startAdornment}function Kue(t){return wi("MuiInputBase",t)}const q_=Ti("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]);var RU;const mI=(t,e)=>{const{ownerState:r}=t;return[e.root,r.formControl&&e.formControl,r.startAdornment&&e.adornedStart,r.endAdornment&&e.adornedEnd,r.error&&e.error,r.size==="small"&&e.sizeSmall,r.multiline&&e.multiline,r.color&&e[`color${Wn(r.color)}`],r.fullWidth&&e.fullWidth,r.hiddenLabel&&e.hiddenLabel]},gI=(t,e)=>{const{ownerState:r}=t;return[e.input,r.size==="small"&&e.inputSizeSmall,r.multiline&&e.inputMultiline,r.type==="search"&&e.inputTypeSearch,r.startAdornment&&e.inputAdornedStart,r.endAdornment&&e.inputAdornedEnd,r.hiddenLabel&&e.inputHiddenLabel]},Yue=t=>{const{classes:e,color:r,disabled:o,error:u,endAdornment:f,focused:y,formControl:T,fullWidth:a,hiddenLabel:A,multiline:D,readOnly:O,size:B,startAdornment:H,type:Q}=t,re={root:["root",`color${Wn(r)}`,o&&"disabled",u&&"error",a&&"fullWidth",y&&"focused",T&&"formControl",B&&B!=="medium"&&`size${Wn(B)}`,D&&"multiline",H&&"adornedStart",f&&"adornedEnd",A&&"hiddenLabel",O&&"readOnly"],input:["input",o&&"disabled",Q==="search"&&"inputTypeSearch",D&&"inputMultiline",B==="small"&&"inputSizeSmall",A&&"inputHiddenLabel",H&&"inputAdornedStart",f&&"inputAdornedEnd",O&&"readOnly"]};return Ii(re,Kue,e)},_I=Hn("div",{name:"MuiInputBase",slot:"Root",overridesResolver:mI})(Yi(({theme:t})=>({...t.typography.body1,color:(t.vars||t).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${q_.disabled}`]:{color:(t.vars||t).palette.text.disabled,cursor:"default"},variants:[{props:({ownerState:e})=>e.multiline,style:{padding:"4px 0 5px"}},{props:({ownerState:e,size:r})=>e.multiline&&r==="small",style:{paddingTop:1}},{props:({ownerState:e})=>e.fullWidth,style:{width:"100%"}}]}))),yI=Hn("input",{name:"MuiInputBase",slot:"Input",overridesResolver:gI})(Yi(({theme:t})=>{const e=t.palette.mode==="light",r={color:"currentColor",...t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:e?.42:.5},transition:t.transitions.create("opacity",{duration:t.transitions.duration.shorter})},o={opacity:"0 !important"},u=t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:e?.42:.5};return{font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%","&::-webkit-input-placeholder":r,"&::-moz-placeholder":r,"&::-ms-input-placeholder":r,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${q_.formControl} &`]:{"&::-webkit-input-placeholder":o,"&::-moz-placeholder":o,"&::-ms-input-placeholder":o,"&:focus::-webkit-input-placeholder":u,"&:focus::-moz-placeholder":u,"&:focus::-ms-input-placeholder":u},[`&.${q_.disabled}`]:{opacity:1,WebkitTextFillColor:(t.vars||t).palette.text.disabled},variants:[{props:({ownerState:f})=>!f.disableInjectingGlobalStyles,style:{animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}}},{props:{size:"small"},style:{paddingTop:1}},{props:({ownerState:f})=>f.multiline,style:{height:"auto",resize:"none",padding:0,paddingTop:0}},{props:{type:"search"},style:{MozAppearance:"textfield"}}]}})),MU=sue({"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}),Que=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiInputBase"}),{"aria-describedby":u,autoComplete:f,autoFocus:y,className:T,color:a,components:A={},componentsProps:D={},defaultValue:O,disabled:B,disableInjectingGlobalStyles:H,endAdornment:Q,error:re,fullWidth:se=!1,id:G,inputComponent:Y="input",inputProps:Z={},inputRef:fe,margin:Te,maxRows:Pe,minRows:ce,multiline:he=!1,name:W,onBlur:ge,onChange:_e,onClick:Ee,onFocus:we,onKeyDown:xt,onKeyUp:Rt,placeholder:Bt,readOnly:bt,renderSuffix:at,rows:Ct,size:Zt,slotProps:rt={},slots:wt={},startAdornment:pt,type:jt="text",value:Mt,...pn}=o,un=Z.value!=null?Z.value:Mt,{current:_n}=ue.useRef(un!=null),St=ue.useRef(),ln=ue.useCallback(dr=>{},[]),Kt=Po(St,fe,Z.ref,ln),[xn,Er]=ue.useState(!1),Dn=Uh(),hr=Af({props:o,muiFormControl:Dn,states:["color","disabled","error","hiddenLabel","size","required","filled"]});hr.focused=Dn?Dn.focused:xn,ue.useEffect(()=>{!Dn&&B&&xn&&(Er(!1),ge&&ge())},[Dn,B,xn,ge]);const Fr=Dn&&Dn.onFilled,ar=Dn&&Dn.onEmpty,Yn=ue.useCallback(dr=>{PE(dr)?Fr&&Fr():ar&&ar()},[Fr,ar]);am(()=>{_n&&Yn({value:un})},[un,Yn,_n]);const De=dr=>{we&&we(dr),Z.onFocus&&Z.onFocus(dr),Dn&&Dn.onFocus?Dn.onFocus(dr):Er(!0)},Ze=dr=>{ge&&ge(dr),Z.onBlur&&Z.onBlur(dr),Dn&&Dn.onBlur?Dn.onBlur(dr):Er(!1)},st=(dr,...zi)=>{if(!_n){const ls=dr.target||St.current;if(ls==null)throw new Error(Oh(1));Yn({value:ls.value})}Z.onChange&&Z.onChange(dr,...zi),_e&&_e(dr,...zi)};ue.useEffect(()=>{Yn(St.current)},[]);const rn=dr=>{St.current&&dr.currentTarget===dr.target&&St.current.focus(),Ee&&Ee(dr)};let Pt=Y,vn=Z;he&&Pt==="input"&&(Ct?vn={type:void 0,minRows:Ct,maxRows:Ct,...vn}:vn={type:void 0,maxRows:Pe,minRows:ce,...vn},Pt=Zue);const Sr=dr=>{Yn(dr.animationName==="mui-auto-fill-cancel"?St.current:{value:"x"})};ue.useEffect(()=>{Dn&&Dn.setAdornedStart(!!pt)},[Dn,pt]);const yn={...o,color:hr.color||"primary",disabled:hr.disabled,endAdornment:Q,error:hr.error,focused:hr.focused,formControl:Dn,fullWidth:se,hiddenLabel:hr.hiddenLabel,multiline:he,size:hr.size,startAdornment:pt,type:jt},Zn=Yue(yn),br=wt.root||A.Root||_I,Lr=rt.root||D.root||{},Li=wt.input||A.Input||yI;return vn={...vn,...rt.input??D.input},J.jsxs(ue.Fragment,{children:[!H&&typeof MU=="function"&&(RU||(RU=J.jsx(MU,{}))),J.jsxs(br,{...Lr,ref:r,onClick:rn,...pn,...!QM(br)&&{ownerState:{...yn,...Lr.ownerState}},className:Mr(Zn.root,Lr.className,T,bt&&"MuiInputBase-readOnly"),children:[pt,J.jsx(bO.Provider,{value:null,children:J.jsx(Li,{"aria-invalid":hr.error,"aria-describedby":u,autoComplete:f,autoFocus:y,defaultValue:O,disabled:hr.disabled,id:G,onAnimationStart:Sr,name:W,placeholder:Bt,readOnly:bt,required:hr.required,rows:Ct,value:un,onKeyDown:xt,onKeyUp:Rt,type:jt,...vn,...!QM(Li)&&{as:Pt,ownerState:{...yn,...vn.ownerState}},ref:Kt,className:Mr(Zn.input,vn.className,bt&&"MuiInputBase-readOnly"),onBlur:Ze,onChange:st,onFocus:De})}),Q,at?at({...hr,startAdornment:pt}):null]})]})}),wO=Que;function Jue(t){return wi("MuiInput",t)}const Y0={...q_,...Ti("MuiInput",["root","underline","input"])};function ehe(t){return wi("MuiOutlinedInput",t)}const su={...q_,...Ti("MuiOutlinedInput",["root","notchedOutline","input"])};function the(t){return wi("MuiFilledInput",t)}const Sp={...q_,...Ti("MuiFilledInput",["root","underline","input","adornedStart","adornedEnd","sizeSmall","multiline","hiddenLabel"])},nhe=hy(J.jsx("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),rhe={entering:{opacity:1},entered:{opacity:1}},ihe=ue.forwardRef(function(e,r){const o=_O(),u={enter:o.transitions.duration.enteringScreen,exit:o.transitions.duration.leavingScreen},{addEndListener:f,appear:y=!0,children:T,easing:a,in:A,onEnter:D,onEntered:O,onEntering:B,onExit:H,onExited:Q,onExiting:re,style:se,timeout:G=u,TransitionComponent:Y=Mu,...Z}=e,fe=ue.useRef(null),Te=Po(fe,l1(T),r),Pe=xt=>Rt=>{if(xt){const Bt=fe.current;Rt===void 0?xt(Bt):xt(Bt,Rt)}},ce=Pe(B),he=Pe((xt,Rt)=>{DG(xt);const Bt=AE({style:se,timeout:G,easing:a},{mode:"enter"});xt.style.webkitTransition=o.transitions.create("opacity",Bt),xt.style.transition=o.transitions.create("opacity",Bt),D&&D(xt,Rt)}),W=Pe(O),ge=Pe(re),_e=Pe(xt=>{const Rt=AE({style:se,timeout:G,easing:a},{mode:"exit"});xt.style.webkitTransition=o.transitions.create("opacity",Rt),xt.style.transition=o.transitions.create("opacity",Rt),H&&H(xt)}),Ee=Pe(Q),we=xt=>{f&&f(fe.current,xt)};return J.jsx(Y,{appear:y,in:A,nodeRef:fe,onEnter:he,onEntered:W,onEntering:ce,onExit:_e,onExited:Ee,onExiting:ge,addEndListener:we,timeout:G,...Z,children:(xt,Rt)=>ue.cloneElement(T,{style:{opacity:0,visibility:xt==="exited"&&!A?"hidden":void 0,...rhe[xt],...se,...T.props.style},ref:Te,...Rt})})});function she(t){return wi("MuiBackdrop",t)}Ti("MuiBackdrop",["root","invisible"]);const ohe=t=>{const{classes:e,invisible:r}=t;return Ii({root:["root",r&&"invisible"]},she,e)},ahe=Hn("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.invisible&&e.invisible]}})({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent",variants:[{props:{invisible:!0},style:{backgroundColor:"transparent"}}]}),lhe=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiBackdrop"}),{children:u,className:f,component:y="div",invisible:T=!1,open:a,components:A={},componentsProps:D={},slotProps:O={},slots:B={},TransitionComponent:H,transitionDuration:Q,...re}=o,se={...o,component:y,invisible:T},G=ohe(se),Y={transition:H,root:A.Root,...B},Z={...D,...O},fe={slots:Y,slotProps:Z},[Te,Pe]=Ol("root",{elementType:ahe,externalForwardedProps:fe,className:Mr(G.root,f),ownerState:se}),[ce,he]=Ol("transition",{elementType:ihe,externalForwardedProps:fe,ownerState:se});return delete he.ownerState,J.jsx(ce,{in:a,timeout:Q,...re,...he,children:J.jsx(Te,{"aria-hidden":!0,...Pe,classes:G,ref:r,children:u})})});function che(t){const{badgeContent:e,invisible:r=!1,max:o=99,showZero:u=!1}=t,f=TG({badgeContent:e,max:o});let y=r;r===!1&&e===0&&!u&&(y=!0);const{badgeContent:T,max:a=o}=y?f:t,A=T&&Number(T)>a?`${a}+`:T;return{badgeContent:T,invisible:y,max:a,displayValue:A}}function uhe(t){return wi("MuiBadge",t)}const Dd=Ti("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),qP=10,WP=4,hhe=t=>{const{color:e,anchorOrigin:r,invisible:o,overlap:u,variant:f,classes:y={}}=t,T={root:["root"],badge:["badge",f,o&&"invisible",`anchorOrigin${Wn(r.vertical)}${Wn(r.horizontal)}`,`anchorOrigin${Wn(r.vertical)}${Wn(r.horizontal)}${Wn(u)}`,`overlap${Wn(u)}`,e!=="default"&&`color${Wn(e)}`]};return Ii(T,uhe,y)},dhe=Hn("span",{name:"MuiBadge",slot:"Root",overridesResolver:(t,e)=>e.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),fhe=Hn("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.badge,e[r.variant],e[`anchorOrigin${Wn(r.anchorOrigin.vertical)}${Wn(r.anchorOrigin.horizontal)}${Wn(r.overlap)}`],r.color!=="default"&&e[`color${Wn(r.color)}`],r.invisible&&e.invisible]}})(Yi(({theme:t})=>({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:t.typography.fontFamily,fontWeight:t.typography.fontWeightMedium,fontSize:t.typography.pxToRem(12),minWidth:qP*2,lineHeight:1,padding:"0 6px",height:qP*2,borderRadius:qP,zIndex:1,transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.enteringScreen}),variants:[...Object.entries(t.palette).filter(([,e])=>e&&e.main&&e.contrastText).map(([e])=>({props:{color:e},style:{backgroundColor:(t.vars||t).palette[e].main,color:(t.vars||t).palette[e].contrastText}})),{props:{variant:"dot"},style:{borderRadius:WP,height:WP*2,minWidth:WP*2,padding:0}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${Dd.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${Dd.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${Dd.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${Dd.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${Dd.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${Dd.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${Dd.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${Dd.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.leavingScreen})}}]}))),phe=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiBadge"}),{anchorOrigin:u={vertical:"top",horizontal:"right"},className:f,classes:y,component:T,components:a={},componentsProps:A={},children:D,overlap:O="rectangular",color:B="default",invisible:H=!1,max:Q=99,badgeContent:re,slots:se,slotProps:G,showZero:Y=!1,variant:Z="standard",...fe}=o,{badgeContent:Te,invisible:Pe,max:ce,displayValue:he}=che({max:Q,invisible:H,badgeContent:re,showZero:Y}),W=TG({anchorOrigin:u,color:B,overlap:O,variant:Z,badgeContent:re}),ge=Pe||Te==null&&Z!=="dot",{color:_e=B,overlap:Ee=O,anchorOrigin:we=u,variant:xt=Z}=ge?W:o,Rt=xt!=="dot"?he:void 0,Bt={...o,badgeContent:Te,invisible:ge,max:ce,displayValue:Rt,showZero:Y,anchorOrigin:we,color:_e,overlap:Ee,variant:xt},bt=hhe(Bt),at=(se==null?void 0:se.root)??a.Root??dhe,Ct=(se==null?void 0:se.badge)??a.Badge??fhe,Zt=(G==null?void 0:G.root)??A.root,rt=(G==null?void 0:G.badge)??A.badge,wt=EE({elementType:at,externalSlotProps:Zt,externalForwardedProps:fe,additionalProps:{ref:r,as:T},ownerState:Bt,className:Mr(Zt==null?void 0:Zt.className,bt.root,f)}),pt=EE({elementType:Ct,externalSlotProps:rt,ownerState:Bt,className:Mr(bt.badge,rt==null?void 0:rt.className)});return J.jsxs(at,{...wt,children:[D,J.jsx(Ct,{...pt,children:Rt})]})});function mhe(t){return wi("MuiButton",t)}const Fg=Ti("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]),ghe=ue.createContext({}),_he=ue.createContext(void 0),yhe=t=>{const{color:e,disableElevation:r,fullWidth:o,size:u,variant:f,classes:y}=t,T={root:["root",f,`${f}${Wn(e)}`,`size${Wn(u)}`,`${f}Size${Wn(u)}`,`color${Wn(e)}`,r&&"disableElevation",o&&"fullWidth"],label:["label"],startIcon:["icon","startIcon",`iconSize${Wn(u)}`],endIcon:["icon","endIcon",`iconSize${Wn(u)}`]},a=Ii(T,mhe,y);return{...y,...a}},OG=[{props:{size:"small"},style:{"& > *:nth-of-type(1)":{fontSize:18}}},{props:{size:"medium"},style:{"& > *:nth-of-type(1)":{fontSize:20}}},{props:{size:"large"},style:{"& > *:nth-of-type(1)":{fontSize:22}}}],vhe=Hn(xO,{shouldForwardProp:t=>Ba(t)||t==="classes",name:"MuiButton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,e[r.variant],e[`${r.variant}${Wn(r.color)}`],e[`size${Wn(r.size)}`],e[`${r.variant}Size${Wn(r.size)}`],r.color==="inherit"&&e.colorInherit,r.disableElevation&&e.disableElevation,r.fullWidth&&e.fullWidth]}})(Yi(({theme:t})=>{var o,u;const e=t.palette.mode==="light"?t.palette.grey[300]:t.palette.grey[800],r=t.palette.mode==="light"?t.palette.grey.A100:t.palette.grey[700];return{...t.typography.button,minWidth:64,padding:"6px 16px",border:0,borderRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create(["background-color","box-shadow","border-color","color"],{duration:t.transitions.duration.short}),"&:hover":{textDecoration:"none"},[`&.${Fg.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{variant:"contained"},style:{color:"var(--variant-containedColor)",backgroundColor:"var(--variant-containedBg)",boxShadow:(t.vars||t).shadows[2],"&:hover":{boxShadow:(t.vars||t).shadows[4],"@media (hover: none)":{boxShadow:(t.vars||t).shadows[2]}},"&:active":{boxShadow:(t.vars||t).shadows[8]},[`&.${Fg.focusVisible}`]:{boxShadow:(t.vars||t).shadows[6]},[`&.${Fg.disabled}`]:{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground}}},{props:{variant:"outlined"},style:{padding:"5px 15px",border:"1px solid currentColor",borderColor:"var(--variant-outlinedBorder, currentColor)",backgroundColor:"var(--variant-outlinedBg)",color:"var(--variant-outlinedColor)",[`&.${Fg.disabled}`]:{border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`}}},{props:{variant:"text"},style:{padding:"6px 8px",color:"var(--variant-textColor)",backgroundColor:"var(--variant-textBg)"}},...Object.entries(t.palette).filter(([,f])=>f&&f.main&&f.dark&&f.contrastText).map(([f])=>({props:{color:f},style:{"--variant-textColor":(t.vars||t).palette[f].main,"--variant-outlinedColor":(t.vars||t).palette[f].main,"--variant-outlinedBorder":t.vars?`rgba(${t.vars.palette[f].mainChannel} / 0.5)`:Dl(t.palette[f].main,.5),"--variant-containedColor":(t.vars||t).palette[f].contrastText,"--variant-containedBg":(t.vars||t).palette[f].main,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":(t.vars||t).palette[f].dark,"--variant-textBg":t.vars?`rgba(${t.vars.palette[f].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:Dl(t.palette[f].main,t.palette.action.hoverOpacity),"--variant-outlinedBorder":(t.vars||t).palette[f].main,"--variant-outlinedBg":t.vars?`rgba(${t.vars.palette[f].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:Dl(t.palette[f].main,t.palette.action.hoverOpacity)}}}})),{props:{color:"inherit"},style:{"--variant-containedColor":t.vars?t.vars.palette.text.primary:(u=(o=t.palette).getContrastText)==null?void 0:u.call(o,e),"--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedBg:e,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedHoverBg:r,"--variant-textBg":t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:Dl(t.palette.text.primary,t.palette.action.hoverOpacity),"--variant-outlinedBg":t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:Dl(t.palette.text.primary,t.palette.action.hoverOpacity)}}}},{props:{size:"small",variant:"text"},style:{padding:"4px 5px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"text"},style:{padding:"8px 11px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"outlined"},style:{padding:"3px 9px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"outlined"},style:{padding:"7px 21px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"contained"},style:{padding:"4px 10px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"contained"},style:{padding:"8px 22px",fontSize:t.typography.pxToRem(15)}},{props:{disableElevation:!0},style:{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${Fg.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${Fg.disabled}`]:{boxShadow:"none"}}},{props:{fullWidth:!0},style:{width:"100%"}}]}})),xhe=Hn("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.startIcon,e[`iconSize${Wn(r.size)}`]]}})({display:"inherit",marginRight:8,marginLeft:-4,variants:[{props:{size:"small"},style:{marginLeft:-2}},...OG]}),bhe=Hn("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.endIcon,e[`iconSize${Wn(r.size)}`]]}})({display:"inherit",marginRight:-4,marginLeft:8,variants:[{props:{size:"small"},style:{marginRight:-2}},...OG]}),LG=ue.forwardRef(function(e,r){const o=ue.useContext(ghe),u=ue.useContext(_he),f=Ex(o,e),y=Qi({props:f,name:"MuiButton"}),{children:T,color:a="primary",component:A="button",className:D,disabled:O=!1,disableElevation:B=!1,disableFocusRipple:H=!1,endIcon:Q,focusVisibleClassName:re,fullWidth:se=!1,size:G="medium",startIcon:Y,type:Z,variant:fe="text",...Te}=y,Pe={...y,color:a,component:A,disabled:O,disableElevation:B,disableFocusRipple:H,fullWidth:se,size:G,type:Z,variant:fe},ce=yhe(Pe),he=Y&&J.jsx(xhe,{className:ce.startIcon,ownerState:Pe,children:Y}),W=Q&&J.jsx(bhe,{className:ce.endIcon,ownerState:Pe,children:Q}),ge=u||"";return J.jsxs(vhe,{ownerState:Pe,className:Mr(o.className,ce.root,D,ge),component:A,disabled:O,focusRipple:!H,focusVisibleClassName:Mr(ce.focusVisible,re),ref:r,type:Z,...Te,classes:ce,children:[he,T,W]})});function whe(t){return wi("PrivateSwitchBase",t)}Ti("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const The=t=>{const{classes:e,checked:r,disabled:o,edge:u}=t,f={root:["root",r&&"checked",o&&"disabled",u&&`edge${Wn(u)}`],input:["input"]};return Ii(f,whe,e)},Ehe=Hn(xO)({padding:9,borderRadius:"50%",variants:[{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:({edge:t,ownerState:e})=>t==="start"&&e.size!=="small",style:{marginLeft:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}},{props:({edge:t,ownerState:e})=>t==="end"&&e.size!=="small",style:{marginRight:-12}}]}),She=Hn("input",{shouldForwardProp:Ba})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),Ihe=ue.forwardRef(function(e,r){const{autoFocus:o,checked:u,checkedIcon:f,className:y,defaultChecked:T,disabled:a,disableFocusRipple:A=!1,edge:D=!1,icon:O,id:B,inputProps:H,inputRef:Q,name:re,onBlur:se,onChange:G,onFocus:Y,readOnly:Z,required:fe=!1,tabIndex:Te,type:Pe,value:ce,...he}=e,[W,ge]=TE({controlled:u,default:!!T,name:"SwitchBase",state:"checked"}),_e=Uh(),Ee=Ct=>{Y&&Y(Ct),_e&&_e.onFocus&&_e.onFocus(Ct)},we=Ct=>{se&&se(Ct),_e&&_e.onBlur&&_e.onBlur(Ct)},xt=Ct=>{if(Ct.nativeEvent.defaultPrevented)return;const Zt=Ct.target.checked;ge(Zt),G&&G(Ct,Zt)};let Rt=a;_e&&typeof Rt>"u"&&(Rt=_e.disabled);const Bt=Pe==="checkbox"||Pe==="radio",bt={...e,checked:W,disabled:Rt,disableFocusRipple:A,edge:D},at=The(bt);return J.jsxs(Ehe,{component:"span",className:Mr(at.root,y),centerRipple:!0,focusRipple:!A,disabled:Rt,tabIndex:null,role:void 0,onFocus:Ee,onBlur:we,ownerState:bt,ref:r,...he,children:[J.jsx(She,{autoFocus:o,checked:u,defaultChecked:T,className:at.input,disabled:Rt,id:Bt?B:void 0,name:re,onChange:xt,readOnly:Z,ref:Q,required:fe,ownerState:bt,tabIndex:Te,type:Pe,...Pe==="checkbox"&&ce===void 0?{}:{value:ce},...H}),W?f:O]})});function Ahe(t){const e=ol(t);return e.body===t?lm(t).innerWidth>e.documentElement.clientWidth:t.scrollHeight>t.clientHeight}function Uv(t,e){e?t.setAttribute("aria-hidden","true"):t.removeAttribute("aria-hidden")}function kU(t){return parseInt(lm(t).getComputedStyle(t).paddingRight,10)||0}function Che(t){const r=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].indexOf(t.tagName)!==-1,o=t.tagName==="INPUT"&&t.getAttribute("type")==="hidden";return r||o}function DU(t,e,r,o,u){const f=[e,r,...o];[].forEach.call(t.children,y=>{const T=f.indexOf(y)===-1,a=!Che(y);T&&a&&Uv(y,u)})}function HP(t,e){let r=-1;return t.some((o,u)=>e(o)?(r=u,!0):!1),r}function Phe(t,e){const r=[],o=t.container;if(!e.disableScrollLock){if(Ahe(o)){const y=wG(ol(o));r.push({value:o.style.paddingRight,property:"padding-right",el:o}),o.style.paddingRight=`${kU(o)+y}px`;const T=ol(o).querySelectorAll(".mui-fixed");[].forEach.call(T,a=>{r.push({value:a.style.paddingRight,property:"padding-right",el:a}),a.style.paddingRight=`${kU(a)+y}px`})}let f;if(o.parentNode instanceof DocumentFragment)f=ol(o).body;else{const y=o.parentElement,T=lm(o);f=(y==null?void 0:y.nodeName)==="HTML"&&T.getComputedStyle(y).overflowY==="scroll"?y:o}r.push({value:f.style.overflow,property:"overflow",el:f},{value:f.style.overflowX,property:"overflow-x",el:f},{value:f.style.overflowY,property:"overflow-y",el:f}),f.style.overflow="hidden"}return()=>{r.forEach(({value:f,el:y,property:T})=>{f?y.style.setProperty(T,f):y.style.removeProperty(T)})}}function Rhe(t){const e=[];return[].forEach.call(t.children,r=>{r.getAttribute("aria-hidden")==="true"&&e.push(r)}),e}class Mhe{constructor(){this.modals=[],this.containers=[]}add(e,r){let o=this.modals.indexOf(e);if(o!==-1)return o;o=this.modals.length,this.modals.push(e),e.modalRef&&Uv(e.modalRef,!1);const u=Rhe(r);DU(r,e.mount,e.modalRef,u,!0);const f=HP(this.containers,y=>y.container===r);return f!==-1?(this.containers[f].modals.push(e),o):(this.containers.push({modals:[e],container:r,restore:null,hiddenSiblings:u}),o)}mount(e,r){const o=HP(this.containers,f=>f.modals.indexOf(e)!==-1),u=this.containers[o];u.restore||(u.restore=Phe(u,r))}remove(e,r=!0){const o=this.modals.indexOf(e);if(o===-1)return o;const u=HP(this.containers,y=>y.modals.indexOf(e)!==-1),f=this.containers[u];if(f.modals.splice(f.modals.indexOf(e),1),this.modals.splice(o,1),f.modals.length===0)f.restore&&f.restore(),e.modalRef&&Uv(e.modalRef,r),DU(f.container,e.mount,e.modalRef,f.hiddenSiblings,!1),this.containers.splice(u,1);else{const y=f.modals[f.modals.length-1];y.modalRef&&Uv(y.modalRef,!1)}return o}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}}const khe=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function Dhe(t){const e=parseInt(t.getAttribute("tabindex")||"",10);return Number.isNaN(e)?t.contentEditable==="true"||(t.nodeName==="AUDIO"||t.nodeName==="VIDEO"||t.nodeName==="DETAILS")&&t.getAttribute("tabindex")===null?0:t.tabIndex:e}function Ohe(t){if(t.tagName!=="INPUT"||t.type!=="radio"||!t.name)return!1;const e=o=>t.ownerDocument.querySelector(`input[type="radio"]${o}`);let r=e(`[name="${t.name}"]:checked`);return r||(r=e(`[name="${t.name}"]`)),r!==t}function Lhe(t){return!(t.disabled||t.tagName==="INPUT"&&t.type==="hidden"||Ohe(t))}function zhe(t){const e=[],r=[];return Array.from(t.querySelectorAll(khe)).forEach((o,u)=>{const f=Dhe(o);f===-1||!Lhe(o)||(f===0?e.push(o):r.push({documentOrder:u,tabIndex:f,node:o}))}),r.sort((o,u)=>o.tabIndex===u.tabIndex?o.documentOrder-u.documentOrder:o.tabIndex-u.tabIndex).map(o=>o.node).concat(e)}function Nhe(){return!0}function Fhe(t){const{children:e,disableAutoFocus:r=!1,disableEnforceFocus:o=!1,disableRestoreFocus:u=!1,getTabbable:f=zhe,isEnabled:y=Nhe,open:T}=t,a=ue.useRef(!1),A=ue.useRef(null),D=ue.useRef(null),O=ue.useRef(null),B=ue.useRef(null),H=ue.useRef(!1),Q=ue.useRef(null),re=Po(l1(e),Q),se=ue.useRef(null);ue.useEffect(()=>{!T||!Q.current||(H.current=!r)},[r,T]),ue.useEffect(()=>{if(!T||!Q.current)return;const Z=ol(Q.current);return Q.current.contains(Z.activeElement)||(Q.current.hasAttribute("tabIndex")||Q.current.setAttribute("tabIndex","-1"),H.current&&Q.current.focus()),()=>{u||(O.current&&O.current.focus&&(a.current=!0,O.current.focus()),O.current=null)}},[T]),ue.useEffect(()=>{if(!T||!Q.current)return;const Z=ol(Q.current),fe=ce=>{se.current=ce,!(o||!y()||ce.key!=="Tab")&&Z.activeElement===Q.current&&ce.shiftKey&&(a.current=!0,D.current&&D.current.focus())},Te=()=>{var W,ge;const ce=Q.current;if(ce===null)return;if(!Z.hasFocus()||!y()||a.current){a.current=!1;return}if(ce.contains(Z.activeElement)||o&&Z.activeElement!==A.current&&Z.activeElement!==D.current)return;if(Z.activeElement!==B.current)B.current=null;else if(B.current!==null)return;if(!H.current)return;let he=[];if((Z.activeElement===A.current||Z.activeElement===D.current)&&(he=f(Q.current)),he.length>0){const _e=!!((W=se.current)!=null&&W.shiftKey&&((ge=se.current)==null?void 0:ge.key)==="Tab"),Ee=he[0],we=he[he.length-1];typeof Ee!="string"&&typeof we!="string"&&(_e?we.focus():Ee.focus())}else ce.focus()};Z.addEventListener("focusin",Te),Z.addEventListener("keydown",fe,!0);const Pe=setInterval(()=>{Z.activeElement&&Z.activeElement.tagName==="BODY"&&Te()},50);return()=>{clearInterval(Pe),Z.removeEventListener("focusin",Te),Z.removeEventListener("keydown",fe,!0)}},[r,o,u,y,T,f]);const G=Z=>{O.current===null&&(O.current=Z.relatedTarget),H.current=!0,B.current=Z.target;const fe=e.props.onFocus;fe&&fe(Z)},Y=Z=>{O.current===null&&(O.current=Z.relatedTarget),H.current=!0};return J.jsxs(ue.Fragment,{children:[J.jsx("div",{tabIndex:T?0:-1,onFocus:Y,ref:A,"data-testid":"sentinelStart"}),ue.cloneElement(e,{ref:re,onFocus:G}),J.jsx("div",{tabIndex:T?0:-1,onFocus:Y,ref:D,"data-testid":"sentinelEnd"})]})}function Bhe(t){return typeof t=="function"?t():t}function Uhe(t){return t?t.props.hasOwnProperty("in"):!1}const Vhe=new Mhe;function jhe(t){const{container:e,disableEscapeKeyDown:r=!1,disableScrollLock:o=!1,manager:u=Vhe,closeAfterTransition:f=!1,onTransitionEnter:y,onTransitionExited:T,children:a,onClose:A,open:D,rootRef:O}=t,B=ue.useRef({}),H=ue.useRef(null),Q=ue.useRef(null),re=Po(Q,O),[se,G]=ue.useState(!D),Y=Uhe(a);let Z=!0;(t["aria-hidden"]==="false"||t["aria-hidden"]===!1)&&(Z=!1);const fe=()=>ol(H.current),Te=()=>(B.current.modalRef=Q.current,B.current.mount=H.current,B.current),Pe=()=>{u.mount(Te(),{disableScrollLock:o}),Q.current&&(Q.current.scrollTop=0)},ce=o_(()=>{const Bt=Bhe(e)||fe().body;u.add(Te(),Bt),Q.current&&Pe()}),he=ue.useCallback(()=>u.isTopModal(Te()),[u]),W=o_(Bt=>{H.current=Bt,Bt&&(D&&he()?Pe():Q.current&&Uv(Q.current,Z))}),ge=ue.useCallback(()=>{u.remove(Te(),Z)},[Z,u]);ue.useEffect(()=>()=>{ge()},[ge]),ue.useEffect(()=>{D?ce():(!Y||!f)&&ge()},[D,ge,Y,f,ce]);const _e=Bt=>bt=>{var at;(at=Bt.onKeyDown)==null||at.call(Bt,bt),!(bt.key!=="Escape"||bt.which===229||!he())&&(r||(bt.stopPropagation(),A&&A(bt,"escapeKeyDown")))},Ee=Bt=>bt=>{var at;(at=Bt.onClick)==null||at.call(Bt,bt),bt.target===bt.currentTarget&&A&&A(bt,"backdropClick")};return{getRootProps:(Bt={})=>{const bt=SG(t);delete bt.onTransitionEnter,delete bt.onTransitionExited;const at={...bt,...Bt};return{role:"presentation",...at,onKeyDown:_e(at),ref:re}},getBackdropProps:(Bt={})=>{const bt=Bt;return{"aria-hidden":!0,...bt,onClick:Ee(bt),open:D}},getTransitionProps:()=>{const Bt=()=>{G(!1),y&&y()},bt=()=>{G(!0),T&&T(),f&&ge()};return{onEnter:qM(Bt,a==null?void 0:a.props.onEnter),onExited:qM(bt,a==null?void 0:a.props.onExited)}},rootRef:re,portalRef:W,isTopModal:he,exited:se,hasTransition:Y}}function $he(t){return wi("MuiModal",t)}Ti("MuiModal",["root","hidden","backdrop"]);const Ghe=t=>{const{open:e,exited:r,classes:o}=t;return Ii({root:["root",!e&&r&&"hidden"],backdrop:["backdrop"]},$he,o)},qhe=Hn("div",{name:"MuiModal",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,!r.open&&r.exited&&e.hidden]}})(Yi(({theme:t})=>({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0,variants:[{props:({ownerState:e})=>!e.open&&e.exited,style:{visibility:"hidden"}}]}))),Whe=Hn(lhe,{name:"MuiModal",slot:"Backdrop",overridesResolver:(t,e)=>e.backdrop})({zIndex:-1}),Hhe=ue.forwardRef(function(e,r){const o=Qi({name:"MuiModal",props:e}),{BackdropComponent:u=Whe,BackdropProps:f,classes:y,className:T,closeAfterTransition:a=!1,children:A,container:D,component:O,components:B={},componentsProps:H={},disableAutoFocus:Q=!1,disableEnforceFocus:re=!1,disableEscapeKeyDown:se=!1,disablePortal:G=!1,disableRestoreFocus:Y=!1,disableScrollLock:Z=!1,hideBackdrop:fe=!1,keepMounted:Te=!1,onBackdropClick:Pe,onClose:ce,onTransitionEnter:he,onTransitionExited:W,open:ge,slotProps:_e={},slots:Ee={},theme:we,...xt}=o,Rt={...o,closeAfterTransition:a,disableAutoFocus:Q,disableEnforceFocus:re,disableEscapeKeyDown:se,disablePortal:G,disableRestoreFocus:Y,disableScrollLock:Z,hideBackdrop:fe,keepMounted:Te},{getRootProps:Bt,getBackdropProps:bt,getTransitionProps:at,portalRef:Ct,isTopModal:Zt,exited:rt,hasTransition:wt}=jhe({...Rt,rootRef:r}),pt={...Rt,exited:rt},jt=Ghe(pt),Mt={};if(A.props.tabIndex===void 0&&(Mt.tabIndex="-1"),wt){const{onEnter:xn,onExited:Er}=at();Mt.onEnter=xn,Mt.onExited=Er}const pn={slots:{root:B.Root,backdrop:B.Backdrop,...Ee},slotProps:{...H,..._e}},[un,_n]=Ol("root",{elementType:qhe,externalForwardedProps:pn,getSlotProps:Bt,additionalProps:{ref:r,as:O},ownerState:pt,className:Mr(T,jt==null?void 0:jt.root,!pt.open&&pt.exited&&(jt==null?void 0:jt.hidden))}),[St,ln]=Ol("backdrop",{elementType:u,externalForwardedProps:pn,additionalProps:f,getSlotProps:xn=>bt({...xn,onClick:Er=>{Pe&&Pe(Er),xn!=null&&xn.onClick&&xn.onClick(Er)}}),className:Mr(f==null?void 0:f.className,jt==null?void 0:jt.backdrop),ownerState:pt}),Kt=Po(f==null?void 0:f.ref,ln.ref);return!Te&&!ge&&(!wt||rt)?null:J.jsx(que,{ref:Ct,container:D,disablePortal:G,children:J.jsxs(un,{..._n,...xt,children:[!fe&&u?J.jsx(St,{...ln,ref:Kt}):null,J.jsx(Fhe,{disableEnforceFocus:re,disableAutoFocus:Q,disableRestoreFocus:Y,isEnabled:Zt,open:ge,children:ue.cloneElement(A,Mt)})]})})}),Zhe=t=>{const{classes:e,disableUnderline:r,startAdornment:o,endAdornment:u,size:f,hiddenLabel:y,multiline:T}=t,a={root:["root",!r&&"underline",o&&"adornedStart",u&&"adornedEnd",f==="small"&&`size${Wn(f)}`,y&&"hiddenLabel",T&&"multiline"],input:["input"]},A=Ii(a,the,e);return{...e,...A}},Xhe=Hn(_I,{shouldForwardProp:t=>Ba(t)||t==="classes",name:"MuiFilledInput",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[...mI(t,e),!r.disableUnderline&&e.underline]}})(Yi(({theme:t})=>{const e=t.palette.mode==="light",r=e?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",o=e?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",u=e?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",f=e?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return{position:"relative",backgroundColor:t.vars?t.vars.palette.FilledInput.bg:o,borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),"&:hover":{backgroundColor:t.vars?t.vars.palette.FilledInput.hoverBg:u,"@media (hover: none)":{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:o}},[`&.${Sp.focused}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:o},[`&.${Sp.disabled}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.disabledBg:f},variants:[{props:({ownerState:y})=>!y.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Sp.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Sp.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`:r}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Sp.disabled}, .${Sp.error}):before`]:{borderBottom:`1px solid ${(t.vars||t).palette.text.primary}`},[`&.${Sp.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(t.palette).filter(([,y])=>y&&y.main).map(([y])=>{var T;return{props:{disableUnderline:!1,color:y},style:{"&::after":{borderBottom:`2px solid ${(T=(t.vars||t).palette[y])==null?void 0:T.main}`}}}}),{props:({ownerState:y})=>y.startAdornment,style:{paddingLeft:12}},{props:({ownerState:y})=>y.endAdornment,style:{paddingRight:12}},{props:({ownerState:y})=>y.multiline,style:{padding:"25px 12px 8px"}},{props:({ownerState:y,size:T})=>y.multiline&&T==="small",style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:y})=>y.multiline&&y.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:y})=>y.multiline&&y.hiddenLabel&&y.size==="small",style:{paddingTop:8,paddingBottom:9}}]}})),Khe=Hn(yI,{name:"MuiFilledInput",slot:"Input",overridesResolver:gI})(Yi(({theme:t})=>({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12,...!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:t.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:t.palette.mode==="light"?null:"#fff",caretColor:t.palette.mode==="light"?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},...t.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:e})=>e.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:e})=>e.startAdornment,style:{paddingLeft:0}},{props:({ownerState:e})=>e.endAdornment,style:{paddingRight:0}},{props:({ownerState:e})=>e.hiddenLabel&&e.size==="small",style:{paddingTop:8,paddingBottom:9}},{props:({ownerState:e})=>e.multiline,style:{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0}}]}))),RE=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiFilledInput"}),{disableUnderline:u=!1,components:f={},componentsProps:y,fullWidth:T=!1,hiddenLabel:a,inputComponent:A="input",multiline:D=!1,slotProps:O,slots:B={},type:H="text",...Q}=o,re={...o,disableUnderline:u,fullWidth:T,inputComponent:A,multiline:D,type:H},se=Zhe(o),G={root:{ownerState:re},input:{ownerState:re}},Y=O??y?Ho(G,O??y):G,Z=B.root??f.Root??Xhe,fe=B.input??f.Input??Khe;return J.jsx(wO,{slots:{root:Z,input:fe},componentsProps:Y,fullWidth:T,inputComponent:A,multiline:D,ref:r,type:H,...Q,classes:se})});RE&&(RE.muiName="Input");function Yhe(t){return wi("MuiFormControl",t)}Ti("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const Qhe=t=>{const{classes:e,margin:r,fullWidth:o}=t,u={root:["root",r!=="none"&&`margin${Wn(r)}`,o&&"fullWidth"]};return Ii(u,Yhe,e)},Jhe=Hn("div",{name:"MuiFormControl",slot:"Root",overridesResolver:({ownerState:t},e)=>({...e.root,...e[`margin${Wn(t.margin)}`],...t.fullWidth&&e.fullWidth})})({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top",variants:[{props:{margin:"normal"},style:{marginTop:16,marginBottom:8}},{props:{margin:"dense"},style:{marginTop:8,marginBottom:4}},{props:{fullWidth:!0},style:{width:"100%"}}]}),ede=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiFormControl"}),{children:u,className:f,color:y="primary",component:T="div",disabled:a=!1,error:A=!1,focused:D,fullWidth:O=!1,hiddenLabel:B=!1,margin:H="none",required:Q=!1,size:re="medium",variant:se="outlined",...G}=o,Y={...o,color:y,component:T,disabled:a,error:A,fullWidth:O,hiddenLabel:B,margin:H,required:Q,size:re,variant:se},Z=Qhe(Y),[fe,Te]=ue.useState(()=>{let we=!1;return u&&ue.Children.forEach(u,xt=>{if(!VP(xt,["Input","Select"]))return;const Rt=VP(xt,["Select"])?xt.props.input:xt;Rt&&Xue(Rt.props)&&(we=!0)}),we}),[Pe,ce]=ue.useState(()=>{let we=!1;return u&&ue.Children.forEach(u,xt=>{VP(xt,["Input","Select"])&&(PE(xt.props,!0)||PE(xt.props.inputProps,!0))&&(we=!0)}),we}),[he,W]=ue.useState(!1);a&&he&&W(!1);const ge=D!==void 0&&!a?D:he;let _e;const Ee=ue.useMemo(()=>({adornedStart:fe,setAdornedStart:Te,color:y,disabled:a,error:A,filled:Pe,focused:ge,fullWidth:O,hiddenLabel:B,size:re,onBlur:()=>{W(!1)},onEmpty:()=>{ce(!1)},onFilled:()=>{ce(!0)},onFocus:()=>{W(!0)},registerEffect:_e,required:Q,variant:se}),[fe,y,a,A,Pe,ge,O,B,_e,Q,re,se]);return J.jsx(bO.Provider,{value:Ee,children:J.jsx(Jhe,{as:T,ownerState:Y,className:Mr(Z.root,f),ref:r,...G,children:u})})});function tde(t){return wi("MuiFormControlLabel",t)}const gv=Ti("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),nde=t=>{const{classes:e,disabled:r,labelPlacement:o,error:u,required:f}=t,y={root:["root",r&&"disabled",`labelPlacement${Wn(o)}`,u&&"error",f&&"required"],label:["label",r&&"disabled"],asterisk:["asterisk",u&&"error"]};return Ii(y,tde,e)},rde=Hn("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[{[`& .${gv.label}`]:e.label},e.root,e[`labelPlacement${Wn(r.labelPlacement)}`]]}})(Yi(({theme:t})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${gv.disabled}`]:{cursor:"default"},[`& .${gv.label}`]:{[`&.${gv.disabled}`]:{color:(t.vars||t).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:e})=>e==="start"||e==="top"||e==="bottom",style:{marginLeft:16}}]}))),ide=Hn("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(t,e)=>e.asterisk})(Yi(({theme:t})=>({[`&.${gv.error}`]:{color:(t.vars||t).palette.error.main}}))),sde=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiFormControlLabel"}),{checked:u,className:f,componentsProps:y={},control:T,disabled:a,disableTypography:A,inputRef:D,label:O,labelPlacement:B="end",name:H,onChange:Q,required:re,slots:se={},slotProps:G={},value:Y,...Z}=o,fe=Uh(),Te=a??T.props.disabled??(fe==null?void 0:fe.disabled),Pe=re??T.props.required,ce={disabled:Te,required:Pe};["checked","name","onChange","value","inputRef"].forEach(Rt=>{typeof T.props[Rt]>"u"&&typeof o[Rt]<"u"&&(ce[Rt]=o[Rt])});const he=Af({props:o,muiFormControl:fe,states:["error"]}),W={...o,disabled:Te,labelPlacement:B,required:Pe,error:he.error},ge=nde(W),_e={slots:se,slotProps:{...y,...G}},[Ee,we]=Ol("typography",{elementType:CU,externalForwardedProps:_e,ownerState:W});let xt=O;return xt!=null&&xt.type!==CU&&!A&&(xt=J.jsx(Ee,{component:"span",...we,className:Mr(ge.label,we==null?void 0:we.className),children:xt})),J.jsxs(rde,{className:Mr(ge.root,f),ownerState:W,ref:r,...Z,children:[ue.cloneElement(T,ce),Pe?J.jsxs("div",{children:[xt,J.jsxs(ide,{ownerState:W,"aria-hidden":!0,className:ge.asterisk,children:["","*"]})]}):xt]})});function ode(t){return wi("MuiFormGroup",t)}Ti("MuiFormGroup",["root","row","error"]);const ade=t=>{const{classes:e,row:r,error:o}=t;return Ii({root:["root",r&&"row",o&&"error"]},ode,e)},lde=Hn("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.row&&e.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),cde=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiFormGroup"}),{className:u,row:f=!1,...y}=o,T=Uh(),a=Af({props:o,muiFormControl:T,states:["error"]}),A={...o,row:f,error:a.error},D=ade(A);return J.jsx(lde,{className:Mr(D.root,u),ownerState:A,ref:r,...y})});function ude(t){return wi("MuiFormHelperText",t)}const OU=Ti("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var LU;const hde=t=>{const{classes:e,contained:r,size:o,disabled:u,error:f,filled:y,focused:T,required:a}=t,A={root:["root",u&&"disabled",f&&"error",o&&`size${Wn(o)}`,r&&"contained",T&&"focused",y&&"filled",a&&"required"]};return Ii(A,ude,e)},dde=Hn("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.size&&e[`size${Wn(r.size)}`],r.contained&&e.contained,r.filled&&e.filled]}})(Yi(({theme:t})=>({color:(t.vars||t).palette.text.secondary,...t.typography.caption,textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${OU.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${OU.error}`]:{color:(t.vars||t).palette.error.main},variants:[{props:{size:"small"},style:{marginTop:4}},{props:({ownerState:e})=>e.contained,style:{marginLeft:14,marginRight:14}}]}))),fde=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiFormHelperText"}),{children:u,className:f,component:y="p",disabled:T,error:a,filled:A,focused:D,margin:O,required:B,variant:H,...Q}=o,re=Uh(),se=Af({props:o,muiFormControl:re,states:["variant","size","disabled","error","filled","focused","required"]}),G={...o,component:y,contained:se.variant==="filled"||se.variant==="outlined",variant:se.variant,size:se.size,disabled:se.disabled,error:se.error,filled:se.filled,focused:se.focused,required:se.required};delete G.ownerState;const Y=hde(G);return J.jsx(dde,{as:y,className:Mr(Y.root,f),ref:r,...Q,ownerState:G,children:u===" "?LU||(LU=J.jsx("span",{className:"notranslate",children:""})):u})});function pde(t){return wi("MuiFormLabel",t)}const Vv=Ti("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),mde=t=>{const{classes:e,color:r,focused:o,disabled:u,error:f,filled:y,required:T}=t,a={root:["root",`color${Wn(r)}`,u&&"disabled",f&&"error",y&&"filled",o&&"focused",T&&"required"],asterisk:["asterisk",f&&"error"]};return Ii(a,pde,e)},gde=Hn("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:({ownerState:t},e)=>({...e.root,...t.color==="secondary"&&e.colorSecondary,...t.filled&&e.filled})})(Yi(({theme:t})=>({color:(t.vars||t).palette.text.secondary,...t.typography.body1,lineHeight:"1.4375em",padding:0,position:"relative",variants:[...Object.entries(t.palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e},style:{[`&.${Vv.focused}`]:{color:(t.vars||t).palette[e].main}}})),{props:{},style:{[`&.${Vv.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${Vv.error}`]:{color:(t.vars||t).palette.error.main}}}]}))),_de=Hn("span",{name:"MuiFormLabel",slot:"Asterisk",overridesResolver:(t,e)=>e.asterisk})(Yi(({theme:t})=>({[`&.${Vv.error}`]:{color:(t.vars||t).palette.error.main}}))),yde=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiFormLabel"}),{children:u,className:f,color:y,component:T="label",disabled:a,error:A,filled:D,focused:O,required:B,...H}=o,Q=Uh(),re=Af({props:o,muiFormControl:Q,states:["color","required","focused","disabled","error","filled"]}),se={...o,color:re.color||"primary",component:T,disabled:re.disabled,error:re.error,filled:re.filled,focused:re.focused,required:re.required},G=mde(se);return J.jsxs(gde,{as:T,ownerState:se,className:Mr(G.root,f),ref:r,...H,children:[u,re.required&&J.jsxs(_de,{ownerState:se,"aria-hidden":!0,className:G.asterisk,children:["","*"]})]})});function JM(t){return`scale(${t}, ${t**2})`}const vde={entering:{opacity:1,transform:JM(1)},entered:{opacity:1,transform:"none"}},ZP=typeof navigator<"u"&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),ek=ue.forwardRef(function(e,r){const{addEndListener:o,appear:u=!0,children:f,easing:y,in:T,onEnter:a,onEntered:A,onEntering:D,onExit:O,onExited:B,onExiting:H,style:Q,timeout:re="auto",TransitionComponent:se=Mu,...G}=e,Y=bG(),Z=ue.useRef(),fe=_O(),Te=ue.useRef(null),Pe=Po(Te,l1(f),r),ce=Rt=>Bt=>{if(Rt){const bt=Te.current;Bt===void 0?Rt(bt):Rt(bt,Bt)}},he=ce(D),W=ce((Rt,Bt)=>{DG(Rt);const{duration:bt,delay:at,easing:Ct}=AE({style:Q,timeout:re,easing:y},{mode:"enter"});let Zt;re==="auto"?(Zt=fe.transitions.getAutoHeightDuration(Rt.clientHeight),Z.current=Zt):Zt=bt,Rt.style.transition=[fe.transitions.create("opacity",{duration:Zt,delay:at}),fe.transitions.create("transform",{duration:ZP?Zt:Zt*.666,delay:at,easing:Ct})].join(","),a&&a(Rt,Bt)}),ge=ce(A),_e=ce(H),Ee=ce(Rt=>{const{duration:Bt,delay:bt,easing:at}=AE({style:Q,timeout:re,easing:y},{mode:"exit"});let Ct;re==="auto"?(Ct=fe.transitions.getAutoHeightDuration(Rt.clientHeight),Z.current=Ct):Ct=Bt,Rt.style.transition=[fe.transitions.create("opacity",{duration:Ct,delay:bt}),fe.transitions.create("transform",{duration:ZP?Ct:Ct*.666,delay:ZP?bt:bt||Ct*.333,easing:at})].join(","),Rt.style.opacity=0,Rt.style.transform=JM(.75),O&&O(Rt)}),we=ce(B),xt=Rt=>{re==="auto"&&Y.start(Z.current||0,Rt),o&&o(Te.current,Rt)};return J.jsx(se,{appear:u,in:T,nodeRef:Te,onEnter:W,onEntered:ge,onEntering:he,onExit:Ee,onExited:we,onExiting:_e,addEndListener:xt,timeout:re==="auto"?null:re,...G,children:(Rt,Bt)=>ue.cloneElement(f,{style:{opacity:0,transform:JM(.75),visibility:Rt==="exited"&&!T?"hidden":void 0,...vde[Rt],...Q,...f.props.style},ref:Pe,...Bt})})});ek&&(ek.muiSupportAuto=!0);const xde=t=>{const{classes:e,disableUnderline:r}=t,u=Ii({root:["root",!r&&"underline"],input:["input"]},Jue,e);return{...e,...u}},bde=Hn(_I,{shouldForwardProp:t=>Ba(t)||t==="classes",name:"MuiInput",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[...mI(t,e),!r.disableUnderline&&e.underline]}})(Yi(({theme:t})=>{let r=t.palette.mode==="light"?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return t.vars&&(r=`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`),{position:"relative",variants:[{props:({ownerState:o})=>o.formControl,style:{"label + &":{marginTop:16}}},{props:({ownerState:o})=>!o.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Y0.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Y0.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${r}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Y0.disabled}, .${Y0.error}):before`]:{borderBottom:`2px solid ${(t.vars||t).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${r}`}},[`&.${Y0.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(t.palette).filter(([,o])=>o&&o.main).map(([o])=>({props:{color:o,disableUnderline:!1},style:{"&::after":{borderBottom:`2px solid ${(t.vars||t).palette[o].main}`}}}))]}})),wde=Hn(yI,{name:"MuiInput",slot:"Input",overridesResolver:gI})({}),ME=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiInput"}),{disableUnderline:u=!1,components:f={},componentsProps:y,fullWidth:T=!1,inputComponent:a="input",multiline:A=!1,slotProps:D,slots:O={},type:B="text",...H}=o,Q=xde(o),se={root:{ownerState:{disableUnderline:u}}},G=D??y?Ho(D??y,se):se,Y=O.root??f.Root??bde,Z=O.input??f.Input??wde;return J.jsx(wO,{slots:{root:Y,input:Z},slotProps:G,fullWidth:T,inputComponent:a,multiline:A,ref:r,type:B,...H,classes:Q})});ME&&(ME.muiName="Input");function Tde(t){return wi("MuiInputLabel",t)}Ti("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const Ede=t=>{const{classes:e,formControl:r,size:o,shrink:u,disableAnimation:f,variant:y,required:T}=t,a={root:["root",r&&"formControl",!f&&"animated",u&&"shrink",o&&o!=="normal"&&`size${Wn(o)}`,y],asterisk:[T&&"asterisk"]},A=Ii(a,Tde,e);return{...e,...A}},Sde=Hn(yde,{shouldForwardProp:t=>Ba(t)||t==="classes",name:"MuiInputLabel",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[{[`& .${Vv.asterisk}`]:e.asterisk},e.root,r.formControl&&e.formControl,r.size==="small"&&e.sizeSmall,r.shrink&&e.shrink,!r.disableAnimation&&e.animated,r.focused&&e.focused,e[r.variant]]}})(Yi(({theme:t})=>({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",variants:[{props:({ownerState:e})=>e.formControl,style:{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"}},{props:{size:"small"},style:{transform:"translate(0, 17px) scale(1)"}},{props:({ownerState:e})=>e.shrink,style:{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"}},{props:({ownerState:e})=>!e.disableAnimation,style:{transition:t.transitions.create(["color","transform","max-width"],{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut})}},{props:{variant:"filled"},style:{zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"filled",size:"small"},style:{transform:"translate(12px, 13px) scale(1)"}},{props:({variant:e,ownerState:r})=>e==="filled"&&r.shrink,style:{userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"}},{props:({variant:e,ownerState:r,size:o})=>e==="filled"&&r.shrink&&o==="small",style:{transform:"translate(12px, 4px) scale(0.75)"}},{props:{variant:"outlined"},style:{zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"outlined",size:"small"},style:{transform:"translate(14px, 9px) scale(1)"}},{props:({variant:e,ownerState:r})=>e==="outlined"&&r.shrink,style:{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}}]}))),Ide=ue.forwardRef(function(e,r){const o=Qi({name:"MuiInputLabel",props:e}),{disableAnimation:u=!1,margin:f,shrink:y,variant:T,className:a,...A}=o,D=Uh();let O=y;typeof O>"u"&&D&&(O=D.filled||D.focused||D.adornedStart);const B=Af({props:o,muiFormControl:D,states:["size","variant","required","focused"]}),H={...o,disableAnimation:u,formControl:D,shrink:O,size:B.size,variant:B.variant,required:B.required,focused:B.focused},Q=Ede(H);return J.jsx(Sde,{"data-shrink":O,ref:r,className:Mr(Q.root,a),...A,ownerState:H,classes:Q})}),Ade=ue.createContext({});function Cde(t){return wi("MuiList",t)}Ti("MuiList",["root","padding","dense","subheader"]);const Pde=t=>{const{classes:e,disablePadding:r,dense:o,subheader:u}=t;return Ii({root:["root",!r&&"padding",o&&"dense",u&&"subheader"]},Cde,e)},Rde=Hn("ul",{name:"MuiList",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,!r.disablePadding&&e.padding,r.dense&&e.dense,r.subheader&&e.subheader]}})({listStyle:"none",margin:0,padding:0,position:"relative",variants:[{props:({ownerState:t})=>!t.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:t})=>t.subheader,style:{paddingTop:0}}]}),Mde=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiList"}),{children:u,className:f,component:y="ul",dense:T=!1,disablePadding:a=!1,subheader:A,...D}=o,O=ue.useMemo(()=>({dense:T}),[T]),B={...o,component:y,dense:T,disablePadding:a},H=Pde(B);return J.jsx(Ade.Provider,{value:O,children:J.jsxs(Rde,{as:y,className:Mr(H.root,f),ref:r,ownerState:B,...D,children:[A,u]})})});function XP(t,e,r){return t===e?t.firstChild:e&&e.nextElementSibling?e.nextElementSibling:r?null:t.firstChild}function zU(t,e,r){return t===e?r?t.firstChild:t.lastChild:e&&e.previousElementSibling?e.previousElementSibling:r?null:t.lastChild}function zG(t,e){if(e===void 0)return!0;let r=t.innerText;return r===void 0&&(r=t.textContent),r=r.trim().toLowerCase(),r.length===0?!1:e.repeating?r[0]===e.keys[0]:r.startsWith(e.keys.join(""))}function Q0(t,e,r,o,u,f){let y=!1,T=u(t,e,e?r:!1);for(;T;){if(T===t.firstChild){if(y)return!1;y=!0}const a=o?!1:T.disabled||T.getAttribute("aria-disabled")==="true";if(!T.hasAttribute("tabindex")||!zG(T,f)||a)T=u(t,T,r);else return T.focus(),!0}return!1}const kde=ue.forwardRef(function(e,r){const{actions:o,autoFocus:u=!1,autoFocusItem:f=!1,children:y,className:T,disabledItemsFocusable:a=!1,disableListWrap:A=!1,onKeyDown:D,variant:O="selectedMenu",...B}=e,H=ue.useRef(null),Q=ue.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});am(()=>{u&&H.current.focus()},[u]),ue.useImperativeHandle(o,()=>({adjustStyleForScrollbar:(Z,{direction:fe})=>{const Te=!H.current.style.width;if(Z.clientHeight<H.current.clientHeight&&Te){const Pe=`${wG(ol(Z))}px`;H.current.style[fe==="rtl"?"paddingLeft":"paddingRight"]=Pe,H.current.style.width=`calc(100% + ${Pe})`}return H.current}}),[]);const re=Z=>{const fe=H.current,Te=Z.key;if(Z.ctrlKey||Z.metaKey||Z.altKey){D&&D(Z);return}const ce=ol(fe).activeElement;if(Te==="ArrowDown")Z.preventDefault(),Q0(fe,ce,A,a,XP);else if(Te==="ArrowUp")Z.preventDefault(),Q0(fe,ce,A,a,zU);else if(Te==="Home")Z.preventDefault(),Q0(fe,null,A,a,XP);else if(Te==="End")Z.preventDefault(),Q0(fe,null,A,a,zU);else if(Te.length===1){const he=Q.current,W=Te.toLowerCase(),ge=performance.now();he.keys.length>0&&(ge-he.lastTime>500?(he.keys=[],he.repeating=!0,he.previousKeyMatched=!0):he.repeating&&W!==he.keys[0]&&(he.repeating=!1)),he.lastTime=ge,he.keys.push(W);const _e=ce&&!he.repeating&&zG(ce,he);he.previousKeyMatched&&(_e||Q0(fe,ce,!1,a,XP,he))?Z.preventDefault():he.previousKeyMatched=!1}D&&D(Z)},se=Po(H,r);let G=-1;ue.Children.forEach(y,(Z,fe)=>{if(!ue.isValidElement(Z)){G===fe&&(G+=1,G>=y.length&&(G=-1));return}Z.props.disabled||(O==="selectedMenu"&&Z.props.selected||G===-1)&&(G=fe),G===fe&&(Z.props.disabled||Z.props.muiSkipListHighlight||Z.type.muiSkipListHighlight)&&(G+=1,G>=y.length&&(G=-1))});const Y=ue.Children.map(y,(Z,fe)=>{if(fe===G){const Te={};return f&&(Te.autoFocus=!0),Z.props.tabIndex===void 0&&O==="selectedMenu"&&(Te.tabIndex=0),ue.cloneElement(Z,Te)}return Z});return J.jsx(Mde,{role:"menu",ref:se,className:T,onKeyDown:re,tabIndex:u?0:-1,...B,children:Y})});function Dde(t){return wi("MuiPopover",t)}Ti("MuiPopover",["root","paper"]);function NU(t,e){let r=0;return typeof e=="number"?r=e:e==="center"?r=t.height/2:e==="bottom"&&(r=t.height),r}function FU(t,e){let r=0;return typeof e=="number"?r=e:e==="center"?r=t.width/2:e==="right"&&(r=t.width),r}function BU(t){return[t.horizontal,t.vertical].map(e=>typeof e=="number"?`${e}px`:e).join(" ")}function KP(t){return typeof t=="function"?t():t}const Ode=t=>{const{classes:e}=t;return Ii({root:["root"],paper:["paper"]},Dde,e)},Lde=Hn(Hhe,{name:"MuiPopover",slot:"Root",overridesResolver:(t,e)=>e.root})({}),NG=Hn(xue,{name:"MuiPopover",slot:"Paper",overridesResolver:(t,e)=>e.paper})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),zde=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiPopover"}),{action:u,anchorEl:f,anchorOrigin:y={vertical:"top",horizontal:"left"},anchorPosition:T,anchorReference:a="anchorEl",children:A,className:D,container:O,elevation:B=8,marginThreshold:H=16,open:Q,PaperProps:re={},slots:se={},slotProps:G={},transformOrigin:Y={vertical:"top",horizontal:"left"},TransitionComponent:Z=ek,transitionDuration:fe="auto",TransitionProps:{onEntering:Te,...Pe}={},disableScrollLock:ce=!1,...he}=o,W=(G==null?void 0:G.paper)??re,ge=ue.useRef(),_e={...o,anchorOrigin:y,anchorReference:a,elevation:B,marginThreshold:H,externalPaperSlotProps:W,transformOrigin:Y,TransitionComponent:Z,transitionDuration:fe,TransitionProps:Pe},Ee=Ode(_e),we=ue.useCallback(()=>{if(a==="anchorPosition")return T;const ln=KP(f),xn=(ln&&ln.nodeType===1?ln:ol(ge.current).body).getBoundingClientRect();return{top:xn.top+NU(xn,y.vertical),left:xn.left+FU(xn,y.horizontal)}},[f,y.horizontal,y.vertical,T,a]),xt=ue.useCallback(ln=>({vertical:NU(ln,Y.vertical),horizontal:FU(ln,Y.horizontal)}),[Y.horizontal,Y.vertical]),Rt=ue.useCallback(ln=>{const Kt={width:ln.offsetWidth,height:ln.offsetHeight},xn=xt(Kt);if(a==="none")return{top:null,left:null,transformOrigin:BU(xn)};const Er=we();let Dn=Er.top-xn.vertical,hr=Er.left-xn.horizontal;const Fr=Dn+Kt.height,ar=hr+Kt.width,Yn=lm(KP(f)),De=Yn.innerHeight-H,Ze=Yn.innerWidth-H;if(H!==null&&Dn<H){const st=Dn-H;Dn-=st,xn.vertical+=st}else if(H!==null&&Fr>De){const st=Fr-De;Dn-=st,xn.vertical+=st}if(H!==null&&hr<H){const st=hr-H;hr-=st,xn.horizontal+=st}else if(ar>Ze){const st=ar-Ze;hr-=st,xn.horizontal+=st}return{top:`${Math.round(Dn)}px`,left:`${Math.round(hr)}px`,transformOrigin:BU(xn)}},[f,a,we,xt,H]),[Bt,bt]=ue.useState(Q),at=ue.useCallback(()=>{const ln=ge.current;if(!ln)return;const Kt=Rt(ln);Kt.top!==null&&(ln.style.top=Kt.top),Kt.left!==null&&(ln.style.left=Kt.left),ln.style.transformOrigin=Kt.transformOrigin,bt(!0)},[Rt]);ue.useEffect(()=>(ce&&window.addEventListener("scroll",at),()=>window.removeEventListener("scroll",at)),[f,ce,at]);const Ct=(ln,Kt)=>{Te&&Te(ln,Kt),at()},Zt=()=>{bt(!1)};ue.useEffect(()=>{Q&&at()}),ue.useImperativeHandle(u,()=>Q?{updatePosition:()=>{at()}}:null,[Q,at]),ue.useEffect(()=>{if(!Q)return;const ln=vG(()=>{at()}),Kt=lm(f);return Kt.addEventListener("resize",ln),()=>{ln.clear(),Kt.removeEventListener("resize",ln)}},[f,Q,at]);let rt=fe;fe==="auto"&&!Z.muiSupportAuto&&(rt=void 0);const wt=O||(f?ol(KP(f)).body:void 0),pt={slots:se,slotProps:{...G,paper:W}},[jt,Mt]=Ol("paper",{elementType:NG,externalForwardedProps:pt,additionalProps:{elevation:B,className:Mr(Ee.paper,W==null?void 0:W.className),style:Bt?W.style:{...W.style,opacity:0}},ownerState:_e}),[pn,{slotProps:un,..._n}]=Ol("root",{elementType:Lde,externalForwardedProps:pt,additionalProps:{slotProps:{backdrop:{invisible:!0}},container:wt,open:Q},ownerState:_e,className:Mr(Ee.root,D)}),St=Po(ge,Mt.ref);return J.jsx(pn,{..._n,...!QM(pn)&&{slotProps:un,disableScrollLock:ce},...he,ref:r,children:J.jsx(Z,{appear:!0,in:Q,onEntering:Ct,onExited:Zt,timeout:rt,...Pe,children:J.jsx(jt,{...Mt,ref:St,children:A})})})});function Nde(t){return wi("MuiMenu",t)}Ti("MuiMenu",["root","paper","list"]);const Fde={vertical:"top",horizontal:"right"},Bde={vertical:"top",horizontal:"left"},Ude=t=>{const{classes:e}=t;return Ii({root:["root"],paper:["paper"],list:["list"]},Nde,e)},Vde=Hn(zde,{shouldForwardProp:t=>Ba(t)||t==="classes",name:"MuiMenu",slot:"Root",overridesResolver:(t,e)=>e.root})({}),jde=Hn(NG,{name:"MuiMenu",slot:"Paper",overridesResolver:(t,e)=>e.paper})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),$de=Hn(kde,{name:"MuiMenu",slot:"List",overridesResolver:(t,e)=>e.list})({outline:0}),Gde=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiMenu"}),{autoFocus:u=!0,children:f,className:y,disableAutoFocusItem:T=!1,MenuListProps:a={},onClose:A,open:D,PaperProps:O={},PopoverClasses:B,transitionDuration:H="auto",TransitionProps:{onEntering:Q,...re}={},variant:se="selectedMenu",slots:G={},slotProps:Y={},...Z}=o,fe=_ce(),Te={...o,autoFocus:u,disableAutoFocusItem:T,MenuListProps:a,onEntering:Q,PaperProps:O,transitionDuration:H,TransitionProps:re,variant:se},Pe=Ude(Te),ce=u&&!T&&D,he=ue.useRef(null),W=(Bt,bt)=>{he.current&&he.current.adjustStyleForScrollbar(Bt,{direction:fe?"rtl":"ltr"}),Q&&Q(Bt,bt)},ge=Bt=>{Bt.key==="Tab"&&(Bt.preventDefault(),A&&A(Bt,"tabKeyDown"))};let _e=-1;ue.Children.map(f,(Bt,bt)=>{ue.isValidElement(Bt)&&(Bt.props.disabled||(se==="selectedMenu"&&Bt.props.selected||_e===-1)&&(_e=bt))});const Ee=G.paper??jde,we=Y.paper??O,xt=EE({elementType:G.root,externalSlotProps:Y.root,ownerState:Te,className:[Pe.root,y]}),Rt=EE({elementType:Ee,externalSlotProps:we,ownerState:Te,className:Pe.paper});return J.jsx(Vde,{onClose:A,anchorOrigin:{vertical:"bottom",horizontal:fe?"right":"left"},transformOrigin:fe?Fde:Bde,slots:{paper:Ee,root:G.root},slotProps:{root:xt,paper:Rt},open:D,ref:r,transitionDuration:H,TransitionProps:{onEntering:W,...re},ownerState:Te,...Z,classes:B,children:J.jsx($de,{onKeyDown:ge,actions:he,autoFocus:u&&(_e===-1||T),autoFocusItem:ce,variant:se,...a,className:Mr(Pe.list,a.className),children:f})})});function qde(t){return wi("MuiNativeSelect",t)}const TO=Ti("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),Wde=t=>{const{classes:e,variant:r,disabled:o,multiple:u,open:f,error:y}=t,T={select:["select",r,o&&"disabled",u&&"multiple",y&&"error"],icon:["icon",`icon${Wn(r)}`,f&&"iconOpen",o&&"disabled"]};return Ii(T,qde,e)},FG=Hn("select")(({theme:t})=>({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":{borderRadius:0},[`&.${TO.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(t.vars||t).palette.background.paper},variants:[{props:({ownerState:e})=>e.variant!=="filled"&&e.variant!=="outlined",style:{"&&&":{paddingRight:24,minWidth:16}}},{props:{variant:"filled"},style:{"&&&":{paddingRight:32}}},{props:{variant:"outlined"},style:{borderRadius:(t.vars||t).shape.borderRadius,"&:focus":{borderRadius:(t.vars||t).shape.borderRadius},"&&&":{paddingRight:32}}}]})),Hde=Hn(FG,{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:Ba,overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.select,e[r.variant],r.error&&e.error,{[`&.${TO.multiple}`]:e.multiple}]}})({}),BG=Hn("svg")(({theme:t})=>({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(t.vars||t).palette.action.active,[`&.${TO.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:({ownerState:e})=>e.open,style:{transform:"rotate(180deg)"}},{props:{variant:"filled"},style:{right:7}},{props:{variant:"outlined"},style:{right:7}}]})),Zde=Hn(BG,{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.icon,r.variant&&e[`icon${Wn(r.variant)}`],r.open&&e.iconOpen]}})({}),Xde=ue.forwardRef(function(e,r){const{className:o,disabled:u,error:f,IconComponent:y,inputRef:T,variant:a="standard",...A}=e,D={...e,disabled:u,variant:a,error:f},O=Wde(D);return J.jsxs(ue.Fragment,{children:[J.jsx(Hde,{ownerState:D,className:Mr(O.select,o),disabled:u,ref:T||r,...A}),e.multiple?null:J.jsx(Zde,{as:y,ownerState:D,className:O.icon})]})});var UU;const Kde=Hn("fieldset",{shouldForwardProp:Ba})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),Yde=Hn("legend",{shouldForwardProp:Ba})(Yi(({theme:t})=>({float:"unset",width:"auto",overflow:"hidden",variants:[{props:({ownerState:e})=>!e.withLabel,style:{padding:0,lineHeight:"11px",transition:t.transitions.create("width",{duration:150,easing:t.transitions.easing.easeOut})}},{props:({ownerState:e})=>e.withLabel,style:{display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:t.transitions.create("max-width",{duration:50,easing:t.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}}},{props:({ownerState:e})=>e.withLabel&&e.notched,style:{maxWidth:"100%",transition:t.transitions.create("max-width",{duration:100,easing:t.transitions.easing.easeOut,delay:50})}}]})));function Qde(t){const{children:e,classes:r,className:o,label:u,notched:f,...y}=t,T=u!=null&&u!=="",a={...t,notched:f,withLabel:T};return J.jsx(Kde,{"aria-hidden":!0,className:o,ownerState:a,...y,children:J.jsx(Yde,{ownerState:a,children:T?J.jsx("span",{children:u}):UU||(UU=J.jsx("span",{className:"notranslate",children:""}))})})}const Jde=t=>{const{classes:e}=t,o=Ii({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},ehe,e);return{...e,...o}},efe=Hn(_I,{shouldForwardProp:t=>Ba(t)||t==="classes",name:"MuiOutlinedInput",slot:"Root",overridesResolver:mI})(Yi(({theme:t})=>{const e=t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{position:"relative",borderRadius:(t.vars||t).shape.borderRadius,[`&:hover .${su.notchedOutline}`]:{borderColor:(t.vars||t).palette.text.primary},[`&.${su.focused} .${su.notchedOutline}`]:{borderWidth:2},variants:[...Object.entries(t.palette).filter(([,r])=>r&&r.main).map(([r])=>({props:{color:r},style:{[`&.${su.focused} .${su.notchedOutline}`]:{borderColor:(t.vars||t).palette[r].main}}})),{props:{},style:{"@media (hover: none)":{[`&:hover .${su.notchedOutline}`]:{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:e}},[`&.${su.error} .${su.notchedOutline}`]:{borderColor:(t.vars||t).palette.error.main},[`&.${su.disabled} .${su.notchedOutline}`]:{borderColor:(t.vars||t).palette.action.disabled}}},{props:({ownerState:r})=>r.startAdornment,style:{paddingLeft:14}},{props:({ownerState:r})=>r.endAdornment,style:{paddingRight:14}},{props:({ownerState:r})=>r.multiline,style:{padding:"16.5px 14px"}},{props:({ownerState:r,size:o})=>r.multiline&&o==="small",style:{padding:"8.5px 14px"}}]}})),tfe=Hn(Qde,{name:"MuiOutlinedInput",slot:"NotchedOutline",overridesResolver:(t,e)=>e.notchedOutline})(Yi(({theme:t})=>{const e=t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:e}})),nfe=Hn(yI,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:gI})(Yi(({theme:t})=>({padding:"16.5px 14px",...!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:t.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:t.palette.mode==="light"?null:"#fff",caretColor:t.palette.mode==="light"?null:"#fff",borderRadius:"inherit"}},...t.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{padding:"8.5px 14px"}},{props:({ownerState:e})=>e.multiline,style:{padding:0}},{props:({ownerState:e})=>e.startAdornment,style:{paddingLeft:0}},{props:({ownerState:e})=>e.endAdornment,style:{paddingRight:0}}]}))),kE=ue.forwardRef(function(e,r){var o;const u=Qi({props:e,name:"MuiOutlinedInput"}),{components:f={},fullWidth:y=!1,inputComponent:T="input",label:a,multiline:A=!1,notched:D,slots:O={},type:B="text",...H}=u,Q=Jde(u),re=Uh(),se=Af({props:u,muiFormControl:re,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),G={...u,color:se.color||"primary",disabled:se.disabled,error:se.error,focused:se.focused,formControl:re,fullWidth:y,hiddenLabel:se.hiddenLabel,multiline:A,size:se.size,type:B},Y=O.root??f.Root??efe,Z=O.input??f.Input??nfe;return J.jsx(wO,{slots:{root:Y,input:Z},renderSuffix:fe=>J.jsx(tfe,{ownerState:G,className:Q.notchedOutline,label:a!=null&&a!==""&&se.required?o||(o=J.jsxs(ue.Fragment,{children:[a,"","*"]})):a,notched:typeof D<"u"?D:!!(fe.startAdornment||fe.filled||fe.focused)}),fullWidth:y,inputComponent:T,multiline:A,ref:r,type:B,...H,classes:{...Q,notchedOutline:null}})});kE&&(kE.muiName="Input");const rfe=hy(J.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),ife=hy(J.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),sfe=Hn("span",{shouldForwardProp:Ba})({position:"relative",display:"flex"}),ofe=Hn(rfe)({transform:"scale(1)"}),afe=Hn(ife)(Yi(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function UG(t){const{checked:e=!1,classes:r={},fontSize:o}=t,u={...t,checked:e};return J.jsxs(sfe,{className:r.root,ownerState:u,children:[J.jsx(ofe,{fontSize:o,className:r.background,ownerState:u}),J.jsx(afe,{fontSize:o,className:r.dot,ownerState:u})]})}const VG=ue.createContext(void 0);function lfe(){return ue.useContext(VG)}function cfe(t){return wi("MuiRadio",t)}const VU=Ti("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),ufe=t=>{const{classes:e,color:r,size:o}=t,u={root:["root",`color${Wn(r)}`,o!=="medium"&&`size${Wn(o)}`]};return{...e,...Ii(u,cfe,e)}},hfe=Hn(Ihe,{shouldForwardProp:t=>Ba(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.size!=="medium"&&e[`size${Wn(r.size)}`],e[`color${Wn(r.color)}`]]}})(Yi(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${VU.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:Dl(t.palette.action.active,t.palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[e].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:Dl(t.palette[e].main,t.palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e},style:{[`&.${VU.checked}`]:{color:(t.vars||t).palette[e].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function dfe(t,e){return typeof e=="object"&&e!==null?t===e:String(t)===String(e)}const jU=J.jsx(UG,{checked:!0}),$U=J.jsx(UG,{}),ffe=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiRadio"}),{checked:u,checkedIcon:f=jU,color:y="primary",icon:T=$U,name:a,onChange:A,size:D="medium",className:O,disableRipple:B=!1,...H}=o,Q={...o,disableRipple:B,color:y,size:D},re=ufe(Q),se=lfe();let G=u;const Y=qM(A,se&&se.onChange);let Z=a;return se&&(typeof G>"u"&&(G=dfe(se.value,o.value)),typeof Z>"u"&&(Z=se.name)),J.jsx(hfe,{type:"radio",icon:ue.cloneElement(T,{fontSize:$U.props.fontSize??D}),checkedIcon:ue.cloneElement(f,{fontSize:jU.props.fontSize??D}),ownerState:Q,classes:re,name:Z,checked:G,onChange:Y,ref:r,className:Mr(re.root,O),...H})});function pfe(t){return wi("MuiRadioGroup",t)}Ti("MuiRadioGroup",["root","row","error"]);const mfe=t=>{const{classes:e,row:r,error:o}=t;return Ii({root:["root",r&&"row",o&&"error"]},pfe,e)},gfe=ue.forwardRef(function(e,r){const{actions:o,children:u,className:f,defaultValue:y,name:T,onChange:a,value:A,...D}=e,O=ue.useRef(null),B=mfe(e),[H,Q]=TE({controlled:A,default:y,name:"RadioGroup"});ue.useImperativeHandle(o,()=>({focus:()=>{let Y=O.current.querySelector("input:not(:disabled):checked");Y||(Y=O.current.querySelector("input:not(:disabled)")),Y&&Y.focus()}}),[]);const re=Po(r,O),se=pO(T),G=ue.useMemo(()=>({name:se,onChange(Y){Q(Y.target.value),a&&a(Y,Y.target.value)},value:H}),[se,a,Q,H]);return J.jsx(VG.Provider,{value:G,children:J.jsx(cde,{role:"radiogroup",ref:re,className:Mr(B.root,f),...D,children:u})})});function _fe(t){return wi("MuiSelect",t)}const J0=Ti("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var GU;const yfe=Hn(FG,{name:"MuiSelect",slot:"Select",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[{[`&.${J0.select}`]:e.select},{[`&.${J0.select}`]:e[r.variant]},{[`&.${J0.error}`]:e.error},{[`&.${J0.multiple}`]:e.multiple}]}})({[`&.${J0.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),vfe=Hn(BG,{name:"MuiSelect",slot:"Icon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.icon,r.variant&&e[`icon${Wn(r.variant)}`],r.open&&e.iconOpen]}})({}),xfe=Hn("input",{shouldForwardProp:t=>RG(t)&&t!=="classes",name:"MuiSelect",slot:"NativeInput",overridesResolver:(t,e)=>e.nativeInput})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function qU(t,e){return typeof e=="object"&&e!==null?t===e:String(t)===String(e)}function bfe(t){return t==null||typeof t=="string"&&!t.trim()}const wfe=t=>{const{classes:e,variant:r,disabled:o,multiple:u,open:f,error:y}=t,T={select:["select",r,o&&"disabled",u&&"multiple",y&&"error"],icon:["icon",`icon${Wn(r)}`,f&&"iconOpen",o&&"disabled"],nativeInput:["nativeInput"]};return Ii(T,_fe,e)},Tfe=ue.forwardRef(function(e,r){var ls;const{"aria-describedby":o,"aria-label":u,autoFocus:f,autoWidth:y,children:T,className:a,defaultOpen:A,defaultValue:D,disabled:O,displayEmpty:B,error:H=!1,IconComponent:Q,inputRef:re,labelId:se,MenuProps:G={},multiple:Y,name:Z,onBlur:fe,onChange:Te,onClose:Pe,onFocus:ce,onOpen:he,open:W,readOnly:ge,renderValue:_e,SelectDisplayProps:Ee={},tabIndex:we,type:xt,value:Rt,variant:Bt="standard",...bt}=e,[at,Ct]=TE({controlled:Rt,default:D,name:"Select"}),[Zt,rt]=TE({controlled:W,default:A,name:"Select"}),wt=ue.useRef(null),pt=ue.useRef(null),[jt,Mt]=ue.useState(null),{current:pn}=ue.useRef(W!=null),[un,_n]=ue.useState(),St=Po(r,re),ln=ue.useCallback(Sn=>{pt.current=Sn,Sn&&Mt(Sn)},[]),Kt=jt==null?void 0:jt.parentNode;ue.useImperativeHandle(St,()=>({focus:()=>{pt.current.focus()},node:wt.current,value:at}),[at]),ue.useEffect(()=>{A&&Zt&&jt&&!pn&&(_n(y?null:Kt.clientWidth),pt.current.focus())},[jt,y]),ue.useEffect(()=>{f&&pt.current.focus()},[f]),ue.useEffect(()=>{if(!se)return;const Sn=ol(pt.current).getElementById(se);if(Sn){const lr=()=>{getSelection().isCollapsed&&pt.current.focus()};return Sn.addEventListener("click",lr),()=>{Sn.removeEventListener("click",lr)}}},[se]);const xn=(Sn,lr)=>{Sn?he&&he(lr):Pe&&Pe(lr),pn||(_n(y?null:Kt.clientWidth),rt(Sn))},Er=Sn=>{Sn.button===0&&(Sn.preventDefault(),pt.current.focus(),xn(!0,Sn))},Dn=Sn=>{xn(!1,Sn)},hr=ue.Children.toArray(T),Fr=Sn=>{const lr=hr.find(hn=>hn.props.value===Sn.target.value);lr!==void 0&&(Ct(lr.props.value),Te&&Te(Sn,lr))},ar=Sn=>lr=>{let hn;if(lr.currentTarget.hasAttribute("tabindex")){if(Y){hn=Array.isArray(at)?at.slice():[];const Zs=at.indexOf(Sn.props.value);Zs===-1?hn.push(Sn.props.value):hn.splice(Zs,1)}else hn=Sn.props.value;if(Sn.props.onClick&&Sn.props.onClick(lr),at!==hn&&(Ct(hn),Te)){const Zs=lr.nativeEvent||lr,Ei=new Zs.constructor(Zs.type,Zs);Object.defineProperty(Ei,"target",{writable:!0,value:{value:hn,name:Z}}),Te(Ei,Sn)}Y||xn(!1,lr)}},Yn=Sn=>{ge||[" ","ArrowUp","ArrowDown","Enter"].includes(Sn.key)&&(Sn.preventDefault(),xn(!0,Sn))},De=jt!==null&&Zt,Ze=Sn=>{!De&&fe&&(Object.defineProperty(Sn,"target",{writable:!0,value:{value:at,name:Z}}),fe(Sn))};delete bt["aria-invalid"];let st,rn;const Pt=[];let vn=!1;(PE({value:at})||B)&&(_e?st=_e(at):vn=!0);const Sr=hr.map(Sn=>{if(!ue.isValidElement(Sn))return null;let lr;if(Y){if(!Array.isArray(at))throw new Error(Oh(2));lr=at.some(hn=>qU(hn,Sn.props.value)),lr&&vn&&Pt.push(Sn.props.children)}else lr=qU(at,Sn.props.value),lr&&vn&&(rn=Sn.props.children);return ue.cloneElement(Sn,{"aria-selected":lr?"true":"false",onClick:ar(Sn),onKeyUp:hn=>{hn.key===" "&&hn.preventDefault(),Sn.props.onKeyUp&&Sn.props.onKeyUp(hn)},role:"option",selected:lr,value:void 0,"data-value":Sn.props.value})});vn&&(Y?Pt.length===0?st=null:st=Pt.reduce((Sn,lr,hn)=>(Sn.push(lr),hn<Pt.length-1&&Sn.push(", "),Sn),[]):st=rn);let yn=un;!y&&pn&&jt&&(yn=Kt.clientWidth);let Zn;typeof we<"u"?Zn=we:Zn=O?null:0;const br=Ee.id||(Z?`mui-component-select-${Z}`:void 0),Lr={...e,variant:Bt,value:at,open:De,error:H},Li=wfe(Lr),dr={...G.PaperProps,...(ls=G.slotProps)==null?void 0:ls.paper},zi=pO();return J.jsxs(ue.Fragment,{children:[J.jsx(yfe,{as:"div",ref:ln,tabIndex:Zn,role:"combobox","aria-controls":zi,"aria-disabled":O?"true":void 0,"aria-expanded":De?"true":"false","aria-haspopup":"listbox","aria-label":u,"aria-labelledby":[se,br].filter(Boolean).join(" ")||void 0,"aria-describedby":o,onKeyDown:Yn,onMouseDown:O||ge?null:Er,onBlur:Ze,onFocus:ce,...Ee,ownerState:Lr,className:Mr(Ee.className,Li.select,a),id:br,children:bfe(st)?GU||(GU=J.jsx("span",{className:"notranslate",children:""})):st}),J.jsx(xfe,{"aria-invalid":H,value:Array.isArray(at)?at.join(","):at,name:Z,ref:wt,"aria-hidden":!0,onChange:Fr,tabIndex:-1,disabled:O,className:Li.nativeInput,autoFocus:f,...bt,ownerState:Lr}),J.jsx(vfe,{as:Q,className:Li.icon,ownerState:Lr}),J.jsx(Gde,{id:`menu-${Z||""}`,anchorEl:Kt,open:De,onClose:Dn,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},...G,MenuListProps:{"aria-labelledby":se,role:"listbox","aria-multiselectable":Y?"true":void 0,disableListWrap:!0,id:zi,...G.MenuListProps},slotProps:{...G.slotProps,paper:{...dr,style:{minWidth:yn,...dr!=null?dr.style:null}}},children:Sr})]})}),Efe=t=>{const{classes:e}=t;return e},EO={name:"MuiSelect",overridesResolver:(t,e)=>e.root,shouldForwardProp:t=>Ba(t)&&t!=="variant",slot:"Root"},Sfe=Hn(ME,EO)(""),Ife=Hn(kE,EO)(""),Afe=Hn(RE,EO)(""),jG=ue.forwardRef(function(e,r){const o=rue({name:"MuiSelect",props:e}),{autoWidth:u=!1,children:f,classes:y={},className:T,defaultOpen:a=!1,displayEmpty:A=!1,IconComponent:D=nhe,id:O,input:B,inputProps:H,label:Q,labelId:re,MenuProps:se,multiple:G=!1,native:Y=!1,onClose:Z,onOpen:fe,open:Te,renderValue:Pe,SelectDisplayProps:ce,variant:he="outlined",...W}=o,ge=Y?Xde:Tfe,_e=Uh(),Ee=Af({props:o,muiFormControl:_e,states:["variant","error"]}),we=Ee.variant||he,xt={...o,variant:we,classes:y},Rt=Efe(xt),{root:Bt,...bt}=Rt,at=B||{standard:J.jsx(Sfe,{ownerState:xt}),outlined:J.jsx(Ife,{label:Q,ownerState:xt}),filled:J.jsx(Afe,{ownerState:xt})}[we],Ct=Po(r,l1(at));return J.jsx(ue.Fragment,{children:ue.cloneElement(at,{inputComponent:ge,inputProps:{children:f,error:Ee.error,IconComponent:D,variant:we,type:void 0,multiple:G,...Y?{id:O}:{autoWidth:u,defaultOpen:a,displayEmpty:A,labelId:re,MenuProps:se,onClose:Z,onOpen:fe,open:Te,renderValue:Pe,SelectDisplayProps:{id:O,...ce}},...H,classes:H?Ho(bt,H.classes):bt,...B?B.props.inputProps:{}},...(G&&Y||A)&&we==="outlined"?{notched:!0}:{},ref:Ct,className:Mr(at.props.className,T,Rt.root),...!B&&{variant:we},...W})})});jG.muiName="Select";function Cfe(t){return wi("MuiTextField",t)}Ti("MuiTextField",["root"]);const Pfe={standard:ME,filled:RE,outlined:kE},Rfe=t=>{const{classes:e}=t;return Ii({root:["root"]},Cfe,e)},Mfe=Hn(ede,{name:"MuiTextField",slot:"Root",overridesResolver:(t,e)=>e.root})({}),kfe=ue.forwardRef(function(e,r){const o=Qi({props:e,name:"MuiTextField"}),{autoComplete:u,autoFocus:f=!1,children:y,className:T,color:a="primary",defaultValue:A,disabled:D=!1,error:O=!1,FormHelperTextProps:B,fullWidth:H=!1,helperText:Q,id:re,InputLabelProps:se,inputProps:G,InputProps:Y,inputRef:Z,label:fe,maxRows:Te,minRows:Pe,multiline:ce=!1,name:he,onBlur:W,onChange:ge,onFocus:_e,placeholder:Ee,required:we=!1,rows:xt,select:Rt=!1,SelectProps:Bt,slots:bt={},slotProps:at={},type:Ct,value:Zt,variant:rt="outlined",...wt}=o,pt={...o,autoFocus:f,color:a,disabled:D,error:O,fullWidth:H,multiline:ce,required:we,select:Rt,variant:rt},jt=Rfe(pt),Mt=pO(re),pn=Q&&Mt?`${Mt}-helper-text`:void 0,un=fe&&Mt?`${Mt}-label`:void 0,_n=Pfe[rt],St={slots:bt,slotProps:{input:Y,inputLabel:se,htmlInput:G,formHelperText:B,select:Bt,...at}},ln={},Kt=St.slotProps.inputLabel;rt==="outlined"&&(Kt&&typeof Kt.shrink<"u"&&(ln.notched=Kt.shrink),ln.label=fe),Rt&&((!Bt||!Bt.native)&&(ln.id=void 0),ln["aria-describedby"]=void 0);const[xn,Er]=Ol("input",{elementType:_n,externalForwardedProps:St,additionalProps:ln,ownerState:pt}),[Dn,hr]=Ol("inputLabel",{elementType:Ide,externalForwardedProps:St,ownerState:pt}),[Fr,ar]=Ol("htmlInput",{elementType:"input",externalForwardedProps:St,ownerState:pt}),[Yn,De]=Ol("formHelperText",{elementType:fde,externalForwardedProps:St,ownerState:pt}),[Ze,st]=Ol("select",{elementType:jG,externalForwardedProps:St,ownerState:pt}),rn=J.jsx(xn,{"aria-describedby":pn,autoComplete:u,autoFocus:f,defaultValue:A,fullWidth:H,multiline:ce,name:he,rows:xt,maxRows:Te,minRows:Pe,type:Ct,value:Zt,id:Mt,inputRef:Z,onBlur:W,onChange:ge,onFocus:_e,placeholder:Ee,inputProps:ar,slots:{input:bt.htmlInput?Fr:void 0},...Er});return J.jsxs(Mfe,{className:Mr(jt.root,T),disabled:D,error:O,fullWidth:H,ref:r,required:we,color:a,variant:rt,ownerState:pt,...wt,children:[fe!=null&&fe!==""&&J.jsx(Dn,{htmlFor:Mt,id:un,...hr,children:fe}),Rt?J.jsx(Ze,{"aria-describedby":pn,id:Mt,labelId:un,value:Zt,input:rn,...st,children:y}):rn,Q&&J.jsx(Yn,{id:pn,...De,children:Q})]})}),Dfe=hy(J.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),WU=hy([J.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),J.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"CameraAlt"),Ofe=hy(J.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),Lfe=ue.createContext(null),zfe=ue.createContext({}),Nfe=ue.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),Ffe=typeof window<"u",Bfe=Ffe?ue.useLayoutEffect:ue.useEffect;function $G(t){const e=ue.useRef(null);return e.current===null&&(e.current=t()),e.current}class Ufe extends ue.Component{getSnapshotBeforeUpdate(e){const r=this.props.childRef.current;if(r&&e.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=r.offsetHeight||0,o.width=r.offsetWidth||0,o.top=r.offsetTop,o.left=r.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Vfe({children:t,isPresent:e}){const r=ue.useId(),o=ue.useRef(null),u=ue.useRef({width:0,height:0,top:0,left:0}),{nonce:f}=ue.useContext(Nfe);return ue.useInsertionEffect(()=>{const{width:y,height:T,top:a,left:A}=u.current;if(e||!o.current||!y||!T)return;o.current.dataset.motionPopId=r;const D=document.createElement("style");return f&&(D.nonce=f),document.head.appendChild(D),D.sheet&&D.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${y}px !important;
            height: ${T}px !important;
            top: ${a}px !important;
            left: ${A}px !important;
          }
        `),()=>{document.head.removeChild(D)}},[e]),J.jsx(Ufe,{isPresent:e,childRef:o,sizeRef:u,children:ue.cloneElement(t,{ref:o})})}const jfe=({children:t,initial:e,isPresent:r,onExitComplete:o,custom:u,presenceAffectsLayout:f,mode:y})=>{const T=$G($fe),a=ue.useId(),A=ue.useMemo(()=>({id:a,initial:e,isPresent:r,custom:u,onExitComplete:D=>{T.set(D,!0);for(const O of T.values())if(!O)return;o&&o()},register:D=>(T.set(D,!1),()=>T.delete(D))}),f?[Math.random()]:[r]);return ue.useMemo(()=>{T.forEach((D,O)=>T.set(O,!1))},[r]),ue.useEffect(()=>{!r&&!T.size&&o&&o()},[r]),y==="popLayout"&&(t=J.jsx(Vfe,{isPresent:r,children:t})),J.jsx(Lfe.Provider,{value:A,children:t})};function $fe(){return new Map}const Vw=t=>t.key||"";function HU(t){const e=[];return ue.Children.forEach(t,r=>{ue.isValidElement(r)&&e.push(r)}),e}const Gfe=({children:t,exitBeforeEnter:e,custom:r,initial:o=!0,onExitComplete:u,presenceAffectsLayout:f=!0,mode:y="sync"})=>{const T=ue.useMemo(()=>HU(t),[t]),a=T.map(Vw),A=ue.useRef(!0),D=ue.useRef(T),O=$G(()=>new Map),[B,H]=ue.useState(T),[Q,re]=ue.useState(T);Bfe(()=>{A.current=!1,D.current=T;for(let Y=0;Y<Q.length;Y++){const Z=Vw(Q[Y]);a.includes(Z)?O.delete(Z):O.get(Z)!==!0&&O.set(Z,!1)}},[Q,a.length,a.join("-")]);const se=[];if(T!==B){let Y=[...T];for(let Z=0;Z<Q.length;Z++){const fe=Q[Z],Te=Vw(fe);a.includes(Te)||(Y.splice(Z,0,fe),se.push(fe))}y==="wait"&&se.length&&(Y=se),re(HU(Y)),H(T);return}const{forceRender:G}=ue.useContext(zfe);return J.jsx(J.Fragment,{children:Q.map(Y=>{const Z=Vw(Y),fe=T===Q||a.includes(Z),Te=()=>{if(O.has(Z))O.set(Z,!0);else return;let Pe=!0;O.forEach(ce=>{ce||(Pe=!1)}),Pe&&(G==null||G(),re(D.current),u&&u())};return J.jsx(jfe,{isPresent:fe,initial:!A.current||o?void 0:!1,custom:fe?void 0:r,presenceAffectsLayout:f,mode:y,onExitComplete:fe?void 0:Te,children:Y},Z)})})};var SO=u1(),kr=t=>c1(t,SO),IO=u1();kr.write=t=>c1(t,IO);var vI=u1();kr.onStart=t=>c1(t,vI);var AO=u1();kr.onFrame=t=>c1(t,AO);var CO=u1();kr.onFinish=t=>c1(t,CO);var T_=[];kr.setTimeout=(t,e)=>{const r=kr.now()+e,o=()=>{const f=T_.findIndex(y=>y.cancel==o);~f&&T_.splice(f,1),Yd-=~f?1:0},u={time:r,handler:t,cancel:o};return T_.splice(GG(r),0,u),Yd+=1,qG(),u};var GG=t=>~(~T_.findIndex(e=>e.time>t)||~T_.length);kr.cancel=t=>{vI.delete(t),AO.delete(t),CO.delete(t),SO.delete(t),IO.delete(t)};kr.sync=t=>{tk=!0,kr.batchedUpdates(t),tk=!1};kr.throttle=t=>{let e;function r(){try{t(...e)}finally{e=null}}function o(...u){e=u,kr.onStart(r)}return o.handler=t,o.cancel=()=>{vI.delete(r),e=null},o};var PO=typeof window<"u"?window.requestAnimationFrame:()=>{};kr.use=t=>PO=t;kr.now=typeof performance<"u"?()=>performance.now():Date.now;kr.batchedUpdates=t=>t();kr.catch=console.error;kr.frameLoop="always";kr.advance=()=>{kr.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):HG()};var Kd=-1,Yd=0,tk=!1;function c1(t,e){tk?(e.delete(t),t(0)):(e.add(t),qG())}function qG(){Kd<0&&(Kd=0,kr.frameLoop!=="demand"&&PO(WG))}function qfe(){Kd=-1}function WG(){~Kd&&(PO(WG),kr.batchedUpdates(HG))}function HG(){const t=Kd;Kd=kr.now();const e=GG(Kd);if(e&&(ZG(T_.splice(0,e),r=>r.handler()),Yd-=e),!Yd){qfe();return}vI.flush(),SO.flush(t?Math.min(64,Kd-t):16.667),AO.flush(),IO.flush(),CO.flush()}function u1(){let t=new Set,e=t;return{add(r){Yd+=e==t&&!t.has(r)?1:0,t.add(r)},delete(r){return Yd-=e==t&&t.has(r)?1:0,t.delete(r)},flush(r){e.size&&(t=new Set,Yd-=e.size,ZG(e,o=>o(r)&&t.add(o)),Yd+=t.size,e=t)}}}function ZG(t,e){t.forEach(r=>{try{e(r)}catch(o){kr.catch(o)}})}var Wfe=Object.defineProperty,Hfe=(t,e)=>{for(var r in e)Wfe(t,r,{get:e[r],enumerable:!0})},Pc={};Hfe(Pc,{assign:()=>Xfe,colors:()=>df,createStringInterpolator:()=>MO,skipAnimation:()=>KG,to:()=>XG,willAdvance:()=>kO});function nk(){}var Zfe=(t,e,r)=>Object.defineProperty(t,e,{value:r,writable:!0,configurable:!0}),mn={arr:Array.isArray,obj:t=>!!t&&t.constructor.name==="Object",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",und:t=>t===void 0};function hh(t,e){if(mn.arr(t)){if(!mn.arr(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}return t===e}var Yr=(t,e)=>t.forEach(e);function Au(t,e,r){if(mn.arr(t)){for(let o=0;o<t.length;o++)e.call(r,t[o],`${o}`);return}for(const o in t)t.hasOwnProperty(o)&&e.call(r,t[o],o)}var rl=t=>mn.und(t)?[]:mn.arr(t)?t:[t];function jv(t,e){if(t.size){const r=Array.from(t);t.clear(),Yr(r,e)}}var _v=(t,...e)=>jv(t,r=>r(...e)),RO=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),MO,XG,df=null,KG=!1,kO=nk,Xfe=t=>{t.to&&(XG=t.to),t.now&&(kr.now=t.now),t.colors!==void 0&&(df=t.colors),t.skipAnimation!=null&&(KG=t.skipAnimation),t.createStringInterpolator&&(MO=t.createStringInterpolator),t.requestAnimationFrame&&kr.use(t.requestAnimationFrame),t.batchedUpdates&&(kr.batchedUpdates=t.batchedUpdates),t.willAdvance&&(kO=t.willAdvance),t.frameLoop&&(kr.frameLoop=t.frameLoop)},$v=new Set,Ll=[],YP=[],DE=0,xI={get idle(){return!$v.size&&!Ll.length},start(t){DE>t.priority?($v.add(t),kr.onStart(Kfe)):(YG(t),kr(rk))},advance:rk,sort(t){if(DE)kr.onFrame(()=>xI.sort(t));else{const e=Ll.indexOf(t);~e&&(Ll.splice(e,1),QG(t))}},clear(){Ll=[],$v.clear()}};function Kfe(){$v.forEach(YG),$v.clear(),kr(rk)}function YG(t){Ll.includes(t)||QG(t)}function QG(t){Ll.splice(Yfe(Ll,e=>e.priority>t.priority),0,t)}function rk(t){const e=YP;for(let r=0;r<Ll.length;r++){const o=Ll[r];DE=o.priority,o.idle||(kO(o),o.advance(t),o.idle||e.push(o))}return DE=0,YP=Ll,YP.length=0,Ll=e,Ll.length>0}function Yfe(t,e){const r=t.findIndex(e);return r<0?t.length:r}var Qfe=(t,e,r)=>Math.min(Math.max(r,t),e),Jfe={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},Tc="[-+]?\\d*\\.?\\d+",OE=Tc+"%";function bI(...t){return"\\(\\s*("+t.join(")\\s*,\\s*(")+")\\s*\\)"}var epe=new RegExp("rgb"+bI(Tc,Tc,Tc)),tpe=new RegExp("rgba"+bI(Tc,Tc,Tc,Tc)),npe=new RegExp("hsl"+bI(Tc,OE,OE)),rpe=new RegExp("hsla"+bI(Tc,OE,OE,Tc)),ipe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,spe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,ope=/^#([0-9a-fA-F]{6})$/,ape=/^#([0-9a-fA-F]{8})$/;function lpe(t){let e;return typeof t=="number"?t>>>0===t&&t>=0&&t<=4294967295?t:null:(e=ope.exec(t))?parseInt(e[1]+"ff",16)>>>0:df&&df[t]!==void 0?df[t]:(e=epe.exec(t))?(Bg(e[1])<<24|Bg(e[2])<<16|Bg(e[3])<<8|255)>>>0:(e=tpe.exec(t))?(Bg(e[1])<<24|Bg(e[2])<<16|Bg(e[3])<<8|KU(e[4]))>>>0:(e=ipe.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=ape.exec(t))?parseInt(e[1],16)>>>0:(e=spe.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=npe.exec(t))?(ZU(XU(e[1]),jw(e[2]),jw(e[3]))|255)>>>0:(e=rpe.exec(t))?(ZU(XU(e[1]),jw(e[2]),jw(e[3]))|KU(e[4]))>>>0:null}function QP(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function ZU(t,e,r){const o=r<.5?r*(1+e):r+e-r*e,u=2*r-o,f=QP(u,o,t+1/3),y=QP(u,o,t),T=QP(u,o,t-1/3);return Math.round(f*255)<<24|Math.round(y*255)<<16|Math.round(T*255)<<8}function Bg(t){const e=parseInt(t,10);return e<0?0:e>255?255:e}function XU(t){return(parseFloat(t)%360+360)%360/360}function KU(t){const e=parseFloat(t);return e<0?0:e>1?255:Math.round(e*255)}function jw(t){const e=parseFloat(t);return e<0?0:e>100?1:e/100}function YU(t){let e=lpe(t);if(e===null)return t;e=e||0;const r=(e&4278190080)>>>24,o=(e&16711680)>>>16,u=(e&65280)>>>8,f=(e&255)/255;return`rgba(${r}, ${o}, ${u}, ${f})`}var Sx=(t,e,r)=>{if(mn.fun(t))return t;if(mn.arr(t))return Sx({range:t,output:e,extrapolate:r});if(mn.str(t.output[0]))return MO(t);const o=t,u=o.output,f=o.range||[0,1],y=o.extrapolateLeft||o.extrapolate||"extend",T=o.extrapolateRight||o.extrapolate||"extend",a=o.easing||(A=>A);return A=>{const D=upe(A,f);return cpe(A,f[D],f[D+1],u[D],u[D+1],a,y,T,o.map)}};function cpe(t,e,r,o,u,f,y,T,a){let A=a?a(t):t;if(A<e){if(y==="identity")return A;y==="clamp"&&(A=e)}if(A>r){if(T==="identity")return A;T==="clamp"&&(A=r)}return o===u?o:e===r?t<=e?o:u:(e===-1/0?A=-A:r===1/0?A=A-e:A=(A-e)/(r-e),A=f(A),o===-1/0?A=-A:u===1/0?A=A+o:A=A*(u-o)+o,A)}function upe(t,e){for(var r=1;r<e.length-1&&!(e[r]>=t);++r);return r-1}var hpe=(t,e="end")=>r=>{r=e==="end"?Math.min(r,.999):Math.max(r,.001);const o=r*t,u=e==="end"?Math.floor(o):Math.ceil(o);return Qfe(0,1,u/t)},LE=1.70158,$w=LE*1.525,QU=LE+1,JU=2*Math.PI/3,e6=2*Math.PI/4.5,Gw=t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,dpe={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>1-(1-t)*(1-t),easeInOutQuad:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeInCubic:t=>t*t*t,easeOutCubic:t=>1-Math.pow(1-t,3),easeInOutCubic:t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1-Math.pow(1-t,4),easeInOutQuart:t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1-Math.pow(1-t,5),easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInExpo:t=>t===0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t===1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,easeInCirc:t=>1-Math.sqrt(1-Math.pow(t,2)),easeOutCirc:t=>Math.sqrt(1-Math.pow(t-1,2)),easeInOutCirc:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,easeInBack:t=>QU*t*t*t-LE*t*t,easeOutBack:t=>1+QU*Math.pow(t-1,3)+LE*Math.pow(t-1,2),easeInOutBack:t=>t<.5?Math.pow(2*t,2)*(($w+1)*2*t-$w)/2:(Math.pow(2*t-2,2)*(($w+1)*(t*2-2)+$w)+2)/2,easeInElastic:t=>t===0?0:t===1?1:-Math.pow(2,10*t-10)*Math.sin((t*10-10.75)*JU),easeOutElastic:t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t*10-.75)*JU)+1,easeInOutElastic:t=>t===0?0:t===1?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*e6))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*e6)/2+1,easeInBounce:t=>1-Gw(1-t),easeOutBounce:Gw,easeInOutBounce:t=>t<.5?(1-Gw(1-2*t))/2:(1+Gw(2*t-1))/2,steps:hpe},Ix=Symbol.for("FluidValue.get"),W_=Symbol.for("FluidValue.observers"),kl=t=>!!(t&&t[Ix]),Ca=t=>t&&t[Ix]?t[Ix]():t,t6=t=>t[W_]||null;function fpe(t,e){t.eventObserved?t.eventObserved(e):t(e)}function Ax(t,e){const r=t[W_];r&&r.forEach(o=>{fpe(o,e)})}var JG=class{constructor(t){if(!t&&!(t=this.get))throw Error("Unknown getter");ppe(this,t)}},ppe=(t,e)=>eq(t,Ix,e);function dy(t,e){if(t[Ix]){let r=t[W_];r||eq(t,W_,r=new Set),r.has(e)||(r.add(e),t.observerAdded&&t.observerAdded(r.size,e))}return e}function Cx(t,e){const r=t[W_];if(r&&r.has(e)){const o=r.size-1;o?r.delete(e):t[W_]=null,t.observerRemoved&&t.observerRemoved(o,e)}}var eq=(t,e,r)=>Object.defineProperty(t,e,{value:r,writable:!0,configurable:!0}),bT=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,mpe=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,n6=new RegExp(`(${bT.source})(%|[a-z]+)`,"i"),gpe=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,wI=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,tq=t=>{const[e,r]=_pe(t);if(!e||RO())return t;const o=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(o)return o.trim();if(r&&r.startsWith("--")){const u=window.getComputedStyle(document.documentElement).getPropertyValue(r);return u||t}else{if(r&&wI.test(r))return tq(r);if(r)return r}return t},_pe=t=>{const e=wI.exec(t);if(!e)return[,];const[,r,o]=e;return[r,o]},JP,ype=(t,e,r,o,u)=>`rgba(${Math.round(e)}, ${Math.round(r)}, ${Math.round(o)}, ${u})`,nq=t=>{JP||(JP=df?new RegExp(`(${Object.keys(df).join("|")})(?!\\w)`,"g"):/^\b$/);const e=t.output.map(f=>Ca(f).replace(wI,tq).replace(mpe,YU).replace(JP,YU)),r=e.map(f=>f.match(bT).map(Number)),u=r[0].map((f,y)=>r.map(T=>{if(!(y in T))throw Error('The arity of each "output" value must be equal');return T[y]})).map(f=>Sx({...t,output:f}));return f=>{var a;const y=!n6.test(e[0])&&((a=e.find(A=>n6.test(A)))==null?void 0:a.replace(bT,""));let T=0;return e[0].replace(bT,()=>`${u[T++](f)}${y||""}`).replace(gpe,ype)}},DO="react-spring: ",rq=t=>{const e=t;let r=!1;if(typeof e!="function")throw new TypeError(`${DO}once requires a function parameter`);return(...o)=>{r||(e(...o),r=!0)}},vpe=rq(console.warn);function xpe(){vpe(`${DO}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var bpe=rq(console.warn);function wpe(){bpe(`${DO}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function TI(t){return mn.str(t)&&(t[0]=="#"||/\d/.test(t)||!RO()&&wI.test(t)||t in(df||{}))}var OO=RO()?ue.useEffect:ue.useLayoutEffect,Tpe=()=>{const t=ue.useRef(!1);return OO(()=>(t.current=!0,()=>{t.current=!1}),[]),t};function iq(){const t=ue.useState()[1],e=Tpe();return()=>{e.current&&t(Math.random())}}function Epe(t,e){const[r]=ue.useState(()=>({inputs:e,result:t()})),o=ue.useRef(),u=o.current;let f=u;return f?e&&f.inputs&&Spe(e,f.inputs)||(f={inputs:e,result:t()}):f=r,ue.useEffect(()=>{o.current=f,u==r&&(r.inputs=r.result=void 0)},[f]),f.result}function Spe(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}var sq=t=>ue.useEffect(t,Ipe),Ipe=[];function r6(t){const e=ue.useRef();return ue.useEffect(()=>{e.current=t}),e.current}var Px=Symbol.for("Animated:node"),Ape=t=>!!t&&t[Px]===t,lu=t=>t&&t[Px],LO=(t,e)=>Zfe(t,Px,e),EI=t=>t&&t[Px]&&t[Px].getPayload(),oq=class{constructor(){LO(this,this)}getPayload(){return this.payload||[]}},h1=class extends oq{constructor(t){super(),this._value=t,this.done=!0,this.durationProgress=0,mn.num(this._value)&&(this.lastPosition=this._value)}static create(t){return new h1(t)}getPayload(){return[this]}getValue(){return this._value}setValue(t,e){return mn.num(t)&&(this.lastPosition=t,e&&(t=Math.round(t/e)*e,this.done&&(this.lastPosition=t))),this._value===t?!1:(this._value=t,!0)}reset(){const{done:t}=this;this.done=!1,mn.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,t&&(this.lastVelocity=null),this.v0=null)}},Rx=class extends h1{constructor(t){super(0),this._string=null,this._toString=Sx({output:[t,t]})}static create(t){return new Rx(t)}getValue(){const t=this._string;return t??(this._string=this._toString(this._value))}setValue(t){if(mn.str(t)){if(t==this._string)return!1;this._string=t,this._value=1}else if(super.setValue(t))this._string=null;else return!1;return!0}reset(t){t&&(this._toString=Sx({output:[this.getValue(),t]})),this._value=0,super.reset()}},zE={dependencies:null},SI=class extends oq{constructor(t){super(),this.source=t,this.setValue(t)}getValue(t){const e={};return Au(this.source,(r,o)=>{Ape(r)?e[o]=r.getValue(t):kl(r)?e[o]=Ca(r):t||(e[o]=r)}),e}setValue(t){this.source=t,this.payload=this._makePayload(t)}reset(){this.payload&&Yr(this.payload,t=>t.reset())}_makePayload(t){if(t){const e=new Set;return Au(t,this._addToPayload,e),Array.from(e)}}_addToPayload(t){zE.dependencies&&kl(t)&&zE.dependencies.add(t);const e=EI(t);e&&Yr(e,r=>this.add(r))}},aq=class extends SI{constructor(t){super(t)}static create(t){return new aq(t)}getValue(){return this.source.map(t=>t.getValue())}setValue(t){const e=this.getPayload();return t.length==e.length?e.map((r,o)=>r.setValue(t[o])).some(Boolean):(super.setValue(t.map(Cpe)),!0)}};function Cpe(t){return(TI(t)?Rx:h1).create(t)}function ik(t){const e=lu(t);return e?e.constructor:mn.arr(t)?aq:TI(t)?Rx:h1}var i6=(t,e)=>{const r=!mn.fun(t)||t.prototype&&t.prototype.isReactComponent;return ue.forwardRef((o,u)=>{const f=ue.useRef(null),y=r&&ue.useCallback(Q=>{f.current=Mpe(u,Q)},[u]),[T,a]=Rpe(o,e),A=iq(),D=()=>{const Q=f.current;if(r&&!Q)return;(Q?e.applyAnimatedValues(Q,T.getValue(!0)):!1)===!1&&A()},O=new Ppe(D,a),B=ue.useRef();OO(()=>(B.current=O,Yr(a,Q=>dy(Q,O)),()=>{B.current&&(Yr(B.current.deps,Q=>Cx(Q,B.current)),kr.cancel(B.current.update))})),ue.useEffect(D,[]),sq(()=>()=>{const Q=B.current;Yr(Q.deps,re=>Cx(re,Q))});const H=e.getComponentProps(T.getValue());return ue.createElement(t,{...H,ref:y})})},Ppe=class{constructor(t,e){this.update=t,this.deps=e}eventObserved(t){t.type=="change"&&kr.write(this.update)}};function Rpe(t,e){const r=new Set;return zE.dependencies=r,t.style&&(t={...t,style:e.createAnimatedStyle(t.style)}),t=new SI(t),zE.dependencies=null,[t,r]}function Mpe(t,e){return t&&(mn.fun(t)?t(e):t.current=e),e}var s6=Symbol.for("AnimatedComponent"),kpe=(t,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:r=u=>new SI(u),getComponentProps:o=u=>u}={})=>{const u={applyAnimatedValues:e,createAnimatedStyle:r,getComponentProps:o},f=y=>{const T=o6(y)||"Anonymous";return mn.str(y)?y=f[y]||(f[y]=i6(y,u)):y=y[s6]||(y[s6]=i6(y,u)),y.displayName=`Animated(${T})`,y};return Au(t,(y,T)=>{mn.arr(t)&&(T=o6(y)),f[T]=f(y)}),{animated:f}},o6=t=>mn.str(t)?t:t&&mn.str(t.displayName)?t.displayName:mn.fun(t)&&t.name||null;function kp(t,...e){return mn.fun(t)?t(...e):t}var Gv=(t,e)=>t===!0||!!(e&&t&&(mn.fun(t)?t(e):rl(t).includes(e))),lq=(t,e)=>mn.obj(t)?e&&t[e]:t,cq=(t,e)=>t.default===!0?t[e]:t.default?t.default[e]:void 0,Dpe=t=>t,zO=(t,e=Dpe)=>{let r=Ope;t.default&&t.default!==!0&&(t=t.default,r=Object.keys(t));const o={};for(const u of r){const f=e(t[u],u);mn.und(f)||(o[u]=f)}return o},Ope=["config","onProps","onStart","onChange","onPause","onResume","onRest"],Lpe={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function zpe(t){const e={};let r=0;if(Au(t,(o,u)=>{Lpe[u]||(e[u]=o,r++)}),r)return e}function uq(t){const e=zpe(t);if(e){const r={to:e};return Au(t,(o,u)=>u in e||(r[u]=o)),r}return{...t}}function Mx(t){return t=Ca(t),mn.arr(t)?t.map(Mx):TI(t)?Pc.createStringInterpolator({range:[0,1],output:[t,t]})(1):t}function Npe(t){for(const e in t)return!0;return!1}function sk(t){return mn.fun(t)||mn.arr(t)&&mn.obj(t[0])}function Fpe(t,e){var r;(r=t.ref)==null||r.delete(t),e==null||e.delete(t)}function Bpe(t,e){var r;e&&t.ref!==e&&((r=t.ref)==null||r.delete(t),e.add(t),t.ref=e)}var Upe={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}},ok={...Upe.default,mass:1,damping:1,easing:dpe.linear,clamp:!1},Vpe=class{constructor(){this.velocity=0,Object.assign(this,ok)}};function jpe(t,e,r){r&&(r={...r},a6(r,e),e={...r,...e}),a6(t,e),Object.assign(t,e);for(const y in ok)t[y]==null&&(t[y]=ok[y]);let{frequency:o,damping:u}=t;const{mass:f}=t;return mn.und(o)||(o<.01&&(o=.01),u<0&&(u=0),t.tension=Math.pow(2*Math.PI/o,2)*f,t.friction=4*Math.PI*u*f/o),t}function a6(t,e){if(!mn.und(e.decay))t.duration=void 0;else{const r=!mn.und(e.tension)||!mn.und(e.friction);(r||!mn.und(e.frequency)||!mn.und(e.damping)||!mn.und(e.mass))&&(t.duration=void 0,t.decay=void 0),r&&(t.frequency=void 0)}}var l6=[],$pe=class{constructor(){this.changed=!1,this.values=l6,this.toValues=null,this.fromValues=l6,this.config=new Vpe,this.immediate=!1}};function hq(t,{key:e,props:r,defaultProps:o,state:u,actions:f}){return new Promise((y,T)=>{let a,A,D=Gv(r.cancel??(o==null?void 0:o.cancel),e);if(D)H();else{mn.und(r.pause)||(u.paused=Gv(r.pause,e));let Q=o==null?void 0:o.pause;Q!==!0&&(Q=u.paused||Gv(Q,e)),a=kp(r.delay||0,e),Q?(u.resumeQueue.add(B),f.pause()):(f.resume(),B())}function O(){u.resumeQueue.add(B),u.timeouts.delete(A),A.cancel(),a=A.time-kr.now()}function B(){a>0&&!Pc.skipAnimation?(u.delayed=!0,A=kr.setTimeout(H,a),u.pauseQueue.add(O),u.timeouts.add(A)):H()}function H(){u.delayed&&(u.delayed=!1),u.pauseQueue.delete(O),u.timeouts.delete(A),t<=(u.cancelId||0)&&(D=!0);try{f.start({...r,callId:t,cancel:D},y)}catch(Q){T(Q)}}})}var NO=(t,e)=>e.length==1?e[0]:e.some(r=>r.cancelled)?E_(t.get()):e.every(r=>r.noop)?dq(t.get()):wc(t.get(),e.every(r=>r.finished)),dq=t=>({value:t,noop:!0,finished:!0,cancelled:!1}),wc=(t,e,r=!1)=>({value:t,finished:e,cancelled:r}),E_=t=>({value:t,cancelled:!0,finished:!1});function fq(t,e,r,o){const{callId:u,parentId:f,onRest:y}=e,{asyncTo:T,promise:a}=r;return!f&&t===T&&!e.reset?a:r.promise=(async()=>{r.asyncId=u,r.asyncTo=t;const A=zO(e,(se,G)=>G==="onRest"?void 0:se);let D,O;const B=new Promise((se,G)=>(D=se,O=G)),H=se=>{const G=u<=(r.cancelId||0)&&E_(o)||u!==r.asyncId&&wc(o,!1);if(G)throw se.result=G,O(se),se},Q=(se,G)=>{const Y=new c6,Z=new u6;return(async()=>{if(Pc.skipAnimation)throw kx(r),Z.result=wc(o,!1),O(Z),Z;H(Y);const fe=mn.obj(se)?{...se}:{...G,to:se};fe.parentId=u,Au(A,(Pe,ce)=>{mn.und(fe[ce])&&(fe[ce]=Pe)});const Te=await o.start(fe);return H(Y),r.paused&&await new Promise(Pe=>{r.resumeQueue.add(Pe)}),Te})()};let re;if(Pc.skipAnimation)return kx(r),wc(o,!1);try{let se;mn.arr(t)?se=(async G=>{for(const Y of G)await Q(Y)})(t):se=Promise.resolve(t(Q,o.stop.bind(o))),await Promise.all([se.then(D),B]),re=wc(o.get(),!0,!1)}catch(se){if(se instanceof c6)re=se.result;else if(se instanceof u6)re=se.result;else throw se}finally{u==r.asyncId&&(r.asyncId=f,r.asyncTo=f?T:void 0,r.promise=f?a:void 0)}return mn.fun(y)&&kr.batchedUpdates(()=>{y(re,o,o.item)}),re})()}function kx(t,e){jv(t.timeouts,r=>r.cancel()),t.pauseQueue.clear(),t.resumeQueue.clear(),t.asyncId=t.asyncTo=t.promise=void 0,e&&(t.cancelId=e)}var c6=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},u6=class extends Error{constructor(){super("SkipAnimationSignal")}},ak=t=>t instanceof FO,Gpe=1,FO=class extends JG{constructor(){super(...arguments),this.id=Gpe++,this._priority=0}get priority(){return this._priority}set priority(t){this._priority!=t&&(this._priority=t,this._onPriorityChange(t))}get(){const t=lu(this);return t&&t.getValue()}to(...t){return Pc.to(this,t)}interpolate(...t){return xpe(),Pc.to(this,t)}toJSON(){return this.get()}observerAdded(t){t==1&&this._attach()}observerRemoved(t){t==0&&this._detach()}_attach(){}_detach(){}_onChange(t,e=!1){Ax(this,{type:"change",parent:this,value:t,idle:e})}_onPriorityChange(t){this.idle||xI.sort(this),Ax(this,{type:"priority",parent:this,priority:t})}},cm=Symbol.for("SpringPhase"),pq=1,lk=2,ck=4,eR=t=>(t[cm]&pq)>0,Od=t=>(t[cm]&lk)>0,ev=t=>(t[cm]&ck)>0,h6=(t,e)=>e?t[cm]|=lk|pq:t[cm]&=~lk,d6=(t,e)=>e?t[cm]|=ck:t[cm]&=~ck,qpe=class extends FO{constructor(t,e){if(super(),this.animation=new $pe,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!mn.und(t)||!mn.und(e)){const r=mn.obj(t)?{...t}:{...e,from:t};mn.und(r.default)&&(r.default=!0),this.start(r)}}get idle(){return!(Od(this)||this._state.asyncTo)||ev(this)}get goal(){return Ca(this.animation.to)}get velocity(){const t=lu(this);return t instanceof h1?t.lastVelocity||0:t.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return eR(this)}get isAnimating(){return Od(this)}get isPaused(){return ev(this)}get isDelayed(){return this._state.delayed}advance(t){let e=!0,r=!1;const o=this.animation;let{toValues:u}=o;const{config:f}=o,y=EI(o.to);!y&&kl(o.to)&&(u=rl(Ca(o.to))),o.values.forEach((A,D)=>{if(A.done)return;const O=A.constructor==Rx?1:y?y[D].lastPosition:u[D];let B=o.immediate,H=O;if(!B){if(H=A.lastPosition,f.tension<=0){A.done=!0;return}let Q=A.elapsedTime+=t;const re=o.fromValues[D],se=A.v0!=null?A.v0:A.v0=mn.arr(f.velocity)?f.velocity[D]:f.velocity;let G;const Y=f.precision||(re==O?.005:Math.min(1,Math.abs(O-re)*.001));if(mn.und(f.duration))if(f.decay){const Z=f.decay===!0?.998:f.decay,fe=Math.exp(-(1-Z)*Q);H=re+se/(1-Z)*(1-fe),B=Math.abs(A.lastPosition-H)<=Y,G=se*fe}else{G=A.lastVelocity==null?se:A.lastVelocity;const Z=f.restVelocity||Y/10,fe=f.clamp?0:f.bounce,Te=!mn.und(fe),Pe=re==O?A.v0>0:re<O;let ce,he=!1;const W=1,ge=Math.ceil(t/W);for(let _e=0;_e<ge&&(ce=Math.abs(G)>Z,!(!ce&&(B=Math.abs(O-H)<=Y,B)));++_e){Te&&(he=H==O||H>O==Pe,he&&(G=-G*fe,H=O));const Ee=-f.tension*1e-6*(H-O),we=-f.friction*.001*G,xt=(Ee+we)/f.mass;G=G+xt*W,H=H+G*W}}else{let Z=1;f.duration>0&&(this._memoizedDuration!==f.duration&&(this._memoizedDuration=f.duration,A.durationProgress>0&&(A.elapsedTime=f.duration*A.durationProgress,Q=A.elapsedTime+=t)),Z=(f.progress||0)+Q/this._memoizedDuration,Z=Z>1?1:Z<0?0:Z,A.durationProgress=Z),H=re+f.easing(Z)*(O-re),G=(H-A.lastPosition)/t,B=Z==1}A.lastVelocity=G,Number.isNaN(H)&&(console.warn("Got NaN while animating:",this),B=!0)}y&&!y[D].done&&(B=!1),B?A.done=!0:e=!1,A.setValue(H,f.round)&&(r=!0)});const T=lu(this),a=T.getValue();if(e){const A=Ca(o.to);(a!==A||r)&&!f.decay?(T.setValue(A),this._onChange(A)):r&&f.decay&&this._onChange(a),this._stop()}else r&&this._onChange(a)}set(t){return kr.batchedUpdates(()=>{this._stop(),this._focus(t),this._set(t)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(Od(this)){const{to:t,config:e}=this.animation;kr.batchedUpdates(()=>{this._onStart(),e.decay||this._set(t,!1),this._stop()})}return this}update(t){return(this.queue||(this.queue=[])).push(t),this}start(t,e){let r;return mn.und(t)?(r=this.queue||[],this.queue=[]):r=[mn.obj(t)?t:{...e,to:t}],Promise.all(r.map(o=>this._update(o))).then(o=>NO(this,o))}stop(t){const{to:e}=this.animation;return this._focus(this.get()),kx(this._state,t&&this._lastCallId),kr.batchedUpdates(()=>this._stop(e,t)),this}reset(){this._update({reset:!0})}eventObserved(t){t.type=="change"?this._start():t.type=="priority"&&(this.priority=t.priority+1)}_prepareNode(t){const e=this.key||"";let{to:r,from:o}=t;r=mn.obj(r)?r[e]:r,(r==null||sk(r))&&(r=void 0),o=mn.obj(o)?o[e]:o,o==null&&(o=void 0);const u={to:r,from:o};return eR(this)||(t.reverse&&([r,o]=[o,r]),o=Ca(o),mn.und(o)?lu(this)||this._set(r):this._set(o)),u}_update({...t},e){const{key:r,defaultProps:o}=this;t.default&&Object.assign(o,zO(t,(y,T)=>/^on/.test(T)?lq(y,r):y)),p6(this,t,"onProps"),nv(this,"onProps",t,this);const u=this._prepareNode(t);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const f=this._state;return hq(++this._lastCallId,{key:r,props:t,defaultProps:o,state:f,actions:{pause:()=>{ev(this)||(d6(this,!0),_v(f.pauseQueue),nv(this,"onPause",wc(this,tv(this,this.animation.to)),this))},resume:()=>{ev(this)&&(d6(this,!1),Od(this)&&this._resume(),_v(f.resumeQueue),nv(this,"onResume",wc(this,tv(this,this.animation.to)),this))},start:this._merge.bind(this,u)}}).then(y=>{if(t.loop&&y.finished&&!(e&&y.noop)){const T=mq(t);if(T)return this._update(T,!0)}return y})}_merge(t,e,r){if(e.cancel)return this.stop(!0),r(E_(this));const o=!mn.und(t.to),u=!mn.und(t.from);if(o||u)if(e.callId>this._lastToId)this._lastToId=e.callId;else return r(E_(this));const{key:f,defaultProps:y,animation:T}=this,{to:a,from:A}=T;let{to:D=a,from:O=A}=t;u&&!o&&(!e.default||mn.und(D))&&(D=O),e.reverse&&([D,O]=[O,D]);const B=!hh(O,A);B&&(T.from=O),O=Ca(O);const H=!hh(D,a);H&&this._focus(D);const Q=sk(e.to),{config:re}=T,{decay:se,velocity:G}=re;(o||u)&&(re.velocity=0),e.config&&!Q&&jpe(re,kp(e.config,f),e.config!==y.config?kp(y.config,f):void 0);let Y=lu(this);if(!Y||mn.und(D))return r(wc(this,!0));const Z=mn.und(e.reset)?u&&!e.default:!mn.und(O)&&Gv(e.reset,f),fe=Z?O:this.get(),Te=Mx(D),Pe=mn.num(Te)||mn.arr(Te)||TI(Te),ce=!Q&&(!Pe||Gv(y.immediate||e.immediate,f));if(H){const _e=ik(D);if(_e!==Y.constructor)if(ce)Y=this._set(Te);else throw Error(`Cannot animate between ${Y.constructor.name} and ${_e.name}, as the "to" prop suggests`)}const he=Y.constructor;let W=kl(D),ge=!1;if(!W){const _e=Z||!eR(this)&&B;(H||_e)&&(ge=hh(Mx(fe),Te),W=!ge),(!hh(T.immediate,ce)&&!ce||!hh(re.decay,se)||!hh(re.velocity,G))&&(W=!0)}if(ge&&Od(this)&&(T.changed&&!Z?W=!0:W||this._stop(a)),!Q&&((W||kl(a))&&(T.values=Y.getPayload(),T.toValues=kl(D)?null:he==Rx?[1]:rl(Te)),T.immediate!=ce&&(T.immediate=ce,!ce&&!Z&&this._set(a)),W)){const{onRest:_e}=T;Yr(Hpe,we=>p6(this,e,we));const Ee=wc(this,tv(this,a));_v(this._pendingCalls,Ee),this._pendingCalls.add(r),T.changed&&kr.batchedUpdates(()=>{var we;T.changed=!Z,_e==null||_e(Ee,this),Z?kp(y.onRest,Ee):(we=T.onStart)==null||we.call(T,Ee,this)})}Z&&this._set(fe),Q?r(fq(e.to,e,this._state,this)):W?this._start():Od(this)&&!H?this._pendingCalls.add(r):r(dq(fe))}_focus(t){const e=this.animation;t!==e.to&&(t6(this)&&this._detach(),e.to=t,t6(this)&&this._attach())}_attach(){let t=0;const{to:e}=this.animation;kl(e)&&(dy(e,this),ak(e)&&(t=e.priority+1)),this.priority=t}_detach(){const{to:t}=this.animation;kl(t)&&Cx(t,this)}_set(t,e=!0){const r=Ca(t);if(!mn.und(r)){const o=lu(this);if(!o||!hh(r,o.getValue())){const u=ik(r);!o||o.constructor!=u?LO(this,u.create(r)):o.setValue(r),o&&kr.batchedUpdates(()=>{this._onChange(r,e)})}}return lu(this)}_onStart(){const t=this.animation;t.changed||(t.changed=!0,nv(this,"onStart",wc(this,tv(this,t.to)),this))}_onChange(t,e){e||(this._onStart(),kp(this.animation.onChange,t,this)),kp(this.defaultProps.onChange,t,this),super._onChange(t,e)}_start(){const t=this.animation;lu(this).reset(Ca(t.to)),t.immediate||(t.fromValues=t.values.map(e=>e.lastPosition)),Od(this)||(h6(this,!0),ev(this)||this._resume())}_resume(){Pc.skipAnimation?this.finish():xI.start(this)}_stop(t,e){if(Od(this)){h6(this,!1);const r=this.animation;Yr(r.values,u=>{u.done=!0}),r.toValues&&(r.onChange=r.onPause=r.onResume=void 0),Ax(this,{type:"idle",parent:this});const o=e?E_(this.get()):wc(this.get(),tv(this,t??r.to));_v(this._pendingCalls,o),r.changed&&(r.changed=!1,nv(this,"onRest",o,this))}}};function tv(t,e){const r=Mx(e),o=Mx(t.get());return hh(o,r)}function mq(t,e=t.loop,r=t.to){const o=kp(e);if(o){const u=o!==!0&&uq(o),f=(u||t).reverse,y=!u||u.reset;return Dx({...t,loop:e,default:!1,pause:void 0,to:!f||sk(r)?r:void 0,from:y?t.from:void 0,reset:y,...u})}}function Dx(t){const{to:e,from:r}=t=uq(t),o=new Set;return mn.obj(e)&&f6(e,o),mn.obj(r)&&f6(r,o),t.keys=o.size?Array.from(o):null,t}function Wpe(t){const e=Dx(t);return mn.und(e.default)&&(e.default=zO(e)),e}function f6(t,e){Au(t,(r,o)=>r!=null&&e.add(o))}var Hpe=["onStart","onRest","onChange","onPause","onResume"];function p6(t,e,r){t.animation[r]=e[r]!==cq(e,r)?lq(e[r],t.key):void 0}function nv(t,e,...r){var o,u,f,y;(u=(o=t.animation)[e])==null||u.call(o,...r),(y=(f=t.defaultProps)[e])==null||y.call(f,...r)}var Zpe=["onStart","onChange","onRest"],Xpe=1,Kpe=class{constructor(e,r){this.id=Xpe++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),r&&(this._flush=r),e&&this.start({default:!0,...e})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each((r,o)=>e[o]=r.get()),e}set(e){for(const r in e){const o=e[r];mn.und(o)||this.springs[r].set(o)}}update(e){return e&&this.queue.push(Dx(e)),this}start(e){let{queue:r}=this;return e?r=rl(e).map(Dx):this.queue=[],this._flush?this._flush(this,r):(xq(this,r),uk(this,r))}stop(e,r){if(e!==!!e&&(r=e),r){const o=this.springs;Yr(rl(r),u=>o[u].stop(!!e))}else kx(this._state,this._lastAsyncId),this.each(o=>o.stop(!!e));return this}pause(e){if(mn.und(e))this.start({pause:!0});else{const r=this.springs;Yr(rl(e),o=>r[o].pause())}return this}resume(e){if(mn.und(e))this.start({pause:!1});else{const r=this.springs;Yr(rl(e),o=>r[o].resume())}return this}each(e){Au(this.springs,e)}_onFrame(){const{onStart:e,onChange:r,onRest:o}=this._events,u=this._active.size>0,f=this._changed.size>0;(u&&!this._started||f&&!this._started)&&(this._started=!0,jv(e,([a,A])=>{A.value=this.get(),a(A,this,this._item)}));const y=!u&&this._started,T=f||y&&o.size?this.get():null;f&&r.size&&jv(r,([a,A])=>{A.value=T,a(A,this,this._item)}),y&&(this._started=!1,jv(o,([a,A])=>{A.value=T,a(A,this,this._item)}))}eventObserved(e){if(e.type=="change")this._changed.add(e.parent),e.idle||this._active.add(e.parent);else if(e.type=="idle")this._active.delete(e.parent);else return;kr.onFrame(this._onFrame)}};function uk(t,e){return Promise.all(e.map(r=>gq(t,r))).then(r=>NO(t,r))}async function gq(t,e,r){const{keys:o,to:u,from:f,loop:y,onRest:T,onResolve:a}=e,A=mn.obj(e.default)&&e.default;y&&(e.loop=!1),u===!1&&(e.to=null),f===!1&&(e.from=null);const D=mn.arr(u)||mn.fun(u)?u:void 0;D?(e.to=void 0,e.onRest=void 0,A&&(A.onRest=void 0)):Yr(Zpe,re=>{const se=e[re];if(mn.fun(se)){const G=t._events[re];e[re]=({finished:Y,cancelled:Z})=>{const fe=G.get(se);fe?(Y||(fe.finished=!1),Z&&(fe.cancelled=!0)):G.set(se,{value:null,finished:Y||!1,cancelled:Z||!1})},A&&(A[re]=e[re])}});const O=t._state;e.pause===!O.paused?(O.paused=e.pause,_v(e.pause?O.pauseQueue:O.resumeQueue)):O.paused&&(e.pause=!0);const B=(o||Object.keys(t.springs)).map(re=>t.springs[re].start(e)),H=e.cancel===!0||cq(e,"cancel")===!0;(D||H&&O.asyncId)&&B.push(hq(++t._lastAsyncId,{props:e,state:O,actions:{pause:nk,resume:nk,start(re,se){H?(kx(O,t._lastAsyncId),se(E_(t))):(re.onRest=T,se(fq(D,re,O,t)))}}})),O.paused&&await new Promise(re=>{O.resumeQueue.add(re)});const Q=NO(t,await Promise.all(B));if(y&&Q.finished&&!(r&&Q.noop)){const re=mq(e,y,u);if(re)return xq(t,[re]),gq(t,re,!0)}return a&&kr.batchedUpdates(()=>a(Q,t,t.item)),Q}function m6(t,e){const r={...t.springs};return e&&Yr(rl(e),o=>{mn.und(o.keys)&&(o=Dx(o)),mn.obj(o.to)||(o={...o,to:void 0}),vq(r,o,u=>yq(u))}),_q(t,r),r}function _q(t,e){Au(e,(r,o)=>{t.springs[o]||(t.springs[o]=r,dy(r,t))})}function yq(t,e){const r=new qpe;return r.key=t,e&&dy(r,e),r}function vq(t,e,r){e.keys&&Yr(e.keys,o=>{(t[o]||(t[o]=r(o)))._prepareNode(e)})}function xq(t,e){Yr(e,r=>{vq(t.springs,r,o=>yq(o,t))})}var II=({children:t,...e})=>{const r=ue.useContext(NE),o=e.pause||!!r.pause,u=e.immediate||!!r.immediate;e=Epe(()=>({pause:o,immediate:u}),[o,u]);const{Provider:f}=NE;return ue.createElement(f,{value:e},t)},NE=Ype(II,{});II.Provider=NE.Provider;II.Consumer=NE.Consumer;function Ype(t,e){return Object.assign(t,ue.createContext(e)),t.Provider._context=t,t.Consumer._context=t,t}var Qpe=()=>{const t=[],e=function(o){wpe();const u=[];return Yr(t,(f,y)=>{if(mn.und(o))u.push(f.start());else{const T=r(o,f,y);T&&u.push(f.start(T))}}),u};e.current=t,e.add=function(o){t.includes(o)||t.push(o)},e.delete=function(o){const u=t.indexOf(o);~u&&t.splice(u,1)},e.pause=function(){return Yr(t,o=>o.pause(...arguments)),this},e.resume=function(){return Yr(t,o=>o.resume(...arguments)),this},e.set=function(o){Yr(t,(u,f)=>{const y=mn.fun(o)?o(f,u):o;y&&u.set(y)})},e.start=function(o){const u=[];return Yr(t,(f,y)=>{if(mn.und(o))u.push(f.start());else{const T=this._getProps(o,f,y);T&&u.push(f.start(T))}}),u},e.stop=function(){return Yr(t,o=>o.stop(...arguments)),this},e.update=function(o){return Yr(t,(u,f)=>u.update(this._getProps(o,u,f))),this};const r=function(o,u,f){return mn.fun(o)?o(f,u):o};return e._getProps=r,e};function Jpe(t,e,r){const o=mn.fun(e)&&e;o&&!r&&(r=[]);const u=ue.useMemo(()=>o||arguments.length==3?Qpe():void 0,[]),f=ue.useRef(0),y=iq(),T=ue.useMemo(()=>({ctrls:[],queue:[],flush(G,Y){const Z=m6(G,Y);return f.current>0&&!T.queue.length&&!Object.keys(Z).some(Te=>!G.springs[Te])?uk(G,Y):new Promise(Te=>{_q(G,Z),T.queue.push(()=>{Te(uk(G,Y))}),y()})}}),[]),a=ue.useRef([...T.ctrls]),A=[],D=r6(t)||0;ue.useMemo(()=>{Yr(a.current.slice(t,D),G=>{Fpe(G,u),G.stop(!0)}),a.current.length=t,O(D,t)},[t]),ue.useMemo(()=>{O(0,Math.min(D,t))},r);function O(G,Y){for(let Z=G;Z<Y;Z++){const fe=a.current[Z]||(a.current[Z]=new Kpe(null,T.flush)),Te=o?o(Z,fe):e[Z];Te&&(A[Z]=Wpe(Te))}}const B=a.current.map((G,Y)=>m6(G,A[Y])),H=ue.useContext(II),Q=r6(H),re=H!==Q&&Npe(H);OO(()=>{f.current++,T.ctrls=a.current;const{queue:G}=T;G.length&&(T.queue=[],Yr(G,Y=>Y())),Yr(a.current,(Y,Z)=>{u==null||u.add(Y),re&&Y.start({default:H});const fe=A[Z];fe&&(Bpe(Y,fe.ref),Y.ref?Y.queue.push(fe):Y.start(fe))})}),sq(()=>()=>{Yr(T.ctrls,G=>G.stop(!0))});const se=B.map(G=>({...G}));return u?[se,u]:se}function d1(t,e){const r=mn.fun(t),[[o],u]=Jpe(1,r?t:[t],r?[]:e);return r||arguments.length==2?[o,u]:o}var eme=class extends FO{constructor(t,e){super(),this.source=t,this.idle=!0,this._active=new Set,this.calc=Sx(...e);const r=this._get(),o=ik(r);LO(this,o.create(r))}advance(t){const e=this._get(),r=this.get();hh(e,r)||(lu(this).setValue(e),this._onChange(e,this.idle)),!this.idle&&g6(this._active)&&tR(this)}_get(){const t=mn.arr(this.source)?this.source.map(Ca):rl(Ca(this.source));return this.calc(...t)}_start(){this.idle&&!g6(this._active)&&(this.idle=!1,Yr(EI(this),t=>{t.done=!1}),Pc.skipAnimation?(kr.batchedUpdates(()=>this.advance()),tR(this)):xI.start(this))}_attach(){let t=1;Yr(rl(this.source),e=>{kl(e)&&dy(e,this),ak(e)&&(e.idle||this._active.add(e),t=Math.max(t,e.priority+1))}),this.priority=t,this._start()}_detach(){Yr(rl(this.source),t=>{kl(t)&&Cx(t,this)}),this._active.clear(),tR(this)}eventObserved(t){t.type=="change"?t.idle?this.advance():(this._active.add(t.parent),this._start()):t.type=="idle"?this._active.delete(t.parent):t.type=="priority"&&(this.priority=rl(this.source).reduce((e,r)=>Math.max(e,(ak(r)?r.priority:0)+1),0))}};function tme(t){return t.idle!==!1}function g6(t){return!t.size||Array.from(t).every(tme)}function tR(t){t.idle||(t.idle=!0,Yr(EI(t),e=>{e.done=!0}),Ax(t,{type:"idle",parent:t}))}Pc.assign({createStringInterpolator:nq,to:(t,e)=>new eme(t,e)});var bq=/^--/;function nme(t,e){return e==null||typeof e=="boolean"||e===""?"":typeof e=="number"&&e!==0&&!bq.test(t)&&!(qv.hasOwnProperty(t)&&qv[t])?e+"px":(""+e).trim()}var _6={};function rme(t,e){if(!t.nodeType||!t.setAttribute)return!1;const r=t.nodeName==="filter"||t.parentNode&&t.parentNode.nodeName==="filter",{style:o,children:u,scrollTop:f,scrollLeft:y,viewBox:T,...a}=e,A=Object.values(a),D=Object.keys(a).map(O=>r||t.hasAttribute(O)?O:_6[O]||(_6[O]=O.replace(/([A-Z])/g,B=>"-"+B.toLowerCase())));u!==void 0&&(t.textContent=u);for(const O in o)if(o.hasOwnProperty(O)){const B=nme(O,o[O]);bq.test(O)?t.style.setProperty(O,B):t.style[O]=B}D.forEach((O,B)=>{t.setAttribute(O,A[B])}),f!==void 0&&(t.scrollTop=f),y!==void 0&&(t.scrollLeft=y),T!==void 0&&t.setAttribute("viewBox",T)}var qv={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ime=(t,e)=>t+e.charAt(0).toUpperCase()+e.substring(1),sme=["Webkit","Ms","Moz","O"];qv=Object.keys(qv).reduce((t,e)=>(sme.forEach(r=>t[ime(r,e)]=t[e]),t),qv);var ome=/^(matrix|translate|scale|rotate|skew)/,ame=/^(translate)/,lme=/^(rotate|skew)/,nR=(t,e)=>mn.num(t)&&t!==0?t+e:t,wT=(t,e)=>mn.arr(t)?t.every(r=>wT(r,e)):mn.num(t)?t===e:parseFloat(t)===e,cme=class extends SI{constructor({x:t,y:e,z:r,...o}){const u=[],f=[];(t||e||r)&&(u.push([t||0,e||0,r||0]),f.push(y=>[`translate3d(${y.map(T=>nR(T,"px")).join(",")})`,wT(y,0)])),Au(o,(y,T)=>{if(T==="transform")u.push([y||""]),f.push(a=>[a,a===""]);else if(ome.test(T)){if(delete o[T],mn.und(y))return;const a=ame.test(T)?"px":lme.test(T)?"deg":"";u.push(rl(y)),f.push(T==="rotate3d"?([A,D,O,B])=>[`rotate3d(${A},${D},${O},${nR(B,a)})`,wT(B,0)]:A=>[`${T}(${A.map(D=>nR(D,a)).join(",")})`,wT(A,T.startsWith("scale")?1:0)])}}),u.length&&(o.transform=new ume(u,f)),super(o)}},ume=class extends JG{constructor(t,e){super(),this.inputs=t,this.transforms=e,this._value=null}get(){return this._value||(this._value=this._get())}_get(){let t="",e=!0;return Yr(this.inputs,(r,o)=>{const u=Ca(r[0]),[f,y]=this.transforms[o](mn.arr(u)?u:r.map(Ca));t+=" "+f,e=e&&y}),e?"none":t}observerAdded(t){t==1&&Yr(this.inputs,e=>Yr(e,r=>kl(r)&&dy(r,this)))}observerRemoved(t){t==0&&Yr(this.inputs,e=>Yr(e,r=>kl(r)&&Cx(r,this)))}eventObserved(t){t.type=="change"&&(this._value=null),Ax(this,t)}},hme=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"];Pc.assign({batchedUpdates:L3.unstable_batchedUpdates,createStringInterpolator:nq,colors:Jfe});var dme=kpe(hme,{applyAnimatedValues:rme,createAnimatedStyle:t=>new cme(t),getComponentProps:({scrollTop:t,scrollLeft:e,...r})=>r}),wq=dme.animated;function hk(t,e){return t.map(function(r,o){return r+e[o]})}function BO(t,e){return t.map(function(r,o){return r-e[o]})}function dk(t){return Math.hypot.apply(Math,t)}function fme(t,e,r){var o=dk(e),u=o===0?0:1/o,f=r===0?0:1/r,y=f*o,T=e.map(function(D){return f*D}),a=e.map(function(D){return u*D}),A=dk(t);return{velocities:T,velocity:y,distance:A,direction:a}}function fk(t){return Math.sign?Math.sign(t):+(t>0)-+(t<0)||+t}function pme(t,e,r){return Math.max(e,Math.min(t,r))}function mme(t,e){return Math.pow(t,e*5)}function y6(t,e,r){return e===0||Math.abs(e)===1/0?mme(t,r):t*e*r/(e+r*t)}function v6(t,e,r,o){return o===void 0&&(o=.15),o===0?pme(t,e,r):t<e?-y6(e-t,r-e,o)+e:t>r?+y6(t-r,r-e,o)+r:t}function gme(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _me(t,e,r){return e&&gme(t.prototype,e),t}function fa(){return fa=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},fa.apply(this,arguments)}function Tq(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function yme(t,e){if(t==null)return{};var r={},o=Object.keys(t),u,f;for(f=0;f<o.length;f++)u=o[f],!(e.indexOf(u)>=0)&&(r[u]=t[u]);return r}function lh(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function vme(t,e){if(t){if(typeof t=="string")return x6(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return x6(t,e)}}function x6(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,o=new Array(e);r<e;r++)o[r]=t[r];return o}function AI(t,e){var r;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(r=vme(t))||e){r&&(t=r);var o=0;return function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return r=t[Symbol.iterator](),r.next.bind(r)}function Eq(){}function Sq(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.length===0?Eq:e.length===1?e[0]:function(){for(var o,u=AI(e),f;!(f=u()).done;){var y=f.value;o=y.apply(this,arguments)||o}return o}}function qd(t,e){if(t===void 0){if(e===void 0)throw new Error("Must define fallback value if undefined is expected");t=e}return Array.isArray(t)?t:[t,t]}function b6(t){if(typeof t=="function"){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];return t.apply(void 0,r)}else return t}function UO(t,e){t===void 0&&(t={});for(var r={},o=0,u=Object.entries(e);o<u.length;o++){var f=u[o],y=f[0],T=f[1];switch(typeof T){case"function":r[y]=T.call(r,t[y],y,t);break;case"object":r[y]=UO(t[y],T);break;case"boolean":T&&(r[y]=t[y]);break}}return r}function xme(){try{return"constructor"in GestureEvent}catch{return!1}}function Iq(){return typeof window<"u"&&"ontouchstart"in window}function bme(){return typeof window<"u"&&"onpointerdown"in window}function Aq(t){return"pointerId"in t?null:t.type==="touchend"?t.changedTouches:t.targetTouches}function Cq(t){return Array.from(Aq(t)).map(function(e){return e.identifier})}function w6(t){var e="buttons"in t?t.buttons:0,r=t.shiftKey,o=t.altKey,u=t.metaKey,f=t.ctrlKey;return{buttons:e,shiftKey:r,altKey:o,metaKey:u,ctrlKey:f}}var wme=function(e){return e};function T6(t,e){e===void 0&&(e=wme);var r=Aq(t),o=r?r[0]:t,u=o.clientX,f=o.clientY;return e([u,f])}var Tme=180,Eme=.15,Sme=.5,Ime=50,Ame=250,Cme={threshold:function(e){return e===void 0&&(e=0),qd(e)},rubberband:function(e){switch(e===void 0&&(e=0),e){case!0:return qd(Eme);case!1:return qd(0);default:return qd(e)}},enabled:function(e){return e===void 0&&(e=!0),e},triggerAllEvents:function(e){return e===void 0&&(e=!1),e},initial:function(e){return e===void 0&&(e=0),typeof e=="function"?e:qd(e)},transform:!0},Pq=fa({},Cme,{axis:!0,lockDirection:function(e){return e===void 0&&(e=!1),e},bounds:function(e){if(e===void 0&&(e={}),typeof e=="function")return function(O){return Pq.bounds(e(O))};var r=e,o=r.left,u=o===void 0?-1/0:o,f=r.right,y=f===void 0?1/0:f,T=r.top,a=T===void 0?-1/0:T,A=r.bottom,D=A===void 0?1/0:A;return[[u,y],[a,D]]}}),Pme=typeof window<"u"&&window.document&&window.document.createElement,Rme={enabled:function(e){return e===void 0&&(e=!0),e},domTarget:!0,window:function(t){function e(r){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return t===void 0&&(t=Pme?window:void 0),t}),eventOptions:function(e){var r=e===void 0?{}:e,o=r.passive,u=o===void 0?!0:o,f=r.capture,y=f===void 0?!1:f;return{passive:u,capture:y}},transform:!0},Mme=fa({},Pq,{useTouch:function(e){e===void 0&&(e=!1);var r=Iq(),o=bme();return!!(e&&r||r&&!o)},experimental_preventWindowScrollY:function(e){return e===void 0&&(e=!1),e},threshold:function(e,r,o){var u=o.filterTaps,f=u===void 0?!1:u,y=o.lockDirection,T=y===void 0?!1:y,a=o.axis,A=a===void 0?void 0:a,D=qd(e,f?3:T||A?1:0);return this.filterTaps=f,D},swipeVelocity:function(e){return e===void 0&&(e=Sme),qd(e)},swipeDistance:function(e){return e===void 0&&(e=Ime),qd(e)},swipeDuration:function(e){return e===void 0&&(e=Ame),e},delay:function(e){switch(e===void 0&&(e=0),e){case!0:return Tme;case!1:return 0;default:return e}}});function kme(t){return t===void 0&&(t={}),UO(t,Rme)}function Dme(t){return t===void 0&&(t={}),UO(t,Mme)}function Ome(t){var e=t.domTarget,r=t.eventOptions,o=t.window,u=t.enabled,f=yme(t,["domTarget","eventOptions","window","enabled"]),y=kme({domTarget:e,eventOptions:r,window:o,enabled:u});return y.drag=Dme(f),y}function rv(t){return fa({_active:!1,_blocked:!1,_intentional:[!1,!1],_movement:[0,0],_initial:[0,0],_bounds:[[-1/0,1/0],[-1/0,1/0]],_threshold:[0,0],_lastEventType:void 0,_dragStarted:!1,_dragPreventScroll:!1,_dragIsTap:!0,_dragDelayed:!1,event:void 0,intentional:!1,values:[0,0],velocities:[0,0],delta:[0,0],movement:[0,0],offset:[0,0],lastOffset:[0,0],direction:[0,0],initial:[0,0],previous:[0,0],first:!1,last:!1,active:!1,timeStamp:0,startTime:0,elapsedTime:0,cancel:Eq,canceled:!1,memo:void 0,args:void 0},t)}function Rq(){var t={hovering:!1,scrolling:!1,wheeling:!1,dragging:!1,moving:!1,pinching:!1,touches:0,buttons:0,down:!1,shiftKey:!1,altKey:!1,metaKey:!1,ctrlKey:!1,locked:!1},e=rv({_pointerId:void 0,axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0,tap:!1,swipe:[0,0]}),r=rv({_pointerIds:[],da:[0,0],vdva:[0,0],origin:void 0,turns:0}),o=rv({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),u=rv({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),f=rv({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0});return{shared:t,drag:e,pinch:r,wheel:o,move:u,scroll:f}}var Mp=new Map,Lme=function(e){return e},zme=function(){function t(r,o){var u=this;o===void 0&&(o=[]),this.controller=r,this.args=o,this.debounced=!0,this.setTimeout=function(f,y){var T;y===void 0&&(y=140),clearTimeout(u.controller.timeouts[u.stateKey]);for(var a=arguments.length,A=new Array(a>2?a-2:0),D=2;D<a;D++)A[D-2]=arguments[D];u.controller.timeouts[u.stateKey]=(T=window).setTimeout.apply(T,[f,y].concat(A))},this.clearTimeout=function(){clearTimeout(u.controller.timeouts[u.stateKey])},this.fireGestureHandler=function(f){if(f===void 0&&(f=!1),u.state._blocked)return u.debounced||(u.state._active=!1,u.clean()),null;if(!f&&!u.state.intentional&&!u.config.triggerAllEvents)return null;if(u.state.intentional){var y=u.state.active,T=u.state._active;u.state.active=T,u.state.first=T&&!y,u.state.last=y&&!T,u.controller.state.shared[u.ingKey]=T}var a=u.controller.pointerIds.size||u.controller.touchIds.size,A=u.controller.state.shared.buttons>0||a>0,D=fa({},u.controller.state.shared,u.state,u.mapStateValues(u.state),{locked:!!document.pointerLockElement,touches:a,down:A}),O=u.handler(D);return u.state.memo=O!==void 0?O:u.state.memo,D},this.controller=r,this.args=o}var e=t.prototype;return e.updateSharedState=function(o){Object.assign(this.controller.state.shared,o)},e.updateGestureState=function(o){Object.assign(this.state,o)},e.checkIntentionality=function(o,u){return{_intentional:o,_blocked:!1}},e.getMovement=function(o){var u=this.config.rubberband,f=this.state,y=f._bounds,T=f._initial,a=f._active,A=f._intentional,D=f.lastOffset,O=f.movement,B=f._threshold,H=this.getInternalMovement(o,this.state),Q=A[0]===!1?E6(H[0],B[0]):A[0],re=A[1]===!1?E6(H[1],B[1]):A[1],se=this.checkIntentionality([Q,re],H);if(se._blocked)return fa({},se,{_movement:H,delta:[0,0]});var G=se._intentional,Y=H,Z=[G[0]!==!1?H[0]-G[0]:0,G[1]!==!1?H[1]-G[1]:0],fe=hk(Z,D),Te=a?u:[0,0];return Z=S6(y,hk(Z,T),Te),fa({},se,{intentional:G[0]!==!1||G[1]!==!1,_initial:T,_movement:Y,movement:Z,values:o,offset:S6(y,fe,Te),delta:BO(Z,O)})},e.clean=function(){this.clearTimeout()},_me(t,[{key:"config",get:function(){return this.controller.config[this.stateKey]}},{key:"enabled",get:function(){return this.controller.config.enabled&&this.config.enabled}},{key:"state",get:function(){return this.controller.state[this.stateKey]}},{key:"handler",get:function(){return this.controller.handlers[this.stateKey]}},{key:"transform",get:function(){return this.config.transform||this.controller.config.transform||Lme}}]),t}();function E6(t,e){return Math.abs(t)>=e?fk(t)*e:!1}function S6(t,e,r){var o=e[0],u=e[1],f=r[0],y=r[1],T=t[0],a=T[0],A=T[1],D=t[1],O=D[0],B=D[1];return[v6(o,a,A,f),v6(u,O,B,y)]}function rR(t,e,r){var o=t.state,u=e.timeStamp,f=e.type,y=o.values,T=r?0:u-o.startTime;return{_lastEventType:f,event:e,timeStamp:u,elapsedTime:T,previous:y}}function Nme(t,e,r,o){var u=t.state,f=t.config,y=t.stateKey,T=t.args,a=t.transform,A=u.offset,D=r.timeStamp,O=f.initial,B=f.bounds,H=f.threshold,Q=BO(a(H),a([0,0])).map(Math.abs),re=fa({},Rq()[y],{_active:!0,args:T,values:e,initial:e,_threshold:Q,offset:A,lastOffset:A,startTime:D});return fa({},re,{_initial:b6(O,re),_bounds:b6(B,re)})}var Fme=function(e){var r=this;this.classes=e,this.pointerIds=new Set,this.touchIds=new Set,this.supportsTouchEvents=Iq(),this.supportsGestureEvents=xme(),this.bind=function(){for(var o=arguments.length,u=new Array(o),f=0;f<o;f++)u[f]=arguments[f];for(var y={},T=AI(r.classes),a;!(a=T()).done;){var A=a.value;new A(r,u).addBindings(y)}var D=function(H){ou(y,H,function(Q){return r.nativeRefs[H](fa({},r.state.shared,{event:Q,args:u}))})};for(var O in r.nativeRefs)D(O);return r.config.domTarget?Gme(r,y):qme(r,y)},this.effect=function(){return r.config.domTarget&&r.bind(),r.clean},this.clean=function(){var o=kq(r.config),u=r.config.eventOptions;o&&f1(o,Mq(r.domListeners),u),Object.values(r.timeouts).forEach(clearTimeout),Vme(r)},this.classes=e,this.state=Rq(),this.timeouts={},this.domListeners=[],this.windowListeners={}};function Bme(t,e){"pointerId"in e?t.pointerIds.add(e.pointerId):t.touchIds=new Set(Cq(e))}function Ume(t,e){"pointerId"in e?t.pointerIds.delete(e.pointerId):Cq(e).forEach(function(r){return t.touchIds.delete(r)})}function Vme(t){var e=t.config,r=e.window,o=e.eventOptions,u=t.windowListeners;if(r){for(var f in u){var y=u[f];f1(r,y,o)}t.windowListeners={}}}function jme(t,e,r){var o=t.config,u=t.windowListeners;r===void 0&&(r=o.eventOptions),o.window&&(f1(o.window,u[e],r),delete u[e])}function $me(t,e,r,o){var u=t.config,f=t.windowListeners;r===void 0&&(r=[]),o===void 0&&(o=u.eventOptions),u.window&&(f1(u.window,f[e],o),Dq(u.window,f[e]=r,o))}function Gme(t,e){var r=t.config,o=t.domListeners,u=kq(r);if(!u)throw new Error("domTarget must be defined");var f=r.eventOptions;f1(u,Mq(o),f);for(var y=0,T=Object.entries(e);y<T.length;y++){var a=T[y],A=a[0],D=a[1],O=A.slice(2).toLowerCase();o.push([O,Sq.apply(void 0,D)])}Dq(u,o,f)}function qme(t,e){for(var r=t.config,o={},u=r.eventOptions.capture?"Capture":"",f=0,y=Object.entries(e);f<y.length;f++){var T=y[f],a=T[0],A=T[1],D=Array.isArray(A)?A:[A],O=a+u;o[O]=Sq.apply(void 0,D)}return o}function Mq(t){return t===void 0&&(t=[]),t.splice(0,t.length)}function kq(t){var e=t.domTarget;return e&&"current"in e?e.current:e}function ou(t,e,r){t[e]||(t[e]=[]),t[e].push(r)}function Dq(t,e,r){e===void 0&&(e=[]),r===void 0&&(r={});for(var o=AI(e),u;!(u=o()).done;){var f=u.value,y=f[0],T=f[1];t.addEventListener(y,T,r)}}function f1(t,e,r){e===void 0&&(e=[]),r===void 0&&(r={});for(var o=AI(e),u;!(u=o()).done;){var f=u.value,y=f[0],T=f[1];t.removeEventListener(y,T,r)}}function Wme(t,e,r){r===void 0&&(r={});var o=Zme(t),u=vi.useMemo(function(){return new Fme(o)},[]);return u.config=e,u.handlers=t,u.nativeRefs=r,vi.useEffect(u.effect,[]),u.config.domTarget?Hme:u.bind}function Hme(){}function Zme(t){var e=new Set;return t.drag&&e.add(Mp.get("drag")),t.wheel&&e.add(Mp.get("wheel")),t.scroll&&e.add(Mp.get("scroll")),t.move&&e.add(Mp.get("move")),t.pinch&&e.add(Mp.get("pinch")),t.hover&&e.add(Mp.get("hover")),e}var Xme=function(t){Tq(e,t);function e(){return t.apply(this,arguments)||this}var r=e.prototype;return r.getInternalMovement=function(u,f){return BO(u,f.initial)},r.checkIntentionality=function(u,f){if(u[0]===!1&&u[1]===!1)return{_intentional:u,axis:this.state.axis};var y=f.map(Math.abs),T=y[0],a=y[1],A=this.state.axis||(T>a?"x":T<a?"y":void 0);return!this.config.axis&&!this.config.lockDirection?{_intentional:u,_blocked:!1,axis:A}:A?this.config.axis&&A!==this.config.axis?{_intentional:u,_blocked:!0,axis:A}:(u[A==="x"?1:0]=!1,{_intentional:u,_blocked:!1,axis:A}):{_intentional:[!1,!1],_blocked:!1,axis:A}},r.getKinematics=function(u,f){var y=this.getMovement(u);if(!y._blocked){var T=f.timeStamp-this.state.timeStamp;Object.assign(y,fme(y.movement,y.delta,T))}return y},r.mapStateValues=function(u){return{xy:u.values,vxvy:u.velocities}},e}(zme),Kme=3;function I6(t){"persist"in t&&typeof t.persist=="function"&&t.persist()}var Yme=function(t){Tq(e,t);function e(){var o;return o=t.apply(this,arguments)||this,o.ingKey="dragging",o.stateKey="drag",o.setPointerCapture=function(u){if(!(o.config.useTouch||document.pointerLockElement)){var f=u.target,y=u.pointerId;f&&"setPointerCapture"in f&&f.setPointerCapture(y),o.updateGestureState({_dragTarget:f,_dragPointerId:y})}},o.releasePointerCapture=function(){if(!(o.config.useTouch||document.pointerLockElement)){var u=o.state,f=u._dragTarget,y=u._dragPointerId;if(y&&f&&"releasePointerCapture"in f&&(!("hasPointerCapture"in f)||f.hasPointerCapture(y)))try{f.releasePointerCapture(y)}catch{}}},o.preventScroll=function(u){o.state._dragPreventScroll&&u.cancelable&&u.preventDefault()},o.getEventId=function(u){return o.config.useTouch?u.changedTouches[0].identifier:u.pointerId},o.isValidEvent=function(u){return o.state._pointerId===o.getEventId(u)},o.shouldPreventWindowScrollY=o.config.experimental_preventWindowScrollY&&o.controller.supportsTouchEvents,o.setUpWindowScrollDetection=function(u){I6(u),$me(o.controller,o.stateKey,[["touchmove",o.preventScroll],["touchend",o.clean.bind(lh(o))],["touchcancel",o.clean.bind(lh(o))]],{passive:!1}),o.setTimeout(o.startDrag.bind(lh(o)),250,u)},o.setUpDelayedDragTrigger=function(u){o.state._dragDelayed=!0,I6(u),o.setTimeout(o.startDrag.bind(lh(o)),o.config.delay,u)},o.setStartState=function(u){var f=T6(u,o.transform);o.updateSharedState(w6(u)),o.updateGestureState(fa({},Nme(lh(o),f,u),rR(lh(o),u,!0),{_pointerId:o.getEventId(u)})),o.updateGestureState(o.getMovement(f))},o.onDragStart=function(u){Bme(o.controller,u),!(!o.enabled||o.state._active)&&(o.setStartState(u),o.setPointerCapture(u),o.shouldPreventWindowScrollY?o.setUpWindowScrollDetection(u):o.config.delay>0?o.setUpDelayedDragTrigger(u):o.startDrag(u,!0))},o.onDragChange=function(u){if(!(o.state.canceled||!o.state._active||!o.isValidEvent(u)||o.state._lastEventType===u.type&&u.timeStamp===o.state.timeStamp)){var f;if(document.pointerLockElement){var y=u.movementX,T=u.movementY;f=hk(o.transform([y,T]),o.state.values)}else f=T6(u,o.transform);var a=o.getKinematics(f,u);if(!o.state._dragStarted){if(o.state._dragDelayed){o.startDrag(u);return}if(o.shouldPreventWindowScrollY)if(!o.state._dragPreventScroll&&a.axis)if(a.axis==="x")o.startDrag(u);else{o.state._active=!1;return}else return;else return}var A=w6(u);o.updateSharedState(A);var D=rR(lh(o),u),O=dk(a._movement),B=o.state._dragIsTap;B&&O>=Kme&&(B=!1),o.updateGestureState(fa({},D,a,{_dragIsTap:B})),o.fireGestureHandler()}},o.onDragEnd=function(u){if(Ume(o.controller,u),!!o.isValidEvent(u)&&(o.clean(),!!o.state._active)){o.state._active=!1;var f=o.state._dragIsTap,y=o.state.velocities,T=y[0],a=y[1],A=o.state.movement,D=A[0],O=A[1],B=o.state._intentional,H=B[0],Q=B[1],re=o.config.swipeVelocity,se=re[0],G=re[1],Y=o.config.swipeDistance,Z=Y[0],fe=Y[1],Te=o.config.swipeDuration,Pe=fa({},rR(lh(o),u),o.getMovement(o.state.values)),ce=[0,0];Pe.elapsedTime<Te&&(H!==!1&&Math.abs(T)>se&&Math.abs(D)>Z&&(ce[0]=fk(T)),Q!==!1&&Math.abs(a)>G&&Math.abs(O)>fe&&(ce[1]=fk(a))),o.updateSharedState({buttons:0}),o.updateGestureState(fa({},Pe,{tap:f,swipe:ce})),o.fireGestureHandler(o.config.filterTaps&&f===!0)}},o.clean=function(){t.prototype.clean.call(lh(o)),o.state._dragStarted=!1,o.releasePointerCapture(),jme(o.controller,o.stateKey)},o.onCancel=function(){o.state.canceled||(o.updateGestureState({canceled:!0,_active:!1}),o.updateSharedState({buttons:0}),setTimeout(function(){return o.fireGestureHandler()},0))},o.onClick=function(u){o.state._dragIsTap||u.stopPropagation()},o}var r=e.prototype;return r.startDrag=function(u,f){f===void 0&&(f=!1),!(!this.state._active||this.state._dragStarted)&&(f||this.setStartState(u),this.updateGestureState({_dragStarted:!0,_dragPreventScroll:!0,cancel:this.onCancel}),this.clearTimeout(),this.fireGestureHandler())},r.addBindings=function(u){if(this.config.useTouch?(ou(u,"onTouchStart",this.onDragStart),ou(u,"onTouchMove",this.onDragChange),ou(u,"onTouchEnd",this.onDragEnd),ou(u,"onTouchCancel",this.onDragEnd)):(ou(u,"onPointerDown",this.onDragStart),ou(u,"onPointerMove",this.onDragChange),ou(u,"onPointerUp",this.onDragEnd),ou(u,"onPointerCancel",this.onDragEnd)),this.config.filterTaps){var f=this.controller.config.eventOptions.capture?"onClick":"onClickCapture";ou(u,f,this.onClick)}},e}(Xme);function Qme(t,e){var r,o=[],u,f=!1;function y(){for(var T=arguments.length,a=new Array(T),A=0;A<T;A++)a[A]=arguments[A];return f&&r===this&&e(a,o)||(u=t.apply(this,a),f=!0,r=this,o=a),u}return y}function TT(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var r,o,u;if(Array.isArray(t)){if(r=t.length,r!==e.length)return!1;for(o=r;o--!==0;)if(!TT(t[o],e[o]))return!1;return!0}var f;if(typeof Map=="function"&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(f=t.entries();!(o=f.next()).done;)if(!e.has(o.value[0]))return!1;for(f=t.entries();!(o=f.next()).done;)if(!TT(o.value[1],e.get(o.value[0])))return!1;return!0}if(typeof Set=="function"&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(f=t.entries();!(o=f.next()).done;)if(!e.has(o.value[0]))return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===e.toString();if(u=Object.keys(t),r=u.length,r!==Object.keys(e).length)return!1;for(o=r;o--!==0;)if(!Object.prototype.hasOwnProperty.call(e,u[o]))return!1;if(typeof Element<"u"&&t instanceof Element)return!1;for(o=r;o--!==0;)if(!(u[o]==="_owner"&&t.$$typeof)&&!TT(t[u[o]],e[u[o]]))return!1;return!0}return t!==t&&e!==e}function Jme(t,e){try{return TT(t,e)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}}function p1(t,e){e===void 0&&(e={}),Mp.set("drag",Yme);var r=ue.useRef();return r.current||(r.current=Qme(Ome,Jme)),Wme({drag:t},r.current(e))}const ege=ue.createContext(),VO=()=>ue.useContext(ege);var Oq={exports:{}};(function(t,e){var r={};(function(o,u){t.exports=u()})(PV,function(){var o,u,f;function y(a,A){if(!o)o=A;else if(!u)u=A;else{var D="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",O={};o(O),f=A(O),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(f.workerUrl=window.URL.createObjectURL(new Blob([D],{type:"text/javascript"})))}}y(["exports"],function(a){var A="3.6.0";let D;const O={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(D==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{D=r.API_URL_REGEX!=null?new RegExp(r.API_URL_REGEX):i}catch{D=i}}return D},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!O.API_URL)return null;try{const i=new URL(O.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function B(i){return O.API_URL_REGEX.test(i)}function H(i){return i.indexOf("mapbox:")===0}function Q(i){return O.API_CDN_URL_REGEX.test(i)}function re(i){return O.API_SPRITE_REGEX.test(i)}function se(i){return O.API_STYLE_REGEX.test(i)&&!re(i)}const G={create:"create",load:"load",fullLoad:"fullLoad"},Y={mark(i){performance.mark(i)},measure(i,n,s){performance.measure(i,n,s)}};function Z(i){const n=i.name.split("?")[0];return Q(n)&&n.includes("mapbox-gl.js")?"javascript":Q(n)&&n.includes("mapbox-gl.css")?"css":function(s){return O.API_FONTS_REGEX.test(s)}(n)?"fontRange":re(n)?"sprite":se(n)?"style":function(s){return O.API_TILEJSON_REGEX.test(s)}(n)?"tilejson":"other"}function fe(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Te={},Pe={};Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.setMatrixArrayType=function(i){Pe.ARRAY_TYPE=he=i},Pe.toRadian=function(i){return i*ge},Pe.equals=function(i,n){return Math.abs(i-n)<=ce*Math.max(1,Math.abs(i),Math.abs(n))},Pe.RANDOM=Pe.ARRAY_TYPE=Pe.EPSILON=void 0;var ce=1e-6;Pe.EPSILON=ce;var he=typeof Float32Array<"u"?Float32Array:Array;Pe.ARRAY_TYPE=he;var W=Math.random;Pe.RANDOM=W;var ge=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var i=0,n=arguments.length;n--;)i+=arguments[n]*arguments[n];return Math.sqrt(i)});var _e={};function Ee(i){return Ee=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ee(i)}Object.defineProperty(_e,"__esModule",{value:!0}),_e.create=function(){var i=new we.ARRAY_TYPE(4);return we.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},_e.clone=function(i){var n=new we.ARRAY_TYPE(4);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n},_e.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i},_e.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i},_e.fromValues=function(i,n,s,c){var h=new we.ARRAY_TYPE(4);return h[0]=i,h[1]=n,h[2]=s,h[3]=c,h},_e.set=function(i,n,s,c,h){return i[0]=n,i[1]=s,i[2]=c,i[3]=h,i},_e.transpose=function(i,n){if(i===n){var s=n[1];i[1]=n[2],i[2]=s}else i[0]=n[0],i[1]=n[2],i[2]=n[1],i[3]=n[3];return i},_e.invert=function(i,n){var s=n[0],c=n[1],h=n[2],p=n[3],m=s*p-h*c;return m?(i[0]=p*(m=1/m),i[1]=-c*m,i[2]=-h*m,i[3]=s*m,i):null},_e.adjoint=function(i,n){var s=n[0];return i[0]=n[3],i[1]=-n[1],i[2]=-n[2],i[3]=s,i},_e.determinant=function(i){return i[0]*i[3]-i[2]*i[1]},_e.multiply=Rt,_e.rotate=function(i,n,s){var c=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(s),b=Math.cos(s);return i[0]=c*b+p*v,i[1]=h*b+m*v,i[2]=c*-v+p*b,i[3]=h*-v+m*b,i},_e.scale=function(i,n,s){var c=n[1],h=n[2],p=n[3],m=s[0],v=s[1];return i[0]=n[0]*m,i[1]=c*m,i[2]=h*v,i[3]=p*v,i},_e.fromRotation=function(i,n){var s=Math.sin(n),c=Math.cos(n);return i[0]=c,i[1]=s,i[2]=-s,i[3]=c,i},_e.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=n[1],i},_e.str=function(i){return"mat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},_e.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},_e.LDU=function(i,n,s,c){return i[2]=c[2]/c[0],s[0]=c[0],s[1]=c[1],s[3]=c[3]-i[2]*s[1],[i,n,s]},_e.add=function(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i[2]=n[2]+s[2],i[3]=n[3]+s[3],i},_e.subtract=Bt,_e.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]},_e.equals=function(i,n){var s=i[0],c=i[1],h=i[2],p=i[3],m=n[0],v=n[1],b=n[2],E=n[3];return Math.abs(s-m)<=we.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(c-v)<=we.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(h-b)<=we.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))&&Math.abs(p-E)<=we.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))},_e.multiplyScalar=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3]*s,i},_e.multiplyScalarAndAdd=function(i,n,s,c){return i[0]=n[0]+s[0]*c,i[1]=n[1]+s[1]*c,i[2]=n[2]+s[2]*c,i[3]=n[3]+s[3]*c,i},_e.sub=_e.mul=void 0;var we=function(i,n){if(i&&i.__esModule)return i;if(i===null||Ee(i)!=="object"&&typeof i!="function")return{default:i};var s=xt(void 0);if(s&&s.has(i))return s.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,s&&s.set(i,c),c}(Pe);function xt(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(xt=function(c){return c?s:n})(i)}function Rt(i,n,s){var c=n[0],h=n[1],p=n[2],m=n[3],v=s[0],b=s[1],E=s[2],I=s[3];return i[0]=c*v+p*b,i[1]=h*v+m*b,i[2]=c*E+p*I,i[3]=h*E+m*I,i}function Bt(i,n,s){return i[0]=n[0]-s[0],i[1]=n[1]-s[1],i[2]=n[2]-s[2],i[3]=n[3]-s[3],i}_e.mul=Rt,_e.sub=Bt;var bt={};function at(i){return at=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},at(i)}Object.defineProperty(bt,"__esModule",{value:!0}),bt.create=function(){var i=new Ct.ARRAY_TYPE(6);return Ct.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[4]=0,i[5]=0),i[0]=1,i[3]=1,i},bt.clone=function(i){var n=new Ct.ARRAY_TYPE(6);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n},bt.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i},bt.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i},bt.fromValues=function(i,n,s,c,h,p){var m=new Ct.ARRAY_TYPE(6);return m[0]=i,m[1]=n,m[2]=s,m[3]=c,m[4]=h,m[5]=p,m},bt.set=function(i,n,s,c,h,p,m){return i[0]=n,i[1]=s,i[2]=c,i[3]=h,i[4]=p,i[5]=m,i},bt.invert=function(i,n){var s=n[0],c=n[1],h=n[2],p=n[3],m=n[4],v=n[5],b=s*p-c*h;return b?(i[0]=p*(b=1/b),i[1]=-c*b,i[2]=-h*b,i[3]=s*b,i[4]=(h*v-p*m)*b,i[5]=(c*m-s*v)*b,i):null},bt.determinant=function(i){return i[0]*i[3]-i[1]*i[2]},bt.multiply=rt,bt.rotate=function(i,n,s){var c=n[0],h=n[1],p=n[2],m=n[3],v=n[4],b=n[5],E=Math.sin(s),I=Math.cos(s);return i[0]=c*I+p*E,i[1]=h*I+m*E,i[2]=c*-E+p*I,i[3]=h*-E+m*I,i[4]=v,i[5]=b,i},bt.scale=function(i,n,s){var c=n[1],h=n[2],p=n[3],m=n[4],v=n[5],b=s[0],E=s[1];return i[0]=n[0]*b,i[1]=c*b,i[2]=h*E,i[3]=p*E,i[4]=m,i[5]=v,i},bt.translate=function(i,n,s){var c=n[0],h=n[1],p=n[2],m=n[3],v=n[4],b=n[5],E=s[0],I=s[1];return i[0]=c,i[1]=h,i[2]=p,i[3]=m,i[4]=c*E+p*I+v,i[5]=h*E+m*I+b,i},bt.fromRotation=function(i,n){var s=Math.sin(n),c=Math.cos(n);return i[0]=c,i[1]=s,i[2]=-s,i[3]=c,i[4]=0,i[5]=0,i},bt.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=n[1],i[4]=0,i[5]=0,i},bt.fromTranslation=function(i,n){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=n[0],i[5]=n[1],i},bt.str=function(i){return"mat2d("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+")"},bt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],1)},bt.add=function(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i[2]=n[2]+s[2],i[3]=n[3]+s[3],i[4]=n[4]+s[4],i[5]=n[5]+s[5],i},bt.subtract=wt,bt.multiplyScalar=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3]*s,i[4]=n[4]*s,i[5]=n[5]*s,i},bt.multiplyScalarAndAdd=function(i,n,s,c){return i[0]=n[0]+s[0]*c,i[1]=n[1]+s[1]*c,i[2]=n[2]+s[2]*c,i[3]=n[3]+s[3]*c,i[4]=n[4]+s[4]*c,i[5]=n[5]+s[5]*c,i},bt.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]},bt.equals=function(i,n){var s=i[0],c=i[1],h=i[2],p=i[3],m=i[4],v=i[5],b=n[0],E=n[1],I=n[2],P=n[3],M=n[4],z=n[5];return Math.abs(s-b)<=Ct.EPSILON*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(c-E)<=Ct.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(h-I)<=Ct.EPSILON*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(p-P)<=Ct.EPSILON*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(m-M)<=Ct.EPSILON*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(v-z)<=Ct.EPSILON*Math.max(1,Math.abs(v),Math.abs(z))},bt.sub=bt.mul=void 0;var Ct=function(i,n){if(i&&i.__esModule)return i;if(i===null||at(i)!=="object"&&typeof i!="function")return{default:i};var s=Zt(void 0);if(s&&s.has(i))return s.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,s&&s.set(i,c),c}(Pe);function Zt(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(Zt=function(c){return c?s:n})(i)}function rt(i,n,s){var c=n[0],h=n[1],p=n[2],m=n[3],v=n[4],b=n[5],E=s[0],I=s[1],P=s[2],M=s[3],z=s[4],F=s[5];return i[0]=c*E+p*I,i[1]=h*E+m*I,i[2]=c*P+p*M,i[3]=h*P+m*M,i[4]=c*z+p*F+v,i[5]=h*z+m*F+b,i}function wt(i,n,s){return i[0]=n[0]-s[0],i[1]=n[1]-s[1],i[2]=n[2]-s[2],i[3]=n[3]-s[3],i[4]=n[4]-s[4],i[5]=n[5]-s[5],i}bt.mul=rt,bt.sub=wt;var pt={};function jt(i){return jt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},jt(i)}Object.defineProperty(pt,"__esModule",{value:!0}),pt.create=function(){var i=new Mt.ARRAY_TYPE(9);return Mt.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i},pt.fromMat4=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[4],i[4]=n[5],i[5]=n[6],i[6]=n[8],i[7]=n[9],i[8]=n[10],i},pt.clone=function(i){var n=new Mt.ARRAY_TYPE(9);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n},pt.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i},pt.fromValues=function(i,n,s,c,h,p,m,v,b){var E=new Mt.ARRAY_TYPE(9);return E[0]=i,E[1]=n,E[2]=s,E[3]=c,E[4]=h,E[5]=p,E[6]=m,E[7]=v,E[8]=b,E},pt.set=function(i,n,s,c,h,p,m,v,b,E){return i[0]=n,i[1]=s,i[2]=c,i[3]=h,i[4]=p,i[5]=m,i[6]=v,i[7]=b,i[8]=E,i},pt.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},pt.transpose=function(i,n){if(i===n){var s=n[1],c=n[2],h=n[5];i[1]=n[3],i[2]=n[6],i[3]=s,i[5]=n[7],i[6]=c,i[7]=h}else i[0]=n[0],i[1]=n[3],i[2]=n[6],i[3]=n[1],i[4]=n[4],i[5]=n[7],i[6]=n[2],i[7]=n[5],i[8]=n[8];return i},pt.invert=function(i,n){var s=n[0],c=n[1],h=n[2],p=n[3],m=n[4],v=n[5],b=n[6],E=n[7],I=n[8],P=I*m-v*E,M=-I*p+v*b,z=E*p-m*b,F=s*P+c*M+h*z;return F?(i[0]=P*(F=1/F),i[1]=(-I*c+h*E)*F,i[2]=(v*c-h*m)*F,i[3]=M*F,i[4]=(I*s-h*b)*F,i[5]=(-v*s+h*p)*F,i[6]=z*F,i[7]=(-E*s+c*b)*F,i[8]=(m*s-c*p)*F,i):null},pt.adjoint=function(i,n){var s=n[0],c=n[1],h=n[2],p=n[3],m=n[4],v=n[5],b=n[6],E=n[7],I=n[8];return i[0]=m*I-v*E,i[1]=h*E-c*I,i[2]=c*v-h*m,i[3]=v*b-p*I,i[4]=s*I-h*b,i[5]=h*p-s*v,i[6]=p*E-m*b,i[7]=c*b-s*E,i[8]=s*m-c*p,i},pt.determinant=function(i){var n=i[3],s=i[4],c=i[5],h=i[6],p=i[7],m=i[8];return i[0]*(m*s-c*p)+i[1]*(-m*n+c*h)+i[2]*(p*n-s*h)},pt.multiply=un,pt.translate=function(i,n,s){var c=n[0],h=n[1],p=n[2],m=n[3],v=n[4],b=n[5],E=n[6],I=n[7],P=n[8],M=s[0],z=s[1];return i[0]=c,i[1]=h,i[2]=p,i[3]=m,i[4]=v,i[5]=b,i[6]=M*c+z*m+E,i[7]=M*h+z*v+I,i[8]=M*p+z*b+P,i},pt.rotate=function(i,n,s){var c=n[0],h=n[1],p=n[2],m=n[3],v=n[4],b=n[5],E=n[6],I=n[7],P=n[8],M=Math.sin(s),z=Math.cos(s);return i[0]=z*c+M*m,i[1]=z*h+M*v,i[2]=z*p+M*b,i[3]=z*m-M*c,i[4]=z*v-M*h,i[5]=z*b-M*p,i[6]=E,i[7]=I,i[8]=P,i},pt.scale=function(i,n,s){var c=s[0],h=s[1];return i[0]=c*n[0],i[1]=c*n[1],i[2]=c*n[2],i[3]=h*n[3],i[4]=h*n[4],i[5]=h*n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i},pt.fromTranslation=function(i,n){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=n[0],i[7]=n[1],i[8]=1,i},pt.fromRotation=function(i,n){var s=Math.sin(n),c=Math.cos(n);return i[0]=c,i[1]=s,i[2]=0,i[3]=-s,i[4]=c,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},pt.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=n[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},pt.fromMat2d=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=0,i[3]=n[2],i[4]=n[3],i[5]=0,i[6]=n[4],i[7]=n[5],i[8]=1,i},pt.fromQuat=function(i,n){var s=n[0],c=n[1],h=n[2],p=n[3],m=s+s,v=c+c,b=h+h,E=s*m,I=c*m,P=c*v,M=h*m,z=h*v,F=h*b,V=p*m,j=p*v,K=p*b;return i[0]=1-P-F,i[3]=I-K,i[6]=M+j,i[1]=I+K,i[4]=1-E-F,i[7]=z-V,i[2]=M-j,i[5]=z+V,i[8]=1-E-P,i},pt.normalFromMat4=function(i,n){var s=n[0],c=n[1],h=n[2],p=n[3],m=n[4],v=n[5],b=n[6],E=n[7],I=n[8],P=n[9],M=n[10],z=n[11],F=n[12],V=n[13],j=n[14],K=n[15],pe=s*v-c*m,de=s*b-h*m,me=s*E-p*m,Ae=c*b-h*v,Ce=c*E-p*v,ze=h*E-p*b,$e=I*V-P*F,Xe=I*j-M*F,tt=I*K-z*F,Ke=P*j-M*V,lt=P*K-z*V,Tt=M*K-z*j,ct=pe*Tt-de*lt+me*Ke+Ae*tt-Ce*Xe+ze*$e;return ct?(i[0]=(v*Tt-b*lt+E*Ke)*(ct=1/ct),i[1]=(b*tt-m*Tt-E*Xe)*ct,i[2]=(m*lt-v*tt+E*$e)*ct,i[3]=(h*lt-c*Tt-p*Ke)*ct,i[4]=(s*Tt-h*tt+p*Xe)*ct,i[5]=(c*tt-s*lt-p*$e)*ct,i[6]=(V*ze-j*Ce+K*Ae)*ct,i[7]=(j*me-F*ze-K*de)*ct,i[8]=(F*Ce-V*me+K*pe)*ct,i):null},pt.projection=function(i,n,s){return i[0]=2/n,i[1]=0,i[2]=0,i[3]=0,i[4]=-2/s,i[5]=0,i[6]=-1,i[7]=1,i[8]=1,i},pt.str=function(i){return"mat3("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+")"},pt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},pt.add=function(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i[2]=n[2]+s[2],i[3]=n[3]+s[3],i[4]=n[4]+s[4],i[5]=n[5]+s[5],i[6]=n[6]+s[6],i[7]=n[7]+s[7],i[8]=n[8]+s[8],i},pt.subtract=_n,pt.multiplyScalar=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3]*s,i[4]=n[4]*s,i[5]=n[5]*s,i[6]=n[6]*s,i[7]=n[7]*s,i[8]=n[8]*s,i},pt.multiplyScalarAndAdd=function(i,n,s,c){return i[0]=n[0]+s[0]*c,i[1]=n[1]+s[1]*c,i[2]=n[2]+s[2]*c,i[3]=n[3]+s[3]*c,i[4]=n[4]+s[4]*c,i[5]=n[5]+s[5]*c,i[6]=n[6]+s[6]*c,i[7]=n[7]+s[7]*c,i[8]=n[8]+s[8]*c,i},pt.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]&&i[8]===n[8]},pt.equals=function(i,n){var s=i[0],c=i[1],h=i[2],p=i[3],m=i[4],v=i[5],b=i[6],E=i[7],I=i[8],P=n[0],M=n[1],z=n[2],F=n[3],V=n[4],j=n[5],K=n[6],pe=n[7],de=n[8];return Math.abs(s-P)<=Mt.EPSILON*Math.max(1,Math.abs(s),Math.abs(P))&&Math.abs(c-M)<=Mt.EPSILON*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(h-z)<=Mt.EPSILON*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(p-F)<=Mt.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(m-V)<=Mt.EPSILON*Math.max(1,Math.abs(m),Math.abs(V))&&Math.abs(v-j)<=Mt.EPSILON*Math.max(1,Math.abs(v),Math.abs(j))&&Math.abs(b-K)<=Mt.EPSILON*Math.max(1,Math.abs(b),Math.abs(K))&&Math.abs(E-pe)<=Mt.EPSILON*Math.max(1,Math.abs(E),Math.abs(pe))&&Math.abs(I-de)<=Mt.EPSILON*Math.max(1,Math.abs(I),Math.abs(de))},pt.sub=pt.mul=void 0;var Mt=function(i,n){if(i&&i.__esModule)return i;if(i===null||jt(i)!=="object"&&typeof i!="function")return{default:i};var s=pn(void 0);if(s&&s.has(i))return s.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,s&&s.set(i,c),c}(Pe);function pn(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(pn=function(c){return c?s:n})(i)}function un(i,n,s){var c=n[0],h=n[1],p=n[2],m=n[3],v=n[4],b=n[5],E=n[6],I=n[7],P=n[8],M=s[0],z=s[1],F=s[2],V=s[3],j=s[4],K=s[5],pe=s[6],de=s[7],me=s[8];return i[0]=M*c+z*m+F*E,i[1]=M*h+z*v+F*I,i[2]=M*p+z*b+F*P,i[3]=V*c+j*m+K*E,i[4]=V*h+j*v+K*I,i[5]=V*p+j*b+K*P,i[6]=pe*c+de*m+me*E,i[7]=pe*h+de*v+me*I,i[8]=pe*p+de*b+me*P,i}function _n(i,n,s){return i[0]=n[0]-s[0],i[1]=n[1]-s[1],i[2]=n[2]-s[2],i[3]=n[3]-s[3],i[4]=n[4]-s[4],i[5]=n[5]-s[5],i[6]=n[6]-s[6],i[7]=n[7]-s[7],i[8]=n[8]-s[8],i}pt.mul=un,pt.sub=_n;var St={};function ln(i){return ln=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ln(i)}Object.defineProperty(St,"__esModule",{value:!0}),St.create=function(){var i=new Kt.ARRAY_TYPE(16);return Kt.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},St.clone=function(i){var n=new Kt.ARRAY_TYPE(16);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],n},St.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i},St.fromValues=function(i,n,s,c,h,p,m,v,b,E,I,P,M,z,F,V){var j=new Kt.ARRAY_TYPE(16);return j[0]=i,j[1]=n,j[2]=s,j[3]=c,j[4]=h,j[5]=p,j[6]=m,j[7]=v,j[8]=b,j[9]=E,j[10]=I,j[11]=P,j[12]=M,j[13]=z,j[14]=F,j[15]=V,j},St.set=function(i,n,s,c,h,p,m,v,b,E,I,P,M,z,F,V,j){return i[0]=n,i[1]=s,i[2]=c,i[3]=h,i[4]=p,i[5]=m,i[6]=v,i[7]=b,i[8]=E,i[9]=I,i[10]=P,i[11]=M,i[12]=z,i[13]=F,i[14]=V,i[15]=j,i},St.identity=Er,St.transpose=function(i,n){if(i===n){var s=n[1],c=n[2],h=n[3],p=n[6],m=n[7],v=n[11];i[1]=n[4],i[2]=n[8],i[3]=n[12],i[4]=s,i[6]=n[9],i[7]=n[13],i[8]=c,i[9]=p,i[11]=n[14],i[12]=h,i[13]=m,i[14]=v}else i[0]=n[0],i[1]=n[4],i[2]=n[8],i[3]=n[12],i[4]=n[1],i[5]=n[5],i[6]=n[9],i[7]=n[13],i[8]=n[2],i[9]=n[6],i[10]=n[10],i[11]=n[14],i[12]=n[3],i[13]=n[7],i[14]=n[11],i[15]=n[15];return i},St.invert=function(i,n){var s=n[0],c=n[1],h=n[2],p=n[3],m=n[4],v=n[5],b=n[6],E=n[7],I=n[8],P=n[9],M=n[10],z=n[11],F=n[12],V=n[13],j=n[14],K=n[15],pe=s*v-c*m,de=s*b-h*m,me=s*E-p*m,Ae=c*b-h*v,Ce=c*E-p*v,ze=h*E-p*b,$e=I*V-P*F,Xe=I*j-M*F,tt=I*K-z*F,Ke=P*j-M*V,lt=P*K-z*V,Tt=M*K-z*j,ct=pe*Tt-de*lt+me*Ke+Ae*tt-Ce*Xe+ze*$e;return ct?(i[0]=(v*Tt-b*lt+E*Ke)*(ct=1/ct),i[1]=(h*lt-c*Tt-p*Ke)*ct,i[2]=(V*ze-j*Ce+K*Ae)*ct,i[3]=(M*Ce-P*ze-z*Ae)*ct,i[4]=(b*tt-m*Tt-E*Xe)*ct,i[5]=(s*Tt-h*tt+p*Xe)*ct,i[6]=(j*me-F*ze-K*de)*ct,i[7]=(I*ze-M*me+z*de)*ct,i[8]=(m*lt-v*tt+E*$e)*ct,i[9]=(c*tt-s*lt-p*$e)*ct,i[10]=(F*Ce-V*me+K*pe)*ct,i[11]=(P*me-I*Ce-z*pe)*ct,i[12]=(v*Xe-m*Ke-b*$e)*ct,i[13]=(s*Ke-c*Xe+h*$e)*ct,i[14]=(V*de-F*Ae-j*pe)*ct,i[15]=(I*Ae-P*de+M*pe)*ct,i):null},St.adjoint=function(i,n){var s=n[0],c=n[1],h=n[2],p=n[3],m=n[4],v=n[5],b=n[6],E=n[7],I=n[8],P=n[9],M=n[10],z=n[11],F=n[12],V=n[13],j=n[14],K=n[15];return i[0]=v*(M*K-z*j)-P*(b*K-E*j)+V*(b*z-E*M),i[1]=-(c*(M*K-z*j)-P*(h*K-p*j)+V*(h*z-p*M)),i[2]=c*(b*K-E*j)-v*(h*K-p*j)+V*(h*E-p*b),i[3]=-(c*(b*z-E*M)-v*(h*z-p*M)+P*(h*E-p*b)),i[4]=-(m*(M*K-z*j)-I*(b*K-E*j)+F*(b*z-E*M)),i[5]=s*(M*K-z*j)-I*(h*K-p*j)+F*(h*z-p*M),i[6]=-(s*(b*K-E*j)-m*(h*K-p*j)+F*(h*E-p*b)),i[7]=s*(b*z-E*M)-m*(h*z-p*M)+I*(h*E-p*b),i[8]=m*(P*K-z*V)-I*(v*K-E*V)+F*(v*z-E*P),i[9]=-(s*(P*K-z*V)-I*(c*K-p*V)+F*(c*z-p*P)),i[10]=s*(v*K-E*V)-m*(c*K-p*V)+F*(c*E-p*v),i[11]=-(s*(v*z-E*P)-m*(c*z-p*P)+I*(c*E-p*v)),i[12]=-(m*(P*j-M*V)-I*(v*j-b*V)+F*(v*M-b*P)),i[13]=s*(P*j-M*V)-I*(c*j-h*V)+F*(c*M-h*P),i[14]=-(s*(v*j-b*V)-m*(c*j-h*V)+F*(c*b-h*v)),i[15]=s*(v*M-b*P)-m*(c*M-h*P)+I*(c*b-h*v),i},St.determinant=function(i){var n=i[0],s=i[1],c=i[2],h=i[3],p=i[4],m=i[5],v=i[6],b=i[7],E=i[8],I=i[9],P=i[10],M=i[11],z=i[12],F=i[13],V=i[14],j=i[15];return(n*m-s*p)*(P*j-M*V)-(n*v-c*p)*(I*j-M*F)+(n*b-h*p)*(I*V-P*F)+(s*v-c*m)*(E*j-M*z)-(s*b-h*m)*(E*V-P*z)+(c*b-h*v)*(E*F-I*z)},St.multiply=Dn,St.translate=function(i,n,s){var c,h,p,m,v,b,E,I,P,M,z,F,V=s[0],j=s[1],K=s[2];return n===i?(i[12]=n[0]*V+n[4]*j+n[8]*K+n[12],i[13]=n[1]*V+n[5]*j+n[9]*K+n[13],i[14]=n[2]*V+n[6]*j+n[10]*K+n[14],i[15]=n[3]*V+n[7]*j+n[11]*K+n[15]):(h=n[1],p=n[2],m=n[3],v=n[4],b=n[5],E=n[6],I=n[7],P=n[8],M=n[9],z=n[10],F=n[11],i[0]=c=n[0],i[1]=h,i[2]=p,i[3]=m,i[4]=v,i[5]=b,i[6]=E,i[7]=I,i[8]=P,i[9]=M,i[10]=z,i[11]=F,i[12]=c*V+v*j+P*K+n[12],i[13]=h*V+b*j+M*K+n[13],i[14]=p*V+E*j+z*K+n[14],i[15]=m*V+I*j+F*K+n[15]),i},St.scale=function(i,n,s){var c=s[0],h=s[1],p=s[2];return i[0]=n[0]*c,i[1]=n[1]*c,i[2]=n[2]*c,i[3]=n[3]*c,i[4]=n[4]*h,i[5]=n[5]*h,i[6]=n[6]*h,i[7]=n[7]*h,i[8]=n[8]*p,i[9]=n[9]*p,i[10]=n[10]*p,i[11]=n[11]*p,i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i},St.rotate=function(i,n,s,c){var h,p,m,v,b,E,I,P,M,z,F,V,j,K,pe,de,me,Ae,Ce,ze,$e,Xe,tt,Ke,lt=c[0],Tt=c[1],ct=c[2],At=Math.hypot(lt,Tt,ct);return At<Kt.EPSILON?null:(lt*=At=1/At,Tt*=At,ct*=At,h=Math.sin(s),p=Math.cos(s),b=n[1],E=n[2],I=n[3],M=n[5],z=n[6],F=n[7],j=n[9],K=n[10],pe=n[11],de=lt*lt*(m=1-p)+p,Ce=lt*Tt*m-ct*h,ze=Tt*Tt*m+p,$e=ct*Tt*m+lt*h,Xe=lt*ct*m+Tt*h,tt=Tt*ct*m-lt*h,Ke=ct*ct*m+p,i[0]=(v=n[0])*de+(P=n[4])*(me=Tt*lt*m+ct*h)+(V=n[8])*(Ae=ct*lt*m-Tt*h),i[1]=b*de+M*me+j*Ae,i[2]=E*de+z*me+K*Ae,i[3]=I*de+F*me+pe*Ae,i[4]=v*Ce+P*ze+V*$e,i[5]=b*Ce+M*ze+j*$e,i[6]=E*Ce+z*ze+K*$e,i[7]=I*Ce+F*ze+pe*$e,i[8]=v*Xe+P*tt+V*Ke,i[9]=b*Xe+M*tt+j*Ke,i[10]=E*Xe+z*tt+K*Ke,i[11]=I*Xe+F*tt+pe*Ke,n!==i&&(i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i)},St.rotateX=function(i,n,s){var c=Math.sin(s),h=Math.cos(s),p=n[4],m=n[5],v=n[6],b=n[7],E=n[8],I=n[9],P=n[10],M=n[11];return n!==i&&(i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[4]=p*h+E*c,i[5]=m*h+I*c,i[6]=v*h+P*c,i[7]=b*h+M*c,i[8]=E*h-p*c,i[9]=I*h-m*c,i[10]=P*h-v*c,i[11]=M*h-b*c,i},St.rotateY=function(i,n,s){var c=Math.sin(s),h=Math.cos(s),p=n[0],m=n[1],v=n[2],b=n[3],E=n[8],I=n[9],P=n[10],M=n[11];return n!==i&&(i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[0]=p*h-E*c,i[1]=m*h-I*c,i[2]=v*h-P*c,i[3]=b*h-M*c,i[8]=p*c+E*h,i[9]=m*c+I*h,i[10]=v*c+P*h,i[11]=b*c+M*h,i},St.rotateZ=function(i,n,s){var c=Math.sin(s),h=Math.cos(s),p=n[0],m=n[1],v=n[2],b=n[3],E=n[4],I=n[5],P=n[6],M=n[7];return n!==i&&(i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[0]=p*h+E*c,i[1]=m*h+I*c,i[2]=v*h+P*c,i[3]=b*h+M*c,i[4]=E*h-p*c,i[5]=I*h-m*c,i[6]=P*h-v*c,i[7]=M*h-b*c,i},St.fromTranslation=function(i,n){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i},St.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=n[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},St.fromRotation=function(i,n,s){var c,h,p,m=s[0],v=s[1],b=s[2],E=Math.hypot(m,v,b);return E<Kt.EPSILON?null:(m*=E=1/E,v*=E,b*=E,c=Math.sin(n),h=Math.cos(n),i[0]=m*m*(p=1-h)+h,i[1]=v*m*p+b*c,i[2]=b*m*p-v*c,i[3]=0,i[4]=m*v*p-b*c,i[5]=v*v*p+h,i[6]=b*v*p+m*c,i[7]=0,i[8]=m*b*p+v*c,i[9]=v*b*p-m*c,i[10]=b*b*p+h,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)},St.fromXRotation=function(i,n){var s=Math.sin(n),c=Math.cos(n);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=c,i[6]=s,i[7]=0,i[8]=0,i[9]=-s,i[10]=c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},St.fromYRotation=function(i,n){var s=Math.sin(n),c=Math.cos(n);return i[0]=c,i[1]=0,i[2]=-s,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=s,i[9]=0,i[10]=c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},St.fromZRotation=function(i,n){var s=Math.sin(n),c=Math.cos(n);return i[0]=c,i[1]=s,i[2]=0,i[3]=0,i[4]=-s,i[5]=c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},St.fromRotationTranslation=hr,St.fromQuat2=function(i,n){var s=new Kt.ARRAY_TYPE(3),c=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],b=n[5],E=n[6],I=n[7],P=c*c+h*h+p*p+m*m;return P>0?(s[0]=2*(v*m+I*c+b*p-E*h)/P,s[1]=2*(b*m+I*h+E*c-v*p)/P,s[2]=2*(E*m+I*p+v*h-b*c)/P):(s[0]=2*(v*m+I*c+b*p-E*h),s[1]=2*(b*m+I*h+E*c-v*p),s[2]=2*(E*m+I*p+v*h-b*c)),hr(i,n,s),i},St.getTranslation=function(i,n){return i[0]=n[12],i[1]=n[13],i[2]=n[14],i},St.getScaling=Fr,St.getRotation=function(i,n){var s=new Kt.ARRAY_TYPE(3);Fr(s,n);var c=1/s[0],h=1/s[1],p=1/s[2],m=n[0]*c,v=n[1]*h,b=n[2]*p,E=n[4]*c,I=n[5]*h,P=n[6]*p,M=n[8]*c,z=n[9]*h,F=n[10]*p,V=m+I+F,j=0;return V>0?(j=2*Math.sqrt(V+1),i[3]=.25*j,i[0]=(P-z)/j,i[1]=(M-b)/j,i[2]=(v-E)/j):m>I&&m>F?(j=2*Math.sqrt(1+m-I-F),i[3]=(P-z)/j,i[0]=.25*j,i[1]=(v+E)/j,i[2]=(M+b)/j):I>F?(j=2*Math.sqrt(1+I-m-F),i[3]=(M-b)/j,i[0]=(v+E)/j,i[1]=.25*j,i[2]=(P+z)/j):(j=2*Math.sqrt(1+F-m-I),i[3]=(v-E)/j,i[0]=(M+b)/j,i[1]=(P+z)/j,i[2]=.25*j),i},St.fromRotationTranslationScale=function(i,n,s,c){var h=n[0],p=n[1],m=n[2],v=n[3],b=h+h,E=p+p,I=m+m,P=h*b,M=h*E,z=h*I,F=p*E,V=p*I,j=m*I,K=v*b,pe=v*E,de=v*I,me=c[0],Ae=c[1],Ce=c[2];return i[0]=(1-(F+j))*me,i[1]=(M+de)*me,i[2]=(z-pe)*me,i[3]=0,i[4]=(M-de)*Ae,i[5]=(1-(P+j))*Ae,i[6]=(V+K)*Ae,i[7]=0,i[8]=(z+pe)*Ce,i[9]=(V-K)*Ce,i[10]=(1-(P+F))*Ce,i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i},St.fromRotationTranslationScaleOrigin=function(i,n,s,c,h){var p=n[0],m=n[1],v=n[2],b=n[3],E=p+p,I=m+m,P=v+v,M=p*E,z=p*I,F=p*P,V=m*I,j=m*P,K=v*P,pe=b*E,de=b*I,me=b*P,Ae=c[0],Ce=c[1],ze=c[2],$e=h[0],Xe=h[1],tt=h[2],Ke=(1-(V+K))*Ae,lt=(z+me)*Ae,Tt=(F-de)*Ae,ct=(z-me)*Ce,At=(1-(M+K))*Ce,ot=(j+pe)*Ce,mt=(F+de)*ze,Ot=(j-pe)*ze,ut=(1-(M+V))*ze;return i[0]=Ke,i[1]=lt,i[2]=Tt,i[3]=0,i[4]=ct,i[5]=At,i[6]=ot,i[7]=0,i[8]=mt,i[9]=Ot,i[10]=ut,i[11]=0,i[12]=s[0]+$e-(Ke*$e+ct*Xe+mt*tt),i[13]=s[1]+Xe-(lt*$e+At*Xe+Ot*tt),i[14]=s[2]+tt-(Tt*$e+ot*Xe+ut*tt),i[15]=1,i},St.fromQuat=function(i,n){var s=n[0],c=n[1],h=n[2],p=n[3],m=s+s,v=c+c,b=h+h,E=s*m,I=c*m,P=c*v,M=h*m,z=h*v,F=h*b,V=p*m,j=p*v,K=p*b;return i[0]=1-P-F,i[1]=I+K,i[2]=M-j,i[3]=0,i[4]=I-K,i[5]=1-E-F,i[6]=z+V,i[7]=0,i[8]=M+j,i[9]=z-V,i[10]=1-E-P,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},St.frustum=function(i,n,s,c,h,p,m){var v=1/(s-n),b=1/(h-c),E=1/(p-m);return i[0]=2*p*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*p*b,i[6]=0,i[7]=0,i[8]=(s+n)*v,i[9]=(h+c)*b,i[10]=(m+p)*E,i[11]=-1,i[12]=0,i[13]=0,i[14]=m*p*2*E,i[15]=0,i},St.perspectiveNO=ar,St.perspectiveZO=function(i,n,s,c,h){var p,m=1/Math.tan(n/2);return i[0]=m/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=h*(p=1/(c-h)),i[14]=h*c*p):(i[10]=-1,i[14]=-c),i},St.perspectiveFromFieldOfView=function(i,n,s,c){var h=Math.tan(n.upDegrees*Math.PI/180),p=Math.tan(n.downDegrees*Math.PI/180),m=Math.tan(n.leftDegrees*Math.PI/180),v=Math.tan(n.rightDegrees*Math.PI/180),b=2/(m+v),E=2/(h+p);return i[0]=b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=E,i[6]=0,i[7]=0,i[8]=-(m-v)*b*.5,i[9]=(h-p)*E*.5,i[10]=c/(s-c),i[11]=-1,i[12]=0,i[13]=0,i[14]=c*s/(s-c),i[15]=0,i},St.orthoNO=Yn,St.orthoZO=function(i,n,s,c,h,p,m){var v=1/(n-s),b=1/(c-h),E=1/(p-m);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=E,i[11]=0,i[12]=(n+s)*v,i[13]=(h+c)*b,i[14]=p*E,i[15]=1,i},St.lookAt=function(i,n,s,c){var h,p,m,v,b,E,I,P,M,z,F=n[0],V=n[1],j=n[2],K=c[0],pe=c[1],de=c[2],me=s[0],Ae=s[1],Ce=s[2];return Math.abs(F-me)<Kt.EPSILON&&Math.abs(V-Ae)<Kt.EPSILON&&Math.abs(j-Ce)<Kt.EPSILON?Er(i):(I=F-me,P=V-Ae,M=j-Ce,h=pe*(M*=z=1/Math.hypot(I,P,M))-de*(P*=z),p=de*(I*=z)-K*M,m=K*P-pe*I,(z=Math.hypot(h,p,m))?(h*=z=1/z,p*=z,m*=z):(h=0,p=0,m=0),v=P*m-M*p,b=M*h-I*m,E=I*p-P*h,(z=Math.hypot(v,b,E))?(v*=z=1/z,b*=z,E*=z):(v=0,b=0,E=0),i[0]=h,i[1]=v,i[2]=I,i[3]=0,i[4]=p,i[5]=b,i[6]=P,i[7]=0,i[8]=m,i[9]=E,i[10]=M,i[11]=0,i[12]=-(h*F+p*V+m*j),i[13]=-(v*F+b*V+E*j),i[14]=-(I*F+P*V+M*j),i[15]=1,i)},St.targetTo=function(i,n,s,c){var h=n[0],p=n[1],m=n[2],v=c[0],b=c[1],E=c[2],I=h-s[0],P=p-s[1],M=m-s[2],z=I*I+P*P+M*M;z>0&&(I*=z=1/Math.sqrt(z),P*=z,M*=z);var F=b*M-E*P,V=E*I-v*M,j=v*P-b*I;return(z=F*F+V*V+j*j)>0&&(F*=z=1/Math.sqrt(z),V*=z,j*=z),i[0]=F,i[1]=V,i[2]=j,i[3]=0,i[4]=P*j-M*V,i[5]=M*F-I*j,i[6]=I*V-P*F,i[7]=0,i[8]=I,i[9]=P,i[10]=M,i[11]=0,i[12]=h,i[13]=p,i[14]=m,i[15]=1,i},St.str=function(i){return"mat4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+", "+i[9]+", "+i[10]+", "+i[11]+", "+i[12]+", "+i[13]+", "+i[14]+", "+i[15]+")"},St.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])},St.add=function(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i[2]=n[2]+s[2],i[3]=n[3]+s[3],i[4]=n[4]+s[4],i[5]=n[5]+s[5],i[6]=n[6]+s[6],i[7]=n[7]+s[7],i[8]=n[8]+s[8],i[9]=n[9]+s[9],i[10]=n[10]+s[10],i[11]=n[11]+s[11],i[12]=n[12]+s[12],i[13]=n[13]+s[13],i[14]=n[14]+s[14],i[15]=n[15]+s[15],i},St.subtract=De,St.multiplyScalar=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3]*s,i[4]=n[4]*s,i[5]=n[5]*s,i[6]=n[6]*s,i[7]=n[7]*s,i[8]=n[8]*s,i[9]=n[9]*s,i[10]=n[10]*s,i[11]=n[11]*s,i[12]=n[12]*s,i[13]=n[13]*s,i[14]=n[14]*s,i[15]=n[15]*s,i},St.multiplyScalarAndAdd=function(i,n,s,c){return i[0]=n[0]+s[0]*c,i[1]=n[1]+s[1]*c,i[2]=n[2]+s[2]*c,i[3]=n[3]+s[3]*c,i[4]=n[4]+s[4]*c,i[5]=n[5]+s[5]*c,i[6]=n[6]+s[6]*c,i[7]=n[7]+s[7]*c,i[8]=n[8]+s[8]*c,i[9]=n[9]+s[9]*c,i[10]=n[10]+s[10]*c,i[11]=n[11]+s[11]*c,i[12]=n[12]+s[12]*c,i[13]=n[13]+s[13]*c,i[14]=n[14]+s[14]*c,i[15]=n[15]+s[15]*c,i},St.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]&&i[8]===n[8]&&i[9]===n[9]&&i[10]===n[10]&&i[11]===n[11]&&i[12]===n[12]&&i[13]===n[13]&&i[14]===n[14]&&i[15]===n[15]},St.equals=function(i,n){var s=i[0],c=i[1],h=i[2],p=i[3],m=i[4],v=i[5],b=i[6],E=i[7],I=i[8],P=i[9],M=i[10],z=i[11],F=i[12],V=i[13],j=i[14],K=i[15],pe=n[0],de=n[1],me=n[2],Ae=n[3],Ce=n[4],ze=n[5],$e=n[6],Xe=n[7],tt=n[8],Ke=n[9],lt=n[10],Tt=n[11],ct=n[12],At=n[13],ot=n[14],mt=n[15];return Math.abs(s-pe)<=Kt.EPSILON*Math.max(1,Math.abs(s),Math.abs(pe))&&Math.abs(c-de)<=Kt.EPSILON*Math.max(1,Math.abs(c),Math.abs(de))&&Math.abs(h-me)<=Kt.EPSILON*Math.max(1,Math.abs(h),Math.abs(me))&&Math.abs(p-Ae)<=Kt.EPSILON*Math.max(1,Math.abs(p),Math.abs(Ae))&&Math.abs(m-Ce)<=Kt.EPSILON*Math.max(1,Math.abs(m),Math.abs(Ce))&&Math.abs(v-ze)<=Kt.EPSILON*Math.max(1,Math.abs(v),Math.abs(ze))&&Math.abs(b-$e)<=Kt.EPSILON*Math.max(1,Math.abs(b),Math.abs($e))&&Math.abs(E-Xe)<=Kt.EPSILON*Math.max(1,Math.abs(E),Math.abs(Xe))&&Math.abs(I-tt)<=Kt.EPSILON*Math.max(1,Math.abs(I),Math.abs(tt))&&Math.abs(P-Ke)<=Kt.EPSILON*Math.max(1,Math.abs(P),Math.abs(Ke))&&Math.abs(M-lt)<=Kt.EPSILON*Math.max(1,Math.abs(M),Math.abs(lt))&&Math.abs(z-Tt)<=Kt.EPSILON*Math.max(1,Math.abs(z),Math.abs(Tt))&&Math.abs(F-ct)<=Kt.EPSILON*Math.max(1,Math.abs(F),Math.abs(ct))&&Math.abs(V-At)<=Kt.EPSILON*Math.max(1,Math.abs(V),Math.abs(At))&&Math.abs(j-ot)<=Kt.EPSILON*Math.max(1,Math.abs(j),Math.abs(ot))&&Math.abs(K-mt)<=Kt.EPSILON*Math.max(1,Math.abs(K),Math.abs(mt))},St.sub=St.mul=St.ortho=St.perspective=void 0;var Kt=function(i,n){if(i&&i.__esModule)return i;if(i===null||ln(i)!=="object"&&typeof i!="function")return{default:i};var s=xn(void 0);if(s&&s.has(i))return s.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,s&&s.set(i,c),c}(Pe);function xn(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(xn=function(c){return c?s:n})(i)}function Er(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Dn(i,n,s){var c=n[0],h=n[1],p=n[2],m=n[3],v=n[4],b=n[5],E=n[6],I=n[7],P=n[8],M=n[9],z=n[10],F=n[11],V=n[12],j=n[13],K=n[14],pe=n[15],de=s[0],me=s[1],Ae=s[2],Ce=s[3];return i[0]=de*c+me*v+Ae*P+Ce*V,i[1]=de*h+me*b+Ae*M+Ce*j,i[2]=de*p+me*E+Ae*z+Ce*K,i[3]=de*m+me*I+Ae*F+Ce*pe,i[4]=(de=s[4])*c+(me=s[5])*v+(Ae=s[6])*P+(Ce=s[7])*V,i[5]=de*h+me*b+Ae*M+Ce*j,i[6]=de*p+me*E+Ae*z+Ce*K,i[7]=de*m+me*I+Ae*F+Ce*pe,i[8]=(de=s[8])*c+(me=s[9])*v+(Ae=s[10])*P+(Ce=s[11])*V,i[9]=de*h+me*b+Ae*M+Ce*j,i[10]=de*p+me*E+Ae*z+Ce*K,i[11]=de*m+me*I+Ae*F+Ce*pe,i[12]=(de=s[12])*c+(me=s[13])*v+(Ae=s[14])*P+(Ce=s[15])*V,i[13]=de*h+me*b+Ae*M+Ce*j,i[14]=de*p+me*E+Ae*z+Ce*K,i[15]=de*m+me*I+Ae*F+Ce*pe,i}function hr(i,n,s){var c=n[0],h=n[1],p=n[2],m=n[3],v=c+c,b=h+h,E=p+p,I=c*v,P=c*b,M=c*E,z=h*b,F=h*E,V=p*E,j=m*v,K=m*b,pe=m*E;return i[0]=1-(z+V),i[1]=P+pe,i[2]=M-K,i[3]=0,i[4]=P-pe,i[5]=1-(I+V),i[6]=F+j,i[7]=0,i[8]=M+K,i[9]=F-j,i[10]=1-(I+z),i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i}function Fr(i,n){var s=n[4],c=n[5],h=n[6],p=n[8],m=n[9],v=n[10];return i[0]=Math.hypot(n[0],n[1],n[2]),i[1]=Math.hypot(s,c,h),i[2]=Math.hypot(p,m,v),i}function ar(i,n,s,c,h){var p,m=1/Math.tan(n/2);return i[0]=m/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=(h+c)*(p=1/(c-h)),i[14]=2*h*c*p):(i[10]=-1,i[14]=-2*c),i}function Yn(i,n,s,c,h,p,m){var v=1/(n-s),b=1/(c-h),E=1/(p-m);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*E,i[11]=0,i[12]=(n+s)*v,i[13]=(h+c)*b,i[14]=(m+p)*E,i[15]=1,i}function De(i,n,s){return i[0]=n[0]-s[0],i[1]=n[1]-s[1],i[2]=n[2]-s[2],i[3]=n[3]-s[3],i[4]=n[4]-s[4],i[5]=n[5]-s[5],i[6]=n[6]-s[6],i[7]=n[7]-s[7],i[8]=n[8]-s[8],i[9]=n[9]-s[9],i[10]=n[10]-s[10],i[11]=n[11]-s[11],i[12]=n[12]-s[12],i[13]=n[13]-s[13],i[14]=n[14]-s[14],i[15]=n[15]-s[15],i}St.perspective=ar,St.ortho=Yn,St.mul=Dn,St.sub=De;var Ze={},st={};function rn(i){return rn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},rn(i)}Object.defineProperty(st,"__esModule",{value:!0}),st.create=Sr,st.clone=function(i){var n=new Pt.ARRAY_TYPE(3);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n},st.length=yn,st.fromValues=function(i,n,s){var c=new Pt.ARRAY_TYPE(3);return c[0]=i,c[1]=n,c[2]=s,c},st.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i},st.set=function(i,n,s,c){return i[0]=n,i[1]=s,i[2]=c,i},st.add=function(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i[2]=n[2]+s[2],i},st.subtract=Zn,st.multiply=br,st.divide=Lr,st.ceil=function(i,n){return i[0]=Math.ceil(n[0]),i[1]=Math.ceil(n[1]),i[2]=Math.ceil(n[2]),i},st.floor=function(i,n){return i[0]=Math.floor(n[0]),i[1]=Math.floor(n[1]),i[2]=Math.floor(n[2]),i},st.min=function(i,n,s){return i[0]=Math.min(n[0],s[0]),i[1]=Math.min(n[1],s[1]),i[2]=Math.min(n[2],s[2]),i},st.max=function(i,n,s){return i[0]=Math.max(n[0],s[0]),i[1]=Math.max(n[1],s[1]),i[2]=Math.max(n[2],s[2]),i},st.round=function(i,n){return i[0]=Math.round(n[0]),i[1]=Math.round(n[1]),i[2]=Math.round(n[2]),i},st.scale=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i},st.scaleAndAdd=function(i,n,s,c){return i[0]=n[0]+s[0]*c,i[1]=n[1]+s[1]*c,i[2]=n[2]+s[2]*c,i},st.distance=Li,st.squaredDistance=dr,st.squaredLength=zi,st.negate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i},st.inverse=function(i,n){return i[0]=1/n[0],i[1]=1/n[1],i[2]=1/n[2],i},st.normalize=function(i,n){var s=n[0],c=n[1],h=n[2],p=s*s+c*c+h*h;return p>0&&(p=1/Math.sqrt(p)),i[0]=n[0]*p,i[1]=n[1]*p,i[2]=n[2]*p,i},st.dot=ls,st.cross=function(i,n,s){var c=n[0],h=n[1],p=n[2],m=s[0],v=s[1],b=s[2];return i[0]=h*b-p*v,i[1]=p*m-c*b,i[2]=c*v-h*m,i},st.lerp=function(i,n,s,c){var h=n[0],p=n[1],m=n[2];return i[0]=h+c*(s[0]-h),i[1]=p+c*(s[1]-p),i[2]=m+c*(s[2]-m),i},st.hermite=function(i,n,s,c,h,p){var m=p*p,v=m*(2*p-3)+1,b=m*(p-2)+p,E=m*(p-1),I=m*(3-2*p);return i[0]=n[0]*v+s[0]*b+c[0]*E+h[0]*I,i[1]=n[1]*v+s[1]*b+c[1]*E+h[1]*I,i[2]=n[2]*v+s[2]*b+c[2]*E+h[2]*I,i},st.bezier=function(i,n,s,c,h,p){var m=1-p,v=m*m,b=p*p,E=v*m,I=3*p*v,P=3*b*m,M=b*p;return i[0]=n[0]*E+s[0]*I+c[0]*P+h[0]*M,i[1]=n[1]*E+s[1]*I+c[1]*P+h[1]*M,i[2]=n[2]*E+s[2]*I+c[2]*P+h[2]*M,i},st.random=function(i,n){n=n||1;var s=2*Pt.RANDOM()*Math.PI,c=2*Pt.RANDOM()-1,h=Math.sqrt(1-c*c)*n;return i[0]=Math.cos(s)*h,i[1]=Math.sin(s)*h,i[2]=c*n,i},st.transformMat4=function(i,n,s){var c=n[0],h=n[1],p=n[2],m=s[3]*c+s[7]*h+s[11]*p+s[15];return i[0]=(s[0]*c+s[4]*h+s[8]*p+s[12])/(m=m||1),i[1]=(s[1]*c+s[5]*h+s[9]*p+s[13])/m,i[2]=(s[2]*c+s[6]*h+s[10]*p+s[14])/m,i},st.transformMat3=function(i,n,s){var c=n[0],h=n[1],p=n[2];return i[0]=c*s[0]+h*s[3]+p*s[6],i[1]=c*s[1]+h*s[4]+p*s[7],i[2]=c*s[2]+h*s[5]+p*s[8],i},st.transformQuat=function(i,n,s){var c=s[0],h=s[1],p=s[2],m=n[0],v=n[1],b=n[2],E=h*b-p*v,I=p*m-c*b,P=c*v-h*m,M=h*P-p*I,z=p*E-c*P,F=c*I-h*E,V=2*s[3];return I*=V,P*=V,z*=2,F*=2,i[0]=m+(E*=V)+(M*=2),i[1]=v+I+z,i[2]=b+P+F,i},st.rotateX=function(i,n,s,c){var h=[],p=[];return h[0]=n[0]-s[0],h[1]=n[1]-s[1],h[2]=n[2]-s[2],p[0]=h[0],p[1]=h[1]*Math.cos(c)-h[2]*Math.sin(c),p[2]=h[1]*Math.sin(c)+h[2]*Math.cos(c),i[0]=p[0]+s[0],i[1]=p[1]+s[1],i[2]=p[2]+s[2],i},st.rotateY=function(i,n,s,c){var h=[],p=[];return h[0]=n[0]-s[0],h[1]=n[1]-s[1],h[2]=n[2]-s[2],p[0]=h[2]*Math.sin(c)+h[0]*Math.cos(c),p[1]=h[1],p[2]=h[2]*Math.cos(c)-h[0]*Math.sin(c),i[0]=p[0]+s[0],i[1]=p[1]+s[1],i[2]=p[2]+s[2],i},st.rotateZ=function(i,n,s,c){var h=[],p=[];return h[0]=n[0]-s[0],h[1]=n[1]-s[1],h[2]=n[2]-s[2],p[0]=h[0]*Math.cos(c)-h[1]*Math.sin(c),p[1]=h[0]*Math.sin(c)+h[1]*Math.cos(c),p[2]=h[2],i[0]=p[0]+s[0],i[1]=p[1]+s[1],i[2]=p[2]+s[2],i},st.angle=function(i,n){var s=i[0],c=i[1],h=i[2],p=n[0],m=n[1],v=n[2],b=Math.sqrt(s*s+c*c+h*h)*Math.sqrt(p*p+m*m+v*v),E=b&&ls(i,n)/b;return Math.acos(Math.min(Math.max(E,-1),1))},st.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i},st.str=function(i){return"vec3("+i[0]+", "+i[1]+", "+i[2]+")"},st.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]},st.equals=function(i,n){var s=i[0],c=i[1],h=i[2],p=n[0],m=n[1],v=n[2];return Math.abs(s-p)<=Pt.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(c-m)<=Pt.EPSILON*Math.max(1,Math.abs(c),Math.abs(m))&&Math.abs(h-v)<=Pt.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))},st.forEach=st.sqrLen=st.len=st.sqrDist=st.dist=st.div=st.mul=st.sub=void 0;var Pt=function(i,n){if(i&&i.__esModule)return i;if(i===null||rn(i)!=="object"&&typeof i!="function")return{default:i};var s=vn(void 0);if(s&&s.has(i))return s.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,s&&s.set(i,c),c}(Pe);function vn(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(vn=function(c){return c?s:n})(i)}function Sr(){var i=new Pt.ARRAY_TYPE(3);return Pt.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function yn(i){return Math.hypot(i[0],i[1],i[2])}function Zn(i,n,s){return i[0]=n[0]-s[0],i[1]=n[1]-s[1],i[2]=n[2]-s[2],i}function br(i,n,s){return i[0]=n[0]*s[0],i[1]=n[1]*s[1],i[2]=n[2]*s[2],i}function Lr(i,n,s){return i[0]=n[0]/s[0],i[1]=n[1]/s[1],i[2]=n[2]/s[2],i}function Li(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1],n[2]-i[2])}function dr(i,n){var s=n[0]-i[0],c=n[1]-i[1],h=n[2]-i[2];return s*s+c*c+h*h}function zi(i){var n=i[0],s=i[1],c=i[2];return n*n+s*s+c*c}function ls(i,n){return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]}st.sub=Zn,st.mul=br,st.div=Lr,st.dist=Li,st.sqrDist=dr,st.len=yn,st.sqrLen=zi;var Sn,lr=(Sn=Sr(),function(i,n,s,c,h,p){var m,v;for(n||(n=3),s||(s=0),v=c?Math.min(c*n+s,i.length):i.length,m=s;m<v;m+=n)Sn[0]=i[m],Sn[1]=i[m+1],Sn[2]=i[m+2],h(Sn,Sn,p),i[m]=Sn[0],i[m+1]=Sn[1],i[m+2]=Sn[2];return i});st.forEach=lr;var hn={};function Zs(i){return Zs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Zs(i)}Object.defineProperty(hn,"__esModule",{value:!0}),hn.create=_a,hn.clone=function(i){var n=new Ei.ARRAY_TYPE(4);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n},hn.fromValues=function(i,n,s,c){var h=new Ei.ARRAY_TYPE(4);return h[0]=i,h[1]=n,h[2]=s,h[3]=c,h},hn.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i},hn.set=function(i,n,s,c,h){return i[0]=n,i[1]=s,i[2]=c,i[3]=h,i},hn.add=function(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i[2]=n[2]+s[2],i[3]=n[3]+s[3],i},hn.subtract=en,hn.multiply=Kn,hn.divide=ei,hn.ceil=function(i,n){return i[0]=Math.ceil(n[0]),i[1]=Math.ceil(n[1]),i[2]=Math.ceil(n[2]),i[3]=Math.ceil(n[3]),i},hn.floor=function(i,n){return i[0]=Math.floor(n[0]),i[1]=Math.floor(n[1]),i[2]=Math.floor(n[2]),i[3]=Math.floor(n[3]),i},hn.min=function(i,n,s){return i[0]=Math.min(n[0],s[0]),i[1]=Math.min(n[1],s[1]),i[2]=Math.min(n[2],s[2]),i[3]=Math.min(n[3],s[3]),i},hn.max=function(i,n,s){return i[0]=Math.max(n[0],s[0]),i[1]=Math.max(n[1],s[1]),i[2]=Math.max(n[2],s[2]),i[3]=Math.max(n[3],s[3]),i},hn.round=function(i,n){return i[0]=Math.round(n[0]),i[1]=Math.round(n[1]),i[2]=Math.round(n[2]),i[3]=Math.round(n[3]),i},hn.scale=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3]*s,i},hn.scaleAndAdd=function(i,n,s,c){return i[0]=n[0]+s[0]*c,i[1]=n[1]+s[1]*c,i[2]=n[2]+s[2]*c,i[3]=n[3]+s[3]*c,i},hn.distance=Ai,hn.squaredDistance=vs,hn.length=xs,hn.squaredLength=Ps,hn.negate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=-n[3],i},hn.inverse=function(i,n){return i[0]=1/n[0],i[1]=1/n[1],i[2]=1/n[2],i[3]=1/n[3],i},hn.normalize=function(i,n){var s=n[0],c=n[1],h=n[2],p=n[3],m=s*s+c*c+h*h+p*p;return m>0&&(m=1/Math.sqrt(m)),i[0]=s*m,i[1]=c*m,i[2]=h*m,i[3]=p*m,i},hn.dot=function(i,n){return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},hn.cross=function(i,n,s,c){var h=s[0]*c[1]-s[1]*c[0],p=s[0]*c[2]-s[2]*c[0],m=s[0]*c[3]-s[3]*c[0],v=s[1]*c[2]-s[2]*c[1],b=s[1]*c[3]-s[3]*c[1],E=s[2]*c[3]-s[3]*c[2],I=n[0],P=n[1],M=n[2],z=n[3];return i[0]=P*E-M*b+z*v,i[1]=-I*E+M*m-z*p,i[2]=I*b-P*m+z*h,i[3]=-I*v+P*p-M*h,i},hn.lerp=function(i,n,s,c){var h=n[0],p=n[1],m=n[2],v=n[3];return i[0]=h+c*(s[0]-h),i[1]=p+c*(s[1]-p),i[2]=m+c*(s[2]-m),i[3]=v+c*(s[3]-v),i},hn.random=function(i,n){var s,c,h,p,m,v;n=n||1;do m=(s=2*Ei.RANDOM()-1)*s+(c=2*Ei.RANDOM()-1)*c;while(m>=1);do v=(h=2*Ei.RANDOM()-1)*h+(p=2*Ei.RANDOM()-1)*p;while(v>=1);var b=Math.sqrt((1-m)/v);return i[0]=n*s,i[1]=n*c,i[2]=n*h*b,i[3]=n*p*b,i},hn.transformMat4=function(i,n,s){var c=n[0],h=n[1],p=n[2],m=n[3];return i[0]=s[0]*c+s[4]*h+s[8]*p+s[12]*m,i[1]=s[1]*c+s[5]*h+s[9]*p+s[13]*m,i[2]=s[2]*c+s[6]*h+s[10]*p+s[14]*m,i[3]=s[3]*c+s[7]*h+s[11]*p+s[15]*m,i},hn.transformQuat=function(i,n,s){var c=n[0],h=n[1],p=n[2],m=s[0],v=s[1],b=s[2],E=s[3],I=E*c+v*p-b*h,P=E*h+b*c-m*p,M=E*p+m*h-v*c,z=-m*c-v*h-b*p;return i[0]=I*E+z*-m+P*-b-M*-v,i[1]=P*E+z*-v+M*-m-I*-b,i[2]=M*E+z*-b+I*-v-P*-m,i[3]=n[3],i},hn.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=0,i},hn.str=function(i){return"vec4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},hn.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]},hn.equals=function(i,n){var s=i[0],c=i[1],h=i[2],p=i[3],m=n[0],v=n[1],b=n[2],E=n[3];return Math.abs(s-m)<=Ei.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(c-v)<=Ei.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(h-b)<=Ei.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))&&Math.abs(p-E)<=Ei.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))},hn.forEach=hn.sqrLen=hn.len=hn.sqrDist=hn.dist=hn.div=hn.mul=hn.sub=void 0;var Ei=function(i,n){if(i&&i.__esModule)return i;if(i===null||Zs(i)!=="object"&&typeof i!="function")return{default:i};var s=ao(void 0);if(s&&s.has(i))return s.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,s&&s.set(i,c),c}(Pe);function ao(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(ao=function(c){return c?s:n})(i)}function _a(){var i=new Ei.ARRAY_TYPE(4);return Ei.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function en(i,n,s){return i[0]=n[0]-s[0],i[1]=n[1]-s[1],i[2]=n[2]-s[2],i[3]=n[3]-s[3],i}function Kn(i,n,s){return i[0]=n[0]*s[0],i[1]=n[1]*s[1],i[2]=n[2]*s[2],i[3]=n[3]*s[3],i}function ei(i,n,s){return i[0]=n[0]/s[0],i[1]=n[1]/s[1],i[2]=n[2]/s[2],i[3]=n[3]/s[3],i}function Ai(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1],n[2]-i[2],n[3]-i[3])}function vs(i,n){var s=n[0]-i[0],c=n[1]-i[1],h=n[2]-i[2],p=n[3]-i[3];return s*s+c*c+h*h+p*p}function xs(i){return Math.hypot(i[0],i[1],i[2],i[3])}function Ps(i){var n=i[0],s=i[1],c=i[2],h=i[3];return n*n+s*s+c*c+h*h}hn.sub=en,hn.mul=Kn,hn.div=ei,hn.dist=Ai,hn.sqrDist=vs,hn.len=xs,hn.sqrLen=Ps;var Ns=function(){var i=_a();return function(n,s,c,h,p,m){var v,b;for(s||(s=4),c||(c=0),b=h?Math.min(h*s+c,n.length):n.length,v=c;v<b;v+=s)i[0]=n[v],i[1]=n[v+1],i[2]=n[v+2],i[3]=n[v+3],p(i,i,m),n[v]=i[0],n[v+1]=i[1],n[v+2]=i[2],n[v+3]=i[3];return n}}();function Ro(i){return Ro=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ro(i)}hn.forEach=Ns,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.create=lo,Ze.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i},Ze.setAxisAngle=Ni,Ze.getAxisAngle=function(i,n){var s=2*Math.acos(n[3]),c=Math.sin(s/2);return c>Ur.EPSILON?(i[0]=n[0]/c,i[1]=n[1]/c,i[2]=n[2]/c):(i[0]=1,i[1]=0,i[2]=0),s},Ze.getAngle=function(i,n){var s=Oe(i,n);return Math.acos(2*s*s-1)},Ze.multiply=ku,Ze.rotateX=function(i,n,s){s*=.5;var c=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(s),b=Math.cos(s);return i[0]=c*b+m*v,i[1]=h*b+p*v,i[2]=p*b-h*v,i[3]=m*b-c*v,i},Ze.rotateY=function(i,n,s){s*=.5;var c=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(s),b=Math.cos(s);return i[0]=c*b-p*v,i[1]=h*b+m*v,i[2]=p*b+c*v,i[3]=m*b-h*v,i},Ze.rotateZ=function(i,n,s){s*=.5;var c=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(s),b=Math.cos(s);return i[0]=c*b+h*v,i[1]=h*b-c*v,i[2]=p*b+m*v,i[3]=m*b-p*v,i},Ze.calculateW=function(i,n){var s=n[0],c=n[1],h=n[2];return i[0]=s,i[1]=c,i[2]=h,i[3]=Math.sqrt(Math.abs(1-s*s-c*c-h*h)),i},Ze.exp=Ve,Ze.ln=ee,Ze.pow=function(i,n,s){return ee(i,n),Le(i,i,s),Ve(i,i),i},Ze.slerp=oe,Ze.random=function(i){var n=Ur.RANDOM(),s=Ur.RANDOM(),c=Ur.RANDOM(),h=Math.sqrt(1-n),p=Math.sqrt(n);return i[0]=h*Math.sin(2*Math.PI*s),i[1]=h*Math.cos(2*Math.PI*s),i[2]=p*Math.sin(2*Math.PI*c),i[3]=p*Math.cos(2*Math.PI*c),i},Ze.invert=function(i,n){var s=n[0],c=n[1],h=n[2],p=n[3],m=s*s+c*c+h*h+p*p,v=m?1/m:0;return i[0]=-s*v,i[1]=-c*v,i[2]=-h*v,i[3]=p*v,i},Ze.conjugate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=n[3],i},Ze.fromMat3=be,Ze.fromEuler=function(i,n,s,c){var h=.5*Math.PI/180;n*=h,s*=h,c*=h;var p=Math.sin(n),m=Math.cos(n),v=Math.sin(s),b=Math.cos(s),E=Math.sin(c),I=Math.cos(c);return i[0]=p*b*I-m*v*E,i[1]=m*v*I+p*b*E,i[2]=m*b*E-p*v*I,i[3]=m*b*I+p*v*E,i},Ze.str=function(i){return"quat("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},Ze.setAxes=Ze.sqlerp=Ze.rotationTo=Ze.equals=Ze.exactEquals=Ze.normalize=Ze.sqrLen=Ze.squaredLength=Ze.len=Ze.length=Ze.lerp=Ze.dot=Ze.scale=Ze.mul=Ze.add=Ze.set=Ze.copy=Ze.fromValues=Ze.clone=void 0;var Ur=ya(Pe),Ua=ya(pt),ti=ya(st),gi=ya(hn);function pl(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(pl=function(c){return c?s:n})(i)}function ya(i,n){if(i&&i.__esModule)return i;if(i===null||Ro(i)!=="object"&&typeof i!="function")return{default:i};var s=pl(n);if(s&&s.has(i))return s.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,s&&s.set(i,c),c}function lo(){var i=new Ur.ARRAY_TYPE(4);return Ur.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Ni(i,n,s){s*=.5;var c=Math.sin(s);return i[0]=c*n[0],i[1]=c*n[1],i[2]=c*n[2],i[3]=Math.cos(s),i}function ku(i,n,s){var c=n[0],h=n[1],p=n[2],m=n[3],v=s[0],b=s[1],E=s[2],I=s[3];return i[0]=c*I+m*v+h*E-p*b,i[1]=h*I+m*b+p*v-c*E,i[2]=p*I+m*E+c*b-h*v,i[3]=m*I-c*v-h*b-p*E,i}function Ve(i,n){var s=n[0],c=n[1],h=n[2],p=n[3],m=Math.sqrt(s*s+c*c+h*h),v=Math.exp(p),b=m>0?v*Math.sin(m)/m:0;return i[0]=s*b,i[1]=c*b,i[2]=h*b,i[3]=v*Math.cos(m),i}function ee(i,n){var s=n[0],c=n[1],h=n[2],p=n[3],m=Math.sqrt(s*s+c*c+h*h),v=m>0?Math.atan2(m,p)/m:0;return i[0]=s*v,i[1]=c*v,i[2]=h*v,i[3]=.5*Math.log(s*s+c*c+h*h+p*p),i}function oe(i,n,s,c){var h,p,m,v,b,E=n[0],I=n[1],P=n[2],M=n[3],z=s[0],F=s[1],V=s[2],j=s[3];return(p=E*z+I*F+P*V+M*j)<0&&(p=-p,z=-z,F=-F,V=-V,j=-j),1-p>Ur.EPSILON?(h=Math.acos(p),m=Math.sin(h),v=Math.sin((1-c)*h)/m,b=Math.sin(c*h)/m):(v=1-c,b=c),i[0]=v*E+b*z,i[1]=v*I+b*F,i[2]=v*P+b*V,i[3]=v*M+b*j,i}function be(i,n){var s,c=n[0]+n[4]+n[8];if(c>0)s=Math.sqrt(c+1),i[3]=.5*s,i[0]=(n[5]-n[7])*(s=.5/s),i[1]=(n[6]-n[2])*s,i[2]=(n[1]-n[3])*s;else{var h=0;n[4]>n[0]&&(h=1),n[8]>n[3*h+h]&&(h=2);var p=(h+1)%3,m=(h+2)%3;s=Math.sqrt(n[3*h+h]-n[3*p+p]-n[3*m+m]+1),i[h]=.5*s,i[3]=(n[3*p+m]-n[3*m+p])*(s=.5/s),i[p]=(n[3*p+h]+n[3*h+p])*s,i[m]=(n[3*m+h]+n[3*h+m])*s}return i}Ze.clone=gi.clone,Ze.fromValues=gi.fromValues,Ze.copy=gi.copy,Ze.set=gi.set,Ze.add=gi.add,Ze.mul=ku;var Le=gi.scale;Ze.scale=Le;var Oe=gi.dot;Ze.dot=Oe,Ze.lerp=gi.lerp;var qe=gi.length;Ze.length=qe,Ze.len=qe;var nt=gi.squaredLength;Ze.squaredLength=nt,Ze.sqrLen=nt;var Ge=gi.normalize;Ze.normalize=Ge,Ze.exactEquals=gi.exactEquals,Ze.equals=gi.equals;var et,_t,yt,Gt=(et=ti.create(),_t=ti.fromValues(1,0,0),yt=ti.fromValues(0,1,0),function(i,n,s){var c=ti.dot(n,s);return c<-.999999?(ti.cross(et,_t,n),ti.len(et)<1e-6&&ti.cross(et,yt,n),ti.normalize(et,et),Ni(i,et,Math.PI),i):c>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(ti.cross(et,n,s),i[0]=et[0],i[1]=et[1],i[2]=et[2],i[3]=1+c,Ge(i,i))});Ze.rotationTo=Gt;var fn,En,nr=(fn=lo(),En=lo(),function(i,n,s,c,h,p){return oe(fn,n,h,p),oe(En,s,c,p),oe(i,fn,En,2*p*(1-p)),i});Ze.sqlerp=nr;var Cn,rr=(Cn=Ua.create(),function(i,n,s,c){return Cn[0]=s[0],Cn[3]=s[1],Cn[6]=s[2],Cn[1]=c[0],Cn[4]=c[1],Cn[7]=c[2],Cn[2]=-n[0],Cn[5]=-n[1],Cn[8]=-n[2],Ge(i,be(i,Cn))});Ze.setAxes=rr;var on={};function Hr(i){return Hr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Hr(i)}Object.defineProperty(on,"__esModule",{value:!0}),on.create=function(){var i=new fr.ARRAY_TYPE(8);return fr.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0),i[3]=1,i},on.clone=function(i){var n=new fr.ARRAY_TYPE(8);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n},on.fromValues=function(i,n,s,c,h,p,m,v){var b=new fr.ARRAY_TYPE(8);return b[0]=i,b[1]=n,b[2]=s,b[3]=c,b[4]=h,b[5]=p,b[6]=m,b[7]=v,b},on.fromRotationTranslationValues=function(i,n,s,c,h,p,m){var v=new fr.ARRAY_TYPE(8);v[0]=i,v[1]=n,v[2]=s,v[3]=c;var b=.5*h,E=.5*p,I=.5*m;return v[4]=b*c+E*s-I*n,v[5]=E*c+I*i-b*s,v[6]=I*c+b*n-E*i,v[7]=-b*i-E*n-I*s,v},on.fromRotationTranslation=bs,on.fromTranslation=function(i,n){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=.5*n[0],i[5]=.5*n[1],i[6]=.5*n[2],i[7]=0,i},on.fromRotation=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},on.fromMat4=function(i,n){var s=ir.create();di.getRotation(s,n);var c=new fr.ARRAY_TYPE(3);return di.getTranslation(c,n),bs(i,s,c),i},on.copy=Fs,on.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},on.set=function(i,n,s,c,h,p,m,v,b){return i[0]=n,i[1]=s,i[2]=c,i[3]=h,i[4]=p,i[5]=m,i[6]=v,i[7]=b,i},on.getDual=function(i,n){return i[0]=n[4],i[1]=n[5],i[2]=n[6],i[3]=n[7],i},on.setDual=function(i,n){return i[4]=n[0],i[5]=n[1],i[6]=n[2],i[7]=n[3],i},on.getTranslation=function(i,n){var s=n[4],c=n[5],h=n[6],p=n[7],m=-n[0],v=-n[1],b=-n[2],E=n[3];return i[0]=2*(s*E+p*m+c*b-h*v),i[1]=2*(c*E+p*v+h*m-s*b),i[2]=2*(h*E+p*b+s*v-c*m),i},on.translate=function(i,n,s){var c=n[0],h=n[1],p=n[2],m=n[3],v=.5*s[0],b=.5*s[1],E=.5*s[2],I=n[4],P=n[5],M=n[6],z=n[7];return i[0]=c,i[1]=h,i[2]=p,i[3]=m,i[4]=m*v+h*E-p*b+I,i[5]=m*b+p*v-c*E+P,i[6]=m*E+c*b-h*v+M,i[7]=-c*v-h*b-p*E+z,i},on.rotateX=function(i,n,s){var c=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],b=n[5],E=n[6],I=n[7],P=v*m+I*c+b*p-E*h,M=b*m+I*h+E*c-v*p,z=E*m+I*p+v*h-b*c,F=I*m-v*c-b*h-E*p;return ir.rotateX(i,n,s),i[4]=P*(m=i[3])+F*(c=i[0])+M*(p=i[2])-z*(h=i[1]),i[5]=M*m+F*h+z*c-P*p,i[6]=z*m+F*p+P*h-M*c,i[7]=F*m-P*c-M*h-z*p,i},on.rotateY=function(i,n,s){var c=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],b=n[5],E=n[6],I=n[7],P=v*m+I*c+b*p-E*h,M=b*m+I*h+E*c-v*p,z=E*m+I*p+v*h-b*c,F=I*m-v*c-b*h-E*p;return ir.rotateY(i,n,s),i[4]=P*(m=i[3])+F*(c=i[0])+M*(p=i[2])-z*(h=i[1]),i[5]=M*m+F*h+z*c-P*p,i[6]=z*m+F*p+P*h-M*c,i[7]=F*m-P*c-M*h-z*p,i},on.rotateZ=function(i,n,s){var c=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],b=n[5],E=n[6],I=n[7],P=v*m+I*c+b*p-E*h,M=b*m+I*h+E*c-v*p,z=E*m+I*p+v*h-b*c,F=I*m-v*c-b*h-E*p;return ir.rotateZ(i,n,s),i[4]=P*(m=i[3])+F*(c=i[0])+M*(p=i[2])-z*(h=i[1]),i[5]=M*m+F*h+z*c-P*p,i[6]=z*m+F*p+P*h-M*c,i[7]=F*m-P*c-M*h-z*p,i},on.rotateByQuatAppend=function(i,n,s){var c=s[0],h=s[1],p=s[2],m=s[3],v=n[0],b=n[1],E=n[2],I=n[3];return i[0]=v*m+I*c+b*p-E*h,i[1]=b*m+I*h+E*c-v*p,i[2]=E*m+I*p+v*h-b*c,i[3]=I*m-v*c-b*h-E*p,i[4]=(v=n[4])*m+(I=n[7])*c+(b=n[5])*p-(E=n[6])*h,i[5]=b*m+I*h+E*c-v*p,i[6]=E*m+I*p+v*h-b*c,i[7]=I*m-v*c-b*h-E*p,i},on.rotateByQuatPrepend=function(i,n,s){var c=n[0],h=n[1],p=n[2],m=n[3],v=s[0],b=s[1],E=s[2],I=s[3];return i[0]=c*I+m*v+h*E-p*b,i[1]=h*I+m*b+p*v-c*E,i[2]=p*I+m*E+c*b-h*v,i[3]=m*I-c*v-h*b-p*E,i[4]=c*(I=s[7])+m*(v=s[4])+h*(E=s[6])-p*(b=s[5]),i[5]=h*I+m*b+p*v-c*E,i[6]=p*I+m*E+c*b-h*v,i[7]=m*I-c*v-h*b-p*E,i},on.rotateAroundAxis=function(i,n,s,c){if(Math.abs(c)<fr.EPSILON)return Fs(i,n);var h=Math.hypot(s[0],s[1],s[2]);c*=.5;var p=Math.sin(c),m=p*s[0]/h,v=p*s[1]/h,b=p*s[2]/h,E=Math.cos(c),I=n[0],P=n[1],M=n[2],z=n[3];i[0]=I*E+z*m+P*b-M*v,i[1]=P*E+z*v+M*m-I*b,i[2]=M*E+z*b+I*v-P*m,i[3]=z*E-I*m-P*v-M*b;var F=n[4],V=n[5],j=n[6],K=n[7];return i[4]=F*E+K*m+V*b-j*v,i[5]=V*E+K*v+j*m-F*b,i[6]=j*E+K*b+F*v-V*m,i[7]=K*E-F*m-V*v-j*b,i},on.add=function(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i[2]=n[2]+s[2],i[3]=n[3]+s[3],i[4]=n[4]+s[4],i[5]=n[5]+s[5],i[6]=n[6]+s[6],i[7]=n[7]+s[7],i},on.multiply=Gl,on.scale=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3]*s,i[4]=n[4]*s,i[5]=n[5]*s,i[6]=n[6]*s,i[7]=n[7]*s,i},on.lerp=function(i,n,s,c){var h=1-c;return jh(n,s)<0&&(c=-c),i[0]=n[0]*h+s[0]*c,i[1]=n[1]*h+s[1]*c,i[2]=n[2]*h+s[2]*c,i[3]=n[3]*h+s[3]*c,i[4]=n[4]*h+s[4]*c,i[5]=n[5]*h+s[5]*c,i[6]=n[6]*h+s[6]*c,i[7]=n[7]*h+s[7]*c,i},on.invert=function(i,n){var s=Du(n);return i[0]=-n[0]/s,i[1]=-n[1]/s,i[2]=-n[2]/s,i[3]=n[3]/s,i[4]=-n[4]/s,i[5]=-n[5]/s,i[6]=-n[6]/s,i[7]=n[7]/s,i},on.conjugate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=n[3],i[4]=-n[4],i[5]=-n[5],i[6]=-n[6],i[7]=n[7],i},on.normalize=function(i,n){var s=Du(n);if(s>0){s=Math.sqrt(s);var c=n[0]/s,h=n[1]/s,p=n[2]/s,m=n[3]/s,v=n[4],b=n[5],E=n[6],I=n[7],P=c*v+h*b+p*E+m*I;i[0]=c,i[1]=h,i[2]=p,i[3]=m,i[4]=(v-c*P)/s,i[5]=(b-h*P)/s,i[6]=(E-p*P)/s,i[7]=(I-m*P)/s}return i},on.str=function(i){return"quat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+")"},on.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]},on.equals=function(i,n){var s=i[0],c=i[1],h=i[2],p=i[3],m=i[4],v=i[5],b=i[6],E=i[7],I=n[0],P=n[1],M=n[2],z=n[3],F=n[4],V=n[5],j=n[6],K=n[7];return Math.abs(s-I)<=fr.EPSILON*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(c-P)<=fr.EPSILON*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(h-M)<=fr.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(p-z)<=fr.EPSILON*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(m-F)<=fr.EPSILON*Math.max(1,Math.abs(m),Math.abs(F))&&Math.abs(v-V)<=fr.EPSILON*Math.max(1,Math.abs(v),Math.abs(V))&&Math.abs(b-j)<=fr.EPSILON*Math.max(1,Math.abs(b),Math.abs(j))&&Math.abs(E-K)<=fr.EPSILON*Math.max(1,Math.abs(E),Math.abs(K))},on.sqrLen=on.squaredLength=on.len=on.length=on.dot=on.mul=on.setReal=on.getReal=void 0;var fr=ji(Pe),ir=ji(Ze),di=ji(St);function fi(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(fi=function(c){return c?s:n})(i)}function ji(i,n){if(i&&i.__esModule)return i;if(i===null||Hr(i)!=="object"&&typeof i!="function")return{default:i};var s=fi(n);if(s&&s.has(i))return s.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,s&&s.set(i,c),c}function bs(i,n,s){var c=.5*s[0],h=.5*s[1],p=.5*s[2],m=n[0],v=n[1],b=n[2],E=n[3];return i[0]=m,i[1]=v,i[2]=b,i[3]=E,i[4]=c*E+h*b-p*v,i[5]=h*E+p*m-c*b,i[6]=p*E+c*v-h*m,i[7]=-c*m-h*v-p*b,i}function Fs(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i}function Gl(i,n,s){var c=n[0],h=n[1],p=n[2],m=n[3],v=s[4],b=s[5],E=s[6],I=s[7],P=n[4],M=n[5],z=n[6],F=n[7],V=s[0],j=s[1],K=s[2],pe=s[3];return i[0]=c*pe+m*V+h*K-p*j,i[1]=h*pe+m*j+p*V-c*K,i[2]=p*pe+m*K+c*j-h*V,i[3]=m*pe-c*V-h*j-p*K,i[4]=c*I+m*v+h*E-p*b+P*pe+F*V+M*K-z*j,i[5]=h*I+m*b+p*v-c*E+M*pe+F*j+z*V-P*K,i[6]=p*I+m*E+c*b-h*v+z*pe+F*K+P*j-M*V,i[7]=m*I-c*v-h*b-p*E+F*pe-P*V-M*j-z*K,i}on.getReal=ir.copy,on.setReal=ir.copy,on.mul=Gl;var jh=ir.dot;on.dot=jh;var $h=ir.length;on.length=$h,on.len=$h;var Du=ir.squaredLength;on.squaredLength=Du,on.sqrLen=Du;var Mn={};function Mo(i){return Mo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Mo(i)}Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.create=Gh,Mn.clone=function(i){var n=new Ko.ARRAY_TYPE(2);return n[0]=i[0],n[1]=i[1],n},Mn.fromValues=function(i,n){var s=new Ko.ARRAY_TYPE(2);return s[0]=i,s[1]=n,s},Mn.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i},Mn.set=function(i,n,s){return i[0]=n,i[1]=s,i},Mn.add=function(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i},Mn.subtract=si,Mn.multiply=Mc,Mn.divide=ql,Mn.ceil=function(i,n){return i[0]=Math.ceil(n[0]),i[1]=Math.ceil(n[1]),i},Mn.floor=function(i,n){return i[0]=Math.floor(n[0]),i[1]=Math.floor(n[1]),i},Mn.min=function(i,n,s){return i[0]=Math.min(n[0],s[0]),i[1]=Math.min(n[1],s[1]),i},Mn.max=function(i,n,s){return i[0]=Math.max(n[0],s[0]),i[1]=Math.max(n[1],s[1]),i},Mn.round=function(i,n){return i[0]=Math.round(n[0]),i[1]=Math.round(n[1]),i},Mn.scale=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i},Mn.scaleAndAdd=function(i,n,s,c){return i[0]=n[0]+s[0]*c,i[1]=n[1]+s[1]*c,i},Mn.distance=Wl,Mn.squaredDistance=Cf,Mn.length=kc,Mn.squaredLength=Ou,Mn.negate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i},Mn.inverse=function(i,n){return i[0]=1/n[0],i[1]=1/n[1],i},Mn.normalize=function(i,n){var s=n[0],c=n[1],h=s*s+c*c;return h>0&&(h=1/Math.sqrt(h)),i[0]=n[0]*h,i[1]=n[1]*h,i},Mn.dot=function(i,n){return i[0]*n[0]+i[1]*n[1]},Mn.cross=function(i,n,s){var c=n[0]*s[1]-n[1]*s[0];return i[0]=i[1]=0,i[2]=c,i},Mn.lerp=function(i,n,s,c){var h=n[0],p=n[1];return i[0]=h+c*(s[0]-h),i[1]=p+c*(s[1]-p),i},Mn.random=function(i,n){n=n||1;var s=2*Ko.RANDOM()*Math.PI;return i[0]=Math.cos(s)*n,i[1]=Math.sin(s)*n,i},Mn.transformMat2=function(i,n,s){var c=n[0],h=n[1];return i[0]=s[0]*c+s[2]*h,i[1]=s[1]*c+s[3]*h,i},Mn.transformMat2d=function(i,n,s){var c=n[0],h=n[1];return i[0]=s[0]*c+s[2]*h+s[4],i[1]=s[1]*c+s[3]*h+s[5],i},Mn.transformMat3=function(i,n,s){var c=n[0],h=n[1];return i[0]=s[0]*c+s[3]*h+s[6],i[1]=s[1]*c+s[4]*h+s[7],i},Mn.transformMat4=function(i,n,s){var c=n[0],h=n[1];return i[0]=s[0]*c+s[4]*h+s[12],i[1]=s[1]*c+s[5]*h+s[13],i},Mn.rotate=function(i,n,s,c){var h=n[0]-s[0],p=n[1]-s[1],m=Math.sin(c),v=Math.cos(c);return i[0]=h*v-p*m+s[0],i[1]=h*m+p*v+s[1],i},Mn.angle=function(i,n){var s=i[0],c=i[1],h=n[0],p=n[1],m=Math.sqrt(s*s+c*c)*Math.sqrt(h*h+p*p);return Math.acos(Math.min(Math.max(m&&(s*h+c*p)/m,-1),1))},Mn.zero=function(i){return i[0]=0,i[1]=0,i},Mn.str=function(i){return"vec2("+i[0]+", "+i[1]+")"},Mn.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]},Mn.equals=function(i,n){var s=i[0],c=i[1],h=n[0],p=n[1];return Math.abs(s-h)<=Ko.EPSILON*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(c-p)<=Ko.EPSILON*Math.max(1,Math.abs(c),Math.abs(p))},Mn.forEach=Mn.sqrLen=Mn.sqrDist=Mn.dist=Mn.div=Mn.mul=Mn.sub=Mn.len=void 0;var Ko=function(i,n){if(i&&i.__esModule)return i;if(i===null||Mo(i)!=="object"&&typeof i!="function")return{default:i};var s=Rc(void 0);if(s&&s.has(i))return s.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,s&&s.set(i,c),c}(Pe);function Rc(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(Rc=function(c){return c?s:n})(i)}function Gh(){var i=new Ko.ARRAY_TYPE(2);return Ko.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0),i}function si(i,n,s){return i[0]=n[0]-s[0],i[1]=n[1]-s[1],i}function Mc(i,n,s){return i[0]=n[0]*s[0],i[1]=n[1]*s[1],i}function ql(i,n,s){return i[0]=n[0]/s[0],i[1]=n[1]/s[1],i}function Wl(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1])}function Cf(i,n){var s=n[0]-i[0],c=n[1]-i[1];return s*s+c*c}function kc(i){return Math.hypot(i[0],i[1])}function Ou(i){var n=i[0],s=i[1];return n*n+s*s}Mn.len=kc,Mn.sub=si,Mn.mul=Mc,Mn.div=ql,Mn.dist=Wl,Mn.sqrDist=Cf,Mn.sqrLen=Ou;var qh=function(){var i=Gh();return function(n,s,c,h,p,m){var v,b;for(s||(s=2),c||(c=0),b=h?Math.min(h*s+c,n.length):n.length,v=c;v<b;v+=s)i[0]=n[v],i[1]=n[v+1],p(i,i,m),n[v]=i[0],n[v+1]=i[1];return n}}();function Wh(i){return Wh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Wh(i)}Mn.forEach=qh,Object.defineProperty(Te,"__esModule",{value:!0}),a.aB=Te.vec4=a.$=Te.vec3=Te.vec2=Te.quat2=a.aw=Te.quat=a.ae=Te.mat4=a.bE=Te.mat3=Te.mat2d=a.aD=Te.mat2=Te.glMatrix=void 0;var xm=xo(Pe);Te.glMatrix=xm;var Dc=xo(_e);a.aD=Te.mat2=Dc;var vo=xo(bt);Te.mat2d=vo;var sr=xo(pt);a.bE=Te.mat3=sr;var bm=xo(St);a.ae=Te.mat4=bm;var wm=xo(Ze);a.aw=Te.quat=wm;var Oc=xo(on);Te.quat2=Oc;var Tm=xo(Mn);Te.vec2=Tm;var gy=xo(st);a.$=Te.vec3=gy;var Pf=xo(hn);function ko(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,s=new WeakMap;return(ko=function(c){return c?s:n})(i)}function xo(i,n){if(i&&i.__esModule)return i;if(i===null||Wh(i)!=="object"&&typeof i!="function")return{default:i};var s=ko(n);if(s&&s.has(i))return s.get(i);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(c,p,m):c[p]=i[p]}return c.default=i,s&&s.set(i,c),c}a.aB=Te.vec4=Pf;var Em=Lc;function Lc(i,n,s,c){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(c-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=n,this.p2x=s,this.p2y=c}Lc.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,n){if(n===void 0&&(n=1e-6),i<0)return 0;if(i>1)return 1;for(var s=i,c=0;c<8;c++){var h=this.sampleCurveX(s)-i;if(Math.abs(h)<n)return s;var p=this.sampleCurveDerivativeX(s);if(Math.abs(p)<1e-6)break;s-=h/p}var m=0,v=1;for(s=i,c=0;c<20&&(h=this.sampleCurveX(s),!(Math.abs(h-i)<n));c++)i>h?m=s:v=s,s=.5*(v-m)+m;return s},solve:function(i,n){return this.sampleCurveY(this.solveCurveX(i,n))}};var zc=fe(Em),Nc=Yo;function Yo(i,n){this.x=i,this.y=n}Yo.prototype={clone:function(){return new Yo(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,n){return this.clone()._rotateAround(i,n)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var n=i.x-this.x,s=i.y-this.y;return n*n+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,n){return Math.atan2(this.x*n-this.y*i,this.x*i+this.y*n)},_matMult:function(i){var n=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=n,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var n=Math.cos(i),s=Math.sin(i),c=s*this.x+n*this.y;return this.x=n*this.x-s*this.y,this.y=c,this},_rotateAround:function(i,n){var s=Math.cos(i),c=Math.sin(i),h=n.y+c*(this.x-n.x)+s*(this.y-n.y);return this.x=n.x+s*(this.x-n.x)-c*(this.y-n.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Yo.convert=function(i){return i instanceof Yo?i:Array.isArray(i)?new Yo(i[0],i[1]):i};var Nt=fe(Nc);function Hl(i,n){if(Array.isArray(i)){if(!Array.isArray(n)||i.length!==n.length)return!1;for(let s=0;s<i.length;s++)if(!Hl(i[s],n[s]))return!1;return!0}if(typeof i=="object"&&i!==null&&n!==null){if(typeof n!="object"||Object.keys(i).length!==Object.keys(n).length)return!1;for(const s in i)if(!Hl(i[s],n[s]))return!1;return!0}return i===n}const Hh=Math.PI/180,oi=180/Math.PI;function Qn(i){return i*Hh}function Xs(i){return i*oi}const Fc=[[0,0],[1,0],[1,1],[0,1]];function Lu(i){if(i<=0)return 0;if(i>=1)return 1;const n=i*i,s=n*i;return 4*(i<.5?s:3*(i-n)+s-.75)}function zu(i,n,s,c){const h=new zc(i,n,s,c);return function(p){return h.solve(p)}}const co=zu(.25,.1,.25,1);function Gn(i,n,s){return Math.min(s,Math.max(n,i))}function Qo(i,n,s){return(s=Gn((s-i)/(n-i),0,1))*s*(3-2*s)}function Zl(i,n,s){const c=s-n,h=((i-n)%c+c)%c+n;return h===n?s:h}function Nu(i,n,s){if(!i.length)return s(null,[]);let c=i.length;const h=new Array(i.length);let p=null;i.forEach((m,v)=>{n(m,(b,E)=>{b&&(p=b),h[v]=E,--c==0&&s(p,h)})})}function Xl(i){const n=[];for(const s in i)n.push(i[s]);return n}function ws(i,...n){for(const s of n)for(const c in s)i[c]=s[c];return i}let Zh=1;function Kl(){return Zh++}function Yl(){return function i(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function va(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Rf(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Fu(i,n){i.forEach(s=>{n[s]&&(n[s]=n[s].bind(n))})}function Va(i,n){return i.indexOf(n,i.length-n.length)!==-1}function Bc(i,n,s){const c={};for(const h in i)c[h]=n.call(this,i[h],h,i);return c}function Ts(i,n,s){const c={};for(const h in i)n.call(this,i[h],h,i)&&(c[h]=i[h]);return c}function Rs(i){return Array.isArray(i)?i.map(Rs):typeof i=="object"&&i?Bc(i,Rs):i}const cs={};function _i(i){cs[i]||(typeof console<"u"&&console.warn(i),cs[i]=!0)}function Jo(i,n,s){return(s.y-i.y)*(n.x-i.x)>(n.y-i.y)*(s.x-i.x)}function Sm(i){let n=0;for(let s,c,h=0,p=i.length,m=p-1;h<p;m=h++)s=i[h],c=i[m],n+=(c.x-s.x)*(s.y+c.y);return n}function Ql([i,n,s]){const c=Qn(n+90),h=Qn(s);return{x:i*Math.cos(c)*Math.sin(h),y:i*Math.sin(c)*Math.sin(h),z:i*Math.cos(h),azimuthal:n,polar:s}}function Do(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Uc(i){const n={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,h,p)=>{const m=h||p;return n[c]=!m||m.toLowerCase(),""}),n["max-age"]){const s=parseInt(n["max-age"],10);isNaN(s)?delete n["max-age"]:n["max-age"]=s}return n}let Xh,Vc,ja,ml,Ji,jc,$c=null;function $a(i){try{const n=self[i];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}}function R(i,n){return[i[4*n],i[4*n+1],i[4*n+2],i[4*n+3]]}function X(i,n,s,c){for(;n<s;){const h=n+s>>1;i[h]<c?n=h+1:s=h}return n}function le(i,n,s,c){for(;n<s;){const h=n+s>>1;i[h]<=c?n=h+1:s=h}return n}function ke(i){return i>0?1/(1.001-i):1+i}function ht(i){return i>0?1-1/(1.001-i):-i}function kt(){return Xh==null&&(Xh=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Xh}const Qt={now:()=>ml!==void 0?ml:performance.now(),setNow(i){ml=i},restoreNow(){ml=void 0},frame(i){const n=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(i,n=0){const{width:s,height:c}=i;Ji||(Ji=document.createElement("canvas"));const h=Ji.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(s>Ji.width||c>Ji.height)&&(Ji.width=s,Ji.height=c),h.clearRect(-n,-n,s+2*n,c+2*n),h.drawImage(i,0,0,s,c),h.getImageData(-n,-n,s+2*n,c+2*n)},resolveURL:i=>(Vc||(Vc=document.createElement("a")),Vc.href=i,Vc.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(ja==null&&(ja=window.matchMedia("(prefers-reduced-motion: reduce)")),ja.matches)},hasCanvasFingerprintNoise(){if(jc!==void 0)return jc;if(!kt())return jc=!1,!1;const i=new OffscreenCanvas(85,1),n=i.getContext("2d",{willReadFrequently:!0});let s=0;for(let h=0;h<i.width;++h)n.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,n.fillRect(h,0,1,1);const c=n.getImageData(0,0,i.width,i.height);s=0;for(let h=0;h<c.data.length;++h)if(h%4!=3&&s++!==c.data[h])return jc=!0,!0;return jc=!1,!1}};function ri(i,n){const s=i.indexOf("?");if(s<0)return`${i}?${new URLSearchParams(n).toString()}`;const c=new URLSearchParams(i.slice(s));for(const h in n)c.set(h,n[h]);return`${i.slice(0,s)}?${c.toString()}`}function us(i,n={persistentParams:[]}){const s=i.indexOf("?");if(s<0)return i;const c=new URLSearchParams,h=new URLSearchParams(i.slice(s));for(const m of n.persistentParams){const v=h.get(m);v&&c.set(m,v)}const p=c.toString();return`${i.slice(0,s)}${p.length>0?`?${p}`:""}`}const Vr="mapbox-tiles";let Es=500,Ss=50;const Jl=["language","worldview","jobid"];let es,ec;function Kh(){try{return caches}catch{}}function Mf(){const i=Kh();i&&!es&&(es=i.open(Vr))}let Im=1/0;const Am={supported:!1,testSupport:function(i){!Cm&&Yh&&(v1?_y(i):kf=i)}};let kf,Yh,Cm=!1,v1=!1;const x1=typeof self<"u"?self:{};function _y(i){const n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Yh),i.isContextLost())return;Am.supported=!0}catch{}i.deleteTexture(n),Cm=!0}x1.document&&(Yh=x1.document.createElement("img"),Yh.onload=function(){kf&&_y(kf),kf=null,v1=!0},Yh.onerror=function(){Cm=!0,kf=null},Yh.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Df={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Df);class Pm extends Error{constructor(n,s,c){s===401&&B(c)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const yy=Do()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,gl=function(i,n){if(!(/^file:/.test(s=i.url)||/^file:/.test(yy())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,h){const p=new AbortController,m=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:yy(),referrerPolicy:c.referrerPolicy,signal:p.signal});let v=!1,b=!1;const E=(I=m.url).indexOf("sku=")>0&&B(I);var I;c.type==="json"&&m.headers.set("Accept","application/json");const P=(z,F,V)=>{if(b)return;if(z&&z.message!=="SecurityError"&&_i(z.toString()),F&&V)return M(F);const j=Date.now();fetch(m).then(K=>{if(K.ok){const pe=E?K.clone():null;return M(K,pe,j)}return h(new Pm(K.statusText,K.status,c.url))}).catch(K=>{K.name!=="AbortError"&&h(new Error(`${K.message} ${c.url}`))})},M=(z,F,V)=>{(c.type==="arrayBuffer"?z.arrayBuffer():c.type==="json"?z.json():z.text()).then(j=>{b||(F&&V&&function(K,pe,de){if(Mf(),!es)return;const me=Uc(pe.headers.get("Cache-Control")||"");if(me["no-store"])return;const Ae={status:pe.status,statusText:pe.statusText,headers:new Headers};pe.headers.forEach(($e,Xe)=>Ae.headers.set(Xe,$e)),me["max-age"]&&Ae.headers.set("Expires",new Date(de+1e3*me["max-age"]).toUTCString());const Ce=Ae.headers.get("Expires");if(!Ce||new Date(Ce).getTime()-de<42e4)return;let ze=us(K.url,{persistentParams:Jl});if(pe.status===206){const $e=K.headers.get("Range");if(!$e)return;Ae.status=200,ze=ri(ze,{range:$e})}(function($e,Xe){if(ec===void 0)try{new Response(new ReadableStream),ec=!0}catch{ec=!1}ec?Xe($e.body):$e.blob().then(Xe)})(pe,$e=>{const Xe=new Response((tt=pe.status)!==200&&tt!==404&&[101,103,204,205,304].includes(tt)?null:$e,Ae);var tt;Mf(),es&&es.then(Ke=>Ke.put(ze,Xe)).catch(Ke=>_i(Ke.message))})}(m,F,V),v=!0,h(null,j,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(j=>{b||h(new Error(j.message))})};return E?function(z,F){if(Mf(),!es)return F(null);es.then(V=>{let j=us(z.url,{persistentParams:Jl});const K=z.headers.get("Range");K&&(j=ri(j,{range:K})),V.match(j).then(pe=>{const de=function(me){if(!me)return!1;const Ae=new Date(me.headers.get("Expires")||0),Ce=Uc(me.headers.get("Cache-Control")||"");return Ae>Date.now()&&!Ce["no-cache"]}(pe);V.delete(j),de&&V.put(j,pe.clone()),F(null,pe,de)}).catch(F)}).catch(F)}(m,P):P(null,null),{cancel:()=>{b=!0,v||p.abort()}}}(i,n);if(Do()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,n,void 0,!0)}var s;return function(c,h){const p=new XMLHttpRequest;p.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const m in c.headers)p.setRequestHeader(m,c.headers[m]);return c.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=c.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let m=p.response;if(c.type==="json")try{m=JSON.parse(p.response)}catch(v){return h(v)}h(null,m,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new Pm(p.statusText,p.status,c.url))},p.send(c.body),{cancel:()=>p.abort()}}(i,n)},Bu=function(i,n){return gl(ws(i,{type:"arrayBuffer"}),n)};function FI(i){const n=document.createElement("a");return n.href=i,n.protocol===location.protocol&&n.host===location.host}const b1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Of,Qh;Of=[],Qh=0;const Lf=function(i,n){if(Am.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Qh>=O.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:i,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return Of.push(p),p}Qh++;let s=!1;const c=()=>{if(!s)for(s=!0,Qh--;Of.length&&Qh<O.MAX_PARALLEL_IMAGE_REQUESTS;){const p=Of.shift(),{requestParameters:m,callback:v,cancelled:b}=p;b||(p.cancel=Lf(m,v).cancel)}},h=Bu(i,(p,m,v,b)=>{c(),p?n(p):m&&(self.createImageBitmap?function(E,I){const P=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(P).then(M=>{I(null,M)}).catch(M=>{I(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(E,I)=>n(E,I,v,b)):function(E,I){const P=new Image;P.onload=()=>{I(null,P),URL.revokeObjectURL(P.src),P.onload=null,requestAnimationFrame(()=>{P.src=b1})},P.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?URL.createObjectURL(M):b1}(m,(E,I)=>n(E,I,v,b)))});return{cancel:()=>{h.cancel(),c()}}},vy="01",xy="NO_ACCESS_TOKEN",BI=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function xa(i){const n=i.match(BI);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Uu(i){const n=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${n}`}const by="mapbox.eventData";function w1(i){if(!i)return null;const n=i.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(n[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Vu{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const s=w1(O.ACCESS_TOKEN);let c="";return c=s&&s.u?btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(h,p)=>String.fromCharCode(+("0x"+p)))):O.ACCESS_TOKEN||"",n?`${by}.${n}:${c}`:`${by}:${c}`}fetchEventData(){const n=$a("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(n)try{const h=localStorage.getItem(s);h&&(this.eventData=JSON.parse(h));const p=localStorage.getItem(c);p&&(this.anonId=p)}catch{_i("Unable to read from LocalStorage")}}saveEventData(){const n=$a("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid"),h=this.anonId;if(n&&h)try{localStorage.setItem(c,h),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{_i("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,s,c,h){if(!O.EVENTS_URL)return;const p=xa(O.EVENTS_URL);p.params.push(`access_token=${h||O.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(n).toISOString()},v=s?ws(m,s):m,b={url:Uu(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=function(E,I){return gl(ws(E,{method:"POST"}),I)}(b,E=>{this.pendingRequest=null,c(E),this.saveEventData(),this.processRequests(h)})}queueRequest(n,s){this.queue.push(n),this.processRequests(s)}}const T1=new class extends Vu{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,n){O.EVENTS_URL&&O.ACCESS_TOKEN&&Array.isArray(i)&&i.some(s=>H(s)||B(s))&&this.queueRequest(Date.now(),n)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=w1(O.ACCESS_TOKEN),s=n?n.u:O.ACCESS_TOKEN;let c=s!==this.eventData.tokenU;Rf(this.anonId)||(this.anonId=Yl(),c=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),m=new Date(h),v=(h-this.eventData.lastSuccess)/864e5;c=c||v>=1||v<-1||p.getDate()!==m.getDate()}else c=!0;c?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:A,skuId:vy,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=h,this.eventData.tokenU=s)},i):this.processRequests()}},wy=T1.postTurnstileEvent.bind(T1),Jh=new class extends Vu{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,n,s,c){this.skuToken=n,this.errorCb=c,O.EVENTS_URL&&(s||O.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},s):this.errorCb(new Error(xy)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:s}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),Rf(this.anonId)||(this.anonId=Yl()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:A,skuId:vy,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):n&&(this.success[n]=!0)},i))}remove(){this.errorCb=null}},E1=Jh.postMapLoadEvent.bind(Jh),zf=new class extends Vu{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(i){let n=this.mapInstanceIdMap.get(i);return n||(n=Yl(),this.mapInstanceIdMap.set(i,n)),n}getEventId(i){const n=this.eventIdPerMapInstanceMap.get(i)||0;return this.eventIdPerMapInstanceMap.set(i,n+1),n}postStyleLoadEvent(i,n){const{map:s,style:c,importedStyles:h}=n;if(!O.EVENTS_URL||!i&&!O.ACCESS_TOKEN)return;const p=this.getMapInstanceId(s),m={mapInstanceId:p,eventId:this.getEventId(p),style:c};h.length&&(m.importedStyles=h),this.queueRequest({timestamp:Date.now(),payload:m},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:s}=this.queue.shift();this.postEvent(n,s,()=>{},i)}},S1=zf.postStyleLoadEvent.bind(zf),I1=new class extends Vu{constructor(){super("gljs.performance")}postPerformanceEvent(i,n){O.EVENTS_URL&&(i||O.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:s}=this.queue.shift(),c=function(h){const p=performance.getEntriesByType("resource"),m=performance.getEntriesByType("mark"),v=function(z){const F={};if(z){for(const V in z)if(V!=="other")for(const j of z[V]){const K=`${V}ResolveRangeMin`,pe=`${V}ResolveRangeMax`,de=`${V}RequestCount`,me=`${V}RequestCachedCount`;F[K]=Math.min(F[K]||1/0,j.startTime),F[pe]=Math.max(F[pe]||-1/0,j.responseEnd);const Ae=Ce=>{F[Ce]===void 0&&(F[Ce]=0),++F[Ce]};j.transferSize!==void 0&&j.transferSize===0&&Ae(me),Ae(de)}}return F}(function(z,F){const V={};if(z)for(const j of z){const K=F(j);V[K]===void 0&&(V[K]=[]),V[K].push(j)}return V}(p,Z)),b=window.devicePixelRatio,E=navigator.connection||navigator.mozConnection||navigator.webkitConnection,I=E?E.effectiveType:void 0,P={counters:[],metadata:[],attributes:[]},M=(z,F,V)=>{V!=null&&z.push({name:F,value:V.toString()})};for(const z in v)M(P.counters,z,v[z]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(M(P.counters,"interactionRangeMin",h.interactionRange[0]),M(P.counters,"interactionRangeMax",h.interactionRange[1])),m)for(const z of Object.keys(G)){const F=G[z],V=m.find(j=>j.name===F);V&&M(P.counters,F,V.startTime)}return M(P.counters,"visibilityHidden",h.visibilityHidden),M(P.attributes,"style",function(z){if(z)for(const F of z){const V=F.name.split("?")[0];if(se(V)){const j=V.split("/").slice(-2);if(j.length===2)return`mapbox://styles/${j[0]}/${j[1]}`}}}(p)),M(P.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),M(P.attributes,"fogEnabled",h.fogEnabled?"true":"false"),M(P.attributes,"projection",h.projection),M(P.attributes,"zoom",h.zoom),M(P.metadata,"devicePixelRatio",b),M(P.metadata,"connectionEffectiveType",I),M(P.metadata,"navigatorUserAgent",navigator.userAgent),M(P.metadata,"screenWidth",window.screen.width),M(P.metadata,"screenHeight",window.screen.height),M(P.metadata,"windowWidth",window.innerWidth),M(P.metadata,"windowHeight",window.innerHeight),M(P.metadata,"mapWidth",h.width/b),M(P.metadata,"mapHeight",h.height/b),M(P.metadata,"webglRenderer",h.renderer),M(P.metadata,"webglVendor",h.vendor),M(P.metadata,"sdkVersion",A),M(P.metadata,"sdkIdentifier","mapbox-gl-js"),P}(s);for(const h of c.metadata);for(const h of c.counters);for(const h of c.attributes);this.postEvent(n,c,()=>{},i)}},UI=I1.postPerformanceEvent.bind(I1),Nf=new class extends Vu{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,n,s,c){if(!O.API_URL||!O.SESSION_PATH)return;const h=xa(O.API_URL+O.SESSION_PATH);h.params.push(`sku=${n||""}`),h.params.push(`access_token=${c||O.ACCESS_TOKEN||""}`);const p={url:Uu(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,v){return gl(ws(m,{method:"GET"}),v)}(p,m=>{this.pendingRequest=null,s(m),this.saveEventData(),this.processRequests(c)})}getSessionAPI(i,n,s,c){this.skuToken=n,this.errorCb=c,O.SESSION_PATH&&O.API_URL&&(s||O.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},s):this.errorCb(new Error(xy)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:s}=this.queue.shift();n&&this.success[n]||this.getSession(s,this.skuToken,c=>{c?this.errorCb(c):n&&(this.success[n]=!0)},i)}remove(){this.errorCb=null}},Ty=Nf.getSessionAPI.bind(Nf),Ff=new Set;var ju={exports:{}},ed={exports:function(i,n){var s,c,h,p,m,v,b,E;for(c=i.length-(s=3&i.length),h=n,m=3432918353,v=461845907,E=0;E<c;)b=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,h=27492+(65535&(p=5*(65535&(h=(h^=b=(65535&(b=(b=(65535&b)*m+(((b>>>16)*m&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(b=0,s){case 3:b^=(255&i.charCodeAt(E+2))<<16;case 2:b^=(255&i.charCodeAt(E+1))<<8;case 1:h^=b=(65535&(b=(b=(65535&(b^=255&i.charCodeAt(E)))*m+(((b>>>16)*m&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}},VI={exports:function(i,n){for(var s,c=i.length,h=n^c,p=0;c>=4;)s=1540483477*(65535&(s=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(s>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++p;switch(c){case 3:h^=(255&i.charCodeAt(p+2))<<16;case 2:h^=(255&i.charCodeAt(p+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(p)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}},A1=ed.exports,jI=VI.exports;ju.exports=A1,ju.exports.murmur3=A1,ju.exports.murmur2=jI;var Rm=fe(ju.exports);class _l{constructor(n,...s){ws(this,s[0]||{}),this.type=n}}class Bf extends _l{constructor(n,s={}){super("error",ws({error:n},s))}}function Mm(i,n,s){s[i]&&s[i].indexOf(n)!==-1||(s[i]=s[i]||[],s[i].push(n))}function Ey(i,n,s){if(s&&s[i]){const c=s[i].indexOf(n);c!==-1&&s[i].splice(c,1)}}class $u{on(n,s){return this._listeners=this._listeners||{},Mm(n,s,this._listeners),this}off(n,s){return Ey(n,s,this._listeners),Ey(n,s,this._oneTimeListeners),this}once(n,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Mm(n,s,this._oneTimeListeners),this):new Promise(c=>this.once(n,c))}fire(n,s){const c=typeof n=="string"?new _l(n,s):n,h=c.type;if(this.listens(h)){c.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const b of p)b.call(this,c);const m=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const b of m)Ey(h,b,this._oneTimeListeners),b.call(this,c);const v=this._eventedParent;v&&(ws(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(c))}else c instanceof Bf&&console.error(c.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,s){return this._eventedParent=n,this._eventedParentData=s,this}}a.G=void 0;var C1={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function km(i){return(i=Math.round(i))<0?0:i>255?255:i}function Sy(i){return km(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function Dm(i){return(n=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:n>1?1:n;var n}function Iy(i,n,s){return s<0?s+=1:s>1&&(s-=1),6*s<1?i+(n-i)*s*6:2*s<1?n:3*s<2?i+(n-i)*(2/3-s)*6:i}try{a.G={}.parseCSSColor=function(i){var n,s=i.replace(/ /g,"").toLowerCase();if(s in C1)return C1[s].slice();if(s[0]==="#")return s.length===4?(n=parseInt(s.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:s.length===7&&(n=parseInt(s.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var c=s.indexOf("("),h=s.indexOf(")");if(c!==-1&&h+1===s.length){var p=s.substr(0,c),m=s.substr(c+1,h-(c+1)).split(","),v=1;switch(p){case"rgba":if(m.length!==4)return null;v=Dm(m.pop());case"rgb":return m.length!==3?null:[Sy(m[0]),Sy(m[1]),Sy(m[2]),v];case"hsla":if(m.length!==4)return null;v=Dm(m.pop());case"hsl":if(m.length!==3)return null;var b=(parseFloat(m[0])%360+360)%360/360,E=Dm(m[1]),I=Dm(m[2]),P=I<=.5?I*(E+1):I+E-I*E,M=2*I-P;return[km(255*Iy(M,P,b+1/3)),km(255*Iy(M,P,b)),km(255*Iy(M,P,b-1/3)),v];default:return null}}return null}}catch{}class wr{constructor(n,s,c,h=1){this.r=n,this.g=s,this.b=c,this.a=h}static parse(n){if(!n)return;if(n instanceof wr)return n;if(typeof n!="string")return;const s=a.G(n);return s?new wr(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[n,s,c,h]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(n)},${Math.round(s)},${Math.round(c)},${h})`}toRenderColor(n){const{r:s,g:c,b:h,a:p}=this;return new $I(n,s,c,h,p)}}class $I{constructor(n,s,c,h,p){if(n){const m=n.image.height,v=m*m;s=p===0?0:s/p*(m-1),c=p===0?0:c/p*(m-1),h=p===0?0:h/p*(m-1);const b=Math.floor(s),E=Math.floor(c),I=Math.floor(h),P=Math.ceil(s),M=Math.ceil(c),z=Math.ceil(h),F=s-b,V=c-E,j=h-I,K=n.image.data,pe=4*(b+E*v+I*m),de=4*(b+E*v+z*m),me=4*(b+M*v+I*m),Ae=4*(b+M*v+z*m),Ce=4*(P+E*v+I*m),ze=4*(P+E*v+z*m),$e=4*(P+M*v+I*m),Xe=4*(P+M*v+z*m);if(pe<0||Xe>=K.length)throw new Error("out of range");this.r=wn(wn(wn(K[pe],K[de],j),wn(K[me],K[Ae],j),V),wn(wn(K[Ce],K[ze],j),wn(K[$e],K[Xe],j),V),F)/255*p,this.g=wn(wn(wn(K[pe+1],K[de+1],j),wn(K[me+1],K[Ae+1],j),V),wn(wn(K[Ce+1],K[ze+1],j),wn(K[$e+1],K[Xe+1],j),V),F)/255*p,this.b=wn(wn(wn(K[pe+2],K[de+2],j),wn(K[me+2],K[Ae+2],j),V),wn(wn(K[Ce+2],K[ze+2],j),wn(K[$e+2],K[Xe+2],j),V),F)/255*p,this.a=p}else this.r=s,this.g=c,this.b=h,this.a=p}toArray(){const{r:n,g:s,b:c,a:h}=this;return h===0?[0,0,0,0]:[255*n/h,255*s/h,255*c/h,h]}toArray01(){const{r:n,g:s,b:c,a:h}=this;return h===0?[0,0,0,0]:[n/h,s/h,c/h,h]}toArray01Scaled(n){const{r:s,g:c,b:h,a:p}=this;return p===0?[0,0,0]:[s/p*n,c/p*n,h/p*n]}toArray01PremultipliedAlpha(){const{r:n,g:s,b:c,a:h}=this;return[n,s,c,h]}toArray01Linear(){const{r:n,g:s,b:c,a:h}=this;return h===0?[0,0,0,0]:[Math.pow(n/h,2.2),Math.pow(s/h,2.2),Math.pow(c/h,2.2),h]}}function wn(i,n,s){return i*(1-s)+n*s}function Ay(i,n,s){return i.map((c,h)=>wn(c,n[h],s))}wr.black=new wr(0,0,0,1),wr.white=new wr(1,1,1,1),wr.transparent=new wr(0,0,0,0),wr.red=new wr(1,0,0,1),wr.blue=new wr(0,0,1,1);var Uf=Object.freeze({__proto__:null,array:Ay,color:function(i,n,s){return new wr(wn(i.r,n.r,s),wn(i.g,n.g,s),wn(i.b,n.b,s),wn(i.a,n.a,s))},number:wn});function td(i,...n){for(const s of n)for(const c in s)i[c]=s[c];return i}class yl extends Error{constructor(n,s){super(s),this.message=s,this.key=n}}class Cy{constructor(n,s=[]){this.parent=n,this.bindings={};for(const[c,h]of s)this.bindings[c]=h}concat(n){return new Cy(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const ea={kind:"null"},Yt={kind:"number"},pr={kind:"string"},Ir={kind:"boolean"},ba={kind:"color"},nd={kind:"object"},_r={kind:"value"},Om={kind:"collator"},rd={kind:"formatted"},Gu={kind:"resolvedImage"};function Ks(i,n){return{kind:"array",itemType:i,N:n}}function Ci(i){if(i.kind==="array"){const n=Ci(i.itemType);return typeof i.N=="number"?`array<${n}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${n}>`}return i.kind}const Py=[ea,Yt,pr,Ir,ba,rd,nd,Ks(_r),Gu];function Vf(i,n){if(n.kind==="error")return null;if(i.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!Vf(i.itemType,n.itemType))&&(typeof i.N!="number"||i.N===n.N))return null}else{if(i.kind===n.kind)return null;if(i.kind==="value"){for(const s of Py)if(!Vf(s,n))return null}}return`Expected ${Ci(i)} but found ${Ci(n)} instead.`}function wa(i,n){return n.some(s=>s.kind===i.kind)}function jf(i,n){return n.some(s=>s==="null"?i===null:s==="array"?Array.isArray(i):s==="object"?i&&!Array.isArray(i)&&typeof i=="object":s===typeof i)}class Lm{constructor(n,s,c){this.sensitivity=n?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,s){return this.collator.compare(n,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class zm{constructor(n,s,c,h,p){this.text=n.normalize?n.normalize():n,this.image=s,this.scale=c,this.fontStack=h,this.textColor=p}}class uo{constructor(n){this.sections=n}static fromString(n){return new uo([new zm(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.namePrimary.length!==0)}static factory(n){return n instanceof uo?n:uo.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const s of this.sections){if(s.image){n.push(["image",s.image.namePrimary]);continue}n.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toRenderColor(null).toArray())),n.push(c)}return n}}class ta{constructor(n){this.namePrimary=n.namePrimary,n.nameSecondary&&(this.nameSecondary=n.nameSecondary),this.available=n.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(n,s){return n?new ta({namePrimary:n,nameSecondary:s,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function P1(i,n,s,c){return typeof i=="number"&&i>=0&&i<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof s=="number"&&s>=0&&s<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[i,n,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[i,n,s,c]:[i,n,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function id(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof wr||i instanceof Lm||i instanceof uo||i instanceof ta)return!0;if(Array.isArray(i)){for(const n of i)if(!id(n))return!1;return!0}if(typeof i=="object"){for(const n in i)if(!id(i[n]))return!1;return!0}return!1}function ts(i){if(i===null)return ea;if(typeof i=="string")return pr;if(typeof i=="boolean")return Ir;if(typeof i=="number")return Yt;if(i instanceof wr)return ba;if(i instanceof Lm)return Om;if(i instanceof uo)return rd;if(i instanceof ta)return Gu;if(Array.isArray(i)){const n=i.length;let s;for(const c of i){const h=ts(c);if(s){if(s===h)continue;s=_r;break}s=h}return Ks(s||_r,n)}return nd}function Ga(i){const n=typeof i;return i===null?"":n==="string"||n==="number"||n==="boolean"?String(i):i instanceof wr||i instanceof uo||i instanceof ta?i.toString():JSON.stringify(i)}class qa{constructor(n,s){this.type=n,this.value=s}static parse(n,s){if(n.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!id(n[1]))return s.error("invalid value");const c=n[1];let h=ts(c);const p=s.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new qa(h,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof wr?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof uo?this.value.serialize():this.value}}class hs{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const Ry={string:pr,number:Yt,boolean:Ir,object:nd};class na{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");let c,h=1;const p=n[0];if(p==="array"){let v,b;if(n.length>2){const E=n[1];if(typeof E!="string"||!(E in Ry)||E==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);v=Ry[E],h++}else v=_r;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return s.error('The length argument to "array" must be a positive integer literal',2);b=n[2],h++}c=Ks(v,b)}else c=Ry[p];const m=[];for(;h<n.length;h++){const v=s.parse(n[h],h,_r);if(!v)return null;m.push(v)}return new na(c,m)}evaluate(n){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(n);if(!Vf(this.type,ts(c)))return c;if(s===this.args.length-1)throw new hs(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${Ci(ts(c))} but was expected to be of type ${Ci(this.type)}.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,s=[n.kind];if(n.kind==="array"){const c=n.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);const h=n.N;(typeof h=="number"||this.args.length>1)&&s.push(h)}}return s.concat(this.args.map(c=>c.serialize()))}}class qu{constructor(n){this.type=rd,this.sections=n}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const c=n[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");const h=[];let p=!1;for(let m=1;m<=n.length-1;++m){const v=n[m];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let b=null;if(v["font-scale"]&&(b=s.parse(v["font-scale"],1,Yt),!b))return null;let E=null;if(v["text-font"]&&(E=s.parse(v["text-font"],1,Ks(pr)),!E))return null;let I=null;if(v["text-color"]&&(I=s.parse(v["text-color"],1,ba),!I))return null;const P=h[h.length-1];P.scale=b,P.font=E,P.textColor=I}else{const b=s.parse(n[m],1,_r);if(!b)return null;const E=b.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new qu(h)}evaluate(n){return new uo(this.sections.map(s=>{const c=s.content.evaluate(n);return ts(c)===Gu?new zm("",c,null,null,null):new zm(Ga(c),null,s.scale?s.scale.evaluate(n):null,s.font?s.font.evaluate(n).join(","):null,s.textColor?s.textColor.evaluate(n):null)}))}eachChild(n){for(const s of this.sections)n(s.content),s.scale&&n(s.scale),s.font&&n(s.font),s.textColor&&n(s.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const s of this.sections){n.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),n.push(c)}return n}}class tc{constructor(n,s){this.type=Gu,this.inputPrimary=n,this.inputSecondary=s}static parse(n,s){if(n.length<2)return s.error("Expected two or more arguments.");const c=s.parse(n[1],1,pr);if(!c)return s.error("No image name provided.");if(n.length===2)return new tc(c);const h=s.parse(n[2],1,pr);return h?new tc(c,h):s.error("Secondary image variant is not a string.")}evaluate(n){const s=ta.fromString(this.inputPrimary.evaluate(n),this.inputSecondary?this.inputSecondary.evaluate(n):void 0);return s&&n.availableImages&&(s.available=n.availableImages.indexOf(s.namePrimary)>-1,s.nameSecondary&&s.available&&n.availableImages&&(s.available=n.availableImages.indexOf(s.nameSecondary)>-1)),s}eachChild(n){n(this.inputPrimary),this.inputSecondary&&n(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Gc(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}const GI={"to-boolean":Ir,"to-color":ba,"to-number":Yt,"to-string":pr};class nc{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const c=n[0],h=[];let p=ea;if(c==="to-array"){if(!Array.isArray(n[1]))return null;const m=n[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);p=Ks(s.expectedType.itemType,m)}else{if(!(m>0&&id(n[1][0])))return null;p=Ks(ts(n[1][0]),m)}for(let v=0;v<m;v++){const b=n[1][v];let E;if(Gc(b)==="array")E=s.parse(b,void 0,p.itemType);else{const I=Gc(b);if(I!==p.itemType.kind)return s.error(`Expected ${p.itemType.kind} but found ${I}.`);E=s.registry.literal.parse(["literal",b===void 0?null:b],s)}if(!E)return null;h.push(E)}}else{if((c==="to-boolean"||c==="to-string")&&n.length!==2)return s.error("Expected one argument.");p=GI[c];for(let m=1;m<n.length;m++){const v=s.parse(n[m],m,_r);if(!v)return null;h.push(v)}}return new nc(p,h)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let s,c;for(const h of this.args){if(s=h.evaluate(n),c=null,s instanceof wr)return s;if(typeof s=="string"){const p=n.parseColor(s);if(p)return p}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:P1(s[0],s[1],s[2],s[3]),!c))return new wr(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new hs(c||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const c of this.args){if(s=c.evaluate(n),s===null)return 0;const h=Number(s);if(!isNaN(h))return h}throw new hs(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?uo.fromString(Ga(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?ta.fromString(Ga(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map(s=>s.evaluate(n)):Ga(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new qu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new tc(this.args[0]).serialize();const n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{n.push(s.serialize())}),n}}const qI=["Unknown","Point","LineString","Polygon"];class My{constructor(n,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?qI[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:c,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*s-n[0])+this.featureDistanceData.bearing[1]*(h*s-n[1])}return 0}parseColor(n){let s=this._parseColorCache[n];return s||(s=this._parseColorCache[n]=wr.parse(n)),s}getConfig(n){return this.options?this.options.get(n):null}}class Oo{constructor(n,s,c,h,p){this.name=n,this.type=s,this._evaluate=c,this.args=h,this._overloadIndex=p}evaluate(n){if(!this._evaluate){const s=Oo.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,s){const c=n[0],h=Oo.definitions[c];if(!h)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,m=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=[];let b=null,E=-1;for(const[I,P]of m){if(Array.isArray(I)&&I.length!==n.length-1)continue;v.push(I),E++,b=new W1(s.registry,s.path,null,s.scope,void 0,s._scope,s.options);const M=[];let z=!1;for(let F=1;F<n.length;F++){const V=n[F],j=Array.isArray(I)?I[F-1]:I.type,K=b.parse(V,1+M.length,j);if(!K){z=!0;break}M.push(K)}if(!z)if(Array.isArray(I)&&I.length!==M.length)b.error(`Expected ${I.length} arguments, but found ${M.length} instead.`);else{for(let F=0;F<M.length;F++){const V=Array.isArray(I)?I[F]:I.type,j=M[F];b.concat(F+1).checkSubtype(V,j.type)}if(b.errors.length===0)return new Oo(c,p,P,M,E)}}if(v.length===1)s.errors.push(...b.errors);else{const I=(v.length?v:m.map(([M])=>M)).map(WI).join(" | "),P=[];for(let M=1;M<n.length;M++){const z=s.parse(n[M],1+P.length);if(!z)return null;P.push(Ci(z.type))}s.error(`Expected arguments of type ${I}, but found (${P.join(", ")}) instead.`)}return null}static register(n,s){Oo.definitions=s;for(const c in s)n[c]=Oo}}function WI(i){return Array.isArray(i)?`(${i.map(Ci).join(", ")})`:`(${Ci(i.type)}...)`}class $f{constructor(n,s,c){this.type=Om,this.locale=c,this.caseSensitive=n,this.diacriticSensitive=s}static parse(n,s){if(n.length!==2)return s.error("Expected one argument.");const c=n[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");const h=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Ir);if(!h)return null;const p=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Ir);if(!p)return null;let m=null;return c.locale&&(m=s.parse(c.locale,1,pr),!m)?null:new $f(h,p,m)}evaluate(n){return new Lm(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}function Tr(i,n,s=0,c=i.length-1,h=R1){for(;c>s;){if(c-s>600){const b=c-s+1,E=n-s+1,I=Math.log(b),P=.5*Math.exp(2*I/3),M=.5*Math.sqrt(I*P*(b-P)/b)*(E-b/2<0?-1:1);Tr(i,n,Math.max(s,Math.floor(n-E*P/b+M)),Math.min(c,Math.floor(n+(b-E)*P/b+M)),h)}const p=i[n];let m=s,v=c;for(sd(i,s,n),h(i[c],p)>0&&sd(i,s,c);m<v;){for(sd(i,m,v),m++,v--;h(i[m],p)<0;)m++;for(;h(i[v],p)>0;)v--}h(i[s],p)===0?sd(i,s,v):(v++,sd(i,v,c)),v<=n&&(s=v+1),n<=v&&(c=v-1)}}function sd(i,n,s){const c=i[n];i[n]=i[s],i[s]=c}function R1(i,n){return i<n?-1:i>n?1:0}function HI(i){let n=0;for(let s,c,h=0,p=i.length,m=p-1;h<p;m=h++)s=i[h],c=i[m],n+=(c.x-s.x)*(s.y+c.y);return n}function Gf(i,n){i[0]=Math.min(i[0],n[0]),i[1]=Math.min(i[1],n[1]),i[2]=Math.max(i[2],n[0]),i[3]=Math.max(i[3],n[1])}function qc(i,n){return!(i[0]<=n[0]||i[2]>=n[2]||i[1]<=n[1]||i[3]>=n[3])}function Nm(i,n,s){const c=i[0]-n[0],h=i[1]-n[1],p=i[0]-s[0],m=i[1]-s[1];return c*m-p*h==0&&c*p<=0&&h*m<=0}function rc(i,n,s=!1){let c=!1;for(let v=0,b=n.length;v<b;v++){const E=n[v];for(let I=0,P=E.length,M=P-1;I<P;M=I++){const z=E[M],F=E[I];if(Nm(i,z,F))return s;(p=z)[1]>(h=i)[1]!=(m=F)[1]>h[1]&&h[0]<(m[0]-p[0])*(h[1]-p[1])/(m[1]-p[1])+p[0]&&(c=!c)}}var h,p,m;return c}function M1(i,n,s,c){const h=c[0]-s[0],p=c[1]-s[1],m=(i[0]-s[0])*p-h*(i[1]-s[1]),v=(n[0]-s[0])*p-h*(n[1]-s[1]);return m>0&&v<0||m<0&&v>0}function qf(i,n,s,c){return(h=[c[0]-s[0],c[1]-s[1]])[0]*(p=[n[0]-i[0],n[1]-i[1]])[1]-h[1]*p[0]!=0&&!(!M1(i,n,s,c)||!M1(s,c,i,n));var h,p}const Ys=8192;function ZI(i,n){const s=(180+i[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,n.z);return[Math.round(s*h*Ys),Math.round(c*h*Ys)]}function k1(i,n){for(let s=0;s<n.length;s++)if(rc(i,n[s]))return!0;return!1}function Wf(i,n,s){for(const c of s)for(let h=0,p=c.length,m=p-1;h<p;m=h++)if(qf(i,n,c[m],c[h]))return!0;return!1}function Fm(i,n){for(let s=0;s<i.length;++s)if(!rc(i[s],n))return!1;for(let s=0;s<i.length-1;++s)if(Wf(i[s],i[s+1],n))return!1;return!0}function XI(i,n){for(let s=0;s<n.length;s++)if(Fm(i,n[s]))return!0;return!1}function ky(i,n,s){const c=[];for(let h=0;h<i.length;h++){const p=[];for(let m=0;m<i[h].length;m++){const v=ZI(i[h][m],s);Gf(n,v),p.push(v)}c.push(p)}return c}function D1(i,n,s){const c=[];for(let h=0;h<i.length;h++){const p=ky(i[h],n,s);c.push(p)}return c}function Dy(i,n,s,c){if(i[0]<s[0]||i[0]>s[2]){const h=.5*c;let p=i[0]-s[0]>h?-c:s[0]-i[0]>h?c:0;p===0&&(p=i[0]-s[2]>h?-c:s[2]-i[0]>h?c:0),i[0]+=p}Gf(n,i)}function Bm(i,n,s,c){const h=Math.pow(2,c.z)*Ys,p=[c.x*Ys,c.y*Ys],m=[];if(!i)return m;for(const v of i)for(const b of v){const E=[b.x+p[0],b.y+p[1]];Dy(E,n,s,h),m.push(E)}return m}function O1(i,n,s,c){const h=Math.pow(2,c.z)*Ys,p=[c.x*Ys,c.y*Ys],m=[];if(!i)return m;for(const b of i){const E=[];for(const I of b){const P=[I.x+p[0],I.y+p[1]];Gf(n,P),E.push(P)}m.push(E)}if(n[2]-n[0]<=h/2){(v=n)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const b of m)for(const E of b)Dy(E,n,s,h)}var v;return m}class vl{constructor(n,s){this.type=Ir,this.geojson=n,this.geometries=s}static parse(n,s){if(n.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(id(n[1])){const c=n[1];if(c.type==="FeatureCollection")for(let h=0;h<c.features.length;++h){const p=c.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new vl(c,c.features[h].geometry)}else if(c.type==="Feature"){const h=c.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new vl(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new vl(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(s,c){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=s.canonicalID();if(!m)return!1;if(c.type==="Polygon"){const v=ky(c.coordinates,p,m),b=Bm(s.geometry(),h,p,m);if(!qc(h,p))return!1;for(const E of b)if(!rc(E,v))return!1}if(c.type==="MultiPolygon"){const v=D1(c.coordinates,p,m),b=Bm(s.geometry(),h,p,m);if(!qc(h,p))return!1;for(const E of b)if(!k1(E,v))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(s,c){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=s.canonicalID();if(!m)return!1;if(c.type==="Polygon"){const v=ky(c.coordinates,p,m),b=O1(s.geometry(),h,p,m);if(!qc(h,p))return!1;for(const E of b)if(!Fm(E,v))return!1}if(c.type==="MultiPolygon"){const v=D1(c.coordinates,p,m),b=O1(s.geometry(),h,p,m);if(!qc(h,p))return!1;for(const E of b)if(!XI(E,v))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Um={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},L1=1/298.257223563,z1=L1*(2-L1),Hf=Math.PI/180;class Zf{static fromTile(n,s,c){const h=Math.PI*(1-2*(n+.5)/Math.pow(2,s)),p=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/Hf;return new Zf(p,c)}static get units(){return Um}constructor(n,s){if(n===void 0)throw new Error("No latitude given.");if(s&&!Um[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(Um).join(", ")}`);const c=6378.137*Hf*(s?Um[s]:1),h=Math.cos(n*Hf),p=1/(1-z1*(1-h*h)),m=Math.sqrt(p);this.kx=c*m*h,this.ky=c*m*p*(1-z1)}distance(n,s){const c=ra(n[0]-s[0])*this.kx,h=(n[1]-s[1])*this.ky;return Math.sqrt(c*c+h*h)}bearing(n,s){const c=ra(s[0]-n[0])*this.kx;return Math.atan2(c,(s[1]-n[1])*this.ky)/Hf}destination(n,s,c){const h=c*Hf;return this.offset(n,Math.sin(h)*s,Math.cos(h)*s)}offset(n,s,c){return[n[0]+s/this.kx,n[1]+c/this.ky]}lineDistance(n){let s=0;for(let c=0;c<n.length-1;c++)s+=this.distance(n[c],n[c+1]);return s}area(n){let s=0;for(let c=0;c<n.length;c++){const h=n[c];for(let p=0,m=h.length,v=m-1;p<m;v=p++)s+=ra(h[p][0]-h[v][0])*(h[p][1]+h[v][1])*(c?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(n,s){let c=0;if(s<=0)return n[0];for(let h=0;h<n.length-1;h++){const p=n[h],m=n[h+1],v=this.distance(p,m);if(c+=v,c>s)return Oy(p,m,(s-(c-v))/v)}return n[n.length-1]}pointToSegmentDistance(n,s,c){let[h,p]=s,m=ra(c[0]-h)*this.kx,v=(c[1]-p)*this.ky;if(m!==0||v!==0){const b=(ra(n[0]-h)*this.kx*m+(n[1]-p)*this.ky*v)/(m*m+v*v);b>1?(h=c[0],p=c[1]):b>0&&(h+=m/this.kx*b,p+=v/this.ky*b)}return m=ra(n[0]-h)*this.kx,v=(n[1]-p)*this.ky,Math.sqrt(m*m+v*v)}pointOnLine(n,s){let c=1/0,h=n[0][0],p=n[0][1],m=0,v=0;for(let b=0;b<n.length-1;b++){let E=n[b][0],I=n[b][1],P=ra(n[b+1][0]-E)*this.kx,M=(n[b+1][1]-I)*this.ky,z=0;P===0&&M===0||(z=(ra(s[0]-E)*this.kx*P+(s[1]-I)*this.ky*M)/(P*P+M*M),z>1?(E=n[b+1][0],I=n[b+1][1]):z>0&&(E+=P/this.kx*z,I+=M/this.ky*z)),P=ra(s[0]-E)*this.kx,M=(s[1]-I)*this.ky;const F=P*P+M*M;F<c&&(c=F,h=E,p=I,m=b,v=z)}return{point:[h,p],index:m,t:Math.max(0,Math.min(1,v))}}lineSlice(n,s,c){let h=this.pointOnLine(c,n),p=this.pointOnLine(c,s);if(h.index>p.index||h.index===p.index&&h.t>p.t){const E=h;h=p,p=E}const m=[h.point],v=h.index+1,b=p.index;!N1(c[v],m[0])&&v<=b&&m.push(c[v]);for(let E=v+1;E<=b;E++)m.push(c[E]);return N1(c[b],p.point)||m.push(p.point),m}lineSliceAlong(n,s,c){let h=0;const p=[];for(let m=0;m<c.length-1;m++){const v=c[m],b=c[m+1],E=this.distance(v,b);if(h+=E,h>n&&p.length===0&&p.push(Oy(v,b,(n-(h-E))/E)),h>=s)return p.push(Oy(v,b,(s-(h-E))/E)),p;h>n&&p.push(b)}return p}bufferPoint(n,s){const c=s/this.ky,h=s/this.kx;return[n[0]-h,n[1]-c,n[0]+h,n[1]+c]}bufferBBox(n,s){const c=s/this.ky,h=s/this.kx;return[n[0]-h,n[1]-c,n[2]+h,n[3]+c]}insideBBox(n,s){return ra(n[0]-s[0])>=0&&ra(n[0]-s[2])<=0&&n[1]>=s[1]&&n[1]<=s[3]}}function N1(i,n){return i[0]===n[0]&&i[1]===n[1]}function Oy(i,n,s){const c=ra(n[0]-i[0]);return[i[0]+c*s,i[1]+(n[1]-i[1])*s]}function ra(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}class Wc{constructor(n=[],s=(c,h)=>c<h?-1:c>h?1:0){if(this.data=n,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:s,compare:c}=this,h=s[n];for(;n>0;){const p=n-1>>1,m=s[p];if(c(h,m)>=0)break;s[n]=m,n=p}s[n]=h}_down(n){const{data:s,compare:c}=this,h=this.length>>1,p=s[n];for(;n<h;){let m=1+(n<<1);const v=m+1;if(v<this.length&&c(s[v],s[m])<0&&(m=v),c(s[m],p)>=0)break;s[n]=s[m],n=m}s[n]=p}}var Lt=8192;function F1(i,n){return n.dist-i.dist}const Xf=100,Ly=50;function B1(i){const n=[1/0,1/0,-1/0,-1/0];if(n.length!==i.length)return!1;for(let s=0;s<n.length;s++)if(n[s]!==i[s])return!1;return!0}function Vm(i){return i[1]-i[0]+1}function ic(i,n){const s=i[1]>=i[0]&&i[1]<n;return s||console.warn("Distance Expression: Index is out of range"),s}function zy(i,n){if(i[0]>i[1])return[null,null];const s=Vm(i);if(n){if(s===2)return[i,null];const c=Math.floor(s/2);return[[i[0],i[0]+c],[i[0]+c,i[1]]]}{if(s===1)return[i,null];const c=Math.floor(s/2)-1;return[[i[0],i[0]+c],[i[0]+c+1,i[1]]]}}function ia(i,n){const s=[1/0,1/0,-1/0,-1/0];if(!ic(n,i.length))return s;for(let c=n[0];c<=n[1];++c)Gf(s,i[c]);return s}function jm(i){const n=[1/0,1/0,-1/0,-1/0];for(let s=0;s<i.length;++s)for(let c=0;c<i[s].length;++c)Gf(n,i[s][c]);return n}function od(i,n,s){if(B1(i)||B1(n))return NaN;let c=0,h=0;return i[2]<n[0]&&(c=n[0]-i[2]),i[0]>n[2]&&(c=i[0]-n[2]),i[1]>n[3]&&(h=i[1]-n[3]),i[3]<n[1]&&(h=n[1]-i[3]),s.distance([0,0],[c,h])}function U1(i){return 360*i-180}function V1(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function sa(i,n){const s=Math.pow(2,n.z),c=(i.y/Lt+n.y)/s;return[U1((i.x/Lt+n.x)/s),V1(c)]}function j1(i,n){const s=[];for(let c=0;c<i.length;++c)s.push(sa(i[c],n));return s}function $1(i,n,s){const c=s.pointOnLine(n,i).point;return s.distance(i,c)}function Ny(i,n,s,c,h){const p=s.slice(c[0],c[1]+1);let m=1/0;for(let v=n[0];v<=n[1];++v)if((m=Math.min(m,$1(i[v],p,h)))===0)return 0;return m}function ad(i,n,s,c,h){const p=Math.min(h.pointToSegmentDistance(i,s,c),h.pointToSegmentDistance(n,s,c)),m=Math.min(h.pointToSegmentDistance(s,i,n),h.pointToSegmentDistance(c,i,n));return Math.min(p,m)}function KI(i,n,s,c,h){if(!ic(n,i.length)||!ic(c,s.length))return NaN;let p=1/0;for(let m=n[0];m<n[1];++m)for(let v=c[0];v<c[1];++v){if(qf(i[m],i[m+1],s[v],s[v+1]))return 0;p=Math.min(p,ad(i[m],i[m+1],s[v],s[v+1],h))}return p}function YI(i,n,s,c,h){if(!ic(n,i.length)||!ic(c,s.length))return NaN;let p=1/0;for(let m=n[0];m<=n[1];++m)for(let v=c[0];v<=c[1];++v)if((p=Math.min(p,h.distance(i[m],s[v])))===0)return p;return p}function QI(i,n,s){if(rc(i,n,!0))return 0;let c=1/0;for(const h of n){const p=h.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[p-1]&&(c=Math.min(c,s.pointToSegmentDistance(i,h[p-1],h[0])))===0||(c=Math.min(c,$1(i,h,s)))===0)return c}return c}function JI(i,n,s,c){if(!ic(n,i.length))return NaN;for(let p=n[0];p<=n[1];++p)if(rc(i[p],s,!0))return 0;let h=1/0;for(let p=n[0];p<n[1];++p)for(const m of s)for(let v=0,b=m.length,E=b-1;v<b;E=v++){if(qf(i[p],i[p+1],m[E],m[v]))return 0;h=Math.min(h,ad(i[p],i[p+1],m[E],m[v],c))}return h}function G1(i,n){for(const s of i)for(let c=0;c<=s.length-1;++c)if(rc(s[c],n,!0))return!0;return!1}function $m(i,n,s,c=1/0){const h=jm(i),p=jm(n);if(c!==1/0&&od(h,p,s)>=c)return c;if(qc(h,p)){if(G1(i,n))return 0}else if(G1(n,i))return 0;let m=c;for(const v of i)for(let b=0,E=v.length,I=E-1;b<E;I=b++)for(const P of n)for(let M=0,z=P.length,F=z-1;M<z;F=M++){if(qf(v[I],v[b],P[F],P[M]))return 0;m=Math.min(m,ad(v[I],v[b],P[F],P[M],s))}return m}function Wu(i,n,s,c,h,p,m){if(p===null||m===null)return;const v=od(ia(c,p),ia(h,m),s);v<n&&i.push({dist:v,range1:p,range2:m})}function oa(i,n,s,c,h=1/0){let p=Math.min(c.distance(i[0],s[0][0]),h);if(p===0)return p;const m=new Wc([{dist:0,range1:[0,i.length-1],range2:[0,0]}],F1),v=n?Ly:Xf,b=jm(s);for(;m.length;){const E=m.pop();if(E.dist>=p)continue;const I=E.range1;if(Vm(I)<=v){if(!ic(I,i.length))return NaN;if(n){const P=JI(i,I,s,c);if((p=Math.min(p,P))===0)return p}else for(let P=I[0];P<=I[1];++P){const M=QI(i[P],s,c);if((p=Math.min(p,M))===0)return p}}else{const P=zy(I,n);if(P[0]!==null){const M=od(ia(i,P[0]),b,c);M<p&&m.push({dist:M,range1:P[0],range2:[0,0]})}if(P[1]!==null){const M=od(ia(i,P[1]),b,c);M<p&&m.push({dist:M,range1:P[1],range2:[0,0]})}}}return p}function Kf(i,n,s,c,h,p=1/0){let m=Math.min(p,h.distance(i[0],s[0]));if(m===0)return m;const v=new Wc([{dist:0,range1:[0,i.length-1],range2:[0,s.length-1]}],F1),b=n?Ly:Xf,E=c?Ly:Xf;for(;v.length;){const I=v.pop();if(I.dist>=m)continue;const P=I.range1,M=I.range2;if(Vm(P)<=b&&Vm(M)<=E){if(!ic(P,i.length)||!ic(M,s.length))return NaN;if(n&&c?m=Math.min(m,KI(i,P,s,M,h)):n||c?n&&!c?m=Math.min(m,Ny(s,M,i,P,h)):!n&&c&&(m=Math.min(m,Ny(i,P,s,M,h))):m=Math.min(m,YI(i,P,s,M,h)),m===0)return m}else{const z=zy(P,n),F=zy(M,c);Wu(v,m,h,i,s,z[0],F[0]),Wu(v,m,h,i,s,z[0],F[1]),Wu(v,m,h,i,s,z[1],F[0]),Wu(v,m,h,i,s,z[1],F[1])}}return m}function Fy(i,n,s,c,h=1/0){let p=h;const m=ia(i,[0,i.length-1]);for(const v of s)if(!(p!==1/0&&od(m,ia(v,[0,v.length-1]),c)>=p)&&(p=Math.min(p,Kf(i,n,v,!0,c,p)),p===0))return p;return p}function Gm(i,n,s,c,h=1/0){let p=h;const m=ia(i,[0,i.length-1]);for(const v of s){if(p!==1/0&&od(m,jm(v),c)>=p)continue;const b=oa(i,n,v,c,p);if(isNaN(b))return b;if((p=Math.min(p,b))===0)return p}return p}function By(i){return i==="Point"||i==="MultiPoint"||i==="LineString"||i==="MultiLineString"||i==="Polygon"||i==="MultiPolygon"}class Hu{constructor(n,s){this.type=Yt,this.geojson=n,this.geometries=s}static parse(n,s){if(n.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if(id(n[1])){const c=n[1];if(c.type==="FeatureCollection"){for(let h=0;h<c.features.length;++h)if(By(c.features[h].geometry.type))return new Hu(c,c.features[h].geometry)}else if(c.type==="Feature"){if(By(c.geometry.type))return new Hu(c,c.geometry)}else if(By(c.type))return new Hu(c,c)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){const s=n.geometry(),c=n.canonicalID();if(s!=null&&c!=null){if(n.geometryType()==="Point")return function(h,p,m){const v=[];for(const E of h)for(const I of E)v.push(sa(I,p));const b=new Zf(v[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?Kf(v,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",b):m.type==="MultiLineString"?Fy(v,!1,m.coordinates,b):m.type==="Polygon"||m.type==="MultiPolygon"?Gm(v,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,b):null}(s,c,this.geometries);if(n.geometryType()==="LineString")return function(h,p,m){const v=[];for(const E of h){const I=[];for(const P of E)I.push(sa(P,p));v.push(I)}const b=new Zf(v[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Fy(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,b);if(m.type==="MultiLineString"){let E=1/0;for(let I=0;I<m.coordinates.length;I++){const P=Fy(m.coordinates[I],!0,v,b,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}if(m.type==="Polygon"||m.type==="MultiPolygon"){let E=1/0;for(let I=0;I<v.length;I++){const P=Gm(v[I],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,b,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}return null}(s,c,this.geometries);if(n.geometryType()==="Polygon")return function(h,p,m){const v=[];for(const E of function(I,P){const M=I.length;if(M<=1)return[I];const z=[];let F,V;for(let j=0;j<M;j++){const K=HI(I[j]);K!==0&&(I[j].area=Math.abs(K),V===void 0&&(V=K<0),V===K<0?(F&&z.push(F),F=[I[j]]):F.push(I[j]))}return F&&z.push(F),z}(h)){const I=[];for(let P=0;P<E.length;++P)I.push(j1(E[P],p));v.push(I)}const b=new Zf(v[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Gm(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,b);if(m.type==="MultiLineString"){let E=1/0;for(let I=0;I<m.coordinates.length;I++){const P=Gm(m.coordinates[I],!0,v,b,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}return m.type==="Polygon"||m.type==="MultiPolygon"?function(E,I,P){let M=1/0;for(const z of E)for(const F of I){const V=$m(z,F,P,M);if(isNaN(V))return V;if((M=Math.min(M,V))===0)return M}return M}(m.type==="Polygon"?[m.coordinates]:m.coordinates,v,b):null}(s,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Yf(i,n){switch(i){case"string":return Ga(n);case"number":return+n;case"boolean":return!!n;case"color":return wr.parse(n);case"formatted":return uo.fromString(Ga(n));case"resolvedImage":return ta.fromString(Ga(n))}return n}function q1(i,n,s,c){return c!==void 0&&(i=c*Math.round(i/c)),n!==void 0&&i<n&&(i=n),s!==void 0&&i>s&&(i=s),i}class Hc{constructor(n,s,c){this.type=n,this.key=s,this.scope=c}static parse(n,s){let c=s.expectedType;if(c==null&&(c=_r),n.length<2||n.length>3)return s.error("Invalid number of arguments for 'config' expression.");const h=s.parse(n[1],1);if(!(h instanceof qa))return s.error("Key name of 'config' expression must be a string literal.");if(n.length>=3){const p=s.parse(n[2],2);return p instanceof qa?new Hc(c,Ga(h.value),Ga(p.value)):s.error("Scope of 'config' expression must be a string literal.")}return new Hc(c,Ga(h.value))}evaluate(n){const s=[this.key,this.scope,n.scope].filter(Boolean).join(""),c=n.getConfig(s);if(!c)return null;const{type:h,value:p,values:m,minValue:v,maxValue:b,stepValue:E}=c,I=c.default.evaluate(n);let P=I;if(p){const M=n.scope;n.scope=(M||"").split("").slice(1).join(""),P=p.evaluate(n),n.scope=M}return h&&(P=Yf(h,P)),P===void 0||v===void 0&&b===void 0&&E===void 0||(typeof P=="number"?P=q1(P,v,b,E):Array.isArray(P)&&(P=P.map(M=>typeof M=="number"?q1(M,v,b,E):M))),p!==void 0&&P!==void 0&&m&&!m.includes(P)&&(P=I,h&&(P=Yf(h,P))),(h&&h!==this.type||P!==void 0&&ts(P)!==this.type)&&(P=Yf(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const n=["config",this.key];return this.scope&&n.concat(this.key),n}}function Qf(i){if(i instanceof Oo&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof vl||i instanceof Hu)return!1;let n=!0;return i.eachChild(s=>{n&&!Qf(s)&&(n=!1)}),n}function qm(i){if(i instanceof Oo&&i.name==="feature-state")return!1;let n=!0;return i.eachChild(s=>{n&&!qm(s)&&(n=!1)}),n}function Jf(i){if(i instanceof Hc)return new Set([i.key]);let n=new Set;return i.eachChild(s=>{n=new Set([...n,...Jf(s)])}),n}function ep(i,n){if(i instanceof Oo&&n.indexOf(i.name)>=0)return!1;let s=!0;return i.eachChild(c=>{s&&!ep(c,n)&&(s=!1)}),s}class tp{constructor(n,s){this.type=s.type,this.name=n,this.boundExpression=s}static parse(n,s){if(n.length!==2||typeof n[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const c=n[1];return s.scope.has(c)?new tp(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Wm{constructor(n,s=[],c,h=new Cy,p=[],m,v){this.registry=n,this.path=s,this.key=s.map(b=>`[${b}]`).join(""),this.scope=h,this.errors=p,this.expectedType=c,this._scope=m,this.options=v}parse(n,s,c,h,p={}){return s||c?this.concat(s,c,h)._parse(n,p):this._parse(n,p)}_parse(n,s){function c(h,p,m){return m==="assert"?new na(p,[h]):m==="coerce"?new nc(p,[h]):h}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(h){let p=h.parse(n,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,v=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||v.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(m,v))return null}else p=c(p,m,s.typeAnnotation||"coerce");else p=c(p,m,s.typeAnnotation||"assert")}if(!(p instanceof qa)&&p.type.kind!=="resolvedImage"&&np(p)){const m=new My(this._scope,this.options);try{p=new qa(p.type,p.evaluate(m))}catch(v){return this.error(v.message),null}}return p}return nc.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,s,c){const h=typeof n=="number"?this.path.concat(n):this.path,p=c?this.scope.concat(c):this.scope;return new Wm(this.registry,h,s||null,p,this.errors,this._scope,this.options)}error(n,...s){const c=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new yl(c,n))}checkSubtype(n,s){const c=Vf(n,s);return c&&this.error(c),c}}var W1=Wm;function np(i){if(i instanceof tp)return np(i.boundExpression);if(i instanceof Oo&&i.name==="error"||i instanceof $f||i instanceof vl||i instanceof Hu||i instanceof Hc)return!1;const n=i instanceof nc||i instanceof na;let s=!0;return i.eachChild(c=>{s=n?s&&np(c):s&&c instanceof qa}),!!s&&Qf(i)&&ep(i,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Zu(i,n){const s=i.length-1;let c,h,p=0,m=s,v=0;for(;p<=m;)if(v=Math.floor((p+m)/2),c=i[v],h=i[v+1],c<=n){if(v===s||n<h)return v;p=v+1}else{if(!(c>n))throw new hs("Input is not a number.");m=v-1}return 0}class ld{constructor(n,s,c){this.type=n,this.input=s,this.labels=[],this.outputs=[];for(const[h,p]of c)this.labels.push(h),this.outputs.push(p)}static parse(n,s){if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(n[1],1,Yt);if(!c)return null;const h=[];let p=null;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);for(let m=1;m<n.length;m+=2){const v=m===1?-1/0:n[m],b=n[m+1],E=m,I=m+1;if(typeof v!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=v)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=s.parse(b,I,p);if(!P)return null;p=p||P.type,h.push([v,P])}return new ld(p,c,h)}evaluate(n){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(n);const h=this.input.evaluate(n);if(h<=s[0])return c[0].evaluate(n);const p=s.length;return h>=s[p-1]?c[p-1].evaluate(n):c[Zu(s,h)].evaluate(n)}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&n.push(this.labels[s]),n.push(this.outputs[s].serialize());return n}}const H1=.95047,Uy=1.08883,Z1=4/29,Zc=6/29,X1=3*Zc*Zc,eA=Zc*Zc*Zc,tA=Math.PI/180,nA=180/Math.PI;function Hm(i){return i>eA?Math.pow(i,1/3):i/X1+Z1}function Vy(i){return i>Zc?i*i*i:X1*(i-Z1)}function jy(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function $y(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function K1(i){const n=$y(i.r),s=$y(i.g),c=$y(i.b),h=Hm((.4124564*n+.3575761*s+.1804375*c)/H1),p=Hm((.2126729*n+.7151522*s+.072175*c)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-Hm((.0193339*n+.119192*s+.9503041*c)/Uy)),alpha:i.a}}function Y1(i){let n=(i.l+16)/116,s=isNaN(i.a)?n:n+i.a/500,c=isNaN(i.b)?n:n-i.b/200;return n=1*Vy(n),s=H1*Vy(s),c=Uy*Vy(c),new wr(jy(3.2404542*s-1.5371385*n-.4985314*c),jy(-.969266*s+1.8760108*n+.041556*c),jy(.0556434*s-.2040259*n+1.0572252*c),i.alpha)}function rA(i,n,s){const c=n-i;return i+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const rp={forward:K1,reverse:Y1,interpolate:function(i,n,s){return{l:wn(i.l,n.l,s),a:wn(i.a,n.a,s),b:wn(i.b,n.b,s),alpha:wn(i.alpha,n.alpha,s)}}},ip={forward:function(i){const{l:n,a:s,b:c}=K1(i),h=Math.atan2(c,s)*nA;return{h:h<0?h+360:h,c:Math.sqrt(s*s+c*c),l:n,alpha:i.a}},reverse:function(i){const n=i.h*tA,s=i.c;return Y1({l:i.l,a:Math.cos(n)*s,b:Math.sin(n)*s,alpha:i.alpha})},interpolate:function(i,n,s){return{h:rA(i.h,n.h,s),c:wn(i.c,n.c,s),l:wn(i.l,n.l,s),alpha:wn(i.alpha,n.alpha,s)}}};var sp=Object.freeze({__proto__:null,hcl:ip,lab:rp});class aa{constructor(n,s,c,h,p){this.type=n,this.operator=s,this.interpolation=c,this.input=h,this.labels=[],this.outputs=[];for(const[m,v]of p)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(n,s,c,h){let p=0;if(n.name==="exponential")p=Gy(s,n.base,c,h);else if(n.name==="linear")p=Gy(s,1,c,h);else if(n.name==="cubic-bezier"){const m=n.controlPoints;p=new zc(m[0],m[1],m[2],m[3]).solve(Gy(s,1,c,h))}return p}static parse(n,s){let[c,h,p,...m]=n;if(!Array.isArray(h)||h.length===0)return s.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some(I=>typeof I!="number"||I<0||I>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(p=s.parse(p,2,Yt),!p)return null;const v=[];let b=null;c==="interpolate-hcl"||c==="interpolate-lab"?b=ba:s.expectedType&&s.expectedType.kind!=="value"&&(b=s.expectedType);for(let E=0;E<m.length;E+=2){const I=m[E],P=m[E+1],M=E+3,z=E+4;if(typeof I!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(v.length&&v[v.length-1][0]>=I)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const F=s.parse(P,z,b);if(!F)return null;b=b||F.type,v.push([I,F])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new aa(b,c,h,p,v):s.error(`Type ${Ci(b)} is not interpolatable.`)}evaluate(n){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(n);const h=this.input.evaluate(n);if(h<=s[0])return c[0].evaluate(n);const p=s.length;if(h>=s[p-1])return c[p-1].evaluate(n);const m=Zu(s,h),v=aa.interpolationFactor(this.interpolation,h,s[m],s[m+1]),b=c[m].evaluate(n),E=c[m+1].evaluate(n);return this.operator==="interpolate"?Uf[this.type.kind.toLowerCase()](b,E,v):this.operator==="interpolate-hcl"?ip.reverse(ip.interpolate(ip.forward(b),ip.forward(E),v)):rp.reverse(rp.interpolate(rp.forward(b),rp.forward(E),v))}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,n,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function Gy(i,n,s,c){const h=c-s,p=i-s;return h===0?0:n===1?p/h:(Math.pow(n,p)-1)/(Math.pow(n,h)-1)}class Xu{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expectected at least one argument.");let c=null;const h=s.expectedType;h&&h.kind!=="value"&&(c=h);const p=[];for(const v of n.slice(1)){const b=s.parse(v,1+p.length,c,void 0,{typeAnnotation:"omit"});if(!b)return null;c=c||b.type,p.push(b)}const m=h&&p.some(v=>Vf(h,v.type));return new Xu(m?_r:c,p)}evaluate(n){let s,c=null,h=0;for(const p of this.args){if(h++,c=p.evaluate(n),c&&c instanceof ta&&!c.available&&(s||(s=c),c=null,h===this.args.length))return s;if(c!==null)break}return c}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(s=>{n.push(s.serialize())}),n}}class Zm{constructor(n,s){this.type=s.type,this.bindings=[].concat(n),this.result=s}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const s of this.bindings)n(s[1]);n(this.result)}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const c=[];for(let p=1;p<n.length-1;p+=2){const m=n[p];if(typeof m!="string")return s.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return s.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=s.parse(n[p+1],p+1);if(!v)return null;c.push([m,v])}const h=s.parse(n[n.length-1],n.length-1,s.expectedType,c);return h?new Zm(c,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[s,c]of this.bindings)n.push(s,c.serialize());return n.push(this.result.serialize()),n}}class Xm{constructor(n,s,c){this.type=n,this.index=s,this.input=c}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const c=s.parse(n[1],1,Yt),h=s.parse(n[2],2,Ks(s.expectedType||_r));return c&&h?new Xm(h.type.itemType,c,h):null}evaluate(n){const s=this.index.evaluate(n),c=this.input.evaluate(n);if(s<0)throw new hs(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new hs(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new hs(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class qy{constructor(n,s){this.type=Ir,this.needle=n,this.haystack=s}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const c=s.parse(n[1],1,_r),h=s.parse(n[2],2,_r);return c&&h?wa(c.type,[Ir,pr,Yt,ea,_r])?new qy(c,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ci(c.type)} instead`):null}evaluate(n){const s=this.needle.evaluate(n),c=this.haystack.evaluate(n);if(c==null)return!1;if(!jf(s,["boolean","string","number","null"]))throw new hs(`Expected first argument to be of type boolean, string, number or null, but found ${Ci(ts(s))} instead.`);if(!jf(c,["string","array"]))throw new hs(`Expected second argument to be of type array or string, but found ${Ci(ts(c))} instead.`);return c.indexOf(s)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class op{constructor(n,s,c){this.type=Yt,this.needle=n,this.haystack=s,this.fromIndex=c}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const c=s.parse(n[1],1,_r),h=s.parse(n[2],2,_r);if(!c||!h)return null;if(!wa(c.type,[Ir,pr,Yt,ea,_r]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ci(c.type)} instead`);if(n.length===4){const p=s.parse(n[3],3,Yt);return p?new op(c,h,p):null}return new op(c,h)}evaluate(n){const s=this.needle.evaluate(n),c=this.haystack.evaluate(n);if(!jf(s,["boolean","string","number","null"]))throw new hs(`Expected first argument to be of type boolean, string, number or null, but found ${Ci(ts(s))} instead.`);if(!jf(c,["string","array"]))throw new hs(`Expected second argument to be of type array or string, but found ${Ci(ts(c))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(n);return c.indexOf(s,h)}return c.indexOf(s)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Km{constructor(n,s,c,h,p,m){this.inputType=n,this.type=s,this.input=c,this.cases=h,this.outputs=p,this.otherwise=m}static parse(n,s){if(n.length<5)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return s.error("Expected an even number of arguments.");let c,h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const p={},m=[];for(let E=2;E<n.length-1;E+=2){let I=n[E];const P=n[E+1];Array.isArray(I)||(I=[I]);const M=s.concat(E);if(I.length===0)return M.error("Expected at least one branch label.");for(const F of I){if(typeof F!="number"&&typeof F!="string")return M.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return M.error("Numeric branch labels must be integer values.");if(c){if(M.checkSubtype(c,ts(F)))return null}else c=ts(F);if(p[String(F)]!==void 0)return M.error("Branch labels must be unique.");p[String(F)]=m.length}const z=s.parse(P,E,h);if(!z)return null;h=h||z.type,m.push(z)}const v=s.parse(n[1],1,_r);if(!v)return null;const b=s.parse(n[n.length-1],n.length-1,h);return b?v.type.kind!=="value"&&s.concat(1).checkSubtype(c,v.type)?null:new Km(c,h,v,p,m,b):null}evaluate(n){const s=this.input.evaluate(n);return(ts(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],h={};for(const m of s){const v=h[this.cases[m]];v===void 0?(h[this.cases[m]]=c.length,c.push([this.cases[m],[m]])):c[v][1].push(m)}const p=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,v]of c)n.push(v.length===1?p(v[0]):v.map(p)),n.push(this.outputs[m].serialize());return n.push(this.otherwise.serialize()),n}}class Ym{constructor(n,s,c){this.type=n,this.branches=s,this.otherwise=c}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);const h=[];for(let m=1;m<n.length-1;m+=2){const v=s.parse(n[m],m,Ir);if(!v)return null;const b=s.parse(n[m+1],m+1,c);if(!b)return null;h.push([v,b]),c=c||b.type}const p=s.parse(n[n.length-1],n.length-1,c);return p?new Ym(c,h,p):null}evaluate(n){for(const[s,c]of this.branches)if(s.evaluate(n))return c.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[s,c]of this.branches)n(s),n(c);n(this.otherwise)}outputDefined(){return this.branches.every(([n,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(s=>{n.push(s.serialize())}),n}}class ap{constructor(n,s,c,h){this.type=n,this.input=s,this.beginIndex=c,this.endIndex=h}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const c=s.parse(n[1],1,_r),h=s.parse(n[2],2,Yt);if(!c||!h)return null;if(!wa(c.type,[Ks(_r),pr,_r]))return s.error(`Expected first argument to be of type array or string, but found ${Ci(c.type)} instead`);if(n.length===4){const p=s.parse(n[3],3,Yt);return p?new ap(c.type,c,h,p):null}return new ap(c.type,c,h)}evaluate(n){const s=this.input.evaluate(n),c=this.beginIndex.evaluate(n);if(!jf(s,["string","array"]))throw new hs(`Expected first argument to be of type array or string, but found ${Ci(ts(s))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(n);return s.slice(c,h)}return s.slice(c)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Qm(i,n){return i==="=="||i==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Jm(i,n,s,c){return c.compare(n,s)===0}function cd(i,n,s){const c=i!=="=="&&i!=="!=";return class Lq{constructor(p,m,v){this.type=Ir,this.lhs=p,this.rhs=m,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const v=p[0];let b=m.parse(p[1],1,_r);if(!b)return null;if(!Qm(v,b.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${Ci(b.type)}'.`);let E=m.parse(p[2],2,_r);if(!E)return null;if(!Qm(v,E.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${Ci(E.type)}'.`);if(b.type.kind!==E.type.kind&&b.type.kind!=="value"&&E.type.kind!=="value")return m.error(`Cannot compare types '${Ci(b.type)}' and '${Ci(E.type)}'.`);c&&(b.type.kind==="value"&&E.type.kind!=="value"?b=new na(E.type,[b]):b.type.kind!=="value"&&E.type.kind==="value"&&(E=new na(b.type,[E])));let I=null;if(p.length===4){if(b.type.kind!=="string"&&E.type.kind!=="string"&&b.type.kind!=="value"&&E.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(I=m.parse(p[3],3,Om),!I)return null}return new Lq(b,E,I)}evaluate(p){const m=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(c&&this.hasUntypedArgument){const b=ts(m),E=ts(v);if(b.kind!==E.kind||b.kind!=="string"&&b.kind!=="number")throw new hs(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${b.kind}, ${E.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const b=ts(m),E=ts(v);if(b.kind!=="string"||E.kind!=="string")return n(p,m,v)}return this.collator?s(p,m,v,this.collator.evaluate(p)):n(p,m,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[i];return this.eachChild(m=>{p.push(m.serialize())}),p}}}const iA=cd("==",function(i,n,s){return n===s},Jm),Q1=cd("!=",function(i,n,s){return n!==s},function(i,n,s,c){return!Jm(0,n,s,c)}),sA=cd("<",function(i,n,s){return n<s},function(i,n,s,c){return c.compare(n,s)<0}),oA=cd(">",function(i,n,s){return n>s},function(i,n,s,c){return c.compare(n,s)>0}),aA=cd("<=",function(i,n,s){return n<=s},function(i,n,s,c){return c.compare(n,s)<=0}),lA=cd(">=",function(i,n,s){return n>=s},function(i,n,s,c){return c.compare(n,s)>=0});class Wy{constructor(n,s,c,h,p,m){this.type=pr,this.number=n,this.locale=s,this.currency=c,this.unit=h,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(n,s){if(n.length!==3)return s.error("Expected two arguments.");const c=s.parse(n[1],1,Yt);if(!c)return null;const h=n[2];if(typeof h!="object"||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=s.parse(h.locale,1,pr),!p))return null;let m=null;if(h.currency&&(m=s.parse(h.currency,1,pr),!m))return null;let v=null;if(h.unit&&(v=s.parse(h.unit,1,pr),!v))return null;let b=null;if(h["min-fraction-digits"]&&(b=s.parse(h["min-fraction-digits"],1,Yt),!b))return null;let E=null;return h["max-fraction-digits"]&&(E=s.parse(h["max-fraction-digits"],1,Yt),!E)?null:new Wy(c,p,m,v,b,E)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class Hy{constructor(n){this.type=Yt,this.input=n}static parse(n,s){if(n.length!==2)return s.error(`Expected 1 argument, but found ${n.length-1} instead.`);const c=s.parse(n[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Ci(c.type)} instead.`):new Hy(c):null}evaluate(n){const s=this.input.evaluate(n);if(typeof s=="string"||Array.isArray(s))return s.length;throw new hs(`Expected value to be of type string or array, but found ${Ci(ts(s))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(s=>{n.push(s.serialize())}),n}}function J1(i){return function(){i=1831565813+(i|=0)|0;let n=Math.imul(i^i>>>15,1|i);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const ud={"==":iA,"!=":Q1,">":oA,"<":sA,">=":lA,"<=":aA,array:na,at:Xm,boolean:na,case:Ym,coalesce:Xu,collator:$f,format:qu,image:tc,in:qy,"index-of":op,interpolate:aa,"interpolate-hcl":aa,"interpolate-lab":aa,length:Hy,let:Zm,literal:qa,match:Km,number:na,"number-format":Wy,object:na,slice:ap,step:ld,string:na,"to-boolean":nc,"to-color":nc,"to-number":nc,"to-string":nc,var:tp,within:vl,distance:Hu,config:Hc};function eb(i,[n,s,c,h]){n=n.evaluate(i),s=s.evaluate(i),c=c.evaluate(i);const p=h?h.evaluate(i):1,m=P1(n,s,c,p);if(m)throw new hs(m);return new wr(n/255*p,s/255*p,c/255*p,p)}function cA(i,[n,s,c,h]){n=n.evaluate(i),s=s.evaluate(i),c=c.evaluate(i);const p=h?h.evaluate(i):1,m=function(E,I,P,M){return typeof E=="number"&&E>=0&&E<=360?typeof I=="number"&&I>=0&&I<=100&&typeof P=="number"&&P>=0&&P<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[E,I,P,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[E,I,P,M]:[E,I,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[E,I,P,M]:[E,I,P]).join(", ")}]: 'h' must be between 0 and 360.`}(n,s,c,p);if(m)throw new hs(m);const v=`hsla(${n}, ${s}%, ${c}%, ${p})`,b=wr.parse(v);if(!b)throw new hs(`Failed to parse HSLA color: ${v}`);return b}function g(i,n){return i in n}function l(i,n){const s=n[i];return s===void 0?null:s}function d(i){return{type:i}}function _(i){return{result:"success",value:i}}function x(i){return{result:"error",value:i}}function w(i,n){return!!i&&!!i.parameters&&i.parameters.indexOf(n)>-1}function S(i){return i["property-type"]==="data-driven"}function C(i){return w(i.expression,"measure-light")}function k(i){return w(i.expression,"zoom")}function L(i){return!!i.expression&&i.expression.interpolated}function N(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function U(i){return i}function $(i,n){const s=n.type==="color",c=i.stops&&typeof i.stops[0][0]=="object",h=c||!(c||i.property!==void 0),p=i.type||(L(n)?"exponential":"interval");if(s&&((i=td({},i)).stops&&(i.stops=i.stops.map(E=>[E[0],wr.parse(E[1])])),i.default=wr.parse(i.default?i.default:n.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!sp[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let m,v,b;if(p==="exponential")m=ie;else if(p==="interval")m=ne;else if(p==="categorical"){m=te,v=Object.create(null);for(const E of i.stops)v[E[0]]=E[1];b=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=ae}if(c){const E={},I=[];for(let z=0;z<i.stops.length;z++){const F=i.stops[z],V=F[0].zoom;E[V]===void 0&&(E[V]={zoom:V,type:i.type,property:i.property,default:i.default,stops:[]},I.push(V)),E[V].stops.push([F[0].value,F[1]])}const P=[];for(const z of I)P.push([E[z].zoom,$(E[z],n)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:aa.interpolationFactor.bind(void 0,M),zoomStops:P.map(z=>z[0]),evaluate:({zoom:z},F)=>ie({stops:P,base:i.base},n,z).evaluate(z,F)}}if(h){const E=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:aa.interpolationFactor.bind(void 0,E),zoomStops:i.stops.map(I=>I[0]),evaluate:({zoom:I})=>m(i,n,I,v,b)}}return{kind:"source",evaluate(E,I){const P=I&&I.properties?I.properties[i.property]:void 0;return P===void 0?q(i.default,n.default):m(i,n,P,v,b)}}}function q(i,n,s){return i!==void 0?i:n!==void 0?n:s!==void 0?s:void 0}function te(i,n,s,c,h){return q(typeof s===h?c[s]:void 0,i.default,n.default)}function ne(i,n,s){if(Gc(s)!=="number")return q(i.default,n.default);const c=i.stops.length;if(c===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[c-1][0])return i.stops[c-1][1];const h=Zu(i.stops.map(p=>p[0]),s);return i.stops[h][1]}function ie(i,n,s){const c=i.base!==void 0?i.base:1;if(Gc(s)!=="number")return q(i.default,n.default);const h=i.stops.length;if(h===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[h-1][0])return i.stops[h-1][1];const p=Zu(i.stops.map(I=>I[0]),s),m=function(I,P,M,z){const F=z-M,V=I-M;return F===0?0:P===1?V/F:(Math.pow(P,V)-1)/(Math.pow(P,F)-1)}(s,c,i.stops[p][0],i.stops[p+1][0]),v=i.stops[p][1],b=i.stops[p+1][1];let E=Uf[n.type]||U;if(i.colorSpace&&i.colorSpace!=="rgb"){const I=sp[i.colorSpace];E=(P,M)=>I.reverse(I.interpolate(I.forward(P),I.forward(M),m))}return typeof v.evaluate=="function"?{evaluate(...I){const P=v.evaluate.apply(void 0,I),M=b.evaluate.apply(void 0,I);if(P!==void 0&&M!==void 0)return E(P,M,m)}}:E(v,b,m)}function ae(i,n,s){return n.type==="color"?s=wr.parse(s):n.type==="formatted"?s=uo.fromString(s.toString()):n.type==="resolvedImage"?s=ta.fromString(s.toString()):Gc(s)===n.type||n.type==="enum"&&n.values[s]||(s=void 0),q(s,i.default,n.default)}Oo.register(ud,{error:[{kind:"error"},[pr],(i,[n])=>{throw new hs(n.evaluate(i))}],typeof:[pr,[_r],(i,[n])=>Ci(ts(n.evaluate(i)))],"to-rgba":[Ks(Yt,4),[ba],(i,[n])=>n.evaluate(i).toRenderColor(null).toArray()],rgb:[ba,[Yt,Yt,Yt],eb],rgba:[ba,[Yt,Yt,Yt,Yt],eb],hsl:[ba,[Yt,Yt,Yt],cA],hsla:[ba,[Yt,Yt,Yt,Yt],cA],has:{type:Ir,overloads:[[[pr],(i,[n])=>g(n.evaluate(i),i.properties())],[[pr,nd],(i,[n,s])=>g(n.evaluate(i),s.evaluate(i))]]},get:{type:_r,overloads:[[[pr],(i,[n])=>l(n.evaluate(i),i.properties())],[[pr,nd],(i,[n,s])=>l(n.evaluate(i),s.evaluate(i))]]},"feature-state":[_r,[pr],(i,[n])=>l(n.evaluate(i),i.featureState||{})],properties:[nd,[],i=>i.properties()],"geometry-type":[pr,[],i=>i.geometryType()],id:[_r,[],i=>i.id()],zoom:[Yt,[],i=>i.globals.zoom],pitch:[Yt,[],i=>i.globals.pitch||0],"distance-from-center":[Yt,[],i=>i.distanceFromCenter()],"measure-light":[Yt,[pr],(i,[n])=>i.measureLight(n.evaluate(i))],"heatmap-density":[Yt,[],i=>i.globals.heatmapDensity||0],"line-progress":[Yt,[],i=>i.globals.lineProgress||0],"raster-value":[Yt,[],i=>i.globals.rasterValue||0],"raster-particle-speed":[Yt,[],i=>i.globals.rasterParticleSpeed||0],"sky-radial-progress":[Yt,[],i=>i.globals.skyRadialProgress||0],accumulated:[_r,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Yt,d(Yt),(i,n)=>{let s=0;for(const c of n)s+=c.evaluate(i);return s}],"*":[Yt,d(Yt),(i,n)=>{let s=1;for(const c of n)s*=c.evaluate(i);return s}],"-":{type:Yt,overloads:[[[Yt,Yt],(i,[n,s])=>n.evaluate(i)-s.evaluate(i)],[[Yt],(i,[n])=>-n.evaluate(i)]]},"/":[Yt,[Yt,Yt],(i,[n,s])=>n.evaluate(i)/s.evaluate(i)],"%":[Yt,[Yt,Yt],(i,[n,s])=>n.evaluate(i)%s.evaluate(i)],ln2:[Yt,[],()=>Math.LN2],pi:[Yt,[],()=>Math.PI],e:[Yt,[],()=>Math.E],"^":[Yt,[Yt,Yt],(i,[n,s])=>Math.pow(n.evaluate(i),s.evaluate(i))],sqrt:[Yt,[Yt],(i,[n])=>Math.sqrt(n.evaluate(i))],log10:[Yt,[Yt],(i,[n])=>Math.log(n.evaluate(i))/Math.LN10],ln:[Yt,[Yt],(i,[n])=>Math.log(n.evaluate(i))],log2:[Yt,[Yt],(i,[n])=>Math.log(n.evaluate(i))/Math.LN2],sin:[Yt,[Yt],(i,[n])=>Math.sin(n.evaluate(i))],cos:[Yt,[Yt],(i,[n])=>Math.cos(n.evaluate(i))],tan:[Yt,[Yt],(i,[n])=>Math.tan(n.evaluate(i))],asin:[Yt,[Yt],(i,[n])=>Math.asin(n.evaluate(i))],acos:[Yt,[Yt],(i,[n])=>Math.acos(n.evaluate(i))],atan:[Yt,[Yt],(i,[n])=>Math.atan(n.evaluate(i))],min:[Yt,d(Yt),(i,n)=>Math.min(...n.map(s=>s.evaluate(i)))],max:[Yt,d(Yt),(i,n)=>Math.max(...n.map(s=>s.evaluate(i)))],abs:[Yt,[Yt],(i,[n])=>Math.abs(n.evaluate(i))],round:[Yt,[Yt],(i,[n])=>{const s=n.evaluate(i);return s<0?-Math.round(-s):Math.round(s)}],floor:[Yt,[Yt],(i,[n])=>Math.floor(n.evaluate(i))],ceil:[Yt,[Yt],(i,[n])=>Math.ceil(n.evaluate(i))],"filter-==":[Ir,[pr,_r],(i,[n,s])=>i.properties()[n.value]===s.value],"filter-id-==":[Ir,[_r],(i,[n])=>i.id()===n.value],"filter-type-==":[Ir,[pr],(i,[n])=>i.geometryType()===n.value],"filter-<":[Ir,[pr,_r],(i,[n,s])=>{const c=i.properties()[n.value],h=s.value;return typeof c==typeof h&&c<h}],"filter-id-<":[Ir,[_r],(i,[n])=>{const s=i.id(),c=n.value;return typeof s==typeof c&&s<c}],"filter->":[Ir,[pr,_r],(i,[n,s])=>{const c=i.properties()[n.value],h=s.value;return typeof c==typeof h&&c>h}],"filter-id->":[Ir,[_r],(i,[n])=>{const s=i.id(),c=n.value;return typeof s==typeof c&&s>c}],"filter-<=":[Ir,[pr,_r],(i,[n,s])=>{const c=i.properties()[n.value],h=s.value;return typeof c==typeof h&&c<=h}],"filter-id-<=":[Ir,[_r],(i,[n])=>{const s=i.id(),c=n.value;return typeof s==typeof c&&s<=c}],"filter->=":[Ir,[pr,_r],(i,[n,s])=>{const c=i.properties()[n.value],h=s.value;return typeof c==typeof h&&c>=h}],"filter-id->=":[Ir,[_r],(i,[n])=>{const s=i.id(),c=n.value;return typeof s==typeof c&&s>=c}],"filter-has":[Ir,[_r],(i,[n])=>n.value in i.properties()],"filter-has-id":[Ir,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ir,[Ks(pr)],(i,[n])=>n.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ir,[Ks(_r)],(i,[n])=>n.value.indexOf(i.id())>=0],"filter-in-small":[Ir,[pr,Ks(_r)],(i,[n,s])=>s.value.indexOf(i.properties()[n.value])>=0],"filter-in-large":[Ir,[pr,Ks(_r)],(i,[n,s])=>function(c,h,p,m){for(;p<=m;){const v=p+m>>1;if(h[v]===c)return!0;h[v]>c?m=v-1:p=v+1}return!1}(i.properties()[n.value],s.value,0,s.value.length-1)],all:{type:Ir,overloads:[[[Ir,Ir],(i,[n,s])=>n.evaluate(i)&&s.evaluate(i)],[d(Ir),(i,n)=>{for(const s of n)if(!s.evaluate(i))return!1;return!0}]]},any:{type:Ir,overloads:[[[Ir,Ir],(i,[n,s])=>n.evaluate(i)||s.evaluate(i)],[d(Ir),(i,n)=>{for(const s of n)if(s.evaluate(i))return!0;return!1}]]},"!":[Ir,[Ir],(i,[n])=>!n.evaluate(i)],"is-supported-script":[Ir,[pr],(i,[n])=>{const s=i.globals&&i.globals.isSupportedScript;return!s||s(n.evaluate(i))}],upcase:[pr,[pr],(i,[n])=>n.evaluate(i).toUpperCase()],downcase:[pr,[pr],(i,[n])=>n.evaluate(i).toLowerCase()],concat:[pr,d(_r),(i,n)=>n.map(s=>Ga(s.evaluate(i))).join("")],"resolved-locale":[pr,[Om],(i,[n])=>n.evaluate(i).resolvedLocale()],random:[Yt,[Yt,Yt,_r],(i,n)=>{const[s,c,h]=n.map(m=>m.evaluate(i));if(s>c||s===c)return s;let p;if(typeof h=="string")p=function(m){let v=0;if(m.length===0)return v;for(let b=0;b<m.length;b++)v=(v<<5)-v+m.charCodeAt(b),v|=0;return v}(h);else{if(typeof h!="number")throw new hs(`Invalid seed input: ${h}`);p=h}return s+J1(p)()*(c-s)}]});class ve{constructor(n,s,c,h){this.expression=n,this._warningHistory={},this._evaluator=new My(c,h),this._defaultValue=s?function(p){return p.type==="color"&&(N(p.default)||Array.isArray(p.default))?new wr(0,0,0,0):p.type==="color"?wr.parse(p.default)||null:p.default===void 0?null:p.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(n,s,c,h,p,m,v,b){return this._evaluator.globals=n,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(n,s,c,h,p,m,v,b){this._evaluator.globals=n,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new hs(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${E.message}`)),this._defaultValue}}}function xe(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ud}function ye(i,n,s,c){const h=new W1(ud,[],n?function(m){const v={color:ba,string:pr,number:Yt,enum:pr,boolean:Ir,formatted:rd,resolvedImage:Gu};return m.type==="array"?Ks(v[m.value]||_r,m.length):v[m.type]}(n):void 0,void 0,void 0,s,c),p=h.parse(i,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?_(new ve(p,n,s,c)):x(h.errors)}class Me{constructor(n,s,c){this.kind=n,this._styleExpression=s,this.isLightConstant=c,this.isStateDependent=n!=="constant"&&!qm(s.expression),this.configDependencies=Jf(s.expression)}evaluateWithoutErrorHandling(n,s,c,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(n,s,c,h,p,m)}evaluate(n,s,c,h,p,m){return this._styleExpression.evaluate(n,s,c,h,p,m)}}class Se{constructor(n,s,c,h,p){this.kind=n,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=n!=="camera"&&!qm(s.expression),this.isLightConstant=p,this.configDependencies=Jf(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(n,s,c,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(n,s,c,h,p,m)}evaluate(n,s,c,h,p,m){return this._styleExpression.evaluate(n,s,c,h,p,m)}interpolationFactor(n,s,c){return this.interpolationType?aa.interpolationFactor(this.interpolationType,n,s,c):0}}function Ie(i,n,s,c){if((i=ye(i,n,s,c)).result==="error")return i;const h=i.value.expression,p=Qf(h);if(!p&&!S(n))return x([new yl("","data expressions not supported")]);const m=ep(h,["zoom","pitch","distance-from-center"]);if(!m&&!k(n))return x([new yl("","zoom expressions not supported")]);const v=ep(h,["measure-light"]);if(!v&&!C(n))return x([new yl("","measure-light expression not supported")]);const b=n.expression&&n.expression.relaxZoomRestriction,E=Fe(h);return E||m||b?E instanceof yl?x([E]):E instanceof aa&&!L(n)?x([new yl("",'"interpolate" expressions cannot be used with this property')]):_(E?new Se(p?"camera":"composite",i.value,E.labels,E instanceof aa?E.interpolation:void 0,v):new Me(p?"constant":"source",i.value,v)):x([new yl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ne{constructor(n,s){this._parameters=n,this._specification=s,td(this,$(this._parameters,this._specification))}static deserialize(n){return new Ne(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Fe(i){let n=null;if(i instanceof Zm)n=Fe(i.result);else if(i instanceof Xu){for(const s of i.args)if(n=Fe(s),n)break}else(i instanceof ld||i instanceof aa)&&i.input instanceof Oo&&i.input.name==="zoom"&&(n=i);return n instanceof yl||i.eachChild(s=>{const c=Fe(s);c instanceof yl?n=c:n&&c&&n!==c&&(n=new yl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}var We=Re,Be=3;function Re(i,n,s){var c=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(n=h[1])+2*(s=h[2]);for(var p=0;p<this.d*this.d;p++){var m=h[Be+p],v=h[Be+p+1];c.push(m===v?null:h.subarray(m,v))}var b=h[Be+c.length+1];this.keys=h.subarray(h[Be+c.length],b),this.bboxes=h.subarray(b),this.insert=this._insertReadonly}else{this.d=n+2*s;for(var E=0;E<this.d*this.d;E++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=i,this.padding=s,this.scale=n/i,this.uid=0;var I=s/n*i;this.min=-I,this.max=i+I}Re.prototype.insert=function(i,n,s,c,h){this._forEachCell(n,s,c,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(h)},Re.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Re.prototype._insertCell=function(i,n,s,c,h,p){this.cells[h].push(p)},Re.prototype.query=function(i,n,s,c,h){var p=this.min,m=this.max;if(i<=p&&n<=p&&m<=s&&m<=c&&!h)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(i,n,s,c,this._queryCell,v,{},h),v},Re.prototype._queryCell=function(i,n,s,c,h,p,m,v){var b=this.cells[h];if(b!==null)for(var E=this.keys,I=this.bboxes,P=0;P<b.length;P++){var M=b[P];if(m[M]===void 0){var z=4*M;(v?v(I[z+0],I[z+1],I[z+2],I[z+3]):i<=I[z+2]&&n<=I[z+3]&&s>=I[z+0]&&c>=I[z+1])?(m[M]=!0,p.push(E[M])):m[M]=!1}}},Re.prototype._forEachCell=function(i,n,s,c,h,p,m,v){for(var b=this._convertToCellCoord(i),E=this._convertToCellCoord(n),I=this._convertToCellCoord(s),P=this._convertToCellCoord(c),M=b;M<=I;M++)for(var z=E;z<=P;z++){var F=this.d*z+M;if((!v||v(this._convertFromCellCoord(M),this._convertFromCellCoord(z),this._convertFromCellCoord(M+1),this._convertFromCellCoord(z+1)))&&h.call(this,i,n,s,c,F,p,m,v))return}},Re.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Re.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Re.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,n=Be+this.cells.length+1+1,s=0,c=0;c<this.cells.length;c++)s+=this.cells[c].length;var h=new Int32Array(n+s+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=n,m=0;m<i.length;m++){var v=i[m];h[Be+m]=p,h.set(v,p),p+=v.length}return h[Be+i.length]=p,h.set(this.keys,p),h[Be+i.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer};var Je=fe(We);const Ye={};function je(i,n,s={}){Object.defineProperty(i,"_classRegistryKey",{value:n,writable:!1}),Ye[n]={klass:i,omit:s.omit||[]}}je(Object,"Object"),Je.serialize=function(i,n){const s=i.toArrayBuffer();return n&&n.add(s),{buffer:s}},Je.deserialize=function(i){return new Je(i.buffer)},Object.defineProperty(Je,"name",{value:"Grid"}),je(Je,"Grid"),je(wr,"Color"),je(Error,"Error"),je(uo,"Formatted"),je(zm,"FormattedSection"),je(Pm,"AJAXError"),je(ta,"ResolvedImage"),je(Ne,"StylePropertyFunction"),je(ve,"StyleExpression",{omit:["_evaluator"]}),je(Se,"ZoomDependentExpression"),je(Me,"ZoomConstantExpression"),je(Oo,"CompoundExpression",{omit:["_evaluate"]});for(const i in ud)Ye[ud[i]._classRegistryKey]||je(ud[i],`Expression${i}`);function vt(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function dt(i){return self.ImageBitmap&&i instanceof ImageBitmap}function He(i,n){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(vt(i)||dt(i))return n&&n.add(i),i;if(ArrayBuffer.isView(i)){const s=i;return n&&n.add(s.buffer),s}if(i instanceof ImageData)return n&&n.add(i.data.buffer),i;if(Array.isArray(i)){const s=[];for(const c of i)s.push(He(c,n));return s}if(i instanceof Map){const s={$name:"Map"};for(const[c,h]of i.entries())s[c]=He(h);return s}if(i instanceof Set){const s={$name:"Set"};let c=0;for(const h of i.values())s[++c]=He(h);return s}if(typeof i=="object"){const s=i.constructor,c=s._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const h=s.serialize?s.serialize(i,n):{};if(!s.serialize){for(const p in i)i.hasOwnProperty(p)&&(Ye[c].omit.indexOf(p)>=0||(h[p]=He(i[p],n)));i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(h.$name=c),h}throw new Error("can't serialize object of type "+typeof i)}function it(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||vt(i)||dt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(it);if(typeof i=="object"){const n=i.$name||"Object";if(n==="Map"){const h=new Map;for(const p of Object.keys(i))p!=="$name"&&h.set(p,it(i[p]));return h}if(n==="Set"){const h=new Set;for(const p of Object.keys(i))p!=="$name"&&h.add(it(i[p]));return h}const{klass:s}=Ye[n];if(!s)throw new Error(`can't deserialize unregistered class ${n}`);if(s.deserialize)return s.deserialize(i);const c=Object.create(s.prototype);for(const h of Object.keys(i))h!=="$name"&&(c[h]=it(i[h]));return c}throw new Error("can't deserialize object of type "+typeof i)}const Ue={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519,"CJK Unified Ideographs Extension B":i=>i>=131072&&i<=173791};function ft(i){for(const n of i)if($t(n.charCodeAt(0)))return!0;return!1}function gt(i){for(const n of i)if(!Ut(n.charCodeAt(0)))return!1;return!0}function Ut(i){return!(Ue.Arabic(i)||Ue["Arabic Supplement"](i)||Ue["Arabic Extended-A"](i)||Ue["Arabic Presentation Forms-A"](i)||Ue["Arabic Presentation Forms-B"](i))}function $t(i){return!(i!==746&&i!==747&&(i<4352||!(Ue["Bopomofo Extended"](i)||Ue.Bopomofo(i)||Ue["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Ue["CJK Compatibility Ideographs"](i)||Ue["CJK Compatibility"](i)||Ue["CJK Radicals Supplement"](i)||Ue["CJK Strokes"](i)||!(!Ue["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ue["CJK Unified Ideographs Extension A"](i)||Ue["CJK Unified Ideographs"](i)||Ue["Enclosed CJK Letters and Months"](i)||Ue["Hangul Compatibility Jamo"](i)||Ue["Hangul Jamo Extended-A"](i)||Ue["Hangul Jamo Extended-B"](i)||Ue["Hangul Jamo"](i)||Ue["Hangul Syllables"](i)||Ue.Hiragana(i)||Ue["Ideographic Description Characters"](i)||Ue.Kanbun(i)||Ue["Kangxi Radicals"](i)||Ue["Katakana Phonetic Extensions"](i)||Ue.Katakana(i)&&i!==12540||!(!Ue["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ue["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Ue["Unified Canadian Aboriginal Syllabics"](i)||Ue["Unified Canadian Aboriginal Syllabics Extended"](i)||Ue["Vertical Forms"](i)||Ue["Yijing Hexagram Symbols"](i)||Ue["Yi Syllables"](i)||Ue["Yi Radicals"](i))))}function tn(i){return!($t(i)||function(n){return!!(Ue["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Ue["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Ue["Letterlike Symbols"](n)||Ue["Number Forms"](n)||Ue["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Ue["Control Pictures"](n)&&n!==9251||Ue["Optical Character Recognition"](n)||Ue["Enclosed Alphanumerics"](n)||Ue["Geometric Shapes"](n)||Ue["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Ue["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Ue["CJK Symbols and Punctuation"](n)||Ue.Katakana(n)||Ue["Private Use Area"](n)||Ue["CJK Compatibility Forms"](n)||Ue["Small Form Variants"](n)||Ue["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(i))}function qt(i){return i>=1424&&i<=2303||Ue["Arabic Presentation Forms-A"](i)||Ue["Arabic Presentation Forms-B"](i)}function bn(i,n){return!(!n&&qt(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Ue.Khmer(i))}function Fn(i){for(const n of i)if(qt(n.charCodeAt(0)))return!0;return!1}const Tn="deferred",jn="loading",or="loaded";let Zr=null,zr="unavailable",cr=null;const Or=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(zr="error"),Zr&&Zr(i)};function qn(){Xn.fire(new _l("pluginStateChange",{pluginStatus:zr,pluginURL:cr}))}const Xn=new $u,Bn=function(){return zr},mr=function(){if(zr!==Tn||!cr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");zr=jn,qn(),cr&&Bu({url:cr},i=>{i?Or(i):(zr=or,qn())})},Jn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>zr===or||Jn.applyArabicShaping!=null,isLoading:()=>zr===jn,setState(i){zr=i.pluginStatus,cr=i.pluginURL},isParsed:()=>Jn.applyArabicShaping!=null&&Jn.processBidirectionalText!=null&&Jn.processStyledBidirectionalText!=null,getPluginURL:()=>cr};class An{constructor(n,s){this.zoom=n,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return function(s,c){for(const h of s)if(!bn(h.charCodeAt(0),c))return!1;return!0}(n,Jn.isLoaded())}}class Fi{constructor(n,s,c,h){this.property=n,this.value=s,this.expression=function(p,m,v,b){if(N(p))return new Ne(p,m);if(xe(p)||Array.isArray(p)&&p.length>0){const E=Ie(p,m,v,b);if(E.result==="error")throw new Error(E.value.map(I=>`${I.key}: ${I.message}`).join(", "));return E.value}{let E=p;return typeof p=="string"&&m.type==="color"&&(E=wr.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>E}}}(s===void 0?n.specification.default:s,n.specification,c,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,s,c){return this.property.possiblyEvaluate(this,n,s,c)}}class Bi{constructor(n,s,c){this.property=n,this.value=new Fi(n,void 0,s,c)}transitioned(n,s){return new Js(this.property,this.value,s,ws({},n.transition,this.transition),n.now)}untransitioned(){return new Js(this.property,this.value,null,{},0)}}class Qs{constructor(n,s,c){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=s,this._options=c,this.configDependencies=new Set}getValue(n){return Rs(this._values[n].value.value)}setValue(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new Bi(this._values[n].property,this._scope,this._options)),this._values[n].value=new Fi(this._values[n].property,s===null?void 0:Rs(s),this._scope,this._options),this._values[n].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].value.expression.configDependencies]))}setTransitionOrValue(n,s){s&&(this._options=s);const c=this._properties.properties;if(n)for(const h in n){const p=n[h];if(Va(h,"-transition")){const m=h.slice(0,-11);c[m]&&this.setTransition(m,p)}else c.hasOwnProperty(h)&&this.setValue(h,p)}}getTransition(n){return Rs(this._values[n].transition)}setTransition(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new Bi(this._values[n].property)),this._values[n].transition=Rs(s)||void 0}serialize(){const n={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(n[s]=c);const h=this.getTransition(s);h!==void 0&&(n[`${s}-transition`]=h)}return n}transitioned(n,s){const c=new Bs(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].transitioned(n,s._values[h]);return c}untransitioned(){const n=new Bs(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].untransitioned();return n}}class Js{constructor(n,s,c,h,p){const m=h.delay||0,v=h.duration||0;p=p||0,this.property=n,this.value=s,this.begin=p+m,this.end=this.begin+v,n.specification.transition&&(h.delay||h.duration)&&(this.prior=c)}possiblyEvaluate(n,s,c){const h=n.now||0,p=this.value.possiblyEvaluate(n,s,c),m=this.prior;if(m){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return m.possiblyEvaluate(n,s,c);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(n,s,c),p,Lu(v))}}return p}}class Bs{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,s,c){const h=new Us(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(n,s,c);return h}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class eo{constructor(n,s,c){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=s,this._options=c,this.configDependencies=new Set}getValue(n){return Rs(this._values[n].value)}setValue(n,s){this._values[n]=new Fi(this._values[n].property,s===null?void 0:Rs(s),this._scope,this._options),this._values[n].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].expression.configDependencies]))}serialize(){const n={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(n[s]=c)}return n}possiblyEvaluate(n,s,c){const h=new Us(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(n,s,c);return h}}class Ms{constructor(n,s,c){this.property=n,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,s,c,h){return this.property.evaluate(this.value,this.parameters,n,s,c,h)}}class Us{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class It{constructor(n){this.specification=n}possiblyEvaluate(n,s){return n.expression.evaluate(s)}interpolate(n,s,c){const h=Uf[this.specification.type];return h?h(n,s,c):n}}class sn{constructor(n,s){this.specification=n,this.overrides=s}possiblyEvaluate(n,s,c,h){return new Ms(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(s,null,{},c,h)}:n.expression,s)}interpolate(n,s,c){if(n.value.kind!=="constant"||s.value.kind!=="constant")return n;if(n.value.value===void 0||s.value.value===void 0)return new Ms(this,{kind:"constant",value:void 0},n.parameters);const h=Uf[this.specification.type];return h?new Ms(this,{kind:"constant",value:h(n.value.value,s.value.value,c)},n.parameters):n}evaluate(n,s,c,h,p,m){return n.kind==="constant"?n.value:n.evaluate(s,c,h,p,m)}}class ho{constructor(n){this.specification=n}possiblyEvaluate(n,s,c,h){return!!n.expression.evaluate(s,null,{},c,h)}interpolate(){return!1}}class jr{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new An(0,{});for(const c in n){const h=n[c];h.specification.overridable&&this.overridableProperties.push(c);const p=this.defaultPropertyValues[c]=new Fi(h,void 0),m=this.defaultTransitionablePropertyValues[c]=new Bi(h);this.defaultTransitioningPropertyValues[c]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=p.possiblyEvaluate(s)}}}je(sn,"DataDrivenProperty"),je(It,"DataConstantProperty"),je(ho,"ColorRampProperty");var Qe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-line-alignment":{"type":"enum","values":{"inside":1,"outside":1,"center":1},"default":"center","property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function sc(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Wa(i){if(Array.isArray(i))return i.map(Wa);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const n={};for(const s in i)n[s]=Wa(i[s]);return n}return sc(i)}function oc(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const n of i.slice(1))if(!oc(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function ac(i,n="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};oc(i)||(i=hd(i));const s=i;let c=!0;try{c=function(E){if(!Xc(E))return E;let I=Wa(E);return tg(I),I=eg(I),I}(s)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(s,null,2)}
        `)}const h=Qe[`filter_${n}`],p=ye(c,h);let m=null;if(p.result==="error")throw new Error(p.value.map(E=>`${E.key}: ${E.message}`).join(", "));m=(E,I,P)=>p.value.evaluate(E,I,{},P);let v=null,b=null;if(c!==s){const E=ye(s,h);if(E.result==="error")throw new Error(E.value.map(I=>`${I.key}: ${I.message}`).join(", "));v=(I,P,M,z,F)=>E.value.evaluate(I,P,{},M,void 0,void 0,z,F),b=!Qf(E.value.expression)}return{filter:m,dynamicFilter:v||void 0,needGeometry:ng(c),needFeature:!!b}}function eg(i){if(!Array.isArray(i))return i;const n=function(s){if(Zy.has(s[0])){for(let c=1;c<s.length;c++)if(Xc(s[c]))return!0}return s}(i);return n===!0?n:n.map(s=>eg(s))}function tg(i){let n=!1;const s=[];if(i[0]==="case"){for(let c=1;c<i.length-1;c+=2)n=n||Xc(i[c]),s.push(i[c+1]);s.push(i[i.length-1])}else if(i[0]==="match"){n=n||Xc(i[1]);for(let c=2;c<i.length-1;c+=2)s.push(i[c+1]);s.push(i[i.length-1])}else if(i[0]==="step"){n=n||Xc(i[1]);for(let c=1;c<i.length-1;c+=2)s.push(i[c+1])}n&&(i.length=0,i.push("any",...s));for(let c=1;c<i.length;c++)tg(i[c])}function Xc(i){if(!Array.isArray(i))return!1;if((n=i[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let s=1;s<i.length;s++)if(Xc(i[s]))return!0;return!1}const Zy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ku(i,n){return i<n?-1:i>n?1:0}function ng(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let n=1;n<i.length;n++)if(ng(i[n]))return!0;return!1}function hd(i){if(!i)return!0;const n=i[0];return i.length<=1?n!=="any":n==="=="?uA(i[1],i[2],"=="):n==="!="?tb(uA(i[1],i[2],"==")):n==="<"||n===">"||n==="<="||n===">="?uA(i[1],i[2],n):n==="any"?(s=i.slice(1),["any"].concat(s.map(hd))):n==="all"?["all"].concat(i.slice(1).map(hd)):n==="none"?["all"].concat(i.slice(1).map(hd).map(tb)):n==="in"?sL(i[1],i.slice(2)):n==="!in"?tb(sL(i[1],i.slice(2))):n==="has"?oL(i[1]):n!=="!has"||tb(oL(i[1]));var s}function uA(i,n,s){switch(i){case"$type":return[`filter-type-${s}`,n];case"$id":return[`filter-id-${s}`,n];default:return[`filter-${s}`,i,n]}}function sL(i,n){if(n.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(s=>typeof s!=typeof n[0])?["filter-in-large",i,["literal",n.sort(Ku)]]:["filter-in-small",i,["literal",n]]}}function oL(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function tb(i){return["!",i]}const nb="";function aL(i,n){return n?`${i}${nb}${n}`:i}const lL="-transition",HW=new Set(["fill","line","background","hillshade","raster"]);class la extends $u{constructor(n,s,c,h,p){if(super(),this.id=n.id,this.fqid=aL(this.id,c),this.type=n.type,this.scope=c,this.lut=h,this.options=p,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),n.slot&&(this.slot=n.slot),s.layout&&(this._unevaluatedLayout=new eo(s.layout,this.scope,p),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),s.paint)){this._transitionablePaint=new Qs(s.paint,this.scope,p);for(const m in n.paint)this.setPaintProperty(m,n.paint[m]);for(const m in n.layout)this.setLayoutProperty(m,n.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Us(s.paint)}}onAdd(n){}onRemove(n){}isDraped(n){return HW.has(this.type)}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,s){if(this.type==="custom"&&n==="visibility")return void(this.visibility=s);const c=this._unevaluatedLayout;c._properties.properties[n]&&(c.setValue(n,s),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),n==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(n){return Va(n,lL)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,s){const c=this._transitionablePaint,h=c._properties.properties;if(Va(n,lL)){const P=n.slice(0,-11);return h[P]&&c.setTransition(P,s||void 0),!1}if(!h[n])return!1;const p=c._values[n],m=p.value.isDataDriven(),v=p.value;c.setValue(n,s),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),this._handleSpecialPaintPropertyUpdate(n);const b=c._values[n].value,E=b.isDataDriven(),I=Va(n,"pattern")||n==="line-dasharray";return E||m||I||this._handleOverridablePaintPropertyUpdate(n,v,b)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,s,c){return null}_handleOverridablePaintPropertyUpdate(n,s,c){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,s)}serialize(){return Ts({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(n,s)=>!(n===void 0||s==="layout"&&!Object.keys(n).length||s==="paint"&&!Object.keys(n).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const n in this.paint._values){const s=this.paint.get(n);if(s instanceof Ms&&S(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ac(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(n){this._stats&&(n.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(n){}queryIntersectsFeature(n,s,c,h,p,m,v,b,E){}queryIntersectsMatchingFeature(n,s,c,h){}}const ZW={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Xy{constructor(n,s){this._structArray=n,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ai{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,s){return n._trim(),s&&(n.isTransferred=!0,s.add(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const s=Object.create(this.prototype);return s.arrayBuffer=n.arrayBuffer,s.length=n.length,s.capacity=n.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...n){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...n){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Pr(i,n=1){let s=0,c=0;return{members:i.map(h=>{const p=ZW[h.type].BYTES_PER_ELEMENT,m=s=cL(s,Math.max(n,p)),v=h.components||1;return c=Math.max(c,p),s+=p*v,{name:h.name,type:h.type,components:v,offset:m}}),size:cL(s,Math.max(c,n)),alignment:n}}function cL(i,n){return Math.ceil(i/n)*n}class lc extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s){const c=this.length;return this.resize(c+1),this.emplace(c,n,s)}emplace(n,s,c){const h=2*n;return this.int16[h+0]=s,this.int16[h+1]=c,n}}lc.prototype.bytesPerElement=4,je(lc,"StructArrayLayout2i4");class rb extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,c)}emplace(n,s,c,h){const p=3*n;return this.int16[p+0]=s,this.int16[p+1]=c,this.int16[p+2]=h,n}}rb.prototype.bytesPerElement=6,je(rb,"StructArrayLayout3i6");class Yu extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,c,h)}emplace(n,s,c,h,p){const m=4*n;return this.int16[m+0]=s,this.int16[m+1]=c,this.int16[m+2]=h,this.int16[m+3]=p,n}}Yu.prototype.bytesPerElement=8,je(Yu,"StructArrayLayout4i8");class hA extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,s,c,h,p)}emplace(n,s,c,h,p,m){const v=5*n;return this.int16[v+0]=s,this.int16[v+1]=c,this.int16[v+2]=h,this.int16[v+3]=p,this.int16[v+4]=m,n}}hA.prototype.bytesPerElement=10,je(hA,"StructArrayLayout5i10");class dA extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,h,p,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,n,s,c,h,p,m,v)}emplace(n,s,c,h,p,m,v,b){const E=6*n,I=12*n,P=3*n;return this.int16[E+0]=s,this.int16[E+1]=c,this.uint8[I+4]=h,this.uint8[I+5]=p,this.uint8[I+6]=m,this.uint8[I+7]=v,this.float32[P+2]=b,n}}dA.prototype.bytesPerElement=12,je(dA,"StructArrayLayout2i4ub1f12");class dd extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,c,h)}emplace(n,s,c,h,p){const m=4*n;return this.float32[m+0]=s,this.float32[m+1]=c,this.float32[m+2]=h,this.float32[m+3]=p,n}}dd.prototype.bytesPerElement=16,je(dd,"StructArrayLayout4f16");class fd extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,c)}emplace(n,s,c,h){const p=3*n;return this.float32[p+0]=s,this.float32[p+1]=c,this.float32[p+2]=h,n}}fd.prototype.bytesPerElement=12,je(fd,"StructArrayLayout3f12");class pd extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,s,c,h,p)}emplace(n,s,c,h,p,m){const v=6*n,b=3*n;return this.uint16[v+0]=s,this.uint16[v+1]=c,this.uint16[v+2]=h,this.uint16[v+3]=p,this.float32[b+2]=m,n}}pd.prototype.bytesPerElement=12,je(pd,"StructArrayLayout4ui1f12");class ib extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,c,h)}emplace(n,s,c,h,p){const m=4*n;return this.uint16[m+0]=s,this.uint16[m+1]=c,this.uint16[m+2]=h,this.uint16[m+3]=p,n}}ib.prototype.bytesPerElement=8,je(ib,"StructArrayLayout4ui8");class sb extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c,h,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,s,c,h,p,m)}emplace(n,s,c,h,p,m,v){const b=6*n;return this.int16[b+0]=s,this.int16[b+1]=c,this.int16[b+2]=h,this.int16[b+3]=p,this.int16[b+4]=m,this.int16[b+5]=v,n}}sb.prototype.bytesPerElement=12,je(sb,"StructArrayLayout6i12");class fA extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,c,h,p,m,v,b,E,I,P,M){const z=this.length;return this.resize(z+1),this.emplace(z,n,s,c,h,p,m,v,b,E,I,P,M)}emplace(n,s,c,h,p,m,v,b,E,I,P,M,z){const F=12*n;return this.int16[F+0]=s,this.int16[F+1]=c,this.int16[F+2]=h,this.int16[F+3]=p,this.uint16[F+4]=m,this.uint16[F+5]=v,this.uint16[F+6]=b,this.uint16[F+7]=E,this.int16[F+8]=I,this.int16[F+9]=P,this.int16[F+10]=M,this.int16[F+11]=z,n}}fA.prototype.bytesPerElement=24,je(fA,"StructArrayLayout4i4ui4i24");class pA extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,h,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,s,c,h,p,m)}emplace(n,s,c,h,p,m,v){const b=10*n,E=5*n;return this.int16[b+0]=s,this.int16[b+1]=c,this.int16[b+2]=h,this.float32[E+2]=p,this.float32[E+3]=m,this.float32[E+4]=v,n}}pA.prototype.bytesPerElement=20,je(pA,"StructArrayLayout3i3f20");class mA extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint32[1*n+0]=s,n}}mA.prototype.bytesPerElement=4,je(mA,"StructArrayLayout1ul4");class md extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s){const c=this.length;return this.resize(c+1),this.emplace(c,n,s)}emplace(n,s,c){const h=2*n;return this.uint16[h+0]=s,this.uint16[h+1]=c,n}}md.prototype.bytesPerElement=4,je(md,"StructArrayLayout2ui4");class gA extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,c,h,p,m,v,b,E,I,P,M,z){const F=this.length;return this.resize(F+1),this.emplace(F,n,s,c,h,p,m,v,b,E,I,P,M,z)}emplace(n,s,c,h,p,m,v,b,E,I,P,M,z,F){const V=20*n,j=10*n;return this.int16[V+0]=s,this.int16[V+1]=c,this.int16[V+2]=h,this.int16[V+3]=p,this.int16[V+4]=m,this.float32[j+3]=v,this.float32[j+4]=b,this.float32[j+5]=E,this.float32[j+6]=I,this.int16[V+14]=P,this.uint32[j+8]=M,this.uint16[V+18]=z,this.uint16[V+19]=F,n}}gA.prototype.bytesPerElement=40,je(gA,"StructArrayLayout5i4f1i1ul2ui40");class ob extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c,h,p,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,n,s,c,h,p,m,v)}emplace(n,s,c,h,p,m,v,b){const E=8*n;return this.int16[E+0]=s,this.int16[E+1]=c,this.int16[E+2]=h,this.int16[E+4]=p,this.int16[E+5]=m,this.int16[E+6]=v,this.int16[E+7]=b,n}}ob.prototype.bytesPerElement=16,je(ob,"StructArrayLayout3i2i2i16");class _A extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,s,c,h,p)}emplace(n,s,c,h,p,m){const v=4*n,b=8*n;return this.float32[v+0]=s,this.float32[v+1]=c,this.float32[v+2]=h,this.int16[b+6]=p,this.int16[b+7]=m,n}}_A.prototype.bytesPerElement=16,je(_A,"StructArrayLayout2f1f2i16");class yA extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,c,h)}emplace(n,s,c,h,p){const m=12*n,v=3*n;return this.uint8[m+0]=s,this.uint8[m+1]=c,this.float32[v+1]=h,this.float32[v+2]=p,n}}yA.prototype.bytesPerElement=12,je(yA,"StructArrayLayout2ub2f12");class ks extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,c)}emplace(n,s,c,h){const p=3*n;return this.uint16[p+0]=s,this.uint16[p+1]=c,this.uint16[p+2]=h,n}}ks.prototype.bytesPerElement=6,je(ks,"StructArrayLayout3ui6");class vA extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,s,c,h,p,m,v,b,E,I,P,M,z,F,V,j,K,pe,de,me,Ae){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,n,s,c,h,p,m,v,b,E,I,P,M,z,F,V,j,K,pe,de,me,Ae)}emplace(n,s,c,h,p,m,v,b,E,I,P,M,z,F,V,j,K,pe,de,me,Ae,Ce){const ze=30*n,$e=15*n,Xe=60*n;return this.int16[ze+0]=s,this.int16[ze+1]=c,this.int16[ze+2]=h,this.float32[$e+2]=p,this.float32[$e+3]=m,this.uint16[ze+8]=v,this.uint16[ze+9]=b,this.uint32[$e+5]=E,this.uint32[$e+6]=I,this.uint32[$e+7]=P,this.uint16[ze+16]=M,this.uint16[ze+17]=z,this.uint16[ze+18]=F,this.float32[$e+10]=V,this.float32[$e+11]=j,this.uint8[Xe+48]=K,this.uint8[Xe+49]=pe,this.uint8[Xe+50]=de,this.uint32[$e+13]=me,this.int16[ze+28]=Ae,this.uint8[Xe+58]=Ce,n}}vA.prototype.bytesPerElement=60,je(vA,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class xA extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,s,c,h,p,m,v,b,E,I,P,M,z,F,V,j,K,pe,de,me,Ae,Ce,ze,$e,Xe,tt,Ke,lt,Tt,ct,At,ot){const mt=this.length;return this.resize(mt+1),this.emplace(mt,n,s,c,h,p,m,v,b,E,I,P,M,z,F,V,j,K,pe,de,me,Ae,Ce,ze,$e,Xe,tt,Ke,lt,Tt,ct,At,ot)}emplace(n,s,c,h,p,m,v,b,E,I,P,M,z,F,V,j,K,pe,de,me,Ae,Ce,ze,$e,Xe,tt,Ke,lt,Tt,ct,At,ot,mt){const Ot=20*n,ut=40*n,Ft=80*n;return this.float32[Ot+0]=s,this.float32[Ot+1]=c,this.int16[ut+4]=h,this.int16[ut+5]=p,this.int16[ut+6]=m,this.int16[ut+7]=v,this.int16[ut+8]=b,this.int16[ut+9]=E,this.int16[ut+10]=I,this.int16[ut+11]=P,this.int16[ut+12]=M,this.uint16[ut+13]=z,this.uint16[ut+14]=F,this.uint16[ut+15]=V,this.uint16[ut+16]=j,this.uint16[ut+17]=K,this.uint16[ut+18]=pe,this.uint16[ut+19]=de,this.uint16[ut+20]=me,this.uint16[ut+21]=Ae,this.uint16[ut+22]=Ce,this.uint16[ut+23]=ze,this.uint16[ut+24]=$e,this.uint16[ut+25]=Xe,this.uint16[ut+26]=tt,this.uint16[ut+27]=Ke,this.uint32[Ot+14]=lt,this.float32[Ot+15]=Tt,this.float32[Ot+16]=ct,this.float32[Ot+17]=At,this.float32[Ot+18]=ot,this.uint8[Ft+76]=mt,n}}xA.prototype.bytesPerElement=80,je(xA,"StructArrayLayout2f9i15ui1ul4f1ub80");class rg extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.float32[1*n+0]=s,n}}rg.prototype.bytesPerElement=4,je(rg,"StructArrayLayout1f4");class lp extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,s,c,h,p)}emplace(n,s,c,h,p,m){const v=5*n;return this.float32[v+0]=s,this.float32[v+1]=c,this.float32[v+2]=h,this.float32[v+3]=p,this.float32[v+4]=m,n}}lp.prototype.bytesPerElement=20,je(lp,"StructArrayLayout5f20");class bA extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,h,p,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,n,s,c,h,p,m,v)}emplace(n,s,c,h,p,m,v,b){const E=7*n;return this.float32[E+0]=s,this.float32[E+1]=c,this.float32[E+2]=h,this.float32[E+3]=p,this.float32[E+4]=m,this.float32[E+5]=v,this.float32[E+6]=b,n}}bA.prototype.bytesPerElement=28,je(bA,"StructArrayLayout7f28");class wA extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,c,h)}emplace(n,s,c,h,p){const m=6*n;return this.uint32[3*n+0]=s,this.uint16[m+2]=c,this.uint16[m+3]=h,this.uint16[m+4]=p,n}}wA.prototype.bytesPerElement=12,je(wA,"StructArrayLayout1ul3ui12");class Ky extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint16[1*n+0]=s,n}}Ky.prototype.bytesPerElement=2,je(Ky,"StructArrayLayout1ui2");class Yy extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s){const c=this.length;return this.resize(c+1),this.emplace(c,n,s)}emplace(n,s,c){const h=2*n;return this.float32[h+0]=s,this.float32[h+1]=c,n}}Yy.prototype.bytesPerElement=8,je(Yy,"StructArrayLayout2f8");class TA extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,h,p,m,v,b,E,I,P,M,z,F,V,j){const K=this.length;return this.resize(K+1),this.emplace(K,n,s,c,h,p,m,v,b,E,I,P,M,z,F,V,j)}emplace(n,s,c,h,p,m,v,b,E,I,P,M,z,F,V,j,K){const pe=16*n;return this.float32[pe+0]=s,this.float32[pe+1]=c,this.float32[pe+2]=h,this.float32[pe+3]=p,this.float32[pe+4]=m,this.float32[pe+5]=v,this.float32[pe+6]=b,this.float32[pe+7]=E,this.float32[pe+8]=I,this.float32[pe+9]=P,this.float32[pe+10]=M,this.float32[pe+11]=z,this.float32[pe+12]=F,this.float32[pe+13]=V,this.float32[pe+14]=j,this.float32[pe+15]=K,n}}TA.prototype.bytesPerElement=64,je(TA,"StructArrayLayout16f64");class ab extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,h,p,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,n,s,c,h,p,m,v)}emplace(n,s,c,h,p,m,v,b){const E=10*n,I=5*n;return this.uint16[E+0]=s,this.uint16[E+1]=c,this.uint16[E+2]=h,this.uint16[E+3]=p,this.float32[I+2]=m,this.float32[I+3]=v,this.float32[I+4]=b,n}}ab.prototype.bytesPerElement=20,je(ab,"StructArrayLayout4ui3f20");class EA extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.int16[1*n+0]=s,n}}EA.prototype.bytesPerElement=2,je(EA,"StructArrayLayout1i2");class SA extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint8[1*n+0]=s,n}}SA.prototype.bytesPerElement=1,je(SA,"StructArrayLayout1ub1");class uL extends Xy{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}uL.prototype.size=40;class IA extends gA{get(n){return new uL(this,n)}}je(IA,"CollisionBoxArray");class hL extends Xy{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}hL.prototype.size=60;class dL extends vA{get(n){return new hL(this,n)}}je(dL,"PlacedSymbolArray");class fL extends Xy{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}fL.prototype.size=80;class pL extends xA{get(n){return new fL(this,n)}}je(pL,"SymbolInstanceArray");class mL extends rg{getoffsetX(n){return this.float32[1*n+0]}}je(mL,"GlyphOffsetArray");class gL extends lc{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}je(gL,"SymbolLineVertexArray");class _L extends Xy{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}_L.prototype.size=12;class yL extends wA{get(n){return new _L(this,n)}}je(yL,"FeatureIndexArray");class vL extends md{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}je(vL,"FillExtrusionCentroidArray");class xL extends Xy{get a_join_normal_inside_polygon0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside_polygon1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside_polygon2(){return this._structArray.int16[this._pos2+2]}get a_join_normal_inside_polygon3(){return this._structArray.int16[this._pos2+3]}}xL.prototype.size=8;class bL extends Yu{get(n){return new xL(this,n)}}je(bL,"FillExtrusionWallArray");const XW=Pr([{name:"a_pos",components:2,type:"Int16"}],4),KW=Pr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class pi{constructor(n=[]){this.segments=n}_prepareSegment(n,s,c,h){let p=this.segments[this.segments.length-1];return n>pi.MAX_VERTEX_ARRAY_LENGTH&&_i(`Max vertices per segment is ${pi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!p||p.vertexLength+n>pi.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:s,primitiveOffset:c,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}prepareSegment(n,s,c,h){return this._prepareSegment(n,s.length,c.length,h)}get(){return this.segments}destroy(){for(const n of this.segments)for(const s in n.vaos)n.vaos[s].destroy()}static simpleSegment(n,s,c,h){return new pi([{vertexOffset:n,primitiveOffset:s,vertexLength:c,primitiveLength:h,vaos:{},sortKey:0}])}}function wL(i,n){return 256*(i=Gn(Math.floor(i),0,255))+Gn(Math.floor(n),0,255)}pi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,je(pi,"SegmentVector");const YW=Pr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),QW=Pr([{name:"a_dash",components:4,type:"Uint16"}]);class Qy{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,s,c,h){this.ids.push(TL(n)),this.positions.push(s,c,h)}eachPosition(n,s){const c=TL(n);let h=0,p=this.ids.length-1;for(;h<p;){const m=h+p>>1;this.ids[m]>=c?p=m:h=m+1}for(;this.ids[h]===c;)s(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(n,s){const c=new Float64Array(n.ids),h=new Uint32Array(n.positions);return AA(c,h,0,c.length-1),s&&(s.add(c.buffer),s.add(h.buffer)),{ids:c,positions:h}}static deserialize(n){const s=new Qy;let c;s.ids=n.ids,s.positions=n.positions;for(const h of s.ids)h!==c&&s.uniqueIds.push(h),c=h;return s.indexed=!0,s}}function TL(i){const n=+i;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:Rm(String(i))}function AA(i,n,s,c){for(;s<c;){const h=i[s+c>>1];let p=s-1,m=c+1;for(;;){do p++;while(i[p]<h);do m--;while(i[m]>h);if(p>=m)break;lb(i,p,m),lb(n,3*p,3*m),lb(n,3*p+1,3*m+1),lb(n,3*p+2,3*m+2)}m-s<c-m?(AA(i,n,s,m),s=m+1):(AA(i,n,m+1,c),c=m)}}function lb(i,n,s){const c=i[n];i[n]=i[s],i[s]=c}je(Qy,"FeaturePositionMap");class Qu{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,s),this.initialized=!0),!!this.location}set(n,s,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class cb extends Qu{constructor(n){super(n),this.current=0}set(n,s,c){this.fetchUniformLocation(n,s)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class Lo extends Qu{constructor(n){super(n),this.current=0}set(n,s,c){this.fetchUniformLocation(n,s)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Ju extends Qu{constructor(n){super(n),this.current=[0,0]}set(n,s,c){this.fetchUniformLocation(n,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class CA extends Qu{constructor(n){super(n),this.current=[0,0,0]}set(n,s,c){this.fetchUniformLocation(n,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class PA extends Qu{constructor(n){super(n),this.current=[0,0,0,0]}set(n,s,c){this.fetchUniformLocation(n,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class EL extends Qu{constructor(n){super(n),this.current=wr.transparent.toRenderColor(null)}set(n,s,c){this.fetchUniformLocation(n,s)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const JW=new Float32Array(16);class Jy extends Qu{constructor(n){super(n),this.current=JW}set(n,s,c){if(this.fetchUniformLocation(n,s)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let h=1;h<16;h++)if(c[h]!==this.current[h]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const eH=new Float32Array(9),tH=new Float32Array(4);class RA extends Qu{constructor(n){super(n),this.current=tH}set(n,s,c){if(this.fetchUniformLocation(n,s)){for(let h=0;h<4;h++)if(c[h]!==this.current[h]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function MA(i){return[wL(255*i.r,255*i.g),wL(255*i.b,255*i.a)]}class e0{constructor(n,s,c,h){this.value=n,this.uniformNames=s.map(p=>`u_${p}`),this.type=c,this.context=h}setUniform(n,s,c,h,p){const m=h.constantOr(this.value);s.set(n,p,m instanceof wr?m.toRenderColor(this.context.lut):m)}getBinding(n,s){return this.type==="color"?new EL(n):new Lo(n)}}class ig{constructor(n,s){this.uniformNames=s.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(n){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br)}setUniform(n,s,c,h,p){const m=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;m&&s.set(n,p,m)}getBinding(n,s){return s==="u_pattern"||s==="u_dash"?new PA(n):new Lo(n)}}class eh{constructor(n,s,c,h){this.expression=n,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(p=>({name:`a_${p}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(n,s,c,h,p,m,v){const b=this.paintVertexArray.length,E=this.expression.evaluate(new An(0,{brightness:m}),s,{},p,h,v);this.paintVertexArray.resize(n),this._setPaintValue(b,n,E,this.context)}updatePaintArray(n,s,c,h,p,m,v){const b=this.expression.evaluate({zoom:0,brightness:v},c,h,void 0,p);this._setPaintValue(n,s,b,this.context)}_setPaintValue(n,s,c,h){if(this.type==="color"){const p=MA(c.toRenderColor(h.lut));for(let m=n;m<s;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=n;p<s;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cc{constructor(n,s,c,h,p,m){this.expression=n,this.uniformNames=s.map(v=>`u_${v}_t`),this.type=c,this.useIntegerZoom=h,this.context=p,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(n,s,c,h,p,m,v){const b=this.expression.evaluate(new An(this.context.zoom,{brightness:m}),s,{},p,h,v),E=this.expression.evaluate(new An(this.context.zoom+1,{brightness:m}),s,{},p,h,v),I=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(I,n,b,E,this.context)}updatePaintArray(n,s,c,h,p,m,v){const b=this.expression.evaluate({zoom:this.context.zoom,brightness:v},c,h,void 0,p),E=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v},c,h,void 0,p);this._setPaintValue(n,s,b,E,this.context)}_setPaintValue(n,s,c,h,p){if(this.type==="color"){const m=MA(c.toRenderColor(p.lut)),v=MA(c.toRenderColor(p.lut));for(let b=n;b<s;b++)this.paintVertexArray.emplace(b,m[0],m[1],v[0],v[1])}else{for(let m=n;m<s;m++)this.paintVertexArray.emplace(m,c,h);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(h))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,s,c,h,p){const m=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,v=Gn(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);s.set(n,p,v)}getBinding(n,s){return new Lo(n)}}class gd{constructor(n,s,c,h,p){this.expression=n,this.layerId=p,this.paintVertexAttributes=(c==="array"?QW:YW).members;for(let m=0;m<s.length;++m);this.paintVertexArray=new h}populatePaintArray(n,s,c,h){const p=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(p,n,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(n,s,c,h,p,m,v){this._setPaintValues(n,s,c.patterns&&c.patterns[this.layerId],m)}_setPaintValues(n,s,c,h){if(!h||!c)return;const p=h[c];if(!p)return;const{tl:m,br:v,pixelRatio:b}=p;for(let E=n;E<s;E++)this.paintVertexArray.emplace(E,m[0],m[1],v[0],v[1],b)}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cp{constructor(n,s,c=()=>!0){this.binders={},this._buffers=[],this.context=s;const h=[];for(const p in n.paint._values){const m=n.paint.get(p);if(!c(p)||!(m instanceof Ms&&S(m.property.specification)))continue;const v=rH(p,n.type),b=m.value,E=m.property.specification.type,I=!!m.property.useIntegerZoom,P=p==="line-dasharray"||p.endsWith("pattern"),M=p==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||M)if(b.kind==="source"||M||P){const z=SL(p,E,"source");this.binders[p]=P?new gd(b,v,E,z,n.id):new eh(b,v,E,z),h.push(`/a_${p}`)}else{const z=SL(p,E,"composite");this.binders[p]=new cc(b,v,E,I,s,z),h.push(`/z_${p}`)}else this.binders[p]=P?new ig(b.value,v):new e0(b.value,v,E,s),h.push(`/u_${p}`)}this.cacheKey=h.sort().join("")}getMaxValue(n){const s=this.binders[n];return s instanceof eh||s instanceof cc?s.maxValue:0}populatePaintArrays(n,s,c,h,p,m,v){for(const b in this.binders){const E=this.binders[b];E.context=this.context,(E instanceof eh||E instanceof cc||E instanceof gd)&&E.populatePaintArray(n,s,c,h,p,m,v)}}setConstantPatternPositions(n){for(const s in this.binders){const c=this.binders[s];c instanceof ig&&c.setConstantPatternPositions(n)}}updatePaintArrays(n,s,c,h,p,m,v,b){let E=!1;const I=Object.keys(n),P=I.length!==0,M=P?I:s.uniqueIds;this.context.lut=p.lut;for(const z in this.binders){const F=this.binders[z];if(F.context=this.context,(F instanceof eh||F instanceof cc||F instanceof gd)&&(F.expression.isStateDependent===!0||F.expression.isLightConstant===!1)){const V=p.paint.get(z);F.expression=V.value;for(const j of M){const K=n[j.toString()];s.eachPosition(j,(pe,de,me)=>{const Ae=h.feature(pe);F.updatePaintArray(de,me,Ae,K,m,v,b)})}if(!P)for(const j of c.uniqueIds){const K=n[j.toString()];c.eachPosition(j,(pe,de,me)=>{const Ae=h.feature(pe);F.updatePaintArray(de,me,Ae,K,m,v,b)})}E=!0}}return E}defines(){const n=[];for(const s in this.binders){const c=this.binders[s];(c instanceof e0||c instanceof ig)&&n.push(...c.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return n}getBinderAttributes(){const n=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof eh||c instanceof cc||c instanceof gd)for(let h=0;h<c.paintVertexAttributes.length;h++)n.push(c.paintVertexAttributes[h].name)}return n}getBinderUniforms(){const n=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof e0||c instanceof ig||c instanceof cc)for(const h of c.uniformNames)n.push(h)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const s=[];for(const c in this.binders){const h=this.binders[c];if(h instanceof e0||h instanceof ig||h instanceof cc)for(const p of h.uniformNames)s.push({name:p,property:c,binding:h.getBinding(n,p)})}return s}setUniforms(n,s,c,h,p){for(const{name:m,property:v,binding:b}of c)this.binders[v].setUniform(n,b,p,h.get(v),m)}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const s=this.binders[n];(s instanceof eh||s instanceof cc||s instanceof gd)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(n){for(const s in this.binders){const c=this.binders[s];(c instanceof eh||c instanceof cc||c instanceof gd)&&c.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const s=this.binders[n];(s instanceof eh||s instanceof cc||s instanceof gd)&&s.destroy()}}}class _d{constructor(n,s,c=()=>!0){this.programConfigurations={};for(const h of n)this.programConfigurations[h.id]=new cp(h,s,c);this.needsUpload=!1,this._featureMap=new Qy,this._featureMapWithoutIds=new Qy,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,s,c,h,p,m,v,b){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(n,s,h,p,m,v,b);s.id!==void 0?this._featureMap.add(s.id,c,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,s,c,h,p,m){for(const v of c)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,s,v,h,p,m||0)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const nH={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function rH(i,n){return nH[i]||[i.replace(`${n}-`,"").replace(/-/g,"_")]}const iH={"line-pattern":{source:pd,composite:pd},"fill-pattern":{source:pd,composite:pd},"fill-extrusion-pattern":{source:pd,composite:pd},"line-dasharray":{source:ib,composite:ib}},sH={color:{source:Yy,composite:dd},number:{source:rg,composite:Yy}};function SL(i,n,s){const c=iH[i];return c&&c[s]||sH[n][s]}je(e0,"ConstantBinder"),je(ig,"PatternConstantBinder"),je(eh,"SourceExpressionBinder"),je(gd,"PatternCompositeBinder"),je(cc,"CompositeExpressionBinder"),je(cp,"ProgramConfiguration",{omit:["_buffers"]}),je(_d,"ProgramConfigurationSet");const zo=Lt/Math.PI/2,kA=5,IL=6,oH=16383,sg=64,DA=[sg,32,16],xl=-zo,bl=zo;function og(i,n,s,c=zo){return s=Qn(s),[i*Math.sin(s)*c,-n*c,i*Math.cos(s)*c]}function up(i,n,s){return og(Math.cos(Qn(i)),Math.sin(Qn(i)),n,s)}const ag=63710088e-1,OA=2*Math.PI*ag;class yr{constructor(n,s){if(isNaN(n)||isNaN(s))throw new Error(`Invalid LngLat object: (${n}, ${s})`);if(this.lng=+n,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new yr(Zl(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const s=Math.PI/180,c=this.lat*s,h=n.lat*s,p=Math.sin(c)*Math.sin(h)+Math.cos(c)*Math.cos(h)*Math.cos((n.lng-this.lng)*s);return ag*Math.acos(Math.min(p,1))}toBounds(n=0){const s=360*n/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new yd({lng:this.lng-c,lat:this.lat-s},{lng:this.lng+c,lat:this.lat+s})}toEcef(n){return up(this.lat,this.lng,zo+n*zo/ag)}static convert(n){if(n instanceof yr)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new yr(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new yr(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class yd{constructor(n,s){if(n)if(s)this.setSouthWest(n).setNorthEast(s);else if(n.length===4){const c=n;this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]])}else{const c=n;this.setSouthWest(c[0]).setNorthEast(c[1])}}setNorthEast(n){return this._ne=n instanceof yr?new yr(n.lng,n.lat):yr.convert(n),this}setSouthWest(n){return this._sw=n instanceof yr?new yr(n.lng,n.lat):yr.convert(n),this}extend(n){const s=this._sw,c=this._ne;let h,p;if(n instanceof yr)h=n,p=n;else{if(!(n instanceof yd))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(yd.convert(n)):this.extend(yr.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(yr.convert(n)):this;if(h=n._sw,p=n._ne,!h||!p)return this}return s||c?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),c.lng=Math.max(p.lng,c.lng),c.lat=Math.max(p.lat,c.lat)):(this._sw=new yr(h.lng,h.lat),this._ne=new yr(p.lng,p.lat)),this}getCenter(){return new yr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new yr(this.getWest(),this.getNorth())}getSouthEast(){return new yr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:s,lat:c}=yr.convert(n);let h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&h}static convert(n){return!n||n instanceof yd?n:new yd(n)}}var AL={};(function(i,n){(function(s){function c(p,m,v){var b=h(256*p,256*(m=Math.pow(2,v)-m-1),v),E=h(256*(p+1),256*(m+1),v);return b[0]+","+b[1]+","+E[0]+","+E[1]}function h(p,m,v){var b=2*Math.PI*6378137/256/Math.pow(2,v);return[p*b-2*Math.PI*6378137/2,m*b-2*Math.PI*6378137/2]}s.getURL=function(p,m,v,b,E,I){return I=I||{},p+"?"+["bbox="+c(v,b,E),"format="+(I.format||"image/png"),"service="+(I.service||"WMS"),"version="+(I.version||"1.1.1"),"request="+(I.request||"GetMap"),"srs="+(I.srs||"EPSG:3857"),"width="+(I.width||256),"height="+(I.height||256),"layers="+m].join("&")},s.getTileBBox=c,s.getMercCoords=h,Object.defineProperty(s,"__esModule",{value:!0})})(n)})(0,AL);var aH=AL;class hp{constructor(n,s,c){this.z=n,this.x=s,this.y=c,this.key=lg(0,n,n,s,c)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,s){const c=aH.getTileBBox(this.x,this.y,this.z),h=function(p,m,v){let b,E="";for(let I=p;I>0;I--)b=1<<I-1,E+=(m&b?1:0)+(v&b?2:0);return E}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class CL{constructor(n,s){this.wrap=n,this.canonical=s,this.key=lg(n,s.z,s.z,s.x,s.y)}}class ds{constructor(n,s,c,h,p){this.overscaledZ=n,this.wrap=s,this.canonical=new hp(c,+h,+p),this.key=s===0&&n===c?this.canonical.key:lg(s,n,c,h,p)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const s=this.canonical.z-n;return n>this.canonical.z?new ds(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ds(n,this.wrap,n,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(n,s=!0){if(this.overscaledZ===n&&s)return this.key;if(n>this.canonical.z)return lg(this.wrap*+s,n,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-n;return lg(this.wrap*+s,n,n,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const s=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>s&&n.canonical.y===this.canonical.y>>s}children(n){if(this.overscaledZ>=n)return[new ds(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,h=2*this.canonical.y;return[new ds(s,this.wrap,s,c,h),new ds(s,this.wrap,s,c+1,h),new ds(s,this.wrap,s,c,h+1),new ds(s,this.wrap,s,c+1,h+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new ds(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new ds(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new CL(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function lg(i,n,s,c,h){const p=1<<Math.min(s,22);let m=p*(h%p)+c%p;return i&&s<22&&(m+=p*p*((i<0?-2*i-1:2*i)%(1<<2*(22-s)))),16*(32*m+s)+(n-s)}const lH=[i=>{let n=i.canonical.x-1,s=i.wrap;return n<0&&(n=(1<<i.canonical.z)-1,s--),new ds(i.overscaledZ,s,i.canonical.z,n,i.canonical.y)},i=>{let n=i.canonical.x+1,s=i.wrap;return n===1<<i.canonical.z&&(n=0,s++),new ds(i.overscaledZ,s,i.canonical.z,n,i.canonical.y)},i=>new ds(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,(i.canonical.y===0?1<<i.canonical.z:i.canonical.y)-1),i=>new ds(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y===(1<<i.canonical.z)-1?0:i.canonical.y+1)];je(hp,"CanonicalTileID"),je(ds,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const cH=0,uH=25.5;function LA(i){return OA*Math.cos(i*Math.PI/180)}function Kc(i){return(180+i)/360}function Yc(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function No(i,n){return i/LA(n)}function ca(i){return 360*i-180}function Vs(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function PL(i,n){return i*LA(Vs(n))}const Ui=85.051129;function RL(i){return Math.cos(Qn(Gn(i,-Ui,Ui)))}function dp(i,n){const s=Gn(n,cH,uH),c=Math.pow(2,s);return RL(i)*OA/(512*c)}function ML(i){return 1/Math.cos(i*Math.PI/180)}function ub(i,n=0){const s=Math.exp(Math.PI*(1-(i.y+n/Lt)/(1<<i.z)*2));return 80150034*s/(s*s+1)/Lt/(1<<i.z)}class fo{constructor(n,s,c=0){this.x=+n,this.y=+s,this.z=+c}static fromLngLat(n,s=0){const c=yr.convert(n);return new fo(Kc(c.lng),Yc(c.lat),No(s,c.lat))}toLngLat(){return new yr(ca(this.x),Vs(this.y))}toAltitude(){return PL(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/OA*ML(Vs(this.y))}}function zA(i,n,s,c,h,p,m,v,b){const E=(n+c)/2,I=(s+h)/2,P=new Nt(E,I);v(P),function(M,z,F,V,j,K){const pe=F-j,de=V-K;return Math.abs((V-z)*pe-(F-M)*de)/Math.hypot(pe,de)}(P.x,P.y,p.x,p.y,m.x,m.y)>=b?(zA(i,n,s,E,I,p,P,v,b),zA(i,E,I,c,h,P,m,v,b)):i.push(m)}function kL(i,n,s){let c=i[0],h=c.x,p=c.y;n(c);const m=[c];for(let v=1;v<i.length;v++){const b=i[v],{x:E,y:I}=b;n(b),zA(m,h,p,E,I,c,b,n,s),h=E,p=I,c=b}return m}function NA(i,n,s,c){if(c(n,s)){const h=n.add(s)._mult(.5);NA(i,n,h,c),NA(i,h,s,c)}else i.push(s)}function hH(i,n){let s=i[0];const c=[s];for(let h=1;h<i.length;h++){const p=i[h];NA(c,s,p,n),s=p}return c}const FA=Math.pow(2,14)-1,DL=-FA-1;function dH(i,n){const s=Math.round(i.x*n),c=Math.round(i.y*n);return i.x=Gn(s,DL,FA),i.y=Gn(c,DL,FA),(s<i.x||s>i.x+1||c<i.y||c>i.y+1)&&_i("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function uc(i,n,s){const c=i.loadGeometry(),h=i.extent,p=Lt/h;if(n&&s&&s.projection.isReprojectedInTileSpace){const m=1<<n.z,{scale:v,x:b,y:E,projection:I}=s,P=M=>{const z=ca((n.x+M.x/h)/m),F=Vs((n.y+M.y/h)/m),V=I.project(z,F);M.x=(V.x*v-b)*h,M.y=(V.y*v-E)*h};for(let M=0;M<c.length;M++)if(i.type!==1)c[M]=kL(c[M],P,1);else{const z=[];for(const F of c[M])F.x<0||F.x>=h||F.y<0||F.y>=h||(P(F),z.push(F));c[M]=z}}for(const m of c)for(const v of m)dH(v,p);return c}function th(i,n){return{type:i.type,id:i.id,properties:i.properties,geometry:n?uc(i):[]}}function hb(i,n,s,c,h){i.emplaceBack(2*n+(c+1)/2,2*s+(h+1)/2)}function db(i,n,s){i.emplaceBack(n.x,n.y,n.z,s[0]*16384,s[1]*16384,s[2]*16384)}class BA{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new lc,this.indexArray=new ks,this.segments=new pi,this.programConfigurations=new _d(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}updateFootprints(n,s){}populate(n,s,c,h){const p=this.layers[0],m=[];let v=null;p.type==="circle"&&(v=p.layout.get("circle-sort-key"));for(const{feature:E,id:I,index:P,sourceLayerIndex:M}of n){const z=this.layers[0]._featureFilter.needGeometry,F=th(E,z);if(!this.layers[0]._featureFilter.filter(new An(this.zoom),F,c))continue;const V=v?v.evaluate(F,{},c):void 0,j={id:I,properties:E.properties,type:E.type,sourceLayerIndex:M,index:P,geometry:z?F.geometry:uc(E,c,h),patterns:{},sortKey:V};m.push(j)}v&&m.sort((E,I)=>E.sortKey-I.sortKey);let b=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new sb,b=h.projection);for(const E of m){const{geometry:I,index:P,sourceLayerIndex:M}=E,z=n[P].feature;this.addFeature(E,I,P,s.availableImages,c,b,s.brightness),s.featureIndex.insert(z,I,P,M,this.index)}}update(n,s,c,h,p){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,s,m?this.stateDependentLayers:this.layers,c,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,XW.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,KW.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,s,c,h,p,m,v){for(const b of s)for(const E of b){const I=E.x,P=E.y;if(I<0||I>=Lt||P<0||P>=Lt)continue;if(m){const F=m.projectTilePoint(I,P,p),V=m.upVector(p,I,P),j=this.globeExtVertexArray;db(j,F,V),db(j,F,V),db(j,F,V),db(j,F,V)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),z=M.vertexLength;hb(this.layoutVertexArray,I,P,-1,-1),hb(this.layoutVertexArray,I,P,1,-1),hb(this.layoutVertexArray,I,P,1,1),hb(this.layoutVertexArray,I,P,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+2,z+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,{},h,p,v)}}function UA(i,n){for(let s=0;s<i.length;s++)if(vd(n,i[s]))return!0;for(let s=0;s<n.length;s++)if(vd(i,n[s]))return!0;return!!VA(i,n)}function fH(i,n,s){return!!vd(i,n)||!!jA(n,i,s)}function OL(i,n){if(i.length===1)return zL(n,i[0]);for(let s=0;s<n.length;s++){const c=n[s];for(let h=0;h<c.length;h++)if(vd(i,c[h]))return!0}for(let s=0;s<i.length;s++)if(zL(n,i[s]))return!0;for(let s=0;s<n.length;s++)if(VA(i,n[s]))return!0;return!1}function pH(i,n,s){if(i.length>1){if(VA(i,n))return!0;for(let c=0;c<n.length;c++)if(jA(n[c],i,s))return!0}for(let c=0;c<i.length;c++)if(jA(i[c],n,s))return!0;return!1}function VA(i,n){if(i.length===0||n.length===0)return!1;for(let s=0;s<i.length-1;s++){const c=i[s],h=i[s+1];for(let p=0;p<n.length-1;p++)if(mH(c,h,n[p],n[p+1]))return!0}return!1}function mH(i,n,s,c){return Jo(i,s,c)!==Jo(n,s,c)&&Jo(i,n,s)!==Jo(i,n,c)}function jA(i,n,s){const c=s*s;if(n.length===1)return i.distSqr(n[0])<c;for(let h=1;h<n.length;h++)if(LL(i,n[h-1],n[h])<c)return!0;return!1}function LL(i,n,s){const c=n.distSqr(s);if(c===0)return i.distSqr(n);const h=((i.x-n.x)*(s.x-n.x)+(i.y-n.y)*(s.y-n.y))/c;return i.distSqr(h<0?n:h>1?s:s.sub(n)._mult(h)._add(n))}function zL(i,n){let s,c,h,p=!1;for(let m=0;m<i.length;m++){s=i[m];for(let v=0,b=s.length-1;v<s.length;b=v++)c=s[v],h=s[b],c.y>n.y!=h.y>n.y&&n.x<(h.x-c.x)*(n.y-c.y)/(h.y-c.y)+c.x&&(p=!p)}return p}function vd(i,n){let s=!1;for(let c=0,h=i.length-1;c<i.length;h=c++){const p=i[c],m=i[h];p.y>n.y!=m.y>n.y&&n.x<(m.x-p.x)*(n.y-p.y)/(m.y-p.y)+p.x&&(s=!s)}return s}function NL(i,n,s,c,h){for(const m of i)if(n<=m.x&&s<=m.y&&c>=m.x&&h>=m.y)return!0;const p=[new Nt(n,s),new Nt(n,h),new Nt(c,h),new Nt(c,s)];if(i.length>2){for(const m of p)if(vd(i,m))return!0}for(let m=0;m<i.length-1;m++)if(gH(i[m],i[m+1],p))return!0;return!1}function gH(i,n,s){const c=s[0],h=s[2];if(i.x<c.x&&n.x<c.x||i.x>h.x&&n.x>h.x||i.y<c.y&&n.y<c.y||i.y>h.y&&n.y>h.y)return!1;const p=Jo(i,n,s[0]);return p!==Jo(i,n,s[1])||p!==Jo(i,n,s[2])||p!==Jo(i,n,s[3])}function cg(i,n,s,c,h,p){let m=n.y-i.y,v=i.x-n.x;if(p=p||0){const b=m*m+v*v;if(b===0)return!0;const E=Math.sqrt(b);m/=E,v/=E}return!((s.x-i.x)*m+(s.y-i.y)*v-p<0||(c.x-i.x)*m+(c.y-i.y)*v-p<0||(h.x-i.x)*m+(h.y-i.y)*v-p<0)}function $A(i,n,s,c,h,p,m){return!(cg(i,n,c,h,p,m)||cg(n,s,c,h,p,m)||cg(s,i,c,h,p,m)||cg(c,h,i,n,s,m)||cg(h,p,i,n,s,m)||cg(p,c,i,n,s,m))}function ug(i,n,s){const c=n.paint.get(i).value;return c.kind==="constant"?c.value:s.programConfigurations.get(n.id).getMaxValue(i)}function fb(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function FL(i,n,s,c,h){if(!n[0]&&!n[1])return i;const p=Nt.convert(n)._mult(h);s==="viewport"&&p._rotate(-c);const m=[];for(let v=0;v<i.length;v++)m.push(i[v].sub(p));return m}function BL(i,n,s,c){const h=Nt.convert(i)._mult(c);return n==="viewport"&&h._rotate(-s),h}let UL,VL;je(BA,"CircleBucket",{omit:["layers"]});class GA{constructor(n,s){this.pos=n,this.dir=s}intersectsPlane(n,s,c){const h=a.$.dot(s,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((n[0]-this.pos[0])*s[0]+(n[1]-this.pos[1])*s[1]+(n[2]-this.pos[2])*s[2])/h;return c[0]=this.pos[0]+this.dir[0]*p,c[1]=this.pos[1]+this.dir[1]*p,c[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(n,s,c){if(a.$.equals(this.pos,n)||s===0)return c[0]=c[1]=c[2]=0,!1;const[h,p,m]=this.dir,v=this.pos[0]-n[0],b=this.pos[1]-n[1],E=this.pos[2]-n[2],I=h*h+p*p+m*m,P=2*(v*h+b*p+E*m),M=P*P-4*I*(v*v+b*b+E*E-s*s);if(M<0){const z=Math.max(-P/2,0),F=v+h*z,V=b+p*z,j=E+m*z,K=Math.hypot(F,V,j);return c[0]=F*s/K,c[1]=V*s/K,c[2]=j*s/K,!1}{const z=(-P-Math.sqrt(M))/(2*I);if(z<0){const F=Math.hypot(v,b,E);return c[0]=v*s/F,c[1]=b*s/F,c[2]=E*s/F,!1}return c[0]=v+h*z,c[1]=b+p*z,c[2]=E+m*z,!0}}}class qA{constructor(n,s,c,h,p){this.TL=n,this.TR=s,this.BR=c,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(n,s,c){const h=[-1,1,1],p=[1,1,1],m=[1,-1,1],v=[-1,-1,1],b=a.$.transformMat4(h,h,n),E=a.$.transformMat4(p,p,n),I=a.$.transformMat4(m,m,n),P=a.$.transformMat4(v,v,n);return new qA(b,E,I,P,s/c)}}function t0(i,n,s){let c=1/0,h=-1/0;const p=[];for(const m of i){a.$.sub(p,m,n);const v=a.$.dot(p,s);c=Math.min(c,v),h=Math.max(h,v)}return[c,h]}function jL(i,n){let s=!0;for(let c=0;c<i.planes.length;c++){const h=i.planes[c];let p=0;for(let m=0;m<n.length;m++)p+=a.$.dot(h,n[m])+h[3]>=0;if(p===0)return 0;p!==n.length&&(s=!1)}return s?2:1}function $L(i,n){for(const s of i.projections){const c=t0(n,i.points[0],s.axis);if(s.projection[1]<c[0]||s.projection[0]>c[1])return 0}return 1}function GL(i,n){let s=0;const c=[0,0,0,0];for(let h=0;h<i.length;h++)c[0]=i[h][0],c[1]=i[h][1],c[2]=i[h][2],c[3]=1,a.aB.dot(c,n)>=0&&s++;return s}class WA{constructor(n,s){this.points=n||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=li.fromPoints(this.points),this.projections=[],this.frustumEdges=[a.$.sub([],this.points[2],this.points[3]),a.$.sub([],this.points[0],this.points[3]),a.$.sub([],this.points[4],this.points[0]),a.$.sub([],this.points[5],this.points[1]),a.$.sub([],this.points[6],this.points[2]),a.$.sub([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const h=[0,-c[2],c[1]],p=[c[2],0,-c[0]];this.projections.push({axis:h,projection:t0(this.points,this.points[0],h)}),this.projections.push({axis:p,projection:t0(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(n,s,c,h){const p=Math.pow(2,c),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const I=a.aB.transformMat4([],E,n),P=1/I[3]/s*p;return a.aB.mul(I,I,[P,P,h?1/I[3]:P,P])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const I=a.$.sub([],m[E[0]],m[E[1]]),P=a.$.sub([],m[E[2]],m[E[1]]),M=a.$.normalize([],a.$.cross([],I,P)),z=-a.$.dot(M,m[E[1]]);return M.concat(z)}),b=[];for(let E=0;E<m.length;E++)b.push([m[E][0],m[E][1],m[E][2]]);return new WA(b,v)}intersectsPrecise(n,s,c){for(let h=0;h<s.length;h++)if(!GL(n,s[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!GL(n,this.planes[h]))return 0;for(const h of c)for(const p of this.frustumEdges){const m=a.$.cross([],h,p),v=a.$.length(m);if(v===0)continue;a.$.scale(m,m,1/v);const b=t0(this.points,this.points[0],m),E=t0(n,this.points[0],m);if(b[0]>E[1]||E[0]>b[1])return 0}return 1}containsPoint(n){for(const s of this.planes){const c=s[3];if(a.$.dot([s[0],s[1],s[2]],n)+c<0)return!1}return!0}}class li{static fromPoints(n){const s=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const h of n)a.$.min(s,s,h),a.$.max(c,c,h);return new li(s,c)}static fromTileIdAndHeight(n,s,c){const h=1<<n.canonical.z,p=n.canonical.x,m=n.canonical.y;return new li([p/h,m/h,s],[(p+1)/h,(m+1)/h,c])}static applyTransform(n,s){const c=n.getCorners();for(let h=0;h<c.length;++h)a.$.transformMat4(c[h],c[h],s);return li.fromPoints(c)}static applyTransformFast(n,s){const c=[s[12],s[13],s[14]],h=[...c];for(let p=0;p<3;p++)for(let m=0;m<3;m++){const v=s[4*m+p],b=v*n.min[m],E=v*n.max[m];c[p]+=Math.min(b,E),h[p]+=Math.max(b,E)}return new li(c,h)}static projectAabbCorners(n,s){const c=n.getCorners();for(let h=0;h<c.length;++h)a.$.transformMat4(c[h],c[h],s);return c}constructor(n,s){this.min=n,this.max=s,this.center=a.$.scale([],a.$.add([],this.min,this.max),.5)}quadrant(n){const s=[n%2==0,n<2],c=a.$.clone(this.min),h=a.$.clone(this.max);for(let p=0;p<s.length;p++)c[p]=s[p]?this.min[p]:this.center[p],h[p]=s[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new li(c,h)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,s=this.max;return[[n[0],n[1],n[2]],[s[0],n[1],n[2]],[s[0],s[1],n[2]],[n[0],s[1],n[2]],[n[0],n[1],s[2]],[s[0],n[1],s[2]],[s[0],s[1],s[2]],[n[0],s[1],s[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?jL(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?jL(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,s){return s||this.intersects(n)?$L(n,this.getCorners()):0}intersectsPreciseFlat(n,s){return s||this.intersectsFlat(n)?$L(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let s=0;s<3;++s)if(this.min[s]>n.max[s]||n.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],n.min[s]),this.max[s]=Math.max(this.max[s],n.max[s])}encapsulatePoint(n){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],n[s]),this.max[s]=Math.max(this.max[s],n[s])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}je(li,"Aabb");const _H=Pr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:pb}=_H,qL=Pr([{name:"a_pos_3",components:3,type:"Int16"}]);var n0=Pr([{name:"a_pos",type:"Int16",components:2}]);function mb(i){return i*zo/ag}const yH=[new li([xl,xl,xl],[bl,bl,bl]),new li([xl,xl,xl],[0,0,bl]),new li([0,xl,xl],[bl,0,bl]),new li([xl,0,xl],[0,bl,bl]),new li([0,0,xl],[bl,bl,bl])];function WL(i,n,s,c=!0){const h=a.$.scale([],i._camera.position,i.worldSize),p=[n,s,1,1];a.aB.transformMat4(p,p,i.pixelMatrixInverse),a.aB.scale(p,p,1/p[3]);const m=a.$.sub([],p,h),v=a.$.normalize([],m),b=i.globeMatrix,E=[b[12],b[13],b[14]],I=a.$.sub([],E,h),P=a.$.length(I),M=a.$.normalize([],I),z=i.worldSize/(2*Math.PI),F=a.$.dot(M,v),V=Math.asin(z/P);if(V<Math.acos(F)){if(!c)return null;const Ke=[],lt=[];a.$.scale(Ke,v,P/F),a.$.normalize(lt,a.$.sub(lt,Ke,I)),a.$.normalize(v,a.$.add(v,I,a.$.scale(v,lt,Math.tan(V)*P)))}const j=[];new GA(h,v).closestPointOnSphere(E,z,j);const K=a.$.normalize([],R(b,0)),pe=a.$.normalize([],R(b,1)),de=a.$.normalize([],R(b,2)),me=a.$.dot(K,j),Ae=a.$.dot(pe,j),Ce=a.$.dot(de,j),ze=Xs(Math.asin(-Ae/z));let $e=Xs(Math.atan2(me,Ce));$e=i.center.lng+function(Ke,lt){const Tt=(lt-Ke+180)%360-180;return Tt<-180?Tt+360:Tt}(i.center.lng,$e);const Xe=Kc($e),tt=Gn(Yc(ze),0,1);return new fo(Xe,tt)}class vH{constructor(n,s,c){this.a=a.$.sub([],n,c),this.b=a.$.sub([],s,c),this.center=c;const h=a.$.normalize([],this.a),p=a.$.normalize([],this.b);this.angle=Math.acos(a.$.dot(h,p))}}function HA(i,n){if(i.angle===0)return null;let s;return s=i.a[n]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[n]/i.a[n]/Math.sin(i.angle)-1/Math.tan(i.angle)),s<0||s>1?null:function(c,h,p,m){const v=Math.sin(p);return c*(Math.sin((1-m)*p)/v)+h*(Math.sin(m*p)/v)}(i.a[n],i.b[n],i.angle,Gn(s,0,1))+i.center[n]}function Qc(i){if(i.z<=1)return yH[i.z+2*i.y+i.x];const n=ZA(gb(i));return li.fromPoints(n)}function nh(i,n,s){return a.$.scale(i,i,1-s),a.$.scaleAndAdd(i,i,n,s)}function HL(i,n){const s=rh(n.zoom);if(s===0)return Qc(i);const c=gb(i),h=ZA(c),p=Kc(c.getWest())*n.worldSize,m=Kc(c.getEast())*n.worldSize,v=Yc(c.getNorth())*n.worldSize,b=Yc(c.getSouth())*n.worldSize,E=[p,v,0],I=[m,v,0],P=[p,b,0],M=[m,b,0],z=a.ae.invert([],n.globeMatrix);return a.$.transformMat4(E,E,z),a.$.transformMat4(I,I,z),a.$.transformMat4(P,P,z),a.$.transformMat4(M,M,z),h[0]=nh(h[0],P,s),h[1]=nh(h[1],M,s),h[2]=nh(h[2],I,s),h[3]=nh(h[3],E,s),li.fromPoints(h)}function ZL(i,n,s){for(const c of i)a.$.transformMat4(c,c,n),a.$.scale(c,c,s)}function XL(i,n,s,c){const h=n/i.worldSize,p=i.globeMatrix;if(s.z<=1){const Xe=Qc(s).getCorners();return ZL(Xe,p,h),li.fromPoints(Xe)}const m=gb(s,c),v=ZA(m,zo+mb(i._tileCoverLift));ZL(v,p,h);const b=Number.MAX_VALUE,E=[-b,-b,-b],I=[b,b,b];if(m.contains(i.center)){for(const Ke of v)a.$.min(I,I,Ke),a.$.max(E,E,Ke);E[2]=0;const Xe=i.point,tt=[Xe.x*h,Xe.y*h,0];return a.$.min(I,I,tt),a.$.max(E,E,tt),new li(I,E)}if(i._tileCoverLift>0){for(const Xe of v)a.$.min(I,I,Xe),a.$.max(E,E,Xe);return new li(I,E)}const P=[p[12]*h,p[13]*h,p[14]*h],M=m.getCenter(),z=Gn(i.center.lat,-Ui,Ui),F=Gn(M.lat,-Ui,Ui),V=Kc(i.center.lng),j=Yc(z);let K=V-Kc(M.lng);const pe=j-Yc(F);K>.5?K-=1:K<-.5&&(K+=1);let de=0;if(Math.abs(K)>Math.abs(pe))de=K>=0?1:3;else{de=pe>=0?0:2;const Xe=[p[4]*h,p[5]*h,p[6]*h],tt=-Math.sin(Qn(pe>=0?m.getSouth():m.getNorth()))*zo;a.$.scaleAndAdd(P,P,Xe,tt)}const me=v[de],Ae=v[(de+1)%4],Ce=new vH(me,Ae,P),ze=[HA(Ce,0)||me[0],HA(Ce,1)||me[1],HA(Ce,2)||me[2]],$e=rh(i.zoom);if($e>0){const Xe=function({x:Ke,y:lt,z:Tt},ct,At,ot,mt){const Ot=1/(1<<Tt);let ut=Ke*Ot,Ft=ut+Ot,Dt=lt*Ot,Et=Dt+Ot,gn=0;const cn=(ut+Ft)/2-ot;return cn>.5?gn=-1:cn<-.5&&(gn=1),ut=((ut+gn)*ct-(ot*=ct))*At+ot,Ft=((Ft+gn)*ct-ot)*At+ot,Dt=(Dt*ct-(mt*=ct))*At+mt,Et=(Et*ct-mt)*At+mt,[[ut,Et,0],[Ft,Et,0],[Ft,Dt,0],[ut,Dt,0]]}(s,n,i._pixelsPerMercatorPixel,V,j);for(let Ke=0;Ke<v.length;Ke++)nh(v[Ke],Xe[Ke],$e);const tt=a.$.add([],Xe[de],Xe[(de+1)%4]);a.$.scale(tt,tt,.5),nh(ze,tt,$e)}for(const Xe of v)a.$.min(I,I,Xe),a.$.max(E,E,Xe);return I[2]=Math.min(me[2],Ae[2]),a.$.min(I,I,ze),a.$.max(E,E,ze),new li(I,E)}function gb({x:i,y:n,z:s},c=!1){const h=1/(1<<s),p=new yr(ca(i*h),n===(1<<s)-1&&c?-90:Vs((n+1)*h)),m=new yr(ca((i+1)*h),n===0&&c?90:Vs(n*h));return new yd(p,m)}function ZA(i,n=zo){const s=Qn(i.getNorth()),c=Qn(i.getSouth()),h=Math.cos(s),p=Math.cos(c),m=Math.sin(s),v=Math.sin(c),b=i.getWest(),E=i.getEast();return[og(p,v,b,n),og(p,v,E,n),og(h,m,E,n),og(h,m,b,n)]}function r0(i,n,s,c){const h=1<<s.z,p=(i/Lt+s.x)/h;return up(Vs((n/Lt+s.y)/h),ca(p),c)}function _b({min:i,max:n}){return oH/Math.max(n[0]-i[0],n[1]-i[1],n[2]-i[2])}const KL=new Float64Array(16);function i0(i){const n=_b(i),s=a.ae.fromScaling(KL,[n,n,n]);return a.ae.translate(s,s,a.$.negate([],i.min))}function XA(i){const n=a.ae.fromTranslation(KL,i.min),s=1/_b(i);return a.ae.scale(n,n,[s,s,s])}function KA(i){const n=Lt/(2*Math.PI);return i/(2*Math.PI)/n}function YL(i,n){return Lt/(512*Math.pow(2,i))*_b(Qc(n))}function QL(i,n,s,c,h){const p=KA(s),m=[i,n,-s/(2*Math.PI)],v=a.ae.identity(new Float64Array(16));return a.ae.translate(v,v,m),a.ae.scale(v,v,[p,p,p]),a.ae.rotateX(v,v,Qn(-h)),a.ae.rotateY(v,v,Qn(-c)),v}function rh(i){return Qo(kA,IL,i)}function JL(i,n){const s=up(n.lat,n.lng),c=function(p){const m=up(p._center.lat,p._center.lng),v=a.$.fromValues(0,1,0);let b=a.$.cross([],v,m);const E=a.ae.fromRotation([],-p.angle,m);b=a.$.transformMat4(b,b,E),a.ae.fromRotation(E,-p._pitch,b);const I=a.$.normalize([],m);return a.$.scale(I,I,mb(p.cameraToCenterDistance/p.pixelsPerMeter)),a.$.transformMat4(I,I,E),a.$.add([],m,I)}(i),h=a.$.subtract([],c,s);return a.$.angle(h,s)}function YA(i,n){return JL(i,n)>Math.PI/2*1.01}const e4=Qn(85),xH=Math.cos(e4),bH=Math.sin(e4),wH=a.ae.create(),t4=i=>{const n=[];return i.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),i.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function n4(i,n,s,c,h,p,m,v,b){if(p&&i.queryGeometry.isAboveHorizon)return!1;p&&(b*=i.pixelToTileUnitsFactor);const E=i.tileID.canonical,I=s.projection.upVectorScale(E,s.center.lat,s.worldSize).metersToTile;for(const P of n)for(const M of P){const z=M.add(v),F=h&&s.elevation?s.elevation.exaggeration()*h.getElevationAt(z.x,z.y,!0):0,V=s.projection.projectTilePoint(z.x,z.y,E);if(F>0){const de=s.projection.upVector(E,z.x,z.y);V.x+=de[0]*I*F,V.y+=de[1]*I*F,V.z+=de[2]*I*F}const j=p?z:TH(V.x,V.y,V.z,c),K=p?i.tilespaceRays.map(de=>SH(de,F)):i.queryGeometry.screenGeometry,pe=a.aB.transformMat4([],[V.x,V.y,V.z,1],c);if(!m&&p?b*=pe[3]/s.cameraToCenterDistance:m&&!p&&(b*=s.cameraToCenterDistance/pe[3]),p){const de=Vs((M.y/Lt+E.y)/(1<<E.z));b/=s.projection.pixelsPerMeter(de,1)/No(1,de)}if(fH(K,j,b))return!0}return!1}function TH(i,n,s,c){const h=a.aB.transformMat4([],[i,n,s,1],c);return new Nt(h[0]/h[3],h[1]/h[3])}const r4=a.$.fromValues(0,0,0),EH=a.$.fromValues(0,0,1);function SH(i,n){const s=a.$.create();return r4[2]=n,i.intersectsPlane(r4,EH,s),new Nt(s[0],s[1])}class i4 extends BA{}function s4(i,{width:n,height:s},c,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==n*s*c)throw new RangeError("mismatched image size")}else h=new Uint8Array(n*s*c);return i.width=n,i.height=s,i.data=h,i}function o4(i,n,s){const{width:c,height:h}=n;c===i.width&&h===i.height||(QA(i,n,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,c),height:Math.min(i.height,h)},s,null),i.width=c,i.height=h,i.data=n.data)}function QA(i,n,s,c,h,p,m,v){if(h.width===0||h.height===0)return n;if(h.width>i.width||h.height>i.height||s.x>i.width-h.width||s.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>n.width||h.height>n.height||c.x>n.width-h.width||c.y>n.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const b=i.data,E=n.data,I=p===4&&v;for(let P=0;P<h.height;P++){const M=((s.y+P)*i.width+s.x)*p,z=((c.y+P)*n.width+c.x)*p;if(I)for(let F=0;F<h.width;F++){const V=M+F*p+3,j=z+F*p;E[j+0]=255,E[j+1]=255,E[j+2]=255,E[j+3]=b[V]}else if(m)for(let F=0;F<h.width;F++){const V=M+F*p,j=z+F*p,K=b[V+3],pe=new wr(b[V+0]/255*K,b[V+1]/255*K,b[V+2]/255*K,K).toRenderColor(m).toArray();E[j+0]=pe[0],E[j+1]=pe[1],E[j+2]=pe[2],E[j+3]=pe[3]}else for(let F=0;F<h.width*p;F++)E[z+F]=b[M+F]}return n}je(i4,"HeatmapBucket",{omit:["layers"]});class xd{constructor(n,s){s4(this,n,1,s)}resize(n){o4(this,new xd(n),1)}clone(){return new xd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,c,h,p){QA(n,s,c,h,p,1,null)}}class Ha{constructor(n,s){s4(this,n,4,s)}resize(n){o4(this,new Ha(n),4)}replace(n,s){s?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Ha({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,c,h,p,m,v){QA(n,s,c,h,p,4,m,v)}}class a4{constructor(n,s){this.width=n.width,this.height=n.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}let l4,c4,u4,h4;function s0(i){const n={},s=i.resolution||256,c=i.clips?i.clips.length:1,h=i.image||new Ha({width:s,height:c}),p=(m,v,b)=>{n[i.evaluationKey]=b;const E=i.expression.evaluate(n);E&&(h.data[m+v+0]=Math.floor(255*E.r/E.a),h.data[m+v+1]=Math.floor(255*E.g/E.a),h.data[m+v+2]=Math.floor(255*E.b/E.a),h.data[m+v+3]=Math.floor(255*E.a))};if(i.clips)for(let m=0,v=0;m<c;++m,v+=4*s)for(let b=0,E=0;b<s;b++,E+=4){const I=b/(s-1),{start:P,end:M}=i.clips[m];p(v,E,P*(1-I)+M*I)}else for(let m=0,v=0;m<s;m++,v+=4)p(0,v,m/(s-1));return h}je(xd,"AlphaImage"),je(Ha,"RGBAImage");const IH=Pr([{name:"a_pos",components:2,type:"Int16"}],4),{members:AH}=IH;function o0(i,n,s=2){const c=n&&n.length,h=c?n[0]*s:i.length;let p=d4(i,0,h,s,!0);const m=[];if(!p||p.next===p.prev)return m;let v,b,E;if(c&&(p=function(I,P,M,z){const F=[];for(let V=0,j=P.length;V<j;V++){const K=d4(I,P[V]*z,V<j-1?P[V+1]*z:I.length,z,!1);K===K.next&&(K.steiner=!0),F.push(LH(K))}F.sort(kH);for(let V=0;V<F.length;V++)M=DH(F[V],M);return M}(i,n,p,s)),i.length>80*s){v=1/0,b=1/0;let I=-1/0,P=-1/0;for(let M=s;M<h;M+=s){const z=i[M],F=i[M+1];z<v&&(v=z),F<b&&(b=F),z>I&&(I=z),F>P&&(P=F)}E=Math.max(I-v,P-b),E=E!==0?32767/E:0}return a0(p,m,s,v,b,E,0),m}function d4(i,n,s,c,h){let p;if(h===function(m,v,b,E){let I=0;for(let P=v,M=b-E;P<b;P+=E)I+=(m[M]-m[P])*(m[P+1]+m[M+1]),M=P;return I}(i,n,s,c)>0)for(let m=n;m<s;m+=c)p=m4(m/c|0,i[m],i[m+1],p);else for(let m=s-c;m>=n;m-=c)p=m4(m/c|0,i[m],i[m+1],p);return p&&yb(p,p.next)&&(c0(p),p=p.next),p}function fp(i,n){if(!i)return i;n||(n=i);let s,c=i;do if(s=!1,c.steiner||!yb(c,c.next)&&fs(c.prev,c,c.next)!==0)c=c.next;else{if(c0(c),c=n=c.prev,c===c.next)break;s=!0}while(s||c!==n);return n}function a0(i,n,s,c,h,p,m){if(!i)return;!m&&p&&function(b,E,I,P){let M=b;do M.z===0&&(M.z=JA(M.x,M.y,E,I,P)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==b);M.prevZ.nextZ=null,M.prevZ=null,function(z){let F,V=1;do{let j,K=z;z=null;let pe=null;for(F=0;K;){F++;let de=K,me=0;for(let Ce=0;Ce<V&&(me++,de=de.nextZ,de);Ce++);let Ae=V;for(;me>0||Ae>0&&de;)me!==0&&(Ae===0||!de||K.z<=de.z)?(j=K,K=K.nextZ,me--):(j=de,de=de.nextZ,Ae--),pe?pe.nextZ=j:z=j,j.prevZ=pe,pe=j;K=de}pe.nextZ=null,V*=2}while(F>1)}(M)}(i,c,h,p);let v=i;for(;i.prev!==i.next;){const b=i.prev,E=i.next;if(p?PH(i,c,h,p):CH(i))n.push(b.i,i.i,E.i),c0(i),i=E.next,v=E.next;else if((i=E)===v){m?m===1?a0(i=RH(fp(i),n),n,s,c,h,p,2):m===2&&MH(i,n,s,c,h,p):a0(fp(i),n,s,c,h,p,1);break}}}function CH(i){const n=i.prev,s=i,c=i.next;if(fs(n,s,c)>=0)return!1;const h=n.x,p=s.x,m=c.x,v=n.y,b=s.y,E=c.y,I=h<p?h<m?h:m:p<m?p:m,P=v<b?v<E?v:E:b<E?b:E,M=h>p?h>m?h:m:p>m?p:m,z=v>b?v>E?v:E:b>E?b:E;let F=c.next;for(;F!==n;){if(F.x>=I&&F.x<=M&&F.y>=P&&F.y<=z&&hg(h,v,p,b,m,E,F.x,F.y)&&fs(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function PH(i,n,s,c){const h=i.prev,p=i,m=i.next;if(fs(h,p,m)>=0)return!1;const v=h.x,b=p.x,E=m.x,I=h.y,P=p.y,M=m.y,z=v<b?v<E?v:E:b<E?b:E,F=I<P?I<M?I:M:P<M?P:M,V=v>b?v>E?v:E:b>E?b:E,j=I>P?I>M?I:M:P>M?P:M,K=JA(z,F,n,s,c),pe=JA(V,j,n,s,c);let de=i.prevZ,me=i.nextZ;for(;de&&de.z>=K&&me&&me.z<=pe;){if(de.x>=z&&de.x<=V&&de.y>=F&&de.y<=j&&de!==h&&de!==m&&hg(v,I,b,P,E,M,de.x,de.y)&&fs(de.prev,de,de.next)>=0||(de=de.prevZ,me.x>=z&&me.x<=V&&me.y>=F&&me.y<=j&&me!==h&&me!==m&&hg(v,I,b,P,E,M,me.x,me.y)&&fs(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;de&&de.z>=K;){if(de.x>=z&&de.x<=V&&de.y>=F&&de.y<=j&&de!==h&&de!==m&&hg(v,I,b,P,E,M,de.x,de.y)&&fs(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;me&&me.z<=pe;){if(me.x>=z&&me.x<=V&&me.y>=F&&me.y<=j&&me!==h&&me!==m&&hg(v,I,b,P,E,M,me.x,me.y)&&fs(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function RH(i,n){let s=i;do{const c=s.prev,h=s.next.next;!yb(c,h)&&f4(c,s,s.next,h)&&l0(c,h)&&l0(h,c)&&(n.push(c.i,s.i,h.i),c0(s),c0(s.next),s=i=h),s=s.next}while(s!==i);return fp(s)}function MH(i,n,s,c,h,p){let m=i;do{let v=m.next.next;for(;v!==m.prev;){if(m.i!==v.i&&zH(m,v)){let b=p4(m,v);return m=fp(m,m.next),b=fp(b,b.next),a0(m,n,s,c,h,p,0),void a0(b,n,s,c,h,p,0)}v=v.next}m=m.next}while(m!==i)}function kH(i,n){return i.x-n.x}function DH(i,n){const s=function(h,p){let m=p;const v=h.x,b=h.y;let E,I=-1/0;do{if(b<=m.y&&b>=m.next.y&&m.next.y!==m.y){const V=m.x+(b-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(V<=v&&V>I&&(I=V,E=m.x<m.next.x?m:m.next,V===v))return E}m=m.next}while(m!==p);if(!E)return null;const P=E,M=E.x,z=E.y;let F=1/0;m=E;do{if(v>=m.x&&m.x>=M&&v!==m.x&&hg(b<z?v:I,b,M,z,b<z?I:v,b,m.x,m.y)){const V=Math.abs(b-m.y)/(v-m.x);l0(m,h)&&(V<F||V===F&&(m.x>E.x||m.x===E.x&&OH(E,m)))&&(E=m,F=V)}m=m.next}while(m!==P);return E}(i,n);if(!s)return n;const c=p4(s,i);return fp(c,c.next),fp(s,s.next)}function OH(i,n){return fs(i.prev,i,n.prev)<0&&fs(n.next,i,i.next)<0}function JA(i,n,s,c,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-s)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-c)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function LH(i){let n=i,s=i;do(n.x<s.x||n.x===s.x&&n.y<s.y)&&(s=n),n=n.next;while(n!==i);return s}function hg(i,n,s,c,h,p,m,v){return(h-m)*(n-v)>=(i-m)*(p-v)&&(i-m)*(c-v)>=(s-m)*(n-v)&&(s-m)*(p-v)>=(h-m)*(c-v)}function zH(i,n){return i.next.i!==n.i&&i.prev.i!==n.i&&!function(s,c){let h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==c.i&&h.next.i!==c.i&&f4(h,h.next,s,c))return!0;h=h.next}while(h!==s);return!1}(i,n)&&(l0(i,n)&&l0(n,i)&&function(s,c){let h=s,p=!1;const m=(s.x+c.x)/2,v=(s.y+c.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&m<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==s);return p}(i,n)&&(fs(i.prev,i,n.prev)||fs(i,n.prev,n))||yb(i,n)&&fs(i.prev,i,i.next)>0&&fs(n.prev,n,n.next)>0)}function fs(i,n,s){return(n.y-i.y)*(s.x-n.x)-(n.x-i.x)*(s.y-n.y)}function yb(i,n){return i.x===n.x&&i.y===n.y}function f4(i,n,s,c){const h=xb(fs(i,n,s)),p=xb(fs(i,n,c)),m=xb(fs(s,c,i)),v=xb(fs(s,c,n));return h!==p&&m!==v||!(h!==0||!vb(i,s,n))||!(p!==0||!vb(i,c,n))||!(m!==0||!vb(s,i,c))||!(v!==0||!vb(s,n,c))}function vb(i,n,s){return n.x<=Math.max(i.x,s.x)&&n.x>=Math.min(i.x,s.x)&&n.y<=Math.max(i.y,s.y)&&n.y>=Math.min(i.y,s.y)}function xb(i){return i>0?1:i<0?-1:0}function l0(i,n){return fs(i.prev,i,i.next)<0?fs(i,n,i.next)>=0&&fs(i,i.prev,n)>=0:fs(i,n,i.prev)<0||fs(i,i.next,n)<0}function p4(i,n){const s=eC(i.i,i.x,i.y),c=eC(n.i,n.x,n.y),h=i.next,p=n.prev;return i.next=n,n.prev=i,s.next=h,h.prev=s,c.next=s,s.prev=c,p.next=c,c.prev=p,c}function m4(i,n,s,c){const h=eC(i,n,s);return c?(h.next=c.next,h.prev=c,c.next.prev=h,c.next=h):(h.prev=h,h.next=h),h}function c0(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function eC(i,n,s){return{i,x:n,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function bb(i,n){const s=i.length;if(s<=1)return[i];const c=[];let h,p;for(let m=0;m<s;m++){const v=Sm(i[m]);v!==0&&(i[m].area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(h&&c.push(h),h=[i[m]]):h.push(i[m]))}if(h&&c.push(h),n>1)for(let m=0;m<c.length;m++)c[m].length<=n||(Tr(c[m],n,1,c[m].length-1,NH),c[m]=c[m].slice(0,n));return c}function NH(i,n){return n.area-i.area}function tC(i,n,s){const c=s.patternDependencies;let h=!1;for(const p of n){const m=p.paint.get(`${i}-pattern`);m.isConstant()||(h=!0);const v=m.constantOr(null);v&&(h=!0,c[v]=!0)}return h}function nC(i,n,s,c,h){const p=h.patternDependencies;for(const m of n){const v=m.paint.get(`${i}-pattern`).value;if(v.kind!=="constant"){let b=v.evaluate({zoom:c},s,{},h.availableImages);b=b&&b.name?b.name:b,p[b]=!0,s.patterns[m.id]=b}}return s}class wb{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new lc,this.indexArray=new ks,this.indexArray2=new md,this.programConfigurations=new _d(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new pi,this.segments2=new pi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=n.projection}updateFootprints(n,s){}populate(n,s,c,h){this.hasPattern=tC("fill",this.layers,s);const p=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:v,id:b,index:E,sourceLayerIndex:I}of n){const P=this.layers[0]._featureFilter.needGeometry,M=th(v,P);if(!this.layers[0]._featureFilter.filter(new An(this.zoom),M,c))continue;const z=p?p.evaluate(M,{},c,s.availableImages):void 0,F={id:b,properties:v.properties,type:v.type,sourceLayerIndex:I,index:E,geometry:P?M.geometry:uc(v,c,h),patterns:{},sortKey:z};m.push(F)}p&&m.sort((v,b)=>v.sortKey-b.sortKey);for(const v of m){const{geometry:b,index:E,sourceLayerIndex:I}=v;if(this.hasPattern){const P=nC("fill",this.layers,v,this.zoom,s);this.patternFeatures.push(P)}else this.addFeature(v,b,E,c,{},s.availableImages,s.brightness);s.featureIndex.insert(n[E].feature,b,E,I,this.index)}}update(n,s,c,h,p){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,s,m?this.stateDependentLayers:this.layers,c,h,p)}addFeatures(n,s,c,h,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,c,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,AH),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,s,c,h,p,m=[],v){for(const b of bb(s,500)){let E=0;for(const V of b)E+=V.length;const I=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),P=I.vertexLength,M=[],z=[];for(const V of b){if(V.length===0)continue;V!==b[0]&&z.push(M.length/2);const j=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),K=j.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(K+V.length-1,K),M.push(V[0].x),M.push(V[0].y);for(let pe=1;pe<V.length;pe++)this.layoutVertexArray.emplaceBack(V[pe].x,V[pe].y),this.indexArray2.emplaceBack(K+pe-1,K+pe),M.push(V[pe].x),M.push(V[pe].y);j.vertexLength+=V.length,j.primitiveLength+=V.length}const F=o0(M,z);for(let V=0;V<F.length;V+=3)this.indexArray.emplaceBack(P+F[V],P+F[V+1],P+F[V+2]);I.vertexLength+=E,I.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,p,m,h,v)}}let g4,_4,y4,v4;je(wb,"FillBucket",{omit:["layers","patternFeatures"]});class rC{constructor(n,s,c,h){if(this.triangleCount=s.length/3,this.min=new Nt(0,0),this.max=new Nt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0)return;const[p,m]=[n[0].clone(),n[0].clone()];for(let P=1;P<n.length;++P){const M=n[P];p.x=Math.min(p.x,M.x),p.y=Math.min(p.y,M.y),m.x=Math.max(m.x,M.x),m.y=Math.max(m.y,M.y)}if(h){const P=Math.ceil(Math.max(m.x-p.x,m.y-p.y)/h);c=Math.max(c,P)}if(c===0)return;this.min=p,this.max=m;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const b=Math.max(v.x,v.y)/c;this.cellsX=Math.max(1,Math.ceil(v.x/b)),this.cellsY=Math.max(1,Math.ceil(v.y/b)),this.xScale=1/b,this.yScale=1/b;const E=[];for(let P=0;P<this.triangleCount;P++){const M=n[s[3*P+0]].sub(this.min),z=n[s[3*P+1]].sub(this.min),F=n[s[3*P+2]].sub(this.min),V=Jc(Math.floor(Math.min(M.x,z.x,F.x)),this.xScale,this.cellsX),j=Jc(Math.floor(Math.max(M.x,z.x,F.x)),this.xScale,this.cellsX),K=Jc(Math.floor(Math.min(M.y,z.y,F.y)),this.yScale,this.cellsY),pe=Jc(Math.floor(Math.max(M.y,z.y,F.y)),this.yScale,this.cellsY),de=new Nt(0,0),me=new Nt(0,0),Ae=new Nt(0,0),Ce=new Nt(0,0);for(let ze=K;ze<=pe;++ze){de.y=me.y=ze*b,Ae.y=Ce.y=(ze+1)*b;for(let $e=V;$e<=j;++$e)de.x=Ae.x=$e*b,me.x=Ce.x=($e+1)*b,($A(M,z,F,de,me,Ce)||$A(M,z,F,de,Ce,Ae))&&E.push({cellIdx:ze*this.cellsX+$e,triIdx:P})}}if(E.length===0)return;E.sort((P,M)=>P.cellIdx-M.cellIdx||P.triIdx-M.triIdx);let I=0;for(;I<E.length;){const P=E[I].cellIdx,M={start:this.payload.length,len:0};for(;I<E.length&&E[I].cellIdx===P;)++M.len,this.payload.push(E[I++].triIdx);this.cells[P]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(n,s){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>n.x||n.y>this.max.y||this.min.y>n.y)return;const c=Jc(n.x-this.min.x,this.xScale,this.cellsX),h=Jc(n.y-this.min.y,this.yScale,this.cellsY),p=this.cells[h*this.cellsX+c];if(p){this._lazyInitLookup();for(let m=0;m<p.len;m++){const v=this.payload[p.start+m],b=Math.floor(v/8),E=1<<v%8;if(!(this.lookup[b]&E)&&(this.lookup[b]|=E,s.push(v),s.length===this.triangleCount))return}}}query(n,s,c){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>s.x||n.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();const h=Jc(n.x-this.min.x,this.xScale,this.cellsX),p=Jc(s.x-this.min.x,this.xScale,this.cellsX),m=Jc(n.y-this.min.y,this.yScale,this.cellsY),v=Jc(s.y-this.min.y,this.yScale,this.cellsY);for(let b=m;b<=v;b++)for(let E=h;E<=p;E++){const I=this.cells[b*this.cellsX+E];if(I)for(let P=0;P<I.len;P++){const M=this.payload[I.start+P],z=Math.floor(M/8),F=1<<M%8;if(!(this.lookup[z]&F)&&(this.lookup[z]|=F,c.push(M),c.length===this.triangleCount))return}}}}function Jc(i,n,s){return Math.max(0,Math.min(s-1,Math.floor(i*n)))}je(rC,"TriangleGridIndex");class x4{constructor(n){this.zoom=n.zoom,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[]}updateFootprints(n,s){for(const c of this.footprints)s.push({footprint:c,id:n})}populate(n,s,c,h){const p=[];for(const{feature:m,id:v,index:b,sourceLayerIndex:E}of n){const I=this.layers[0]._featureFilter.needGeometry,P=th(m,I);if(!this.layers[0]._featureFilter.filter(new An(this.zoom),P,c))continue;const M={id:v,properties:m.properties,type:m.type,sourceLayerIndex:E,index:b,geometry:I?P.geometry:uc(m,c,h),patterns:{}};p.push(M)}for(const m of p){const{geometry:v,index:b,sourceLayerIndex:E}=m;this.addFeature(m,v,b,c,{},s.availableImages,s.brightness),s.featureIndex.insert(n[b].feature,v,b,E,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(n){}update(n,s,c,h,p){}destroy(){}addFeature(n,s,c,h,p,m=[],v){for(const b of bb(s,2)){const E=[],I=[],P=[],M=new Nt(1/0,1/0),z=new Nt(-1/0,-1/0);for(const j of b)if(j.length!==0){j!==b[0]&&P.push(I.length/2);for(let K=0;K<j.length;K++)I.push(j[K].x),I.push(j[K].y),E.push(j[K]),M.x=Math.min(M.x,j[K].x),M.y=Math.min(M.y,j[K].y),z.x=Math.max(z.x,j[K].x),z.y=Math.max(z.y,j[K].y)}const F=o0(I,P),V=new rC(E,F,8,256);this.footprints.push({vertices:E,indices:F,grid:V,min:M,max:z})}}}je(x4,"ClipBucket",{omit:["layers"]});const FH=Pr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),BH=Pr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),UH=Pr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),VH=Pr([{name:"a_join_normal_inside_polygon",components:4,type:"Int16"}]),jH=Pr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),$H=Pr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:GH}=FH;var Tb={},qH=Nc,b4=dg;function dg(i,n,s,c,h){this.properties={},this.extent=s,this.type=0,this._pbf=i,this._geometry=-1,this._keys=c,this._values=h,i.readFields(WH,this,n)}function WH(i,n,s){i==1?n.id=s.readVarint():i==2?function(c,h){for(var p=c.readVarint()+c.pos;c.pos<p;){var m=h._keys[c.readVarint()],v=h._values[c.readVarint()];h.properties[m]=v}}(s,n):i==3?n.type=s.readVarint():i==4&&(n._geometry=s.pos)}function HH(i){for(var n,s,c=0,h=0,p=i.length,m=p-1;h<p;m=h++)c+=((s=i[m]).x-(n=i[h]).x)*(n.y+s.y);return c}dg.types=["Unknown","Point","LineString","Polygon"],dg.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var n,s=i.readVarint()+i.pos,c=1,h=0,p=0,m=0,v=[];i.pos<s;){if(h<=0){var b=i.readVarint();c=7&b,h=b>>3}if(h--,c===1||c===2)p+=i.readSVarint(),m+=i.readSVarint(),c===1&&(n&&v.push(n),n=[]),n.push(new qH(p,m));else{if(c!==7)throw new Error("unknown command "+c);n&&n.push(n[0].clone())}}return n&&v.push(n),v},dg.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var n=i.readVarint()+i.pos,s=1,c=0,h=0,p=0,m=1/0,v=-1/0,b=1/0,E=-1/0;i.pos<n;){if(c<=0){var I=i.readVarint();s=7&I,c=I>>3}if(c--,s===1||s===2)(h+=i.readSVarint())<m&&(m=h),h>v&&(v=h),(p+=i.readSVarint())<b&&(b=p),p>E&&(E=p);else if(s!==7)throw new Error("unknown command "+s)}return[m,b,v,E]},dg.prototype.toGeoJSON=function(i,n,s){var c,h,p=this.extent*Math.pow(2,s),m=this.extent*i,v=this.extent*n,b=this.loadGeometry(),E=dg.types[this.type];function I(z){for(var F=0;F<z.length;F++){var V=z[F];z[F]=[360*(V.x+m)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(c=0;c<b.length;c++)P[c]=b[c][0];I(b=P);break;case 2:for(c=0;c<b.length;c++)I(b[c]);break;case 3:for(b=function(z){var F=z.length;if(F<=1)return[z];for(var V,j,K=[],pe=0;pe<F;pe++){var de=HH(z[pe]);de!==0&&(j===void 0&&(j=de<0),j===de<0?(V&&K.push(V),V=[z[pe]]):V.push(z[pe]))}return V&&K.push(V),K}(b),c=0;c<b.length;c++)for(h=0;h<b[c].length;h++)I(b[c][h])}b.length===1?b=b[0]:E="Multi"+E;var M={type:"Feature",geometry:{type:E,coordinates:b},properties:this.properties};return"id"in this&&(M.id=this.id),M};var ZH=b4,w4=T4;function T4(i,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(XH,this,n),this.length=this._features.length}function XH(i,n,s){i===15?n.version=s.readVarint():i===1?n.name=s.readString():i===5?n.extent=s.readVarint():i===2?n._features.push(s.pos):i===3?n._keys.push(s.readString()):i===4&&n._values.push(function(c){for(var h=null,p=c.readVarint()+c.pos;c.pos<p;){var m=c.readVarint()>>3;h=m===1?c.readString():m===2?c.readFloat():m===3?c.readDouble():m===4?c.readVarint64():m===5?c.readVarint():m===6?c.readSVarint():m===7?c.readBoolean():null}return h}(s))}T4.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var n=this._pbf.readVarint()+this._pbf.pos;return new ZH(this._pbf,n,this.extent,this._keys,this._values)};var KH=w4;function YH(i,n,s){if(i===3){var c=new KH(s,s.readVarint()+s.pos);c.length&&(n[c.name]=c)}}var iC=Tb.VectorTile=function(i,n){this.layers=i.readFields(YH,{},n)},Eb=Tb.VectorTileFeature=b4;Tb.VectorTileLayer=w4;class pp extends Nt{constructor(n,s,c){super(n,s),this.z=c}}class E4 extends pp{constructor(n,s,c,h){super(n,s,c),this.w=h}}function Sb(i,n,s,c){const h=[],p=c===0?(m,v,b,E,I,P)=>{m.push(new Nt(P,b+(P-v)/(E-v)*(I-b)))}:(m,v,b,E,I,P)=>{m.push(new Nt(v+(P-b)/(I-b)*(E-v),P))};for(const m of i){const v=[];for(const b of m){if(b.length<=2)continue;const E=[];for(let M=0;M<b.length-1;M++){const z=b[M].x,F=b[M].y,V=b[M+1].x,j=b[M+1].y,K=c===0?z:F,pe=c===0?V:j;K<n?pe>n&&p(E,z,F,V,j,n):K>s?pe<s&&p(E,z,F,V,j,s):E.push(b[M]),pe<n&&K>=n&&p(E,z,F,V,j,n),pe>s&&K<=s&&p(E,z,F,V,j,s)}let I=b[b.length-1];const P=c===0?I.x:I.y;P>=n&&P<=s&&E.push(I),E.length&&(I=E[E.length-1],E[0].x===I.x&&E[0].y===I.y||E.push(E[0]),v.push(E))}v.length&&h.push(v)}return h}function S4(i,n,s,c){const h=s==="x"?"y":"x",p=(c-i[s])/(n[s]-i[s]);i[h]=i[h]+(n[h]-i[h])*p,i[s]=c,i.hasOwnProperty("z")&&(i.z=wn(i.z,n.z,p)),i.hasOwnProperty("w")&&(i.w=wn(i.w,n.w,p))}function I4(i,n,s,c){const h=s,p=c;for(const m of["x","y"]){let v=i,b=n;v[m]>=b[m]&&(v=n,b=i),v[m]<h&&b[m]>h&&S4(v,b,m,h),v[m]<p&&b[m]>p&&S4(b,v,m,p)}}const Ib=Number.MAX_SAFE_INTEGER;function A4(i,n,s,c){return i.order<n||i.order===Ib||!(i.clipMask&s)||function(h,p){return p.length!==0&&p.find(m=>m===h)===void 0}(c,i.clipScope)}function Ab(i,n){return i.x-n.x||i.y-n.y}function C4(i,n){return Ab(i.min,n.min)===0&&Ab(i.max,n.max)===0}function sC(i,n){return!(i.min.x>n.max.x||i.max.x<n.min.x||i.min.y>n.max.y||i.max.y<n.min.y)}function oC(i,n){if(i.length!==n.length)return!1;for(let s=0;s<i.length;s++)if(i[s].sourceId!==n[s].sourceId||!C4(i[s],n[s])||i[s].order!==n[s].order||i[s].clipMask!==n[s].clipMask||!Hl(i[s].clipScope,n[s].clipScope))return!1;return!0}function P4(i,n,s){const c=1/Lt,h=1/(1<<s.canonical.z),p=(n.x*c+s.canonical.x)*h+s.wrap,m=(n.y*c+s.canonical.y)*h;return{min:new Nt((i.x*c+s.canonical.x)*h+s.wrap,(i.y*c+s.canonical.y)*h),max:new Nt(p,m)}}function QH(i,n,s){const c=1<<s.canonical.z,h=((n.x-s.wrap)*c-s.canonical.x)*Lt,p=(n.y*c-s.canonical.y)*Lt;return{min:new Nt(((i.x-s.wrap)*c-s.canonical.x)*Lt,(i.y*c-s.canonical.y)*Lt),max:new Nt(h,p)}}function R4(i,n,s,c,h,p,m){const v=i.indices,b=i.vertices,E=[];for(let I=c;I<c+h;I+=3){const P=n[s[I+0]+p],M=n[s[I+1]+p],z=n[s[I+2]+p],F=Math.min(P.x,M.x,z.x),V=Math.max(P.x,M.x,z.x),j=Math.min(P.y,M.y,z.y),K=Math.max(P.y,M.y,z.y);E.length=0,i.grid.query(new Nt(F,j),new Nt(V,K),E);for(let pe=0;pe<E.length;pe++){const de=E[pe];if($A(b[v[3*de+0]],b[v[3*de+1]],b[v[3*de+2]],P,M,z,m))return!0}}return!1}function M4(i,n,s,c){if(!i||!s)return!1;let h=i.vertices;if(!n.canonical.equals(c.canonical)||n.wrap!==c.wrap){if(s.vertices.length<i.vertices.length)return M4(s,c,i,n);const p=n.canonical,m=c.canonical,v=Math.pow(2,m.z-p.z);h=i.vertices.map(b=>new Nt((b.x+p.x*Lt)*v-m.x*Lt,(b.y+p.y*Lt)*v-m.y*Lt))}return R4(s,h,i.indices,0,i.indices.length,0,0)}function k4(i,n,s,c){const h=Math.pow(2,c.z-s.z);return new Nt((i+s.x*Lt)*h-c.x*Lt,(n+s.y*Lt)*h-c.y*Lt)}function D4(i,n){const s=[];n.footprint.grid.queryPoint(i,s);const c=n.footprint.indices,h=n.footprint.vertices;for(let p=0;p<s.length;p++){const m=s[p];if(vd([h[c[3*m+0]],h[c[3*m+1]],h[c[3*m+2]]],i))return!0}return!1}class O4{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,s){const c=this.toIdx(n,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(n,s){return this.leaves[this.toIdx(n,s)]}toIdx(n,s){return s*this.size+n}}function L4(i,n,s,c){let h=0,p=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(c[m])<1e-15){if(s[m]<i[m]||s[m]>n[m])return null}else{const v=1/c[m];let b=(i[m]-s[m])*v,E=(n[m]-s[m])*v;if(b>E){const I=b;b=E,E=I}if(b>h&&(h=b),E<p&&(p=E),h>p)return null}return h}function z4(i,n,s,c,h,p,m,v,b,E,I){const P=c-i,M=h-n,z=p-s,F=m-i,V=v-n,j=b-s,K=I[1]*j-I[2]*V,pe=I[2]*F-I[0]*j,de=I[0]*V-I[1]*F,me=P*K+M*pe+z*de;if(Math.abs(me)<1e-15)return null;const Ae=1/me,Ce=E[0]-i,ze=E[1]-n,$e=E[2]-s,Xe=(Ce*K+ze*pe+$e*de)*Ae;if(Xe<0||Xe>1)return null;const tt=ze*z-$e*M,Ke=$e*P-Ce*z,lt=Ce*M-ze*P,Tt=(I[0]*tt+I[1]*Ke+I[2]*lt)*Ae;return Tt<0||Xe+Tt>1?null:(F*tt+V*Ke+j*lt)*Ae}function N4(i,n,s){return(i-n)/(s-n)}function F4(i,n,s,c,h,p,m,v,b){const E=1<<s,I=p-c,P=m-h,M=(i+1)/E*I+c,z=(n+0)/E*P+h,F=(n+1)/E*P+h;v[0]=(i+0)/E*I+c,v[1]=z,b[0]=M,b[1]=F}class B4{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(p){const m=Math.ceil(Math.log2(p.dim/8)),v=[];let b=Math.ceil(Math.pow(2,m));const E=1/b,I=(z,F,V,j,K)=>{const pe=j?1:0,de=(z+1)*V-pe,me=F*V,Ae=(F+1)*V-pe;K[0]=z*V,K[1]=me,K[2]=de,K[3]=Ae};let P=new O4(b);const M=[];for(let z=0;z<b*b;z++){I(z%b,Math.floor(z/b),E,!1,M);const F=bd(M[0],M[1],p),V=bd(M[2],M[1],p),j=bd(M[2],M[3],p),K=bd(M[0],M[3],p);P.minimums.push(Math.min(F,V,j,K)),P.maximums.push(Math.max(F,V,j,K)),P.leaves.push(1)}for(v.push(P),b/=2;b>=1;b/=2){const z=v[v.length-1];P=new O4(b);for(let F=0;F<b*b;F++){I(F%b,Math.floor(F/b),2,!0,M);const V=z.getElevation(M[0],M[1]),j=z.getElevation(M[2],M[1]),K=z.getElevation(M[2],M[3]),pe=z.getElevation(M[0],M[3]),de=z.isLeaf(M[0],M[1]),me=z.isLeaf(M[2],M[1]),Ae=z.isLeaf(M[2],M[3]),Ce=z.isLeaf(M[0],M[3]),ze=Math.min(V.min,j.min,K.min,pe.min),$e=Math.max(V.max,j.max,K.max,pe.max),Xe=de&&me&&Ae&&Ce;P.maximums.push($e),P.minimums.push(ze),P.leaves.push($e-ze<=5&&Xe?1:0)}v.push(P)}return v}(this.dem),c=s.length-1,h=s[c];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(n,s,c,h,p,m,v=1){return L4([n,s,-100],[c,h,this.maximums[0]*v],p,m)}raycast(n,s,c,h,p,m,v=1){if(!this.nodeCount)return null;const b=this.raycastRoot(n,s,c,h,p,m,v);if(b==null)return null;const E=[],I=[],P=[],M=[],z=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:F,t:V,nodex:j,nodey:K,depth:pe}=z.pop();if(this.leaves[F]){F4(j,K,pe,n,s,c,h,P,M);const me=1<<pe,Ae=(j+0)/me,Ce=(j+1)/me,ze=(K+0)/me,$e=(K+1)/me,Xe=bd(Ae,ze,this.dem)*v,tt=bd(Ce,ze,this.dem)*v,Ke=bd(Ce,$e,this.dem)*v,lt=bd(Ae,$e,this.dem)*v,Tt=z4(P[0],P[1],Xe,M[0],P[1],tt,M[0],M[1],Ke,p,m),ct=z4(M[0],M[1],Ke,P[0],M[1],lt,P[0],P[1],Xe,p,m),At=Math.min(Tt!==null?Tt:Number.MAX_VALUE,ct!==null?ct:Number.MAX_VALUE);if(At!==Number.MAX_VALUE)return At;{const ot=a.$.scaleAndAdd([],p,m,V);if(U4(Xe,tt,lt,Ke,N4(ot[0],P[0],M[0]),N4(ot[1],P[1],M[1]))>=ot[2])return V}continue}let de=0;for(let me=0;me<this._siblingOffset.length;me++){F4((j<<1)+this._siblingOffset[me][0],(K<<1)+this._siblingOffset[me][1],pe+1,n,s,c,h,P,M),P[2]=-100,M[2]=this.maximums[this.childOffsets[F]+me]*v;const Ae=L4(P,M,p,m);if(Ae!=null){const Ce=Ae;E[me]=Ce;let ze=!1;for(let $e=0;$e<de&&!ze;$e++)Ce>=E[I[$e]]&&(I.splice($e,0,me),ze=!0);ze||(I[de]=me),de++}}for(let me=0;me<de;me++){const Ae=I[me];z.push({idx:this.childOffsets[F]+Ae,t:E[Ae],nodex:(j<<1)+this._siblingOffset[Ae][0],nodey:(K<<1)+this._siblingOffset[Ae][1],depth:pe+1})}}return null}_addNode(n,s,c){return this.minimums.push(n),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(n,s,c,h,p){if(n[h].isLeaf(s,c)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const m=h-1,v=n[m];let b=0,E=0;for(let I=0;I<this._siblingOffset.length;I++){const P=2*s+this._siblingOffset[I][0],M=2*c+this._siblingOffset[I][1],z=v.getElevation(P,M),F=v.isLeaf(P,M),V=this._addNode(z.min,z.max,F);F&&(b|=1<<I),E||(E=V)}for(let I=0;I<this._siblingOffset.length;I++)b&1<<I||this._construct(n,2*s+this._siblingOffset[I][0],2*c+this._siblingOffset[I][1],m,E+I)}}function U4(i,n,s,c,h,p){return wn(wn(i,s,p),wn(n,c,p),h)}function bd(i,n,s){const c=s.dim,h=Gn(i*c-.5,0,c-1),p=Gn(n*c-.5,0,c-1),m=Math.floor(h),v=Math.floor(p),b=Math.min(m+1,c-1),E=Math.min(v+1,c-1);return U4(s.get(m,v),s.get(b,v),s.get(m,E),s.get(b,E),h-m,p-v)}const JH={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function eZ(i,n,s){return(256*i*256+256*n+s)/10-1e4}function tZ(i,n,s){return 256*i+n+s/256-32768}class Cb{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,s,c,h=!1){if(this.uid=n,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return _i(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const p=this.dim=s.height-2,m=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let b=0;b<p;b++)m[this._idx(-1,b)]=m[this._idx(0,b)],m[this._idx(p,b)]=m[this._idx(p-1,b)],m[this._idx(b,-1)]=m[this._idx(b,0)],m[this._idx(b,p)]=m[this._idx(b,p-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(p,-1)]=m[this._idx(p-1,0)],m[this._idx(-1,p)]=m[this._idx(0,p-1)],m[this._idx(p,p)]=m[this._idx(p-1,p-1)]}const v=c==="terrarium"?tZ:eZ;for(let b=0;b<m.length;++b){const E=4*b;this.floatView[b]=v(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=Qt.now()}_buildQuadTree(){this._tree=new B4(this)}get(n,s,c=!1){c&&(n=Gn(n,-1,this.dim),s=Gn(s,-1,this.dim));const h=this._idx(n,s);return this.floatView[h]}set(n,s,c){const h=this._idx(n,s),p=this.floatView[h];return this.floatView[h]=c,c-p}static getUnpackVector(n){return JH[n]}_idx(n,s){if(n<-1||n>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(n+1)}static pack(n,s){const c=[0,0,0,0],h=Cb.getUnpackVector(s);let p=Math.floor((n+h[3])/h[2]);return c[2]=p%256,p=Math.floor(p/256),c[1]=p%256,p=Math.floor(p/256),c[0]=p,c}getPixels(){return new a4({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,s,c){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,p=s*this.dim+this.dim,m=c*this.dim,v=c*this.dim+this.dim;switch(s){case-1:h=p-1;break;case 1:p=h+1}switch(c){case-1:m=v-1;break;case 1:v=m+1}const b=-s*this.dim,E=-c*this.dim;for(let I=m;I<v;I++)for(let P=h;P<p;P++){const M=4*this._idx(P,I),z=4*this._idx(P+b,I+E);this.pixels[M+0]=n.pixels[z+0],this.pixels[M+1]=n.pixels[z+1],this.pixels[M+2]=n.pixels[z+2],this.pixels[M+3]=n.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}je(Cb,"DEMData"),je(B4,"DemMinMaxQuadTree",{omit:["dem"]});class fg{constructor(n,s,c){this._demTile=n,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(n,s,c){const h=c||n.findDEMTileFor(s);if(!h||!h.dem)return;const p=h.dem,m=h.tileID,v=1<<s.canonical.z-m.canonical.z;return new fg(h,p.dim/Lt/v,[(s.canonical.x/v-m.canonical.x)*p.dim,(s.canonical.y/v-m.canonical.y)*p.dim])}tileCoordToPixel(n,s){const c=s*this._scale+this._offset[1],h=Math.floor(n*this._scale+this._offset[0]),p=Math.floor(c);return new Nt(h,p)}getElevationAt(n,s,c,h){const p=n*this._scale+this._offset[0],m=s*this._scale+this._offset[1],v=Math.floor(p),b=Math.floor(m),E=this._dem;return h=!!h,c?wn(wn(E.get(v,b,h),E.get(v,b+1,h),m-b),wn(E.get(v+1,b,h),E.get(v+1,b+1,h),m-b),p-v):E.get(v,b,h)}getElevationAtPixel(n,s,c){return this._dem.get(n,s,!!c)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*No(1,n)*this._dem.stride}}const V4={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},nZ=Eb.types,rZ=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-line-alignment"],iZ=["fill-extrusion-flood-light-ground-radius"],sZ=Math.pow(2,13),oZ=Math.pow(2,15)-1,j4=new Nt(0,1),wd=2147483648;function u0(i,n,s,c,h,p,m,v){i.emplaceBack((n<<1)+m,(s<<1)+p,(Math.floor(c*sZ)<<1)+h,Math.round(v))}function h0(i,n,s,c){i.emplaceBack(n.x*Lt,n.y*Lt,s?0:1,c?1:0)}function Pb(i,n,s,c,h,p){i.emplaceBack(n.x,n.y,(s.x<<1)+c,(s.y<<1)+h,p)}function d0(i,n,s){i.emplaceBack(n.x,n.y,n.z,s[0]*16384,s[1]*16384,s[2]*16384)}class $4{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class G4{constructor(){this.centroidXY=new Nt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Nt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Nt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Nt(this.max.x-this.min.x,this.max.y-this.min.y)}}class q4{constructor(){this.acc=new Nt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,s){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=s.x,n.min.y=n.max.y=s.y)}appendEdge(n,s,c){this.accCount++,this.acc._add(s);let h=!!this.borders;s.x<n.min.x?(n.min.x=s.x,h=!0):s.x>n.max.x&&(n.max.x=s.x,h=!0),s.y<n.min.y?(n.min.y=s.y,h=!0):s.y>n.max.y&&(n.max.y=s.y,h=!0),((s.x===0||s.x===Lt)&&s.x===c.x)!=((s.y===0||s.y===Lt)&&s.y===c.y)&&this.processBorderOverlap(s,c),h&&this.checkBorderIntersection(s,c)}checkBorderIntersection(n,s){s.x<0!=n.x<0&&this.addBorderIntersection(0,wn(s.y,n.y,(0-s.x)/(n.x-s.x))),s.x>Lt!=n.x>Lt&&this.addBorderIntersection(1,wn(s.y,n.y,(Lt-s.x)/(n.x-s.x))),s.y<0!=n.y<0&&this.addBorderIntersection(2,wn(s.x,n.x,(0-s.y)/(n.y-s.y))),s.y>Lt!=n.y>Lt&&this.addBorderIntersection(3,wn(s.x,n.x,(Lt-s.y)/(n.y-s.y)))}addBorderIntersection(n,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[n];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(n,s){if(n.x===s.x){if(n.y===s.y)return;const c=n.x===0?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,n.y)}else{const c=n.y===0?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,n.x)}}centroid(){return this.accCount===0?new Nt(0,0):new Nt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((n,s)=>n+ +(s[0]!==Number.MAX_VALUE),0):0}}function W4(i,n){const s=i.add(n)._unit(),c=Gn(i.x*s.x+i.y*s.y,-1,1);var h,p,m;return h=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(h)))/4*oZ*((p=i).x*(m=n).y-p.y*m.x<0?-1:1)}const aZ=[i=>i.x<0,i=>i.x>Lt,i=>i.y<0,i=>i.y>Lt];function lZ(i,n,s,c){const h=[4];if(c===0)return h;s._mult(c);const p=i.sub(s),m=n.sub(s),v=[i,n,p,m];for(let b=0;b<4;b++)for(const E of v)if(aZ[b](E)){h.push(b);break}return h}class H4{constructor(n){this.vertexArray=new hA,this.indexArray=new ks,this.programConfigurations=new _d(n.layers,{zoom:n.zoom,lut:n.lut},s=>iZ.includes(s)),this._segments=new pi,this.hiddenByLandmarkVertexArray=new SA,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new pi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,s,c,h=!1){const p=n.length;if(p>2){let m=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let b;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const E=n[0],I=n[1];b=W4(E.sub(n[p-1])._perp()._unit(),I.sub(E)._perp()._unit())}for(let E=0;E<p;E++){const I=E===p-1?0:E+1,P=n[E],M=n[I],z=n[I===p-1?0:I+1],F=M.sub(P)._perp()._unit(),V=W4(F,z.sub(M)._perp()._unit()),j=b,K=V;if(aC(P,M,s)||h&&K4(P,s)&&K4(M,s)){b=V;continue}const pe=v.vertexLength;Pb(this.vertexArray,P,M,1,1,j),Pb(this.vertexArray,P,M,1,0,j),Pb(this.vertexArray,P,M,0,1,K),Pb(this.vertexArray,P,M,0,0,K),v.vertexLength+=4;const de=lZ(P,M,F,c);for(const me of de)this._segmentToGroundQuads[m].push({id:pe,region:me}),this._segmentToRegionTriCounts[m][me]+=2,v.primitiveLength+=2;b=V}}}prepareBorderSegments(){if(!this.hasData())return;const n=this._segments.get(),s=n.length;for(let c=0;c<s;c++)this._segmentToGroundQuads[c].sort((h,p)=>h.region-p.region);for(let c=0;c<s;c++){const h=this._segmentToGroundQuads[c],p=n[c],m=this._segmentToRegionTriCounts[c];m.reduce((b,E)=>b+E,0);let v=0;for(let b=0;b<=4;b++){const E=m[b];if(E!==0){let I=this.regionSegments[b];I||(I=this.regionSegments[b]=new pi);const P={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+v,vertexLength:p.vertexLength,primitiveLength:E};I.get().push(P)}v+=E}for(let b=0;b<h.length;b++){const E=h[b].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,s,c,h,p,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,s,c,h,p,m)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,BH.members),this.indexBuffer=n.createIndexBuffer(this.indexArray))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,s,c,h,p,m){this.hasData()&&this.programConfigurations.updatePaintArrays(n,s,c,h,p,m)}updateHiddenByLandmark(n){if(!this.hasData())return;const s=n.groundVertexCount+n.groundVertexArrayOffset;if(n.groundVertexCount===0)return;const c=n.flags&wd?1:0;for(let h=n.groundVertexArrayOffset;h<s;++h)this.hiddenByLandmarkVertexArray.emplace(h,c);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,jH.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){const s=this.regionSegments[n];s&&s.destroy()}}}}class Rb{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ks,this.footprintVertices=new lc,this.footprintSegments=[],this.layoutVertexArray=new Yu,this.centroidVertexArray=new vL,this.wallVertexArray=new bL,this.indexArray=new ks,this.programConfigurations=new _d(n.layers,{zoom:n.zoom,lut:n.lut},s=>rZ.includes(s)),this.segments=new pi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new H4(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(n,s){}populate(n,s,c,h){this.features=[],this.hasPattern=tC("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=ub(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:m,index:v,sourceLayerIndex:b}of n){const E=this.layers[0]._featureFilter.needGeometry,I=th(p,E);if(!this.layers[0]._featureFilter.filter(new An(this.zoom),I,c))continue;const P={id:m,sourceLayerIndex:b,index:v,geometry:E?I.geometry:uc(p,c,h),properties:p.properties,type:p.type,patterns:{}},M=this.layoutVertexArray.length;if(this.hasPattern)this.features.push(nC("fill-extrusion",this.layers,P,this.zoom,s));else if(this.wallMode)for(const z of P.geometry)this.addFeature(P,[z],v,c,{},s.availableImages,h,s.brightness);else this.addFeature(P,P.geometry,v,c,{},s.availableImages,h,s.brightness);s.featureIndex.insert(p,P.geometry,v,b,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,s,c,h,p,m){for(const v of this.features){const{geometry:b}=v;if(this.wallMode)for(const E of b)this.addFeature(v,[E],v.index,s,c,h,p,m);else this.addFeature(v,b,v.index,s,c,h,p,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,s,c,h,p){const m=Object.keys(n).length!==0;if(m&&!this.stateDependentLayers.length)return;const v=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(n,s,v,c,h,p),this.groundEffect.update(n,s,v,c,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,GH),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.wallVertexBuffer=n.createVertexBuffer(this.wallVertexArray,VH.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,$H.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,UH.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,s,c,h,p,m,v,b){const E=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,I=[new Nt(0,0),new Nt(Lt,Lt)],P=v.projection,M=P.name==="globe",z=this.wallMode||nZ[n.type]==="Polygon",F=new q4;F.centroidDataIndex=this.centroidData.length;const V=new G4,j=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},h)<=0,K=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},h);let pe;if(V.height=K,V.vertexArrayOffset=this.layoutVertexArray.length,V.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new sb),this.wallMode){if(M)return void _i("Non zero fill-extrusion-line-width is not yet supported on globe.");if(s.length!==1)return;pe=function(tt){const Ke=tt[0].x===tt[tt.length-1].x&&tt[0].y===tt[tt.length-1].y;(function(cn){let Ht=0;const zt=cn.length;for(let In=0;In<zt;In++)Ht+=(cn[(In+1)%zt].x-cn[In].x)*(cn[(In+1)%zt].y+cn[In].y);return Ht>=0})(tt)||(tt=tt.reverse());const Tt={isPolygon:Ke,geometry:[],joinNormals:[]},ct=[],At=[],ot=[];let mt=tt.length;if(mt<(Ke?3:2))return Tt;for(;mt>=2&&tt[mt-1].equals(tt[mt-2]);)mt--;let Ot,ut,Ft,Dt,Et,gn=0;for(;gn<mt-1&&tt[gn].equals(tt[gn+1]);)gn++;Ke&&(Ot=tt[mt-2],Et=tt[gn].sub(Ot)._unit()._perp());for(let cn=gn;cn<mt;cn++){if(Ft=cn===mt-1?Ke?tt[gn+1]:void 0:tt[cn+1],Ft&&tt[cn].equals(Ft))continue;Et&&(Dt=Et),Ot&&(ut=Ot),Ot=tt[cn],Et=Ft?Ft.sub(Ot)._unit()._perp():Dt,Dt=Dt||Et;const Ht=Dt.add(Et);Ht.x===0&&Ht.y===0||Ht._unit();const zt=Ht.x*Et.x+Ht.y*Et.y,In=zt!==0?1/zt:1/0,dn=Dt.x*Et.y-Dt.y*Et.x>0;let nn="miter";nn==="miter"&&In>2&&(nn="bevel");const On=(zn,Ln,$n,ur)=>{const tr=new Nt(zn.x,zn.y),Br=new Nt(zn.x,zn.y);tr.x-=Ln.x*ur,tr.y-=Ln.y*ur,Br.x-=Ln.x*Math.max($n,1),Br.y-=Ln.y*Math.max($n,1),ot.push(Ln),ct.push(tr),At.push(Br)};if(nn==="miter")Ht._mult(In),On(Ot,Ht,1,0);else{const zn=-Math.sqrt(In*In-1),Ln=dn?zn:0,$n=dn?0:zn;ut&&On(Ot,Dt,Ln,$n),Ft&&On(Ot,Et,Ln,$n)}}return Tt.geometry=[...ct,...At.reverse(),ct[0]],Tt.joinNormals=[...ot,...ot.reverse(),ot[ot.length-1]],Tt}(s[0]),s=[pe.geometry]}const de=(tt,Ke)=>tt<(Ke.length-1)/2||tt===Ke.length-1,me=this.wallMode?[s]:bb(s,500);for(let tt=me.length-1;tt>=0;tt--){const Ke=me[tt];(Ke.length===0||(Ae=Ke[0]).every(lt=>lt.x<=0)||Ae.every(lt=>lt.x>=Lt)||Ae.every(lt=>lt.y<=0)||Ae.every(lt=>lt.y>=Lt))&&me.splice(tt,1)}var Ae;let Ce;if(M)Ce=ez(me,I,h);else{Ce=[];for(const tt of me)Ce.push({polygon:tt,bounds:I})}const ze=z?this.edgeRadius:0,$e=ze>0&&this.zoom<17,Xe=(tt,Ke)=>{if(tt.length===0)return!1;const lt=tt[tt.length-1];return Ke.x===lt.x&&Ke.y===lt.y};for(const{polygon:tt,bounds:Ke}of Ce){let lt=0,Tt=0;for(const mt of tt)z&&!mt[0].equals(mt[mt.length-1])&&mt.push(mt[0]),Tt+=z?mt.length-1:mt.length;const ct=this.segments.prepareSegment((z?5:4)*Tt,this.layoutVertexArray,this.indexArray);V.footprintSegIdx<0&&(V.footprintSegIdx=this.footprintSegments.length),V.polygonSegIdx<0&&(V.polygonSegIdx=this.polygonSegments.length);const At={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ot=new $4;if(ot.vertexOffset=this.footprintVertices.length,ot.indexOffset=3*this.footprintIndices.length,ot.ringIndices=[],z){const mt=[],Ot=[];lt=ct.vertexLength;for(let Ft=0;Ft<tt.length;Ft++){const Dt=tt[Ft];Dt.length&&Ft!==0&&Ot.push(mt.length/2);const Et=[];let gn,cn;gn=Dt[1].sub(Dt[0])._perp()._unit(),ot.ringIndices.push(Dt.length-1);for(let Ht=1;Ht<Dt.length;Ht++){const zt=Dt[Ht],In=Dt[Ht===Dt.length-1?1:Ht+1],dn=zt.clone();if(ze){cn=In.sub(zt)._perp()._unit();const nn=gn.add(cn)._unit(),On=ze*Math.min(4,1/(gn.x*nn.x+gn.y*nn.y));dn.x+=On*nn.x,dn.y+=On*nn.y,dn.x=Math.round(dn.x),dn.y=Math.round(dn.y),gn=cn}if(!j||ze!==0&&!$e||Xe(Et,dn)||Et.push(dn),u0(this.layoutVertexArray,dn.x,dn.y,0,0,1,1,0),this.wallMode){const nn=de(Ht,Dt);h0(this.wallVertexArray,pe.joinNormals[Ht],nn,pe.isPolygon)}ct.vertexLength++,this.footprintVertices.emplaceBack(zt.x,zt.y),mt.push(zt.x,zt.y),M&&d0(this.layoutVertexExtArray,P.projectTilePoint(dn.x,dn.y,h),P.upVector(h,dn.x,dn.y))}j&&(ze===0||$e)&&(Et.length!==0&&Xe(Et,Et[0])&&Et.pop(),this.groundEffect.addData(Et,Ke,E))}const ut=o0(mt,Ot);for(let Ft=0;Ft<ut.length;Ft+=3)this.footprintIndices.emplaceBack(ot.vertexOffset+ut[Ft+0],ot.vertexOffset+ut[Ft+1],ot.vertexOffset+ut[Ft+2]),this.indexArray.emplaceBack(lt+ut[Ft],lt+ut[Ft+2],lt+ut[Ft+1]),ct.primitiveLength++;ot.indexCount+=ut.length,ot.vertexCount+=this.footprintVertices.length-ot.vertexOffset}for(let mt=0;mt<tt.length;mt++){const Ot=tt[mt];F.startRing(V,Ot[0]);let ut=Ot.length>4&&Y4(Ot[Ot.length-2],Ot[0],Ot[1]),Ft=ze?cZ(Ot[Ot.length-2],Ot[0],Ot[1],ze):0;const Dt=[];let Et,gn,cn;gn=Ot[1].sub(Ot[0])._perp()._unit();let Ht=!0;for(let zt=1,In=0;zt<Ot.length;zt++){let dn=Ot[zt-1],nn=Ot[zt];const On=Ot[zt===Ot.length-1?1:zt+1];if(F.appendEdge(V,nn,dn),aC(nn,dn,Ke)){ze&&(gn=On.sub(nn)._perp()._unit(),Ht=!Ht);continue}const zn=nn.sub(dn)._perp(),Ln=zn.x/(Math.abs(zn.x)+Math.abs(zn.y)),$n=zn.y>0?1:0,ur=dn.dist(nn);if(In+ur>32768&&(In=0),ze){cn=On.sub(nn)._perp()._unit();let Nn=X4(dn,nn,On,Z4(gn,cn),ze);isNaN(Nn)&&(Nn=0);const Rr=nn.sub(dn)._unit();dn=dn.add(Rr.mult(Ft))._round(),nn=nn.add(Rr.mult(-Nn))._round(),Ft=Nn,gn=cn,j&&this.zoom>=17&&(Xe(Dt,dn)||Dt.push(dn),Xe(Dt,nn)||Dt.push(nn))}const tr=ct.vertexLength,Br=Ot.length>4&&Y4(dn,nn,On);let $r=Q4(In,ut,Ht);if(u0(this.layoutVertexArray,dn.x,dn.y,Ln,$n,0,0,$r),u0(this.layoutVertexArray,dn.x,dn.y,Ln,$n,0,1,$r),this.wallMode){const Nn=de(zt-1,Ot),Rr=pe.joinNormals[zt-1];h0(this.wallVertexArray,Rr,!Nn,pe.isPolygon),h0(this.wallVertexArray,Rr,!Nn,pe.isPolygon)}if(In+=ur,$r=Q4(In,Br,!Ht),ut=Br,u0(this.layoutVertexArray,nn.x,nn.y,Ln,$n,0,0,$r),u0(this.layoutVertexArray,nn.x,nn.y,Ln,$n,0,1,$r),this.wallMode){const Nn=de(zt,Ot),Rr=pe.joinNormals[zt];h0(this.wallVertexArray,Rr,!Nn,pe.isPolygon),h0(this.wallVertexArray,Rr,!Nn,pe.isPolygon)}if(ct.vertexLength+=4,this.indexArray.emplaceBack(tr+0,tr+1,tr+2),this.indexArray.emplaceBack(tr+1,tr+3,tr+2),ct.primitiveLength+=2,ze){const Nn=lt+(zt===1?Ot.length-2:zt-2),Rr=zt===1?lt:Nn+1;if(this.indexArray.emplaceBack(tr+1,Nn,tr+3),this.indexArray.emplaceBack(Nn,Rr,tr+3),ct.primitiveLength+=2,Et===void 0&&(Et=tr),!aC(On,Ot[zt],Ke)){const Dr=zt===Ot.length-1?Et:ct.vertexLength;this.indexArray.emplaceBack(tr+2,tr+3,Dr),this.indexArray.emplaceBack(tr+3,Dr+1,Dr),this.indexArray.emplaceBack(tr+3,Rr,Dr+1),ct.primitiveLength+=3}Ht=!Ht}if(M){const Nn=this.layoutVertexExtArray,Rr=P.projectTilePoint(dn.x,dn.y,h),Dr=P.projectTilePoint(nn.x,nn.y,h),Qr=P.upVector(h,dn.x,dn.y),Pi=P.upVector(h,nn.x,nn.y);d0(Nn,Rr,Qr),d0(Nn,Rr,Qr),d0(Nn,Dr,Pi),d0(Nn,Dr,Pi)}}z&&(lt+=Ot.length-1),j&&ze&&this.zoom>=17&&(Dt.length!==0&&Xe(Dt,Dt[0])&&Dt.pop(),this.groundEffect.addData(Dt,Ke,E,ze>0))}this.footprintSegments.push(ot),At.triangleCount=this.indexArray.length-At.triangleArrayOffset,this.polygonSegments.push(At),++V.footprintSegLen,++V.polygonSegLen}if(V.vertexCount=this.layoutVertexArray.length-V.vertexArrayOffset,V.groundVertexCount=this.groundEffect.vertexArray.length-V.groundVertexArrayOffset,V.vertexCount!==0){if(V.centroidXY=F.borders?j4:this.encodeCentroid(F,V),this.centroidData.push(V),F.borders){this.featuresOnBorder.push(F);const tt=this.featuresOnBorder.length-1;for(let Ke=0;Ke<F.borders.length;Ke++)F.borders[Ke][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ke].push(tt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,p,m,h,b),this.groundEffect.addPaintPropertiesData(n,c,p,m,h,b),this.maxHeight=Math.max(this.maxHeight,K)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort((s,c)=>this.featuresOnBorder[s].borders[n][0]-this.featuresOnBorder[c].borders[n][0])}splitToSubtiles(){const n=[];for(let v=0;v<this.centroidData.length;v++){const b=this.centroidData[v],E=+(b.min.y+b.max.y>Lt),I=2*E+(+(b.min.x+b.max.x>Lt)^E);for(let P=0;P<b.polygonSegLen;P++){const M=b.polygonSegIdx+P;n.push({centroidIdx:v,subtile:I,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const s=new ks;n.sort((v,b)=>v.triangleSegmentIdx===b.triangleSegmentIdx?v.subtile-b.subtile:v.triangleSegmentIdx-b.triangleSegmentIdx);let c=0,h=0,p=0;for(const v of n){if(v.triangleSegmentIdx!==c)break;p++}const m=n.length;for(;h!==n.length;){c=n[h].triangleSegmentIdx;let v=0,b=h,E=h;for(let I=b;I<p&&n[I].subtile===v;I++)E++;for(;b!==p;){const I=n[b];v=I.subtile;const P=this.centroidData[I.centroidIdx].min.clone(),M=this.centroidData[I.centroidIdx].max.clone(),z={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let F=b;F<E;F++){const V=n[F],j=this.polygonSegments[V.polygonSegmentIdx],K=this.centroidData[V.centroidIdx].min,pe=this.centroidData[V.centroidIdx].max,de=this.indexArray.uint16;for(let me=j.triangleArrayOffset;me<j.triangleArrayOffset+j.triangleCount;me++)s.emplaceBack(de[3*me],de[3*me+1],de[3*me+2]);z.primitiveLength+=j.triangleCount,P.x=Math.min(P.x,K.x),P.y=Math.min(P.y,K.y),M.x=Math.max(M.x,pe.x),M.y=Math.max(M.y,pe.y)}z.primitiveLength>0&&this.triangleSubSegments.push({segment:z,min:P,max:M}),b=E;for(let F=b;F<p&&n[F].subtile===n[b].subtile;F++)E++}h=p;for(let I=h;I<m&&n[I].triangleSegmentIdx===n[h].triangleSegmentIdx;I++)p++}s._trim(),this.indexArray=s}getVisibleSegments(n,s,c){const h=new pi;if(this.wallMode){for(const V of this.triangleSubSegments)h.segments.push(V.segment);return h}let p=0,m=0;const v=1<<n.canonical.z;if(s){const V=s.getMinMaxForTile(n);V&&(p=V.min,m=V.max)}m+=this.maxHeight;const b=n.toUnwrapped();let E;const I=[b.canonical.x/v+b.wrap,b.canonical.y/v],P=[(b.canonical.x+1)/v+b.wrap,(b.canonical.y+1)/v],M=(V,j,K)=>[V[0]*(1-K[0])+j[0]*K[0],V[1]*(1-K[1])+j[1]*K[1]],z=[],F=[];for(const V of this.triangleSubSegments){z[0]=V.min.x/Lt,z[1]=V.min.y/Lt,F[0]=V.max.x/Lt,F[1]=V.max.y/Lt;const j=M(I,P,z),K=M(I,P,F);if(new li([j[0],j[1],p],[K[0],K[1],m]).intersectsPrecise(c)===0){E&&(h.segments.push(E),E=void 0);continue}const pe=V.segment;E&&E.vertexOffset!==pe.vertexOffset&&(h.segments.push(E),E=void 0),E?(E.vertexLength+=pe.vertexLength,E.primitiveLength+=pe.primitiveLength):E={vertexOffset:pe.vertexOffset,primitiveLength:pe.primitiveLength,vertexLength:pe.vertexLength,primitiveOffset:pe.primitiveOffset,sortKey:void 0,vaos:{}}}return E&&h.segments.push(E),h}encodeCentroid(n,s){const c=n.centroid(),h=s.span(),p=Math.min(7,Math.round(h.x*this.tileToMeter/10)),m=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new Nt(Gn(c.x,1,Lt-1)<<3|p,Gn(c.y,1,Lt-1)<<3|m)}encodeBorderCentroid(n){if(!n.borders)return new Nt(0,0);const s=n.borders,c=Number.MAX_VALUE;if(s[0][0]!==c||s[1][0]!==c){const h=s[0][0]!==c?0:1;return new Nt(6|(s[0][0]!==c?0:65528),(s[h][0]+s[h][1])/2<<3|6)}{const h=s[2][0]!==c?2:3;return new Nt((s[h][0]+s[h][1])/2<<3|6,6|(s[2][0]!==c?0:65528))}}showCentroid(n){const s=this.centroidData[n.centroidDataIndex];s.flags&=wd,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);const s=n.vertexArrayOffset,c=n.vertexCount+n.vertexArrayOffset,h=n.flags&wd?j4:n.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==h.y||p!==h.x){for(let m=s;m<c;++m)this.centroidVertexArray.emplace(m,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,s,c){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const h=s.getReplacementRegionsForTile(n.toUnwrapped());if(oC(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const p=[];for(const m of this.activeReplacements){if(m.order<c)continue;const v=Math.pow(2,m.footprintTileId.canonical.z-n.canonical.z);for(const b of this.centroidData)if(!(b.flags&wd||m.min.x>b.max.x||b.min.x>m.max.x||m.min.y>b.max.y||b.min.y>m.max.y))for(let E=0;E<b.footprintSegLen;E++){const I=this.footprintSegments[b.footprintSegIdx+E];if(p.length=0,uZ(this.footprintVertices,I.vertexOffset,I.vertexCount,m.footprintTileId.canonical,n.canonical,p),R4(m.footprint,p,this.footprintIndices.uint16,I.indexOffset,I.indexCount,-I.vertexOffset,-v)){b.flags|=wd;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,s,c){let h=!1;for(let p=0;p<c.footprintSegLen;p++){const m=this.footprintSegments[c.footprintSegIdx+p];let v=0;for(const b of m.ringIndices){for(let E=v,I=b+v-1;E<b+v;I=E++){const P=this.footprintVertices.int16[2*(E+m.vertexOffset)+0],M=this.footprintVertices.int16[2*(E+m.vertexOffset)+1],z=this.footprintVertices.int16[2*(I+m.vertexOffset)+1];M>s!=z>s&&n<(this.footprintVertices.int16[2*(I+m.vertexOffset)+0]-P)*(s-M)/(z-M)+P&&(h=!h)}v=b}}return h}getHeightAtTileCoord(n,s){let c=Number.NEGATIVE_INFINITY,h=!0;const p=4*(n+Lt)*Lt+(s+Lt);if(this.partLookup.hasOwnProperty(p)){const m=this.partLookup[p];return m?{height:m.height,hidden:!!(m.flags&wd)}:void 0}for(const m of this.centroidData)n>m.max.x||m.min.x>n||s>m.max.y||m.min.y>s||this.footprintContainsPoint(n,s,m)&&m&&m.height>c&&(c=m.height,this.partLookup[p]=m,h=!!(m.flags&wd));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:h};this.partLookup[p]=void 0}}function Z4(i,n){const s=i.add(n)._unit();return i.x*s.x+i.y*s.y}function cZ(i,n,s,c){const h=n.sub(i)._perp()._unit(),p=s.sub(n)._perp()._unit();return X4(i,n,s,Z4(h,p),c)}function X4(i,n,s,c,h){const p=Math.sqrt(1-c*c);return Math.min(i.dist(n)/3,n.dist(s)/3,h*p/c)}function aC(i,n,s){return i.x<s[0].x&&n.x<s[0].x||i.x>s[1].x&&n.x>s[1].x||i.y<s[0].y&&n.y<s[0].y||i.y>s[1].y&&n.y>s[1].y}function K4(i,n){return i.x<n[0].x||i.x>n[1].x||i.y<n[0].y||i.y>n[1].y}function Y4(i,n,s){if(i.x<0||i.x>=Lt||n.x<0||n.x>=Lt||s.x<0||s.x>=Lt)return!1;const c=s.sub(n),h=c.perp(),p=i.sub(n);return(c.x*p.x+c.y*p.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(p.x*p.x+p.y*p.y))>-.866&&h.x*p.x+h.y*p.y<0}function Q4(i,n,s){const c=n?2|i:-3&i;return s?1|c:-2&c}function J4(){const i=Math.PI/32,n=Math.tan(i),s=ag;return s*Math.sqrt(1+2*n*n)-s}function ez(i,n,s){const c=1<<s.z,h=ca(s.x/c),p=ca((s.x+1)/c),m=Vs(s.y/c),v=Vs((s.y+1)/c);return function(b,E,I,P,M=0,z){const F=[];if(!b.length||!I||!P)return F;const V=(Ce,ze)=>{for(const $e of Ce)F.push({polygon:$e,bounds:ze})},j=Math.ceil(Math.log2(I)),K=Math.ceil(Math.log2(P)),pe=j-K,de=[];for(let Ce=0;Ce<Math.abs(pe);Ce++)de.push(pe>0?0:1);for(let Ce=0;Ce<Math.min(j,K);Ce++)de.push(0),de.push(1);let me=b;if(me=Sb(me,E[0].y-M,E[1].y+M,1),me=Sb(me,E[0].x-M,E[1].x+M,0),!me.length)return F;const Ae=[];for(de.length?Ae.push({polygons:me,bounds:E,depth:0}):V(me,E);Ae.length;){const Ce=Ae.pop(),ze=Ce.depth,$e=de[ze],Xe=Ce.bounds[0],tt=Ce.bounds[1],Ke=$e===0?Xe.x:Xe.y,lt=$e===0?tt.x:tt.y,Tt=z?z($e,Ke,lt):.5*(Ke+lt),ct=Sb(Ce.polygons,Ke-M,Tt+M,$e),At=Sb(Ce.polygons,Tt-M,lt+M,$e);if(ct.length){const ot=[Xe,new Nt($e===0?Tt:tt.x,$e===1?Tt:tt.y)];de.length>ze+1?Ae.push({polygons:ct,bounds:ot,depth:ze+1}):V(ct,ot)}if(At.length){const ot=[new Nt($e===0?Tt:Xe.x,$e===1?Tt:Xe.y),tt];de.length>ze+1?Ae.push({polygons:At,bounds:ot,depth:ze+1}):V(At,ot)}}return F}(i,n,Math.ceil((p-h)/11.25),Math.ceil((m-v)/11.25),1,(b,E,I)=>{if(b===0)return .5*(E+I);{const P=Vs((s.y+E/Lt)/c);return(Yc(.5*(Vs((s.y+I/Lt)/c)+P))*c-s.y)*Lt}})}function uZ(i,n,s,c,h,p){const m=Math.pow(2,c.z-h.z);for(let v=0;v<s;v++){let b=i.int16[2*(v+n)+0],E=i.int16[2*(v+n)+1];b=(b+h.x*Lt)*m-c.x*Lt,E=(E+h.y*Lt)*m-c.y*Lt,p.push(new Nt(b,E))}}let tz,nz;function f0(i,n){return i.x*n.x+i.y*n.y}function rz(i,n){if(i.length===1){let s=0;const c=n[s++];let h;for(;!h||c.equals(h);)if(h=n[s++],!h)return 1/0;for(;s<n.length;s++){const p=n[s],m=i[0],v=h.sub(c),b=p.sub(c),E=m.sub(c),I=f0(v,v),P=f0(v,b),M=f0(b,b),z=f0(E,v),F=f0(E,b),V=I*M-P*P,j=(M*z-P*F)/V,K=(I*F-P*z)/V,pe=c.z*(1-j-K)+h.z*j+p.z*K;if(isFinite(pe))return pe}return 1/0}{let s=1/0;for(const c of n)s=Math.min(s,c.z);return s}}function iz(i,n,s,c,h,p,m,v){const b=m*h.getElevationAt(i,n,!0,!0),E=p[0]!==0,I=E?p[1]===0?m*(p[0]/7-450):m*function(P,M,z){const F=Math.floor(M[0]/8),V=Math.floor(M[1]/8),j=10*(M[0]-8*F),K=10*(M[1]-8*V),pe=P.getElevationAt(F,V,!0,!0),de=P.getMeterToDEM(z),me=Math.floor(.5*(j*de-1)),Ae=Math.floor(.5*(K*de-1)),Ce=P.tileCoordToPixel(F,V),ze=2*me+1,$e=2*Ae+1,Xe=function(At,ot,mt,Ot,ut){return[At.getElevationAtPixel(ot,mt,!0),At.getElevationAtPixel(ot+ut,mt,!0),At.getElevationAtPixel(ot,mt+ut,!0),At.getElevationAtPixel(ot+Ot,mt+ut,!0)]}(P,Ce.x-me,Ce.y-Ae,ze,$e),tt=Math.abs(Xe[0]-Xe[1]),Ke=Math.abs(Xe[2]-Xe[3]),lt=Math.abs(Xe[0]-Xe[2])+Math.abs(Xe[1]-Xe[3]),Tt=Math.min(.25,.5*de*(tt+Ke)/ze),ct=Math.min(.25,.5*de*lt/$e);return pe+Math.max(Tt*j,ct*K)}(h,p,v):b;return{base:b+(s===0)?-1:s,top:E?Math.max(I+c,b+s+2):b+c}}je(Rb,"FillExtrusionBucket",{omit:["layers","features"]}),je(G4,"PartData"),je($4,"FootprintSegment"),je(q4,"BorderCentroidData"),je(H4,"GroundEffect");const hZ=Pr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:dZ}=hZ,fZ=Pr([{name:"a_packed",components:4,type:"Float32"}]),{members:pZ}=fZ,mZ=Pr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:gZ}=mZ,_Z=Pr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),yZ=Pr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),vZ=Pr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Pr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const sz=Pr([{name:"a_z_offset",components:1,type:"Float32"}],4),xZ=Pr([{name:"a_texb",components:2,type:"Uint16"}]),bZ=Pr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),wZ=Pr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Pr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const oz=Pr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),TZ=Pr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Pr([{name:"triangle",components:3,type:"Uint16"}]),Pr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Pr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Pr([{type:"Float32",name:"offsetX"}]),Pr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class az{constructor(n,s){this.width=n,this.height=s,this.nextRow=0,this.image=new xd({width:n,height:s}),this.positions={},this.uploaded=!1}getDash(n,s){const c=this.getKey(n,s);return this.positions[c]}trim(){const n=this.width,s=this.height=va(this.nextRow);this.image.resize({width:n,height:s})}getKey(n,s){return n.join(",")+s}getDashRanges(n,s,c){const h=[];let p=n.length%2==1?-n[n.length-1]*c:0,m=n[0]*c,v=!0;h.push({left:p,right:m,isDash:v,zeroLength:n[0]===0});let b=n[0];for(let E=1;E<n.length;E++){v=!v;const I=n[E];p=b*c,b+=I,m=b*c,h.push({left:p,right:m,isDash:v,zeroLength:I===0})}return h}addRoundDash(n,s,c){const h=s/2;for(let p=-c;p<=c;p++){const m=this.width*(this.nextRow+c+p);let v=0,b=n[v];for(let E=0;E<this.width;E++){E/b.right>1&&(b=n[++v]);const I=Math.abs(E-b.left),P=Math.abs(E-b.right),M=Math.min(I,P);let z;const F=p/c*(h+1);if(b.isDash){const V=h-Math.abs(F);z=Math.sqrt(M*M+V*V)}else z=h-Math.sqrt(M*M+F*F);this.image.data[m+E]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(n,s){for(let b=n.length-1;b>=0;--b){const E=n[b],I=n[b+1];E.zeroLength?n.splice(b,1):I&&I.isDash===E.isDash&&(I.left=E.left,n.splice(b,1))}const c=n[0],h=n[n.length-1];c.isDash===h.isDash&&(c.left=h.left-this.width,h.right=c.right+this.width);const p=this.width*this.nextRow;let m=0,v=n[m];for(let b=0;b<this.width;b++){b/v.right>1&&(v=n[++m]);const E=Math.abs(b-v.left),I=Math.abs(b-v.right),P=Math.min(E,I);this.image.data[p+b]=Math.max(0,Math.min(255,(v.isDash?P:-P)+s+128))}}addDash(n,s){const c=this.getKey(n,s);if(this.positions[c])return this.positions[c];const h=s==="round",p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return _i("LineAtlas out of space"),null;n.length===0&&n.push(1);let v=0;for(let I=0;I<n.length;I++)n[I]<0&&(_i("Negative value is found in line dasharray, replacing values with 0"),n[I]=0),v+=n[I];if(v!==0){const I=this.width/v,P=this.getDashRanges(n,this.width,I);h?this.addRoundDash(P,I,p):this.addRegularDash(P,s==="square"?.5*I:0)}const b=this.nextRow+p;this.nextRow+=m;const E={tl:[b,p],br:[v,0]};return this.positions[c]=E,E}}je(az,"LineAtlas");const EZ=Eb.types,SZ=Math.cos(Math.PI/180*37.5),IZ=Math.cos(Math.PI/180*5);class Mb{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new dA,this.layoutVertexArray2=new dd,this.patternVertexArray=new fd,this.indexArray=new ks,this.programConfigurations=new _d(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new pi,this.maxLineLength=0,this.zOffsetVertexArray=new rg,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=n.tessellationStep?n.tessellationStep:Lt/64}updateFootprints(n,s){}populate(n,s,c,h){this.hasPattern=tC("line",this.layers,s);const p=this.layers[0].layout.get("line-sort-key"),m=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!m.isConstant()||!!m.constantOr(0);const v=[];for(const{feature:P,id:M,index:z,sourceLayerIndex:F}of n){const V=this.layers[0]._featureFilter.needGeometry,j=th(P,V);if(!this.layers[0]._featureFilter.filter(new An(this.zoom),j,c))continue;const K=p?p.evaluate(j,{},c):void 0,pe={id:M,properties:P.properties,type:P.type,sourceLayerIndex:F,index:z,geometry:V?j.geometry:uc(P,c,h),patterns:{},sortKey:K};v.push(pe)}p&&v.sort((P,M)=>P.sortKey-M.sortKey);const{lineAtlas:b,featureIndex:E}=s,I=this.addConstantDashes(b);for(const P of v){const{geometry:M,index:z,sourceLayerIndex:F}=P;if(I&&this.addFeatureDashes(P,b),this.hasPattern){const V=nC("line",this.layers,P,this.zoom,s);this.patternFeatures.push(V)}else this.addFeature(P,M,z,c,b.positions,s.availableImages,s.brightness);E.insert(n[z].feature,M,z,F,this.index)}}addConstantDashes(n){let s=!1;for(const c of this.layers){const h=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")s=!0;else{const m=p.value,v=h.value;if(!v)continue;n.addDash(v,m)}}return s}addFeatureDashes(n,s){const c=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,m=h.layout.get("line-cap").value;if(p.kind==="constant"&&m.kind==="constant")continue;let v,b;if(p.kind==="constant"){if(v=p.value,!v)continue}else v=p.evaluate({zoom:c},n);b=m.kind==="constant"?m.value:m.evaluate({zoom:c},n),s.addDash(v,b),n.patterns[h.id]=s.getKey(v,b)}}update(n,s,c,h,p){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,s,m?this.stateDependentLayers:this.layers,c,h,p)}addFeatures(n,s,c,h,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,c,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,pZ)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=n.createVertexBuffer(this.patternVertexArray,gZ)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,sz.members,!0)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,dZ),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,s,c,h,p,m,v){const b=this.layers[0].layout,E=b.get("line-join").evaluate(n,{}),I=b.get("line-cap").evaluate(n,{}),P=b.get("line-miter-limit"),M=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const z of s)this.addLine(z,n,h,E,I,P,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,p,m,h,v)}addLine(n,s,c,h,p,m,v){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const b={zoom:this.zoom,lineProgress:void 0},E=this.layers[0].layout,I=h==="none";if(this.patternJoinNone=this.hasPattern&&I,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ce=0;Ce<n.length-1;Ce++)this.totalDistance+=n[Ce].dist(n[Ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=EZ[s.type]==="Polygon";let M=n.length;for(;M>=2&&n[M-1].equals(n[M-2]);)M--;let z=0;for(;z<M-1&&n[z].equals(n[z+1]);)z++;if(M<(P?3:2))return;h==="bevel"&&(m=1.05);const F=this.overscaling<=16?15*Lt/(512*this.overscaling):0,V=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let j,K,pe,de,me,Ae;this.e1=this.e2=-1,P&&(j=n[M-2],me=n[z].sub(j)._unit()._perp());for(let Ce=z;Ce<M;Ce++){if(pe=Ce===M-1?P?n[z+1]:void 0:n[Ce+1],pe&&n[Ce].equals(pe))continue;if(me&&(de=me),j&&(K=j),j=n[Ce],this.hasZOffset){const ot=E.get("line-z-offset").value;if(ot.kind==="constant")Ae=ot.value;else{if(this.lineClips){const mt=this.totalDistance/(this.lineClips.end-this.lineClips.start);b.lineProgress=(mt*this.lineClips.start+this.distance+(K?K.dist(j):0))/mt}else _i(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),b.lineProgress=0;Ae=ot.evaluate(b,s)}Ae=Ae||0}me=pe?pe.sub(j)._unit()._perp():de,de=de||me;const ze=K&&pe;let $e=ze?h:P||I?"butt":p;const Xe=de.x*me.x+de.y*me.y;if(I){const ot=function(mt){if(mt.patternJoinNone){const Ot=mt.segmentPoints.length/2,ut=mt.lineSoFar-mt.segmentStart;for(let Ft=0;Ft<Ot;++Ft){const Dt=mt.segmentPoints[2*Ft+1],Et=Math.round(mt.segmentPoints[2*Ft])+.5+.25*Dt;mt.patternVertexArray.emplaceBack(Et,ut,mt.segmentStart),mt.patternVertexArray.emplaceBack(Et,ut,mt.segmentStart)}mt.segmentPoints.length=0}mt.e1=mt.e2=-1};if(ze&&Xe<IZ){this.updateDistance(K,j),this.addCurrentVertex(j,de,1,1,V,Ae),ot(this),this.addCurrentVertex(j,me,-1,-1,V,Ae);continue}if(K){if(!pe){this.updateDistance(K,j),this.addCurrentVertex(j,de,1,1,V,Ae),ot(this);continue}$e="miter"}}let tt=de.add(me);tt.x===0&&tt.y===0||tt._unit();const Ke=tt.x*me.x+tt.y*me.y,lt=Ke!==0?1/Ke:1/0,Tt=2*Math.sqrt(2-2*Ke),ct=Ke<SZ&&K&&pe,At=de.x*me.y-de.y*me.x>0;if(ct&&Ce>z){const ot=j.dist(K);if(ot>2*F){const mt=j.sub(j.sub(K)._mult(F/ot)._round());this.updateDistance(K,mt),this.addCurrentVertex(mt,de,0,0,V,Ae),K=mt}}if(ze&&$e==="round"&&(lt<v?$e="miter":lt<=2&&($e="fakeround")),$e==="miter"&&lt>m&&($e="bevel"),$e==="bevel"&&(lt>2&&($e="flipbevel"),lt<m&&($e="miter")),K&&this.updateDistance(K,j),$e==="miter")tt._mult(lt),this.addCurrentVertex(j,tt,0,0,V,Ae);else if($e==="flipbevel"){if(lt>100)tt=me.mult(-1);else{const ot=lt*de.add(me).mag()/de.sub(me).mag();tt._perp()._mult(ot*(At?-1:1))}this.addCurrentVertex(j,tt,0,0,V,Ae),this.addCurrentVertex(j,tt.mult(-1),0,0,V,Ae)}else if($e==="bevel"||$e==="fakeround"){const ot=-Math.sqrt(lt*lt-1),mt=At?ot:0,Ot=At?0:ot;if(K&&this.addCurrentVertex(j,de,mt,Ot,V,Ae),$e==="fakeround"){const ut=Math.round(180*Tt/Math.PI/20);for(let Ft=1;Ft<ut;Ft++){let Dt=Ft/ut;if(Dt!==.5){const gn=Dt-.5;Dt+=Dt*gn*(Dt-1)*((1.0904+Xe*(Xe*(3.55645-1.43519*Xe)-3.2452))*gn*gn+(.848013+Xe*(.215638*Xe-1.06021)))}const Et=me.sub(de)._mult(Dt)._add(de)._unit()._mult(At?-1:1);this.addHalfVertex(j,Et.x,Et.y,!1,At,0,V,Ae)}}pe&&this.addCurrentVertex(j,me,-mt,-Ot,V,Ae)}else $e==="butt"?this.addCurrentVertex(j,tt,0,0,V,Ae):$e==="square"?(K||this.addCurrentVertex(j,tt,-1,-1,V,Ae),this.addCurrentVertex(j,tt,0,0,V,Ae),K&&this.addCurrentVertex(j,tt,1,1,V,Ae)):$e==="round"&&(K&&(this.addCurrentVertex(j,de,0,0,V,Ae),this.addCurrentVertex(j,de,1,1,V,Ae,!0)),pe&&(this.addCurrentVertex(j,me,-1,-1,V,Ae,!0),this.addCurrentVertex(j,me,0,0,V,Ae)));if(ct&&Ce<M-1){const ot=j.dist(pe);if(ot>2*F){const mt=j.add(pe.sub(j)._mult(F/ot)._round());this.updateDistance(j,mt),this.addCurrentVertex(mt,me,0,0,V,Ae),j=mt}}}}addVerticesTo(n,s,c,h,p,m,v,b,E,I){const P=(s.w-n.w)/this.tessellationStep|0;if(P>1){this.lineSoFar=n.w;const M=(s.x-n.x)/P,z=(s.y-n.y)/P,F=(s.z-n.z)/P,V=(s.w-n.w)/P;for(let j=1;j<P;++j)n.x+=M,n.y+=z,n.z+=F,this.lineSoFar+=V,this.addHalfVertex(n,c,h,I,!1,v,E,n.z),this.addHalfVertex(n,p,m,I,!0,-b,E,n.z)}this.lineSoFar=s.w,this.addHalfVertex(s,c,h,I,!1,v,E,s.z),this.addHalfVertex(s,p,m,I,!0,-b,E,s.z)}addCurrentVertex(n,s,c,h,p,m,v=!1){const b=s.x+s.y*c,E=s.y-s.x*c,I=s.y*h-s.x,P=-s.y-s.x*h;if(m!=null){const z=Lt+10,F=m,V=new E4(n.x,n.y,F,this.lineSoFar),j=lz(n,-10,z),K=this.lineSoFar;if(this.currentVertex)if(j){const pe=this.currentVertexIsOutside,de=this.currentVertex,me=new E4(n.x,n.y,F,this.lineSoFar);I4(de,me,-10,z),lz(me,-10,z)||(pe&&(this.e1=this.e2=-1,this.lineSoFar=de.w,this.addHalfVertex(de,b,E,v,!1,c,p,de.z),this.addHalfVertex(de,I,P,v,!0,-h,p,de.z)),this.addVerticesTo(de,me,b,E,I,P,c,h,p,v))}else{const pe=this.currentVertex;this.currentVertexIsOutside&&(I4(pe,V,-10,z),this.e1=this.e2=-1,this.lineSoFar=pe.w,this.addHalfVertex(pe,b,E,v,!1,c,p,pe.z),this.addHalfVertex(pe,I,P,v,!0,-h,p,pe.z)),this.addVerticesTo(pe,V,b,E,I,P,c,h,p,v)}else j||(this.addHalfVertex(n,b,E,v,!1,c,p,m),this.addHalfVertex(n,I,P,v,!0,-h,p,m));this.currentVertex=V,this.currentVertexIsOutside=j,this.lineSoFar=K}else this.addHalfVertex(n,b,E,v,!1,c,p,m),this.addHalfVertex(n,I,P,v,!0,-h,p,m)}addHalfVertex({x:n,y:s},c,h,p,m,v,b,E){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((n<<1)+(p?1:0),(s<<1)+(m?1:0),Math.round(63*c)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const I=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),b.primitiveLength++),m?this.e2=I:this.e1=I,E!=null&&this.zOffsetVertexArray.emplaceBack(E)}updateScaledDistance(){if(this.lineClips){const n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,s){this.distance+=n.dist(s),this.updateScaledDistance()}}function lz(i,n,s){return i.x<n||i.x>s||i.y<n||i.y>s}let cz,uz;function hz(i,n,s){return n*(Lt/(i.tileSize*Math.pow(2,s-i.tileID.overscaledZ)))}function dz(i,n){return 1/hz(i,1,n.tileZoom)}function fz(i,n,s,c){return i.translatePosMatrix(c||n.tileID.projMatrix,n,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}je(Mb,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const pz=i=>{const n=[];mz(i)&&n.push("RENDER_LINE_DASH"),i.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");const s=i.paint.get("line-trim-offset");s[0]===0&&s[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),i.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER");const c=i.layout.get("line-join").constantOr("miter")==="none",h=!!i.paint.get("line-pattern").constantOr(1);return c&&h&&n.push("LINE_JOIN_NONE"),n};function mz(i){const n=i.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}class gz{constructor(n){this._stringToNumber={},this._numberToString=[];for(let s=0;s<n.length;s++){const c=n[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}var AZ={read:function(i,n,s,c,h){var p,m,v=8*h-c-1,b=(1<<v)-1,E=b>>1,I=-7,P=s?h-1:0,M=s?-1:1,z=i[n+P];for(P+=M,p=z&(1<<-I)-1,z>>=-I,I+=v;I>0;p=256*p+i[n+P],P+=M,I-=8);for(m=p&(1<<-I)-1,p>>=-I,I+=c;I>0;m=256*m+i[n+P],P+=M,I-=8);if(p===0)p=1-E;else{if(p===b)return m?NaN:1/0*(z?-1:1);m+=Math.pow(2,c),p-=E}return(z?-1:1)*m*Math.pow(2,p-c)},write:function(i,n,s,c,h,p){var m,v,b,E=8*p-h-1,I=(1<<E)-1,P=I>>1,M=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=c?0:p-1,F=c?1:-1,V=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(v=isNaN(n)?1:0,m=I):(m=Math.floor(Math.log(n)/Math.LN2),n*(b=Math.pow(2,-m))<1&&(m--,b*=2),(n+=m+P>=1?M/b:M*Math.pow(2,1-P))*b>=2&&(m++,b/=2),m+P>=I?(v=0,m=I):m+P>=1?(v=(n*b-1)*Math.pow(2,h),m+=P):(v=n*Math.pow(2,P-1)*Math.pow(2,h),m=0));h>=8;i[s+z]=255&v,z+=F,v/=256,h-=8);for(m=m<<h|v,E+=h;E>0;i[s+z]=255&m,z+=F,m/=256,E-=8);i[s+z-F]|=128*V}},_z=ci,kb=AZ;function ci(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}ci.Varint=0,ci.Fixed64=1,ci.Bytes=2,ci.Fixed32=5;var lC=4294967296,yz=1/lC,vz=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ih(i){return i.type===ci.Bytes?i.readVarint()+i.pos:i.pos+1}function pg(i,n,s){return s?4294967296*n+(i>>>0):4294967296*(n>>>0)+(i>>>0)}function xz(i,n,s){var c=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));s.realloc(c);for(var h=s.pos-1;h>=i;h--)s.buf[h+c]=s.buf[h]}function CZ(i,n){for(var s=0;s<i.length;s++)n.writeVarint(i[s])}function PZ(i,n){for(var s=0;s<i.length;s++)n.writeSVarint(i[s])}function RZ(i,n){for(var s=0;s<i.length;s++)n.writeFloat(i[s])}function MZ(i,n){for(var s=0;s<i.length;s++)n.writeDouble(i[s])}function kZ(i,n){for(var s=0;s<i.length;s++)n.writeBoolean(i[s])}function DZ(i,n){for(var s=0;s<i.length;s++)n.writeFixed32(i[s])}function OZ(i,n){for(var s=0;s<i.length;s++)n.writeSFixed32(i[s])}function LZ(i,n){for(var s=0;s<i.length;s++)n.writeFixed64(i[s])}function zZ(i,n){for(var s=0;s<i.length;s++)n.writeSFixed64(i[s])}function Db(i,n){return(i[n]|i[n+1]<<8|i[n+2]<<16)+16777216*i[n+3]}function mg(i,n,s){i[s]=n,i[s+1]=n>>>8,i[s+2]=n>>>16,i[s+3]=n>>>24}function bz(i,n){return(i[n]|i[n+1]<<8|i[n+2]<<16)+(i[n+3]<<24)}ci.prototype={destroy:function(){this.buf=null},readFields:function(i,n,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),h=c>>3,p=this.pos;this.type=7&c,i(h,n,this),this.pos===p&&this.skip(c)}return n},readMessage:function(i,n){return this.readFields(i,n,this.readVarint()+this.pos)},readFixed32:function(){var i=Db(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=bz(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Db(this.buf,this.pos)+Db(this.buf,this.pos+4)*lC;return this.pos+=8,i},readSFixed64:function(){var i=Db(this.buf,this.pos)+bz(this.buf,this.pos+4)*lC;return this.pos+=8,i},readFloat:function(){var i=kb.read(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=kb.read(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var n,s,c=this.buf;return n=127&(s=c[this.pos++]),s<128?n:(n|=(127&(s=c[this.pos++]))<<7,s<128?n:(n|=(127&(s=c[this.pos++]))<<14,s<128?n:(n|=(127&(s=c[this.pos++]))<<21,s<128?n:function(h,p,m){var v,b,E=m.buf;if(v=(112&(b=E[m.pos++]))>>4,b<128||(v|=(127&(b=E[m.pos++]))<<3,b<128)||(v|=(127&(b=E[m.pos++]))<<10,b<128)||(v|=(127&(b=E[m.pos++]))<<17,b<128)||(v|=(127&(b=E[m.pos++]))<<24,b<128)||(v|=(1&(b=E[m.pos++]))<<31,b<128))return pg(h,v,p);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(s=c[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,n=this.pos;return this.pos=i,i-n>=12&&vz?function(s,c,h){return vz.decode(s.subarray(c,h))}(this.buf,n,i):function(s,c,h){for(var p="",m=c;m<h;){var v,b,E,I=s[m],P=null,M=I>239?4:I>223?3:I>191?2:1;if(m+M>h)break;M===1?I<128&&(P=I):M===2?(192&(v=s[m+1]))==128&&(P=(31&I)<<6|63&v)<=127&&(P=null):M===3?(b=s[m+2],(192&(v=s[m+1]))==128&&(192&b)==128&&((P=(15&I)<<12|(63&v)<<6|63&b)<=2047||P>=55296&&P<=57343)&&(P=null)):M===4&&(b=s[m+2],E=s[m+3],(192&(v=s[m+1]))==128&&(192&b)==128&&(192&E)==128&&((P=(15&I)<<18|(63&v)<<12|(63&b)<<6|63&E)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,M=1):P>65535&&(P-=65536,p+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),p+=String.fromCharCode(P),m+=M}return p}(this.buf,n,i)},readBytes:function(){var i=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,i);return this.pos=i,n},readPackedVarint:function(i,n){if(this.type!==ci.Bytes)return i.push(this.readVarint(n));var s=ih(this);for(i=i||[];this.pos<s;)i.push(this.readVarint(n));return i},readPackedSVarint:function(i){if(this.type!==ci.Bytes)return i.push(this.readSVarint());var n=ih(this);for(i=i||[];this.pos<n;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==ci.Bytes)return i.push(this.readBoolean());var n=ih(this);for(i=i||[];this.pos<n;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==ci.Bytes)return i.push(this.readFloat());var n=ih(this);for(i=i||[];this.pos<n;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==ci.Bytes)return i.push(this.readDouble());var n=ih(this);for(i=i||[];this.pos<n;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==ci.Bytes)return i.push(this.readFixed32());var n=ih(this);for(i=i||[];this.pos<n;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==ci.Bytes)return i.push(this.readSFixed32());var n=ih(this);for(i=i||[];this.pos<n;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==ci.Bytes)return i.push(this.readFixed64());var n=ih(this);for(i=i||[];this.pos<n;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==ci.Bytes)return i.push(this.readSFixed64());var n=ih(this);for(i=i||[];this.pos<n;)i.push(this.readSFixed64());return i},skip:function(i){var n=7&i;if(n===ci.Varint)for(;this.buf[this.pos++]>127;);else if(n===ci.Bytes)this.pos=this.readVarint()+this.pos;else if(n===ci.Fixed32)this.pos+=4;else{if(n!==ci.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(i,n){this.writeVarint(i<<3|n)},realloc:function(i){for(var n=this.length||16;n<this.pos+i;)n*=2;if(n!==this.length){var s=new Uint8Array(n);s.set(this.buf),this.buf=s,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),mg(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),mg(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),mg(this.buf,-1&i,this.pos),mg(this.buf,Math.floor(i*yz),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),mg(this.buf,-1&i,this.pos),mg(this.buf,Math.floor(i*yz),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(n,s){var c,h;if(n>=0?(c=n%4294967296|0,h=n/4294967296|0):(h=~(-n/4294967296),4294967295^(c=~(-n%4294967296))?c=c+1|0:(c=0,h=h+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(p,m,v){v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7)}(c,0,s),function(p,m){var v=(7&p)<<4;m.buf[m.pos++]|=v|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))}(h,s)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var n=this.pos;this.pos=function(c,h,p){for(var m,v,b=0;b<h.length;b++){if((m=h.charCodeAt(b))>55295&&m<57344){if(!v){m>56319||b+1===h.length?(c[p++]=239,c[p++]=191,c[p++]=189):v=m;continue}if(m<56320){c[p++]=239,c[p++]=191,c[p++]=189,v=m;continue}m=v-55296<<10|m-56320|65536,v=null}else v&&(c[p++]=239,c[p++]=191,c[p++]=189,v=null);m<128?c[p++]=m:(m<2048?c[p++]=m>>6|192:(m<65536?c[p++]=m>>12|224:(c[p++]=m>>18|240,c[p++]=m>>12&63|128),c[p++]=m>>6&63|128),c[p++]=63&m|128)}return p}(this.buf,i,this.pos);var s=this.pos-n;s>=128&&xz(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeFloat:function(i){this.realloc(4),kb.write(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),kb.write(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var n=i.length;this.writeVarint(n),this.realloc(n);for(var s=0;s<n;s++)this.buf[this.pos++]=i[s]},writeRawMessage:function(i,n){this.pos++;var s=this.pos;i(n,this);var c=this.pos-s;c>=128&&xz(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(i,n,s){this.writeTag(i,ci.Bytes),this.writeRawMessage(n,s)},writePackedVarint:function(i,n){n.length&&this.writeMessage(i,CZ,n)},writePackedSVarint:function(i,n){n.length&&this.writeMessage(i,PZ,n)},writePackedBoolean:function(i,n){n.length&&this.writeMessage(i,kZ,n)},writePackedFloat:function(i,n){n.length&&this.writeMessage(i,RZ,n)},writePackedDouble:function(i,n){n.length&&this.writeMessage(i,MZ,n)},writePackedFixed32:function(i,n){n.length&&this.writeMessage(i,DZ,n)},writePackedSFixed32:function(i,n){n.length&&this.writeMessage(i,OZ,n)},writePackedFixed64:function(i,n){n.length&&this.writeMessage(i,LZ,n)},writePackedSFixed64:function(i,n){n.length&&this.writeMessage(i,zZ,n)},writeBytesField:function(i,n){this.writeTag(i,ci.Bytes),this.writeBytes(n)},writeFixed32Field:function(i,n){this.writeTag(i,ci.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(i,n){this.writeTag(i,ci.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(i,n){this.writeTag(i,ci.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(i,n){this.writeTag(i,ci.Fixed64),this.writeSFixed64(n)},writeVarintField:function(i,n){this.writeTag(i,ci.Varint),this.writeVarint(n)},writeSVarintField:function(i,n){this.writeTag(i,ci.Varint),this.writeSVarint(n)},writeStringField:function(i,n){this.writeTag(i,ci.Bytes),this.writeString(n)},writeFloatField:function(i,n){this.writeTag(i,ci.Fixed32),this.writeFloat(n)},writeDoubleField:function(i,n){this.writeTag(i,ci.Fixed64),this.writeDouble(n)},writeBooleanField:function(i,n){this.writeVarintField(i,!!n)}};var p0=fe(_z);const NZ=["id","tile","layer","source","sourceLayer","state"];class wz{constructor(n,s,c,h,p){this.type="Feature",this._vectorTileFeature=n,this._z=s,this._x=c,this._y=h,this.properties=n.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const s of NZ)this[s]!==void 0&&(n[s]=this[s]);return n}}class FZ{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,s,c){const h=String(s);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][h]=this.stateChanges[n][h]||{},ws(this.stateChanges[n][h],c),this.deletedStates[n]===null){this.deletedStates[n]={};for(const p in this.state[n])p!==h&&(this.deletedStates[n][p]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][h]===null){this.deletedStates[n][h]={};for(const p in this.state[n][h])c[p]||(this.deletedStates[n][h][p]=null)}else for(const p in c)this.deletedStates[n]&&this.deletedStates[n][h]&&this.deletedStates[n][h][p]===null&&delete this.deletedStates[n][h][p]}removeFeatureState(n,s,c){if(this.deletedStates[n]===null)return;const h=String(s);if(this.deletedStates[n]=this.deletedStates[n]||{},c&&s!==void 0)this.deletedStates[n][h]!==null&&(this.deletedStates[n][h]=this.deletedStates[n][h]||{},this.deletedStates[n][h][c]=null);else if(s!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][h])for(c in this.deletedStates[n][h]={},this.stateChanges[n][h])this.deletedStates[n][h][c]=null;else this.deletedStates[n][h]=null;else this.deletedStates[n]=null}getState(n,s){const c=String(s),h=ws({},(this.state[n]||{})[c],(this.stateChanges[n]||{})[c]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const p=this.deletedStates[n][s];if(p===null)return{};for(const m in p)delete h[m]}return h}initializeTileState(n,s){n.setFeatureState(this.state,s)}coalesceChanges(n,s){const c={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const p={};for(const m in this.stateChanges[h])this.state[h][m]||(this.state[h][m]={}),ws(this.state[h][m],this.stateChanges[h][m]),p[m]=this.state[h][m];c[h]=p}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const p={};if(this.deletedStates[h]===null)for(const m in this.state[h])p[m]={},this.state[h][m]={};else for(const m in this.deletedStates[h]){if(this.deletedStates[h][m]===null)this.state[h][m]={};else if(this.state[h][m])for(const v of Object.keys(this.deletedStates[h][m]))delete this.state[h][m][v];p[m]=this.state[h][m]}c[h]=c[h]||{},ws(c[h],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const h in n)n[h].setFeatureState(c,s)}}class Tz{constructor(n,s){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Je(Lt,16,0),this.featureIndexArray=new yL,this.promoteId=s,this.is3DTile=!1}insert(n,s,c,h,p,m=0,v=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,h,p,m);const E=this.grid;for(let I=0;I<s.length;I++){const P=s[I],M=[1/0,1/0,-1/0,-1/0];for(let z=0;z<P.length;z++){const F=P[z];M[0]=Math.min(M[0],F.x),M[1]=Math.min(M[1],F.y),M[2]=Math.max(M[2],F.x),M[3]=Math.max(M[3],F.y)}v!==0&&(M[0]-=v,M[1]-=v,M[2]+=v,M[3]+=v),M[0]<Lt&&M[1]<Lt&&M[2]>=0&&M[3]>=0&&E.insert(b,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new iC(new p0(this.rawTileData)).layers,this.sourceLayerCoder=new gz(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,s,c,h){this.loadVTLayers();const p=n.params||{},m=ac(p.filter),v=n.tileResult,b=n.transform,E=v.bufferedTilespaceBounds,I=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(F,V,j,K)=>NL(v.bufferedTilespaceGeometry,F,V,j,K));I.sort(BZ);let P=null;b.elevation&&I.length>0&&(P=fg.create(b.elevation,this.tileID));const M={};let z;for(let F=0;F<I.length;F++){const V=I[F];if(V===z)continue;z=V;const j=this.featureIndexArray.get(V);let K=null;if(this.is3DTile){const pe=this.bucketLayerIDs[0][0],de=s[pe];if(de.type!=="model")continue;const{queryFeature:me,intersectionZ:Ae}=de.queryIntersectsMatchingFeature(v,j.featureIndex,m,b);me&&this.appendToResult(M,pe,j.featureIndex,me,Ae)}else this.loadMatchingFeature(M,j,m,p.layers,p.availableImages,s,c,h,(pe,de,me,Ae=0)=>(K||(K=uc(pe,this.tileID.canonical,n.tileTransform)),de.queryIntersectsFeature(v,pe,me,K,this.z,n.transform,n.pixelPosMatrix,P,Ae)))}return M}loadMatchingFeature(n,s,c,h,p,m,v,b,E){const{featureIndex:I,bucketIndex:P,sourceLayerIndex:M,layoutVertexArrayOffset:z}=s,F=this.bucketLayerIDs[P];if(h&&!function(pe,de){for(let me=0;me<pe.length;me++)if(de.indexOf(pe[me])>=0)return!0;return!1}(h,F))return;const V=this.sourceLayerCoder.decode(M),j=this.vtLayers[V].feature(I);if(c.needGeometry){const pe=th(j,!0);if(!c.filter(new An(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!c.filter(new An(this.tileID.overscaledZ),j))return;const K=this.getId(j,V);for(let pe=0;pe<F.length;pe++){const de=F[pe];if(h&&h.indexOf(de)<0)continue;const me=m[de];if(!me)continue;let Ae={};K!==void 0&&b&&(Ae=b.getState(me.sourceLayer||"_geojsonTileLayer",K));const Ce=!E||E(j,me,Ae,z);if(!Ce)continue;const ze=new wz(j,this.z,this.x,this.y,K),$e=ws({},v[de]);$e.paint=Ez($e.paint,me.paint,j,Ae,p),$e.layout=Ez($e.layout,me.layout,j,Ae,p),ze.layer=$e,this.appendToResult(n,de,I,ze,Ce)}}appendToResult(n,s,c,h,p){let m=n[s];m===void 0&&(m=n[s]=[]),m.push({featureIndex:c,feature:h,intersectionZ:p})}lookupSymbolFeatures(n,s,c,h,p,m,v,b){const E={};this.loadVTLayers();const I=ac(p);for(const P of n)this.loadMatchingFeature(E,{bucketIndex:c,sourceLayerIndex:h,featureIndex:P,layoutVertexArrayOffset:0},I,m,v,b,s);return E}loadFeature(n){const{featureIndex:s,sourceLayerIndex:c}=n;this.loadVTLayers();const h=this.sourceLayerCoder.decode(c),p=this.vtFeatures[h];if(p[s])return p[s];const m=this.vtLayers[h].feature(s);return p[s]=m,m}hasLayer(n){for(const s of this.bucketLayerIDs)for(const c of s)if(n===c)return!0;return!1}getId(n,s){let c=n.id;if(this.promoteId){const h=typeof this.promoteId=="string"?this.promoteId:this.promoteId[s];h!=null&&(c=n.properties[h]),typeof c=="boolean"&&(c=Number(c))}return c}}function Ez(i,n,s,c,h){return Bc(i,(p,m)=>{const v=n instanceof Us?n.get(m):null;return v&&v.evaluate?v.evaluate(s,c,h):v})}function BZ(i,n){return n-i}je(Tz,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var to=24;const hc=128;function cC(i,n){const{expression:s}=n;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new An(i+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:h}=s;let p=0;for(;p<c.length&&c[p]<=i;)p++;p=Math.max(0,p-1);let m=p;for(;m<c.length&&c[m]<i+1;)m++;m=Math.min(c.length-1,m);const v=c[p],b=c[m];return s.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:b,minSize:s.evaluate(new An(v)),maxSize:s.evaluate(new An(b)),interpolationType:h}}}function Ob(i,{uSize:n,uSizeT:s},{lowerSize:c,upperSize:h}){return i.kind==="source"?c/hc:i.kind==="composite"?wn(c/hc,h/hc,s):n}function gg(i,n){let s=0,c=0;if(i.kind==="constant")c=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:h,minZoom:p,maxZoom:m}=i,v=h?Gn(aa.interpolationFactor(h,n,p,m),0,1):0;i.kind==="camera"?c=wn(i.minSize,i.maxSize,v):s=v}return{uSizeT:s,uSize:c}}var UZ=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:hc,evaluateSizeForFeature:Ob,evaluateSizeForZoom:gg,getSizeData:cC});function VZ(i,n,s){return i.sections.forEach(c=>{c.text=function(h,p,m){const v=p.layout.get("text-transform").evaluate(m,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),Jn.applyArabicShaping&&(h=Jn.applyArabicShaping(h)),h}(c.text,n,s)}),i}const m0={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function jZ(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}function $Z(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}const uC=3;function GZ(i,n,s){n.glyphs=[],i===1&&s.readMessage(qZ,n)}function qZ(i,n,s){if(i===3){const{id:c,bitmap:h,width:p,height:m,left:v,top:b,advance:E}=s.readMessage(WZ,{});n.glyphs.push({id:c,bitmap:new xd({width:p+2*uC,height:m+2*uC},h),metrics:{width:p,height:m,left:v,top:b,advance:E}})}else i===4?n.ascender=s.readSVarint():i===5&&(n.descender=s.readSVarint())}function WZ(i,n,s){i===1?n.id=s.readVarint():i===2?n.bitmap=s.readBytes():i===3?n.width=s.readVarint():i===4?n.height=s.readVarint():i===5?n.left=s.readSVarint():i===6?n.top=s.readSVarint():i===7&&(n.advance=s.readVarint())}const Sz=uC,Za={horizontal:1,vertical:2,horizontalOnly:3};class g0{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,s){const c=new g0;return c.scale=n||1,c.fontStack=s,c}static forImage(n){const s=new g0;return s.imageName=n,s}}class _g{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,s){const c=new _g;for(let h=0;h<n.sections.length;h++){const p=n.sections[h];p.image?c.addImageSection(p):c.addTextSection(p,s)}return c}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=function(s,c){let h="";for(let p=0;p<s.length;p++){const m=s.charCodeAt(p+1)||null,v=s.charCodeAt(p-1)||null;h+=!c&&(m&&tn(m)&&!m0[s[p+1]]||v&&tn(v)&&!m0[s[p-1]])||!m0[s[p]]?s[p]:m0[s[p]]}return h}(this.text,n)}trim(){let n=0;for(let c=0;c<this.text.length&&Lb[this.text.charCodeAt(c)];c++)n++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=n&&Lb[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(n,s),this.sectionIndex=this.sectionIndex.slice(n,s)}substring(n,s){const c=new _g;return c.text=this.text.substring(n,s),c.sectionIndex=this.sectionIndex.slice(n,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,s)=>Math.max(n,this.sections[s].scale),0)}addTextSection(n,s){this.text+=n.text,this.sections.push(g0.forText(n.scale,n.fontStack||s));const c=this.sections.length-1;for(let h=0;h<n.text.length;++h)this.sectionIndex.push(c)}addImageSection(n){const s=n.image?n.image.namePrimary:"";if(s.length===0)return void _i("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(g0.forImage(s)),this.sectionIndex.push(this.sections.length-1)):_i("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hC(i,n,s,c,h,p,m,v,b,E,I,P,M,z,F){const V=_g.fromFeature(i,h);P===Za.vertical&&V.verticalizePunctuation(M);let j=[];const K=function(Ce,ze,$e,Xe,tt,Ke){if(!Ce)return[];const lt=[],Tt=function(mt,Ot,ut,Ft,Dt,Et){let gn=0;for(let cn=0;cn<mt.length();cn++){const Ht=mt.getSection(cn);gn+=Iz(mt.getCodePoint(cn),Ht,Ft,Dt,Ot,Et)}return gn/Math.max(1,Math.ceil(gn/ut))}(Ce,ze,$e,Xe,tt,Ke),ct=Ce.text.indexOf("")>=0;let At=0;for(let mt=0;mt<Ce.length();mt++){const Ot=Ce.getSection(mt),ut=Ce.getCodePoint(mt);if(Lb[ut]||(At+=Iz(ut,Ot,Xe,tt,ze,Ke)),mt<Ce.length()-1){const Ft=!((ot=ut)<11904||!(Ue["Bopomofo Extended"](ot)||Ue.Bopomofo(ot)||Ue["CJK Compatibility Forms"](ot)||Ue["CJK Compatibility Ideographs"](ot)||Ue["CJK Compatibility"](ot)||Ue["CJK Radicals Supplement"](ot)||Ue["CJK Strokes"](ot)||Ue["CJK Symbols and Punctuation"](ot)||Ue["CJK Unified Ideographs Extension A"](ot)||Ue["CJK Unified Ideographs"](ot)||Ue["Enclosed CJK Letters and Months"](ot)||Ue["Halfwidth and Fullwidth Forms"](ot)||Ue.Hiragana(ot)||Ue["Ideographic Description Characters"](ot)||Ue["Kangxi Radicals"](ot)||Ue["Katakana Phonetic Extensions"](ot)||Ue.Katakana(ot)||Ue["Vertical Forms"](ot)||Ue["Yi Radicals"](ot)||Ue["Yi Syllables"](ot)));(HZ[ut]||Ft||Ot.imageName)&&lt.push(Cz(mt+1,At,Tt,lt,ZZ(ut,Ce.getCodePoint(mt+1),Ft&&ct),!1))}}var ot;return Pz(Cz(Ce.length(),At,Tt,lt,0,!0))}(V,E,p,n,c,z),{processBidirectionalText:pe,processStyledBidirectionalText:de}=Jn;if(pe&&V.sections.length===1){const Ce=pe(V.toString(),K);for(const ze of Ce){const $e=new _g;$e.text=ze,$e.sections=V.sections;for(let Xe=0;Xe<ze.length;Xe++)$e.sectionIndex.push(0);j.push($e)}}else if(de){const Ce=de(V.text,V.sectionIndex,K);for(const ze of Ce){const $e=new _g;$e.text=ze[0],$e.sectionIndex=ze[1],$e.sections=V.sections,j.push($e)}}else j=function(Ce,ze){const $e=[],Xe=Ce.text;let tt=0;for(const Ke of ze)$e.push(Ce.substring(tt,Ke)),tt=Ke;return tt<Xe.length&&$e.push(Ce.substring(tt,Xe.length)),$e}(V,K);const me=[],Ae={positionedLines:me,text:V.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ce,ze,$e,Xe,tt,Ke,lt,Tt,ct,At,ot,mt){let Ot=0,ut=0,Ft=0;const Dt=Tt==="right"?1:Tt==="left"?0:.5;let Et=!1;for(const dn of tt){const nn=dn.getSections();for(const On of nn){if(On.imageName)continue;const zn=ze[On.fontStack];if(zn&&(Et=zn.ascender!==void 0&&zn.descender!==void 0,!Et))break}if(!Et)break}let gn=0;for(const dn of tt){dn.trim();const nn=dn.getMaxScale(),On=(nn-1)*to,zn={positionedGlyphs:[],lineOffset:0};Ce.positionedLines[gn]=zn;const Ln=zn.positionedGlyphs;let $n=0;if(!dn.length()){ut+=Ke,++gn;continue}let ur=0,tr=0;for(let $r=0;$r<dn.length();$r++){const Nn=dn.getSection($r),Rr=dn.getSectionIndex($r),Dr=dn.getCodePoint($r);let Qr=Nn.scale,Pi=null,Gi=null,Ri=null,yi=to,Ds=0;const ns=!(ct===Za.horizontal||!ot&&!$t(Dr)||ot&&(Lb[Dr]||(cn=Dr,Ue.Arabic(cn)||Ue["Arabic Supplement"](cn)||Ue["Arabic Extended-A"](cn)||Ue["Arabic Presentation Forms-A"](cn)||Ue["Arabic Presentation Forms-B"](cn))));if(Nn.imageName){const no=Xe[Nn.imageName];if(!no)continue;Ri=Nn.imageName,Ce.iconsInText=Ce.iconsInText||!0,Gi=no.paddedRect;const Xr=no.displaySize;Qr=Qr*to/mt,Pi={width:Xr[0],height:Xr[1],left:0,top:-Sz,advance:ns?Xr[1]:Xr[0],localGlyph:!1},Ds=Et?-Pi.height*Qr:nn*to-17-Xr[1]*Qr,yi=Pi.advance;const ua=(ns?Xr[0]:Xr[1])*Qr-to*nn;ua>0&&ua>$n&&($n=ua)}else{const no=$e[Nn.fontStack];if(!no)continue;no[Dr]&&(Gi=no[Dr]);const Xr=ze[Nn.fontStack];if(!Xr)continue;const ua=Xr.glyphs[Dr];if(!ua)continue;if(Pi=ua.metrics,yi=Dr!==8203?to:0,Et){const _c=Xr.ascender!==void 0?Math.abs(Xr.ascender):0,Sl=Xr.descender!==void 0?Math.abs(Xr.descender):0,Il=(_c+Sl)*Qr;ur<Il&&(ur=Il,tr=(_c-Sl)/2*Qr),Ds=-_c*Qr}else Ds=(nn-Qr)*to-17}ns?(Ce.verticalizable=!0,Ln.push({glyph:Dr,imageName:Ri,x:Ot,y:ut+Ds,vertical:ns,scale:Qr,localGlyph:Pi.localGlyph,fontStack:Nn.fontStack,sectionIndex:Rr,metrics:Pi,rect:Gi}),Ot+=yi*Qr+At):(Ln.push({glyph:Dr,imageName:Ri,x:Ot,y:ut+Ds,vertical:ns,scale:Qr,localGlyph:Pi.localGlyph,fontStack:Nn.fontStack,sectionIndex:Rr,metrics:Pi,rect:Gi}),Ot+=Pi.advance*Qr+At)}Ln.length!==0&&(Ft=Math.max(Ot-At,Ft),Et?Rz(Ln,Dt,$n,tr,Ke*nn/2):Rz(Ln,Dt,$n,0,Ke/2)),Ot=0;const Br=Ke*nn+$n;zn.lineOffset=Math.max($n,On),ut+=Br,++gn}var cn;const Ht=ut,{horizontalAlign:zt,verticalAlign:In}=dC(lt);(function(dn,nn,On,zn,Ln,$n){const ur=(nn-On)*Ln,tr=-$n*zn;for(const Br of dn)for(const $r of Br.positionedGlyphs)$r.x+=ur,$r.y+=tr})(Ce.positionedLines,Dt,zt,In,Ft,Ht),Ce.top+=-In*Ht,Ce.bottom=Ce.top+Ht,Ce.left+=-zt*Ft,Ce.right=Ce.left+Ft,Ce.hasBaseline=Et}(Ae,n,s,c,j,m,v,b,P,E,M,F),!function(Ce){for(const ze of Ce)if(ze.positionedGlyphs.length!==0)return!1;return!0}(me)&&Ae}const Lb={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},HZ={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Iz(i,n,s,c,h,p){if(n.imageName){const m=c[n.imageName];return m?m.displaySize[0]*n.scale*to/p+h:0}{const m=s[n.fontStack],v=m&&m.glyphs[i];return v?v.metrics.advance*n.scale+h:0}}function Az(i,n,s,c){const h=Math.pow(i-n,2);return c?i<n?h/2:2*h:h+Math.abs(s)*s}function ZZ(i,n,s){let c=0;return i===10&&(c-=1e4),s&&(c+=150),i!==40&&i!==65288||(c+=50),n!==41&&n!==65289||(c+=50),c}function Cz(i,n,s,c,h,p){let m=null,v=Az(n,s,h,p);for(const b of c){const E=Az(n-b.x,s,h,p)+b.badness;E<=v&&(m=b,v=E)}return{index:i,x:n,priorBreak:m,badness:v}}function Pz(i){return i?Pz(i.priorBreak).concat(i.index):[]}function dC(i){let n=.5,s=.5;switch(i){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:n,verticalAlign:s}}function Rz(i,n,s,c,h){if(!(n||s||c||h))return;const p=i.length-1,m=i[p],v=(m.x+m.metrics.advance*m.scale)*n;for(let b=0;b<=p;b++)i[b].x-=v,i[b].y+=s+c+h}function XZ(i,n,s,c){const{horizontalAlign:h,verticalAlign:p}=dC(c),m=s[0]-i.displaySize[0]*h,v=s[1]-i.displaySize[1]*p;return{imagePrimary:i,imageSecondary:n,top:v,bottom:v+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function Mz(i,n,s,c,h,p){const m=i.imagePrimary;let v;if(m.content){const j=m.content,K=m.pixelRatio||1;v=[j[0]/K,j[1]/K,m.displaySize[0]-j[2]/K,m.displaySize[1]-j[3]/K]}const b=n.left*p,E=n.right*p;let I,P,M,z;s==="width"||s==="both"?(z=h[0]+b-c[3],P=h[0]+E+c[1]):(z=h[0]+(b+E-m.displaySize[0])/2,P=z+m.displaySize[0]);const F=n.top*p,V=n.bottom*p;return s==="height"||s==="both"?(I=h[1]+F-c[0],M=h[1]+V+c[2]):(I=h[1]+(F+V-m.displaySize[1])/2,M=I+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:I,right:P,bottom:M,left:z,collisionPadding:v}}class sh extends Nt{constructor(n,s,c,h,p){super(n,s),this.angle=h,this.z=c,p!==void 0&&(this.segment=p)}clone(){return new sh(this.x,this.y,this.z,this.angle,this.segment)}}function kz(i,n,s,c,h){if(n.segment===void 0)return!0;let p=n,m=n.segment+1,v=0;for(;v>-s/2;){if(m--,m<0)return!1;v-=i[m].dist(p),p=i[m]}v+=i[m].dist(i[m+1]),m++;const b=[];let E=0;for(;v<s/2;){const I=i[m],P=i[m+1];if(!P)return!1;let M=i[m-1].angleTo(I)-I.angleTo(P);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:M}),E+=M;v-b[0].distance>c;)E-=b.shift().angleDelta;if(E>h)return!1;m++,v+=I.dist(P)}return!0}function Dz(i){let n=0;for(let s=0;s<i.length-1;s++)n+=i[s].dist(i[s+1]);return n}function Oz(i,n,s){return i?.6*n*s:0}function Lz(i,n){return Math.max(i?i.right-i.left:0,n?n.right-n.left:0)}function KZ(i,n,s,c,h,p){const m=Oz(s,h,p),v=Lz(s,c)*p;let b=0;const E=Dz(i)/2;for(let I=0;I<i.length-1;I++){const P=i[I],M=i[I+1],z=P.dist(M);if(b+z>E){const F=(E-b)/z,V=wn(P.x,M.x,F),j=wn(P.y,M.y,F),K=new sh(V,j,0,M.angleTo(P),I);return!m||kz(i,K,v,m,n)?K:void 0}b+=z}}function YZ(i,n,s,c,h,p,m,v,b){const E=Oz(c,p,m),I=Lz(c,h),P=I*m,M=i[0].x===0||i[0].x===b||i[0].y===0||i[0].y===b;return n-P<n/4&&(n=P+n/4),zz(i,M?n/2*v%n:(I/2+2*p)*m*v%n,n,E,s,P,M,!1,b)}function zz(i,n,s,c,h,p,m,v,b){const E=p/2,I=Dz(i);let P=0,M=n-s,z=[];for(let F=0;F<i.length-1;F++){const V=i[F],j=i[F+1],K=V.dist(j),pe=j.angleTo(V);for(;M+s<P+K;){M+=s;const de=(M-P)/K,me=wn(V.x,j.x,de),Ae=wn(V.y,j.y,de);if(me>=0&&me<b&&Ae>=0&&Ae<b&&M-E>=0&&M+E<=I){const Ce=new sh(me,Ae,0,pe,F);c&&!kz(i,Ce,p,c,h)||z.push(Ce)}}P+=K}return v||z.length||m||(z=zz(i,P/2,s,c,h,p,m,!0,b)),z}function Nz(i,n,s,c,h){const p=[];for(let m=0;m<i.length;m++){const v=i[m];let b;for(let E=0;E<v.length-1;E++){let I=v[E],P=v[E+1];I.x<n&&P.x<n||(I.x<n?I=new Nt(n,I.y+(n-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x<n&&(P=new Nt(n,I.y+(n-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y<s&&P.y<s||(I.y<s?I=new Nt(I.x+(s-I.y)/(P.y-I.y)*(P.x-I.x),s)._round():P.y<s&&(P=new Nt(I.x+(s-I.y)/(P.y-I.y)*(P.x-I.x),s)._round()),I.x>=c&&P.x>=c||(I.x>=c?I=new Nt(c,I.y+(c-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x>=c&&(P=new Nt(c,I.y+(c-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y>=h&&P.y>=h||(I.y>=h?I=new Nt(I.x+(h-I.y)/(P.y-I.y)*(P.x-I.x),h)._round():P.y>=h&&(P=new Nt(I.x+(h-I.y)/(P.y-I.y)*(P.x-I.x),h)._round()),b&&I.equals(b[b.length-1])||(b=[I],p.push(b)),b.push(P)))))}}return p}function Fz(i){let n=0,s=0;for(const m of i)n+=m.w*m.h,s=Math.max(s,m.w);i.sort((m,v)=>v.h-m.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),s),h:1/0}];let h=0,p=0;for(const m of i)for(let v=c.length-1;v>=0;v--){const b=c[v];if(!(m.w>b.w||m.h>b.h)){if(m.x=b.x,m.y=b.y,p=Math.max(p,m.y+m.h),h=Math.max(h,m.x+m.w),m.w===b.w&&m.h===b.h){const E=c.pop();v<c.length&&(c[v]=E)}else m.h===b.h?(b.x+=m.w,b.w-=m.w):m.w===b.w?(b.y+=m.h,b.h-=m.h):(c.push({x:b.x+m.w,y:b.y,w:b.w-m.w,h:m.h}),b.y+=m.h,b.h-=m.h);break}}return{w:h,h:p,fill:n/(h*p)||0}}je(sh,"Anchor");const Ta=1;class fC{constructor(n,{pixelRatio:s,version:c,stretchX:h,stretchY:p,content:m}){this.paddedRect=n,this.pixelRatio=s,this.stretchX=h,this.stretchY=p,this.content=m,this.version=c}get tl(){return[this.paddedRect.x+Ta,this.paddedRect.y+Ta]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ta,this.paddedRect.y+this.paddedRect.h-Ta]}get displaySize(){return[(this.paddedRect.w-2*Ta)/this.pixelRatio,(this.paddedRect.h-2*Ta)/this.pixelRatio]}}class Bz{constructor(n,s,c){const h={},p={};this.haveRenderCallbacks=[];const m=[];this.addImages(n,h,m),this.addImages(s,p,m);const{w:v,h:b}=Fz(m),E=new Ha({width:v||1,height:b||1});for(const I in n){const P=n[I],M=h[I].paddedRect;Ha.copy(P.data,E,{x:0,y:0},{x:M.x+Ta,y:M.y+Ta},P.data,c,P.sdf)}for(const I in s){const P=s[I],M=p[I].paddedRect,z=M.x+Ta,F=M.y+Ta,V=P.data.width,j=P.data.height;Ha.copy(P.data,E,{x:0,y:0},{x:z,y:F},P.data,c),Ha.copy(P.data,E,{x:0,y:j-1},{x:z,y:F-1},{width:V,height:1},c),Ha.copy(P.data,E,{x:0,y:0},{x:z,y:F+j},{width:V,height:1},c),Ha.copy(P.data,E,{x:V-1,y:0},{x:z-1,y:F},{width:1,height:j},c),Ha.copy(P.data,E,{x:0,y:0},{x:z+V,y:F},{width:1,height:j},c)}this.image=E,this.iconPositions=h,this.patternPositions=p}addImages(n,s,c){for(const h in n){const p=n[h],m={x:0,y:0,w:p.data.width+2*Ta,h:p.data.height+2*Ta};c.push(m),s[h]=new fC(m,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(n,s,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>n.hasImage(h,c)),n.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const h in n.getUpdatedImages(c))this.patchUpdatedImage(this.iconPositions[h],n.getImage(h,c),s),this.patchUpdatedImage(this.patternPositions[h],n.getImage(h,c),s)}patchUpdatedImage(n,s,c){if(!n||!s||n.version===s.version)return;n.version=s.version;const[h,p]=n.tl,m=!!Object.keys(this.patternPositions).length;c.update(s.data,{useMipmap:m},{x:h,y:p})}}je(fC,"ImagePosition"),je(Bz,"ImageAtlas");const _0=1e20;function Uz(i,n,s,c,h,p,m,v,b){for(let E=n;E<n+c;E++)Vz(i,s*p+E,p,h,m,v,b);for(let E=s;E<s+h;E++)Vz(i,E*p+n,1,c,m,v,b)}function Vz(i,n,s,c,h,p,m){p[0]=0,m[0]=-_0,m[1]=_0,h[0]=i[n];for(let v=1,b=0,E=0;v<c;v++){h[v]=i[n+v*s];const I=v*v;do{const P=p[b];E=(h[v]-h[P]+I-P*P)/(v-P)/2}while(E<=m[b]&&--b>-1);b++,p[b]=v,m[b]=E,m[b+1]=_0}for(let v=0,b=0;v<c;v++){for(;m[b+1]<v;)b++;const E=p[b],I=v-E;i[n+v*s]=h[E]+I*I}}const dc=2,pC={none:0,ideographs:1,all:2};class yg{constructor(n,s,c){this.requestManager=n,this.localGlyphMode=s,this.localFontFamily=c,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n,s){this.urls[s]=n}getGlyphs(n,s,c){const h=[],p=this.urls[s]||O.GLYPHS_URL;for(const m in n)for(const v of n[m])h.push({stack:m,id:v});Nu(h,({stack:m,id:v},b)=>{let E=this.entries[m];E||(E=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let I=E.glyphs[v];if(I!==void 0)return void b(null,{stack:m,id:v,glyph:I});if(I=this._tinySDF(E,m,v),I)return E.glyphs[v]=I,void b(null,{stack:m,id:v,glyph:I});const P=Math.floor(v/256);if(256*P>65535)return void b(new Error("glyphs > 65535 not supported"));if(E.ranges[P])return void b(null,{stack:m,id:v,glyph:I});let M=E.requests[P];M||(M=E.requests[P]=[],yg.loadGlyphRange(m,P,p,this.requestManager,(z,F)=>{if(F){E.ascender=F.ascender,E.descender=F.descender;for(const V in F.glyphs)this._doesCharSupportLocalGlyph(+V)||(E.glyphs[+V]=F.glyphs[+V]);E.ranges[P]=!0}for(const V of M)V(z,F);delete E.requests[P]})),M.push((z,F)=>{z?b(z):F&&b(null,{stack:m,id:v,glyph:F.glyphs[v]||null})})},(m,v)=>{if(m)c(m);else if(v){const b={};for(const{stack:E,id:I,glyph:P}of v)b[E]===void 0&&(b[E]={}),b[E].glyphs===void 0&&(b[E].glyphs={}),b[E].glyphs[I]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},b[E].ascender=this.entries[E].ascender,b[E].descender=this.entries[E].descender;c(null,b)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==pC.none&&(this.localGlyphMode===pC.all?!!this.localFontFamily:!!this.localFontFamily&&(Ue["CJK Unified Ideographs"](n)||Ue["Hangul Syllables"](n)||Ue.Hiragana(n)||Ue.Katakana(n)||Ue["CJK Symbols and Punctuation"](n)||Ue["CJK Unified Ideographs Extension A"](n)||Ue["CJK Unified Ideographs Extension B"](n)))}_tinySDF(n,s,c){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(c))return;let p=n.tinySDF;if(!p){let V="400";/bold/i.test(s)?V="900":/medium/i.test(s)?V="500":/light/i.test(s)&&(V="200"),p=n.tinySDF=new yg.TinySDF({fontFamily:h,fontWeight:V,fontSize:24*dc,buffer:3*dc,radius:8*dc}),p.fontWeight=V}if(this.localGlyphs[p.fontWeight][c])return this.localGlyphs[p.fontWeight][c];const m=String.fromCodePoint(c),{data:v,width:b,height:E,glyphWidth:I,glyphHeight:P,glyphLeft:M,glyphTop:z,glyphAdvance:F}=p.draw(m);return this.localGlyphs[p.fontWeight][c]={id:c,bitmap:new xd({width:b,height:E},v),metrics:{width:I/dc,height:P/dc,left:M/dc,top:z/dc-27,advance:F/dc,localGlyph:!0}}}}yg.loadGlyphRange=function(i,n,s,c,h){const p=256*n,m=p+255,v=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",i).replace("{range}",`${p}-${m}`),Df.Glyphs);Bu(v,(b,E)=>{if(b)h(b);else if(E){const I={},P=function(M){return new p0(M).readFields(GZ,{})}(E);for(const M of P.glyphs)I[M.id]=M;h(null,{glyphs:I,ascender:P.ascender,descender:P.descender})}})},yg.TinySDF=class{constructor({fontSize:i=24,buffer:n=3,radius:s=8,cutoff:c=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:m="normal"}={}){this.buffer=n,this.cutoff=c,this.radius=s;const v=this.size=i+4*n,b=this._createCanvas(v),E=this.ctx=b.getContext("2d",{willReadFrequently:!0});E.font=`${m} ${p} ${i}px ${h}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(i){const n=document.createElement("canvas");return n.width=n.height=i,n}draw(i){const{width:n,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(i),m=Math.ceil(s),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),b=Math.min(this.size-this.buffer,m+Math.ceil(c)),E=v+2*this.buffer,I=b+2*this.buffer,P=Math.max(E*I,0),M=new Uint8ClampedArray(P),z={data:M,width:E,height:I,glyphWidth:v,glyphHeight:b,glyphTop:m,glyphLeft:0,glyphAdvance:n};if(v===0||b===0)return z;const{ctx:F,buffer:V,gridInner:j,gridOuter:K}=this;F.clearRect(V,V,v,b),F.fillText(i,V,V+m);const pe=F.getImageData(V,V,v,b);K.fill(_0,0,P),j.fill(0,0,P);for(let de=0;de<b;de++)for(let me=0;me<v;me++){const Ae=pe.data[4*(de*v+me)+3]/255;if(Ae===0)continue;const Ce=(de+V)*E+me+V;if(Ae===1)K[Ce]=0,j[Ce]=_0;else{const ze=.5-Ae;K[Ce]=ze>0?ze*ze:0,j[Ce]=ze<0?ze*ze:0}}Uz(K,0,0,E,I,E,this.f,this.v,this.z),Uz(j,V,V,v,b,E,this.f,this.v,this.z);for(let de=0;de<P;de++){const me=Math.sqrt(K[de])-Math.sqrt(j[de]);M[de]=Math.round(255-255*(me/this.radius+this.cutoff))}return z}};const Td=Ta;function jz(i,n,s,c){const h=[],p=i.imagePrimary,m=p.pixelRatio,v=p.paddedRect.w-2*Td,b=p.paddedRect.h-2*Td,E=i.right-i.left,I=i.bottom-i.top,P=p.stretchX||[[0,v]],M=p.stretchY||[[0,b]],z=(Ke,lt)=>Ke+lt[1]-lt[0],F=P.reduce(z,0),V=M.reduce(z,0),j=v-F,K=b-V;let pe=0,de=F,me=0,Ae=V,Ce=0,ze=j,$e=0,Xe=K;if(p.content&&c){const Ke=p.content;pe=zb(P,0,Ke[0]),me=zb(M,0,Ke[1]),de=zb(P,Ke[0],Ke[2]),Ae=zb(M,Ke[1],Ke[3]),Ce=Ke[0]-pe,$e=Ke[1]-me,ze=Ke[2]-Ke[0]-de,Xe=Ke[3]-Ke[1]-Ae}const tt=(Ke,lt,Tt,ct)=>{const At=Nb(Ke.stretch-pe,de,E,i.left),ot=Fb(Ke.fixed-Ce,ze,Ke.stretch,F),mt=Nb(lt.stretch-me,Ae,I,i.top),Ot=Fb(lt.fixed-$e,Xe,lt.stretch,V),ut=Nb(Tt.stretch-pe,de,E,i.left),Ft=Fb(Tt.fixed-Ce,ze,Tt.stretch,F),Dt=Nb(ct.stretch-me,Ae,I,i.top),Et=Fb(ct.fixed-$e,Xe,ct.stretch,V),gn=new Nt(At,mt),cn=new Nt(ut,mt),Ht=new Nt(ut,Dt),zt=new Nt(At,Dt),In=new Nt(ot/m,Ot/m),dn=new Nt(Ft/m,Et/m),nn=n*Math.PI/180;if(nn){const tr=Math.sin(nn),Br=Math.cos(nn),$r=[Br,-tr,tr,Br];gn._matMult($r),cn._matMult($r),zt._matMult($r),Ht._matMult($r)}const On=Ke.stretch+Ke.fixed,zn=Tt.stretch+Tt.fixed,Ln=lt.stretch+lt.fixed,$n=ct.stretch+ct.fixed,ur=i.imageSecondary;return{tl:gn,tr:cn,bl:zt,br:Ht,texPrimary:{x:p.paddedRect.x+Td+On,y:p.paddedRect.y+Td+Ln,w:zn-On,h:$n-Ln},texSecondary:ur?{x:ur.paddedRect.x+Td+On,y:ur.paddedRect.y+Td+Ln,w:zn-On,h:$n-Ln}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:In,pixelOffsetBR:dn,minFontScaleX:ze/m/E,minFontScaleY:Xe/m/I,isSDF:s}};if(c&&(p.stretchX||p.stretchY)){const Ke=$z(P,j,F),lt=$z(M,K,V);for(let Tt=0;Tt<Ke.length-1;Tt++){const ct=Ke[Tt],At=Ke[Tt+1];for(let ot=0;ot<lt.length-1;ot++)h.push(tt(ct,lt[ot],At,lt[ot+1]))}}else h.push(tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:b+1}));return h}function zb(i,n,s){let c=0;for(const h of i)c+=Math.max(n,Math.min(s,h[1]))-Math.max(n,Math.min(s,h[0]));return c}function $z(i,n,s){const c=[{fixed:-Td,stretch:0}];for(const[h,p]of i){const m=c[c.length-1];c.push({fixed:h-m.stretch,stretch:m.stretch}),c.push({fixed:h-m.stretch,stretch:m.stretch+(p-h)})}return c.push({fixed:n+Td,stretch:s}),c}function Nb(i,n,s,c){return i/n*s+c}function Fb(i,n,s,c){return i-n*s/c}function QZ(i,n,s,c){const h=n+i.positionedLines[c].lineOffset;return c===0?s+h/2:s+(h+(n+i.positionedLines[c-1].lineOffset))/2}function JZ(i,n=1,s=!1){let c=1/0,h=1/0,p=-1/0,m=-1/0;const v=i[0];for(let z=0;z<v.length;z++){const F=v[z];(!z||F.x<c)&&(c=F.x),(!z||F.y<h)&&(h=F.y),(!z||F.x>p)&&(p=F.x),(!z||F.y>m)&&(m=F.y)}const b=Math.min(p-c,m-h);let E=b/2;const I=new Wc([],eX);if(b===0)return new Nt(c,h);for(let z=c;z<p;z+=b)for(let F=h;F<m;F+=b)I.push(new vg(z+E,F+E,E,i));let P=function(z){let F=0,V=0,j=0;const K=z[0];for(let pe=0,de=K.length,me=de-1;pe<de;me=pe++){const Ae=K[pe],Ce=K[me],ze=Ae.x*Ce.y-Ce.x*Ae.y;V+=(Ae.x+Ce.x)*ze,j+=(Ae.y+Ce.y)*ze,F+=3*ze}return new vg(V/F,j/F,0,z)}(i),M=I.length;for(;I.length;){const z=I.pop();(z.d>P.d||!P.d)&&(P=z,s&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,M)),z.max-P.d<=n||(E=z.h/2,I.push(new vg(z.p.x-E,z.p.y-E,E,i)),I.push(new vg(z.p.x+E,z.p.y-E,E,i)),I.push(new vg(z.p.x-E,z.p.y+E,E,i)),I.push(new vg(z.p.x+E,z.p.y+E,E,i)),M+=4)}return s&&(console.log(`num probes: ${M}`),console.log(`best distance: ${P.d}`)),P.p}function eX(i,n){return n.max-i.max}class vg{constructor(n,s,c,h){this.p=new Nt(n,s),this.h=c,this.d=function(p,m){let v=!1,b=1/0;for(let E=0;E<m.length;E++){const I=m[E];for(let P=0,M=I.length,z=M-1;P<M;z=P++){const F=I[P],V=I[z];F.y>p.y!=V.y>p.y&&p.x<(V.x-F.x)*(p.y-F.y)/(V.y-F.y)+F.x&&(v=!v),b=Math.min(b,LL(p,F,V))}}return(v?1:-1)*Math.sqrt(b)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const mC=Number.POSITIVE_INFINITY,tX=Math.sqrt(2);function Gz(i,[n,s]){let c=0,h=0;if(s===mC){n<0&&(n=0);const p=n/tX;switch(i){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-n;break;case"top":h=n-7}switch(i){case"top-right":case"bottom-right":c=-p;break;case"top-left":case"bottom-left":c=p;break;case"left":c=n;break;case"right":c=-n}}else{switch(n=Math.abs(n),s=Math.abs(s),i){case"top-right":case"top-left":case"top":h=s-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-s}switch(i){case"top-right":case"bottom-right":case"right":c=-n;break;case"top-left":case"bottom-left":case"left":c=n}}return[c,h]}function gC(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function nX(i,n,s,c,h,p,m,v,b,E,I,P,M,z,F){let V=p.textMaxSize.evaluate(n,{},P);V===void 0&&(V=m);const j=i.layers[0].layout,K=j.get("icon-offset").evaluate(n,{},P),pe=Wz(s.horizontal)||s.vertical,de=M.name==="globe",me=to,Ae=m/me,Ce=i.tilePixelRatio*V/me,ze=(At=i.overscaling,i.zoom>18&&At>2&&(At>>=1),Math.max(Lt/(512*At),1)*j.get("symbol-spacing")),$e=j.get("text-padding")*i.tilePixelRatio,Xe=j.get("icon-padding")*i.tilePixelRatio,tt=Qn(j.get("text-max-angle")),Ke=j.get("text-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",lt=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",Tt=j.get("symbol-placement"),ct=ze/2;var At;const ot=j.get("icon-text-fit").evaluate(n,{},P),mt=j.get("icon-text-fit-padding").evaluate(n,{},P),Ot=ot!=="none";let ut;i.hasAnyIconTextFit===!1&&Ot&&(i.hasAnyIconTextFit=!0),c&&Ot&&(i.allowVerticalPlacement&&s.vertical&&(ut=Mz(c,s.vertical,ot,mt,K,Ae)),pe&&(c=Mz(c,pe,ot,mt,K,Ae)));const Ft=(Dt,Et,gn)=>{if(Et.x<0||Et.x>=Lt||Et.y<0||Et.y>=Lt)return;let cn=null;if(de){const{x:Ht,y:zt,z:In}=M.projectTilePoint(Et.x,Et.y,gn);cn={anchor:new sh(Ht,zt,In,0,void 0),up:M.upVector(gn,Et.x,Et.y)}}(function(Ht,zt,In,dn,nn,On,zn,Ln,$n,ur,tr,Br,$r,Nn,Rr,Dr,Qr,Pi,Gi,Ri,yi,Ds,ns,no,Xr,ua,_c){const Sl=Ht.addToLineVertexArray(zt,dn);let Il,bp,Pd,wp,N0,lN,cN,uN=0,hN=0,dN=0,fN=0,qC=-1,WC=-1;const nu={};let pN=Rm("");const Tp=In?In.anchor:zt,HC=$n.layout.get("icon-text-fit").evaluate(yi,{},Xr)!=="none";let ZC=0,XC=0;if($n._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ZC,XC]=$n.layout.get("text-offset").evaluate(yi,{},Xr).map(Sa=>Sa*to):(ZC=$n.layout.get("text-radial-offset").evaluate(yi,{},Xr)*to,XC=mC),Ht.allowVerticalPlacement&&nn.vertical){const Sa=nn.vertical;if(Rr)lN=_C(Sa),Ln&&(cN=_C(Ln));else{const Ia=$n.layout.get("text-rotate").evaluate(yi,{},Xr)+90;Pd=Bb(ur,Tp,zt,tr,Br,$r,Sa,Nn,Ia,Dr),Ln&&(wp=Bb(ur,Tp,zt,tr,Br,$r,Ln,Pi,Ia))}}if(On){const Sa=$n.layout.get("icon-rotate").evaluate(yi,{},Xr),Ia=jz(On,Sa,ns,HC),Cg=Ln?jz(Ln,Sa,ns,HC):void 0;bp=Bb(ur,Tp,zt,tr,Br,$r,On,Pi,Sa),uN=4*Ia.length;const mN=Ht.iconSizeData;let Ep=null;mN.kind==="source"?(Ep=[hc*$n.layout.get("icon-size").evaluate(yi,{},Xr)],Ep[0]>Ed&&_i(`${Ht.layerIds[0]}: Value for "icon-size" is >= ${y0}. Reduce your "icon-size".`)):mN.kind==="composite"&&(Ep=[hc*Ds.compositeIconSizes[0].evaluate(yi,{},Xr),hc*Ds.compositeIconSizes[1].evaluate(yi,{},Xr)],(Ep[0]>Ed||Ep[1]>Ed)&&_i(`${Ht.layerIds[0]}: Value for "icon-size" is >= ${y0}. Reduce your "icon-size".`)),Ht.addSymbols(Ht.icon,Ia,Ep,Ri,Gi,yi,!1,In,zt,Sl.lineStartIndex,Sl.lineLength,-1,no,Xr,ua,_c),qC=Ht.icon.placedSymbolArray.length-1,Cg&&(hN=4*Cg.length,Ht.addSymbols(Ht.icon,Cg,Ep,Ri,Gi,yi,Za.vertical,In,zt,Sl.lineStartIndex,Sl.lineLength,-1,no,Xr,ua,_c),WC=Ht.icon.placedSymbolArray.length-1)}for(const Sa in nn.horizontal){const Ia=nn.horizontal[Sa];Il||(pN=Rm(Ia.text),Rr?N0=_C(Ia):Il=Bb(ur,Tp,zt,tr,Br,$r,Ia,Nn,$n.layout.get("text-rotate").evaluate(yi,{},Xr),Dr));const Cg=Ia.positionedLines.length===1;if(dN+=qz(Ht,In,zt,Ia,zn,$n,Rr,yi,Dr,Sl,nn.vertical?Za.horizontal:Za.horizontalOnly,Cg?Object.keys(nn.horizontal):[Sa],nu,qC,Ds,no,Xr,ua),Cg)break}nn.vertical&&(fN+=qz(Ht,In,zt,nn.vertical,zn,$n,Rr,yi,Dr,Sl,Za.vertical,["vertical"],nu,WC,Ds,no,Xr,ua));let Rd=-1;const KC=(Sa,Ia)=>Sa?Math.max(Sa,Ia):Ia;Rd=KC(N0,Rd),Rd=KC(lN,Rd),Rd=KC(cN,Rd);const gK=Rd>-1?1:0;Ht.glyphOffsetArray.length>=65535&&_i("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),yi.sortKey!==void 0&&Ht.addToSortKeyRanges(Ht.symbolInstances.length,yi.sortKey),Ht.symbolInstances.emplaceBack(zt.x,zt.y,Tp.x,Tp.y,Tp.z,nu.right>=0?nu.right:-1,nu.center>=0?nu.center:-1,nu.left>=0?nu.left:-1,nu.vertical>=0?nu.vertical:-1,qC,WC,pN,Il!==void 0?Il:Ht.collisionBoxArray.length,Il!==void 0?Il+1:Ht.collisionBoxArray.length,Pd!==void 0?Pd:Ht.collisionBoxArray.length,Pd!==void 0?Pd+1:Ht.collisionBoxArray.length,bp!==void 0?bp:Ht.collisionBoxArray.length,bp!==void 0?bp+1:Ht.collisionBoxArray.length,wp||Ht.collisionBoxArray.length,wp?wp+1:Ht.collisionBoxArray.length,tr,dN,fN,uN,hN,gK,0,ZC,XC,Rd,0,HC?1:0)})(i,Et,cn,Dt,s,c,h,ut,i.layers[0],i.collisionBoxArray,n.index,n.sourceLayerIndex,i.index,$e,Ke,b,0,Xe,lt,K,n,p,E,I,P,z,F)};if(Tt==="line")for(const Dt of Nz(n.geometry,0,0,Lt,Lt)){const Et=YZ(Dt,ze,tt,s.vertical||pe,c,me,Ce,i.overscaling,Lt);for(const gn of Et)pe&&rX(i,pe.text,ct,gn)||Ft(Dt,gn,P)}else if(Tt==="line-center"){for(const Dt of n.geometry)if(Dt.length>1){const Et=KZ(Dt,tt,s.vertical||pe,c,me,Ce);Et&&Ft(Dt,Et,P)}}else if(n.type==="Polygon")for(const Dt of bb(n.geometry,0)){const Et=JZ(Dt,16);Ft(Dt[0],new sh(Et.x,Et.y,0,0,void 0),P)}else if(n.type==="LineString")for(const Dt of n.geometry)Ft(Dt,new sh(Dt[0].x,Dt[0].y,0,0,void 0),P);else if(n.type==="Point")for(const Dt of n.geometry)for(const Et of Dt)Ft([Et],new sh(Et.x,Et.y,0,0,void 0),P)}const y0=255,Ed=y0*hc;function qz(i,n,s,c,h,p,m,v,b,E,I,P,M,z,F,V,j,K){const pe=function(Ae,Ce,ze,$e,Xe,tt,Ke,lt){const Tt=[];if(Ce.positionedLines.length===0)return Tt;const ct=$e.layout.get("text-rotate").evaluate(tt,{})*Math.PI/180,At=function(Ft){const Dt=Ft[0],Et=Ft[1],gn=Dt*Et;return gn>0?[Dt,-Et]:gn<0?[-Dt,Et]:Dt===0?[Et,Dt]:[Et,-Dt]}(ze);let ot=Math.abs(Ce.top-Ce.bottom);for(const Ft of Ce.positionedLines)ot-=Ft.lineOffset;const mt=Ce.positionedLines.length,Ot=ot/mt;let ut=Ce.top-ze[1];for(let Ft=0;Ft<mt;++Ft){const Dt=Ce.positionedLines[Ft];ut=QZ(Ce,Ot,ut,Ft);for(const Et of Dt.positionedGlyphs){if(!Et.rect)continue;const gn=Et.rect||{};let cn=Sz+1,Ht=!0,zt=1,In=0;if(Et.imageName){const Ri=Ke[Et.imageName];if(!Ri)continue;if(Ri.sdf){_i("SDF images are not supported in formatted text and will be ignored.");continue}Ht=!1,zt=Ri.pixelRatio,cn=Ta/zt}const dn=(Xe||lt)&&Et.vertical,nn=Et.metrics.advance*Et.scale/2,On=Et.metrics,zn=Et.rect;if(zn===null)continue;lt&&Ce.verticalizable&&(In=Et.imageName?nn-Et.metrics.width*Et.scale/2:0);const Ln=Xe?[Et.x+nn,Et.y]:[0,0];let $n=[0,0],ur=[0,0],tr=!1;Xe||(dn?(ur=[Et.x+nn+At[0],Et.y+At[1]-In],tr=!0):$n=[Et.x+nn+ze[0],Et.y+ze[1]-In]);const Br=zn.w*Et.scale/(zt*(Et.localGlyph?dc:1)),$r=zn.h*Et.scale/(zt*(Et.localGlyph?dc:1));let Nn,Rr,Dr,Qr;if(dn){const Ri=Et.y-ut,yi=new Nt(-nn,nn-Ri),Ds=-Math.PI/2,ns=new Nt(...ur);Nn=new Nt(-nn+$n[0],$n[1]),Nn._rotateAround(Ds,yi)._add(ns),Nn.x+=-Ri+nn,Nn.y-=(On.left-cn)*Et.scale;const no=Et.imageName?On.advance*Et.scale:to*Et.scale,Xr=String.fromCodePoint(Et.glyph);jZ(Xr)?Nn.x+=(1-cn)*Et.scale:$Z(Xr)?Nn.x+=no-On.height*Et.scale+(-cn-1)*Et.scale:Nn.x+=Et.imageName||On.width+2*cn===zn.w&&On.height+2*cn===zn.h?(no-$r)/2:(no-(On.height+2*cn)*Et.scale)/2,Rr=new Nt(Nn.x,Nn.y-Br),Dr=new Nt(Nn.x+$r,Nn.y),Qr=new Nt(Nn.x+$r,Nn.y-Br)}else{const Ri=(On.left-cn)*Et.scale-nn+$n[0],yi=(-On.top-cn)*Et.scale+$n[1],Ds=Ri+Br,ns=yi+$r;Nn=new Nt(Ri,yi),Rr=new Nt(Ds,yi),Dr=new Nt(Ri,ns),Qr=new Nt(Ds,ns)}if(ct){let Ri;Ri=Xe?new Nt(0,0):tr?new Nt(At[0],At[1]):new Nt(ze[0],ze[1]),Nn._rotateAround(ct,Ri),Rr._rotateAround(ct,Ri),Dr._rotateAround(ct,Ri),Qr._rotateAround(ct,Ri)}const Pi=new Nt(0,0),Gi=new Nt(0,0);Tt.push({tl:Nn,tr:Rr,bl:Dr,br:Qr,texPrimary:gn,texSecondary:void 0,writingMode:Ce.writingMode,glyphOffset:Ln,sectionIndex:Et.sectionIndex,isSDF:Ht,pixelOffsetTL:Pi,pixelOffsetBR:Gi,minFontScaleX:0,minFontScaleY:0})}}return Tt}(0,c,b,p,m,v,h,i.allowVerticalPlacement),de=i.textSizeData;let me=null;de.kind==="source"?(me=[hc*p.layout.get("text-size").evaluate(v,{},j)],me[0]>Ed&&_i(`${i.layerIds[0]}: Value for "text-size" is >= ${y0}. Reduce your "text-size".`)):de.kind==="composite"&&(me=[hc*F.compositeTextSizes[0].evaluate(v,{},j),hc*F.compositeTextSizes[1].evaluate(v,{},j)],(me[0]>Ed||me[1]>Ed)&&_i(`${i.layerIds[0]}: Value for "text-size" is >= ${y0}. Reduce your "text-size".`)),i.addSymbols(i.text,pe,me,b,m,v,I,n,s,E.lineStartIndex,E.lineLength,z,V,j,K,!1);for(const Ae of P)M[Ae]=i.text.placedSymbolArray.length-1;return 4*pe.length}function Wz(i){for(const n in i)return i[n];return null}function Bb(i,n,s,c,h,p,m,v,b,E){let I=m.top,P=m.bottom,M=m.left,z=m.right;const F=m.collisionPadding;if(F&&(M-=F[0],I-=F[1],z+=F[2],P+=F[3]),b){const V=new Nt(M,I),j=new Nt(z,I),K=new Nt(M,P),pe=new Nt(z,P),de=Qn(b);let me=new Nt(0,0);E&&(me=new Nt(E[0],E[1])),V._rotateAround(de,me),j._rotateAround(de,me),K._rotateAround(de,me),pe._rotateAround(de,me),M=Math.min(V.x,j.x,K.x,pe.x),z=Math.max(V.x,j.x,K.x,pe.x),I=Math.min(V.y,j.y,K.y,pe.y),P=Math.max(V.y,j.y,K.y,pe.y)}return i.emplaceBack(n.x,n.y,n.z,s.x,s.y,M,I,z,P,v,c,h,p),i.length-1}function _C(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const n=i.bottom-i.top;return n>0?Math.max(10,n):null}function rX(i,n,s,c){const h=i.compareText;if(n in h){const p=h[n];for(let m=p.length-1;m>=0;m--)if(c.dist(p[m])<s)return!0}else h[n]=[];return h[n].push(c),!1}function Hz(i,n){const s=i.fovAboveCenter,c=i.elevation?i.elevation.getMinElevationBelowMSL()*n:0,h=(i._camera.position[2]*i.worldSize-c)/Math.cos(i._pitch),p=Math.sin(s)*h/Math.sin(Math.max(Math.PI/2-i._pitch-s,.01)),m=Math.sin(i._pitch)*p+h;return Math.min(1.01*m,h*(1/i._horizonShift))}function mp(i,n){if(!n.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:n};const s=Math.pow(2,-i.z),c=i.x*s,h=(i.x+1)*s,p=i.y*s,m=(i.y+1)*s,v=ca(c),b=ca(h),E=Vs(p),I=Vs(m),P=n.project(v,E),M=n.project(b,E),z=n.project(b,I),F=n.project(v,I);let V=Math.min(P.x,M.x,z.x,F.x),j=Math.min(P.y,M.y,z.y,F.y),K=Math.max(P.x,M.x,z.x,F.x),pe=Math.max(P.y,M.y,z.y,F.y);const de=s/16;function me(Ce,ze,$e,Xe,tt,Ke){const lt=($e+tt)/2,Tt=(Xe+Ke)/2,ct=n.project(ca(lt),Vs(Tt)),At=Math.max(0,V-ct.x,j-ct.y,ct.x-K,ct.y-pe);V=Math.min(V,ct.x),K=Math.max(K,ct.x),j=Math.min(j,ct.y),pe=Math.max(pe,ct.y),At>de&&(me(Ce,ct,$e,Xe,lt,Tt),me(ct,ze,lt,Tt,tt,Ke))}me(P,M,c,p,h,p),me(M,z,h,p,h,m),me(z,F,h,m,c,m),me(F,P,c,m,c,p),V-=de,j-=de,K+=de,pe+=de;const Ae=1/Math.max(K-V,pe-j);return{scale:Ae,x:V*Ae,y:j*Ae,x2:K*Ae,y2:pe*Ae,projection:n}}function Zz(i,{x:n,y:s},c=0){return new Nt(((n-c)*i.scale-i.x)*Lt,(s*i.scale-i.y)*Lt)}const iX=a.ae.identity(new Float32Array(16));class Sd{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,s){return{x:0,y:0,z:0}}unproject(n,s){return new yr(0,0)}projectTilePoint(n,s,c){return{x:n,y:s,z:0}}locationPoint(n,s,c=!0){return n._coordinatePoint(n.locationCoordinate(s),c)}pixelsPerMeter(n,s){return No(1,n)*s}pixelSpaceConversion(n,s,c){return 1}farthestPixelDistance(n){return Hz(n,n.pixelsPerMeter)}pointCoordinate(n,s,c,h){const p=n.horizonLineFromTop(!1),m=new Nt(s,Math.max(p,c));return n.rayIntersectionCoordinate(n.pointRayIntersection(m,h))}pointCoordinate3D(n,s,c){const h=new Nt(s,c);if(n.elevation)return n.elevation.pointCoordinate(h);{const p=this.pointCoordinate(n,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(n,s){if(n.elevation&&n.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(n,s.x,s.y);const c=n.horizonLineFromTop();return s.y<c}createInversionMatrix(n,s){return iX}createTileMatrix(n,s,c){let h,p,m;const v=c.canonical,b=a.ae.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=mp(v,this);h=1,p=E.x+c.wrap*E.scale,m=E.y,a.ae.scale(b,b,[h/E.scale,h/E.scale,n.pixelsPerMeter/s])}else h=s/n.zoomScale(v.z),p=(v.x+Math.pow(2,v.z)*c.wrap)*h,m=v.y*h;return a.ae.translate(b,b,[p,m,0]),a.ae.scale(b,b,[h/Lt,h/Lt,1]),b}upVector(n,s,c){return[0,0,1]}upVectorScale(n,s,c){return{metersToTile:1}}}class sX extends Sd{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[s,c]=this.parallels=n.parallels||[29.5,45.5],h=Math.sin(Qn(s));this.n=(h+Math.sin(Qn(c)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(n,s){const{n:c,c:h,r0:p}=this,m=Qn(n-this.center[0]),v=Qn(s),b=Math.sqrt(h-2*c*Math.sin(v))/c;return{x:b*Math.sin(m*c),y:b*Math.cos(m*c)-p,z:0}}unproject(n,s){const{n:c,c:h,r0:p}=this,m=p+s;let v=Math.atan2(n,Math.abs(m))*Math.sign(m);m*c<0&&(v-=Math.PI*Math.sign(n)*Math.sign(m));const b=Qn(this.center[0])*c;v=Zl(v,-Math.PI-b,Math.PI-b);const E=Gn(Xs(v/c)+this.center[0],-180,180),I=Math.asin(Gn((h-(n*n+m*m)*c*c)/(2*c),-1,1)),P=Gn(Xs(I),-Ui,Ui);return new yr(E,P)}}const v0=1.340264,x0=-.081106,b0=893e-6,w0=.003796,Ub=Math.sqrt(3)/2;class oX extends Sd{project(n,s){s=s/180*Math.PI,n=n/180*Math.PI;const c=Math.asin(Ub*Math.sin(s)),h=c*c,p=h*h*h;return{x:.5*(n*Math.cos(c)/(Ub*(v0+3*x0*h+p*(7*b0+9*w0*h)))/Math.PI+.5),y:1-.5*(c*(v0+x0*h+p*(b0+w0*h))/Math.PI+1),z:0}}unproject(n,s){n=(2*n-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,h=c*c,p=h*h*h;for(let I,P,M,z=0;z<12&&(P=c*(v0+x0*h+p*(b0+w0*h))-s,M=v0+3*x0*h+p*(7*b0+9*w0*h),I=P/M,c=Gn(c-I,-Math.PI/3,Math.PI/3),h=c*c,p=h*h*h,!(Math.abs(I)<1e-12));++z);const m=Ub*n*(v0+3*x0*h+p*(7*b0+9*w0*h))/Math.cos(c),v=Math.asin(Math.sin(c)/Ub),b=Gn(180*m/Math.PI,-180,180),E=Gn(180*v/Math.PI,-Ui,Ui);return new yr(b,E)}}class aX extends Sd{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,s){return{x:.5+n/360,y:.5-s/360,z:0}}unproject(n,s){const c=360*(n-.5),h=Gn(360*(.5-s),-Ui,Ui);return new yr(c,h)}}const xg=Math.PI/2;function Vb(i){return Math.tan((xg+i)/2)}class lX extends Sd{constructor(n){super(n),this.center=n.center||[0,30];const[s,c]=this.parallels=n.parallels||[30,30];let h=Qn(s),p=Qn(c);this.southernCenter=h+p<0,this.southernCenter&&(h=-h,p=-p);const m=Math.cos(h),v=Vb(h);this.n=h===p?Math.sin(h):Math.log(m/Math.cos(p))/Math.log(Vb(p)/v),this.f=m*Math.pow(Vb(h),this.n)/this.n}project(n,s){s=Qn(s),this.southernCenter&&(s=-s),n=Qn(n-this.center[0]);const c=1e-6,{n:h,f:p}=this;p>0?s<-xg+c&&(s=-xg+c):s>xg-c&&(s=xg-c);const m=p/Math.pow(Vb(s),h);let v=m*Math.sin(h*n),b=p-m*Math.cos(h*n);return v=.5*(v/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:v,y:this.southernCenter?b:1-b,z:0}}unproject(n,s){n=(2*n-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:c,f:h}=this,p=h-s,m=Math.sign(p),v=Math.sign(c)*Math.sqrt(n*n+p*p);let b=Math.atan2(n,Math.abs(p))*m;p*c<0&&(b-=Math.PI*Math.sign(n)*m);const E=Gn(Xs(b/c)+this.center[0],-180,180),I=Gn(Xs(2*Math.atan(Math.pow(h/v,1/c))-xg),-Ui,Ui);return new yr(E,this.southernCenter?-I:I)}}class Xz extends Sd{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,s){return{x:Kc(n),y:Yc(s),z:0}}unproject(n,s){const c=ca(n),h=Vs(s);return new yr(c,h)}}const Kz=Qn(Ui);class cX extends Sd{project(n,s){const c=(s=Qn(s))*s,h=c*c;return{x:.5*((n=Qn(n))*(.8707-.131979*c+h*(h*(.003971*c-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+h*(.028874*c-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(n,s){n=(2*n-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,h=25,p=0,m=c*c;do{m=c*c;const E=m*m;p=(c*(1.007226+m*(.015085+E*(.028874*m-.044475-.005916*E)))-s)/(1.007226+m*(.045255+E*(.259866*m-.311325-.005916*11*E))),c=Gn(c-p,-Kz,Kz)}while(Math.abs(p)>1e-6&&--h>0);m=c*c;const v=Gn(Xs(n/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),b=Xs(c);return new yr(v,b)}}const Yz=Qn(Ui);class uX extends Sd{project(n,s){s=Qn(s),n=Qn(n);const c=Math.cos(s),h=2/Math.PI,p=Math.acos(c*Math.cos(n/2)),m=Math.sin(p)/p,v=.5*(n*h+2*c*Math.sin(n/2)/m)||0,b=.5*(s+Math.sin(s)/m)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(n,s){let c=n=(2*n-.5)*Math.PI,h=s=(2*(1-s)-1)*Math.PI,p=25;const m=1e-6;let v=0,b=0;do{const E=Math.cos(h),I=Math.sin(h),P=2*I*E,M=I*I,z=E*E,F=Math.cos(c/2),V=Math.sin(c/2),j=2*F*V,K=V*V,pe=1-z*F*F,de=pe?1/pe:0,me=pe?Math.acos(E*F)*Math.sqrt(1/pe):0,Ae=.5*(2*me*E*V+2*c/Math.PI)-n,Ce=.5*(me*I+h)-s,ze=.5*de*(z*K+me*E*F*M)+1/Math.PI,$e=de*(j*P/4-me*I*V),Xe=.125*de*(P*V-me*I*z*j),tt=.5*de*(M*F+me*K*E)+.5,Ke=$e*Xe-tt*ze;v=(Ce*$e-Ae*tt)/Ke,b=(Ae*Xe-Ce*ze)/Ke,c=Gn(c-v,-Math.PI,Math.PI),h=Gn(h-b,-Yz,Yz)}while((Math.abs(v)>m||Math.abs(b)>m)&&--p>0);return new yr(Xs(c),Xs(h))}}class Qz extends Sd{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Qn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,s){const{scale:c,cosPhi:h}=this;return{x:Qn(n)*h*c+.5,y:-Math.sin(Qn(s))/h*c+.5,z:0}}unproject(n,s){const{scale:c,cosPhi:h}=this,p=-(s-.5)/c,m=Gn(Xs((n-.5)/c)/h,-180,180),v=Math.asin(Gn(p*h,-1,1)),b=Gn(Xs(v),-Ui,Ui);return new yr(m,b)}}class hX extends Xz{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,s,c){const h=r0(n,s,c),p=i0(Qc(c));return a.$.transformMat4(h,h,p),{x:h[0],y:h[1],z:h[2]}}locationPoint(n,s){const c=up(s.lat,s.lng),h=a.$.normalize([],c),p=n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(s),n._centerAltitude):n._centerAltitude,m=No(1,0)*Lt*p;a.$.scaleAndAdd(c,c,h,m);const v=a.ae.identity(new Float64Array(16));return a.ae.multiply(v,n.pixelMatrix,n.globeMatrix),a.$.transformMat4(c,c,v),new Nt(c[0],c[1])}pixelsPerMeter(n,s){return No(1,0)*s}pixelSpaceConversion(n,s,c){const h=No(1,n)*s,p=wn(No(1,45)*s,h,c);return this.pixelsPerMeter(n,s)/p}createTileMatrix(n,s,c){const h=XA(Qc(c.canonical));return a.ae.multiply(new Float64Array(16),n.globeMatrix,h)}createInversionMatrix(n,s){const{center:c}=n,h=i0(Qc(s));return a.ae.rotateY(h,h,Qn(c.lng)),a.ae.rotateX(h,h,Qn(c.lat)),a.ae.scale(h,h,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(n,s,c,h){return WL(n,s,c,!0)||new fo(0,0)}pointCoordinate3D(n,s,c){const h=this.pointCoordinate(n,s,c,0);return[h.x,h.y,h.z]}isPointAboveHorizon(n,s){return!WL(n,s.x,s.y,!1)}farthestPixelDistance(n){const s=function(h,p){const m=h.cameraToCenterDistance,v=h._centerAltitude*p,b=h._camera,E=h._camera.forward(),I=a.$.add([],a.$.scale([],E,-m),[0,0,v]),P=h.worldSize/(2*Math.PI),M=[0,0,-P],z=h.width/h.height,F=Math.tan(h.fovAboveCenter),V=a.$.scale([],b.up(),F),j=a.$.scale([],b.right(),F*z),K=a.$.normalize([],a.$.add([],a.$.add([],E,V),j)),pe=[];let de;if(new GA(I,K).closestPointOnSphere(M,P,pe)){const me=a.$.add([],pe,M),Ae=a.$.sub([],me,I);de=Math.cos(h.fovAboveCenter)*a.$.length(Ae)}else{const me=a.$.sub([],I,M),Ae=a.$.sub([],M,I);a.$.normalize(Ae,Ae);const Ce=a.$.length(me)-P;de=Math.sqrt(Ce*(Ce+2*P));const ze=Math.acos(de/(P+Ce))-Math.acos(a.$.dot(E,Ae));de*=Math.cos(ze)}return 1.01*de}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),c=rh(n.zoom);if(c>0){const h=Hz(n,No(1,n.center.lat)*n.worldSize),p=n.worldSize/(2*Math.PI),m=Math.max(n.width,n.height)/n.worldSize*Math.PI;return wn(s,h+p*(1-Math.cos(m)),Math.pow(c,10))}return s}upVector(n,s,c){return r0(s,c,n,1)}upVectorScale(n){return{metersToTile:mb(_b(Qc(n)))}}}function Jz(i){const n=i.parallels,s=!!n&&Math.abs(n[0]+n[1])<.01;switch(i.name){case"mercator":return new Xz(i);case"equirectangular":return new aX(i);case"naturalEarth":return new cX(i);case"equalEarth":return new oX(i);case"winkelTripel":return new uX(i);case"albers":return s?new Qz(i):new sX(i);case"lambertConformalConic":return s?new Qz(i):new lX(i);case"globe":return new hX(i)}throw new Error(`Invalid projection name: ${i.name}`)}const dX=Eb.types,fX=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function jb(i,n,s,c,h,p,m,v,b,E,I,P,M){const z=v?Math.min(Ed,Math.round(v[0])):0,F=v?Math.min(Ed,Math.round(v[1])):0;i.emplaceBack(n,s,Math.round(32*c),Math.round(32*h),p,m,(z<<1)+(b?1:0),F,16*E,16*I,256*P,256*M)}function $b(i,n,s){i.emplaceBack(n,s)}function Gb(i,n,s,c,h,p,m){i.emplaceBack(n,s,c,h,p,m)}function qb(i,n,s,c,h){i.emplaceBack(n,s,c,h),i.emplaceBack(n,s,c,h),i.emplaceBack(n,s,c,h),i.emplaceBack(n,s,c,h)}function pX(i){for(const n of i.sections)if(Fn(n.text))return!0;return!1}class yC{constructor(n){this.layoutVertexArray=new fA,this.indexArray=new ks,this.programConfigurations=n,this.segments=new pi,this.dynamicLayoutVertexArray=new dd,this.opacityVertexArray=new mA,this.placedSymbolArray=new dL,this.iconTransitioningVertexArray=new md,this.globeExtVertexArray=new pA,this.zOffsetVertexArray=new rg}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(n,s,c,h,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,_Z.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,vZ.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,fX,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,xZ.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,yZ.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,sz.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||h)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}je(yC,"SymbolBuffers");class vC{constructor(n,s,c){this.layoutVertexArray=new n,this.layoutAttributes=s,this.indexArray=new c,this.segments=new pi,this.collisionVertexArray=new yA,this.collisionVertexArrayExt=new dd}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,bZ.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,wZ.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}je(vC,"CollisionBuffers");class bg{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.lut=n.lut,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=a.ae.identity([]),this.placementViewportMatrix=a.ae.identity([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=cC(this.zoom,s["text-size"]),this.iconSizeData=cC(this.zoom,s["icon-size"]);const c=this.layers[0].layout,h=c.get("symbol-sort-key"),p=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(m=>Za[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=c.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new yC(new _d(this.layers,{zoom:this.zoom,lut:this.lut},n=>/^text/.test(n))),this.icon=new yC(new _d(this.layers,{zoom:this.zoom,lut:this.lut},n=>/^icon/.test(n))),this.glyphOffsetArray=new mL,this.lineVertexArray=new gL,this.symbolInstances=new pL}calculateGlyphDependencies(n,s,c,h,p){for(let m=0;m<n.length;m++){const v=n.codePointAt(m);if(v===void 0)break;if(s[v]=!0,h&&p&&v<=65535){const b=m0[n.charAt(m)];b&&(s[b.charCodeAt(0)]=!0)}}}updateFootprints(n,s){}updateReplacement(n,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const c=s.getReplacementRegionsForTile(n.toUnwrapped(),!0);return!oC(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(n,s,c,h){const p=this.layers[0],m=p.layout,v=this.projection.name==="globe",b=m.get("text-font"),E=m.get("text-field"),I=m.get("icon-image"),P=(E.value.kind!=="constant"||E.value.value instanceof uo&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),M=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,z=m.get("symbol-sort-key");if(this.features=[],!P&&!M)return;const F=s.iconDependencies,V=s.glyphDependencies,j=s.availableImages,K=new An(this.zoom);for(const{feature:pe,id:de,index:me,sourceLayerIndex:Ae}of n){const Ce=p._featureFilter.needGeometry,ze=th(pe,Ce);if(!p._featureFilter.filter(K,ze,c))continue;if(Ce||(ze.geometry=uc(pe,c,h)),v&&pe.type!==1&&c.z<=5){const Ke=ze.geometry,lt=.98078528056,Tt=(ct,At)=>{const ot=r0(ct.x,ct.y,c,1),mt=r0(At.x,At.y,c,1);return a.$.dot(ot,mt)<lt};for(let ct=0;ct<Ke.length;ct++)Ke[ct]=hH(Ke[ct],Tt)}let $e,Xe;if(P){const Ke=p.getValueAndResolveTokens("text-field",ze,c,j),lt=uo.factory(Ke);pX(lt)&&(this.hasRTLText=!0),(!this.hasRTLText||Bn()==="unavailable"||this.hasRTLText&&Jn.isParsed())&&($e=VZ(lt,p,ze))}if(M){const Ke=p.getValueAndResolveTokens("icon-image",ze,c,j);Xe=Ke instanceof ta?Ke:ta.fromString(Ke)}if(!$e&&!Xe)continue;const tt=this.sortFeaturesByKey?z.evaluate(ze,{},c):void 0;if(this.features.push({id:de,text:$e,icon:Xe,index:me,sourceLayerIndex:Ae,geometry:ze.geometry,properties:pe.properties,type:dX[pe.type],sortKey:tt}),Xe&&(F[Xe.namePrimary]=!0,Xe.nameSecondary&&(F[Xe.nameSecondary]=!0)),$e){const Ke=b.evaluate(ze,{},c).join(","),lt=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Za.vertical)>=0;for(const Tt of $e.sections)if(Tt.image)F[Tt.image.namePrimary]=!0;else{const ct=ft($e.toString()),At=Tt.fontStack||Ke,ot=V[At]=V[At]||{};this.calculateGlyphDependencies(Tt.text,ot,lt,this.allowVerticalPlacement,ct)}}}m.get("symbol-placement")==="line"&&(this.features=function(pe){const de={},me={},Ae=[];let Ce=0;function ze(Ke){Ae.push(pe[Ke]),Ce++}function $e(Ke,lt,Tt){const ct=me[Ke];return delete me[Ke],me[lt]=ct,Ae[ct].geometry[0].pop(),Ae[ct].geometry[0]=Ae[ct].geometry[0].concat(Tt[0]),ct}function Xe(Ke,lt,Tt){const ct=de[lt];return delete de[lt],de[Ke]=ct,Ae[ct].geometry[0].shift(),Ae[ct].geometry[0]=Tt[0].concat(Ae[ct].geometry[0]),ct}function tt(Ke,lt,Tt){const ct=Tt?lt[0][lt[0].length-1]:lt[0][0];return`${Ke}:${ct.x}:${ct.y}`}for(let Ke=0;Ke<pe.length;Ke++){const lt=pe[Ke],Tt=lt.geometry,ct=lt.text?lt.text.toString():null;if(!ct){ze(Ke);continue}const At=tt(ct,Tt),ot=tt(ct,Tt,!0);if(At in me&&ot in de&&me[At]!==de[ot]){const mt=Xe(At,ot,Tt),Ot=$e(At,ot,Ae[mt].geometry);delete de[At],delete me[ot],me[tt(ct,Ae[Ot].geometry,!0)]=Ot,Ae[mt].geometry=null}else At in me?$e(At,ot,Tt):ot in de?Xe(At,ot,Tt):(ze(Ke),de[At]=Ce-1,me[ot]=Ce-1)}return Ae.filter(Ke=>Ke.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,de)=>pe.sortKey-de.sortKey)}update(n,s,c,h,p){const m=Object.keys(n).length!==0;if(m&&!this.stateDependentLayers.length)return;const v=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(n,s,v,c,h,p),this.icon.programConfigurations.updatePaintArrays(n,s,v,c,h,p)}updateZOffset(){const n=(p,m,v)=>{c+=m,c>p.length&&p.resize(c);for(let b=-m;b<0;b++)p.emplace(b+c,v)},s=(p,m,v)=>{h+=m,h>p.length&&p.resize(h);for(let b=-m;b<0;b++)p.emplace(b+h,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,h=0;for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:b,numIconVertices:E}=m,I=m.zOffset,P=E>0;if((v>0||b>0)&&(n(this.text.zOffsetVertexArray,v,I),n(this.text.zOffsetVertexArray,b,I)),P){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:z}=m;M>=0&&s(this.icon.zOffsetVertexArray,E,I),z>=0&&s(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,I)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Jz(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,s){const c=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:h,y:p}of s)this.lineVertexArray.emplaceBack(h,p);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(n,s,c,h,p,m,v,b,E,I,P,M,z,F,V,j){const K=n.indexArray,pe=n.layoutVertexArray,de=n.globeExtVertexArray,me=n.segments.prepareSegment(4*s.length,pe,K,this.canOverlap?m.sortKey:void 0),Ae=this.glyphOffsetArray.length,Ce=me.vertexLength,ze=this.allowVerticalPlacement&&v===Za.vertical?Math.PI/2:0,$e=m.text&&m.text.sections;for(let tt=0;tt<s.length;tt++){const{tl:Ke,tr:lt,bl:Tt,br:ct,texPrimary:At,texSecondary:ot,pixelOffsetTL:mt,pixelOffsetBR:Ot,minFontScaleX:ut,minFontScaleY:Ft,glyphOffset:Dt,isSDF:Et,sectionIndex:gn}=s[tt],cn=me.vertexLength,Ht=Dt[1];if(jb(pe,E.x,E.y,Ke.x,Ht+Ke.y,At.x,At.y,c,Et,mt.x,mt.y,ut,Ft),jb(pe,E.x,E.y,lt.x,Ht+lt.y,At.x+At.w,At.y,c,Et,Ot.x,mt.y,ut,Ft),jb(pe,E.x,E.y,Tt.x,Ht+Tt.y,At.x,At.y+At.h,c,Et,mt.x,Ot.y,ut,Ft),jb(pe,E.x,E.y,ct.x,Ht+ct.y,At.x+At.w,At.y+At.h,c,Et,Ot.x,Ot.y,ut,Ft),b){const{x:zt,y:In,z:dn}=b.anchor,[nn,On,zn]=b.up;Gb(de,zt,In,dn,nn,On,zn),Gb(de,zt,In,dn,nn,On,zn),Gb(de,zt,In,dn,nn,On,zn),Gb(de,zt,In,dn,nn,On,zn),qb(n.dynamicLayoutVertexArray,zt,In,dn,ze)}else qb(n.dynamicLayoutVertexArray,E.x,E.y,E.z,ze);if(j){const zt=ot||At;$b(n.iconTransitioningVertexArray,zt.x,zt.y),$b(n.iconTransitioningVertexArray,zt.x+zt.w,zt.y),$b(n.iconTransitioningVertexArray,zt.x,zt.y+zt.h),$b(n.iconTransitioningVertexArray,zt.x+zt.w,zt.y+zt.h)}K.emplaceBack(cn,cn+1,cn+2),K.emplaceBack(cn+1,cn+2,cn+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Dt[0]),tt!==s.length-1&&gn===s[tt+1].sectionIndex||n.programConfigurations.populatePaintArrays(pe.length,m,m.index,{},z,F,V,$e&&$e[gn])}const Xe=b?b.anchor:E;n.placedSymbolArray.emplaceBack(Xe.x,Xe.y,Xe.z,E.x,E.y,Ae,this.glyphOffsetArray.length-Ae,Ce,I,P,E.segment,c?c[0]:0,c?c[1]:0,h[0],h[1],v,0,!1,0,M,0)}_commitLayoutVertex(n,s,c,h,p,m,v){n.emplaceBack(s,c,h,p,m,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(n,s,c,h,p,m,v){const b=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),E=b.vertexLength,I=v.tileAnchorX,P=v.tileAnchorY;for(let z=0;z<4;z++)c.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,s,n.padding,v.zOffset),this._commitLayoutVertex(c.layoutVertexArray,h,p,m,I,P,new Nt(n.x1,n.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,p,m,I,P,new Nt(n.x2,n.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,p,m,I,P,new Nt(n.x2,n.y2)),this._commitLayoutVertex(c.layoutVertexArray,h,p,m,I,P,new Nt(n.x1,n.y2)),b.vertexLength+=4;const M=c.indexArray;M.emplaceBack(E,E+1),M.emplaceBack(E+1,E+2),M.emplaceBack(E+2,E+3),M.emplaceBack(E+3,E),b.primitiveLength+=4}_addTextDebugCollisionBoxes(n,s,c,h,p,m){for(let v=h;v<p;v++){const b=c.get(v),E=this.getSymbolInstanceTextSize(n,m,s,v);this._addCollisionDebugVertices(b,E,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(n,s,c,h,p,m){for(let v=h;v<p;v++){const b=c.get(v),E=this.getSymbolInstanceIconSize(n,s,m.placedIconSymbolIndex);this._addCollisionDebugVertices(b,E,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}generateCollisionDebugBuffers(n,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vC(ob,oz.members,md),this.iconCollisionBox=new vC(ob,oz.members,md);const c=gg(this.iconSizeData,n),h=gg(this.textSizeData,n);for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(h,n,s,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(h,n,s,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(c,n,s,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(c,n,s,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(n,s,c,h){const p=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:h),m=Ob(this.textSizeData,n,p)/to;return this.tilePixelRatio*m}getSymbolInstanceIconSize(n,s,c){const h=this.icon.placedSymbolArray.get(c),p=Ob(this.iconSizeData,n,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(n,s,c,h){n.emplaceBack(s,-c,-c,h),n.emplaceBack(s,c,-c,h),n.emplaceBack(s,c,c,h),n.emplaceBack(s,-c,c,h)}_updateTextDebugCollisionBoxes(n,s,c,h,p,m){for(let v=h;v<p;v++){const b=c.get(v),E=this.getSymbolInstanceTextSize(n,m,s,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,b.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(n,s,c,h,p,m){for(let v=h;v<p;v++){const b=c.get(v),E=this.getSymbolInstanceIconSize(n,s,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,b.padding,m.zOffset)}}updateCollisionDebugBuffers(n,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=gg(this.iconSizeData,n),h=gg(this.textSizeData,n);for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,n,s,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(h,n,s,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(c,n,s,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._updateIconDebugCollisionBoxes(c,n,s,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,s,c,h,p,m,v,b,E){const I={};if(s<c){const{x1:P,y1:M,x2:z,y2:F,padding:V,projectedAnchorX:j,projectedAnchorY:K,projectedAnchorZ:pe,tileAnchorX:de,tileAnchorY:me,featureIndex:Ae}=n.get(s);I.textBox={x1:P,y1:M,x2:z,y2:F,padding:V,projectedAnchorX:j,projectedAnchorY:K,projectedAnchorZ:pe,tileAnchorX:de,tileAnchorY:me},I.textFeatureIndex=Ae}if(h<p){const{x1:P,y1:M,x2:z,y2:F,padding:V,projectedAnchorX:j,projectedAnchorY:K,projectedAnchorZ:pe,tileAnchorX:de,tileAnchorY:me,featureIndex:Ae}=n.get(h);I.verticalTextBox={x1:P,y1:M,x2:z,y2:F,padding:V,projectedAnchorX:j,projectedAnchorY:K,projectedAnchorZ:pe,tileAnchorX:de,tileAnchorY:me},I.verticalTextFeatureIndex=Ae}if(m<v){const{x1:P,y1:M,x2:z,y2:F,padding:V,projectedAnchorX:j,projectedAnchorY:K,projectedAnchorZ:pe,tileAnchorX:de,tileAnchorY:me,featureIndex:Ae}=n.get(m);I.iconBox={x1:P,y1:M,x2:z,y2:F,padding:V,projectedAnchorX:j,projectedAnchorY:K,projectedAnchorZ:pe,tileAnchorX:de,tileAnchorY:me},I.iconFeatureIndex=Ae}if(b<E){const{x1:P,y1:M,x2:z,y2:F,padding:V,projectedAnchorX:j,projectedAnchorY:K,projectedAnchorZ:pe,tileAnchorX:de,tileAnchorY:me,featureIndex:Ae}=n.get(b);I.verticalIconBox={x1:P,y1:M,x2:z,y2:F,padding:V,projectedAnchorX:j,projectedAnchorY:K,projectedAnchorZ:pe,tileAnchorX:de,tileAnchorY:me},I.verticalIconFeatureIndex=Ae}return I}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,s){const c=n.placedSymbolArray.get(s),h=c.vertexStartIndex+4*c.numGlyphs;for(let p=c.vertexStartIndex;p<h;p+=4)n.indexArray.emplaceBack(p,p+1,p+2),n.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(n),c=Math.cos(n),h=[],p=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const b=this.symbolInstances.get(v);h.push(0|Math.round(s*b.tileAnchorX+c*b.tileAnchorY)),p.push(b.featureIndex)}return m.sort((v,b)=>h[v]-h[b]||p[b]-p[v]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((n,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(n).zOffset)}addToSortKeyRanges(n,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:E}=c;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}je(bg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),bg.addDynamicAttributes=qb;class wl{constructor(n,s,c,h){this.context=n,this.format=c,this.texture=n.gl.createTexture(),this.update(s,h)}update(n,s,c){const{width:h,height:p}=n,{context:m}=this,{gl:v}=m;if(v.bindTexture(v.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!s||s.premultiply!==!1)),this.useMipmap=!!(s&&s.useMipmap),c||this.size&&this.size[0]===h&&this.size[1]===p){const{x:b,y:E}=c||{x:0,y:0};if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap)v.texSubImage2D(v.TEXTURE_2D,0,b,E,v.RGBA,v.UNSIGNED_BYTE,n);else{let I=this.format,P=v.UNSIGNED_BYTE;this.format===v.R32F&&(I=v.RED,P=v.FLOAT),v.texSubImage2D(v.TEXTURE_2D,0,b,E,h,p,I,P,n.data)}}else if(this.size=[h,p],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap){let b=this.format;this.format===v.R8&&(b=v.RED),v.texImage2D(v.TEXTURE_2D,0,this.format,b,v.UNSIGNED_BYTE,n)}else{let b=this.format,E=this.format,I=v.UNSIGNED_BYTE,P=!1;this.format===v.DEPTH_COMPONENT&&(b=v.DEPTH_COMPONENT16,I=v.UNSIGNED_SHORT),this.format===v.DEPTH_STENCIL&&(b=v.DEPTH24_STENCIL8,I=v.UNSIGNED_INT_24_8,P=!0),this.format===v.R8&&(E=v.RED),this.format===v.R32F&&(I=v.FLOAT,E=v.RED),!this.useMipmap&&P?v.texStorage2D(v.TEXTURE_2D,1,b,h,p):v.texImage2D(v.TEXTURE_2D,0,b,h,p,0,E,I,n.data)}this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(n,s,c=!1){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!c?n===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),s!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(n,s,c,h){const{context:p}=this,{gl:m}=p;m.bindTexture(m.TEXTURE_2D,this.texture),s!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,s),this.magFilter=s),n!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?n===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),c!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,c),this.wrapS=c),h!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class Wb{constructor(n,s){this.context=n,this.texture=s}bind(n,s){const{context:c}=this,{gl:h}=c;h.bindTexture(h.TEXTURE_2D,this.texture),n!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,n),this.minFilter=n),s!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrapS=s)}}const Tl=32,eu=33,Id=new Uint16Array(8184);for(let i=0;i<2046;i++){let n=i+2,s=0,c=0,h=0,p=0,m=0,v=0;for(1&n?h=p=m=Tl:s=c=v=Tl;(n>>=1)>1;){const E=s+h>>1,I=c+p>>1;1&n?(h=s,p=c,s=m,c=v):(s=h,c=p,h=m,p=v),m=E,v=I}const b=4*i;Id[b+0]=s,Id[b+1]=c,Id[b+2]=h,Id[b+3]=p}const tu=new Uint16Array(2178),Ad=new Uint8Array(1089),Hb=new Uint16Array(1089);function e5(i){return i===0?-.03125:i===32?.03125:0}var Zb=Pr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class gp{constructor(n,s,c,h){this.id=gp.uniqueIdxCounter,gp.uniqueIdxCounter++,this.context=n;const p=n.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||h||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=gp.uniqueIdxCounter,gp.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}gp.uniqueIdxCounter=0;class wg{constructor(n,s,c){this.func=n,this.mask=s,this.range=c}}wg.ReadOnly=!1,wg.ReadWrite=!0,wg.disabled=new wg(519,wg.ReadOnly,[0,1]);const xC=7680;class bC{constructor(n,s,c,h,p,m){this.test=n,this.ref=s,this.mask=c,this.fail=h,this.depthFail=p,this.pass=m}}bC.disabled=new bC({func:519,mask:0},0,0,xC,xC,xC);const T0=771;class Ea{constructor(n,s,c,h){this.blendFunction=n,this.blendColor=s,this.mask=c,this.blendEquation=h}}Ea.Replace=[1,0,1,0],Ea.disabled=new Ea(Ea.Replace,wr.transparent,[!1,!1,!1,!1]),Ea.unblended=new Ea(Ea.Replace,wr.transparent,[!0,!0,!0,!0]),Ea.alphaBlended=new Ea([1,T0,1,T0],wr.transparent,[!0,!0,!0,!0]),Ea.alphaBlendedNonPremultiplied=new Ea([770,T0,770,T0],wr.transparent,[!0,!0,!0,!0]),Ea.multiply=new Ea([774,0,774,0],wr.transparent,[!0,!0,!0,!0]);const wC=1029,TC=2305;class fc{constructor(n,s,c){this.enable=n,this.mode=s,this.frontFace=c}}fc.disabled=new fc(!1,wC,TC),fc.backCCW=new fc(!0,wC,TC),fc.backCW=new fc(!0,wC,2304),fc.frontCW=new fc(!0,1028,2304),fc.frontCCW=new fc(!0,1028,TC);var mX=Pr([{name:"a_index",type:"Int16",components:1}]);const t5={type:2,extent:Lt,loadGeometry:()=>[[new Nt(0,0),new Nt(Lt+1,0),new Nt(Lt+1,Lt+1),new Nt(0,Lt+1),new Nt(0,0)]]};class Xb{constructor(n,s,c,h,p){this.tileID=n,this.uid=Kl(),this.uses=0,this.tileSize=s,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,h&&h.style&&(this._lastUpdatedBrightness=h.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(n){const s=n+this.timeAdded;s<Qt.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=mp(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,s,c){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(h,p){const m={};if(!p)return m;for(const v of h){const b=v.layerIds.map(E=>p.getLayer(E)).filter(Boolean);if(b.length!==0){v.layers=b,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(E=>b.filter(I=>I.id===E)[0]));for(const E of b)m[E.fqid]=v}}return m}(n.buckets,s.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const p=this.buckets[h];if(p instanceof bg){if(this.hasSymbolBuckets=!0,!c)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const p=this.buckets[h];if(p instanceof bg&&p.hasRTLText){this.hasRTLText=!0,Jn.isLoading()||Jn.isLoaded()||Bn()!=="deferred"||mr();break}}this.queryPadding=0;for(const h in this.buckets){const p=this.buckets[h],m=s.style.getOwnLayer(h);if(!m)continue;const v=m.queryRadius(p);this.queryPadding=Math.max(this.queryPadding,v)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new IA}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(n)}const s=n.gl,c=this.imageAtlas;if(c&&!c.uploaded){const h=!!Object.keys(c.patternPositions).length;this.imageAtlasTexture=new wl(n,c.image,s.RGBA,{useMipmap:h}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new wl(n,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new wl(n,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(n,s,c){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,c),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const h=s.style.getBrightness();(this._lastUpdatedBrightness||h)&&(this._lastUpdatedBrightness&&h&&Math.abs(this._lastUpdatedBrightness-h)<.001||(this._lastUpdatedBrightness=h,this.updateBuckets(void 0,s)))}queryRenderedFeatures(n,s,c,h,p,m,v,b){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:v,transform:m,params:p,tileTransform:this.tileTransform},n,s,c):{}}querySourceFeatures(n,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const h=c.loadVTLayers(),p=s?s.sourceLayer:"",m=h._geojsonTileLayer||h[p];if(!m)return;const v=ac(s&&s.filter),{z:b,x:E,y:I}=this.tileID.canonical,P={z:b,x:E,y:I};for(let M=0;M<m.length;M++){const z=m.feature(M);if(v.needGeometry){const j=th(z,!0);if(!v.filter(new An(this.tileID.overscaledZ),j,this.tileID.canonical))continue}else if(!v.filter(new An(this.tileID.overscaledZ),z))continue;const F=c.getId(z,p),V=new wz(z,b,E,I,F);V.tile=P,n.push(V)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const s=this.expirationTime;if(n.cacheControl){const c=Uc(n.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const c=Date.now();let h=!1;if(this.expirationTime>c)h=!1;else if(s)if(this.expirationTime<s)h=!0;else{const p=this.expirationTime-s;p?this.expirationTime=c+Math.max(p,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,s){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0&&s&&this.updateBuckets(n,s)}updateBuckets(n,s){if(!this.latestFeatureIndex)return;const c=this.latestFeatureIndex.loadVTLayers(),h=s.style.listImages(),p=s.style.getBrightness();for(const m in this.buckets){if(!s.style.hasLayer(m))continue;const v=this.buckets[m],b=v.layers[0].sourceLayer||"_geojsonTileLayer",E=c[b];let I={};if(n&&(I=n[b],!E||!I||Object.keys(I).length===0))continue;if(v.update(I,E,h,this.imageAtlas&&this.imageAtlas.patternPositions||{},p),v instanceof Mb||v instanceof wb){const M=s.style.getOwnSourceCache(v.layers[0].source);s._terrain&&s._terrain.enabled&&M&&v.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(M.id,this.tileID)}const P=s&&s.style&&s.style.getOwnLayer(m);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Qt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=Qt.now()+n}setTexture(n,s){const c=s.context,h=c.gl;this.texture=this.texture||s.getTileTexture(n.width),this.texture&&this.texture instanceof wl?this.texture.update(n,{useMipmap:!0}):(this.texture=new wl(c,n,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(n,s){const c={};for(const h of s)c[h]=!0;this.dependencies[n]=c}hasDependency(n,s){for(const c of n){const h=this.dependencies[c];if(h){for(const p of s)if(h[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const c=uc(t5,this.tileID.canonical,this.tileTransform)[0],h=new lc,p=new Ky;for(let m=0;m<c.length;m++){const{x:v,y:b}=c[m];h.emplaceBack(v,b),p.emplaceBack(m)}p.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(p),this._tileDebugBuffer=n.createVertexBuffer(h,n0.members),this._tileDebugSegments=pi.simpleSegment(0,0,h.length,p.length)}_makeTileBoundsBuffers(n,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const c=uc(t5,this.tileID.canonical,this.tileTransform)[0];let h,p;if(this.isRaster){const m=function(v,b){const E=mp(v,b),I=Math.pow(2,v.z);for(let j=0;j<eu;j++)for(let K=0;K<eu;K++){const pe=ca((v.x+(K+e5(K))/Tl)/I),de=Vs((v.y+(j+e5(j))/Tl)/I),me=b.project(pe,de),Ae=j*eu+K;tu[2*Ae+0]=Math.round((me.x*E.scale-E.x)*Lt),tu[2*Ae+1]=Math.round((me.y*E.scale-E.y)*Lt)}Ad.fill(0),Hb.fill(0);for(let j=2045;j>=0;j--){const K=4*j,pe=Id[K+0],de=Id[K+1],me=Id[K+2],Ae=Id[K+3],Ce=pe+me>>1,ze=de+Ae>>1,$e=Ce+ze-de,Xe=ze+pe-Ce,tt=de*eu+pe,Ke=Ae*eu+me,lt=ze*eu+Ce,Tt=Math.hypot((tu[2*tt+0]+tu[2*Ke+0])/2-tu[2*lt+0],(tu[2*tt+1]+tu[2*Ke+1])/2-tu[2*lt+1])>=16;Ad[lt]=Ad[lt]||(Tt?1:0),j<1022&&(Ad[lt]=Ad[lt]||Ad[(de+Xe>>1)*eu+(pe+$e>>1)]||Ad[(Ae+Xe>>1)*eu+(me+$e>>1)])}const P=new Yu,M=new ks;let z=0;function F(j,K){const pe=K*eu+j;return Hb[pe]===0&&(P.emplaceBack(tu[2*pe+0],tu[2*pe+1],j*Lt/Tl,K*Lt/Tl),Hb[pe]=++z),Hb[pe]-1}function V(j,K,pe,de,me,Ae){const Ce=j+pe>>1,ze=K+de>>1;if(Math.abs(j-me)+Math.abs(K-Ae)>1&&Ad[ze*eu+Ce])V(me,Ae,j,K,Ce,ze),V(pe,de,me,Ae,Ce,ze);else{const $e=F(j,K),Xe=F(pe,de),tt=F(me,Ae);M.emplaceBack($e,Xe,tt)}}return V(0,0,Tl,Tl,Tl,0),V(Tl,Tl,0,0,0,Tl),{vertices:P,indices:M}}(this.tileID.canonical,s);h=m.vertices,p=m.indices}else{h=new Yu,p=new ks;for(const{x:v,y:b}of c)h.emplaceBack(v,b,0,0);const m=o0(h.int16,void 0,4);for(let v=0;v<m.length;v+=3)p.emplaceBack(m[v],m[v+1],m[v+2])}this._tileBoundsBuffer=n.createVertexBuffer(h,Zb.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(p),this._tileBoundsSegments=pi.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugBuffers(n,s){const c=s.projection;if(!c||c.name!=="globe"||s.freezeTileCoverage)return;const h=this.tileID.canonical,p=i0(HL(h,s)),m=rh(s.zoom);let v;m>0&&(v=a.ae.invert(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,h,s,p,v,m),this._makeGlobeTileDebugTextBuffer(n,h,s,p,v,m)}_globePoint(n,s,c,h,p,m,v){let b=r0(n,s,c);if(m){const E=1<<c.z,I=Kc(h.center.lng),P=Yc(h.center.lat),M=(c.x+.5)/E-I;let z=0;M>.5?z=-1:M<-.5&&(z=1);let F=(n/Lt+c.x)/E+z,V=(s/Lt+c.y)/E;F=(F-I)*h._pixelsPerMercatorPixel+I,V=(V-P)*h._pixelsPerMercatorPixel+P;const j=[F*h.worldSize,V*h.worldSize,0];a.$.transformMat4(j,j,m),b=nh(b,j,v)}return a.$.transformMat4(b,b,p)}_makeGlobeTileDebugBorderBuffer(n,s,c,h,p,m){const v=new lc,b=new Ky,E=new rb,I=(M,z,F,V,j)=>{const K=(F-M)/(j-1),pe=(V-z)/(j-1),de=v.length;for(let me=0;me<j;me++){const Ae=M+me*K,Ce=z+me*pe;v.emplaceBack(Ae,Ce);const ze=this._globePoint(Ae,Ce,s,c,h,p,m);E.emplaceBack(ze[0],ze[1],ze[2]),b.emplaceBack(de+me)}},P=Lt;I(0,0,P,0,16),I(P,0,P,P,16),I(P,P,0,P,16),I(0,P,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(b),this._tileDebugBuffer=n.createVertexBuffer(v,n0.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(E,qL.members),this._tileDebugSegments=pi.simpleSegment(0,0,v.length,b.length)}_makeGlobeTileDebugTextBuffer(n,s,c,h,p,m){const v=Lt/4,b=new lc,E=new ks,I=new rb,P=25;E.reserve(32),b.reserve(P),I.reserve(P);const M=(z,F)=>P*z+F;for(let z=0;z<P;z++){const F=z*v;for(let V=0;V<P;V++){const j=V*v;b.emplaceBack(j,F);const K=this._globePoint(j,F,s,c,h,p,m);I.emplaceBack(K[0],K[1],K[2])}}for(let z=0;z<4;z++)for(let F=0;F<4;F++){const V=M(z,F),j=M(z,F+1),K=M(z+1,F),pe=M(z+1,F+1);E.emplaceBack(V,j,K),E.emplaceBack(K,j,pe)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(E),this._tileDebugTextBuffer=n.createVertexBuffer(b,n0.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(I,qL.members),this._tileDebugTextSegments=pi.simpleSegment(0,0,P,32)}destroy(n=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof wl&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function gX(i,n,s){i===1?n.header_length=s.readFixed32():i===2?n.x=s.readVarint():i===3?n.y=s.readVarint():i===4?n.z=s.readVarint():i===5&&n.layers.push(function(c,h){return c.readFields(bX,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},h)}(s,s.readVarint()+s.pos))}function _X(i,n,s){i===1?(n.delta_filter=function(c,h){return c.readFields(yX,{block_size:0},h)}(s,s.readVarint()+s.pos),n.filter="delta_filter"):i===2?(s.readVarint(),n.filter="zigzag_filter"):i===3?(s.readVarint(),n.filter="bitshuffle_filter"):i===4&&(s.readVarint(),n.filter="byteshuffle_filter")}function yX(i,n,s){i===1&&(n.block_size=s.readVarint())}function vX(i,n,s){i===1?(s.readVarint(),n.codec="gzip_data"):i===2?(s.readVarint(),n.codec="jpeg_image"):i===3?(s.readVarint(),n.codec="webp_image"):i===4&&(s.readVarint(),n.codec="png_image")}function xX(i,n,s){i===1?n.first_byte=s.readFixed64():i===2?n.last_byte=s.readFixed64():i===3?n.filters.push(function(c,h){return c.readFields(_X,{},h)}(s,s.readVarint()+s.pos)):i===4?n.codec=function(c,h){return c.readFields(vX,{},h)}(s,s.readVarint()+s.pos):i===5?n.deprecated_offset=s.readFloat():i===6?n.deprecated_scale=s.readFloat():i===7?n.bands.push(s.readString()):i===8?n.offset=s.readDouble():i===9&&(n.scale=s.readDouble())}function bX(i,n,s){i===1?n.version=s.readVarint():i===2?n.name=s.readString():i===3?n.units=s.readString():i===4?n.tilesize=s.readVarint():i===5?n.buffer=s.readVarint():i===6?n.pixel_format=s.readVarint():i===7&&n.data_index.push(function(c,h){return c.readFields(xX,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},h)}(s,s.readVarint()+s.pos))}function wX(i,n,s){if(i===2)(function(c,h,p){c.readFields(TX,p,h)})(s,s.readVarint()+s.pos,n);else if(i===3)throw new Error("Not implemented")}function TX(i,n,s){if(i===1){let c=0;const h=s.readVarint()+s.pos;for(;s.pos<h;)n[c++]=s.readVarint()}}class EX{constructor(n){this.capacity=n,this.cache=new Map}get(n){if(!this.cache.has(n))return;const s=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,s),s}put(n,s){this.cache.has(n)?this.cache.delete(n):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(n,s)}}function SX(i,n){if(n.length!==4)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let s=n[3];for(let c=2;c>=1;c--){const h=c===1?1:0,p=c===2?1:0;for(let m=0;m<n[0];m++){const v=n[1]*m;for(let b=h;b<n[1];b++){const E=n[2]*(b+v);for(let I=p;I<n[2];I++){const P=n[3]*(I+E);for(let M=0;M<n[3];M++){const z=P+M;i[z]+=i[z-s]}}}}s*=n[c]}return i}function IX(i){for(let n=0,s=i.length;n<s;n++)i[n]=i[n]>>>1^-(1&i[n]);return i}function AX(i,n){switch(n){case"uint32":return i;case"uint16":for(let s=0;s<i.length;s+=2){const c=i[s],h=i[s+1];i[s]=(240&c)>>4|(61440&c)>>8|(240&h)<<4|61440&h,i[s+1]=15&c|(3840&c)>>4|(15&h)<<8|(3840&h)<<4}return i;case"uint8":for(let s=0;s<i.length;s+=4){const c=i[s],h=i[s+1],p=i[s+2],m=i[s+3];i[s+0]=(192&c)>>6|(192&h)>>4|(192&p)>>2|192&m,i[s+1]=(48&c)>>4|(48&h)>>2|48&p|(48&m)<<2,i[s+2]=(12&c)>>2|12&h|(12&p)<<2|(12&m)<<4,i[s+3]=3&c|(3&h)<<2|(3&p)<<4|(3&m)<<6}return i;default:throw new Error(`Invalid pixel format, "${n}"`)}}var Xa=Uint8Array,E0=Uint16Array,CX=Int32Array,n5=new Xa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),r5=new Xa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),PX=new Xa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i5=function(i,n){for(var s=new E0(31),c=0;c<31;++c)s[c]=n+=1<<i[c-1];var h=new CX(s[30]);for(c=1;c<30;++c)for(var p=s[c];p<s[c+1];++p)h[p]=p-s[c]<<5|c;return{b:s,r:h}},s5=i5(n5,2),o5=s5.b,RX=s5.r;o5[28]=258,RX[258]=28;for(var MX=i5(r5,0).b,a5=new E0(32768),$i=0;$i<32768;++$i){var Tg=(43690&$i)>>1|(21845&$i)<<1;a5[$i]=((65280&(Tg=(61680&(Tg=(52428&Tg)>>2|(13107&Tg)<<2))>>4|(3855&Tg)<<4))>>8|(255&Tg)<<8)>>1}var S0=function(i,n,s){for(var c=i.length,h=0,p=new E0(n);h<c;++h)i[h]&&++p[i[h]-1];var m,v=new E0(n);for(h=1;h<n;++h)v[h]=v[h-1]+p[h-1]<<1;m=new E0(1<<n);var b=15-n;for(h=0;h<c;++h)if(i[h])for(var E=h<<4|i[h],I=n-i[h],P=v[i[h]-1]++<<I,M=P|(1<<I)-1;P<=M;++P)m[a5[P]>>b]=E;return m},I0=new Xa(288);for($i=0;$i<144;++$i)I0[$i]=8;for($i=144;$i<256;++$i)I0[$i]=9;for($i=256;$i<280;++$i)I0[$i]=7;for($i=280;$i<288;++$i)I0[$i]=8;var l5=new Xa(32);for($i=0;$i<32;++$i)l5[$i]=5;var kX=S0(I0,9),DX=S0(l5,5),EC=function(i){for(var n=i[0],s=1;s<i.length;++s)i[s]>n&&(n=i[s]);return n},pc=function(i,n,s){var c=n/8|0;return(i[c]|i[c+1]<<8)>>(7&n)&s},SC=function(i,n){var s=n/8|0;return(i[s]|i[s+1]<<8|i[s+2]<<16)>>(7&n)},OX=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],mc=function(i,n,s){var c=new Error(n||OX[i]);if(c.code=i,Error.captureStackTrace&&Error.captureStackTrace(c,mc),!s)throw c;return c},LX=new Xa(0),zX=typeof TextDecoder<"u"&&new TextDecoder;try{zX.decode(LX,{stream:!0})}catch{}const NX={gzip_data:"gzip"};class El extends Error{constructor(n){super(n),this.name="MRTError"}}const FX={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},c5={uint32:1,uint16:2,uint8:4},BX={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let IC,AC;class A0{constructor(n=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=n}getLayer(n){const s=this.layers[n];if(!s)throw new El(`Layer '${n}' not found`);return s}getHeaderLength(n){const s=new Uint8Array(n),c=new DataView(n);if(s[0]!==13)throw new El("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(n){const s=new Uint8Array(n),c=this.getHeaderLength(n);if(s.length<c)throw new El(`Expected header with length >= ${c} but got buffer of length ${s.length}`);const h=function(p,m){return p.readFields(gX,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new IC(s.subarray(0,c)));if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new El(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const p of h.layers)this.layers[p.name]=new UX(p,{cacheSize:this._cacheSize});return this}createDecodingTask(n){const s=[],c=this.getLayer(n.layerName);for(let h of n.blockIndices){const p=c.dataIndex[h],m=p.first_byte-n.firstByte,v=p.last_byte-n.firstByte;if(c._blocksInProgress.has(h))continue;const b={layerName:c.name,firstByte:m,lastByte:v,pixelFormat:c.pixelFormat,blockIndex:h,blockShape:[p.bands.length].concat(c.bandShape),buffer:c.buffer,codec:p.codec.codec,filters:p.filters.map(E=>E.filter)};c._blocksInProgress.add(h),s.push(b)}return new u5(s,()=>{s.forEach(h=>c._blocksInProgress.delete(h.blockIndex))},(h,p)=>{if(s.forEach(m=>c._blocksInProgress.delete(m.blockIndex)),h)throw h;p.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class UX{constructor({version:n,name:s,units:c,tilesize:h,pixel_format:p,buffer:m,data_index:v},b){if(this.version=n,this.version!==1)throw new El(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=s,this.units=c,this.tileSize=h,this.buffer=m,this.pixelFormat=FX[p],this.dataIndex=v,this.bandShape=[h+2*m,h+2*m,c5[this.pixelFormat]],this._decodedBlocks=new EX(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return c5[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:n})=>n).flat()}processDecodedData(n){const s=n.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,n.data)}getBlockForBand(n){let s=0;switch(typeof n){case"string":for(const[c,h]of this.dataIndex.entries()){for(const[p,m]of h.bands.entries())if(m===n)return{bandIndex:s+p,blockIndex:c,blockBandIndex:p};s+=h.bands.length}break;case"number":for(const[c,h]of this.dataIndex.entries()){if(n>=s&&n<s+h.bands.length)return{bandIndex:n,blockIndex:c,blockBandIndex:n-s};s+=h.bands.length}break;default:throw new El(`Invalid band \`${JSON.stringify(n)}\`. Expected string or integer.`)}throw new El(`Band not found: ${JSON.stringify(n)}`)}getDataRange(n){let s=1/0,c=-1/0;const h=[],p=new Set;for(const m of n){const{blockIndex:v}=this.getBlockForBand(m);if(v<0)throw new El(`Invalid band: ${JSON.stringify(m)}`);const b=this.dataIndex[v];h.includes(v)||h.push(v),p.add(v),s=Math.min(s,b.first_byte),c=Math.max(c,b.last_byte)}if(p.size>this.cacheSize)throw new El(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:c,blockIndices:h}}hasBand(n){const{blockIndex:s}=this.getBlockForBand(n);return s>=0}hasDataForBand(n){const{blockIndex:s}=this.getBlockForBand(n);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(n){const{blockIndex:s,blockBandIndex:c}=this.getBlockForBand(n),h=this._decodedBlocks.get(s.toString());if(!h)throw new El(`Data for band ${JSON.stringify(n)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[s],m=this.bandShape.reduce((E,I)=>E*I,1),v=c*m,b=h.subarray(v,v+m);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset!==0?p.offset:p.deprecated_offset,scale:p.scale!==0?p.scale:p.deprecated_scale}}}A0.setPbf=function(i){IC=i};class u5{constructor(n,s,c){this.tasks=n,this._onCancel=s,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(n,s){this._finalized||(this._onComplete(n,s),this._finalized=!0)}}A0.performDecoding=function(i,n){const s=new Uint8Array(i);return Promise.all(n.tasks.map(c=>{const{layerName:h,firstByte:p,lastByte:m,pixelFormat:v,blockShape:b,blockIndex:E,filters:I,codec:P}=c,M=s.subarray(p,m+1),z=new Uint32Array(b[0]*b[1]*b[2]);let F;if(P!=="gzip_data")throw new El(`Unhandled codec: ${P}`);return F=function(V,j){if(!globalThis.DecompressionStream&&j==="gzip_data")return Promise.resolve(((me=function(ze){ze[0]==31&&ze[1]==139&&ze[2]==8||mc(6,"invalid gzip data");var $e=ze[3],Xe=10;4&$e&&(Xe+=2+(ze[10]|ze[11]<<8));for(var tt=($e>>3&1)+($e>>4&1);tt>0;tt-=!ze[Xe++]);return Xe+(2&$e)}(de=V))+8>de.length&&mc(6,"invalid gzip data"),function(ze,$e,Xe,tt){var Ke=ze.length;if(!Ke||$e.f&&!$e.l)return Xe||new Xa(0);var lt=!Xe,Tt=lt||$e.i!=2,ct=$e.i;lt&&(Xe=new Xa(3*Ke));var At,ot,mt=function(Pd){var wp=Xe.length;if(Pd>wp){var N0=new Xa(Math.max(2*wp,Pd));N0.set(Xe),Xe=N0}},Ot=$e.f||0,ut=$e.p||0,Ft=$e.b||0,Dt=$e.l,Et=$e.d,gn=$e.m,cn=$e.n,Ht=8*Ke;do{if(!Dt){Ot=pc(ze,ut,1);var zt=pc(ze,ut+1,3);if(ut+=3,!zt){var In=ze[(Nn=4+((ut+7)/8|0))-4]|ze[Nn-3]<<8,dn=Nn+In;if(dn>Ke){ct&&mc(0);break}Tt&&mt(Ft+In),Xe.set(ze.subarray(Nn,dn),Ft),$e.b=Ft+=In,$e.p=ut=8*dn,$e.f=Ot;continue}if(zt==1)Dt=kX,Et=DX,gn=9,cn=5;else if(zt==2){var nn=pc(ze,ut,31)+257,On=pc(ze,ut+10,15)+4,zn=nn+pc(ze,ut+5,31)+1;ut+=14;for(var Ln=new Xa(zn),$n=new Xa(19),ur=0;ur<On;++ur)$n[PX[ur]]=pc(ze,ut+3*ur,7);ut+=3*On;var tr=EC($n),Br=(1<<tr)-1,$r=S0($n,tr);for(ur=0;ur<zn;){var Nn,Rr=$r[pc(ze,ut,Br)];if(ut+=15&Rr,(Nn=Rr>>4)<16)Ln[ur++]=Nn;else{var Dr=0,Qr=0;for(Nn==16?(Qr=3+pc(ze,ut,3),ut+=2,Dr=Ln[ur-1]):Nn==17?(Qr=3+pc(ze,ut,7),ut+=3):Nn==18&&(Qr=11+pc(ze,ut,127),ut+=7);Qr--;)Ln[ur++]=Dr}}var Pi=Ln.subarray(0,nn),Gi=Ln.subarray(nn);gn=EC(Pi),cn=EC(Gi),Dt=S0(Pi,gn),Et=S0(Gi,cn)}else mc(1);if(ut>Ht){ct&&mc(0);break}}Tt&&mt(Ft+131072);for(var Ri=(1<<gn)-1,yi=(1<<cn)-1,Ds=ut;;Ds=ut){var ns=(Dr=Dt[SC(ze,ut)&Ri])>>4;if((ut+=15&Dr)>Ht){ct&&mc(0);break}if(Dr||mc(2),ns<256)Xe[Ft++]=ns;else{if(ns==256){Ds=ut,Dt=null;break}var no=ns-254;ns>264&&(no=pc(ze,ut,(1<<(_c=n5[ur=ns-257]))-1)+o5[ur],ut+=_c);var Xr=Et[SC(ze,ut)&yi],ua=Xr>>4;if(Xr||mc(3),ut+=15&Xr,Gi=MX[ua],ua>3){var _c=r5[ua];Gi+=SC(ze,ut)&(1<<_c)-1,ut+=_c}if(ut>Ht){ct&&mc(0);break}Tt&&mt(Ft+131072);var Sl=Ft+no;if(Ft<Gi){var Il=0-Gi,bp=Math.min(Gi,Sl);for(Il+Ft<0&&mc(3);Ft<bp;++Ft)Xe[Ft]=(void 0)[Il+Ft]}for(;Ft<Sl;++Ft)Xe[Ft]=Xe[Ft-Gi]}}$e.l=Dt,$e.p=Ds,$e.b=Ft,$e.f=Ot,Dt&&(Ot=1,$e.m=gn,$e.d=Et,$e.n=cn)}while(!Ot);return Ft!=Xe.length&&lt?(At=Xe,((ot=Ft)==null||ot>At.length)&&(ot=At.length),new Xa(At.subarray(0,ot))):Xe.subarray(0,Ft)}(de.subarray(me,-8),{i:2},new Xa(((K=de)[(pe=K.length)-4]|K[pe-3]<<8|K[pe-2]<<16|K[pe-1]<<24)>>>0))));var K,pe,de,me;const Ae=NX[j];if(!Ae)throw new Error(`Unhandled codec: ${j}`);const Ce=new globalThis.DecompressionStream(Ae);return new Response(new Blob([V]).stream().pipeThrough(Ce)).arrayBuffer().then(ze=>new Uint8Array(ze))}(M,P).then(V=>(function(j,K){j.readFields(wX,K)}(new IC(V),z),new BX[v](z.buffer))),F.then(V=>{for(let j=I.length-1;j>=0;j--)switch(I[j]){case"delta_filter":SX(V,b);break;case"zigzag_filter":IX(V);break;case"bitshuffle_filter":AX(V,v);break;default:throw new El(`Unhandled filter "${I[j]}"`)}return{layerName:h,blockIndex:E,data:V}}).catch(V=>{throw V})}))},A0.setPbf(p0);class h5 extends Xb{constructor(n,s,c,h,p){super(n,s,c,h,p),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(n,s){const c=s.context,h=c.gl;this.texture=this.texture||s.getTileTexture(n.width),this.texture&&this.texture instanceof wl?this.texture.update(n,{useMipmap:!1,premultiply:!1}):this.texture=new wl(c,n,h.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,s){const c=this._mrt=new A0(30),h=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=Bu(h,(p,m,v,b)=>{if(p)s(p);else try{const E=c.getHeaderLength(m);if(E>n)return void(this.request=this.fetchHeader(E,s));c.parseHeader(m),this._isHeaderLoaded=!0;let I=0;for(const P of Object.values(c.layers))I=Math.max(I,P.dataIndex[P.dataIndex.length-1].last_byte);m.byteLength>=I&&(this.entireBuffer=m),s(null,this.entireBuffer||m,v,b)}catch(E){s(E)}}),this.request}fetchBand(n,s,c){const h=this._mrt;if(!this._isHeaderLoaded||!h)return void c(new Error("Tile header is not ready"));const p=this.actor;if(!p)return void c(new Error("Can't fetch tile band without an actor"));let m;const v=(P,M)=>{m.complete(P,M),P?c(P):(this.updateTextureDescriptor(n,s),c(null,this.textureDescriptor&&this.textureDescriptor.img))},b=(P,M)=>{if(P)return c(P);const z=p.send("decodeRasterArray",{buffer:M,task:m},v,void 0,!0);this._workQueue.push(()=>{z&&z.cancel(),m.cancel()})},E=h.getLayer(n);if(!E)return void c(new Error(`Unknown sourceLayer "${n}"`));if(E.hasDataForBand(s))return this.updateTextureDescriptor(n,s),void c(null,this.textureDescriptor?this.textureDescriptor.img:null);const I=E.getDataRange([s]);if(m=h.createDecodingTask(I),!m||m.tasks.length)if(this.flushQueues(),this.entireBuffer)b(null,this.entireBuffer.slice(I.firstByte,I.lastByte+1));else{const P=Object.assign({},this.requestParams,{headers:{Range:`bytes=${I.firstByte}-${I.lastByte}`}}),M=Bu(P,b);this._fetchQueue.push(()=>{M.cancel(),m.cancel()})}else c(null)}updateNeeded(n,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,s){if(!this._mrt)return;const c=this._mrt.getLayer(n);if(!c||!c.hasBand(s)||!c.hasDataForBand(s))return;const{bytes:h,tileSize:p,buffer:m,offset:v,scale:b}=c.getBandView(s),E=p+2*m,I={data:h,width:E,height:E},P=this.texture;P&&P instanceof wl&&P.update(I,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:n,band:s,img:I,buffer:m,offset:v,tileSize:p,format:c.pixelFormat,mix:[b,256*b,65536*b,16777216*b]}}}class VX{constructor(n,s){this.max=n,this.onRemove=s,this.reset()}reset(){for(const n in this.data)for(const s of this.data[n])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(n,s,c){const h=n.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const p={value:s,timeout:void 0};if(c!==void 0&&(p.timeout=setTimeout(()=>{this.remove(n,p)},c)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const s=this.data[n].shift();return s.timeout&&clearTimeout(s.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),s.value}getByKey(n){const s=this.data[n];return s?s[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,s){if(!this.has(n))return this;const c=n.wrapped().key,h=s===void 0?0:this.data[c].indexOf(s),p=this.data[c][h];return this.data[c].splice(h,1),p.timeout&&clearTimeout(p.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(p.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(n){const s=[];for(const c in this.data)for(const h of this.data[c])n(h.value)||s.push(h);for(const c of s)this.remove(c.value.tileID,c)}}class _p extends $u{constructor(n,s,c){super(),this.id=n,this._onlySymbols=c,s.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new VX(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new FZ,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const s=this._tiles[n];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,s){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,s)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const c=this._tiles[s];c.upload(n),c.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Xl(this._tiles).map(n=>n.tileID).sort(d5).map(n=>n.key)}getRenderableIds(n,s){const c=[];for(const h in this._tiles)this._isIdRenderable(+h,n,s)&&c.push(this._tiles[h]);return n?c.sort((h,p)=>{const m=h.tileID,v=p.tileID,b=new Nt(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),E=new Nt(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-v.overscaledZ||E.y-b.y||E.x-b.x}).map(h=>h.tileID.key):c.map(h=>h.tileID).sort(d5).map(h=>h.key)}hasRenderableParent(n){const s=this.findLoadedParent(n,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(n,s,c){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(s||!this._tiles[n].holdingForFade())&&(c||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,s){const c=this._tiles[n];c&&(c.state!=="loading"&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,n,s)))}_tileLoaded(n,s,c,h){if(h)if(n.state="errored",h.status!==404)this._source.fire(new Bf(h,{tile:n}));else{if(this._source.fire(new _l("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=Qt.now(),c==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(s,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new _l("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const s=this.getRenderableIds();for(let h=0;h<s.length;h++){const p=s[h];if(n.neighboringTiles&&n.neighboringTiles[p]){const m=this.getTileByID(p);c(n,m),c(m,n)}}function c(h,p){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let m=p.tileID.canonical.x-h.tileID.canonical.x;const v=p.tileID.canonical.y-h.tileID.canonical.y,b=Math.pow(2,h.tileID.canonical.z),E=p.tileID.key;m===0&&v===0||Math.abs(v)>1||(Math.abs(m)>1&&(Math.abs(m+b)===1?m+=b:Math.abs(m-b)===1&&(m-=b)),p.dem&&h.dem&&(h.dem.backfillBorder(p.dem,m,v),h.neighboringTiles&&h.neighboringTiles[E]&&(h.neighboringTiles[E].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,s,c,h){for(const p in this._tiles){let m=this._tiles[p];if(h[p]||!m.hasData()||m.tileID.overscaledZ<=s||m.tileID.overscaledZ>c)continue;let v=m.tileID;for(;m&&m.tileID.overscaledZ>s+1;){const E=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[E.key],m&&m.hasData()&&(v=E)}let b=v;for(;b.overscaledZ>s;)if(b=b.scaledTo(b.overscaledZ-1),n[b.key]){h[v.key]=v;break}}}findLoadedParent(n,s){if(n.key in this._loadedParentTiles){const c=this._loadedParentTiles[n.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=n.overscaledZ-1;c>=s;c--){const h=n.scaledTo(c),p=this._getLoadedTile(h);if(p)return p}}_getLoadedTile(n){const s=this._tiles[n.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,s){s=s||this._source.tileSize;const c=Math.ceil(n.width/s)+1,h=Math.ceil(n.height/s)+1,p=Math.floor(c*h*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(n){const s=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,s){const c={};for(const h in this._tiles){const p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),c[p.tileID.key]=p}this._tiles=c;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(n,s,c,h){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;this.updateCacheSize(n,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const p=this._source.type==="batched-model";let m;if(this.used||this.usedForTerrain){if(this._source.tileID)m=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(E=>new ds(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y));else if(this.tileCoverLift!==0){const E=n.clone();E.tileCoverLift=this.tileCoverLift,m=E.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:p}),this._source.minzoom<=1&&n.projection.name==="globe"&&(m.push(new ds(1,0,1,0,0)),m.push(new ds(1,0,1,1,0)),m.push(new ds(1,0,1,0,1)),m.push(new ds(1,0,1,1,1)))}else if(m=n.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:p}),this._source.hasTile){const E=this._source.hasTile.bind(this._source);m=m.filter(I=>E(I))}}else m=[];if(m.length>0&&this.castsShadows&&h&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!CC(this._source.type)){const E=n.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!c}),I=Math.min(E,this._source.maxzoom);if(p){const P=n.extendTileCover(m,I);for(const M of P)m.push(M)}else{const P=n.extendTileCover(m,I,h);for(const M of P)this._shadowCasterTiles[M.key]=!0,m.push(M)}}const v=this._updateRetainedTiles(m);if(CC(this._source.type)&&m.length!==0){const E={},I={},P=Object.keys(v);for(const z of P){const F=v[z],V=this._tiles[z];if(!V||V.fadeEndTime&&V.fadeEndTime<=Qt.now())continue;const j=this.findLoadedParent(F,Math.max(F.overscaledZ-_p.maxOverzooming,this._source.minzoom));j&&(this._addTile(j.tileID),E[j.tileID.key]=j.tileID),I[z]=F}const M=m[m.length-1].overscaledZ;for(const z in this._tiles){const F=this._tiles[z];if(v[z]||!F.hasData())continue;let V=F.tileID;for(;V.overscaledZ>M;){V=V.scaledTo(V.overscaledZ-1);const j=this._tiles[V.key];if(j&&j.hasData()&&I[V.key]){v[z]=F.tileID;break}}}for(const z in E)v[z]||(this._coveredTiles[z]=!0,v[z]=E[z])}for(const E in v)this._tiles[E].clearFadeHold();const b=function(E,I){const P=[];for(const M in E)M in I||P.push(M);return P}(this._tiles,v);for(const E of b){const I=this._tiles[E];I.hasSymbolBuckets&&!I.holdingForFade()?I.setHoldDuration(this.map._fadeDuration):I.hasSymbolBuckets&&!I.symbolFadeFinished()||this._removeTile(+E)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const s={};if(n.length===0)return s;const c={},h=n.reduce((E,I)=>Math.min(E,I.overscaledZ),1/0),p=n[0].overscaledZ,m=Math.max(p-_p.maxOverzooming,this._source.minzoom),v=Math.max(p+_p.maxUnderzooming,this._source.minzoom),b={};for(const E of n){const I=this._addTile(E);s[E.key]=E,I.hasData()||h<this._source.maxzoom&&(b[E.key]=E)}this._retainLoadedChildren(b,h,v,s);for(const E of n){let I=this._tiles[E.key];if(I.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const M=E.children(this._source.maxzoom)[0],z=this.getTile(M);if(z&&z.hasData()){s[M.key]=M;continue}}else{const M=E.children(this._source.maxzoom);if(s[M[0].key]&&s[M[1].key]&&s[M[2].key]&&s[M[3].key])continue}let P=I.wasRequested();for(let M=E.overscaledZ-1;M>=m;--M){const z=E.scaledTo(M);if(c[z.key]||(c[z.key]=!0,I=this.getTile(z),!I&&P&&(I=this._addTile(z)),I&&(s[z.key]=z,P=I.wasRequested(),I.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const s=[];let c,h=this._tiles[n].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){c=this._loadedParentTiles[h.key];break}s.push(h.key);const p=h.scaledTo(h.overscaledZ-1);if(c=this._getLoadedTile(p),c)break;h=p}for(const p of s)this._loadedParentTiles[p]=c}}_addTile(n){let s=this._tiles[n.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),s;s=this._cache.getAndRemove(n),s&&(this._setTileReloadTimer(n.key,s),s.tileID=n,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,s)));const c=!!s;if(!c){const h=this.map?this.map.painter:null,p=this._source.tileSize*n.overscaleFactor();s=this._source.type==="raster-array"?new h5(n,p,this.transform.tileZoom,h,this._isRaster):new Xb(n,p,this.transform.tileZoom,h,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,n.key,s.state))}return s?(s.uses++,this._tiles[n.key]=s,c||this._source.fire(new _l("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(n,s){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const c=s.getExpiryTimeout();c&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},c))}_removeTile(n){const s=this._tiles[n];s&&(s.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,s,c){const h=[],p=this.transform;if(!p)return h;const m=p.projection.name==="globe",v=Kc(p.center.lng);for(const b in this._tiles){const E=this._tiles[b];if(c&&E.clearQueryDebugViz(),E.holdingForFade())continue;let I;if(m){const P=E.tileID.canonical;if(P.z===0){const M=[Math.abs(Gn(v,...C0(P,-1))-v),Math.abs(Gn(v,...C0(P,1))-v)];I=[0,2*M.indexOf(Math.min(...M))-1]}else{const M=[Math.abs(Gn(v,...C0(P,-1))-v),Math.abs(Gn(v,...C0(P,0))-v),Math.abs(Gn(v,...C0(P,1))-v)];I=[M.indexOf(Math.min(...M))-1]}}else I=[0];for(const P of I){const M=n.containsTile(E,p,s,P);M&&h.push(M)}}return h}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,s){const c=this.getRenderableIds(n,s).map(p=>this._tiles[p].tileID),h=this.transform.projection.name==="globe";for(const p of c)p.projMatrix=this.transform.calculateProjMatrix(p.toUnwrapped()),p.expandedProjMatrix=h?this.transform.calculateProjMatrix(p.toUnwrapped(),!1,!0):p.projMatrix;return c}sortCoordinatesByDistance(n){const s=n.slice(),c=this.transform._camera.position,h=this.transform._camera.forward(),p={};for(const m of s){const v=1/(1<<m.canonical.z);p[m.key]=((m.canonical.x+.5)*v+m.wrap-c[0])*h[0]+((m.canonical.y+.5)*v-c[1])*h[1]-c[2]*h[2]}return s.sort((m,v)=>p[m.key]-p[v.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(CC(this._source.type))for(const n in this._tiles){const s=this._tiles[n];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=Qt.now())return!0}return!1}setFeatureState(n,s,c){this._state.updateState(n=n||"_geojsonTileLayer",s,c)}removeFeatureState(n,s,c){this._state.removeFeatureState(n=n||"_geojsonTileLayer",s,c)}getFeatureState(n,s){return this._state.getState(n=n||"_geojsonTileLayer",s)}setDependencies(n,s,c){const h=this._tiles[n];h&&h.setDependencies(s,c)}reloadTilesForDependencies(n,s){for(const c in this._tiles)this._tiles[c].hasDependency(n,s)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(n,s))}_preloadTiles(n,s){if(!this._sourceLoaded){const v=()=>{this._sourceLoaded&&(this._source.off("data",v),this._preloadTiles(n,s))};return void this._source.on("data",v)}const c=new Map,h=Array.isArray(n)?n:[n],p=this.map.painter.terrain,m=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const v of h){const b=v.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of b)c.set(E.key,E);this.usedForTerrain&&v.updateElevation(!1)}Nu(Array.from(c.values()),(v,b)=>{const E=new Xb(v,this._source.tileSize*v.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,I=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),b(I,E)})},s)}}function d5(i,n){const s=Math.abs(2*i.wrap)-+(i.wrap<0),c=Math.abs(2*n.wrap)-+(n.wrap<0);return i.overscaledZ-n.overscaledZ||c-s||n.canonical.y-i.canonical.y||n.canonical.x-i.canonical.x}function CC(i){return i==="raster"||i==="image"||i==="video"||i==="custom"}function C0(i,n){const s=1<<i.z;return[i.x/s+n,(i.x+1)/s+n]}_p.maxOverzooming=10,_p.maxUnderzooming=3;const f5=()=>AC||(AC={layout:cz||(cz=new jr({"line-cap":new sn(Qe.layout_line["line-cap"]),"line-join":new sn(Qe.layout_line["line-join"]),"line-miter-limit":new It(Qe.layout_line["line-miter-limit"]),"line-round-limit":new It(Qe.layout_line["line-round-limit"]),"line-sort-key":new sn(Qe.layout_line["line-sort-key"]),"line-z-offset":new sn(Qe.layout_line["line-z-offset"]),visibility:new It(Qe.layout_line.visibility)})),paint:uz||(uz=new jr({"line-opacity":new sn(Qe.paint_line["line-opacity"]),"line-color":new sn(Qe.paint_line["line-color"]),"line-translate":new It(Qe.paint_line["line-translate"]),"line-translate-anchor":new It(Qe.paint_line["line-translate-anchor"]),"line-width":new sn(Qe.paint_line["line-width"]),"line-gap-width":new sn(Qe.paint_line["line-gap-width"]),"line-offset":new sn(Qe.paint_line["line-offset"]),"line-blur":new sn(Qe.paint_line["line-blur"]),"line-dasharray":new sn(Qe.paint_line["line-dasharray"]),"line-pattern":new sn(Qe.paint_line["line-pattern"]),"line-gradient":new ho(Qe.paint_line["line-gradient"]),"line-trim-offset":new It(Qe.paint_line["line-trim-offset"]),"line-trim-fade-range":new It(Qe.paint_line["line-trim-fade-range"]),"line-trim-color":new It(Qe.paint_line["line-trim-color"]),"line-emissive-strength":new It(Qe.paint_line["line-emissive-strength"]),"line-border-width":new sn(Qe.paint_line["line-border-width"]),"line-border-color":new sn(Qe.paint_line["line-border-color"]),"line-occlusion-opacity":new It(Qe.paint_line["line-occlusion-opacity"])}))},AC);class jX extends sn{possiblyEvaluate(n,s){return s=new An(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition}),super.possiblyEvaluate(n,s)}evaluate(n,s,c,h){return s=ws({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(n,s,c,h)}}let P0,p5,m5,PC;function g5(i,n){return n>0?n+2*i:i}class _5{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:ea,this.defaultValue=n}evaluate(n){if(n.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(n.formattedSection))return s.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}je(_5,"FormatSectionOverride",{omit:["defaultValue"]});const RC=()=>PC||(PC={layout:p5||(p5=new jr({"symbol-placement":new It(Qe.layout_symbol["symbol-placement"]),"symbol-spacing":new It(Qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new It(Qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new sn(Qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new It(Qe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new It(Qe.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new It(Qe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new It(Qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new It(Qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new It(Qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new sn(Qe.layout_symbol["icon-size"]),"icon-text-fit":new sn(Qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new sn(Qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new sn(Qe.layout_symbol["icon-image"]),"icon-rotate":new sn(Qe.layout_symbol["icon-rotate"]),"icon-padding":new It(Qe.layout_symbol["icon-padding"]),"icon-keep-upright":new It(Qe.layout_symbol["icon-keep-upright"]),"icon-offset":new sn(Qe.layout_symbol["icon-offset"]),"icon-anchor":new sn(Qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new It(Qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new It(Qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new It(Qe.layout_symbol["text-rotation-alignment"]),"text-field":new sn(Qe.layout_symbol["text-field"]),"text-font":new sn(Qe.layout_symbol["text-font"]),"text-size":new sn(Qe.layout_symbol["text-size"]),"text-max-width":new sn(Qe.layout_symbol["text-max-width"]),"text-line-height":new sn(Qe.layout_symbol["text-line-height"]),"text-letter-spacing":new sn(Qe.layout_symbol["text-letter-spacing"]),"text-justify":new sn(Qe.layout_symbol["text-justify"]),"text-radial-offset":new sn(Qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new It(Qe.layout_symbol["text-variable-anchor"]),"text-anchor":new sn(Qe.layout_symbol["text-anchor"]),"text-max-angle":new It(Qe.layout_symbol["text-max-angle"]),"text-writing-mode":new It(Qe.layout_symbol["text-writing-mode"]),"text-rotate":new sn(Qe.layout_symbol["text-rotate"]),"text-padding":new It(Qe.layout_symbol["text-padding"]),"text-keep-upright":new It(Qe.layout_symbol["text-keep-upright"]),"text-transform":new sn(Qe.layout_symbol["text-transform"]),"text-offset":new sn(Qe.layout_symbol["text-offset"]),"text-allow-overlap":new It(Qe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new It(Qe.layout_symbol["text-ignore-placement"]),"text-optional":new It(Qe.layout_symbol["text-optional"]),visibility:new It(Qe.layout_symbol.visibility)})),paint:m5||(m5=new jr({"icon-opacity":new sn(Qe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new sn(Qe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new sn(Qe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new sn(Qe.paint_symbol["text-emissive-strength"]),"icon-color":new sn(Qe.paint_symbol["icon-color"]),"icon-halo-color":new sn(Qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new sn(Qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new sn(Qe.paint_symbol["icon-halo-blur"]),"icon-translate":new It(Qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new It(Qe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new sn(Qe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new sn(Qe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new sn(Qe.paint_symbol["text-occlusion-opacity"]),"text-color":new sn(Qe.paint_symbol["text-color"],{runtimeType:ba,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new sn(Qe.paint_symbol["text-halo-color"]),"text-halo-width":new sn(Qe.paint_symbol["text-halo-width"]),"text-halo-blur":new sn(Qe.paint_symbol["text-halo-blur"]),"text-translate":new It(Qe.paint_symbol["text-translate"]),"text-translate-anchor":new It(Qe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new It(Qe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new It(Qe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new It(Qe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new It(Qe.paint_symbol["icon-color-brightness-max"])}))},PC);class Kb extends la{constructor(n,s,c,h){super(n,RC(),s,c,h),this._colorAdjustmentMatrix=a.ae.identity([]),this.hasInitialOcclusionOpacityProperties=n.paint!==void 0&&("icon-occlusion-opacity"in n.paint||"text-occlusion-opacity"in n.paint)}recalculate(n,s){super.recalculate(n,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const h=[];for(const p of c)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(n,s,c,h){return this._saturation===n&&this._contrast===s&&this._brightnessMin===c&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(p,m,v,b){p=ht(p),m=ke(m);const E=a.ae.create(),I=p/3,P=1-2*I,M=[P,I,I,0,I,P,I,0,I,I,P,0,0,0,0,1],z=.5-.5*m,F=b-v;return a.ae.multiply(E,[F,0,0,0,0,F,0,0,0,0,F,0,v,v,v,1],[m,0,0,0,0,m,0,0,0,0,m,0,z,z,z,1]),a.ae.multiply(E,E,M),E}(n,s,c,h),this._saturation=n,this._contrast=s,this._brightnessMin=c,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(n,s,c,h){const p=this.layout.get(n).evaluate(s,{},c,h),m=this._unevaluatedLayout._values[n];return m.isDataDriven()||xe(m.value)||!p?p:function(v,b){return b.replace(/{([^{}]+)}/g,(E,I)=>I in v?String(v[I]):"")}(s.properties,p)}createBucket(n){return new bg(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of RC().paint.overridableProperties){if(!Kb.hasPaintOverride(this.layout,n))continue;const s=this.paint.get(n),c=new _5(s),h=new ve(c,s.property.specification,this.scope,this.options);let p=null;p=s.value.kind==="constant"||s.value.kind==="source"?new Me("source",h):new Se("composite",h,s.value.zoomStops,s.value._interpolationType),this.paint._values[n]=new Ms(s.property,p,s.parameters)}}_handleOverridablePaintPropertyUpdate(n,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&Kb.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,s){const c=n.get("text-field"),h=RC().paint.properties[s];let p=!1;const m=v=>{for(const b of v)if(h.overrides&&h.overrides.hasOverride(b))return void(p=!0)};if(c.value.kind==="constant"&&c.value.value instanceof uo)m(c.value.value.sections);else if(c.value.kind==="source"){const v=E=>{p||(E instanceof qa&&ts(E.value)===rd?m(E.value.sections):E instanceof qu?m(E.sections):E.eachChild(v))},b=c.value;b._styleExpression&&v(b._styleExpression.expression)}return p}getProgramIds(){const n=this.paint.get("icon-opacity").constantOr(1)!==0,s=this.paint.get("text-opacity").constantOr(1)!==0,c=[];return n&&c.push("symbolIcon"),s&&c.push("symbolSDF"),c}getDefaultProgramParams(n,s,c){return{config:new cp(this,{zoom:s,lut:c}),overrideFog:!1}}}let y5,v5,x5,b5;function Yb(i,n,s,c,h,p,m,v){const b=[i,n,1,s,c,1,h,p,1],E=[m,v,1],I=a.bE.adjoint([],b),[P,M,z]=a.$.transformMat3(E,E,I);return a.bE.multiply(b,b,[P,0,0,0,M,0,0,0,z])}function w5(i,n,s,c,h,p,m,v){const b=function(E,I,P,M,z,F,V,j){const K=Yb(0,0,1,0,1,1,0,1),pe=Yb(E,I,P,M,z,F,V,j),de=a.bE.adjoint([],K);return a.bE.multiply(pe,pe,de)}(i,n,s,c,h,p,m,v);return[b[2]/b[8]/Lt,b[5]/b[8]/Lt]}function Qb(i){return[i[0],Math.min(Math.max(i[1],-Ui),Ui)]}class T5 extends $u{constructor(n,s,c,h){super(),this.id=n,this.dispatcher=c,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=s,this._dirty=!1}load(n,s){if(this._loaded=s||!1,this.fire(new _l("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=Lf(this.map._requestManager.transformRequest(this.url,Df.Image),(c,h)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new Bf(c)):h&&(this.image=h instanceof HTMLImageElement?Qt.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Wb(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new _l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(n){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Wb||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=n[0][1],c=n[0][1];for(const p of n)p[1]>c&&(c=p[1]),p[1]<s&&(s=p[1]);const h=(c+s)/2;if(h>Ui?this.onNorthPole=!0:h<-Ui&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=n.map(fo.fromLngLat);this.tileID=function(m){let v=1/0,b=1/0,E=-1/0,I=-1/0;for(const V of m)v=Math.min(v,V.x),b=Math.min(b,V.y),E=Math.max(E,V.x),I=Math.max(I,V.y);const P=Math.max(E-v,I-b),M=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),z=Math.pow(2,M);let F=Math.floor((v+E)/2*z);return F>1&&(F-=1),new hp(M,F,Math.floor((b+I)/2*z))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new _l("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(const j in this.tiles){const K=this.tiles[j];K.state!=="loaded"&&(K.state="loaded",K.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const s=mp(new hp(0,0,0),this.map.transform.projection),c=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(j){const K=j[1].x-j[0].x,pe=j[1].y-j[0].y,de=j[2].x-j[1].x,me=j[2].y-j[1].y,Ae=j[3].x-j[2].x,Ce=j[3].y-j[2].y,ze=j[0].x-j[3].x,$e=j[0].y-j[3].y,Xe=K*me-de*pe,tt=de*Ce-Ae*me,Ke=Ae*$e-ze*Ce,lt=ze*pe-K*$e;return Xe>0&&tt>0&&Ke>0&&lt>0||Xe<0&&tt<0&&Ke<0&&lt<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=mp(this.tileID,this.map.transform.projection),[p,m,v,b]=this.coordinates.map(j=>{const K=h.projection.project(j[0],j[1]);return Zz(h,K)._round()});this.perspectiveTransform=w5(p.x,p.y,m.x,m.y,v.x,v.y,b.x,b.y);const E=this._boundsArray=new Yu;E.emplaceBack(p.x,p.y,0,0),E.emplaceBack(m.x,m.y,Lt,0),E.emplaceBack(b.x,b.y,0,Lt),E.emplaceBack(v.x,v.y,Lt,Lt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(E,Zb.members),this.boundsSegments=pi.simpleSegment(0,0,4,2);const I=[],P=function(j){return[Qb(j[0]),Qb(j[1]),Qb(j[2]),Qb(j[3])]}(this.coordinates),[M,z,F,V]=function(j){let K=j[0][0],pe=K,de=j[0][1],me=de;for(let Ae=1;Ae<j.length;Ae++)j[Ae][0]<K?K=j[Ae][0]:j[Ae][0]>pe&&(pe=j[Ae][0]),j[Ae][1]<de?de=j[Ae][1]:j[Ae][1]>me&&(me=j[Ae][1]);return[K,de,pe-K,me-de]}(P);{const j=new Yu,[K,pe,de,me]=function(ot){let mt=ot[0].x,Ot=mt,ut=ot[0].y,Ft=ut;for(let Dt=1;Dt<ot.length;Dt++)ot[Dt].x<mt?mt=ot[Dt].x:ot[Dt].x>Ot&&(Ot=ot[Dt].x),ot[Dt].y<ut?ut=ot[Dt].y:ot[Dt].y>Ft&&(Ft=ot[Dt].y);return[mt,ut,Ot-mt,Ft-ut]}(c),Ae=ot=>[(ot.x-K)/de,(ot.y-pe)/me],[Ce,ze,$e,Xe]=c.map(Ae),tt=function(ot,mt,Ot,ut,Ft,Dt,Et,gn){const cn=Yb(0,0,1,0,1,1,0,1),Ht=Yb(ot,mt,Ot,ut,Ft,Dt,Et,gn),zt=a.bE.adjoint([],Ht);return a.bE.multiply(cn,cn,zt)}(Ce[0],Ce[1],ze[0],ze[1],$e[0],$e[1],Xe[0],Xe[1]);this.elevatedGlobePerspectiveTransform=w5(Ce[0],Ce[1],ze[0],ze[1],$e[0],$e[1],Xe[0],Xe[1]);const Ke=(ot,mt)=>{I.push(ot.lng);const Ot=Math.round((ot.lng-M)/F*Lt),ut=Math.round((ot.lat-z)/V*Lt),Ft=Ae(mt),Dt=a.$.transformMat3([],[Ft[0],Ft[1],1],tt),Et=Math.round(Dt[0]/Dt[2]*Lt),gn=Math.round(Dt[1]/Dt[2]*Lt);j.emplaceBack(Ot,ut,Et,gn)},lt=c[3].x-c[0].x,Tt=c[3].y-c[0].y,ct=c[2].x-c[1].x,At=c[2].y-c[1].y;for(let ot=0;ot<65;ot++){const mt=ot/64,Ot=[c[0].x+mt*lt,c[0].y+mt*Tt],ut=[c[1].x+mt*ct,c[1].y+mt*At],Ft=ut[0]-Ot[0],Dt=ut[1]-Ot[1];for(let Et=0;Et<65;Et++){const gn=Et/64,cn={x:Ot[0]+Ft*gn,y:Ot[1]+Dt*gn,z:0};Ke(s.projection.unproject(cn.x,cn.y),cn)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer(j,Zb.members)}{this.maxLongitudeTriangleSize=0;let j=[],K=new ks;const pe=(de,me,Ae)=>{K.emplaceBack(de,me,Ae);const Ce=I[de],ze=I[me],$e=I[Ae],Xe=Math.min(Math.min(Ce,ze),$e),tt=Math.max(Math.max(Ce,ze),$e)-Xe;tt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=tt),j.push(Xe+tt/2)};for(let de=0;de<64;de++)for(let me=0;me<64;me++){const Ae=65*de+me,Ce=Ae+1,ze=Ae+65,$e=ze+1;pe(Ae,ze,Ce),pe(Ce,ze,$e)}[j,K]=function(de,me){const Ae=Array.from({length:de.length},($e,Xe)=>Xe);Ae.sort(($e,Xe)=>de[$e]-de[Xe]);const Ce=[],ze=new ks;for(let $e=0;$e<Ae.length;$e++){const Xe=Ae[$e];Ce.push(de[Xe]);const tt=3*Xe,Ke=tt+1;ze.emplaceBack(me.uint16[tt],me.uint16[Ke],me.uint16[Ke+1])}return[Ce,ze]}(j,K),this.elevatedGlobeTrianglesCenterLongitudes=j,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(K)}this.elevatedGlobeSegments=pi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,F/Lt,0,V/Lt,0,0,z,M,0])}prepare(){const n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;const s=this.map.painter.context,c=s.gl;!this._dirty||this.texture instanceof Wb||(this.texture?this.texture.update(this.image):(this.texture=new wl(s,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(s)}loadTile(n,s){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},s(null)):(n.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){const s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let h=(p=n+180)+360*Math.round((c[0]-p)/360);var p;const m=new pi,v=(P,M)=>{m.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:s.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-h)<=b){const P=le(c,0,c.length,h+b);return P===c.length||v(P,X(c,P+1,c.length,h+360-b)-P),m}h<c[0]&&(h+=360);const E=X(c,0,c.length,h-b);if(E===c.length)return v(0,c.length),m;v(0,E-0);const I=le(c,E+1,c.length,h+b);return I!==c.length&&v(I,c.length-I),m}}const $X=(Math.pow(256,2)-1)/16907520;class E5 extends la{constructor(n,s,c,h){super(n,{layout:x5||(x5=new jr({visibility:new It(Qe.layout_raster.visibility)})),paint:b5||(b5=new jr({"raster-opacity":new It(Qe.paint_raster["raster-opacity"]),"raster-color":new ho(Qe.paint_raster["raster-color"]),"raster-color-mix":new It(Qe.paint_raster["raster-color-mix"]),"raster-color-range":new It(Qe.paint_raster["raster-color-range"]),"raster-hue-rotate":new It(Qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new It(Qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new It(Qe.paint_raster["raster-brightness-max"]),"raster-saturation":new It(Qe.paint_raster["raster-saturation"]),"raster-contrast":new It(Qe.paint_raster["raster-contrast"]),"raster-resampling":new It(Qe.paint_raster["raster-resampling"]),"raster-fade-duration":new It(Qe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new It(Qe.paint_raster["raster-emissive-strength"]),"raster-array-band":new It(Qe.paint_raster["raster-array-band"]),"raster-elevation":new It(Qe.paint_raster["raster-elevation"])}))},s,c,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(n){return!(n&&n._source instanceof T5&&(n._source.onNorthPole||n._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(n){n!=="raster-color"&&n!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(n){if(!this.hasColorMap()||!this._curRampRange)return;const s=this._transitionablePaint._values["raster-color"].value.expression,[c,h]=n||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(h)||c===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=s0({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,h])}}let S5,I5,A5,C5,P5;class R5 extends la{constructor(n,s,c,h){super(n,{layout:S5||(S5=new jr({visibility:new It(Qe["layout_raster-particle"].visibility)})),paint:I5||(I5=new jr({"raster-particle-array-band":new It(Qe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new It(Qe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ho(Qe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new It(Qe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new It(Qe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new It(Qe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new It(Qe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new It(Qe["paint_raster-particle"]["raster-particle-elevation"])}))},s,c,h),this._updateColorRamp(),this.lastInvalidatedAt=Qt.now()}onRemove(n){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(n){return!1}_handleSpecialPaintPropertyUpdate(n){n!=="raster-particle-color"&&n!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),n==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=s0({expression:n,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Qt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class GX extends la{constructor(n,s){super(n,{},s,null),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}function MC(i,n,s){const c=[0,0,1],h=a.aw.identity([]);return a.aw.rotateY(h,h,s?-Qn(i)+Math.PI:Qn(i)),a.aw.rotateX(h,h,-Qn(n)),a.$.transformQuat(c,c,h),a.$.normalize(c,c)}function M5(i,n){const s=Jb(i.projection,i.zoom,i.width,i.height),c=function(p,m,v,b,E){const I=new yr(v.lng-180*Cd,v.lat),P=new yr(v.lng+180*Cd,v.lat),M=p.project(I.lng,I.lat),z=p.project(P.lng,P.lat),F=-Math.atan2(z.y-M.y,z.x-M.x),V=fo.fromLngLat(v);V.y=Gn(V.y,-1+Cd,1-Cd);const j=V.toLngLat(),K=p.project(j.lng,j.lat),pe=fo.fromLngLat(j);pe.x+=Cd;const de=pe.toLngLat(),me=p.project(de.lng,de.lat),Ae=O5(me.x-K.x,me.y-K.y,F),Ce=fo.fromLngLat(j);Ce.y+=Cd;const ze=Ce.toLngLat(),$e=p.project(ze.lng,ze.lat),Xe=O5($e.x-K.x,$e.y-K.y,F),tt=Math.abs(Ae.x)/Math.abs(Xe.y),Ke=a.ae.identity([]);a.ae.rotateZ(Ke,Ke,-F*(1-(E?0:b)));const lt=a.ae.identity([]);return a.ae.scale(lt,lt,[1,1-(1-tt)*b,1]),lt[4]=-Xe.x/Xe.y*b,a.ae.rotateZ(lt,lt,F),a.ae.multiply(lt,Ke,lt),lt}(i.projection,0,i.center,s,n),h=k5(i);return a.ae.scale(c,c,[h,h,1]),c}function k5(i){const n=i.projection,s=Jb(i.projection,i.zoom,i.width,i.height),c=D5(n,i.center),h=D5(n,yr.convert(n.center));return Math.pow(2,c*s+(1-s)*h)}function Jb(i,n,s,c,h=1/0){const p=i.range;if(!p)return 0;const m=Math.min(h,Math.max(s,c)),v=Math.log(m/1024)/Math.LN2;return Qo(p[0]+v,p[1]+v,n)}const Cd=1/4e4;function D5(i,n){const s=Gn(n.lat,-Ui,Ui),c=new yr(n.lng-180*Cd,s),h=new yr(n.lng+180*Cd,s),p=i.project(c.lng,s),m=i.project(h.lng,s),v=fo.fromLngLat(c),b=fo.fromLngLat(h),E=m.x-p.x,I=m.y-p.y,P=b.x-v.x,M=b.y-v.y,z=Math.sqrt((P*P+M*M)/(E*E+I*I));return Math.log(z)/Math.LN2}function O5(i,n,s){const c=Math.cos(s),h=Math.sin(s);return{x:i*c-n*h,y:i*h+n*c}}function L5(i,n,s){a.ae.identity(i),a.ae.rotateZ(i,i,Qn(n[2])),a.ae.rotateX(i,i,Qn(n[0])),a.ae.rotateY(i,i,Qn(n[1])),a.ae.scale(i,i,s),a.ae.multiply(i,i,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function ew(i,n,s,c,h,p,m,v){const b=[s[0]-n[0],s[1]-n[1],0],E=[c[0]-n[0],c[1]-n[1],0];if(a.$.length(b)<1e-12||a.$.length(E)<1e-12)return a.aw.identity(i);const I=a.$.cross([],b,E);a.$.normalize(I,I),a.$.subtract(E,c,n),b[2]=(p-h)*v,E[2]=(m-h)*v;const P=b;return a.$.cross(P,b,E),a.$.normalize(P,P),a.aw.rotationTo(i,I,P)}function kC(i,n,s=!1){const c=rh(n.zoom),h=function(p,m,v){const b=m.worldSize,E=[p[12],p[13],p[14]],I=Vs(E[1]/b),P=ca(E[0]/b),M=a.ae.identity([]),z=No(1,I)*b,F=No(1,0)*b*dp(I,m.zoom),V=1/KA(b);let j=F*V;if(v){const me=Jb(m.projection,m.zoom,m.width,m.height,1024);j=V*m.projection.pixelSpaceConversion(m.center.lat,b,me)}const K=up(I,P);a.$.add(K,K,a.$.scale([],a.$.normalize([],K),z*j*E[2]));const pe=function(me){const Ae=[me[0],me[1],me[2]];let Ce=[0,1,0];const ze=a.$.cross([],Ce,Ae);return a.$.cross(Ce,Ae,ze),a.$.squaredLength(Ce)===0&&(Ce=[0,1,0],a.$.cross(ze,Ae,Ce)),a.$.normalize(ze,ze),a.$.normalize(Ce,Ce),a.$.normalize(Ae,Ae),[ze[0],ze[1],ze[2],0,Ce[0],Ce[1],Ce[2],0,Ae[0],Ae[1],Ae[2],0,me[0],me[1],me[2],1]}(K);a.ae.scale(M,M,[j,j,j*z]),a.ae.translate(M,M,[-E[0],-E[1],-E[2]]);const de=a.ae.multiply([],m.globeMatrix,pe);return a.ae.multiply(de,de,M),a.ae.multiply(de,de,p),de}(i,n,s);if(c>0){const p=function(m,v){const b=v.worldSize,E=No(1,0)*b*dp(v.center.lat,v.zoom)/KA(b),I=No(1,v.center.lat)*b,P=a.ae.identity([]);return a.ae.rotateY(P,P,Qn(v.center.lng)),a.ae.rotateX(P,P,Qn(v.center.lat)),a.ae.translate(P,P,[0,0,zo]),a.ae.scale(P,P,[E,E,E*I]),a.ae.translate(P,P,[v.point.x-.5*b,v.point.y-.5*b,0]),a.ae.multiply(P,P,m),a.ae.multiply(P,v.globeMatrix,P)}(i,n);return function(m,v,b){const E=(F,V,j)=>{const K=a.$.length(F),pe=a.$.length(V),de=nh(F,V,j);return a.$.scale(de,de,1/a.$.length(de)*wn(K,pe,j))},I=E([m[0],m[1],m[2]],[v[0],v[1],v[2]],b),P=E([m[4],m[5],m[6]],[v[4],v[5],v[6]],b),M=E([m[8],m[9],m[10]],[v[8],v[9],v[10]],b),z=nh([m[12],m[13],m[14]],[v[12],v[13],v[14]],b);return[I[0],I[1],I[2],0,P[0],P[1],P[2],0,M[0],M[1],M[2],0,z[0],z[1],z[2],1]}(h,p,c)}return h}function z5(i,n,s,c){const h=li.projectAabbCorners(c,s);let p=Number.MAX_VALUE,m=-1;for(let E=0;E<h.length;++E){const I=h[E];I[0]=(.5*I[0]+.5)*n.width,I[1]=(.5-.5*I[1])*n.height,I[2]<p&&(m=E,p=I[2])}const v=E=>new Nt(h[E][0],h[E][1]);let b;switch(m){case 0:case 6:b=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:b=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:b=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:b=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if(UA(i,b))return p}const qX=Pr([{name:"a_pos_3f",components:3,type:"Float32"}]),WX=Pr([{name:"a_color_3f",components:3,type:"Float32"}]),HX=Pr([{name:"a_color_4f",components:4,type:"Float32"}]),ZX=Pr([{name:"a_uv_2f",components:2,type:"Float32"}]),XX=Pr([{name:"a_normal_3f",components:3,type:"Float32"}]),KX=Pr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),YX=Pr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class tw{constructor(n,s,c,h){this.message=(n?`${n}: `:"")+c,h&&(this.identifier=h),s!=null&&s.__line__&&(this.line=s.__line__)}}function N5(i,n){const s=i.indexOf("://")===-1;try{return new URL(i,s&&n?"http://example.com":void 0),!0}catch{return!1}}class F5{constructor(n,s){this.feature=n,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class B5{constructor(){this.instancedDataArray=new TA,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class DC{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=n.projection,this.index=n.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(n,s){}populate(n,s,c,h){this.tileToMeter=ub(c);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:v,index:b,sourceLayerIndex:E}of n){const I=v??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),P=th(m,p);if(!this.layers[0]._featureFilter.filter(new An(this.zoom),P,c))continue;const M={id:I,sourceLayerIndex:E,index:b,geometry:p?P.geometry:uc(m,c,h),properties:m.properties,type:m.type,patterns:{}},z=this.addFeature(M,M.geometry,P);z&&s.featureIndex.insert(m,M.geometry,b,E,this.index,this.instancesPerModel[z].instancedDataArray.length,Lt/32)}this.lookup=null}update(n,s,c,h){for(const p in this.instancesPerModel){const m=this.instancesPerModel[p];for(const v in n)m.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(m.features[m.idToFeaturesIndex[v]],n[v],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];for(const h of c.features){const p=this.layers[0],m=h.feature,v=this.canonical,b=p.paint.get("model-rotation").evaluate(m,{},v),E=p.paint.get("model-scale").evaluate(m,{},v),I=p.paint.get("model-translation").evaluate(m,{},v);a.$.exactEquals(h.rotation,b)&&a.$.exactEquals(h.scale,E)&&a.$.exactEquals(h.translation,I)||(this.evaluate(h,h.featureStates,c,!0),n=!0)}}return n}updateReplacement(n,s,c,h){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const p=s.getReplacementRegionsForTile(n.toUnwrapped(),!0);if(oC(this.activeReplacements,p))return!1;this.activeReplacements=p;let m=!1;for(const v in this.instancesPerModel){const b=this.instancesPerModel[v],E=b.instancedDataArray;for(const I of b.features){const P=I.instancedDataOffset,M=I.instancedDataCount;for(let z=0;z<M;z++){const F=16*(z+P);let V=E.float32[F+0];V=V>Lt?V-Lt:V;const j=Math.floor(V),K=E.float32[F+1];let pe=!1;for(const de of this.activeReplacements)if(!A4(de,c,V4.Model,h)&&!(de.min.x>j||j>de.max.x||de.min.y>K||K>de.max.y)&&(pe=D4(k4(j,K,n.canonical,de.footprintTileId.canonical),de),pe))break;E.float32[F]=pe?V+Lt:V,m=m||pe}}}return m}isEmpty(){for(const n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=n.createVertexBuffer(c.instancedDataArray,KX.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(n&&this.modelUris)for(const s of this.modelUris)n.removeModel(s,"")}addFeature(n,s,c){const h=this.layers[0],p=h.layout.get("model-id").evaluate(c,{},this.canonical);if(!p)return _i(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),p;N5(p,!1)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new B5);const m=this.instancesPerModel[p],v=m.instancedDataArray,b=new F5(c,v.length);for(const E of s)for(const I of E){if(I.x<0||I.x>=Lt||I.y<0||I.y>=Lt)continue;const P=(this.lookupDim-1)/Lt,M=this.lookupDim*(I.y*P|0)+I.x*P|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const z=v.length;v.resize(z+1),m.instancesEvaluatedElevation.push(0),v.float32[16*z]=I.x,v.float32[16*z+1]=I.y}return b.instancedDataCount=m.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(n.id&&(m.idToFeaturesIndex[n.id]=m.features.length),m.features.push(b),this.evaluate(b,{},m,!1)),p}getModelUris(){return this.modelUris}evaluate(n,s,c,h){const p=this.layers[0],m=n.feature,v=this.canonical,b=n.rotation=p.paint.get("model-rotation").evaluate(m,s,v),E=n.scale=p.paint.get("model-scale").evaluate(m,s,v),I=n.translation=p.paint.get("model-translation").evaluate(m,s,v),P=p.paint.get("model-color").evaluate(m,s,v);P.a=p.paint.get("model-color-mix-intensity").evaluate(m,s,v);const M=[];this.maxVerticalOffset<I[2]&&(this.maxVerticalOffset=I[2]),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),L5(M,b,E);const z=Math.round(100*P.a)+P.b/1.05;for(let F=0;F<n.instancedDataCount;++F){const V=n.instancedDataOffset+F,j=16*V,K=c.instancedDataArray.float32;let pe=0;h&&(pe=K[j+6]-c.instancesEvaluatedElevation[V]);const de=0|K[j+1];K[j]=(0|K[j])+P.r/1.05,K[j+1]=de+P.g/1.05,K[j+2]=z,K[j+3]=1/(v.z>10?this.tileToMeter:ub(v,de)),K[j+4]=I[0],K[j+5]=I[1],K[j+6]=I[2]+pe,K[j+7]=M[0],K[j+8]=M[1],K[j+9]=M[2],K[j+10]=M[4],K[j+11]=M[5],K[j+12]=M[6],K[j+13]=M[8],K[j+14]=M[9],K[j+15]=M[10],c.instancesEvaluatedElevation[V]=I[2]}}}let U5,V5;je(DC,"ModelBucket",{omit:["layers"]}),je(B5,"PerModelAttributes"),je(F5,"ModelFeature");const yp=64,Eg={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function j5(i,n,s,c,h,p,m,v,b,E=!1){const I=s.zoom,P=s.project(c),M=dp(c.lat,I),z=1/M;a.ae.identity(i),a.ae.translate(i,i,[P.x+m[0]*z,P.y+m[1]*z,m[2]]);let F=1,V=1;const j=s.worldSize;if(E){if(s.projection.name==="mercator"){let me=0;s.elevation&&(me=s.elevation.getAtPointOrZero(new fo(P.x/j,P.y/j),0));const Ae=a.aB.transformMat4([],[P.x,P.y,me,1],s.projMatrix)[3]/s.cameraToCenterDistance;F=Ae,V=Ae*dp(s.center.lat,I)}else if(s.projection.name==="globe"){const me=kC(i,s),Ae=a.ae.multiply([],s.projMatrix,me),Ce=[0,0,0,1];a.aB.transformMat4(Ce,Ce,Ae);const ze=Ce[3]/s.cameraToCenterDistance,$e=rh(I),Xe=s.projection.pixelsPerMeter(c.lat,j)*dp(c.lat,I),tt=s.projection.pixelsPerMeter(s.center.lat,j)*dp(s.center.lat,I);F=ze/wn(Xe,RL(s.center.lat),$e),V=ze*M/Xe,F*=tt,V*=tt}}else F=z;a.ae.scale(i,i,[F,F,V]);const K=[...i],pe=n.orientation,de=[];if(L5(de,[pe[0]+h[0],pe[1]+h[1],pe[2]+h[2]],p),a.ae.multiply(i,K,de),v&&s.elevation){let me=0;const Ae=[];if(b&&s.elevation){me=function($e,Xe,tt,Ke,lt){const Tt=Xe.elevation;if(!Tt)return 0;const ct=li.projectAabbCorners(tt,Ke),At=No(1,lt.lat)*Xe.worldSize,ot=function(In,dn){const nn=[0,0,1],On=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const zn of On){const Ln=In[zn.corners[0]],$n=In[zn.corners[1]],ur=In[zn.corners[2]],tr=[$n[0]-Ln[0],$n[1]-Ln[1],dn*($n[2]-Ln[2])],Br=a.$.cross(tr,tr,[ur[0]-Ln[0],ur[1]-Ln[1],dn*(ur[2]-Ln[2])]);a.$.normalize(Br,Br),zn.dotProductWithUp=a.$.dot(Br,nn)}return On.sort((zn,Ln)=>zn.dotProductWithUp-Ln.dotProductWithUp),On[0].corners}(ct,At),mt=ct[ot[0]],Ot=ct[ot[1]],ut=ct[ot[2]],Ft=ct[ot[3]],Dt=Tt.getAtPointOrZero(new fo(mt[0]/Xe.worldSize,mt[1]/Xe.worldSize),0),Et=Tt.getAtPointOrZero(new fo(Ot[0]/Xe.worldSize,Ot[1]/Xe.worldSize),0),gn=Tt.getAtPointOrZero(new fo(ut[0]/Xe.worldSize,ut[1]/Xe.worldSize),0),cn=Tt.getAtPointOrZero(new fo(Ft[0]/Xe.worldSize,Ft[1]/Xe.worldSize),0),Ht=(Dt+cn)/2,zt=(Et+gn)/2;return Ht>zt?Et<gn?ew($e,Ot,Ft,mt,Et,cn,Dt,At):ew($e,ut,mt,Ft,gn,Dt,cn,At):Dt<cn?ew($e,mt,Ot,ut,Dt,Et,gn,At):ew($e,Ft,ut,Ot,cn,gn,Et,At),Math.max(Ht,zt)}(Ae,s,n.aabb,i,c);const Ce=a.ae.fromQuat([],Ae),ze=a.ae.multiply([],Ce,de);a.ae.multiply(i,K,ze)}else me=s.elevation.getAtPointOrZero(new fo(P.x/j,P.y/j),0);me!==0&&(i[14]+=me)}}function R0(i,n,s=!1){i.uploaded||(i.gfxTexture=new wl(n,i.image,s?n.gl.R8:n.gl.RGBA,{useMipmap:i.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),i.uploaded=!0,i.image=null)}function QX(i,n,s){i.indexBuffer=n.createIndexBuffer(i.indexArray,!1,!0),i.vertexBuffer=n.createVertexBuffer(i.vertexArray,qX.members,!1,!0),i.normalArray&&(i.normalBuffer=n.createVertexBuffer(i.normalArray,XX.members,!1,!0)),i.texcoordArray&&(i.texcoordBuffer=n.createVertexBuffer(i.texcoordArray,ZX.members,!1,!0)),i.colorArray&&(i.colorBuffer=n.createVertexBuffer(i.colorArray,(i.colorArray.bytesPerElement===12?WX:HX).members,!1,!0)),i.featureArray&&(i.pbrBuffer=n.createVertexBuffer(i.featureArray,YX.members,!0)),i.segments=pi.simpleSegment(0,0,i.vertexArray.length,i.indexArray.length);const c=i.material;c.pbrMetallicRoughness.baseColorTexture&&R0(c.pbrMetallicRoughness.baseColorTexture,n),c.pbrMetallicRoughness.metallicRoughnessTexture&&R0(c.pbrMetallicRoughness.metallicRoughnessTexture,n),c.normalTexture&&R0(c.normalTexture,n),c.occlusionTexture&&R0(c.occlusionTexture,n,s),c.emissionTexture&&R0(c.emissionTexture,n)}function OC(i,n,s){if(i.meshes)for(const c of i.meshes)QX(c,n,s);if(i.children)for(const c of i.children)OC(c,n,s)}function nw(i){if(i.meshes)for(const n of i.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(i.children)for(const n of i.children)nw(n)}function LC(i){if(i.meshes)for(const s of i.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((n=s.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(i.children)for(const s of i.children)LC(s)}class JX{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class eK{constructor(){this.tasks={},this.taskQueue=[],Fu(["process"],this),this.invoker=new JX(this.process),this.nextId=0}add(n,s){const c=this.nextId++,h=function({type:p,isSymbolTile:m,zoom:v}){return v=v||0,p==="message"?0:p!=="maybePrepare"||m?p!=="parseTile"||m?p==="parseTile"&&m?300-v:p==="maybePrepare"&&m?400-v:500:200-v:100-v}(s);if(h===0){try{n()}finally{}return null}return this.tasks[c]={fn:n,metadata:s,priority:h,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const s=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let n=null,s=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<s&&(s=p.priority,n=h)}if(n===null)return null;const c=this.taskQueue[n];return this.taskQueue.splice(n,1),c}remove(){this.invoker.remove()}}class $5{constructor(n,s,c){this.target=n,this.parent=s,this.mapId=c,this.callbacks={},this.cancelCallbacks={},Fu(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new eK}send(n,s,c,h,p=!1,m){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=m,this.callbacks[v]=c);const b=new Set;return this.target.postMessage({id:v,type:n,hasCallback:!!c,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:He(s,b)},b),{cancel:()=>{c&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(n){const s=n.data,c=s.id;if(c&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){const h=this.cancelCallbacks[c];delete this.cancelCallbacks[c],h&&h.cancel()}else if(s.mustQueue||Do()){const h=this.callbacks[c],p=this.scheduler.add(()=>this.processTask(c,s),h&&h.metadata||{type:"message"});p&&(this.cancelCallbacks[c]=p)}else this.processTask(c,s)}processTask(n,s){if(delete this.cancelCallbacks[n],s.type==="<response>"){const c=this.callbacks[n];delete this.callbacks[n],c&&(s.error?c(it(s.error)):c(null,it(s.data)))}else{const c=new Set,h=s.hasCallback?(m,v)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:m?He(m):null,data:He(v,c)},c)}:m=>{},p=it(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,p,h);else if(this.parent.getWorkerSource){const m=s.type.split(".");this.parent.getWorkerSource(s.sourceMapId,m[0],p.source,p.scope)[m[1]](p,h)}else h(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Sg{constructor(n,s){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Kl();const c=this.workerPool.acquire(this.id);for(let h=0;h<c.length;h++){const p=new Sg.Actor(c[h],s,this.id);p.name=`Worker ${h}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,s,c){Nu(this.actors,(h,p)=>{h.send(n,s,p)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}Sg.Actor=$5;var M0={workerUrl:"",workerClass:null,workerParams:void 0};function tK(){return M0.workerClass!=null?new M0.workerClass:new self.Worker(M0.workerUrl,M0.workerParams)}const zC="mapboxgl_preloaded_worker_pool";class k0{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<k0.workerCount;)this.workers.push(new tK);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[zC]}numActive(){return Object.keys(this.active).length}}let D0;function rw(){return D0||(D0=new k0),D0}k0.workerCount=2;let iw,NC,gc,Ig,FC,Ag=null;function G5(){return Do()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:NC||O.DRACO_URL}function q5(){if(Do()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Ig)return Ig;const i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Ig=WebAssembly.validate(i)?O.MESHOPT_SIMD_URL:O.MESHOPT_URL,Ig}const sw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},nK={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},O0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function W5(i,n,s){const c=s.json.bufferViews.length,h=s.buffers.length;n.bufferView=c,s.json.bufferViews[c]={buffer:h,byteLength:i.byteLength},s.buffers[h]=i}const BC="KHR_draco_mesh_compression";function rK(i,n){const s=i.extensions&&i.extensions[BC];if(!s)return;const c=new gc.Decoder,h=K5(n,s.bufferView),p=new gc.Mesh;if(!c.DecodeArrayToMesh(h,h.byteLength,p))throw new Error("Failed to decode Draco mesh");const m=n.json.accessors[i.indices],v=sw[m.componentType],b=m.count*v.BYTES_PER_ELEMENT,E=gc._malloc(b);v===Uint16Array?c.GetTrianglesUInt16Array(p,b,E):c.GetTrianglesUInt32Array(p,b,E),W5(gc.memory.buffer.slice(E,E+b),m,n),gc._free(E);for(const I of Object.keys(s.attributes)){const P=c.GetAttributeByUniqueId(p,s.attributes[I]),M=n.json.accessors[i.attributes[I]],z=nK[M.componentType],F=M.count*O0[M.type]*sw[M.componentType].BYTES_PER_ELEMENT,V=gc._malloc(F);c.GetAttributeDataArrayForAllPoints(p,P,gc[z],F,V),W5(gc.memory.buffer.slice(V,V+F),M,n),gc._free(V)}c.destroy(),p.destroy(),delete i.extensions[BC]}const ow="EXT_meshopt_compression";function iK(i,n){if(!i.extensions||!i.extensions[ow])return;const s=i.extensions[ow],c=new Uint8Array(n.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),h=new Uint8Array(s.count*s.byteStride);FC.decodeGltfBuffer(h,s.count,s.byteStride,c,s.mode,s.filter),i.buffer=n.buffers.length,i.byteOffset=0,n.buffers[i.buffer]=h.buffer,delete i.extensions[ow]}const H5=1179937895,Z5=new TextDecoder("utf8");function X5(i,n){return new URL(i,n).href}function sK(i,n,s,c){return fetch(X5(i.uri,c)).then(h=>h.arrayBuffer()).then(h=>{n.buffers[s]=h})}function K5(i,n){const s=i.json.bufferViews[n];return new Uint8Array(i.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function oK(i,n,s,c){if(i.uri){const h=X5(i.uri,c);return fetch(h).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{n.images[s]=p})}if(i.bufferView!==void 0){const h=K5(n,i.bufferView),p=new Blob([h],{type:i.mimeType});return createImageBitmap(p).then(m=>{n.images[s]=m})}}function Y5(i,n=0,s){const c={json:null,images:[],buffers:[]};if(new Uint32Array(i,n,1)[0]===H5){const I=new Uint32Array(i,n);let P=2;const M=(I[P++]>>2)-3,z=I[P++]>>2;if(P++,c.json=JSON.parse(Z5.decode(I.subarray(P,P+z))),P+=z,P<M){const F=I[P++];P++;const V=n+(P<<2);c.buffers[0]=i.slice(V,V+F)}}else c.json=JSON.parse(Z5.decode(new Uint8Array(i,n)));const{buffers:h,images:p,meshes:m,extensionsUsed:v,bufferViews:b}=c.json;let E=Promise.resolve();if(h){const I=[];for(let P=0;P<h.length;P++){const M=h[P];M.uri?I.push(sK(M,c,P,s)):c.buffers[P]||(c.buffers[P]=null)}E=Promise.all(I)}return E.then(()=>{const I=[],P=v&&v.includes(BC),M=v&&v.includes(ow);if(P&&I.push(function(){if(!gc)return iw||(iw=function(z){let F,V=null;function j(){F=new Uint8Array(V.buffer)}function K(){throw new Error("Unexpected Draco error.")}const pe={a:{a:K,d:function(de,me,Ae){return F.copyWithin(de,me,me+Ae)},c:function(de){const me=F.length,Ae=Math.max(de>>>0,Math.ceil(1.2*me)),Ce=Math.ceil((Ae-me)/65536);try{return V.grow(Ce),j(),!0}catch{return!1}},b:K}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(z,pe):z.then(de=>de.arrayBuffer()).then(de=>WebAssembly.instantiate(de,pe))).then(de=>{const{Rb:me,Qb:Ae,P:Ce,T:ze,X:$e,Ja:Xe,La:tt,Qa:Ke,Va:lt,Wa:Tt,eb:ct,jb:At,f:ot,e:mt,yb:Ot,zb:ut,Ab:Ft,Bb:Dt,Db:Et,Gb:gn}=de.instance.exports;V=mt;const cn=(()=>{let Ht=0,zt=0,In=0,dn=0;return nn=>{In&&(me(dn),me(Ht),zt+=In,In=Ht=0),Ht||(zt+=128,Ht=Ae(zt));const On=nn.length+7&-8;let zn=Ht;On>=zt&&(In=On,zn=dn=Ae(On));for(let Ln=0;Ln<nn.length;Ln++)F[zn+Ln]=nn[Ln];return zn}})();return j(),ot(),{memory:mt,_free:me,_malloc:Ae,Mesh:class{constructor(){this.ptr=Ce()}destroy(){ze(this.ptr)}},Decoder:class{constructor(){this.ptr=Xe()}destroy(){At(this.ptr)}DecodeArrayToMesh(Ht,zt,In){const dn=cn(Ht),nn=tt(this.ptr,dn,zt,In.ptr);return!!$e(nn)}GetAttributeByUniqueId(Ht,zt){return{ptr:Ke(this.ptr,Ht.ptr,zt)}}GetTrianglesUInt16Array(Ht,zt,In){lt(this.ptr,Ht.ptr,zt,In)}GetTrianglesUInt32Array(Ht,zt,In){Tt(this.ptr,Ht.ptr,zt,In)}GetAttributeDataArrayForAllPoints(Ht,zt,In,dn,nn){ct(this.ptr,Ht.ptr,zt.ptr,In,dn,nn)}},DT_INT8:Ot(),DT_UINT8:ut(),DT_INT16:Ft(),DT_UINT16:Dt(),DT_UINT32:Et(),DT_FLOAT32:gn()}})}(fetch(G5())),iw.then(z=>{gc=z,iw=void 0}))}()),M&&I.push(function(){if(FC)return;const z=function(F){let V;const j=WebAssembly.instantiateStreaming(F,{}).then(de=>{V=de.instance,V.exports.__wasm_call_ctors()}),K={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},pe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:j,supported:!0,decodeGltfBuffer(de,me,Ae,Ce,ze,$e){(function(Xe,tt,Ke,lt,Tt,ct,At){const ot=Xe.exports.sbrk,mt=lt+3&-4,Ot=ot(mt*Tt),ut=ot(ct.length),Ft=new Uint8Array(Xe.exports.memory.buffer);Ft.set(ct,ut);const Dt=tt(Ot,lt,Tt,ut,ct.length);if(Dt===0&&At&&At(Ot,mt,Tt),Ke.set(Ft.subarray(Ot,Ot+lt*Tt)),ot(Ot-ot(0)),Dt!==0)throw new Error(`Malformed buffer data: ${Dt}`)})(V,V.exports[pe[ze]],de,me,Ae,Ce,V.exports[K[$e]])}}}(fetch(q5()));return z.ready.then(()=>{FC=z})}()),p)for(let z=0;z<p.length;z++)I.push(oK(p[z],c,z,s));return(I.length?Promise.all(I):Promise.resolve()).then(()=>{if(P&&m)for(const{primitives:z}of m)for(const F of z)rK(F,c);if(M&&m&&b)for(const z of b)iK(z,c);return c})})}function vp(i,n){const s=i.json.bufferViews[n.bufferView],c=sw[n.componentType];return new c(i.buffers[s.buffer],(n.byteOffset||0)+(s.byteOffset||0),n.count*(s.byteStride&&s.byteStride!==O0[n.type]*c.BYTES_PER_ELEMENT?s.byteStride/c.BYTES_PER_ELEMENT:O0[n.type]))}function UC(i,n,s,c){const h=sw[n.componentType],p=function(I){switch(I){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),m=i.json.bufferViews[n.bufferView],v=m.byteStride?m.byteStride/h.BYTES_PER_ELEMENT:O0[n.type],b=s.float32,E=b.length/s.capacity;for(let I=0,P=0;I<n.count*v;I+=v,P+=E)for(let M=0;M<E;M++)b[P+M]=c[I+M]*p;s._trim()}function aK(i,n,s){const c=i.indices,h=i.attributes,p={};p.indexArray=new ks;const m=n.json.accessors[c],v=m.count/3;p.indexArray.reserve(v);const b=vp(n,m);for(let M=0;M<v;M++)p.indexArray.emplaceBack(b[3*M],b[3*M+1],b[3*M+2]);p.indexArray._trim(),p.vertexArray=new fd;const E=n.json.accessors[h.POSITION];p.vertexArray.reserve(E.count);const I=vp(n,E);for(let M=0;M<E.count;M++)p.vertexArray.emplaceBack(I[3*M],I[3*M+1],I[3*M+2]);if(p.vertexArray._trim(),p.aabb=new li(E.min,E.max),p.centroid=function(M,z){const F=[0,0,0],V=M.length;if(V>0){for(let j=0;j<V;j++){const K=3*M[j];F[0]+=z[K],F[1]+=z[K+1],F[2]+=z[K+2]}F[0]/=V,F[1]/=V,F[2]/=V}return F}(b,I),h.COLOR_0!==void 0){const M=n.json.accessors[h.COLOR_0],z=O0[M.type],F=vp(n,M);p.colorArray=z===3?new fd:new dd,p.colorArray.resize(M.count),UC(n,M,p.colorArray,F)}if(h.NORMAL!==void 0){p.normalArray=new fd;const M=n.json.accessors[h.NORMAL];p.normalArray.resize(M.count);const z=vp(n,M);UC(n,M,p.normalArray,z)}if(h.TEXCOORD_0!==void 0&&s.length>0){p.texcoordArray=new Yy;const M=n.json.accessors[h.TEXCOORD_0];p.texcoordArray.resize(M.count);const z=vp(n,M);UC(n,M,p.texcoordArray,z)}if(h._FEATURE_ID_RGBA4444!==void 0){const M=n.json.accessors[h._FEATURE_ID_RGBA4444];n.json.extensionsUsed&&n.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=vp(n,M))}h._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(vp(n,n.json.accessors[h._FEATURE_RGBA4444]).buffer));const P=i.material;return p.material=function(M,z){const{emissiveFactor:F=[0,0,0],alphaMode:V="OPAQUE",alphaCutoff:j=.5,normalTexture:K,occlusionTexture:pe,emissiveTexture:de,doubleSided:me}=M,{baseColorFactor:Ae=[1,1,1,1],metallicFactor:Ce=1,roughnessFactor:ze=1,baseColorTexture:$e,metallicRoughnessTexture:Xe}=M.pbrMetallicRoughness||{},tt=pe?z[pe.index]:void 0;if(pe&&pe.extensions&&pe.extensions.KHR_texture_transform&&tt){const Ke=pe.extensions.KHR_texture_transform;tt.offsetScale=[Ke.offset[0],Ke.offset[1],Ke.scale[0],Ke.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new wr(...Ae),metallicFactor:Ce,roughnessFactor:ze,baseColorTexture:$e?z[$e.index]:void 0,metallicRoughnessTexture:Xe?z[Xe.index]:void 0},doubleSided:me,emissiveFactor:F,alphaMode:V,alphaCutoff:j,normalTexture:K?z[K.index]:void 0,occlusionTexture:tt,emissionTexture:de?z[de.index]:void 0,defined:M.defined===void 0}}(P!==void 0?n.json.materials[P]:{defined:!1},s),p}function Q5(i,n,s){const{matrix:c,rotation:h,translation:p,scale:m,mesh:v,extras:b,children:E}=i,I={};if(I.matrix=c||a.ae.fromRotationTranslationScale([],h||[0,0,0,1],p||[0,0,0],m||[1,1,1]),v!==void 0){I.meshes=s[v];const P=I.anchor=[0,0];for(const M of I.meshes){const{min:z,max:F}=M.aabb;P[0]+=z[0]+F[0],P[1]+=z[1]+F[1]}P[0]=Math.floor(P[0]/I.meshes.length/2),P[1]=Math.floor(P[1]/I.meshes.length/2)}if(b&&(b.id&&(I.id=b.id),b.lights&&(I.lights=function(P){if(!P.length)return[];const M=function(K){const pe=atob(K),de=new Uint8Array(pe.length);for(let me=0;me<pe.length;me++)de[me]=pe.codePointAt(me);return de}(P),z=[],F=M.length/24,V=new Uint16Array(M.buffer),j=new Float32Array(M.buffer);for(let K=0;K<F;K++){const pe=V[2*K*6]/30,de=V[2*K*6+1]/30,me=V[2*K*6+10]/100,Ae=j[6*K+1],Ce=j[6*K+2],ze=j[6*K+3],$e=j[6*K+4],Xe=ze-Ae,tt=$e-Ce,Ke=Math.hypot(Xe,tt);z.push({pos:[Ae+.5*Xe,Ce+.5*tt,de],normal:[tt/Ke,-Xe/Ke,0],width:Ke,height:pe,depth:me,points:[Ae,Ce,ze,$e]})}return z}(b.lights))),E){const P=[];for(const M of E)P.push(Q5(n.json.nodes[M],n,s));I.children=P}return I}function lK(i){if(i.vertices.length===0||i.indices.length===0)return null;const n=new rC(i.vertices,i.indices,8,256),[s,c]=[n.min.clone(),n.max.clone()];return{vertices:i.vertices,indices:i.indices,grid:n,min:s,max:c}}function cK(i){if(!i.extras||!i.extras.ground)return null;const n=i.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;const s=n[0];if(!s||!Array.isArray(s)||s.length===0)return null;const c=[];for(const m of s){if(!Array.isArray(m)||m.length!==2)continue;const v=m[0],b=m[1];typeof v=="number"&&typeof b=="number"&&c.push(new Nt(v,b))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let h=0;for(let m=0;m<c.length;m++){const v=c[m],b=c[(m+1)%c.length],E=c[(m+2)%c.length];h+=(v.x-b.x)*(E.y-b.y)-(E.x-b.x)*(v.y-b.y)}h>0&&c.reverse();const p=o0(c.flatMap(m=>[m.x,m.y]),[]);return p.length===0?null:{vertices:c,indices:p}}function uK(i,n){const s=[],c=[];let h=0;const p=[];for(const m of i){h=s.length;const v=m.vertexArray.float32,b=m.indexArray.uint16;for(let E=0;E<m.vertexArray.length;E++)p[0]=v[3*E+0],p[1]=v[3*E+1],p[2]=v[3*E+2],a.$.transformMat4(p,p,n),s.push(new Nt(p[0],p[1]));for(let E=0;E<3*m.indexArray.length;E++)c.push(b[E]+h)}if(c.length%3!=0)return null;for(let m=0;m<c.length;m+=3){const v=s[c[m+0]],b=s[c[m+1]],E=s[c[m+2]];(v.x-b.x)*(E.y-b.y)-(E.x-b.x)*(v.y-b.y)>0&&([c[m+1],c[m+2]]=[c[m+2],c[m+1]])}return{vertices:s,indices:c}}function J5(i){const n=function(b,E){const I=[],P=WebGL2RenderingContext;if(b.json.textures)for(const M of b.json.textures){const z={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};M.sampler!==void 0&&Object.assign(z,b.json.samplers[M.sampler]),I.push({image:E[M.source],sampler:z,uploaded:!1})}return I}(i,i.images),s=function(b,E){const I=[];for(const P of b.json.meshes){const M=[];for(const z of P.primitives)M.push(aK(z,b,E));I.push(M)}return I}(i,n),{scenes:c,scene:h,nodes:p}=i.json,m=c?c[h||0].nodes:p,v=[];for(const b of m)v.push(Q5(p[b],i,s));return function(b,E,I){const P={},M=new Set;for(let z=0;z<b.length;z++){const F=I[E[z]];if(!F.extras)continue;const V=F.extras["mapbox:footprint:version"],j=F.extras["mapbox:footprint:id"];(V||j)&&M.add(z),V==="1.0.0"&&j&&(P[j]=z)}for(let z=0;z<b.length;z++){if(M.has(z))continue;const F=b[z],V=I[E[z]];if(!V.extras)continue;let j=null;F.id in P&&(j=uK(b[P[F.id]].meshes,F.matrix)),j||(j=cK(V)),j&&(F.footprint=lK(j))}if(M.size>0){const z=Array.from(M.values()).sort((F,V)=>F-V);for(let F=z.length-1;F>=0;F--)b.splice(z[F],1)}}(v,m,i.json.nodes),v}function hK(i){i.heightmap=new Float32Array(4096),i.heightmap.fill(-1);const n=i.vertexArray.float32,s=i.aabb.min[0]-1,c=i.aabb.min[1]-1,h=yp/(i.aabb.max[0]-s+2),p=yp/(i.aabb.max[1]-c+2);for(let m=0;m<n.length;m+=3){const v=n[m+2],b=(n[m+0]-s)*h|0,E=(n[m+1]-c)*p|0;v>i.heightmap[E*yp+b]&&(i.heightmap[E*yp+b]=v)}}function dK(i,n){const s={};s.indexArray=new ks,s.indexArray.reserve(4*i.length),s.vertexArray=new fd,s.vertexArray.reserve(10*i.length),s.colorArray=new dd,s.vertexArray.reserve(10*i.length);let c=0;for(const m of i){const v=Math.min(10,Math.max(4,1.3*m.height))*n,b=[-m.normal[1],m.normal[0],0],E=Math.min(.29,.1*m.width/m.depth),I=m.width-2*m.depth*n*(E+.01),P=a.$.scaleAndAdd([],m.pos,b,I/2),M=a.$.scaleAndAdd([],m.pos,b,-I/2),z=[P[0],P[1],P[2]+m.height],F=[M[0],M[1],M[2]+m.height],V=a.$.scaleAndAdd([],m.normal,b,E);a.$.scale(V,V,v);const j=a.$.scaleAndAdd([],m.normal,b,-E);a.$.scale(j,j,v),a.$.add(V,P,V),a.$.add(j,M,j),P[2]+=.1,M[2]+=.1,s.vertexArray.emplaceBack(V[0],V[1],V[2]),s.vertexArray.emplaceBack(j[0],j[1],j[2]),s.vertexArray.emplaceBack(P[0],P[1],P[2]),s.vertexArray.emplaceBack(M[0],M[1],M[2]),s.vertexArray.emplaceBack(z[0],z[1],z[2]),s.vertexArray.emplaceBack(F[0],F[1],F[2]),s.vertexArray.emplaceBack(P[0],P[1],P[2]),s.vertexArray.emplaceBack(M[0],M[1],M[2]),s.vertexArray.emplaceBack(V[0],V[1],V[2]),s.vertexArray.emplaceBack(j[0],j[1],j[2]);const K=I/v/2;s.colorArray.emplaceBack(-K-E,-1,K,.8),s.colorArray.emplaceBack(K+E,-1,K,.8),s.colorArray.emplaceBack(-K,0,K,1.3),s.colorArray.emplaceBack(K,0,K,1.3),s.colorArray.emplaceBack(K+E,-.8,K,.7),s.colorArray.emplaceBack(K+E,-.8,K,.7),s.colorArray.emplaceBack(0,0,K,1.3),s.colorArray.emplaceBack(0,0,K,1.3),s.colorArray.emplaceBack(K+E,-1.2,K,.8),s.colorArray.emplaceBack(K+E,-1.2,K,.8),s.indexArray.emplaceBack(6+c,4+c,8+c),s.indexArray.emplaceBack(7+c,9+c,5+c),s.indexArray.emplaceBack(0+c,1+c,2+c),s.indexArray.emplaceBack(1+c,3+c,2+c),c+=10}const h={defined:!0,emissiveFactor:[0,0,0]},p={};return p.baseColorFactor=wr.white,h.pbrMetallicRoughness=p,s.material=h,s.aabb=new li([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}const VC=new Float32Array(262144),xp=new Uint8Array(262144);function eN(i){let n=0;if(i.meshes)for(const s of i.meshes)n=Math.max(n,s.aabb.max[2]);if(i.children)for(const s of i.children)n=Math.max(n,eN(s));return n}function tN(i,n,s){if(i.meshes)for(const c of i.meshes)c.aabb.min[0]!==1/0&&s.insert(n,c.aabb.min[0],c.aabb.min[1],c.aabb.max[0],c.aabb.max[1]);if(i.children)for(const c of i.children)tN(c,n,s)}const nN=["","wall","door","roof","window","lamp","logo"];class rN{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:n.id,geometry:[],properties:{height:eN(n)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new li([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let n=0;const s=new li([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==n&&(c.transformedAabb=li.applyTransformFast(c.aabb,this.node.matrix),s.encapsulate(c.transformedAabb)),n++;this.aabb=s}return this.aabb}}class aw{constructor(n,s,c,h,p,m){this.id=s,this.modelTraits|=Eg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,c&&(this.modelTraits|=Eg.HasMapboxMeshFeatures),h&&(this.modelTraits|=Eg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const v of n)this.nodesInfo.push(new rN(v)),tN(v,m.featureIndexArray.length,m.grid),m.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,m.bucketLayerIDs.length-1,0)}updateFootprints(n,s){for(const c of this.getNodesInfo()){const h=c.node;h.footprint&&s.push({footprint:h.footprint,id:n})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;const s=this.getNodesInfo();for(const c of s){const h=c.node;this.uploaded?this.updatePbrBuffer(h):OC(h,n,!0)}for(const c of s)nw(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let s=!1;if(!n.meshes)return s;for(const c of n.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),s=!0);return s}needsReEvaluation(n,s,c){const h=n.transform.projectionOptions,p=n.style.getBrightness(),m=this.brightness!==p;return!!(!this.uploaded||this.dirty||h.name!==this.projection.name||L0(c.paint.get("model-color").value,m)||L0(c.paint.get("model-color-mix-intensity").value,m)||L0(c.paint.get("model-roughness").value,m)||L0(c.paint.get("model-emissive-strength").value,m)||L0(c.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=h,this.brightness=p,!0)}evaluateScale(n,s){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;const c=this.getNodesInfo(),h=this.id.canonical;for(const p of c){const m=p.feature;p.evaluatedScale=s.paint.get("model-scale").evaluate(m,{},h)}}evaluate(n){const s=this.getNodesInfo();for(const c of s){if(!c.node.meshes)continue;const h=c.feature,p=c.node.meshes&&c.node.meshes[0].featureData,m=c.evaluatedColor[2],v=c.evaluatedRMEA[2],b=this.id.canonical;if(c.hasTranslucentParts=!1,p){for(let E=0;E<nN.length;E++){const I=nN[E];I.length&&(h.properties.part=I);const P=n.paint.get("model-color").evaluate(h,{},b).toRenderColor(null),M=n.paint.get("model-color-mix-intensity").evaluate(h,{},b);c.evaluatedColor[E]=[P.r,P.g,P.b,M],c.evaluatedRMEA[E][0]=n.paint.get("model-roughness").evaluate(h,{},b),c.evaluatedRMEA[E][2]=n.paint.get("model-emissive-strength").evaluate(h,{},b),c.evaluatedRMEA[E][3]=P.a,c.emissionHeightBasedParams[E]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,{},b),!c.hasTranslucentParts&&P.a<1&&(c.hasTranslucentParts=!0)}delete h.properties.part,pK(c,m!==c.evaluatedColor[2]||v!==c.evaluatedRMEA[2],this.modelTraits)}else c.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(h,{},b);c.evaluatedScale=n.paint.get("model-scale").evaluate(h,{},b),this.updatePbrBuffer(c.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,s,c,h){const p=n.findDEMTileFor(c);if(p&&(p.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const m=fg.create(n,c,p);if(!m)return;this.modelTraits&Eg.HasMapboxMeshFeatures&&this.updateDEM(n,m,c,h);for(const v of this.getNodesInfo()){const b=v.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const E=b.footprint.vertices;let I=m.getElevationAt(E[0].x,E[0].y,!0,!0);for(let P=1;P<E.length;P++)I=Math.min(I,m.getElevationAt(E[P].x,E[P].y,!0,!0));b.elevation=I}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=s}}updateDEM(n,s,c,h){let p=s._dem._modifiedForSources[h];if(p===void 0&&(s._dem._modifiedForSources[h]=[],p=s._dem._modifiedForSources[h]),p.includes(c.canonical))return;const m=s._dem.dim;p.push(c.canonical);let v=!1;for(const b of this.getNodesInfo()){const E=b.node;if(!E.footprint||!E.footprint.grid)continue;const I=E.footprint.grid,P=s.tileCoordToPixel(I.min.x,I.min.y),M=s.tileCoordToPixel(I.max.x,I.max.y),z=Math.min(Math.min(m-M.y,P.x),Math.min(P.y,m-M.x));if(z<0)continue;const F=Gn(z,2,5);let V=Math.max(0,P.x-F),j=Math.max(0,P.y-F),K=Math.min(M.x+F,m-1),pe=Math.min(M.y+F,m-1);for(let Ce=j;Ce<=pe;++Ce)for(let ze=V;ze<=K;++ze)xp[Ce*m+ze]=255;let de=0,me=0;for(let Ce=0;Ce<I.cellsY;++Ce)for(let ze=0;ze<I.cellsX;++ze){if(!I.cells[Ce*I.cellsX+ze])continue;const $e=s.tileCoordToPixel(I.min.x+ze/I.xScale,I.min.y+Ce/I.yScale),Xe=s.tileCoordToPixel(I.min.x+(ze+1)/I.xScale,I.min.y+(Ce+1)/I.yScale);for(let tt=$e.y;tt<=Math.min(Xe.y+1,m-1);++tt)for(let Ke=$e.x;Ke<=Math.min(Xe.x+1,m-1);++Ke)xp[tt*m+Ke]===255&&(xp[tt*m+Ke]=0,de+=s.getElevationAtPixel(Ke,tt),me++)}const Ae=de/me;V=Math.max(1,P.x-F),j=Math.max(1,P.y-F),K=Math.min(M.x+F,m-2),pe=Math.min(M.y+F,m-2),v=!0;for(let Ce=j;Ce<=pe;++Ce)for(let ze=V;ze<=K;++ze)xp[Ce*m+ze]===0&&(VC[Ce*m+ze]=s._dem.set(ze,Ce,Ae));for(let Ce=1;Ce<F;++Ce){V=Math.max(1,P.x-Ce),j=Math.max(1,P.y-Ce),K=Math.min(M.x+Ce,m-2),pe=Math.min(M.y+Ce,m-2);for(let ze=j;ze<=pe;++ze)for(let $e=V;$e<=K;++$e){const Xe=ze*m+$e;if(xp[Xe]===255){let tt=0,Ke=0,lt=-1,Tt=-1;for(let ct=-1;ct<=1;++ct)for(let At=-1;At<=1;++At){const ot=(ze+ct)*m+$e+At;if(xp[ot]>=Ce)continue;const mt=VC[ot],Ot=Math.abs(mt);Ot>Ke&&(tt=mt,Ke=Ot,lt=At,Tt=ct)}if(Ke>.1){const ct=1-(Ce+.5*Math.abs(lt*Tt))/F;let At=s._dem.get($e,ze)+tt*ct;const ot=s._dem.get($e+lt,ze+Tt),mt=s._dem.get($e-lt,ze-Tt,!0);(At-ot)*(At-mt)>0&&(At=(ot+mt)/2),VC[Xe]=s._dem.set($e,ze,At),xp[Xe]=Ce}}}}}v&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=Qt.now())}getNodesInfo(){return this.nodesInfo}destroy(){const n=this.getNodesInfo();for(const s of n)nw(s.node),LC(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(n,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const c=s.getReplacementRegionsForTile(n.toUnwrapped()),h=this.getNodesInfo();for(let p=0;p<this.nodesInfo.length;p++){const m=h[p].node;h[p].hiddenByReplacement=!!m.footprint&&!c.find(v=>v.footprint===m.footprint)}}getHeightAtTileCoord(n,s){const c=this.getNodesInfo(),h=[],p=[0,0,0],m=a.ae.identity([]);for(let v=0;v<this.nodesInfo.length;v++){const b=c[v],E=b.node.meshes[0],I=E.transformedAabb;if(n<I.min[0]||s<I.min[1]||n>I.max[0]||s>I.max[1])continue;if(b.node.hidden===!0)return{height:0,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};a.ae.invert(m,b.node.matrix),p[0]=n,p[1]=s,a.$.transformMat4(p,p,m);const P=(p[0]-E.aabb.min[0])/(E.aabb.max[0]-E.aabb.min[0])*yp|0,M=Math.min(63,(p[1]-E.aabb.min[1])/(E.aabb.max[1]-E.aabb.min[1])*yp|0)*yp+Math.min(63,P),z=E.heightmap[M];if(!(z<0&&b.node.footprint))return b.hiddenByReplacement?void 0:{height:z,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};if(b.node.footprint.grid.query(new Nt(n,s),new Nt(n,s),h),h.length>0)return{height:void 0,maxHeight:b.feature.properties.height,hidden:b.hiddenByReplacement,verticalScale:b.evaluatedScale[2]}}}}function L0(i,n){return!i.isLightConstant&&n}function fK(i,n,s,c,h,p,m,v){let b=(61440&n|(61440&n)>>4)>>8,E=(3840&n|(3840&n)>>4)>>4,I=240&n|(240&n)>>4;s[3]>0&&(b=wn(b,255*s[0],s[3]),E=wn(E,255*s[1],s[3]),I=wn(I,255*s[2],s[3]));const P=b<<8|E,M=I<<8|Math.floor(255*c[3]),z=function(Ce){const ze=Gn(Ce,0,2);return Math.min(Math.round(.5*ze*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],F=Gn(h[0],0,1),V=Gn(h[1],0,1),j=Gn(h[2],0,1),K=Gn(h[3],0,1);let pe,de,me,Ae;if(F!==V&&m!==p&&V!==F){const Ce=m-p;de=1/(Ce*(V-F)),me=-(p+Ce*F)/(Ce*(V-F));const ze=Gn(h[4],-1,1);Ae=Math.pow(10,ze),pe=255*j<<8|255*K}else pe=65535,de=0,me=1,Ae=1;if(i.emplaceBack(P,M,z,pe,de,me,Ae),v){const Ce=v.length;v.clear();for(let ze=0;ze<Ce;ze++)v.emplaceBack(P,M,z,pe,de,me,Ae)}}function pK(i,n,s){const c=i.node;let h=0;const p=s&Eg.HasMeshoptCompression;for(const m of c.meshes){if(c.lights&&c.lightMeshIndex===h||!m.featureData)continue;m.featureArray=new ab,m.featureArray.reserve(m.featureData.length);let v=n;for(const b of m.featureData){const E=p?65535&b:b>>16&65535,I=p?b>>16&65535:65535&b,P=(15&I)<8?15&I:0,M=i.evaluatedRMEA[P],z=i.evaluatedColor[P],F=i.emissionHeightBasedParams[P];let V;if(v&&P===2&&c.lights&&(V=new ab,V.resize(10*c.lights.length)),fK(m.featureArray,E,z,M,F,m.aabb.min[2],m.aabb.max[2],V),V&&v){v=!1;const j=c.meshes[c.lightMeshIndex];j.featureArray=V,j.featureArray._trim()}}m.featureArray._trim(),h++}}function iN(i,n,s,c){const h=1<<i.z;n.lat=Vs((c/Lt+i.y)/h),n.lng=ca((s/Lt+i.x)/h)}je(aw,"Tiled3dModelBucket",{omit:["layers"]}),je(rN,"Tiled3dModelFeature");const mK={circle:class extends la{constructor(i,n,s,c){super(i,{layout:UL||(UL=new jr({"circle-sort-key":new sn(Qe.layout_circle["circle-sort-key"]),visibility:new It(Qe.layout_circle.visibility)})),paint:VL||(VL=new jr({"circle-radius":new sn(Qe.paint_circle["circle-radius"]),"circle-color":new sn(Qe.paint_circle["circle-color"]),"circle-blur":new sn(Qe.paint_circle["circle-blur"]),"circle-opacity":new sn(Qe.paint_circle["circle-opacity"]),"circle-translate":new It(Qe.paint_circle["circle-translate"]),"circle-translate-anchor":new It(Qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new It(Qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new It(Qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new sn(Qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new sn(Qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new sn(Qe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new It(Qe.paint_circle["circle-emissive-strength"])}))},n,s,c)}createBucket(i){return new BA(i)}queryRadius(i){const n=i;return ug("circle-radius",this,n)+ug("circle-stroke-width",this,n)+fb(this.paint.get("circle-translate"))}queryIntersectsFeature(i,n,s,c,h,p,m,v){const b=BL(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(n,s)+this.paint.get("circle-stroke-width").evaluate(n,s);return n4(i,c,p,m,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(i,n,s){const c=t4(this);return{config:new cp(this,{zoom:n,lut:s}),defines:c,overrideFog:!1}}},heatmap:class extends la{createBucket(i){return new i4(i)}constructor(i,n,s,c){super(i,{layout:l4||(l4=new jr({visibility:new It(Qe.layout_heatmap.visibility)})),paint:c4||(c4=new jr({"heatmap-radius":new sn(Qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new sn(Qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new It(Qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ho(Qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new It(Qe.paint_heatmap["heatmap-opacity"])}))},n,s,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=s0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return ug("heatmap-radius",this,i)}queryIntersectsFeature(i,n,s,c,h,p,m,v){const b=this.paint.get("heatmap-radius").evaluate(n,s);return n4(i,c,p,m,v,!0,!0,new Nt(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(i,n,s){return i==="heatmap"?{config:new cp(this,{zoom:n,lut:s}),overrideFog:!1}:{}}},hillshade:class extends la{constructor(i,n,s,c){super(i,{layout:u4||(u4=new jr({visibility:new It(Qe.layout_hillshade.visibility)})),paint:h4||(h4=new jr({"hillshade-illumination-direction":new It(Qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new It(Qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new It(Qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new It(Qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new It(Qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new It(Qe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new It(Qe.paint_hillshade["hillshade-emissive-strength"])}))},n,s,c)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(i,n,s){return{overrideFog:!1}}},fill:class extends la{constructor(i,n,s,c){super(i,{layout:g4||(g4=new jr({"fill-sort-key":new sn(Qe.layout_fill["fill-sort-key"]),visibility:new It(Qe.layout_fill.visibility)})),paint:_4||(_4=new jr({"fill-antialias":new It(Qe.paint_fill["fill-antialias"]),"fill-opacity":new sn(Qe.paint_fill["fill-opacity"]),"fill-color":new sn(Qe.paint_fill["fill-color"]),"fill-outline-color":new sn(Qe.paint_fill["fill-outline-color"]),"fill-translate":new It(Qe.paint_fill["fill-translate"]),"fill-translate-anchor":new It(Qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new sn(Qe.paint_fill["fill-pattern"]),"fill-emissive-strength":new It(Qe.paint_fill["fill-emissive-strength"])}))},n,s,c)}getProgramIds(){const i=this.paint.get("fill-pattern"),n=i&&i.constantOr(1),s=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(i,n,s){return{config:new cp(this,{zoom:n,lut:s}),overrideFog:!1}}recalculate(i,n){super.recalculate(i,n);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new wb(i)}queryRadius(){return fb(this.paint.get("fill-translate"))}queryIntersectsFeature(i,n,s,c,h,p){return!i.queryGeometry.isAboveHorizon&&OL(FL(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends la{constructor(i,n,s,c){super(i,{layout:tz||(tz=new jr({visibility:new It(Qe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new It(Qe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:nz||(nz=new jr({"fill-extrusion-opacity":new It(Qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new sn(Qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new It(Qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new It(Qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new sn(Qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new sn(Qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new sn(Qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new It(Qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new It(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new It(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new It(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new It(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new It(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new It(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new It(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new sn(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new sn(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new It(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new It(Qe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new It(Qe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new It(Qe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new It(Qe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new sn(Qe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-line-alignment":new It(Qe["paint_fill-extrusion"]["fill-extrusion-line-alignment"])}))},n,s,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new Rb(i)}queryRadius(){return fb(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(i,n,s,c,h,p,m,v,b){const E=BL(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(n,s),P=this.paint.get("fill-extrusion-base").evaluate(n,s),M=[0,0],z=v&&p.elevation,F=p.elevation?p.elevation.exaggeration():1,V=i.tile.getBucket(this);if(z&&V instanceof Rb){const me=V.centroidVertexArray,Ae=b+1;Ae<me.length&&(M[0]=me.geta_centroid_pos0(Ae),M[1]=me.geta_centroid_pos1(Ae))}if(M[0]===0&&M[1]===1)return!1;p.projection.name==="globe"&&(c=ez([c],[new Nt(0,0),new Nt(Lt,Lt)],i.tileID.canonical).map(me=>me.polygon).flat());const j=z?v:null,[K,pe]=function(me,Ae,Ce,ze,$e,Xe,tt,Ke,lt,Tt,ct){return me.projection.name==="globe"?function(At,ot,mt,Ot,ut,Ft,Dt,Et,gn,cn,Ht){const zt=[],In=[],dn=At.projection.upVectorScale(Ht,At.center.lat,At.worldSize).metersToTile,nn=[0,0,0,1],On=[0,0,0,1],zn=($n,ur,tr,Br)=>{$n[0]=ur,$n[1]=tr,$n[2]=Br,$n[3]=1},Ln=J4();mt>0&&(mt+=Ln),Ot+=Ln;for(const $n of ot){const ur=[],tr=[];for(const Br of $n){const $r=Br.x+ut.x,Nn=Br.y+ut.y,Rr=At.projection.projectTilePoint($r,Nn,Ht),Dr=At.projection.upVector(Ht,Br.x,Br.y);let Qr=mt,Pi=Ot;if(Dt){const Gi=iz($r,Nn,mt,Ot,Dt,Et,gn,cn);Qr+=Gi.base,Pi+=Gi.top}mt!==0?zn(nn,Rr.x+Dr[0]*dn*Qr,Rr.y+Dr[1]*dn*Qr,Rr.z+Dr[2]*dn*Qr):zn(nn,Rr.x,Rr.y,Rr.z),zn(On,Rr.x+Dr[0]*dn*Pi,Rr.y+Dr[1]*dn*Pi,Rr.z+Dr[2]*dn*Pi),a.$.transformMat4(nn,nn,Ft),a.$.transformMat4(On,On,Ft),ur.push(new pp(nn[0],nn[1],nn[2])),tr.push(new pp(On[0],On[1],On[2]))}zt.push(ur),In.push(tr)}return[zt,In]}(me,Ae,Ce,ze,$e,Xe,tt,Ke,lt,Tt,ct):tt?function(At,ot,mt,Ot,ut,Ft,Dt,Et,gn){const cn=[],Ht=[],zt=[0,0,0,1];for(const In of At){const dn=[],nn=[];for(const On of In){const zn=On.x+Ot.x,Ln=On.y+Ot.y,$n=iz(zn,Ln,ot,mt,Ft,Dt,Et,gn);zt[0]=zn,zt[1]=Ln,zt[2]=$n.base,zt[3]=1,a.aB.transformMat4(zt,zt,ut),zt[3]=Math.max(zt[3],1e-5);const ur=new pp(zt[0]/zt[3],zt[1]/zt[3],zt[2]/zt[3]);zt[0]=zn,zt[1]=Ln,zt[2]=$n.top,zt[3]=1,a.aB.transformMat4(zt,zt,ut),zt[3]=Math.max(zt[3],1e-5);const tr=new pp(zt[0]/zt[3],zt[1]/zt[3],zt[2]/zt[3]);dn.push(ur),nn.push(tr)}cn.push(dn),Ht.push(nn)}return[cn,Ht]}(Ae,Ce,ze,$e,Xe,tt,Ke,lt,Tt):function(At,ot,mt,Ot,ut){const Ft=[],Dt=[],Et=ut[8]*ot,gn=ut[9]*ot,cn=ut[10]*ot,Ht=ut[11]*ot,zt=ut[8]*mt,In=ut[9]*mt,dn=ut[10]*mt,nn=ut[11]*mt;for(const On of At){const zn=[],Ln=[];for(const $n of On){const ur=$n.x+Ot.x,tr=$n.y+Ot.y,Br=ut[0]*ur+ut[4]*tr+ut[12],$r=ut[1]*ur+ut[5]*tr+ut[13],Nn=ut[2]*ur+ut[6]*tr+ut[14],Rr=ut[3]*ur+ut[7]*tr+ut[15],Dr=Br+Et,Qr=$r+gn,Pi=Nn+cn,Gi=Math.max(Rr+Ht,1e-5),Ri=Br+zt,yi=$r+In,Ds=Nn+dn,ns=Math.max(Rr+nn,1e-5);zn.push(new pp(Dr/Gi,Qr/Gi,Pi/Gi)),Ln.push(new pp(Ri/ns,yi/ns,Ds/ns))}Ft.push(zn),Dt.push(Ln)}return[Ft,Dt]}(Ae,Ce,ze,$e,Xe)}(p,c,P,I,E,m,j,M,F,p.center.lat,i.tileID.canonical),de=i.queryGeometry;return function(me,Ae,Ce){let ze=1/0;OL(Ce,Ae)&&(ze=rz(Ce,Ae[0]));for(let $e=0;$e<Ae.length;$e++){const Xe=Ae[$e],tt=me[$e];for(let Ke=0;Ke<Xe.length-1;Ke++){const lt=Xe[Ke],Tt=[lt,Xe[Ke+1],tt[Ke+1],tt[Ke],lt];UA(Ce,Tt)&&(ze=Math.min(ze,rz(Ce,Tt)))}}return ze!==1/0&&ze}(K,pe,de.isPointQuery()?de.screenBounds:de.screenGeometry)}},line:class extends la{constructor(i,n,s,c){const h=f5();super(i,h,n,s,c),h.layout&&(this.layout=new Us(h.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof ld,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,n){super.recalculate(i,n),this.paint._values["line-floorwidth"]=(()=>{if(P0)return P0;const s=f5();return P0=new jX(s.paint.properties["line-width"].specification),P0.useIntegerZoom=!0,P0})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Mb(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(i,n,s){const c=pz(this);return{config:new cp(this,{zoom:n,lut:s}),defines:c,overrideFog:!1}}queryRadius(i){const n=i,s=g5(ug("line-width",this,n),ug("line-gap-width",this,n)),c=ug("line-offset",this,n);return s/2+Math.abs(c)+fb(this.paint.get("line-translate"))}queryIntersectsFeature(i,n,s,c,h,p){if(i.queryGeometry.isAboveHorizon)return!1;const m=FL(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),v=i.pixelToTileUnitsFactor/2*g5(this.paint.get("line-width").evaluate(n,s),this.paint.get("line-gap-width").evaluate(n,s)),b=this.paint.get("line-offset").evaluate(n,s);return b&&(c=function(E,I){const P=[],M=new Nt(0,0);for(let z=0;z<E.length;z++){const F=E[z],V=[];for(let j=0;j<F.length;j++){const K=F[j],pe=F[j+1],de=j===0?M:K.sub(F[j-1])._unit()._perp(),me=j===F.length-1?M:pe.sub(K)._unit()._perp(),Ae=de._add(me)._unit();Ae._mult(1/(Ae.x*me.x+Ae.y*me.y)),V.push(Ae._mult(I)._add(K))}P.push(V)}return P}(c,b*i.pixelToTileUnitsFactor)),function(E,I,P){for(let M=0;M<I.length;M++){const z=I[M];if(E.length>=3){for(let F=0;F<z.length;F++)if(vd(E,z[F]))return!0}if(pH(E,z,P))return!0}return!1}(m,c,v)}isTileClipped(){return!0}isDraped(i){const n=this.layout.get("line-z-offset");return n.isConstant()&&!n.constantOr(0)}},symbol:Kb,background:class extends la{constructor(i,n,s,c){super(i,{layout:y5||(y5=new jr({visibility:new It(Qe.layout_background.visibility)})),paint:v5||(v5=new jr({"background-color":new It(Qe.paint_background["background-color"]),"background-pattern":new It(Qe.paint_background["background-pattern"]),"background-opacity":new It(Qe.paint_background["background-opacity"]),"background-emissive-strength":new It(Qe.paint_background["background-emissive-strength"])}))},n,s,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(i,n,s){return{overrideFog:!1}}},raster:E5,"raster-particle":R5,sky:class extends la{constructor(i,n,s,c){super(i,{layout:A5||(A5=new jr({visibility:new It(Qe.layout_sky.visibility)})),paint:C5||(C5=new jr({"sky-type":new It(Qe.paint_sky["sky-type"]),"sky-atmosphere-sun":new It(Qe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new It(Qe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new It(Qe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new It(Qe.paint_sky["sky-gradient-radius"]),"sky-gradient":new ho(Qe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new It(Qe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new It(Qe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new It(Qe.paint_sky["sky-opacity"])}))},n,s,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=s0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(i,n){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),h=!c,p=i.style.light,m=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&_i("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?MC(m.azimuthal,90-m.polar,n):MC(c[0],90-c[1],n)}const s=this.paint.get("sky-gradient-center");return MC(s[0],90-s[1],n)}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}},slot:class extends la{constructor(i,n,s,c){super(i,{paint:P5||(P5=new jr({}))},n,null)}},model:class extends la{constructor(i,n,s,c){super(i,{layout:U5||(U5=new jr({visibility:new It(Qe.layout_model.visibility),"model-id":new sn(Qe.layout_model["model-id"])})),paint:V5||(V5=new jr({"model-opacity":new It(Qe.paint_model["model-opacity"]),"model-rotation":new sn(Qe.paint_model["model-rotation"]),"model-scale":new sn(Qe.paint_model["model-scale"]),"model-translation":new sn(Qe.paint_model["model-translation"]),"model-color":new sn(Qe.paint_model["model-color"]),"model-color-mix-intensity":new sn(Qe.paint_model["model-color-mix-intensity"]),"model-type":new It(Qe.paint_model["model-type"]),"model-cast-shadows":new It(Qe.paint_model["model-cast-shadows"]),"model-receive-shadows":new It(Qe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new It(Qe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new sn(Qe.paint_model["model-emissive-strength"]),"model-roughness":new sn(Qe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new sn(Qe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new It(Qe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new It(Qe.paint_model["model-front-cutoff"])}))},n,s,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new DC(i)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(i){return i instanceof aw?Lt-1:0}queryIntersectsFeature(i,n,s,c,h,p){if(!this.modelManager)return!1;const m=this.modelManager,v=i.tile.getBucket(this);if(!(v&&v instanceof DC))return!1;const b=v;for(const E in b.instancesPerModel){const I=b.instancesPerModel[E],P=n.id!==void 0?n.id:n.properties&&n.properties.hasOwnProperty("id")?n.properties.id:void 0;if(I.idToFeaturesIndex.hasOwnProperty(P)){const M=I.features[I.idToFeaturesIndex[P]],z=m.getModel(E,this.scope);if(!z)return!1;let F=a.ae.create();const V=new yr(0,0),j=b.canonical;let K=Number.MAX_VALUE;for(let pe=0;pe<M.instancedDataCount;++pe){const de=16*(M.instancedDataOffset+pe),me=I.instancedDataArray.float32,Ae=[me[de+4],me[de+5],me[de+6]];iN(j,V,me[de],0|me[de+1]),j5(F,z,p,V,M.rotation,M.scale,Ae,!1,!1,!1),p.projection.name==="globe"&&(F=kC(F,p));const Ce=a.ae.multiply([],p.projMatrix,F),ze=i.queryGeometry,$e=z5(ze.isPointQuery()?ze.screenBounds:ze.screenGeometry,p,Ce,z.aabb);$e!=null&&(K=Math.min($e,K))}return K!==Number.MAX_VALUE&&K}}return!1}_handleOverridablePaintPropertyUpdate(i,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven()||i!=="model-color"&&i!=="model-color-mix-intensity"&&i!=="model-rotation"&&i!=="model-scale"&&i!=="model-translation"&&i!=="model-emissive-strength")}_isPropertyZoomDependent(i){const n=this._transitionablePaint._values[i];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof Se}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(i,n,s,c){const h=i.tile,p=h.getBucket(this);let m=null,v=Number.MAX_VALUE;if(!(p&&p instanceof aw))return{queryFeature:m,intersectionZ:v};const b=p.getNodesInfo()[n];if(b.hiddenByReplacement||!b.node.meshes||!s.filter(new An(h.tileID.overscaledZ),b.feature,h.tileID.canonical))return{queryFeature:m,intersectionZ:v};const E=b.node,I=c.calculatePosMatrix(h.tileID.toUnwrapped(),c.worldSize),P=b.evaluatedScale;let M=0;c.elevation&&E.elevation&&(M=E.elevation*c.elevation.exaggeration()),a.ae.translate(I,I,[(E.anchor?E.anchor[0]:0)*(P[0]-1),(E.anchor?E.anchor[1]:0)*(P[1]-1),M]),a.ae.scale(I,I,P),a.ae.multiply(I,I,E.matrix);const z=i.queryGeometry,F=z.isPointQuery()?z.screenBounds:z.screenGeometry,V=function(K){const pe=a.ae.multiply([],I,K.matrix),de=a.ae.multiply(pe,c.expandedFarZProjMatrix,pe);for(let me=0;me<K.meshes.length;++me){const Ae=K.meshes[me];if(me===K.lightMeshIndex)continue;const Ce=z5(F,c,de,Ae.aabb);Ce!=null&&(v=Math.min(Ce,v))}if(K.children)for(const me of K.children)V(me)};if(V(E),v===Number.MAX_VALUE)return{queryFeature:m,intersectionZ:v};const j=new yr(0,0);return iN(h.tileID.canonical,j,b.node.anchor[0],b.node.anchor[1]),m={type:"Feature",geometry:{type:"Point",coordinates:[j.lng,j.lat]},properties:b.feature.properties,id:b.feature.id,state:{},layer:this.serialize()},{queryFeature:m,intersectionZ:v}}},clip:class extends la{constructor(i,n,s,c){super(i,{layout:y4||(y4=new jr({"clip-layer-types":new It(Qe.layout_clip["clip-layer-types"]),"clip-layer-scope":new It(Qe.layout_clip["clip-layer-scope"])})),paint:v4||(v4=new jr({}))},n,s,c)}recalculate(i,n){super.recalculate(i,n)}createBucket(i){return new x4(i)}isTileClipped(){return!0}is3D(){return!0}}};je(u5,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const sN=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class jC{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(n,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=c>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=sN[15&c];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(n,2,1),[v]=new Uint32Array(n,4,1);return new jC(v,m,p,n)}constructor(n,s=64,c=Float64Array,h){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const p=sN.indexOf(this.ArrayType),m=2*n*this.ArrayType.BYTES_PER_ELEMENT,v=n*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${c}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+v+b,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+m+v+b),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+v+b,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=n)}add(n,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=n,this.coords[this._pos++]=s,c}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return $C(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,s,c,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:v}=this,b=[0,p.length-1,0],E=[];for(;b.length;){const I=b.pop()||0,P=b.pop()||0,M=b.pop()||0;if(P-M<=v){for(let j=M;j<=P;j++){const K=m[2*j],pe=m[2*j+1];K>=n&&K<=c&&pe>=s&&pe<=h&&E.push(p[j])}continue}const z=M+P>>1,F=m[2*z],V=m[2*z+1];F>=n&&F<=c&&V>=s&&V<=h&&E.push(p[z]),(I===0?n<=F:s<=V)&&(b.push(M),b.push(z-1),b.push(1-I)),(I===0?c>=F:h>=V)&&(b.push(z+1),b.push(P),b.push(1-I))}return E}within(n,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:m}=this,v=[0,h.length-1,0],b=[],E=c*c;for(;v.length;){const I=v.pop()||0,P=v.pop()||0,M=v.pop()||0;if(P-M<=m){for(let j=M;j<=P;j++)aN(p[2*j],p[2*j+1],n,s)<=E&&b.push(h[j]);continue}const z=M+P>>1,F=p[2*z],V=p[2*z+1];aN(F,V,n,s)<=E&&b.push(h[z]),(I===0?n-c<=F:s-c<=V)&&(v.push(M),v.push(z-1),v.push(1-I)),(I===0?n+c>=F:s+c>=V)&&(v.push(z+1),v.push(P),v.push(1-I))}return b}}function $C(i,n,s,c,h,p){if(h-c<=s)return;const m=c+h>>1;oN(i,n,m,c,h,p),$C(i,n,s,c,m-1,1-p),$C(i,n,s,m+1,h,1-p)}function oN(i,n,s,c,h,p){for(;h>c;){if(h-c>600){const E=h-c+1,I=s-c+1,P=Math.log(E),M=.5*Math.exp(2*P/3),z=.5*Math.sqrt(P*M*(E-M)/E)*(I-E/2<0?-1:1);oN(i,n,s,Math.max(c,Math.floor(s-I*M/E+z)),Math.min(h,Math.floor(s+(E-I)*M/E+z)),p)}const m=n[2*s+p];let v=c,b=h;for(z0(i,n,c,s),n[2*h+p]>m&&z0(i,n,c,h);v<b;){for(z0(i,n,v,b),v++,b--;n[2*v+p]<m;)v++;for(;n[2*b+p]>m;)b--}n[2*c+p]===m?z0(i,n,c,b):(b++,z0(i,n,b,h)),b<=s&&(c=b+1),s<=b&&(h=b-1)}}function z0(i,n,s,c){GC(i,s,c),GC(n,2*s,2*c),GC(n,2*s+1,2*c+1)}function GC(i,n,s){const c=i[n];i[n]=i[s],i[s]=c}function aN(i,n,s,c){const h=i-s,p=n-c;return h*h+p*p}a.A=qm,a.B=ep,a.C=wr,a.D=Qf,a.E=$u,a.F=Oo,a.H=oc,a.I=gp,a.J=N,a.K=C,a.L=function(i){const n=i.value;let s=[];if(!n)return s;const c=Gc(n);return c!=="string"?(s=s.concat([new tw(i.key,n,`string expected, "${c}" found`)]),s):(N5(n,!0)||(s=s.concat([new tw(i.key,n,`invalid url "${n}"`)])),s)},a.M=class{constructor(i,n,s,c){this.id=i,this.position=n!=null?new yr(n[0],n[1]):new yr(0,0),this.orientation=s??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new li([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(i,n){if(a.ae.multiply(i.matrix,n,i.matrix),i.meshes)for(const s of i.meshes){const c=li.applyTransformFast(s.aabb,i.matrix);this.aabb.encapsulate(c)}if(i.children)for(const s of i.children)this._applyTransformations(s,i.matrix)}computeBoundsAndApplyParent(){const i=a.ae.identity([]);for(const n of this.nodes)this._applyTransformations(n,i)}computeModelMatrix(i,n,s,c,h,p,m=!1){j5(this.matrix,this,i.transform,this.position,n,s,c,h,p,m)}upload(i){if(!this.uploaded){for(const n of this.nodes)OC(n,i);for(const n of this.nodes)nw(n);this.uploaded=!0}}destroy(){for(const i of this.nodes)LC(i)}},a.N=Qe,a.O=Qs,a.P=Nt,a.Q=ws,a.R=Df,a.S=EA,a.T=wl,a.U=jr,a.V=tw,a.W=It,a.X=class{constructor(i){this.specification=i}possiblyEvaluate(i,n){return Ql(i.expression.evaluate(n))}interpolate(i,n,s){return{x:wn(i.x,n.x,s),y:wn(i.y,n.y,s),z:wn(i.z,n.z,s),azimuthal:wn(i.azimuthal,n.azimuthal,s),polar:wn(i.polar,n.polar,s)}}},a.Y=An,a.Z=Se,a._=fo,a.a=Ea,a.a$=qA,a.a0=Qo,a.a1=Us,a.a2=rh,a.a3=wn,a.a4=Lt,a.a5=Ay,a.a6=class{constructor(i){this.specification=i}possiblyEvaluate(i,n){return function([s,c]){const h=Ql([1,s,c]);return{x:h.x,y:h.y,z:h.z}}(i.expression.evaluate(n))}interpolate(i,n,s){return{x:wn(i.x,n.x,s),y:wn(i.y,n.y,s),z:wn(i.z,n.z,s)}}},a.a7=Jy,a.a8=cb,a.a9=Ju,a.aA=function(i,n,s){i[4*n+0]=s[0],i[4*n+1]=s[1],i[4*n+2]=s[2],i[4*n+3]=s[3]},a.aC=function(i,n){const{x:s,y:c}=i.point,h=QL(s,c,i.worldSize/i._pixelsPerMercatorPixel,0,0);return a.ae.multiply(h,h,XA(Qc(n)))},a.aE=gg,a.aF=Za,a.aG=Ob,a.aH=function(i,n,s,c,h){const p=5*n+2;i.float32[p+0]=s,i.float32[p+1]=c,i.float32[p+2]=h},a.aI=qb,a.aJ=yr,a.aK=Jz,a.aL=CL,a.aM=WA,a.aN=k5,a.aO=hp,a.aP=XL,a.aQ=ds,a.aR=function(i,n,s,c,h,p,m,v,b){if(b.name==="globe")return XL(i,n,new hp(s,c,h),!1);const E=mp({z:s,x:c,y:h},b);return new li([(p+E.x/E.scale)*n,n*(E.y/E.scale),m],[(p+E.x2/E.scale)*n,n*(E.y2/E.scale),v])},a.aS=function(i,n,s){let c=0;for(let h=0;h<2;++h)i[h]>0&&(c+=(i[h]-0)*(i[h]-0)),n[h]<0&&(c+=(0-n[h])*(0-n[h]));return c},a.aT=Ui,a.aU=GA,a.aV=IL,a.aW=function(i){const n=a.ae.identity(new Float64Array(16));a.ae.multiply(n,i.pixelMatrix,i.globeMatrix);const s=[0,xl,0],c=[0,bl,0];return a.$.transformMat4(s,s,n),a.$.transformMat4(c,c,n),[s[0]>0&&s[0]<=i.width&&s[1]>0&&s[1]<=i.height&&!YA(i,new yr(i.center.lat,90)),c[0]>0&&c[0]<=i.width&&c[1]>0&&c[1]<=i.height&&!YA(i,new yr(i.center.lat,-90))]},a.aX=function(i,n){const{scale:s}=i.tileTransform,c=s*Lt/(i.tileSize*Math.pow(2,n.zoom-i.tileID.overscaledZ+i.tileID.canonical.z));return a.aD.scale(new Float32Array(4),n.inverseAdjustmentMatrix,[c,c])},a.aY=Jb,a.aZ=M5,a.a_=function(i){const n=M5(i,!0);return a.aD.invert([],[n[0],n[1],n[4],n[5]])},a.aa=EL,a.ab=Lo,a.ac=Qn,a.ad=function(i,n,s){const c=Math.sqrt(i*i+n*n+s*s),h=c>0?Math.acos(s/c)*oi:0;let p=i!==0||n!==0?Math.atan2(-n,-i)*oi+90:0;return p<0&&(p+=360),[c,p,h]},a.af=wg,a.ag=fc,a.ah=bC,a.ai=function(i,n){const s={};for(let c=0;c<n.length;c++){const h=n[c];h in i&&(s[h]=i[h])}return s},a.aj=yd,a.ak=Kc,a.al=Yc,a.am=aL,a.an=function(i){Im++,Im>Ss&&(i.getActor().send("enforceCacheSizeLimit",Es),Im=0)},a.ao=wy,a.ap=class{constructor(i){this.entries={},this.scheduler=i}request(i,n,s,c){const h=this.entries[i]=this.entries[i]||{callbacks:[]};if(h.result){const[p,m]=h.result;return this.scheduler?this.scheduler.add(()=>{c(p,m)},n):c(p,m),()=>{}}return h.callbacks.push(c),h.cancel||(h.cancel=s((p,m)=>{h.result=[p,m];for(const v of h.callbacks)this.scheduler?this.scheduler.add(()=>{v(p,m)},n):v(p,m);setTimeout(()=>delete this.entries[i],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(p=>p!==c),h.callbacks.length||(h.cancel(),delete this.entries[i]))}}},a.aq=function(i,n,s){const c=JSON.stringify(i.request);return i.data&&(this.deduped.entries[c]={result:[null,i.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},h=>{const p=Bu(i.request,(m,v,b,E)=>{m?h(m):v&&h(null,{vectorTile:s?void 0:new iC(new p0(v)),rawData:v,cacheControl:b,expires:E})});return()=>{p.cancel(),h()}},n)},a.ar=CA,a.as=class extends Qu{constructor(i){super(i),this.current=eH}set(i,n,s){if(this.fetchUniformLocation(i,n)){for(let c=0;c<9;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},a.at=PA,a.au=Gn,a.av=Zl,a.ax=R,a.ay=No,a.az=Vs,a.b=pi,a.b$=lH,a.b0=function(i){const{x:n,y:s}=i.point,{lng:c,lat:h}=i._center;return QL(n,s,i.worldSize,c,h)},a.b1=Xs,a.b2=lg,a.b3=kA,a.b4=function(i){const n=Math.round((i+45+360)%360/90)%4;return Fc[n]},a.b5=45,a.b6=LA,a.b7=ub,a.b8=li,a.b9=Ql,a.bA=Xb,a.bB=a4,a.bC=function(i,n){return[Math.pow(i[0],2.2)*n,Math.pow(i[1],2.2)*n,Math.pow(i[2],2.2)*n]},a.bD=hz,a.bF=YL,a.bG=ht,a.bH=ke,a.bI=256,a.bJ=function(i,n){const s=[0,0,0],c=i0(Qc(n.canonical));return a.$.transformMat4(s,s,c),a.$.transformMat4(s,s,i),s},a.bK=i=>({u_camera_to_center_distance:new Lo(i),u_extrude_scale:new RA(i),u_device_pixel_ratio:new Lo(i),u_matrix:new Jy(i),u_inv_rot_matrix:new Jy(i),u_merc_center:new Ju(i),u_tile_id:new CA(i),u_zoom_transition:new Lo(i),u_up_dir:new CA(i),u_emissive_strength:new Lo(i)}),a.bL=i=>({u_matrix:new Jy(i),u_pixels_to_tile_units:new RA(i),u_device_pixel_ratio:new Lo(i),u_units_to_pixels:new Ju(i),u_dash_image:new cb(i),u_gradient_image:new cb(i),u_image_height:new Lo(i),u_texsize:new Ju(i),u_tile_units_to_pixels:new Lo(i),u_alpha_discard_threshold:new Lo(i),u_trim_offset:new Ju(i),u_trim_fade_range:new Ju(i),u_trim_color:new PA(i),u_emissive_strength:new Lo(i)}),a.bM=i=>({u_matrix:new Jy(i),u_texsize:new Ju(i),u_pixels_to_tile_units:new RA(i),u_device_pixel_ratio:new Lo(i),u_image:new cb(i),u_units_to_pixels:new Ju(i),u_tile_units_to_pixels:new Lo(i),u_alpha_discard_threshold:new Lo(i),u_trim_offset:new Ju(i)}),a.bN=_A,a.bO=TZ,a.bP=to,a.bQ=UZ,a.bR=Gz,a.bS=dC,a.bT=t4,a.bU=(i,n,s,c,h,p)=>{const m=i.transform,v=m.projection.name==="globe";let b;if(p.paint.get("circle-pitch-alignment")==="map")if(v){const I=YL(m.zoom,n.canonical)*m._pixelsPerMercatorPixel;b=Float32Array.from([I,0,0,I])}else b=m.calculatePixelsToTileUnitsMatrix(s);else b=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:i.transform.getCameraToCenterDistance(m.projection),u_matrix:i.translatePosMatrix(n.projMatrix,s,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Qt.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:wH,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(v){E.u_inv_rot_matrix=c,E.u_merc_center=h,E.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],E.u_zoom_transition=rh(m.zoom);const I=h[0]*Lt,P=h[1]*Lt;E.u_up_dir=m.projection.upVector(new hp(0,0,0),I,P)}return E},a.bV=pz,a.bW=(i,n,s,c,h,p)=>{const m=i.transform;return{u_matrix:fz(i,n,s,c),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:m.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:h,u_image:0,u_tile_units_to_pixels:dz(n,m),u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:p}},a.bX=(i,n,s,c,h,p,m)=>{const v=i.transform,b=v.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:fz(i,n,s,c),u_pixels_to_tile_units:b,u_device_pixel_ratio:p,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:mz(s)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:dz(n,i.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toRenderColor(s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength")}},a.bY=va,a.bZ=s0,a.b_=J4,a.ba=function(i){return[Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2)]},a.bb=Lu,a.bc=function(i,n,s){const c=rh(s.zoom),h=i.style.map._antialias,p=n.options.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return c===0&&!h&&!p},a.bd=function(i){const n=i.pixelsPerMeter,s=n/No(1,i.center.lat),c=a.ae.identity(new Float64Array(16));return a.ae.translate(c,c,[i.point.x,i.point.y,0]),a.ae.scale(c,c,[s,s,n]),Float32Array.from(c)},a.be=gb,a.bf=function(i){const n=Ui-5;i=Gn(i,-n,n)/n*90;const s=Math.pow(Math.abs(Math.sin(Qn(i))),3);return Math.round(s*(DA.length-1))},a.bg=function(i,n,s,c){const h=n.getNorth(),p=n.getSouth(),m=n.getWest(),v=n.getEast(),b=1<<i.z,E=v-m,I=h-p,P=E/sg,M=-I/DA[s],z=[0,P,0,M,0,0,h,m,0];if(i.z>0){const F=180/c;a.bE.multiply(z,z,[F/E+1,0,0,0,F/I+1,0,-.5*F/P,.5*F/M,1])}return z[2]=b,z[5]=i.x,z[8]=i.y,z},a.bh=i0,a.bi=Qc,a.bj=function(i,n,s){const c=a.ae.identity(new Float64Array(16)),h=(n/(1<<i)-.5)*Math.PI*2;return a.ae.rotateY(c,s.globeMatrix,h),Float32Array.from(c)},a.bk=kt,a.bl=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},a.bm=E5,a.bn=R5,a.bo=T5,a.bp=function(i,n){const s=document.createElement("video");s.muted=!0,s.onloadstart=function(){n(null,s)};for(let c=0;c<i.length;c++){const h=document.createElement("source");FI(i[c])||(s.crossOrigin="Anonymous"),h.src=i[c],s.appendChild(h)}return{cancel:()=>{}}},a.bq=Wb,a.br=Fu,a.bs=class{isDataAvailableAtPoint(i){const n=this._source();if(this.isUsingMockSource()||!n||i.y<0||i.y>1)return!1;const s=n.getSource().maxzoom,c=1<<s,h=Math.floor(i.x),p=Math.floor((i.x-h)*c),m=Math.floor(i.y*c),v=this.findDEMTileFor(new ds(s,h,s,p,m));return!(!v||!v.dem)}getAtPointOrZero(i,n=0){return this.getAtPoint(i,n)||0}getAtPoint(i,n,s=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const c=this._source();if(!c||i.y<0||i.y>1)return n;const h=c.getSource().maxzoom,p=1<<h,m=Math.floor(i.x),v=i.x-m,b=new ds(h,m,h,Math.floor(v*p),Math.floor(i.y*p)),E=this.findDEMTileFor(b);if(!E||!E.dem)return n;const I=E.dem,P=1<<E.tileID.canonical.z,M=(v*P-E.tileID.canonical.x)*I.dim,z=(i.y*P-E.tileID.canonical.y)*I.dim,F=Math.floor(M),V=Math.floor(z);return(s?this.exaggeration():1)*wn(wn(I.get(F,V),I.get(F,V+1),z-V),wn(I.get(F+1,V),I.get(F+1,V+1),z-V),M-F)}getAtTileOffset(i,n,s){const c=1<<i.canonical.z;return this.getAtPointOrZero(new fo(i.wrap+(i.canonical.x+n/Lt)/c,(i.canonical.y+s/Lt)/c))}getAtTileOffsetFunc(i,n,s,c){return h=>{const p=this.getAtTileOffset(i,h.x,h.y),m=c.upVector(i.canonical,h.x,h.y),v=c.upVectorScale(i.canonical,n,s).metersToTile;return a.$.scale(m,m,p*v),m}}getForTilePoints(i,n,s,c){if(this.isUsingMockSource())return!1;const h=fg.create(this,i,c);return!!h&&(n.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],s)}),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(i);if(!n||!n.dem)return null;const s=n.dem.tree,c=n.tileID,h=1<<i.canonical.z-c.canonical.z;let p=i.canonical.x/h-c.canonical.x,m=i.canonical.y/h-c.canonical.y,v=0;for(let b=0;b<i.canonical.z-c.canonical.z&&!s.leaves[v];b++){p*=2,m*=2;const E=2*Math.floor(m)+Math.floor(p);v=s.childOffsets[v]+E,p%=1,m%=1}return{min:this.exaggeration()*s.minimums[v],max:this.exaggeration()*s.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,n,s){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const i=this.visibleDemTiles;if(i.length===0)return null;let n=!1,s=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const h of i){const p=this.getMinMaxForTile(h.tileID);p&&(s=Math.min(s,p.min),c=Math.max(c,p.max),n=!0)}return n?{min:s,max:c}:null}},a.bt=n0,a.bu=mb,a.bv=lc,a.bw=ks,a.bx=_p,a.by=Sg,a.bz=rw,a.c=J5,a.c$=function(i,n,s,c){return i.type==="custom"?new GX(i,n):new mK[i.type](i,n,s,c)},a.c0=Rb,a.c1=wd,a.c2=450,a.c3=7,a.c4=$X,a.c5=h5,a.c6=256,a.c7=HL,a.c8=XA,a.c9=Pr,a.cA=NL,a.cB=function(i,n,s=0){return a.$.fromValues(((n.x-s)*i.scale-i.x)*Lt,(n.y*i.scale-i.y)*Lt,PL(n.z,n.y))},a.cC=function(i){let n=1/0,s=1/0,c=-1/0,h=-1/0;for(const p of i)n=Math.min(n,p.x),s=Math.min(s,p.y),c=Math.max(c,p.x),h=Math.max(h,p.y);return{min:new Nt(n,s),max:new Nt(c,h)}},a.cD=vd,a.cE=kL,a.cF=zo,a.cG=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.cH=Nz,a.cI=UA,a.cJ=A4,a.cK=k4,a.cL=D4,a.cM=gC,a.cN=jC,a.cO=function(i){return i({pluginStatus:zr,pluginURL:cr}),Xn.on("pluginStateChange",i),i},a.cP=yg,a.cQ=pC,a.cR=yy,a.cS=Or,a.cT=H,a.cU=us,a.cV=Rm,a.cW=Rs,a.cX=function(i){const n=i.indexOf(nb);return n>=0?i.slice(0,n):i},a.cY=function(i){return i.indexOf(nb)>=0},a.cZ=function(i){const n=i.indexOf(nb);return n>=0?i.slice(n+1):""},a.c_=function(i){const n=[],s=i.id;return s===void 0&&n.push({message:`layers.${s}: missing required property "id"`}),i.render===void 0&&n.push({message:`layers.${s}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&n.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),n},a.ca=fd,a.cb=lp,a.cc=1,a.cd=T0,a.ce=0,a.cf=bA,a.cg=function(i,n,s,c,h){return Gn((i-n)/(s-n)*(h-c)+c,c,h)},a.ch=J1,a.ci=dp,a.cj=class{constructor(i,n,s,c){this.context=i,this.format=c,this.size=s,this.texture=i.gl.createTexture();const[h,p,m]=this.size,{gl:v}=i;v.bindTexture(v.TEXTURE_3D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(!1);let b=this.format,E=v.UNSIGNED_BYTE;this.format===v.DEPTH_COMPONENT&&(b=v.DEPTH_COMPONENT16,E=v.UNSIGNED_SHORT),this.format===v.R8&&(c=v.RED),this.format===v.R32F&&(E=v.FLOAT,c=v.RED),v.texImage3D(v.TEXTURE_3D,0,b,h,p,m,0,c,E,n.data)}bind(i,n){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_3D,this.texture),i!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,i),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,i),this.minFilter=i),n!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,n),this.wrapS=n)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}},a.ck=kC,a.cl=[1,1,1],a.cm=fg,a.cn=Eg,a.co=md,a.cp=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Nt(1/0,1/0),max:new Nt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(i,n=!1){const s=P4(new Nt(0,0),new Nt(Lt,Lt),i),c=[];if(n&&!sC(s,this._globalClipBounds))return c;for(const h of this._activeRegions){if(h.hiddenByOverlap||!sC(s,h))continue;const p=QH(h.min,h.max,i);c.push({min:p.min,max:p.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return c}setSources(i){this._setSources(i.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const s=[];for(const c of n.cache.getVisibleCoordinates()){const h=n.cache.getTile(c).buckets[n.layer];h&&h.updateFootprints(c.toUnwrapped(),s)}return s},getOrder:()=>n.order,getClipMask:()=>n.clipMask,getClipScope:()=>n.clipScope})))}_addSource(i){const n=i.getFootprints();if(n.length===0)return;const s=i.getOrder(),c=i.getClipMask(),h=i.getClipScope();for(const p of n){if(!p.footprint)continue;const m=P4(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:s,clipMask:c,clipScope:h})}this._sourceIds.push(i.getSourceId())}_computeReplacement(){this._activeRegions.sort((n,s)=>n.priority-s.priority||Ab(n.min,s.min)||Ab(n.max,s.max)||n.order-s.order||n.clipMask-s.clipMask||function(c,h){const p=(m,v)=>m+v;return c.length-h.length||c.reduce(p,"").localeCompare(h.reduce(p,""))}(n.clipScope,s.clipScope));let i=this._activeRegions.length!==this._prevRegions.length;if(!i){let n=0;for(;!i&&n!==this._activeRegions.length;){const s=this._activeRegions[n],c=this._prevRegions[n];i=s.priority!==c.priority||!C4(s,c)||s.order!==c.order||s.clipMask!==c.clipMask||!Hl(s.clipScope,c.clipScope),++n}}if(i){++this._updateTime;for(const s of this._activeRegions)s.order!==Ib&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));const n=s=>{const c=this._activeRegions;if(s>=c.length)return s;const h=c[s].priority;for(;s<c.length&&c[s].priority===h;)++s;return s};if(this._sourceIds.length>1){let s=0,c=n(s);for(;s!==c;){let h=s;const p=s;for(;h!==c;){const m=this._activeRegions[h];m.hiddenByOverlap=!1;for(let v=0;v<p;v++){const b=this._activeRegions[v];if(!b.hiddenByOverlap&&m.order===Ib&&sC(m,b)&&(m.hiddenByOverlap=M4(m.footprint,m.tileId,b.footprint,b.tileId),m.hiddenByOverlap))break}++h}s=c,c=n(s)}}}}_setSources(i){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=i.length-1;n>=0;n--)this._addSource(i[n]);this._computeReplacement()}},a.cq=Yu,a.cr=Zb,a.cs=Ky,a.ct=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy()}_fillGridMeshWithLods(i,n){const s=new lc,c=new ks,h=[],p=i+1+2,m=n[0]+1,v=n[0]+1+(1+n.length),b=(E,I,P)=>{let M=E===p-1?E-2:E===0?E:E-1;return M+=P?24575:0,[M,I]};for(let E=0;E<p;++E)s.emplaceBack(...b(E,0,!0));for(let E=0;E<m;++E)for(let I=0;I<p;++I)s.emplaceBack(...b(I,E,(I===0||I===p-1)&&!0));for(let E=0;E<n.length;++E){const I=n[E];for(let P=0;P<p;++P)s.emplaceBack(...b(P,I,!0))}for(let E=0;E<n.length;++E){const I=c.length,P=n[E]+1+2,M=new ks;for(let V=0;V<P-1;V++){const j=V===P-2,K=j?p*(v-n.length+E-V):p;for(let pe=0;pe<p-1;pe++){const de=V*p+pe;V===0||j||pe===0||pe===p-2?(M.emplaceBack(de+1,de,de+K),M.emplaceBack(de+K,de+K+1,de+1)):(c.emplaceBack(de+1,de,de+K),c.emplaceBack(de+K,de+K+1,de+1))}}const z=pi.simpleSegment(0,I,s.length,c.length-I);for(let V=0;V<M.uint16.length;V+=3)c.emplaceBack(M.uint16[V],M.uint16[V+1],M.uint16[V+2]);const F=pi.simpleSegment(0,I,s.length,c.length-I);h.push({withoutSkirts:z,withSkirts:F})}return{vertices:s,indices:c,segments:h}}_createGrid(i){const n=this._fillGridMeshWithLods(sg,DA);this._gridSegments=n.segments,this._gridBuffer=i.createVertexBuffer(n.vertices,n0.members),this._gridIndexBuffer=i.createIndexBuffer(n.indices,!0)}_createPoles(i){const n=new ks;for(let m=0;m<=sg;m++)n.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=i.createIndexBuffer(n,!0);const s=new lp,c=new lp,h=new lp,p=new lp;this._poleSegments=[];for(let m=0,v=0;m<kA;m++){const b=360/(1<<m);s.emplaceBack(0,-zo,0,.5,0),c.emplaceBack(0,-zo,0,.5,1),h.emplaceBack(0,-zo,0,.5,.5),p.emplaceBack(0,-zo,0,.5,.5);for(let E=0;E<=sg;E++){let I=E/sg,P=0;const M=wn(0,b,I),[z,F,V]=og(xH,bH,M,zo);s.emplaceBack(z,F,V,I,P),c.emplaceBack(z,F,V,I,1-P);const j=Qn(M);I=.5+.5*Math.sin(j),P=.5+.5*Math.cos(j),h.emplaceBack(z,F,V,I,P),p.emplaceBack(z,F,V,I,1-P)}this._poleSegments.push(pi.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(s,pb,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(c,pb,!1),this._texturedPoleNorthVertexBuffer=i.createVertexBuffer(h,pb,!1),this._texturedPoleSouthVertexBuffer=i.createVertexBuffer(p,pb,!1)}getGridBuffers(i,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}},a.cu=function(i){return Ff.has(i)},a.cv=Ib,a.cw=V4,a.cx=function(i,n,s=0,c=!0){const h=new Nt(s,s),p=i.sub(h),m=n.add(h),v=[p,new Nt(m.x,p.y),m,new Nt(p.x,m.y)];return c&&v.push(p.clone()),v},a.cy=function(i,n){const s=[];for(let c=0;c<i.length;c++){const h=Zl(c-1,-1,i.length-1),p=Zl(c+1,-1,i.length-1),m=i[c],v=i[p],b=i[h].sub(m).unit(),E=v.sub(m).unit(),I=E.angleWithSep(b.x,b.y),P=b.add(E).unit().mult(-1*n/Math.sin(I/2));s.push(m.add(P))}return s},a.cz=Zz,a.d=Hl,a.d$=A0,a.d0=Ts,a.d1=Xn,a.d2=gl,a.d3=zu,a.d4=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.d5=co,a.d6=ML,a.d7=up,a.d8=function([i,n,s]){const c=Math.hypot(i,n,s),h=Math.atan2(i,s),p=.5*Math.PI-Math.acos(-n/c);return new yr(Xs(h),Xs(p))},a.d9=ca,a.dA=function(){rw().acquire(zC)},a.dB=function(){const i=D0;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(zC),D0=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.dC=k0,a.dD=function(i){const n=Kh();if(!n)return;const s=n.delete(Vr);i&&s.catch(i).then(()=>i())},a.dE=M0,a.dF=G5,a.dG=function(i){NC=Qt.resolveURL(i),Ag||(Ag=new Sg(rw(),new $u)),Ag.broadcast("setDracoUrl",NC)},a.dH=q5,a.dI=function(i){Ig=Qt.resolveURL(i),Ag||(Ag=new Sg(rw(),new $u)),Ag.broadcast("setMeshoptUrl",Ig)},a.dJ=Xl,a.dK=je,a.dL=xd,a.dM=dc,a.dN=mp,a.dO=IA,a.dP=gz,a.dQ=Tz,a.dR=az,a.dS=Bc,a.dT=Bz,a.dU=bg,a.dV=function(i,n,s,c,h,p,m,v,b,E,I){i.createArrays(),i.tilePixelRatio=Lt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const P=i.layers[0].layout,M=i.layers[0]._unevaluatedLayout._values,z={};if(i.textSizeData.kind==="composite"){const{minZoom:K,maxZoom:pe}=i.textSizeData;z.compositeTextSizes=[M["text-size"].possiblyEvaluate(new An(K),v),M["text-size"].possiblyEvaluate(new An(pe),v)]}if(i.iconSizeData.kind==="composite"){const{minZoom:K,maxZoom:pe}=i.iconSizeData;z.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new An(K),v),M["icon-size"].possiblyEvaluate(new An(pe),v)]}z.layoutTextSize=M["text-size"].possiblyEvaluate(new An(b+1),v),z.layoutIconSize=M["icon-size"].possiblyEvaluate(new An(b+1),v),z.textMaxSize=M["text-size"].possiblyEvaluate(new An(18),v);const F=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",V=P.get("text-size");let j=!1;for(const K of i.features)if(K.icon&&K.icon.nameSecondary){j=!0;break}for(const K of i.features){const pe=P.get("text-font").evaluate(K,{},v).join(","),de=V.evaluate(K,{},v),me=z.layoutTextSize.evaluate(K,{},v),Ae=(z.layoutIconSize.evaluate(K,{},v),{horizontal:{},vertical:void 0}),Ce=K.text;let ze,$e=[0,0];if(Ce){const Ke=Ce.toString(),lt=P.get("text-letter-spacing").evaluate(K,{},v)*to,Tt=P.get("text-line-height").evaluate(K,{},v)*to,ct=gt(Ke)?lt:0,At=P.get("text-anchor").evaluate(K,{},v),ot=P.get("text-variable-anchor");if(!ot){const Dt=P.get("text-radial-offset").evaluate(K,{},v);$e=Dt?Gz(At,[Dt*to,mC]):P.get("text-offset").evaluate(K,{},v).map(Et=>Et*to)}let mt=F?"center":P.get("text-justify").evaluate(K,{},v);const Ot=P.get("symbol-placement")==="point",ut=Ot?P.get("text-max-width").evaluate(K,{},v)*to:1/0,Ft=Dt=>{i.allowVerticalPlacement&&ft(Ke)&&(Ae.vertical=hC(Ce,n,s,h,pe,ut,Tt,At,Dt,ct,$e,Za.vertical,!0,me,de))};if(!F&&ot){const Dt=mt==="auto"?ot.map(gn=>gC(gn)):[mt];let Et=!1;for(let gn=0;gn<Dt.length;gn++){const cn=Dt[gn];if(!Ae.horizontal[cn])if(Et)Ae.horizontal[cn]=Ae.horizontal[0];else{const Ht=hC(Ce,n,s,h,pe,ut,Tt,"center",cn,ct,$e,Za.horizontal,!1,me,de);Ht&&(Ae.horizontal[cn]=Ht,Et=Ht.positionedLines.length===1)}}Ft("left")}else{if(mt==="auto"&&(mt=gC(At)),Ot||P.get("text-writing-mode").indexOf("horizontal")>=0||!ft(Ke)){const Dt=hC(Ce,n,s,h,pe,ut,Tt,At,mt,ct,$e,Za.horizontal,!1,me,de);Dt&&(Ae.horizontal[mt]=Dt)}Ft(Ot?"left":mt)}}let Xe=!1;if(K.icon&&K.icon.namePrimary){const Ke=c[K.icon.namePrimary];Ke&&(ze=XZ(h[K.icon.namePrimary],K.icon.nameSecondary?h[K.icon.nameSecondary]:void 0,P.get("icon-offset").evaluate(K,{},v),P.get("icon-anchor").evaluate(K,{},v)),Xe=Ke.sdf,i.sdfIcons===void 0?i.sdfIcons=Ke.sdf:i.sdfIcons!==Ke.sdf&&_i("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ke.pixelRatio!==i.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const tt=Wz(Ae.horizontal)||Ae.vertical;i.iconsInText||(i.iconsInText=!!tt&&tt.iconsInText),(tt||ze)&&nX(i,K,Ae,ze,c,z,me,0,$e,Xe,m,v,E,I,j)}p&&i.generateCollisionDebugBuffers(b,i.collisionBoxArray)},a.dW=Mb,a.dX=wb,a.dY=iC,a.dZ=p0,a.d_=Cb,a.da=ag,a.db=O,a.dc=YA,a.dd=JL,a.de=function(i){const n=[0,0,0],s=a.ae.identity(new Float64Array(16));return a.ae.multiply(s,i.pixelMatrix,i.globeMatrix),a.$.transformMat4(n,n,s),new Nt(n[0],n[1])},a.df=Y,a.dg=G,a.dh=function(i){const n=i.navigator?i.navigator.userAgent:null;return!!function(s){if($c==null){const c=s.navigator?s.navigator.userAgent:null;$c=!!s.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return $c}(i)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.di=Kl,a.dj=class{constructor(i,n,s){this._transformRequestFn=i,this._customAccessToken=n,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const i=function(){let n="";for(let s=0;s<10;s++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",vy,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,n){return this._transformRequestFn&&this._transformRequestFn(i,n)||{url:i}}normalizeStyleURL(i,n){if(!H(i))return i;const s=xa(i);return s.params.push(`sdk=js-${A}`),s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||n)}normalizeGlyphsURL(i,n){if(!H(i))return i;const s=xa(i);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||n)}normalizeModelURL(i,n){if(!H(i))return i;const s=xa(i);return s.path=`/models/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||n)}normalizeSourceURL(i,n,s,c){if(!H(i))return i;const h=xa(i);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),s&&h.params.push(`language=${s}`),c&&h.params.push(`worldview=${c}`),this._makeAPIURL(h,this._customAccessToken||n)}normalizeSpriteURL(i,n,s,c){const h=xa(i);return H(i)?(h.path=`/styles/v1${h.path}/sprite${n}${s}`,this._makeAPIURL(h,this._customAccessToken||c)):(h.path+=`${n}${s}`,Uu(h))}normalizeTileURL(i,n,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!H(i))return i;const c=xa(i);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||s&&c.authority!=="raster"&&s===512?"@2x":""}${Am.supported?".webp":"$1"}`),c.authority==="raster"?c.path=`/${O.RASTER_URL_PREFIX}${c.path}`:c.authority==="rasterarrays"?c.path=`/${O.RASTERARRAYS_URL_PREFIX}${c.path}`:c.authority==="3dtiles"?c.path=`/${O.TILES3D_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${O.TILE_URL_VERSION}${c.path}`);const h=this._customAccessToken||function(p){for(const m of p){const v=m.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(c.params)||O.ACCESS_TOKEN;return O.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,h)}canonicalizeTileURL(i,n){const s=xa(i);if(!s.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!s.path.match(/\.[\w]+$/))return i;let c="mapbox://";s.path.match(/^\/raster\/v1\//)?c+=`raster/${s.path.replace(`/${O.RASTER_URL_PREFIX}/`,"")}`:s.path.match(/^\/rasterarrays\/v1\//)?c+=`rasterarrays/${s.path.replace(`/${O.RASTERARRAYS_URL_PREFIX}/`,"")}`:c+=`tiles/${s.path.replace(`/${O.TILE_URL_VERSION}/`,"")}`;let h=s.params;return n&&(h=h.filter(p=>!p.match(/^access_token=/))),h.length&&(c+=`?${h.join("&")}`),c}canonicalizeTileset(i,n){const s=!!n&&H(n),c=[];for(const h of i.tiles||[])B(h)?c.push(this.canonicalizeTileURL(h,s)):c.push(h);return c}_makeAPIURL(i,n){const s="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",c=xa(O.API_URL);if(i.protocol=c.protocol,i.authority=c.authority,i.protocol==="http"){const h=i.params.indexOf("secure");h>=0&&i.params.splice(h,1)}if(c.path!=="/"&&(i.path=`${c.path}${i.path}`),!O.REQUIRE_ACCESS_TOKEN)return Uu(i);if(n=n||O.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return i.params=i.params.filter(h=>h.indexOf("access_token")===-1),i.params.push(`access_token=${n||""}`),Uu(i)}},a.dk=function(i,n){n?Ff.add(i):Ff.delete(i)},a.dl=Am,a.dm=UI,a.dn=Ty,a.dp=xy,a.dq=E1,a.dr=S1,a.ds=function(i){Ff.delete(i)},a.dt=Nf,a.du=Jh,a.dv=Nu,a.dw=A,a.dx=function(i,n){Es=i,Ss=n},a.dy=function(i,n,s=!1){if(zr===Tn||zr===jn||zr===or)throw new Error("setRTLTextPlugin cannot be called multiple times.");cr=Qt.resolveURL(i),zr=Tn,Zr=n,qn(),s||mr()},a.dz=Bn,a.e=Qt,a.e0=Eb,a.e1=Tb,a.e2=Nc,a.e3=_z,a.e4=fe,a.e5=Bu,a.e6=function(i){let n=0;if(new Uint32Array(i,0,1)[0]!==H5){const s=new Uint32Array(i,0,7),[,,c,h,p,m]=s;n=s.byteLength+h+p+m+p,(c!==i.byteLength||n>=i.byteLength)&&_i("Invalid b3dm header information.")}return Y5(i,n)},a.e7=function(i,n){const s=J5(i);for(const c of s){for(const h of c.meshes)hK(h);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(dK(c.lights,n)))}return s},a.e8=aw,a.e9=$5,a.ea=Jn,a.eb=function(i){Mf(),es&&es.then(n=>{n.keys().then(s=>{for(let c=0;c<s.length-i;c++)n.delete(s[c])})})},a.f=Bf,a.g=_l,a.h=function(i,n){return gl(ws(i,{type:"json"}),n)},a.i=Lf,a.j=Ha,a.k=Fz,a.l=function(i){return fetch(i).then(n=>n.arrayBuffer()).then(n=>Y5(n,0,i))},a.m=fC,a.n=class extends tw{},a.o=Gc,a.p=mX,a.q=td,a.r=S,a.s=L,a.t=k,a.u=sc,a.v=xe,a.w=_i,a.x=Wa,a.y=Ie,a.z=ye}),y(["./shared"],function(a){function A(Ve){const ee=Ve?Ve.url.toString():void 0;return ee?performance.getEntriesByName(ee):[]}function D(Ve){if(typeof Ve=="number"||typeof Ve=="boolean"||typeof Ve=="string"||Ve==null)return JSON.stringify(Ve);if(Array.isArray(Ve)){let oe="[";for(const be of Ve)oe+=`${D(be)},`;return`${oe}]`}let ee="{";for(const oe of Object.keys(Ve).sort())ee+=`${oe}:${D(Ve[oe])},`;return`${ee}}`}function O(Ve){let ee="";for(const oe of a.cG)ee+=`/${D(Ve[oe])}`;return ee}class B{constructor(ee){this.keyCache={},this._layers={},this._layerConfigs={},ee&&this.replace(ee)}replace(ee,oe){this._layerConfigs={},this._layers={},this.update(ee,[],oe)}update(ee,oe,be){this._options=be;for(const Oe of ee)this._layerConfigs[Oe.id]=Oe,(this._layers[Oe.id]=a.c$(Oe,this.scope,null,this._options)).compileFilter(),this.keyCache[Oe.id]&&delete this.keyCache[Oe.id];for(const Oe of oe)delete this.keyCache[Oe],delete this._layerConfigs[Oe],delete this._layers[Oe];this.familiesBySource={};const Le=function(Oe,qe){const nt={};for(let et=0;et<Oe.length;et++){const _t=qe&&qe[Oe[et].id]||O(Oe[et]);qe&&(qe[Oe[et].id]=_t);let yt=nt[_t];yt||(yt=nt[_t]=[]),yt.push(Oe[et])}const Ge=[];for(const et in nt)Ge.push(nt[et]);return Ge}(a.dJ(this._layerConfigs),this.keyCache);for(const Oe of Le){const qe=Oe.map(Gt=>this._layers[Gt.id]),nt=qe[0];if(nt.visibility==="none")continue;const Ge=nt.source||"";let et=this.familiesBySource[Ge];et||(et=this.familiesBySource[Ge]={});const _t=nt.sourceLayer||"_geojsonTileLayer";let yt=et[_t];yt||(yt=et[_t]=[]),yt.push(qe)}}}const H=1*a.dM;class Q{constructor(ee){const oe={},be=[];for(const nt in ee){const Ge=ee[nt],et=oe[nt]={};for(const _t in Ge.glyphs){const yt=Ge.glyphs[+_t];if(!yt||yt.bitmap.width===0||yt.bitmap.height===0)continue;const Gt=yt.metrics.localGlyph?H:1,fn={x:0,y:0,w:yt.bitmap.width+2*Gt,h:yt.bitmap.height+2*Gt};be.push(fn),et[_t]=fn}}const{w:Le,h:Oe}=a.k(be),qe=new a.dL({width:Le||1,height:Oe||1});for(const nt in ee){const Ge=ee[nt];for(const et in Ge.glyphs){const _t=Ge.glyphs[+et];if(!_t||_t.bitmap.width===0||_t.bitmap.height===0)continue;const yt=oe[nt][et],Gt=_t.metrics.localGlyph?H:1;a.dL.copy(_t.bitmap,qe,{x:0,y:0},{x:yt.x+Gt,y:yt.y+Gt},_t.bitmap)}}this.image=qe,this.positions=oe}}a.dK(Q,"GlyphAtlas");class re{constructor(ee){this.tileID=new a.aQ(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.lut=ee.lut,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.scope=ee.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.collectResourceTiming,this.promoteId=ee.promoteId,this.isSymbolTile=ee.isSymbolTile,this.tileTransform=a.dN(ee.tileID.canonical,ee.projection),this.projection=ee.projection,this.brightness=ee.brightness,this.extraShadowCaster=!!ee.extraShadowCaster,this.tessellationStep=ee.tessellationStep}parse(ee,oe,be,Le,Oe){this.status="parsing",this.data=ee,this.collisionBoxArray=new a.dO;const qe=new a.dP(Object.keys(ee.layers).sort()),nt=new a.dQ(this.tileID,this.promoteId);nt.bucketLayerIDs=[];const Ge={},et=new a.dR(256,256),_t={featureIndex:nt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:et,availableImages:be,brightness:this.brightness},yt=oe.familiesBySource[this.source];for(const on in yt){const Hr=ee.layers[on];if(!Hr)continue;let fr=!1,ir=!1,di=!1;for(const bs of yt[on])bs[0].type==="symbol"?fr=!0:ir=!0,bs[0].is3D()&&bs[0].type!=="model"&&(di=!0);if(this.extraShadowCaster&&!di||this.isSymbolTile===!0&&!fr||this.isSymbolTile===!1&&!ir)continue;Hr.version===1&&a.w(`Vector tile source "${this.source}" layer "${on}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const fi=qe.encode(on),ji=[];for(let bs=0;bs<Hr.length;bs++){const Fs=Hr.feature(bs),Gl=nt.getId(Fs,on);ji.push({feature:Fs,id:Gl,index:bs,sourceLayerIndex:fi})}for(const bs of yt[on]){const Fs=bs[0];(!this.extraShadowCaster||Fs.is3D()&&Fs.type!=="model")&&(this.isSymbolTile!==void 0&&Fs.type==="symbol"!==this.isSymbolTile||Fs.minzoom&&this.zoom<Math.floor(Fs.minzoom)||Fs.maxzoom&&this.zoom>=Fs.maxzoom||Fs.visibility!=="none"&&(se(bs,this.zoom,_t.brightness,be),(Ge[Fs.id]=Fs.createBucket({index:nt.bucketLayerIDs.length,layers:bs,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:fi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(ji,_t,this.tileID.canonical,this.tileTransform),nt.bucketLayerIDs.push(bs.map(Gl=>Gl.id))))}}let Gt,fn,En,nr;et.trim();const Cn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},rr=()=>{if(Gt)return this.status="done",Oe(Gt);if(this.extraShadowCaster)this.status="done",Oe(null,{buckets:a.dJ(Ge).filter(on=>!on.isEmpty()),featureIndex:nt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:_t.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(fn&&En&&nr){const on=new Q(fn),Hr=new a.dT(En,nr,this.lut);for(const fr in Ge){const ir=Ge[fr];ir instanceof a.dU?(se(ir.layers,this.zoom,_t.brightness,be),a.dV(ir,fn,on.positions,En,Hr.iconPositions,this.showCollisionBoxes,be,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):ir.hasPattern&&(ir instanceof a.dW||ir instanceof a.dX||ir instanceof a.c0)&&(se(ir.layers,this.zoom,_t.brightness,be),ir.addFeatures(_t,this.tileID.canonical,Hr.patternPositions,be,this.tileTransform,this.brightness))}this.status="done",Oe(null,{buckets:a.dJ(Ge).filter(fr=>!fr.isEmpty()),featureIndex:nt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:on.image,lineAtlas:et,imageAtlas:Hr,brightness:_t.brightness})}};if(!this.extraShadowCaster){const on=a.dS(_t.glyphDependencies,ir=>Object.keys(ir).map(Number));Object.keys(on).length?Le.send("getGlyphs",{uid:this.uid,stacks:on,scope:this.scope},(ir,di)=>{Gt||(Gt=ir,fn=di,rr())},void 0,!1,Cn):fn={};const Hr=Object.keys(_t.iconDependencies);Hr.length?Le.send("getImages",{icons:Hr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ir,di)=>{Gt||(Gt=ir,En=di,rr())},void 0,!1,Cn):En={};const fr=Object.keys(_t.patternDependencies);fr.length?Le.send("getImages",{icons:fr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ir,di)=>{Gt||(Gt=ir,nr=di,rr())},void 0,!1,Cn):nr={}}rr()}}function se(Ve,ee,oe,be){const Le=new a.Y(ee,{brightness:oe});for(const Oe of Ve)Oe.recalculate(Le,be)}class G extends a.E{constructor(ee,oe,be,Le,Oe,qe){super(),this.actor=ee,this.layerIndex=oe,this.availableImages=be,this.loadVectorData=Oe||a.aq,this.loading={},this.loaded={},this.deduped=new a.ap(ee.scheduler),this.isSpriteLoaded=Le,this.scheduler=ee.scheduler,this.brightness=qe}loadTile(ee,oe){const be=ee.uid,Le=ee&&ee.request,Oe=Le&&Le.collectResourceTiming,qe=this.loading[be]=new re(ee);qe.abort=this.loadVectorData(ee,(nt,Ge)=>{const et=!this.loading[be];if(delete this.loading[be],et||nt||!Ge)return qe.status="done",et||(this.loaded[be]=qe),oe(nt);const _t=Ge.rawData,yt={};Ge.expires&&(yt.expires=Ge.expires),Ge.cacheControl&&(yt.cacheControl=Ge.cacheControl),qe.vectorTile=Ge.vectorTile||new a.dY(new a.dZ(_t));const Gt=()=>{qe.parse(qe.vectorTile,this.layerIndex,this.availableImages,this.actor,(fn,En)=>{if(fn||!En)return oe(fn);const nr={};if(Oe){const Cn=A(Le);Cn.length>0&&(nr.resourceTiming=JSON.parse(JSON.stringify(Cn)))}oe(null,a.Q({rawTileData:_t.slice(0)},En,yt,nr))})};this.isSpriteLoaded?Gt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Gt,{type:"parseTile",isSymbolTile:ee.isSymbolTile,zoom:ee.tileZoom}):Gt()}),this.loaded=this.loaded||{},this.loaded[be]=qe})}reloadTile(ee,oe){const be=this.loaded,Le=ee.uid;if(be&&be[Le]){const Oe=be[Le];Oe.showCollisionBoxes=ee.showCollisionBoxes,Oe.projection=ee.projection,Oe.brightness=ee.brightness,Oe.tileTransform=a.dN(ee.tileID.canonical,ee.projection),Oe.extraShadowCaster=ee.extraShadowCaster,Oe.lut=ee.lut;const qe=(nt,Ge)=>{const et=Oe.reloadCallback;et&&(delete Oe.reloadCallback,Oe.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.actor,et)),oe(nt,Ge)};Oe.status==="parsing"?Oe.reloadCallback=qe:Oe.status==="done"&&(Oe.vectorTile?Oe.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.actor,qe):qe())}else oe(null,void 0)}abortTile(ee,oe){const be=ee.uid,Le=this.loading[be];Le&&(Le.abort&&Le.abort(),delete this.loading[be]),oe()}removeTile(ee,oe){const be=this.loaded,Le=ee.uid;be&&be[Le]&&delete be[Le],oe()}}class Y{loadTile(ee,oe){const{uid:be,encoding:Le,rawImageData:Oe,padding:qe}=ee,nt=ImageBitmap&&Oe instanceof ImageBitmap?this.getImageData(Oe,qe):Oe;oe(null,new a.d_(be,nt,Le,qe<1))}getImageData(ee,oe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ee.width,ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ee.width,this.offscreenCanvas.height=ee.height,this.offscreenCanvasContext.drawImage(ee,0,0,ee.width,ee.height);const be=this.offscreenCanvasContext.getImageData(-oe,-oe,ee.width+2*oe,ee.height+2*oe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),be}}a.d$.setPbf(a.dZ);class Z{decodeRasterArray({task:ee,buffer:oe},be){a.d$.performDecoding(oe,ee).then(Le=>{be(null,Le)},Le=>{be(Le)})}}const fe=a.e0.prototype.toGeoJSON;let Te=class{constructor(Ve){this._feature=Ve,this.extent=a.a4,this.type=Ve.type,this.properties=Ve.tags,"id"in Ve&&!isNaN(Ve.id)&&(this.id=parseInt(Ve.id,10))}loadGeometry(){if(this._feature.type===1){const Ve=[];for(const ee of this._feature.geometry)Ve.push([new a.P(ee[0],ee[1])]);return Ve}{const Ve=[];for(const ee of this._feature.geometry){const oe=[];for(const be of ee)oe.push(new a.P(be[0],be[1]));Ve.push(oe)}return Ve}}toGeoJSON(Ve,ee,oe){return fe.call(this,Ve,ee,oe)}},Pe=class{constructor(Ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.a4,this.length=Ve.length,this._features=Ve}feature(Ve){return new Te(this._features[Ve])}};const ce=64/4096,he=128;class W{constructor(){this.features=new Map}clear(){this.features.clear()}load(ee=[],oe){for(const be of ee){const Le=be.id;if(Le==null)continue;let Oe=this.features.get(Le);Oe&&this.updateCache(Oe,oe),be.geometry?(Oe=_e(be),this.updateCache(Oe,oe),this.features.set(Le,Oe)):this.features.delete(Le),this.updateCache(Oe,oe)}}updateCache(ee,oe){for(const{canonical:be,uid:Le}of Object.values(oe)){const{z:Oe,x:qe,y:nt}=be;ge(ee,Math.pow(2,Oe),qe,nt)&&delete oe[Le]}}getTile(ee,oe,be){const Le=Math.pow(2,ee),Oe=[];for(const qe of this.features.values())ge(qe,Le,oe,be)&&Oe.push(Rt(qe,Le,oe,be));return{features:Oe}}getFeatures(){return[...this.features.values()]}}function ge({minX:Ve,minY:ee,maxX:oe,maxY:be},Le,Oe,qe){return Ve<(Oe+1+ce)/Le&&ee<(qe+1+ce)/Le&&oe>(Oe-ce)/Le&&be>(qe-ce)/Le}function _e(Ve){const{id:ee,geometry:oe,properties:be}=Ve;if(!oe)return;if(oe.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Le,coordinates:Oe}=oe,qe={id:ee,type:1,geometry:[],tags:be,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},nt=qe.geometry;if(Le==="Point")Ee(Oe,nt,qe);else if(Le==="MultiPoint")for(const Ge of Oe)Ee(Ge,nt,qe);else if(Le==="LineString")qe.type=2,we(Oe,nt,qe);else if(Le==="MultiLineString")qe.type=2,xt(Oe,nt,qe);else if(Le==="Polygon")qe.type=3,xt(Oe,nt,qe,!0);else{if(Le!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");qe.type=3;for(const Ge of Oe)xt(Ge,nt,qe,!0)}return qe}function Ee([Ve,ee],oe,be){const Le=a.ak(Ve);let Oe=a.al(ee);Oe=Oe<0?0:Oe>1?1:Oe,oe.push(Le,Oe),be.minX=Math.min(be.minX,Le),be.minY=Math.min(be.minY,Oe),be.maxX=Math.max(be.maxX,Le),be.maxY=Math.max(be.maxY,Oe)}function we(Ve,ee,oe,be=!1,Le=!1){const Oe=[];for(const qe of Ve)Ee(qe,Oe,oe);ee.push(Oe),be&&function(qe,nt){let Ge=0;for(let et=0,_t=qe.length,yt=_t-2;et<_t;yt=et,et+=2)Ge+=(qe[et]-qe[yt])*(qe[et+1]+qe[yt+1]);if(Ge>0===nt)for(let et=0,_t=qe.length;et<_t/2;et+=2){const yt=qe[et],Gt=qe[et+1];qe[et]=qe[_t-2-et],qe[et+1]=qe[_t-1-et],qe[_t-2-et]=yt,qe[_t-1-et]=Gt}}(Oe,Le)}function xt(Ve,ee,oe,be=!1){for(let Le=0;Le<Ve.length;Le++)we(Ve[Le],ee,oe,be,Le===0)}function Rt(Ve,ee,oe,be){const{id:Le,type:Oe,geometry:qe,tags:nt}=Ve,Ge=[];if(Oe===1)(function(et,_t,yt,Gt,fn){for(let En=0;En<et.length;En+=2){const nr=Math.round(a.a4*(et[En+0]*_t-yt)),Cn=Math.round(a.a4*(et[En+1]*_t-Gt));fn.push([nr,Cn])}})(qe,ee,oe,be,Ge);else for(const et of qe)Bt(et,ee,oe,be,Ge);return{id:Le,type:Oe,geometry:Ge,tags:nt}}function Bt(Ve,ee,oe,be,Le){const Oe=-he,qe=a.a4+he;let nt;for(let Ge=0;Ge<Ve.length-2;Ge+=2){let et=Math.round(a.a4*(Ve[Ge+0]*ee-oe)),_t=Math.round(a.a4*(Ve[Ge+1]*ee-be)),yt=Math.round(a.a4*(Ve[Ge+2]*ee-oe)),Gt=Math.round(a.a4*(Ve[Ge+3]*ee-be));const fn=yt-et,En=Gt-_t;et<Oe&&yt<Oe||(et<Oe?(_t+=Math.round(En*((Oe-et)/fn)),et=Oe):yt<Oe&&(Gt=_t+Math.round(En*((Oe-et)/fn)),yt=Oe),_t<Oe&&Gt<Oe||(_t<Oe?(et+=Math.round(fn*((Oe-_t)/En)),_t=Oe):Gt<Oe&&(yt=et+Math.round(fn*((Oe-_t)/En)),Gt=Oe),et>=qe&&yt>=qe||(et>=qe?(_t+=Math.round(En*((qe-et)/fn)),et=qe):yt>=qe&&(Gt=_t+Math.round(En*((qe-et)/fn)),yt=qe),_t>=qe&&Gt>=qe||(_t>=qe?(et+=Math.round(fn*((qe-_t)/En)),_t=qe):Gt>=qe&&(yt=et+Math.round(fn*((qe-_t)/En)),Gt=qe),nt&&et===nt[nt.length-1][0]&&_t===nt[nt.length-1][1]||(nt=[[et,_t]],Le.push(nt)),nt.push([yt,Gt])))))}}var bt={exports:{}},at=a.e2,Ct=a.e1.VectorTileFeature,Zt=rt;function rt(Ve,ee){this.options=ee||{},this.features=Ve,this.length=Ve.length}function wt(Ve,ee){this.id=typeof Ve.id=="number"?Ve.id:void 0,this.type=Ve.type,this.rawGeometry=Ve.type===1?[Ve.geometry]:Ve.geometry,this.properties=Ve.tags,this.extent=ee||4096}rt.prototype.feature=function(Ve){return new wt(this.features[Ve],this.options.extent)},wt.prototype.loadGeometry=function(){var Ve=this.rawGeometry;this.geometry=[];for(var ee=0;ee<Ve.length;ee++){for(var oe=Ve[ee],be=[],Le=0;Le<oe.length;Le++)be.push(new at(oe[Le][0],oe[Le][1]));this.geometry.push(be)}return this.geometry},wt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ve=this.geometry,ee=1/0,oe=-1/0,be=1/0,Le=-1/0,Oe=0;Oe<Ve.length;Oe++)for(var qe=Ve[Oe],nt=0;nt<qe.length;nt++){var Ge=qe[nt];ee=Math.min(ee,Ge.x),oe=Math.max(oe,Ge.x),be=Math.min(be,Ge.y),Le=Math.max(Le,Ge.y)}return[ee,be,oe,Le]},wt.prototype.toGeoJSON=Ct.prototype.toGeoJSON;var pt=a.e3,jt=Zt;function Mt(Ve){var ee=new pt;return function(oe,be){for(var Le in oe.layers)be.writeMessage(3,pn,oe.layers[Le])}(Ve,ee),ee.finish()}function pn(Ve,ee){var oe;ee.writeVarintField(15,Ve.version||1),ee.writeStringField(1,Ve.name||""),ee.writeVarintField(5,Ve.extent||4096);var be={keys:[],values:[],keycache:{},valuecache:{}};for(oe=0;oe<Ve.length;oe++)be.feature=Ve.feature(oe),ee.writeMessage(2,un,be);var Le=be.keys;for(oe=0;oe<Le.length;oe++)ee.writeStringField(3,Le[oe]);var Oe=be.values;for(oe=0;oe<Oe.length;oe++)ee.writeMessage(4,xn,Oe[oe])}function un(Ve,ee){var oe=Ve.feature;oe.id!==void 0&&ee.writeVarintField(1,oe.id),ee.writeMessage(2,_n,Ve),ee.writeVarintField(3,oe.type),ee.writeMessage(4,Kt,oe)}function _n(Ve,ee){var oe=Ve.feature,be=Ve.keys,Le=Ve.values,Oe=Ve.keycache,qe=Ve.valuecache;for(var nt in oe.properties){var Ge=oe.properties[nt],et=Oe[nt];if(Ge!==null){et===void 0&&(be.push(nt),Oe[nt]=et=be.length-1),ee.writeVarint(et);var _t=typeof Ge;_t!=="string"&&_t!=="boolean"&&_t!=="number"&&(Ge=JSON.stringify(Ge));var yt=_t+":"+Ge,Gt=qe[yt];Gt===void 0&&(Le.push(Ge),qe[yt]=Gt=Le.length-1),ee.writeVarint(Gt)}}}function St(Ve,ee){return(ee<<3)+(7&Ve)}function ln(Ve){return Ve<<1^Ve>>31}function Kt(Ve,ee){for(var oe=Ve.loadGeometry(),be=Ve.type,Le=0,Oe=0,qe=oe.length,nt=0;nt<qe;nt++){var Ge=oe[nt],et=1;be===1&&(et=Ge.length),ee.writeVarint(St(1,et));for(var _t=be===3?Ge.length-1:Ge.length,yt=0;yt<_t;yt++){yt===1&&be!==1&&ee.writeVarint(St(2,_t-1));var Gt=Ge[yt].x-Le,fn=Ge[yt].y-Oe;ee.writeVarint(ln(Gt)),ee.writeVarint(ln(fn)),Le+=Gt,Oe+=fn}be===3&&ee.writeVarint(St(7,1))}}function xn(Ve,ee){var oe=typeof Ve;oe==="string"?ee.writeStringField(1,Ve):oe==="boolean"?ee.writeBooleanField(7,Ve):oe==="number"&&(Ve%1!=0?ee.writeDoubleField(3,Ve):Ve<0?ee.writeSVarintField(6,Ve):ee.writeVarintField(5,Ve))}bt.exports=Mt,bt.exports.fromVectorTileJs=Mt,bt.exports.fromGeojsonVt=function(Ve,ee){ee=ee||{};var oe={};for(var be in Ve)oe[be]=new jt(Ve[be].features,ee),oe[be].name=be,oe[be].version=ee.version,oe[be].extent=ee.extent;return Mt({layers:oe})},bt.exports.GeoJSONWrapper=jt;var Er=a.e4(bt.exports);const Dn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ve=>Ve},hr=Math.fround||(Fr=new Float32Array(1),Ve=>(Fr[0]=+Ve,Fr[0]));var Fr;const ar=3,Yn=5,De=6;class Ze{constructor(ee){this.options=Object.assign(Object.create(Dn),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){const{log:oe,minZoom:be,maxZoom:Le}=this.options;oe&&console.time("total time");const Oe=`prepare ${ee.length} points`;oe&&console.time(Oe),this.points=ee;const qe=[];for(let Ge=0;Ge<ee.length;Ge++){const et=ee[Ge];if(!et.geometry)continue;const[_t,yt]=et.geometry.coordinates,Gt=hr(Pt(_t)),fn=hr(vn(yt));qe.push(Gt,fn,1/0,Ge,-1,1),this.options.reduce&&qe.push(0)}let nt=this.trees[Le+1]=this._createTree(qe);oe&&console.timeEnd(Oe);for(let Ge=Le;Ge>=be;Ge--){const et=+Date.now();nt=this.trees[Ge]=this._createTree(this._cluster(nt,Ge)),oe&&console.log("z%d: %d clusters in %dms",Ge,nt.numItems,+Date.now()-et)}return oe&&console.timeEnd("total time"),this}getClusters(ee,oe){let be=((ee[0]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,ee[1]));let Oe=ee[2]===180?180:((ee[2]+180)%360+360)%360-180;const qe=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)be=-180,Oe=180;else if(be>Oe){const yt=this.getClusters([be,Le,180,qe],oe),Gt=this.getClusters([-180,Le,Oe,qe],oe);return yt.concat(Gt)}const nt=this.trees[this._limitZoom(oe)],Ge=nt.range(Pt(be),vn(qe),Pt(Oe),vn(Le)),et=nt.data,_t=[];for(const yt of Ge){const Gt=this.stride*yt;_t.push(et[Gt+Yn]>1?st(et,Gt,this.clusterProps):this.points[et[Gt+ar]])}return _t}getChildren(ee){const oe=this._getOriginId(ee),be=this._getOriginZoom(ee),Le="No cluster with the specified id.",Oe=this.trees[be];if(!Oe)throw new Error(Le);const qe=Oe.data;if(oe*this.stride>=qe.length)throw new Error(Le);const nt=this.options.radius/(this.options.extent*Math.pow(2,be-1)),Ge=Oe.within(qe[oe*this.stride],qe[oe*this.stride+1],nt),et=[];for(const _t of Ge){const yt=_t*this.stride;qe[yt+4]===ee&&et.push(qe[yt+Yn]>1?st(qe,yt,this.clusterProps):this.points[qe[yt+ar]])}if(et.length===0)throw new Error(Le);return et}getLeaves(ee,oe,be){const Le=[];return this._appendLeaves(Le,ee,oe=oe||10,be=be||0,0),Le}getTile(ee,oe,be){const Le=this.trees[this._limitZoom(ee)],Oe=Math.pow(2,ee),{extent:qe,radius:nt}=this.options,Ge=nt/qe,et=(be-Ge)/Oe,_t=(be+1+Ge)/Oe,yt={features:[]};return this._addTileFeatures(Le.range((oe-Ge)/Oe,et,(oe+1+Ge)/Oe,_t),Le.data,oe,be,Oe,yt),oe===0&&this._addTileFeatures(Le.range(1-Ge/Oe,et,1,_t),Le.data,Oe,be,Oe,yt),oe===Oe-1&&this._addTileFeatures(Le.range(0,et,Ge/Oe,_t),Le.data,-1,be,Oe,yt),yt.features.length?yt:null}getClusterExpansionZoom(ee){let oe=this._getOriginZoom(ee)-1;for(;oe<=this.options.maxZoom;){const be=this.getChildren(ee);if(oe++,be.length!==1)break;ee=be[0].properties.cluster_id}return oe}_appendLeaves(ee,oe,be,Le,Oe){const qe=this.getChildren(oe);for(const nt of qe){const Ge=nt.properties;if(Ge&&Ge.cluster?Oe+Ge.point_count<=Le?Oe+=Ge.point_count:Oe=this._appendLeaves(ee,Ge.cluster_id,be,Le,Oe):Oe<Le?Oe++:ee.push(nt),ee.length===be)break}return Oe}_createTree(ee){const oe=new a.cN(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let be=0;be<ee.length;be+=this.stride)oe.add(ee[be],ee[be+1]);return oe.finish(),oe.data=ee,oe}_addTileFeatures(ee,oe,be,Le,Oe,qe){for(const nt of ee){const Ge=nt*this.stride,et=oe[Ge+Yn]>1;let _t,yt,Gt;if(et)_t=rn(oe,Ge,this.clusterProps),yt=oe[Ge],Gt=oe[Ge+1];else{const nr=this.points[oe[Ge+ar]];_t=nr.properties;const[Cn,rr]=nr.geometry.coordinates;yt=Pt(Cn),Gt=vn(rr)}const fn={type:1,geometry:[[Math.round(this.options.extent*(yt*Oe-be)),Math.round(this.options.extent*(Gt*Oe-Le))]],tags:_t};let En;En=et||this.options.generateId?oe[Ge+ar]:this.points[oe[Ge+ar]].id,En!==void 0&&(fn.id=En),qe.features.push(fn)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,oe){const{radius:be,extent:Le,reduce:Oe,minPoints:qe}=this.options,nt=be/(Le*Math.pow(2,oe)),Ge=ee.data,et=[],_t=this.stride;for(let yt=0;yt<Ge.length;yt+=_t){if(Ge[yt+2]<=oe)continue;Ge[yt+2]=oe;const Gt=Ge[yt],fn=Ge[yt+1],En=ee.within(Ge[yt],Ge[yt+1],nt),nr=Ge[yt+Yn];let Cn=nr;for(const rr of En){const on=rr*_t;Ge[on+2]>oe&&(Cn+=Ge[on+Yn])}if(Cn>nr&&Cn>=qe){let rr,on=Gt*nr,Hr=fn*nr,fr=-1;const ir=(yt/_t<<5)+(oe+1)+this.points.length;for(const di of En){const fi=di*_t;if(Ge[fi+2]<=oe)continue;Ge[fi+2]=oe;const ji=Ge[fi+Yn];on+=Ge[fi]*ji,Hr+=Ge[fi+1]*ji,Ge[fi+4]=ir,Oe&&(rr||(rr=this._map(Ge,yt,!0),fr=this.clusterProps.length,this.clusterProps.push(rr)),Oe(rr,this._map(Ge,fi)))}Ge[yt+4]=ir,et.push(on/Cn,Hr/Cn,1/0,ir,-1,Cn),Oe&&et.push(fr)}else{for(let rr=0;rr<_t;rr++)et.push(Ge[yt+rr]);if(Cn>1)for(const rr of En){const on=rr*_t;if(!(Ge[on+2]<=oe)){Ge[on+2]=oe;for(let Hr=0;Hr<_t;Hr++)et.push(Ge[on+Hr])}}}}return et}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,oe,be){if(ee[oe+Yn]>1){const qe=this.clusterProps[ee[oe+De]];return be?Object.assign({},qe):qe}const Le=this.points[ee[oe+ar]].properties,Oe=this.options.map(Le);return be&&Oe===Le?Object.assign({},Oe):Oe}}function st(Ve,ee,oe){return{type:"Feature",id:Ve[ee+ar],properties:rn(Ve,ee,oe),geometry:{type:"Point",coordinates:[(be=Ve[ee],360*(be-.5)),Sr(Ve[ee+1])]}};var be}function rn(Ve,ee,oe){const be=Ve[ee+Yn],Le=be>=1e4?`${Math.round(be/1e3)}k`:be>=1e3?Math.round(be/100)/10+"k":be,Oe=Ve[ee+De],qe=Oe===-1?{}:Object.assign({},oe[Oe]);return Object.assign(qe,{cluster:!0,cluster_id:Ve[ee+ar],point_count:be,point_count_abbreviated:Le})}function Pt(Ve){return Ve/360+.5}function vn(Ve){const ee=Math.sin(Ve*Math.PI/180),oe=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return oe<0?0:oe>1?1:oe}function Sr(Ve){const ee=(180-360*Ve)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}function yn(Ve,ee,oe,be){let Le=be;const Oe=ee+(oe-ee>>1);let qe,nt=oe-ee;const Ge=Ve[ee],et=Ve[ee+1],_t=Ve[oe],yt=Ve[oe+1];for(let Gt=ee+3;Gt<oe;Gt+=3){const fn=Zn(Ve[Gt],Ve[Gt+1],Ge,et,_t,yt);if(fn>Le)qe=Gt,Le=fn;else if(fn===Le){const En=Math.abs(Gt-Oe);En<nt&&(qe=Gt,nt=En)}}Le>be&&(qe-ee>3&&yn(Ve,ee,qe,be),Ve[qe+2]=Le,oe-qe>3&&yn(Ve,qe,oe,be))}function Zn(Ve,ee,oe,be,Le,Oe){let qe=Le-oe,nt=Oe-be;if(qe!==0||nt!==0){const Ge=((Ve-oe)*qe+(ee-be)*nt)/(qe*qe+nt*nt);Ge>1?(oe=Le,be=Oe):Ge>0&&(oe+=qe*Ge,be+=nt*Ge)}return qe=Ve-oe,nt=ee-be,qe*qe+nt*nt}function br(Ve,ee,oe,be){const Le={id:Ve??null,type:ee,geometry:oe,tags:be,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")Lr(Le,oe);else if(ee==="Polygon")Lr(Le,oe[0]);else if(ee==="MultiLineString")for(const Oe of oe)Lr(Le,Oe);else if(ee==="MultiPolygon")for(const Oe of oe)Lr(Le,Oe[0]);return Le}function Lr(Ve,ee){for(let oe=0;oe<ee.length;oe+=3)Ve.minX=Math.min(Ve.minX,ee[oe]),Ve.minY=Math.min(Ve.minY,ee[oe+1]),Ve.maxX=Math.max(Ve.maxX,ee[oe]),Ve.maxY=Math.max(Ve.maxY,ee[oe+1])}function Li(Ve,ee,oe,be){if(!ee.geometry)return;const Le=ee.geometry.coordinates;if(Le&&Le.length===0)return;const Oe=ee.geometry.type,qe=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2);let nt=[],Ge=ee.id;if(oe.promoteId?Ge=ee.properties[oe.promoteId]:oe.generateId&&(Ge=be||0),Oe==="Point")dr(Le,nt);else if(Oe==="MultiPoint")for(const et of Le)dr(et,nt);else if(Oe==="LineString")zi(Le,nt,qe,!1);else if(Oe==="MultiLineString"){if(oe.lineMetrics){for(const et of Le)nt=[],zi(et,nt,qe,!1),Ve.push(br(Ge,"LineString",nt,ee.properties));return}ls(Le,nt,qe,!1)}else if(Oe==="Polygon")ls(Le,nt,qe,!0);else{if(Oe!=="MultiPolygon"){if(Oe==="GeometryCollection"){for(const et of ee.geometry.geometries)Li(Ve,{id:Ge,geometry:et,properties:ee.properties},oe,be);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const et of Le){const _t=[];ls(et,_t,qe,!0),nt.push(_t)}}Ve.push(br(Ge,Oe,nt,ee.properties))}function dr(Ve,ee){ee.push(Sn(Ve[0]),lr(Ve[1]),0)}function zi(Ve,ee,oe,be){let Le,Oe,qe=0;for(let Ge=0;Ge<Ve.length;Ge++){const et=Sn(Ve[Ge][0]),_t=lr(Ve[Ge][1]);ee.push(et,_t,0),Ge>0&&(qe+=be?(Le*_t-et*Oe)/2:Math.sqrt(Math.pow(et-Le,2)+Math.pow(_t-Oe,2))),Le=et,Oe=_t}const nt=ee.length-3;ee[2]=1,yn(ee,0,nt,oe),ee[nt+2]=1,ee.size=Math.abs(qe),ee.start=0,ee.end=ee.size}function ls(Ve,ee,oe,be){for(let Le=0;Le<Ve.length;Le++){const Oe=[];zi(Ve[Le],Oe,oe,be),ee.push(Oe)}}function Sn(Ve){return Ve/360+.5}function lr(Ve){const ee=Math.sin(Ve*Math.PI/180),oe=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return oe<0?0:oe>1?1:oe}function hn(Ve,ee,oe,be,Le,Oe,qe,nt){if(be/=ee,Oe>=(oe/=ee)&&qe<be)return Ve;if(qe<oe||Oe>=be)return null;const Ge=[];for(const et of Ve){const _t=et.geometry;let yt=et.type;const Gt=Le===0?et.minX:et.minY,fn=Le===0?et.maxX:et.maxY;if(Gt>=oe&&fn<be){Ge.push(et);continue}if(fn<oe||Gt>=be)continue;let En=[];if(yt==="Point"||yt==="MultiPoint")Zs(_t,En,oe,be,Le);else if(yt==="LineString")Ei(_t,En,oe,be,Le,!1,nt.lineMetrics);else if(yt==="MultiLineString")_a(_t,En,oe,be,Le,!1);else if(yt==="Polygon")_a(_t,En,oe,be,Le,!0);else if(yt==="MultiPolygon")for(const nr of _t){const Cn=[];_a(nr,Cn,oe,be,Le,!0),Cn.length&&En.push(Cn)}if(En.length){if(nt.lineMetrics&&yt==="LineString"){for(const nr of En)Ge.push(br(et.id,yt,nr,et.tags));continue}yt!=="LineString"&&yt!=="MultiLineString"||(En.length===1?(yt="LineString",En=En[0]):yt="MultiLineString"),yt!=="Point"&&yt!=="MultiPoint"||(yt=En.length===3?"Point":"MultiPoint"),Ge.push(br(et.id,yt,En,et.tags))}}return Ge.length?Ge:null}function Zs(Ve,ee,oe,be,Le){for(let Oe=0;Oe<Ve.length;Oe+=3){const qe=Ve[Oe+Le];qe>=oe&&qe<=be&&en(ee,Ve[Oe],Ve[Oe+1],Ve[Oe+2])}}function Ei(Ve,ee,oe,be,Le,Oe,qe){let nt=ao(Ve);const Ge=Le===0?Kn:ei;let et,_t,yt=Ve.start;for(let Cn=0;Cn<Ve.length-3;Cn+=3){const rr=Ve[Cn],on=Ve[Cn+1],Hr=Ve[Cn+2],fr=Ve[Cn+3],ir=Ve[Cn+4],di=Le===0?rr:on,fi=Le===0?fr:ir;let ji=!1;qe&&(et=Math.sqrt(Math.pow(rr-fr,2)+Math.pow(on-ir,2))),di<oe?fi>oe&&(_t=Ge(nt,rr,on,fr,ir,oe),qe&&(nt.start=yt+et*_t)):di>be?fi<be&&(_t=Ge(nt,rr,on,fr,ir,be),qe&&(nt.start=yt+et*_t)):en(nt,rr,on,Hr),fi<oe&&di>=oe&&(_t=Ge(nt,rr,on,fr,ir,oe),ji=!0),fi>be&&di<=be&&(_t=Ge(nt,rr,on,fr,ir,be),ji=!0),!Oe&&ji&&(qe&&(nt.end=yt+et*_t),ee.push(nt),nt=ao(Ve)),qe&&(yt+=et)}let Gt=Ve.length-3;const fn=Ve[Gt],En=Ve[Gt+1],nr=Le===0?fn:En;nr>=oe&&nr<=be&&en(nt,fn,En,Ve[Gt+2]),Gt=nt.length-3,Oe&&Gt>=3&&(nt[Gt]!==nt[0]||nt[Gt+1]!==nt[1])&&en(nt,nt[0],nt[1],nt[2]),nt.length&&ee.push(nt)}function ao(Ve){const ee=[];return ee.size=Ve.size,ee.start=Ve.start,ee.end=Ve.end,ee}function _a(Ve,ee,oe,be,Le,Oe){for(const qe of Ve)Ei(qe,ee,oe,be,Le,Oe,!1)}function en(Ve,ee,oe,be){Ve.push(ee,oe,be)}function Kn(Ve,ee,oe,be,Le,Oe){const qe=(Oe-ee)/(be-ee);return en(Ve,Oe,oe+(Le-oe)*qe,1),qe}function ei(Ve,ee,oe,be,Le,Oe){const qe=(Oe-oe)/(Le-oe);return en(Ve,ee+(be-ee)*qe,Oe,1),qe}function Ai(Ve,ee){const oe=[];for(let be=0;be<Ve.length;be++){const Le=Ve[be],Oe=Le.type;let qe;if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")qe=vs(Le.geometry,ee);else if(Oe==="MultiLineString"||Oe==="Polygon"){qe=[];for(const nt of Le.geometry)qe.push(vs(nt,ee))}else if(Oe==="MultiPolygon"){qe=[];for(const nt of Le.geometry){const Ge=[];for(const et of nt)Ge.push(vs(et,ee));qe.push(Ge)}}oe.push(br(Le.id,Oe,qe,Le.tags))}return oe}function vs(Ve,ee){const oe=[];oe.size=Ve.size,Ve.start!==void 0&&(oe.start=Ve.start,oe.end=Ve.end);for(let be=0;be<Ve.length;be+=3)oe.push(Ve[be]+ee,Ve[be+1],Ve[be+2]);return oe}function xs(Ve,ee){if(Ve.transformed)return Ve;const oe=1<<Ve.z,be=Ve.x,Le=Ve.y;for(const Oe of Ve.features){const qe=Oe.geometry,nt=Oe.type;if(Oe.geometry=[],nt===1)for(let Ge=0;Ge<qe.length;Ge+=2)Oe.geometry.push(Ps(qe[Ge],qe[Ge+1],ee,oe,be,Le));else for(let Ge=0;Ge<qe.length;Ge++){const et=[];for(let _t=0;_t<qe[Ge].length;_t+=2)et.push(Ps(qe[Ge][_t],qe[Ge][_t+1],ee,oe,be,Le));Oe.geometry.push(et)}}return Ve.transformed=!0,Ve}function Ps(Ve,ee,oe,be,Le,Oe){return[Math.round(oe*(Ve*be-Le)),Math.round(oe*(ee*be-Oe))]}function Ns(Ve,ee,oe,be,Le){const Oe=ee===Le.maxZoom?0:Le.tolerance/((1<<ee)*Le.extent),qe={features:[],numPoints:0,numSimplified:0,numFeatures:Ve.length,source:null,x:oe,y:be,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const nt of Ve)Ro(qe,nt,Oe,Le);return qe}function Ro(Ve,ee,oe,be){const Le=ee.geometry,Oe=ee.type,qe=[];if(Ve.minX=Math.min(Ve.minX,ee.minX),Ve.minY=Math.min(Ve.minY,ee.minY),Ve.maxX=Math.max(Ve.maxX,ee.maxX),Ve.maxY=Math.max(Ve.maxY,ee.maxY),Oe==="Point"||Oe==="MultiPoint")for(let nt=0;nt<Le.length;nt+=3)qe.push(Le[nt],Le[nt+1]),Ve.numPoints++,Ve.numSimplified++;else if(Oe==="LineString")Ur(qe,Le,Ve,oe,!1,!1);else if(Oe==="MultiLineString"||Oe==="Polygon")for(let nt=0;nt<Le.length;nt++)Ur(qe,Le[nt],Ve,oe,Oe==="Polygon",nt===0);else if(Oe==="MultiPolygon")for(let nt=0;nt<Le.length;nt++){const Ge=Le[nt];for(let et=0;et<Ge.length;et++)Ur(qe,Ge[et],Ve,oe,!0,et===0)}if(qe.length){let nt=ee.tags||null;if(Oe==="LineString"&&be.lineMetrics){nt={};for(const et in ee.tags)nt[et]=ee.tags[et];nt.mapbox_clip_start=Le.start/Le.size,nt.mapbox_clip_end=Le.end/Le.size}const Ge={geometry:qe,type:Oe==="Polygon"||Oe==="MultiPolygon"?3:Oe==="LineString"||Oe==="MultiLineString"?2:1,tags:nt};ee.id!==null&&(Ge.id=ee.id),Ve.features.push(Ge)}}function Ur(Ve,ee,oe,be,Le,Oe){const qe=be*be;if(be>0&&ee.size<(Le?qe:be))return void(oe.numPoints+=ee.length/3);const nt=[];for(let Ge=0;Ge<ee.length;Ge+=3)(be===0||ee[Ge+2]>qe)&&(oe.numSimplified++,nt.push(ee[Ge],ee[Ge+1])),oe.numPoints++;Le&&function(Ge,et){let _t=0;for(let yt=0,Gt=Ge.length,fn=Gt-2;yt<Gt;fn=yt,yt+=2)_t+=(Ge[yt]-Ge[fn])*(Ge[yt+1]+Ge[fn+1]);if(_t>0===et)for(let yt=0,Gt=Ge.length;yt<Gt/2;yt+=2){const fn=Ge[yt],En=Ge[yt+1];Ge[yt]=Ge[Gt-2-yt],Ge[yt+1]=Ge[Gt-1-yt],Ge[Gt-2-yt]=fn,Ge[Gt-1-yt]=En}}(nt,Oe),Ve.push(nt)}const Ua={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ti{constructor(ee,oe){const be=(oe=this.options=function(Oe,qe){for(const nt in qe)Oe[nt]=qe[nt];return Oe}(Object.create(Ua),oe)).debug;if(be&&console.time("preprocess data"),oe.maxZoom<0||oe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(oe.promoteId&&oe.generateId)throw new Error("promoteId and generateId cannot be used together.");let Le=function(Oe,qe){const nt=[];if(Oe.type==="FeatureCollection")for(let Ge=0;Ge<Oe.features.length;Ge++)Li(nt,Oe.features[Ge],qe,Ge);else Li(nt,Oe.type==="Feature"?Oe:{geometry:Oe},qe);return nt}(ee,oe);this.tiles={},this.tileCoords=[],be&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",oe.indexMaxZoom,oe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Le=function(Oe,qe){const nt=qe.buffer/qe.extent;let Ge=Oe;const et=hn(Oe,1,-1-nt,nt,0,-1,2,qe),_t=hn(Oe,1,1-nt,2+nt,0,-1,2,qe);return(et||_t)&&(Ge=hn(Oe,1,-nt,1+nt,0,-1,2,qe)||[],et&&(Ge=Ai(et,1).concat(Ge)),_t&&(Ge=Ge.concat(Ai(_t,-1)))),Ge}(Le,oe),Le.length&&this.splitTile(Le,0,0,0),be&&(Le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ee,oe,be,Le,Oe,qe,nt){const Ge=[ee,oe,be,Le],et=this.options,_t=et.debug;for(;Ge.length;){Le=Ge.pop(),be=Ge.pop(),oe=Ge.pop(),ee=Ge.pop();const yt=1<<oe,Gt=gi(oe,be,Le);let fn=this.tiles[Gt];if(!fn&&(_t>1&&console.time("creation"),fn=this.tiles[Gt]=Ns(ee,oe,be,Le,et),this.tileCoords.push({z:oe,x:be,y:Le}),_t)){_t>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",oe,be,Le,fn.numFeatures,fn.numPoints,fn.numSimplified),console.timeEnd("creation"));const ji=`z${oe}`;this.stats[ji]=(this.stats[ji]||0)+1,this.total++}if(fn.source=ee,Oe==null){if(oe===et.indexMaxZoom||fn.numPoints<=et.indexMaxPoints)continue}else{if(oe===et.maxZoom||oe===Oe)continue;if(Oe!=null){const ji=Oe-oe;if(be!==qe>>ji||Le!==nt>>ji)continue}}if(fn.source=null,ee.length===0)continue;_t>1&&console.time("clipping");const En=.5*et.buffer/et.extent,nr=.5-En,Cn=.5+En,rr=1+En;let on=null,Hr=null,fr=null,ir=null,di=hn(ee,yt,be-En,be+Cn,0,fn.minX,fn.maxX,et),fi=hn(ee,yt,be+nr,be+rr,0,fn.minX,fn.maxX,et);ee=null,di&&(on=hn(di,yt,Le-En,Le+Cn,1,fn.minY,fn.maxY,et),Hr=hn(di,yt,Le+nr,Le+rr,1,fn.minY,fn.maxY,et),di=null),fi&&(fr=hn(fi,yt,Le-En,Le+Cn,1,fn.minY,fn.maxY,et),ir=hn(fi,yt,Le+nr,Le+rr,1,fn.minY,fn.maxY,et),fi=null),_t>1&&console.timeEnd("clipping"),Ge.push(on||[],oe+1,2*be,2*Le),Ge.push(Hr||[],oe+1,2*be,2*Le+1),Ge.push(fr||[],oe+1,2*be+1,2*Le),Ge.push(ir||[],oe+1,2*be+1,2*Le+1)}}getTile(ee,oe,be){ee=+ee,oe=+oe,be=+be;const Le=this.options,{extent:Oe,debug:qe}=Le;if(ee<0||ee>24)return null;const nt=1<<ee,Ge=gi(ee,oe=oe+nt&nt-1,be);if(this.tiles[Ge])return xs(this.tiles[Ge],Oe);qe>1&&console.log("drilling down to z%d-%d-%d",ee,oe,be);let et,_t=ee,yt=oe,Gt=be;for(;!et&&_t>0;)_t--,yt>>=1,Gt>>=1,et=this.tiles[gi(_t,yt,Gt)];return et&&et.source?(qe>1&&(console.log("found parent tile z%d-%d-%d",_t,yt,Gt),console.time("drilling down")),this.splitTile(et.source,_t,yt,Gt,ee,oe,be),qe>1&&console.timeEnd("drilling down"),this.tiles[Ge]?xs(this.tiles[Ge],Oe):null):null}}function gi(Ve,ee,oe){return 32*((1<<Ve)*oe+ee)+Ve}function pl(Ve,ee){const oe=Ve.tileID.canonical;if(!this._geoJSONIndex)return ee(null,null);const be=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!be)return ee(null,null);const Le=new Pe(be.features);let Oe=Er(Le);Oe.byteOffset===0&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),ee(null,{vectorTile:Le,rawData:Oe.buffer})}class ya extends G{constructor(ee,oe,be,Le,Oe,qe){super(ee,oe,be,Le,pl,qe),Oe&&(this.loadGeoJSON=Oe),this._dynamicIndex=new W}loadData(ee,oe){const be=ee&&ee.request,Le=be&&be.collectResourceTiming;this.loadGeoJSON(ee,(Oe,qe)=>{if(Oe||!qe)return oe(Oe);if(typeof qe!="object")return oe(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));{try{if(ee.filter){const Ge=a.z(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ge.result==="error")throw new Error(Ge.value.map(et=>`${et.key}: ${et.message}`).join(", "));qe.features=qe.features.filter(et=>Ge.value.evaluate({zoom:0},et))}ee.dynamic?(qe.type==="Feature"&&(qe={type:"FeatureCollection",features:[qe]}),ee.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(qe.features,this.loaded),ee.cluster&&(qe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ee.cluster?new Ze(function({superclusterOptions:Ge,clusterProperties:et}){if(!et||!Ge)return Ge;const _t={},yt={},Gt={accumulated:null,zoom:0},fn={properties:null},En=Object.keys(et);for(const nr of En){const[Cn,rr]=et[nr],on=a.z(rr),Hr=a.z(typeof Cn=="string"?[Cn,["accumulated"],["get",nr]]:Cn);_t[nr]=on.value,yt[nr]=Hr.value}return Ge.map=nr=>{fn.properties=nr;const Cn={};for(const rr of En)Cn[rr]=_t[rr].evaluate(Gt,fn);return Cn},Ge.reduce=(nr,Cn)=>{fn.properties=Cn;for(const rr of En)Gt.accumulated=nr[rr],nr[rr]=yt[rr].evaluate(Gt,fn)},Ge}(ee)).load(qe.features):ee.dynamic?this._dynamicIndex:function(Ge,et){return new ti(Ge,et)}(qe,ee.geojsonVtOptions)}catch(Ge){return oe(Ge)}const nt={};if(Le){const Ge=A(be);Ge&&(nt.resourceTiming={},nt.resourceTiming[ee.source]=JSON.parse(JSON.stringify(Ge)))}oe(null,nt)}})}reloadTile(ee,oe){const be=this.loaded;return be&&be[ee.uid]?ee.partial?oe(null,void 0):super.reloadTile(ee,oe):this.loadTile(ee,oe)}loadGeoJSON(ee,oe){if(ee.request)a.h(ee.request,oe);else{if(typeof ee.data!="string")return oe(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));try{return oe(null,JSON.parse(ee.data))}catch{return oe(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ee,oe){try{oe(null,this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId))}catch(be){oe(be)}}getClusterChildren(ee,oe){try{oe(null,this._geoJSONIndex.getChildren(ee.clusterId))}catch(be){oe(be)}}getClusterLeaves(ee,oe){try{oe(null,this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset))}catch(be){oe(be)}}}class lo{constructor(ee,oe){this.tileID=new a.aQ(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ee.projection,this.brightness=oe}parse(ee,oe,be,Le){this.status="parsing";const Oe=new a.aQ(be.tileID.overscaledZ,be.tileID.wrap,be.tileID.canonical.z,be.tileID.canonical.x,be.tileID.canonical.y),qe={},nt=oe.familiesBySource[be.source],Ge=new a.dQ(Oe,be.promoteId);return Ge.bucketLayerIDs=[],Ge.is3DTile=!0,a.e6(ee).then(et=>{if(!et)return Le(new Error("Could not parse tile"));const _t=a.e7(et,1/a.b7(be.tileID.canonical)),yt=et.json.extensionsUsed&&et.json.extensionsUsed.includes("MAPBOX_mesh_features")||et.json.asset.extras&&et.json.asset.extras.MAPBOX_mesh_features,Gt=et.json.extensionsUsed&&et.json.extensionsUsed.includes("EXT_meshopt_compression"),fn=new a.Y(this.zoom,{brightness:this.brightness});for(const En in nt)for(const nr of nt[En]){const Cn=nr[0];Ge.bucketLayerIDs.push(nr.map(on=>on.id)),Cn.recalculate(fn,[]);const rr=new a.e8(_t,Oe,yt,Gt,this.brightness,Ge);yt||(rr.needsUpload=!0),qe[Cn.fqid]=rr,rr.evaluate(Cn)}this.status="done",Le(null,{buckets:qe,featureIndex:Ge})}).catch(et=>Le(new Error(et.message)))}}class Ni{constructor(ee,oe,be,Le,Oe,qe){this.actor=ee,this.layerIndex=oe,this.brightness=qe,this.loading={},this.loaded={}}loadTile(ee,oe){const be=ee.uid,Le=this.loading[be]=new lo(ee,this.brightness);a.e5(ee.request,(Oe,qe)=>{const nt=!this.loading[be];return delete this.loading[be],nt||Oe?(Le.status="done",nt||(this.loaded[be]=Le),oe(Oe)):qe&&qe.byteLength!==0?void Le.parse(qe,this.layerIndex,ee,(Ge,et)=>{Le.status="done",this.loaded=this.loaded||{},this.loaded[be]=Le,Ge||!et?oe(Ge):oe(null,et)}):(Le.status="done",this.loaded[be]=Le,oe())})}reloadTile(ee,oe){const be=this.loaded,Le=ee.uid;if(be&&be[Le]){const Oe=be[Le];Oe.projection=ee.projection,Oe.brightness=ee.brightness;const qe=(nt,Ge)=>{Oe.reloadCallback&&(delete Oe.reloadCallback,this.loadTile(ee,oe)),oe(nt,Ge)};Oe.status==="parsing"?Oe.reloadCallback=qe:Oe.status==="done"&&this.loadTile(ee,oe)}}abortTile(ee,oe){const be=ee.uid;this.loading[be]&&delete this.loading[be],oe()}removeTile(ee,oe){const be=this.loaded,Le=ee.uid;be&&be[Le]&&delete be[Le],oe()}}class ku{constructor(ee){this.self=ee,this.actor=new a.e9(ee,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.aK({name:"mercator"}),this.workerSourceTypes={vector:G,geojson:ya,"batched-model":Ni},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(oe,be)=>{if(this.workerSourceTypes[oe])throw new Error(`Worker source with name "${oe}" already registered.`);this.workerSourceTypes[oe]=be},this.self.registerRTLTextPlugin=oe=>{if(a.ea.isParsed())throw new Error("RTL text plugin already registered.");a.ea.applyArabicShaping=oe.applyArabicShaping,a.ea.processBidirectionalText=oe.processBidirectionalText,a.ea.processStyledBidirectionalText=oe.processStyledBidirectionalText}}clearCaches(ee,oe,be){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.workerSources[ee],delete this.demWorkerSources[ee],delete this.rasterArrayWorkerSource,be()}checkIfReady(ee,oe,be){be()}setReferrer(ee,oe){this.referrer=oe}spriteLoaded(ee,{scope:oe,isLoaded:be}){if(this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),this.isSpriteLoaded[ee][oe]=be,this.workerSources[ee]&&this.workerSources[ee][oe])for(const Le in this.workerSources[ee][oe]){const Oe=this.workerSources[ee][oe][Le];for(const qe in Oe){const nt=Oe[qe];nt instanceof G&&(nt.isSpriteLoaded=be,nt.fire(new a.g("isSpriteLoaded")))}}}setImages(ee,{scope:oe,images:be},Le){if(this.availableImages[ee]||(this.availableImages[ee]={}),this.availableImages[ee][oe]=be,this.workerSources[ee]&&this.workerSources[ee][oe]){for(const Oe in this.workerSources[ee][oe]){const qe=this.workerSources[ee][oe][Oe];for(const nt in qe)qe[nt].availableImages=be}Le()}else Le()}setProjection(ee,oe){this.projections[ee]=a.aK(oe)}setBrightness(ee,oe,be){this.brightness=oe,be()}setLayers(ee,oe,be){this.getLayerIndex(ee,oe.scope).replace(oe.layers,oe.options),be()}updateLayers(ee,oe,be){this.getLayerIndex(ee,oe.scope).update(oe.layers,oe.removedIds,oe.options),be()}loadTile(ee,oe,be){oe.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,oe.type,oe.source,oe.scope).loadTile(oe,be)}loadDEMTile(ee,oe,be){this.getDEMWorkerSource(ee,oe.source,oe.scope).loadTile(oe,be)}decodeRasterArray(ee,oe,be){this.getRasterArrayWorkerSource().decodeRasterArray(oe,be)}reloadTile(ee,oe,be){oe.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,oe.type,oe.source,oe.scope).reloadTile(oe,be)}abortTile(ee,oe,be){this.getWorkerSource(ee,oe.type,oe.source,oe.scope).abortTile(oe,be)}removeTile(ee,oe,be){this.getWorkerSource(ee,oe.type,oe.source,oe.scope).removeTile(oe,be)}removeSource(ee,oe,be){if(!(this.workerSources[ee]&&this.workerSources[ee][oe.scope]&&this.workerSources[ee][oe.scope][oe.type]&&this.workerSources[ee][oe.scope][oe.type][oe.source]))return;const Le=this.workerSources[ee][oe.scope][oe.type][oe.source];delete this.workerSources[ee][oe.scope][oe.type][oe.source],Le.removeSource!==void 0?Le.removeSource(oe,be):be()}loadWorkerSource(ee,oe,be){try{this.self.importScripts(oe.url),be()}catch(Le){be(Le.toString())}}syncRTLPluginState(ee,oe,be){try{a.ea.setState(oe);const Le=a.ea.getPluginURL();if(a.ea.isLoaded()&&!a.ea.isParsed()&&Le!=null){this.self.importScripts(Le);const Oe=a.ea.isParsed();be(Oe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Le}`),Oe)}}catch(Le){be(Le.toString())}}setDracoUrl(ee,oe){this.dracoUrl=oe}getAvailableImages(ee,oe){this.availableImages[ee]||(this.availableImages[ee]={});let be=this.availableImages[ee][oe];return be||(be=[]),be}getLayerIndex(ee,oe){this.layerIndexes[ee]||(this.layerIndexes[ee]={});let be=this.layerIndexes[ee][oe];return be||(be=this.layerIndexes[ee][oe]=new B,be.scope=oe),be}getWorkerSource(ee,oe,be,Le){return this.workerSources[ee]||(this.workerSources[ee]={}),this.workerSources[ee][Le]||(this.workerSources[ee][Le]={}),this.workerSources[ee][Le][oe]||(this.workerSources[ee][Le][oe]={}),this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),this.workerSources[ee][Le][oe][be]||(this.workerSources[ee][Le][oe][be]=new this.workerSourceTypes[oe]({send:(Oe,qe,nt,Ge,et,_t)=>{this.actor.send(Oe,qe,nt,ee,et,_t)},scheduler:this.actor.scheduler},this.getLayerIndex(ee,Le),this.getAvailableImages(ee,Le),this.isSpriteLoaded[ee][Le],void 0,this.brightness)),this.workerSources[ee][Le][oe][be]}getDEMWorkerSource(ee,oe,be){return this.demWorkerSources[ee]||(this.demWorkerSources[ee]={}),this.demWorkerSources[ee][be]||(this.demWorkerSources[ee][be]={}),this.demWorkerSources[ee][be][oe]||(this.demWorkerSources[ee][be][oe]=new Y),this.demWorkerSources[ee][be][oe]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Z),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ee,oe){a.eb(oe)}getWorkerPerformanceMetrics(ee,oe,be){be(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ku(self)),ku}),y(["./shared"],function(a){var A=D;function D(g){return!function(l){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,w=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(w);try{x=new Worker(S),_=!0}catch{_=!1}return x&&x.terminate(),URL.revokeObjectURL(S),_}()?function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var w=x.getImageData(0,0,1,1);return w&&w.width===_.width}()?(O[d=l&&l.failIfMajorPerformanceCaveat]===void 0&&(O[d]=function(_){var x,w=function(S){var C=document.createElement("canvas"),k=Object.create(D.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=S,C.getContext("webgl2",k)}(_);if(!w)return!1;try{x=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!x||w.isContextLost())&&(w.shaderSource(x,"void main() {}"),w.compileShader(x),w.getShaderParameter(x,w.COMPILE_STATUS)===!0)}(d)),O[d]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var d}(g)}var O={};function B(g,l,d){const _=document.createElement(g);return l!=null&&(_.className=l),d&&d.appendChild(_),_}function H(g,l,d){const _=document.createElementNS("http://www.w3.org/2000/svg",g);for(const x of Object.keys(l))_.setAttributeNS(null,x,String(l[x]));return d&&d.appendChild(_),_}D.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Q=typeof document<"u"?document.documentElement&&document.documentElement.style:null,re=Q&&Q.userSelect!==void 0?"userSelect":"WebkitUserSelect";let se;function G(){Q&&re&&(se=Q[re],Q[re]="none")}function Y(){Q&&re&&(Q[re]=se)}function Z(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",Z,!0)}function fe(){window.addEventListener("click",Z,!0),window.setTimeout(()=>{window.removeEventListener("click",Z,!0)},0)}function Te(g,l){const d=g.getBoundingClientRect();return he(g,d,l)}function Pe(g,l){const d=g.getBoundingClientRect(),_=[];for(let x=0;x<l.length;x++)_.push(he(g,d,l[x]));return _}function ce(g){return window.InstallTrigger!==void 0&&g.button===2&&g.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function he(g,l,d){const _=g.offsetWidth===l.width?1:g.offsetWidth/l.width;return new a.P((d.clientX-l.left)*_,(d.clientY-l.top)*_)}class W{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(l,d){this._updatedSourceCaches[l]=d,this.setDirty()}discardSourceCacheUpdate(l){delete this._updatedSourceCaches[l]}updateLayer(l){const d=l.scope;this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._updatedLayers[d].add(l.id),this.setDirty()}removeLayer(l){const d=l.scope;this._removedLayers[d]=this._removedLayers[d]||{},this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._removedLayers[d][l.id]=l,this._updatedLayers[d].delete(l.id),this._updatedPaintProps.delete(l.fqid),this.setDirty()}getRemovedLayer(l){return this._removedLayers[l.scope]?this._removedLayers[l.scope][l.id]:null}discardLayerRemoval(l){this._removedLayers[l.scope]&&delete this._removedLayers[l.scope][l.id]}getLayerUpdatesByScope(){const l={};for(const d in this._updatedLayers)l[d]=l[d]||{},l[d].updatedIds=Array.from(this._updatedLayers[d].values());for(const d in this._removedLayers)l[d]=l[d]||{},l[d].removedIds=Object.keys(this._removedLayers[d]);return l}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(l){this._updatedPaintProps.add(l.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(l){this._updatedImages.add(l),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const ge={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class _e{constructor(l,d,_,x,w,S){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=x,this.instanceCount=S,this.context=l;const C=l.gl;this.buffer=C.createBuffer(),l.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||w||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,d){for(let _=0;_<this.attributes.length;_++){const x=d.attributes[this.attributes[_].name];x!==void 0&&l.enableVertexAttribArray(x)}}setVertexAttribPointers(l,d,_){for(let x=0;x<this.attributes.length;x++){const w=this.attributes[x],S=d.attributes[w.name];S!==void 0&&l.vertexAttribPointer(S,w.components,l[ge[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}setVertexAttribDivisor(l,d,_){for(let x=0;x<this.attributes.length;x++){const w=d.attributes[this.attributes[x].name];w!==void 0&&this.instanceCount&&this.instanceCount>0&&l.vertexAttribDivisor(w,_)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ee{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class we extends Ee{getDefault(){return a.C.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class xt extends Ee{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Rt extends Ee{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Bt extends Ee{getDefault(){return[!0,!0,!0,!0]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class bt extends Ee{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class at extends Ee{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Ct extends Ee{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const d=this.current;(l.func!==d.func||l.ref!==d.ref||l.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Zt extends Ee{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class rt extends Ee{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=l,this.dirty=!1}}class wt extends Ee{getDefault(){return[0,1]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class pt extends Ee{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=l,this.dirty=!1}}class jt extends Ee{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Mt extends Ee{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.BLEND):d.disable(d.BLEND),this.current=l,this.dirty=!1}}class pn extends Ee{getDefault(){const l=this.gl;return[l.ONE,l.ZERO,l.ONE,l.ZERO]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.blendFuncSeparate(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class un extends Ee{getDefault(){return a.C.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class _n extends Ee{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(l,l),this.current=l,this.dirty=!1)}}class St extends Ee{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=l,this.dirty=!1}}class ln extends Ee{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Kt extends Ee{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let xn=class extends Ee{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class Er extends Ee{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class Dn extends Ee{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class hr extends Ee{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Fr extends Ee{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class ar extends Ee{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Yn extends Ee{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class De extends Ee{getDefault(){return null}set(l){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ze extends Ee{getDefault(){return null}set(l){this.gl&&(l!==this.current||this.dirty)&&(this.gl.bindVertexArray(l),this.current=l,this.dirty=!1)}}class st extends Ee{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class rn extends Ee{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Pt extends Ee{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class vn extends Ee{constructor(l,d){super(l),this.context=l,this.parent=d}getDefault(){return null}}class Sr extends vn{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class yn extends vn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Zn extends vn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,this.attachment(),d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class br extends yn{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Lr{constructor(l,d,_,x,w){this.context=l,this.width=d,this.height=_;const S=this.framebuffer=l.gl.createFramebuffer();x&&(this.colorAttachment=new Sr(l,S)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new yn(l,S):new Zn(l,S))}destroy(){const l=this.context.gl;if(this.colorAttachment){const d=this.colorAttachment.get();d&&l.deleteTexture(d)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const d=this.depthAttachment.get();d&&l.deleteRenderbuffer(d)}else{const d=this.depthAttachment.get();d&&l.deleteTexture(d)}l.deleteFramebuffer(this.framebuffer)}}class Li{constructor(l,d){this.gl=l,this.clearColor=new we(this),this.clearDepth=new xt(this),this.clearStencil=new Rt(this),this.colorMask=new Bt(this),this.depthMask=new bt(this),this.stencilMask=new at(this),this.stencilFunc=new Ct(this),this.stencilOp=new Zt(this),this.stencilTest=new rt(this),this.depthRange=new wt(this),this.depthTest=new pt(this),this.depthFunc=new jt(this),this.blend=new Mt(this),this.blendFunc=new pn(this),this.blendColor=new un(this),this.blendEquation=new _n(this),this.cullFace=new St(this),this.cullFaceSide=new ln(this),this.frontFace=new Kt(this),this.program=new xn(this),this.activeTexture=new Er(this),this.viewport=new Dn(this),this.bindFramebuffer=new hr(this),this.bindRenderbuffer=new Fr(this),this.bindTexture=new ar(this),this.bindVertexBuffer=new Yn(this),this.bindElementBuffer=new De(this),this.bindVertexArrayOES=new Ze(this),this.pixelStoreUnpack=new st(this),this.pixelStoreUnpackPremultiplyAlpha=new rn(this),this.pixelStoreUnpackFlipY=new Pt(this),this.options=d?{...d}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=l.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),this.maxPointSize=l.getParameter(l.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,d,_){return new a.I(this,l,d,_)}createVertexBuffer(l,d,_,x,w){return new _e(this,l,d,_,x,w)}createRenderbuffer(l,d,_){const x=this.gl,w=x.createRenderbuffer();return this.bindRenderbuffer.set(w),x.renderbufferStorage(x.RENDERBUFFER,l,d,_),this.bindRenderbuffer.set(null),w}createFramebuffer(l,d,_,x){return new Lr(this,l,d,_,x)}clear({color:l,depth:d,stencil:_,colorMask:x}){const w=this.gl;let S=0;l&&(S|=w.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set(x||[!0,!0,!0,!0])),d!==void 0&&(S|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),_!==void 0&&(S|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),w.clear(S)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){a.d(l.blendFunction,a.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor),l.blendEquation?this.blendEquation.set(l.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(l.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class dr{constructor(l,d,_,x){const w={width:_[0],height:_[1],data:null},S=l.gl;this.targetColorTexture=new a.T(l,w,S.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new a.T(l,w,S.RGBA,{useMipmap:!1}),this.context=l,this.updateParticleTexture(d,x),this.lastInvalidatedAt=0}updateParticleTexture(l,d){if(this.particleTextureDimension===d.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const _=this.context.gl,x=d.width*d.height;this.particleTexture0=new a.T(this.context,d,_.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new a.T(this.context,d,_.RGBA,{premultiply:!1,useMipmap:!1});const w=new a.S;w.reserve(x);for(let S=0;S<x;S++)w.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(w,a.p.members,!0),this.particleSegment=a.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=d.width}update(l){return!(this.lastInvalidatedAt<l&&(this.lastInvalidatedAt=a.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class zi extends a.E{constructor(l){super(),this.requestManager=l,this.models={"":{}},this.numModelsLoading={}}loadModel(l,d){return a.l(this.requestManager.transformRequest(d,a.R.Model).url).then(_=>{if(!_)return;const x=a.c(_),w=new a.M(l,void 0,void 0,x);return w.computeBoundsAndApplyParent(),w}).catch(_=>{if(_&&_.status===404)return null;this.fire(new a.f(new Error(`Could not load model ${l} from ${d}: ${_.message}`)))})}load(l,d){this.models[d]||(this.models[d]={});const _=Object.keys(l);this.numModelsLoading[d]=(this.numModelsLoading[d]||0)+_.length;const x=[];for(const w of _)x.push(this.loadModel(w,l[w]));Promise.allSettled(x).then(w=>{for(let S=0;S<w.length;S++){const{status:C,value:k}=w[S];C==="fulfilled"&&k&&(this.models[d][_[S]]={model:k,numReferences:1})}this.numModelsLoading[d]-=_.length,this.fire(new a.g("data",{dataType:"style"}))}).catch(w=>{this.fire(new a.f(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const l in this.numModelsLoading)if(this.numModelsLoading[l]>0)return!1;return!0}hasModel(l,d){return!!this.getModel(l,d)}getModel(l,d){return this.models[d]||(this.models[d]={}),this.models[d][l]?this.models[d][l].model:void 0}addModel(l,d,_){this.models[_]||(this.models[_]={}),this.hasModel(l,_)&&this.models[_][l].numReferences++,this.load({[l]:this.requestManager.normalizeModelURL(d)},_)}addModels(l,d){this.models[d]||(this.models[d]={});const _={};for(const x in l)this.models[d][x]={},_[x]=this.requestManager.normalizeModelURL(l[x]);this.load(_,d)}addModelsFromBucket(l,d){this.models[d]||(this.models[d]={});const _={};for(const x of l)this.hasModel(x,d)?this.models[d][x].numReferences++:_[x]=this.requestManager.normalizeModelURL(x);this.load(_,d)}removeModel(l,d){if(this.models[d]&&this.models[d][l]&&(this.models[d][l].numReferences--,this.models[d][l].numReferences===0)){const _=this.models[d][l].model;delete this.models[d][l],_.destroy()}}listModels(l){return this.models[l]||(this.models[l]={}),Object.keys(this.models[l])}upload(l,d){this.models[d]||(this.models[d]={});for(const _ in this.models[d])this.models[d][_].model&&this.models[d][_].model.upload(l.context)}}function ls(g){const{userImage:l}=g;return!!(l&&l.render&&l.render())&&(g.data.replace(new Uint8Array(l.data.buffer)),!0)}class Sn extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(l){this.images[l]={},this.loaded[l]=!1,this.updatedImages[l]={},this.patterns[l]={},this.callbackDispatchedThisFrame[l]={},this.atlasImage[l]=new a.j({width:1,height:1})}isLoaded(){for(const l in this.loaded)if(!this.loaded[l])return!1;return!0}setLoaded(l,d){if(this.loaded[d]!==l&&(this.loaded[d]=l,l)){for(const{ids:_,callback:x}of this.requestors)this._notify(_,d,x);this.requestors=[]}}hasImage(l,d){return!!this.getImage(l,d)}getImage(l,d){return this.images[d][l]}addImage(l,d,_){this._validate(l,_)&&(this.images[d][l]=_)}_validate(l,d){let _=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new a.f(new Error(`Image "${l}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new a.f(new Error(`Image "${l}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new a.f(new Error(`Image "${l}" has invalid "content" value`))),_=!1),_}_validateStretch(l,d){if(!l)return!0;let _=0;for(const x of l){if(x[0]<_||x[1]<x[0]||d<x[1])return!1;_=x[1]}return!0}_validateContent(l,d){return!(l&&(l.length!==4||l[0]<0||d.data.width<l[0]||l[1]<0||d.data.height<l[1]||l[2]<0||d.data.width<l[2]||l[3]<0||d.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,d,_){_.version=this.images[d][l].version+1,this.images[d][l]=_,this.updatedImages[d][l]=!0}removeImage(l,d){const _=this.images[d][l];delete this.images[d][l],delete this.patterns[d][l],_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(l){return Object.keys(this.images[l])}getImages(l,d,_){let x=!0;const w=!!this.loaded[d];if(!w)for(const S of l)this.images[d][S]||(x=!1);w||x?this._notify(l,d,_):this.requestors.push({ids:l,scope:d,callback:_})}getUpdatedImages(l){return this.updatedImages[l]}_notify(l,d,_){const x={};for(const w of l){this.images[d][w]||this.fire(new a.g("styleimagemissing",{id:w}));const S=this.images[d][w];S?x[w]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:a.w(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}_(null,x)}getPixelSize(l){const{width:d,height:_}=this.atlasImage[l];return{width:d,height:_}}getPattern(l,d,_){const x=this.patterns[d][l],w=this.getImage(l,d);if(!w)return null;if(x&&x.position.version===w.version)return x.position;if(x)x.position.version=w.version;else{const S={w:w.data.width+2,h:w.data.height+2,x:0,y:0},C=new a.m(S,w);this.patterns[d][l]={bin:S,position:C}}return this._updatePatternAtlas(d,_),this.patterns[d][l].position}bind(l,d){const _=l.gl;let x=this.atlasTexture[d];x?this.dirty&&(x.update(this.atlasImage[d]),this.dirty=!1):(x=new a.T(l,this.atlasImage[d],_.RGBA),this.atlasTexture[d]=x),x.bind(_.LINEAR,_.CLAMP_TO_EDGE)}_updatePatternAtlas(l,d){const _=[];for(const C in this.patterns[l])_.push(this.patterns[l][C].bin);const{w:x,h:w}=a.k(_),S=this.atlasImage[l];S.resize({width:x||1,height:w||1});for(const C in this.patterns[l]){const{bin:k}=this.patterns[l][C],L=k.x+1,N=k.y+1,U=this.images[l][C].data,$=U.width,q=U.height;a.j.copy(U,S,{x:0,y:0},{x:L,y:N},{width:$,height:q},d),a.j.copy(U,S,{x:0,y:q-1},{x:L,y:N-1},{width:$,height:1},d),a.j.copy(U,S,{x:0,y:0},{x:L,y:N+q},{width:$,height:1},d),a.j.copy(U,S,{x:$-1,y:0},{x:L-1,y:N},{width:1,height:q},d),a.j.copy(U,S,{x:0,y:0},{x:L+$,y:N},{width:1,height:q},d)}this.dirty=!0}beginFrame(){for(const l in this.images)this.callbackDispatchedThisFrame[l]={}}dispatchRenderCallbacks(l,d){for(const _ of l){if(this.callbackDispatchedThisFrame[d][_])continue;this.callbackDispatchedThisFrame[d][_]=!0;const x=this.images[d][_];ls(x)&&this.updateImage(_,d,x)}}}function lr(g){const l=g.key,d=g.value,_=g.valueSpec||{},x=g.objectElementValidators||{},w=g.style,S=g.styleSpec;let C=[];const k=a.o(d);if(k!=="object")return[new a.V(l,d,`object expected, ${k} found`)];for(const L in d){const N=L.split(".")[0];let U;x[N]?U=x[N]:_[N]?U=Ni:x["*"]?U=x["*"]:_["*"]&&(U=Ni),U?C=C.concat(U({key:(l&&`${l}.`)+L,value:d[L],valueSpec:_[N]||_["*"],style:w,styleSpec:S,object:d,objectKey:L},d)):C.push(new a.n(l,d[L],`unknown property "${L}"`))}for(const L in _)x[L]||_[L].required&&_[L].default===void 0&&d[L]===void 0&&C.push(new a.V(l,d,`missing required property "${L}"`));return C}function hn(g){const l=g.value,d=g.valueSpec,_=g.style,x=g.styleSpec,w=g.key,S=g.arrayElementValidator||Ni;if(a.o(l)!=="array")return[new a.V(w,l,`array expected, ${a.o(l)} found`)];if(d.length&&l.length!==d.length)return[new a.V(w,l,`array length ${d.length} expected, length ${l.length} found`)];if(d["min-length"]&&l.length<d["min-length"])return[new a.V(w,l,`array length at least ${d["min-length"]} expected, length ${l.length} found`)];let C={type:d.value,values:d.values,minimum:d.minimum,maximum:d.maximum,function:void 0};x.$version<7&&(C.function=d.function),a.o(d.value)==="object"&&(C=d.value);let k=[];for(let L=0;L<l.length;L++)k=k.concat(S({array:l,arrayIndex:L,value:l[L],valueSpec:C,style:_,styleSpec:x,key:`${w}[${L}]`},!0));return k}function Zs(g){const l=g.key,d=g.value,_=g.valueSpec;let x=a.o(d);if(x==="number"&&d!=d&&(x="NaN"),x!=="number")return[new a.V(l,d,`number expected, ${x} found`)];if("minimum"in _){let w=_.minimum;if(a.o(_.minimum)==="array"&&(w=_.minimum[g.arrayIndex]),d<w)return[new a.V(l,d,`${d} is less than the minimum value ${w}`)]}if("maximum"in _){let w=_.maximum;if(a.o(_.maximum)==="array"&&(w=_.maximum[g.arrayIndex]),d>w)return[new a.V(l,d,`${d} is greater than the maximum value ${w}`)]}return[]}function Ei(g){const l=g.valueSpec,d=a.u(g.value.type);let _,x,w,S={};const C=d!=="categorical"&&g.value.property===void 0,k=!C,L=a.o(g.value.stops)==="array"&&a.o(g.value.stops[0])==="array"&&a.o(g.value.stops[0][0])==="object",N=lr({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(q){if(d==="identity")return[new a.V(q.key,q.value,'identity function may not have a "stops" property')];let te=[];const ne=q.value;return te=te.concat(hn({key:q.key,value:ne,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:U})),a.o(ne)==="array"&&ne.length===0&&te.push(new a.V(q.key,ne,"array must have at least one stop")),te},default:function(q){return Ni({key:q.key,value:q.value,valueSpec:l,style:q.style,styleSpec:q.styleSpec})}}});return d==="identity"&&C&&N.push(new a.V(g.key,g.value,'missing required property "property"')),d==="identity"||g.value.stops||N.push(new a.V(g.key,g.value,'missing required property "stops"')),d==="exponential"&&g.valueSpec.expression&&!a.s(g.valueSpec)&&N.push(new a.V(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(k&&!a.r(g.valueSpec)?N.push(new a.V(g.key,g.value,"property functions not supported")):C&&!a.t(g.valueSpec)&&N.push(new a.V(g.key,g.value,"zoom functions not supported"))),d!=="categorical"&&!L||g.value.property!==void 0||N.push(new a.V(g.key,g.value,'"property" property is required')),N;function U(q){let te=[];const ne=q.value,ie=q.key;if(a.o(ne)!=="array")return[new a.V(ie,ne,`array expected, ${a.o(ne)} found`)];if(ne.length!==2)return[new a.V(ie,ne,`array length 2 expected, length ${ne.length} found`)];if(L){if(a.o(ne[0])!=="object")return[new a.V(ie,ne,`object expected, ${a.o(ne[0])} found`)];if(ne[0].zoom===void 0)return[new a.V(ie,ne,"object stop key must have zoom")];if(ne[0].value===void 0)return[new a.V(ie,ne,"object stop key must have value")];const ae=a.u(ne[0].zoom);if(typeof ae!="number")return[new a.V(ie,ne[0].zoom,"stop zoom values must be numbers")];if(w&&w>ae)return[new a.V(ie,ne[0].zoom,"stop zoom values must appear in ascending order")];ae!==w&&(w=ae,x=void 0,S={}),te=te.concat(lr({key:`${ie}[0]`,value:ne[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:Zs,value:$}}))}else te=te.concat($({key:`${ie}[0]`,value:ne[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},ne));return a.v(a.x(ne[1]))?te.concat([new a.V(`${ie}[1]`,ne[1],"expressions are not allowed in function stops.")]):te.concat(Ni({key:`${ie}[1]`,value:ne[1],valueSpec:l,style:q.style,styleSpec:q.styleSpec}))}function $(q,te){const ne=a.o(q.value),ie=a.u(q.value),ae=q.value!==null?q.value:te;if(_){if(ne!==_)return[new a.V(q.key,ae,`${ne} stop domain type must match previous stop domain type ${_}`)]}else _=ne;if(ne!=="number"&&ne!=="string"&&ne!=="boolean"&&typeof ie!="number"&&typeof ie!="string"&&typeof ie!="boolean")return[new a.V(q.key,ae,"stop domain value must be a number, string, or boolean")];if(ne!=="number"&&d!=="categorical"){let ve=`number expected, ${ne} found`;return a.r(l)&&d===void 0&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new a.V(q.key,ae,ve)]}return d!=="categorical"||ne!=="number"||typeof ie=="number"&&isFinite(ie)&&Math.floor(ie)===ie?d!=="categorical"&&ne==="number"&&typeof ie=="number"&&typeof x=="number"&&x!==void 0&&ie<x?[new a.V(q.key,ae,"stop domain values must appear in ascending order")]:(x=ie,d==="categorical"&&ie in S?[new a.V(q.key,ae,"stop domain values must be unique")]:(S[ie]=!0,[])):[new a.V(q.key,ae,`integer expected, found ${String(ie)}`)]}}function ao(g){const l=(g.expressionContext==="property"?a.y:a.z)(a.x(g.value),g.valueSpec);if(l.result==="error")return l.value.map(_=>new a.V(`${g.key}${_.key}`,g.value,_.message));const d=l.value.expression||l.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!d.outputDefined())return[new a.V(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!a.A(d))return[new a.V(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter")return _a(d,g);if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!a.B(d,["zoom","feature-state"]))return[new a.V(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!a.D(d))return[new a.V(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function _a(g,l){const d=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(l.valueSpec&&l.valueSpec.expression)for(const x of l.valueSpec.expression.parameters)d.delete(x);if(d.size===0)return[];const _=[];return g instanceof a.F&&d.has(g.name)?[new a.V(l.key,l.value,`["${g.name}"] expression is not supported in a filter for a ${l.object.type} layer with id: ${l.object.id}`)]:(g.eachChild(x=>{_.push(..._a(x,l))}),_)}function en(g){const l=g.key,d=g.value,_=g.valueSpec,x=[];return Array.isArray(_.values)?_.values.indexOf(a.u(d))===-1&&x.push(new a.V(l,d,`expected one of [${_.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(_.values).indexOf(a.u(d))===-1&&x.push(new a.V(l,d,`expected one of [${Object.keys(_.values).join(", ")}], ${JSON.stringify(d)} found`)),x}function Kn(g){return a.H(a.x(g.value))?ao(a.q({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):ei(g)}function ei(g){const l=g.value,d=g.key;if(a.o(l)!=="array")return[new a.V(d,l,`array expected, ${a.o(l)} found`)];const _=g.styleSpec;let x,w=[];if(l.length<1)return[new a.V(d,l,"filter array must have at least 1 element")];switch(w=w.concat(en({key:`${d}[0]`,value:l[0],valueSpec:_.filter_operator,style:g.style,styleSpec:g.styleSpec})),a.u(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&a.u(l[1])==="$type"&&w.push(new a.V(d,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&w.push(new a.V(d,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(x=a.o(l[1]),x!=="string"&&w.push(new a.V(`${d}[1]`,l[1],`string expected, ${x} found`)));for(let S=2;S<l.length;S++)x=a.o(l[S]),a.u(l[1])==="$type"?w=w.concat(en({key:`${d}[${S}]`,value:l[S],valueSpec:_.geometry_type,style:g.style,styleSpec:g.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&w.push(new a.V(`${d}[${S}]`,l[S],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let S=1;S<l.length;S++)w=w.concat(ei({key:`${d}[${S}]`,value:l[S],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":x=a.o(l[1]),l.length!==2?w.push(new a.V(d,l,`filter array for "${l[0]}" operator must have 2 elements`)):x!=="string"&&w.push(new a.V(`${d}[1]`,l[1],`string expected, ${x} found`))}return w}function Ai(g,l){const d=g.key,_=g.style,x=g.layer,w=g.styleSpec,S=g.value,C=g.objectKey,k=w[`${l}_${g.layerType}`];if(!k)return[];const L=C.match(/^(.*)-transition$/);if(l==="paint"&&L&&k[L[1]]&&k[L[1]].transition)return Ni({key:d,value:S,valueSpec:w.transition,style:_,styleSpec:w});const N=g.valueSpec||k[C];if(!N)return[new a.n(d,S,`unknown property "${C}"`)];let U;if(a.o(S)==="string"&&a.r(N)&&!N.tokens&&(U=/^{([^}]+)}$/.exec(S))){const q=`\`{ "type": "identity", "property": ${U?JSON.stringify(U[1]):'"_"'} }\``;return[new a.V(d,S,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${q}.`)]}const $=[];if(g.layerType==="symbol")C!=="text-field"||!_||_.glyphs||_.imports||$.push(new a.V(d,S,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&a.J(a.x(S))&&a.u(S.type)==="identity"&&$.push(new a.V(d,S,'"text-font" does not support identity functions'));else if(g.layerType==="model"&&l==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&a.r(N)&&(a.K(N)||a.t(N))){const q=a.y(a.x(S),N),te=q.value.expression||q.value._styleExpression.expression;te&&!a.B(te,["measure-light"])&&(C==="model-emissive-strength"&&a.D(te)&&a.A(te)||$.push(new a.V(d,S,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return $.concat(Ni({key:g.key,value:S,valueSpec:N,style:_,styleSpec:w,expressionContext:"property",propertyType:l,propertyKey:C}))}function vs(g){return Ai(g,"paint")}function xs(g){return Ai(g,"layout")}function Ps(g){let l=[];const d=g.value,_=g.key,x=g.style,w=g.styleSpec;d.type||d.ref||l.push(new a.V(_,d,'either "type" or "ref" is required'));let S=a.u(d.type);const C=a.u(d.ref);if(d.id){const k=a.u(d.id);for(let L=0;L<g.arrayIndex;L++){const N=x.layers[L];a.u(N.id)===k&&l.push(new a.V(_,d.id,`duplicate layer id "${d.id}", previously used at line ${N.id.__line__}`))}}if("ref"in d){let k;["type","source","source-layer","filter","layout"].forEach(L=>{L in d&&l.push(new a.V(_,d[L],`"${L}" is prohibited for ref layers`))}),x.layers.forEach(L=>{a.u(L.id)===C&&(k=L)}),k?k.ref?l.push(new a.V(_,d.ref,"ref cannot reference another ref layer")):S=a.u(k.type):typeof C=="string"&&l.push(new a.V(_,d.ref,`ref layer "${C}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(d.source){const k=x.sources&&x.sources[d.source],L=k&&a.u(k.type);k?L==="vector"&&S==="raster"?l.push(new a.V(_,d.source,`layer "${d.id}" requires a raster source`)):L==="raster"&&S!=="raster"?l.push(new a.V(_,d.source,`layer "${d.id}" requires a vector source`)):L!=="vector"||d["source-layer"]?L==="raster-dem"&&S!=="hillshade"?l.push(new a.V(_,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!d.paint||!d.paint["line-gradient"]&&!d.paint["line-trim-offset"]||L==="geojson"&&k.lineMetrics?S==="raster-particle"&&L!=="raster-array"&&l.push(new a.V(_,d.source,`layer "${d.id}" requires a 'raster-array' source.`)):l.push(new a.V(_,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new a.V(_,d.source,"raster-array source can only be used with layer type 'raster'.")):l.push(new a.V(_,d,`layer "${d.id}" must specify a "source-layer"`)):l.push(new a.V(_,d.source,`source "${d.source}" not found`))}else l.push(new a.V(_,d,'missing required property "source"'));return l=l.concat(lr({key:_,value:d,valueSpec:w.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ni({key:`${_}.type`,value:d.type,valueSpec:w.layer.type,style:g.style,styleSpec:g.styleSpec,object:d,objectKey:"type"}),filter:k=>Kn(a.q({layerType:S},k)),layout:k=>lr({layer:d,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":L=>xs(a.q({layerType:S},L))}}),paint:k=>lr({layer:d,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":L=>vs(a.q({layerType:S,layer:d},L))}})}})),l}function Ns(g){const l=g.value,d=g.key,_=a.o(l);return _!=="string"?[new a.V(d,l,`string expected, ${_} found`)]:[]}const Ro={promoteId:function({key:g,value:l}){if(a.o(l)==="string")return Ns({key:g,value:l});{const d=[];for(const _ in l)d.push(...Ns({key:`${g}.${_}`,value:l[_]}));return d}}};function Ur(g){const l=g.value,d=g.key,_=g.styleSpec,x=g.style;if(!l.type)return[new a.V(d,l,'"type" is required')];const w=a.u(l.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&(l.url||l.tiles||S.push(new a.n(d,l,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(lr({key:d,value:l,valueSpec:_[`source_${w.replace("-","_")}`],style:g.style,styleSpec:_,objectElementValidators:Ro})),S;case"geojson":if(S=lr({key:d,value:l,valueSpec:_.source_geojson,style:x,styleSpec:_,objectElementValidators:Ro}),l.cluster)for(const C in l.clusterProperties){const[k,L]=l.clusterProperties[C],N=typeof k=="string"?[k,["accumulated"],["get",C]]:k;S.push(...ao({key:`${d}.${C}.map`,value:L,expressionContext:"cluster-map"})),S.push(...ao({key:`${d}.${C}.reduce`,value:N,expressionContext:"cluster-reduce"}))}return S;case"video":return lr({key:d,value:l,valueSpec:_.source_video,style:x,styleSpec:_});case"image":return lr({key:d,value:l,valueSpec:_.source_image,style:x,styleSpec:_});case"canvas":return[new a.V(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return en({key:`${d}.type`,value:l.type,valueSpec:{values:Ua(_)},style:x,styleSpec:_})}}function Ua(g){return g.source.reduce((l,d)=>{const _=g[d];return _.type.type==="enum"&&(l=l.concat(Object.keys(_.type.values))),l},[])}function ti(g){const l=g.value,d=g.styleSpec,_=d.light,x=g.style;let w=[];const S=a.o(l);if(l===void 0)return w;if(S!=="object")return w=w.concat([new a.V("light",l,`object expected, ${S} found`)]),w;for(const C in l){const k=C.match(/^(.*)-transition$/);w=w.concat(k&&_[k[1]]&&_[k[1]].transition?Ni({key:C,value:l[C],valueSpec:d.transition,style:x,styleSpec:d}):_[C]?Ni({key:C,value:l[C],valueSpec:_[C],style:x,styleSpec:d}):[new a.V(C,l[C],`unknown property "${C}"`)])}return w}function gi(g){const l=g.value;let d=[];if(!l)return d;const _=a.o(l);if(_!=="object")return d=d.concat([new a.V("light-3d",l,`object expected, ${_} found`)]),d;const x=g.styleSpec,w=x["light-3d"],S=g.key,C=g.style,k=g.style.lights;for(const U of["type","id"])if(!(U in l))return d=d.concat([new a.V("light-3d",l,`missing property ${U} on light`)]),d;if(l.type&&k)for(let U=0;U<g.arrayIndex;U++){const $=a.u(l.type),q=k[U];a.u(q.type)===$&&d.push(new a.V(S,l.id,`duplicate light type "${l.type}", previously defined at line ${q.id.__line__}`))}const L=`properties_light_${l.type}`;if(!(L in x))return d=d.concat([new a.V("light-3d",l,`Invalid light type ${l.type}`)]),d;const N=x[L];for(const U in l)if(U==="properties"){const $=l[U],q=a.o($);if(q!=="object")return d=d.concat([new a.V("properties",$,`object expected, ${q} found`)]),d;for(const te in $)d=d.concat(N[te]?Ni({key:te,value:$[te],valueSpec:N[te],style:C,styleSpec:x}):[new a.n(g.key,$[te],`unknown property "${te}"`)])}else{const $=U.match(/^(.*)-transition$/);d=d.concat($&&w[$[1]]&&w[$[1]].transition?Ni({key:U,value:l[U],valueSpec:x.transition,style:C,styleSpec:x}):w[U]?Ni({key:U,value:l[U],valueSpec:w[U],style:C,styleSpec:x}):[new a.n(U,l[U],`unknown property "${U}"`)])}return d}function pl(g){const l=g.value,d=g.key,_=g.style,x=g.styleSpec,w=x.terrain;let S=[];const C=a.o(l);if(l===void 0||C==="null")return S;if(C!=="object")return S=S.concat([new a.V("terrain",l,`object expected, ${C} found`)]),S;for(const k in l){const L=k.match(/^(.*)-transition$/);S=S.concat(L&&w[L[1]]&&w[L[1]].transition?Ni({key:k,value:l[k],valueSpec:x.transition,style:_,styleSpec:x}):w[k]?Ni({key:k,value:l[k],valueSpec:w[k],style:_,styleSpec:x}):[new a.n(k,l[k],`unknown property "${k}"`)])}if(l.source){const k=_.sources&&_.sources[l.source],L=k&&a.u(k.type);k?L!=="raster-dem"&&S.push(new a.V(d,l.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):S.push(new a.V(d,l.source,`source "${l.source}" not found`))}else S.push(new a.V(d,l,'terrain is missing required property "source"'));return S}function ya(g){const l=g.value,d=g.style,_=g.styleSpec,x=_.fog;let w=[];const S=a.o(l);if(l===void 0)return w;if(S!=="object")return w=w.concat([new a.V("fog",l,`object expected, ${S} found`)]),w;for(const C in l){const k=C.match(/^(.*)-transition$/);w=w.concat(k&&x[k[1]]&&x[k[1]].transition?Ni({key:C,value:l[C],valueSpec:_.transition,style:d,styleSpec:_}):x[C]?Ni({key:C,value:l[C],valueSpec:x[C],style:d,styleSpec:_}):[new a.n(C,l[C],`unknown property "${C}"`)])}return w}const lo={"*":()=>[],array:hn,boolean:function(g){const l=g.value,d=g.key,_=a.o(l);return _!=="boolean"?[new a.V(d,l,`boolean expected, ${_} found`)]:[]},number:Zs,color:function(g){const l=g.key,d=g.value,_=a.o(d);return _!=="string"?[new a.V(l,d,`color expected, ${_} found`)]:a.G(d)===null?[new a.V(l,d,`color expected, "${d}" found`)]:[]},enum:en,filter:Kn,function:Ei,layer:Ps,object:lr,source:Ur,model:a.L,light:ti,"light-3d":gi,terrain:pl,fog:ya,string:Ns,formatted:function(g){return Ns(g).length===0?[]:ao(g)},resolvedImage:function(g){return Ns(g).length===0?[]:ao(g)},projection:function(g){const l=g.value,d=g.styleSpec,_=d.projection,x=g.style;let w=[];const S=a.o(l);if(S==="object")for(const C in l)w=w.concat(Ni({key:C,value:l[C],valueSpec:_[C],style:x,styleSpec:d}));else S!=="string"&&(w=w.concat([new a.V("projection",l,`object or string expected, ${S} found`)]));return w},import:function(g){const{value:l,styleSpec:d}=g,{data:_,...x}=l;Object.defineProperty(x,"__line__",{value:l.__line__,enumerable:!1});let w=lr(a.q({},g,{value:x,valueSpec:d.import}));return a.u(x.id)===""&&w.push(new a.V(`${g.key}.id`,x,"import id can't be an empty string")),_&&(w=w.concat(Ve(_,d,{key:`${g.key}.data`}))),w}};function Ni(g,l=!1){const d=g.value,_=g.valueSpec,x=g.styleSpec;if(_.expression&&a.J(a.u(d)))return Ei(g);if(_.expression&&a.v(a.x(d)))return ao(g);if(_.type&&lo[_.type]){const w=lo[_.type](g);return l===!0&&w.length>0&&a.o(g.value)==="array"?ao(g):w}return lr(a.q({},g,{valueSpec:_.type?x[_.type]:_}))}function ku(g){const l=g.value,d=g.key,_=Ns(g);return _.length||(l.indexOf("{fontstack}")===-1&&_.push(new a.V(d,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&_.push(new a.V(d,l,'"glyphs" url must include a "{range}" token'))),_}function Ve(g,l=a.N,d={}){return Ni({key:d.key||"",value:g,valueSpec:l.$root,styleSpec:l,style:g,objectElementValidators:{glyphs:ku,"*":()=>[]}})}function ee(g,l=a.N){return Gt(Ve(g,l))}const oe=g=>Gt(Ur(g)),be=g=>Gt(ti(g)),Le=g=>Gt(gi(g)),Oe=g=>Gt(pl(g)),qe=g=>Gt(ya(g)),nt=g=>Gt(Ps(g)),Ge=g=>Gt(Kn(g)),et=g=>Gt(vs(g)),_t=g=>Gt(xs(g)),yt=g=>Gt(a.L(g));function Gt(g){return g.slice().sort((l,d)=>l.line&&d.line?l.line-d.line:0)}function fn(g,l){let d=!1;if(l&&l.length)for(const _ of l)_ instanceof a.n?a.w(_.message):(g.fire(new a.f(new Error(_.message))),d=!0);return d}let En;class nr extends a.E{constructor(l,d="flat"){super(),this._transitionable=new a.O(En||(En=new a.U({anchor:new a.W(a.N.light.anchor),position:new a.X(a.N.light.position),color:new a.W(a.N.light.color),intensity:new a.W(a.N.light.intensity)}))),this.setLight(l,d),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,d,_={}){this._validate(be,l,_)||(this._transitionable.setTransitionOrValue(l),this.id=d)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,_){return(!_||_.validate!==!1)&&fn(this,l.call(ee,a.Q({value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.N})))}}const Cn=new a.U({source:new a.W(a.N.terrain.source),exaggeration:new a.W(a.N.terrain.exaggeration)});let rr=class extends a.E{constructor(g,l,d,_){super(),this.scope=d,this._transitionable=new a.O(Cn,d,_),this._transitionable.setTransitionOrValue(g,_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(g,l){this._transitionable.setTransitionOrValue(g,l)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new a.Y(g)).get("exaggeration")}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof a.Z}};const on=45,Hr=65,fr=.05;function ir(g,l,d,_){const x=a.a0(on,Hr,d),[w,S]=di(g,_);let C=1-Math.min(1,Math.exp((l-w)/(S-w)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*x*g.alpha}function di(g,l){const d=.5/Math.tan(.5*l);return[g.range[0]+d,g.range[1]+d]}function fi(g,l,d,_,x){const w=a.$.transformMat4([],[l,d,_],x.mercatorFogMatrix);return ir(g,a.$.length(w),x.pitch,x._fov)}function ji(g,l,d,_,x,w,S){const C=[[d,_,0],[x,_,0],[x,w,0],[d,w,0]];let k=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const N of C){const U=a.$.transformMat4([],N,l),$=a.$.length(U);k=Math.min(k,$),L=Math.max(L,$)}return[ir(g,k,S.pitch,S._fov),ir(g,L,S.pitch,S._fov)]}const bs=new a.U({range:new a.W(a.N.fog.range),color:new a.W(a.N.fog.color),"high-color":new a.W(a.N.fog["high-color"]),"space-color":new a.W(a.N.fog["space-color"]),"horizon-blend":new a.W(a.N.fog["horizon-blend"]),"star-intensity":new a.W(a.N.fog["star-intensity"]),"vertical-range":new a.W(a.N.fog["vertical-range"])});class Fs extends a.E{constructor(l,d,_,x){super(),this._transitionable=new a.O(bs,_,new Map(x)),this.set(l,x),this._transitioning=this._transitionable.untransitioned(),this._transform=d,this.properties=new a.a1(bs),this.scope=_}get state(){const l=this._transform,d=l.projection.name==="globe",_=a.a2(l.zoom),x=this.properties.get("range"),w=[.5,3];return{range:d?[a.a3(w[0],x[0],_),a.a3(w[1],x[1],_)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,d,_={}){if(this._validate(qe,l,_))return;const x=a.Q({},l);for(const w of Object.keys(a.N.fog))x[w]===void 0&&(x[w]=a.N.fog[w].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,d)}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.a0(on,Hr,l))*d.a}getOpacityAtLatLng(l,d){return this._transform.projection.supportsFog?function(_,x,w){const S=a._.fromLngLat(x),C=w.elevation?w.elevation.getAtPointOrZero(S):0;return fi(_,S.x,S.y,C,w)}(this.state,l,d):0}getOpacityForTile(l){if(!this._transform.projection.supportsFog)return[1,1];const d=this._transform.calculateFogTileMatrix(l.toUnwrapped());return ji(this.state,d,0,0,a.a4,a.a4,this._transform)}getOpacityForBounds(l,d,_,x,w){return this._transform.projection.supportsFog?ji(this.state,l,d,_,x,w,this._transform):[1,1]}getFovAdjustedRange(l){return this._transform.projection.supportsFog?di(this.state,l):[0,1]}isVisibleOnFrustum(l){if(!this._transform.projection.supportsFog)return!1;const d=[4,5,6,7];for(const _ of d){const x=l.points[_];let w;if(x[2]>=0)w=x;else{const S=l.points[_-4];w=a.a5(S,x,S[2]/(S[2]-x[2]))}if(fi(this.state,w[0],w[1],0,this._transform)>=fr)return!0}return!1}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,_){return(!_||_.validate!==!1)&&fn(this,l.call(ee,a.Q({value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.N})))}}class Gl extends a.E{constructor(l,d,_,x){super(),this.scope=_,this._options=l,this.properties=new a.a1(d),this._transitionable=new a.O(d,_,new Map(x)),this._transitionable.setTransitionOrValue(l.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(l){this._transitionable.setTransitionOrValue(this._options.properties,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(l,d){this._options=l,this._transitionable.setTransitionOrValue(l.properties,d)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let jh,$h;var Du=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Mn=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Mo=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Ko="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Rc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Gh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,si=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Mc=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,ql=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Wl=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Cf=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const kc=[];vo(Du,kc),vo(Mo,kc),vo(Mn,kc);const Ou={"_prelude_fog.vertex.glsl":Gh,"_prelude_terrain.vertex.glsl":Rc,"_prelude_shadow.vertex.glsl":Wl,"_prelude_fog.fragment.glsl":si,"_prelude_shadow.fragment.glsl":Cf,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Mc,"_prelude_raster_particle.glsl":ql},qh={};sr("",Rc),sr(si,Gh),sr(Cf,Wl),sr(Mc,""),sr(ql,"");const Wh=sr(Mn,Mo),xm=Du;var Dc={background:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:sr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:sr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:sr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:sr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:sr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:sr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);scaled_pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);scaled_pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:sr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_alignment;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);p.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);p.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:sr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:sr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:sr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:sr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:sr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:sr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:sr(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);v_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:sr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:sr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:sr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:sr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ko),skyboxGradient:sr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ko),skyboxCapture:sr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:sr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:sr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:sr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:sr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:sr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function vo(g,l){const d=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of d)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=_.split(" ");for(const w of x)l.includes(w)||l.push(w)}}function sr(g,l){const d=/#include\s+"([^"]+)"/g,_=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let x=l.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(L=>{const N=L.split(" ");return N[N.length-1]}),x=[...new Set(x)]);const w={},S=[],C=[];if(g=g.replace(d,(L,N)=>(C.push(N),"")),(l=l.replace(d,(L,N)=>(S.push(N),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let k=[...kc];vo(g,k),vo(l,k);for(const L of[...S,...C])Ou[L]||console.error(`Undefined include: ${L}`),qh[L]||(qh[L]=[],vo(Ou[L],qh[L])),k=[...k,...qh[L]];return{fragmentSource:g=g.replace(_,(L,N,U,$,q)=>(w[q]=!0,N==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${U} ${$} ${q};
#else
uniform ${U} ${$} u_${q};
#endif
`:N==="initialize"?`
#ifdef HAS_UNIFORM_u_${q}
    ${U} ${$} ${q} = u_${q};
#endif
`:N==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${U} ${$} ${q};
#endif
`:N==="initialize-attribute"?"":void 0)),vertexSource:l=l.replace(_,(L,N,U,$,q)=>{const te=$==="float"?"vec2":$,ne=q.match(/color/)?"color":te;return N==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${q}
in ${U} ${$} a_${q};
#endif
`:w[q]?N==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${U} ${te} a_${q};
out ${U} ${$} ${q};
#else
uniform ${U} ${$} u_${q};
#endif
`:N==="initialize"?ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${U} ${$} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${ne}(a_${q}, u_${q}_t);
#else
    ${U} ${$} ${q} = u_${q};
#endif
`:N==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${U} ${$} a_${q};
    out ${U} ${$} ${q};
#endif
`:N==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${q} = a_${q};
#endif
`:void 0:N==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${U} ${te} a_${q};
#else
uniform ${U} ${$} u_${q};
#endif
`:N==="define-instanced"?ne==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${q}0;
in vec4 a_${q}1;
in vec4 a_${q}2;
in vec4 a_${q}3;
#else
uniform ${U} ${$} u_${q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${U} ${te} a_${q};
#else
uniform ${U} ${$} u_${q};
#endif
`:N==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${U} ${$} ${q} = a_${q};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${U} ${$} ${q} = a_${q};
#else
    ${U} ${$} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${U} ${$} ${q} = unpack_mix_${ne}(a_${q}, u_${q}_t);
#else
    ${U} ${$} ${q} = u_${q};
#endif
`}),staticAttributes:x,usedDefines:k,vertexIncludes:S,fragmentIncludes:C}}class bm{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,d,_,x,w,S,C,k){this.context=l;let L=this.boundPaintVertexBuffers.length!==x.length;for(let U=0;!L&&U<x.length;U++)this.boundPaintVertexBuffers[U]!==x[U]&&(L=!0);let N=this.boundDynamicVertexBuffers.length!==C.length;for(let U=0;!N&&U<C.length;U++)this.boundDynamicVertexBuffers[U]!==C[U]&&(N=!0);if(!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==_||L||N||this.boundIndexBuffer!==w||this.boundVertexOffset!==S)this.freshBind(d,_,x,w,S,C,k);else{l.bindVertexArrayOES.set(this.vao);for(const U of C)U&&(U.bind(),k&&U.instanceCount&&U.setVertexAttribDivisor(l.gl,d,k));w&&w.dynamicDraw&&w.bind()}}freshBind(l,d,_,x,w,S,C){const k=l.numAttributes,L=this.context,N=L.gl;this.vao&&this.destroy(),this.vao=L.gl.createVertexArray(),L.bindVertexArrayOES.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=S,d.enableAttributes(N,l),d.bind(),d.setVertexAttribPointers(N,l,w);for(const U of _)U.enableAttributes(N,l),U.bind(),U.setVertexAttribPointers(N,l,w);for(const U of S)U&&(U.enableAttributes(N,l),U.bind(),U.setVertexAttribPointers(N,l,w),C&&U.instanceCount&&U.setVertexAttribDivisor(N,l,C));x&&x.bind(),L.currentNumAttributes=k}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function wm(g,l){const d=Math.pow(2,l.canonical.z),_=l.canonical.y;return[new a._(0,_/d).toLngLat().lat,new a._(0,(_+1)/d).toLngLat().lat]}function Oc(g,l,d,_,x,w,S){const C=g.context,k=C.gl,L=d.hillshadeFBO;if(!L)return;g.prepareDrawTile();const N=g.isTileAffectedByFog(l),U=g.getOrCreateProgram("hillshade",{overrideFog:N});C.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,L.colorAttachment.get());const $=((ie,ae,ve,xe)=>{const ye=ve.paint.get("hillshade-shadow-color"),Me=ve.paint.get("hillshade-highlight-color"),Se=ve.paint.get("hillshade-accent-color"),Ie=ve.paint.get("hillshade-emissive-strength");let Ne=a.ac(ve.paint.get("hillshade-illumination-direction"));if(ve.paint.get("hillshade-illumination-anchor")==="viewport")Ne-=ie.transform.angle;else if(ie.style&&ie.style.enable3dLights()&&ie.style.directionalLight){const We=ie.style.directionalLight.properties.get("direction"),Be=a.ad(We.x,We.y,We.z);Ne=a.ac(Be[1])}const Fe=!ie.options.moving;return{u_matrix:xe||ie.transform.calculateProjMatrix(ae.tileID.toUnwrapped(),Fe),u_image:0,u_latrange:wm(0,ae.tileID),u_light:[ve.paint.get("hillshade-exaggeration"),Ne],u_shadow:ye.toRenderColor(ve.lut),u_highlight:Me.toRenderColor(ve.lut),u_emissive_strength:Ie,u_accent:Se.toRenderColor(ve.lut)}})(g,d,_,g.terrain?l.projMatrix:null);g.uploadCommonUniforms(C,U,l.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:te,tileBoundsSegments:ne}=g.getTileBoundsBuffers(d);U.draw(g,k.TRIANGLES,x,w,S,a.ag.disabled,$,_.id,q,te,ne)}function Tm(g,l,d){if(!l.needsDEMTextureUpload)return;const _=g.context,x=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||g.getTileTexture(d.stride);const w=d.getPixels();l.demTexture?l.demTexture.update(w,{premultiply:!1}):l.demTexture=new a.T(_,w,x.R32F,{premultiply:!1}),l.needsDEMTextureUpload=!1}function gy(g,l,d){const _=g.context,x=_.gl;if(!l.dem)return;const w=l.dem;if(_.activeTexture.set(x.TEXTURE1),Tm(g,l,w),!l.demTexture)return;l.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const S=w.dim;_.activeTexture.set(x.TEXTURE0);let C=l.hillshadeFBO;if(!C){const $=new a.T(_,{width:S,height:S,data:null},x.RGBA);$.bind(x.LINEAR,x.CLAMP_TO_EDGE),C=l.hillshadeFBO=_.createFramebuffer(S,S,!0,"renderbuffer"),C.colorAttachment.set($.texture)}_.bindFramebuffer.set(C.framebuffer),_.viewport.set([0,0,S,S]);const{tileBoundsBuffer:k,tileBoundsIndexBuffer:L,tileBoundsSegments:N}=g.getMercatorTileBoundsBuffers(),U=[];g.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(g,x.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.unblended,a.ag.disabled,(($,q)=>{const te=q.stride,ne=a.ae.create();return a.ae.ortho(ne,0,a.a4,-a.a4,0,0,1),a.ae.translate(ne,ne,[0,-a.a4,0]),{u_matrix:ne,u_image:1,u_dimension:[te,te],u_zoom:$.overscaledZ}})(l.tileID,w),d.id,k,L,N),l.needsHillshadePrepare=!1}function Pf(g,l,d,_,x){const w=function(C,k){if(C)return x(C);if(k){if(g.url&&k.tiles&&g.tiles&&delete g.tiles,k.variants){if(!Array.isArray(k.variants))return x(new Error("variants must be an array"));for(const N of k.variants){if(N==null||typeof N!="object"||N.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(N.capabilities))return x(new Error("capabilities must be an array"));if(N.capabilities.length===1&&N.capabilities[0]==="meshopt"){k=a.Q(k,N);break}}}const L=a.ai(a.Q(k,g),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(L.vectorLayers=k.vector_layers,L.vectorLayerIds=L.vectorLayers.map(N=>N.id)),k.raster_layers&&(L.rasterLayers=k.raster_layers,L.rasterLayerIds=L.rasterLayers.map(N=>N.id)),L.tiles=l.canonicalizeTileset(L,g.url),x(null,L)}},S=function(C,k,L){if(!C)return null;if(!k&&!L)return C;L=L||C.worldview_default;const N=Object.values(C.language||{});if(N.length===0)return null;const U=Object.values(C.worldview||{});if(U.length===0)return null;const $=N.every(te=>te===k),q=U.every(te=>te===L);return $&&q?C:k in(C.language_options||{})||L in(C.worldview_options||{})?null:C.language_options&&C.worldview_options?C:null}(g.data,d,_);return S?a.e.frame(()=>w(null,S)):g.url?a.h(l.transformRequest(l.normalizeSourceURL(g.url,null,d,_),a.R.Source),w):a.e.frame(()=>{const{data:C,...k}=g;w(null,k)})}class ko{constructor(l,d,_){this.bounds=a.aj.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const d=Math.pow(2,l.z),_=Math.floor(a.ak(this.bounds.getWest())*d),x=Math.floor(a.al(this.bounds.getNorth())*d),w=Math.ceil(a.ak(this.bounds.getEast())*d),S=Math.ceil(a.al(this.bounds.getSouth())*d);return l.x>=_&&l.x<w&&l.y>=x&&l.y<S}}class xo extends a.E{constructor(l,d,_,x){super(),this.id=l,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.Q({type:"raster"},d),a.Q(this,a.ai(d,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"})),this._tileJSONRequest=Pf(this._options,this.map._requestManager,null,null,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new a.f(d)):_&&(a.Q(this,_),_.bounds&&(this.tileBounds=new ko(_.bounds,this.minzoom,this.maxzoom)),a.ao(_.tiles),this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))),l&&l(d)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=a.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return a.Q({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,d){const _=a.e.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);l.request=a.i(this.map._requestManager.transformRequest(x,a.R.Tile),(w,S,C,k)=>(delete l.request,l.aborted?(l.state="unloaded",d(null)):w?(l.state="errored",d(w)):S?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:C,expires:k}),l.setTexture(S,this.map.painter),l.state="loaded",a.an(this.dispatcher),void d(null)):d(null)))}abortTile(l,d){l.request&&(l.request.cancel(),delete l.request),d&&d()}unloadTile(l,d){l.texture&&l.texture instanceof a.T?(l.destroy(!0),l.texture&&l.texture instanceof a.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),d&&d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Em extends a.E{constructor(l,d,_,x){if(super(),this.id=l,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.Q(this,a.ai(d,["url","scheme","tileSize","promoteId"])),this._options=a.Q({type:"vector"},d),this._collectResourceTiming=!!d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new a.ap}load(l){this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=Pf(this._options,this.map._requestManager,d,_,(x,w)=>{this._tileJSONRequest=null,this._loaded=!0,x?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),_&&_.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new a.f(x))):w&&(a.Q(this,w),w.bounds&&(this.tileBounds=new ko(w.bounds,this.minzoom,this.maxzoom)),a.ao(w.tiles,this.map._requestManager._customAccessToken),this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))),l&&l(x)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=a.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return a.Q({},this._options)}loadTile(l,d){const _=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),x=this.map._requestManager.transformRequest(_,a.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,S={request:x,data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,lut:w?{image:w.image.clone()}:null,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(S.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=d:l.request=l.actor.send("reloadTile",S,C.bind(this));else if(l.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",S,C.bind(this),void 0,!0);else{const k=a.aq.call({deduped:this._deduped},S,(L,N)=>{L||!N?C.call(this,L):(S.data={cacheControl:N.cacheControl,expires:N.expires,rawData:N.rawData.slice(0)},l.actor&&l.actor.send("loadTile",S,C.bind(this),void 0,!0))},!0);l.request={cancel:k}}function C(k,L){return delete l.request,l.aborted?d(null):k&&k.status!==404?d(k):(L&&L.resourceTiming&&(l.resourceTiming=L.resourceTiming),this.map._refreshExpiredTiles&&L&&l.setExpiryData(L),l.loadVectorData(L,this.map.painter),a.an(this.dispatcher),d(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(l,d){l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const Lc=(g,l,d)=>({u_matrix:g,u_image0:0,u_skirt_height:l,u_ground_shadow_factor:d}),zc=(g,l,d,_,x,w,S,C,k,L,N,U,$,q,te,ne)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:d,u_zoom_transition:x,u_merc_center:w,u_image0:0,u_frustum_tl:S,u_frustum_tr:C,u_frustum_br:k,u_frustum_bl:L,u_globe_pos:N,u_globe_radius:U,u_viewport:$,u_grid_matrix:ne?Float32Array.from(ne):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:te});class Nc{constructor(l=0,d=0,_=0,x=0){if(isNaN(l)||l<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=_,this.right=x}interpolate(l,d,_){return d.top!=null&&l.top!=null&&(this.top=a.a3(l.top,d.top,_)),d.bottom!=null&&l.bottom!=null&&(this.bottom=a.a3(l.bottom,d.bottom,_)),d.left!=null&&l.left!=null&&(this.left=a.a3(l.left,d.left,_)),d.right!=null&&l.right!=null&&(this.right=a.a3(l.right,d.right,_)),this}getCenter(l,d){const _=a.au((this.left+l-this.right)/2,0,l),x=a.au((this.top+d-this.bottom)/2,0,d);return new a.P(_,x)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Nc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Yo(g,l){const d=a.ax(g,3);a.ae.fromQuat(g,l),a.aA(g,3,d)}function Nt(g,l){const d=a.aw.identity([]);return a.aw.rotateZ(d,d,-l),a.aw.rotateX(d,d,-g),d}function Hl(g,l){const d=[g[0],g[1],0],_=[l[0],l[1],0];if(a.$.length(d)>=1e-15){const S=a.$.normalize([],d);a.$.scale(_,S,a.$.dot(_,S)),l[0]=_[0],l[1]=_[1]}const x=a.$.cross([],l,g);if(a.$.len(x)<1e-15)return null;const w=Math.atan2(-x[1],x[0]);return Nt(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),w)}class Hh{constructor(l,d){this.position=l,this.orientation=d}get position(){return this._position}set position(l){if(l){const d=l instanceof a._?l:new a._(l[0],l[1],l[2]);this._renderWorldCopies&&(d.x=a.av(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(l,d){if(this.orientation=null,!this.position)return;const _=this.position,x=this._elevation?this._elevation.getAtPointOrZero(a._.fromLngLat(l)):0,w=a._.fromLngLat(l,x),S=[w.x-_.x,w.y-_.y,w.z-_.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=Hl(S,d)}setPitchBearing(l,d){this.orientation=Nt(a.ac(l),a.ac(-d))}}class oi{constructor(l,d){this._transform=a.ae.identity([]),this.orientation=d,this.position=l}get mercatorPosition(){const l=this.position;return new a._(l[0],l[1],l[2])}get position(){const l=a.ax(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var d;l&&a.aA(this._transform,3,[(d=l)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||a.aw.identity([]),l&&Yo(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,d){this._orientation=Nt(l,d),Yo(this._transform,this._orientation)}forward(){const l=a.ax(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=a.ax(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=a.ax(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,d){const _=new Float64Array(16);return a.ae.invert(_,this.getWorldToCamera(l,d)),_}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(l,d,_){const x=this.position;a.$.scale(x,x,-l);const w=new Float64Array(16);return a.ae.fromScaling(w,[_,_,_]),a.ae.translate(w,w,x),w[10]*=d,w}getWorldToCamera(l,d){const _=new Float64Array(16),x=new Float64Array(4),w=this.position;return a.aw.conjugate(x,this._orientation),a.$.scale(w,w,-l),a.ae.fromQuat(_,x),a.ae.translate(_,_,w),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=d,_[9]*=d,_[10]*=d,_[11]*=d,_}getCameraToClipPerspective(l,d,_,x){const w=new Float64Array(16);return a.ae.perspective(w,l,d,_,x),w}getCameraToClipOrthographic(l,d,_,x,w,S){const C=new Float64Array(16);return a.ae.ortho(C,l,d,_,x,w,S),C}getDistanceToElevation(l,d=!1){const _=l===0?0:a.ay(l,d?a.az(this.position[1]):this.position[1]),x=this.forward();return(_-this.position[2])/x[2]}clone(){return new oi([...this.position],[...this.orientation])}}const Qn={unknown:0,flipRequired:1,flipNotRequired:2},Xs=Math.tan(85*Math.PI/180);function Fc(g,l,d,_,x,w,S){const C=a.ae.create();if(d)if(w.name==="globe"){const k=a.aC(x,l);a.ae.multiply(C,C,k)}else{const k=a.aD.invert([],S);C[0]=k[0],C[1]=k[1],C[4]=k[2],C[5]=k[3],_||a.ae.rotateZ(C,C,x.angle)}else a.ae.multiply(C,x.labelPlaneMatrix,g);return C}function Lu(g,l,d,_,x,w,S){const C=Fc(g,l,d,_,x,w,S);return w.name==="globe"&&d||(C[2]=C[6]=C[10]=C[14]=0),C}function zu(g,l,d,_,x,w,S){if(d){if(w.name==="globe"){const C=Fc(g,l,d,_,x,w,S);return a.ae.invert(C,C),a.ae.multiply(C,g,C),C}{const C=a.ae.clone(g),k=a.ae.identity([]);return k[0]=S[0],k[1]=S[1],k[4]=S[2],k[5]=S[3],a.ae.multiply(C,C,k),_||a.ae.rotateZ(C,C,-x.angle),C}}return x.glCoordMatrix}function co(g,l,d,_){const x=[g,l,d,1];d?a.aB.transformMat4(x,x,_):Rf(x,x,_);const w=x[3];return x[0]/=w,x[1]/=w,x[2]/=w,x}function Gn(g,l){return Math.min(.5+g/l*.5,1.5)}function Qo(g,l){const d=g[0]/g[3],_=g[1]/g[3];return d>=-l[0]&&d<=l[0]&&_>=-l[1]&&_<=l[1]}function Zl(g,l,d,_,x,w,S,C,k,L){const N=d.transform,U=_?g.textSizeData:g.iconSizeData,$=a.aE(U,d.transform.zoom),q=N.projection.name==="globe",te=[256/d.width*2+1,256/d.height*2+1],ne=_?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;ne.clear();let ie=null;q&&(ie=_?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const ae=g.lineVertexArray,ve=_?g.text.placedSymbolArray:g.icon.placedSymbolArray,xe=d.transform.width/d.transform.height;let ye,Me=!1;for(let Se=0;Se<ve.length;Se++){const Ie=ve.get(Se),{numGlyphs:Ne,writingMode:Fe}=Ie;if(Fe!==a.aF.vertical||Me||ye===a.aF.horizontal||(Me=!0),ye=Fe,(Ie.hidden||Fe===a.aF.vertical)&&!Me){va(Ne,ne);continue}Me=!1;const We=new a.P(Ie.tileAnchorX,Ie.tileAnchorY);let{x:Be,y:Re,z:Je}=N.projection.projectTilePoint(We.x,We.y,L.canonical);if(k){const[Ut,$t,tn]=k(We);Be+=Ut,Re+=$t,Je+=tn}const Ye=[Be,Re,Je,1];if(a.aB.transformMat4(Ye,Ye,l),!Qo(Ye,te)){va(Ne,ne);continue}const je=Ye[3],vt=Gn(d.transform.getCameraToCenterDistance(N.projection),je),dt=a.aG(U,$,Ie),He=S?dt/vt:dt*vt,it=co(Be,Re,Je,x);if(it[3]<=0){va(Ne,ne);continue}let Ue={};const ft=S?null:k,gt=ws(Ie,He,!1,C,l,x,w,g.glyphOffsetArray,ae,ne,ie,it,We,Ue,xe,ft,N.projection,L,S);Me=gt.useVertical,ft&&gt.needsFlipping&&(Ue={}),(gt.notEnoughRoom||Me||gt.needsFlipping&&ws(Ie,He,!0,C,l,x,w,g.glyphOffsetArray,ae,ne,ie,it,We,Ue,xe,ft,N.projection,L,S).notEnoughRoom)&&va(Ne,ne)}_?(g.text.dynamicLayoutVertexBuffer.updateData(ne),ie&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(ie)):(g.icon.dynamicLayoutVertexBuffer.updateData(ne),ie&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(ie))}function Nu(g,l,d,_,x,w,S,C,k,L,N,U,$,q,te,ne){const{lineStartIndex:ie,glyphStartIndex:ae,segment:ve}=C,xe=ae+C.numGlyphs,ye=ie+C.lineLength,Me=l.getoffsetX(ae),Se=l.getoffsetX(xe-1),Ie=Yl(g*Me,d,_,x,w,S,ve,ie,ye,k,L,N,U,$,!0,q,te,ne);if(!Ie)return null;const Ne=Yl(g*Se,d,_,x,w,S,ve,ie,ye,k,L,N,U,$,!0,q,te,ne);return Ne?{first:Ie,last:Ne}:null}function Xl(g,l,d,_){return g===a.aF.horizontal&&Math.abs(_)>Math.abs(d)?{useVertical:!0}:g===a.aF.vertical?_>0?{needsFlipping:!0}:null:l!==Qn.unknown&&function(x,w){return x===0||Math.abs(w/x)>Xs}(d,_)?l===Qn.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null}function ws(g,l,d,_,x,w,S,C,k,L,N,U,$,q,te,ne,ie,ae,ve){const xe=l/24,ye=g.lineOffsetX*xe,Me=g.lineOffsetY*xe,{lineStartIndex:Se,glyphStartIndex:Ie,numGlyphs:Ne,segment:Fe,writingMode:We,flipState:Be}=g,Re=Se+g.lineLength,Je=Ye=>{if(N){const[He,it,Ue]=Ye.up,ft=L.length;a.aH(N,ft+0,He,it,Ue),a.aH(N,ft+1,He,it,Ue),a.aH(N,ft+2,He,it,Ue),a.aH(N,ft+3,He,it,Ue)}const[je,vt,dt]=Ye.point;a.aI(L,je,vt,dt,Ye.angle)};if(Ne>1){const Ye=Nu(xe,C,ye,Me,d,U,$,g,k,w,q,ne,!1,ie,ae,ve);if(!Ye)return{notEnoughRoom:!0};if(_&&!d){let[je,vt,dt]=Ye.first.point,[He,it,Ue]=Ye.last.point;[je,vt]=co(je,vt,dt,S),[He,it]=co(He,it,Ue,S);const ft=Xl(We,Be,(He-je)*te,it-vt);if(g.flipState=ft&&ft.needsFlipping?Qn.flipRequired:Qn.flipNotRequired,ft)return ft}Je(Ye.first);for(let je=Ie+1;je<Ie+Ne-1;je++){const vt=Yl(xe*C.getoffsetX(je),ye,Me,d,U,$,Fe,Se,Re,k,w,q,ne,!1,!1,ie,ae,ve);if(!vt)return L.length-=4*(je-Ie),{notEnoughRoom:!0};Je(vt)}Je(Ye.last)}else{if(_&&!d){const je=co($.x,$.y,0,x),vt=Se+Fe+1,dt=new a.P(k.getx(vt),k.gety(vt)),He=co(dt.x,dt.y,0,x),it=He[3]>0?He:Kl($,dt,je,1,x,void 0,ie,ae.canonical),Ue=Xl(We,Be,(it[0]-je[0])*te,it[1]-je[1]);if(g.flipState=Ue&&Ue.needsFlipping?Qn.flipRequired:Qn.flipNotRequired,Ue)return Ue}const Ye=Yl(xe*C.getoffsetX(Ie),ye,Me,d,U,$,Fe,Se,Re,k,w,q,ne,!1,!1,ie,ae,ve);if(!Ye)return{notEnoughRoom:!0};Je(Ye)}return{}}function Zh(g,l,d,_,x){const{x:w,y:S,z:C}=_.projectTilePoint(g.x,g.y,l);if(!x)return co(w,S,C,d);const[k,L,N]=x(g);return co(w+k,S+L,C+N,d)}function Kl(g,l,d,_,x,w,S,C){const k=Zh(g.sub(l)._unit()._add(g),C,x,S,w);return a.$.sub(k,d,k),a.$.normalize(k,k),a.$.scaleAndAdd(k,d,k,_)}function Yl(g,l,d,_,x,w,S,C,k,L,N,U,$,q,te,ne,ie,ae){const ve=_?g-l:g+l;let xe=ve>0?1:-1,ye=0;_&&(xe*=-1,ye=Math.PI),xe<0&&(ye+=Math.PI);let Me=C+S+(xe>0?0:1)|0,Se=x,Ie=x,Ne=0,Fe=0;const We=Math.abs(ve),Be=[],Re=[];let Je=w,Ye=Je;const je=()=>Kl(Ye,Je,Ie,We-Ne+1,N,$,ne,ie.canonical);for(;Ne+Fe<=We;){if(Me+=xe,Me<C||Me>=k)return null;if(Ie=Se,Ye=Je,Be.push(Ie),q&&Re.push(Ye),Je=new a.P(L.getx(Me),L.gety(Me)),Se=U[Me],!Se){const $t=Zh(Je,ie.canonical,N,ne,$);Se=$t[3]>0?U[Me]=$t:je()}Ne+=Fe,Fe=a.$.distance(Ie,Se)}te&&$&&(U[Me]&&(Se=je(),Fe=a.$.distance(Ie,Se)),U[Me]=Se);const vt=(We-Ne)/Fe,dt=Je.sub(Ye)._mult(vt)._add(Ye),He=a.$.sub([],Se,Ie),it=a.$.scaleAndAdd([],Ie,He,vt);let Ue=[0,0,1],ft=He[0],gt=He[1];if(ae&&(Ue=ne.upVector(ie.canonical,dt.x,dt.y),Ue[0]!==0||Ue[1]!==0||Ue[2]!==1)){const $t=[Ue[2],0,-Ue[0]],tn=a.$.cross([],Ue,$t);a.$.normalize($t,$t),a.$.normalize(tn,tn),ft=a.$.dot(He,$t),gt=a.$.dot(He,tn)}if(d){const $t=a.$.cross([],Ue,He);a.$.normalize($t,$t),a.$.scaleAndAdd(it,it,$t,d*xe)}const Ut=ye+Math.atan2(gt,ft);return Be.push(it),q&&Re.push(dt),{point:it,angle:Ut,path:Be,tilePath:Re,up:Ue}}function va(g,l){const d=l.length,_=d+4*g;l.resize(_),l.float32.fill(-1/0,4*d,4*_)}function Rf(g,l,d){const _=l[0],x=l[1];return g[0]=d[0]*_+d[4]*x+d[12],g[1]=d[1]*_+d[5]*x+d[13],g[3]=d[3]*_+d[7]*x+d[15],g}const Fu=(g,l,d)=>(1-d)*g+d*l,Va=g=>g*g*g*g*g;class Bc{constructor(l,d,_,x,w,S,C){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=_??0,this._maxPitch=x??60,this.setProjection(S),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new a.aJ(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Nc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new oi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const l=new Bc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(l,d=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(l||_)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return a.ai(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=a.aK(this.projectionOptions);const _=this.getProjection(),x=!a.d(d,_);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(l){return this._orthographicProjectionAtLowPitch!==l&&(this._orthographicProjectionAtLowPitch=l,this._calcMatrices(),!0)}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.aK({name:"mercator"});const d=l!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.ay(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.av(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const d=-l*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=a.aD.create(),a.aD.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const d=a.au(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=a.ac(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const d=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(l){this._tileCoverLift!==l&&(this._tileCoverLift=l)}_updateCameraOnTerrain(){const l=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,d=this.elevation&&l===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||l===Number.NEGATIVE_INFINITY&&(!d||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const _=this._elevation;d||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&_.exaggeration()&&this._centerAltitudeValidForExaggeration!==_.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*_.exaggeration(),this._centerAltitudeValidForExaggeration=_.exaggeration()):(this._centerAltitude=l||0,this._centerAltitudeValidForExaggeration=_.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let x=0,w=0;for(let S=0;S<d.length;S++){const C=new a.P(d[S][0]*this.width,_+d[S][1]*(this.height-_)),k=l.pointCoordinate(C);if(!k)continue;const L=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);x+=k[3]*L,w+=L}return w===0?NaN:x/w}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const l=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*d,x=this._mercatorZfromZoom(l),w=this._mercatorZfromZoom(this._maxZoom),S=Math.max(x-_,w);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let _;_=l.z<this._camera.position[2]?[d.x,d.y,d.z]:[l.x,l.y,l.z];const x=a.$.length(a.$.sub([],this._camera.position,_));return a.au(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let d=!1;if(l.orientation&&!a.aw.exactEquals(l.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(l.orientation)),l.position){const _=[l.position.x,l.position.y,l.position.z];a.$.exactEquals(_,this._camera.position)||(this._setCameraPosition(_),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,d=new Hh;return d.position=new a._(l[0],l[1],l[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(l){if(!a.aw.length(l))return!1;a.aw.normalize(l,l);const d=a.$.transformQuat([],[0,0,-1],l),_=a.$.transformQuat([],[0,-1,0],l);if(_[2]<0)return!1;const x=Hl(d,_);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(l){const d=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;l[2]=a.au(l[2],x/_,x/d),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,d,_){this._unmodified=!1,this._edgeInsets.interpolate(l,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const d=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(l){const d=[new a.aL(0,l)];if(this.renderWorldCopies){const _=this.pointCoordinate(new a.P(0,0)),x=this.pointCoordinate(new a.P(this.width,0)),w=this.pointCoordinate(new a.P(this.width,this.height)),S=this.pointCoordinate(new a.P(0,this.height)),C=Math.floor(Math.min(_.x,x.x,w.x,S.x)),k=Math.floor(Math.max(_.x,x.x,w.x,S.x)),L=1;for(let N=C-L;N<=k+L;N++)N!==0&&d.push(new a.aL(N,l))}return d}isLODDisabled(l){return(!l||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(l,d,_){let x=[];const w=_!==void 0,S=!w;if(S&&this.zoom<d||w&&_[0]===0&&_[1]===0)return x;const C=new Set,k=(N,U,$,q,te)=>{const ne=a.b2(U,N,$,q,te);C.has(ne)||(x.push(new a.aQ(N,U,$,q,te)),C.add(ne))};for(let N=0;N<l.length;N++){const U=l[N];if(S&&U.canonical.z!==d)continue;const $=U.canonical,q=U.overscaledZ,te=U.wrap,ne=1<<$.z,ie=$.x+1<ne,ae=$.x>0,ve=$.y+1<ne,xe=$.y>0,ye=U.wrap-(ae?0:1),Me=U.wrap+(ie?0:1),Se=ae?$.x-1:ne-1,Ie=ie?$.x+1:0;if(w)_[0]<0?(k(q,Me,$.z,Ie,$.y),_[1]<0&&ve&&(k(q,te,$.z,$.x,$.y+1),k(q,Me,$.z,Ie,$.y+1)),_[1]>0&&xe&&(k(q,te,$.z,$.x,$.y-1),k(q,Me,$.z,Ie,$.y-1))):_[0]>0?(k(q,ye,$.z,Se,$.y),_[1]<0&&ve&&(k(q,te,$.z,$.x,$.y+1),k(q,ye,$.z,Se,$.y+1)),_[1]>0&&xe&&(k(q,te,$.z,$.x,$.y-1),k(q,ye,$.z,Se,$.y-1))):_[1]<0&&ve?k(q,te,$.z,$.x,$.y+1):xe&&k(q,te,$.z,$.x,$.y-1);else{const Ne=U.visibleQuadrants;1&Ne&&(k(q,ye,$.z,Se,$.y),xe&&(k(q,te,$.z,$.x,$.y-1),k(q,ye,$.z,Se,$.y-1))),2&Ne&&(k(q,Me,$.z,Ie,$.y),xe&&(k(q,te,$.z,$.x,$.y-1),k(q,Me,$.z,Ie,$.y-1))),4&Ne&&(k(q,ye,$.z,Se,$.y),ve&&(k(q,te,$.z,$.x,$.y+1),k(q,ye,$.z,Se,$.y+1))),8&Ne&&(k(q,Me,$.z,Ie,$.y),ve&&(k(q,te,$.z,$.x,$.y+1),k(q,Me,$.z,Ie,$.y+1)))}}const L=[];for(const N of x)x.some(U=>N.isChildOf(U))||L.push(N);if(x=L.filter(N=>!l.some(U=>!!(N.overscaledZ<d&&U.isChildOf(N))||N.equals(U)||N.isChildOf(U))),S){const N=1<<d,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$=[N*U.x,N*U.y],q=4,te=q*q;x=x.filter(ne=>{const ie=ne.canonical.x+.5-$[0],ae=ne.canonical.y+.5-$[1];return ie*ie+ae*ae<te})}return x}coveringTiles(l){let d=this.coveringZoomLevel(l);const _=d,x=this.elevation&&this.elevation.exaggeration(),w=x&&!l.isTerrainDEM,S=this.projection.name==="mercator";if(l.minzoom!==void 0&&d<l.minzoom)return[];l.maxzoom!==void 0&&d>l.maxzoom&&(d=l.maxzoom);const C=this.locationCoordinate(this.center),k=this.center.lat,L=1<<d,N=[L*C.x,L*C.y,0],U=this.projection.name==="globe",$=!U,q=a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,$),te=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ne=L*a.ay(1,this.center.lat),ie=this._camera.position[2]/a.ay(1,this.center.lat),ae=[L*te.x,L*te.y,ie*($?1:ne)],ve=U||x,xe=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),ye=this.isLODDisabled(!0)?d:0;let Me;if(this._elevation&&l.isTerrainDEM)Me=1e4*this._elevation.exaggeration();else if(this._elevation){const He=this._elevation.getMinMaxForVisibleTiles();Me=He?He.max:this._centerAltitude}else Me=this._centerAltitude;const Se=l.isTerrainDEM?-Me:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ie=this.projection.isReprojectedInTileSpace?a.aN(this):1,Ne=He=>{const Ue=new a._(He.x+25e-6,He.y,He.z),ft=new a._(He.x,He.y+25e-6,He.z),gt=He.toLngLat(),Ut=Ue.toLngLat(),$t=ft.toLngLat(),tn=this.locationCoordinate(gt),qt=this.locationCoordinate(Ut),bn=this.locationCoordinate($t),Fn=Math.hypot(qt.x-tn.x,qt.y-tn.y),Tn=Math.hypot(bn.x-tn.x,bn.y-tn.y);return Math.sqrt(Fn*Tn)*Ie/25e-6},Fe=He=>{const it=Me,Ue=Se;return{aabb:a.aR(this,L,0,0,0,He,Ue,it,this.projection),zoom:0,x:0,y:0,minZ:Ue,maxZ:it,wrap:He,fullyVisible:!1}},We=[];let Be=[];const Re=d,Je=l.reparseOverscaled?_:d,Ye=(ie-this._centerAltitude)*ne,je=He=>{if(!this._elevation||!He.tileID||!S)return;const it=this._elevation.getMinMaxForTile(He.tileID),Ue=He.aabb;it?(Ue.min[2]=it.min,Ue.max[2]=it.max,Ue.center[2]=(Ue.min[2]+Ue.max[2])/2):(He.shouldSplit=dt(He),He.shouldSplit||(Ue.min[2]=Ue.max[2]=Ue.center[2]=this._centerAltitude))},vt=(He,it)=>{if(.707*it<He)return 1;const Ue=it/He;return Ue/(1.4144271570014144+(Math.pow(1.1,Ue-1.4144271570014144+1)-1)/(1.1-1)-1)},dt=He=>{if(He.zoom<ye)return!0;if(He.zoom===Re)return!1;if(He.shouldSplit!=null)return He.shouldSplit;const it=He.aabb.distanceX(ae),Ue=He.aabb.distanceY(ae);let ft=Ye,gt=1;if(U){ft=He.aabb.distanceZ(ae);const Tn=Math.pow(2,He.zoom),jn=a.az((He.y+1)/Tn),or=a.az(He.y/Tn),Zr=Math.min(Math.max(k,jn),or),zr=a.b6(Zr)/a.b6(k);if(gt=Zr===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,zr/this._mercatorScaleRatio),this.zoom<=a.b3&&He.zoom===Re-1&&zr>=.9)return!0}else if(w&&(ft=He.aabb.distanceZ(ae)*ne),this.projection.isReprojectedInTileSpace&&_<=5){const Tn=Math.pow(2,He.zoom),jn=Ne(new a._((He.x+.5)/Tn,(He.y+.5)/Tn));gt=jn>.85?1:jn}if(!S){const Tn=Math.sqrt(it*it+Ue*Ue+ft*ft);let jn=(1<<Re-He.zoom)*xe*gt;return jn*=vt(Math.max(ft,Ye),Tn),Tn<jn}let Ut=Number.MAX_VALUE,$t=0;const tn=He.aabb.getCorners(),qt=[];for(const Tn of tn){a.$.sub(qt,Tn,ae),U||(w?qt[2]*=ne:qt[2]=Ye);const jn=a.$.dot(qt,this._camera.forward());jn<Ut&&(Ut=jn,$t=Math.abs(qt[2]))}let bn=(1<<Re-He.zoom)*xe*gt;if(bn*=vt(Math.max($t,Ye),Ut),Ut<bn)return!0;const Fn=He.aabb.closestPoint(N);return Fn[0]===N[0]&&Fn[1]===N[1]};if(this.renderWorldCopies)for(let He=1;He<=3;He++)We.push(Fe(-He)),We.push(Fe(He));for(We.push(Fe(0));We.length>0;){const He=We.pop(),it=He.x,Ue=He.y;let ft=He.fullyVisible;const gt=()=>this.projection.name==="globe"&&(He.y===0||He.y===(1<<He.zoom)-1);if(!ft){let Ut=ve?He.aabb.intersects(q):He.aabb.intersectsFlat(q);if(Ut===0&&gt()){const $t=new a.aO(He.zoom,it,Ue);Ut=a.aP(this,L,$t,!0).intersects(q)}if(Ut===0)continue;ft=Ut===2}if(He.zoom!==Re&&dt(He))for(let Ut=0;Ut<4;Ut++){const $t=(it<<1)+Ut%2,tn=(Ue<<1)+(Ut>>1),qt={aabb:S?He.aabb.quadrant(Ut):a.aR(this,L,He.zoom+1,$t,tn,He.wrap,He.minZ,He.maxZ,this.projection),zoom:He.zoom+1,x:$t,y:tn,wrap:He.wrap,fullyVisible:ft,tileID:void 0,shouldSplit:void 0,minZ:He.minZ,maxZ:He.maxZ};w&&!U&&(qt.tileID=new a.aQ(He.zoom+1===Re?Je:He.zoom+1,He.wrap,He.zoom+1,$t,tn),je(qt)),We.push(qt)}else{const Ut=He.zoom===Re?Je:He.zoom;if(l.minzoom&&l.minzoom>Ut)continue;let $t=0;if(!ft){let Fn=ve?He.aabb.intersectsPrecise(q):He.aabb.intersectsPreciseFlat(q);if(Fn===0&&gt()){const Tn=new a.aO(He.zoom,it,Ue);Fn=a.aP(this,L,Tn,!0).intersectsPrecise(q)}if(Fn===0)continue;if(l.calculateQuadrantVisibility)if(q.containsPoint(He.aabb.center))$t=15;else for(let Tn=0;Tn<4;Tn++)He.aabb.quadrant(Tn).intersects(q)!==0&&($t|=1<<Tn)}const tn=N[0]-(.5+it+(He.wrap<<He.zoom))*(1<<d-He.zoom),qt=N[1]-.5-Ue,bn=He.tileID?He.tileID:new a.aQ(Ut,He.wrap,He.zoom,it,Ue);l.calculateQuadrantVisibility&&(bn.visibleQuadrants=$t),Be.push({tileID:bn,distanceSq:tn*tn+qt*qt})}}if(this.fogCullDistSq){const He=this.fogCullDistSq,it=this.horizonLineFromTop();Be=Be.filter(Ue=>{const ft=[0,0,0,1],gt=[a.a4,a.a4,0,1],Ut=this.calculateFogTileMatrix(Ue.tileID.toUnwrapped());a.aB.transformMat4(ft,ft,Ut),a.aB.transformMat4(gt,gt,Ut);const $t=a.aB.min([],ft,gt),tn=a.aB.max([],ft,gt),qt=a.aS($t,tn);if(qt===0)return!0;let bn=!1;const Fn=this._elevation;if(Fn&&qt>He&&it!==0){const Tn=this.calculateProjMatrix(Ue.tileID.toUnwrapped());let jn;l.isTerrainDEM||(jn=Fn.getMinMaxForTile(Ue.tileID)),jn||(jn={min:Se,max:Me});const or=a.b4(this.rotation),Zr=[or[0]*a.a4,or[1]*a.a4,jn.max];a.$.transformMat4(Zr,Zr,Tn),bn=(1-Zr[1])*this.height*.5<it}return qt<He||bn})}return Be.sort((He,it)=>He.distanceSq-it.distanceSq).map(He=>He.tileID)}resize(l,d){this.width=l,this.height=d,this.pixelsToGLUnits=[2/l,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const d=a.au(l.lat,-a.aT,a.aT),_=this.projection.project(l.lng,d);return new a.P(_.x*this.worldSize,_.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.ay(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,d){let _,x;const w=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;_=(d.x-w.x)/C,x=(d.y-w.y)/C}else{const C=this.pointCoordinate(d),k=this.pointCoordinate(w);_=C.x-k.x,x=C.y-k.y}const S=this.locationCoordinate(l);this.setLocation(new a._(S.x-_,S.y-x))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,d){const _=d?a.ay(d,l.lat):void 0,x=this.projection.project(l.lng,l.lat);return new a._(x.x,x.y,_)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,d){const _=d??this._centerAltitude,x=[l.x,l.y,0,1],w=[l.x,l.y,1,1];a.aB.transformMat4(x,x,this.pixelMatrixInverse),a.aB.transformMat4(w,w,this.pixelMatrixInverse);const S=w[3];a.aB.scale(x,x,1/x[3]),a.aB.scale(w,w,1/S);const C=x[2],k=w[2];return{p0:x,p1:w,t:C===k?0:(_-C)/(k-C)}}screenPointToMercatorRay(l){const d=[l.x,l.y,0,1],_=[l.x,l.y,1,1];return a.aB.transformMat4(d,d,this.pixelMatrixInverse),a.aB.transformMat4(_,_,this.pixelMatrixInverse),a.aB.scale(d,d,1/d[3]),a.aB.scale(_,_,1/_[3]),d[2]=a.ay(d[2],this._center.lat)*this.worldSize,_[2]=a.ay(_[2],this._center.lat)*this.worldSize,a.aB.scale(d,d,1/this.worldSize),a.aB.scale(_,_,1/this.worldSize),new a.aU([d[0],d[1],d[2]],a.$.normalize([],a.$.sub([],_,d)))}rayIntersectionCoordinate(l){const{p0:d,p1:_,t:x}=l,w=a.ay(d[2],this._center.lat),S=a.ay(_[2],this._center.lat);return new a._(a.a3(d[0],_[0],x)/this.worldSize,a.a3(d[1],_[1],x)/this.worldSize,a.a3(w,S,x))}pointCoordinate(l,d=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,d)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let d=this.projection.pointCoordinate3D(this,l.x,l.y);if(d)return new a._(d[0],d[1],d[2]);let _=0,x=this.horizonLineFromTop();if(l.y>x)return this.pointCoordinate(l);const w=.02*x,S=l.clone();for(let C=0;C<10&&x-_>w;C++){S.y=a.a3(_,x,.66);const k=this.projection.pointCoordinate3D(this,S.x,S.y);k?(x=S.y,d=k):_=S.y}return d?new a._(d[0],d[1],d[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=a.aV)return!this.isPointAboveHorizon(l);const d=this.pointCoordinate(l);return d.y>=0&&d.y<=1}_coordinatePoint(l,d){const _=d&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,x=[l.x*this.worldSize,l.y*this.worldSize,_+l.toAltitude(),1];return a.aB.transformMat4(x,x,this.pixelMatrix),x[3]>0?new a.P(x[0]/x[3],x[1]/x[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:d}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=this.pointLocation3D(new a.P(d,l)),S=this.pointLocation3D(new a.P(x,l)),C=this.pointLocation3D(new a.P(x,_)),k=this.pointLocation3D(new a.P(d,_));let L=Math.min(w.lng,S.lng,C.lng,k.lng),N=Math.max(w.lng,S.lng,C.lng,k.lng),U=Math.min(w.lat,S.lat,C.lat,k.lat),$=Math.max(w.lat,S.lat,C.lat,k.lat);const q=Math.pow(2,-this.zoom)/16*270,te=this.projection.name==="globe"?1:4,ne=(ie,ae,ve,xe,ye)=>{const Me=(ie+ve)/2,Se=(ae+xe)/2,Ie=new a.P(Me,Se),{lng:Ne,lat:Fe}=this.pointLocation3D(Ie),We=Math.max(0,L-Ne,U-Fe,Ne-N,Fe-$);L=Math.min(L,Ne),N=Math.max(N,Ne),U=Math.min(U,Fe),$=Math.max($,Fe),(ye<te||We>q)&&(ne(ie,ae,Me,Se,ye+1),ne(Me,Se,ve,xe,ye+1))};if(ne(d,l,x,l,1),ne(x,l,x,_,1),ne(x,_,d,_,1),ne(d,_,d,l,1),this.projection.name==="globe"){const[ie,ae]=a.aW(this);ie?($=90,N=180,L=-180):ae&&(U=-90,N=180,L=-180)}return new a.aj(new a.aJ(L,U),new a.aJ(N,$))}_getBoundsRectangular(l,d){const{top:_,left:x}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,C=new a.P(x,_),k=new a.P(S,_),L=new a.P(S,w),N=new a.P(x,w);let U=this.pointCoordinate(C,l),$=this.pointCoordinate(k,l);const q=this.pointCoordinate(L,d),te=this.pointCoordinate(N,d),ne=(ie,ae)=>(ae.y-ie.y)/(ae.x-ie.x);return U.y>1&&$.y>=0?U=new a._((1-te.y)/ne(te,U)+te.x,1):U.y<0&&$.y<=1&&(U=new a._(-te.y/ne(te,U)+te.x,0)),$.y>1&&U.y>=0?$=new a._((1-q.y)/ne(q,$)+q.x,1):$.y<0&&U.y<=1&&($=new a._(-q.y/ne(q,$)+q.x,0)),new a.aj().extend(this.coordinateLocation(U)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(te)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=l.visibleDemTiles.reduce((_,x)=>{if(x.dem){const w=x.dem.tree;_.min=Math.min(_.min,w.minimums[0]),_.max=Math.max(_.max,w.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*l.exaggeration(),d.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,_=this.height/2-d*(1-this._horizonShift);return l?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-a.aT,this.maxLat=a.aT,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.ak(this.minLng)*this.tileSize,this.worldMaxX=a.ak(this.maxLng)*this.tileSize,this.worldMinY=a.al(this.maxLat)*this.tileSize,this.worldMaxY=a.al(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,d){return this.projection.createTileMatrix(this,d,l)}calculateDistanceTileData(l){const d=l.key,_=this._distanceTileDataCache;if(_[d])return _[d];const x=l.canonical,w=1/this.height,S=this.cameraWorldSize,C=S/this.zoomScale(x.z),k=(x.x+Math.pow(2,x.z)*l.wrap)*C,L=x.y*C,N=this.point;N.x*=S/this.worldSize,N.y*=S/this.worldSize;const U=this.angle,$=Math.sin(-U),q=-Math.cos(-U);return _[d]={bearing:[$,q],center:[(N.x-k)*w,(N.y-L)*w],scale:C/a.a4*w},_[d]}calculateFogTileMatrix(l){const d=l.key,_=this._fogTileMatrixCache;if(_[d])return _[d];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return a.ae.multiply(x,this.worldToFogMatrix,x),_[d]=new Float32Array(x),_[d]}calculateProjMatrix(l,d=!1,_=!1){const x=l.key;let w;if(w=_?this._expandedProjMatrixCache:d?this._alignedProjMatrixCache:this._projMatrixCache,w[x])return w[x];const S=this.calculatePosMatrix(l,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:_?this.expandedFarZProjMatrix:d?this.alignedProjMatrix:this.projMatrix,a.ae.multiply(S,C,S),w[x]=new Float32Array(S),w[x]}calculatePixelsToTileUnitsMatrix(l){const d=l.tileID.key,_=this._pixelsToTileUnitsCache;if(_[d])return _[d];const x=a.aX(l,this);return _[d]=x,_[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const l=1/this.worldSize,d=a.ae.fromScaling([],[l,l,l]);return a.ae.multiply(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const l=this._elevation;this._updateCameraState();const d=a.ay(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),x=this._camera.forward(),w=a.ay(1,this._center.lat);_[2]/=w,x[2]/=w,a.$.normalize(x,x);const S=l.raycast(_,x,l.exaggeration());if(S){const C=a.$.scaleAndAdd([],_,x,S),k=new a._(C[0],C[1],a.ay(C[2],a.az(C[1]))),L=(k.z+a.$.length([k.x-_[0],k.y-_[1],k.z-_[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const d=this._elevation,_=a.ay(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(_),w=d.getAtPointOrZero(new a._(...x)),S=this.pixelsPerMeter/this.worldSize*w,C=this._minimumHeightOverTerrain(),k=x[2]-S;if(k<=C)if(k<0||l){const L=this.locationCoordinate(this._center,this._centerAltitude),N=[x[0],x[1],L.z-x[2]],U=a.$.length(N);N[2]-=(C-k)/this._pixelsPerMercatorPixel;const $=a.$.length(N);if($===0)return;a.$.scale(N,N,U/$*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],L.z*this._pixelsPerMercatorPixel-N[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const $=this.center;return $.lat=a.au($.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&($.lng=a.au($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const d=this._unmodified,{x:_,y:x}=this.point;let w=0,S=_,C=x;const k=this.width/2,L=this.height/2,N=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(x-L<N&&(C=N+L),x+L>U&&(C=U-L),U-N<this.height&&(w=Math.max(w,this.height/(U-N)),C=(U+N)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,te=this.worldSize/2-($+q)/2;S=(_+te+this.worldSize)%this.worldSize-te,S-k<$&&(S=$+k),S+k>q&&(S=q-k),q-$<this.width&&(w=Math.max(w,this.width/(q-$)),S=(q+$)/2)}S===_&&C===x||(this.center=this.unproject(new a.P(S,C))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,d=this.projection.name==="globe",_=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.ay(1,this.center.lat)/a.ay(1,a.b5));const x=a.aY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?_:1,S=this._camera.getWorldToCamera(this.worldSize,w);let C;const k=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(k[8]=2*-l.x/this.width,k[9]=2*l.y/this.height,this.isOrthographic){let Fe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),We=Fe*this.aspect,Be=-We,Re=-Fe;We-=l.x,Be-=l.x,Fe+=l.y,Re+=l.y,C=this._camera.getCameraToClipOrthographic(Be,We,Re,Fe,this._nearZ,this._farZ),((Je,Ye,je,vt)=>{for(let dt=0;dt<16;dt++)Je[dt]=Fu(Ye[dt],je[dt],vt)})(C,C,k,Va(this.pitch>=15?1:this.pitch/15))}else C=k;const L=a.ae.mul([],k,S);let N=a.ae.mul([],C,S);if(this.projection.isReprojectedInTileSpace){const Fe=this.locationCoordinate(this.center),We=a.ae.identity([]);a.ae.translate(We,We,[Fe.x*this.worldSize,Fe.y*this.worldSize,0]),a.ae.multiply(We,We,a.aZ(this)),a.ae.translate(We,We,[-Fe.x*this.worldSize,-Fe.y*this.worldSize,0]),a.ae.multiply(N,N,We),a.ae.multiply(L,L,We),this.inverseAdjustmentMatrix=a.a_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.ae.scale([],N,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=N,this.invProjMatrix=a.ae.invert(new Float64Array(16),this.projMatrix),d){const Fe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Fe[8]=2*-l.x/this.width,Fe[9]=2*l.y/this.height,this.expandedFarZProjMatrix=a.ae.mul([],Fe,S)}else this.expandedFarZProjMatrix=this.projMatrix;const U=a.ae.invert([],C);this.frustumCorners=a.a$.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!d);const $=new Float32Array(16);a.ae.identity($),a.ae.scale($,$,[1,-1,1]),a.ae.rotateX($,$,this._pitch),a.ae.rotateZ($,$,this.angle);const q=a.ae.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.ae.clone(q);const te=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-l.x/this.width,q[9]=2*(l.y+te)/this.height,this.skyboxMatrix=a.ae.multiply($,q,$);const ne=this.point,ie=ne.x,ae=ne.y,ve=this.width%2/2,xe=this.height%2/2,ye=Math.cos(this.angle),Me=Math.sin(this.angle),Se=ie-Math.round(ie)+ye*ve+Me*xe,Ie=ae-Math.round(ae)+ye*xe+Me*ve,Ne=new Float64Array(N);if(a.ae.translate(Ne,Ne,[Se>.5?Se-1:Se,Ie>.5?Ie-1:Ie,0]),this.alignedProjMatrix=Ne,N=a.ae.create(),a.ae.scale(N,N,[this.width/2,-this.height/2,1]),a.ae.translate(N,N,[1,-1,0]),this.labelPlaneMatrix=N,N=a.ae.create(),a.ae.scale(N,N,[1,-1,1]),a.ae.translate(N,N,[-1,-1,0]),a.ae.scale(N,N,[2/this.width,2/this.height,1]),this.glCoordMatrix=N,this.pixelMatrix=a.ae.multiply(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},N=a.ae.invert(new Float64Array(16),this.pixelMatrix),!N)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=N,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.b0(this);const Fe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.$.transformMat4(Fe,Fe,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=N;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,_=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,w=[l,l,d];a.$.scale(w,w,x),a.$.scale(_,_,-1),a.$.multiply(_,_,w);const S=a.ae.create();a.ae.translate(S,S,_),a.ae.scale(S,S,w),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,d,x)}_computeCameraPosition(l){const d=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),x=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-l/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-_[0]*w,x.y/this.worldSize-_[1]*w,l/this.worldSize*this._centerAltitude-_[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],x=l[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(w=Math.min((d-_)/x,1)),this._camera.position=a.$.scaleAndAdd([],this._camera.position,l,w),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,d=this._camera.forward(),{pitch:_,bearing:x}=this._camera.getPitchBearing(),w=a.ay(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.ac(this._maxPitch)),C=Math.max((l[2]-w)/Math.cos(_),S),k=this._zoomFromMercatorZ(C);a.$.scaleAndAdd(l,l,d,C),this._pitch=a.au(_,a.ac(this.minPitch),a.ac(this.maxPitch)),this.angle=a.av(x,-Math.PI,Math.PI),this._setZoom(a.au(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a._(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let d=0,_=a.aV,x=0,w=1/0;for(;_-d>1e-6&&_>d;){const S=d+.5*(_-d),C=this.tileSize*Math.pow(2,S),k=this.getCameraToCenterDistance(this.projection,S,C),L=this.scaleZoom(k/(l*this.tileSize)),N=Math.abs(S-L);N<w&&(w=N,x=S),S<L?d=S:_=S}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,d){const _=Math.min(l.x,d.x),x=Math.max(l.x,d.x),w=Math.min(l.y,d.y),S=Math.max(l.y,d.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new a.P(_,w),new a.P(x,S),new a.P(_,S),new a.P(x,w)],k=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const N of C){const U=this.pointRayIntersection(N);if(U.t<0)return!0;const $=this.rayIntersectionCoordinate(U);if($.x<k||$.y<0||$.x>L||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.b1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(l,d){const _=a.$.length(a.$.sub([],this._camera.position,l)),x=this._zoomFromMercatorZ(_)+d;return _-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const l=function([d,_,x],w){const S=[d,_,x,1];a.aB.transformMat4(S,S,w);const C=S[3]=Math.max(S[3],1e-6);return S[0]/=C,S[1]/=C,S[2]/=C,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,l))}}getCameraToCenterDistance(l,d=this.zoom,_=this.worldSize){const x=a.aY(l,d,this.width,this.height,1024),w=l.pixelSpaceConversion(this.center.lat,_,x);let S=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(S=Fu(1,S,Va(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.ae.multiply(l,l,this.globeMatrix),l}getFrustum(l){return a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,this.projection.zAxisUnit==="meters")}}const Ts={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},Rs=(g,l)=>{if(l>0&&g.terrain&&a.w("Cutoff is currently disabled on terrain"),l<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const d=g.transform,_=Math.max(Math.abs(d._zoom-(g.minCutoffZoom-1)),1),x=d.isLODDisabled(!1)?a.a0(60,45,d.pitch):a.a0(30,15,d.pitch),w=d._farZ-d._nearZ,S=l*d.height,C=((1-(k=x))*d.cameraToCenterDistance+k*(d._farZ+S))*_;var k;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[d._nearZ,d._farZ,(C-d._nearZ)/w,(C-S-d._nearZ)/w]}}},cs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class _i{constructor(l,d){this.aabb=l,this.lastCascade=d}}class Jo{add(l,d){const _=this.receivers[l.key];_!==void 0?(_.aabb.min[0]=Math.min(_.aabb.min[0],d.min[0]),_.aabb.min[1]=Math.min(_.aabb.min[1],d.min[1]),_.aabb.min[2]=Math.min(_.aabb.min[2],d.min[2]),_.aabb.max[0]=Math.max(_.aabb.max[0],d.max[0]),_.aabb.max[1]=Math.max(_.aabb.max[1],d.max[1]),_.aabb.max[2]=Math.max(_.aabb.max[2],d.max[2])):this.receivers[l.key]=new _i(d,null)}clear(){this.receivers={}}get(l){return this.receivers[l.key]}computeRequiredCascades(l,d,_){const x=a.b8.fromPoints(l.points);let w=0;for(const S in this.receivers){const C=this.receivers[S];if(!C||!x.intersectsAabb(C.aabb))continue;C.aabb.min=x.closestPoint(C.aabb.min),C.aabb.max=x.closestPoint(C.aabb.max);const k=C.aabb.getCorners();for(let L=0;L<_.length;L++){let N=!0;for(const U of k){const $=[U[0]*d,U[1]*d,U[2]];if(a.$.transformMat4($,$,_[L].matrix),$[0]<-1||$[0]>1||$[1]<-1||$[1]>1){N=!1;break}}if(C.lastCascade=L,w=Math.max(w,L),N)break}}return w+1}}class Sm{constructor(l){this.painter=l,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Jo,this._depthMode=new a.af(l.context.gl.LEQUAL,a.af.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,l.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),l.tp.registerParameter(cs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),l.tp.registerParameter(cs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),l.tp.registerParameter(cs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),l.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const l of this._cascades)l.texture.destroy(),l.framebuffer.destroy();this._cascades=[]}updateShadowParameters(l,d){const _=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!d||!d.properties)return;const x=d.properties.get("shadow-intensity");if(!d.shadowsEnabled()||x<=0||(this._shadowLayerCount=_.style.order.reduce((te,ne)=>{const ie=_.style._mergedLayers[ne];return te+(ie.hasShadowPass()&&!ie.isHidden(l.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=_.context,S=cs.shadowMapResolution,C=cs.shadowMapResolution;if(this._cascades.length===0||cs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let te=0;te<cs.cascadeCount;++te){const ne=_._shadowMapDebug,ie=w.gl,ae=w.createFramebuffer(S,C,ne,"texture"),ve=new a.T(w,{width:S,height:C,data:null},ie.DEPTH_COMPONENT);if(ae.depthAttachment.set(ve.texture),ne){const xe=new a.T(w,{width:S,height:C,data:null},ie.RGBA);ae.colorAttachment.set(xe.texture)}this._cascades.push({framebuffer:ae,texture:ve,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.aM,scale:0})}}this.shadowDirection=Do(d);let k=0;if(l.elevation){const te=l.elevation,ne=[1e4,-1e4];te.visibleDemTiles.filter(ie=>ie.dem).forEach(ie=>{const ae=ie.dem.tree;ne[0]=Math.min(ne[0],ae.minimums[0]),ne[1]=Math.max(ne[1],ae.maximums[0])}),ne[0]!==1e4&&(k=(ne[1]-ne[0])*te.exaggeration())}const L=1.5*l.cameraToCenterDistance,N=3*L,U=new Float64Array(16);for(let te=0;te<this._cascades.length;++te){const ne=this._cascades[te];let ie=l.height/50,ae=1;cs.cascadeCount===1?ae=N:te===0?ae=L:(ie=L,ae=N);const[ve,xe]=Xh(l,this.shadowDirection,ie,ae,cs.shadowMapResolution,k);ne.scale=l.scale,ne.matrix=ve,ne.boundingSphereRadius=xe,a.ae.invert(U,ne.matrix),ne.frustum=a.aM.fromInvProjectionMatrix(U,1,0,!0),ne.far=ae}const $=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[$].far,this._cascades[$].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/cs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=cs.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ts.ShadowMap0,this._uniformValues.u_shadowmap_1=Ts.ShadowMap0+1,this._groundShadowTiles=_.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const q=_.transform.elevation;for(const te of this._groundShadowTiles){let ne={min:0,max:0};if(q){const ie=q.getMinMaxForTile(te);ie&&(ne=ie)}this.addShadowReceiver(te.toUnwrapped(),ne.min,ne.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(l){this._enabled=l}drawShadowPass(l,d){if(!this.enabled)return;const _=this.painter,x=_.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(_.transform.getFrustum(0),_.transform.worldSize,this._cascades),x.viewport.set([0,0,cs.shadowMapResolution,cs.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){_.currentShadowCascade=w,x.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),x.clear({color:a.C.white,depth:1});for(const S of l.order){const C=l._mergedLayers[S];if(!C.hasShadowPass()||C.isHidden(_.transform.zoom))continue;const k=l.getLayerSourceCache(C),L=k?d[k.id]:void 0;(C.type==="model"||L&&L.length)&&_.renderLayer(_,k,C,L)}}_.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const l=this.painter,d=l.style,_=l.context,x=d.directionalLight,w=d.ambientLight;if(!x||!w)return;const S=[],C=Rs(l,l.longestCutoffRange);C.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const k=Uc(d,x,w),L=new a.af(_.gl.LEQUAL,a.af.ReadOnly,l.depthRangeFor3D);for(const N of this._groundShadowTiles){const U=N.toUnwrapped(),$=l.isTileAffectedByFog(N),q=l.getOrCreateProgram("groundShadow",{defines:S,overrideFog:$});this.setupShadows(U,q),l.uploadCommonUniforms(_,q,U,null,C);const te={u_matrix:l.transform.calculateProjMatrix(U),u_ground_shadow_factor:k};q.draw(l,_.gl.TRIANGLES,L,a.ah.disabled,a.a.multiply,a.ag.disabled,te,"ground_shadow",l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments,{},l.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?a.a.unblended:a.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(l){const d=this.painter.transform,_=d.calculatePosMatrix(l,d.worldSize);return a.ae.multiply(_,this._cascades[this.painter.currentShadowCascade].matrix,_),Float32Array.from(_)}calculateShadowPassMatrixFromMatrix(l){return a.ae.multiply(l,this._cascades[this.painter.currentShadowCascade].matrix,l),Float32Array.from(l)}setupShadows(l,d,_,x=0){if(!this.enabled)return;const w=this.painter.transform,S=this.painter.context,C=S.gl,k=this._uniformValues,L=new Float64Array(16),N=w.calculatePosMatrix(l,w.worldSize);for(let U=0;U<this._cascades.length;U++)a.ae.multiply(L,this._cascades[U].matrix,N),k[U===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),S.activeTexture.set(C.TEXTURE0+Ts.ShadowMap0+U),this._cascades[U].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=!!_,this.useNormalOffset){const U=a.b7(l.canonical),$=2/w.tileSize*a.a4/cs.shadowMapResolution,q=$*this._cascades[0].boundingSphereRadius,te=$*this._cascades[this._cascades.length-1].boundingSphereRadius,ne=(_==="vector-tile"?1:3)/Math.pow(2,x-l.canonical.z-(1-w.zoom+Math.floor(w.zoom)));k.u_shadow_normal_offset=[U,q*ne,te*ne],k.u_shadow_bias=[6e-5,.0012,.012]}else k.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(S,k)}setupShadowsFromMatrix(l,d,_=!1){if(!this.enabled)return;const x=this.painter.context,w=x.gl,S=this._uniformValues,C=new Float64Array(16);for(let k=0;k<cs.cascadeCount;k++)a.ae.multiply(C,this._cascades[k].matrix,l),S[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),x.activeTexture.set(w.TEXTURE0+Ts.ShadowMap0+k),this._cascades[k].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);if(this.useNormalOffset=_,_){const k=cs.normalOffset;S.u_shadow_normal_offset=[1,k,k],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(x,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(l,d,_,x){if(x[2]>=0)return{};const w=function(k,L,N){const U=N/(1<<k.canonical.z);return new a.b8([k.canonical.x*U+k.wrap*N,k.canonical.y*U+k.wrap*N,0],[(k.canonical.x+1)*U+k.wrap*N,(k.canonical.y+1)*U+k.wrap*N,L])}(l,d,_).getCorners(),S=d/-x[2];x[0]<0?(a.$.add(w[0],w[0],[x[0]*S,0,0]),a.$.add(w[3],w[3],[x[0]*S,0,0])):x[0]>0&&(a.$.add(w[1],w[1],[x[0]*S,0,0]),a.$.add(w[2],w[2],[x[0]*S,0,0])),x[1]<0?(a.$.add(w[0],w[0],[0,x[1]*S,0]),a.$.add(w[1],w[1],[0,x[1]*S,0])):x[1]>0&&(a.$.add(w[2],w[2],[0,x[1]*S,0]),a.$.add(w[3],w[3],[0,x[1]*S,0]));const C={};return C.vertices=w,C.planes=[Ql(w[1],w[0],w[4]),Ql(w[2],w[1],w[5]),Ql(w[3],w[2],w[6]),Ql(w[0],w[3],w[7])],C}addShadowReceiver(l,d,_){this._receivers.add(l,a.b8.fromTileIdAndHeight(l,d,_))}getMaxCascadeForTile(l){const d=this._receivers.get(l);return d&&d.lastCascade?d.lastCascade:0}}function Ql(g,l,d){const _=a.$.sub([],d,l),x=a.$.sub([],g,l),w=a.$.cross([],_,x),S=a.$.length(w);return S===0?[0,0,1,0]:(a.$.scale(w,w,1/S),[w[0],w[1],w[2],-a.$.dot(w,l)])}function Do(g){const l=g.properties.get("direction"),d=a.ad(l.x,l.y,l.z);d[2]=a.au(d[2],0,75);const _=a.b9([d[0],d[1],d[2]]);return a.$.fromValues(_.x,_.y,_.z)}function Uc(g,l,d){const _=l.properties.get("color"),x=l.properties.get("intensity"),w=l.properties.get("direction"),S=[w.x,w.y,w.z],C=d.properties.get("color"),k=d.properties.get("intensity"),L=Math.max(a.$.dot([0,0,1],S),0),N=[0,0,0];a.$.scale(N,C.toRenderColor(g.getLut(l.scope)).toArray01Linear().slice(0,3),k);const U=[0,0,0];return a.$.scale(U,_.toRenderColor(g.getLut(d.scope)).toArray01Linear().slice(0,3),L*x),a.ba([N[0]>0?N[0]/(N[0]+U[0]):0,N[1]>0?N[1]/(N[1]+U[1]):0,N[2]>0?N[2]/(N[2]+U[2]):0])}function Xh(g,l,d,_,x,w){const S=g.zoom,C=g.scale,k=g.worldSize,L=1/k,N=g.aspect,U=Math.sqrt(1+N*N)*Math.tan(.5*g.fovX),$=U*U,q=_-d,te=_+d;let ne,ie;$>q/te?(ne=_,ie=_*U):(ne=.5*te*(1+$),ie=.5*Math.sqrt(q*q+2*(_*_+d*d)*$+te*te*$*$));const ae=g.projection.pixelsPerMeter(g.center.lat,k),ve=g._camera.getCameraToWorldMercator(),xe=[0,0,-ne*L];a.$.transformMat4(xe,xe,ve);let ye=ie*L;const Me=g._edgeInsets;if(!(Me.left===0&&Me.top===0&&Me.right===0&&Me.bottom===0||Me.left===Me.right&&Me.top===Me.bottom)){const ft=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?ae:1),gt=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,d,_);gt[8]=2*-g.centerOffset.x/g.width,gt[9]=2*g.centerOffset.y/g.height;const Ut=new Float64Array(16);a.ae.mul(Ut,gt,ft);const $t=new Float64Array(16);a.ae.invert($t,Ut);const tn=a.aM.fromInvProjectionMatrix($t,k,S,!0);for(const qt of tn.points){const bn=((Se=qt)[0]/=C,Se[1]/=C,Se[2]=a.ay(Se[2],g._center.lat),Se);ye=Math.max(ye,a.$.len(a.$.subtract([],xe,bn)))}}var Se;ye*=x/(x-1);const Ie=Math.acos(l[2]),Ne=Math.atan2(-l[0],-l[1]),Fe=new oi;Fe.position=xe,Fe.setPitchBearing(Ie,Ne);const We=Fe.getWorldToCamera(k,ae),Be=ye*k,Re=Math.min(g._mercatorZfromZoom(17)*k*-2,-2*Be),Je=Fe.getCameraToClipOrthographic(-Be,Be,-Be,Be,Re,(Be+w*ae)/l[2]),Ye=new Float64Array(16);a.ae.multiply(Ye,Je,We);const je=a.$.fromValues(Math.floor(1e6*xe[0])/1e6*k,Math.floor(1e6*xe[1])/1e6*k,0),vt=.5*x,dt=[0,0,0];a.$.transformMat4(dt,je,Ye),a.$.scale(dt,dt,vt);const He=[Math.floor(dt[0]),Math.floor(dt[1]),Math.floor(dt[2])],it=[0,0,0];a.$.sub(it,dt,He),a.$.scale(it,it,-1/vt);const Ue=new Float64Array(16);return a.ae.identity(Ue),a.ae.translate(Ue,Ue,it),a.ae.multiply(Ye,Ue,Ye),[Ye,Be]}function Vc(g,l){return g!=null&&l!=null&&!(!g.hasData()||!l.hasData())&&g.demTexture!=null&&l.demTexture!=null&&g.tileID.key!==l.tileID.key}const ja=new class{constructor(){this.operations={}}newMorphing(g,l,d,_,x){if(g in this.operations){const w=this.operations[g];w.to.tileID.key!==d.tileID.key&&(w.queued=d)}else this.operations[g]={startTime:_,phase:0,duration:x,from:l,to:d,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const l=this.operations[g];return{from:l.from,to:l.to,phase:l.phase}}update(g){for(const l in this.operations){const d=this.operations[l];for(d.phase=(g-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,g)){delete this.operations[l];break}}}_nextOp(g,l){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=l,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},ml={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ji(g,l,d){if(l===0)return 0;const _=l<1&&d===514?.25/l:1;return 6*Math.pow(1.5,22-g)*Math.max(l,1)*_}function jc(g,l){const d=1<<g.z;return!l&&(g.x===0||g.x===d-1)||g.y===0||g.y===d-1}const $c=g=>({u_matrix:g});function $a(g,l,d,_,x){if(x>0){const w=a.e.now(),S=(w-g.timeAdded)/x,C=l?(w-l.timeAdded)/x:-1,k=d.getSource(),L=_.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),N=!l||Math.abs(l.tileID.overscaledZ-L)>Math.abs(g.tileID.overscaledZ-L),U=N&&g.refreshedUponExpiration?1:a.au(N?S:1-C,0,1);return g.refreshedUponExpiration&&S>=1&&(g.refreshedUponExpiration=!1),l?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class R extends xo{constructor(l,d,_,x){super(l,d,_,x),this.type="raster-array",this.maxzoom=22,this._options=a.Q({type:"raster-array"},d)}triggerRepaint(l){const d=this.map.painter._terrain,_=this.map.style.getSourceCache(this.id);d&&d.enabled&&_&&d._clearRenderCacheForTile(_.id,l.tileID),this.map.triggerRepaint()}loadTile(l,d){const _=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(_,a.R.Tile);l.requestParams=x,l.actor||(l.actor=this.dispatcher.getActor()),l.request=l.fetchHeader(void 0,(w,S,C,k)=>{if(delete l.request,l.aborted)return l.state="unloaded",d(null);if(w)return w.code===20?void 0:(l.state="errored",d(w));this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:C,expires:k}),l.state="empty",d(null)})}unloadTile(l,d){const _=l.texture;_&&_ instanceof a.T?(l.destroy(!0),this.map.painter.saveTileTexture(_)):(l.destroy(),l.flushQueues(),l._isHeaderLoaded=!1,delete l._mrt,delete l.textureDescriptor),l.fbo&&(l.fbo.destroy(),delete l.fbo),delete l.request,delete l.requestParams,delete l.neighboringTiles,l.state="unloaded"}prepareTile(l,d,_){l._isHeaderLoaded&&(l.state!=="empty"&&(l.state="reloading"),l.fetchBand(d,_,(x,w)=>{if(x)return l.state="errored",this.fire(new a.f(x)),void this.triggerRepaint(l);w&&(l.setTexture(w,this.map.painter),l.state="loaded",this.triggerRepaint(l))}))}getInitialBand(l){if(!this.rasterLayers)return 0;const d=this.rasterLayers.find(({id:w})=>w===l),_=d&&d.fields,x=_&&_.bands&&_.bands;return x?x[0]:0}getTextureDescriptor(l,d,_){if(!l)return;const x=d.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let w=null;d instanceof a.bm?w=d.paint.get("raster-array-band"):d instanceof a.bn&&(w=d.paint.get("raster-particle-array-band"));const S=w||this.getInitialBand(x);if(S!=null)if(l.textureDescriptor){if(!l.updateNeeded(x,S)||_)return Object.assign({},l.textureDescriptor,{texture:l.texture})}else this.prepareTile(l,x,S)}}const X={vector:Em,raster:xo,"raster-dem":class extends xo{constructor(g,l,d,_){super(g,l,d,_),this.type="raster-dem",this.maxzoom=22,this._options=a.Q({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(g,l){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(x,w){x&&(g.state="errored",l(x)),w&&(g.dem=w,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",l(null))}g.request=a.i(this.map._requestManager.transformRequest(d,a.R.Tile),(function(x,w,S,C){if(delete g.request,g.aborted)g.state="unloaded",l(null);else if(x)g.state="errored",l(x);else if(w){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:S,expires:C});const k=ImageBitmap&&w instanceof ImageBitmap&&a.bk(),L=1-(w.width-a.bl(w.width))/2;L<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const N=k?w:a.e.getImageData(w,L),U={uid:g.uid,coord:g.tileID,source:this.id,scope:this.scope,rawImageData:N,encoding:this.encoding,padding:L};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",U,_.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const l=g.canonical,d=Math.pow(2,l.z),_=(l.x-1+d)%d,x=l.x===0?g.wrap-1:g.wrap,w=(l.x+1+d)%d,S=l.x+1===d?g.wrap+1:g.wrap,C={};return C[new a.aQ(g.overscaledZ,x,l.z,_,l.y).key]={backfilled:!1},C[new a.aQ(g.overscaledZ,S,l.z,w,l.y).key]={backfilled:!1},l.y>0&&(C[new a.aQ(g.overscaledZ,x,l.z,_,l.y-1).key]={backfilled:!1},C[new a.aQ(g.overscaledZ,g.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},C[new a.aQ(g.overscaledZ,S,l.z,w,l.y-1).key]={backfilled:!1}),l.y+1<d&&(C[new a.aQ(g.overscaledZ,x,l.z,_,l.y+1).key]={backfilled:!1},C[new a.aQ(g.overscaledZ,g.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},C[new a.aQ(g.overscaledZ,S,l.z,w,l.y+1).key]={backfilled:!1}),C}},"raster-array":R,geojson:class extends a.E{constructor(g,l,d,_){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(_),this._data=l.data,this._options=a.Q({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.minzoom!==void 0&&(this.minzoom=l.minzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const x=a.a4/this.tileSize;this.workerOptions=a.Q({source:this.id,scope:this.scope,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*x,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*x,extent:a.a4,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:a.a4,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*x,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter,dynamic:l.dynamic},l.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){if(!this._options.dynamic)return this.fire(new a.f(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof g!="string"&&(g.type==="Feature"&&(g={type:"FeatureCollection",features:[g]}),g.type!=="FeatureCollection"))return this.fire(new a.f(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof g!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const l=new Map;for(const d of this._data.features)l.set(d.id,d);for(const d of g.features)l.set(d.id,d);this._data.features=[...l.values()]}else this._data=g;return this._updateWorkerData(!0),this}getClusterExpansionZoom(g,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterChildren(g,l){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterLeaves(g,l,d,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:l,offset:d},_),this}_updateWorkerData(g=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.g("dataloading",{dataType:"source"})),this._loaded=!1;const l=a.Q({append:g},this.workerOptions);l.scope=this.scope;const d=this._data;typeof d=="string"?(l.request=this.map._requestManager.transformRequest(a.e.resolveURL(d),a.R.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(d),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(_,x)=>{if(this._loaded=!0,this._pendingLoad=null,_)this.fire(new a.f(_));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(w.resourceTiming=x.resourceTiming[this.id]),g&&(this._partialReload=!0),this.fire(new a.g("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(g),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,l){const d=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const _=this.map.style?this.map.style.getLut(this.scope):null,x=this._partialReload,w={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_?{image:_.image.clone()}:null,scope:this.scope,pixelRatio:a.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:x};g.request=this.actor.send(d,w,(S,C)=>x&&!C?(g.state="loaded",l(null)):(delete g.request,g.destroy(),g.aborted?l(null):S?l(S):(g.loadVectorData(C,this.map.painter,d==="reloadTile"),l(null))),void 0,d==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g,l){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(g){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.Q({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.bo{constructor(g,l,d,_){super(g,l,d,_),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const l of g.urls)this.urls.push(this.map._requestManager.transformRequest(l,a.R.Source).url);a.bp(this.urls,(l,d)=>{this._loaded=!0,l?this.fire(new a.f(l)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const l=this.video.seekable;g<l.start(0)||g>l.end(0)?this.fire(new a.f(new a.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,l=g.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(g,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.bo,model:class extends a.E{constructor(g,l,d,_){super(),this.id=g,this.type="model",this.models=[],this._loaded=!1,this._options=l}load(){const g=[];for(const l in this._options.models){const d=this._options.models[l],_=a.l(this.map._requestManager.transformRequest(d.uri,a.R.Model).url).then(x=>{if(!x)return;const w=a.c(x),S=new a.M(l,d.position,d.orientation,w);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(x=>{this.fire(new a.f(new Error(`Could not load model ${l} from ${d.uri}: ${x.message}`)))});g.push(_)}return Promise.allSettled(g).then(()=>{this._loaded=!0,this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(l=>{this.fire(new a.f(new Error(`Could not load models: ${l.message}`)))})}onAdd(g){this.map=g,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(g,l){}serialize(){return{type:"model"}}},"batched-model":class extends a.E{constructor(g,l,d,_){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=l,this.tiles=this._options.tiles,this.maxzoom=l.maxzoom||19,this.minzoom=l.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=d,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(_)}onAdd(g){this.map=g,this.load()}load(g){this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map._worldview;this._tileJSONRequest=Pf(this._options,this.map._requestManager,l,d,(_,x)=>{this._tileJSONRequest=null,this._loaded=!0,_?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),d&&d.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new a.f(_))):x&&(a.Q(this,x),x.bounds&&(this.tileBounds=new ko(x.bounds,this.minzoom,this.maxzoom)),a.ao(x.tiles,this.map._requestManager._customAccessToken),this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))),g&&g(_)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,l){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(d,a.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=l;else{if(g.buckets){const w=Object.values(g.buckets);for(const S of w)S.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",_,x.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",_,x.bind(this),void 0,!0);function x(w,S){return g.aborted?l(null):w&&w.status!==404?l(w):(S&&(S.resourceTiming&&(g.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&g.setExpiryData(S),g.buckets={...g.buckets,...S.buckets},S.featureIndex&&(g.latestFeatureIndex=S.featureIndex)),g.state="loaded",void l(null))}}serialize(){return a.Q({},this._options)}},canvas:class extends a.bo{constructor(g,l,d,_){super(g,l,d,_),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(w=>typeof w!="number"))||this.fire(new a.f(new a.V(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.f(new a.V(`sources.${g}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new a.f(new a.V(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new a.f(new a.V(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.f(new a.V(`sources.${g}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.f(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(g){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof a.bq||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends a.E{constructor(g,l,d,_){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=l,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.f(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.f(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ko(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),a.Q(this,a.ai(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.ai(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this.map=g,this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:l,y:d,z:_}=g.canonical;return this._implementation.hasTile({x:l,y:d,z:_})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,l){const{x:d,y:_,z:x}=g.tileID.canonical,w=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:d,y:_,z:x},{signal:w.signal})).then((function(S){return delete g.request,g.aborted?(g.state="unloaded",l(null)):S===void 0?(g.state="errored",l(null)):S===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",l(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(S)?(this.loadTileData(g,S),g.state="loaded",void l(null)):(g.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(g.state="errored",l(S))}),g.request.cancel=()=>w.abort()}loadTileData(g,l){g.setTexture(l,this.map.painter)}unloadTile(g,l){if(g.texture&&g.texture instanceof a.T?(g.destroy(!0),g.texture&&g.texture instanceof a.T&&this.map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:d,y:_,z:x}=g.tileID.canonical;this._implementation.unloadTile({x:d,y:_,z:x})}l&&l()}abortTile(g,l){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),l&&l()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=a.am(this.id,this.scope);this.map.style.clearSource(g)}_update(){this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))}}},le=function(g,l,d,_){const x=new X[l.type](g,l,d,_);if(x.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${x.id}`);return a.br(["load","abort","unload","serialize","prepare"],x),x};class ke extends a.bx{constructor(l){const d={type:"raster-dem",maxzoom:l.transform.maxZoom},_=new a.by(a.bz(),null),x=le("mock-dem",d,_,l.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,d){l.state="loaded",d(null)}}class ht extends a.bx{constructor(l){const d=le("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new a.by(a.bz(),null),l.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,d,_){if(l.freezeTileCoverage)return;this.transform=l;const x=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,S)=>{if(w[S.key]="",!this._tiles[S.key]){const C=new a.bA(S,this._source.tileSize*S.overscaleFactor(),l.tileZoom);C.state="loaded",this._tiles[S.key]=C}return w},{});for(const w in this._tiles)w in x||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(l){const d=this.proxyCachedFBO[l];if(d!==void 0){const _=Object.values(d);this.renderCachePool.push(..._),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class kt extends a.aQ{constructor(l,d,_){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=d,this.projMatrix=_}}class Qt extends a.bs{constructor(l,d){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},l.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,x,w]=function(k){const L=new a.bv,N=new a.bw,U=131;L.reserve(17161),N.reserve(33800);const $=a.a4/128,q=a.a4+$/2,te=q+$;for(let ie=-$;ie<te;ie+=$)for(let ae=-$;ae<te;ae+=$){const ve=ae<0||ae>q||ie<0||ie>q?24575:0,xe=a.au(Math.round(ae),0,a.a4),ye=a.au(Math.round(ie),0,a.a4);L.emplaceBack(xe+ve,ye)}const ne=(ie,ae)=>{const ve=ae*U+ie;N.emplaceBack(ve+1,ve,ve+U),N.emplaceBack(ve+U,ve+U+1,ve+1)};for(let ie=1;ie<129;ie++)for(let ae=1;ae<129;ae++)ne(ae,ie);return[0,129].forEach(ie=>{for(let ae=0;ae<130;ae++)ne(ae,ie),ne(ie,ae)}),[L,N,32768]}(),S=l.context;this.gridBuffer=S.createVertexBuffer(_,a.bt.members),this.gridIndexBuffer=S.createIndexBuffer(x),this.gridSegments=a.b.simpleSegment(0,0,_.length,x.length),this.gridNoSkirtSegments=a.b.simpleSegment(0,0,_.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ht(d.map),this.orthoMatrix=a.ae.create(),a.ae.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.a4,0,a.a4,0,1);const C=S.gl;this._overlapStencilMode=new a.ah({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ke(d.map),this._pendingGroundEffectLayers=[]}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),this._style=l,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,d,_){if(l&&l.terrain){this._style!==l&&(this.style=l,this._evaluationZoom=void 0);const x=l.terrain.properties,w=l.terrain.drapeRenderMode===0,S=l.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.e.now();const C=l.terrain&&l.terrain.scope,k=x.get("source"),L=w?this._mockSourceCache:l.getSourceCache(k,C);if(!L)return void a.w(`Couldn't find terrain source "${k}".`);if(this.sourceCache=L,this._exaggeration=S?this.calculateExaggeration(d):x.get("exaggeration"),!d.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const N=()=>{this.sourceCache.used&&a.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(d,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,N(),this._initializing=!0),N(),d.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0,this._previousZoom=d.zoom}else this._disable()}calculateExaggeration(l){const d=this._previousCameraAltitude,_=l.getFreeCameraOptions().position.z/l.pixelsPerMeter*l.worldSize;this._previousCameraAltitude=_;const x=d!=null?_-d:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const w=l.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(w);let C=w-this._previousZoom;const k=this._previousUpdateTimestamp;let L=w;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(w-L)>.5&&(C=.5*(w-L+C)),C*x<0&&(L+=C)),this._evaluationZoom=L;const N=S.getExaggeration(L),U=N===S.getExaggeration(Math.max(0,L-.1));if(U&&Math.abs(N-this._exaggeration)<.01)return N;let $=Math.min(.1,.00375*(this._updateTimestamp-k));return(U||N<.1||Math.abs(C)<1e-4)&&($=Math.min(.2,4*$)),a.a3(this._exaggeration,N,$)}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(l){l.coord&&l.dataType==="source"?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._mergedSourceCaches)this._style._mergedSourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(a._.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=d.getIds().map(k=>{const L=d.getTileByID(k).tileID;return L.projMatrix=_.calculateProjMatrix(L.toUnwrapped()),L});(function(k,L){const N=L.transform.pointCoordinate(L.transform.getCameraPoint()),U=new a.P(N.x,N.y);k.sort(($,q)=>{if(q.overscaledZ-$.overscaledZ)return q.overscaledZ-$.overscaledZ;const te=new a.P($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),ne=new a.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),ie=U.mult(1<<$.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(te)-ie.distSqr(ne)})})(x,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},x.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const k in S){const L=S[k];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,l[k],w),L.usedForTerrain))continue;const N=l[k];L.getSource().reparseOverscaled&&this._assignTerrainTiles(N)}this.proxiedCoords[d.id]=x.map(k=>new kt(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const L=this.terrainTileForTile[k.key];if(!L)continue;const N=L.tileID.key;N in C||(this._visibleDemTiles.push(L),C[N]=N)}}_assignTerrainTiles(l){this._initializing||l.forEach(d=>{if(this.terrainTileForTile[d.key])return;const _=this._findTileCoveringTileID(d,this.sourceCache);_&&(this.terrainTileForTile[d.key]=_)})}_prepareDEMTextures(){const l=this.painter.context,d=l.gl;for(const _ in this.terrainTileForTile){const x=this.terrainTileForTile[_],w=x.dem;!w||x.demTexture&&!x.needsDEMTextureUpload||(l.activeTexture.set(d.TEXTURE1),Tm(this.painter,x,w))}}_prepareDemTileUniforms(l,d,_,x){if(!d||d.demTexture==null)return!1;const w=l.tileID.canonical,S=Math.pow(2,d.tileID.canonical.z-w.z),C=x||"";return _[`u_dem_tl${C}`]=[w.x*S%1,w.y*S%1],_[`u_dem_scale${C}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let l=0;const d=this._visibleDemTiles.reduce((_,x)=>{if(!x.dem)return _;const w=x.dem.tree.minimums[0];return w>0&&l++,_+w},0);return l?d/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,d=l.gl;l.activeTexture.set(d.TEXTURE2);const _=this._getLoadedAreaMinimum(),[x,w]=(()=>{const C=new a.bB({width:1,height:1},new Float32Array([_]));return[d.R32F,C]})();this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(w,{premultiply:!1}):S=this._emptyDEMTexture=new a.T(l,w,x,{premultiply:!1}),S}setupElevationDraw(l,d,_){const x=this.painter.context,w=x.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let C=null,k=null,L=1;if(_&&_.morphing&&this._useVertexMorphing){const q=_.morphing.srcDemTile,te=_.morphing.dstDemTile;L=_.morphing.phase,q&&te&&(this._prepareDemTileUniforms(l,q,S,"_prev")&&(k=q),this._prepareDemTileUniforms(l,te,S)&&(C=te))}const N=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let U=null;var $;if(this.enabled?k&&C?(U=C.demTexture,x.activeTexture.set(w.TEXTURE4),k.demTexture.bind(N(k),w.CLAMP_TO_EDGE),S.u_dem_lerp=L):(C=this.terrainTileForTile[l.tileID.key],U=this._prepareDemTileUniforms(l,C,S)?C.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,x.activeTexture.set(w.TEXTURE2),U&&(S.u_dem_size=($=U).size[0]===1?1:$.size[0]-2,U.bind(N(C),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(_&&_.useDepthForOcclusion,d,S),_&&_.useMeterToDem&&C){const q=(1<<C.tileID.canonical.z)*a.ay(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=q}if(_&&_.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),d.setTerrainUniformValues(x,S),this.painter.transform.projection.name==="globe"){const q=this.globeUniformValues(this.painter.transform,l.tileID.canonical,_&&_.useDenormalizedUpVectorScale);d.setGlobeUniformValues(x,q)}}globeUniformValues(l,d,_){const x=l.projection;return{u_tile_tl_up:x.upVector(d,0,0),u_tile_tr_up:x.upVector(d,a.a4,0),u_tile_br_up:x.upVector(d,a.a4,a.a4),u_tile_bl_up:x.upVector(d,0,a.a4),u_tile_up_scale:_?a.bu(1):x.upVectorScale(d,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const d=this.painter,_=this.painter.context;l.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,w,S,C,k){if(x.transform.projection.name==="globe")(function(L,N,U,$,q){const te=L.context,ne=te.gl;let ie,ae;const ve=L.transform,xe=a.bc(L,te,ve),ye=(Je,Ye)=>{if(ae===Ye)return;const je=[ml[Ye],"PROJECTION_GLOBE_VIEW"];xe&&je.push("CUSTOM_ANTIALIASING");const vt=L.isTileAffectedByFog(Je);ie=L.getOrCreateProgram("globeRaster",{defines:je,overrideFog:vt}),ae=Ye},Me=L.colorModeForRenderPass(),Se=new a.af(ne.LEQUAL,a.af.ReadWrite,L.depthRangeFor3D);ja.update(q);const Ie=a.bd(ve),Ne=[a.ak(ve.center.lng),a.al(ve.center.lat)],Fe=L.globeSharedBuffers,We=[ve.width*a.e.devicePixelRatio,ve.height*a.e.devicePixelRatio],Be=Float32Array.from(ve.globeMatrix),Re={useDenormalizedUpVectorScale:!0};{const Je=L.transform,Ye=Ji(Je.zoom,N.exaggeration(),N.sourceCache._source.tileSize);ae=-1;const je=ne.TRIANGLES;for(const vt of $){const dt=U.getTile(vt),He=a.ah.disabled,it=N.prevTerrainTileForTile[vt.key],Ue=N.terrainTileForTile[vt.key];Vc(it,Ue)&&ja.newMorphing(vt.key,it,Ue,q,250),te.activeTexture.set(ne.TEXTURE0),dt.texture&&dt.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const ft=ja.getMorphValuesForProxy(vt.key),gt=ft?1:0;ft&&a.q(Re,{morphing:{srcDemTile:ft.from,dstDemTile:ft.to,phase:a.bb(ft.phase)}});const Ut=a.be(vt.canonical),$t=a.bf(Ut.getCenter().lat),tn=a.bg(vt.canonical,Ut,$t,Je.worldSize/Je._pixelsPerMercatorPixel),qt=a.bh(a.bi(vt.canonical)),bn=zc(Je.expandedFarZProjMatrix,Be,Ie,qt,a.a2(Je.zoom),Ne,Je.frustumCorners.TL,Je.frustumCorners.TR,Je.frustumCorners.BR,Je.frustumCorners.BL,Je.globeCenterInViewSpace,Je.globeRadius,We,Ye,Je._farZ,tn);if(ye(vt,gt),ie&&(N.setupElevationDraw(dt,ie,Re),L.uploadCommonUniforms(te,ie,vt.toUnwrapped()),Fe)){const[Fn,Tn,jn]=Fe.getGridBuffers($t,Ye!==0);ie.draw(L,je,Se,He,Me,a.ag.backCCW,bn,"globe_raster",Fn,Tn,jn)}}}if(Fe&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const Je=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];xe&&Je.push("CUSTOM_ANTIALIASING"),ie=L.getOrCreateProgram("globeRaster",{defines:Je});for(const Ye of $){const{x:je,y:vt,z:dt}=Ye.canonical,He=vt===0,it=vt===(1<<dt)-1,[Ue,ft,gt,Ut]=Fe.getPoleBuffers(dt,!1);if(Ut&&(He||it)){const $t=U.getTile(Ye);te.activeTexture.set(ne.TEXTURE0),$t.texture&&$t.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);let tn=a.bj(dt,je,ve);const qt=a.bh(a.bi(Ye.canonical)),bn=(Fn,Tn)=>Fn.draw(L,ne.TRIANGLES,Se,a.ah.disabled,Me,a.ag.disabled,zc(ve.expandedFarZProjMatrix,tn,tn,qt,0,Ne,ve.frustumCorners.TL,ve.frustumCorners.TR,ve.frustumCorners.BR,ve.frustumCorners.BL,ve.globeCenterInViewSpace,ve.globeRadius,We,0,ve._farZ),"globe_pole_raster",Tn,gt,Ut);N.setupElevationDraw($t,ie,Re),L.uploadCommonUniforms(te,ie,Ye.toUnwrapped()),He&&L.renderDefaultNorthPole&&bn(ie,Ue),it&&L.renderDefaultSouthPole&&(tn=a.ae.scale(a.ae.create(),tn,[1,-1,1]),bn(ie,ft))}}}})(x,w,S,C,k);else{const L=x.context,N=L.gl;let U,$;const q=x.shadowRenderer,te=Rs(x,x.longestCutoffRange),ne=Me=>{if($===Me)return;const Se=[];Se.push(ml[Me]),te.shouldRenderCutoff&&Se.push("RENDER_CUTOFF"),U=x.getOrCreateProgram("terrainRaster",{defines:Se}),$=Me},ie=x.colorModeForRenderPass(),ae=new a.af(N.LEQUAL,a.af.ReadWrite,x.depthRangeFor3D);ja.update(k);const ve=x.transform,xe=Ji(ve.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let ye=[0,0,0];if(q){const Me=x.style.directionalLight,Se=x.style.ambientLight;Me&&Se&&(ye=Uc(x.style,Me,Se))}{$=-1;const Me=N.TRIANGLES,[Se,Ie]=[w.gridIndexBuffer,w.gridSegments];for(const Ne of C){const Fe=S.getTile(Ne),We=a.ah.disabled,Be=w.prevTerrainTileForTile[Ne.key],Re=w.terrainTileForTile[Ne.key];Vc(Be,Re)&&ja.newMorphing(Ne.key,Be,Re,k,250),L.activeTexture.set(N.TEXTURE0),Fe.texture&&Fe.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const Je=ja.getMorphValuesForProxy(Ne.key),Ye=Je?1:0;let je;Je&&(je={morphing:{srcDemTile:Je.from,dstDemTile:Je.to,phase:a.bb(Je.phase)}});const vt=Lc(Ne.projMatrix,jc(Ne.canonical,ve.renderWorldCopies)?xe/10:xe,ye);if(ne(Ye),!U)continue;w.setupElevationDraw(Fe,U,je);const dt=Ne.toUnwrapped();q&&q.setupShadows(dt,U),x.uploadCommonUniforms(L,U,dt,null,te),U.draw(x,Me,ae,We,ie,a.ag.backCCW,vt,"terrain_raster",w.gridBuffer,Se,Ie)}}}}(d,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;const d=this.painter,_=this.painter.context,x=this.proxySourceCache,w=this.proxiedCoords[x.id],S=this._drapedRenderBatches.shift(),C=d.style.order,k=[];let L=0;for(const N of w){const U=x.getTileByID(N.proxyTileKey),$=x.proxyCachedFBO[N.key]?x.proxyCachedFBO[N.key][l]:void 0,q=$!==void 0?x.renderCache[$]:this.pool[L++],te=$!==void 0;if(U.texture=q.tex,te&&!q.dirty){k.push(U.tileID);continue}let ne;_.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(_.clear({color:a.C.transparent,stencil:0}),q.dirty=!1);for(let ie=S.start;ie<=S.end;++ie){const ae=d.style._mergedLayers[C[ie]];if(ae.isHidden(d.transform.zoom))continue;const ve=d.style.getLayerSourceCache(ae),xe=ve?this.proxyToSource[N.key][ve.id]:[N];if(!xe)continue;const ye=xe;_.viewport.set([0,0,q.fb.width,q.fb.height]),ne!==(ve?ve.id:null)&&(this._setupStencil(q,xe,ae,ve),ne=ve?ve.id:null),d.renderLayer(d,ve,ae,ye)}if(this._drapedRenderBatches.length===0)for(const ie of this._pendingGroundEffectLayers){const ae=d.style._mergedLayers[C[ie]];if(ae.isHidden(d.transform.zoom))continue;const ve=d.style.getLayerSourceCache(ae),xe=ve?this.proxyToSource[N.key][ve.id]:[N];if(!xe)continue;const ye=xe;_.viewport.set([0,0,q.fb.width,q.fb.height]),ne!==(ve?ve.id:null)&&(this._setupStencil(q,xe,ae,ve),ne=ve?ve.id:null),d.renderLayer(d,ve,ae,ye)}this.renderedToTile?(q.dirty=!0,k.push(U.tileID)):te||--L,L===5&&(L=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),S.end+1}postRender(){}isLayerOrderingCorrect(l){const d=l.order.length;let _=-1,x=d;for(let w=0;w<d;++w)this._style.isLayerDraped(l._mergedLayers[l.order[w]])?_=Math.max(_,w):x=Math.min(x,w);return x>_}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{l=Math.min(l,d.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,d,_){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const S=w.tileID,C=1<<S.overscaledZ,{x:k,y:L}=S.canonical,N=k/C,U=(k+1)/C,$=L/C,q=(L+1)/C;return{minx:N,miny:$,maxx:U,maxy:q,t:w.dem.tree.raycastRoot(N,$,U,q,l,d,_),tile:w}});x.sort((w,S)=>(w.t!==null?w.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const w of x){if(w.t==null)return null;const S=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,l,d,_);if(S!=null)return S}return null}_createFBO(){const l=this.painter.context,d=l.gl,_=this.drapeBufferSize;l.activeTexture.set(d.TEXTURE0);const x=new a.T(l,{width:_[0],height:_[1],data:null},d.RGBA);x.bind(d.LINEAR,d.CLAMP_TO_EDGE);const w=l.createFramebuffer(_[0],_[1],!0,null);return w.colorAttachment.set(x.texture),w.depthAttachment=new br(l,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:w,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const l in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const d=this._style._mergedLayers[l],_=d.isHidden(this.painter.transform.zoom);return d.type==="custom"?!_&&d.shouldRedrape():!_&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const _ of this._style.getSources())if(_ instanceof Em){l=!0;break}if(!l)return;const d={};for(let _=0;_<this._style.order.length;++_){const x=this._style._mergedLayers[this._style.order[_]],w=this._style.getLayerSourceCache(x);if(w&&!d[w.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof a.Z){d[w.id]=!0;for(const S of this.proxyCoords){const C=this.proxyToSource[S.key][w.id];if(C)for(const k of C)this._clearRenderCacheForTile(w.id,k)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const _ in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[_]._source instanceof xo){l=!0;break}if(!l)return;const d={};for(let _=0;_<this._style.order.length;++_){const x=this._style._mergedLayers[this._style.order[_]],w=this._style.getLayerSourceCache(x);if(!w||d[w.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const S=x.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const k=this.proxyToSource[C.key][w.id];if(k)for(const L of k){const N=$a(w.getTile(L),w.findLoadedParent(L,0),w,this.painter.transform,S);(N.opacity!==1||N.mix!==0)&&this._clearRenderCacheForTile(w.id,L)}}}}_setupDrapedRenderBatches(){const l=this._style.order,d=l.length;if(d===0)return;const _=[];this._pendingGroundEffectLayers=[];let x,w=0,S=this._style._mergedLayers[l[w]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++w<d;)S=this._style._mergedLayers[l[w]];for(;w<d;++w){const C=this._style._mergedLayers[l[w]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?x===void 0&&(x=w):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),x!==void 0&&(_.push({start:x,end:w-1}),x=void 0)))}if(x!==void 0&&_.push({start:x,end:w-1}),_.length!==0){const C=_[_.length-1];this._pendingGroundEffectLayers.every(k=>k>C.end)||a.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=_}_setupRenderCache(l){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const S=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let C=0;C<S.length;++C){const k=Object.values(S[C]);d.renderCachePool.push(...k)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,x=this._tilesDirty;for(let S=_.length-1;S>=0;S--){const C=_[S];if(d.getTileByID(C.key),d.proxyCachedFBO[C.key]!==void 0){const k=l[C.key],L=this.proxyToSource[C.key];let N=0;for(const U in L){const $=L[U],q=k[U];if(!q||q.length!==$.length||$.some((te,ne)=>te!==q[ne]||x[U]&&x[U].hasOwnProperty(te.key))){N=-1;break}++N}for(const U in d.proxyCachedFBO[C.key])d.renderCache[d.proxyCachedFBO[C.key][U]].dirty=N<0||N!==Object.values(k).length}}const w=[...this._drapedRenderBatches];w.sort((S,C)=>C.end-C.start-(S.end-S.start));for(const S of w)for(const C of _){if(d.proxyCachedFBO[C.key])continue;let k=d.renderCachePool.pop();k===void 0&&d.renderCache.length<50&&(k=d.renderCache.length,d.renderCache.push(this._createFBO())),k!==void 0&&(d.proxyCachedFBO[C.key]={},d.proxyCachedFBO[C.key][S.start]=k,d.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(l,d,_,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,S=w.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let C;if(_.isTileClipped())C=d.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):a.ah.disabled}_renderTileClippingMasks(l,d){const _=this.painter,x=this.painter.context,w=x.gl;_._tileClippingMaskIDs={},x.setColorMode(a.a.disabled),x.setDepthMode(a.af.disabled);const S=_.getOrCreateProgram("clippingMask");for(const C of l){const k=_._tileClippingMaskIDs[C.key]=--d;S.draw(_,w.TRIANGLES,a.af.disabled,new a.ah({func:w.ALWAYS,mask:0},k,255,w.KEEP,w.KEEP,w.REPLACE),a.a.disabled,a.ag.disabled,$c(C.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(l){const d=this.painter.transform;if(l.x<0||l.x>d.width||l.y<0||l.y>d.height)return null;const _=[l.x,l.y,1,1];a.aB.transformMat4(_,_,d.pixelMatrixInverse),a.aB.scale(_,_,1/_[3]),_[0]/=d.worldSize,_[1]/=d.worldSize;const x=d._camera.position,w=a.ay(1,d.center.lat),S=[x[0],x[1],x[2]/w,0],C=a.$.subtract([],_.slice(0,3),S);a.$.normalize(C,C);const k=this.raycast(S,C,this._exaggeration);return k!==null&&k?(a.$.scaleAndAdd(S,S,C,k),S[3]=S[2],S[2]*=w,S):null}_setupProxiedCoordsForOrtho(l,d,_){if(l.getSource()instanceof a.bo)return this._setupProxiedCoordsForImageSource(l,d,_);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const x=this.proxiedCoords[l.id]=[],w=this.proxyCoords;for(let k=0;k<w.length;k++){const L=w[k],N=this._findTileCoveringTileID(L,l);if(N){const U=this._createProxiedId(L,N,_[L.key]&&_[L.key][l.id]);x.push(U),this.proxyToSource[L.key][l.id]=[U]}}let S=!1;const C=new Set;for(let k=0;k<d.length;k++){const L=l.getTile(d[k]);if(!L||!L.hasData())continue;const N=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(N&&N.tileID.canonical.z!==L.tileID.canonical.z){const U=this.proxyToSource[N.tileID.key][l.id],$=this._createProxiedId(N.tileID,L,_[N.tileID.key]&&_[N.tileID.key][l.id]);U?U.splice(U.length-1,0,$):this.proxyToSource[N.tileID.key][l.id]=[$];const q=this.proxyToSource[N.tileID.key][l.id];C.has(q)||C.add(q),x.push($),S=!0}}if(this._sourceTilesOverlap[l.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const k of C)k.sort((L,N)=>N.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(l,d,_){if(!l.getSource().loaded())return;const x=this.proxiedCoords[l.id]=[],w=this.proxyCoords,S=l.getSource(),C=S.tileID;if(!C)return;const k=new a.P(C.x,C.y)._div(1<<C.z),L=S.coordinates.map(a._.fromLngLat).reduce((U,$)=>(U.min.x=Math.min(U.min.x,$.x-k.x),U.min.y=Math.min(U.min.y,$.y-k.y),U.max.x=Math.max(U.max.x,$.x-k.x),U.max.y=Math.max(U.max.y,$.y-k.y),U),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),N=(U,$)=>{const q=U.wrap+U.canonical.x/(1<<U.canonical.z),te=U.canonical.y/(1<<U.canonical.z),ne=a.a4/(1<<U.canonical.z),ie=$.wrap+$.canonical.x/(1<<$.canonical.z),ae=$.canonical.y/(1<<$.canonical.z);return q+ne<ie+L.min.x||q>ie+L.max.x||te+ne<ae+L.min.y||te>ae+L.max.y};for(let U=0;U<w.length;U++){const $=w[U];for(let q=0;q<d.length;q++){const te=l.getTile(d[q]);if(!te||!te.hasData()||N($,te.tileID))continue;const ne=this._createProxiedId($,te,_[$.key]&&_[$.key][l.id]),ie=this.proxyToSource[$.key][l.id];ie?ie.push(ne):this.proxyToSource[$.key][l.id]=[ne],x.push(ne)}}}_createProxiedId(l,d,_){let x=this.orthoMatrix;if(_){const w=_.find(S=>S.key===d.tileID.key);if(w)return w}if(d.tileID.key!==l.key){const w=l.canonical.z-d.tileID.canonical.z;let S,C,k;x=a.ae.create();const L=d.tileID.wrap-l.wrap<<l.overscaledZ;w>0?(S=a.a4>>w,C=S*((d.tileID.canonical.x<<w)-l.canonical.x+L),k=S*((d.tileID.canonical.y<<w)-l.canonical.y)):(S=a.a4<<-w,C=a.a4*(d.tileID.canonical.x-(l.canonical.x+L<<-w)),k=a.a4*(d.tileID.canonical.y-(l.canonical.y<<-w))),a.ae.ortho(x,0,S,0,S,0,1),a.ae.translate(x,x,[C,k,0])}return new kt(d.tileID,l.key,x)}_findTileCoveringTileID(l,d){let _=d.getTile(l);if(_&&_.hasData())return _;const x=this._findCoveringTileCache[d.id],w=x[l.key];if(_=w?d.getTileByID(w):null,_&&_.hasData()||w===null)return _;let S=_?_.tileID:l,C=S.overscaledZ;const k=d.getSource().minzoom,L=[];if(!w){const U=d.getSource().maxzoom;if(l.canonical.z>=U){const $=l.canonical.z-U;d.getSource().reparseOverscaled?(C=Math.max(l.canonical.z+2,d.transform.tileZoom),S=new a.aQ(C,l.wrap,U,l.canonical.x>>$,l.canonical.y>>$)):$!==0&&(C=U,S=new a.aQ(C,l.wrap,U,l.canonical.x>>$,l.canonical.y>>$))}S.key!==l.key&&(L.push(S.key),_=d.getTile(S))}const N=U=>{L.forEach($=>{x[$]=U}),L.length=0};for(C-=1;C>=k&&(!_||!_.hasData());C--){_&&N(_.tileID.key);const U=S.calculateScaledKey(C);if(_=d.getTileByID(U),_&&_.hasData())break;const $=x[U];if($===null)break;$===void 0?L.push(U):_=d.getTileByID($)}return N(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,d){let _=this._tilesDirty[l];_||(_=this._tilesDirty[l]={}),_[d.key]=!0}}function ri(g,l,d){const _=function(C,k,L){const N=a.$.dot(k,C),U=a.$.dot(L,[.2126,.7152,.0722]),$=(te,ne,ie)=>(1-ie)*te+ie*ne,q=$(1-.3*Math.min(U,1),1,Math.min(N+1,1));return $(.92,1,Math.asin(a.au(k[2],-1,1))/Math.PI+.5)*q}(g,[0,0,1],l),x=[0,0,0];a.$.scale(x,d.slice(0,3),_);const w=[0,0,0];a.$.scale(w,l.slice(0,3),g[2]);const S=[0,0,0];return a.$.add(S,x,w),a.ba(S)}const us=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Vr=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Es{static cacheKey(l,d,_,x){let w=`${d}${x?x.cacheKey:""}`;for(const S of _)l.usedDefines.includes(S)&&(w+=`/${S}`);return w}constructor(l,d,_,x,w,S){const C=l.gl;this.program=C.createProgram(),this.configuration=x,this.name=d,this.fixedDefines=[...S];const k=x?x.getBinderAttributes():[],L=(_.staticAttributes||[]).concat(k);let N=x?x.defines():[];N=N.concat(S.map(ie=>`#define ${ie}`));const U=`#version 300 es
`;let $=U+N.concat("precision mediump float;",xm,Wh.fragmentSource).join(`
`);for(const ie of _.fragmentIncludes)$+=`
${Ou[ie]}`;$+=`
${_.fragmentSource}`;let q=U+N.concat("precision highp float;",xm,Wh.vertexSource).join(`
`);for(const ie of _.vertexIncludes)q+=`
${Ou[ie]}`;q+=`
${_.vertexSource}`;const te=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(te,$),C.compileShader(te),C.attachShader(this.program,te);const ne=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(ne,q),C.compileShader(ne),C.attachShader(this.program,ne),this.attributes={},this.numAttributes=L.length;for(let ie=0;ie<this.numAttributes;ie++)if(L[ie]){const ae=L[ie].startsWith("a_")?L[ie]:`a_${L[ie]}`;C.bindAttribLocation(this.program,ie,ae),this.attributes[ae]=ie}C.linkProgram(this.program),C.deleteShader(ne),C.deleteShader(te),this.fixedUniforms=w(l),this.binderUniforms=x?x.getUniforms(l):[],(S.includes("TERRAIN")||d.indexOf("symbol")!==-1||d.indexOf("circle")!==-1)&&(this.terrainUniforms=(ie=>({u_dem:new a.a8(ie),u_dem_prev:new a.a8(ie),u_dem_tl:new a.a9(ie),u_dem_scale:new a.ab(ie),u_dem_tl_prev:new a.a9(ie),u_dem_scale_prev:new a.ab(ie),u_dem_size:new a.ab(ie),u_dem_lerp:new a.ab(ie),u_exaggeration:new a.ab(ie),u_depth:new a.a8(ie),u_depth_size_inv:new a.a9(ie),u_depth_range_unpack:new a.a9(ie),u_occluder_half_size:new a.ab(ie),u_occlusion_depth_offset:new a.ab(ie),u_meter_to_dem:new a.ab(ie),u_label_plane_matrix_inv:new a.a7(ie)}))(l)),S.includes("GLOBE")&&(this.globeUniforms=(ie=>({u_tile_tl_up:new a.ar(ie),u_tile_tr_up:new a.ar(ie),u_tile_br_up:new a.ar(ie),u_tile_bl_up:new a.ar(ie),u_tile_up_scale:new a.ab(ie)}))(l)),S.includes("FOG")&&(this.fogUniforms=(ie=>({u_fog_matrix:new a.a7(ie),u_fog_range:new a.a9(ie),u_fog_color:new a.at(ie),u_fog_horizon_blend:new a.ab(ie),u_fog_vertical_limit:new a.a9(ie),u_fog_temporal_offset:new a.ab(ie),u_frustum_tl:new a.ar(ie),u_frustum_tr:new a.ar(ie),u_frustum_br:new a.ar(ie),u_frustum_bl:new a.ar(ie),u_globe_pos:new a.ar(ie),u_globe_radius:new a.ab(ie),u_globe_transition:new a.ab(ie),u_is_globe:new a.a8(ie),u_viewport:new a.a9(ie)}))(l)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ie=>({u_cutoff_params:new a.at(ie)}))(l)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ie=>({u_lighting_ambient_color:new a.ar(ie),u_lighting_directional_dir:new a.ar(ie),u_lighting_directional_color:new a.ar(ie),u_ground_radiance:new a.ar(ie)}))(l)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ie=>({u_light_matrix_0:new a.a7(ie),u_light_matrix_1:new a.a7(ie),u_fade_range:new a.a9(ie),u_shadow_normal_offset:new a.ar(ie),u_shadow_intensity:new a.ab(ie),u_shadow_texel_size:new a.ab(ie),u_shadow_map_resolution:new a.ab(ie),u_shadow_direction:new a.ar(ie),u_shadow_bias:new a.ar(ie),u_shadowmap_0:new a.a8(ie),u_shadowmap_1:new a.a8(ie)}))(l))}}setTerrainUniformValues(l,d){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const x in d)_[x]&&_[x].set(this.program,x,d[x])}}setGlobeUniformValues(l,d){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const x in d)_[x]&&_[x].set(this.program,x,d[x])}}setFogUniformValues(l,d){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const x in d)_[x].set(this.program,x,d[x])}}setCutoffUniformValues(l,d){if(!this.cutoffUniforms)return;const _=this.cutoffUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const x in d)_[x].set(this.program,x,d[x])}}setLightsUniformValues(l,d){if(!this.lightsUniforms)return;const _=this.lightsUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const x in d)_[x].set(this.program,x,d[x])}}setShadowUniformValues(l,d){if(this.failedToCreate||!this.shadowUniforms)return;const _=this.shadowUniforms;l.program.set(this.program);for(const x in d)_[x].set(this.program,x,d[x])}_drawDebugWireframe(l,d,_,x,w,S,C,k,L,N){const U=l.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const $=l.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||l._terrain&&l._terrain.renderingToTexture||!us.includes(this.name))||!(!U.layers3D||!Vr.includes(this.name))))return;const q=$.gl,te=l.wireframeDebugCache.getLinesFromTrianglesBuffer(l.frameCounter,w,$);if(!te)return;const ne=[...this.fixedDefines];ne.push("DEBUG_WIREFRAME");const ie=l.getOrCreateProgram(this.name,{config:this.configuration,defines:ne});$.program.set(ie.program);const ae=(ye,Me,Se)=>{if(Me[ye]&&Se[ye])for(const Ie in Me[ye])Se[ye][Ie]&&Se[ye][Ie].set(Se.program,Ie,Me[ye][Ie].current)};L&&L.setUniforms(ie.program,$,ie.binderUniforms,C,{zoom:k}),ae("fixedUniforms",this,ie),ae("terrainUniforms",this,ie),ae("globeUniforms",this,ie),ae("fogUniforms",this,ie),ae("lightsUniforms",this,ie),ae("shadowUniforms",this,ie),te.bind(),$.setColorMode(new a.a([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],a.C.transparent,[!0,!0,!0,!1])),$.setDepthMode(new a.af(d.func===q.LESS?q.LEQUAL:d.func,a.af.ReadOnly,d.range)),$.setStencilMode(a.ah.disabled);const ve=3*S.primitiveLength*2,xe=3*S.primitiveOffset*2*2;N&&N>1?q.drawElementsInstanced(q.LINES,ve,q.UNSIGNED_SHORT,xe,N):q.drawElements(q.LINES,ve,q.UNSIGNED_SHORT,xe),w.bind(),$.program.set(this.program),$.setDepthMode(d),$.setStencilMode(_),$.setColorMode(x)}draw(l,d,_,x,w,S,C,k,L,N,U,$,q,te,ne,ie){const ae=l.context,ve=ae.gl;if(this.failedToCreate)return;ae.program.set(this.program),ae.setDepthMode(_),ae.setStencilMode(x),ae.setColorMode(w),ae.setCullFace(S);for(const Me of Object.keys(this.fixedUniforms))this.fixedUniforms[Me].set(this.program,Me,C[Me]);te&&te.setUniforms(this.program,ae,this.binderUniforms,$,{zoom:q});const xe={[ve.POINTS]:1,[ve.LINES]:2,[ve.TRIANGLES]:3,[ve.LINE_STRIP]:1}[d],ye=ie&&ie>0?1:void 0;for(const Me of U.get()){const Se=Me.vaos||(Me.vaos={});(Se[k]||(Se[k]=new bm)).bind(ae,this,L,te?te.getPaintVertexBuffers():[],N,Me.vertexOffset,ne||[],ye),ie&&ie>1?ve.drawElementsInstanced(d,Me.primitiveLength*xe,ve.UNSIGNED_SHORT,Me.primitiveOffset*xe*2,ie):N?ve.drawElements(d,Me.primitiveLength*xe,ve.UNSIGNED_SHORT,Me.primitiveOffset*xe*2):ve.drawArrays(d,Me.vertexOffset,Me.vertexLength),d===ve.TRIANGLES&&N&&this._drawDebugWireframe(l,_,x,w,N,Me,$,q,te,ie)}}}function Ss(g,l){const d=Math.pow(2,l.tileID.overscaledZ),_=l.tileSize*Math.pow(2,g.transform.tileZoom)/d,x=_*(l.tileID.canonical.x+l.tileID.wrap*d),w=_*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture?l.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.bD(l,1,g.transform.tileZoom),u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const Jl=a.ae.create(),es=(g,l,d,_,x,w,S,C,k,L,N,U,$,q,te,ne,ie,ae)=>{const ve=l.style.light,xe=ve.properties.get("position"),ye=[xe.x,xe.y,xe.z],Me=a.bE.create();ve.properties.get("anchor")==="viewport"&&(a.bE.fromRotation(Me,-l.transform.angle),a.$.transformMat3(ye,ye,Me));const Se=ve.properties.get("color"),Ie=l.transform,Ne={u_matrix:g,u_lightpos:ye,u_lightintensity:ve.properties.get("intensity"),u_lightcolor:[Se.r,Se.g,Se.b],u_vertical_gradient:+d,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Jl,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:w,u_alignment:S,u_width_scale:C,u_flood_light_color:q,u_vertical_scale:te,u_flood_light_intensity:ne,u_ground_shadow_factor:ie,u_emissive_strength:ae};return Ie.projection.name==="globe"&&(Ne.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],Ne.u_zoom_transition=N,Ne.u_inv_rot_matrix=$,Ne.u_merc_center=U,Ne.u_up_dir=Ie.projection.upVector(new a.aO(0,0,0),U[0]*a.a4,U[1]*a.a4),Ne.u_height_lift=L),Ne},ec=(g,l,d,_,x)=>({u_matrix:g,u_edge_radius:l,u_alignment:d,u_width_scale:_,u_vertical_scale:x}),Kh=(g,l,d,_,x,w,S,C,k,L,N,U,$,q,te,ne)=>{const ie=es(g,l,d,_,x,w,S,C,k,N,U,$,q,te,ne,1,[0,0,0],0),ae={u_height_factor:-Math.pow(2,k.overscaledZ)/L.tileSize/8};return a.Q(ie,Ss(l,L),ae)},Mf=(g,l)=>({u_matrix:g,u_emissive_strength:l}),Im=(g,l,d,_)=>a.Q(Mf(g,l),Ss(d,_)),Am=(g,l,d)=>({u_matrix:g,u_world:d,u_emissive_strength:l}),kf=(g,l,d,_,x)=>a.Q(Im(g,l,d,_),{u_world:x}),Yh=(g,l,d,_)=>{const x=a.a4/d.tileSize;return{u_matrix:g,u_camera_to_center_distance:l.getCameraToCenterDistance(_),u_extrude_scale:[l.pixelsToGLUnits[0]/x,l.pixelsToGLUnits[1]/x]}},Cm=(g,l,d=1)=>({u_matrix:g,u_color:l.toRenderColor(null),u_overlay:0,u_overlay_scale:d}),v1=a.ae.create(),x1=(g,l,d,_,x,w,S)=>{const C=g.transform,k=C.projection.name==="globe",L=k?a.bF(C.zoom,l.canonical)*C._pixelsPerMercatorPixel:a.bD(d,1,w),N={u_matrix:l.projMatrix,u_extrude_scale:L,u_intensity:S,u_inv_rot_matrix:v1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){N.u_inv_rot_matrix=_,N.u_merc_center=x,N.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],N.u_zoom_transition=a.a2(C.zoom);const U=x[0]*a.a4,$=x[1]*a.a4;N.u_up_dir=C.projection.upVector(new a.aO(0,0,0),U,$)}return N};function _y(g,[l,d,_,x],[w,S]){if(w===S)return[0,0,0,0];const C=255*(g-1)/(g*(S-w));return[l*C,d*C,_*C,x*C]}function Df(g,l,[d,_]){return d===_?0:.5/g+(l-d)*(g-1)/(g*(_-d))}const Pm=(g,l,d,_,x,w,S,C,k,L,N,U,$,q,te,ne,ie,ae,ve,xe,ye)=>({u_matrix:g,u_normalize_matrix:l,u_globe_matrix:d,u_merc_matrix:_,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:L,u_fade_t:N.mix,u_opacity:N.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:a.bG(U.paint.get("raster-saturation")),u_contrast_factor:a.bH(U.paint.get("raster-contrast")),u_spin_weights:yy(U.paint.get("raster-hue-rotate")),u_perspective_transform:$,u_raster_elevation:q,u_zoom_transition:S,u_merc_center:C,u_cutoff_params:k,u_colorization_mix:_y(a.bI,ne,ae),u_colorization_offset:Df(a.bI,ie,ae),u_color_ramp:te,u_texture_offset:[xe/(ve+2*xe),ve/(ve+2*xe)],u_texture_res:[ve+2*xe,ve+2*xe],u_emissive_strength:ye});function yy(g){g*=Math.PI/180;const l=Math.sin(g),d=Math.cos(g);return[(2*d+1)/3,(-Math.sqrt(3)*l-d+1)/3,(Math.sqrt(3)*l-d+1)/3]}const gl=.05,Bu=(g,l,d,_,x,w,S,C,k,L,N,U)=>({u_matrix:g,u_normalize_matrix:l,u_globe_matrix:d,u_merc_matrix:_,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:L,u_fade_t:N.mix,u_opacity:N.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:S,u_merc_center:C,u_cutoff_params:k}),FI=(g,l,d,_,x,w,S,C,k,L)=>({u_particle_texture:g,u_particle_texture_side_len:l,u_tile_offset:d,u_velocity:_,u_color_ramp:w,u_velocity_res:x,u_max_speed:S,u_uv_offset:C,u_data_scale:[255*k[0],255*k[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[gl,gl]}),b1=(g,l,d,_,x,w,S,C,k,L)=>({u_particle_texture:g,u_particle_texture_side_len:l,u_velocity:d,u_velocity_res:_,u_max_speed:x,u_speed_factor:w,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:[255*k[0],255*k[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[gl,gl]}),Of=a.ae.create(),Qh=(g,l,d,_,x,w,S,C,k,L,N,U,$,q,te,ne,ie,ae)=>{const ve=x.transform,xe={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:ve.getCameraToCenterDistance(ne),u_rotate_symbol:+d,u_aspect_ratio:ve.width/ve.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:S,u_coord_matrix:C,u_is_text:+k,u_pitch_with_map:+_,u_texsize:L,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Of,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Of,u_up_vector:[0,-1,0],u_color_adj_mat:ie,u_icon_transition:ae||0};return ne.name==="globe"&&(xe.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],xe.u_zoom_transition=U,xe.u_inv_rot_matrix=q,xe.u_merc_center=$,xe.u_camera_forward=ve._camera.forward(),xe.u_ecef_origin=a.bJ(ve.globeMatrix,N.toUnwrapped()),xe.u_tile_matrix=Float32Array.from(ve.globeMatrix),xe.u_up_vector=te),xe},Lf=(g,l,d,_,x,w,S,C,k,L,N,U,$,q,te,ne,ie)=>a.Q(Qh(g,l,d,_,x,w,S,C,k,L,U,$,q,te,ne,ie),{u_gamma_scale:_?x.transform.getCameraToCenterDistance(ie)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:a.e.devicePixelRatio,u_is_halo:+N,undefined:void 0}),vy=(g,l,d,_,x,w,S,C,k,L,N,U,$,q,te,ne)=>a.Q(Lf(g,l,d,_,x,w,S,C,!0,k,!0,N,U,$,q,te,ne),{u_texsize_icon:L,u_texture_icon:1}),xy=(g,l,d,_)=>({u_matrix:g,u_emissive_strength:l,u_opacity:d,u_color:_}),BI=(g,l,d,_,x,w,S,C)=>a.Q(function(k,L,N,U,$){const{width:q,height:te}=U.imageManager.getPixelSize(L),ne=Math.pow(2,$.tileID.overscaledZ),ie=$.tileSize*Math.pow(2,U.transform.tileZoom)/ne,ae=ie*($.tileID.canonical.x+$.tileID.wrap*ne),ve=ie*$.tileID.canonical.y;return{u_image:0,u_pattern_tl:N.tl,u_pattern_br:N.br,u_texsize:[q,te],u_pattern_size:N.displaySize,u_tile_units_to_pixels:1/a.bD($,1,U.transform.tileZoom),u_pixel_coord_upper:[ae>>16,ve>>16],u_pixel_coord_lower:[65535&ae,65535&ve]}}(0,w,S,_,C),{u_matrix:g,u_emissive_strength:l,u_opacity:d}),xa=new Float32Array(a.ae.identity([])),Uu=(g,l,d,_,x,w,S,C,k,L,N,U,$,q=[0,0,0],te)=>{const ne=x.style.light,ie=ne.properties.get("position"),ae=[-ie.x,-ie.y,ie.z],ve=a.bE.create();ne.properties.get("anchor")==="viewport"&&(a.bE.fromRotation(ve,-x.transform.angle),a.$.transformMat3(ae,ae,ve));const xe=N.alphaMode==="MASK",ye=ne.properties.get("color").toRenderColor(null),Me=$.paint.get("model-ambient-occlusion-intensity"),Se=$.paint.get("model-color").constantOr(a.C.white).toRenderColor(null),Ie=$.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:g,u_lighting_matrix:l,u_normal_matrix:d,u_node_matrix:_||xa,u_lightpos:ae,u_lightintensity:ne.properties.get("intensity"),u_lightcolor:[ye.r,ye.g,ye.b],u_camera_pos:q,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+xe,u_alphaCutoff:N.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[C[0],C[1],C[2],1],u_metallicFactor:k,u_roughnessFactor:L,u_baseColorTexture:Ts.BaseColor,u_metallicRoughnessTexture:Ts.MetallicRoughness,u_normalTexture:Ts.Normal,u_occlusionTexture:Ts.Occlusion,u_emissionTexture:Ts.Emission,u_lutTexture:Ts.LUT,u_color_mix:[Se.r,Se.g,Se.b,Ie],u_aoIntensity:Me,u_emissive_strength:U,u_occlusionTextureTransform:te||[0,0,0,0]}},by=(g,l=xa,d=xa)=>({u_matrix:g,u_instance:l,u_node_matrix:d}),w1={fillExtrusion:g=>({u_matrix:new a.a7(g),u_lightpos:new a.ar(g),u_lightintensity:new a.ab(g),u_lightcolor:new a.ar(g),u_vertical_gradient:new a.ab(g),u_opacity:new a.ab(g),u_edge_radius:new a.ab(g),u_alignment:new a.ab(g),u_width_scale:new a.ab(g),u_ao:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_up_dir:new a.ar(g),u_height_lift:new a.ab(g),u_flood_light_color:new a.ar(g),u_vertical_scale:new a.ab(g),u_flood_light_intensity:new a.ab(g),u_ground_shadow_factor:new a.ar(g),u_emissive_strength:new a.ab(g)}),fillExtrusionDepth:g=>({u_matrix:new a.a7(g),u_edge_radius:new a.ab(g),u_alignment:new a.ab(g),u_width_scale:new a.ab(g),u_vertical_scale:new a.ab(g)}),fillExtrusionPattern:g=>({u_matrix:new a.a7(g),u_lightpos:new a.ar(g),u_lightintensity:new a.ab(g),u_lightcolor:new a.ar(g),u_vertical_gradient:new a.ab(g),u_height_factor:new a.ab(g),u_edge_radius:new a.ab(g),u_alignment:new a.ab(g),u_width_scale:new a.ab(g),u_ao:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_up_dir:new a.ar(g),u_height_lift:new a.ab(g),u_image:new a.a8(g),u_texsize:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g),u_opacity:new a.ab(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new a.a7(g),u_opacity:new a.ab(g),u_ao_pass:new a.ab(g),u_meter_to_tile:new a.ab(g),u_ao:new a.a9(g),u_flood_light_intensity:new a.ab(g),u_flood_light_color:new a.ar(g),u_attenuation:new a.ab(g),u_edge_radius:new a.ab(g),u_fb:new a.a8(g),u_fb_size:new a.ab(g)}),fill:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g)}),fillPattern:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_image:new a.a8(g),u_texsize:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g)}),fillOutline:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_world:new a.a9(g)}),fillOutlinePattern:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_world:new a.a9(g),u_image:new a.a8(g),u_texsize:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g)}),circle:a.bK,collisionBox:g=>({u_matrix:new a.a7(g),u_camera_to_center_distance:new a.ab(g),u_extrude_scale:new a.a9(g)}),collisionCircle:g=>({u_matrix:new a.a7(g),u_inv_matrix:new a.a7(g),u_camera_to_center_distance:new a.ab(g),u_viewport_size:new a.a9(g)}),debug:g=>({u_color:new a.aa(g),u_matrix:new a.a7(g),u_overlay:new a.a8(g),u_overlay_scale:new a.ab(g)}),clippingMask:g=>({u_matrix:new a.a7(g)}),heatmap:g=>({u_extrude_scale:new a.ab(g),u_intensity:new a.ab(g),u_matrix:new a.a7(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_up_dir:new a.ar(g)}),heatmapTexture:g=>({u_image:new a.a8(g),u_color_ramp:new a.a8(g),u_opacity:new a.ab(g)}),hillshade:g=>({u_matrix:new a.a7(g),u_image:new a.a8(g),u_latrange:new a.a9(g),u_light:new a.a9(g),u_shadow:new a.aa(g),u_highlight:new a.aa(g),u_emissive_strength:new a.ab(g),u_accent:new a.aa(g)}),hillshadePrepare:g=>({u_matrix:new a.a7(g),u_image:new a.a8(g),u_dimension:new a.a9(g),u_zoom:new a.ab(g)}),line:a.bL,linePattern:a.bM,raster:g=>({u_matrix:new a.a7(g),u_normalize_matrix:new a.a7(g),u_globe_matrix:new a.a7(g),u_merc_matrix:new a.a7(g),u_grid_matrix:new a.as(g),u_tl_parent:new a.a9(g),u_scale_parent:new a.ab(g),u_fade_t:new a.ab(g),u_opacity:new a.ab(g),u_image0:new a.a8(g),u_image1:new a.a8(g),u_brightness_low:new a.ab(g),u_brightness_high:new a.ab(g),u_saturation_factor:new a.ab(g),u_contrast_factor:new a.ab(g),u_spin_weights:new a.ar(g),u_perspective_transform:new a.a9(g),u_raster_elevation:new a.ab(g),u_zoom_transition:new a.ab(g),u_merc_center:new a.a9(g),u_cutoff_params:new a.at(g),u_colorization_mix:new a.at(g),u_colorization_offset:new a.ab(g),u_color_ramp:new a.a8(g),u_texture_offset:new a.a9(g),u_texture_res:new a.a9(g),u_emissive_strength:new a.ab(g)}),rasterParticle:g=>({u_matrix:new a.a7(g),u_normalize_matrix:new a.a7(g),u_globe_matrix:new a.a7(g),u_merc_matrix:new a.a7(g),u_grid_matrix:new a.as(g),u_tl_parent:new a.a9(g),u_scale_parent:new a.ab(g),u_fade_t:new a.ab(g),u_opacity:new a.ab(g),u_image0:new a.a8(g),u_image1:new a.a8(g),u_raster_elevation:new a.ab(g),u_zoom_transition:new a.ab(g),u_merc_center:new a.a9(g),u_cutoff_params:new a.at(g)}),rasterParticleTexture:g=>({u_texture:new a.a8(g),u_opacity:new a.ab(g)}),rasterParticleDraw:g=>({u_particle_texture:new a.a8(g),u_particle_texture_side_len:new a.ab(g),u_tile_offset:new a.a9(g),u_velocity:new a.a8(g),u_color_ramp:new a.a8(g),u_velocity_res:new a.a9(g),u_max_speed:new a.ab(g),u_uv_offset:new a.a9(g),u_data_scale:new a.a9(g),u_data_offset:new a.ab(g),u_particle_pos_scale:new a.ab(g),u_particle_pos_offset:new a.a9(g)}),rasterParticleUpdate:g=>({u_particle_texture:new a.a8(g),u_particle_texture_side_len:new a.ab(g),u_velocity:new a.a8(g),u_velocity_res:new a.a9(g),u_max_speed:new a.ab(g),u_speed_factor:new a.ab(g),u_reset_rate:new a.ab(g),u_rand_seed:new a.ab(g),u_uv_offset:new a.a9(g),u_data_scale:new a.a9(g),u_data_offset:new a.ab(g),u_particle_pos_scale:new a.ab(g),u_particle_pos_offset:new a.a9(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new a.a8(g),u_is_size_feature_constant:new a.a8(g),u_size_t:new a.ab(g),u_size:new a.ab(g),u_camera_to_center_distance:new a.ab(g),u_rotate_symbol:new a.a8(g),u_aspect_ratio:new a.ab(g),u_fade_change:new a.ab(g),u_matrix:new a.a7(g),u_label_plane_matrix:new a.a7(g),u_coord_matrix:new a.a7(g),u_is_text:new a.a8(g),u_pitch_with_map:new a.a8(g),u_texsize:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_camera_forward:new a.ar(g),u_tile_matrix:new a.a7(g),u_up_vector:new a.ar(g),u_ecef_origin:new a.ar(g),u_texture:new a.a8(g),u_icon_transition:new a.ab(g),u_color_adj_mat:new a.a7(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new a.a8(g),u_is_size_feature_constant:new a.a8(g),u_size_t:new a.ab(g),u_size:new a.ab(g),u_camera_to_center_distance:new a.ab(g),u_rotate_symbol:new a.a8(g),u_aspect_ratio:new a.ab(g),u_fade_change:new a.ab(g),u_matrix:new a.a7(g),u_label_plane_matrix:new a.a7(g),u_coord_matrix:new a.a7(g),u_is_text:new a.a8(g),u_pitch_with_map:new a.a8(g),u_texsize:new a.a9(g),u_texture:new a.a8(g),u_gamma_scale:new a.ab(g),u_device_pixel_ratio:new a.ab(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_camera_forward:new a.ar(g),u_tile_matrix:new a.a7(g),u_up_vector:new a.ar(g),u_ecef_origin:new a.ar(g),u_is_halo:new a.a8(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new a.a8(g),u_is_size_feature_constant:new a.a8(g),u_size_t:new a.ab(g),u_size:new a.ab(g),u_camera_to_center_distance:new a.ab(g),u_rotate_symbol:new a.a8(g),u_aspect_ratio:new a.ab(g),u_fade_change:new a.ab(g),u_matrix:new a.a7(g),u_label_plane_matrix:new a.a7(g),u_coord_matrix:new a.a7(g),u_is_text:new a.a8(g),u_pitch_with_map:new a.a8(g),u_texsize:new a.a9(g),u_texsize_icon:new a.a9(g),u_texture:new a.a8(g),u_texture_icon:new a.a8(g),u_gamma_scale:new a.ab(g),u_device_pixel_ratio:new a.ab(g),u_is_halo:new a.a8(g)}),background:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_opacity:new a.ab(g),u_color:new a.aa(g)}),backgroundPattern:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_opacity:new a.ab(g),u_image:new a.a8(g),u_pattern_tl:new a.a9(g),u_pattern_br:new a.a9(g),u_texsize:new a.a9(g),u_pattern_size:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g)}),terrainRaster:g=>({u_matrix:new a.a7(g),u_image0:new a.a8(g),u_skirt_height:new a.ab(g),u_ground_shadow_factor:new a.ar(g)}),skybox:g=>({u_matrix:new a.a7(g),u_sun_direction:new a.ar(g),u_cubemap:new a.a8(g),u_opacity:new a.ab(g),u_temporal_offset:new a.ab(g)}),skyboxGradient:g=>({u_matrix:new a.a7(g),u_color_ramp:new a.a8(g),u_center_direction:new a.ar(g),u_radius:new a.ab(g),u_opacity:new a.ab(g),u_temporal_offset:new a.ab(g)}),skyboxCapture:g=>({u_matrix_3f:new a.as(g),u_sun_direction:new a.ar(g),u_sun_intensity:new a.ab(g),u_color_tint_r:new a.at(g),u_color_tint_m:new a.at(g),u_luminance:new a.ab(g)}),globeRaster:g=>({u_proj_matrix:new a.a7(g),u_globe_matrix:new a.a7(g),u_normalize_matrix:new a.a7(g),u_merc_matrix:new a.a7(g),u_zoom_transition:new a.ab(g),u_merc_center:new a.a9(g),u_image0:new a.a8(g),u_grid_matrix:new a.as(g),u_skirt_height:new a.ab(g),u_far_z_cutoff:new a.ab(g),u_frustum_tl:new a.ar(g),u_frustum_tr:new a.ar(g),u_frustum_br:new a.ar(g),u_frustum_bl:new a.ar(g),u_globe_pos:new a.ar(g),u_globe_radius:new a.ab(g),u_viewport:new a.a9(g)}),globeAtmosphere:g=>({u_frustum_tl:new a.ar(g),u_frustum_tr:new a.ar(g),u_frustum_br:new a.ar(g),u_frustum_bl:new a.ar(g),u_horizon:new a.ab(g),u_transition:new a.ab(g),u_fadeout_range:new a.ab(g),u_color:new a.at(g),u_high_color:new a.at(g),u_space_color:new a.at(g),u_temporal_offset:new a.ab(g),u_horizon_angle:new a.ab(g)}),model:g=>({u_matrix:new a.a7(g),u_lighting_matrix:new a.a7(g),u_normal_matrix:new a.a7(g),u_node_matrix:new a.a7(g),u_lightpos:new a.ar(g),u_lightintensity:new a.ab(g),u_lightcolor:new a.ar(g),u_camera_pos:new a.ar(g),u_opacity:new a.ab(g),u_baseColorFactor:new a.at(g),u_emissiveFactor:new a.at(g),u_metallicFactor:new a.ab(g),u_roughnessFactor:new a.ab(g),u_baseTextureIsAlpha:new a.a8(g),u_alphaMask:new a.a8(g),u_alphaCutoff:new a.ab(g),u_baseColorTexture:new a.a8(g),u_metallicRoughnessTexture:new a.a8(g),u_normalTexture:new a.a8(g),u_occlusionTexture:new a.a8(g),u_emissionTexture:new a.a8(g),u_lutTexture:new a.a8(g),u_color_mix:new a.at(g),u_aoIntensity:new a.ab(g),u_emissive_strength:new a.ab(g),u_occlusionTextureTransform:new a.at(g)}),modelDepth:g=>({u_matrix:new a.a7(g),u_instance:new a.a7(g),u_node_matrix:new a.a7(g)}),groundShadow:g=>({u_matrix:new a.a7(g),u_ground_shadow_factor:new a.ar(g)}),stars:g=>({u_matrix:new a.a7(g),u_up:new a.ar(g),u_right:new a.ar(g),u_intensity_multiplier:new a.ab(g)}),occlusion:g=>({u_matrix:new a.a7(g),u_anchorPos:new a.ar(g),u_screenSizePx:new a.a9(g),u_occluderSizePx:new a.a9(g),u_color:new a.at(g)})};function Vu(g,l,d){const _=l.createTileMatrix(g,g.worldSize,d.toUnwrapped());return a.ae.multiply(new Float32Array(16),g.projMatrix,_)}function T1(g,l,d){if(l.projection.name===d.projection.name)return g.projMatrix;const _=d.clone();return _.setProjection(l.projection),Vu(_,l.getProjection(),g)}function wy(g,l,d){return l.name===d.projection.name?g.projMatrix:Vu(d,l,g)}let Jh;function E1(g,l,d,_,x,w,S){const C=g.context,k=C.gl,L=g.transform,N=g.getOrCreateProgram("collisionBox"),U=[];let $=0,q=0;for(let ye=0;ye<_.length;ye++){const Me=_[ye],Se=l.getTile(Me),Ie=Se.getBucket(d);if(!Ie)continue;const Ne=T1(Me,Ie,L);let Fe=Ne;x[0]===0&&x[1]===0||(Fe=g.translatePosMatrix(Ne,Se,x,w));const We=S?Ie.textCollisionBox:Ie.iconCollisionBox,Be=Ie.collisionCircleArray;if(Be.length>0){const Re=a.ae.create(),Je=Fe;a.ae.mul(Re,Ie.placementInvProjMatrix,L.glCoordMatrix),a.ae.mul(Re,Re,Ie.placementViewportMatrix),U.push({circleArray:Be,circleOffset:q,transform:Je,invTransform:Re,projection:Ie.getProjection()}),$+=Be.length/4,q=$}We&&(g.terrain&&g.terrain.setupElevationDraw(Se,N),N.draw(g,k.LINES,a.af.disabled,a.ah.disabled,g.colorModeForRenderPass(),a.ag.disabled,Yh(Fe,L,Se,Ie.getProjection()),d.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,L.zoom,null,[We.collisionVertexBuffer,We.collisionVertexBufferExt]))}if(!S||!U.length)return;const te=g.getOrCreateProgram("collisionCircle"),ne=new a.bN;ne.resize(4*$),ne._trim();let ie=0;for(const ye of U)for(let Me=0;Me<ye.circleArray.length/4;Me++){const Se=4*Me,Ie=ye.circleArray[Se+0],Ne=ye.circleArray[Se+1],Fe=ye.circleArray[Se+2],We=ye.circleArray[Se+3];ne.emplace(ie++,Ie,Ne,Fe,We,0),ne.emplace(ie++,Ie,Ne,Fe,We,1),ne.emplace(ie++,Ie,Ne,Fe,We,2),ne.emplace(ie++,Ie,Ne,Fe,We,3)}(!Jh||Jh.length<2*$)&&(Jh=function(ye){const Me=2*ye,Se=new a.bw;Se.resize(Me),Se._trim();for(let Ie=0;Ie<Me;Ie++){const Ne=6*Ie;Se.uint16[Ne+0]=4*Ie+0,Se.uint16[Ne+1]=4*Ie+1,Se.uint16[Ne+2]=4*Ie+2,Se.uint16[Ne+3]=4*Ie+2,Se.uint16[Ne+4]=4*Ie+3,Se.uint16[Ne+5]=4*Ie+0}return Se}($));const ae=C.createIndexBuffer(Jh,!0),ve=C.createVertexBuffer(ne,a.bO.members,!0);for(const ye of U){const Me={u_matrix:ye.transform,u_inv_matrix:ye.invTransform,u_camera_to_center_distance:(xe=L).getCameraToCenterDistance(ye.projection),u_viewport_size:[xe.width,xe.height]};te.draw(g,k.TRIANGLES,a.af.disabled,a.ah.disabled,g.colorModeForRenderPass(),a.ag.disabled,Me,d.id,ve,ae,a.b.simpleSegment(0,2*ye.circleOffset,ye.circleArray.length,ye.circleArray.length/2),null,L.zoom)}var xe;ve.destroy(),ae.destroy()}const zf=a.ae.create();function S1(g){const l=g._camera.getWorldToCamera(g.worldSize,1),d=a.ae.multiply([],l,g.globeMatrix);a.ae.invert(d,d);const _=[0,0,0],x=[0,1,0,0];return a.aB.transformMat4(x,x,d),_[0]=x[0],_[1]=x[1],_[2]=x[2],a.$.normalize(_,_),_}function I1({width:g,height:l,anchor:d,textOffset:_,textScale:x},w){const{horizontalAlign:S,verticalAlign:C}=a.bS(d),k=-(S-.5)*g,L=-(C-.5)*l,N=a.bR(d,_);return new a.P((k/x+N[0])*w,(L/x+N[1])*w)}function UI(g,l,d,_,x,w,S,C,k,L,N){const U=g.text.placedSymbolArray,$=g.text.dynamicLayoutVertexArray,q=g.icon.dynamicLayoutVertexArray,te={},ne=g.getProjection(),ie=wy(C,ne,w),ae=w.elevation,ve=ne.upVectorScale(C.canonical,w.center.lat,w.worldSize).metersToTile;$.clear();for(let xe=0;xe<U.length;xe++){const ye=U.get(xe),{tileAnchorX:Me,tileAnchorY:Se,numGlyphs:Ie}=ye,Ne=ye.hidden||!ye.crossTileID||g.allowVerticalPlacement&&!ye.placedOrientation?null:_[ye.crossTileID];if(Ne){let Fe=0,We=0,Be=0;if(ae){const Ue=ae?ae.getAtTileOffset(C,Me,Se):0,[ft,gt,Ut]=ne.upVector(C.canonical,Me,Se);Fe=Ue*ft*ve,We=Ue*gt*ve,Be=Ue*Ut*ve}let[Re,Je,Ye,je]=co(ye.projectedAnchorX+Fe,ye.projectedAnchorY+We,ye.projectedAnchorZ+Be,d?ie:S);const vt=Gn(w.getCameraToCenterDistance(ne),je);let dt=x.evaluateSizeForFeature(g.textSizeData,L,ye)*vt/a.bP;d&&(dt*=g.tilePixelRatio/k);const He=I1(Ne,dt);d?({x:Re,y:Je,z:Ye}=ne.projectTilePoint(Me+He.x,Se+He.y,C.canonical),[Re,Je,Ye]=co(Re+Fe,Je+We,Ye+Be,S)):(l&&He._rotate(-w.angle),Re+=He.x,Je+=He.y,Ye=0);const it=g.allowVerticalPlacement&&ye.placedOrientation===a.aF.vertical?Math.PI/2:0;for(let Ue=0;Ue<Ie;Ue++)a.aI($,Re,Je,Ye,it);N&&ye.associatedIconIndex>=0&&(te[ye.associatedIconIndex]={x:Re,y:Je,z:Ye,angle:it})}else va(Ie,$)}if(N){q.clear();const xe=g.icon.placedSymbolArray;for(let ye=0;ye<xe.length;ye++){const Me=xe.get(ye),{numGlyphs:Se}=Me,Ie=te[ye];if(Me.hidden||!Ie)va(Se,q);else{const{x:Ne,y:Fe,z:We,angle:Be}=Ie;for(let Re=0;Re<Se;Re++)a.aI(q,Ne,Fe,We,Be)}}g.icon.dynamicLayoutVertexBuffer.updateData(q)}g.text.dynamicLayoutVertexBuffer.updateData($)}function Nf(g,l,d,_,x,w,S={}){const C=d.paint.get("icon-translate"),k=d.paint.get("text-translate"),L=d.paint.get("icon-translate-anchor"),N=d.paint.get("text-translate-anchor"),U=d.layout.get("icon-rotation-alignment"),$=d.layout.get("text-rotation-alignment"),q=d.layout.get("icon-pitch-alignment"),te=d.layout.get("text-pitch-alignment"),ne=d.layout.get("icon-keep-upright"),ie=d.layout.get("text-keep-upright"),ae=d.paint.get("icon-color-saturation"),ve=d.paint.get("icon-color-contrast"),xe=d.paint.get("icon-color-brightness-min"),ye=d.paint.get("icon-color-brightness-max");d.paint.get("icon-occlusion-opacity").constantOr(0),d.paint.get("text-occlusion-opacity").constantOr(0);const Me=g.context,Se=Me.gl,Ie=g.transform,Ne=U==="map",Fe=$==="map",We=q==="map",Be=te==="map",Re=d.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Je=!1;const Ye=g.depthModeForSublayer(0,a.af.ReadOnly),je=[a.ak(Ie.center.lng),a.al(Ie.center.lat)],vt=d.layout.get("text-variable-anchor"),dt=Ie.projection.name==="globe",He=[],it=[0,-1,0];for(const Ue of _){const ft=l.getTile(Ue),gt=ft.getBucket(d);if(!gt||gt.projection.name==="mercator"&&dt||gt.fullyClipped)continue;const Ut=gt.projection.name==="globe",$t=Ut?a.a2(Ie.zoom):0,tn=wy(Ue,gt.getProjection(),Ie),qt=Ie.calculatePixelsToTileUnitsMatrix(ft),bn=vt&&gt.hasTextData(),Fn=gt.hasIconTextFit()&&bn&&gt.hasIconData(),Tn=gt.getProjection().createInversionMatrix(Ie,Ue.canonical),jn=mr=>{Ie.depthOcclusionForSymbolsAndCircles&&(d.hasInitialOcclusionOpacityProperties||g.terrain)&&(mr.push("DEPTH_D24"),mr.push("DEPTH_OCCLUSION"))},or=()=>{const mr=Ne&&d.layout.get("symbol-placement")!=="point",Jn=[];jn(Jn);const An=mr||Fn,Fi=d.paint.get("icon-image-cross-fade").constantOr(0);g.terrainRenderModeElevated()&&We&&Jn.push("PITCH_WITH_MAP_TERRAIN"),Ut&&(Jn.push("PROJECTION_GLOBE_VIEW"),An&&Jn.push("PROJECTED_POS_ON_VIEWPORT")),Fi>0&&Jn.push("ICON_TRANSITION"),gt.icon.zOffsetVertexBuffer&&Jn.push("Z_OFFSET"),ae===0&&ve===0&&xe===0&&ye===1||Jn.push("COLOR_ADJUSTMENT");const Bi=gt.icon.programConfigurations.get(d.id),Qs=g.getOrCreateProgram(gt.sdfIcons?"symbolSDF":"symbolIcon",{config:Bi,defines:Jn});let Js;const Bs=ft.imageAtlasTexture?ft.imageAtlasTexture.size:[0,0],eo=gt.iconSizeData,Ms=a.aE(eo,Ie.zoom),Us=We||Ie.pitch!==0,It=Fc(tn,ft.tileID.canonical,We,Ne,Ie,gt.getProjection(),qt),sn=zu(tn,ft.tileID.canonical,We,Ne,Ie,gt.getProjection(),qt),ho=g.translatePosMatrix(sn,ft,C,L,!0),jr=g.translatePosMatrix(tn,ft,C,L),Qe=An?zf:It,sc=Ne&&!We&&!mr;let Wa=it;!dt&&!Ie.mercatorFromTransition||Ne||(Wa=S1(Ie));const oc=Ut?Wa:it;if(gt.sdfIcons&&!gt.iconsInText)Js=Lf(eo.kind,Ms,sc,We,g,jr,Qe,ho,!1,Bs,!0,Ue,$t,je,Tn,oc,gt.getProjection());else{const Ku=d.getColorAdjustmentMatrix(ae,ve,xe,ye);Js=Qh(eo.kind,Ms,sc,We,g,jr,Qe,ho,!1,Bs,Ue,$t,je,Tn,oc,gt.getProjection(),Ku,Fi)}const ac=ft.imageAtlasTexture?ft.imageAtlasTexture:null,eg=d.layout.get("icon-size").constantOr(0)!==1||gt.iconsNeedLinear,tg=gt.sdfIcons||g.options.rotating||g.options.zooming||eg||Us?Se.LINEAR:Se.NEAREST,Xc=gt.sdfIcons&&d.paint.get("icon-halo-width").constantOr(1)!==0,Zy=g.terrain&&We&&mr?a.ae.invert(a.ae.create(),It):zf;if(mr&&gt.icon){const Ku=Ie.elevation,ng=Ku?Ku.getAtTileOffsetFunc(Ue,Ie.center.lat,Ie.worldSize,gt.getProjection()):null,hd=Lu(tn,ft.tileID.canonical,We,Ne,Ie,gt.getProjection(),qt);Zl(gt,tn,g,!1,hd,sn,We,ne,ng,Ue)}return{program:Qs,buffers:gt.icon,uniformValues:Js,atlasTexture:ac,atlasTextureIcon:null,atlasInterpolation:tg,atlasInterpolationIcon:null,isSDF:gt.sdfIcons,hasHalo:Xc,tile:ft,labelPlaneMatrixInv:Zy}},Zr=()=>{const mr=Fe&&d.layout.get("symbol-placement")!=="point",Jn=[],An=mr||vt||Fn;g.terrainRenderModeElevated()&&Be&&Jn.push("PITCH_WITH_MAP_TERRAIN"),Ut&&(Jn.push("PROJECTION_GLOBE_VIEW"),An&&Jn.push("PROJECTED_POS_ON_VIEWPORT")),gt.text.zOffsetVertexBuffer&&Jn.push("Z_OFFSET"),jn(Jn);const Fi=gt.text.programConfigurations.get(d.id),Bi=g.getOrCreateProgram(gt.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Fi,defines:Jn});let Qs,Js=[0,0],Bs=null;const eo=gt.textSizeData;gt.iconsInText&&(Js=ft.imageAtlasTexture?ft.imageAtlasTexture.size:[0,0],Bs=ft.imageAtlasTexture?ft.imageAtlasTexture:null,Qs=Be||Ie.pitch!==0||g.options.rotating||g.options.zooming||eo.kind==="composite"||eo.kind==="camera"?Se.LINEAR:Se.NEAREST);const Ms=ft.glyphAtlasTexture?ft.glyphAtlasTexture.size:[0,0],Us=a.aE(eo,Ie.zoom),It=Fc(tn,ft.tileID.canonical,Be,Fe,Ie,gt.getProjection(),qt),sn=zu(tn,ft.tileID.canonical,Be,Fe,Ie,gt.getProjection(),qt),ho=g.translatePosMatrix(sn,ft,k,N,!0),jr=g.translatePosMatrix(tn,ft,k,N),Qe=An?zf:It,sc=Fe&&!Be&&!mr;let Wa=it;!dt&&!Ie.mercatorFromTransition||Fe||(Wa=S1(Ie));const oc=Ut?Wa:it;let ac;ac=gt.iconsInText?vy(eo.kind,Us,sc,Be,g,jr,Qe,ho,Ms,Js,Ue,$t,je,Tn,oc,gt.getProjection()):Lf(eo.kind,Us,sc,Be,g,jr,Qe,ho,!0,Ms,!0,Ue,$t,je,Tn,oc,gt.getProjection());const eg=ft.glyphAtlasTexture?ft.glyphAtlasTexture:null,tg=Se.LINEAR,Xc=d.paint.get("text-halo-width").constantOr(1)!==0,Zy=g.terrain&&Be&&mr?a.ae.invert(a.ae.create(),It):zf;if(mr&&gt.text){const Ku=Ie.elevation,ng=Ku?Ku.getAtTileOffsetFunc(Ue,Ie.center.lat,Ie.worldSize,gt.getProjection()):null,hd=Lu(tn,ft.tileID.canonical,Be,Fe,Ie,gt.getProjection(),qt);Zl(gt,tn,g,!0,hd,sn,Be,ie,ng,Ue)}return{program:Bi,buffers:gt.text,uniformValues:ac,atlasTexture:eg,atlasTextureIcon:Bs,atlasInterpolation:tg,atlasInterpolationIcon:Qs,isSDF:!0,hasHalo:Xc,tile:ft,labelPlaneMatrixInv:Zy}},zr=gt.icon.segments.get().length,cr=gt.text.segments.get().length,Or=zr&&!S.onlyText?or():null,qn=cr&&!S.onlyIcons?Zr():null,Xn=d.paint.get("icon-opacity").constantOr(1),Bn=d.paint.get("text-opacity").constantOr(1);if(Re&&gt.canOverlap){Je=!0;const mr=Xn&&!S.onlyText?gt.icon.segments.get():[],Jn=Bn&&!S.onlyIcons?gt.text.segments.get():[];for(const An of mr)He.push({segments:new a.b([An]),sortKey:An.sortKey,state:Or});for(const An of Jn)He.push({segments:new a.b([An]),sortKey:An.sortKey,state:qn})}else S.onlyText||He.push({segments:Xn?gt.icon.segments:new a.b([]),sortKey:0,state:Or}),S.onlyIcons||He.push({segments:Bn?gt.text.segments:new a.b([]),sortKey:0,state:qn})}Je&&He.sort((Ue,ft)=>Ue.sortKey-ft.sortKey);for(const Ue of He){const ft=Ue.state;if(ft)if(g.terrain?g.terrain.setupElevationDraw(ft.tile,ft.program,{useDepthForOcclusion:Ie.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ft.labelPlaneMatrixInv}):g.setupDepthForOcclusion(Ie.depthOcclusionForSymbolsAndCircles,ft.program),Me.activeTexture.set(Se.TEXTURE0),ft.atlasTexture&&ft.atlasTexture.bind(ft.atlasInterpolation,Se.CLAMP_TO_EDGE,!0),ft.atlasTextureIcon&&(Me.activeTexture.set(Se.TEXTURE1),ft.atlasTextureIcon&&ft.atlasTextureIcon.bind(ft.atlasInterpolationIcon,Se.CLAMP_TO_EDGE,!0)),g.uploadCommonLightUniforms(g.context,ft.program),ft.hasHalo){const gt=ft.uniformValues;gt.u_is_halo=1,Ty(ft.buffers,Ue.segments,d,g,ft.program,Ye,x,w,gt,2),gt.u_is_halo=0}else{if(ft.isSDF){const gt=ft.uniformValues;ft.hasHalo&&(gt.u_is_halo=1,Ty(ft.buffers,Ue.segments,d,g,ft.program,Ye,x,w,gt,1)),gt.u_is_halo=0}Ty(ft.buffers,Ue.segments,d,g,ft.program,Ye,x,w,ft.uniformValues,1)}}}function Ty(g,l,d,_,x,w,S,C,k,L){const N=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer];x.draw(_,_.context.gl.TRIANGLES,w,S,C,a.ag.disabled,k,d.id,g.layoutVertexBuffer,g.indexBuffer,l,d.paint,_.transform.zoom,g.programConfigurations.get(d.id),N,L)}function Ff(g,l,d,_,x,w,S){const C=g.context.gl,k=d.paint.get("fill-pattern"),L=k&&k.constantOr(1);let N,U,$,q,te;S?(U=L&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=C.LINES):(U=L?"fillPattern":"fill",N=C.TRIANGLES);for(const ne of _){const ie=l.getTile(ne);if(L&&!ie.patternsLoaded())continue;const ae=ie.getBucket(d);if(!ae)continue;g.prepareDrawTile();const ve=ae.programConfigurations.get(d.id),xe=g.isTileAffectedByFog(ne),ye=g.getOrCreateProgram(U,{config:ve,overrideFog:xe});L&&(g.context.activeTexture.set(C.TEXTURE0),ie.imageAtlasTexture&&ie.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ve.updatePaintBuffers());const Me=k.constantOr(null);if(Me&&ie.imageAtlas){const Ne=ie.imageAtlas.patternPositions[Me.toString()];Ne&&ve.setConstantPatternPositions(Ne)}const Se=g.translatePosMatrix(ne.projMatrix,ie,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor")),Ie=d.paint.get("fill-emissive-strength");if(S){q=ae.indexBuffer2,te=ae.segments2;const Ne=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];$=U==="fillOutlinePattern"&&L?kf(Se,Ie,g,ie,Ne):Am(Se,Ie,Ne)}else q=ae.indexBuffer,te=ae.segments,$=L?Im(Se,Ie,g,ie):Mf(Se,Ie);g.uploadCommonUniforms(g.context,ye,ne.toUnwrapped()),ye.draw(g,N,x,g.stencilModeForClipping(ne),w,a.ag.disabled,$,d.id,ae.layoutVertexBuffer,q,te,d.paint,g.transform.zoom,ve,void 0)}}function ju(g,l,d,_,x,w,S,C){d.resetLayerRenderingStats(g);const k=g.context,L=k.gl,N=g.transform,U=d.paint.get("fill-extrusion-pattern"),$=U.constantOr(1),q=d.paint.get("fill-extrusion-opacity"),te=g.style.enable3dLights(),ne=d.paint.get(te&&!$?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ie=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),ne],ae=d.layout.get("fill-extrusion-edge-radius"),ve=ae>0&&!d.paint.get("fill-extrusion-rounded-roof"),xe=ve?0:ae,ye=N.projection.name==="globe"?a.b_():0,Me=N.projection.name==="globe",Se=Me?a.a2(N.zoom):0,Ie=[a.ak(N.center.lng),a.al(N.center.lat)],Ne=d.paint.get("fill-extrusion-flood-light-color").toRenderColor(d.lut).toArray01().slice(0,3),Fe=d.paint.get("fill-extrusion-flood-light-intensity"),We=d.paint.get("fill-extrusion-vertical-scale"),Be=d.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Re=Rs(g,d.paint.get("fill-extrusion-cutoff-fade-range")),Je=d.paint.get("fill-extrusion-emissive-strength"),Ye=[];Me&&Ye.push("PROJECTION_GLOBE_VIEW"),ie[0]>0&&Ye.push("FAUX_AO"),ve&&Ye.push("ZERO_ROOF_RADIUS"),C&&Ye.push("HAS_CENTROID"),Fe>0&&Ye.push("FLOOD_LIGHT"),Re.shouldRenderCutoff&&Ye.push("RENDER_CUTOFF"),Be&&Ye.push("RENDER_WALL_MODE");const je=(()=>{const Ut=d.paint.get("fill-extrusion-line-alignment");switch(Ut){case"inside":return 1;case"outside":return-1;case"center":return 0;default:return a.w(`Unsupported value for fill-extrusion-line-alignment: ${Ut}`),0}})();let vt;const dt=g.renderPass==="shadow",He=g.shadowRenderer,it=dt&&!!He;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let Ue=[0,0,0];if(He){const Ut=g.style.directionalLight,$t=g.style.ambientLight;Ut&&$t&&(Ue=Uc(g.style,Ut,$t)),vt=Ye.concat(["SHADOWS_SINGLE_CASCADE"])}const ft=it?"fillExtrusionDepth":$?"fillExtrusionPattern":"fillExtrusion",gt=d.getLayerRenderingStats();for(const Ut of _){const $t=l.getTile(Ut),tn=$t.getBucket(d);if(!tn||tn.projection.name!==N.projection.name)continue;let qt=!1;He&&(qt=He.getMaxCascadeForTile(Ut.toUnwrapped())===0);const bn=g.isTileAffectedByFog(Ut),Fn=tn.programConfigurations.get(d.id),Tn=g.getOrCreateProgram(ft,{config:Fn,defines:qt?vt:Ye,overrideFog:bn});if(g.terrain&&g.terrain.setupElevationDraw($t,Tn,{useMeterToDem:!0}),!tn.centroidVertexBuffer){const qn=Tn.attributes.a_centroid_pos;qn!==void 0&&L.vertexAttrib2f(qn,0,0)}!dt&&He&&He.setupShadows($t.tileID.toUnwrapped(),Tn,"vector-tile",$t.tileID.overscaledZ),$&&(g.context.activeTexture.set(L.TEXTURE0),$t.imageAtlasTexture&&$t.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Fn.updatePaintBuffers());const jn=U.constantOr(null);if(jn&&$t.imageAtlas){const qn=$t.imageAtlas.patternPositions[jn.toString()];qn&&Fn.setConstantPatternPositions(qn)}const or=d.paint.get("fill-extrusion-vertical-gradient"),Zr=1/tn.tileToMeter;let zr;if(dt&&He){if(_l($t.tileID,tn,g))continue;const qn=He.calculateShadowPassMatrixFromTile($t.tileID.toUnwrapped());zr=ec(qn,xe,je,Zr,We)}else{const qn=g.translatePosMatrix(Ut.expandedProjMatrix,$t,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Xn=N.projection.createInversionMatrix(N,Ut.canonical);zr=$?Kh(qn,g,or,q,ie,xe,je,Zr,Ut,$t,ye,Se,Ie,Xn,Ne,We):es(qn,g,or,q,ie,xe,je,Zr,Ut,ye,Se,Ie,Xn,Ne,We,Fe,Ue,Je)}g.uploadCommonUniforms(k,Tn,Ut.toUnwrapped(),null,Re);let cr=tn.segments;if(N.projection.name==="mercator"&&!dt&&(cr=tn.getVisibleSegments($t.tileID,g.terrain,g.transform.getFrustum(0)),!cr.get().length))continue;if(gt)if(dt)for(const qn of cr.get())gt.numRenderedVerticesInShadowPass+=qn.primitiveLength;else for(const qn of cr.get())gt.numRenderedVerticesInTransparentPass+=qn.primitiveLength;const Or=[];(g.terrain||C)&&Or.push(tn.centroidVertexBuffer),Me&&Or.push(tn.layoutVertexExtBuffer),Be&&Or.push(tn.wallVertexBuffer),Tn.draw(g,k.gl.TRIANGLES,x,w,S,a.ag.backCCW,zr,d.id,tn.layoutVertexBuffer,tn.indexBuffer,cr,d.paint,g.transform.zoom,Fn,Or)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}function ed(g,l,d,_,x,w,S,C,k,L,N,U,$,q,te,ne,ie,ae,ve){const xe=g.context,ye=xe.gl,Me=g.transform,Se=g.transform.zoom,Ie=[],Ne=Rs(g,d.paint.get("fill-extrusion-cutoff-fade-range"));L==="clear"?(Ie.push("CLEAR_SUBPASS"),ve&&(Ie.push("CLEAR_FROM_TEXTURE"),xe.activeTexture.set(ye.TEXTURE0),ve.bind(ye.LINEAR,ye.CLAMP_TO_EDGE))):L==="sdf"&&Ie.push("SDF_SUBPASS"),ie&&Ie.push("HAS_CENTROID"),Ne.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF");const Fe=d.layout.get("fill-extrusion-edge-radius"),We=(Be,Re,Je,Ye,je)=>{const vt=Re.programConfigurations.get(d.id),dt=g.isTileAffectedByFog(Be),He=g.getOrCreateProgram("fillExtrusionGroundEffect",{config:vt,defines:Ie,overrideFog:dt}),it=((ft,gt,Ut,$t,tn,qt,bn,Fn,Tn,jn,or)=>({u_matrix:gt,u_opacity:Ut,u_ao_pass:$t?1:0,u_meter_to_tile:tn,u_ao:qt,u_flood_light_intensity:bn,u_flood_light_color:Fn,u_attenuation:Tn,u_edge_radius:jn,u_fb:0,u_fb_size:or}))(0,Ye,N,k,je,[U,$*je],q,te,ne,Se>=17?0:Fe*je,ve?ve.size[0]:0),Ue=[];ie&&Ue.push(Re.hiddenByLandmarkVertexBuffer),g.uploadCommonUniforms(xe,He,Be.toUnwrapped(),null,Ne),He.draw(g,xe.gl.TRIANGLES,x,w,S,C,it,d.id,Re.vertexBuffer,Re.indexBuffer,Je,d.paint,Se,vt,Ue)};for(const Be of _){const Re=l.getTile(Be),Je=Re.getBucket(d);if(!Je||Je.projection.name!==Me.projection.name||!Je.groundEffect||Je.groundEffect&&!Je.groundEffect.hasData())continue;const Ye=Je.groundEffect,je=1/Je.tileToMeter;{const vt=g.translatePosMatrix(Be.projMatrix,Re,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),dt=Ye.getDefaultSegment();We(Be,Ye,dt,vt,je)}if(ae)for(let vt=0;vt<4;vt++){const dt=a.b$[vt](Be),He=l.getTile(dt);if(!He)continue;const it=He.getBucket(d);if(!it||it.projection.name!==Me.projection.name||!it.groundEffect||it.groundEffect&&!it.groundEffect.hasData())continue;const Ue=it.groundEffect;let ft,gt;vt===0?(ft=[-a.a4,0,0],gt=1):vt===1?(ft=[a.a4,0,0],gt=0):vt===2?(ft=[0,-a.a4,0],gt=3):(ft=[0,a.a4,0],gt=2);const Ut=Ue.regionSegments[gt];if(!Ut)continue;const $t=new Float32Array(16);a.ae.translate($t,Be.projMatrix,ft),We(Be,Ue,Ut,g.translatePosMatrix($t,Re,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),je)}}}function VI(g,l,d,_,x,w,S){_.centroidVertexArray.length===0&&_.createCentroidsBuffer();const C=w?w.findDEMTileFor(d):null;if(!(C&&C.dem||S))return;const k=ae=>new a.P(Math.ceil((ae+a.c2)*a.c3),0),L=ae=>{const ve=l.getSource().minzoom,xe=Me=>{const Se=l.getTileByID(Me);if(Se&&Se.hasData())return Se.getBucket(x)},ye=[0,-1,1];for(const Me of ye){if(ae.overscaledZ+Me<ve)continue;const Se=xe(ae.calculateScaledKey(ae.overscaledZ+Me));if(Se)return Se}},N=[0,0,0],U=(ae,ve)=>(N[0]=Math.min(ae.min.y,ve.min.y),N[1]=Math.max(ae.max.y,ve.max.y),N[2]=a.a4-ve.min.x>ae.max.x?ve.min.x-a.a4:ae.max.x,N),$=(ae,ve)=>(N[0]=Math.min(ae.min.x,ve.min.x),N[1]=Math.max(ae.max.x,ve.max.x),N[2]=a.a4-ve.min.y>ae.max.y?ve.min.y-a.a4:ae.max.y,N),q=[(ae,ve)=>U(ae,ve),(ae,ve)=>U(ve,ae),(ae,ve)=>$(ae,ve),(ae,ve)=>$(ve,ae)],te=(ae,ve,xe,ye,Me,Se,Ie)=>{if(!w)return 0;const Ne=[[Se?xe:ae,Se?ae:xe,0],[Se?xe:ve,Se?ve:xe,0]],Fe=Ie<0?a.a4+Ie:Ie,We=[Se?Fe:(ae+ve)/2,Se?(ae+ve)/2:Fe,0];return xe===0&&Ie<0||xe!==0&&Ie>0?w.getForTilePoints(Me,[We],!0,ye):Ne.push(We),w.getForTilePoints(d,Ne,!0,C),Math.max(Ne[0][2],Ne[1][2],We[2])/w.exaggeration()};for(let ae=0;ae<4;ae++){const ve=_.borderFeatureIndices[ae];if(ve.length===0)continue;const xe=a.b$[ae](d),ye=L(xe);if(!(ye&&ye instanceof a.c0)||_.borderDoneWithNeighborZ[ae]===ye.canonical.z)continue;ye.centroidVertexArray.length===0&&ye.createCentroidsBuffer();const Me=w?w.findDEMTileFor(xe):null;if(!(Me&&Me.dem||S))continue;const Se=(ae<2?1:5)-ae,Ie=ye.borderDoneWithNeighborZ[Se]!==_.canonical.z,Ne=ye.borderFeatureIndices[Se];let Fe=0;if(_.canonical.z!==ye.canonical.z){for(const We of ve)_.showCentroid(_.featuresOnBorder[We]);if(Ie)for(const We of Ne)ye.showCentroid(ye.featuresOnBorder[We]);_.borderDoneWithNeighborZ[ae]=ye.canonical.z,ye.borderDoneWithNeighborZ[Se]=_.canonical.z}for(const We of ve){const Be=_.featuresOnBorder[We],Re=_.centroidData[Be.centroidDataIndex],Je=Be.borders[ae];let Ye;for(;Fe<Ne.length;){Ye=ye.featuresOnBorder[Ne[Fe]];const je=Ye.borders[Se];if(je[1]>Je[0]+3||je[0]>Je[0]-3)break;ye.showCentroid(Ye),Fe++}if(Ye&&Fe<Ne.length){const je=Fe;let vt=0;for(;!(Ye.borders[Se][0]>Je[1]-3)&&(vt++,++Fe!==Ne.length);)Ye=ye.featuresOnBorder[Ne[Fe]];if(Ye=ye.featuresOnBorder[Ne[je]],vt>1){const it=Ye.borders[Se];Math.abs(Je[0]-it[0])<3&&Math.abs(Je[1]-it[1])<3&&(vt=1,Fe=je+1)}else if(vt===0){_.showCentroid(Be);continue}const dt=ye.centroidData[Ye.centroidDataIndex];S&&vt===1&&(((ne=Re).flags|(ie=dt).flags)&a.c1?(ne.flags|=a.c1,ie.flags|=a.c1):(ne.flags&=~a.c1,ie.flags&=~a.c1));const He=Be.intersectsCount()>1||Ye.intersectsCount()>1;if(vt>1)Fe=je,Re.centroidXY=dt.centroidXY=new a.P(0,0);else if(Me&&Me.dem&&!He){const it=q[ae](Re,dt),Ue=ae%2?a.a4-1:0,ft=te(it[0],Math.min(a.a4-1,it[1]),Ue,Me,xe,ae<2,it[2]);Re.centroidXY=dt.centroidXY=k(ft)}else He?Re.centroidXY=dt.centroidXY=new a.P(0,0):(Re.centroidXY=_.encodeBorderCentroid(Be),dt.centroidXY=ye.encodeBorderCentroid(Ye));_.writeCentroidToBuffer(Re),ye.writeCentroidToBuffer(dt)}else _.showCentroid(Be)}_.borderDoneWithNeighborZ[ae]=ye.canonical.z,ye.borderDoneWithNeighborZ[Se]=_.canonical.z}var ne,ie;(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(g)}const A1=[1,0,0],jI=[0,1,0],Rm=[0,0,1];function _l(g,l,d){const _=d.transform,x=d.shadowRenderer;if(!x)return!0;const w=g.toUnwrapped(),S=_.tileSize*x._cascades[d.currentShadowCascade].scale;let C=l.maxHeight;if(_.elevation){const ne=_.elevation.getMinMaxForTile(g);ne&&(C+=ne.max)}const k=[...x.shadowDirection];k[2]=-k[2];const L=x.computeSimplifiedTileShadowVolume(w,C,S,k);if(!L)return!1;const N=[A1,jI,Rm,k,[k[0],0,k[2]],[0,k[1],k[2]]],U=_.projection.name==="globe",$=_.scaleZoom(S),q=a.aM.fromInvProjectionMatrix(_.invProjMatrix,_.worldSize,$,!U),te=x.getCurrentCascadeFrustum();return q.intersectsPrecise(L.vertices,L.planes,N)===0||te.intersectsPrecise(L.vertices,L.planes,N)===0}function Bf(g){return[g[0]*a.c4,g[1]*a.c4,g[2]*a.c4,0]}function Mm(g,l,d,_,x,w,S,C,k){const L=_.getSource(),N=d.globeSharedBuffers;if(!N)return;let U,$,q;if(l&&(U=_.getTile(l)),L instanceof a.bo?($=L.texture,q=a.bj(0,0,d.transform)):U&&l&&($=U.texture,q=a.bj(l.canonical.z,l.canonical.x,d.transform)),!$||!q)return;g||(q=a.ae.scale(a.ae.create(),q,[1,-1,1]));const te=d.context,ne=te.gl,ie=x.paint.get("raster-resampling")==="nearest"?ne.NEAREST:ne.LINEAR,ae=d.colorModeForDrapableLayerRenderPass(w),ve=S.defines;ve.push("GLOBE_POLES");const xe=new a.af(ne.LEQUAL,a.af.ReadWrite,d.depthRangeFor3D),ye=Float32Array.from(d.transform.expandedFarZProjMatrix),Me=Float32Array.from(a.bh(a.bi(new a.aO(0,0,0))));d.terrain&&d.terrain.prepareDrawTile(),te.activeTexture.set(ne.TEXTURE0),$.bind(ie,ne.CLAMP_TO_EDGE),te.activeTexture.set(ne.TEXTURE1),$.bind(ie,ne.CLAMP_TO_EDGE),$.useMipmap&&te.extTextureFilterAnisotropic&&d.transform.pitch>20&&ne.texParameterf(ne.TEXTURE_2D,te.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,te.extTextureFilterAnisotropicMax);const[Se,Ie,Ne,Fe]=l?N.getPoleBuffers(l.canonical.z,!1):N.getPoleBuffers(0,!0),We=x.paint.get("raster-elevation");let Be;g?(Be=Se,d.renderDefaultNorthPole=We!==0):(Be=Ie,d.renderDefaultSouthPole=We!==0);const Re=Bf(S.mix),Je=((je,vt,dt,He,it,Ue,ft,gt,Ut,$t,tn,qt,bn)=>Pm(je,vt,dt,new Float32Array(16),new Float32Array(9),[0,0],He,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ue,[0,0],gt,2,$t,tn,qt,1,0,bn))(ye,Me,q,a.a2(d.transform.zoom),0,x,0,We,0,Re,S.offset,S.range,w),Ye=d.getOrCreateProgram("raster",{defines:ve});d.uploadCommonUniforms(te,Ye,null),Ye.draw(d,ne.TRIANGLES,xe,k,ae,C,Je,x.id,Be,Ne,Fe)}function Ey(g){const l=g._nearZ,d=g.projection.farthestPixelDistance(g),_=d-l,x=.2*g.height,w=l+x;return[l,d,(w-x-l)/_,(w-l)/_]}function $u(g,l,d,_){if(g)return l instanceof R&&g instanceof a.c5?l.getTextureDescriptor(g,d,!0):{texture:g.texture,mix:Bf(_.mix),offset:_.offset,buffer:0,tileSize:1}}function C1(g,l,d){if(!g)return null;const _=l.getTextureDescriptor(g,d,!0);if(!_)return null;let{texture:x,mix:w,offset:S,tileSize:C,buffer:k,format:L}=_;if(!x||!L)return null;let N=!1;return L==="uint32"&&(N=!0,w[3]=0,w=_y(a.c6,w,[0,d.paint.get("raster-particle-max-speed")]),S=Df(a.c6,S,[0,d.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[k/(C+2*k),C/(C+2*k)],tileSize:C,scalarData:N,scale:w,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function km(g){const l=g._nearZ,d=g.projection.farthestPixelDistance(g),_=d-l,x=.2*g.height,w=l+x;return[l,d,(w-x-l)/_,(w-l)/_]}const Sy=new a.C(1,0,0,1),Dm=new a.C(0,1,0,1),Iy=new a.C(0,0,1,1),wr=new a.C(1,0,1,1),$I=new a.C(0,1,1,1);function wn(g,l,d,_,x,w,S){const C=g.context,k=g.transform,L=C.gl,N=k.projection.name==="globe",U=N?["PROJECTION_GLOBE_VIEW"]:[];let $=a.ae.clone(d.projMatrix);if(N&&a.a2(k.zoom)>0){const Re=a.c7(d.canonical,k),Je=a.c8(Re);$=a.ae.multiply(new Float32Array(16),k.globeMatrix,Je),a.ae.multiply($,k.projMatrix,$)}const q=a.ae.create();q[12]+=2*x/(a.e.devicePixelRatio*k.width),q[13]+=2*w/(a.e.devicePixelRatio*k.height),a.ae.multiply($,q,$);const te=g.getOrCreateProgram("debug",{defines:U}),ne=l.getTileByID(d.key);g.terrain&&g.terrain.setupElevationDraw(ne,te);const ie=a.af.disabled,ae=a.ah.disabled,ve=g.colorModeForRenderPass(),xe="$debug";C.activeTexture.set(L.TEXTURE0),g.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),N?ne._makeGlobeTileDebugBuffers(g.context,k):ne._makeDebugTileBoundsBuffers(g.context,k.projection);const ye=ne._tileDebugBuffer||g.debugBuffer,Me=ne._tileDebugIndexBuffer||g.debugIndexBuffer,Se=ne._tileDebugSegments||g.debugSegments;if(te.draw(g,L.LINE_STRIP,ie,ae,ve,a.ag.disabled,Cm($,_),xe,ye,Me,Se,null,null,null,[ne._globeTileDebugBorderBuffer]),S){const Re=ne.latestRawTileData,Je=Math.floor((Re&&Re.byteLength||0)/1024);let Ye=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Ye+=` => ${d.overscaledZ}`),Ye+=` ${ne.state}`,Ye+=` ${Je}kb`,function(je,vt){je.initDebugOverlayCanvas();const dt=je.debugOverlayCanvas,He=je.context.gl,it=je.debugOverlayCanvas.getContext("2d");it.clearRect(0,0,dt.width,dt.height),it.shadowColor="white",it.shadowBlur=2,it.lineWidth=1.5,it.strokeStyle="white",it.textBaseline="top",it.font="bold 36px Open Sans, sans-serif",it.fillText(vt,5,5),it.strokeText(vt,5,5),je.debugOverlayTexture.update(dt),je.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)}(g,Ye)}const Ie=l.getTile(d).tileSize,Ne=512/Math.min(Ie,512)*(d.overscaledZ/k.zoom)*.5,Fe=ne._tileDebugTextBuffer||g.debugBuffer,We=ne._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,Be=ne._tileDebugTextSegments||g.debugSegments;te.draw(g,L.TRIANGLES,ie,ae,a.a.alphaBlended,a.ag.disabled,Cm($,a.C.transparent,Ne),xe,Fe,We,Be,null,null,null,[ne._globeTileDebugTextBuffer])}function Ay(g,l,d,_){td(g,0,l+d/2,g.transform.width,d,_)}function Uf(g,l,d,_){td(g,l-d/2,0,d,g.transform.height,_)}function td(g,l,d,_,x,w){const S=g.context,C=S.gl;C.enable(C.SCISSOR_TEST),C.scissor(l*a.e.devicePixelRatio,d*a.e.devicePixelRatio,_*a.e.devicePixelRatio,x*a.e.devicePixelRatio),S.clear({color:w}),C.disable(C.SCISSOR_TEST)}const yl=a.c9([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Cy}=yl;function ea(g,l,d,_){g.emplaceBack(l,d,_)}class Yt{constructor(l){this.vertexArray=new a.ca,this.indices=new a.bw,ea(this.vertexArray,-1,-1,1),ea(this.vertexArray,1,-1,1),ea(this.vertexArray,-1,1,1),ea(this.vertexArray,1,1,1),ea(this.vertexArray,-1,-1,-1),ea(this.vertexArray,1,-1,-1),ea(this.vertexArray,-1,1,-1),ea(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,Cy),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=a.b.simpleSegment(0,0,36,12)}}function pr(g,l,d,_,x,w){const S=g.context.gl,C=l.paint.get("sky-atmosphere-color"),k=l.paint.get("sky-atmosphere-halo-color"),L=l.paint.get("sky-atmosphere-sun-intensity"),N=((U,$,q,te,ne)=>({u_matrix_3f:U,u_sun_direction:$,u_sun_intensity:q,u_color_tint_r:[te.r,te.g,te.b,te.a],u_color_tint_m:[ne.r,ne.g,ne.b,ne.a],u_luminance:5e-5}))(a.bE.fromMat4(a.bE.create(),_),x,L,C,k);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+w,l.skyboxTexture,0),d.draw(g,S.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.unblended,a.ag.frontCW,N,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const Ir=a.c9([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ba{constructor(l){const d=new a.cb;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const _=new a.bw;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(d,Ir.members),this.indexBuffer=l.createIndexBuffer(_),this.segments=a.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const nd=a.c9([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class _r{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Om{constructor(l){this.colorModeAlphaBlendedWriteRGB=new a.a([a.cc,a.cd,a.cc,a.cd],a.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new a.a([a.cc,a.ce,a.cc,a.ce],a.C.transparent,[!1,!1,!1,!0]),this.params=new _r,this.updateNeeded=!0,l.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),l.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(l){const d=l.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ba(d);const _=this.params.sizeRange,x=this.params.intensityRange,w=function(N){const U=a.ch(30),$=[];for(let q=0;q<N;++q){const te=2*Math.PI*U(),ne=Math.acos(1-2*U())-.5*Math.PI;$.push(a.$.fromValues(Math.cos(ne)*Math.cos(te),Math.cos(ne)*Math.sin(te),Math.sin(ne)))}return $}(this.params.starsCount),S=a.ch(300),C=new a.cf,k=new a.bw;let L=0;for(let N=0;N<w.length;++N){const U=a.$.scale([],w[N],200),$=Math.max(0,1+.01*_*(1*S()-.5)),q=Math.max(0,1+.01*x*(1*S()-.5));C.emplaceBack(U[0],U[1],U[2],-1,-1,$,q),C.emplaceBack(U[0],U[1],U[2],1,-1,$,q),C.emplaceBack(U[0],U[1],U[2],1,1,$,q),C.emplaceBack(U[0],U[1],U[2],-1,1,$,q),k.emplaceBack(L+0,L+1,L+2),k.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=d.createVertexBuffer(C,nd.members),this.starsIdx=d.createIndexBuffer(k),this.starsSegments=a.b.simpleSegment(0,0,C.length,k.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(l,d){const _=l.context,x=_.gl,w=l.transform,S=new a.af(x.LEQUAL,a.af.ReadOnly,[0,1]),C=a.a2(w.zoom),k=l.style.getLut(d.scope),L=d.properties.get("color").toRenderColor(k).toArray01(),N=d.properties.get("high-color").toRenderColor(k).toArray01(),U=d.properties.get("space-color").toRenderColor(k).toArray01PremultipliedAlpha(),$=5e-4,q=a.cg(d.properties.get("horizon-blend"),0,1,$,.25),te=a.bc(l,_,w)&&q===$?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,ne=l.frameCounter/1e3%1,ie=a.$.length(w.globeCenterInViewSpace),ae=Math.sqrt(Math.pow(ie,2)-Math.pow(te,2)),ve=Math.acos(ae/ie),xe=ye=>{const Me=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ye&&Me.push("ALPHA_PASS");const Se=l.getOrCreateProgram("globeAtmosphere",{defines:Me}),Ie=((Fe,We,Be,Re,Je,Ye,je,vt,dt,He,it,Ue)=>({u_frustum_tl:Fe,u_frustum_tr:We,u_frustum_br:Be,u_frustum_bl:Re,u_horizon:Je,u_transition:Ye,u_fadeout_range:je,u_color:vt,u_high_color:dt,u_space_color:He,u_temporal_offset:it,u_horizon_angle:Ue}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,C,q,L,N,U,ne,ve);l.uploadCommonUniforms(_,Se);const Ne=this.atmosphereBuffer;Ne&&Se.draw(l,x.TRIANGLES,S,a.ah.disabled,ye?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,a.ag.backCW,Ie,ye?"atmosphere_glow_alpha":"atmosphere_glow",Ne.vertexBuffer,Ne.indexBuffer,Ne.segments)};xe(!1),xe(!0)}drawStars(l,d){const _=a.au(d.properties.get("star-intensity"),0,1);if(_===0)return;const x=l.context,w=x.gl,S=l.transform,C=l.getOrCreateProgram("stars"),k=a.aw.identity([]);a.aw.rotateX(k,k,-S._pitch),a.aw.rotateZ(k,k,-S.angle),a.aw.rotateX(k,k,a.ac(S._center.lat)),a.aw.rotateY(k,k,-a.ac(S._center.lng));const L=a.ae.fromQuat(new Float32Array(16),k),N=a.ae.multiply([],S.starsProjMatrix,L),U=a.bE.fromMat4([],L),$=a.bE.invert([],U),q=[0,1,0];a.$.transformMat3(q,q,$),a.$.scale(q,q,this.params.sizeMultiplier);const te=[1,0,0];a.$.transformMat3(te,te,$),a.$.scale(te,te,this.params.sizeMultiplier);const ne=(ie=q,ae=te,ve=_,{u_matrix:Float32Array.from(N),u_up:ie,u_right:ae,u_intensity_multiplier:ve});var ie,ae,ve;l.uploadCommonUniforms(x,C),this.starsVx&&this.starsIdx&&C.draw(l,w.TRIANGLES,a.af.disabled,a.ah.disabled,this.colorModeAlphaBlendedWriteRGB,a.ag.disabled,ne,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function rd(g,l){const d=[...g],_=l.cameraWorldSizeForFog/l.worldSize,x=a.ae.identity([]);return a.ae.scale(x,x,[_,_,1]),a.ae.multiply(d,x,d),a.ae.multiply(d,l.worldToFogMatrix,d),d}function Gu(g,l,d,_,x){const w=d.material,S=_.context,{baseColorTexture:C,metallicRoughnessTexture:k}=w.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:N,emissionTexture:U}=w;function $(q,te,ne){if(q&&(g.push(te),S.activeTexture.set(S.gl.TEXTURE0+ne),q.gfxTexture)){const{minFilter:ie,magFilter:ae,wrapS:ve,wrapT:xe}=q.sampler;q.gfxTexture.bindExtraParam(ie,ae,ve,xe)}}$(C,"HAS_TEXTURE_u_baseColorTexture",Ts.BaseColor),$(k,"HAS_TEXTURE_u_metallicRoughnessTexture",Ts.MetallicRoughness),$(L,"HAS_TEXTURE_u_normalTexture",Ts.Normal),$(N,"HAS_TEXTURE_u_occlusionTexture",Ts.Occlusion),$(U,"HAS_TEXTURE_u_emissionTexture",Ts.Emission),x&&(x.texture||(x.texture=new a.cj(_.context,x.image,[x.image.height,x.image.height,x.image.height],S.gl.RGBA)),S.activeTexture.set(S.gl.TEXTURE0+Ts.LUT),x.texture&&x.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),g.push("APPLY_LUT_ON_GPU")),d.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),l.push(d.texcoordBuffer)),d.colorBuffer&&(g.push(d.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),l.push(d.colorBuffer)),d.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),l.push(d.normalBuffer)),d.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),l.push(d.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||g.push("DIFFUSE_SHADED"),g.push("USE_STANDARD_DERIVATIVES")}function Ks(g,l,d,_,x,w){const S=d.paint.get("model-opacity"),C=l.context,k=new a.af(l.context.gl.LEQUAL,a.af.ReadWrite,l.depthRangeFor3D),L=l.transform,N=g.mesh,U=N.material,$=U.pbrMetallicRoughness,q=l.style.fog;let te;te=l.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:a.ae.multiply([],_.zScaleMatrix,g.nodeModelMatrix),a.ae.multiply(te,_.negCameraPosMatrix,te);const ne=a.ae.invert([],te);a.ae.transpose(ne,ne);const ie=d.paint.get("model-emissive-strength").constantOr(0),ae=Uu(new Float32Array(g.worldViewProjection),new Float32Array(te),new Float32Array(ne),null,l,S,$.baseColorFactor.toRenderColor(null),U.emissiveFactor,$.metallicFactor,$.roughnessFactor,U,ie,d),ve={defines:[]},xe=[];Gu(ve.defines,xe,N,l,d.lut);const ye=l.shadowRenderer;ye&&(ye.useNormalOffset=!1);let Me=null;if(q){const Ne=rd(g.nodeModelMatrix,l.transform);if(Me=new Float32Array(Ne),L.projection.name!=="globe"){const Fe=N.aabb.min,We=N.aabb.max,[Be,Re]=q.getOpacityForBounds(Ne,Fe[0],Fe[1],We[0],We[1]);ve.overrideFog=Be>=fr||Re>=fr}}const Se=Rs(l,d.paint.get("model-cutoff-fade-range"));Se.shouldRenderCutoff&&ve.defines.push("RENDER_CUTOFF");const Ie=l.getOrCreateProgram("model",ve);l.uploadCommonUniforms(C,Ie,null,Me,Se),l.renderPass!=="shadow"&&ye&&ye.setupShadowsFromMatrix(g.nodeModelMatrix,Ie),Ie.draw(l,C.gl.TRIANGLES,k,x,w,N.material.doubleSided?a.ag.disabled:a.ag.backCCW,ae,d.id,N.vertexBuffer,N.indexBuffer,N.segments,d.paint,l.transform.zoom,void 0,xe)}function Ci(g,l,d,_,x,w,S){let C;C=g.projection.name==="globe"?a.ck(d,g):[...d],a.ae.multiply(C,C,l.matrix);const k=a.ae.multiply([],_,C);if(l.meshes)for(const L of l.meshes){if(L.material.alphaMode!=="BLEND"){S.push({mesh:L,depth:0,modelIndex:x,worldViewProjection:k,nodeModelMatrix:C});continue}const N=a.$.transformMat4([],L.centroid,k);N[2]>0&&w.push({mesh:L,depth:N[2],modelIndex:x,worldViewProjection:k,nodeModelMatrix:C})}if(l.children)for(const L of l.children)Ci(g,L,d,_,x,w,S)}function Py(g,l,d,_){const x=d.shadowRenderer;if(!x)return;const w=x.getShadowPassDepthMode(),S=x.getShadowPassColorMode(),C=x.calculateShadowPassMatrixFromMatrix(l),k=by(C);d.getOrCreateProgram("modelDepth",{defines:d._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(d,d.context.gl.TRIANGLES,w,a.ah.disabled,S,a.ag.backCCW,k,_.id,g.vertexBuffer,g.indexBuffer,g.segments,_.paint,d.transform.zoom,void 0,void 0)}function Vf(g,l,d){const _=l.updateZoomBasedPaintProperties(),x=function(w,S,C){let k,L,N,U=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&U>0){const $=w.terrain,q=$.findDEMTileFor(C);q&&q.dem?k=a.cm.create($,C,q):U=0}if(U===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),U===S.validForExaggeration&&(U===0||k&&k._demTile&&k._demTile.tileID===S.validForDEMTile.id&&k._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const $ in S.instancesPerModel){const q=S.instancesPerModel[$];for(let te=0;te<q.instancedDataArray.length;++te){const ne=(k?U*k.getElevationAt(0|q.instancedDataArray.float32[16*te],0|q.instancedDataArray.float32[16*te+1],!0,!0):0)+q.instancesEvaluatedElevation[te];q.instancedDataArray.float32[16*te+6]=ne,L=L?Math.min(S.terrainElevationMin,ne):ne,N=N?Math.max(S.terrainElevationMax,ne):ne}}return S.terrainElevationMin=L||0,S.terrainElevationMax=N||0,S.validForExaggeration=U,S.validForDEMTile=k&&k._demTile?{id:k._demTile.tileID,timestamp:k._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,l,d);(_||x)&&(l.uploaded=!1,l.upload(g.context))}const wa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.b8([0,0,0],[a.a4,a.a4,0])};function jf(g,l){const d=1<<g.canonical.z,_=l.getFreeCameraOptions().position,x=l.elevation,w=g.canonical.x/d,S=(g.canonical.x+1)/d,C=g.canonical.y/d,k=(g.canonical.y+1)/d;let L=l._centerAltitude;if(x){const q=x.getMinMaxForTile(g);q&&q.max>L&&(L=q.max)}const N=a.au(_.x,w,S)-_.x,U=a.au(_.y,C,k)-_.y,$=a.ay(L,l.center.lat)-_.z;return l._zoomFromMercatorZ(Math.sqrt(N*N+U*U+$*$))}function Lm(g,l,d,_,x,w,S){const C=g.context,k=g.renderPass==="shadow",L=g.shadowRenderer,N=k&&L?L.getShadowPassDepthMode():new a.af(C.gl.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D),U=g.isTileAffectedByFog(w);if(d.meshes)for(const $ of d.meshes){const q=["MODEL_POSITION_ON_GPU"],te=[];let ne,ie,ae;_.instancedDataArray.length>20&&q.push("INSTANCED_ARRAYS");const ve=Rs(g,l.paint.get("model-cutoff-fade-range"));if(ve.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),k&&L)ne=g.getOrCreateProgram("modelDepth",{defines:q}),ie=by(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(d.matrix)),ae=L.getShadowPassColorMode();else{Gu(q,te,$,g,l.lut),ne=g.getOrCreateProgram("model",{defines:q,overrideFog:U});const ye=$.material,Me=ye.pbrMetallicRoughness,Se=l.paint.get("model-opacity"),Ie=l.paint.get("model-emissive-strength").constantOr(0);ie=Uu(w.expandedProjMatrix,Float32Array.from(d.matrix),new Float32Array(16),null,g,Se,Me.baseColorFactor.toRenderColor(null),ye.emissiveFactor,Me.metallicFactor,Me.roughnessFactor,ye,Ie,l,x),L&&(S.shadowUniformsInitialized?ne.setShadowUniformValues(C,L.getShadowUniformValues()):(L.setupShadows(w.toUnwrapped(),ne,"model-tile",w.overscaledZ),S.shadowUniformsInitialized=!0)),ae=ve.shouldRenderCutoff||Se<1||ye.alphaMode!=="OPAQUE"?a.a.alphaBlended:a.a.unblended}g.uploadCommonUniforms(C,ne,w.toUnwrapped(),null,ve);const xe=$.material.doubleSided?a.ag.disabled:a.ag.backCCW;if(_.instancedDataArray.length>20)te.push(_.instancedDataBuffer),ne.draw(g,C.gl.TRIANGLES,N,a.ah.disabled,ae,xe,ie,l.id,$.vertexBuffer,$.indexBuffer,$.segments,l.paint,g.transform.zoom,void 0,te,_.instancedDataArray.length);else{const ye=k?"u_instance":"u_normal_matrix";for(let Me=0;Me<_.instancedDataArray.length;++Me)ie[ye]=new Float32Array(_.instancedDataArray.arrayBuffer,64*Me,16),ne.draw(g,C.gl.TRIANGLES,N,a.ah.disabled,ae,xe,ie,l.id,$.vertexBuffer,$.indexBuffer,$.segments,l.paint,g.transform.zoom,void 0,te)}}if(d.children)for(const $ of d.children)Lm(g,l,$,_,x,w,S)}const zm=[1,-1,1];function uo(g,l,d,_){if(!d.modelManager)return!0;const x=d.modelManager;if(!d.shadowRenderer)return!0;const w=d.shadowRenderer,S=l.aabb;let C=!0,k=g.maxHeight;if(k===0){let N=0;for(const U in g.instancesPerModel){const $=x.getModel(U,_);$?N=Math.max(N,Math.max(Math.max($.aabb.max[0],$.aabb.max[1]),$.aabb.max[2])):C=!1}k=g.maxScale*N*1.41+g.maxVerticalOffset,C&&(g.maxHeight=k)}S.max[2]=k,S.min[2]+=g.terrainElevationMin,S.max[2]+=g.terrainElevationMax,a.$.transformMat4(S.min,S.min,l.tileMatrix),a.$.transformMat4(S.max,S.max,l.tileMatrix);const L=S.intersects(w.getCurrentCascadeFrustum());return d.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=L===2),L===0}function ta(g,l){const d=g.uniformValues.u_cutoff_params[0],_=g.uniformValues.u_cutoff_params[1],x=g.uniformValues.u_cutoff_params[2],w=g.uniformValues.u_cutoff_params[3];return _===d||w===x?1:a.au(((l-d)/(_-d)-x)/(w-x),0,1)}function P1(g,l,d,_){if(l.pitch<20)return 1;const x=l.getWorldToCameraMatrix(),w=a.ae.multiply([],x,g),S=[...d.min,1];let C=a.aB.transformMat4([],S,w),k=C,L=C;S[1]=d.max[1],C=a.aB.transformMat4([],S,w),k=C[1]<k[1]?C:k,L=C[1]>L[1]?C:L,S[0]=d.max[0],C=a.aB.transformMat4([],S,w),k=C[1]<k[1]?C:k,L=C[1]>L[1]?C:L,S[1]=d.min[1],C=a.aB.transformMat4([],S,w),k=C[1]<k[1]?C:k,L=C[1]>L[1]?C:L;const N=a.au(_[0],0,1),U=100*l.pixelsPerMeter*a.au(_[1],0,1),$=a.au(_[2],0,1),q=a.$.lerp([],k,L,N),te=Math.tan(.5*l.fovX),ne=-q[2]*te;if(U===0)return q[1]<-Math.abs(ne)?$:1;const ie=(-Math.abs(ne)-q[1])/U,ae=(xe,ye,Me)=>(1-Me)*xe+Me*ye,ve=a.au(ae(1,$,ie),$,1);return ae(1,ve,a.au((l.pitch-20)/20,0,1))}class id{}class ts{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(l,d,_){{const U=this._storage.get(d.id);if(U)return U.lastUsedFrameIdx=l,U.buf}const x=_.gl,w=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),S=new ArrayBuffer(w),C=new Int16Array(S);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const k=new a.co;for(let U=0;U<w/2;U+=3){const $=C[U],q=C[U+1],te=C[U+2];k.emplaceBack($,q),k.emplaceBack(q,te),k.emplaceBack(te,$)}const L=_.bindVertexArrayOES.current,N=new id;return N.buf=new a.I(_,k),N.lastUsedFrameIdx=l,this._storage.set(d.id,N),_.bindVertexArrayOES.set(L),N.buf}update(l){for(const[d,_]of this._storage)l-_.lastUsedFrameIdx>30&&(_.buf.destroy(),this._storage.delete(d))}destroy(){for(const[l,d]of this._storage)d.buf.destroy(),this._storage.delete(l)}}class Ga{constructor(l){this.occluderSize=30,this.depthOffset=-1e-4,l.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),l.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const qa={symbol:function(g,l,d,_,x){if(g.renderPass!=="translucent")return;const w=a.ah.disabled,S=g.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(L,N,U,$,q,te,ne){const ie=N.transform,ae=q==="map",ve=te==="map";for(const xe of L){const ye=$.getTile(xe),Me=ye.getBucket(U);if(!Me||!Me.text||!Me.text.segments.get().length)continue;const Se=a.aE(Me.textSizeData,ie.zoom),Ie=wy(xe,Me.getProjection(),ie),Ne=ie.calculatePixelsToTileUnitsMatrix(ye),Fe=Fc(Ie,ye.tileID.canonical,ve,ae,ie,Me.getProjection(),Ne),We=Me.hasIconTextFit()&&Me.hasIconData();if(Se){const Be=Math.pow(2,ie.zoom-ye.tileID.overscaledZ);UI(Me,ae,ve,ne,a.bQ,ie,Fe,xe,Be,Se,We)}}}(_,g,d,l,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),x);const C=d.paint.get("icon-opacity").constantOr(1)!==0,k=d.paint.get("text-opacity").constantOr(1)!==0;d.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(C||k)?Nf(g,l,d,_,w,S):(C&&Nf(g,l,d,_,w,S,{onlyIcons:!0}),k&&Nf(g,l,d,_,w,S,{onlyText:!0})),l.map.showCollisionBoxes&&(E1(g,l,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),E1(g,l,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(g,l,d,_){if(g.renderPass!=="translucent")return;const x=d.paint.get("circle-opacity"),w=d.paint.get("circle-stroke-width"),S=d.paint.get("circle-stroke-opacity"),C=d.layout.get("circle-sort-key").constantOr(1)!==void 0,k=d.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(w.constantOr(1)===0||S.constantOr(1)===0))return;const L=g.context,N=L.gl,U=g.transform,$=g.depthModeForSublayer(0,a.af.ReadOnly),q=a.ah.disabled,te=g.colorModeForDrapableLayerRenderPass(k),ne=U.projection.name==="globe",ie=[a.ak(U.center.lng),a.al(U.center.lat)],ae=[];for(let xe=0;xe<_.length;xe++){const ye=_[xe],Me=l.getTile(ye),Se=Me.getBucket(d);if(!Se||Se.projection.name!==U.projection.name)continue;const Ie=Se.programConfigurations.get(d.id),Ne=a.bT(d),Fe=g.isTileAffectedByFog(ye);ne&&Ne.push("PROJECTION_GLOBE_VIEW"),Ne.push("DEPTH_D24"),g.terrain&&U.depthOcclusionForSymbolsAndCircles&&Ne.push("DEPTH_OCCLUSION");const We=g.getOrCreateProgram("circle",{config:Ie,defines:Ne,overrideFog:Fe}),Be=Se.layoutVertexBuffer,Re=Se.globeExtVertexBuffer,Je=Se.indexBuffer,Ye=U.projection.createInversionMatrix(U,ye.canonical),je={programConfiguration:Ie,program:We,layoutVertexBuffer:Be,globeExtVertexBuffer:Re,indexBuffer:Je,uniformValues:a.bU(g,ye,Me,Ye,ie,d),tile:Me};if(C){const vt=Se.segments.get();for(const dt of vt)ae.push({segments:new a.b([dt]),sortKey:dt.sortKey,state:je})}else ae.push({segments:Se.segments,sortKey:0,state:je})}C&&ae.sort((xe,ye)=>xe.sortKey-ye.sortKey);const ve={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const xe of ae){const{programConfiguration:ye,program:Me,layoutVertexBuffer:Se,globeExtVertexBuffer:Ie,indexBuffer:Ne,uniformValues:Fe,tile:We}=xe.state,Be=xe.segments;g.terrain&&g.terrain.setupElevationDraw(We,Me,ve),g.uploadCommonUniforms(L,Me,We.tileID.toUnwrapped()),Me.draw(g,N.TRIANGLES,$,q,te,a.ag.disabled,Fe,d.id,Se,Ne,Be,d.paint,U.zoom,ye,[Ie])}},heatmap:function(g,l,d,_){if(d.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const x=g.context,w=x.gl,S=a.ah.disabled,C=new a.a([w.ONE,w.ONE,w.ONE,w.ONE],a.C.transparent,[!0,!0,!0,!0]);(function(q,te,ne,ie){const ae=q.gl,ve=te.width*ie,xe=te.height*ie;q.activeTexture.set(ae.TEXTURE1),q.viewport.set([0,0,ve,xe]);let ye=ne.heatmapFbo;if(!ye||ye&&(ye.width!==ve||ye.height!==xe)){ye&&ye.destroy();const Me=ae.createTexture();ae.bindTexture(ae.TEXTURE_2D,Me),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MAG_FILTER,ae.LINEAR),ye=ne.heatmapFbo=q.createFramebuffer(ve,xe,!0,null),function(Se,Ie,Ne,Fe,We,Be){const Re=Se.gl;Re.texImage2D(Re.TEXTURE_2D,0,Se.extRenderToTextureHalfFloat?Re.RGBA16F:Re.RGBA,We,Be,0,Re.RGBA,Se.extRenderToTextureHalfFloat?Re.HALF_FLOAT:Re.UNSIGNED_BYTE,null),Fe.colorAttachment.set(Ne)}(q,0,Me,ye,ve,xe)}else ae.bindTexture(ae.TEXTURE_2D,ye.colorAttachment.get()),q.bindFramebuffer.set(ye.framebuffer)})(x,g,d,g.transform.projection.name==="globe"?.5:.25),x.clear({color:a.C.transparent});const k=g.transform,L=k.projection.name==="globe",N=L?["PROJECTION_GLOBE_VIEW"]:[],U=L?a.ag.frontCCW:a.ag.disabled,$=[a.ak(k.center.lng),a.al(k.center.lat)];for(let q=0;q<_.length;q++){const te=_[q];if(l.hasRenderableParent(te))continue;const ne=l.getTile(te),ie=ne.getBucket(d);if(!ie||ie.projection.name!==k.projection.name)continue;const ae=g.isTileAffectedByFog(te),ve=ie.programConfigurations.get(d.id),xe=g.getOrCreateProgram("heatmap",{config:ve,defines:N,overrideFog:ae}),{zoom:ye}=g.transform;g.terrain&&g.terrain.setupElevationDraw(ne,xe),g.uploadCommonUniforms(x,xe,te.toUnwrapped());const Me=k.projection.createInversionMatrix(k,te.canonical);xe.draw(g,w.TRIANGLES,a.af.disabled,S,C,U,x1(g,te,ne,Me,$,ye,d.paint.get("heatmap-intensity")),d.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,d.paint,g.transform.zoom,ve,L?[ie.globeExtVertexBuffer]:null)}x.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(x,w){const S=x.context,C=S.gl,k=w.heatmapFbo;if(!k)return;S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,k.colorAttachment.get()),S.activeTexture.set(C.TEXTURE1);let L=w.colorRampTexture;L||(L=w.colorRampTexture=new a.T(S,w.colorRamp,C.RGBA)),L.bind(C.LINEAR,C.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,C.TRIANGLES,a.af.disabled,a.ah.disabled,x.colorModeForRenderPass(),a.ag.disabled,((N,U,$,q)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,w),w.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,w.paint,x.transform.zoom)}(g,d))},line:function(g,l,d,_){if(g.renderPass!=="translucent")return;const x=d.paint.get("line-opacity"),w=d.paint.get("line-width");if(x.constantOr(1)===0||w.constantOr(1)===0)return;const S=d.paint.get("line-emissive-strength"),C=d.paint.get("line-occlusion-opacity"),k=g.context,L=k.gl,N=d.layout.get("line-z-offset"),U=!N.isConstant()||!!N.constantOr(0),$=U?new a.af(g.depthOcclusion?L.GREATER:L.LEQUAL,a.af.ReadOnly,g.depthRangeFor3D):g.depthModeForSublayer(0,a.af.ReadOnly),q=g.colorModeForDrapableLayerRenderPass(S),te=g.terrain&&g.terrain.renderingToTexture,ne=te?1:a.e.devicePixelRatio,ie=d.paint.get("line-dasharray"),ae=ie.constantOr(1),ve=d.layout.get("line-cap"),xe=ie.constantOr(null),ye=ve.constantOr(null),Me=d.paint.get("line-pattern"),Se=Me.constantOr(1),Ie=Me.constantOr(null),Ne=d.paint.get("line-opacity").constantOr(1);let Fe=!Se&&Ne!==1||g.depthOcclusion&&C>0&&C<1;const We=d.paint.get("line-gradient"),Be=Se?"linePattern":"line",Re=a.bV(d);let Je;if(te&&g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(Fe=!1),C!==0&&g.depthOcclusion){const je=d.paint._values["line-opacity"];je&&je.value&&je.value.kind==="constant"?Je=je.value:a.w(`Occlusion opacity for layer ${d.id} is supported only when line-opacity isn't data-driven.`)}if(U&&(g.forceTerrainMode=!0),!U&&C!==0&&g.terrain&&!te)return void a.w(`Occlusion opacity for layer ${d.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const Ye=Fe&&U?g.stencilModeFor3D():a.ah.disabled;for(const je of _){const vt=l.getTile(je);if(Se&&!vt.patternsLoaded())continue;const dt=vt.getBucket(d);if(!dt)continue;g.prepareDrawTile();const He=dt.programConfigurations.get(d.id),it=g.isTileAffectedByFog(je),Ue=g.getOrCreateProgram(Be,{config:He,defines:U?[...Re,"ELEVATED"]:Re,overrideFog:it});if(Ie&&vt.imageAtlas){const qt=vt.imageAtlas.patternPositions[Ie.toString()];qt&&He.setConstantPatternPositions(qt)}if(!Se&&xe&&ye&&vt.lineAtlas){const qt=vt.lineAtlas.getDash(xe,ye);qt&&He.setConstantPatternPositions(qt)}let[ft,gt]=d.paint.get("line-trim-offset");(ye==="round"||ye==="square")&&ft!==gt&&(ft===0&&(ft-=1),gt===1&&(gt+=1));const Ut=te?je.projMatrix:null,$t=Se?a.bW(g,vt,d,Ut,ne,[ft,gt]):a.bX(g,vt,d,Ut,dt.lineClipsArray.length,ne,[ft,gt]);if(We){const qt=dt.gradients[d.id];let bn=qt.texture;if(d.gradientVersion!==qt.version){let Fn=256;if(d.stepInterpolant){const Tn=l.getSource().maxzoom,jn=je.canonical.z===Tn?Math.ceil(1<<g.transform.maxZoom-je.canonical.z):1;Fn=a.au(a.bY(dt.maxLineLength/a.a4*1024*jn),256,k.maxTextureSize)}qt.gradient=a.bZ({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Fn,image:qt.gradient||void 0,clips:dt.lineClipsArray}),qt.texture?qt.texture.update(qt.gradient):qt.texture=new a.T(k,qt.gradient,L.RGBA),qt.version=d.gradientVersion,bn=qt.texture}k.activeTexture.set(L.TEXTURE1),bn.bind(d.stepInterpolant?L.NEAREST:L.LINEAR,L.CLAMP_TO_EDGE)}ae&&(k.activeTexture.set(L.TEXTURE0),vt.lineAtlasTexture&&vt.lineAtlasTexture.bind(L.LINEAR,L.REPEAT),He.updatePaintBuffers()),Se&&(k.activeTexture.set(L.TEXTURE0),vt.imageAtlasTexture&&vt.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),He.updatePaintBuffers()),U&&g.terrain.setupElevationDraw(vt,Ue),g.uploadCommonUniforms(k,Ue,je.toUnwrapped());const tn=qt=>{Je!=null&&(Je.value=Ne*C),Ue.draw(g,L.TRIANGLES,$,qt,q,a.ag.disabled,$t,d.id,dt.layoutVertexBuffer,dt.indexBuffer,dt.segments,d.paint,g.transform.zoom,He,[dt.layoutVertexBuffer2,dt.patternVertexBuffer,dt.zOffsetVertexBuffer]),Je!=null&&(Je.value=Ne)};if(Fe&&!U){const qt=g.stencilModeForClipping(je).ref;qt===0&&te&&k.clear({stencil:0});const bn={func:L.EQUAL,mask:255};$t.u_alpha_discard_threshold=.8,tn(new a.ah(bn,qt,255,L.KEEP,L.KEEP,L.INVERT)),$t.u_alpha_discard_threshold=0,tn(new a.ah(bn,qt,255,L.KEEP,L.KEEP,L.KEEP))}else Fe&&U&&($t.u_alpha_discard_threshold=.001),tn(U?Ye:g.stencilModeForClipping(je))}Fe&&(g.resetStencilClippingMasks(),te&&k.clear({stencil:0})),C===0||g.depthOcclusion||te||g.layersWithOcclusionOpacity.push(g.currentLayer),U&&(g.forceTerrainMode=!1)},fill:function(g,l,d,_){const x=d.paint.get("fill-color"),w=d.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const S=d.paint.get("fill-emissive-strength"),C=g.colorModeForDrapableLayerRenderPass(S),k=d.paint.get("fill-pattern"),L=g.opaquePassEnabledForLayer()&&!k.constantOr(1)&&x.constantOr(a.C.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===L){const N=g.depthModeForSublayer(1,g.renderPass==="opaque"?a.af.ReadWrite:a.af.ReadOnly);Ff(g,l,d,_,N,C,!1)}if(g.renderPass==="translucent"&&d.paint.get("fill-antialias")){const N=g.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,a.af.ReadOnly);Ff(g,l,d,_,N,C,!0)}},"fill-extrusion":function(g,l,d,_){const x=d.paint.get("fill-extrusion-opacity"),w=g.context,S=w.gl,C=g.terrain,k=C&&C.renderingToTexture;if(x===0)return;const L=g.conflationActive&&g.style.isLayerClipped(d,l.getSource()),N=g.style.order.indexOf(d.fqid);if(L&&function(U,$,q,te,ne){for(const ie of te){const ae=$.getTile(ie).getBucket(q);ae&&(ae.updateReplacement(ie,U.replacementSource,ne),ae.uploadCentroid(U.context))}}(g,l,d,_,N),C||L)for(const U of _){const $=l.getTile(U).getBucket(d);$&&VI(g.context,l,U,$,d,C,L)}if(g.renderPass==="shadow"&&g.shadowRenderer){const U=g.shadowRenderer;if(C&&x<.65&&d._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.Z)return;const $=U.getShadowPassDepthMode(),q=U.getShadowPassColorMode();ju(g,l,d,_,$,a.ah.disabled,q,L)}else if(g.renderPass==="translucent"){const U=!d.paint.get("fill-extrusion-pattern").constantOr(1),$=d.paint.get("fill-extrusion-color").constantOr(a.C.white);if(!k&&$.a!==0){const q=new a.af(g.context.gl.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D);x===1&&U?ju(g,l,d,_,q,a.ah.disabled,a.a.unblended,L):(ju(g,l,d,_,q,a.ah.disabled,a.a.disabled,L),ju(g,l,d,_,q,g.stencilModeFor3D(),g.colorModeForRenderPass(),L),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&U&&(!C&&g.transform.projection.name!=="globe"||k)){const q=d.paint.get("fill-extrusion-opacity"),te=d.paint.get("fill-extrusion-ambient-occlusion-intensity"),ne=d.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ie=d.paint.get("fill-extrusion-flood-light-intensity"),ae=d.paint.get("fill-extrusion-flood-light-color").toRenderColor(d.lut).toArray01().slice(0,3),ve=te>0&&ne>0,xe=ie>0,ye=(Se,Ie,Ne)=>(1-Ne)*Se+Ne*Ie,Me=Se=>{const Ie=g.depthModeForSublayer(1,a.af.ReadOnly,S.LEQUAL,!0),Ne=d.paint.get(Se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Fe=ye(.1,3,Ne),We=g._showOverdrawInspector;if(!We){const Be=new a.ah({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Re=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0],S.MIN);ed(g,l,d,_,Ie,Be,Re,a.ag.disabled,Se,"sdf",q,te,ne,ie,ae,Fe,L,!1)}{const Be=We?a.ah.disabled:new a.ah({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Re=We?g.colorModeForRenderPass():new a.a([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],a.C.transparent,[!0,!0,!0,!0]);ed(g,l,d,_,Ie,Be,Re,a.ag.disabled,Se,"color",q,te,ne,ie,ae,Fe,L,!1)}};if(k){const Se=(Ie,Ne,Fe)=>{const We=g.depthModeForSublayer(1,a.af.ReadOnly,S.LEQUAL,!1),Be=d.paint.get(Ie?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Re=ye(.1,3,Be);{const Je=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0]);ed(g,l,d,_,We,a.ah.disabled,Je,a.ag.disabled,Ie,"clear",q,te,ne,ie,ae,Re,L,Ne)}{const Je=new a.ah({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Ye=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0],S.MIN);ed(g,l,d,_,We,Je,Ye,a.ag.disabled,Ie,"sdf",q,te,ne,ie,ae,Re,L,Ne)}{const Je=Ie?S.ZERO:S.ONE_MINUS_DST_ALPHA,Ye=new a.ah({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),je=new a.a([Je,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],a.C.transparent,[!0,!0,!0,!0]);ed(g,l,d,_,We,Ye,je,a.ag.disabled,Ie,"color",q,te,ne,ie,ae,Re,L,Ne)}{const Je=new a.a([S.ONE,S.ONE,S.ONE,Ie?S.ZERO:S.ONE],a.C.transparent,[!1,!1,!1,!0],Ie?S.FUNC_ADD:S.MAX);ed(g,l,d,_,We,a.ah.disabled,Je,a.ag.disabled,Ie,"clear",q,te,ne,ie,ae,Re,L,Ne,Fe)}};if(ve||xe){let Ie;if(g.prepareDrawTile(),C){const Ne=C.drapeBufferSize[0],Fe=C.drapeBufferSize[1];Ie=C.framebufferCopyTexture,Ie&&(!Ie||Ie.size[0]===Ne&&Ie.size[1]===Fe)||(Ie&&Ie.destroy(),Ie=C.framebufferCopyTexture=new a.T(w,new a.j({width:Ne,height:Fe}),S.RGBA)),Ie.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexImage2D(S.TEXTURE_2D,0,S.RGBA,0,0,Ne,Fe,0)}ve&&Se(!0,!1,Ie),xe&&Se(!1,!0,Ie)}}else ve&&Me(!0),xe&&Me(!1),(ve||xe)&&g.resetStencilClippingMasks()}}},hillshade:function(g,l,d,_){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const x=g.context,w=g.terrain&&g.terrain.renderingToTexture,[S,C]=g.renderPass!=="translucent"||w?[{},_]:g.stencilConfigForOverlap(_);for(const k of C){const L=l.getTile(k);if(L.needsHillshadePrepare&&g.renderPass==="offscreen")gy(g,L,d);else if(g.renderPass==="translucent"){const N=g.depthModeForSublayer(0,a.af.ReadOnly),U=d.paint.get("hillshade-emissive-strength"),$=g.colorModeForDrapableLayerRenderPass(U),q=w&&g.terrain?g.terrain.stencilModeForRTTOverlap(k):S[k.overscaledZ];Oc(g,k,L,d,N,q,$)}}x.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,l,d,_,x,w){if(g.renderPass!=="translucent"||d.paint.get("raster-opacity")===0)return;const S=g.transform.projection.name==="globe",C=d.paint.get("raster-elevation")!==0,k=C&&S;if(g.renderElevatedRasterBackface&&!k)return;const L=g.context,N=L.gl,U=l.getSource(),$=function(Se,Ie,Ne,Fe){const We=Ie.paint.get("raster-color"),Be=Se.type==="raster-array",Re=[],Je=Ie.paint.get("raster-resampling"),Ye=Ie.paint.get("raster-color-mix");let je=Ie.paint.get("raster-color-range");const vt=[Ye[0],Ye[1],Ye[2],0],dt=Ye[3];let He=Je==="nearest"?Fe.NEAREST:Fe.LINEAR;if(Be&&(Re.push("RASTER_ARRAY"),We||Re.push("RASTER_COLOR"),Je==="linear"&&Re.push("RASTER_ARRAY_LINEAR"),He=Fe.NEAREST,!je&&Se.rasterLayers)){const it=Se.rasterLayers.find(({id:Ue})=>Ue===Ie.sourceLayer);it&&it.fields&&it.fields.range&&(je=it.fields.range)}if(je=je||[0,1],We){Re.push("RASTER_COLOR"),Ne.activeTexture.set(Fe.TEXTURE2),Ie.updateColorRamp(je);let it=Ie.colorRampTexture;it||(it=Ie.colorRampTexture=new a.T(Ne,Ie.colorRamp,Fe.RGBA)),it.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE)}return{mix:vt,range:je,offset:dt,defines:Re,resampling:He}}(U,d,L,N);if(U instanceof a.bo&&!_.length&&!S)return;const q=d.paint.get("raster-emissive-strength"),te=g.colorModeForDrapableLayerRenderPass(q),ne=g.terrain&&g.terrain.renderingToTexture,ie=!g.options.moving,ae=d.paint.get("raster-resampling")==="nearest"?N.NEAREST:N.LINEAR;if(U instanceof a.bo&&!_.length&&(U.onNorthPole||U.onSouthPole)){const Se=C?g.stencilModeFor3D():a.ah.disabled;return void Mm(!!U.onNorthPole,null,g,l,d,q,$,a.ag.disabled,Se)}if(!_.length)return;const[ve,xe]=U instanceof a.bo||ne?[{},_]:g.stencilConfigForOverlap(_),ye=xe[xe.length-1].overscaledZ;k&&$.defines.push("PROJECTION_GLOBE_VIEW"),C&&$.defines.push("RENDER_CUTOFF");const Me=(Se,Ie,Ne)=>{for(const Fe of Se){const We=Fe.toUnwrapped(),Be=l.getTile(Fe);if(ne&&(!Be||!Be.hasData()))continue;L.activeTexture.set(N.TEXTURE0);const Re=$u(Be,U,d,$);if(!Re||!Re.texture)continue;const{texture:Je,mix:Ye,offset:je,tileSize:vt,buffer:dt}=Re;let He,it;ne?(He=a.af.disabled,it=Fe.projMatrix):C?(He=new a.af(N.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D),it=S?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(We,ie)):(He=g.depthModeForSublayer(Fe.overscaledZ-ye,d.paint.get("raster-opacity")===1?a.af.ReadWrite:a.af.ReadOnly,N.LESS),it=g.transform.calculateProjMatrix(We,ie));const Ue=g.terrain&&ne?g.terrain.stencilModeForRTTOverlap(Fe):ve[Fe.overscaledZ],ft=w?0:d.paint.get("raster-fade-duration");Be.registerFadeDuration(ft);const gt=l.findLoadedParent(Fe,0),Ut=$a(Be,gt,l,g.transform,ft);let $t,tn;g.terrain&&g.terrain.prepareDrawTile(),L.activeTexture.set(N.TEXTURE0),Je.bind(ae,N.CLAMP_TO_EDGE),L.activeTexture.set(N.TEXTURE1),gt?(gt.texture&&gt.texture.bind(ae,N.CLAMP_TO_EDGE),$t=Math.pow(2,gt.tileID.overscaledZ-Be.tileID.overscaledZ),tn=[Be.tileID.canonical.x*$t%1,Be.tileID.canonical.y*$t%1]):Je.bind(ae,N.CLAMP_TO_EDGE),Je.useMipmap&&L.extTextureFilterAnisotropic&&g.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const qt=g.transform;let bn;const Fn=C?Ey(qt):[0,0,0,0];let Tn,jn,or,Zr,zr,cr=0;if(k&&U instanceof a.bo&&U.coordinates.length>3)Tn=Float32Array.from(a.bh(a.bi(new a.aO(0,0,0)))),jn=Float32Array.from(qt.globeMatrix),or=Float32Array.from(a.bd(qt)),Zr=[a.ak(qt.center.lng),a.al(qt.center.lat)],bn=U.elevatedGlobePerspectiveTransform,zr=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(k){const Bn=a.be(Fe.canonical);cr=a.bf(Bn.getCenter().lat),Tn=Float32Array.from(a.bh(a.bi(Fe.canonical))),jn=Float32Array.from(qt.globeMatrix),or=Float32Array.from(a.bd(qt)),Zr=[a.ak(qt.center.lng),a.al(qt.center.lat)],bn=[0,0],zr=Float32Array.from(a.bg(Fe.canonical,Bn,cr,qt.worldSize/qt._pixelsPerMercatorPixel))}else bn=U instanceof a.bo?U.perspectiveTransform:[0,0],Tn=new Float32Array(16),jn=new Float32Array(9),or=new Float32Array(16),Zr=[0,0],zr=new Float32Array(9);const Or=Pm(it,Tn,jn,or,zr,tn||[0,0],a.a2(g.transform.zoom),Zr,Fn,$t||1,Ut,d,bn,C?d.paint.get("raster-elevation"):0,2,Ye,je,$.range,vt,dt,q),qn=g.isTileAffectedByFog(Fe),Xn=g.getOrCreateProgram("raster",{defines:$.defines,overrideFog:qn});if(g.uploadCommonUniforms(L,Xn,We),U instanceof a.bo){const Bn=U.elevatedGlobeVertexBuffer,mr=U.elevatedGlobeIndexBuffer;if(ne||!S)U.boundsBuffer&&U.boundsSegments&&Xn.draw(g,N.TRIANGLES,He,a.ah.disabled,te,a.ag.disabled,Or,d.id,U.boundsBuffer,g.quadTriangleIndexBuffer,U.boundsSegments);else if(Bn&&mr){const Jn=qt.zoom<=a.b3?U.elevatedGlobeSegments:U.getSegmentsForLongitude(qt.center.lng);Jn&&Xn.draw(g,N.TRIANGLES,He,a.ah.disabled,te,Ie,Or,d.id,Bn,mr,Jn)}}else if(k){He=new a.af(N.LEQUAL,a.af.ReadOnly,g.depthRangeFor3D);const Bn=g.globeSharedBuffers;if(Bn){const[mr,Jn,An]=Bn.getGridBuffers(cr,!1);Xn.draw(g,N.TRIANGLES,He,Ne||Ue,g.colorModeForRenderPass(),Ie,Or,d.id,mr,Jn,An)}}else{const{tileBoundsBuffer:Bn,tileBoundsIndexBuffer:mr,tileBoundsSegments:Jn}=g.getTileBoundsBuffers(Be);Xn.draw(g,N.TRIANGLES,He,Ue,te,a.ag.disabled,Or,d.id,Bn,mr,Jn)}}if(!(U instanceof a.bo)&&k)for(const Fe of Se){const We=Fe.canonical.y===(1<<Fe.canonical.z)-1;Fe.canonical.y===0&&Mm(!0,Fe,g,l,d,q,$,Ie,Ne||a.ah.disabled),We&&Mm(!1,Fe,g,l,d,q,$,Ie===a.ag.frontCW?a.ag.backCW:a.ag.frontCW,Ne||a.ah.disabled)}};k?Me(xe,g.renderElevatedRasterBackface?a.ag.backCW:a.ag.frontCW,g.stencilModeFor3D()):Me(xe,a.ag.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,l,d,_,x,w){g.renderPass==="offscreen"&&function(S,C,k,L){if(!L.length)return;const N=S.context,U=N.gl,$=C.getSource();if(!($ instanceof R))return;const q=Math.ceil(Math.sqrt(k.paint.get("raster-particle-count")));let te=k.particlePositionRGBAImage;if(!te||te.width!==q){const xe=function(ye){const Me=ye*ye,Se=new Uint8Array(4*Me),Ie=function(Fe){return Fe|=0,Fe=Math.imul(2747636419^Fe,2654435769),Fe=Math.imul(Fe^Fe>>>16,2654435769),((Fe=Math.imul(Fe^Fe>>>16,2654435769))>>>0)/4294967296},Ne=1/1.1;for(let Fe=0;Fe<Me;Fe++){const We=Ne*(Ie(2*Fe+0)+gl),Be=Ne*(Ie(2*Fe+1)+gl),Re=255*We%1,Je=255*Be%1,Ye=Re,je=Be-Je/255,vt=Je;Se[4*Fe+0]=255*(We-Re/255),Se[4*Fe+1]=255*Ye,Se[4*Fe+2]=255*je,Se[4*Fe+3]=255*vt}return Se}(q);te=k.particlePositionRGBAImage=new a.j({width:q,height:q},xe)}let ne=k.particleFramebuffer;ne?ne.width!==q&&(ne.destroy(),ne=k.particleFramebuffer=N.createFramebuffer(q,q,!0,null)):ne=k.particleFramebuffer=N.createFramebuffer(q,q,!0,null);const ie=[];for(const xe of L){const ye=C.getTile(xe);if(!(ye instanceof a.c5))continue;const Me=C1(ye,$,k);if(!Me)continue;const Se=[ye.tileSize,ye.tileSize];let Ie=k.tileFramebuffer;Ie||(Ie=k.tileFramebuffer=N.createFramebuffer(Se[0],Se[1],!0,null));let Ne=ye.rasterParticleState;Ne||(Ne=ye.rasterParticleState=new dr(N,xe,Se,te));const Fe=Ne.update(k.lastInvalidatedAt);Ne.particleTextureDimension!==q&&Ne.updateParticleTexture(xe,te);const We=Ne.targetColorTexture;Ne.targetColorTexture=Ne.backgroundColorTexture,Ne.backgroundColorTexture=We;const Be=Ne.particleTexture0;Ne.particleTexture0=Ne.particleTexture1,Ne.particleTexture1=Be,ie.push([xe,Me,Ne,Fe])}if(ie.length===0)return;const ae=a.e.now(),ve=k.previousDrawTimestamp?.001*(ae-k.previousDrawTimestamp):.0167;if(k.previousDrawTimestamp=ae,k.hasColorMap()){N.activeTexture.set(U.TEXTURE0+2);let xe=k.colorRampTexture;xe||(xe=k.colorRampTexture=new a.T(N,k.colorRamp,U.RGBA)),xe.bind(U.LINEAR,U.CLAMP_TO_EDGE)}N.bindFramebuffer.set(k.tileFramebuffer.framebuffer),function(xe,ye,Me){const Se=xe.context,Ie=Se.gl,Ne=ye.tileFramebuffer;Se.activeTexture.set(Ie.TEXTURE0);const Fe={u_texture:0,u_opacity:1.05*(Be=ye.paint.get("raster-particle-fade-opacity-factor"))/(Be+.05)},We=xe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Be;for(const Re of Me){const[,,Je,Ye]=Re;Ne.colorAttachment.set(Je.targetColorTexture.texture),Se.viewport.set([0,0,Ne.width,Ne.height]),Se.clear({color:a.C.transparent}),Ye&&(Je.backgroundColorTexture.bind(Ie.NEAREST,Ie.CLAMP_TO_EDGE),We.draw(xe,Ie.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.alphaBlended,a.ag.disabled,Fe,ye.id,xe.viewportBuffer,xe.quadTriangleIndexBuffer,xe.viewportSegments))}}(S,k,ie),function(xe,ye,Me,Se){const Ie=xe.context,Ne=Ie.gl,Fe=Me.tileFramebuffer,We=xe.transform.projection.name==="globe",Be=Me.paint.get("raster-particle-max-speed");for(const Re of Se){const[Je,Ye,je]=Re;Ie.activeTexture.set(Ne.TEXTURE0+0),Ye.texture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),Fe.colorAttachment.set(je.targetColorTexture.texture);const vt=xe.getOrCreateProgram("rasterParticleDraw",{defines:Ye.defines,overrideFog:!1});Ie.activeTexture.set(Ne.TEXTURE0+1);const dt=Ye.scalarData?[]:[0,1,2,3].map(Ue=>a.b$[Ue](Je));dt.push(Je);const He=Je.canonical.x,it=Je.canonical.y;for(const Ue of dt){const ft=ye.getTile(We?Ue.wrapped():Ue);if(!ft)continue;const gt=ft.rasterParticleState;if(!gt)continue;const Ut=Ue.canonical.x+(1<<Ue.canonical.z)*(Ue.wrap-Je.wrap),$t=Ue.canonical.y;gt.particleTexture0.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE);const tn=FI(1,gt.particleTexture0.size[0],[Ut-He,$t-it],0,Ye.texture.size,2,Be,Ye.textureOffset,Ye.scale,Ye.offset);vt.draw(xe,Ne.POINTS,a.af.disabled,a.ah.disabled,a.a.alphaBlended,a.ag.disabled,tn,Me.id,gt.particleIndexBuffer,void 0,gt.particleSegment)}}}(S,C,k,ie),N.bindFramebuffer.set(k.particleFramebuffer.framebuffer),function(xe,ye,Me,Se){const Ie=xe.context,Ne=Ie.gl,Fe=ye.paint.get("raster-particle-max-speed"),We=Se*ye.paint.get("raster-particle-speed-factor")*.15,Be=function(Je){return Math.pow(Je,6)}(.01+1*ye.paint.get("raster-particle-reset-rate-factor")),Re=ye.particleFramebuffer;Ie.viewport.set([0,0,Re.width,Re.height]);for(const Je of Me){const[,Ye,je]=Je;Ie.activeTexture.set(Ne.TEXTURE0+0),Ye.texture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),Ie.activeTexture.set(Ne.TEXTURE0+1);const vt=je.particleTexture0;vt.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE);const dt=b1(1,vt.size[0],0,Ye.texture.size,Fe,We,Be,Ye.textureOffset,Ye.scale,Ye.offset);Re.colorAttachment.set(je.particleTexture1.texture),Ie.clear({color:a.C.transparent}),xe.getOrCreateProgram("rasterParticleUpdate",{defines:Ye.defines}).draw(xe,Ne.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.unblended,a.ag.disabled,dt,ye.id,xe.viewportBuffer,xe.quadTriangleIndexBuffer,xe.viewportSegments)}}(S,k,ie,ve)}(g,l,d,_),g.renderPass==="translucent"&&(function(S,C,k,L,N){const U=S.context,$=U.gl,q=C.getSource().tileSize,te=5*(1-a.a0(a.aV,a.aV+1,S.transform.zoom))*q+k.paint.get("raster-particle-elevation"),ne=!S.options.moving,ie=S.transform.projection.name==="globe";if(!L.length)return;const[ae,ve]=S.stencilConfigForOverlap(L),xe=[];ie&&xe.push("PROJECTION_GLOBE_VIEW");const ye=S.stencilModeFor3D();for(const Me of ve){const Se=Me.toUnwrapped(),Ie=C.getTile(Me);if(!Ie.rasterParticleState)continue;const Ne=Ie.rasterParticleState,Fe=100;Ie.registerFadeDuration(Fe);const We=C.findLoadedParent(Me,0),Be=$a(Ie,We,C,S.transform,Fe);let Re,Je;S.terrain&&S.terrain.prepareDrawTile(),U.activeTexture.set($.TEXTURE0),Ne.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),U.activeTexture.set($.TEXTURE1),We&&We.rasterParticleState?(We.rasterParticleState.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),Re=Math.pow(2,We.tileID.overscaledZ-Ie.tileID.overscaledZ),Je=[Ie.tileID.canonical.x*Re%1,Ie.tileID.canonical.y*Re%1]):Ne.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE);const Ye=ie?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(Se,ne),je=S.transform,vt=km(je),dt=a.be(Me.canonical),He=a.bf(dt.getCenter().lat);let it,Ue,ft,gt,Ut;ie?(it=Float32Array.from(a.bh(a.bi(Me.canonical))),Ue=Float32Array.from(je.globeMatrix),ft=Float32Array.from(a.bd(je)),gt=[a.ak(je.center.lng),a.al(je.center.lat)],Ut=Float32Array.from(a.bg(Me.canonical,dt,He,je.worldSize/je._pixelsPerMercatorPixel))):(it=new Float32Array(16),Ue=new Float32Array(9),ft=new Float32Array(16),gt=[0,0],Ut=new Float32Array(9));const $t=Bu(Ye,it,Ue,ft,Ut,Je||[0,0],a.a2(S.transform.zoom),gt,vt,Re||1,Be,te),tn=S.isTileAffectedByFog(Me),qt=S.getOrCreateProgram("rasterParticle",{defines:xe,overrideFog:tn});if(S.uploadCommonUniforms(U,qt,Se),ie){const bn=new a.af($.LEQUAL,a.af.ReadOnly,S.depthRangeFor3D),Fn=0,Tn=S.globeSharedBuffers;if(Tn){const[jn,or,Zr]=Tn.getGridBuffers(He,Fn!==0);qt.draw(S,$.TRIANGLES,bn,ye,a.a.alphaBlended,S.renderElevatedRasterBackface?a.ag.frontCCW:a.ag.backCCW,$t,k.id,jn,or,Zr)}}else{const bn=S.depthModeForSublayer(0,a.af.ReadOnly),Fn=ae[Me.overscaledZ],{tileBoundsBuffer:Tn,tileBoundsIndexBuffer:jn,tileBoundsSegments:or}=S.getTileBoundsBuffers(Ie);qt.draw(S,$.TRIANGLES,bn,Fn,a.a.alphaBlended,a.ag.disabled,$t,k.id,Tn,jn,or)}}S.resetStencilClippingMasks()}(g,l,d,_),g.style.map.triggerRepaint())},background:function(g,l,d,_){const x=d.paint.get("background-color"),w=d.paint.get("background-opacity"),S=d.paint.get("background-emissive-strength");if(w===0)return;const C=g.context,k=C.gl,L=g.transform,N=L.tileSize,U=d.paint.get("background-pattern");let $;if(U!==void 0&&(U===null||($=g.imageManager.getPattern(U.toString(),d.scope,g.style.getLut(d.scope)),!$)))return;const q=!U&&x.a===1&&w===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==q)return;const te=a.ah.disabled,ne=g.depthModeForSublayer(0,q==="opaque"?a.af.ReadWrite:a.af.ReadOnly),ie=g.colorModeForDrapableLayerRenderPass(S),ae=U?"backgroundPattern":"background";let ve,xe=_;xe||(ve=g.getBackgroundTiles(),xe=Object.values(ve).map(ye=>ye.tileID)),U&&(C.activeTexture.set(k.TEXTURE0),g.imageManager.bind(g.context,d.scope));for(const ye of xe){const Me=g.isTileAffectedByFog(ye),Se=g.getOrCreateProgram(ae,{overrideFog:Me}),Ie=ye.toUnwrapped(),Ne=_?ye.projMatrix:g.transform.calculateProjMatrix(Ie);g.prepareDrawTile();const Fe=l?l.getTile(ye):ve?ve[ye.key]:new a.bA(ye,N,L.zoom,g),We=U?BI(Ne,S,w,g,0,d.scope,$,{tileID:ye,tileSize:N}):xy(Ne,S,w,x.toRenderColor(d.lut));g.uploadCommonUniforms(C,Se,Ie);const{tileBoundsBuffer:Be,tileBoundsIndexBuffer:Re,tileBoundsSegments:Je}=g.getTileBoundsBuffers(Fe);Se.draw(g,k.TRIANGLES,ne,te,ie,a.ag.disabled,We,d.id,Be,Re,Je)}},sky:function(g,l,d){const _=g._atmosphere?a.a2(g.transform.zoom):1,x=d.paint.get("sky-opacity")*_;if(x===0)return;const w=g.context,S=d.paint.get("sky-type"),C=new a.af(w.gl.LEQUAL,a.af.ReadOnly,[0,1]),k=g.frameCounter/1e3%1;S==="atmosphere"?g.renderPass==="offscreen"?d.needsSkyboxCapture(g)&&(function(L,N,U,$){const q=L.context,te=q.gl;let ne=N.skyboxFbo;if(!ne){ne=N.skyboxFbo=q.createFramebuffer(32,32,!0,null),N.skyboxGeometry=new Yt(q),N.skyboxTexture=q.gl.createTexture(),te.bindTexture(te.TEXTURE_CUBE_MAP,N.skyboxTexture),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MAG_FILTER,te.LINEAR);for(let xe=0;xe<6;++xe)te.texImage2D(te.TEXTURE_CUBE_MAP_POSITIVE_X+xe,0,te.RGBA,32,32,0,te.RGBA,te.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(ne.framebuffer),q.viewport.set([0,0,32,32]);const ie=N.getCenter(L,!0),ae=L.getOrCreateProgram("skyboxCapture"),ve=new Float64Array(16);a.ae.identity(ve),a.ae.rotateY(ve,ve,.5*-Math.PI),pr(L,N,ae,ve,ie,0),a.ae.identity(ve),a.ae.rotateY(ve,ve,.5*Math.PI),pr(L,N,ae,ve,ie,1),a.ae.identity(ve),a.ae.rotateX(ve,ve,.5*-Math.PI),pr(L,N,ae,ve,ie,2),a.ae.identity(ve),a.ae.rotateX(ve,ve,.5*Math.PI),pr(L,N,ae,ve,ie,3),a.ae.identity(ve),pr(L,N,ae,ve,ie,4),a.ae.identity(ve),a.ae.rotateY(ve,ve,Math.PI),pr(L,N,ae,ve,ie,5),q.viewport.set([0,0,L.width,L.height])}(g,d),d.markSkyboxValid(g)):g.renderPass==="sky"&&function(L,N,U,$,q){const te=L.context,ne=te.gl,ie=L.transform,ae=L.getOrCreateProgram("skybox");te.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_CUBE_MAP,N.skyboxTexture);const ve=((xe,ye,Me,Se,Ie)=>({u_matrix:xe,u_sun_direction:ye,u_cubemap:0,u_opacity:Se,u_temporal_offset:Ie}))(ie.skyboxMatrix,N.getCenter(L,!1),0,$,q);L.uploadCommonUniforms(te,ae),ae.draw(L,ne.TRIANGLES,U,a.ah.disabled,L.colorModeForRenderPass(),a.ag.backCW,ve,"skybox",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(g,d,C,x,k):S==="gradient"&&g.renderPass==="sky"&&function(L,N,U,$,q){const te=L.context,ne=te.gl,ie=L.transform,ae=L.getOrCreateProgram("skyboxGradient");N.skyboxGeometry||(N.skyboxGeometry=new Yt(te)),te.activeTexture.set(ne.TEXTURE0);let ve=N.colorRampTexture;ve||(ve=N.colorRampTexture=new a.T(te,N.colorRamp,ne.RGBA)),ve.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const xe=((ye,Me,Se,Ie,Ne)=>({u_matrix:ye,u_color_ramp:0,u_center_direction:Me,u_radius:a.ac(Se),u_opacity:Ie,u_temporal_offset:Ne}))(ie.skyboxMatrix,N.getCenter(L,!1),N.paint.get("sky-gradient-radius"),$,q);L.uploadCommonUniforms(te,ae),ae.draw(L,ne.TRIANGLES,U,a.ah.disabled,L.colorModeForRenderPass(),a.ag.backCW,xe,"skyboxGradient",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(g,d,C,x,k)},debug:function(g,l,d,_,x,w){for(let S=0;S<d.length;S++)if(x){const L=new a.C(_.r*.8,_.g*.8,_.b*.8,1);wn(g,l,d[S],_,-1,-1,w),wn(g,l,d[S],_,-1,1,w),wn(g,l,d[S],_,1,1,w),wn(g,l,d[S],_,1,-1,w),wn(g,l,d[S],L,0,0,w)}else wn(g,l,d[S],_,0,0,w)},custom:function(g,l,d,_){const x=g.context,w=d.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&d.isDraped(l)){if(g.renderPass==="offscreen"){const S=w.prerender;if(S){if(g.setCustomLayerDefaults(),x.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const C=g.transform.pointMerc;S.call(w,x.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),a.a2(g.transform.zoom),[C.x,C.y],g.transform.pixelsPerMeterRatio)}else S.call(w,x.gl,g.transform.customLayerMatrix());x.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const C=w.renderToTile;if(C){const k=_[0].canonical,L=new a._(k.x+_[0].wrap*(1<<k.z),k.y,k.z);x.setDepthMode(a.af.disabled),x.setStencilMode(a.ah.disabled),x.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),C.call(w,x.gl,L),x.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),x.setColorMode(g.colorModeForRenderPass()),x.setStencilMode(a.ah.disabled);const S=w.renderingMode==="3d"?new a.af(g.context.gl.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,a.af.ReadOnly);if(x.setDepthMode(S),g.transform.projection.name==="globe"){const C=g.transform.pointMerc;w.render(x.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),a.a2(g.transform.zoom),[C.x,C.y],g.transform.pixelsPerMeterRatio)}else w.render(x.gl,g.transform.customLayerMatrix());x.setDirty(),g.setBaseState(),x.bindFramebuffer.set(null)}}else a.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,l,d,_){if(g.renderPass==="opaque")return;const x=d.paint.get("model-opacity");if(x===0)return;const w=d.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!w||g.terrain&&x<.65&&d._transitionablePaint._values["model-opacity"].value.expression instanceof a.Z))return;const S=g.shadowRenderer,C=d.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,C||(S.enabled=!1));const k=()=>{S&&(S.useNormalOffset=!0,C||(S.enabled=!0))},L=l.getSource();if(g.renderPass==="light-beam"&&L.type!=="batched-model")return;if(L.type==="vector"||L.type==="geojson")return function(ae,ve,xe,ye,Me){const Se=ae.transform;if(Se.projection.name!=="mercator")return void a.w(`Drawing 3D models for ${Se.projection.name} projection is not yet implemented`);const Ie=Se.getFreeCameraOptions().position;if(!ae.modelManager)return;const Ne=ae.modelManager;xe.modelManager=Ne;const Fe=ae.shadowRenderer;if(!xe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const We=xe._unevaluatedLayout._values["model-id"],Be={...xe.layout.get("model-id").parameters},Re=ae.style.order.indexOf(xe.fqid);for(const Je of ye){const Ye=ve.getTile(Je).getBucket(xe);if(!Ye||Ye.projection.name!==Se.projection.name)continue;const je=Ye.getModelUris();je&&!Ye.modelsRequested&&(Ne.addModelsFromBucket(je,Me),Ye.modelsRequested=!0);const vt=jf(Je,Se);Be.zoom=vt;const dt=We.possiblyEvaluate(Be);if(Vf(ae,Ye,Je),wa.shadowUniformsInitialized=!1,wa.useSingleShadowCascade=!!Fe&&Fe.getMaxCascadeForTile(Je.toUnwrapped())===0,ae.renderPass==="shadow"&&Fe){if(ae.currentShadowCascade===1&&Ye.isInsideFirstShadowMapFrustum)continue;const Ue=Se.calculatePosMatrix(Je.toUnwrapped(),Se.worldSize);if(wa.tileMatrix.set(Ue),wa.shadowTileMatrix=Float32Array.from(Fe.calculateShadowPassMatrixFromMatrix(Ue)),wa.aabb.min.fill(0),wa.aabb.max[0]=wa.aabb.max[1]=a.a4,wa.aabb.max[2]=0,uo(Ye,wa,ae,xe.scope))continue}const He=1<<Je.canonical.z,it=[((Ie.x-Je.wrap)*He-Je.canonical.x)*a.a4,(Ie.y*He-Je.canonical.y)*a.a4,Ie.z*He*a.a4];ae.conflationActive&&Object.keys(Ye.instancesPerModel).length>0&&ae.style.isLayerClipped(xe,ve.getSource())&&Ye.updateReplacement(Je,ae.replacementSource,Re,Me)&&(Ye.uploaded=!1,Ye.upload(ae.context));for(let Ue in Ye.instancesPerModel){const ft=Ye.instancesPerModel[Ue];ft.features.length>0&&(Ue=dt.evaluate(ft.features[0].feature,{}));const gt=Ne.getModel(Ue,Me);if(gt&&gt.uploaded)for(const Ut of gt.nodes)Lm(ae,xe,Ut,ft,it,Je,wa)}}}(g,l,d,_,L.type==="vector"?d.scope:""),void k();if(!L.loaded())return;if(L.type==="batched-model")return function(ae,ve,xe,ye){xe.resetLayerRenderingStats(ae);const Me=ae.context,Se=ae.transform,Ie=ae.style.fog,Ne=ae.shadowRenderer;if(Se.projection.name!=="mercator")return void a.w(`Drawing 3D landmark models for ${Se.projection.name} projection is not yet implemented`);const Fe=ae.transform.getFreeCameraOptions().position,We=a.$.scale([],[Fe.x,Fe.y,Fe.z],ae.transform.worldSize);a.$.negate(We,We);const Be=a.ae.identity([]),Re=a.ci(Se.center.lat,Se.zoom),Je=a.ae.fromScaling([],[1,1,1/Re]);a.ae.translate(Be,Be,We);const Ye=xe.paint.get("model-opacity"),je=new a.af(Me.gl.LEQUAL,a.af.ReadWrite,ae.depthRangeFor3D),vt=new a.af(Me.gl.LEQUAL,a.af.ReadOnly,ae.depthRangeFor3D),dt=new a.b8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),He=ae.renderPass==="shadow",it=He&&Ne?Ne.getCurrentCascadeFrustum():Se.getFrustum(Se.scaleZoom(Se.worldSize)),Ue=xe.paint.get("model-front-cutoff"),ft=Ue[2]<1,gt=Rs(ae,xe.paint.get("model-cutoff-fade-range")),Ut=xe.getLayerRenderingStats();(function($t,tn,qt,bn){const Fn=$t.terrain?$t.terrain.exaggeration():0,Tn=$t.transform.zoom;for(const jn of bn){const or=tn.getTile(jn).getBucket(qt);or&&($t.conflationActive&&or.updateReplacement(jn,$t.replacementSource),or.evaluateScale($t,qt),$t.terrain&&Fn>0&&or.elevationUpdate($t.terrain,Fn,jn,qt.source),or.needsReEvaluation($t,Tn,qt)&&or.evaluate(qt))}})(ae,ve,xe,ye),function(){let $t,tn,qt;ft?($t=ye.length-1,tn=-1,qt=-1):($t=0,tn=ye.length,qt=1);for(let bn=$t;bn!==tn;bn+=qt){const Fn=ye[bn],Tn=ve.getTile(Fn).getBucket(xe);if(!Tn||!Tn.uploaded)continue;let jn=!1;Ne&&(jn=Ne.getMaxCascadeForTile(Fn.toUnwrapped())===0);const or=Se.calculatePosMatrix(Fn.toUnwrapped(),Se.worldSize),Zr=Tn.modelTraits,zr=[];for(const cr of Tn.getNodesInfo()){if(cr.hiddenByReplacement||!cr.node.meshes)continue;const Or=cr.node;let qn=0;ae.terrain&&Or.elevation&&(qn=Or.elevation*ae.terrain.exaggeration());const Xn=cr.evaluatedScale;if(Xn[0]<=1&&Xn[1]<=1&&Xn[2]<=1&&(()=>{const Bs=cr.aabb;return dt.min=[...Bs.min],dt.max=[...Bs.max],dt.min[2]+=qn,dt.max[2]+=qn,a.$.transformMat4(dt.min,dt.min,or),a.$.transformMat4(dt.max,dt.max,or),dt})().intersects(it)===0)continue;const Bn=[...or],mr=Or.anchor?Or.anchor[0]:0,Jn=Or.anchor?Or.anchor[1]:0;a.ae.translate(Bn,Bn,[mr*(Xn[0]-1),Jn*(Xn[1]-1),qn]),a.$.exactEquals(Xn,a.cl)||a.ae.scale(Bn,Bn,Xn);const An=a.ae.multiply([],Bn,Or.matrix),Fi=a.ae.multiply([],Se.expandedFarZProjMatrix,An),Bi=a.ae.multiply([],Se.expandedFarZProjMatrix,Bn),Qs=a.aB.transformMat4([],[mr,Jn,qn,1],Fi)[2];Or.hidden=!1;let Js=Ye;He||(ft&&(Js*=P1(Bn,Se,cr.aabb,Ue)),Js*=ta(gt,Qs)),Js!==0?zr.push({nodeInfo:cr,depth:Qs,opacity:Js,wvpForNode:Fi,wvpForTile:Bi,nodeModelMatrix:An,tileModelMatrix:Bn}):Or.hidden=!0}He||zr.sort((cr,Or)=>!ft||cr.opacity===1&&Or.opacity===1?cr.depth<Or.depth?-1:1:cr.opacity===1?-1:Or.opacity===1?1:cr.depth>Or.depth?-1:1);for(const cr of zr){const Or=cr.nodeInfo,qn=Or.node;let Xn=a.ae.multiply([],Je,cr.tileModelMatrix);a.ae.multiply(Xn,Be,Xn);const Bn=a.ae.invert([],Xn);a.ae.transpose(Bn,Bn),a.ae.scale(Bn,Bn,zm),Xn=a.ae.multiply(Xn,Xn,qn.matrix);const mr=ae.renderPass==="light-beam",Jn=Zr&a.cn.HasMapboxMeshFeatures,An=Jn?0:Or.evaluatedRMEA[0][2];for(let Fi=0;Fi<qn.meshes.length;++Fi){const Bi=qn.meshes[Fi],Qs=Fi===qn.lightMeshIndex;let Js=cr.wvpForNode;if(Qs){if(!mr&&!ae.terrain&&ae.shadowRenderer){ae.currentLayer<ae.firstLightBeamLayer&&(ae.firstLightBeamLayer=ae.currentLayer);continue}Js=cr.wvpForTile}else if(mr)continue;const Bs={defines:[]},eo=[];if(Gu(Bs.defines,eo,Bi,ae,xe.lut),Jn||Bs.defines.push("DIFFUSE_SHADED"),jn&&Bs.defines.push("SHADOWS_SINGLE_CASCADE"),Ut&&(He?Ut.numRenderedVerticesInShadowPass+=Bi.vertexArray.length:Ut.numRenderedVerticesInTransparentPass+=Bi.vertexArray.length),He){Py(Bi,cr.nodeModelMatrix,ae,xe);continue}let Ms=null;if(Ie){const Qe=rd(cr.nodeModelMatrix,ae.transform);if(Ms=new Float32Array(Qe),Se.projection.name!=="globe"){const sc=Bi.aabb.min,Wa=Bi.aabb.max,[oc,ac]=Ie.getOpacityForBounds(Qe,sc[0],sc[1],Wa[0],Wa[1]);Bs.overrideFog=oc>=fr||ac>=fr}}const Us=Bi.material;let It;Us.occlusionTexture&&Us.occlusionTexture.offsetScale&&(It=Us.occlusionTexture.offsetScale,Bs.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!He&&Ne&&(Ne.useNormalOffset=!!Bi.normalBuffer);const sn=ae.getOrCreateProgram("model",Bs);!He&&Ne&&Ne.setupShadowsFromMatrix(cr.tileModelMatrix,sn,Ne.useNormalOffset),ae.uploadCommonUniforms(Me,sn,null,Ms);const ho=Us.pbrMetallicRoughness;ho.metallicFactor=.9,ho.roughnessFactor=.5;const jr=Uu(new Float32Array(Js),new Float32Array(Xn),new Float32Array(Bn),new Float32Array(qn.matrix),ae,cr.opacity,ho.baseColorFactor.toRenderColor(null),Us.emissiveFactor,ho.metallicFactor,ho.roughnessFactor,Us,An,xe,[0,0,0],It);!Qs&&(Or.hasTranslucentParts||cr.opacity<1)&&sn.draw(ae,Me.gl.TRIANGLES,je,a.ah.disabled,a.a.disabled,a.ag.backCCW,jr,xe.id,Bi.vertexBuffer,Bi.indexBuffer,Bi.segments,xe.paint,ae.transform.zoom,void 0,eo),sn.draw(ae,Me.gl.TRIANGLES,Qs?vt:je,a.ah.disabled,Qs||cr.opacity<1||Or.hasTranslucentParts?a.a.alphaBlended:a.a.unblended,a.ag.backCCW,jr,xe.id,Bi.vertexBuffer,Bi.indexBuffer,Bi.segments,xe.paint,ae.transform.zoom,void 0,eo)}}}}()}(g,l,d,_),void k();if(L.type!=="model")return;const N=L.getModels(),U=[],$=g.transform.getFreeCameraOptions().position,q=a.$.scale([],[$.x,$.y,$.z],g.transform.worldSize);a.$.negate(q,q);const te=[],ne=[];let ie=0;for(const ae of N){const ve=d.paint.get("model-rotation").constantOr(null),xe=d.paint.get("model-scale").constantOr(null),ye=d.paint.get("model-translation").constantOr(null);ae.computeModelMatrix(g,ve,xe,ye,!0,!0,!1);const Me=a.ae.identity([]),Se=a.ci(ae.position.lat,g.transform.zoom),Ie=a.ae.fromScaling([],[1,1,1/Se]);a.ae.translate(Me,Me,q),U.push({zScaleMatrix:Ie,negCameraPosMatrix:Me});for(const Ne of ae.nodes)Ci(g.transform,Ne,ae.matrix,g.transform.expandedFarZProjMatrix,ie,te,ne);ie++}if(te.sort((ae,ve)=>ve.depth-ae.depth),g.renderPass!=="shadow"){if(x===1)for(const ae of ne)Ks(ae,g,d,U[ae.modelIndex],a.ah.disabled,g.colorModeForRenderPass());else{for(const ae of ne)Ks(ae,g,d,U[ae.modelIndex],a.ah.disabled,a.a.disabled);for(const ae of ne)Ks(ae,g,d,U[ae.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}for(const ae of te)Ks(ae,g,d,U[ae.modelIndex],a.ah.disabled,g.colorModeForRenderPass());k()}else{for(const ae of ne)Py(ae.mesh,ae.nodeModelMatrix,g,d);for(const ae of te)Py(ae.mesh,ae.nodeModelMatrix,g,d);k()}}},hs={model:function(g,l,d){const _=l.getSource();if(!_.loaded())return;if(_.type==="vector"||_.type==="geojson")return void(d.modelManager&&d.modelManager.upload(d,_.type==="vector"?g.scope:""));if(_.type==="batched-model"||_.type!=="model")return;const x=_.getModels();for(const w of x)w.upload(d.context)},raster:function(g,l,d){const _=l.getSource();if(!(_ instanceof R&&_.loaded()))return;const x=g.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!x)return;const w=g.paint.get("raster-array-band")||_.getInitialBand(x);if(w==null)return;const S=l.getIds().map(C=>l.getTileByID(C));for(const C of S)C.updateNeeded(x,w)&&_.prepareTile(C,x,w)},"raster-particle":function(g,l,d){const _=l.getSource();if(!(_ instanceof R&&_.loaded()))return;const x=g.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!x)return;const w=g.paint.get("raster-particle-array-band")||_.getInitialBand(x);if(w==null)return;const S=l.getIds().map(C=>l.getTileByID(C));for(const C of S)C.updateNeeded(x,w)&&_.prepareTile(C,x,w)}};class Ry{constructor(l,d,_,x){this.context=new Li(l,d),this.transform=_,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=a.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const C of w)this._debugParams.enabledLayers[C]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const C of w)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],C);this.occlusionParams=new Ga(x),this.setup(),this.numSublayers=a.bx.maxUnderzooming+a.bx.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.cp,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Sm(this),this._wireframeDebugCache=new ts,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const S=new a.j({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new a.T(this.context,S,l.RGBA)}updateTerrain(l,d){const _=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Qt(this,l));const x=this._terrain;this.transform.elevation=_?x:null,x.update(l,this.transform,d),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(l){const d=l.fog;if(!d||this.transform.projection.name==="globe"||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,x]=d.getFovAdjustedRange(this.transform._fov);if(_>x)return void(this.transform.fogCullDistSq=null);const w=_+.78*(x-_);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(l){l&&!this._terrain&&(this._terrain=new Qt(this,this.style)),this._forceTerrainMode=l}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(l,d){if(this.width=l*a.e.devicePixelRatio,this.height=d*a.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._mergedLayers[_].resize()}setup(){const l=this.context,d=new a.bv;d.emplaceBack(0,0),d.emplaceBack(a.a4,0),d.emplaceBack(0,a.a4),d.emplaceBack(a.a4,a.a4),this.tileExtentBuffer=l.createVertexBuffer(d,a.bt.members),this.tileExtentSegments=a.b.simpleSegment(0,0,4,2);const _=new a.bv;_.emplaceBack(0,0),_.emplaceBack(a.a4,0),_.emplaceBack(0,a.a4),_.emplaceBack(a.a4,a.a4),this.debugBuffer=l.createVertexBuffer(_,a.bt.members),this.debugSegments=a.b.simpleSegment(0,0,4,5);const x=new a.bv;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(x,a.bt.members),this.viewportSegments=a.b.simpleSegment(0,0,4,2);const w=new a.cq;w.emplaceBack(0,0,0,0),w.emplaceBack(a.a4,0,a.a4,0),w.emplaceBack(0,a.a4,0,a.a4),w.emplaceBack(a.a4,a.a4,a.a4,a.a4),this.mercatorBoundsBuffer=l.createVertexBuffer(w,a.cr.members),this.mercatorBoundsSegments=a.b.simpleSegment(0,0,4,2);const S=new a.bw;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(S);const C=new a.cs;for(const L of[0,1,3,2,0])C.emplaceBack(L);this.debugIndexBuffer=l.createIndexBuffer(C),this.emptyTexture=new a.T(l,new a.j({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=a.ae.create();const k=this.context.gl;this.stencilClearMode=new a.ah({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,l.TRIANGLES,a.af.disabled,this.stencilClearMode,a.a.disabled,a.ag.disabled,$c(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,d,_){if(!d||this.currentStencilSource===d.id||!l.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const k of _)if(this._tileClippingMaskIDs[k.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=d.id;const x=this.context,w=x.gl;this.nextStencilID+_.length>256&&this.clearStencil(),x.setColorMode(a.a.disabled),x.setDepthMode(a.af.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of _){const k=d.getTile(C),L=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:N,tileBoundsIndexBuffer:U,tileBoundsSegments:$}=this.getTileBoundsBuffers(k);S.draw(this,w.TRIANGLES,a.af.disabled,new a.ah({func:w.ALWAYS,mask:0},L,255,w.KEEP,w.KEEP,w.REPLACE),a.a.disabled,a.ag.disabled,$c(C.projMatrix),"$clipping",N,U,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,d=this.context.gl;return new a.ah({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const d=this.context.gl;return new a.ah({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(l){const d=this.context.gl,_=l.sort((S,C)=>C.overscaledZ-S.overscaledZ),x=_[_.length-1].overscaledZ,w=_[0].overscaledZ-x+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const S={};for(let C=0;C<w;C++)S[C+x]=new a.ah({func:d.GEQUAL,mask:255},C+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=w,[S,_]}return[{[x]:a.ah.disabled},_]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new a.a([l.CONSTANT_COLOR,l.ONE,l.CONSTANT_COLOR,l.ONE],new a.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.a.unblended:a.a.alphaBlended}colorModeForDrapableLayerRenderPass(l){const d=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new a.a([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.CONSTANT_ALPHA,d.ONE_MINUS_SRC_ALPHA],new a.C(0,0,0,l===void 0?0:l),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(l,d,_,x=!1){if(this.depthOcclusion)return new a.af(this.context.gl.GREATER,a.af.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return a.af.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new a.af(_||this.context.gl.LEQUAL,d,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const l=this.context.gl,d=Math.ceil(this.width),_=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),w=l.getParameter(l.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===d&&this.depthFBO.height===_||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),d!==0&&_!==0&&(this.depthFBO=new Lr(this.context,d,_,!1,"texture"),this.depthTexture=new a.T(this.context,{width:d,height:_,data:null},l.DEPTH_STENCIL),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),l.bindTexture(l.TEXTURE_2D,w),this.depthFBO&&(l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),l.blitFramebuffer(0,0,d,_,0,0,d,_,l.DEPTH_BUFFER_BIT,l.NEAREST),l.bindFramebuffer(l.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((l,d)=>l+d/this._fpsHistory.length,0))}render(l,d){const _=a.e.now();this._dt=_-this._timeStamp,this._timeStamp=_,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=l.map.repaint,this.style=l,this.options=d;const x=this.style._mergedLayers,w=this.style.order.filter(Be=>{const Re=x[Be];return!(Re.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Re.type]});let S=!1,C=!1;for(const Be of w){const Re=x[Be];Re.type==="circle"&&(S=!0),Re.type==="symbol"&&(Re.hasInitialOcclusionOpacityProperties?C=!0:S=!0)}const k=w.map(Be=>x[Be]),L=this.style._mergedSourceCaches;this.imageManager=l.imageManager,this.modelManager=l.modelManager,this.symbolFadeChange=l.placement.symbolFadeChange(a.e.now()),this.imageManager.beginFrame();let N=0,U=!1;for(const Be in L){const Re=L[Be];Re.used&&(Re.prepare(this.context),Re.getSource().usedInConflation&&++N)}let $=!1;for(const Be of k)Be.isHidden(this.transform.zoom)||(Be.type==="clip"&&($=!0),this.prepareLayer(Be));const q={},te={},ne={},ie={},ae={};for(const Be in L){const Re=L[Be];q[Be]=Re.getVisibleCoordinates(),te[Be]=q[Be].slice().reverse(),ne[Be]=Re.getVisibleCoordinates(!0).reverse(),ie[Be]=Re.getShadowCasterCoordinates(),ae[Be]=Re.sortCoordinatesByDistance(q[Be])}const ve=Be=>{const Re=this.style.getLayerSourceCache(Be);return Re&&Re.used?Re.getSource():null};if(N||$){const Be=[],Re=[];let Je=0;for(const Ye of k)this.isSourceForClippingOrConflation(Ye,ve(Ye))&&(Be.push(Ye),Re.push(Je)),Je++;if(Be&&($||Be.length>1)){const Ye=[];for(let je=0;je<Be.length;je++){const vt=Be[je],dt=Re[je],He=this.style.getLayerSourceCache(vt);if(!He||!He.used||!He.getSource().usedInConflation&&vt.type!=="clip")continue;let it=a.cv,Ue=a.cw.None;const ft=[];if(vt.type==="clip"){it=dt;for(const gt of vt.layout.get("clip-layer-types"))Ue|=gt==="model"?a.cw.Model:gt==="symbol"?a.cw.Symbol:a.cw.FillExtrusion;for(const gt of vt.layout.get("clip-layer-scope"))ft.push(gt)}Ye.push({layer:vt.fqid,cache:He,order:it,clipMask:Ue,clipScope:ft})}this.replacementSource.setSources(Ye),U=!0}}U||this.replacementSource.clear(),this.conflationActive=U,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Be=0;Be<k.length;Be++){const Re=k[Be],Je=Re.cutoffRange();if(this.longestCutoffRange=Math.max(Je,this.longestCutoffRange),Je>0){const Ye=ve(Re);Ye&&(this.minCutoffZoom=Math.max(Ye.minzoom,this.minCutoffZoom)),Re.minzoom&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom))}Re.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Be),this._lastOcclusionLayer=Be)}const xe=this.style&&this.style.fog;xe?(this._fogVisible=xe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=xe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ne),this.opaquePassCutoff=0);const ye=this._shadowRenderer;if(ye){ye.updateShadowParameters(this.transform,this.style.directionalLight);for(const Be in L)for(const Re of q[Be]){let Je={min:0,max:0};this.terrain&&(Je=this.terrain.getMinMaxForTile(Re)||Je),ye.addShadowReceiver(Re.toUnwrapped(),Je.min,Je.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.ct(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Om(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!a.cu(this.context.gl))return;this.renderPass="offscreen";for(const Be of k){const Re=l.getLayerSourceCache(Be);if(!Be.hasOffscreenPass()||Be.isHidden(this.transform.zoom))continue;const Je=Re?te[Re.id]:void 0;(Be.type==="custom"||Be.type==="raster"||Be.type==="raster-particle"||Be.isSky()||Je&&Je.length)&&this.renderLayer(this,Re,Be,Je)}this.depthRangeFor3D=[0,1-(k.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ie)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Me=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Se=(()=>{if(d.showOverdrawInspector)return a.C.black;const Be=this.style.fog;if(Be&&this.transform.projection.supportsFog){const Re=this.style.getLut(Be.scope);if(!Me){const Je=Be.properties.get("color").toRenderColor(Re).toArray01();return new a.C(...Je)}if(Me){const Je=Be.properties.get("space-color").toRenderColor(Re).toArray01();return new a.C(...Je)}}return a.C.transparent})();if(this.context.clear({color:Se,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Me&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const Be=k[this.currentLayer],Re=l.getLayerSourceCache(Be);if(Be.isSky())continue;const Je=Re?(Be.is3D()?ae:te)[Re.id]:void 0;this._renderTileClippingMasks(Be,Re,Je),this.renderLayer(this,Re,Be,Je)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Me&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.a2(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const Be=k[this.currentLayer],Re=l.getLayerSourceCache(Be);Be.isSky()&&this.renderLayer(this,Re,Be,Re?te[Re.id]:void 0)}function Ie(Be,Re){let Je;return Re&&(Je=(Be.type==="symbol"?ne:Be.is3D()?ae:te)[Re.id]),Je}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){const Be=k[this.currentLayer];if(Be.type==="raster"||Be.type==="raster-particle"){const Re=l.getLayerSourceCache(Be);this.renderLayer(this,Re,Be,Ie(Be,Re))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ne=0;ye&&(Ne=ye.getShadowCastingLayerCount());let Fe=!1,We=-1;for(let Be=0;Be<w.length;++Be){const Re=k[Be];Re.isHidden(this.transform.zoom)||Re.is3D()&&(We=Be)}for(C&&We===-1&&(S=!0);this.currentLayer<w.length;){const Be=k[this.currentLayer],Re=l.getLayerSourceCache(Be);if(Be.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Be)){if(Be.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(S&&!Fe&&this.terrain&&!this.transform.isOrthographic&&(Fe=!0,this.blitDepth()),C&&We!==-1&&this.currentLayer===We+1&&!this.transform.isOrthographic&&this.blitDepth(),Be.is3D()||this.terrain||this._renderTileClippingMasks(Be,Re,Re?q[Re.id]:void 0),this.renderLayer(this,Re,Be,Ie(Be,Re)),!this.terrain&&ye&&Ne>0&&Be.hasShadowPass()&&--Ne==0&&(ye.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Je=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Je;this.currentLayer++){const Ye=k[this.currentLayer];if(!Ye.hasLightBeamPass())continue;const je=l.getLayerSourceCache(Ye);this.renderLayer(this,je,Ye,je?te[je.id]:void 0)}this.currentLayer=Je,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Je=this.currentLayer;this.depthOcclusion=!0;for(const Ye of this.layersWithOcclusionOpacity){this.currentLayer=Ye;const je=k[this.currentLayer],vt=l.getLayerSourceCache(je),dt=vt?te[vt.id]:void 0;je.is3D()||this.terrain||this._renderTileClippingMasks(je,vt,vt?q[vt.id]:void 0),this.renderLayer(this,vt,je,dt)}this.depthOcclusion=!1,this.currentLayer=Je,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Be=null;k.forEach(Re=>{const Je=l.getLayerSourceCache(Re);Je&&!Re.isHidden(this.transform.zoom)&&Je.getVisibleCoordinates().length&&(!Be||Be.getSource().maxzoom<Je.getSource().maxzoom)&&(Be=Je)}),Be&&this.options.showTileBoundaries&&qa.debug(this,Be,Be.getVisibleCoordinates(),a.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&qa.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Be){const Re=Be.transform.padding;Ay(Be,Be.transform.height-(Re.top||0),3,Sy),Ay(Be,Re.bottom||0,3,Dm),Uf(Be,Re.left||0,3,Iy),Uf(Be,Be.transform.width-(Re.right||0),3,wr);const Je=Be.transform.centerPoint;(function(Ye,je,vt,dt){td(Ye,je-1,vt-10,2,20,dt),td(Ye,je-10,vt-1,20,2,dt)})(Be,Je.x,Be.transform.height-Je.y,$I)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),U||(this.conflationActive=!1)}prepareLayer(l){this.gpuTimingStart(l);const{unsupportedLayers:d}=this.transform.projection,_=!d||!d.includes(l.type);if(hs[l.type]&&(_||this.terrain&&l.type==="custom")){const x=this.style.getLayerSourceCache(l);hs[l.type](l,x,this)}this.gpuTimingEnd()}renderLayer(l,d,_,x){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||_.type==="model"||_.type==="raster"||_.type==="raster-particle"||x&&x.length)&&(this.id=_.id,this.gpuTimingStart(_),l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes(_.type)&&(!l.terrain||_.type!=="custom")||_.type==="clip"||qa[_.type](l,d,_,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery,_=this.context.gl;let x=this.gpuTimers[l.id];x||(x=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:_.createQuery()}),x.calls++,_.beginQuery(d.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,d=this.context.gl,_=d.createQuery();this.deferredRenderGpuTimeQueries.push(_),d.beginQuery(l.TIME_ELAPSED_EXT,_)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const d={};for(const _ in l){const x=l[_],w=this.context.extTimerQuery,S=w.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(x.query),d[_]=S}return d}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.extTimerQuery,_=this.context.gl;let x=0;for(const w of l)x+=d.getQueryParameter(w,_.QUERY_RESULT)/1e6,d.deleteQueryEXT(w);return x}translatePosMatrix(l,d,_,x,w){if(!_[0]&&!_[1])return l;const S=w?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(S){const L=Math.sin(S),N=Math.cos(S);_=[_[0]*N-_[1]*L,_[0]*L+_[1]*N]}const C=[w?_[0]:a.bD(d,_[0],this.transform.zoom),w?_[1]:a.bD(d,_[1],this.transform.zoom),0],k=new Float32Array(16);return a.ae.translate(k,l,C),k}saveTileTexture(l){const d=l.size[0],_=this._tileTextures[d];_?_.push(l):this._tileTextures[d]=[l]}getTileTexture(l){const d=this._tileTextures[l];return d&&d.length>0?d.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(l,d,_){const x=_===void 0?this.terrain&&this.terrain.renderingToTexture:_,w=[];return this.style&&this.style.enable3dLights()&&(l==="globeRaster"||l==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||w.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?w.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):w.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||x||d!==void 0&&!d||w.push("FOG","FOG_DITHERING"),x&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(l,d){this.cache=this.cache||{};const _=d&&d.defines||[],x=d&&d.config,w=this.currentGlobalDefines(l,d&&d.overrideFog,d&&d.overrideRtt).concat(_),S=Es.cacheKey(Dc[l],l,w,x);return this.cache[S]||(this.cache[S]=new Es(this.context,l,Dc[l],x,w1[l],w)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(l,d){if(this.style.enable3dLights()){const _=this.style.directionalLight,x=this.style.ambientLight;if(_&&x){const w=((S,C,k)=>{const L=S.properties.get("direction"),N=S.properties.get("color").toRenderColor(k.getLut(S.scope)).toArray01(),U=S.properties.get("intensity"),$=C.properties.get("color").toRenderColor(k.getLut(C.scope)).toArray01(),q=C.properties.get("intensity"),te=[L.x,L.y,L.z],ne=a.bC($,q),ie=a.bC(N,U);return{u_lighting_ambient_color:ne,u_lighting_directional_dir:te,u_lighting_directional_color:ie,u_ground_radiance:ri(te,ie,ne)}})(_,x,this.style);d.setLightsUniformValues(l,w)}}}uploadCommonUniforms(l,d,_,x,w){if(this.uploadCommonLightUniforms(l,d),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const C=S.getOpacity(this.transform.pitch),k=((L,N,U,$,q,te,ne,ie,ae,ve,xe,ye)=>{const Me=L.transform,Se=N.properties.get("color").toRenderColor(L.style.getLut(N.scope)).toArray01();Se[3]=$;const Ie=L.frameCounter/1e3%1,[Ne,Fe]=N.properties.get("vertical-range");return{u_fog_matrix:U?Me.calculateFogTileMatrix(U):ye||L.identityMat,u_fog_range:N.getFovAdjustedRange(Me._fov),u_fog_color:Se,u_fog_horizon_blend:N.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ne,Fe),Fe],u_fog_temporal_offset:Ie,u_frustum_tl:q,u_frustum_tr:te,u_frustum_br:ne,u_frustum_bl:ie,u_globe_pos:ae,u_globe_radius:ve,u_viewport:xe,u_globe_transition:a.a2(Me.zoom),u_is_globe:+(Me.projection.name==="globe")}})(this,S,_,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.e.devicePixelRatio,this.transform.height*a.e.devicePixelRatio],x);d.setFogUniformValues(l,k)}w&&d.setCutoffUniformValues(l,w.uniformValues)}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,d=l.createTexture();return l.bindTexture(l.TEXTURE_2D,d),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const l=this._backgroundTiles,d=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const x of _)d[x.key]=l[x.key]||new a.bA(x,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(l,d){return!(!l.is3D()||l.minzoom&&l.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||l.sourceLayer!=="building")&&l.type!=="clip"&&(!d||d.type!=="batched-model"))}isTileAffectedByFog(l){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let d=this._cachedTileFogOpacities[l.key];return d||(this._cachedTileFogOpacities[l.key]=d=this.style.fog.getOpacityForTile(l)),d[0]>=fr||d[1]>=fr}setupDepthForOcclusion(l,d,_){const x=this.context,w=x.gl,S=!!_;var C;_||(_={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(w.TEXTURE3),l&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),_.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],_.u_depth_range_unpack=[2/((C=this.depthRangeFor3D)[1]-C[0]),-1-2*C[0]/(C[1]-C[0])],_.u_occluder_half_size=.5*this.occlusionParams.occluderSize,_.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),x.activeTexture.set(w.TEXTURE0),S||d.setTerrainUniformValues(x,_)}}class na{constructor(l,d,_,x){this.screenBounds=l,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(l,d){let _,x;if(l instanceof a.P||typeof l[0]=="number"){const w=a.P.convert(l);_=[w],x=d.isPointAboveHorizon(w)}else{const w=a.P.convert(l[0]),S=a.P.convert(l[1]);_=[w,S],x=a.cx(w,S).every(C=>d.isPointAboveHorizon(C))}return new na(_,d.getCameraPoint(),x,d)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return a.cx(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const d=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],x=a.cx(d,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<_.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?x[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(x[3]=this.cameraPoint)),a.cy(x,l)}bufferedCameraGeometryGlobe(l){const d=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],x=a.cx(d,_,l),w=this.cameraPoint.clone();switch(3*((w.y>d.y)+(w.y>_.y))+((w.x>d.x)+(w.x>_.x))){case 0:x[0]=w,x[4]=w.clone();break;case 1:x.splice(1,0,w);break;case 2:x[1]=w;break;case 3:x.splice(4,0,w);break;case 5:x.splice(2,0,w);break;case 6:x[3]=w;break;case 7:x.splice(3,0,w);break;case 8:x[2]=w}return x}containsTile(l,d,_,x=0){const w=l.queryPadding/d._pixelsPerMercatorPixel+1,S=_?this._bufferedCameraMercator(w,d):this._bufferedScreenMercator(w,d);let C=l.tileID.wrap+(S.unwrapped?x:0);const k=S.polygon.map(ie=>a.cz(l.tileTransform,ie,C));if(!a.cA(k,0,0,a.a4,a.a4))return;C=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const L=this.screenGeometryMercator.polygon.map(ie=>a.cB(l.tileTransform,ie,C)),N=L.map(ie=>new a.P(ie[0],ie[1])),U=d.getFreeCameraOptions().position||new a._(0,0,0),$=a.cB(l.tileTransform,U,C),q=L.map(ie=>{const ae=a.$.sub(ie,ie,$);return a.$.normalize(ae,ae),new a.aU($,ae)}),te=a.bD(l,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:N,tilespaceRays:q,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(ne=a.cC(k),ne.min.x=a.au(ne.min.x,0,a.a4),ne.min.y=a.au(ne.min.y,0,a.a4),ne.max.x=a.au(ne.max.x,0,a.a4),ne.max.y=a.au(ne.max.y,0,a.a4),ne),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:te};var ne}_bufferedScreenMercator(l,d){const _=Gc(l);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let x;return x=d.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),d):{polygon:this.bufferedScreenGeometry(l).map(w=>d.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[_]=x,x}}_bufferedCameraMercator(l,d){const _=Gc(l);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let x;return x=d.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),d):{polygon:this.bufferedCameraGeometry(l).map(w=>d.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[_]=x,x}}_projectAndResample(l,d){const _=function(w,S){const C=a.ae.multiply([],S.pixelMatrix,S.globeMatrix),k=[0,-a.cF,0,1],L=[0,a.cF,0,1],N=[0,0,0,1];a.aB.transformMat4(k,k,C),a.aB.transformMat4(L,L,C),a.aB.transformMat4(N,N,C);const U=new a.P(k[0]/k[3],k[1]/k[3]),$=new a.P(L[0]/L[3],L[1]/L[3]),q=a.cD(w,U)&&k[3]<N[3],te=a.cD(w,$)&&L[3]<N[3];if(!q&&!te)return null;const ne=function(Ie,Ne,Fe){for(let We=1;We<Ie.length;We++){const Be=tc(Ne.pointCoordinate3D(Ie[We-1]).x),Re=tc(Ne.pointCoordinate3D(Ie[We]).x);if(Fe<0){if(Be<Re)return{idx:We,t:-Be/(Re-1-Be)}}else if(Re<Be)return{idx:We,t:(1-Be)/(Re+1-Be)}}return null}(w,S,q?-1:1);if(!ne)return null;const{idx:ie,t:ae}=ne;let ve=ie>1?qu(w.slice(0,ie),S):[],xe=ie<w.length?qu(w.slice(ie),S):[];ve=ve.map(Ie=>new a.P(tc(Ie.x),Ie.y)),xe=xe.map(Ie=>new a.P(tc(Ie.x),Ie.y));const ye=[...ve];ye.length===0&&ye.push(xe[xe.length-1]);const Me=a.a3(ye[ye.length-1].y,(xe.length===0?ve[0]:xe[0]).y,ae);let Se;return Se=q?[new a.P(0,Me),new a.P(0,0),new a.P(1,0),new a.P(1,Me)]:[new a.P(1,Me),new a.P(1,1),new a.P(0,1),new a.P(0,Me)],ye.push(...Se),xe.length===0?ye.push(ve[0]):ye.push(...xe),{polygon:ye.map(Ie=>new a._(Ie.x,Ie.y)),unwrapped:!1}}(l,d);if(_)return _;const x=function(w,S){let C=!1,k=-1/0,L=0;for(let U=0;U<w.length-1;U++)w[U].x>k&&(k=w[U].x,L=U);for(let U=0;U<w.length-1;U++){const $=(L+U)%(w.length-1),q=w[$],te=w[$+1];Math.abs(q.x-te.x)>.5&&(q.x<te.x?(q.x+=1,$===0&&(w[w.length-1].x+=1)):(te.x+=1,$+1===w.length-1&&(w[0].x+=1)),C=!0)}const N=a.ak(S.center.lng);return C&&N<Math.abs(N-1)&&w.forEach(U=>{U.x-=1}),{polygon:w,unwrapped:C}}(qu(l,d).map(w=>new a.P(tc(w.x),w.y)),d);return{polygon:x.polygon.map(w=>new a._(w.x,w.y)),unwrapped:x.unwrapped}}}function qu(g,l){return a.cE(g,d=>{const _=l.pointCoordinate3D(d);d.x=_.x,d.y=_.y},1/256)}function tc(g){return g<0?1+g%1:g%1}function Gc(g){return 100*g|0}function GI(g,l){const d=a.ae.identity([]);return a.ae.scale(d,d,[.5*g.width,.5*-g.height,1]),a.ae.translate(d,d,[1,-1,0]),a.ae.multiply(d,d,g.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(d)}function nc(g,l,d,_,x,w,S,C=!1){const k=g.tilesIn(_,S,C);k.sort(My);const L=[];for(const U of k)L.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(l,d,g._state,U,x,w,GI(g.transform,U.tile.tileID),C)});const N=function(U){const $={},q={};for(const te of U){const ne=te.queryResults,ie=te.wrappedTileID,ae=q[ie]=q[ie]||{};for(const ve in ne){const xe=ne[ve],ye=ae[ve]=ae[ve]||{},Me=$[ve]=$[ve]||[];for(const Se of xe)ye[Se.featureIndex]||(ye[Se.featureIndex]=!0,Me.push(Se))}}return $}(L);for(const U in N)N[U].forEach($=>{const q=$.feature,te=q.layer;te&&te.type!=="background"&&te.type!=="sky"&&te.type!=="slot"&&(q.source=te.source,te["source-layer"]&&(q.sourceLayer=te["source-layer"]),q.state=q.id!==void 0?g.getFeatureState(te["source-layer"],q.id):{})});return N}function qI(g,l){const d=g.getRenderableIds().map(w=>g.getTileByID(w)),_=[],x={};for(let w=0;w<d.length;w++){const S=d[w],C=S.tileID.canonical.key;x[C]||(x[C]=!0,S.querySourceFeatures(_,l))}return _}function My(g,l){const d=g.tileID,_=l.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}class Oo{constructor(l){this.style=l,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const l=!1,d=!1;for(const _ in this.style._mergedLayers){const x=this.style._mergedLayers[_];if(x.type==="fill-extrusion")this.layers.push({layer:x,visible:l,visibilityChanged:d});else if(x.type==="model"){const w=this.style.getLayerSource(x);w&&w.type==="batched-model"&&this.layers.push({layer:x,visible:l,visibilityChanged:d})}}}onNewFrame(l){this.layersGotHidden=!1;for(const d of this.layers){const _=d.layer;let x=!1;_.type==="fill-extrusion"?x=!_.isHidden(l)&&_.paint.get("fill-extrusion-opacity")>0:_.type==="model"&&(x=!_.isHidden(l)&&_.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!x&&d.visible,d.visible=x}}updateZOffset(l,d){this.currentBuildingBuckets=[];for(const x of this.layers){const w=x.layer,S=this.style.getLayerSourceCache(w);let C=1;w.type==="fill-extrusion"&&(C=x.visible?w.paint.get("fill-extrusion-vertical-scale"):0);let k=S?S.getTile(d):null;if(!k&&S&&d.canonical.z>S.getSource().minzoom){let L=d.scaledTo(Math.min(S.getSource().maxzoom,d.overscaledZ-1));for(;L.overscaledZ>=S.getSource().minzoom&&(k=S.getTile(L),!k&&L.overscaledZ!==0);)L=L.scaledTo(L.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:k?k.getBucket(w):null,tileID:k?k.tileID:d,verticalScale:C})}l.hasAnyZOffset=!1;let _=!1;for(let x=0;x<l.symbolInstances.length;x++){const w=l.symbolInstances.get(x),S=w.zOffset,C=this._getHeightAtTileOffset(d,w.tileAnchorX,w.tileAnchorY);w.zOffset=C!==Number.NEGATIVE_INFINITY?C:S,_||S===w.zOffset||(_=!0),l.hasAnyZOffset||w.zOffset===0||(l.hasAnyZOffset=!0)}_&&(l.zOffsetBuffersNeedUpload=!0,l.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(l,d,_,x){let w=d,S=_;if(l.canonical.z!==x.canonical.z){const C=x.canonical,k=1/(1<<l.canonical.z-C.z);w=(d+l.canonical.x*a.a4)*k-C.x*a.a4|0,S=(_+l.canonical.y*a.a4)*k-C.y*a.a4|0}return{tileX:w,tileY:S}}_getHeightAtTileOffset(l,d,_){let x,w;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;const{bucket:C,tileID:k,verticalScale:L}=this.currentBuildingBuckets[S];if(!C)continue;const{tileX:N,tileY:U}=this._mapCoordToOverlappingTile(l,d,_,k),$=C.getHeightAtTileCoord(N,U);$&&$.height!==void 0&&($.hidden?x=$.height:w=Math.max($.height*L,w||0))}if(w!==void 0)return w;for(let S=0;S<this.layers.length;++S){const C=this.layers[S];if(C.layer.type!=="model"||!C.visible)continue;const{bucket:k,tileID:L}=this.currentBuildingBuckets[S];if(!k)continue;const{tileX:N,tileY:U}=this._mapCoordToOverlappingTile(l,d,_,L),$=k.getHeightAtTileCoord(N,U);if($&&!$.hidden)return $.height===void 0&&x!==void 0?Math.min($.maxHeight,x)*$.verticalScale:$.height?$.height*$.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function WI(g,l){const d={};for(const _ in g)_!=="ref"&&(d[_]=g[_]);return a.cG.forEach(_=>{_ in l&&(d[_]=l[_])}),d}function $f(g){g=g.slice();const l=Object.create(null);for(let d=0;d<g.length;d++)l[g[d].id]=g[d];for(let d=0;d<g.length;d++)"ref"in g[d]&&(g[d]=WI(g[d],l[g[d].ref]));return g}const Tr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function sd(g,l,d){d.push({command:Tr.addSource,args:[g,l[g]]})}function R1(g,l,d){l.push({command:Tr.removeSource,args:[g]}),d[g]=!0}function HI(g,l,d,_){R1(g,d,_),sd(g,l,d)}function Gf(g,l,d){let _;for(_ in g[d])if(g[d].hasOwnProperty(_)&&_!=="data"&&!a.d(g[d][_],l[d][_]))return!1;for(_ in l[d])if(l[d].hasOwnProperty(_)&&_!=="data"&&!a.d(g[d][_],l[d][_]))return!1;return!0}function qc(g,l,d,_,x,w){let S;for(S in l=l||{},g=g||{})g.hasOwnProperty(S)&&(a.d(g[S],l[S])||d.push({command:w,args:[_,S,l[S],x]}));for(S in l)l.hasOwnProperty(S)&&!g.hasOwnProperty(S)&&(a.d(g[S],l[S])||d.push({command:w,args:[_,S,l[S],x]}))}function Nm(g){return g.id}function rc(g,l){return g[l.id]=l,g}class M1{constructor(l,d){this.reset(l,d)}reset(l,d){this.points=l||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=a.au(l,0,1);let d=1,_=this._distances[d];const x=l*this.paddedLength+this.padding;for(;_<x&&d<this._distances.length;)_=this._distances[++d];const w=d-1,S=this._distances[w],C=_-S,k=C>0?(x-S)/C:0;return this.points[w].mult(1-k).add(this.points[d].mult(k))}}class qf{constructor(l,d,_){const x=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(l/_),this.yCellCount=Math.ceil(d/_);for(let S=0;S<this.xCellCount*this.yCellCount;S++)x.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,d,_,x,w){this._forEachCell(d,_,x,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(w)}insertCircle(l,d,_,x){this._forEachCell(d-x,_-x,d+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(_),this.circles.push(x)}_insertBoxCell(l,d,_,x,w,S){this.boxCells[w].push(S)}_insertCircleCell(l,d,_,x,w,S){this.circleCells[w].push(S)}_query(l,d,_,x,w,S){if(_<0||l>this.width||x<0||d>this.height)return!w&&[];const C=[];if(l<=0&&d<=0&&this.width<=_&&this.height<=x){if(w)return!0;for(let k=0;k<this.boxKeys.length;k++)C.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const L=this.circles[3*k],N=this.circles[3*k+1],U=this.circles[3*k+2];C.push({key:this.circleKeys[k],x1:L-U,y1:N-U,x2:L+U,y2:N+U})}return S?C.filter(S):C}return this._forEachCell(l,d,_,x,this._queryCell,C,{hitTest:w,seenUids:{box:{},circle:{}}},S),w?C.length>0:C}_queryCircle(l,d,_,x,w){const S=l-_,C=l+_,k=d-_,L=d+_;if(C<0||S>this.width||L<0||k>this.height)return!x&&[];const N=[];return this._forEachCell(S,k,C,L,this._queryCellCircle,N,{hitTest:x,circle:{x:l,y:d,radius:_},seenUids:{box:{},circle:{}}},w),x?N.length>0:N}query(l,d,_,x,w){return this._query(l,d,_,x,!1,w)}hitTest(l,d,_,x,w){return this._query(l,d,_,x,!0,w)}hitTestCircle(l,d,_,x){return this._queryCircle(l,d,_,!0,x)}_queryCell(l,d,_,x,w,S,C,k){const L=C.seenUids,N=this.boxCells[w];if(N!==null){const $=this.bboxes;for(const q of N)if(!L.box[q]){L.box[q]=!0;const te=4*q;if(l<=$[te+2]&&d<=$[te+3]&&_>=$[te+0]&&x>=$[te+1]&&(!k||k(this.boxKeys[q]))){if(C.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[q],x1:$[te],y1:$[te+1],x2:$[te+2],y2:$[te+3]})}}}const U=this.circleCells[w];if(U!==null){const $=this.circles;for(const q of U)if(!L.circle[q]){L.circle[q]=!0;const te=3*q;if(this._circleAndRectCollide($[te],$[te+1],$[te+2],l,d,_,x)&&(!k||k(this.circleKeys[q]))){if(C.hitTest)return S.push(!0),!0;{const ne=$[te],ie=$[te+1],ae=$[te+2];S.push({key:this.circleKeys[q],x1:ne-ae,y1:ie-ae,x2:ne+ae,y2:ie+ae})}}}}}_queryCellCircle(l,d,_,x,w,S,C,k){const L=C.circle,N=C.seenUids,U=this.boxCells[w];if(U!==null){const q=this.bboxes;for(const te of U)if(!N.box[te]){N.box[te]=!0;const ne=4*te;if(this._circleAndRectCollide(L.x,L.y,L.radius,q[ne+0],q[ne+1],q[ne+2],q[ne+3])&&(!k||k(this.boxKeys[te])))return S.push(!0),!0}}const $=this.circleCells[w];if($!==null){const q=this.circles;for(const te of $)if(!N.circle[te]){N.circle[te]=!0;const ne=3*te;if(this._circlesCollide(q[ne],q[ne+1],q[ne+2],L.x,L.y,L.radius)&&(!k||k(this.circleKeys[te])))return S.push(!0),!0}}}_forEachCell(l,d,_,x,w,S,C,k){const L=this._convertToXCellCoord(l),N=this._convertToYCellCoord(d),U=this._convertToXCellCoord(_),$=this._convertToYCellCoord(x);for(let q=L;q<=U;q++)for(let te=N;te<=$;te++)if(w.call(this,l,d,_,x,this.xCellCount*te+q,S,C,k))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,d,_,x,w,S){const C=x-l,k=w-d,L=_+S;return L*L>C*C+k*k}_circleAndRectCollide(l,d,_,x,w,S,C){const k=(S-x)/2,L=Math.abs(l-(x+k));if(L>k+_)return!1;const N=(C-w)/2,U=Math.abs(d-(w+N));if(U>N+_)return!1;if(L<=k||U<=N)return!0;const $=L-k,q=U-N;return $*$+q*q<=_*_}}const Ys=100;class ZI{constructor(l,d,_=new qf(l.width+200,l.height+200,25),x=new qf(l.width+200,l.height+200,25)){this.transform=l,this.grid=_,this.ignoredGrid=x,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Ys,this.screenBottomBoundary=l.height+Ys,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=d}placeCollisionBox(l,d,_,x,w,S,C,k){let L=_.projectedAnchorX,N=_.projectedAnchorY,U=_.projectedAnchorZ;const $=_.elevation,q=_.tileID,te=l.getProjection();if($&&q){const[Se,Ie,Ne]=te.upVector(q.canonical,_.tileAnchorX,_.tileAnchorY),Fe=te.upVectorScale(q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=Se*$*Fe,N+=Ie*$*Fe,U+=Ne*$*Fe}const ne=this.projectAndGetPerspectiveRatio(C,L,N,U,_.tileID,te.name==="globe"||!!$||this.transform.pitch>0,te),ie=S*ne.perspectiveRatio,ae=(_.x1*d+x.x-_.padding)*ie+ne.point.x,ve=(_.y1*d+x.y-_.padding)*ie+ne.point.y,xe=(_.x2*d+x.x+_.padding)*ie+ne.point.x,ye=(_.y2*d+x.y+_.padding)*ie+ne.point.y,Me=ne.perspectiveRatio<=.55||ne.occluded;return!this.isInsideGrid(ae,ve,xe,ye)||!w&&this.grid.hitTest(ae,ve,xe,ye,k)||Me?{box:[],offscreen:!1,occluded:ne.occluded}:{box:[ae,ve,xe,ye],offscreen:this.isOffscreen(ae,ve,xe,ye),occluded:!1}}placeCollisionCircles(l,d,_,x,w,S,C,k,L,N,U,$,q,te,ne){const ie=[],ae=this.transform.elevation,ve=l.getProjection(),xe=ae?ae.getAtTileOffsetFunc(ne,this.transform.center.lat,this.transform.worldSize,ve):null,ye=new a.P(_.tileAnchorX,_.tileAnchorY);let{x:Me,y:Se,z:Ie}=ve.projectTilePoint(ye.x,ye.y,ne.canonical);if(xe){const[dt,He,it]=xe(ye);Me+=dt,Se+=He,Ie+=it}const Ne=ve.name==="globe",Fe=this.projectAndGetPerspectiveRatio(C,Me,Se,Ie,ne,Ne||!!ae||this.transform.pitch>0,ve),{perspectiveRatio:We}=Fe,Be=(U?S/We:S*We)/a.bP,Re=co(Me,Se,Ie,k),Je=Fe.signedDistanceFromCamera>0?Nu(Be,w,_.lineOffsetX*Be,_.lineOffsetY*Be,!1,Re,ye,_,x,k,{},ae&&!U?xe:null,U&&!!ae,ve,ne,U):null;let Ye=!1,je=!1,vt=!0;if(Je&&!Fe.occluded){const dt=.5*q*We+te,He=new a.P(-100,-100),it=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Ue=new M1,{first:ft,last:gt}=Je,Ut=ft.path.length;let $t=[];for(let bn=Ut-1;bn>=1;bn--)$t.push(ft.path[bn]);for(let bn=1;bn<gt.path.length;bn++)$t.push(gt.path[bn]);const tn=2.5*dt;L&&($t=$t.map(([bn,Fn,Tn],jn)=>(xe&&!Ne&&(Tn=xe(jn<Ut-1?ft.tilePath[Ut-1-jn]:gt.tilePath[jn-Ut+2])[2]),co(bn,Fn,Tn,L))),$t.some(bn=>bn[3]<=0)&&($t=[]));let qt=[];if($t.length>0){let bn=1/0,Fn=-1/0,Tn=1/0,jn=-1/0;for(const or of $t)bn=Math.min(bn,or[0]),Tn=Math.min(Tn,or[1]),Fn=Math.max(Fn,or[0]),jn=Math.max(jn,or[1]);Fn>=He.x&&bn<=it.x&&jn>=He.y&&Tn<=it.y&&(qt=[$t.map(or=>new a.P(or[0],or[1]))],(bn<He.x||Fn>it.x||Tn<He.y||jn>it.y)&&(qt=a.cH(qt,He.x,He.y,it.x,it.y)))}for(const bn of qt){Ue.reset(bn,.25*dt);let Fn=0;Fn=Ue.length<=.5*dt?1:Math.ceil(Ue.paddedLength/tn)+1;for(let Tn=0;Tn<Fn;Tn++){const jn=Tn/Math.max(Fn-1,1),or=Ue.lerp(jn),Zr=or.x+Ys,zr=or.y+Ys;ie.push(Zr,zr,dt,0);const cr=Zr-dt,Or=zr-dt,qn=Zr+dt,Xn=zr+dt;if(vt=vt&&this.isOffscreen(cr,Or,qn,Xn),je=je||this.isInsideGrid(cr,Or,qn,Xn),!d&&this.grid.hitTestCircle(Zr,zr,dt,$)&&(Ye=!0,!N))return{circles:[],offscreen:!1,collisionDetected:Ye,occluded:!1}}}}return{circles:!N&&Ye||!je?[]:ie,offscreen:vt,collisionDetected:Ye,occluded:Fe.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let _=1/0,x=1/0,w=-1/0,S=-1/0;for(const N of l){const U=new a.P(N.x+Ys,N.y+Ys);_=Math.min(_,U.x),x=Math.min(x,U.y),w=Math.max(w,U.x),S=Math.max(S,U.y),d.push(U)}const C=this.grid.query(_,x,w,S).concat(this.ignoredGrid.query(_,x,w,S)),k={},L={};for(const N of C){const U=N.key;if(k[U.bucketInstanceId]===void 0&&(k[U.bucketInstanceId]={}),k[U.bucketInstanceId][U.featureIndex])continue;const $=[new a.P(N.x1,N.y1),new a.P(N.x2,N.y1),new a.P(N.x2,N.y2),new a.P(N.x1,N.y2)];a.cI(d,$)&&(k[U.bucketInstanceId][U.featureIndex]=!0,L[U.bucketInstanceId]===void 0&&(L[U.bucketInstanceId]=[]),L[U.bucketInstanceId].push(U.featureIndex))}return L}insertCollisionBox(l,d,_,x,w){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:w},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,d,_,x,w){const S=d?this.ignoredGrid:this.grid,C={bucketInstanceId:_,featureIndex:x,collisionGroupID:w};for(let k=0;k<l.length;k+=4)S.insertCircle(C,l[k],l[k+1],l[k+2])}projectAndGetPerspectiveRatio(l,d,_,x,w,S,C){const k=[d,_,x,1];let L=!1;x||this.transform.pitch>0?(a.aB.transformMat4(k,k,l),this.fogState&&w&&C.name!=="globe"&&(L=function($,q,te,ne,ie,ae){const ve=ae.calculateFogTileMatrix(ie),xe=[q,te,ne];return a.$.transformMat4(xe,xe,ve),ir($,a.$.length(xe),ae.pitch,ae._fov)}(this.fogState,d,_,x,w.toUnwrapped(),this.transform)>.9)):Rf(k,k,l);const N=k[3];return{point:new a.P((k[0]/N+1)/2*this.transform.width+Ys,(-k[1]/N+1)/2*this.transform.height+Ys),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/N*.5,1.5),signedDistanceFromCamera:N,occluded:S&&k[2]>N||L}}isOffscreen(l,d,_,x){return _<Ys||l>=this.screenRightBoundary||x<Ys||d>this.screenBottomBoundary}isInsideGrid(l,d,_,x){return _>=0&&l<this.gridRightBoundary&&x>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const l=a.ae.identity([]);return a.ae.translate(l,l,[-100,-100,0]),l}}class k1{constructor(l,d,_,x){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):x&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Wf{constructor(l,d,_,x,w,S=!1){this.text=new k1(l?l.text:null,d,_,w),this.icon=new k1(l?l.icon:null,d,x,w),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fm{constructor(l,d,_,x=!1){this.text=l,this.icon=d,this.skipFade=_,this.clipped=x}}class XI{constructor(){this.invProjMatrix=a.ae.create(),this.viewportMatrix=a.ae.create(),this.circles=[]}}class ky{constructor(l,d,_,x,w){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=w}}class D1{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[l]}}function Dy(g,l,d,_,x){const{horizontalAlign:w,verticalAlign:S}=a.bS(g),C=-(w-.5)*l,k=-(S-.5)*d,L=a.bR(g,_);return new a.P(C+L[0]*x,k+L[1]*x)}function Bm(g,l,d,_,x){const w=new a.P(g,l);return d&&w._rotate(_?x:-x),w}class O1{constructor(l,d,_,x,w,S){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new ZI(this.transform,w),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new D1(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,d,_,x){const w=_.getBucket(d),S=_.latestFeatureIndex;if(!w||!S||d.fqid!==w.layerIds[0])return;const C=w.layers[0].layout,k=_.collisionBoxArray,L=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),N=_.tileSize/a.a4,U=_.tileID.toUnwrapped();this.transform.setProjection(w.projection);const $=(q=_.tileID,te=w.getProjection(),ne=this.transform,te.name===this.projection?ne.calculateProjMatrix(q.toUnwrapped()):Vu(ne,te,q));var q,te,ne;const ie=C.get("text-pitch-alignment")==="map",ae=C.get("text-rotation-alignment")==="map";d.compileFilter();const ve=d.dynamicFilter(),xe=d.dynamicFilterNeedsFeature(),ye=this.transform.calculatePixelsToTileUnitsMatrix(_),Me=Lu($,_.tileID.canonical,ie,ae,this.transform,w.getProjection(),ye);let Se=null;if(ie){const Fe=zu($,_.tileID.canonical,ie,ae,this.transform,w.getProjection(),ye);Se=a.ae.multiply([],this.transform.labelPlaneMatrix,Fe)}let Ie=null;ve&&_.latestFeatureIndex&&(Ie={unwrappedTileID:U,dynamicFilter:ve,dynamicFilterNeedsFeature:xe,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new ky(w.bucketInstanceId,S,w.sourceLayerIndex,w.index,_.tileID);const Ne={bucket:w,layout:C,posMatrix:$,textLabelPlaneMatrix:Me,labelToScreenMatrix:Se,clippingData:Ie,scale:L,textPixelRatio:N,holdingForFade:_.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:a.aE(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.aE(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(x)for(const Fe of w.sortKeyRanges){const{sortKey:We,symbolInstanceStart:Be,symbolInstanceEnd:Re}=Fe;l.push({sortKey:We,symbolInstanceStart:Be,symbolInstanceEnd:Re,parameters:Ne})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Ne})}attemptAnchorPlacement(l,d,_,x,w,S,C,k,L,N,U,$,q,te,ne,ie,ae,ve){const{textOffset0:xe,textOffset1:ye,crossTileID:Me}=$,Se=[xe,ye],Ie=Dy(l,_,x,Se,w),Ne=this.collisionIndex.placeCollisionBox(te,w,d,Bm(Ie.x,Ie.y,S,C,this.transform.angle),U,k,L,N.predicate);if(ie){const Fe=te.getSymbolInstanceIconSize(ve,this.transform.zoom,$.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(te,Fe,ie,Bm(Ie.x,Ie.y,S,C,this.transform.angle),U,k,L,N.predicate).box.length===0)return}if(Ne.box.length>0){let Fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[Me]&&this.prevPlacement.placements[Me]&&this.prevPlacement.placements[Me].text&&(Fe=this.prevPlacement.variableOffsets[Me].anchor),this.variableOffsets[Me]={textOffset:Se,width:_,height:x,anchor:l,textScale:w,prevAnchor:Fe},this.markUsedJustification(te,l,$,ne),te.allowVerticalPlacement&&(this.markUsedOrientation(te,ne,$),this.placedOrientations[Me]=ne),{shift:Ie,placedGlyphBoxes:Ne}}}placeLayerBucketPart(l,d,_,x){const{bucket:w,layout:S,posMatrix:C,textLabelPlaneMatrix:k,labelToScreenMatrix:L,clippingData:N,textPixelRatio:U,holdingForFade:$,collisionBoxArray:q,partiallyEvaluatedTextSize:te,partiallyEvaluatedIconSize:ne,collisionGroup:ie}=l.parameters,ae=S.get("text-optional"),ve=S.get("icon-optional"),xe=S.get("text-allow-overlap"),ye=S.get("icon-allow-overlap"),Me=S.get("text-rotation-alignment")==="map",Se=S.get("text-pitch-alignment")==="map",Ie=S.get("symbol-z-order")==="viewport-y",Ne=S.get("symbol-z-elevate");this.transform.setProjection(w.projection);let Fe=xe&&(ye||!w.hasIconData()||ve),We=ye&&(xe||!w.hasTextData()||ae);!w.collisionArrays&&q&&w.deserializeCollisionBoxes(q),_&&x&&w.updateCollisionDebugBuffers(this.transform.zoom,q);const Be=(Re,Je,Ye)=>{const{crossTileID:je,numVerticalGlyphVertices:vt}=Re;if(N){const qn={zoom:this.transform.zoom,pitch:this.transform.pitch};let Xn=null;if(N.dynamicFilterNeedsFeature){const Bn=this.retainedQueryData[w.bucketInstanceId];Xn=N.featureIndex.loadFeature({featureIndex:Re.featureIndex,bucketIndex:Bn.bucketIndex,sourceLayerIndex:Bn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,N.dynamicFilter)(qn,Xn,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new a.P(Re.tileAnchorX,Re.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[je]=new Fm(!1,!1,!1,!0),void d.add(je)}if(d.has(je))return;if($)return void(this.placements[je]=new Fm(!1,!1,!1));let dt=!1,He=!1,it=!0,Ue=!1,ft=!1,gt=null,Ut={box:null,offscreen:null,occluded:null},$t={box:null,offscreen:null,occluded:null},tn=null,qt=null,bn=null,Fn=0,Tn=0,jn=0;Ye.textFeatureIndex?Fn=Ye.textFeatureIndex:Re.useRuntimeCollisionCircles&&(Fn=Re.featureIndex),Ye.verticalTextFeatureIndex&&(Tn=Ye.verticalTextFeatureIndex);const or=qn=>{qn.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const Xn=this.transform.elevation;qn.elevation=Re.zOffset+(Xn?Xn.getAtTileOffset(qn.tileID,qn.tileAnchorX,qn.tileAnchorY):0)},Zr=Ye.textBox;if(Zr){or(Zr);const qn=Bn=>{let mr=a.aF.horizontal;if(w.allowVerticalPlacement&&!Bn&&this.prevPlacement){const Jn=this.prevPlacement.placedOrientations[je];Jn&&(this.placedOrientations[je]=Jn,mr=Jn,this.markUsedOrientation(w,mr,Re))}return mr},Xn=(Bn,mr)=>{if(w.allowVerticalPlacement&&vt>0&&Ye.verticalTextBox){for(const Jn of w.writingModes)if(Jn===a.aF.vertical?(Ut=mr(),$t=Ut):Ut=Bn(),Ut&&Ut.box&&Ut.box.length)break}else Ut=Bn()};if(S.get("text-variable-anchor")){let Bn=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[je]){const An=this.prevPlacement.variableOffsets[je];Bn.indexOf(An.anchor)>0&&(Bn=Bn.filter(Fi=>Fi!==An.anchor),Bn.unshift(An.anchor))}const mr=(An,Fi,Bi)=>{const Qs=w.getSymbolInstanceTextSize(te,Re,this.transform.zoom,Je),Js=(An.x2-An.x1)*Qs+2*An.padding,Bs=(An.y2-An.y1)*Qs+2*An.padding,eo=Re.hasIconTextFit&&!ye?Fi:null;eo&&or(eo);let Ms={box:[],offscreen:!1,occluded:!1};const Us=xe?2*Bn.length:Bn.length;for(let It=0;It<Us;++It){const sn=this.attemptAnchorPlacement(Bn[It%Bn.length],An,Js,Bs,Qs,Me,Se,U,C,ie,It>=Bn.length,Re,Je,w,Bi,eo,te,ne);if(sn&&(Ms=sn.placedGlyphBoxes,Ms&&Ms.box&&Ms.box.length)){dt=!0,gt=sn.shift;break}}return Ms};Xn(()=>mr(Zr,Ye.iconBox,a.aF.horizontal),()=>{const An=Ye.verticalTextBox;return An&&or(An),w.allowVerticalPlacement&&!(Ut&&Ut.box&&Ut.box.length)&&vt>0&&An?mr(An,Ye.verticalIconBox,a.aF.vertical):{box:null,offscreen:null,occluded:null}}),Ut&&(dt=Ut.box,it=Ut.offscreen,Ue=Ut.occluded);const Jn=qn(!(!Ut||!Ut.box));if(!dt&&this.prevPlacement){const An=this.prevPlacement.variableOffsets[je];An&&(this.variableOffsets[je]=An,this.markUsedJustification(w,An.anchor,Re,Jn))}}else{const Bn=(mr,Jn)=>{const An=w.getSymbolInstanceTextSize(te,Re,this.transform.zoom,Je),Fi=this.collisionIndex.placeCollisionBox(w,An,mr,new a.P(0,0),xe,U,C,ie.predicate);return Fi&&Fi.box&&Fi.box.length&&(this.markUsedOrientation(w,Jn,Re),this.placedOrientations[je]=Jn),Fi};Xn(()=>Bn(Zr,a.aF.horizontal),()=>{const mr=Ye.verticalTextBox;return w.allowVerticalPlacement&&vt>0&&mr?(or(mr),Bn(mr,a.aF.vertical)):{box:null,offscreen:null,occluded:null}}),qn(!!(Ut&&Ut.box&&Ut.box.length))}}if(tn=Ut,dt=tn&&tn.box&&tn.box.length>0,it=tn&&tn.offscreen,Ue=tn&&tn.occluded,Re.useRuntimeCollisionCircles){const qn=w.text.placedSymbolArray.get(Re.centerJustifiedTextSymbolIndex>=0?Re.centerJustifiedTextSymbolIndex:Re.verticalPlacedTextSymbolIndex),Xn=a.aG(w.textSizeData,te,qn),Bn=S.get("text-padding");qt=this.collisionIndex.placeCollisionCircles(w,xe,qn,w.lineVertexArray,w.glyphOffsetArray,Xn,C,k,L,_,Se,ie.predicate,Re.collisionCircleDiameter*Xn/a.bP,Bn,this.retainedQueryData[w.bucketInstanceId].tileID),dt=xe||qt.circles.length>0&&!qt.collisionDetected,it=it&&qt.offscreen,Ue=qt.occluded}if(Ye.iconFeatureIndex&&(jn=Ye.iconFeatureIndex),Ye.iconBox){const qn=Xn=>{or(Xn);const Bn=Re.hasIconTextFit&&gt?Bm(gt.x,gt.y,Me,Se,this.transform.angle):new a.P(0,0),mr=w.getSymbolInstanceIconSize(ne,this.transform.zoom,Re.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,mr,Xn,Bn,ye,U,C,ie.predicate)};$t&&$t.box&&$t.box.length&&Ye.verticalIconBox?(bn=qn(Ye.verticalIconBox),He=bn.box.length>0):(bn=qn(Ye.iconBox),He=bn.box.length>0),it=it&&bn.offscreen,ft=bn.occluded}const zr=ae||Re.numHorizontalGlyphVertices===0&&vt===0,cr=ve||Re.numIconVertices===0;if(zr||cr?cr?zr||(He=He&&dt):dt=He&&dt:He=dt=He&&dt,dt&&tn&&tn.box&&this.collisionIndex.insertCollisionBox(tn.box,S.get("text-ignore-placement"),w.bucketInstanceId,$t&&$t.box&&Tn?Tn:Fn,ie.ID),He&&bn&&this.collisionIndex.insertCollisionBox(bn.box,S.get("icon-ignore-placement"),w.bucketInstanceId,jn,ie.ID),qt&&(dt&&this.collisionIndex.insertCollisionCircles(qt.circles,S.get("text-ignore-placement"),w.bucketInstanceId,Fn,ie.ID),_)){const qn=w.bucketInstanceId;let Xn=this.collisionCircleArrays[qn];Xn===void 0&&(Xn=this.collisionCircleArrays[qn]=new XI);for(let Bn=0;Bn<qt.circles.length;Bn+=4)Xn.circles.push(qt.circles[Bn+0]),Xn.circles.push(qt.circles[Bn+1]),Xn.circles.push(qt.circles[Bn+2]),Xn.circles.push(qt.collisionDetected?1:0)}const Or=w.projection.name!=="globe";Fe=Fe&&(Or||!Ue),We=We&&(Or||!ft),this.placements[je]=new Fm(dt||Fe,He||We,it||w.justReloaded),d.add(je)};if(Ne&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,this.retainedQueryData[w.bucketInstanceId].tileID),w.updateZOffset()),Ie){const Re=w.getSortedSymbolIndexes(this.transform.angle);for(let Je=Re.length-1;Je>=0;--Je){const Ye=Re[Je];Be(w.symbolInstances.get(Ye),Ye,w.collisionArrays[Ye])}w.hasAnyZOffset&&a.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const Re=w.getSortedIndexesByZOffset();for(let Je=0;Je<Re.length;++Je){const Ye=Re[Je];Be(w.symbolInstances.get(Ye),Ye,w.collisionArrays[Ye])}}else for(let Re=l.symbolInstanceStart;Re<l.symbolInstanceEnd;Re++)Be(w.symbolInstances.get(Re),Re,w.collisionArrays[Re]);if(_&&w.bucketInstanceId in this.collisionCircleArrays){const Re=this.collisionCircleArrays[w.bucketInstanceId];a.ae.invert(Re.invProjMatrix,C),Re.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(l,d,_,x){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:k,crossTileID:L}=_,N=a.cM(d),U=x===a.aF.vertical?k:N==="left"?w:N==="center"?S:N==="right"?C:-1;w>=0&&(l.text.placedSymbolArray.get(w).crossTileID=U>=0&&w!==U?0:L),S>=0&&(l.text.placedSymbolArray.get(S).crossTileID=U>=0&&S!==U?0:L),C>=0&&(l.text.placedSymbolArray.get(C).crossTileID=U>=0&&C!==U?0:L),k>=0&&(l.text.placedSymbolArray.get(k).crossTileID=U>=0&&k!==U?0:L)}markUsedOrientation(l,d,_){const x=d===a.aF.horizontal||d===a.aF.horizontalOnly?d:0,w=d===a.aF.vertical?d:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:L}=_,N=l.text.placedSymbolArray;S>=0&&(N.get(S).placedOrientation=x),C>=0&&(N.get(C).placedOrientation=x),k>=0&&(N.get(k).placedOrientation=x),L>=0&&(N.get(L).placedOrientation=w)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const x=d?d.symbolFadeChange(l):1,w=d?d.opacities:{},S=d?d.variableOffsets:{},C=d?d.placedOrientations:{};for(const k in this.placements){const L=this.placements[k],N=w[k];N?(this.opacities[k]=new Wf(N,x,L.text,L.icon,null,L.clipped),_=_||L.text!==N.text.placed||L.icon!==N.icon.placed):(this.opacities[k]=new Wf(null,x,L.text,L.icon,L.skipFade,L.clipped),_=_||L.text||L.icon)}for(const k in w){const L=w[k];if(!this.opacities[k]){const N=new Wf(L,x,!1,!1);N.isHidden()||(this.opacities[k]=N,_=_||L.text.placed||L.icon.placed)}}for(const k in S)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=S[k]);for(const k in C)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=C[k]);_?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)}updateLayerOpacities(l,d,_,x){const w=new Set;for(const S of d){const C=S.getBucket(l);C&&S.latestFeatureIndex&&l.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,w,S.collisionBoxArray,_,x,S.tileID,l.scope),C.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,S.tileID),C.updateZOffset()))}}updateBucketOpacities(l,d,_,x,w,S,C){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const k=l.layers[0].layout,L=!!l.layers[0].dynamicFilter(),N=new Wf(null,0,!1,!1,!0),U=k.get("text-allow-overlap"),$=k.get("icon-allow-overlap"),q=k.get("text-variable-anchor"),te=k.get("text-rotation-alignment")==="map",ne=k.get("text-pitch-alignment")==="map",ie=new Wf(null,0,U&&($||!l.hasIconData()||k.get("icon-optional")),$&&(U||!l.hasTextData()||k.get("text-optional")),!0);!l.collisionArrays&&_&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(_);const ae=(xe,ye,Me)=>{for(let Se=0;Se<ye/4;Se++)xe.opacityVertexArray.emplaceBack(Me)};let ve=0;w&&l.updateReplacement(S,w);for(let xe=0;xe<l.symbolInstances.length;xe++){const ye=l.symbolInstances.get(xe),{numHorizontalGlyphVertices:Me,numVerticalGlyphVertices:Se,crossTileID:Ie,numIconVertices:Ne,tileAnchorX:Fe,tileAnchorY:We}=ye,Be=d.has(Ie);let Re=this.opacities[Ie];Be?Re=N:Re||(Re=ie,this.opacities[Ie]=Re),d.add(Ie);const Je=Me>0||Se>0,Ye=Ne>0,je=this.placedOrientations[Ie],vt=je===a.aF.vertical,dt=je===a.aF.horizontal||je===a.aF.horizontalOnly;!Je&&!Ye||Re.isHidden()||ve++;let He=!1;if((Je||Ye)&&w)for(const it of l.activeReplacements){if(a.cJ(it,x,a.cw.Symbol,C)||it.min.x>Fe||Fe>it.max.x||it.min.y>We||We>it.max.y)continue;const Ue=a.cK(Fe,We,S.canonical,it.footprintTileId.canonical);if(He=a.cL(Ue,it),He)break}if(Je){const it=He?Wc:ra(Re.text);ae(l.text,Me,vt?Wc:it),ae(l.text,Se,dt?Wc:it);const Ue=Re.text.isHidden(),{leftJustifiedTextSymbolIndex:ft,centerJustifiedTextSymbolIndex:gt,rightJustifiedTextSymbolIndex:Ut,verticalPlacedTextSymbolIndex:$t}=ye,tn=l.text.placedSymbolArray,qt=Ue||vt?1:0;ft>=0&&(tn.get(ft).hidden=qt),gt>=0&&(tn.get(gt).hidden=qt),Ut>=0&&(tn.get(Ut).hidden=qt),$t>=0&&(tn.get($t).hidden=Ue||dt?1:0);const bn=this.variableOffsets[Ie];bn&&this.markUsedJustification(l,bn.anchor,ye,je);const Fn=this.placedOrientations[Ie];Fn&&(this.markUsedJustification(l,"left",ye,Fn),this.markUsedOrientation(l,Fn,ye))}if(Ye){const it=He?Wc:ra(Re.icon),{placedIconSymbolIndex:Ue,verticalPlacedIconSymbolIndex:ft}=ye,gt=l.icon.placedSymbolArray,Ut=Re.icon.isHidden()?1:0;Ue>=0&&(ae(l.icon,Ne,vt?Wc:it),gt.get(Ue).hidden=Ut),ft>=0&&(ae(l.icon,ye.numVerticalIconVertices,dt?Wc:it),gt.get(ft).hidden=Ut)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const it=l.collisionArrays[xe];if(it){let Ue=new a.P(0,0),ft=!0;if(it.textBox||it.verticalTextBox){if(q){const Ut=this.variableOffsets[Ie];Ut?(Ue=Dy(Ut.anchor,Ut.width,Ut.height,Ut.textOffset,Ut.textScale),te&&Ue._rotate(ne?this.transform.angle:-this.transform.angle)):ft=!1}L&&(ft=!Re.clipped),it.textBox&&vl(l.textCollisionBox.collisionVertexArray,Re.text.placed,!ft||vt,Ue.x,Ue.y),it.verticalTextBox&&vl(l.textCollisionBox.collisionVertexArray,Re.text.placed,!ft||dt,Ue.x,Ue.y)}const gt=ft&&!!(!dt&&it.verticalIconBox);it.iconBox&&vl(l.iconCollisionBox.collisionVertexArray,Re.icon.placed,gt,ye.hasIconTextFit?Ue.x:0,ye.hasIconTextFit?Ue.y:0),it.verticalIconBox&&vl(l.iconCollisionBox.collisionVertexArray,Re.icon.placed,!gt,ye.hasIconTextFit?Ue.x:0,ye.hasIconTextFit?Ue.y:0)}}}if(l.fullyClipped=ve===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const xe=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=xe.invProjMatrix,l.placementViewportMatrix=xe.viewportMatrix,l.collisionCircleArray=xe.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>l}setStale(){this.stale=!0}}function vl(g,l,d,_,x){g.emplaceBack(l?1:0,d?1:0,_||0,x||0),g.emplaceBack(l?1:0,d?1:0,_||0,x||0),g.emplaceBack(l?1:0,d?1:0,_||0,x||0),g.emplaceBack(l?1:0,d?1:0,_||0,x||0)}const Um=Math.pow(2,25),L1=Math.pow(2,24),z1=Math.pow(2,17),Hf=Math.pow(2,16),Zf=Math.pow(2,9),N1=Math.pow(2,8),Oy=Math.pow(2,1);function ra(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const l=g.placed?1:0,d=Math.floor(127*g.opacity);return d*Um+l*L1+d*z1+l*Hf+d*Zf+l*N1+d*Oy+l}const Wc=0;class Lt{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,d,_,x,w){const S=this._bucketParts;for(;this._currentTileIndex<l.length;)if(d.getBucketParts(S,x,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((C,k)=>C.sortKey-k.sortKey));this._currentPartIndex<S.length;){const C=S[this._currentPartIndex];if(d.placeLayerBucketPart(C,this._seenCrossTileIDs,_,C.symbolInstanceStart===0),this._currentPartIndex++,w())return!0}return!1}}class F1{constructor(l,d,_,x,w,S,C,k,L){this.placement=new O1(l,w,S,C,k,L),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(l,d,_,x){const w=a.e.now(),S=()=>{const C=a.e.now()-w;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=d[l[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=k)&&(!C.maxzoom||C.maxzoom>k)){const L=C,N=L.layout.get("symbol-z-elevate"),U=this._inProgressLayer=this._inProgressLayer||new Lt(L),$=a.am(C.source,C.scope);if(U.continuePlacement(N?x[$]:_[$],this.placement,this._showCollisionBoxes,C,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Xf=512/a.a4/2;class Ly{constructor(l,d,_){this.tileID=l,this.bucketInstanceId=_,this.index=new a.cN(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=l.canonical.x*a.a4,w=l.canonical.y*a.a4;for(let S=0;S<d.length;S++){const{key:C,crossTileID:k,tileAnchorX:L,tileAnchorY:N}=d.get(S),U=Math.floor((x+L)*Xf),$=Math.floor((w+N)*Xf);this.index.add(U,$),this.keys.push(C),this.crossTileIDs.push(k)}this.index.finish()}findMatches(l,d,_){const x=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),w=Xf/Math.pow(2,d.canonical.z-this.tileID.canonical.z),S=d.canonical.x*a.a4,C=d.canonical.y*a.a4;for(let k=0;k<l.length;k++){const L=l.get(k);if(L.crossTileID)continue;const{key:N,tileAnchorX:U,tileAnchorY:$}=L,q=Math.floor((S+U)*w),te=Math.floor((C+$)*w),ne=this.index.range(q-x,te-x,q+x,te+x);for(const ie of ne){const ae=this.crossTileIDs[ie];if(this.keys[ie]===N&&!_.has(ae)){_.add(ae),L.crossTileID=ae;break}}}}}class B1{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Vm{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const d=Math.round((l-this.lng)/360);if(d!==0)for(const _ in this.indexes){const x=this.indexes[_],w={};for(const S in x){const C=x[S];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+d),w[C.tileID.key]=C}this.indexes[_]=w}this.lng=l}addBucket(l,d,_){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let w=0;w<d.symbolInstances.length;w++)d.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const x=this.usedCrossTileIDs[l.overscaledZ];for(const w in this.indexes){const S=this.indexes[w];if(Number(w)>l.overscaledZ)for(const C in S){const k=S[C];k.tileID.isChildOf(l)&&k.findMatches(d.symbolInstances,l,x)}else{const C=S[l.scaledTo(Number(w)).key];C&&C.findMatches(d.symbolInstances,l,x)}}for(let w=0;w<d.symbolInstances.length;w++){const S=d.symbolInstances.get(w);S.crossTileID||(S.crossTileID=_.generate(),x.add(S.crossTileID))}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Ly(l,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(l,d){for(const _ of d.crossTileIDs)this.usedCrossTileIDs[l].delete(_)}removeStaleBuckets(l){let d=!1;for(const _ in this.indexes){const x=this.indexes[_];for(const w in x)l[x[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[w]),delete x[w],d=!0)}return d}}class ic{constructor(){this.layerIndexes={},this.crossTileIDs=new B1,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,d,_,x){let w=this.layerIndexes[l.fqid];w===void 0&&(w=this.layerIndexes[l.fqid]=new Vm);let S=!1;const C={};x.name!=="globe"&&w.handleWrapJump(_);for(const k of d){const L=k.getBucket(l);L&&l.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(k.tileID,L,this.crossTileIDs)&&(S=!0),C[L.bucketInstanceId]=!0)}return w.removeStaleBuckets(C)&&(S=!0),S}pruneUnusedLayers(l){const d={};l.forEach(_=>{d[_]=!0});for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}const zy=new a.U({data:new a.W(a.N.colorTheme.data)}),ia=(g,l)=>fn(g,l&&l.filter(d=>d.identifier!=="source.canvas")),jm=a.ai(Tr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),od=a.ai(Tr,["setCenter","setZoom","setBearing","setPitch"]),U1={version:8,layers:[],sources:{}},V1={duration:300,delay:0};class sa extends a.E{constructor(l,d={}){super(),this.map=l,this.scope=d.scope||"",this.globalId=null,this.fragments=[],this.importDepth=d.importDepth||0,this.importsCache=d.importsCache||new Map,this.resolvedImports=d.resolvedImports||new Set,this.transition=a.Q({},V1),this._buildingIndex=new Oo(this),this.crossTileSymbolIndex=new ic,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=d.styleChanges||new W,this.dispatcher=d.dispatcher?d.dispatcher:new a.by(a.bz(),this),d.imageManager?this.imageManager=d.imageManager:(this.imageManager=new Sn,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=d.glyphManager?d.glyphManager:new a.cP(l._requestManager,d.localFontFamily?a.cQ.all:d.localIdeographFontFamily?a.cQ.ideographs:a.cQ.none,d.localFontFamily||d.localIdeographFontFamily),d.modelManager?this.modelManager=d.modelManager:(this.modelManager=new zi(l._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=d.configOptions?d.configOptions:new Map,this._configDependentLayers=d.configDependentLayers?d.configDependentLayers:new Set,this._config=d.config,this._initialConfig=d.initialConfig,this.dispatcher.broadcast("setReferrer",a.cR());const _=this;this._rtlTextPluginCallback=sa.registerForPluginStateChange(x=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(w,S)=>{if(a.cS(w),S&&S.every(C=>C))for(const C in _._sourceCaches){const k=_._sourceCaches[C],L=k.getSource().type;L!=="vector"&&L!=="geojson"||k.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const w=this.getOwnSource(x.sourceId);if(w&&w.vectorLayerIds)for(const S in this._layers){const C=this._layers[S];C.source===w.id&&this._validateLayer(C)}})}load(l){return l?(typeof l=="string"?this.loadURL(l):this.loadJSON(l),this):this}_getGlobalId(l){if(!l)return null;if(typeof l=="string"){if(a.cT(l))return l;const d=a.cU(l);if(!d.startsWith("http"))try{return new URL(d,location.href).toString()}catch{return d}return d}return`json://${a.cV(JSON.stringify(l))}`}_diffStyle(l,d,_){this.globalId=this._getGlobalId(l);const x=(w,S)=>{try{S(null,this.setState(w,_))}catch(C){S(C,!1)}};if(typeof l=="string"){const w=this.map._requestManager.normalizeStyleURL(l),S=this.map._requestManager.transformRequest(w,a.R.Style);a.h(S,(C,k)=>{C?this.fire(new a.f(C)):k&&x(k,d)})}else typeof l=="object"&&x(l,d)}loadURL(l,d={}){this.fire(new a.g("dataloading",{dataType:"style"}));const _=typeof d.validate=="boolean"?d.validate:!a.cT(l);this.globalId=this._getGlobalId(l),l=this.map._requestManager.normalizeStyleURL(l,d.accessToken),this.resolvedImports.add(l);const x=this.importsCache.get(l);if(x)return this._load(x,_);const w=this.map._requestManager.transformRequest(l,a.R.Style);this._request=a.h(w,(S,C)=>{if(this._request=null,S)this.fire(new a.f(S));else if(C)return this.importsCache.set(l,C),this._load(C,_)})}loadJSON(l,d={}){this.fire(new a.g("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(l),this._request=a.e.frame(()=>{this._request=null,this._load(l,d.validate!==!1)})}loadEmpty(){this.fire(new a.g("dataloading",{dataType:"style"})),this._load(U1,!1)}_loadImports(l,d,_){if(this.importDepth>=4)return a.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const w of l){const S=this._createFragmentStyle(w),C=new Promise(N=>{S.once("style.import.load",N),S.once("error",N)}).then(()=>this.mergeAll());if(x.push(C),this.resolvedImports.has(w.url)){S.loadEmpty();continue}const k=w.data||this.importsCache.get(w.url);k?(S.loadJSON(k,{validate:d}),this._isInternalStyle(k)&&(S.globalId=null)):w.url?S.loadURL(w.url,{validate:d}):S.loadEmpty();const L={style:S,id:w.id,config:w.config};if(_){const N=this.fragments.findIndex(({id:U})=>U===_);this.fragments=this.fragments.slice(0,N).concat(L).concat(this.fragments.slice(N))}else this.fragments.push(L)}return Promise.allSettled(x)}getImportGlobalIds(l=this,d=new Set){for(const _ of l.fragments)_.style.globalId&&d.add(_.style.globalId),this.getImportGlobalIds(_.style,d);return[...d.values()]}_createFragmentStyle(l){const d=this.scope?a.am(l.id,this.scope):l.id;let _;const x=this._initialConfig&&this._initialConfig[d];(l.config||x)&&(_=a.Q({},l.config,x));const w=new sa(this.map,{scope:d,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:_,configOptions:this.options,configDependentLayers:this._configDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(l){return this.isRootStyle()&&(l.fragment||!!l.schema&&l.fragment!==!1)}_load(l,d){const _=l.schema;if(this._isInternalStyle(l)){const S=a.Q({},U1,{imports:[{id:"basemap",data:l,url:""}]});return void this._load(S,d)}if(this.updateConfig(this._config,_),d&&ia(this,ee(l)))return;this._loaded=!0,this.stylesheet=a.cW(l);const x=()=>{for(const L in l.sources)this.addSource(L,l.sources[L],{validate:!1,isInitialLoad:!0});l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(l.glyphs,this.scope);const S=$f(this.stylesheet.layers);if(this._order=S.map(L=>L.id),this.stylesheet.light&&a.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const L=this.stylesheet.lights[0];this.light=new nr(L.properties,L.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new nr(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const L of S){const N=a.c$(L,this.scope,this._styleColorTheme.lut,this.options);N.configDependencies.size!==0&&this._configDependentLayers.add(N.fqid),N.setEventedParent(this,{layer:{id:N.id}}),this._layers[N.id]=N,this._serializedLayers[N.id]=N.serialize();const U=this.getOwnLayerSourceCache(N),$=!!this.directionalLight&&this.directionalLight.shadowsEnabled();U&&N.canCastShadows()&&$&&(U.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const C=this.stylesheet.terrain;C&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(C,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.g("data",{dataType:"style"}));const k=this.isRootStyle();l.imports?this._loadImports(l.imports,d).then(()=>{this._reloadImports(),this.fire(new a.g(k?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new a.g(k?"style.load":"style.import.load")))},w=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=w,w){const S=this._evaluateColorThemeData(w);this._loadColorTheme(S).then(()=>{x()}).catch(C=>{a.w(`Couldn't load color theme from the stylesheet: ${C}`),x()})}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}mergeAll(){let l,d,_,x,w,S,C,k;const L={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(N=>{if(N.stylesheet){if(N.light!=null&&(l=N.light),N.stylesheet.lights)for(const U of N.stylesheet.lights)U.type==="ambient"&&N.ambientLight!=null&&(d=N.ambientLight),U.type==="directional"&&N.directionalLight!=null&&(_=N.directionalLight);x=this._prioritizeTerrain(x,N.terrain,N.stylesheet.terrain),N.stylesheet.fog&&N.fog!=null&&(w=N.fog),N.stylesheet.camera!=null&&(k=N.stylesheet.camera),N.stylesheet.projection!=null&&(S=N.stylesheet.projection),N.stylesheet.transition!=null&&(C=N.stylesheet.transition),L[N.scope]=N._styleColorTheme}}),this.light=l,this.ambientLight=d,this.directionalLight=_,this.fog=w,this._styleColorThemeForScope=L,x===null?delete this.terrain:this.terrain=x,this.camera=k||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=a.Q({},V1,C),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(l){const d=_=>{for(const x of _.fragments)d(x.style);l(_)};d(this)}_prioritizeTerrain(l,d,_){const x=l&&l.drapeRenderMode===0;return _===null?d&&d.drapeRenderMode===0?d:x?l:null:d!=null&&(!l||x||d&&d.drapeRenderMode===1)?d:l}mergeTerrain(){let l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(d=>{l=this._prioritizeTerrain(l,d.terrain,d.stylesheet.terrain)}),l===null?delete this.terrain:this.terrain=l}mergeProjection(){let l;this.forEachFragmentStyle(d=>{d.stylesheet.projection!=null&&(l=d.stylesheet.projection)}),this.projection=l||{name:"mercator"}}mergeSources(){const l={},d={},_={};this.forEachFragmentStyle(x=>{for(const w in x._sourceCaches){const S=a.am(w,x.scope);l[S]=x._sourceCaches[w]}for(const w in x._otherSourceCaches){const S=a.am(w,x.scope);d[S]=x._otherSourceCaches[w]}for(const w in x._symbolSourceCaches){const S=a.am(w,x.scope);_[S]=x._symbolSourceCaches[w]}}),this._mergedSourceCaches=l,this._mergedOtherSourceCaches=d,this._mergedSymbolSourceCaches=_}mergeLayers(){const l={},d=[],_={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(const C of S._order){const k=S._layers[C];if(k.type==="slot"){const L=a.cX(C);if(l[L])continue;l[L]=[]}k.slot&&l[k.slot]?l[k.slot].push(k):d.push(k)}}),this._mergedOrder=[],this._clipLayerIndices=[];let x=0;const w=(S=[])=>{for(const C of S)if(C.type==="slot"){const k=a.cX(C.id);l[k]&&w(l[k]),this._mergedSlots.push(k)}else{const k=a.am(C.id,C.scope);this._mergedOrder.push(k),_[k]=C,C.is3D()&&(this._has3DLayers=!0),C.type==="circle"&&(this._hasCircleLayers=!0),C.type==="symbol"&&(this._hasSymbolLayers=!0),C.type==="clip"&&this._clipLayerIndices.push(x),x++}};w(d),this._mergedOrder.sort((S,C)=>{const k=_[S],L=_[C];return k.hasInitialOcclusionOpacityProperties?L.is3D()?1:0:k.is3D()&&L.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=_,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(l){return this.stylesheet.camera=a.Q({},this.stylesheet.camera,l),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(l){return l.data?function(d,_,x){const w=a.Q({},_);for(const C of Object.keys(a.N.colorTheme))w[C]===void 0&&(w[C]=a.N.colorTheme[C].default);const S=new a.O(zy,d,new Map(x));return S.setTransitionOrValue(w,x),S.untransitioned().possiblyEvaluate(new a.Y(0))}(this.scope,l,this.options).get("data"):null}_loadColorTheme(l){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const d=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((_,x)=>{const w="data:image/png;base64,";if(!l||l.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void _();let S=l;S.startsWith(w)||(S=w+S);const C="mapbox-reserved-lut",k=new Image;k.src=S,k.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},k.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==d)return void _();this._styleColorTheme.lutLoading=!1;const{width:L,height:N,data:U}=a.e.getImageData(k);if(N>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==N*N)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(C)&&this.removeImage(C),this.addImage(C,{data:new a.j({width:L,height:N},U),pixelRatio:1,sdf:!1,version:0});const $=this.imageManager.getImage(C,this.scope);$?(this._styleColorTheme.lut={image:$.data,data:l},_()):x(new Error("Missing LUT image."))}})}getLut(l){const d=this._styleColorThemeForScope[l];return d?d.lut:null}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(l){this._spriteRequest=function(d,_,x){let w,S,C;const k=a.e.devicePixelRatio>1?"@2x":"";let L=a.h(_.transformRequest(_.normalizeSpriteURL(d,k,".json"),a.R.SpriteJSON),($,q)=>{L=null,C||(C=$,w=q,U())}),N=a.i(_.transformRequest(_.normalizeSpriteURL(d,k,".png"),a.R.SpriteImage),($,q)=>{N=null,C||(C=$,S=q,U())});function U(){if(C)x(C);else if(w&&S){const $=a.e.getImageData(S),q={};for(const te in w){const{width:ne,height:ie,x:ae,y:ve,sdf:xe,pixelRatio:ye,stretchX:Me,stretchY:Se,content:Ie}=w[te],Ne=new a.j({width:ne,height:ie});a.j.copy($,Ne,{x:ae,y:ve},{x:0,y:0},{width:ne,height:ie},null),q[te]={data:Ne,pixelRatio:ye,sdf:xe,stretchX:Me,stretchY:Se,content:Ie}}x(null,q)}}return{cancel(){L&&(L.cancel(),L=null),N&&(N.cancel(),N=null)}}}(l,this.map._requestManager,(d,_)=>{if(this._spriteRequest=null,d)this.fire(new a.f(d));else if(_)for(const x in _)this.imageManager.addImage(x,this.scope,_[x]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.g("data",{dataType:"style"}))})}_validateLayer(l){const d=this.getOwnSource(l.source);if(!d)return;const _=l.sourceLayer;_&&(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(_)===-1)&&this.fire(new a.f(new Error(`Source layer "${_}" does not exist on source "${d.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:l}of this.fragments)if(!l.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((l,d)=>{const _=this.fragments[d];return _&&_.style&&(l.data=_.style.serialize()),l})}_serializeSources(){const l={};for(const d in this._sourceCaches){const _=this._sourceCaches[d].getSource();l[_.id]||(l[_.id]=_.serialize())}return l}_serializeLayers(l){const d=[];for(const _ of l){const x=this._layers[_];x&&x.type!=="custom"&&d.push(x.serialize())}return d}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(l){return!!this.terrain&&l.isDraped(this.getLayerSourceCache(l))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(l){const d=this.getOwnLayer(l);if(d)return d;this.fire(new a.f(new Error(`The layer '${l}' does not exist in the map's style.`)))}_checkSource(l){const d=this.getOwnSource(l);if(d)return d;this.fire(new a.f(new Error(`The source '${l}' does not exist in the map's style.`)))}precompilePrograms(l,d){const _=this.map.painter;if(_)for(let x=l.minzoom||0;x<(l.maxzoom||25.5);x++){const w=l.getProgramIds();if(w)for(const S of w){const C=l.getDefaultProgramParams(S,d.zoom,this._styleColorTheme.lut);C&&(_.style=this,this.fog&&(_._fogVisible=!0,C.overrideFog=!0,_.getOrCreateProgram(S,C)),_._fogVisible=!1,C.overrideFog=!1,_.getOrCreateProgram(S,C),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(C.overrideRtt=!0,_.getOrCreateProgram(S,C)))}}}update(l){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(l),this.directionalLight&&this.directionalLight.recalculate(l);const d=this.calculateLightsBrightness();l.brightness=d||0,d!==this._brightness&&(this._brightness=d,this.dispatcher.broadcast("setBrightness",d));const _=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const C in S){const{updatedIds:k,removedIds:L}=S[C];(k||L)&&(this._updateWorkerLayers(C,k,L),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(l),this.light&&this.light.updateTransitions(l),this.ambientLight&&this.ambientLight.updateTransitions(l),this.directionalLight&&this.directionalLight.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._changes.reset()}const w={};for(const S in this._mergedSourceCaches){const C=this._mergedSourceCaches[S];w[S]=C.used,C.used=!1,C.tileCoverLift=0}for(const S of this._mergedOrder){const C=this._mergedLayers[S];if(C.recalculate(l,this._availableImages),!C.isHidden(l.zoom)){const k=this.getLayerSourceCache(C);k&&(k.used=!0,k.tileCoverLift=Math.max(k.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(C,l)}):this.precompilePrograms(C,l))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();for(const S in w){const C=this._mergedSourceCaches[S];w[S]!==C.used&&C.getSource().fire(new a.g("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),_&&this.fire(new a.g("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=this._changes.getUpdatedImages();if(l.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],l);this._changes.resetUpdatedImages()}}_updateWorkerLayers(l,d,_){const x=this.getFragmentStyle(l);x&&this.dispatcher.broadcast("updateLayers",{layers:d?x._serializeLayers(d):[],scope:l,removedIds:_||[],options:x.options})}setState(l,d){if(this._checkLoaded(),ia(this,ee(l)))return!1;(l=a.cW(l)).layers=$f(l.layers);const _=function(S,C){if(!S)return[{command:Tr.setStyle,args:[C]}];let k=[];try{if(!a.d(S.version,C.version))return[{command:Tr.setStyle,args:[C]}];if(a.d(S.center,C.center)||k.push({command:Tr.setCenter,args:[C.center]}),a.d(S.zoom,C.zoom)||k.push({command:Tr.setZoom,args:[C.zoom]}),a.d(S.bearing,C.bearing)||k.push({command:Tr.setBearing,args:[C.bearing]}),a.d(S.pitch,C.pitch)||k.push({command:Tr.setPitch,args:[C.pitch]}),a.d(S.sprite,C.sprite)||k.push({command:Tr.setSprite,args:[C.sprite]}),a.d(S.glyphs,C.glyphs)||k.push({command:Tr.setGlyphs,args:[C.glyphs]}),a.d(S.imports,C.imports)||function(q=[],te=[],ne){te=te||[];const ie=(q=q||[]).map(Nm),ae=te.map(Nm),ve=q.reduce(rc,{}),xe=te.reduce(rc,{}),ye=ie.slice();let Me,Se,Ie,Ne;for(Me=0,Se=0;Me<ie.length;Me++)Ie=ie[Me],xe.hasOwnProperty(Ie)?Se++:(ne.push({command:Tr.removeImport,args:[Ie]}),ye.splice(ye.indexOf(Ie,Se),1));for(Me=0,Se=0;Me<ae.length;Me++)Ie=ae[ae.length-1-Me],ye[ye.length-1-Me]!==Ie&&(ve.hasOwnProperty(Ie)?(ne.push({command:Tr.removeImport,args:[Ie]}),ye.splice(ye.lastIndexOf(Ie,ye.length-Se),1)):Se++,Ne=ye[ye.length-Me],ne.push({command:Tr.addImport,args:[xe[Ie],Ne]}),ye.splice(ye.length-Me,0,Ie));for(const Fe of te){const We=ve[Fe.id];We&&!a.d(We,Fe)&&ne.push({command:Tr.updateImport,args:[Fe.id,Fe]})}}(S.imports,C.imports,k),a.d(S.transition,C.transition)||k.push({command:Tr.setTransition,args:[C.transition]}),a.d(S.light,C.light)||k.push({command:Tr.setLight,args:[C.light]}),a.d(S.fog,C.fog)||k.push({command:Tr.setFog,args:[C.fog]}),a.d(S.projection,C.projection)||k.push({command:Tr.setProjection,args:[C.projection]}),a.d(S.lights,C.lights)||k.push({command:Tr.setLights,args:[C.lights]}),a.d(S.camera,C.camera)||k.push({command:Tr.setCamera,args:[C.camera]}),!a.d(S["color-theme"],C["color-theme"]))return[{command:Tr.setStyle,args:[C]}];const L={},N=[];(function(q,te,ne,ie){let ae;for(ae in te=te||{},q=q||{})q.hasOwnProperty(ae)&&(te.hasOwnProperty(ae)||R1(ae,ne,ie));for(ae in te){if(!te.hasOwnProperty(ae))continue;const ve=te[ae];q.hasOwnProperty(ae)?a.d(q[ae],ve)||(q[ae].type==="geojson"&&ve.type==="geojson"&&Gf(q,te,ae)?ne.push({command:Tr.setGeoJSONSourceData,args:[ae,ve.data]}):HI(ae,te,ne,ie)):sd(ae,te,ne)}})(S.sources,C.sources,N,L);const U=[];S.layers&&S.layers.forEach(q=>{q.source&&L[q.source]?k.push({command:Tr.removeLayer,args:[q.id]}):U.push(q)});let $=S.terrain;$&&L[$.source]&&(k.push({command:Tr.setTerrain,args:[void 0]}),$=void 0),k=k.concat(N),a.d($,C.terrain)||k.push({command:Tr.setTerrain,args:[C.terrain]}),function(q,te,ne){te=te||[];const ie=(q=q||[]).map(Nm),ae=te.map(Nm),ve=q.reduce(rc,{}),xe=te.reduce(rc,{}),ye=ie.slice(),Me=Object.create(null);let Se,Ie,Ne,Fe,We,Be,Re;for(Se=0,Ie=0;Se<ie.length;Se++)Ne=ie[Se],xe.hasOwnProperty(Ne)?Ie++:(ne.push({command:Tr.removeLayer,args:[Ne]}),ye.splice(ye.indexOf(Ne,Ie),1));for(Se=0,Ie=0;Se<ae.length;Se++)Ne=ae[ae.length-1-Se],ye[ye.length-1-Se]!==Ne&&(ve.hasOwnProperty(Ne)?(ne.push({command:Tr.removeLayer,args:[Ne]}),ye.splice(ye.lastIndexOf(Ne,ye.length-Ie),1)):Ie++,Be=ye[ye.length-Se],ne.push({command:Tr.addLayer,args:[xe[Ne],Be]}),ye.splice(ye.length-Se,0,Ne),Me[Ne]=!0);for(Se=0;Se<ae.length;Se++)if(Ne=ae[Se],Fe=ve[Ne],We=xe[Ne],!Me[Ne]&&!a.d(Fe,We))if(a.d(Fe.source,We.source)&&a.d(Fe["source-layer"],We["source-layer"])&&a.d(Fe.type,We.type)){for(Re in qc(Fe.layout,We.layout,ne,Ne,null,Tr.setLayoutProperty),qc(Fe.paint,We.paint,ne,Ne,null,Tr.setPaintProperty),a.d(Fe.slot,We.slot)||ne.push({command:Tr.setSlot,args:[Ne,We.slot]}),a.d(Fe.filter,We.filter)||ne.push({command:Tr.setFilter,args:[Ne,We.filter]}),a.d(Fe.minzoom,We.minzoom)&&a.d(Fe.maxzoom,We.maxzoom)||ne.push({command:Tr.setLayerZoomRange,args:[Ne,We.minzoom,We.maxzoom]}),Fe)Fe.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?qc(Fe[Re],We[Re],ne,Ne,Re.slice(6),Tr.setPaintProperty):a.d(Fe[Re],We[Re])||ne.push({command:Tr.setLayerProperty,args:[Ne,Re,We[Re]]}));for(Re in We)We.hasOwnProperty(Re)&&!Fe.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?qc(Fe[Re],We[Re],ne,Ne,Re.slice(6),Tr.setPaintProperty):a.d(Fe[Re],We[Re])||ne.push({command:Tr.setLayerProperty,args:[Ne,Re,We[Re]]}))}else ne.push({command:Tr.removeLayer,args:[Ne]}),Be=ye[ye.lastIndexOf(Ne)+1],ne.push({command:Tr.addLayer,args:[We,Be]})}(U,C.layers,k)}catch(L){console.warn("Unable to compute style diff:",L),k=[{command:Tr.setStyle,args:[C]}]}return k}(this.serialize(),l).filter(S=>!(S.command in od));if(_.length===0)return!1;const x=_.filter(S=>!(S.command in jm));if(x.length>0)throw new Error(`Unimplemented: ${x.map(S=>S.command).join(", ")}.`);const w=[];return _.forEach(S=>{w.push(this[S.command].apply(this,S.args))}),d&&Promise.all(w).then(d),this.stylesheet=l,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(l,d){return this.getImage(l)?this.fire(new a.f(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,this.scope,d),this._afterImageUpdated(l),this)}updateImage(l,d){this.imageManager.updateImage(l,this.scope,d)}getImage(l){return this.imageManager.getImage(l,this.scope)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l,this.scope),this._afterImageUpdated(l),this):this.fire(new a.f(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(l),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new a.g("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(l,d,_={}){return this._checkLoaded(),this._validate(yt,`models.${l}`,d,null,_)||(this.modelManager.addModel(l,d,this.scope),this._changes.setDirty()),this}hasModel(l){return this.modelManager.hasModel(l,this.scope)}removeModel(l){return this.hasModel(l)?(this.modelManager.removeModel(l,this.scope),this):this.fire(new a.f(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(l,d,_={}){if(this._checkLoaded(),this.getOwnSource(l)!==void 0)throw new Error(`There is already a source with ID "${l}".`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(oe,`sources.${l}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const x=le(l,d,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const w=S=>{const C=(S?"symbol:":"other:")+x.id,k=a.am(C,this.scope),L=this._sourceCaches[C]=new a.bx(k,x,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=L,L.onAdd(this.map)};w(!1),d.type!=="vector"&&d.type!=="geojson"||w(!0),x.onAdd&&x.onAdd(this.map),_.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(l){this._checkLoaded();const d=this.getOwnSource(l);if(!d)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===l)return this.fire(new a.f(new Error(`Source "${l}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===l)return this.fire(new a.f(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const _=this.getOwnSourceCaches(l);for(const x of _){const w=a.cX(x.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(x.id),x.fire(new a.g("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],this.mergeSources(),d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(l,d){this._checkLoaded(),this.getOwnSource(l).setData(d),this._changes.setDirty()}getOwnSource(l){const d=this.getOwnSourceCache(l);return d&&d.getSource()}getOwnSources(){const l=[];for(const d in this._otherSourceCaches){const _=this.getOwnSourceCache(d);_&&l.push(_.getSource())}return l}areTilesLoaded(){const l=this._mergedSourceCaches;for(const d in l){const _=l[d]._tiles;for(const x in _){const w=_[x];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(l){if(this._checkLoaded(),!l)return delete this.ambientLight,void delete this.directionalLight;const d=this._getTransitionParameters();for(const x of l){if(this._validate(Le,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(x),w.updateTransitions(d)}else this.ambientLight=new Gl(x,jh||(jh=new a.U({color:new a.W(a.N.properties_light_ambient.color),intensity:new a.W(a.N.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(x),w.updateTransitions(d)}else this.directionalLight=new Gl(x,$h||($h=new a.U({direction:new a.a6(a.N.properties_light_directional.direction),color:new a.W(a.N.properties_light_directional.color),intensity:new a.W(a.N.properties_light_directional.intensity),"cast-shadows":new a.W(a.N.properties_light_directional["cast-shadows"]),"shadow-intensity":new a.W(a.N.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const _=new a.Y(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const l=this.directionalLight,d=this.ambientLight;if(!l||!d)return;const _=U=>.2126*(U[0]<=.03928?U[0]/12.92:Math.pow((U[0]+.055)/1.055,2.4))+.7152*(U[1]<=.03928?U[1]/12.92:Math.pow((U[1]+.055)/1.055,2.4))+.0722*(U[2]<=.03928?U[2]/12.92:Math.pow((U[2]+.055)/1.055,2.4)),x=l.properties.get("color").toRenderColor(null).toArray01(),w=l.properties.get("intensity"),S=l.properties.get("direction"),C=1-a.ad(S.x,S.y,S.z)[2]/90,k=_(x)*w*C,L=d.properties.get("color").toRenderColor(null).toArray01(),N=d.properties.get("intensity");return(k+_(L)*N)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const l=[];return this.directionalLight&&l.push(this.directionalLight.get()),this.ambientLight&&l.push(this.ambientLight.get()),l}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(l){if(!l)return this;if(a.cY(l)){const d=a.cZ(l),_=this.fragments.find(({id:w})=>w===d);if(!_)throw new Error(`Style import not found: ${l}`);const x=a.cX(l);return _.style.getFragmentStyle(x)}{const d=this.fragments.find(({id:_})=>_===l);if(!d)throw new Error(`Style import not found: ${l}`);return d.style}}getConfigProperty(l,d){const _=this.getFragmentStyle(l);if(!_)return null;const x=a.am(d,_.scope),w=_.options.get(x),S=w?w.value||w.default:null;return S?S.serialize():null}setConfigProperty(l,d,_){const x=this.getFragmentStyle(l);if(!x)return;const w=x.stylesheet.schema;if(!w||!w[d])return;const S=a.z(_);if(S.result!=="success")return void ia(this,S.value);const C=S.value.expression,k=a.am(d,x.scope),L=x.options.get(k);if(!L)return;let N;const{minValue:U,maxValue:$,stepValue:q,type:te,values:ne}=w[d],ie=a.z(w[d].default);ie.result==="success"&&(N=ie.value.expression),N?(this.options.set(k,{...L,value:C,default:N,minValue:U,maxValue:$,stepValue:q,type:te,values:ne}),this.updateConfigDependencies(d)):this.fire(new a.f(new Error(`No schema defined for the config option "${d}" in the "${l}" fragment.`)))}getConfig(l){const d=this.getFragmentStyle(l);if(!d)return null;const _=d.stylesheet.schema;if(!_)return null;const x={};for(const w in _){const S=a.am(w,d.scope),C=d.options.get(S),k=C?C.value||C.default:null;x[w]=k?k.serialize():null}return x}setConfig(l,d){const _=this.getFragmentStyle(l);_&&(_.updateConfig(d,_.stylesheet.schema),this.updateConfigDependencies())}getSchema(l){const d=this.getFragmentStyle(l);return d?d.stylesheet.schema:null}setSchema(l,d){const _=this.getFragmentStyle(l);_&&(_.stylesheet.schema=d,_.updateConfig(_._config,d),this.updateConfigDependencies())}updateConfig(l,d){if(this._config=l,l||d)if(d)for(const _ in d){let x,w;const S=a.z(d[_].default);if(S.result==="success"&&(x=S.value.expression),l&&l[_]!==void 0){const $=a.z(l[_]);$.result==="success"&&(w=$.value.expression)}const{minValue:C,maxValue:k,stepValue:L,type:N,values:U}=d[_];if(x){const $=a.am(_,this.scope);this.options.set($,{default:x,value:w,minValue:C,maxValue:k,stepValue:L,type:N,values:U})}else this.fire(new a.f(new Error(`No schema defined for config option "${_}".`)))}else this.fire(new a.f(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(l){for(const d of this._configDependentLayers){const _=this.getLayer(d);if(_){if(l&&!_.configDependencies.has(l))continue;_.possiblyEvaluateVisibility(),this._updateLayer(_)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(d=>{if(d._styleColorTheme.colorTheme){const _=d._evaluateColorThemeData(d._styleColorTheme.colorTheme);(!d._styleColorTheme.lut&&_!==""||d._styleColorTheme.lut&&_!==d._styleColorTheme.lut.data)&&d.setColorTheme(d._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(l,d,_={}){this._checkLoaded();const x=l.id;if(this._layers[x])return void this.fire(new a.f(new Error(`Layer with id "${x}" already exists on this map`)));let w;if(l.type==="custom"){if(ia(this,a.c_(l)))return;w=a.c$(l,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof l.source=="object"&&(this.addSource(x,l.source),l=a.cW(l),l=a.Q(l,{source:x})),this._validate(nt,`layers.${x}`,l,{arrayIndex:-1},_))return;w=a.c$(l,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[w.id]=w.serialize()}w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid);let S=this._order.length;if(d){const N=this._order.indexOf(d);if(N===-1)return void this.fire(new a.f(new Error(`Layer with id "${d}" does not exist on this map.`)));w.slot===this._layers[d].slot?S=N:a.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,x),this._layerOrderChanged=!0,this._layers[x]=w;const C=this.getOwnLayerSourceCache(w),k=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&w.canCastShadows()&&k&&(C.castsShadows=!0);const L=this._changes.getRemovedLayer(w);if(L&&w.source&&C&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const N=a.am(w.source,w.scope);L.type!==w.type?this._changes.updateSourceCache(N,"clear"):(this._changes.updateSourceCache(N,"reload"),C.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(l,d){this._checkLoaded();const _=this._checkLayer(l);if(!_||l===d)return;const x=this._order.indexOf(l);this._order.splice(x,1);let w=this._order.length;if(d){const S=this._order.indexOf(d);if(S===-1)return void this.fire(new a.f(new Error(`Layer with id "${d}" does not exist on this map.`)));_.slot===this._layers[d].slot?w=S:a.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,l),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(l){this._checkLoaded();const d=this._checkLayer(l);if(!d)return;d.setEventedParent(null);const _=this._order.indexOf(l);this._order.splice(_,1),delete this._layers[l],delete this._serializedLayers[l],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(d.fqid),this._changes.removeLayer(d);const x=this.getOwnLayerSourceCache(d);if(x&&x.castsShadows){let w=!1;for(const S in this._layers)if(this._layers[S].source===d.source&&this._layers[S].canCastShadows()){w=!0;break}x.castsShadows=w}d.onRemove&&d.onRemove(this.map),this.mergeLayers()}getOwnLayer(l){return this._layers[l]}hasLayer(l){return l in this._mergedLayers}hasLayerType(l){for(const d in this._layers)if(this._layers[d].type===l)return!0;return!1}setLayerZoomRange(l,d,_){this._checkLoaded();const x=this._checkLayer(l);x&&(x.minzoom===d&&x.maxzoom===_||(d!=null&&(x.minzoom=d),_!=null&&(x.maxzoom=_),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(l,d){this._checkLoaded();const _=this._checkLayer(l);_&&_.slot!==d&&(_.slot=d,this._updateLayer(_))}setFilter(l,d,_={}){this._checkLoaded();const x=this._checkLayer(l);if(x&&!a.d(x.filter,d))return d==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(Ge,`layers.${x.id}.filter`,d,{layerType:x.type},_)||(x.filter=a.cW(d),this._updateLayer(x)))}getFilter(l){const d=this._checkLayer(l);if(d)return a.cW(d.filter)}setLayoutProperty(l,d,_,x={}){this._checkLoaded();const w=this._checkLayer(l);if(w&&!a.d(w.getLayoutProperty(d),_)){if(_!=null&&(!x||x.validate!==!1)&&ia(w,_t.call(ee,{key:`layers.${l}.layout.${d}`,layerType:w.type,objectKey:d,value:_,styleSpec:a.N,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(d,_),w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)}}getLayoutProperty(l,d){const _=this._checkLayer(l);if(_)return _.getLayoutProperty(d)}setPaintProperty(l,d,_,x={}){this._checkLoaded();const w=this._checkLayer(l);if(!w||a.d(w.getPaintProperty(d),_)||_!=null&&(!x||x.validate!==!1)&&ia(w,et.call(ee,{key:`layers.${l}.paint.${d}`,layerType:w.type,objectKey:d,value:_,styleSpec:a.N})))return;const S=w.setPaintProperty(d,_);w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),S&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(l,d){const _=this._checkLayer(l);if(_)return _.getPaintProperty(d)}setFeatureState(l,d){this._checkLoaded();const _=l.source,x=l.sourceLayer,w=this._checkSource(_);if(!w)return;const S=w.type;if(S==="geojson"&&x)return void this.fire(new a.f(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!x)return void this.fire(new a.f(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new a.f(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(_);for(const k of C)k.setFeatureState(x,l.id,d)}removeFeatureState(l,d){this._checkLoaded();const _=l.source,x=this._checkSource(_);if(!x)return;const w=x.type,S=w==="vector"?l.sourceLayer:void 0;if(w==="vector"&&!S)return void this.fire(new a.f(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new a.f(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(_);for(const k of C)k.removeFeatureState(S,l.id,d)}getFeatureState(l){this._checkLoaded();const d=l.source,_=l.sourceLayer,x=this._checkSource(d);if(x){if(x.type!=="vector"||_)return l.id===void 0&&this.fire(new a.f(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(d)[0].getFeatureState(_,l.id);this.fire(new a.f(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(l){return this.stylesheet.transition=a.Q({},this.stylesheet.transition,l),this.transition=this.stylesheet.transition,this}getTransition(){return a.Q({},this.stylesheet.transition)}serialize(){this._checkLoaded();const l=this.getTerrain(),d=l&&this.terrain&&this.terrain.scope===this.scope?l:this.stylesheet.terrain;return a.d0({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:d,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},_=>_!==void 0)}_updateLayer(l){this._changes.updateLayer(l);const d=this.getLayerSourceCache(l),_=a.am(l.source,l.scope),x=this._changes.getUpdatedSourceCaches();l.source&&!x[_]&&d&&d.getSource().type!=="raster"&&(this._changes.updateSourceCache(_,"reload"),d.pause()),l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const d=C=>this._mergedLayers[C].type==="fill-extrusion"||this._mergedLayers[C].type==="model",_=this.order,x={},w=[];for(let C=_.length-1;C>=0;C--){const k=_[C];if(d(k)){x[k]=C;for(const L of l){const N=L[k];if(N)for(const U of N)w.push(U)}}}w.sort((C,k)=>k.intersectionZ-C.intersectionZ);const S=[];for(let C=_.length-1;C>=0;C--){const k=_[C];if(d(k))for(let L=w.length-1;L>=0;L--){const N=w[L].feature;if(N.layer&&x[N.layer.id]<C)break;S.push(N),w.pop()}else for(const L of l){const N=L[k];if(N)for(const U of N)S.push(U.feature)}}return S}queryRenderedFeatures(l,d,_){d&&d.filter&&this._validate(Ge,"queryRenderedFeatures.filter",d.filter,null,d),d.scope=this.scope,d.availableImages=this._availableImages,d.serializedLayers=this._serializedLayers;const x={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new a.f(new Error("parameters.layers must be an Array."))),[];for(const L of d.layers){const N=this._mergedLayers[L];if(!N)return this.fire(new a.f(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];x[N.source]=!0}}const w=[],S=d.serializedLayers||{},C=d&&d.layers?d.layers.some(L=>{const N=this.getLayer(L);return N&&N.is3D()}):this.has3DLayers(),k=na.createFromScreenPoints(l,_);for(const L in this._mergedSourceCaches){const N=this._mergedSourceCaches[L].getSource();if(!N||N.scope!==d.scope)continue;const U=this._mergedSourceCaches[L].getSource().id;d.layers&&!x[U]||w.push(nc(this._mergedSourceCaches[L],this._mergedLayers,S,k,d,_,C,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(L,N,U,$,q,te,ne){const ie={},ae=te.queryRenderedSymbols($),ve=[];for(const xe of Object.keys(ae).map(Number))ve.push(ne[xe]);ve.sort(My);for(const xe of ve){const ye=xe.featureIndex.lookupSymbolFeatures(ae[xe.bucketInstanceId],N,xe.bucketIndex,xe.sourceLayerIndex,q.filter,q.layers,q.availableImages,L);for(const Me in ye){const Se=ie[Me]=ie[Me]||[],Ie=ye[Me];Ie.sort((Ne,Fe)=>{const We=xe.featureSortOrder;if(We){const Be=We.indexOf(Ne.featureIndex);return We.indexOf(Fe.featureIndex)-Be}return Fe.featureIndex-Ne.featureIndex});for(const Ne of Ie)Se.push(Ne)}}for(const xe in ie)ie[xe].forEach(ye=>{const Me=ye.feature,Se=U(L[xe]);if(!Se)return;const Ie=Se.getFeatureState(Me.layer["source-layer"],Me.id);Me.source=Me.layer.source,Me.layer["source-layer"]&&(Me.sourceLayer=Me.layer["source-layer"]),Me.state=Ie});return ie}(this._mergedLayers,S,this.getLayerSourceCache.bind(this),k.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(l,d){d&&d.filter&&this._validate(Ge,"querySourceFeatures.filter",d.filter,null,d);const _=this.getOwnSourceCaches(l);let x=[];for(const w of _)x=x.concat(qI(w,d));return x}addSourceType(l,d,_){return sa.getSourceType(l)?_(new Error(`A source type called "${l}" already exists.`)):(sa.setSourceType(l,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:d.workerSourceURL},_):_(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(l,d,_={}){this._checkLoaded();const x=this.light.getLight();let w=!1;for(const C in l)if(!a.d(l[C],x[C])){w=!0;break}if(!w)return;const S=this._getTransitionParameters();this.light.setLight(l,d,_),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=a.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&a.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(l,d=1){if(this._checkLoaded(),!l)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),d===0&&delete this.terrain,l===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let _=l;const x=l.source==null;if(d===1){if(this.disableElevatedTerrain)return;if(typeof _.source=="object"){const C="terrain-dem-src";this.addSource(C,_.source),_=a.cW(_),_=a.Q(_,{source:C})}const w=a.Q({},_),S={};if(this.terrain&&x){w.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(S.style=C.serialize())}if(this._validate(Oe,"terrain",w,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&d!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,d),this.fire(new a.g("data",{dataType:"style"}))}else{const w=this.terrain,S=w.get();for(const C of Object.keys(a.N.terrain))!_.hasOwnProperty(C)&&a.N.terrain[C].default&&(_[C]=a.N.terrain[C].default);for(const C in l)if(!a.d(l[C],S[C])){w.set(l,this.options),this.stylesheet.terrain=l;const k=this._getTransitionParameters({duration:0});w.updateTransitions(k),this.fire(new a.g("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const d=this.fog=new Fs(l,this.map.transform,this.scope,this.options);this.stylesheet.fog=d.get();const _=this._getTransitionParameters({duration:0});d.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog;if(!a.d(d.get(),l)){d.set(l,this.options),this.stylesheet.fog=d.get();const _=this._getTransitionParameters({duration:0});d.updateTransitions(_)}}else this._createFog(l);this._markersNeedUpdate=!0}setColorTheme(l){this._checkLoaded();const d=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()};if(this._styleColorTheme.colorTheme=l,!l)return this._styleColorTheme.lut=null,void d();const _=this._evaluateColorThemeData(l);this._loadColorTheme(_).then(()=>{this.fire(new a.g("colorthemeset")),d()}).catch(x=>{a.w(`Couldn't set color theme: ${x}`)})}_getTransitionParameters(l){return{now:a.e.now(),transition:a.Q(this.transition,l)}}updateDrapeFirstLayers(){if(!this.terrain)return;const l=[],d=[];for(const _ of this._mergedOrder)this.isLayerDraped(this._mergedLayers[_])?l.push(_):d.push(_);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...d)}_createTerrain(l,d){const _=this.terrain=new rr(l,d,this.scope,this.options);d===1&&(this.stylesheet.terrain=l),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});_.updateTransitions(x)}_force3DLayerUpdate(){for(const l in this._layers){const d=this._layers[l];d.type==="fill-extrusion"&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const d=this._layers[l];d.type==="symbol"&&this._updateLayer(d)}}_validate(l,d,_,x,w={}){if(w&&w.validate===!1)return!1;const S=a.Q({},this.serialize());return ia(this,l.call(ee,a.Q({key:d,style:S,value:_,styleSpec:a.N},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.d1.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._mergedLayers)this._mergedLayers[l].setEventedParent(null);for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles(),this._mergedSourceCaches[l].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(l){const d=this.getSourceCaches(l);for(const _ of d)_.clearTiles()}clearSources(){for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles()}reloadSource(l){const d=this.getSourceCaches(l);for(const _ of d)_.resume(),_.reload()}reloadSources(){for(const l of this.getSources())l.reload&&l.reload()}updateSources(l){let d;this.directionalLight&&(d=Do(this.directionalLight));for(const _ in this._mergedSourceCaches)this._mergedSourceCaches[_].update(l,void 0,void 0,d)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const d=this._sourceCaches[l];d.resume(),d.reload()}}_updatePlacement(l,d,_,x,w,S,C=!1){let k=!1,L=!1;const N={},U={};for(const $ of this._mergedOrder){const q=this._mergedLayers[$];if(q.type!=="symbol")continue;const te=a.am(q.source,q.scope);let ne=N[te];if(!ne){const ae=this.getLayerSourceCache(q);if(!ae)continue;const ve=ae.getRenderableIds(!0).map(xe=>ae.getTileByID(xe));U[te]=ve.slice(),ne=N[te]=ve.sort((xe,ye)=>ye.tileID.overscaledZ-xe.tileID.overscaledZ||(xe.tileID.isLessThan(ye.tileID)?-1:1))}const ie=this.crossTileSymbolIndex.addLayer(q,ne,d.center.lng,d.projection);k=k||ie}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new a.g("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.e.now(),d.zoom))&&(this.pauseablePlacement=new F1(d,this._mergedOrder,C,_,x,w,this.placement,this.fog&&d.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,N,U),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.e.now()),L=!0),k&&this.pauseablePlacement.placement.setStale()),L||k){this._buildingIndex.onNewFrame(d.zoom);for(let $=0;$<this._mergedOrder.length;$++){const q=this._mergedLayers[this._mergedOrder[$]];if(q.type!=="symbol")continue;const te=this.isLayerClipped(q)&&this._clipLayerIndices.some(ne=>$<ne);this.placement.updateLayerOpacities(q,N[a.am(q.source,q.scope)],$,te?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.e.now())}}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}addImport(l,d){this._checkLoaded();const _=this.stylesheet.imports=this.stylesheet.imports||[];if(_.findIndex(({id:w})=>w===l.id)!==-1)return void this.fire(new a.f(new Error(`Import with id '${l.id}' already exists in the map's style.`)));if(!d)return _.push(l),this._loadImports([l],!0);const x=_.findIndex(({id:w})=>w===d);return x===-1&&this.fire(new a.f(new Error(`Import with id "${d}" does not exist on this map.`))),this.stylesheet.imports=_.slice(0,x).concat(l).concat(_.slice(x)),this._loadImports([l],!0,d)}updateImport(l,d){this._checkLoaded();const _=this.stylesheet.imports||[],x=this.getImportIndex(l);return x===-1?this:typeof d=="string"?(this.setImportUrl(l,d),this):(d.url&&d.url!==_[x].url&&this.setImportUrl(l,d.url),a.d(d.config,_[x].config)||this.setImportConfig(l,d.config),a.d(d.data,_[x].data)||this.setImportData(l,d.data),this)}moveImport(l,d){this._checkLoaded();let _=this.stylesheet.imports||[];const x=this.getImportIndex(l);if(x===-1)return this;const w=this.getImportIndex(d);if(w===-1)return this;const S=_[x],C=this.fragments[x];return _=_.filter(({id:k})=>k!==l),this.fragments=this.fragments.filter(({id:k})=>k!==l),this.stylesheet.imports=_.slice(0,w).concat(S).concat(_.slice(w)),this.fragments=this.fragments.slice(0,w).concat(C).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(l,d){this._checkLoaded();const _=this.stylesheet.imports||[],x=this.getImportIndex(l);if(x===-1)return this;_[x].url=d;const w=this.fragments[x];return w.style=this._createFragmentStyle(_[x]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(d),this}setImportData(l,d){this._checkLoaded();const _=this.getImportIndex(l),x=this.stylesheet.imports||[];return _===-1?this:d?(this.fragments[_].style.setState(d),this._reloadImports(),this):(delete x[_].data,this.setImportUrl(l,x[_].url))}setImportConfig(l,d){this._checkLoaded();const _=this.getImportIndex(l),x=this.stylesheet.imports||[];if(_===-1)return this;d?x[_].config=d:delete x[_].config;const w=this.fragments[_],S=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=d,w.style.updateConfig(d,S),this.updateConfigDependencies(),this}removeImport(l){this._checkLoaded();const d=this.stylesheet.imports||[],_=this.getImportIndex(l);_!==-1&&(d.splice(_,1),this.fragments[_].style._remove(),this.fragments.splice(_,1),this._reloadImports())}getImportIndex(l){const d=(this.stylesheet.imports||[]).findIndex(_=>_.id===l);return d===-1&&this.fire(new a.f(new Error(`Import '${l}' does not exist in the map's style and cannot be updated.`))),d}getLayer(l){return this._mergedLayers[l]}getSources(){const l=[];for(const d in this._mergedOtherSourceCaches){const _=this._mergedOtherSourceCaches[d];_&&l.push(_.getSource())}return l}getSource(l,d){const _=this.getSourceCache(l,d);return _&&_.getSource()}getLayerSource(l){const d=this.getLayerSourceCache(l);return d&&d.getSource()}getSourceCache(l,d){const _=a.am(l,d);return this._mergedOtherSourceCaches[_]}getLayerSourceCache(l){const d=a.am(l.source,l.scope);return l.type==="symbol"?this._mergedSymbolSourceCaches[d]:this._mergedOtherSourceCaches[d]}getSourceCaches(l){if(l==null)return Object.values(this._mergedSourceCaches);const d=[];return this._mergedOtherSourceCaches[l]&&d.push(this._mergedOtherSourceCaches[l]),this._mergedSymbolSourceCaches[l]&&d.push(this._mergedSymbolSourceCaches[l]),d}updateSourceCaches(){const l=this._changes.getUpdatedSourceCaches();for(const d in l){const _=l[d];_==="reload"?this.reloadSource(d):_==="clear"&&this.clearSource(d)}}updateLayers(l){const d=this._changes.getUpdatedPaintProperties();for(const _ of d){const x=this.getLayer(_);x&&x.updateTransitions(l)}}getImages(l,d,_){this.imageManager.getImages(d.icons,d.scope,_),this._updateTilesForChangedImages();const x=w=>{w&&w.setDependencies(d.tileID.key,d.type,d.icons)};x(this._otherSourceCaches[d.source]),x(this._symbolSourceCaches[d.source])}getGlyphs(l,d,_){this.glyphManager.getGlyphs(d.stacks,d.scope,_)}getResource(l,d,_){return a.d2(d,_)}getOwnSourceCache(l){return this._otherSourceCaches[l]}getOwnLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}getOwnSourceCaches(l){const d=[];return this._otherSourceCaches[l]&&d.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&d.push(this._symbolSourceCaches[l]),d}_isSourceCacheLoaded(l){const d=this.getOwnSourceCaches(l);return d.length===0?(this.fire(new a.f(new Error(`There is no source with ID '${l}'`))),!1):d.every(_=>_.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(l,d){if(this._clipLayerIndices.length===0&&l.type!=="fill-extrusion")return!1;const _=l.type==="fill-extrusion"&&l.sourceLayer==="building";let x=0;if(l.is3D()){if(_||d&&d.type==="batched-model")return!0;l.type==="model"&&(x=a.cw.Model)}else l.type==="symbol"&&(x=a.cw.Symbol);for(const w of this._clipLayerIndices){const S=this._mergedLayers[this._mergedOrder[w]];if(!S)continue;const C=[];for(const k of S.layout.get("clip-layer-types"))C.push(k==="model"?a.cw.Model:k==="symbol"?a.cw.Symbol:a.cw.FillExtrusion);for(const k of C)if(x&k)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(l=>{l.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function j1(g,l){let d=!1,_=null;const x=()=>{_=null,d&&(g(),_=setTimeout(x,l),d=!1)};return()=>(d=!0,_||x(),_)}sa.getSourceType=function(g){return X[g]},sa.setSourceType=function(g,l){X[g]=l},sa.registerForPluginStateChange=a.cO;class $1{constructor(l){this._hashName=l&&encodeURIComponent(l),a.br(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=j1(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const d=Ny(l);if(this._hashName){const _=this._hashName;let x=!1;const w=location.hash.slice(1).split("&").map(S=>{const C=S.split("=")[0];return C===_?(x=!0,`${C}=${d}`):S}).filter(S=>S);return x||w.push(`${_}=${d}`),`#${w.join("&")}`}return`#${d}`}_getCurrentHash(){const l=location.hash.replace("#","");if(this._hashName){let d;return l.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(d=_)}),(d&&d[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(_=>isNaN(_))){const _=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(d[3]||0):l.getBearing();return l.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ny(g,l){const d=g.getCenter(),_=Math.round(100*g.getZoom())/100,x=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,x),S=Math.round(d.lng*w)/w,C=Math.round(d.lat*w)/w,k=g.getBearing(),L=g.getPitch();let N=l?`/${S}/${C}/${_}`:`${_}/${C}/${S}`;return(k||L)&&(N+="/"+Math.round(10*k)/10),L&&(N+=`/${Math.round(L)}`),N}const ad={linearity:.3,easing:a.d3(0,0,.3,1)},KI=a.Q({deceleration:2500,maxSpeed:1400},ad),YI=a.Q({deceleration:20,maxSpeed:1400},ad),QI=a.Q({deceleration:1e3,maxSpeed:360},ad),JI=a.Q({deceleration:1e3,maxSpeed:90},ad);class G1{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.e.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,d=a.e.now();for(;l.length>0&&d-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)d.zoom+=w.zoomDelta||0,d.bearing+=w.bearingDelta||0,d.pitch+=w.pitchDelta||0,w.panDelta&&d.pan._add(w.panDelta),w.around&&(d.around=w.around),w.pinchAround&&(d.pinchAround=w.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(d.pan.mag()){const w=Wu(d.pan.mag(),_,a.Q({},KI,l||{}));x.offset=d.pan.mult(w.amount/d.pan.mag()),x.center=this._map.transform.center,$m(x,w)}if(d.zoom){const w=Wu(d.zoom,_,YI);x.zoom=this._map.transform.zoom+w.amount,$m(x,w)}if(d.bearing){const w=Wu(d.bearing,_,QI);x.bearing=this._map.transform.bearing+a.au(w.amount,-179,179),$m(x,w)}if(d.pitch){const w=Wu(d.pitch,_,JI);x.pitch=this._map.transform.pitch+w.amount,$m(x,w)}if(x.zoom||x.bearing){const w=d.pinchAround===void 0?d.around:d.pinchAround;x.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function $m(g,l){(!g.duration||g.duration<l.duration)&&(g.duration=l.duration,g.easing=l.easing)}function Wu(g,l,d){const{maxSpeed:_,linearity:x,deceleration:w}=d,S=a.au(g*x/(l/1e3),-_,_),C=Math.abs(S)/(w*x);return{easing:d.easing,duration:1e3*C,amount:S*(C/2)}}class oa extends a.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,_,x={}){const w=Te(d.getCanvasContainer(),_),S=d.unproject(w);super(l,a.Q({point:w,lngLat:S,originalEvent:_},x)),this._defaultPrevented=!1,this.target=d}}class Kf extends a.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,_){const x=l==="touchend"?_.changedTouches:_.touches,w=Pe(d.getCanvasContainer(),x),S=w.map(k=>d.unproject(k)),C=w.reduce((k,L,N,U)=>k.add(L.div(U.length)),new a.P(0,0));super(l,{points:w,point:C,lngLats:S,lngLat:d.unproject(C),originalEvent:_}),this._defaultPrevented=!1}}class Fy extends a.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d){super("wheel",{originalEvent:d}),this._defaultPrevented=!1}}class Gm{constructor(l,d){this._map=l,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new Fy(this._map,l))}mousedown(l,d){return this._mousedownPos=d,this._firePreventable(new oa(l.type,this._map,l))}mouseup(l){this._map.fire(new oa(l.type,this._map,l))}preclick(l){const d=a.Q({},l);d.type="preclick",this._map.fire(new oa(d.type,this._map,d))}click(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(l),this._map.fire(new oa(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new oa(l.type,this._map,l))}mouseover(l){this._map.fire(new oa(l.type,this._map,l))}mouseout(l){this._map.fire(new oa(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Kf(l.type,this._map,l))}touchmove(l){this._map.fire(new Kf(l.type,this._map,l))}touchend(l){this._map.fire(new Kf(l.type,this._map,l))}touchcancel(l){this._map.fire(new Kf(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class By{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new oa(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new oa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new oa(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hu{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,d){this.isEnabled()&&l.shiftKey&&l.button===0&&(G(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(l,d){if(!this._active)return;const _=d,x=this._startPos,w=this._lastPos;if(!x||!w||w.equals(_)||!this._box&&_.dist(x)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=B("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const S=Math.min(x.x,_.x),C=Math.max(x.x,_.x),k=Math.min(x.y,_.y),L=Math.max(x.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${k}px)`,this._box.style.width=C-S+"px",this._box.style.height=L-k+"px")})}mouseupWindow(l,d){if(!this._active)return;const _=this._startPos,x=d;if(_&&l.button===0){if(this.reset(),fe(),_.x!==x.x||_.y!==x.y)return this._map.fire(new a.g("boxzoomend",{originalEvent:l})),{cameraAnimation:w=>w.fitScreenCoordinates(_,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Y(),delete this._startPos,delete this._lastPos}_fireEvent(l,d){return this._map.fire(new a.g(l,{originalEvent:d}))}}function Yf(g,l){const d={};for(let _=0;_<g.length;_++)d[g[_].identifier]=l[_];return d}class q1{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),_.length===this.numTouches&&(this.centroid=function(x){const w=new a.P(0,0);for(const S of x)w._add(S);return w.div(x.length)}(d),this.touches=Yf(_,d)))}touchmove(l,d,_){if(this.aborted||!this.centroid)return;const x=Yf(_,d);for(const w in this.touches){const S=x[w];(!S||S.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(l,d,_){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Hc{constructor(l){this.singleTap=new q1(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,d,_){this.singleTap.touchstart(l,d,_)}touchmove(l,d,_){this.singleTap.touchmove(l,d,_)}touchend(l,d,_){const x=this.singleTap.touchend(l,d,_);if(x){const w=l.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(x)<30;if(w&&S||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Qf{constructor(){this._zoomIn=new Hc({numTouches:1,numTaps:2}),this._zoomOut=new Hc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,d,_){this._zoomIn.touchstart(l,d,_),this._zoomOut.touchstart(l,d,_)}touchmove(l,d,_){this._zoomIn.touchmove(l,d,_),this._zoomOut.touchmove(l,d,_)}touchend(l,d,_){const x=this._zoomIn.touchend(l,d,_),w=this._zoomOut.touchend(l,d,_);return x?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(x)},{originalEvent:l})}):w?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(w)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qm={0:1,2:2};class Jf{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,d){return!1}_move(l,d){return{}}mousedown(l,d){if(this._lastPoint)return;const _=ce(l);this._correctButton(l,_)&&(this._lastPoint=d,this._eventButton=_)}mousemoveWindow(l,d){const _=this._lastPoint;if(_){if(l.preventDefault(),this._eventButton!=null&&function(x,w){const S=qm[w];return x.buttons===void 0||(x.buttons&S)!==S}(l,this._eventButton))this.reset();else if(this._moved||!(d.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(_,d)}}mouseupWindow(l){this._lastPoint&&ce(l)===this._eventButton&&(this._moved&&fe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ep extends Jf{mousedown(l,d){super.mousedown(l,d),this._lastPoint&&(this._active=!0)}_correctButton(l,d){return d===0&&!l.ctrlKey}_move(l,d){return{around:d,panDelta:d.sub(l)}}}class tp extends Jf{_correctButton(l,d){return d===0&&l.ctrlKey||d===2}_move(l,d){const _=.8*(d.x-l.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(l){l.preventDefault()}}class Wm extends Jf{_correctButton(l,d){return d===0&&l.ctrlKey||d===2}_move(l,d){const _=-.5*(d.y-l.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(l){l.preventDefault()}}class W1{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),a.br(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(l,d,_){return this._calculateTransform(l,d,_)}touchmove(l,d,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!a.d4())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,d,_)}}touchend(l,d,_){this._calculateTransform(l,d,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,d,_){_.length>0&&(this._active=!0);const x=Yf(_,d),w=new a.P(0,0),S=new a.P(0,0);let C=0;for(const L in x){const N=x[L],U=this._touches[L];U&&(w._add(N),S._add(N.sub(U)),C++,x[L]=N)}if(this._touches=x,C<this._minTouches||!S.mag())return;const k=S.div(C);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(C),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=B("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class np{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,d,_){return{}}touchstart(l,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(l,d,_){const x=this._firstTwoTouches;if(!x)return;l.preventDefault();const[w,S]=x,C=Zu(_,d,w),k=Zu(_,d,S);if(!C||!k)return;const L=this._aroundCenter?null:C.add(k).div(2);return this._move([C,k],L,l)}touchend(l,d,_){if(!this._firstTwoTouches)return;const[x,w]=this._firstTwoTouches,S=Zu(_,d,x),C=Zu(_,d,w);S&&C||(this._active&&fe(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Zu(g,l,d){for(let _=0;_<g.length;_++)if(g[_].identifier===d)return l[_]}function ld(g,l){return Math.log(g/l)/Math.LN2}class H1 extends np{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,d){const _=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(ld(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ld(this._distance,_),pinchAround:d}}}function Uy(g,l){return 180*g.angleWith(l)/Math.PI}class Z1 extends np{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,d){const _=this._vector;if(this._vector=l[0].sub(l[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Uy(this._vector,_),pinchAround:d}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const d=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const x=Uy(l,_);return Math.abs(x)<d}}function Zc(g){return Math.abs(g.y)>Math.abs(g.x)}class X1 extends np{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,Zc(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,d,_){const x=this._lastPoints;if(!x)return;const w=l[0].sub(x[0]),S=l[1].sub(x[1]);return this._map._cooperativeGestures&&!a.d4()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(w,S,_.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(w.y+S.y)/2*-.5})}gestureBeginsVertically(l,d,_){if(this._valid!==void 0)return this._valid;const x=l.mag()>=2,w=d.mag()>=2;if(!x&&!w)return;if(!x||!w)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;const S=l.y>0==d.y>0;return Zc(l)&&Zc(d)&&S}}const eA={panStep:100,bearingStep:15,pitchStep:10};class tA{constructor(){const l=eA;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let d=0,_=0,x=0,w=0,S=0;switch(l.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:l.shiftKey?_=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?_=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?x=1:(l.preventDefault(),S=-1);break;case 40:l.shiftKey?x=-1:(l.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:C=>{const k=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:nA,zoom:d?Math.round(k)+d*(l.shiftKey?2:1):k,bearing:C.getBearing()+_*this._bearingStep,pitch:C.getPitch()+x*this._pitchStep,offset:[-w*this._panStep,-S*this._panStep],center:C.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function nA(g){return g*(2-g)}const Hm=4.000244140625,Vy=1/450;class jy{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._handler=d,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Vy,a.br(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||a.d4()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const _=a.e.now(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,d!==0&&d%Hm==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=d,this._timeout=window.setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(x*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=Te(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>Hm?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&N!==0&&(N=1/N);const U=d(),$=Math.pow(2,U),q=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):$;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(q*N))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:d(),x=this._startZoom,w=this._easing;let S,C=!1;if(this._type==="wheel"&&x&&w){const L=Math.min((a.e.now()-this._lastWheelEventTime)/200,1),N=w(L);S=a.a3(x,_,N),L<1?this._frameId||(this._frameId=!0):C=!0}else S=_,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let k=S-d();return k*this._lastDelta<0&&(k=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:k,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let d=a.d5;if(this._prevEase){const _=this._prevEase,x=(a.e.now()-_.start)/_.duration,w=_.easing(x+.01)-_.easing(x),S=.27/Math.sqrt(w*w+1e-4)*.01,C=Math.sqrt(.0729-S*S);d=a.d3(S,C,.25,1)}return this._prevEase={start:a.e.now(),duration:l,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=B("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class $y{constructor(l,d){this._clickZoom=l,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class K1{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,d){return l.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(l.shiftKey?-1:1),around:_.unproject(d)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Y1{constructor(){this._tap=new Hc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,d,_){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=d[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(l,d,_))}touchmove(l,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const x=d[0],w=x.y-this._swipePoint.y;return this._swipePoint=x,l.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(l,d,_)}touchend(l,d,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(l,d,_)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rA{constructor(l,d,_){this._el=l,this._mousePan=d,this._touchPan=_}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class rp{constructor(l,d,_){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ip{constructor(l,d,_,x){this._el=l,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const sp=g=>g.zoom||g.drag||g.pitch||g.rotate;class aa extends a.g{}class Gy{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,d){const _=a.$.sub([],d,l);this.radius=a.$.length(_[2]<0?a.$.div([],_,this.constants):[_[0],_[1],0])}projectRay(l){a.$.div(l,l,this.constants),a.$.normalize(l,l),a.$.mul(l,l,this.constants);const d=a.$.scale([],l,this.radius);if(d[2]>0){const _=a.$.scale([],[0,0,1],a.$.dot(d,[0,0,1])),x=a.$.scale([],a.$.normalize([],[d[0],d[1],0]),this.radius),w=a.$.add([],d,a.$.scale([],a.$.sub([],a.$.add([],x,_),d),2));d[0]=w[0],d[1]=w[1]}return d}}function Xu(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Zm{constructor(l,d){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new G1(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Gy,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),a.br(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,w,S]of this._listeners){const C=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(w,C,S)}}destroy(){for(const[l,d,_]of this._listeners){const x=l===document?this.handleWindowEvent:this.handleEvent;l.removeEventListener(d,x,_)}}_addDefaultHandlers(l){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new Gm(d,l));const x=d.boxZoom=new Hu(d,l);this._add("boxZoom",x);const w=new Qf,S=new K1;d.doubleClickZoom=new $y(S,w),this._add("tapZoom",w),this._add("clickZoom",S);const C=new Y1;this._add("tapDragZoom",C);const k=d.touchPitch=new X1(d);this._add("touchPitch",k);const L=new tp(l),N=new Wm(l);d.dragRotate=new rp(l,L,N),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);const U=new ep(l),$=new W1(d,l);d.dragPan=new rA(_,U,$),this._add("mousePan",U),this._add("touchPan",$,["touchZoom","touchRotate"]);const q=new Z1,te=new H1;d.touchZoomRotate=new ip(_,te,q,C),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]),this._add("blockableMapEvent",new By(d));const ne=d.scrollZoom=new jy(d,this);this._add("scrollZoom",ne,["mousePan"]);const ie=d.keyboard=new tA;this._add("keyboard",ie);for(const ae of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[ae]&&d[ae].enable(l[ae])}_add(l,d,_){this._handlers.push({handlerName:l,handler:d,allowed:_}),this._handlersById[l]=d}stop(l){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!sp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,d,_){for(const x in l)if(x!==_&&(!d||d.indexOf(x)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const d=[];for(const _ of l)this._el.contains(_.target)&&d.push(_);return d}handleEvent(l,d){this._updatingCamera=!0;const _=l.type==="renderFrame",x=_?void 0:l,w={needsRenderFrame:!1},S={},C={},k=l.touches?this._getMapTouches(l.touches):void 0,L=k?Pe(this._el,k):_?void 0:Te(this._el,l);for(const{handlerName:$,handler:q,allowed:te}of this._handlers){if(!q.isEnabled())continue;let ne;this._blockedByActive(C,te,$)?q.reset():q[d||l.type]&&(ne=q[d||l.type](l,L,k),this.mergeHandlerResult(w,S,ne,$,x),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||q.isActive())&&(C[$]=q)}const N={};for(const $ in this._previousActiveHandlers)C[$]||(N[$]=x);this._previousActiveHandlers=C,(Object.keys(N).length||Xu(w))&&(this._changes.push([w,S,N]),this._triggerRenderFrame()),(Object.keys(C).length||Xu(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=w;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(l,d,_,x,w){if(!_)return;a.Q(l,_);const S={handlerName:x,originalEvent:_.originalEvent||w};_.zoomDelta!==void 0&&(d.zoom=S),_.panDelta!==void 0&&(d.drag=S),_.pitchDelta!==void 0&&(d.pitch=S),_.bearingDelta!==void 0&&(d.rotate=S)}_applyChanges(){const l={},d={},_={};for(const[x,w,S]of this._changes)x.panDelta&&(l.panDelta=(l.panDelta||new a.P(0,0))._add(x.panDelta)),x.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(l.around=x.around),x.aroundCoord!==void 0&&(l.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(l.pinchAround=x.pinchAround),x.noInertia&&(l.noInertia=x.noInertia),a.Q(d,w),a.Q(_,S);this._updateMapTransform(l,d,_),this._changes=[]}_updateMapTransform(l,d,_){const x=this._map,w=x.transform,S=ve=>[ve.x,ve.y,ve.z];if((ve=>{const xe=this._eventsInProgress.drag;return xe&&!this._handlersById[xe.handlerName].isActive()})()&&!Xu(l)){const ve=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),ve!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&x._stop(!0),!Xu(l))return void this._fireEvents(d,_,!0);let{panDelta:C,zoomDelta:k,bearingDelta:L,pitchDelta:N,around:U,aroundCoord:$,pinchAround:q}=l;w._isCameraConstrained&&(k>0&&(k=0),w._isCameraConstrained=!1),q!==void 0&&(U=q),(k||(ve=>d[ve]&&!this._eventsInProgress[ve])("drag"))&&U&&(this._dragOrigin=S(w.pointCoordinate3D(U)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",x._stop(!0),U=U||x.transform.centerPoint,L&&(w.bearing+=L),N&&(w.pitch+=N),w._updateCameraState();const te=[0,0,0];if(C)if(w.projection.name==="mercator"){const ve=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(U).dir),xe=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(U.sub(C)).dir);te[0]=xe[0]-ve[0],te[1]=xe[1]-ve[1]}else{const ve=w.pointCoordinate(U);if(w.projection.name==="globe"){C=C.rotate(-w.angle);const xe=w._pixelsPerMercatorPixel/w.worldSize;te[0]=-C.x*a.d6(a.az(ve.y))*xe,te[1]=-C.y*a.d6(w.center.lat)*xe}else{const xe=w.pointCoordinate(U.sub(C));ve&&xe&&(te[0]=xe.x-ve.x,te[1]=xe.y-ve.y)}}const ne=w.zoom,ie=[0,0,0];if(k){const ve=S($||w.pointCoordinate3D(U)),xe={dir:a.$.normalize([],a.$.sub([],ve,w._camera.position))};if(xe.dir[2]<0){const ye=w.zoomDeltaToMovement(ve,k);a.$.scale(ie,xe.dir,ye)}}const ae=a.$.add(te,te,ie);w._translateCameraConstrained(ae),k&&Math.abs(w.zoom-ne)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,_,!0)}_fireEvents(l,d,_){const x=sp(this._eventsInProgress),w=sp(l),S={};for(const N in l){const{originalEvent:U}=l[N];this._eventsInProgress[N]||(S[`${N}start`]=U),this._eventsInProgress[N]=l[N]}!x&&w&&this._fireEvent("movestart",w.originalEvent);for(const N in S)this._fireEvent(N,S[N]);w&&this._fireEvent("move",w.originalEvent);for(const N in l){const{originalEvent:U}=l[N];this._fireEvent(N,U)}const C={};let k;for(const N in this._eventsInProgress){const{handlerName:U,originalEvent:$}=this._eventsInProgress[N];this._handlersById[U].isActive()||(delete this._eventsInProgress[N],k=d[U]||$,C[`${N}end`]=k)}for(const N in C)this._fireEvent(N,C[N]);const L=sp(this._eventsInProgress);if(_&&(x||w)&&!L){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;N?(U(N.bearing||this._map.getBearing())&&(N.bearing=0),this._map.easeTo(N,{originalEvent:k})):(this._map.fire(new a.g("moveend",{originalEvent:k})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,d){this._map.fire(new a.g(l,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new aa("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Xm="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qy extends a.E{constructor(l,d){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=d.respectPrefersReducedMotion!==!1,a.br(["_renderFrameCallback"],this)}getCenter(){return new a.aJ(this.transform.center.lng,this.transform.center.lat)}setCenter(l,d){return this.jumpTo({center:l},d)}panBy(l,d,_){return l=a.P.convert(l).mult(-1),this.panTo(this.transform.center,a.Q({offset:l},d),_)}panTo(l,d,_){return this.easeTo(a.Q({center:l},d),_)}getZoom(){return this.transform.zoom}setZoom(l,d){return this.jumpTo({zoom:l},d),this}zoomTo(l,d,_){return this.easeTo(a.Q({zoom:l},d),_)}zoomIn(l,d){return this.zoomTo(this.getZoom()+1,l,d),this}zoomOut(l,d){return this.zoomTo(this.getZoom()-1,l,d),this}getBearing(){return this.transform.bearing}setBearing(l,d){return this.jumpTo({bearing:l},d),this}getPadding(){return this.transform.padding}setPadding(l,d){return this.jumpTo({padding:l},d),this}rotateTo(l,d,_){return this.easeTo(a.Q({bearing:l},d),_)}resetNorth(l,d){return this.rotateTo(0,a.Q({duration:1e3},l),d),this}resetNorthPitch(l,d){return this.easeTo(a.Q({bearing:0,pitch:0,duration:1e3},l),d),this}snapToNorth(l,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,d):this}getPitch(){return this.transform.pitch}setPitch(l,d){return this.jumpTo({pitch:l},d),this}cameraForBounds(l,d){l=a.aj.convert(l);const _=d&&d.bearing||0,x=d&&d.pitch||0,w=l.getNorthWest(),S=l.getSouthEast();return this._cameraForBounds(this.transform,w,S,_,x,d)}_extendPadding(l){const d={top:0,right:0,bottom:0,left:0};return l==null?a.Q({},d,this.transform.padding):typeof l=="number"?{top:l,bottom:l,right:l,left:l}:a.Q({},d,l)}_extendCameraOptions(l){return(l=a.Q({offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=this._extendPadding(l.padding),l}_minimumAABBFrustumDistance(l,d){const _=d.max[0]-d.min[0],x=d.max[1]-d.min[1];return _/x>l.aspect?_/(2*Math.tan(.5*l.fovX)*l.aspect):x/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,d,_,x,w,S){const C=l.clone(),k=this._extendCameraOptions(S);C.bearing=x,C.pitch=w;const L=a.aJ.convert(d),N=a.aJ.convert(_),U=.5*(L.lat+N.lat),$=.5*(L.lng+N.lng),q=a.d7(U,$),te=a.$.normalize([],q),ne=a.$.normalize([],a.$.cross([],te,[0,1,0])),ie=a.$.cross([],ne,te),ae=[ne[0],ne[1],ne[2],0,ie[0],ie[1],ie[2],0,te[0],te[1],te[2],0,0,0,0,1],ve=[q,a.d7(L.lat,L.lng),a.d7(N.lat,L.lng),a.d7(N.lat,N.lng),a.d7(L.lat,N.lng),a.d7(U,L.lng),a.d7(U,N.lng),a.d7(L.lat,$),a.d7(N.lat,$)];let xe=a.b8.fromPoints(ve.map(Ue=>[a.$.dot(ne,Ue),a.$.dot(ie,Ue),a.$.dot(te,Ue)]));const ye=a.$.transformMat4([],xe.center,ae);a.$.squaredLength(ye)===0&&a.$.set(ye,0,0,1),a.$.normalize(ye,ye),a.$.scale(ye,ye,a.cF),C.center=a.d8(ye);const Me=C.getWorldToCameraMatrix(),Se=a.ae.invert(new Float64Array(16),Me);xe=a.b8.applyTransform(xe,a.ae.multiply([],Me,ae));const Ie=this._extendAABB(xe,C,k,x);if(!Ie)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");xe=Ie,a.$.transformMat4(ye,ye,Me);const Ne=.5*(xe.max[2]-xe.min[2]),Fe=this._minimumAABBFrustumDistance(C,xe),We=a.$.scale([],[0,0,1],Ne),Be=a.$.add(We,ye,We),Re=Fe+(C.pitch===0?0:a.$.distance(ye,Be)),Je=C.globeCenterInViewSpace,Ye=a.$.sub([],ye,[Je[0],Je[1],Je[2]]);a.$.normalize(Ye,Ye),a.$.scale(Ye,Ye,Re);const je=a.$.add([],ye,Ye);a.$.transformMat4(je,je,Se);const vt=a.da/a.cF,dt=a.$.length(je),He=a.ay(Math.max(dt*vt-a.da,Number.EPSILON),0),it=Math.min(C.zoomFromMercatorZAdjusted(He),k.maxZoom);return it>.5*(a.b3+a.aV)?(C.setProjection({name:"mercator"}),C.zoom=it,this._cameraForBounds(C,d,_,x,w,S)):{center:C.center,zoom:it,bearing:x,pitch:w}}_extendAABB(l,d,_,x){const w=.5*((_.padding.left||0)+(_.padding.right||0)),S=.5*((_.padding.top||0)+(_.padding.bottom||0)),C=S,k=w,L=w,N=S,U=d.width-(k+L),$=d.height-(C+N),q=a.$.sub([],l.max,l.min),te=Math.min(U/q[0],$/q[1]),ne=Math.min(d.scaleZoom(d.scale*te),_.maxZoom);if(isNaN(ne))return null;const ie=d.scale/d.zoomScale(ne),ae=new a.b8([l.min[0]-k*ie,l.min[1]-N*ie,l.min[2]],[l.max[0]+L*ie,l.max[1]+C*ie,l.max[2]]),ve=(typeof _.offset.x=="number"&&typeof _.offset.y=="number"?new a.P(_.offset.x,_.offset.y):a.P.convert(_.offset)).rotate(-a.ac(x));return ae.center[0]-=ve.x*ie,ae.center[1]+=ve.y*ie,ae}queryTerrainElevation(l,d){const _=this.transform.elevation;return _?(d=a.Q({},{exaggerated:!0},d),_.getAtPoint(a._.fromLngLat(l),null,d.exaggerated)):null}_cameraForBounds(l,d,_,x,w,S){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,d,_,x,w,S);const C=l.clone(),k=this._extendCameraOptions(S);C.bearing=x,C.pitch=w;const L=a.aJ.convert(d),N=a.aJ.convert(_),U=new a.aJ(L.lng,N.lat),$=new a.aJ(N.lng,L.lat),q=C.project(L),te=C.project(N),ne=this.queryTerrainElevation(L),ie=this.queryTerrainElevation(N),ae=this.queryTerrainElevation(U),ve=this.queryTerrainElevation($),xe=[[q.x,q.y,Math.min(ne||0,ie||0,ae||0,ve||0)],[te.x,te.y,Math.max(ne||0,ie||0,ae||0,ve||0)]];let ye=a.b8.fromPoints(xe);const Me=C.getWorldToCameraMatrix(),Se=a.ae.invert(new Float64Array(16),Me);ye=a.b8.applyTransform(ye,Me);const Ie=this._extendAABB(ye,C,k,x);if(!Ie)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ye=Ie;const Ne=.5*a.$.sub([],ye.max,ye.min)[2],Fe=this._minimumAABBFrustumDistance(C,ye),We=[0,0,1,0];a.aB.transformMat4(We,We,Me),a.aB.normalize(We,We);const Be=a.$.scale([],We,Fe+Ne),Re=a.$.add([],ye.center,Be);a.$.transformMat4(ye.center,ye.center,Se),a.$.transformMat4(Re,Re,Se);const Je=[ye.center[0],ye.center[1],Re[2]*C.pixelsPerMeter];a.$.scale(Je,Je,1/C.worldSize);const Ye=a.d9(Je[0]),je=a.az(Je[1]),vt=Math.min(C._zoomFromMercatorZ(Je[2]),k.maxZoom),dt=new a.aJ(Ye,je);return C.mercatorFromTransition&&vt<.5*(a.b3+a.aV)?(C.setProjection({name:"globe"}),C.zoom=vt,this._cameraForBounds(C,d,_,x,w,S)):{center:dt,zoom:vt,bearing:x,pitch:w}}fitBounds(l,d,_){const x=this.cameraForBounds(l,d);return this._fitInternal(x,d,_)}fitScreenCoordinates(l,d,_,x,w){const S=a.P.convert(l),C=a.P.convert(d),k=new a.P(Math.min(S.x,C.x),Math.min(S.y,C.y)),L=new a.P(Math.max(S.x,C.x),Math.max(S.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,C))return this;const N=this.transform.pointLocation3D(k),U=this.transform.pointLocation3D(L),$=this.transform.pointLocation3D(new a.P(k.x,L.y)),q=this.transform.pointLocation3D(new a.P(L.x,k.y)),te=[Math.min(N.lng,U.lng,$.lng,q.lng),Math.min(N.lat,U.lat,$.lat,q.lat)],ne=[Math.max(N.lng,U.lng,$.lng,q.lng),Math.max(N.lat,U.lat,$.lat,q.lat)],ie=x&&x.pitch?x.pitch:this.getPitch(),ae=this._cameraForBounds(this.transform,te,ne,_,ie,x);return this._fitInternal(ae,x,w)}_fitInternal(l,d,_){return l?(d=a.Q(l,d)).linear?this.easeTo(d,_):this.flyTo(d,_):this}jumpTo(l,d){this.stop();const _=l.preloadOnly?this.transform.clone():this.transform;let x=!1,w=!1,S=!1;if("zoom"in l&&_.zoom!==+l.zoom&&(x=!0,_.zoom=+l.zoom),l.center!==void 0&&(_.center=a.aJ.convert(l.center)),"bearing"in l&&_.bearing!==+l.bearing&&(w=!0,_.bearing=+l.bearing),"pitch"in l&&_.pitch!==+l.pitch&&(S=!0,_.pitch=+l.pitch),l.padding!=null){const C=typeof l.padding=="number"?this._extendPadding(l.padding):l.padding;_.isPaddingEqual(C)||(_.padding=C)}return l.preloadOnly?(this._preloadTiles(_),this):(this.fire(new a.g("movestart",d)).fire(new a.g("move",d)),x&&this.fire(new a.g("zoomstart",d)).fire(new a.g("zoom",d)).fire(new a.g("zoomend",d)),w&&this.fire(new a.g("rotatestart",d)).fire(new a.g("rotate",d)).fire(new a.g("rotateend",d)),S&&this.fire(new a.g("pitchstart",d)).fire(new a.g("pitch",d)).fire(new a.g("pitchend",d)),this.fire(new a.g("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.w(Xm),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,d){const _=this.transform;if(!_.projection.supportsFreeCamera)return a.w(Xm),this;this.stop();const x=_.zoom,w=_.pitch,S=_.bearing;_.setFreeCameraOptions(l);const C=x!==_.zoom,k=w!==_.pitch,L=S!==_.bearing;return this.fire(new a.g("movestart",d)).fire(new a.g("move",d)),C&&this.fire(new a.g("zoomstart",d)).fire(new a.g("zoom",d)).fire(new a.g("zoomend",d)),L&&this.fire(new a.g("rotatestart",d)).fire(new a.g("rotate",d)).fire(new a.g("rotateend",d)),k&&this.fire(new a.g("pitchstart",d)).fire(new a.g("pitch",d)).fire(new a.g("pitchend",d)),this.fire(new a.g("moveend",d)),this}easeTo(l,d){this._stop(!1,l.easeId),((l=a.Q({offset:[0,0],duration:500,easing:a.d5},l)).animate===!1||this._prefersReducedMotion(l))&&(l.duration=0);const _=this.transform,x=this.getZoom(),w=this.getBearing(),S=this.getPitch(),C=this.getPadding(),k="zoom"in l?+l.zoom:x,L="bearing"in l?this._normalizeBearing(l.bearing,w):w,N="pitch"in l?+l.pitch:S,U=this._extendPadding(l.padding),$=a.P.convert(l.offset);let q,te,ne;if(_.projection.name==="globe"){const Fe=a._.fromLngLat(_.center),We=$.rotate(-_.angle);Fe.x+=We.x/_.worldSize,Fe.y+=We.y/_.worldSize;const Be=Fe.toLngLat(),Re=a.aJ.convert(l.center||Be);this._normalizeCenter(Re),q=_.centerPoint.add(We),te=new a.P(Fe.x,Fe.y).mult(_.worldSize),ne=new a.P(a.ak(Re.lng),a.al(Re.lat)).mult(_.worldSize).sub(te)}else{q=_.centerPoint.add($);const Fe=_.pointLocation(q),We=a.aJ.convert(l.center||Fe);this._normalizeCenter(We),te=_.project(Fe),ne=_.project(We).sub(te)}const ie=_.zoomScale(k-x);let ae,ve;l.around&&(ae=a.aJ.convert(l.around),ve=_.locationPoint(ae));const xe=this._zooming||k!==x,ye=this._rotating||w!==L,Me=this._pitching||N!==S,Se=!_.isPaddingEqual(U),Ie=Fe=>We=>{if(xe&&(Fe.zoom=a.a3(x,k,We)),ye&&(Fe.bearing=a.a3(w,L,We)),Me&&(Fe.pitch=a.a3(S,N,We)),Se&&(Fe.interpolatePadding(C,U,We),q=Fe.centerPoint.add($)),ae)Fe.setLocationAtPoint(ae,ve);else{const Be=Fe.zoomScale(Fe.zoom-x),Re=k>x?Math.min(2,ie):Math.max(.5,ie),Je=Math.pow(Re,1-We),Ye=Fe.unproject(te.add(ne.mult(We*Je)).mult(Be));Fe.setLocationAtPoint(Fe.renderWorldCopies?Ye.wrap():Ye,q)}return l.preloadOnly||this._fireMoveEvents(d),Fe};if(l.preloadOnly){const Fe=this._emulate(Ie,l.duration,_);return this._preloadTiles(Fe),this}const Ne={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=xe,this._rotating=ye,this._pitching=Me,this._padding=Se,this._easeId=l.easeId,this._prepareEase(d,l.noMoveStart,Ne),this._ease(Ie(_),Fe=>{_.cameraElevationReference==="sea"&&_.recenterOnTerrain(),this._afterEase(d,Fe)},l),this}_prepareEase(l,d,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),d||_.moving||this.fire(new a.g("movestart",l)),this._zooming&&!_.zooming&&this.fire(new a.g("zoomstart",l)),this._rotating&&!_.rotating&&this.fire(new a.g("rotatestart",l)),this._pitching&&!_.pitching&&this.fire(new a.g("pitchstart",l))}_fireMoveEvents(l){this.fire(new a.g("move",l)),this._zooming&&this.fire(new a.g("zoom",l)),this._rotating&&this.fire(new a.g("rotate",l)),this._pitching&&this.fire(new a.g("pitch",l))}_afterEase(l,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,x=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new a.g("zoomend",l)),x&&this.fire(new a.g("rotateend",l)),w&&this.fire(new a.g("pitchend",l)),this.fire(new a.g("moveend",l))}flyTo(l,d){if(this._prefersReducedMotion(l)){const it=a.ai(l,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(it,d)}this.stop(),l=a.Q({offset:[0,0],speed:1.2,curve:1.42,easing:a.d5},l);const _=this.transform,x=this.getZoom(),w=this.getBearing(),S=this.getPitch(),C=this.getPadding(),k="zoom"in l?a.au(+l.zoom,_.minZoom,_.maxZoom):x,L="bearing"in l?this._normalizeBearing(l.bearing,w):w,N="pitch"in l?+l.pitch:S,U=this._extendPadding(l.padding),$=_.zoomScale(k-x),q=a.P.convert(l.offset);let te=_.centerPoint.add(q);const ne=_.pointLocation(te),ie=a.aJ.convert(l.center||ne);this._normalizeCenter(ie);const ae=_.project(ne),ve=_.project(ie).sub(ae);let xe=l.curve;const ye=Math.max(_.width,_.height),Me=ye/$,Se=ve.mag();if("minZoom"in l){const it=a.au(Math.min(l.minZoom,x,k),_.minZoom,_.maxZoom),Ue=ye/_.zoomScale(it-x);xe=Math.sqrt(Ue/Se*2)}const Ie=xe*xe;function Ne(it){const Ue=(Me*Me-ye*ye+(it?-1:1)*Ie*Ie*Se*Se)/(2*(it?Me:ye)*Ie*Se);return Math.log(Math.sqrt(Ue*Ue+1)-Ue)}function Fe(it){return(Math.exp(it)-Math.exp(-it))/2}function We(it){return(Math.exp(it)+Math.exp(-it))/2}const Be=Ne(0);let Re=function(it){return We(Be)/We(Be+xe*it)},Je=function(it){return ye*((We(Be)*(Fe(Ue=Be+xe*it)/We(Ue))-Fe(Be))/Ie)/Se;var Ue},Ye=(Ne(1)-Be)/xe;if(Math.abs(Se)<1e-6||!isFinite(Ye)){if(Math.abs(ye-Me)<1e-6)return this.easeTo(l,d);const it=Me<ye?-1:1;Ye=Math.abs(Math.log(Me/ye))/xe,Je=function(){return 0},Re=function(Ue){return Math.exp(it*xe*Ue)}}l.duration="duration"in l?+l.duration:1e3*Ye/("screenSpeed"in l?+l.screenSpeed/xe:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const je=w!==L,vt=N!==S,dt=!_.isPaddingEqual(U),He=it=>Ue=>{const ft=Ue*Ye,gt=1/Re(ft);it.zoom=Ue===1?k:x+it.scaleZoom(gt),je&&(it.bearing=a.a3(w,L,Ue)),vt&&(it.pitch=a.a3(S,N,Ue)),dt&&(it.interpolatePadding(C,U,Ue),te=it.centerPoint.add(q));const Ut=Ue===1?ie:it.unproject(ae.add(ve.mult(Je(ft))).mult(gt));return it.setLocationAtPoint(it.renderWorldCopies?Ut.wrap():Ut,te),it._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(d),it};if(l.preloadOnly){const it=this._emulate(He,l.duration,_);return this._preloadTiles(it),this}return this._zooming=!0,this._rotating=je,this._pitching=vt,this._padding=dt,this._prepareEase(d,!1),this._ease(He(_),()=>this._afterEase(d),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(l){}_cancelRenderFrame(l){}_stop(l,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,d)}if(!l){const _=this.handlers;_&&_.stop(!1)}return this}_ease(l,d,_){_.animate===!1||_.duration===0?(l(1),d()):(this._easeStart=a.e.now(),this._easeOptions=_,this._onEaseFrame=l,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((a.e.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,d){l=a.av(l,-180,180);const _=Math.abs(l-d);return Math.abs(l-360-d)<_&&(l-=360),Math.abs(l+360-d)<_&&(l+=360),l}_normalizeCenter(l){const d=this.transform;if(d.maxBounds||d.projection.name!=="globe"&&!d.renderWorldCopies)return;const _=l.lng-d.center.lng;l.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&a.e.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,d,_){const x=Math.ceil(15*d/1e3),w=[],S=l(_.clone());for(let C=0;C<=x;C++){const k=S(C/x);w.push(k.clone())}return w}_preloadTiles(l,d){}}class op{constructor(l={}){this.options=l,a.br(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const d=this.options&&this.options.compact,_=l._getUIString("AttributionControl.ToggleAttribution");this._map=l,this._container=B("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=B("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",_);const x=B("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",_),this._innerContainer=B("div","mapboxgl-ctrl-attrib-inner",this._container),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.db.ACCESS_TOKEN}];if(l){const _=d.reduce((x,w,S)=>(w.value&&(x+=`${w.key}=${w.value}${S<d.length-1?"&":""}`),x),"?");l.href=`${a.db.FEEDBACK_URL}/${_}#${Ny(this._map,!0)}`,l.rel="noopener nofollow"}}_updateData(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const d=this._map.style._mergedSourceCaches;for(const x in d){const w=d[x];if(w.used){const S=w.getSource();S.attribution&&l.indexOf(S.attribution)<0&&l.push(S.attribution)}}l.sort((x,w)=>x.length-w.length),l=l.filter((x,w)=>{for(let S=w+1;S<l.length;S++)if(l[S].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const _=l.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,l.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Km{constructor(){a.br(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=B("div","mapboxgl-ctrl");const d=B("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(const d in l){const _=l[d].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const d=l[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class Ym{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d}remove(l){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const x of _)if(x.id===l)return void(x.cancelled=!0)}run(l=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ap(g,l,d){if(g=new a.aJ(g.lng,g.lat),l){const _=new a.aJ(g.lng-360,g.lat),x=new a.aJ(g.lng+360,g.lat),w=360*Math.ceil(Math.abs(g.lng-d.center.lng)/360),S=d.locationPoint(g).distSqr(l),C=l.x<0||l.y<0||l.x>d.width||l.y>d.height;d.locationPoint(_).distSqr(l)<S&&(C||Math.abs(_.lng-d.center.lng)<w)?g=_:d.locationPoint(x).distSqr(l)<S&&(C||Math.abs(x.lng-d.center.lng)<w)&&(g=x)}for(;Math.abs(g.lng-d.center.lng)>180;){const _=d.locationPoint(g);if(_.x>=0&&_.y>=0&&_.x<=d.width&&_.y<=d.height)break;g.lng>d.center.lng?g.lng-=360:g.lng+=360}return g}const Qm={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Jm extends a.E{constructor(l,d){if(super(),(l instanceof HTMLElement||d)&&(l=a.Q({element:l},d)),a.br(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=a.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=B("div");const w=41,S=27,C=H("svg",{display:"block",height:w*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${w}`},this._element),k=H("radialGradient",{id:"shadowGradient"},H("defs",{},C));H("stop",{offset:"10%","stop-opacity":.4},k),H("stop",{offset:"100%","stop-opacity":.05},k),H("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),H("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),H("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),H("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=a.P.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const _=this._element.classList;for(const w in Qm)_.remove(`mapboxgl-marker-anchor-${w}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`);const x=l&&l.className?l.className.trim().split(/\s+/):[];_.add(...x),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=a.aJ.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const d=l.code,_=l.charCode||l.keyCode;d!=="Space"&&d!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(l){const d=l.originalEvent.target,_=this._element;this._popup&&(d===_||_.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,d=this._pos;if(!l||!d)return!1;const _=l.unproject(d),x=l.getFreeCameraOptions();if(!x.position)return!1;const w=x.position.toLngLat();return w.distanceTo(_)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const d=this._pos;if(!d||d.x<0||d.x>l.transform.width||d.y<0||d.y>l.transform.height)return void this._clearFadeTimer();const _=l.unproject(d);let x;l._showingGlobe()&&a.dc(l.transform,this._lngLat)?x=0:(x=1-l._queryFogOpacity(_),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${Qm[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${d.x}px,${d.y}px)
        `}_calculateXYTransform(){const l=this._pos,d=this._map,_=this.getPitchAlignment();if(!d||!l||_!=="map")return"";if(!d._showingGlobe()){const k=d.getPitch();return k?`rotateX(${k}deg)`:""}const x=a.b1(a.dd(d.transform,this._lngLat)),w=l.sub(a.de(d.transform)),S=Math.abs(w.x)+Math.abs(w.y);if(S===0)return"";const C=x/S;return`rotateX(${-w.y*C}deg) rotateY(${w.x*C}deg)`}_calculateZTransform(){const l=this._pos,d=this._map;if(!d||!l)return"";let _=0;const x=this.getRotationAlignment();if(x==="map")if(d._showingGlobe()){const w=d.project(new a.aJ(this._lngLat.lng,this._lngLat.lat+.001)),S=d.project(new a.aJ(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);_=a.b1(Math.atan2(S.y,S.x))-90}else _=-d.getBearing();else if(x==="horizon"){const w=a.a0(4,6,d.getZoom()),S=a.de(d.transform);S.y+=w*d.transform.height;const C=l.sub(S),k=a.b1(Math.atan2(C.y,C.x));_=(k>90?k-270:k+90)*(1-w)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(l){cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=ap(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),l===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=a.P.convert(l),this._update(),this}addClassName(l){return this._element.classList.add(l),this}removeClassName(l){return this._element.classList.remove(l),this}toggleClassName(l){return this._element.classList.toggle(l)}_onMove(l){const d=this._map;if(!d)return;const _=this._pointerdownPos,x=this._positionDelta;if(_&&x){if(!this._isDragging){const w=this._clickTolerance||d._clickTolerance;if(l.point.dist(_)<w)return;this._isDragging=!0}this._pos=l.point.sub(x),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.g("dragstart"))),this.fire(new a.g("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.g("dragend")),this._state="inactive"}_addDragHandler(l){const d=this._map,_=this._pos;d&&_&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(_),this._pointerdownPos=l.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const d=this._map;return d&&(l?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const cd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},iA=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Q1(g=new a.P(0,0),l="bottom"){if(typeof g=="number"){const d=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(l){case"top":return new a.P(0,g);case"top-left":return new a.P(d,d);case"top-right":return new a.P(-d,d);case"bottom":return new a.P(0,-g);case"bottom-left":return new a.P(d,-d);case"bottom-right":return new a.P(-d,-d);case"left":return new a.P(g,0);case"right":return new a.P(-g,0)}return new a.P(0,0)}return g instanceof a.P||Array.isArray(g)?a.P.convert(g):a.P.convert(g[l]||[0,0])}class sA{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const d=a.bb((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,d,_){this._start=this.getValue(d),this._end=l,this._startTime=d,this._endTime=d+_}}const oA={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class aA{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const lA={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},Wy={showCompass:!0,showZoom:!0,visualizePitch:!1};class Hy{constructor(l,d,_=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new tp({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,_&&(this.mousePitch=new Wm({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),a.br(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(l,d){this.mouseRotate.mousedown(l,d),this.mousePitch&&this.mousePitch.mousedown(l,d),G()}move(l,d){const _=this.map,x=this.mouseRotate.mousemoveWindow(l,d),w=x&&x.bearingDelta;if(w&&_.setBearing(_.getBearing()+w),this.mousePitch){const S=this.mousePitch.mousemoveWindow(l,d),C=S&&S.pitchDelta;C&&_.setPitch(_.getPitch()+C)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Y(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(a.Q({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),Te(this.element,l)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,Te(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Pe(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=Pe(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const J1={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ud={maxWidth:100,unit:"metric"},eb={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:a.dw,supported:A,setRTLTextPlugin:a.dy,getRTLTextPluginStatus:a.dz,Map:class extends qy{constructor(g){a.df.mark(a.dg.create);const l=g;if((g=a.Q({},lA,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&a.dh(window)&&(g.antialias=!1,a.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Bc(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._repaint=!!g.repaint,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new Ym,this._domRenderTaskQueue=new Ym,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.di(),this._locale=a.Q({},oA,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._tessellationStep=g.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=g.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new sA(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new a.dj(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?{...g.contextCreateOptions}:{},typeof g.container=="string"){const d=document.getElementById(g.container);if(!d)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=d}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&a.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),a.br(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new aA),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Zm(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||a.db.DEFAULT_STYLE,{config:g.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),g.hash&&(this._hash=new $1(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){l.center==null&&l.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const d=g.bounds;d&&(this.resize(),this.fitBounds(d,a.Q({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new op({customAttribution:g.customAttribution})),this._logoControl=new Km,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new a.g(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new a.g(`${d.dataType}dataloading`,d))})}_getMapId(){return this._mapId}addControl(g,l){if(l===void 0&&(l=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new a.f(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=g.onAdd(this);this._controls.push(g);const _=this._controlPositions[l];return l.indexOf("bottom")!==-1?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new a.f(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(g);return l>-1&&this._controls.splice(l,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new a.g("movestart",g)).fire(new a.g("move",g)),this.fire(new a.g("resize",g)),l&&this.fire(new a.g("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(a.aj.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new a.g("zoomstart")).fire(new a.g("zoom")).fire(new a.g("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new a.g("zoomstart")).fire(new a.g("zoom")).fire(new a.g("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new a.g("pitchstart")).fire(new a.g("pitch")).fire(new a.g("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new a.g("pitchstart")).fire(new a.g("pitch")).fire(new a.g("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(l=>l==="auto"?navigator.language:l):g}setLanguage(g){const l=this._parseLanguage(g);if(!this.style||l===this._language)return this;this._language=l,this.style.reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,l=g.projection.name;let d;l==="globe"&&g.zoom>=a.aV?(g.setMercatorFromTransition(),d=!0):l==="mercator"&&g.zoom<a.aV&&(g.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,l){return this._updateProjection(g||l||{name:"mercator"})}_updateProjection(g){let l;return l=g.name==="globe"&&this.transform.zoom>=a.aV?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),l&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g){return this.transform.locationPoint3D(a.aJ.convert(g))}unproject(g){return this.transform.pointLocation3D(a.P.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,l,d){if(g==="mouseenter"||g==="mouseover"){let _=!1;const x=S=>{const C=l.filter(L=>this.getLayer(L)),k=C.length?this.queryRenderedFeatures(S.point,{layers:C}):[];k.length?_||(_=!0,d.call(this,new oa(g,this,S.originalEvent,{features:k}))):_=!1},w=()=>{_=!1};return{layers:new Set(l),listener:d,delegates:{mousemove:x,mouseout:w}}}if(g==="mouseleave"||g==="mouseout"){let _=!1;const x=S=>{const C=l.filter(k=>this.getLayer(k));(C.length?this.queryRenderedFeatures(S.point,{layers:C}):[]).length?_=!0:_&&(_=!1,d.call(this,new oa(g,this,S.originalEvent)))},w=S=>{_&&(_=!1,d.call(this,new oa(g,this,S.originalEvent)))};return{layers:new Set(l),listener:d,delegates:{mousemove:x,mouseout:w}}}{const _=x=>{const w=l.filter(C=>this.getLayer(C)),S=w.length?this.queryRenderedFeatures(x.point,{layers:w}):[];S.length&&(x.features=S,d.call(this,x),delete x.features)};return{layers:new Set(l),listener:d,delegates:{[g]:_}}}}on(g,l,d){if(typeof l=="function"||d===void 0)return super.on(g,l);if(Array.isArray(l)||(l=[l]),l){for(const x of l)if(!this._isValidId(x))return this}const _=this._createDelegatedListener(g,l,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(_);for(const x in _.delegates)this.on(x,_.delegates[x]);return this}once(g,l,d){if(typeof l=="function"||d===void 0)return super.once(g,l);if(Array.isArray(l)||(l=[l]),l){for(const x of l)if(!this._isValidId(x))return this}const _=this._createDelegatedListener(g,l,d);for(const x in _.delegates)this.once(x,_.delegates[x]);return this}off(g,l,d){if(typeof l=="function"||d===void 0)return super.off(g,l);const _=new Set(Array.isArray(l)?l:[l]);for(const S of _)if(!this._isValidId(S))return this;const x=(S,C)=>{if(S.size!==C.size)return!1;for(const k of S)if(!C.has(k))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[g]:void 0;return w&&(S=>{for(let C=0;C<S.length;C++){const k=S[C];if(k.listener===d&&x(k.layers,_)){for(const L in k.delegates)this.off(L,k.delegates[L]);return S.splice(C,1),this}}})(w),this}queryRenderedFeatures(g,l){if(!this.style)return[];if(l!==void 0||g===void 0||g instanceof a.P||Array.isArray(g)||(l=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],(l=l||{}).layers&&Array.isArray(l.layers)){for(const d of l.layers)if(!this._isValidId(d))return[]}return this.style.queryRenderedFeatures(g,l,this.transform)}querySourceFeatures(g,l){return this._isValidId(g)?this.style.querySourceFeatures(g,l):[]}isPointOnSurface(g){const{name:l}=this.transform.projection;return l!=="globe"&&l!=="mercator"&&a.w(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(g))}setStyle(g,l){return l=a.Q({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l),this.style&&g&&l.diff!==!1&&l.localFontFamily===this._localFontFamily&&l.localIdeographFontFamily===this._localIdeographFontFamily&&!l.config?(this.style._diffStyle(g,(d,_)=>{d?(a.w(`Unable to perform style diff: ${String(d.message||d.error||d)}. Rebuilding the style from scratch.`),this._updateStyle(g,l)):_&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(g,l))}_getUIString(g){const l=this._locale[g];if(l==null)throw new Error(`Missing UI string '${g}'`);return l}_updateStyle(g,l){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g){const d=a.Q({},l);l&&l.config&&(d.initialConfig=l.config,delete d.config),this.style=new sa(this,d).load(g),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new sa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.w("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new a.f(new Error("IDs can't be empty."))),!1):!a.cY(g)||(this.fire(new a.f(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}addSource(g,l){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,l),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,l,d){this._lazyInitEmptyStyle(),this.style.addSourceType(g,l,d)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,l,{pixelRatio:d=1,sdf:_=!1,stretchX:x,stretchY:w,content:S}={}){if(this._lazyInitEmptyStyle(),l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap){const{width:C,height:k,data:L}=a.e.getImageData(l);this.style.addImage(g,{data:new a.j({width:C,height:k},L),pixelRatio:d,stretchX:x,stretchY:w,content:S,sdf:_,version:0})}else if(l.width===void 0||l.height===void 0)this.fire(new a.f(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:k}=l,L=l;this.style.addImage(g,{data:new a.j({width:C,height:k},new Uint8Array(L.data)),pixelRatio:d,stretchX:x,stretchY:w,content:S,sdf:_,version:0,userImage:L}),L.onAdd&&L.onAdd(this,g)}}updateImage(g,l){this._lazyInitEmptyStyle();const d=this.style.getImage(g);if(!d)return void this.fire(new a.f(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap?a.e.getImageData(l):l,{width:x,height:w,data:S}=_;if(x===void 0||w===void 0)return void this.fire(new a.f(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==d.data.width||w!==d.data.height)return void this.fire(new a.f(new Error(`The width and height of the updated image (${x}, ${w})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const C=!(l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap);d.data.replace(S,C),this.style.updateImage(g,d)}hasImage(g){return g?!!this.style&&!!this.style.getImage(g):(this.fire(new a.f(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,l){a.i(this._requestManager.transformRequest(g,a.R.Image),(d,_)=>{l(d,_ instanceof HTMLImageElement?a.e.getImageData(_):_)})}listImages(){return this.style.listImages()}addModel(g,l){this._lazyInitEmptyStyle(),this.style.addModel(g,l)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new a.f(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,l){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,l),this._update(!0)):this}getSlot(g){const l=this.getLayer(g);return l&&l.slot||null}setSlot(g,l){return this.style.setSlot(g,l),this.style.mergeLayers(),this._update(!0)}addImport(g,l){return this.style.addImport(g,l),this}updateImport(g,l){return typeof l!="string"&&l.id!==g?(this.removeImport(g),this.addImport(l)):(this.style.updateImport(g,l),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,l){return this.style.moveImport(g,l),this._update(!0)}moveLayer(g,l){return this._isValidId(g)?(this.style.moveLayer(g,l),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){if(!this._isValidId(g))return null;const l=this.style.getOwnLayer(g);return l?l.type==="custom"?l.implementation:l.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(g,l,d){return this._isValidId(g)?(this.style.setLayerZoomRange(g,l,d),this._update(!0)):this}setFilter(g,l,d={}){return this._isValidId(g)?(this.style.setFilter(g,l,d),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,l,d,_={}){return this._isValidId(g)?(this.style.setPaintProperty(g,l,d,_),this._update(!0)):this}getPaintProperty(g,l){return this._isValidId(g)?this.style.getPaintProperty(g,l):null}setLayoutProperty(g,l,d,_={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,l,d,_),this._update(!0)):this}getLayoutProperty(g,l){return this._isValidId(g)?this.style.getLayoutProperty(g,l):null}getSchema(g){return this.style.getSchema(g)}setSchema(g,l){return this.style.setSchema(g,l),this._update(!0)}getConfig(g){return this.style.getConfig(g)}setConfig(g,l){return this.style.setConfig(g,l),this._update(!0)}getConfigProperty(g,l){return this.style.getConfigProperty(g,l)}setConfigProperty(g,l,d){return this.style.setConfigProperty(g,l,d),this._update(!0)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const l=g[0];l.properties?this.style.setFlatLight(l.properties,l.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,l={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(g){return this._lazyInitEmptyStyle(),this.style.setColorTheme(g),this._update(!0)}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.aJ.convert(g),this.transform):0}setFeatureState(g,l){return this._isValidId(g.source)?(this.style.setFeatureState(g,l),this._update()):this}removeFeatureState(g,l){return this._isValidId(g.source)?(this.style.removeFeatureState(g,l),this._update()):this}getFeatureState(g){return this._isValidId(g.source)?this.style.getFeatureState(g):null}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let d,_,x,w=this._container;for(;w&&(!_||!x);){const S=window.getComputedStyle(w).transform;S&&S!=="none"&&(d=S.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&d[0]!=="0"&&d[0]!=="1"&&(_=d[0]),d[3]&&d[3]!=="0"&&d[3]!=="1"&&(x=d[3])),w=w.parentElement}this._containerWidth=_?Math.abs(g/_):g,this._containerHeight=x?Math.abs(l/x):l}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=B("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=B("div","mapboxgl-canvas-container",g);this._canvas=B("canvas","mapboxgl-canvas",l),this._interactive&&(l.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=B("div","mapboxgl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=B("div",`mapboxgl-ctrl-${x}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,l){const d=a.e.devicePixelRatio||1;this._canvas.width=d*Math.ceil(g),this._canvas.height=d*Math.ceil(l),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${l}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const l=this._markers.indexOf(g);l!==-1&&this._markers.splice(l,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const l=this._popups.indexOf(g);l!==-1&&this._popups.splice(l,1)}_setupPainter(){const g=a.Q({},A.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl2",g);l?(a.dk(l,!0),this.painter=new Ry(l,this._contextCreateOptions,this.transform,this._tp),this.on("data",d=>{d.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.dl.testSupport(l)):this.fire(new a.f(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.g("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new a.g("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let l;this.fire(new a.g("renderstart")),++this._frameId;const d=this.painter.context.extTimerQuery,_=a.e.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(l=x.createQuery(),x.beginQuery(d.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,N=this.transform.pitch,U=a.e.now(),$=new a.Y(L,{now:U,fadeDuration:w,pitch:N,transition:this.style.transition});this.style.update($)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(_),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(_);const C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource);if(C&&(this._placementDirty=C.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.g("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.df.mark(a.dg.load),this.fire(new a.g("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const L=a.e.now()-_;x.endQuery(d.TIME_ELAPSED_EXT),setTimeout(()=>{const N=x.getQueryParameter(l,x.QUERY_RESULT)/1e6;x.deleteQuery(l),this.fire(new a.g("gpu-timing-frame",{cpuTime:L,gpuTime:N}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const N=this.painter.queryGpuTimers(L);this.fire(new a.g("gpu-timing-layer",{layerTimes:N}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const N=this.painter.queryGpuTimeDeferredRender(L);this.fire(new a.g("gpu-timing-deferred-render",{gpuTime:N}))},50)}const k=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(k||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(S=this._updateAverageElevation(_,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new a.g("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const N=this._calculateSpeedIndex();this.fire(new a.g("speedindexcompleted",{speedIndex:N})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,a.df.mark(a.dg.fullLoad),this._performanceMetricsCollection&&a.dm(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const l of this._markers)g&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!g||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(g,l=!1){const d=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&d(0);const _=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(_||(l||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const x=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=g;const S=Math.abs(x-w);if(S>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(w),d(w);this._averageElevation.easeTo(w,g,300)}else if(S>1e-4)return this._averageElevation.jumpTo(w),d(w)}return!!this._averageElevation.isEasing(g)&&d(this._averageElevation.getValue(g))}_authenticate(){a.dn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===a.dp||g.status===401)){const l=this.painter.context.gl;a.dk(l,!1),this._logoControl instanceof Km&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.f(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.dq(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&a.dr(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const d=this.painter.context.gl,_=d.createFramebuffer();function x(w){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,w,0);const S=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,S),S}return d.bindFramebuffer(d.FRAMEBUFFER,_),this._canvasPixelComparison(x(g),l.canvasCopies.map(x),l.timeStamps)}_canvasPixelComparison(g,l,d){let _=d[1]-d[0];const x=g.length/4;for(let w=0;w<l.length;w++){const S=l[w];let C=0;for(let k=0;k<S.length;k+=4)S[k]===g[k]&&S[k+1]===g[k+1]&&S[k+2]===g[k+2]&&S[k+3]===g[k+3]&&(C+=1);_+=(d[w+2]-d[w+1])*(1-C/x)}return _}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.ds(this.painter.context.gl),a.dt.remove(),a.du.remove(),this._removed=!0,this.fire(new a.g("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=a.e.frame(l=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(l)}))}_preloadTiles(g){const l=this.style?this.style.getSourceCaches():[];return a.dv(l,(d,_)=>d._preloadTiles(g,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,this._tp.refreshUI(),g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,this._tp.refreshUI(),g&&this._update())}_setCacheLimits(g,l){a.dx(g,l)}get version(){return a.dw}},NavigationControl:class{constructor(g={}){this.options=a.Q({},Wy,g),this._container=B("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(a.br(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),B("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),B("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.br(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:l}):d.resetNorth({},{originalEvent:l}))}),this._compassIcon=B("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const l=g.getZoom(),d=l===g.getMaxZoom(),_=l===g.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Hy(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,l){const d=B("button",g,this._container);return d.type="button",d.addEventListener("click",l),d}_setButtonTitle(g,l){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${l}`);g.setAttribute("aria-label",d),g.firstElementChild&&g.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends a.E{constructor(g={}){super();const l=navigator.geolocation;this.options=a.Q({geolocation:l},J1,g),a.br(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=j1(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=B("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const l=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,g(d)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(d=>l(d.state!=="denied")).catch(()=>l()):l()}_isOutOfMapMaxBounds(g){const l=this._map.getMaxBounds(),d=g.coords;return!!l&&(d.longitude<l.getWest()||d.longitude>l.getEast()||d.latitude<l.getSouth()||d.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new a.g("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.g("geolocate",g)),this._finish()}}_updateCamera(g){const l=new a.aJ(g.coords.longitude,g.coords.latitude),d=g.coords.accuracy,_=this._map.getBearing(),x=a.Q({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(d),x,{geolocateSource:!0})}_updateMarker(g){if(g){const l=new a.aJ(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,l=a.ay(1,g._center.lat)*g.worldSize,d=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.g("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=B("button","mapboxgl-ctrl-geolocate",this._container),B("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=B("div","mapboxgl-user-location"),this._dotElement.appendChild(B("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(B("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Jm({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=B("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Jm({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.g("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.g("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.g("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.g("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:op,ScaleControl:class{constructor(g={}){this.options=a.Q({},ud,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.br(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,l=this._map,d=l._containerHeight/2,_=l._containerWidth/2-g/2,x=l.unproject([_,d]),w=l.unproject([_+g,d]),S=x.distanceTo(w);if(this.options.unit==="imperial"){const C=3.2808*S;C>5280?this._setScale(g,C/5280,"mile"):this._setScale(g,C,"foot")}else this.options.unit==="nautical"?this._setScale(g,S/1852,"nautical-mile"):S>=1e3?this._setScale(g,S/1e3,"kilometer"):this._setScale(g,S,"meter")}_setScale(g,l,d){this._map._requestDomTask(()=>{const _=function(w){const S=Math.pow(10,`${Math.floor(w)}`.length-1);let C=w/S;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(k){const L=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*L)/L}(C),S*C}(l),x=_/l;this._container.innerHTML=this._isNumberFormatSupported&&d!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(_):`${_}&nbsp;${eb[d]}`,this._container.style.width=g*x+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=B("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g={}){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:a.w("Full screen control 'container' must be a DOM element.")),a.br(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=B("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=B("button","mapboxgl-ctrl-fullscreen",this._controlContainer);B("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.E{constructor(g){super(),this.options=a.Q(Object.create(cd),g),a.br(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new a.g("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new a.g("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=a.aJ.convert(g),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const l=document.createDocumentFragment(),d=document.createElement("body");let _;for(d.innerHTML=g;_=d.firstChild,_;)l.appendChild(_);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=B("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(g),this.options.closeButton){const d=this._closeButton=B("button","mapboxgl-popup-close-button",l);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let l;return this._classList.delete(g)?l=!1:(this._classList.add(g),l=!0),this._updateClassList(),l}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const l=this._map,d=this._container,_=this._pos;if(!l||!d||!_)return"bottom";const x=d.offsetWidth,w=d.offsetHeight,S=_.x<x/2,C=_.x>l.transform.width-x/2;if(_.y+g<w)return S?"top-left":C?"top-right":"top";if(_.y>l.transform.height-w){if(S)return"bottom-left";if(C)return"bottom-right"}return S?"left":C?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),g.className=l.join(" ")}_update(g){const l=this._map,d=this._content;if(!l||!this._lngLat&&!this._trackPointer||!d)return;let _=this._container;if(_||(_=this._container=B("div","mapboxgl-popup",l.getContainer()),this._tip=B("div","mapboxgl-popup-tip",_),_.appendChild(d)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ap(this._lngLat,this._pos,l.transform)),!this._trackPointer||g){const x=this._pos=this._trackPointer&&g instanceof a.P?g:l.project(this._lngLat),w=Q1(this.options.offset),S=this._anchor=this._getAnchor(w.y),C=Q1(this.options.offset,S),k=x.add(C).round();l._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Qm[S]} translate(${k.x}px,${k.y}px)`)})}if(!this._marker&&l._showingGlobe()){const x=a.dc(l.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(iA);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:Jm,Style:sa,LngLat:a.aJ,LngLatBounds:a.aj,Point:a.P,MercatorCoordinate:a._,FreeCameraOptions:Hh,Evented:a.E,config:a.db,prewarm:a.dA,clearPrewarmedResources:a.dB,get accessToken(){return a.db.ACCESS_TOKEN},set accessToken(g){a.db.ACCESS_TOKEN=g},get baseApiUrl(){return a.db.API_URL},set baseApiUrl(g){a.db.API_URL=g},get workerCount(){return a.dC.workerCount},set workerCount(g){a.dC.workerCount=g},get maxParallelImageRequests(){return a.db.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){a.db.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){a.dD(g)},get workerUrl(){return a.dE.workerUrl},set workerUrl(g){a.dE.workerUrl=g},get workerClass(){return a.dE.workerClass},set workerClass(g){a.dE.workerClass=g},get workerParams(){return a.dE.workerParams},set workerParams(g){a.dE.workerParams=g},get dracoUrl(){return a.dF()},set dracoUrl(g){a.dG(g)},get meshoptUrl(){return a.dH()},set meshoptUrl(g){a.dI(g)},setNow:a.e.setNow,restoreNow:a.e.restoreNow}});var T=f;return T})})(Oq);var tge=Oq.exports;const um=HE(tge),zq="pk.eyJ1Ijoia3lpbTUwIiwiYSI6ImNsempkdjZibDAzM2MybXE4bDJmcnZ6ZGsifQ.-ie6lQO1TWYrL8c6h2W41g";um.accessToken=zq;let qw=null,A6=!1;const Al={},nge=async(t,e)=>{if(Xt.currentUser){const r=gr(Rn,"users",Xt.currentUser.uid);try{await io(r,{location:{latitude:t,longitude:e,timestamp:new Date().toISOString()}})}catch(o){console.error("Error updating location:",o)}}},Nq=(t,e,r,o)=>{if(console.log("Adding marker for user:",o),!t||typeof t.addLayer!="function")return console.error("Invalid map object in addMarker"),null;if(!t.loaded())return console.log("Map not yet loaded, waiting..."),t.on("load",()=>Nq(t,e,r,o)),null;const u=document.createElement("div");u.className="marker-container";const f=document.createElement("img");f.src=o.profilePhoto||"/default-profile.png",f.alt=o.name||"User",f.className="marker-image";let y=!1;f.onerror=()=>{y||(console.warn(`Failed to load image for ${o.name||"user"}, default profile used.`),y=!0),f.src="/default-profile.png"},u.appendChild(f);const T=document.createElement("div");T.className="marker-dot",u.appendChild(T);try{const a=new um.Marker(u).setLngLat([r,e]).addTo(t);console.log("Marker created:",a);const A=new um.Popup({offset:25,closeButton:!1,closeOnClick:!1,maxWidth:"none"}),D=document.createElement("div");D.className="custom-popup",D.innerHTML=`
      <div class="profile-container">
        <div class="profile-header">
          <div class="profile-photo-container">
            <img src="${o.profilePhoto||"/default-profile.png"}" alt="${o.name||"User"}" class="profile-photo">
          </div>
          <div class="profile-info">
            <h2 class="profile-name">${o.name||"Unknown User"}</h2>
            <p class="profile-status"><span class="status-dot"></span> Active</p>
            <p class="profile-bio">${o.bio||"No bio available"}</p>
          </div>
        </div>
        <div class="tags-container">
          ${(o.tags||[]).map(B=>`<div class="tag">${B}</div>`).join("")}
        </div>
        <button class="add-friend-button">Add Friend</button>
      </div>
    `;const O=D.querySelector(".add-friend-button");return O.addEventListener("click",async()=>{console.log("Add friend button clicked");try{const B=gr(Rn,"users",Xt.currentUser.uid),re=(await is(B)).data().friends||[];re.includes(o.id)||(await io(B,{friends:[...re,o.id]}),O.textContent="Friend Added",O.disabled=!0)}catch(B){console.error("Error adding friend:",B)}}),A.setDOMContent(D),a.setPopup(A),a.getElement().addEventListener("click",B=>{console.log("Marker clicked:",o),B.stopPropagation(),A.addTo(t)}),a}catch(a){return console.error("Error creating marker:",a),null}},Fq=(t,e)=>{if(console.log("Setting up user locations listener"),!t||typeof t.addLayer!="function")return console.error("Invalid map object in setupUserLocationsListener"),()=>{};if(!t.loaded())return t.on("load",()=>Fq(t,e)),()=>{};const r=ss(Rn,"users"),o=qo(r,Di("isActive","==",!0));return x_(o,async u=>{console.log("User locations snapshot received");const f=new Set,y=Xt.currentUser;if(!y){console.warn("No authenticated user found");return}const a=(await is(gr(Rn,"users",y.uid))).data(),A=(a==null?void 0:a.friends)||[],D=(a==null?void 0:a.isPrivate)||!1;u.forEach(async O=>{const B=O.id,H=O.data();console.log("Processing user:",B,H);const Q=!H.isPrivate||B===y.uid||D&&A.includes(B)||!D&&A.includes(B);if(H.isActive&&H.location&&Q){f.add(B);const re=new Date(H.location.timestamp).getTime();if(new Date().getTime()-re>3e5)console.log("Removing inactive user:",B),Al[B]&&(Al[B].remove(),delete Al[B]);else if(Al[B])console.log("Updating marker for user:",B),Al[B].setLngLat([H.location.longitude,H.location.latitude]);else{console.log("Adding new marker for user:",B);const Y=Nq(t,H.location.latitude,H.location.longitude,{id:B,name:H.name,profilePhoto:H.profilePhoto,bio:H.bio,tags:H.tags});Y&&(Al[B]=Y)}}else console.log("Removing marker for non-visible user:",B),Al[B]&&(Al[B].remove(),delete Al[B])}),Object.keys(Al).forEach(O=>{f.has(O)||(console.log("Removing marker for user no longer in snapshot:",O),Al[O].remove(),delete Al[O])}),typeof e=="function"?e([...f]):console.warn("setCurrentUserIds is not a function")})},rge=(t,e)=>{if(console.log("Setting up user location tracking"),!t||typeof t.addLayer!="function"){console.error("Invalid map object in trackUserLocation");return}if("geolocation"in navigator)return navigator.geolocation.watchPosition(o=>{const{latitude:u,longitude:f}=o.coords;nge(u,f),(!qw||!A6||Math.abs(u-qw.latitude)>.001||Math.abs(f-qw.longitude)>.001)&&(t.flyTo({center:[f,u],zoom:15}),qw={latitude:u,longitude:f},A6=!0),fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${f},${u}.json?access_token=${zq}`).then(T=>T.json()).then(T=>{T.features&&T.features.length>0&&e(T.features[0].place_name)}).catch(T=>{console.error("Error fetching address:",T)})},o=>{console.error("Error getting location:",o)},{enableHighAccuracy:!0,maximumAge:0,timeout:27e3});console.error("Geolocation is not supported by this browser.")},pk=async(t,e)=>{if(!t){console.error("Map object is not available");return}try{const o=(await is(gr(Rn,"users",e))).data();o&&o.location?t.flyTo({center:[o.location.longitude,o.location.latitude],zoom:15,duration:1e3}):console.warn(`No location data found for user ${e}`)}catch(r){console.error("Error centering map on user:",r)}},mk=async t=>{if(Xt.currentUser){const e=gr(Rn,"users",Xt.currentUser.uid);try{await io(e,{isActive:t})}catch(r){console.error("Error updating active status:",r)}}},ige=t=>Xt.onAuthStateChanged(e=>{e?mk(!0):(mk(!1),t("/login"))}),sge=(t,e)=>{Xt.currentUser?mk(!1).then(()=>{localStorage.clear(),Xt.signOut().then(()=>{t("/login")}).catch(r=>{console.error("Error signing out:",r)})}):(localStorage.clear(),Xt.signOut().then(()=>{t("/login")}).catch(r=>{console.error("Error signing out:",r)}))},oge=ue.createContext(),age=()=>ue.useContext(oge),C6=()=>{};let jO={},Bq={},Uq=null,Vq={mark:C6,measure:C6};try{typeof window<"u"&&(jO=window),typeof document<"u"&&(Bq=document),typeof MutationObserver<"u"&&(Uq=MutationObserver),typeof performance<"u"&&(Vq=performance)}catch{}const{userAgent:P6=""}=jO.navigator||{},xf=jO,Xi=Bq,R6=Uq,Ww=Vq;xf.document;const Vh=!!Xi.documentElement&&!!Xi.head&&typeof Xi.addEventListener=="function"&&typeof Xi.createElement=="function",jq=~P6.indexOf("MSIE")||~P6.indexOf("Trident/");var as="classic",$q="duotone",al="sharp",ll="sharp-duotone",lge=[as,$q,al,ll],cge={classic:{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},sharp:{900:"fass",400:"fasr",300:"fasl",100:"fast"},"sharp-duotone":{900:"fasds"}},M6={kit:{fak:"kit","fa-kit":"kit"},"kit-duotone":{fakd:"kit-duotone","fa-kit-duotone":"kit-duotone"}},uge=["kit"],hge=/fa(s|r|l|t|d|b|k|kd|ss|sr|sl|st|sds)?[\-\ ]/,dge=/Font ?Awesome ?([56 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Sharp Duotone|Sharp|Kit)?.*/i,fge={"Font Awesome 5 Free":{900:"fas",400:"far"},"Font Awesome 5 Pro":{900:"fas",400:"far",normal:"far",300:"fal"},"Font Awesome 5 Brands":{400:"fab",normal:"fab"},"Font Awesome 5 Duotone":{900:"fad"}},pge={"Font Awesome 6 Free":{900:"fas",400:"far"},"Font Awesome 6 Pro":{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},"Font Awesome 6 Brands":{400:"fab",normal:"fab"},"Font Awesome 6 Duotone":{900:"fad"},"Font Awesome 6 Sharp":{900:"fass",400:"fasr",normal:"fasr",300:"fasl",100:"fast"},"Font Awesome 6 Sharp Duotone":{900:"fasds"}},mge={classic:{"fa-brands":"fab","fa-duotone":"fad","fa-light":"fal","fa-regular":"far","fa-solid":"fas","fa-thin":"fat"},sharp:{"fa-solid":"fass","fa-regular":"fasr","fa-light":"fasl","fa-thin":"fast"},"sharp-duotone":{"fa-solid":"fasds"}},gge={classic:["fas","far","fal","fat"],sharp:["fass","fasr","fasl","fast"],"sharp-duotone":["fasds"]},_ge={classic:{fab:"fa-brands",fad:"fa-duotone",fal:"fa-light",far:"fa-regular",fas:"fa-solid",fat:"fa-thin"},sharp:{fass:"fa-solid",fasr:"fa-regular",fasl:"fa-light",fast:"fa-thin"},"sharp-duotone":{fasds:"fa-solid"}},yge={classic:{solid:"fas",regular:"far",light:"fal",thin:"fat",duotone:"fad",brands:"fab"},sharp:{solid:"fass",regular:"fasr",light:"fasl",thin:"fast"},"sharp-duotone":{solid:"fasds"}},Gq={classic:{fa:"solid",fas:"solid","fa-solid":"solid",far:"regular","fa-regular":"regular",fal:"light","fa-light":"light",fat:"thin","fa-thin":"thin",fad:"duotone","fa-duotone":"duotone",fab:"brands","fa-brands":"brands"},sharp:{fa:"solid",fass:"solid","fa-solid":"solid",fasr:"regular","fa-regular":"regular",fasl:"light","fa-light":"light",fast:"thin","fa-thin":"thin"},"sharp-duotone":{fa:"solid",fasds:"solid","fa-solid":"solid"}},vge=["solid","regular","light","thin","duotone","brands"],qq=[1,2,3,4,5,6,7,8,9,10],xge=qq.concat([11,12,13,14,15,16,17,18,19,20]),yv={GROUP:"duotone-group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},bge=[...Object.keys(gge),...vge,"2xs","xs","sm","lg","xl","2xl","beat","border","fade","beat-fade","bounce","flip-both","flip-horizontal","flip-vertical","flip","fw","inverse","layers-counter","layers-text","layers","li","pull-left","pull-right","pulse","rotate-180","rotate-270","rotate-90","rotate-by","shake","spin-pulse","spin-reverse","spin","stack-1x","stack-2x","stack","ul",yv.GROUP,yv.SWAP_OPACITY,yv.PRIMARY,yv.SECONDARY].concat(qq.map(t=>"".concat(t,"x"))).concat(xge.map(t=>"w-".concat(t))),wge={"Font Awesome Kit":{400:"fak",normal:"fak"},"Font Awesome Kit Duotone":{400:"fakd",normal:"fakd"}},Tge={kit:{"fa-kit":"fak"},"kit-duotone":{"fa-kit-duotone":"fakd"}},Ege={kit:{fak:"fa-kit"},"kit-duotone":{fakd:"fa-kit-duotone"}},k6={kit:{kit:"fak"},"kit-duotone":{"kit-duotone":"fakd"}};const zh="___FONT_AWESOME___",gk=16,Wq="fa",Hq="svg-inline--fa",hm="data-fa-i2svg",_k="data-fa-pseudo-element",Sge="data-fa-pseudo-element-pending",$O="data-prefix",GO="data-icon",D6="fontawesome-i2svg",Ige="async",Age=["HTML","HEAD","STYLE","SCRIPT"],Zq=(()=>{try{return!0}catch{return!1}})(),Xq=[as,al,ll];function m1(t){return new Proxy(t,{get(e,r){return r in e?e[r]:e[as]}})}const Kq={...Gq};Kq[as]={...Gq[as],...M6.kit,...M6["kit-duotone"]};const qp=m1(Kq),yk={...yge};yk[as]={...yk[as],...k6.kit,...k6["kit-duotone"]};const Ox=m1(yk),vk={..._ge};vk[as]={...vk[as],...Ege.kit};const Wp=m1(vk),xk={...mge};xk[as]={...xk[as],...Tge.kit};const Cge=m1(xk),Pge=hge,Yq="fa-layers-text",Rge=dge,Mge={...cge};m1(Mge);const kge=["class","data-prefix","data-icon","data-fa-transform","data-fa-mask"],iR=yv,H_=new Set;Object.keys(Ox[as]).map(H_.add.bind(H_));Object.keys(Ox[al]).map(H_.add.bind(H_));Object.keys(Ox[ll]).map(H_.add.bind(H_));const Dge=[...uge,...bge],Wv=xf.FontAwesomeConfig||{};function Oge(t){var e=Xi.querySelector("script["+t+"]");if(e)return e.getAttribute(t)}function Lge(t){return t===""?!0:t==="false"?!1:t==="true"?!0:t}Xi&&typeof Xi.querySelector=="function"&&[["data-family-prefix","familyPrefix"],["data-css-prefix","cssPrefix"],["data-family-default","familyDefault"],["data-style-default","styleDefault"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(e=>{let[r,o]=e;const u=Lge(Oge(r));u!=null&&(Wv[o]=u)});const Qq={styleDefault:"solid",familyDefault:"classic",cssPrefix:Wq,replacementClass:Hq,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0};Wv.familyPrefix&&(Wv.cssPrefix=Wv.familyPrefix);const Z_={...Qq,...Wv};Z_.autoReplaceSvg||(Z_.observeMutations=!1);const Vn={};Object.keys(Qq).forEach(t=>{Object.defineProperty(Vn,t,{enumerable:!0,set:function(e){Z_[t]=e,Hv.forEach(r=>r(Vn))},get:function(){return Z_[t]}})});Object.defineProperty(Vn,"familyPrefix",{enumerable:!0,set:function(t){Z_.cssPrefix=t,Hv.forEach(e=>e(Vn))},get:function(){return Z_.cssPrefix}});xf.FontAwesomeConfig=Vn;const Hv=[];function zge(t){return Hv.push(t),()=>{Hv.splice(Hv.indexOf(t),1)}}const Ld=gk,gu={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function Nge(t){if(!t||!Vh)return;const e=Xi.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=t;const r=Xi.head.childNodes;let o=null;for(let u=r.length-1;u>-1;u--){const f=r[u],y=(f.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(y)>-1&&(o=f)}return Xi.head.insertBefore(e,o),t}const Fge="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function Lx(){let t=12,e="";for(;t-- >0;)e+=Fge[Math.random()*62|0];return e}function fy(t){const e=[];for(let r=(t||[]).length>>>0;r--;)e[r]=t[r];return e}function qO(t){return t.classList?fy(t.classList):(t.getAttribute("class")||"").split(" ").filter(e=>e)}function Jq(t){return"".concat(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Bge(t){return Object.keys(t||{}).reduce((e,r)=>e+"".concat(r,'="').concat(Jq(t[r]),'" '),"").trim()}function CI(t){return Object.keys(t||{}).reduce((e,r)=>e+"".concat(r,": ").concat(t[r].trim(),";"),"")}function WO(t){return t.size!==gu.size||t.x!==gu.x||t.y!==gu.y||t.rotate!==gu.rotate||t.flipX||t.flipY}function Uge(t){let{transform:e,containerWidth:r,iconWidth:o}=t;const u={transform:"translate(".concat(r/2," 256)")},f="translate(".concat(e.x*32,", ").concat(e.y*32,") "),y="scale(".concat(e.size/16*(e.flipX?-1:1),", ").concat(e.size/16*(e.flipY?-1:1),") "),T="rotate(".concat(e.rotate," 0 0)"),a={transform:"".concat(f," ").concat(y," ").concat(T)},A={transform:"translate(".concat(o/2*-1," -256)")};return{outer:u,inner:a,path:A}}function Vge(t){let{transform:e,width:r=gk,height:o=gk,startCentered:u=!1}=t,f="";return u&&jq?f+="translate(".concat(e.x/Ld-r/2,"em, ").concat(e.y/Ld-o/2,"em) "):u?f+="translate(calc(-50% + ".concat(e.x/Ld,"em), calc(-50% + ").concat(e.y/Ld,"em)) "):f+="translate(".concat(e.x/Ld,"em, ").concat(e.y/Ld,"em) "),f+="scale(".concat(e.size/Ld*(e.flipX?-1:1),", ").concat(e.size/Ld*(e.flipY?-1:1),") "),f+="rotate(".concat(e.rotate,"deg) "),f}var jge=`:root, :host {
  --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Free";
  --fa-font-regular: normal 400 1em/1 "Font Awesome 6 Free";
  --fa-font-light: normal 300 1em/1 "Font Awesome 6 Pro";
  --fa-font-thin: normal 100 1em/1 "Font Awesome 6 Pro";
  --fa-font-duotone: normal 900 1em/1 "Font Awesome 6 Duotone";
  --fa-font-brands: normal 400 1em/1 "Font Awesome 6 Brands";
  --fa-font-sharp-solid: normal 900 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-regular: normal 400 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-light: normal 300 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-thin: normal 100 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-duotone-solid: normal 900 1em/1 "Font Awesome 6 Sharp Duotone";
}

svg:not(:root).svg-inline--fa, svg:not(:host).svg-inline--fa {
  overflow: visible;
  box-sizing: content-box;
}

.svg-inline--fa {
  display: var(--fa-display, inline-block);
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-2xs {
  vertical-align: 0.1em;
}
.svg-inline--fa.fa-xs {
  vertical-align: 0em;
}
.svg-inline--fa.fa-sm {
  vertical-align: -0.0714285705em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.2em;
}
.svg-inline--fa.fa-xl {
  vertical-align: -0.25em;
}
.svg-inline--fa.fa-2xl {
  vertical-align: -0.3125em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-li {
  width: var(--fa-li-width, 2em);
  top: 0.25em;
}
.svg-inline--fa.fa-fw {
  width: var(--fa-fw-width, 1.25em);
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  transform-origin: center center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  transform-origin: center center;
}

.fa-layers-counter {
  background-color: var(--fa-counter-background-color, #ff253a);
  border-radius: var(--fa-counter-border-radius, 1em);
  box-sizing: border-box;
  color: var(--fa-inverse, #fff);
  line-height: var(--fa-counter-line-height, 1);
  max-width: var(--fa-counter-max-width, 5em);
  min-width: var(--fa-counter-min-width, 1.5em);
  overflow: hidden;
  padding: var(--fa-counter-padding, 0.25em 0.5em);
  right: var(--fa-right, 0);
  text-overflow: ellipsis;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-counter-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: var(--fa-bottom, 0);
  right: var(--fa-right, 0);
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: var(--fa-bottom, 0);
  left: var(--fa-left, 0);
  right: auto;
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom left;
}

.fa-layers-top-right {
  top: var(--fa-top, 0);
  right: var(--fa-right, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-top-left {
  left: var(--fa-left, 0);
  right: auto;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top left;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-2xs {
  font-size: 0.625em;
  line-height: 0.1em;
  vertical-align: 0.225em;
}

.fa-xs {
  font-size: 0.75em;
  line-height: 0.0833333337em;
  vertical-align: 0.125em;
}

.fa-sm {
  font-size: 0.875em;
  line-height: 0.0714285718em;
  vertical-align: 0.0535714295em;
}

.fa-lg {
  font-size: 1.25em;
  line-height: 0.05em;
  vertical-align: -0.075em;
}

.fa-xl {
  font-size: 1.5em;
  line-height: 0.0416666682em;
  vertical-align: -0.125em;
}

.fa-2xl {
  font-size: 2em;
  line-height: 0.03125em;
  vertical-align: -0.1875em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: var(--fa-li-margin, 2.5em);
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: calc(-1 * var(--fa-li-width, 2em));
  position: absolute;
  text-align: center;
  width: var(--fa-li-width, 2em);
  line-height: inherit;
}

.fa-border {
  border-color: var(--fa-border-color, #eee);
  border-radius: var(--fa-border-radius, 0.1em);
  border-style: var(--fa-border-style, solid);
  border-width: var(--fa-border-width, 0.08em);
  padding: var(--fa-border-padding, 0.2em 0.25em 0.15em);
}

.fa-pull-left {
  float: left;
  margin-right: var(--fa-pull-margin, 0.3em);
}

.fa-pull-right {
  float: right;
  margin-left: var(--fa-pull-margin, 0.3em);
}

.fa-beat {
  animation-name: fa-beat;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-bounce {
  animation-name: fa-bounce;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
}

.fa-fade {
  animation-name: fa-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-beat-fade {
  animation-name: fa-beat-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-flip {
  animation-name: fa-flip;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-shake {
  animation-name: fa-shake;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin {
  animation-name: fa-spin;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 2s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin-reverse {
  --fa-animation-direction: reverse;
}

.fa-pulse,
.fa-spin-pulse {
  animation-name: fa-spin;
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, steps(8));
}

@media (prefers-reduced-motion: reduce) {
  .fa-beat,
.fa-bounce,
.fa-fade,
.fa-beat-fade,
.fa-flip,
.fa-pulse,
.fa-shake,
.fa-spin,
.fa-spin-pulse {
    animation-delay: -1ms;
    animation-duration: 1ms;
    animation-iteration-count: 1;
    transition-delay: 0s;
    transition-duration: 0s;
  }
}
@keyframes fa-beat {
  0%, 90% {
    transform: scale(1);
  }
  45% {
    transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@keyframes fa-bounce {
  0% {
    transform: scale(1, 1) translateY(0);
  }
  10% {
    transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    transform: scale(1, 1) translateY(0);
  }
  100% {
    transform: scale(1, 1) translateY(0);
  }
}
@keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    transform: scale(1);
  }
  50% {
    opacity: 1;
    transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@keyframes fa-flip {
  50% {
    transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@keyframes fa-shake {
  0% {
    transform: rotate(-15deg);
  }
  4% {
    transform: rotate(15deg);
  }
  8%, 24% {
    transform: rotate(-18deg);
  }
  12%, 28% {
    transform: rotate(18deg);
  }
  16% {
    transform: rotate(-22deg);
  }
  20% {
    transform: rotate(22deg);
  }
  32% {
    transform: rotate(-12deg);
  }
  36% {
    transform: rotate(12deg);
  }
  40%, 100% {
    transform: rotate(0deg);
  }
}
@keyframes fa-spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  transform: rotate(90deg);
}

.fa-rotate-180 {
  transform: rotate(180deg);
}

.fa-rotate-270 {
  transform: rotate(270deg);
}

.fa-flip-horizontal {
  transform: scale(-1, 1);
}

.fa-flip-vertical {
  transform: scale(1, -1);
}

.fa-flip-both,
.fa-flip-horizontal.fa-flip-vertical {
  transform: scale(-1, -1);
}

.fa-rotate-by {
  transform: rotate(var(--fa-rotate-angle, 0));
}

.fa-stack {
  display: inline-block;
  vertical-align: middle;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
  z-index: var(--fa-stack-z-index, auto);
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: var(--fa-inverse, #fff);
}

.sr-only,
.fa-sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.sr-only-focusable:not(:focus),
.fa-sr-only-focusable:not(:focus) {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse,
.fa-duotone.fa-inverse {
  color: var(--fa-inverse, #fff);
}`;function eW(){const t=Wq,e=Hq,r=Vn.cssPrefix,o=Vn.replacementClass;let u=jge;if(r!==t||o!==e){const f=new RegExp("\\.".concat(t,"\\-"),"g"),y=new RegExp("\\--".concat(t,"\\-"),"g"),T=new RegExp("\\.".concat(e),"g");u=u.replace(f,".".concat(r,"-")).replace(y,"--".concat(r,"-")).replace(T,".".concat(o))}return u}let O6=!1;function sR(){Vn.autoAddCss&&!O6&&(Nge(eW()),O6=!0)}var $ge={mixout(){return{dom:{css:eW,insertCss:sR}}},hooks(){return{beforeDOMElementCreation(){sR()},beforeI2svg(){sR()}}}};const Nh=xf||{};Nh[zh]||(Nh[zh]={});Nh[zh].styles||(Nh[zh].styles={});Nh[zh].hooks||(Nh[zh].hooks={});Nh[zh].shims||(Nh[zh].shims=[]);var _u=Nh[zh];const tW=[],nW=function(){Xi.removeEventListener("DOMContentLoaded",nW),FE=1,tW.map(t=>t())};let FE=!1;Vh&&(FE=(Xi.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(Xi.readyState),FE||Xi.addEventListener("DOMContentLoaded",nW));function Gge(t){Vh&&(FE?setTimeout(t,0):tW.push(t))}function g1(t){const{tag:e,attributes:r={},children:o=[]}=t;return typeof t=="string"?Jq(t):"<".concat(e," ").concat(Bge(r),">").concat(o.map(g1).join(""),"</").concat(e,">")}function L6(t,e,r){if(t&&t[e]&&t[e][r])return{prefix:e,iconName:r,icon:t[e][r]}}var oR=function(e,r,o,u){var f=Object.keys(e),y=f.length,T=r,a,A,D;for(o===void 0?(a=1,D=e[f[0]]):(a=0,D=o);a<y;a++)A=f[a],D=T(D,e[A],A,e);return D};function qge(t){const e=[];let r=0;const o=t.length;for(;r<o;){const u=t.charCodeAt(r++);if(u>=55296&&u<=56319&&r<o){const f=t.charCodeAt(r++);(f&64512)==56320?e.push(((u&1023)<<10)+(f&1023)+65536):(e.push(u),r--)}else e.push(u)}return e}function bk(t){const e=qge(t);return e.length===1?e[0].toString(16):null}function Wge(t,e){const r=t.length;let o=t.charCodeAt(e),u;return o>=55296&&o<=56319&&r>e+1&&(u=t.charCodeAt(e+1),u>=56320&&u<=57343)?(o-55296)*1024+u-56320+65536:o}function z6(t){return Object.keys(t).reduce((e,r)=>{const o=t[r];return!!o.icon?e[o.iconName]=o.icon:e[r]=o,e},{})}function wk(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{skipHooks:o=!1}=r,u=z6(e);typeof _u.hooks.addPack=="function"&&!o?_u.hooks.addPack(t,z6(e)):_u.styles[t]={..._u.styles[t]||{},...u},t==="fas"&&wk("fa",e)}const{styles:Dp,shims:Hge}=_u,Zge={[as]:Object.values(Wp[as]),[al]:Object.values(Wp[al]),[ll]:Object.values(Wp[ll])};let HO=null,rW={},iW={},sW={},oW={},aW={};const Xge={[as]:Object.keys(qp[as]),[al]:Object.keys(qp[al]),[ll]:Object.keys(qp[ll])};function Kge(t){return~Dge.indexOf(t)}function Yge(t,e){const r=e.split("-"),o=r[0],u=r.slice(1).join("-");return o===t&&u!==""&&!Kge(u)?u:null}const lW=()=>{const t=o=>oR(Dp,(u,f,y)=>(u[y]=oR(f,o,{}),u),{});rW=t((o,u,f)=>(u[3]&&(o[u[3]]=f),u[2]&&u[2].filter(T=>typeof T=="number").forEach(T=>{o[T.toString(16)]=f}),o)),iW=t((o,u,f)=>(o[f]=f,u[2]&&u[2].filter(T=>typeof T=="string").forEach(T=>{o[T]=f}),o)),aW=t((o,u,f)=>{const y=u[2];return o[f]=f,y.forEach(T=>{o[T]=f}),o});const e="far"in Dp||Vn.autoFetchSvg,r=oR(Hge,(o,u)=>{const f=u[0];let y=u[1];const T=u[2];return y==="far"&&!e&&(y="fas"),typeof f=="string"&&(o.names[f]={prefix:y,iconName:T}),typeof f=="number"&&(o.unicodes[f.toString(16)]={prefix:y,iconName:T}),o},{names:{},unicodes:{}});sW=r.names,oW=r.unicodes,HO=PI(Vn.styleDefault,{family:Vn.familyDefault})};zge(t=>{HO=PI(t.styleDefault,{family:Vn.familyDefault})});lW();function ZO(t,e){return(rW[t]||{})[e]}function Qge(t,e){return(iW[t]||{})[e]}function Qd(t,e){return(aW[t]||{})[e]}function cW(t){return sW[t]||{prefix:null,iconName:null}}function Jge(t){const e=oW[t],r=ZO("fas",t);return e||(r?{prefix:"fas",iconName:r}:null)||{prefix:null,iconName:null}}function bf(){return HO}const XO=()=>({prefix:null,iconName:null,rest:[]});function PI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{family:r=as}=e,o=qp[r][t],u=Ox[r][t]||Ox[r][o],f=t in _u.styles?t:null;return u||f||null}const e_e={[as]:Object.keys(Wp[as]),[al]:Object.keys(Wp[al]),[ll]:Object.keys(Wp[ll])};function RI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{skipLookups:r=!1}=e,o={[as]:"".concat(Vn.cssPrefix,"-").concat(as),[al]:"".concat(Vn.cssPrefix,"-").concat(al),[ll]:"".concat(Vn.cssPrefix,"-").concat(ll)};let u=null,f=as;const y=lge.filter(a=>a!==$q);y.forEach(a=>{(t.includes(o[a])||t.some(A=>e_e[a].includes(A)))&&(f=a)});const T=t.reduce((a,A)=>{const D=Yge(Vn.cssPrefix,A);if(Dp[A]?(A=Zge[f].includes(A)?Cge[f][A]:A,u=A,a.prefix=A):Xge[f].indexOf(A)>-1?(u=A,a.prefix=PI(A,{family:f})):D?a.iconName=D:A!==Vn.replacementClass&&!y.some(O=>A===o[O])&&a.rest.push(A),!r&&a.prefix&&a.iconName){const O=u==="fa"?cW(a.iconName):{},B=Qd(a.prefix,a.iconName);O.prefix&&(u=null),a.iconName=O.iconName||B||a.iconName,a.prefix=O.prefix||a.prefix,a.prefix==="far"&&!Dp.far&&Dp.fas&&!Vn.autoFetchSvg&&(a.prefix="fas")}return a},XO());return(t.includes("fa-brands")||t.includes("fab"))&&(T.prefix="fab"),(t.includes("fa-duotone")||t.includes("fad"))&&(T.prefix="fad"),!T.prefix&&f===al&&(Dp.fass||Vn.autoFetchSvg)&&(T.prefix="fass",T.iconName=Qd(T.prefix,T.iconName)||T.iconName),!T.prefix&&f===ll&&(Dp.fasds||Vn.autoFetchSvg)&&(T.prefix="fasds",T.iconName=Qd(T.prefix,T.iconName)||T.iconName),(T.prefix==="fa"||u==="fa")&&(T.prefix=bf()||"fas"),T}class t_e{constructor(){this.definitions={}}add(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];const u=r.reduce(this._pullDefinitions,{});Object.keys(u).forEach(f=>{this.definitions[f]={...this.definitions[f]||{},...u[f]},wk(f,u[f]);const y=Wp[as][f];y&&wk(y,u[f]),lW()})}reset(){this.definitions={}}_pullDefinitions(e,r){const o=r.prefix&&r.iconName&&r.icon?{0:r}:r;return Object.keys(o).map(u=>{const{prefix:f,iconName:y,icon:T}=o[u],a=T[2];e[f]||(e[f]={}),a.length>0&&a.forEach(A=>{typeof A=="string"&&(e[f][A]=T)}),e[f][y]=T}),e}}let N6=[],a_={};const S_={},n_e=Object.keys(S_);function r_e(t,e){let{mixoutsTo:r}=e;return N6=t,a_={},Object.keys(S_).forEach(o=>{n_e.indexOf(o)===-1&&delete S_[o]}),N6.forEach(o=>{const u=o.mixout?o.mixout():{};if(Object.keys(u).forEach(f=>{typeof u[f]=="function"&&(r[f]=u[f]),typeof u[f]=="object"&&Object.keys(u[f]).forEach(y=>{r[f]||(r[f]={}),r[f][y]=u[f][y]})}),o.hooks){const f=o.hooks();Object.keys(f).forEach(y=>{a_[y]||(a_[y]=[]),a_[y].push(f[y])})}o.provides&&o.provides(S_)}),r}function Tk(t,e){for(var r=arguments.length,o=new Array(r>2?r-2:0),u=2;u<r;u++)o[u-2]=arguments[u];return(a_[t]||[]).forEach(y=>{e=y.apply(null,[e,...o])}),e}function dm(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];(a_[t]||[]).forEach(f=>{f.apply(null,r)})}function wf(){const t=arguments[0],e=Array.prototype.slice.call(arguments,1);return S_[t]?S_[t].apply(null,e):void 0}function Ek(t){t.prefix==="fa"&&(t.prefix="fas");let{iconName:e}=t;const r=t.prefix||bf();if(e)return e=Qd(r,e)||e,L6(uW.definitions,r,e)||L6(_u.styles,r,e)}const uW=new t_e,i_e=()=>{Vn.autoReplaceSvg=!1,Vn.observeMutations=!1,dm("noAuto")},s_e={i2svg:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Vh?(dm("beforeI2svg",t),wf("pseudoElements2svg",t),wf("i2svg",t)):Promise.reject(new Error("Operation requires a DOM of some kind."))},watch:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{autoReplaceSvgRoot:e}=t;Vn.autoReplaceSvg===!1&&(Vn.autoReplaceSvg=!0),Vn.observeMutations=!0,Gge(()=>{a_e({autoReplaceSvgRoot:e}),dm("watch",t)})}},o_e={icon:t=>{if(t===null)return null;if(typeof t=="object"&&t.prefix&&t.iconName)return{prefix:t.prefix,iconName:Qd(t.prefix,t.iconName)||t.iconName};if(Array.isArray(t)&&t.length===2){const e=t[1].indexOf("fa-")===0?t[1].slice(3):t[1],r=PI(t[0]);return{prefix:r,iconName:Qd(r,e)||e}}if(typeof t=="string"&&(t.indexOf("".concat(Vn.cssPrefix,"-"))>-1||t.match(Pge))){const e=RI(t.split(" "),{skipLookups:!0});return{prefix:e.prefix||bf(),iconName:Qd(e.prefix,e.iconName)||e.iconName}}if(typeof t=="string"){const e=bf();return{prefix:e,iconName:Qd(e,t)||t}}}},fl={noAuto:i_e,config:Vn,dom:s_e,parse:o_e,library:uW,findIconDefinition:Ek,toHtml:g1},a_e=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{autoReplaceSvgRoot:e=Xi}=t;(Object.keys(_u.styles).length>0||Vn.autoFetchSvg)&&Vh&&Vn.autoReplaceSvg&&fl.dom.i2svg({node:e})};function MI(t,e){return Object.defineProperty(t,"abstract",{get:e}),Object.defineProperty(t,"html",{get:function(){return t.abstract.map(r=>g1(r))}}),Object.defineProperty(t,"node",{get:function(){if(!Vh)return;const r=Xi.createElement("div");return r.innerHTML=t.html,r.children}}),t}function l_e(t){let{children:e,main:r,mask:o,attributes:u,styles:f,transform:y}=t;if(WO(y)&&r.found&&!o.found){const{width:T,height:a}=r,A={x:T/a/2,y:.5};u.style=CI({...f,"transform-origin":"".concat(A.x+y.x/16,"em ").concat(A.y+y.y/16,"em")})}return[{tag:"svg",attributes:u,children:e}]}function c_e(t){let{prefix:e,iconName:r,children:o,attributes:u,symbol:f}=t;const y=f===!0?"".concat(e,"-").concat(Vn.cssPrefix,"-").concat(r):f;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:{...u,id:y},children:o}]}]}function KO(t){const{icons:{main:e,mask:r},prefix:o,iconName:u,transform:f,symbol:y,title:T,maskId:a,titleId:A,extra:D,watchable:O=!1}=t,{width:B,height:H}=r.found?r:e,Q=o==="fak",re=[Vn.replacementClass,u?"".concat(Vn.cssPrefix,"-").concat(u):""].filter(Te=>D.classes.indexOf(Te)===-1).filter(Te=>Te!==""||!!Te).concat(D.classes).join(" ");let se={children:[],attributes:{...D.attributes,"data-prefix":o,"data-icon":u,class:re,role:D.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(B," ").concat(H)}};const G=Q&&!~D.classes.indexOf("fa-fw")?{width:"".concat(B/H*16*.0625,"em")}:{};O&&(se.attributes[hm]=""),T&&(se.children.push({tag:"title",attributes:{id:se.attributes["aria-labelledby"]||"title-".concat(A||Lx())},children:[T]}),delete se.attributes.title);const Y={...se,prefix:o,iconName:u,main:e,mask:r,maskId:a,transform:f,symbol:y,styles:{...G,...D.styles}},{children:Z,attributes:fe}=r.found&&e.found?wf("generateAbstractMask",Y)||{children:[],attributes:{}}:wf("generateAbstractIcon",Y)||{children:[],attributes:{}};return Y.children=Z,Y.attributes=fe,y?c_e(Y):l_e(Y)}function F6(t){const{content:e,width:r,height:o,transform:u,title:f,extra:y,watchable:T=!1}=t,a={...y.attributes,...f?{title:f}:{},class:y.classes.join(" ")};T&&(a[hm]="");const A={...y.styles};WO(u)&&(A.transform=Vge({transform:u,startCentered:!0,width:r,height:o}),A["-webkit-transform"]=A.transform);const D=CI(A);D.length>0&&(a.style=D);const O=[];return O.push({tag:"span",attributes:a,children:[e]}),f&&O.push({tag:"span",attributes:{class:"sr-only"},children:[f]}),O}function u_e(t){const{content:e,title:r,extra:o}=t,u={...o.attributes,...r?{title:r}:{},class:o.classes.join(" ")},f=CI(o.styles);f.length>0&&(u.style=f);const y=[];return y.push({tag:"span",attributes:u,children:[e]}),r&&y.push({tag:"span",attributes:{class:"sr-only"},children:[r]}),y}const{styles:aR}=_u;function Sk(t){const e=t[0],r=t[1],[o]=t.slice(4);let u=null;return Array.isArray(o)?u={tag:"g",attributes:{class:"".concat(Vn.cssPrefix,"-").concat(iR.GROUP)},children:[{tag:"path",attributes:{class:"".concat(Vn.cssPrefix,"-").concat(iR.SECONDARY),fill:"currentColor",d:o[0]}},{tag:"path",attributes:{class:"".concat(Vn.cssPrefix,"-").concat(iR.PRIMARY),fill:"currentColor",d:o[1]}}]}:u={tag:"path",attributes:{fill:"currentColor",d:o}},{found:!0,width:e,height:r,icon:u}}const h_e={found:!1,width:512,height:512};function d_e(t,e){!Zq&&!Vn.showMissingIcons&&t&&console.error('Icon with name "'.concat(t,'" and prefix "').concat(e,'" is missing.'))}function Ik(t,e){let r=e;return e==="fa"&&Vn.styleDefault!==null&&(e=bf()),new Promise((o,u)=>{if(r==="fa"){const f=cW(t)||{};t=f.iconName||t,e=f.prefix||e}if(t&&e&&aR[e]&&aR[e][t]){const f=aR[e][t];return o(Sk(f))}d_e(t,e),o({...h_e,icon:Vn.showMissingIcons&&t?wf("missingIconAbstract")||{}:{}})})}const B6=()=>{},Ak=Vn.measurePerformance&&Ww&&Ww.mark&&Ww.measure?Ww:{mark:B6,measure:B6},vv='FA "6.6.0"',f_e=t=>(Ak.mark("".concat(vv," ").concat(t," begins")),()=>hW(t)),hW=t=>{Ak.mark("".concat(vv," ").concat(t," ends")),Ak.measure("".concat(vv," ").concat(t),"".concat(vv," ").concat(t," begins"),"".concat(vv," ").concat(t," ends"))};var YO={begin:f_e,end:hW};const ET=()=>{};function U6(t){return typeof(t.getAttribute?t.getAttribute(hm):null)=="string"}function p_e(t){const e=t.getAttribute?t.getAttribute($O):null,r=t.getAttribute?t.getAttribute(GO):null;return e&&r}function m_e(t){return t&&t.classList&&t.classList.contains&&t.classList.contains(Vn.replacementClass)}function g_e(){return Vn.autoReplaceSvg===!0?ST.replace:ST[Vn.autoReplaceSvg]||ST.replace}function __e(t){return Xi.createElementNS("http://www.w3.org/2000/svg",t)}function y_e(t){return Xi.createElement(t)}function dW(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{ceFn:r=t.tag==="svg"?__e:y_e}=e;if(typeof t=="string")return Xi.createTextNode(t);const o=r(t.tag);return Object.keys(t.attributes||[]).forEach(function(f){o.setAttribute(f,t.attributes[f])}),(t.children||[]).forEach(function(f){o.appendChild(dW(f,{ceFn:r}))}),o}function v_e(t){let e=" ".concat(t.outerHTML," ");return e="".concat(e,"Font Awesome fontawesome.com "),e}const ST={replace:function(t){const e=t[0];if(e.parentNode)if(t[1].forEach(r=>{e.parentNode.insertBefore(dW(r),e)}),e.getAttribute(hm)===null&&Vn.keepOriginalSource){let r=Xi.createComment(v_e(e));e.parentNode.replaceChild(r,e)}else e.remove()},nest:function(t){const e=t[0],r=t[1];if(~qO(e).indexOf(Vn.replacementClass))return ST.replace(t);const o=new RegExp("".concat(Vn.cssPrefix,"-.*"));if(delete r[0].attributes.id,r[0].attributes.class){const f=r[0].attributes.class.split(" ").reduce((y,T)=>(T===Vn.replacementClass||T.match(o)?y.toSvg.push(T):y.toNode.push(T),y),{toNode:[],toSvg:[]});r[0].attributes.class=f.toSvg.join(" "),f.toNode.length===0?e.removeAttribute("class"):e.setAttribute("class",f.toNode.join(" "))}const u=r.map(f=>g1(f)).join(`
`);e.setAttribute(hm,""),e.innerHTML=u}};function V6(t){t()}function fW(t,e){const r=typeof e=="function"?e:ET;if(t.length===0)r();else{let o=V6;Vn.mutateApproach===Ige&&(o=xf.requestAnimationFrame||V6),o(()=>{const u=g_e(),f=YO.begin("mutate");t.map(u),f(),r()})}}let QO=!1;function pW(){QO=!0}function Ck(){QO=!1}let BE=null;function j6(t){if(!R6||!Vn.observeMutations)return;const{treeCallback:e=ET,nodeCallback:r=ET,pseudoElementsCallback:o=ET,observeMutationsRoot:u=Xi}=t;BE=new R6(f=>{if(QO)return;const y=bf();fy(f).forEach(T=>{if(T.type==="childList"&&T.addedNodes.length>0&&!U6(T.addedNodes[0])&&(Vn.searchPseudoElements&&o(T.target),e(T.target)),T.type==="attributes"&&T.target.parentNode&&Vn.searchPseudoElements&&o(T.target.parentNode),T.type==="attributes"&&U6(T.target)&&~kge.indexOf(T.attributeName))if(T.attributeName==="class"&&p_e(T.target)){const{prefix:a,iconName:A}=RI(qO(T.target));T.target.setAttribute($O,a||y),A&&T.target.setAttribute(GO,A)}else m_e(T.target)&&r(T.target)})}),Vh&&BE.observe(u,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}function x_e(){BE&&BE.disconnect()}function b_e(t){const e=t.getAttribute("style");let r=[];return e&&(r=e.split(";").reduce((o,u)=>{const f=u.split(":"),y=f[0],T=f.slice(1);return y&&T.length>0&&(o[y]=T.join(":").trim()),o},{})),r}function w_e(t){const e=t.getAttribute("data-prefix"),r=t.getAttribute("data-icon"),o=t.innerText!==void 0?t.innerText.trim():"";let u=RI(qO(t));return u.prefix||(u.prefix=bf()),e&&r&&(u.prefix=e,u.iconName=r),u.iconName&&u.prefix||(u.prefix&&o.length>0&&(u.iconName=Qge(u.prefix,t.innerText)||ZO(u.prefix,bk(t.innerText))),!u.iconName&&Vn.autoFetchSvg&&t.firstChild&&t.firstChild.nodeType===Node.TEXT_NODE&&(u.iconName=t.firstChild.data)),u}function T_e(t){const e=fy(t.attributes).reduce((u,f)=>(u.name!=="class"&&u.name!=="style"&&(u[f.name]=f.value),u),{}),r=t.getAttribute("title"),o=t.getAttribute("data-fa-title-id");return Vn.autoA11y&&(r?e["aria-labelledby"]="".concat(Vn.replacementClass,"-title-").concat(o||Lx()):(e["aria-hidden"]="true",e.focusable="false")),e}function E_e(){return{iconName:null,title:null,titleId:null,prefix:null,transform:gu,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}}}function $6(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{styleParser:!0};const{iconName:r,prefix:o,rest:u}=w_e(t),f=T_e(t),y=Tk("parseNodeAttributes",{},t);let T=e.styleParser?b_e(t):[];return{iconName:r,title:t.getAttribute("title"),titleId:t.getAttribute("data-fa-title-id"),prefix:o,transform:gu,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:u,styles:T,attributes:f},...y}}const{styles:S_e}=_u;function mW(t){const e=Vn.autoReplaceSvg==="nest"?$6(t,{styleParser:!1}):$6(t);return~e.extra.classes.indexOf(Yq)?wf("generateLayersText",t,e):wf("generateSvgReplacementMutation",t,e)}let Cu=new Set;Xq.map(t=>{Cu.add("fa-".concat(t))});Object.keys(qp[as]).map(Cu.add.bind(Cu));Object.keys(qp[al]).map(Cu.add.bind(Cu));Object.keys(qp[ll]).map(Cu.add.bind(Cu));Cu=[...Cu];function G6(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!Vh)return Promise.resolve();const r=Xi.documentElement.classList,o=D=>r.add("".concat(D6,"-").concat(D)),u=D=>r.remove("".concat(D6,"-").concat(D)),f=Vn.autoFetchSvg?Cu:Xq.map(D=>"fa-".concat(D)).concat(Object.keys(S_e));f.includes("fa")||f.push("fa");const y=[".".concat(Yq,":not([").concat(hm,"])")].concat(f.map(D=>".".concat(D,":not([").concat(hm,"])"))).join(", ");if(y.length===0)return Promise.resolve();let T=[];try{T=fy(t.querySelectorAll(y))}catch{}if(T.length>0)o("pending"),u("complete");else return Promise.resolve();const a=YO.begin("onTree"),A=T.reduce((D,O)=>{try{const B=mW(O);B&&D.push(B)}catch(B){Zq||B.name==="MissingIcon"&&console.error(B)}return D},[]);return new Promise((D,O)=>{Promise.all(A).then(B=>{fW(B,()=>{o("active"),o("complete"),u("pending"),typeof e=="function"&&e(),a(),D()})}).catch(B=>{a(),O(B)})})}function I_e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;mW(t).then(r=>{r&&fW([r],e)})}function A_e(t){return function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o=(e||{}).icon?e:Ek(e||{});let{mask:u}=r;return u&&(u=(u||{}).icon?u:Ek(u||{})),t(o,{...r,mask:u})}}const C_e=function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{transform:r=gu,symbol:o=!1,mask:u=null,maskId:f=null,title:y=null,titleId:T=null,classes:a=[],attributes:A={},styles:D={}}=e;if(!t)return;const{prefix:O,iconName:B,icon:H}=t;return MI({type:"icon",...t},()=>(dm("beforeDOMElementCreation",{iconDefinition:t,params:e}),Vn.autoA11y&&(y?A["aria-labelledby"]="".concat(Vn.replacementClass,"-title-").concat(T||Lx()):(A["aria-hidden"]="true",A.focusable="false")),KO({icons:{main:Sk(H),mask:u?Sk(u.icon):{found:!1,width:null,height:null,icon:{}}},prefix:O,iconName:B,transform:{...gu,...r},symbol:o,title:y,maskId:f,titleId:T,extra:{attributes:A,styles:D,classes:a}})))};var P_e={mixout(){return{icon:A_e(C_e)}},hooks(){return{mutationObserverCallbacks(t){return t.treeCallback=G6,t.nodeCallback=I_e,t}}},provides(t){t.i2svg=function(e){const{node:r=Xi,callback:o=()=>{}}=e;return G6(r,o)},t.generateSvgReplacementMutation=function(e,r){const{iconName:o,title:u,titleId:f,prefix:y,transform:T,symbol:a,mask:A,maskId:D,extra:O}=r;return new Promise((B,H)=>{Promise.all([Ik(o,y),A.iconName?Ik(A.iconName,A.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(Q=>{let[re,se]=Q;B([e,KO({icons:{main:re,mask:se},prefix:y,iconName:o,transform:T,symbol:a,maskId:D,title:u,titleId:f,extra:O,watchable:!0})])}).catch(H)})},t.generateAbstractIcon=function(e){let{children:r,attributes:o,main:u,transform:f,styles:y}=e;const T=CI(y);T.length>0&&(o.style=T);let a;return WO(f)&&(a=wf("generateAbstractTransformGrouping",{main:u,transform:f,containerWidth:u.width,iconWidth:u.width})),r.push(a||u.icon),{children:r,attributes:o}}}},R_e={mixout(){return{layer(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{classes:r=[]}=e;return MI({type:"layer"},()=>{dm("beforeDOMElementCreation",{assembler:t,params:e});let o=[];return t(u=>{Array.isArray(u)?u.map(f=>{o=o.concat(f.abstract)}):o=o.concat(u.abstract)}),[{tag:"span",attributes:{class:["".concat(Vn.cssPrefix,"-layers"),...r].join(" ")},children:o}]})}}}},M_e={mixout(){return{counter(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{title:r=null,classes:o=[],attributes:u={},styles:f={}}=e;return MI({type:"counter",content:t},()=>(dm("beforeDOMElementCreation",{content:t,params:e}),u_e({content:t.toString(),title:r,extra:{attributes:u,styles:f,classes:["".concat(Vn.cssPrefix,"-layers-counter"),...o]}})))}}}},k_e={mixout(){return{text(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{transform:r=gu,title:o=null,classes:u=[],attributes:f={},styles:y={}}=e;return MI({type:"text",content:t},()=>(dm("beforeDOMElementCreation",{content:t,params:e}),F6({content:t,transform:{...gu,...r},title:o,extra:{attributes:f,styles:y,classes:["".concat(Vn.cssPrefix,"-layers-text"),...u]}})))}}},provides(t){t.generateLayersText=function(e,r){const{title:o,transform:u,extra:f}=r;let y=null,T=null;if(jq){const a=parseInt(getComputedStyle(e).fontSize,10),A=e.getBoundingClientRect();y=A.width/a,T=A.height/a}return Vn.autoA11y&&!o&&(f.attributes["aria-hidden"]="true"),Promise.resolve([e,F6({content:e.innerHTML,width:y,height:T,transform:u,title:o,extra:f,watchable:!0})])}}};const D_e=new RegExp('"',"ug"),q6=[1105920,1112319],W6={FontAwesome:{normal:"fas",400:"fas"},...pge,...fge,...wge},Pk=Object.keys(W6).reduce((t,e)=>(t[e.toLowerCase()]=W6[e],t),{}),O_e=Object.keys(Pk).reduce((t,e)=>{const r=Pk[e];return t[e]=r[900]||[...Object.entries(r)][0][1],t},{});function L_e(t){const e=t.replace(D_e,""),r=Wge(e,0),o=r>=q6[0]&&r<=q6[1],u=e.length===2?e[0]===e[1]:!1;return{value:bk(u?e[0]:e),isSecondary:o||u}}function z_e(t,e){const r=t.replace(/^['"]|['"]$/g,"").toLowerCase(),o=parseInt(e),u=isNaN(o)?"normal":o;return(Pk[r]||{})[u]||O_e[r]}function H6(t,e){const r="".concat(Sge).concat(e.replace(":","-"));return new Promise((o,u)=>{if(t.getAttribute(r)!==null)return o();const y=fy(t.children).filter(B=>B.getAttribute(_k)===e)[0],T=xf.getComputedStyle(t,e),a=T.getPropertyValue("font-family"),A=a.match(Rge),D=T.getPropertyValue("font-weight"),O=T.getPropertyValue("content");if(y&&!A)return t.removeChild(y),o();if(A&&O!=="none"&&O!==""){const B=T.getPropertyValue("content");let H=z_e(a,D);const{value:Q,isSecondary:re}=L_e(B),se=A[0].startsWith("FontAwesome");let G=ZO(H,Q),Y=G;if(se){const Z=Jge(Q);Z.iconName&&Z.prefix&&(G=Z.iconName,H=Z.prefix)}if(G&&!re&&(!y||y.getAttribute($O)!==H||y.getAttribute(GO)!==Y)){t.setAttribute(r,Y),y&&t.removeChild(y);const Z=E_e(),{extra:fe}=Z;fe.attributes[_k]=e,Ik(G,H).then(Te=>{const Pe=KO({...Z,icons:{main:Te,mask:XO()},prefix:H,iconName:Y,extra:fe,watchable:!0}),ce=Xi.createElementNS("http://www.w3.org/2000/svg","svg");e==="::before"?t.insertBefore(ce,t.firstChild):t.appendChild(ce),ce.outerHTML=Pe.map(he=>g1(he)).join(`
`),t.removeAttribute(r),o()}).catch(u)}else o()}else o()})}function N_e(t){return Promise.all([H6(t,"::before"),H6(t,"::after")])}function F_e(t){return t.parentNode!==document.head&&!~Age.indexOf(t.tagName.toUpperCase())&&!t.getAttribute(_k)&&(!t.parentNode||t.parentNode.tagName!=="svg")}function Z6(t){if(Vh)return new Promise((e,r)=>{const o=fy(t.querySelectorAll("*")).filter(F_e).map(N_e),u=YO.begin("searchPseudoElements");pW(),Promise.all(o).then(()=>{u(),Ck(),e()}).catch(()=>{u(),Ck(),r()})})}var B_e={hooks(){return{mutationObserverCallbacks(t){return t.pseudoElementsCallback=Z6,t}}},provides(t){t.pseudoElements2svg=function(e){const{node:r=Xi}=e;Vn.searchPseudoElements&&Z6(r)}}};let X6=!1;var U_e={mixout(){return{dom:{unwatch(){pW(),X6=!0}}}},hooks(){return{bootstrap(){j6(Tk("mutationObserverCallbacks",{}))},noAuto(){x_e()},watch(t){const{observeMutationsRoot:e}=t;X6?Ck():j6(Tk("mutationObserverCallbacks",{observeMutationsRoot:e}))}}}};const K6=t=>{let e={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return t.toLowerCase().split(" ").reduce((r,o)=>{const u=o.toLowerCase().split("-"),f=u[0];let y=u.slice(1).join("-");if(f&&y==="h")return r.flipX=!0,r;if(f&&y==="v")return r.flipY=!0,r;if(y=parseFloat(y),isNaN(y))return r;switch(f){case"grow":r.size=r.size+y;break;case"shrink":r.size=r.size-y;break;case"left":r.x=r.x-y;break;case"right":r.x=r.x+y;break;case"up":r.y=r.y-y;break;case"down":r.y=r.y+y;break;case"rotate":r.rotate=r.rotate+y;break}return r},e)};var V_e={mixout(){return{parse:{transform:t=>K6(t)}}},hooks(){return{parseNodeAttributes(t,e){const r=e.getAttribute("data-fa-transform");return r&&(t.transform=K6(r)),t}}},provides(t){t.generateAbstractTransformGrouping=function(e){let{main:r,transform:o,containerWidth:u,iconWidth:f}=e;const y={transform:"translate(".concat(u/2," 256)")},T="translate(".concat(o.x*32,", ").concat(o.y*32,") "),a="scale(".concat(o.size/16*(o.flipX?-1:1),", ").concat(o.size/16*(o.flipY?-1:1),") "),A="rotate(".concat(o.rotate," 0 0)"),D={transform:"".concat(T," ").concat(a," ").concat(A)},O={transform:"translate(".concat(f/2*-1," -256)")},B={outer:y,inner:D,path:O};return{tag:"g",attributes:{...B.outer},children:[{tag:"g",attributes:{...B.inner},children:[{tag:r.icon.tag,children:r.icon.children,attributes:{...r.icon.attributes,...B.path}}]}]}}}};const lR={x:0,y:0,width:"100%",height:"100%"};function Y6(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return t.attributes&&(t.attributes.fill||e)&&(t.attributes.fill="black"),t}function j_e(t){return t.tag==="g"?t.children:[t]}var $_e={hooks(){return{parseNodeAttributes(t,e){const r=e.getAttribute("data-fa-mask"),o=r?RI(r.split(" ").map(u=>u.trim())):XO();return o.prefix||(o.prefix=bf()),t.mask=o,t.maskId=e.getAttribute("data-fa-mask-id"),t}}},provides(t){t.generateAbstractMask=function(e){let{children:r,attributes:o,main:u,mask:f,maskId:y,transform:T}=e;const{width:a,icon:A}=u,{width:D,icon:O}=f,B=Uge({transform:T,containerWidth:D,iconWidth:a}),H={tag:"rect",attributes:{...lR,fill:"white"}},Q=A.children?{children:A.children.map(Y6)}:{},re={tag:"g",attributes:{...B.inner},children:[Y6({tag:A.tag,attributes:{...A.attributes,...B.path},...Q})]},se={tag:"g",attributes:{...B.outer},children:[re]},G="mask-".concat(y||Lx()),Y="clip-".concat(y||Lx()),Z={tag:"mask",attributes:{...lR,id:G,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"},children:[H,se]},fe={tag:"defs",children:[{tag:"clipPath",attributes:{id:Y},children:j_e(O)},Z]};return r.push(fe,{tag:"rect",attributes:{fill:"currentColor","clip-path":"url(#".concat(Y,")"),mask:"url(#".concat(G,")"),...lR}}),{children:r,attributes:o}}}},G_e={provides(t){let e=!1;xf.matchMedia&&(e=xf.matchMedia("(prefers-reduced-motion: reduce)").matches),t.missingIconAbstract=function(){const r=[],o={fill:"currentColor"},u={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};r.push({tag:"path",attributes:{...o,d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"}});const f={...u,attributeName:"opacity"},y={tag:"circle",attributes:{...o,cx:"256",cy:"364",r:"28"},children:[]};return e||y.children.push({tag:"animate",attributes:{...u,attributeName:"r",values:"28;14;28;28;14;28;"}},{tag:"animate",attributes:{...f,values:"1;0;1;1;0;1;"}}),r.push(y),r.push({tag:"path",attributes:{...o,opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"},children:e?[]:[{tag:"animate",attributes:{...f,values:"1;0;0;0;0;1;"}}]}),e||r.push({tag:"path",attributes:{...o,opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"},children:[{tag:"animate",attributes:{...f,values:"0;0;1;1;0;0;"}}]}),{tag:"g",attributes:{class:"missing"},children:r}}}},q_e={hooks(){return{parseNodeAttributes(t,e){const r=e.getAttribute("data-fa-symbol"),o=r===null?!1:r===""?!0:r;return t.symbol=o,t}}}},W_e=[$ge,P_e,R_e,M_e,k_e,B_e,U_e,V_e,$_e,G_e,q_e];r_e(W_e,{mixoutsTo:fl});fl.noAuto;fl.config;fl.library;fl.dom;const Rk=fl.parse;fl.findIconDefinition;fl.toHtml;const H_e=fl.icon;fl.layer;fl.text;fl.counter;function Q6(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),r.push.apply(r,o)}return r}function hu(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Q6(Object(r),!0).forEach(function(o){l_(t,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Q6(Object(r)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(r,o))})}return t}function UE(t){"@babel/helpers - typeof";return UE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},UE(t)}function l_(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Z_e(t,e){if(t==null)return{};var r={},o=Object.keys(t),u,f;for(f=0;f<o.length;f++)u=o[f],!(e.indexOf(u)>=0)&&(r[u]=t[u]);return r}function X_e(t,e){if(t==null)return{};var r=Z_e(t,e),o,u;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(t);for(u=0;u<f.length;u++)o=f[u],!(e.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(t,o)&&(r[o]=t[o])}return r}function Mk(t){return K_e(t)||Y_e(t)||Q_e(t)||J_e()}function K_e(t){if(Array.isArray(t))return kk(t)}function Y_e(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Q_e(t,e){if(t){if(typeof t=="string")return kk(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kk(t,e)}}function kk(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,o=new Array(e);r<e;r++)o[r]=t[r];return o}function J_e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eye(t){var e,r=t.beat,o=t.fade,u=t.beatFade,f=t.bounce,y=t.shake,T=t.flash,a=t.spin,A=t.spinPulse,D=t.spinReverse,O=t.pulse,B=t.fixedWidth,H=t.inverse,Q=t.border,re=t.listItem,se=t.flip,G=t.size,Y=t.rotation,Z=t.pull,fe=(e={"fa-beat":r,"fa-fade":o,"fa-beat-fade":u,"fa-bounce":f,"fa-shake":y,"fa-flash":T,"fa-spin":a,"fa-spin-reverse":D,"fa-spin-pulse":A,"fa-pulse":O,"fa-fw":B,"fa-inverse":H,"fa-border":Q,"fa-li":re,"fa-flip":se===!0,"fa-flip-horizontal":se==="horizontal"||se==="both","fa-flip-vertical":se==="vertical"||se==="both"},l_(e,"fa-".concat(G),typeof G<"u"&&G!==null),l_(e,"fa-rotate-".concat(Y),typeof Y<"u"&&Y!==null&&Y!==0),l_(e,"fa-pull-".concat(Z),typeof Z<"u"&&Z!==null),l_(e,"fa-swap-opacity",t.swapOpacity),e);return Object.keys(fe).map(function(Te){return fe[Te]?Te:null}).filter(function(Te){return Te})}function tye(t){return t=t-0,t===t}function gW(t){return tye(t)?t:(t=t.replace(/[\-_\s]+(.)?/g,function(e,r){return r?r.toUpperCase():""}),t.substr(0,1).toLowerCase()+t.substr(1))}var nye=["style"];function rye(t){return t.charAt(0).toUpperCase()+t.slice(1)}function iye(t){return t.split(";").map(function(e){return e.trim()}).filter(function(e){return e}).reduce(function(e,r){var o=r.indexOf(":"),u=gW(r.slice(0,o)),f=r.slice(o+1).trim();return u.startsWith("webkit")?e[rye(u)]=f:e[u]=f,e},{})}function _W(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof e=="string")return e;var o=(e.children||[]).map(function(a){return _W(t,a)}),u=Object.keys(e.attributes||{}).reduce(function(a,A){var D=e.attributes[A];switch(A){case"class":a.attrs.className=D,delete e.attributes.class;break;case"style":a.attrs.style=iye(D);break;default:A.indexOf("aria-")===0||A.indexOf("data-")===0?a.attrs[A.toLowerCase()]=D:a.attrs[gW(A)]=D}return a},{attrs:{}}),f=r.style,y=f===void 0?{}:f,T=X_e(r,nye);return u.attrs.style=hu(hu({},u.attrs.style),y),t.apply(void 0,[e.tag,hu(hu({},u.attrs),T)].concat(Mk(o)))}var yW=!1;try{yW=!0}catch{}function sye(){if(!yW&&console&&typeof console.error=="function"){var t;(t=console).error.apply(t,arguments)}}function J6(t){if(t&&UE(t)==="object"&&t.prefix&&t.iconName&&t.icon)return t;if(Rk.icon)return Rk.icon(t);if(t===null)return null;if(t&&UE(t)==="object"&&t.prefix&&t.iconName)return t;if(Array.isArray(t)&&t.length===2)return{prefix:t[0],iconName:t[1]};if(typeof t=="string")return{prefix:"fas",iconName:t}}function cR(t,e){return Array.isArray(e)&&e.length>0||!Array.isArray(e)&&e?l_({},t,e):{}}var eV={border:!1,className:"",mask:null,maskId:null,fixedWidth:!1,inverse:!1,flip:!1,icon:null,listItem:!1,pull:null,pulse:!1,rotation:null,size:null,spin:!1,spinPulse:!1,spinReverse:!1,beat:!1,fade:!1,beatFade:!1,bounce:!1,shake:!1,symbol:!1,title:"",titleId:null,transform:null,swapOpacity:!1},vW=vi.forwardRef(function(t,e){var r=hu(hu({},eV),t),o=r.icon,u=r.mask,f=r.symbol,y=r.className,T=r.title,a=r.titleId,A=r.maskId,D=J6(o),O=cR("classes",[].concat(Mk(eye(r)),Mk((y||"").split(" ")))),B=cR("transform",typeof r.transform=="string"?Rk.transform(r.transform):r.transform),H=cR("mask",J6(u)),Q=H_e(D,hu(hu(hu(hu({},O),B),H),{},{symbol:f,title:T,titleId:a,maskId:A}));if(!Q)return sye("Could not find icon",D),null;var re=Q.abstract,se={ref:e};return Object.keys(r).forEach(function(G){eV.hasOwnProperty(G)||(se[G]=r[G])}),oye(re[0],se)});vW.displayName="FontAwesomeIcon";vW.propTypes={beat:Gr.bool,border:Gr.bool,beatFade:Gr.bool,bounce:Gr.bool,className:Gr.string,fade:Gr.bool,flash:Gr.bool,mask:Gr.oneOfType([Gr.object,Gr.array,Gr.string]),maskId:Gr.string,fixedWidth:Gr.bool,inverse:Gr.bool,flip:Gr.oneOf([!0,!1,"horizontal","vertical","both"]),icon:Gr.oneOfType([Gr.object,Gr.array,Gr.string]),listItem:Gr.bool,pull:Gr.oneOf(["right","left"]),pulse:Gr.bool,rotation:Gr.oneOf([0,90,180,270]),shake:Gr.bool,size:Gr.oneOf(["2xs","xs","sm","lg","xl","2xl","1x","2x","3x","4x","5x","6x","7x","8x","9x","10x"]),spin:Gr.bool,spinPulse:Gr.bool,spinReverse:Gr.bool,symbol:Gr.oneOfType([Gr.bool,Gr.string]),title:Gr.string,titleId:Gr.string,transform:Gr.oneOfType([Gr.string,Gr.object]),swapOpacity:Gr.bool};var oye=_W.bind(null,vi.createElement);const aye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M414-46q-32%200-55-20.5T332-118l-9-67q-5-2-10-5l-10-6-61%2026q-29%2012-59%202.5T137-205L71-322q-16-27-9.5-57.5T93-429l52-40v-22l-52-39q-26-19-32-49.5T71-638l66-116q16-27%2045.5-37t58.5%202l64%2026q5-3%209-5.5t9-4.5l9-68q4-32%2027-52.5t55-20.5h132q32%200%2055%2020.5t27%2052.5l9%2068q5%202%2010%204.5t10%205.5l61-26q29-12%2059-2t46%2037l66%20116q16%2028%2010%2058.5T867-530l-53%2039v11q0%203-.5%205.5t-.5%205.5l53%2039q26%2019%2032%2049.5T888-322l-67%20117q-16%2027-45.5%2037t-58.5-2l-62-26q-5%203-9%206t-9%205l-9%2067q-4%2031-27%2051.5T546-46H414Zm37-126h56l15-104q32-8%2061-24t51-42l98%2041%2027-50-83-63q5-16%208-32.5t3-33.5q0-17-3-33.5t-8-32.5l85-63-29-50-97%2042q-22-26-51-43t-62-24l-13-104h-58l-12%20103q-34%207-63.5%2024T323-618l-96-41-28%2050%2082%2061q-5%2017-8%2033.5t-3%2034.5q0%2017%203%2034t8%2034l-82%2061%2028%2050%2096-41q23%2025%2053%2042t63%2025l12%20103Zm28-168q58%200%2099-41t41-99q0-58-41-99t-99-41q-58%200-99%2041t-41%2099q0%2058%2041%2099t99%2041Zm1-140Z'/%3e%3c/svg%3e",tV="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M202.63-202.87h57.24l374.74-374.74-56.76-57-375.22%20375.22v56.52Zm-45.26%2091q-19.15%200-32.33-13.17-13.17-13.18-13.17-32.33v-102.26q0-18.15%206.84-34.69%206.83-16.53%2019.51-29.2l501.17-500.41q12.48-11.72%2027.7-17.96%2015.21-6.24%2031.93-6.24%2016.48%200%2032.2%206.24%2015.71%206.24%2027.67%2018.72l65.28%2065.56q12.48%2011.72%2018.34%2027.56%205.86%2015.83%205.86%2031.79%200%2016.72-5.86%2032.05-5.86%2015.34-18.34%2027.82L324-138.22q-12.67%2012.68-29.21%2019.51-16.53%206.84-34.68%206.84H157.37Zm597.37-586.39-56.24-56.48%2056.24%2056.48Zm-148.89%2092.41-28-28.76%2056.76%2057-28.76-28.24Z'/%3e%3c/svg%3e",lye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='m421-443-60-60q-17-17-42-17t-42%2017q-17%2017-16.5%2042t17.5%2042l98%2098q19.36%2019%2045.18%2019T466-321l211-211q17-17%2017-41.5T677-615q-17-17-42-17t-42%2017L421-443Zm59%20397q-91%200-169.99-34.08-78.98-34.09-137.41-92.52-58.43-58.43-92.52-137.41Q46-389%2046-480q0-91%2034.08-169.99%2034.09-78.98%2092.52-137.41%2058.43-58.43%20137.41-92.52Q389-914%20480-914q91%200%20169.99%2034.08%2078.98%2034.09%20137.41%2092.52%2058.43%2058.43%2092.52%20137.41Q914-571%20914-480q0%2091-34.08%20169.99-34.09%2078.98-92.52%20137.41-58.43%2058.43-137.41%2092.52Q571-46%20480-46Zm0-126q130%200%20219-89t89-219q0-130-89-219t-219-89q-130%200-219%2089t-89%20219q0%20130%2089%20219t219%2089Zm0-308Z'/%3e%3c/svg%3e",cye=({handleLogout:t,isNavExpanded:e})=>{const[r,o]=ue.useState("placeholder.jpg"),[u,f]=ue.useState("Default Name"),[y,T]=ue.useState("default_username"),[a,A]=ue.useState("Default Bio"),[D,O]=ue.useState(!1),[B,H]=ue.useState(!1),[Q,re]=ue.useState(null),[se,G]=ue.useState([]);ue.useState(!1);const[Y,Z]=ue.useState([]),[fe,Te]=ue.useState(null),Pe=ue.useRef(null),{showNotification:ce}=VO();age();const he=F3(),[W,ge]=ue.useState(window.innerWidth<768),[_e,Ee]=ue.useState(window.innerHeight*.5),we=[{img:"/education.png",value:"education"},{img:"/food.png",value:"food"},{img:"/games.png",value:"games"},{img:"/other.png",value:"other"}];ue.useEffect(()=>{const rt=()=>{ge(window.innerWidth<768)};return window.addEventListener("resize",rt),()=>window.removeEventListener("resize",rt)},[]),ue.useEffect(()=>{Xt.currentUser&&(xt(),Rt(),Bt())},[]);const xt=async()=>{try{const rt=await Fv(Xt.currentUser.uid);rt&&(f(rt.name||"Default Name"),T(rt.username||"default_username"),o(rt.profilePhoto||"placeholder.jpg"),A(rt.bio||"Default Bio"),H(rt.isPrivate||!1),G(rt.tags||[]))}catch(rt){console.error("Error fetching user data:",rt),ce("Failed to load user data","error")}},Rt=async()=>{if(Xt.currentUser)try{const rt=qo(ss(Rn,"quests"),Di("uid","==",Xt.currentUser.uid),yE("createdAt","desc"),w7(5)),pt=(await tl(rt)).docs.map(jt=>({id:jt.id,...jt.data()}));Z(pt)}catch(rt){console.error("Error fetching recent quests:",rt),ce("Failed to load recent quests","error")}},Bt=async()=>{if(Xt.currentUser)try{const rt=qo(ss(Rn,"quests"),Di("uid","==",Xt.currentUser.uid),Di("status","==","accepted")),wt=await tl(rt);if(wt.empty)Te(null);else{const pt=wt.docs[0].data();if(pt.targetUser){const jt=await Fv(pt.targetUser);Te({...pt,partnerName:(jt==null?void 0:jt.name)||"Unknown",partnerPhoto:(jt==null?void 0:jt.profilePhoto)||"placeholder.jpg",partnerUsername:(jt==null?void 0:jt.username)||"unknown_user"})}else Te(pt)}}catch(rt){console.error("Error fetching active quest:",rt),ce("Failed to load active quest","error")}},bt=async()=>{try{let rt=r;Q&&(rt=await Boe(Q)),await eU(Xt.currentUser.uid,{name:u,username:y,bio:a,profilePhoto:rt,tags:se}),O(!1),re(null),ce("Profile updated successfully!","success")}catch(rt){console.error("Error updating profile:",rt),ce("Failed to update profile","error")}},at=rt=>{const wt=rt.target.files[0];wt&&(re(wt),o(URL.createObjectURL(wt)))},Ct=()=>{D&&Pe.current.click()},Zt=async rt=>{const wt=se.filter(pt=>pt!==rt);G(wt);try{await eU(Xt.currentUser.uid,{tags:wt}),ce("Tag removed successfully","success")}catch(pt){console.error("Error removing tag:",pt),ce("Failed to remove tag","error")}};return p1(({movement:[,rt],down:wt,event:pt})=>{if(W){if(wt){const jt=window.innerHeight*.5-rt;Ee(Math.max(100,Math.min(jt,window.innerHeight-60)))}pt.preventDefault()}},{delay:0,threshold:5}),d1({height:W?_e:"auto",config:{tension:300,friction:30}}),J.jsx(JO,{children:J.jsxs("div",{className:"prof-container",children:[J.jsxs("header",{children:[J.jsxs("div",{className:"prof",children:[J.jsxs("div",{className:"prof-picture",onClick:()=>D&&Ct(),style:D?{cursor:"pointer"}:{},children:[D&&J.jsxs(J.Fragment,{children:[J.jsx("input",{type:"file",ref:Pe,onChange:at,style:{display:"none"}}),J.jsx(tV,{})]}),J.jsx("img",{src:r,alt:"ProfilePicture"})]}),J.jsx("div",{className:"prof-name-container",style:D?{gap:"4px"}:{},children:D?J.jsxs(J.Fragment,{children:[J.jsx("input",{type:"text",value:u,onChange:rt=>f(rt.target.value),className:"prof-input",placeholder:"Name"}),J.jsx("div",{children:J.jsx("input",{type:"text",value:y,onChange:rt=>T(rt.target.value),className:"prof-input",placeholder:"Username"})})]}):J.jsxs(J.Fragment,{children:[J.jsx("p",{className:"prof-name",children:u}),J.jsxs("p",{className:"prof-username",children:["@",y]})]})}),J.jsxs("div",{className:"prof-header-buttons",children:[D?J.jsx(lye,{onClick:bt}):J.jsx(tV,{onClick:()=>O(!0)}),J.jsx(aye,{onClick:()=>he("/home/settings")})]})]}),J.jsxs("div",{className:"prof-bio",children:[J.jsx("h3",{children:"Bio"}),D?J.jsx("textarea",{value:a,onChange:rt=>A(rt.target.value),className:"prof-bio-edit",placeholder:"Bio",maxLength:150}):J.jsx("p",{children:a})]})]}),J.jsxs("div",{className:"prof-body",children:[J.jsxs("div",{className:"profile-section",children:[J.jsx("h3",{className:"section-title",children:"Tags"}),J.jsx("div",{className:"tags-container",children:se.map(rt=>{var wt;return J.jsxs("div",{className:"tag",children:[J.jsx("img",{src:((wt=we.find(pt=>pt.value===rt))==null?void 0:wt.img)||"/other.png",alt:rt,className:"tag-icon"}),J.jsx("button",{onClick:()=>Zt(rt),children:"x"})]},rt)})})]}),J.jsxs("div",{className:"profile-section",children:[J.jsx("h3",{className:"section-title",children:"Active Quests"}),fe?J.jsxs("div",{className:"quest-item",children:[J.jsxs("p",{children:['"',fe.title,'" with']}),fe.partnerName&&J.jsxs("div",{className:"quest-partner",children:[J.jsx("img",{src:fe.partnerPhoto||"placeholder.jpg",alt:fe.partnerName,className:"partner-photo"}),J.jsxs("p",{children:[fe.partnerName," @",fe.partnerUsername]})]})]}):J.jsx("p",{className:"section-empty-msg",children:"No quests ongoing. Ready to start a new adventure?"})]}),J.jsxs("div",{className:"profile-section",children:[J.jsx("h3",{className:"section-title",children:"Recent Quests"}),Y.length>0?Y.map(rt=>J.jsxs("div",{className:"quest-item",children:[J.jsx("p",{children:rt.title}),rt.targetUser&&J.jsxs("p",{children:["with"," ",typeof rt.targetUser=="string"?rt.targetUser:rt.targetUser.name||"Unknown User"]})]},rt.id)):J.jsx("p",{className:"section-empty-msg",children:"No recent quests. Time to explore!"})]})]})]})})},uye=Ru("div")({backgroundColor:"#000000",borderRadius:"20px",width:"90%",maxWidth:"500px",height:"90%",display:"flex",flexDirection:"column",overflow:"hidden"}),hye=Ru("div")({position:"relative",width:"100%",height:"calc(100% - 150px)",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",backgroundColor:"#000000"}),dye=Ru("img")({maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}),fye=Ru("div")({position:"absolute",border:"2px solid white",boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.5)"}),pye=Ru("div")({padding:"20px",backgroundColor:"#000000"}),mye=Ru(gfe)({display:"flex",justifyContent:"space-between",marginBottom:"20px"}),gye=Ru(ffe)({color:"white","&.Mui-checked":{color:"white"}}),_ye=Ru(sde)({"& .MuiFormControlLabel-label":{color:"white"}}),yye=Ru("div")({display:"flex",justifyContent:"space-between"}),nV=Ru(LG)({flex:1,margin:"0 5px",fontWeight:"bold",borderRadius:"25px",padding:"12px 0"}),uR=[{value:"standard",label:"Standard (2:3)",width:1e3,height:1500},{value:"square",label:"Square (1:1)",width:1e3,height:1e3},{value:"long",label:"Long (1:2.1)",width:1e3,height:2100}],vye=({photoPreview:t,onUpload:e,onCancel:r})=>{const[o,u]=ue.useState("standard"),[f,y]=ue.useState({x:0,y:0}),[T,a]=ue.useState({width:0,height:0}),[A,D]=ue.useState({width:0,height:0}),O=ue.useRef(null),B=ue.useRef(null),H=ue.useRef(null);ue.useEffect(()=>{const G=new Image;G.onload=()=>{D({width:G.width,height:G.height})},G.src=t},[t]),ue.useEffect(()=>{Q()},[o,A]);const Q=()=>{if(O.current&&A.width&&A.height){const G=O.current.getBoundingClientRect(),Y=uR.find(ce=>ce.value===o);G.width/G.height;const Z=A.width/A.height,fe=Y.width/Y.height;let Te,Pe;fe>Z?(Te=G.width,Pe=Te/fe):(Pe=G.height,Te=Pe*fe),a({width:Te,height:Pe}),y({x:(G.width-Te)/2,y:(G.height-Pe)/2})}},re=G=>{G.preventDefault();const Y=G.clientX-f.x,Z=G.clientY-f.y,fe=Pe=>{if(O.current&&H.current&&B.current){const ce=O.current.getBoundingClientRect(),he=B.current.getBoundingClientRect();let W=Pe.clientX-Y,ge=Pe.clientY-Z;W=Math.max(he.left-ce.left,Math.min(W,he.right-ce.left-T.width)),ge=Math.max(he.top-ce.top,Math.min(ge,he.bottom-ce.top-T.height)),y({x:W,y:ge})}},Te=()=>{document.removeEventListener("mousemove",fe),document.removeEventListener("mouseup",Te)};document.addEventListener("mousemove",fe),document.addEventListener("mouseup",Te)},se=()=>{if(B.current&&H.current){const G=B.current.getBoundingClientRect(),Y=H.current.getBoundingClientRect(),Z={x:(Y.left-G.left)/G.width,y:(Y.top-G.top)/G.height,width:Y.width/G.width,height:Y.height/G.height},fe=uR.find(Te=>Te.value===o);e(Z,`${fe.width}:${fe.height}`)}};return J.jsxs(uye,{children:[J.jsxs(hye,{ref:O,children:[J.jsx(dye,{ref:B,src:t,alt:"Preview"}),J.jsx(fye,{ref:H,style:{width:`${T.width}px`,height:`${T.height}px`,left:`${f.x}px`,top:`${f.y}px`},onMouseDown:re})]}),J.jsxs(pye,{children:[J.jsx(mye,{row:!0,"aria-label":"aspect-ratio",name:"aspect-ratio",value:o,onChange:G=>u(G.target.value),children:uR.map(G=>J.jsx(_ye,{value:G.value,control:J.jsx(gye,{}),label:G.label},G.value))}),J.jsxs(yye,{children:[J.jsx(nV,{onClick:se,variant:"contained",color:"primary",children:"Done"}),J.jsx(nV,{onClick:r,variant:"outlined",children:"Cancel"})]})]})]})};function JO({children:t}){return J.jsxs("div",{className:"navigation-modal-container",children:[J.jsx(hJ,{className:"navigation-modal-bg",to:"/home"}),J.jsx("div",{className:"navigation-modal",children:t})]})}const xye=t=>{t.getLayer("route")&&t.removeLayer("route"),t.getSource("route")&&t.removeSource("route")},bye=({currentUserIds:t,map:e,setLockedUserId:r,lockedUserId:o,lockedUserData:u,isCreateQuestOpen:f,setIsCreateQuestOpen:y})=>{console.log("Quests component rendering"),ue.useState(!1);const[T,a]=ue.useState(""),[A,D]=ue.useState(""),[O,B]=ue.useState(""),[H,Q]=ue.useState([]),[re,se]=ue.useState(""),[G,Y]=ue.useState([]),[Z,fe]=ue.useState(null),[Te,Pe]=ue.useState(!1),[ce,he]=ue.useState(!1),[W,ge]=ue.useState(null),[_e,Ee]=ue.useState(null),[we,xt]=ue.useState(null),[Rt,Bt]=ue.useState({acceptors:[],pendingAcceptors:[]}),[bt,at]=ue.useState(!1);ue.useState(null),ue.useState(!1);const[Ct,Zt]=ue.useState([]),[rt,wt]=ue.useState("public"),[pt,jt]=ue.useState(window.innerHeight*.5),{showNotification:Mt}=VO();ue.useEffect(()=>{(async()=>{try{const Ze=qo(ss(Rn,"users")),st=x_(Ze,rn=>{if(rn.empty){console.error("No users found."),Y([]);return}const Pt=rn.docs.map(vn=>({id:vn.id,...vn.data()}));Y(Pt)});return()=>st()}catch(Ze){console.error("Error fetching users:",Ze)}})()},[]),ue.useEffect(()=>{Xt.currentUser&&(async()=>{try{const Ze=qo(ss(Rn,"quests"),Di("isPublic","==",!0)),st=qo(ss(Rn,"quests"),Di("uid","==",Xt.currentUser.uid)),rn=qo(ss(Rn,"quests"),Di("targetUser","==",Xt.currentUser.uid)),[Pt,vn,Sr]=await Promise.all([tl(Ze),tl(st),tl(rn)]),yn=Pt.docs.map(dr=>({id:dr.id,...dr.data()})),Zn=vn.docs.map(dr=>({id:dr.id,...dr.data()})),br=await Promise.all(Sr.docs.map(async dr=>{const zi=dr.data(),ls=await is(gr(Rn,"users",zi.uid)),Sn=ls.exists()?ls.data():{};return{id:dr.id,...zi,senderName:Sn.name||"Unknown sender"}})),Lr=[...yn,...Zn,...br],Li=new Map(Lr.map(dr=>[dr.id,dr]));Q(Array.from(Li.values()))}catch(Ze){console.error("Error fetching quests:",Ze)}})()},[Xt.currentUser,Mt,G]),G.filter(De=>De.name.toLowerCase().includes(re.toLowerCase()));const pn=async()=>{if(Xt.currentUser){if(!W){console.error("Pending quest is null.");return}try{const De=gr(ss(Rn,"quests"));if(W.isPublic)await gT(De,{...W,id:De.id,uid:Xt.currentUser.uid,acceptedBy:[],pendingAcceptors:[]});else{if(!W.targetUser){console.error("Target user is missing in the quest");return}const Ze=qo(ss(Rn,"quests"),Di("uid","==",Xt.currentUser.uid),Di("targetUser","==",W.targetUser),Di("title","==",W.title),Di("description","==",W.description),Di("isPublic","==",!1));if(!(await tl(Ze)).empty){Mt("A similar private quest already exists for this user.","info");return}await gT(De,{...W,id:De.id,uid:Xt.currentUser.uid,acceptedBy:[],pendingAcceptors:[]})}Mt("Quest created!","success"),ge(null),he(!1),a(""),D(""),B(""),fe(null),se(""),Pe(!1)}catch(De){console.error("Error creating quest:",De),Mt("Failed to create quest.","error")}}},un=async De=>{if(Xt.currentUser)try{const Ze=gr(Rn,"quests",De),rn=(await is(Ze)).data();if(!rn.isPublic&&rn.targetUser===Xt.currentUser.uid)await Lv(Ze),Q(H.filter(Pt=>Pt.id!==De)),Mt("Quest declined!","success");else if(rn.isPublic)await io(Ze,{declinedBy:zv(Xt.currentUser.uid)}),Q(H.filter(Pt=>Pt.id!==De)),Mt("Quest declined!","success");else{const Pt=rn.acceptedBy.filter(vn=>vn!==Xt.currentUser.uid);await io(Ze,{acceptedBy:Pt}),Q(H.map(vn=>vn.id===De?{...vn,acceptedBy:Pt}:vn)),Mt("Quest declined!","success")}}catch(Ze){console.error("Error declining quest:",Ze),Mt("Failed to decline quest.","error")}},_n=async De=>{if(!Xt.currentUser){console.error("No authenticated user"),Mt("You must be logged in to accept quests.","error");return}if(!De.id){console.error("Quest ID is missing"),Mt("Invalid quest. Please try again.","error");return}try{const Ze=gr(Rn,"quests",De.id),st=await is(Ze);if(!st.exists()){console.error("Quest does not exist"),Mt("This quest no longer exists.","error");return}let Pt={...st.data(),status:De.isPublic?"pending":"accepted"};De.isPublic?Pt.pendingAcceptors=zv(Xt.currentUser.uid):Pt.acceptedBy=Xt.currentUser.uid;const vn=await is(gr(Rn,"users",De.uid)),Sr=await is(gr(Rn,"users",Xt.currentUser.uid));if(!vn.exists()||!Sr.exists()){console.error("Sender or receiver data not found"),Mt("Unable to process quest. User data missing.","error");return}const yn=vn.data(),Zn=Sr.data();if(!yn.location||!Zn.location?(console.error("Sender or receiver location missing"),Mt("Location data is missing. Unable to display route.","warning")):Pt.routeInfo={senderLocation:yn.location,receiverLocation:Zn.location},await io(Ze,Pt),Q(br=>br.map(Lr=>Lr.id===De.id?Pt:Lr)),De.isPublic||(Zt(br=>[...br,Pt]),Pt.routeInfo&&e&&St(e,Pt.routeInfo.senderLocation,Pt.routeInfo.receiverLocation)),Mt("Quest accepted!","success"),De.isPublic){const br=gr(ss(Rn,"notifications"));await gT(br,{type:"quest_accepted",questId:De.id,recipientId:De.uid,senderId:Xt.currentUser.uid,content:`${Xt.currentUser.displayName||"Someone"} has accepted your quest: ${De.title}`,createdAt:new Date,read:!1})}}catch(Ze){console.error("Error accepting quest:",Ze),Mt("Failed to accept quest. Please try again.","error")}},St=ue.useCallback((De,Ze)=>{if(!e||!e.loaded()){console.error("Map is not fully loaded");return}if(!De||!Ze){console.error("Invalid locations for route display");return}const st=`https://api.mapbox.com/directions/v5/mapbox/walking/${De.longitude},${De.latitude};${Ze.longitude},${Ze.latitude}?geometries=geojson&access_token=${um.accessToken}`;fetch(st).then(rn=>rn.json()).then(rn=>{if(!rn.routes||rn.routes.length===0){console.error("No route found in the response");return}const Pt=rn.routes[0].geometry;e.getSource("route")?e.getSource("route").setData(Pt):e.addLayer({id:"route",type:"line",source:{type:"geojson",data:Pt},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#00FFFF","line-width":5,"line-opacity":.75}});const vn=new um.LngLatBounds().extend([De.longitude,De.latitude]).extend([Ze.longitude,Ze.latitude]);e.fitBounds(vn,{padding:50})}).catch(rn=>{console.error("Error fetching or displaying route:",rn)})},[e]);ue.useEffect(()=>{if(Xt.currentUser&&e){const De=x_(qo(ss(Rn,"quests"),Di("status","in",["approved","accepted"]),Di("uid","==",Xt.currentUser.uid)),Ze=>{const st=Ze.docs.map(rn=>({id:rn.id,...rn.data()}));Zt(st),st.forEach(rn=>{!rn.isPublic&&rn.routeInfo&&St(rn.routeInfo.senderLocation,rn.routeInfo.receiverLocation)})});return()=>De()}},[Xt.currentUser,e,St]);const ln=async(De,Ze)=>{if(console.log("Approving acceptor:",Ze),!Ze||!Ze.id){console.error("Selected acceptor is not defined or missing id."),Mt("Invalid acceptor data.","error");return}try{const st=gr(Rn,"quests",De),rn=await is(st);if(!rn.exists()){console.error("Quest document does not exist."),Mt("Quest not found.","error");return}const Pt=rn.data(),vn={...Pt,pendingAcceptors:FM(Ze.id),acceptedBy:zv(Ze.id),targetUser:Ze.id,status:"approved"};if(Xt.currentUser){const Sr=gr(Rn,"users",Xt.currentUser.uid),yn=gr(Rn,"users",Ze.id),[Zn,br]=await Promise.all([is(Sr),is(yn)]);if(Zn.exists()&&br.exists()){const Lr=Zn.data(),Li=br.data();Lr.location&&Li.location&&(vn.routeInfo={senderLocation:Lr.location,receiverLocation:Li.location})}}await io(st,vn),Q(Sr=>Sr.map(yn=>yn.id===De?{...yn,...vn}:yn)),Zt(Sr=>[...Sr,{...Pt,...vn,id:De}]),vn.routeInfo&&e&&St(e,vn.routeInfo.senderLocation,vn.routeInfo.receiverLocation),Mt(`Quest approved for ${Ze.name}!`,"success"),at(!1)}catch(st){console.error("Error approving acceptor:",st),Mt("Failed to approve acceptor.","error")}},Kt=async De=>{try{const Ze=gr(Rn,"quests",De);await Lv(Ze),Q(H.filter(st=>st.id!==De)),Zt(Ct.filter(st=>st.id!==De)),e&&xye(e),Mt("Quest completed and deleted!","success")}catch(Ze){console.error("Error completing quest:",Ze),Mt("Failed to complete quest.","error")}},xn=async De=>{try{const Ze=gr(Rn,"quests",De);await Lv(Ze),Q(H.filter(st=>st.id!==De)),Mt("Quest canceled!","success")}catch(Ze){console.error("Error canceling quest:",Ze),Mt("Failed to cancel quest.","error")}},Er=async De=>{try{const Ze=gr(Rn,"quests",De.id),rn=(await is(Ze)).data(),Pt=rn.acceptedBy||[],vn=rn.pendingAcceptors||[],Sr=await Promise.all(Pt.map(async Zn=>{const br=await is(gr(Rn,"users",Zn));return{id:Zn,...br.data()}})),yn=await Promise.all(vn.map(async Zn=>{const br=await is(gr(Rn,"users",Zn));return{id:Zn,...br.data()}}));Bt({acceptors:Sr,pendingAcceptors:yn}),xt(De),at(!0)}catch(Ze){console.error("Error fetching acceptors:",Ze),Mt("Failed to fetch acceptors.","error")}},Dn=H.filter(De=>{var Ze,st,rn,Pt;return De.isPublic?De.uid===((Ze=Xt.currentUser)==null?void 0:Ze.uid)||De.approvedUser===((st=Xt.currentUser)==null?void 0:st.uid):De.targetUser===((rn=Xt.currentUser)==null?void 0:rn.uid)||De.uid===((Pt=Xt.currentUser)==null?void 0:Pt.uid)}),hr=async(De,Ze)=>{try{const st=gr(Rn,"quests",De.id);await io(st,{acceptedBy:Ze.id,pendingAcceptors:[]}),Q(H.map(rn=>rn.id===De.id?{...rn,acceptedBy:Ze.id,pendingAcceptors:[]}:rn)),Bt([]),Mt(`Quest assigned to ${Ze.name}!`,"success")}catch(st){console.error("Error selecting acceptor:",st),Mt("Failed to assign quest.","error")}},Fr=()=>{Ee(null)},ar=()=>{switch(rt){case"public":return J.jsxs("div",{className:"quests-column",children:[J.jsx("h3",{children:"Public Quests"}),Dn.filter(De=>{var Ze;return De.isPublic&&(!De.declinedBy||!De.declinedBy.includes((Ze=Xt.currentUser)==null?void 0:Ze.uid))}).length>0?Dn.filter(De=>{var Ze;return De.isPublic&&(!De.declinedBy||!De.declinedBy.includes((Ze=Xt.currentUser)==null?void 0:Ze.uid))}).map(De=>{var rn,Pt,vn,Sr,yn;const st=(G.find(Zn=>Zn.id===De.uid)||{}).name||"";return J.jsxs("div",{className:"quest-item",children:[J.jsxs("p",{children:[J.jsx("strong",{children:"Title:"})," ",De.title]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Description:"})," ",De.description]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Time Frame:"})," ",De.timeFrame]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Sender:"})," ",st]}),De.isPublic&&((rn=Xt.currentUser)==null?void 0:rn.uid)!==De.uid&&!(Array.isArray(De.acceptedBy)&&De.acceptedBy.includes((Pt=Xt.currentUser)==null?void 0:Pt.uid))&&!(Array.isArray(De.pendingAcceptors)&&De.pendingAcceptors.includes((vn=Xt.currentUser)==null?void 0:vn.uid))&&J.jsxs("div",{className:"quest-actions",children:[J.jsx("button",{className:"confirm-button",onClick:()=>_n(De),children:"Accept"}),J.jsx("button",{className:"cancel-button",onClick:()=>un(De.id),children:"Decline"})]}),De.uid===((Sr=Xt.currentUser)==null?void 0:Sr.uid)&&J.jsxs("div",{className:"quest-actions",children:[J.jsx("button",{className:"select-button",onClick:()=>Er(De),children:"View Pending Acceptors"}),J.jsx("button",{className:"cancel-button",onClick:()=>xn(De.id),children:"Cancel Quest"})]}),Array.isArray(De.acceptedBy)&&De.acceptedBy.includes((yn=Xt.currentUser)==null?void 0:yn.uid)&&J.jsx("div",{className:"quest-actions",children:J.jsx("button",{className:"confirm-button",onClick:()=>Kt(De.id),children:"Complete"})})]},De.id)}):J.jsx("p",{children:"No public quests."})]});case"received":return J.jsxs("div",{className:"quests-column",children:[J.jsx("h3",{children:"Received Quests"}),H.filter(De=>{var Ze;return De.targetUser===((Ze=Xt.currentUser)==null?void 0:Ze.uid)&&!De.isPublic}).length>0?H.filter(De=>{var Ze;return De.targetUser===((Ze=Xt.currentUser)==null?void 0:Ze.uid)&&!De.isPublic}).map(De=>{var vn,Sr,yn,Zn;const st=(G.find(br=>br.id===De.uid)||{}).name||"",rn=De.targetUser===((vn=Xt.currentUser)==null?void 0:vn.uid),Pt=De.uid===((Sr=Xt.currentUser)==null?void 0:Sr.uid);return J.jsxs("div",{className:"quest-item",children:[J.jsxs("p",{children:[J.jsx("strong",{children:"Title:"})," ",De.title]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Description:"})," ",De.description]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Time Frame:"})," ",De.timeFrame]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Sender:"})," ",st]}),rn&&De.status==="accepted"&&J.jsxs("div",{className:"quest-actions",children:[J.jsx("button",{className:"confirm-button",onClick:()=>Kt(De.id),children:"Complete"}),J.jsx("button",{className:"cancel-button",onClick:()=>xn(De.id),children:"Cancel"})]}),rn&&De.status==="pending"&&J.jsxs("div",{className:"quest-actions",children:[J.jsx("button",{className:"confirm-button",onClick:()=>_n(De),children:"Accept"}),J.jsx("button",{className:"cancel-button",onClick:()=>un(De.id),children:"Decline"})]}),Pt&&J.jsxs("p",{children:["Status: ",De.status]}),De.acceptedBy&&J.jsxs("div",{children:[J.jsxs("p",{children:[J.jsx("strong",{children:"Accepted By:"})," ",((yn=G.find(br=>br.id===De.acceptedBy))==null?void 0:yn.name)||"Pending acceptance"]}),J.jsx("img",{src:((Zn=G.find(br=>br.id===De.acceptedBy))==null?void 0:Zn.profilePhotoUrl)||"/default-profile.png",alt:"Profile",className:"user-pfp"})]})]},De.id)}):J.jsx("p",{children:"No received quests."})]});case"sent":return J.jsxs("div",{className:"quests-column",children:[J.jsx("h3",{children:"Sent Quests"}),H.filter(De=>{var Ze;return De.uid===((Ze=Xt.currentUser)==null?void 0:Ze.uid)&&!De.isPublic}).length>0?H.filter(De=>{var Ze;return De.uid===((Ze=Xt.currentUser)==null?void 0:Ze.uid)&&!De.isPublic}).map(De=>{const Ze=G.find(Pt=>Pt.id===De.acceptedBy)||{},st=Ze.name||"",rn=G.filter(Pt=>De.pendingAcceptors&&De.pendingAcceptors.includes(Pt.id));return J.jsxs("div",{className:"quest-item",children:[J.jsxs("p",{children:[J.jsx("strong",{children:"Title:"})," ",De.title]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Description:"})," ",De.description]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Time Frame:"})," ",De.timeFrame]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Status:"})," ",De.status]}),rn.length>0&&J.jsxs("div",{children:[J.jsx("p",{children:J.jsx("strong",{children:"Pending Acceptors:"})}),J.jsx("ul",{children:rn.map(Pt=>J.jsxs("li",{onClick:()=>hr(De,Pt),children:[Pt.name,J.jsx("img",{src:Pt.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"user-pfp"})]},Pt.id))})]}),De.acceptedBy&&J.jsxs("div",{children:[J.jsxs("p",{children:[J.jsx("strong",{children:"Accepted By:"})," ",st]}),J.jsx("img",{src:Ze.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"user-pfp"})]})]},De.id)}):J.jsx("p",{children:"No sent quests."})]});default:return null}},Yn=p1(({movement:[,De],down:Ze})=>{if(Ze){const st=window.innerHeight*.5-De;jt(Math.max(100,Math.min(st,window.innerHeight-60)))}});return d1({height:pt,config:{tension:300,friction:30}}),J.jsx(JO,{children:J.jsxs("div",{className:"quests-page",children:[J.jsx("div",{className:"drag-handle",...Yn()}),J.jsx("div",{className:"quests-header",children:J.jsx("h2",{children:"Quests"})}),J.jsxs("div",{className:"tabs",children:[J.jsx("button",{className:`tab-button ${rt==="public"?"active":""}`,onClick:()=>wt("public"),children:"Public Quests"}),J.jsx("button",{className:`tab-button ${rt==="received"?"active":""}`,onClick:()=>wt("received"),children:"Received Quests"}),J.jsx("button",{className:`tab-button ${rt==="sent"?"active":""}`,onClick:()=>wt("sent"),children:"Sent Quests"})]}),ar(),ce&&W&&J.jsx("div",{className:"modal-overlay",children:J.jsxs("div",{className:"modal confirmation-dialog",children:[J.jsx("h3",{children:"Confirm Quest Sending"}),J.jsx("p",{children:"Are you sure you want to send the quest with the following details?"}),J.jsxs("p",{children:[J.jsx("strong",{children:"Title:"})," ",W.title]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Description:"})," ",W.description]}),J.jsxs("p",{children:[J.jsx("strong",{children:"Time Frame:"})," ",W.timeFrame]}),J.jsxs("div",{className:"modal-actions",children:[J.jsx("button",{className:"confirm-button",onClick:pn,children:"Confirm"}),J.jsx("button",{className:"cancel-button",onClick:()=>he(!1),children:"Cancel"})]})]})}),_e&&J.jsx("div",{className:"modal-overlay",children:J.jsxs("div",{className:"modal profile-popup",children:[J.jsx("button",{className:"close-button",onClick:Fr,children:"X"}),J.jsx("h3",{children:_e.name}),J.jsx("img",{src:_e.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"profile-pic"}),J.jsxs("p",{children:[J.jsx("strong",{children:"Bio:"})," ",_e.bio]})]})}),bt&&J.jsx("div",{className:"modal-overlay",children:J.jsxs("div",{className:"modal acceptors-modal",children:[J.jsx("h3",{children:"Accepted By"}),J.jsx("ul",{children:Rt.acceptors.map((De,Ze)=>J.jsx("li",{children:De.name},Ze))}),J.jsx("h3",{children:"Pending Acceptors"}),J.jsx("ul",{children:Rt.pendingAcceptors.map((De,Ze)=>J.jsx("li",{onClick:()=>ln(we.id,De),className:"selectable-user",children:De.name},Ze))}),J.jsx("button",{className:"close-button",onClick:()=>at(!1),children:"Close"})]})})]})})},wye=({isOpen:t,quests:e,currentUserIds:r,map:o})=>J.jsx("div",{className:`quests-window ${t?"show-section":"hide-section"}`,children:J.jsx(bye,{quests:e,currentUserIds:r,map:o})}),xW={"--background-color":"rgb(33,33,35)","--text-color":"#ffffff","--accent-color":"#0a91ff","--nav-background":"#1a1a1a","--card-background":"#2c2c2c","--hover-color":"#3a3a3a","--border-color":"#333333"},bW={"--background-color":"#f5f5f5","--text-color":"#333333","--accent-color":"#3c68c6","--nav-background":"#ffffff","--card-background":"#ffffff","--hover-color":"#e0e0e0","--border-color":"#e0e0e0"},Tye="mapbox://styles/mapbox/dark-v10",Eye="mapbox://styles/mapbox/light-v10";function Dk(t){for(let[e,r]of Object.entries(t))document.documentElement.style.setProperty(e,r)}function wW(t,e){t&&t.setStyle&&t.setStyle(e?Eye:Tye)}function Sye(){const t=document.body.classList.toggle("light-mode");Dk(t?bW:xW),localStorage.setItem("theme",t?"light":"dark");const r=window.currentMap;wW(r,t),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{isLightMode:t}}))}function Iye(){const e=localStorage.getItem("theme")==="light";e?(Dk(bW),document.body.classList.add("light-mode")):Dk(xW);const r=window.currentMap;wW(r,e)}function Aye(){return document.body.classList.contains("light-mode")?"light":"dark"}const Cye="pk.eyJ1Ijoia3lpbTUwIiwiYSI6ImNsempkdjZibDAzM2MybXE4bDJmcnZ6ZGsifQ.-ie6lQO1TWYrL8c6h2W41g";um.accessToken=Cye;const rV="mapbox://styles/kyim50/clzniqnmq009s01qgee0a13s0",iV="mapbox://styles/mapbox/light-v10",iv=({address:t,setAddress:e,setCurrentUserIds:r,setMap:o,activeSection:u,lockedUser:f,showAddressBar:y,isFullScreen:T})=>{const a=ue.useRef(null),A=ue.useRef(null),[D,O]=ue.useState(!1),[B,H]=ue.useState([]),Q=ue.useRef({}),re=ue.useCallback(()=>{if(!A.current){const se=JSON.parse(localStorage.getItem("mapState")),G=Aye();A.current=new um.Map({container:a.current,style:G==="light"?iV:rV,center:(se==null?void 0:se.center)||[0,0],zoom:(se==null?void 0:se.zoom)||2,attributionControl:!1}),A.current.on("load",()=>{O(!0),o(A.current),window.currentMap=A.current}),A.current.on("moveend",()=>{const Y=A.current.getCenter(),Z=A.current.getZoom();localStorage.setItem("mapState",JSON.stringify({center:Y,zoom:Z}))})}},[o]);return ue.useEffect(()=>(re(),Iye(),()=>{if(A.current){const se=A.current.getCenter(),G=A.current.getZoom();localStorage.setItem("mapState",JSON.stringify({center:se,zoom:G})),A.current.remove(),A.current=null,window.currentMap=null}}),[re]),ue.useEffect(()=>{const se=G=>{const{isLightMode:Y}=G.detail;A.current&&D&&A.current.setStyle(Y?iV:rV)};return window.addEventListener("themeChanged",se),()=>{window.removeEventListener("themeChanged",se)}},[D]),ue.useEffect(()=>{let se;return D&&A.current&&(rge(A.current,e),se=Fq(A.current,(G,Y)=>{H(G),r(G),Q.current=Y})),()=>{se&&se()}},[D,e,r]),ue.useEffect(()=>{if(A.current&&D){const se=()=>{A.current.resize()};return se(),window.addEventListener("resize",se),()=>window.removeEventListener("resize",se)}},[D,u,T]),ue.useEffect(()=>{A.current&&D&&f&&(pk(A.current,f),Object.keys(Q.current).forEach(se=>{const Y=Q.current[se].getElement(),Z=Y.querySelector(".lock-indicator");if(se===f){if(!Z){const fe=document.createElement("div");fe.className="lock-indicator",Y.appendChild(fe)}}else Z&&Y.removeChild(Z)}))},[D,f]),J.jsxs(J.Fragment,{children:[J.jsx("div",{ref:a,className:`map-placeholder ${T?"full-screen":""}`,style:{width:"100%",height:"100%"}}),y&&J.jsx("div",{className:"address-bar",id:"address-bar",children:t})]})},Pye=({activeSection:t,showSection:e,logo:r,title:o})=>{const u=[{id:"home",icon:"/home.png",label:"Feed"},{id:"profile",icon:"/user-avatar.png",label:"Profile"},{id:"connections",icon:"/happy.png",label:"Connections"},{id:"quests",icon:"/letter.png",label:"Quests"},{id:"privacy",icon:"/privacy1.png",label:"Privacy"}];return J.jsxs("div",{className:"nav-bar",children:[J.jsxs("div",{className:"nav-header",children:[J.jsx("img",{src:r,alt:"Quests Logo",className:"qlogo"}),J.jsx("span",{className:"nav-title",children:o})]}),J.jsx("nav",{children:u.map(f=>J.jsxs("button",{onClick:()=>e(f.id),className:`nav-button ${t===f.id?"active":""}`,children:[J.jsx("img",{src:f.icon,alt:f.label}),J.jsx("span",{children:f.label})]},f.id))})]})},hR="/assets/chatbubble-DDibP9i3.png",Rye=({currentUserIds:t,map:e,setLockedUserId:r,lockedUserId:o,lockedUserData:u})=>{const[f,y]=ue.useState([]),[T,a]=ue.useState([]),[A,D]=ue.useState([]),[O,B]=ue.useState(null),[H,Q]=ue.useState(""),[re,se]=ue.useState(""),[G,Y]=ue.useState(null),[Z,fe]=ue.useState([]),[Te,Pe]=ue.useState(""),[ce,he]=ue.useState([]),[W,ge]=ue.useState(!1),[_e,Ee]=ue.useState(null),[we,xt]=ue.useState(null),[Rt,Bt]=ue.useState("friends"),[bt,at]=ue.useState(window.innerHeight*.5),Ct=ue.useCallback(async()=>{if(!Xt.currentUser){console.error("User is not authenticated");return}const De=ss(Rn,"users"),Ze=qo(De,Di("isActive","==",!0)),rn=(await tl(Ze)).docs.map(Pt=>({id:Pt.id,...Pt.data()})).filter(Pt=>Pt.id!==Xt.currentUser.uid&&!T.some(vn=>vn.id===Pt.id)&&t.includes(Pt.id));y(rn)},[T,t]),Zt=ue.useCallback(async()=>{if(!Xt.currentUser){console.error("User is not authenticated");return}try{const De=gr(Rn,"users",Xt.currentUser.uid),st=(await is(De)).data(),rn=(st==null?void 0:st.friends)||[],Pt=await Promise.all(rn.map(async vn=>{const Sr=gr(Rn,"users",vn),yn=await is(Sr);return{id:vn,...yn.data()}}));a(Pt)}catch(De){console.error("Error fetching friends:",De)}},[]);ue.useEffect(()=>{if(!Xt.currentUser){console.error("User is not authenticated");return}const De=x_(ss(Rn,"friend_requests"),async Ze=>{const st=Ze.docs.map(yn=>({id:yn.id,...yn.data()})),rn=st.filter(yn=>yn.status==="pending"&&yn.receiverId===Xt.currentUser.uid),vn=st.filter(yn=>yn.status==="accepted"&&(yn.senderId===Xt.currentUser.uid||yn.receiverId===Xt.currentUser.uid)).map(yn=>yn.senderId===Xt.currentUser.uid?yn.receiverId:yn.senderId);Zt().then(()=>{a(yn=>yn.filter(Zn=>vn.includes(Zn.id)))});const Sr=await Promise.all(rn.map(async yn=>{const Zn=gr(Rn,"users",yn.senderId),Lr=(await is(Zn)).data();return{id:yn.id,senderId:yn.senderId,senderName:(Lr==null?void 0:Lr.name)||"User",senderPhoto:(Lr==null?void 0:Lr.profilePhoto)||"default_photo_url"}}));D(Sr),Ct()});return Zt(),()=>De()},[Ct,Zt]);const rt=async De=>{if(console.log("Attempting to send friend request to:",De),!De){console.error("Receiver ID is undefined.");return}try{const Ze=qo(ss(Rn,"friend_requests"),Di("senderId","==",Xt.currentUser.uid),Di("receiverId","==",De),Di("status","==","pending"));if(!(await tl(Ze)).empty){console.log("Friend request already exists"),se("Friend request already exists!");return}await zM(ss(Rn,"friend_requests"),{senderId:Xt.currentUser.uid,senderName:Xt.currentUser.displayName,senderPhoto:Xt.currentUser.photoURL,receiverId:De,status:"pending",timestamp:NM()}),se("Friend request sent!")}catch(Ze){console.error("Error sending friend request:",Ze)}},wt=async(De,Ze)=>{try{await io(gr(Rn,"friend_requests",De),{status:"accepted"}),await io(gr(Rn,"users",Xt.currentUser.uid),{friends:zv(Ze)}),await io(gr(Rn,"users",Ze),{friends:zv(Xt.currentUser.uid)}),se("Friend request accepted!"),Zt()}catch(st){console.error("Error accepting friend request:",st)}},pt=async De=>{try{await Lv(gr(Rn,"friend_requests",De)),se("Friend request declined!")}catch(Ze){console.error("Error declining friend request:",Ze)}},jt=async De=>{try{await io(gr(Rn,"users",Xt.currentUser.uid),{friends:FM(De)}),await io(gr(Rn,"users",De),{friends:FM(Xt.currentUser.uid)}),a(Ze=>Ze.filter(st=>st.id!==De)),se("Friend removed!")}catch(Ze){console.error("Error removing friend:",Ze)}},Mt=async De=>{if(we===De.id)xt(null),e&&Xt.currentUser&&(pk(e,Xt.currentUser.uid),setTimeout(()=>e.resize(),300));else{xt(De.id);const st=(await is(gr(Rn,"users",De.id))).data();st&&st.location&&e&&(pk(e,De.id),setTimeout(()=>e.resize(),300))}},pn=()=>{B(null)},un=De=>{Q(De.target.value)},_n=De=>{Y(De),Kt(De.id),ln(De)},St=()=>{Y(null),fe([])},ln=De=>{he(Ze=>{const st=Ze.filter(rn=>rn.id!==De.id);return[De,...st]})},Kt=async De=>{if(!Xt.currentUser){console.error("User is not authenticated");return}const Ze=ss(Rn,"messages"),st=qo(Ze,Di("senderId","in",[Xt.currentUser.uid,De]),Di("receiverId","in",[Xt.currentUser.uid,De]),yE("timestamp","desc"),w7(20)),Pt=(await tl(st)).docs.map(vn=>({id:vn.id,...vn.data()})).reverse();fe(Pt)},xn=async()=>{if(Te.trim())try{await zM(ss(Rn,"messages"),{senderId:Xt.currentUser.uid,receiverId:G.id,content:Te,timestamp:NM()}),Pe(""),ln(G)}catch(De){console.error("Error sending message:",De)}},Er=De=>{Pe(De.target.value),_e&&clearTimeout(_e),io(gr(Rn,"users",Xt.currentUser.uid),{isTyping:!0});const Ze=setTimeout(()=>{io(gr(Rn,"users",Xt.currentUser.uid),{isTyping:!1})},2e3);Ee(Ze)};ue.useEffect(()=>{if(G){const De=x_(qo(ss(Rn,"messages"),Di("senderId","in",[Xt.currentUser.uid,G.id]),Di("receiverId","in",[Xt.currentUser.uid,G.id]),yE("timestamp")),st=>{const rn=st.docs.map(Pt=>({id:Pt.id,...Pt.data()}));fe(rn)}),Ze=x_(gr(Rn,"users",G.id),st=>{const rn=st.data();rn&&rn.isTyping?ge(!0):ge(!1)});return()=>{De(),Ze()}}},[G]);const Dn=f.filter(De=>De.name.toLowerCase().includes(H.toLowerCase())),hr=()=>{if(!we)return null;const De=f.find(Ze=>Ze.id===we)||T.find(Ze=>Ze.id===we);return De?(T.some(Ze=>Ze.id===De.id),J.jsxs("div",{className:"profile-container",children:[J.jsxs("div",{className:"profile-header",children:[J.jsx("div",{className:"profile-photo-container",children:J.jsx("img",{src:De.profilePhoto,alt:"Profile",className:"profile-photo"})}),J.jsxs("div",{className:"profile-name-status",children:[J.jsx("h2",{className:"profile-name",children:De.name}),J.jsxs("p",{className:"profile-status",children:[J.jsx("span",{className:"status-dot"})," Active"]})]})]}),J.jsxs("div",{className:"profile-section",children:[J.jsx("h3",{className:"section-title",children:"Bio"}),J.jsx("p",{className:"profile-bio",children:De.bio||"No bio available"})]}),J.jsxs("div",{className:"profile-section",children:[J.jsx("h3",{className:"section-title",children:"Tags"}),J.jsx("div",{className:"tags-container",children:De.tags&&De.tags.map(Ze=>J.jsx("div",{className:"tag",children:Ze},Ze))})]}),J.jsxs("div",{className:"profile-actions",children:[J.jsx("button",{className:"add-friend-btn1",onClick:()=>rt(De.id),children:"Add Friend"}),J.jsx("button",{className:"chat-btn2",onClick:()=>_n(De),children:J.jsx("img",{src:hR,alt:"Chat",className:"icon-img"})})]}),J.jsx("button",{className:"unlock-btn1",onClick:()=>xt(null),children:"Unlock User"})]})):null},Fr=()=>{switch(Rt){case"friends":return J.jsxs("div",{className:"friends-section",children:[J.jsx("h2",{children:"Friends"}),T.map(De=>J.jsxs("div",{className:"friend-item1",onClick:()=>Mt(De),children:[J.jsx("img",{src:De.profilePhoto,alt:"Friend"}),J.jsx("div",{children:De.name}),J.jsxs("div",{className:"button-group",children:[J.jsx("button",{className:"remove-friend-btn1",onClick:Ze=>{Ze.stopPropagation(),jt(De.id)},children:"Remove"}),J.jsx("button",{className:"chat-btn1",onClick:Ze=>{Ze.stopPropagation(),_n(De)},children:J.jsx("img",{src:hR,alt:"Chat",className:"icon-img"})})]})]},De.id))]});case"pending":return J.jsxs("div",{className:"pending-requests-section",children:[J.jsx("h2",{children:"Pending Requests"}),A.map(De=>J.jsxs("div",{className:"pending-request",children:[J.jsx("img",{src:De.senderPhoto,alt:"User"}),J.jsx("div",{children:De.senderName}),J.jsxs("div",{className:"button-group",children:[J.jsx("button",{className:"accept-btn",onClick:()=>wt(De.id,De.senderId),children:"Accept"}),J.jsx("button",{className:"decline-btn",onClick:()=>pt(De.id),children:"Decline"})]})]},De.id))]});case"people":return J.jsxs("div",{className:"people-section",children:[J.jsx("h2",{children:"People"}),Dn.map(De=>J.jsxs("div",{className:`people-item ${we===De.id?"locked":""}`,onClick:()=>Mt(De),children:[J.jsx("img",{src:De.profilePhoto,alt:"User"}),J.jsx("div",{children:De.name}),J.jsxs("div",{className:"button-group",children:[J.jsx("button",{className:"add-friend-btn1",onClick:Ze=>{Ze.stopPropagation(),rt(De.id)},children:"Add Friend"}),J.jsx("button",{className:"chat-btn1",onClick:Ze=>{Ze.stopPropagation(),_n(De)},children:J.jsx("img",{src:hR,alt:"Chat",className:"icon-img"})})]})]},De.id))]});case"recentChats":return J.jsxs("div",{className:"recent-chats-section",children:[J.jsx("h2",{children:"Recent Chats"}),ce.map(De=>J.jsxs("div",{className:"chat-history-item",onClick:()=>_n(De),children:[J.jsx("img",{src:De.profilePhoto,alt:"Profile"}),J.jsx("div",{children:De.name})]},De.id))]});default:return null}},ar=p1(({movement:[,De],down:Ze})=>{if(Ze){const st=window.innerHeight*.5-De;at(Math.max(100,Math.min(st,window.innerHeight-60)))}}),Yn=d1({height:bt,config:{tension:300,friction:30}});return J.jsx(JO,{children:J.jsxs("div",{className:`connections-container2 ${we?"user-locked1":""}`,style:Yn,children:[J.jsx("div",{className:"drag-handle",...ar()}),re&&J.jsx("div",{className:"notification1",children:re}),we?hr():J.jsxs(J.Fragment,{children:[J.jsx("div",{className:"search-bar1",children:J.jsx("input",{type:"text",placeholder:"Search users...",value:H,onChange:un})}),J.jsxs("div",{className:"connectionstabs",children:[J.jsx("button",{className:`tab-button-con ${Rt==="friends"?"active1 selected":""}`,onClick:()=>Bt("friends"),children:"Friends"}),J.jsx("button",{className:`tab-button-con ${Rt==="pending"?"active1 selected":""}`,onClick:()=>Bt("pending"),children:"Pending Requests"}),J.jsx("button",{className:`tab-button-con ${Rt==="people"?"active1 selected":""}`,onClick:()=>Bt("people"),children:"People"}),J.jsx("button",{className:`tab-button-con ${Rt==="recentChats"?"active1 selected":""}`,onClick:()=>Bt("recentChats"),children:"Recent Chats"})]}),Fr()]}),O&&J.jsxs("div",{className:"user-popup1",children:[J.jsx("button",{className:"close-popup1",onClick:pn,children:""}),J.jsx("img",{src:O.profilePhoto,alt:"Profile"}),J.jsx("div",{children:O.name}),J.jsx("div",{children:O.bio}),J.jsx("button",{className:"view-profile-btn1",onClick:()=>rt(O.id),children:"Add Friend"}),J.jsx("button",{className:"remove-friend-btn1",onClick:()=>jt(O.id),children:"Remove"})]}),G&&J.jsxs("div",{className:"chat-container1",children:[J.jsxs("div",{className:"chat-header1",children:[J.jsx("button",{className:"back-btn1",onClick:St,children:""}),J.jsx("img",{src:G.profilePhoto,alt:"Profile"}),J.jsx("div",{children:G.name})]}),J.jsxs("div",{className:"chat-messages1",children:[Z.map(De=>J.jsx("div",{className:`message1 ${De.senderId===Xt.currentUser.uid?"sent1":"received1"}`,children:J.jsx("div",{children:De.content})},De.id)),W&&J.jsxs("div",{className:"typing-indicator1",children:[J.jsx("span",{}),J.jsx("span",{}),J.jsx("span",{})]})]}),J.jsxs("div",{className:"chat-input1",children:[J.jsx("input",{type:"text",placeholder:"Type a message...",value:Te,onChange:Er}),J.jsx("button",{onClick:xn,children:J.jsx("img",{className:"sendchatimg",src:"sendchat.png",alt:"Send"})})]})]})]})})},Mye=()=>{const[t,e]=ue.useState({friendsCanSeeLocation:!0,quietMap:!1,canSeeOtherMarkers:!0,useCustomVisibilityList:!1}),[r,o]=ue.useState([]),[u,f]=ue.useState(""),[y,T]=ue.useState([]),[a,A]=ue.useState(window.innerHeight*.5);ue.useEffect(()=>{D()},[]);const D=async()=>{try{const Y=(await is(gr(Rn,"users",Xt.currentUser.uid))).data();e(Y.privacySettings||{friendsCanSeeLocation:!0,quietMap:!1,canSeeOtherMarkers:!0,useCustomVisibilityList:!1}),o(Y.customVisibilityList||[])}catch(G){console.error("Error fetching privacy settings:",G)}},O=async(G,Y)=>{try{const Z={...t,[G]:Y};e(Z),await io(gr(Rn,"users",Xt.currentUser.uid),{privacySettings:Z})}catch(Z){console.error("Error updating privacy setting:",Z)}},B=async G=>{if(f(G.target.value),G.target.value.length>2)try{const Y=ss(Rn,"users"),Z=qo(Y,Di("username",">=",G.target.value),Di("username","<=",G.target.value+"")),Te=(await tl(Z)).docs.map(Pe=>({id:Pe.id,...Pe.data()}));T(Te)}catch(Y){console.error("Error searching users:",Y)}else T([])},H=async G=>{if(G&&!r.some(Y=>Y.id===G.id)){const Y=[...r,G];o(Y),f(""),T([]);try{await io(gr(Rn,"users",Xt.currentUser.uid),{customVisibilityList:Y})}catch(Z){console.error("Error updating custom list:",Z)}}},Q=async G=>{const Y=r.filter(Z=>Z.id!==G);o(Y);try{await io(gr(Rn,"users",Xt.currentUser.uid),{customVisibilityList:Y})}catch(Z){console.error("Error updating custom list:",Z)}},re=p1(({movement:[,G],down:Y})=>{if(Y){const Z=window.innerHeight*.5-G;A(Math.max(100,Math.min(Z,window.innerHeight-60)))}}),se=d1({height:a,config:{tension:300,friction:30}});return J.jsxs(wq.div,{className:"privacy-container",style:se,children:[J.jsx("div",{className:"drag-handle",...re()}),J.jsx("h2",{children:"Privacy Settings"}),J.jsxs("div",{className:"privacy-section",children:[J.jsx("h3",{className:"section-title1",children:"Location Visibility"}),J.jsxs("div",{className:"privacy-option",children:[J.jsxs("label",{className:"toggle-switch",children:[J.jsx("input",{type:"checkbox",checked:t.friendsCanSeeLocation,onChange:G=>O("friendsCanSeeLocation",G.target.checked)}),J.jsx("span",{className:"slider round"})]}),J.jsx("span",{children:"Friends can see my location in privacy mode"})]}),J.jsxs("div",{className:"privacy-option",children:[J.jsxs("label",{className:"toggle-switch",children:[J.jsx("input",{type:"checkbox",checked:t.quietMap,onChange:G=>O("quietMap",G.target.checked)}),J.jsx("span",{className:"slider round"})]}),J.jsx("span",{children:"Quiet Map (Hide my location from everyone)"})]}),J.jsxs("div",{className:"privacy-option",children:[J.jsxs("label",{className:"toggle-switch",children:[J.jsx("input",{type:"checkbox",checked:t.canSeeOtherMarkers,onChange:G=>O("canSeeOtherMarkers",G.target.checked)}),J.jsx("span",{className:"slider round"})]}),J.jsx("span",{children:"See other users' markers on the map"})]})]}),J.jsxs("div",{className:"privacy-section",children:[J.jsx("h3",{className:"section-title1",children:"Custom Visibility List"}),J.jsxs("div",{className:"privacy-option",children:[J.jsxs("label",{className:"toggle-switch",children:[J.jsx("input",{type:"checkbox",checked:t.useCustomVisibilityList,onChange:G=>O("useCustomVisibilityList",G.target.checked)}),J.jsx("span",{className:"slider round"})]}),J.jsx("span",{children:"Use Custom Visibility List"})]}),t.useCustomVisibilityList&&J.jsxs(J.Fragment,{children:[J.jsxs("div",{className:"search-user",children:[J.jsx("input",{type:"text",value:u,onChange:B,placeholder:"Search users..."}),J.jsx("div",{className:"search-results",children:y.map(G=>J.jsxs("div",{className:"search-result-item",onClick:()=>H(G),children:[J.jsx("img",{src:G.profilePhoto||"/default-profile.png",alt:G.username,className:"user-avatar"}),J.jsx("span",{children:G.username})]},G.id))})]}),J.jsx("div",{className:"custom-list",children:r.map(G=>J.jsxs("div",{className:"custom-list-item",children:[J.jsx("img",{src:G.profilePhoto||"/default-profile.png",alt:G.username,className:"user-avatar"}),J.jsx("span",{children:G.username}),J.jsx("button",{onClick:()=>Q(G.id),children:"Remove"})]},G.id))})]})]})]})},kye="/assets/notification-bPXQTjjH.png",Dye="/assets/day-and-night-DlaE3U3y.png",sV=vi.memo(({items:t,onItemClick:e})=>{const r=ue.useCallback(o=>{const u=o.split(":").map(Number);return u[0]===u[1]?"square":u[0]*3===u[1]*2?"standard":u[0]*21===u[1]*10?"long":"standard"},[]);return J.jsx("div",{className:"pin-container",children:t.map(o=>{const u=r(o.aspectRatio||"2:3");return J.jsxs("div",{className:"pin-item",children:[J.jsx("div",{className:`card-wrapper pin-${u}`,children:J.jsxs("div",{className:"card",onClick:()=>e(o),children:[J.jsx("div",{className:"card-image-container",children:J.jsx("img",{src:o.image,alt:o.caption||`Photo by ${o.user.name}`,className:"card-image"})}),J.jsx("div",{className:"card-content",children:o.caption&&J.jsx("p",{className:"card-caption",children:o.caption})})]})}),J.jsxs("div",{className:"card-user-info",children:[J.jsx("img",{src:o.user.profilePhoto||"/default-profile-image.jpg",alt:o.user.name,className:"card-user-avatar"}),J.jsx("span",{className:"card-username",children:o.user.name})]})]},o.id)})})}),Oye=vi.memo(({selectedImage:t,comments:e,onClose:r,onAddComment:o,onDeletePost:u})=>{var a,A,D;const[f,y]=ue.useState(""),T=()=>{o(f),y("")};return J.jsx("div",{className:"image-preview-overlay",onClick:r,children:J.jsxs("div",{className:"image-preview-content",onClick:O=>O.stopPropagation(),children:[J.jsx("div",{className:"image-preview-main",children:J.jsx("img",{src:t==null?void 0:t.image,alt:"Preview",className:"preview-image"})}),J.jsxs("div",{className:"image-preview-sidebar",children:[J.jsxs("div",{className:"image-preview-header",children:[J.jsxs("div",{className:"user-info",children:[J.jsx("img",{src:((a=t==null?void 0:t.user)==null?void 0:a.profilePhoto)||"/default-profile-image.jpg",alt:"User",className:"user-avatar"}),J.jsx("span",{className:"username",children:((A=t==null?void 0:t.user)==null?void 0:A.name)||"Unknown User"})]}),J.jsx(IconButton,{onClick:r,className:"close-button",children:J.jsx(Close,{})})]}),J.jsx("div",{className:"quest-info",children:t!=null&&t.questTitle?J.jsx("p",{className:"quest-title",children:t.questTitle}):J.jsx("p",{className:"quest-break",children:"Taking a break from quests"})}),(t==null?void 0:t.caption)&&J.jsx("p",{className:"image-caption",children:t.caption}),J.jsx("div",{className:"comments-section",children:e.map(O=>J.jsxs("div",{className:"comment",children:[J.jsx("img",{src:O.userProfileImage||"/default-profile-image.jpg",alt:O.username,className:"comment-user-avatar"}),J.jsxs("div",{className:"comment-content",children:[J.jsx("strong",{children:O.username}),J.jsx("p",{children:O.text})]})]},O.id))}),J.jsx("div",{className:"add-comment",children:J.jsx(TextField,{value:f,onChange:O=>y(O.target.value),placeholder:"Add a comment...",fullWidth:!0,InputProps:{endAdornment:J.jsx(IconButton,{onClick:T,children:J.jsx(Send,{})})}})}),(t==null?void 0:t.userId)===((D=auth.currentUser)==null?void 0:D.uid)&&J.jsx(Button,{startIcon:J.jsx(Delete,{}),onClick:u,className:"delete-button",children:"Delete Post"})]})]})})}),Lye=({currentUser:t})=>ue.useMemo(()=>J.jsxs("div",{className:"profile-display",children:[J.jsx("div",{className:"profile-photo-container",children:J.jsx("img",{src:(t==null?void 0:t.profilePhoto)||"/default-profile-image.jpg",alt:(t==null?void 0:t.name)||"Profile",className:"profile-photo"})}),J.jsxs("div",{className:"profile-name-status",children:[J.jsx("h2",{className:"profile-name",children:(t==null?void 0:t.name)||"Loading..."}),J.jsxs("p",{className:"profile-status",children:[J.jsx("span",{className:"status-dot"}),"Active now"]})]})]}),[t]);vi.memo(()=>{const[t,e]=ue.useState(""),[r,o]=ue.useState([]),[u,f]=ue.useState("Loading address..."),[y,T]=ue.useState(null),[a,A]=ue.useState(null),[D,O]=ue.useState(null);ue.useState(null);const[B,H]=ue.useState("environment"),[Q,re]=ue.useState(!1),[se,G]=ue.useState(null),[Y,Z]=ue.useState(!1),[fe,Te]=ue.useState(null);ue.useState("medium"),ue.useState([]);const[Pe,ce]=ue.useState(!1),[he,W]=ue.useState(null),[ge,_e]=ue.useState(""),[Ee,we]=ue.useState([]);ue.useState("");const[xt,Rt]=ue.useState([]),[Bt,bt]=ue.useState(!0),[at,Ct]=ue.useState(null),[Zt,rt]=ue.useState(!1),[wt,pt]=ue.useState([]),[jt,Mt]=ue.useState(!0),[pn,un]=ue.useState({width:1920,height:1080}),[_n,St]=ue.useState([]),[ln,Kt]=ue.useState(!1),[xn,Er]=ue.useState(window.innerHeight*.5),[Dn,hr]=ue.useState(window.innerWidth<=768),Fr=F3(),{showNotification:ar}=VO();ue.useRef(null);const Yn=ue.useCallback(async en=>await Fv(en),[]);ue.useEffect(()=>{const en=Xt.onAuthStateChanged(async Kn=>{if(Kn){const ei=await Yn(Kn.uid);ei?(Ct({uid:Kn.uid,...ei}),G(ei),De(Kn.uid),Ze(Kn.uid)):console.error("User document not found")}else Ct(null),G(null),St([]),Rt([]);bt(!1)});return()=>en()},[Yn]),ue.useEffect(()=>{const en=ige(Fr);return()=>en()},[Fr]),ue.useEffect(()=>{const en=()=>{hr(window.innerWidth<=768)};return window.addEventListener("resize",en),()=>window.removeEventListener("resize",en)},[]),ue.useEffect(()=>{const en=()=>{const Kn=window.innerWidth>=1024;un(Kn?{width:3840,height:2160}:{width:1920,height:1080})};return en(),window.addEventListener("resize",en),()=>window.removeEventListener("resize",en)},[]);const De=ue.useCallback(async en=>{const Kn=gr(Rn,"users",en),ei=await is(Kn);if(ei.exists()){const vs=ei.data().friends||[],xs=await Promise.all(vs.map(async Ps=>{const Ns=gr(Rn,"users",Ps),Ro=await is(Ns);if(Ro.exists()){const Ur=Ro.data(),Ua=qo(ss(Rn,"quests"),Di("uid","==",Ps),Di("status","==","accepted")),ti=await tl(Ua);let gi="Idle",pl=null;if(!ti.empty){const ya=ti.docs[0].data();if(gi="On a quest",ya.targetUser){const lo=await is(gr(Rn,"users",ya.targetUser));lo.exists()&&(pl=lo.data())}}return{id:Ps,name:Ur.name,username:Ur.username,profilePhoto:Ur.profilePhoto,status:gi,questPartner:pl}}return null}));St(xs.filter(Ps=>Ps!==null))}},[]),Ze=ue.useCallback(async en=>{if(en)try{const Kn=gr(Rn,"users",en),ei=await is(Kn);if(ei.exists()){const vs=ei.data().friends||[],xs=ss(Rn,"photos"),Ps=qo(xs,Di("userId","in",[en,...vs]),yE("timestamp","desc")),Ns=await tl(Ps),Ro=await Promise.all(Ns.docs.map(async Ur=>{const Ua=Ur.data(),ti=await Fv(Ua.userId);return{id:Ur.id,...Ua,username:(ti==null?void 0:ti.name)||"Unknown User",user:{name:(ti==null?void 0:ti.name)||"Unknown User",profilePhoto:(ti==null?void 0:ti.profilePhoto)||"/default-profile-image.jpg"}}}));Rt(Ro)}}catch(Kn){console.error("Error fetching grid data:",Kn),ar("Failed to load posts. Please try again.")}},[Fv,ar]),st=ue.useCallback(en=>{e(Kn=>{const ei=en===Kn?"":en;return Mt(ei===""||ei==="home"),Z(!1),ei})},[]),rn=ue.useCallback(async en=>{if(en)try{const Kn=await Yn(en);Kn?(A(en),O({id:en,...Kn}),e("connections"),y&&y.flyTo({center:[Kn.location.longitude,Kn.location.latitude],zoom:15})):console.error("No user found with ID:",en)}catch(Kn){console.error("Error fetching user data:",Kn)}else if(A(null),O(null),y&&Xt.currentUser){const Kn=await Yn(Xt.currentUser.uid);y.flyTo({center:[Kn.location.longitude,Kn.location.latitude],zoom:15})}},[y,Yn]),Pt=ue.useCallback(en=>{Te(en),re(!1)},[]),vn=ue.useCallback(()=>{H(en=>en==="user"?"environment":"user")},[]),Sr=ue.useCallback(()=>{re(en=>!en),Kt(en=>!en)},[]),yn=ue.useCallback(()=>{Z(en=>{const Kn=!en;return!Kn&&y&&(se!=null&&se.location)&&y.flyTo({center:[se.location.longitude,se.location.latitude],zoom:15,duration:2e3}),Kn})},[y,se]),Zn=ue.useCallback(en=>{W(en),ce(Kn=>!Kn),en&&br(en.id)},[]),br=ue.useCallback(async en=>{const Kn=ss(Rn,"photos",en,"comments"),ei=await tl(Kn),Ai=await Promise.all(ei.docs.map(async vs=>{const xs=vs.data(),Ps=await Yn(xs.userId);return{id:vs.id,...xs,userProfileImage:Ps.profilePhoto}}));we(Ai)},[Yn]),Lr=ue.useCallback(async en=>{if(en.trim()&&he){const Kn=await zM(ss(Rn,"photos",he.id,"comments"),{text:en,userId:Xt.currentUser.uid,username:Xt.currentUser.displayName,timestamp:new Date}),ei=await Yn(Xt.currentUser.uid);we(Ai=>[...Ai,{id:Kn.id,text:en,userId:Xt.currentUser.uid,username:Xt.currentUser.displayName,timestamp:new Date,userProfileImage:ei.profilePhoto}])}},[he,Yn]),Li=ue.useCallback(async(en,Kn,ei="")=>{if(Xt.currentUser&&fe)try{const Ai=gr(ss(Rn,"photos")),vs={id:Ai.id,userId:Xt.currentUser.uid,user:{name:Xt.currentUser.displayName||"Unknown User",profilePhoto:(at==null?void 0:at.profilePhoto)||null},image:fe,aspectRatio:Kn,caption:ei,cropInfo:en,timestamp:NM()};await gT(Ai,vs),ar("Photo uploaded successfully"),Te(null),_e(""),Rt(xs=>[vs,...xs]),Ze(Xt.currentUser.uid)}catch(Ai){console.error("Error uploading photo:",Ai),ar("Failed to upload photo. Please try again.")}},[Xt.currentUser,fe,at,ar,Ze]),dr=ue.useCallback(async()=>{if(he&&he.userId===Xt.currentUser.uid)try{await Lv(gr(Rn,"photos",he.id)),ce(!1),Rt(en=>en.filter(Kn=>Kn.id!==he.id)),ar("Post deleted successfully"),Ze(Xt.currentUser.uid)}catch(en){console.error("Error deleting post:",en),ar("Failed to delete post. Please try again.")}},[he,ar,Ze]),zi=ue.useCallback(()=>rt(en=>!en),[]),ls=ue.useCallback(()=>pt([]),[]),Sn=p1(({movement:[,en],down:Kn})=>{if(Kn&&Dn){const ei=window.innerHeight*.5-en;Er(Math.max(100,Math.min(ei,window.innerHeight-60)))}}),lr=d1({height:xn,config:{tension:300,friction:30}}),hn=ue.useCallback(()=>J.jsxs("div",{className:"home-content",children:[J.jsxs("div",{className:"top-bar-old",children:[J.jsx(Lye,{}),J.jsx("div",{className:"top-bar-old-center",children:J.jsx(kfe,{className:"search-bar-home",placeholder:"Search...",variant:"outlined",fullWidth:!0,InputProps:{startAdornment:J.jsx(Bw,{children:J.jsx(Ofe,{})})}})}),J.jsxs("div",{className:"top-bar-old-right",children:[J.jsx(Bw,{onClick:zi,children:J.jsx(phe,{badgeContent:wt.length,color:"primary",children:J.jsx("img",{src:kye,alt:"Notifications",className:"top-bar-old-icon"})})}),J.jsx(Bw,{onClick:Sye,children:J.jsx("img",{src:Dye,alt:"Toggle Theme",className:"top-bar-old-icon"})})]})]}),J.jsx("div",{className:"section-container",children:J.jsx("div",{className:"friends-list2",children:_n.map(en=>J.jsxs("div",{className:"friend-item",children:[J.jsx("div",{className:"friend-photo-container",children:J.jsx("img",{src:en.profilePhoto||"/default-profile-image.jpg",alt:en.name,className:"friend-photo"})}),J.jsxs("div",{className:"friend-info",children:[J.jsx("div",{className:"friend-name",children:en.name}),J.jsxs("div",{className:"friend-username",children:["@",en.username]}),J.jsxs("div",{className:`friend-status ${en.status==="Idle"?"idle":"on-quest"}`,children:[en.status,en.status==="On a quest"&&en.questPartner&&J.jsxs("span",{className:"quest-partner",children:["with ",J.jsx("img",{src:en.questPartner.profilePhoto||"/default-profile-image.jpg",alt:en.questPartner.name,className:"partner-photo"}),"@",en.questPartner.username]})]})]})]},en.id))})}),Zt&&J.jsxs("div",{className:"notifications-dropdown",children:[J.jsx("h3",{children:"Notifications"}),wt.map((en,Kn)=>J.jsx("div",{className:"notification-item",children:en},Kn)),J.jsx(LG,{onClick:ls,children:"Clear All"})]}),J.jsx("div",{className:"main-area",children:Dn?J.jsxs("div",{className:"mobile-layout",children:[J.jsx("div",{className:"full-map-container",children:J.jsx(iv,{address:u,setAddress:f,setCurrentUserIds:o,setMap:T,activeSection:t,lockedUser:a,showAddressBar:!1,isFullScreen:!0})}),J.jsxs(wq.div,{className:"draggable-container",style:lr,children:[J.jsx("div",{className:"drag-handle",...Sn()}),J.jsxs("div",{className:"mobile-content",children:[J.jsx("div",{className:"camera-button",onClick:Sr,children:J.jsx(WU,{})}),J.jsxs("div",{className:"section-container",children:[J.jsx("h2",{className:"section-title3",children:"Feed"}),J.jsx(sV,{items:xt,onItemClick:Zn})]})]})]})]}):J.jsxs(J.Fragment,{children:[J.jsx("div",{className:"grid-area",children:J.jsxs("div",{className:"section-container",children:[J.jsx("h2",{className:"section-title3",children:"Feed"}),J.jsx(sV,{items:xt,onItemClick:Zn})]})}),J.jsx("div",{className:"side-area",children:J.jsxs("div",{className:"section-container",children:[J.jsx("h2",{className:"section-title",children:"Camera & Map"}),J.jsxs("div",{className:"camera-map-area",children:[ln?J.jsx(CameraComponent,{facingMode:B,toggleCamera:Sr,handleCapture:Pt,handleFlipCamera:vn,isFullScreenCamera:ln,cameraResolution:pn}):J.jsxs("div",{className:"camera-placeholder",onClick:Sr,children:[J.jsx(WU,{}),J.jsx("span",{children:"Open Camera"})]}),J.jsx("div",{className:"mini-map",onClick:yn,children:J.jsx(iv,{address:u,setAddress:f,setCurrentUserIds:o,setMap:T,activeSection:t,lockedUser:a,showAddressBar:!1,isFullScreen:!1})})]})]})})]})}),J.jsxs(Gfe,{children:[Pe&&J.jsx(Oye,{selectedImage:he,comments:Ee,onClose:()=>ce(!1),onAddComment:Lr,onDeletePost:dr}),fe&&J.jsx(vye,{photoPreview:fe,onUpload:Li,onCancel:()=>Te(null),currentUser:at})]})]}),[Q,B,Sr,Pt,vn,yn,u,t,a,Pe,he,Ee,Lr,dr,fe,Li,at,wt,zi,ls,pn,_n,xt,Dn,lr,Sn]),Zs=ue.useCallback(()=>J.jsxs("div",{className:"full-map-container",children:[J.jsx(Bw,{onClick:yn,className:"back-button",children:J.jsx(Dfe,{})}),J.jsx(iv,{address:u,setAddress:f,setCurrentUserIds:o,setMap:T,activeSection:t,lockedUser:a,showAddressBar:!0,isFullScreen:!0})]}),[yn,u,t,a]),Ei=ue.useCallback(async()=>{try{await sge(),ar("Logged out successfully"),Fr("/login")}catch(en){console.error("Logout failed:",en),ar("Logout failed. Please try again.")}},[ar,Fr]),ao=ue.useCallback(()=>{const en=jt?hn():J.jsx("div",{className:`section-content ${Dn?"mobile-section":""}`,children:(()=>{switch(t){case"profile":return J.jsx(cye,{handleLogout:Ei});case"quests":return J.jsx(wye,{currentUserIds:r,map:y});case"connections":return J.jsx(Rye,{currentUserIds:r,map:y,setLockedUser:rn,lockedUser:a,lockedUserData:D});case"privacy":return J.jsx(Mye,{});default:return null}})()});return Dn&&!jt?J.jsxs("div",{className:"mobile-section-with-map",children:[J.jsx("div",{className:"mobile-map-container",children:J.jsx(iv,{address:u,setAddress:f,setCurrentUserIds:o,setMap:T,activeSection:t,lockedUser:a,showAddressBar:!1,isFullScreen:!1})}),J.jsx("div",{className:"mobile-section-content",children:en})]}):en},[t,jt,r,y,rn,a,D,hn,Ei,Dn,u]),_a=ue.useCallback(()=>jt?"home-active":t==="profile"||t==="privacy"?`${t}-active`:t==="connections"?a?"connections-locked-active":"connections-active":t?`${t}-active`:"",[t,a,jt]);return ue.useEffect(()=>{jt&&T(null)},[jt]),J.jsxs("div",{className:`home-screen-container2 ${Dn?"mobile-view":""}`,children:[J.jsx(Pye,{activeSection:t,showSection:st,logo:"Questslogo blue.png",title:"QUESTS"}),Dn&&J.jsx("nav",{className:"mobile-nav-bar-container",children:J.jsxs("nav",{className:"mobile-nav-bar",children:[J.jsx("a",{href:"#home",className:`mobile-nav-button ${t===""?"active":""}`,onClick:()=>st(""),children:J.jsx("img",{src:"home.png",alt:"Home"})}),J.jsx("a",{href:"#profile",className:`mobile-nav-button ${t==="profile"?"active":""}`,onClick:()=>st("profile"),children:J.jsx("img",{src:"user-avatar.png",alt:"Profile"})}),J.jsx("a",{href:"#connections",className:`mobile-nav-button ${t==="connections"?"active":""}`,onClick:()=>st("connections"),children:J.jsx("img",{src:"happy.png",alt:"Connections"})}),J.jsx("a",{href:"#quests",className:`mobile-nav-button ${t==="quests"?"active":""}`,onClick:()=>st("quests"),children:J.jsx("img",{src:"letter.png",alt:"Quests"})}),J.jsx("a",{href:"#privacy",className:`mobile-nav-button ${t==="privacy"?"active":""}`,onClick:()=>st("privacy"),children:J.jsx("img",{src:"privacy1.png",alt:"Privacy"})})]})}),J.jsxs("div",{className:`main-content2 ${_a()}`,children:[Y?Zs():ao(),!jt&&!Y&&!Dn&&J.jsx("div",{className:"map-container2",children:J.jsx(iv,{address:u,setAddress:f,setCurrentUserIds:o,setMap:T,activeSection:t,lockedUser:a,showAddressBar:!0,isFullScreen:!1})})]})]})});var zye={exports:{}};(function(t,e){(function(r,o){t.exports=o(ue)})(typeof self<"u"?self:PV,function(r){return function(o){function u(y){if(f[y])return f[y].exports;var T=f[y]={i:y,l:!1,exports:{}};return o[y].call(T.exports,T,T.exports,u),T.l=!0,T.exports}var f={};return u.m=o,u.c=f,u.d=function(y,T,a){u.o(y,T)||Object.defineProperty(y,T,{configurable:!1,enumerable:!0,get:a})},u.n=function(y){var T=y&&y.__esModule?function(){return y.default}:function(){return y};return u.d(T,"a",T),T},u.o=function(y,T){return Object.prototype.hasOwnProperty.call(y,T)},u.p="",u(u.s=6)}([function(o,u,f){function y(_e,Ee){return A(_e)||a(_e,Ee)||T()}function T(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function a(_e,Ee){var we=[],xt=!0,Rt=!1,Bt=void 0;try{for(var bt,at=_e[Symbol.iterator]();!(xt=(bt=at.next()).done)&&(we.push(bt.value),!Ee||we.length!==Ee);xt=!0);}catch(Ct){Rt=!0,Bt=Ct}finally{try{xt||at.return==null||at.return()}finally{if(Rt)throw Bt}}return we}function A(_e){if(Array.isArray(_e))return _e}var D=f(1),O=f.n(D),B=f(7),H=f.n(B),Q=f(2),re=f(9),se=f.n(re),G=f(10),Y=f(5),Z=function(_e){return _e.query||Object(G.a)(_e)},fe=function(_e){if(!_e)return null;var Ee=Object.keys(_e);return Ee.length===0?null:Ee.reduce(function(we,xt){return we[Object(Q.a)(xt)]=_e[xt],we},{})},Te=function(){var _e=O.a.useRef(!1);return O.a.useEffect(function(){_e.current=!0},[]),_e.current},Pe=function(_e){var Ee=O.a.useContext(Y.a),we=function(){return fe(_e)||fe(Ee)},xt=O.a.useState(we),Rt=y(xt,2),Bt=Rt[0],bt=Rt[1];return O.a.useEffect(function(){var at=we();se()(Bt,at)||bt(at)},[_e,Ee]),Bt},ce=function(_e){var Ee=function(){return Z(_e)},we=O.a.useState(Ee),xt=y(we,2),Rt=xt[0],Bt=xt[1];return O.a.useEffect(function(){var bt=Ee();Rt!==bt&&Bt(bt)},[_e]),Rt},he=function(_e,Ee){var we=function(){return H()(_e,Ee||{},!!Ee)},xt=O.a.useState(we),Rt=y(xt,2),Bt=Rt[0],bt=Rt[1],at=Te();return O.a.useEffect(function(){return at&&bt(we()),function(){Bt.dispose()}},[_e,Ee]),Bt},W=function(_e){var Ee=O.a.useState(_e.matches),we=y(Ee,2),xt=we[0],Rt=we[1];return O.a.useEffect(function(){var Bt=function(){Rt(_e.matches)};return _e.addListener(Bt),Bt(),function(){_e.removeListener(Bt)}},[_e]),xt},ge=function(_e,Ee,we){var xt=Pe(Ee),Rt=ce(_e);if(!Rt)throw new Error("Invalid or missing MediaQuery!");var Bt=he(Rt,xt),bt=W(Bt),at=Te();return O.a.useEffect(function(){at&&we&&we(bt)},[bt]),bt};u.a=ge},function(o,u){o.exports=r},function(o,u,f){function y(O){return"-"+O.toLowerCase()}function T(O){if(D.hasOwnProperty(O))return D[O];var B=O.replace(a,y);return D[O]=A.test(B)?"-"+B:B}var a=/[A-Z]/g,A=/^ms-/,D={};u.a=T},function(o,u,f){o.exports=f(13)},function(o,u,f){o.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(o,u,f){var y=f(1),T=f.n(y),a=T.a.createContext();u.a=a},function(o,u,f){Object.defineProperty(u,"__esModule",{value:!0});var y=f(0),T=f(17),a=f(5);f.d(u,"default",function(){return T.a}),f.d(u,"useMediaQuery",function(){return y.a}),f.d(u,"Context",function(){return a.a})},function(o,u,f){function y(D,O,B){function H(Z){Y&&Y.addListener(Z)}function Q(Z){Y&&Y.removeListener(Z)}function re(Z){G.matches=Z.matches,G.media=Z.media}function se(){Y&&Y.removeListener(re)}var G=this;if(A&&!B){var Y=A.call(window,D);this.matches=Y.matches,this.media=Y.media,Y.addListener(re)}else this.matches=a(D,O),this.media=D;this.addListener=H,this.removeListener=Q,this.dispose=se}function T(D,O,B){return new y(D,O,B)}var a=f(8).match,A=typeof window<"u"?window.matchMedia:null;o.exports=T},function(o,u,f){function y(se,G){return T(se).some(function(Y){var Z=Y.inverse,fe=Y.type==="all"||G.type===Y.type;if(fe&&Z||!fe&&!Z)return!1;var Te=Y.expressions.every(function(Pe){var ce=Pe.feature,he=Pe.modifier,W=Pe.value,ge=G[ce];if(!ge)return!1;switch(ce){case"orientation":case"scan":return ge.toLowerCase()===W.toLowerCase();case"width":case"height":case"device-width":case"device-height":W=D(W),ge=D(ge);break;case"resolution":W=A(W),ge=A(ge);break;case"aspect-ratio":case"device-aspect-ratio":case"device-pixel-ratio":W=a(W),ge=a(ge);break;case"grid":case"color":case"color-index":case"monochrome":W=parseInt(W,10)||1,ge=parseInt(ge,10)||0}switch(he){case"min":return ge>=W;case"max":return ge<=W;default:return ge===W}});return Te&&!Z||!Te&&Z})}function T(se){return se.split(",").map(function(G){G=G.trim();var Y=G.match(O),Z=Y[1],fe=Y[2],Te=Y[3]||"",Pe={};return Pe.inverse=!!Z&&Z.toLowerCase()==="not",Pe.type=fe?fe.toLowerCase():"all",Te=Te.match(/\([^\)]+\)/g)||[],Pe.expressions=Te.map(function(ce){var he=ce.match(B),W=he[1].toLowerCase().match(H);return{modifier:W[1],feature:W[2],value:he[2]}}),Pe})}function a(se){var G,Y=Number(se);return Y||(G=se.match(/^(\d+)\s*\/\s*(\d+)$/),Y=G[1]/G[2]),Y}function A(se){var G=parseFloat(se);switch(String(se).match(re)[1]){case"dpcm":return G/2.54;case"dppx":return 96*G;default:return G}}function D(se){var G=parseFloat(se);switch(String(se).match(Q)[1]){case"em":case"rem":return 16*G;case"cm":return 96*G/2.54;case"mm":return 96*G/2.54/10;case"in":return 96*G;case"pt":return 72*G;case"pc":return 72*G/12;default:return G}}u.match=y,u.parse=T;var O=/(?:(only|not)?\s*([^\s\(\)]+)(?:\s*and)?\s*)?(.+)?/i,B=/\(\s*([^\s\:\)]+)\s*(?:\:\s*([^\s\)]+))?\s*\)/,H=/^(?:(min|max)-)?(.+)/,Q=/(em|rem|px|cm|mm|in|pt|pc)?$/,re=/(dpi|dpcm|dppx)?$/},function(o,u,f){function y(T,a){if(T===a)return!0;if(!T||!a)return!1;var A=Object.keys(T),D=Object.keys(a),O=A.length;if(D.length!==O)return!1;for(var B=0;B<O;B++){var H=A[B];if(T[H]!==a[H])return!1}return!0}o.exports=y},function(o,u,f){var y=f(2),T=f(11),a=function(O){return"not ".concat(O)},A=function(O,B){var H=Object(y.a)(O);return typeof B=="number"&&(B="".concat(B,"px")),B===!0?H:B===!1?a(H):"(".concat(H,": ").concat(B,")")},D=function(O){return O.join(" and ")};u.a=function(O){var B=[];return Object.keys(T.a.all).forEach(function(H){var Q=O[H];Q!=null&&B.push(A(H,Q))}),D(B)}},function(o,u,f){function y(se,G){var Y=Object.keys(se);if(Object.getOwnPropertySymbols){var Z=Object.getOwnPropertySymbols(se);G&&(Z=Z.filter(function(fe){return Object.getOwnPropertyDescriptor(se,fe).enumerable})),Y.push.apply(Y,Z)}return Y}function T(se){for(var G=1;G<arguments.length;G++){var Y=arguments[G]!=null?arguments[G]:{};G%2?y(Y,!0).forEach(function(Z){a(se,Z,Y[Z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(se,Object.getOwnPropertyDescriptors(Y)):y(Y).forEach(function(Z){Object.defineProperty(se,Z,Object.getOwnPropertyDescriptor(Y,Z))})}return se}function a(se,G,Y){return G in se?Object.defineProperty(se,G,{value:Y,enumerable:!0,configurable:!0,writable:!0}):se[G]=Y,se}var A=f(12),D=f.n(A),O=D.a.oneOfType([D.a.string,D.a.number]),B={orientation:D.a.oneOf(["portrait","landscape"]),scan:D.a.oneOf(["progressive","interlace"]),aspectRatio:D.a.string,deviceAspectRatio:D.a.string,height:O,deviceHeight:O,width:O,deviceWidth:O,color:D.a.bool,colorIndex:D.a.bool,monochrome:D.a.bool,resolution:O},H=T({minAspectRatio:D.a.string,maxAspectRatio:D.a.string,minDeviceAspectRatio:D.a.string,maxDeviceAspectRatio:D.a.string,minHeight:O,maxHeight:O,minDeviceHeight:O,maxDeviceHeight:O,minWidth:O,maxWidth:O,minDeviceWidth:O,maxDeviceWidth:O,minColor:D.a.number,maxColor:D.a.number,minColorIndex:D.a.number,maxColorIndex:D.a.number,minMonochrome:D.a.number,maxMonochrome:D.a.number,minResolution:O,maxResolution:O},B),Q={all:D.a.bool,grid:D.a.bool,aural:D.a.bool,braille:D.a.bool,handheld:D.a.bool,print:D.a.bool,projection:D.a.bool,screen:D.a.bool,tty:D.a.bool,tv:D.a.bool,embossed:D.a.bool},re=T({},Q,{},H);B.type=Object.keys(Q),u.a={all:re,types:Q,matchers:B,features:H}},function(o,u,f){var y=f(3);o.exports=f(14)(y.isElement,!0)},function(o,u,f){(function(){function y(De){return typeof De=="string"||typeof De=="function"||De===he||De===xt||De===ge||De===W||De===Bt||De===bt||typeof De=="object"&&De!==null&&(De.$$typeof===Ct||De.$$typeof===at||De.$$typeof===_e||De.$$typeof===Ee||De.$$typeof===Rt||De.$$typeof===Zt||De.$$typeof===rt)}function T(De){if(typeof De=="object"&&De!==null){var Ze=De.$$typeof;switch(Ze){case Pe:var st=De.type;switch(st){case we:case xt:case he:case ge:case W:case Bt:return st;default:var rn=st&&st.$$typeof;switch(rn){case Ee:case Rt:case _e:return rn;default:return Ze}}case Ct:case at:case ce:return Ze}}}function a(De){return Yn||(Yn=!0,jt(!1,"The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),A(De)||T(De)===we}function A(De){return T(De)===xt}function D(De){return T(De)===Ee}function O(De){return T(De)===_e}function B(De){return typeof De=="object"&&De!==null&&De.$$typeof===Pe}function H(De){return T(De)===Rt}function Q(De){return T(De)===he}function re(De){return T(De)===Ct}function se(De){return T(De)===at}function G(De){return T(De)===ce}function Y(De){return T(De)===ge}function Z(De){return T(De)===W}function fe(De){return T(De)===Bt}Object.defineProperty(u,"__esModule",{value:!0});var Te=typeof Symbol=="function"&&Symbol.for,Pe=Te?Symbol.for("react.element"):60103,ce=Te?Symbol.for("react.portal"):60106,he=Te?Symbol.for("react.fragment"):60107,W=Te?Symbol.for("react.strict_mode"):60108,ge=Te?Symbol.for("react.profiler"):60114,_e=Te?Symbol.for("react.provider"):60109,Ee=Te?Symbol.for("react.context"):60110,we=Te?Symbol.for("react.async_mode"):60111,xt=Te?Symbol.for("react.concurrent_mode"):60111,Rt=Te?Symbol.for("react.forward_ref"):60112,Bt=Te?Symbol.for("react.suspense"):60113,bt=Te?Symbol.for("react.suspense_list"):60120,at=Te?Symbol.for("react.memo"):60115,Ct=Te?Symbol.for("react.lazy"):60116,Zt=Te?Symbol.for("react.fundamental"):60117,rt=Te?Symbol.for("react.responder"):60118,wt=function(){},pt=function(De){for(var Ze=arguments.length,st=Array(Ze>1?Ze-1:0),rn=1;rn<Ze;rn++)st[rn-1]=arguments[rn];var Pt=0,vn="Warning: "+De.replace(/%s/g,function(){return st[Pt++]});typeof console<"u"&&console.warn(vn);try{throw new Error(vn)}catch{}};wt=function(De,Ze){if(Ze===void 0)throw new Error("`lowPriorityWarning(condition, format, ...args)` requires a warning message argument");if(!De){for(var st=arguments.length,rn=Array(st>2?st-2:0),Pt=2;Pt<st;Pt++)rn[Pt-2]=arguments[Pt];pt.apply(void 0,[Ze].concat(rn))}};var jt=wt,Mt=we,pn=xt,un=Ee,_n=_e,St=Pe,ln=Rt,Kt=he,xn=Ct,Er=at,Dn=ce,hr=ge,Fr=W,ar=Bt,Yn=!1;u.typeOf=T,u.AsyncMode=Mt,u.ConcurrentMode=pn,u.ContextConsumer=un,u.ContextProvider=_n,u.Element=St,u.ForwardRef=ln,u.Fragment=Kt,u.Lazy=xn,u.Memo=Er,u.Portal=Dn,u.Profiler=hr,u.StrictMode=Fr,u.Suspense=ar,u.isValidElementType=y,u.isAsyncMode=a,u.isConcurrentMode=A,u.isContextConsumer=D,u.isContextProvider=O,u.isElement=B,u.isForwardRef=H,u.isFragment=Q,u.isLazy=re,u.isMemo=se,u.isPortal=G,u.isProfiler=Y,u.isStrictMode=Z,u.isSuspense=fe})()},function(o,u,f){function y(){return null}var T=f(3),a=f(15),A=f(4),D=f(16),O=Function.call.bind(Object.prototype.hasOwnProperty),B=function(){};B=function(H){var Q="Warning: "+H;typeof console<"u"&&console.error(Q);try{throw new Error(Q)}catch{}},o.exports=function(H,Q){function re(rt){var wt=rt&&(bt&&rt[bt]||rt[at]);if(typeof wt=="function")return wt}function se(rt,wt){return rt===wt?rt!==0||1/rt==1/wt:rt!==rt&&wt!==wt}function G(rt){this.message=rt,this.stack=""}function Y(rt){function wt(pn,un,_n,St,ln,Kt,xn){if(St=St||Ct,Kt=Kt||_n,xn!==A){if(Q){var Er=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw Er.name="Invariant Violation",Er}if(typeof console<"u"){var Dn=St+":"+_n;!pt[Dn]&&jt<3&&(B("You are manually calling a React.PropTypes validation function for the `"+Kt+"` prop on `"+St+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),pt[Dn]=!0,jt++)}}return un[_n]==null?pn?new G(un[_n]===null?"The "+ln+" `"+Kt+"` is marked as required in `"+St+"`, but its value is `null`.":"The "+ln+" `"+Kt+"` is marked as required in `"+St+"`, but its value is `undefined`."):null:rt(un,_n,St,ln,Kt)}var pt={},jt=0,Mt=wt.bind(null,!1);return Mt.isRequired=wt.bind(null,!0),Mt}function Z(rt){function wt(pt,jt,Mt,pn,un,_n){var St=pt[jt];return we(St)!==rt?new G("Invalid "+pn+" `"+un+"` of type `"+xt(St)+"` supplied to `"+Mt+"`, expected `"+rt+"`."):null}return Y(wt)}function fe(rt){function wt(pt,jt,Mt,pn,un){if(typeof rt!="function")return new G("Property `"+un+"` of component `"+Mt+"` has invalid PropType notation inside arrayOf.");var _n=pt[jt];if(!Array.isArray(_n))return new G("Invalid "+pn+" `"+un+"` of type `"+we(_n)+"` supplied to `"+Mt+"`, expected an array.");for(var St=0;St<_n.length;St++){var ln=rt(_n,St,Mt,pn,un+"["+St+"]",A);if(ln instanceof Error)return ln}return null}return Y(wt)}function Te(rt){function wt(pt,jt,Mt,pn,un){if(!(pt[jt]instanceof rt)){var _n=rt.name||Ct;return new G("Invalid "+pn+" `"+un+"` of type `"+Bt(pt[jt])+"` supplied to `"+Mt+"`, expected instance of `"+_n+"`.")}return null}return Y(wt)}function Pe(rt){function wt(pt,jt,Mt,pn,un){for(var _n=pt[jt],St=0;St<rt.length;St++)if(se(_n,rt[St]))return null;var ln=JSON.stringify(rt,function(Kt,xn){return xt(xn)==="symbol"?String(xn):xn});return new G("Invalid "+pn+" `"+un+"` of value `"+String(_n)+"` supplied to `"+Mt+"`, expected one of "+ln+".")}return Array.isArray(rt)?Y(wt):(B(arguments.length>1?"Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z]).":"Invalid argument supplied to oneOf, expected an array."),y)}function ce(rt){function wt(pt,jt,Mt,pn,un){if(typeof rt!="function")return new G("Property `"+un+"` of component `"+Mt+"` has invalid PropType notation inside objectOf.");var _n=pt[jt],St=we(_n);if(St!=="object")return new G("Invalid "+pn+" `"+un+"` of type `"+St+"` supplied to `"+Mt+"`, expected an object.");for(var ln in _n)if(O(_n,ln)){var Kt=rt(_n,ln,Mt,pn,un+"."+ln,A);if(Kt instanceof Error)return Kt}return null}return Y(wt)}function he(rt){function wt(Mt,pn,un,_n,St){for(var ln=0;ln<rt.length;ln++)if((0,rt[ln])(Mt,pn,un,_n,St,A)==null)return null;return new G("Invalid "+_n+" `"+St+"` supplied to `"+un+"`.")}if(!Array.isArray(rt))return B("Invalid argument supplied to oneOfType, expected an instance of array."),y;for(var pt=0;pt<rt.length;pt++){var jt=rt[pt];if(typeof jt!="function")return B("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+Rt(jt)+" at index "+pt+"."),y}return Y(wt)}function W(rt){function wt(pt,jt,Mt,pn,un){var _n=pt[jt],St=we(_n);if(St!=="object")return new G("Invalid "+pn+" `"+un+"` of type `"+St+"` supplied to `"+Mt+"`, expected `object`.");for(var ln in rt){var Kt=rt[ln];if(Kt){var xn=Kt(_n,ln,Mt,pn,un+"."+ln,A);if(xn)return xn}}return null}return Y(wt)}function ge(rt){function wt(pt,jt,Mt,pn,un){var _n=pt[jt],St=we(_n);if(St!=="object")return new G("Invalid "+pn+" `"+un+"` of type `"+St+"` supplied to `"+Mt+"`, expected `object`.");var ln=a({},pt[jt],rt);for(var Kt in ln){var xn=rt[Kt];if(!xn)return new G("Invalid "+pn+" `"+un+"` key `"+Kt+"` supplied to `"+Mt+"`.\nBad object: "+JSON.stringify(pt[jt],null,"  ")+`
Valid keys: `+JSON.stringify(Object.keys(rt),null,"  "));var Er=xn(_n,Kt,Mt,pn,un+"."+Kt,A);if(Er)return Er}return null}return Y(wt)}function _e(rt){switch(typeof rt){case"number":case"string":case"undefined":return!0;case"boolean":return!rt;case"object":if(Array.isArray(rt))return rt.every(_e);if(rt===null||H(rt))return!0;var wt=re(rt);if(!wt)return!1;var pt,jt=wt.call(rt);if(wt!==rt.entries){for(;!(pt=jt.next()).done;)if(!_e(pt.value))return!1}else for(;!(pt=jt.next()).done;){var Mt=pt.value;if(Mt&&!_e(Mt[1]))return!1}return!0;default:return!1}}function Ee(rt,wt){return rt==="symbol"||!!wt&&(wt["@@toStringTag"]==="Symbol"||typeof Symbol=="function"&&wt instanceof Symbol)}function we(rt){var wt=typeof rt;return Array.isArray(rt)?"array":rt instanceof RegExp?"object":Ee(wt,rt)?"symbol":wt}function xt(rt){if(rt==null)return""+rt;var wt=we(rt);if(wt==="object"){if(rt instanceof Date)return"date";if(rt instanceof RegExp)return"regexp"}return wt}function Rt(rt){var wt=xt(rt);switch(wt){case"array":case"object":return"an "+wt;case"boolean":case"date":case"regexp":return"a "+wt;default:return wt}}function Bt(rt){return rt.constructor&&rt.constructor.name?rt.constructor.name:Ct}var bt=typeof Symbol=="function"&&Symbol.iterator,at="@@iterator",Ct="<<anonymous>>",Zt={array:Z("array"),bool:Z("boolean"),func:Z("function"),number:Z("number"),object:Z("object"),string:Z("string"),symbol:Z("symbol"),any:function(){return Y(y)}(),arrayOf:fe,element:function(){function rt(wt,pt,jt,Mt,pn){var un=wt[pt];return H(un)?null:new G("Invalid "+Mt+" `"+pn+"` of type `"+we(un)+"` supplied to `"+jt+"`, expected a single ReactElement.")}return Y(rt)}(),elementType:function(){function rt(wt,pt,jt,Mt,pn){var un=wt[pt];return T.isValidElementType(un)?null:new G("Invalid "+Mt+" `"+pn+"` of type `"+we(un)+"` supplied to `"+jt+"`, expected a single ReactElement type.")}return Y(rt)}(),instanceOf:Te,node:function(){function rt(wt,pt,jt,Mt,pn){return _e(wt[pt])?null:new G("Invalid "+Mt+" `"+pn+"` supplied to `"+jt+"`, expected a ReactNode.")}return Y(rt)}(),objectOf:ce,oneOf:Pe,oneOfType:he,shape:W,exact:ge};return G.prototype=Error.prototype,Zt.checkPropTypes=D,Zt.resetWarningCache=D.resetWarningCache,Zt.PropTypes=Zt,Zt}},function(o,u,f){function y(D){if(D==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(D)}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var T=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;o.exports=function(){try{if(!Object.assign)return!1;var D=new String("abc");if(D[5]="de",Object.getOwnPropertyNames(D)[0]==="5")return!1;for(var O={},B=0;B<10;B++)O["_"+String.fromCharCode(B)]=B;if(Object.getOwnPropertyNames(O).map(function(Q){return O[Q]}).join("")!=="0123456789")return!1;var H={};return"abcdefghijklmnopqrst".split("").forEach(function(Q){H[Q]=Q}),Object.keys(Object.assign({},H)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}()?Object.assign:function(D,O){for(var B,H,Q=y(D),re=1;re<arguments.length;re++){B=Object(arguments[re]);for(var se in B)a.call(B,se)&&(Q[se]=B[se]);if(T){H=T(B);for(var G=0;G<H.length;G++)A.call(B,H[G])&&(Q[H[G]]=B[H[G]])}}return Q}},function(o,u,f){function y(O,B,H,Q,re){for(var se in O)if(D(O,se)){var G;try{if(typeof O[se]!="function"){var Y=Error((Q||"React class")+": "+H+" type `"+se+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof O[se]+"`.");throw Y.name="Invariant Violation",Y}G=O[se](B,se,Q,H,null,a)}catch(fe){G=fe}if(!G||G instanceof Error||T((Q||"React class")+": type specification of "+H+" `"+se+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof G+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),G instanceof Error&&!(G.message in A)){A[G.message]=!0;var Z=re?re():"";T("Failed "+H+" type: "+G.message+(Z??""))}}}var T=function(){},a=f(4),A={},D=Function.call.bind(Object.prototype.hasOwnProperty);T=function(O){var B="Warning: "+O;typeof console<"u"&&console.error(B);try{throw new Error(B)}catch{}},y.resetWarningCache=function(){A={}},o.exports=y},function(o,u,f){function y(D,O){if(D==null)return{};var B,H,Q=T(D,O);if(Object.getOwnPropertySymbols){var re=Object.getOwnPropertySymbols(D);for(H=0;H<re.length;H++)B=re[H],O.indexOf(B)>=0||Object.prototype.propertyIsEnumerable.call(D,B)&&(Q[B]=D[B])}return Q}function T(D,O){if(D==null)return{};var B,H,Q={},re=Object.keys(D);for(H=0;H<re.length;H++)B=re[H],O.indexOf(B)>=0||(Q[B]=D[B]);return Q}function a(D){var O=D.children,B=D.device,H=D.onChange,Q=y(D,["children","device","onChange"]),re=Object(A.a)(Q,B,H);return typeof O=="function"?O(re):re?O:null}u.a=a;var A=f(0)}])})})(zye);ue.createContext();var Da=function(){return Da=Object.assign||function(e){for(var r,o=1,u=arguments.length;o<u;o++){r=arguments[o];for(var f in r)Object.prototype.hasOwnProperty.call(r,f)&&(e[f]=r[f])}return e},Da.apply(this,arguments)};function VE(t,e,r){if(r||arguments.length===2)for(var o=0,u=e.length,f;o<u;o++)(f||!(o in e))&&(f||(f=Array.prototype.slice.call(e,0,o)),f[o]=e[o]);return t.concat(f||Array.prototype.slice.call(e))}var Wi="-ms-",Zv="-moz-",mi="-webkit-",TW="comm",kI="rule",eL="decl",Nye="@import",EW="@keyframes",Fye="@layer",SW=Math.abs,tL=String.fromCharCode,Ok=Object.assign;function Bye(t,e){return go(t,0)^45?(((e<<2^go(t,0))<<2^go(t,1))<<2^go(t,2))<<2^go(t,3):0}function IW(t){return t.trim()}function dh(t,e){return(t=e.exec(t))?t[0]:t}function Nr(t,e,r){return t.replace(e,r)}function IT(t,e,r){return t.indexOf(e,r)}function go(t,e){return t.charCodeAt(e)|0}function X_(t,e,r){return t.slice(e,r)}function du(t){return t.length}function AW(t){return t.length}function xv(t,e){return e.push(t),t}function Uye(t,e){return t.map(e).join("")}function oV(t,e){return t.filter(function(r){return!dh(r,e)})}var DI=1,K_=1,CW=0,Vl=0,Gs=0,py="";function OI(t,e,r,o,u,f,y,T){return{value:t,root:e,parent:r,type:o,props:u,children:f,line:DI,column:K_,length:y,return:"",siblings:T}}function zd(t,e){return Ok(OI("",null,null,"",null,null,0,t.siblings),t,{length:-t.length},e)}function Ug(t){for(;t.root;)t=zd(t.root,{children:[t]});xv(t,t.siblings)}function Vye(){return Gs}function jye(){return Gs=Vl>0?go(py,--Vl):0,K_--,Gs===10&&(K_=1,DI--),Gs}function Ic(){return Gs=Vl<CW?go(py,Vl++):0,K_++,Gs===10&&(K_=1,DI++),Gs}function Hp(){return go(py,Vl)}function AT(){return Vl}function LI(t,e){return X_(py,t,e)}function Lk(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function $ye(t){return DI=K_=1,CW=du(py=t),Vl=0,[]}function Gye(t){return py="",t}function dR(t){return IW(LI(Vl-1,zk(t===91?t+2:t===40?t+1:t)))}function qye(t){for(;(Gs=Hp())&&Gs<33;)Ic();return Lk(t)>2||Lk(Gs)>3?"":" "}function Wye(t,e){for(;--e&&Ic()&&!(Gs<48||Gs>102||Gs>57&&Gs<65||Gs>70&&Gs<97););return LI(t,AT()+(e<6&&Hp()==32&&Ic()==32))}function zk(t){for(;Ic();)switch(Gs){case t:return Vl;case 34:case 39:t!==34&&t!==39&&zk(Gs);break;case 40:t===41&&zk(t);break;case 92:Ic();break}return Vl}function Hye(t,e){for(;Ic()&&t+Gs!==57;)if(t+Gs===84&&Hp()===47)break;return"/*"+LI(e,Vl-1)+"*"+tL(t===47?t:Ic())}function Zye(t){for(;!Lk(Hp());)Ic();return LI(t,Vl)}function Xye(t){return Gye(CT("",null,null,null,[""],t=$ye(t),0,[0],t))}function CT(t,e,r,o,u,f,y,T,a){for(var A=0,D=0,O=y,B=0,H=0,Q=0,re=1,se=1,G=1,Y=0,Z="",fe=u,Te=f,Pe=o,ce=Z;se;)switch(Q=Y,Y=Ic()){case 40:if(Q!=108&&go(ce,O-1)==58){IT(ce+=Nr(dR(Y),"&","&\f"),"&\f",SW(A?T[A-1]:0))!=-1&&(G=-1);break}case 34:case 39:case 91:ce+=dR(Y);break;case 9:case 10:case 13:case 32:ce+=qye(Q);break;case 92:ce+=Wye(AT()-1,7);continue;case 47:switch(Hp()){case 42:case 47:xv(Kye(Hye(Ic(),AT()),e,r,a),a);break;default:ce+="/"}break;case 123*re:T[A++]=du(ce)*G;case 125*re:case 59:case 0:switch(Y){case 0:case 125:se=0;case 59+D:G==-1&&(ce=Nr(ce,/\f/g,"")),H>0&&du(ce)-O&&xv(H>32?lV(ce+";",o,r,O-1,a):lV(Nr(ce," ","")+";",o,r,O-2,a),a);break;case 59:ce+=";";default:if(xv(Pe=aV(ce,e,r,A,D,u,T,Z,fe=[],Te=[],O,f),f),Y===123)if(D===0)CT(ce,e,Pe,Pe,fe,f,O,T,Te);else switch(B===99&&go(ce,3)===110?100:B){case 100:case 108:case 109:case 115:CT(t,Pe,Pe,o&&xv(aV(t,Pe,Pe,0,0,u,T,Z,u,fe=[],O,Te),Te),u,Te,O,T,o?fe:Te);break;default:CT(ce,Pe,Pe,Pe,[""],Te,0,T,Te)}}A=D=H=0,re=G=1,Z=ce="",O=y;break;case 58:O=1+du(ce),H=Q;default:if(re<1){if(Y==123)--re;else if(Y==125&&re++==0&&jye()==125)continue}switch(ce+=tL(Y),Y*re){case 38:G=D>0?1:(ce+="\f",-1);break;case 44:T[A++]=(du(ce)-1)*G,G=1;break;case 64:Hp()===45&&(ce+=dR(Ic())),B=Hp(),D=O=du(Z=ce+=Zye(AT())),Y++;break;case 45:Q===45&&du(ce)==2&&(re=0)}}return f}function aV(t,e,r,o,u,f,y,T,a,A,D,O){for(var B=u-1,H=u===0?f:[""],Q=AW(H),re=0,se=0,G=0;re<o;++re)for(var Y=0,Z=X_(t,B+1,B=SW(se=y[re])),fe=t;Y<Q;++Y)(fe=IW(se>0?H[Y]+" "+Z:Nr(Z,/&\f/g,H[Y])))&&(a[G++]=fe);return OI(t,e,r,u===0?kI:T,a,A,D,O)}function Kye(t,e,r,o){return OI(t,e,r,TW,tL(Vye()),X_(t,2,-2),0,o)}function lV(t,e,r,o,u){return OI(t,e,r,eL,X_(t,0,o),X_(t,o+1,-1),o,u)}function PW(t,e,r){switch(Bye(t,e)){case 5103:return mi+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return mi+t+t;case 4789:return Zv+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return mi+t+Zv+t+Wi+t+t;case 5936:switch(go(t,e+11)){case 114:return mi+t+Wi+Nr(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return mi+t+Wi+Nr(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return mi+t+Wi+Nr(t,/[svh]\w+-[tblr]{2}/,"lr")+t}case 6828:case 4268:case 2903:return mi+t+Wi+t+t;case 6165:return mi+t+Wi+"flex-"+t+t;case 5187:return mi+t+Nr(t,/(\w+).+(:[^]+)/,mi+"box-$1$2"+Wi+"flex-$1$2")+t;case 5443:return mi+t+Wi+"flex-item-"+Nr(t,/flex-|-self/g,"")+(dh(t,/flex-|baseline/)?"":Wi+"grid-row-"+Nr(t,/flex-|-self/g,""))+t;case 4675:return mi+t+Wi+"flex-line-pack"+Nr(t,/align-content|flex-|-self/g,"")+t;case 5548:return mi+t+Wi+Nr(t,"shrink","negative")+t;case 5292:return mi+t+Wi+Nr(t,"basis","preferred-size")+t;case 6060:return mi+"box-"+Nr(t,"-grow","")+mi+t+Wi+Nr(t,"grow","positive")+t;case 4554:return mi+Nr(t,/([^-])(transform)/g,"$1"+mi+"$2")+t;case 6187:return Nr(Nr(Nr(t,/(zoom-|grab)/,mi+"$1"),/(image-set)/,mi+"$1"),t,"")+t;case 5495:case 3959:return Nr(t,/(image-set\([^]*)/,mi+"$1$`$1");case 4968:return Nr(Nr(t,/(.+:)(flex-)?(.*)/,mi+"box-pack:$3"+Wi+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+mi+t+t;case 4200:if(!dh(t,/flex-|baseline/))return Wi+"grid-column-align"+X_(t,e)+t;break;case 2592:case 3360:return Wi+Nr(t,"template-","")+t;case 4384:case 3616:return r&&r.some(function(o,u){return e=u,dh(o.props,/grid-\w+-end/)})?~IT(t+(r=r[e].value),"span",0)?t:Wi+Nr(t,"-start","")+t+Wi+"grid-row-span:"+(~IT(r,"span",0)?dh(r,/\d+/):+dh(r,/\d+/)-+dh(t,/\d+/))+";":Wi+Nr(t,"-start","")+t;case 4896:case 4128:return r&&r.some(function(o){return dh(o.props,/grid-\w+-start/)})?t:Wi+Nr(Nr(t,"-end","-span"),"span ","")+t;case 4095:case 3583:case 4068:case 2532:return Nr(t,/(.+)-inline(.+)/,mi+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(du(t)-1-e>6)switch(go(t,e+1)){case 109:if(go(t,e+4)!==45)break;case 102:return Nr(t,/(.+:)(.+)-([^]+)/,"$1"+mi+"$2-$3$1"+Zv+(go(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~IT(t,"stretch",0)?PW(Nr(t,"stretch","fill-available"),e,r)+t:t}break;case 5152:case 5920:return Nr(t,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(o,u,f,y,T,a,A){return Wi+u+":"+f+A+(y?Wi+u+"-span:"+(T?a:+a-+f)+A:"")+t});case 4949:if(go(t,e+6)===121)return Nr(t,":",":"+mi)+t;break;case 6444:switch(go(t,go(t,14)===45?18:11)){case 120:return Nr(t,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+mi+(go(t,14)===45?"inline-":"")+"box$3$1"+mi+"$2$3$1"+Wi+"$2box$3")+t;case 100:return Nr(t,":",":"+Wi)+t}break;case 5719:case 2647:case 2135:case 3927:case 2391:return Nr(t,"scroll-","scroll-snap-")+t}return t}function jE(t,e){for(var r="",o=0;o<t.length;o++)r+=e(t[o],o,t,e)||"";return r}function Yye(t,e,r,o){switch(t.type){case Fye:if(t.children.length)break;case Nye:case eL:return t.return=t.return||t.value;case TW:return"";case EW:return t.return=t.value+"{"+jE(t.children,o)+"}";case kI:if(!du(t.value=t.props.join(",")))return""}return du(r=jE(t.children,o))?t.return=t.value+"{"+r+"}":""}function Qye(t){var e=AW(t);return function(r,o,u,f){for(var y="",T=0;T<e;T++)y+=t[T](r,o,u,f)||"";return y}}function Jye(t){return function(e){e.root||(e=e.return)&&t(e)}}function e0e(t,e,r,o){if(t.length>-1&&!t.return)switch(t.type){case eL:t.return=PW(t.value,t.length,r);return;case EW:return jE([zd(t,{value:Nr(t.value,"@","@"+mi)})],o);case kI:if(t.length)return Uye(r=t.props,function(u){switch(dh(u,o=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Ug(zd(t,{props:[Nr(u,/:(read-\w+)/,":"+Zv+"$1")]})),Ug(zd(t,{props:[u]})),Ok(t,{props:oV(r,o)});break;case"::placeholder":Ug(zd(t,{props:[Nr(u,/:(plac\w+)/,":"+mi+"input-$1")]})),Ug(zd(t,{props:[Nr(u,/:(plac\w+)/,":"+Zv+"$1")]})),Ug(zd(t,{props:[Nr(u,/:(plac\w+)/,Wi+"input-$1")]})),Ug(zd(t,{props:[u]})),Ok(t,{props:oV(r,o)});break}return""})}}var t0e={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Ka={},Y_=typeof process<"u"&&Ka!==void 0&&(Ka.REACT_APP_SC_ATTR||Ka.SC_ATTR)||"data-styled",RW="active",MW="data-styled-version",zI="6.1.13",nL=`/*!sc*/
`,$E=typeof window<"u"&&"HTMLElement"in window,n0e=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&Ka!==void 0&&Ka.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&Ka.REACT_APP_SC_DISABLE_SPEEDY!==""?Ka.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&Ka.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&Ka!==void 0&&Ka.SC_DISABLE_SPEEDY!==void 0&&Ka.SC_DISABLE_SPEEDY!==""&&Ka.SC_DISABLE_SPEEDY!=="false"&&Ka.SC_DISABLE_SPEEDY),NI=Object.freeze([]),Q_=Object.freeze({});function r0e(t,e,r){return r===void 0&&(r=Q_),t.theme!==r.theme&&t.theme||e||r.theme}var kW=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),i0e=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,s0e=/(^-|-$)/g;function cV(t){return t.replace(i0e,"-").replace(s0e,"")}var o0e=/(a)(d)/gi,Hw=52,uV=function(t){return String.fromCharCode(t+(t>25?39:97))};function Nk(t){var e,r="";for(e=Math.abs(t);e>Hw;e=e/Hw|0)r=uV(e%Hw)+r;return(uV(e%Hw)+r).replace(o0e,"$1-$2")}var fR,DW=5381,c_=function(t,e){for(var r=e.length;r;)t=33*t^e.charCodeAt(--r);return t},OW=function(t){return c_(DW,t)};function a0e(t){return Nk(OW(t)>>>0)}function l0e(t){return t.displayName||t.name||"Component"}function pR(t){return typeof t=="string"&&!0}var LW=typeof Symbol=="function"&&Symbol.for,zW=LW?Symbol.for("react.memo"):60115,c0e=LW?Symbol.for("react.forward_ref"):60112,u0e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},h0e={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},NW={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d0e=((fR={})[c0e]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},fR[zW]=NW,fR);function hV(t){return("type"in(e=t)&&e.type.$$typeof)===zW?NW:"$$typeof"in t?d0e[t.$$typeof]:u0e;var e}var f0e=Object.defineProperty,p0e=Object.getOwnPropertyNames,dV=Object.getOwnPropertySymbols,m0e=Object.getOwnPropertyDescriptor,g0e=Object.getPrototypeOf,fV=Object.prototype;function FW(t,e,r){if(typeof e!="string"){if(fV){var o=g0e(e);o&&o!==fV&&FW(t,o,r)}var u=p0e(e);dV&&(u=u.concat(dV(e)));for(var f=hV(t),y=hV(e),T=0;T<u.length;++T){var a=u[T];if(!(a in h0e||r&&r[a]||y&&a in y||f&&a in f)){var A=m0e(e,a);try{f0e(t,a,A)}catch{}}}}return t}function J_(t){return typeof t=="function"}function rL(t){return typeof t=="object"&&"styledComponentId"in t}function Bp(t,e){return t&&e?"".concat(t," ").concat(e):t||e||""}function pV(t,e){if(t.length===0)return"";for(var r=t[0],o=1;o<t.length;o++)r+=t[o];return r}function zx(t){return t!==null&&typeof t=="object"&&t.constructor.name===Object.name&&!("props"in t&&t.$$typeof)}function Fk(t,e,r){if(r===void 0&&(r=!1),!r&&!zx(t)&&!Array.isArray(t))return e;if(Array.isArray(e))for(var o=0;o<e.length;o++)t[o]=Fk(t[o],e[o]);else if(zx(e))for(var o in e)t[o]=Fk(t[o],e[o]);return t}function iL(t,e){Object.defineProperty(t,"toString",{value:e})}function _1(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(t," for more information.").concat(e.length>0?" Args: ".concat(e.join(", ")):""))}var _0e=function(){function t(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return t.prototype.indexOfGroup=function(e){for(var r=0,o=0;o<e;o++)r+=this.groupSizes[o];return r},t.prototype.insertRules=function(e,r){if(e>=this.groupSizes.length){for(var o=this.groupSizes,u=o.length,f=u;e>=f;)if((f<<=1)<0)throw _1(16,"".concat(e));this.groupSizes=new Uint32Array(f),this.groupSizes.set(o),this.length=f;for(var y=u;y<f;y++)this.groupSizes[y]=0}for(var T=this.indexOfGroup(e+1),a=(y=0,r.length);y<a;y++)this.tag.insertRule(T,r[y])&&(this.groupSizes[e]++,T++)},t.prototype.clearGroup=function(e){if(e<this.length){var r=this.groupSizes[e],o=this.indexOfGroup(e),u=o+r;this.groupSizes[e]=0;for(var f=o;f<u;f++)this.tag.deleteRule(o)}},t.prototype.getGroup=function(e){var r="";if(e>=this.length||this.groupSizes[e]===0)return r;for(var o=this.groupSizes[e],u=this.indexOfGroup(e),f=u+o,y=u;y<f;y++)r+="".concat(this.tag.getRule(y)).concat(nL);return r},t}(),PT=new Map,GE=new Map,RT=1,Zw=function(t){if(PT.has(t))return PT.get(t);for(;GE.has(RT);)RT++;var e=RT++;return PT.set(t,e),GE.set(e,t),e},y0e=function(t,e){RT=e+1,PT.set(t,e),GE.set(e,t)},v0e="style[".concat(Y_,"][").concat(MW,'="').concat(zI,'"]'),x0e=new RegExp("^".concat(Y_,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),b0e=function(t,e,r){for(var o,u=r.split(","),f=0,y=u.length;f<y;f++)(o=u[f])&&t.registerName(e,o)},w0e=function(t,e){for(var r,o=((r=e.textContent)!==null&&r!==void 0?r:"").split(nL),u=[],f=0,y=o.length;f<y;f++){var T=o[f].trim();if(T){var a=T.match(x0e);if(a){var A=0|parseInt(a[1],10),D=a[2];A!==0&&(y0e(D,A),b0e(t,D,a[3]),t.getTag().insertRules(A,u)),u.length=0}else u.push(T)}}},mV=function(t){for(var e=document.querySelectorAll(v0e),r=0,o=e.length;r<o;r++){var u=e[r];u&&u.getAttribute(Y_)!==RW&&(w0e(t,u),u.parentNode&&u.parentNode.removeChild(u))}};function T0e(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var BW=function(t){var e=document.head,r=t||e,o=document.createElement("style"),u=function(T){var a=Array.from(T.querySelectorAll("style[".concat(Y_,"]")));return a[a.length-1]}(r),f=u!==void 0?u.nextSibling:null;o.setAttribute(Y_,RW),o.setAttribute(MW,zI);var y=T0e();return y&&o.setAttribute("nonce",y),r.insertBefore(o,f),o},E0e=function(){function t(e){this.element=BW(e),this.element.appendChild(document.createTextNode("")),this.sheet=function(r){if(r.sheet)return r.sheet;for(var o=document.styleSheets,u=0,f=o.length;u<f;u++){var y=o[u];if(y.ownerNode===r)return y}throw _1(17)}(this.element),this.length=0}return t.prototype.insertRule=function(e,r){try{return this.sheet.insertRule(r,e),this.length++,!0}catch{return!1}},t.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},t.prototype.getRule=function(e){var r=this.sheet.cssRules[e];return r&&r.cssText?r.cssText:""},t}(),S0e=function(){function t(e){this.element=BW(e),this.nodes=this.element.childNodes,this.length=0}return t.prototype.insertRule=function(e,r){if(e<=this.length&&e>=0){var o=document.createTextNode(r);return this.element.insertBefore(o,this.nodes[e]||null),this.length++,!0}return!1},t.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},t.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},t}(),I0e=function(){function t(e){this.rules=[],this.length=0}return t.prototype.insertRule=function(e,r){return e<=this.length&&(this.rules.splice(e,0,r),this.length++,!0)},t.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},t.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},t}(),gV=$E,A0e={isServer:!$E,useCSSOMInjection:!n0e},UW=function(){function t(e,r,o){e===void 0&&(e=Q_),r===void 0&&(r={});var u=this;this.options=Da(Da({},A0e),e),this.gs=r,this.names=new Map(o),this.server=!!e.isServer,!this.server&&$E&&gV&&(gV=!1,mV(this)),iL(this,function(){return function(f){for(var y=f.getTag(),T=y.length,a="",A=function(O){var B=function(G){return GE.get(G)}(O);if(B===void 0)return"continue";var H=f.names.get(B),Q=y.getGroup(O);if(H===void 0||!H.size||Q.length===0)return"continue";var re="".concat(Y_,".g").concat(O,'[id="').concat(B,'"]'),se="";H!==void 0&&H.forEach(function(G){G.length>0&&(se+="".concat(G,","))}),a+="".concat(Q).concat(re,'{content:"').concat(se,'"}').concat(nL)},D=0;D<T;D++)A(D);return a}(u)})}return t.registerId=function(e){return Zw(e)},t.prototype.rehydrate=function(){!this.server&&$E&&mV(this)},t.prototype.reconstructWithOptions=function(e,r){return r===void 0&&(r=!0),new t(Da(Da({},this.options),e),this.gs,r&&this.names||void 0)},t.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},t.prototype.getTag=function(){return this.tag||(this.tag=(e=function(r){var o=r.useCSSOMInjection,u=r.target;return r.isServer?new I0e(u):o?new E0e(u):new S0e(u)}(this.options),new _0e(e)));var e},t.prototype.hasNameForId=function(e,r){return this.names.has(e)&&this.names.get(e).has(r)},t.prototype.registerName=function(e,r){if(Zw(e),this.names.has(e))this.names.get(e).add(r);else{var o=new Set;o.add(r),this.names.set(e,o)}},t.prototype.insertRules=function(e,r,o){this.registerName(e,r),this.getTag().insertRules(Zw(e),o)},t.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},t.prototype.clearRules=function(e){this.getTag().clearGroup(Zw(e)),this.clearNames(e)},t.prototype.clearTag=function(){this.tag=void 0},t}(),C0e=/&/g,P0e=/^\s*\/\/.*$/gm;function VW(t,e){return t.map(function(r){return r.type==="rule"&&(r.value="".concat(e," ").concat(r.value),r.value=r.value.replaceAll(",",",".concat(e," ")),r.props=r.props.map(function(o){return"".concat(e," ").concat(o)})),Array.isArray(r.children)&&r.type!=="@keyframes"&&(r.children=VW(r.children,e)),r})}function R0e(t){var e,r,o,u=Q_,f=u.options,y=f===void 0?Q_:f,T=u.plugins,a=T===void 0?NI:T,A=function(B,H,Q){return Q.startsWith(r)&&Q.endsWith(r)&&Q.replaceAll(r,"").length>0?".".concat(e):B},D=a.slice();D.push(function(B){B.type===kI&&B.value.includes("&")&&(B.props[0]=B.props[0].replace(C0e,r).replace(o,A))}),y.prefix&&D.push(e0e),D.push(Yye);var O=function(B,H,Q,re){H===void 0&&(H=""),Q===void 0&&(Q=""),re===void 0&&(re="&"),e=re,r=H,o=new RegExp("\\".concat(r,"\\b"),"g");var se=B.replace(P0e,""),G=Xye(Q||H?"".concat(Q," ").concat(H," { ").concat(se," }"):se);y.namespace&&(G=VW(G,y.namespace));var Y=[];return jE(G,Qye(D.concat(Jye(function(Z){return Y.push(Z)})))),Y};return O.hash=a.length?a.reduce(function(B,H){return H.name||_1(15),c_(B,H.name)},DW).toString():"",O}var M0e=new UW,Bk=R0e(),jW=vi.createContext({shouldForwardProp:void 0,styleSheet:M0e,stylis:Bk});jW.Consumer;vi.createContext(void 0);function _V(){return ue.useContext(jW)}var k0e=function(){function t(e,r){var o=this;this.inject=function(u,f){f===void 0&&(f=Bk);var y=o.name+f.hash;u.hasNameForId(o.id,y)||u.insertRules(o.id,y,f(o.rules,y,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=r,iL(this,function(){throw _1(12,String(o.name))})}return t.prototype.getName=function(e){return e===void 0&&(e=Bk),this.name+e.hash},t}(),D0e=function(t){return t>="A"&&t<="Z"};function yV(t){for(var e="",r=0;r<t.length;r++){var o=t[r];if(r===1&&o==="-"&&t[0]==="-")return t;D0e(o)?e+="-"+o.toLowerCase():e+=o}return e.startsWith("ms-")?"-"+e:e}var $W=function(t){return t==null||t===!1||t===""},GW=function(t){var e,r,o=[];for(var u in t){var f=t[u];t.hasOwnProperty(u)&&!$W(f)&&(Array.isArray(f)&&f.isCss||J_(f)?o.push("".concat(yV(u),":"),f,";"):zx(f)?o.push.apply(o,VE(VE(["".concat(u," {")],GW(f),!1),["}"],!1)):o.push("".concat(yV(u),": ").concat((e=u,(r=f)==null||typeof r=="boolean"||r===""?"":typeof r!="number"||r===0||e in t0e||e.startsWith("--")?String(r).trim():"".concat(r,"px")),";")))}return o};function Zp(t,e,r,o){if($W(t))return[];if(rL(t))return[".".concat(t.styledComponentId)];if(J_(t)){if(!J_(f=t)||f.prototype&&f.prototype.isReactComponent||!e)return[t];var u=t(e);return Zp(u,e,r,o)}var f;return t instanceof k0e?r?(t.inject(r,o),[t.getName(o)]):[t]:zx(t)?GW(t):Array.isArray(t)?Array.prototype.concat.apply(NI,t.map(function(y){return Zp(y,e,r,o)})):[t.toString()]}function O0e(t){for(var e=0;e<t.length;e+=1){var r=t[e];if(J_(r)&&!rL(r))return!1}return!0}var L0e=OW(zI),z0e=function(){function t(e,r,o){this.rules=e,this.staticRulesId="",this.isStatic=(o===void 0||o.isStatic)&&O0e(e),this.componentId=r,this.baseHash=c_(L0e,r),this.baseStyle=o,UW.registerId(r)}return t.prototype.generateAndInjectStyles=function(e,r,o){var u=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,r,o):"";if(this.isStatic&&!o.hash)if(this.staticRulesId&&r.hasNameForId(this.componentId,this.staticRulesId))u=Bp(u,this.staticRulesId);else{var f=pV(Zp(this.rules,e,r,o)),y=Nk(c_(this.baseHash,f)>>>0);if(!r.hasNameForId(this.componentId,y)){var T=o(f,".".concat(y),void 0,this.componentId);r.insertRules(this.componentId,y,T)}u=Bp(u,y),this.staticRulesId=y}else{for(var a=c_(this.baseHash,o.hash),A="",D=0;D<this.rules.length;D++){var O=this.rules[D];if(typeof O=="string")A+=O;else if(O){var B=pV(Zp(O,e,r,o));a=c_(a,B+D),A+=B}}if(A){var H=Nk(a>>>0);r.hasNameForId(this.componentId,H)||r.insertRules(this.componentId,H,o(A,".".concat(H),void 0,this.componentId)),u=Bp(u,H)}}return u},t}(),qW=vi.createContext(void 0);qW.Consumer;var mR={};function N0e(t,e,r){var o=rL(t),u=t,f=!pR(t),y=e.attrs,T=y===void 0?NI:y,a=e.componentId,A=a===void 0?function(fe,Te){var Pe=typeof fe!="string"?"sc":cV(fe);mR[Pe]=(mR[Pe]||0)+1;var ce="".concat(Pe,"-").concat(a0e(zI+Pe+mR[Pe]));return Te?"".concat(Te,"-").concat(ce):ce}(e.displayName,e.parentComponentId):a,D=e.displayName,O=D===void 0?function(fe){return pR(fe)?"styled.".concat(fe):"Styled(".concat(l0e(fe),")")}(t):D,B=e.displayName&&e.componentId?"".concat(cV(e.displayName),"-").concat(e.componentId):e.componentId||A,H=o&&u.attrs?u.attrs.concat(T).filter(Boolean):T,Q=e.shouldForwardProp;if(o&&u.shouldForwardProp){var re=u.shouldForwardProp;if(e.shouldForwardProp){var se=e.shouldForwardProp;Q=function(fe,Te){return re(fe,Te)&&se(fe,Te)}}else Q=re}var G=new z0e(r,B,o?u.componentStyle:void 0);function Y(fe,Te){return function(Pe,ce,he){var W=Pe.attrs,ge=Pe.componentStyle,_e=Pe.defaultProps,Ee=Pe.foldedComponentIds,we=Pe.styledComponentId,xt=Pe.target,Rt=vi.useContext(qW),Bt=_V(),bt=Pe.shouldForwardProp||Bt.shouldForwardProp,at=r0e(ce,Rt,_e)||Q_,Ct=function(Mt,pn,un){for(var _n,St=Da(Da({},pn),{className:void 0,theme:un}),ln=0;ln<Mt.length;ln+=1){var Kt=J_(_n=Mt[ln])?_n(St):_n;for(var xn in Kt)St[xn]=xn==="className"?Bp(St[xn],Kt[xn]):xn==="style"?Da(Da({},St[xn]),Kt[xn]):Kt[xn]}return pn.className&&(St.className=Bp(St.className,pn.className)),St}(W,ce,at),Zt=Ct.as||xt,rt={};for(var wt in Ct)Ct[wt]===void 0||wt[0]==="$"||wt==="as"||wt==="theme"&&Ct.theme===at||(wt==="forwardedAs"?rt.as=Ct.forwardedAs:bt&&!bt(wt,Zt)||(rt[wt]=Ct[wt]));var pt=function(Mt,pn){var un=_V(),_n=Mt.generateAndInjectStyles(pn,un.styleSheet,un.stylis);return _n}(ge,Ct),jt=Bp(Ee,we);return pt&&(jt+=" "+pt),Ct.className&&(jt+=" "+Ct.className),rt[pR(Zt)&&!kW.has(Zt)?"class":"className"]=jt,rt.ref=he,ue.createElement(Zt,rt)}(Z,fe,Te)}Y.displayName=O;var Z=vi.forwardRef(Y);return Z.attrs=H,Z.componentStyle=G,Z.displayName=O,Z.shouldForwardProp=Q,Z.foldedComponentIds=o?Bp(u.foldedComponentIds,u.styledComponentId):"",Z.styledComponentId=B,Z.target=o?u.target:t,Object.defineProperty(Z,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(fe){this._foldedDefaultProps=o?function(Te){for(var Pe=[],ce=1;ce<arguments.length;ce++)Pe[ce-1]=arguments[ce];for(var he=0,W=Pe;he<W.length;he++)Fk(Te,W[he],!0);return Te}({},u.defaultProps,fe):fe}}),iL(Z,function(){return".".concat(Z.styledComponentId)}),f&&FW(Z,t,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),Z}function vV(t,e){for(var r=[t[0]],o=0,u=e.length;o<u;o+=1)r.push(e[o],t[o+1]);return r}var xV=function(t){return Object.assign(t,{isCss:!0})};function F0e(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(J_(t)||zx(t))return xV(Zp(vV(NI,VE([t],e,!0))));var o=t;return e.length===0&&o.length===1&&typeof o[0]=="string"?Zp(o):xV(Zp(vV(o,e)))}function Uk(t,e,r){if(r===void 0&&(r=Q_),!e)throw _1(1,e);var o=function(u){for(var f=[],y=1;y<arguments.length;y++)f[y-1]=arguments[y];return t(e,r,F0e.apply(void 0,VE([u],f,!1)))};return o.attrs=function(u){return Uk(t,e,Da(Da({},r),{attrs:Array.prototype.concat(r.attrs,u).filter(Boolean)}))},o.withConfig=function(u){return Uk(t,e,Da(Da({},r),u))},o}var WW=function(t){return Uk(N0e,t)},my=WW;kW.forEach(function(t){my[t]=WW(t)});/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function qE(t,e,r,o){return new(r||(r=Promise))(function(u,f){function y(A){try{a(o.next(A))}catch(D){f(D)}}function T(A){try{a(o.throw(A))}catch(D){f(D)}}function a(A){A.done?u(A.value):new r(function(D){D(A.value)}).then(y,T)}a((o=o.apply(t,[])).next())})}function WE(t,e){var r={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},o,u,f,y;return y={next:T(0),throw:T(1),return:T(2)},typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function T(A){return function(D){return a([A,D])}}function a(A){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,u&&(f=A[0]&2?u.return:A[0]?u.throw||((f=u.return)&&f.call(u),0):u.next)&&!(f=f.call(u,A[1])).done)return f;switch(u=0,f&&(A=[A[0]&2,f.value]),A[0]){case 0:case 1:f=A;break;case 4:return r.label++,{value:A[1],done:!1};case 5:r.label++,u=A[1],A=[0];continue;case 7:A=r.ops.pop(),r.trys.pop();continue;default:if(f=r.trys,!(f=f.length>0&&f[f.length-1])&&(A[0]===6||A[0]===2)){r=0;continue}if(A[0]===3&&(!f||A[1]>f[0]&&A[1]<f[3])){r.label=A[1];break}if(A[0]===6&&r.label<f[1]){r.label=f[1],f=A;break}if(f&&r.label<f[2]){r.label=f[2],r.ops.push(A);break}f[2]&&r.ops.pop(),r.trys.pop();continue}A=e.call(t,r)}catch(D){A=[6,D],u=0}finally{o=f=0}if(A[0]&5)throw A[1];return{value:A[0]?A[1]:void 0,done:!0}}}function y1(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var B0e=my.div(wV||(wV=y1([`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
`],[`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
`]))),U0e=my.div(TV||(TV=y1([`
  width: 100%;
  `,`
`],[`
  width: 100%;
  `,`
`])),function(t){var e=t.aspectRatio;return e==="cover"?`
    position: absolute;
    bottom: 0;
    top: 0;
    left: 0;
    right: 0;`:`
    position: relative;
    padding-bottom: `+100/e+"%;"}),bV=my.div(EV||(EV=y1([`
  padding: 40px;
`],[`
  padding: 40px;
`]))),V0e=my.video(SV||(SV=y1([`
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
  transform: rotateY(`,`);
`],[`
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
  transform: rotateY(`,`);
`])),function(t){var e=t.mirrored;return e?"180deg":"0deg"}),j0e=my.canvas(IV||(IV=y1([`
  display: none;
`],[`
  display: none;
`]))),wV,TV,EV,SV,IV,$0e=vi.forwardRef(function(t,e){var r=t.facingMode,o=r===void 0?"user":r,u=t.aspectRatio,f=u===void 0?"cover":u,y=t.numberOfCamerasCallback,T=y===void 0?function(){return null}:y,a=t.videoSourceDeviceId,A=a===void 0?void 0:a,D=t.errorMessages,O=D===void 0?{noCameraAccessible:"No camera device accessible. Please connect your camera or try a different browser.",permissionDenied:"Permission denied. Please refresh and give camera permission.",switchCamera:"It is not possible to switch camera to different one because there is only one video device accessible.",canvas:"Canvas is not supported."}:D,B=t.videoReadyCallback,H=B===void 0?function(){return null}:B,Q=ue.useRef(null),re=ue.useRef(null),se=ue.useRef(null),G=ue.useRef(null),Y=ue.useState(0),Z=Y[0],fe=Y[1],Te=ue.useState(null),Pe=Te[0],ce=Te[1],he=ue.useState(o),W=he[0],ge=he[1],_e=ue.useState(!1),Ee=_e[0],we=_e[1],xt=ue.useState(!1),Rt=xt[0],Bt=xt[1],bt=ue.useState(!1),at=bt[0],Ct=bt[1],Zt=ue.useState(!1),rt=Zt[0],wt=Zt[1],pt=ue.useRef(!1);ue.useEffect(function(){return pt.current=!0,function(){pt.current=!1}},[]),ue.useEffect(function(){T(Z)},[Z]);var jt=function(Mt){return Mt===void 0&&(Mt=!1),qE(void 0,void 0,void 0,function(){var pn,un;return WE(this,function(_n){switch(_n.label){case 0:if(!(Pe&&(navigator!=null&&navigator.mediaDevices)&&pt.current))return[3,4];if(pn=navigator.mediaDevices.getSupportedConstraints(),un=Pe.getTracks()[0],!(pn&&"torch"in pn&&un))return[3,4];_n.label=1;case 1:return _n.trys.push([1,3,,4]),[4,un.applyConstraints({advanced:[{torch:Mt}]})];case 2:return _n.sent(),[2,!0];case 3:return _n.sent(),[2,!1];case 4:return[2,!1]}})})};return ue.useEffect(function(){jt(rt)},[rt]),ue.useImperativeHandle(e,function(){return{takePhoto:function(Mt){var pn,un,_n,St,ln;if(Z<1)throw new Error(O.noCameraAccessible);if(re!=null&&re.current){var Kt=((pn=Q==null?void 0:Q.current)===null||pn===void 0?void 0:pn.videoWidth)||1280,xn=((un=Q==null?void 0:Q.current)===null||un===void 0?void 0:un.videoHeight)||720,Er=Kt/xn,Dn=((_n=G==null?void 0:G.current)===null||_n===void 0?void 0:_n.offsetWidth)||1280,hr=((St=G==null?void 0:G.current)===null||St===void 0?void 0:St.offsetHeight)||1280,Fr=Dn/hr,ar=void 0,Yn=void 0,De=void 0,Ze=void 0,st=void 0;switch(Er>Fr?(Ze=xn,De=xn*Fr,ar=(Kt-De)/2,Yn=0):(De=Kt,Ze=Kt/Fr,ar=0,Yn=(xn-Ze)/2),re.current.width=De,re.current.height=Ze,se.current||(se.current=re.current.getContext("2d",{willReadFrequently:!0})),se.current&&(Q!=null&&Q.current)&&se.current.drawImage(Q.current,ar,Yn,De,Ze,0,0,De,Ze),Mt){case"imgData":st=(ln=se.current)===null||ln===void 0?void 0:ln.getImageData(0,0,De,Ze);break;default:st=re.current.toDataURL("image/jpeg");break}return st}else throw new Error(O.canvas)},switchCamera:function(){if(Z<1)throw new Error(O.noCameraAccessible);Z<2&&console.error("Error: Unable to switch camera. Only one device is accessible.");var Mt=W==="user"?"environment":"user";return ge(Mt),Mt},getNumberOfCameras:function(){return Z},toggleTorch:function(){var Mt=!rt;return wt(Mt),Mt},torchSupported:at}}),ue.useEffect(function(){q0e(Pe,ce,W,A,fe,we,Bt,!!pt.current)},[W,A]),ue.useEffect(function(){return jt(!1).then(function(Mt){return Ct(Mt)}),Pe&&Q&&Q.current&&(Q.current.srcObject=Pe),function(){Pe&&Pe.getTracks().forEach(function(Mt){Mt.stop()})}},[Pe]),vi.createElement(U0e,{ref:G,aspectRatio:f},vi.createElement(B0e,null,Ee?vi.createElement(bV,null,O.noCameraAccessible):null,Rt?vi.createElement(bV,null,O.permissionDenied):null,vi.createElement(V0e,{ref:Q,id:"video",muted:!0,autoPlay:!0,playsInline:!0,mirrored:W==="user",onLoadedData:function(){H()}}),vi.createElement(j0e,{ref:re})))});$0e.displayName="Camera";var G0e=function(t){return qE(void 0,void 0,void 0,function(){var e;return WE(this,function(r){switch(r.label){case 0:return e=[],t!=="environment"?[3,2]:[4,navigator.mediaDevices.enumerateDevices().then(function(o){var u=o.filter(function(f){return f.kind=="videoinput"});u.forEach(function(f){var y=f.getCapabilities();y.facingMode&&y.facingMode.indexOf("environment")>=0&&y.deviceId&&e.push(y.deviceId)})})];case 1:r.sent(),r.label=2;case 2:return e.length>1?[2,e.pop()]:[2,void 0]}})})},q0e=function(t,e,r,o,u,f,y,T){return qE(void 0,void 0,void 0,function(){var a,A,D,O,B;return WE(this,function(H){switch(H.label){case 0:return t&&t.getTracks().forEach(function(Q){Q.stop()}),[4,G0e(r)];case 1:return A=H.sent(),A?a=A:a=o?{exact:o}:void 0,D={audio:!1,video:{deviceId:a,facingMode:r}},!((B=navigator==null?void 0:navigator.mediaDevices)===null||B===void 0)&&B.getUserMedia?navigator.mediaDevices.getUserMedia(D).then(function(Q){T&&e(AV(Q,u))}).catch(function(Q){CV(Q,f,y)}):(O=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,O?O(D,function(Q){return qE(void 0,void 0,void 0,function(){return WE(this,function(re){return T&&e(AV(Q,u)),[2]})})},function(Q){CV(Q,f,y)}):f(!0)),[2]}})})},AV=function(t,e){return navigator.mediaDevices.enumerateDevices().then(function(r){return e(r.filter(function(o){return o.kind==="videoinput"}).length)}),t},CV=function(t,e,r){console.error(t),t.name==="PermissionDeniedError"?r(!0):e(!0)};
